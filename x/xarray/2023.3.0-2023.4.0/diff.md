# Comparing `tmp/xarray-2023.3.0.tar.gz` & `tmp/xarray-2023.4.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "xarray-2023.3.0.tar", last modified: Wed Mar 22 16:19:16 2023, max compression
+gzip compressed data, was "xarray-2023.4.0.tar", last modified: Fri Apr 14 17:26:50 2023, max compression
```

## Comparing `xarray-2023.3.0.tar` & `xarray-2023.4.0.tar`

### file list

```diff
@@ -1,370 +1,368 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.235300 xarray-2023.3.0/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.163301 xarray-2023.3.0/.binder/
--rw-r--r--   0 runner    (1001) docker     (123)      533 2023-03-22 16:18:56.000000 xarray-2023.3.0/.binder/environment.yml
--rw-r--r--   0 runner    (1001) docker     (123)      297 2023-03-22 16:18:56.000000 xarray-2023.3.0/.codecov.yml
--rw-r--r--   0 runner    (1001) docker     (123)      115 2023-03-22 16:18:56.000000 xarray-2023.3.0/.git-blame-ignore-revs
--rw-r--r--   0 runner    (1001) docker     (123)      125 2023-03-22 16:18:56.000000 xarray-2023.3.0/.git_archival.txt
--rw-r--r--   0 runner    (1001) docker     (123)      138 2023-03-22 16:18:56.000000 xarray-2023.3.0/.gitattributes
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.163301 xarray-2023.3.0/.github/
--rw-r--r--   0 runner    (1001) docker     (123)       62 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/FUNDING.yml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.163301 xarray-2023.3.0/.github/ISSUE_TEMPLATE/
--rw-r--r--   0 runner    (1001) docker     (123)     2738 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/ISSUE_TEMPLATE/bugreport.yml
--rw-r--r--   0 runner    (1001) docker     (123)      702 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/ISSUE_TEMPLATE/config.yml
--rw-r--r--   0 runner    (1001) docker     (123)      490 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/ISSUE_TEMPLATE/misc.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1158 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/ISSUE_TEMPLATE/newfeature.yml
--rw-r--r--   0 runner    (1001) docker     (123)      258 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/PULL_REQUEST_TEMPLATE.md
--rw-r--r--   0 runner    (1001) docker     (123)      156 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/dependabot.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1242 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/labeler.yml
--rw-r--r--   0 runner    (1001) docker     (123)     2133 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/stale.yml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.163301 xarray-2023.3.0/.github/workflows/
--rw-r--r--   0 runner    (1001) docker     (123)     2748 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/workflows/benchmarks.yml
--rw-r--r--   0 runner    (1001) docker     (123)     6642 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/workflows/ci-additional.yaml
--rw-r--r--   0 runner    (1001) docker     (123)     5023 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/workflows/ci.yaml
--rw-r--r--   0 runner    (1001) docker     (123)     1163 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/workflows/configure-testpypi-version.py
--rw-r--r--   0 runner    (1001) docker     (123)      298 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/workflows/label-all.yml
--rw-r--r--   0 runner    (1001) docker     (123)      316 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/workflows/label-prs.yml
--rw-r--r--   0 runner    (1001) docker     (123)     2446 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/workflows/parse_logs.py
--rw-r--r--   0 runner    (1001) docker     (123)     1360 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/workflows/publish-test-results.yaml
--rw-r--r--   0 runner    (1001) docker     (123)     2454 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/workflows/pypi-release.yaml
--rw-r--r--   0 runner    (1001) docker     (123)     2259 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/workflows/testpypi-release.yaml
--rw-r--r--   0 runner    (1001) docker     (123)     2735 2023-03-22 16:18:56.000000 xarray-2023.3.0/.github/workflows/upstream-dev-ci.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      865 2023-03-22 16:18:56.000000 xarray-2023.3.0/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)      163 2023-03-22 16:18:56.000000 xarray-2023.3.0/.pep8speaks.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1707 2023-03-22 16:18:56.000000 xarray-2023.3.0/.pre-commit-config.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      383 2023-03-22 16:18:56.000000 xarray-2023.3.0/.readthedocs.yaml
--rw-r--r--   0 runner    (1001) docker     (123)     3064 2023-03-22 16:18:56.000000 xarray-2023.3.0/CITATION.cff
--rw-r--r--   0 runner    (1001) docker     (123)     3230 2023-03-22 16:18:56.000000 xarray-2023.3.0/CODE_OF_CONDUCT.md
--rw-r--r--   0 runner    (1001) docker     (123)      127 2023-03-22 16:18:56.000000 xarray-2023.3.0/CONTRIBUTING.md
--rw-r--r--   0 runner    (1001) docker     (123)     4538 2023-03-22 16:18:56.000000 xarray-2023.3.0/HOW_TO_RELEASE.md
--rw-r--r--   0 runner    (1001) docker     (123)    10273 2023-03-22 16:18:56.000000 xarray-2023.3.0/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     3495 2023-03-22 16:19:16.235300 xarray-2023.3.0/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     8912 2023-03-22 16:18:56.000000 xarray-2023.3.0/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.163301 xarray-2023.3.0/asv_bench/
--rw-r--r--   0 runner    (1001) docker     (123)     6287 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/asv.conf.json
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.167301 xarray-2023.3.0/asv_bench/benchmarks/
--rw-r--r--   0 runner    (1001) docker     (123)     7991 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/README_CI.md
--rw-r--r--   0 runner    (1001) docker     (123)     1654 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1192 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/combine.py
--rw-r--r--   0 runner    (1001) docker     (123)     1872 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/dataarray_missing.py
--rw-r--r--   0 runner    (1001) docker     (123)    21598 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/dataset_io.py
--rw-r--r--   0 runner    (1001) docker     (123)     4228 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/groupby.py
--rw-r--r--   0 runner    (1001) docker     (123)      500 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/import.py
--rw-r--r--   0 runner    (1001) docker     (123)     5373 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/indexing.py
--rw-r--r--   0 runner    (1001) docker     (123)     1492 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/interp.py
--rw-r--r--   0 runner    (1001) docker     (123)     2443 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/merge.py
--rw-r--r--   0 runner    (1001) docker     (123)     1674 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/pandas.py
--rw-r--r--   0 runner    (1001) docker     (123)     1021 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/polyfit.py
--rw-r--r--   0 runner    (1001) docker     (123)     1379 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/reindexing.py
--rw-r--r--   0 runner    (1001) docker     (123)      784 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/renaming.py
--rw-r--r--   0 runner    (1001) docker     (123)     1037 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/repr.py
--rw-r--r--   0 runner    (1001) docker     (123)     4603 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/rolling.py
--rw-r--r--   0 runner    (1001) docker     (123)     1860 2023-03-22 16:18:56.000000 xarray-2023.3.0/asv_bench/benchmarks/unstacking.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.167301 xarray-2023.3.0/ci/
--rwxr-xr-x   0 runner    (1001) docker     (123)     1331 2023-03-22 16:18:56.000000 xarray-2023.3.0/ci/install-upstream-wheels.sh
--rwxr-xr-x   0 runner    (1001) docker     (123)     6543 2023-03-22 16:18:56.000000 xarray-2023.3.0/ci/min_deps_check.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.171301 xarray-2023.3.0/ci/requirements/
--rw-r--r--   0 runner    (1001) docker     (123)      590 2023-03-22 16:18:56.000000 xarray-2023.3.0/ci/requirements/all-but-dask.yml
--rw-r--r--   0 runner    (1001) docker     (123)      218 2023-03-22 16:18:56.000000 xarray-2023.3.0/ci/requirements/bare-minimum.yml
--rw-r--r--   0 runner    (1001) docker     (123)      831 2023-03-22 16:18:56.000000 xarray-2023.3.0/ci/requirements/doc.yml
--rw-r--r--   0 runner    (1001) docker     (123)      650 2023-03-22 16:18:56.000000 xarray-2023.3.0/ci/requirements/environment-py311.yml
--rw-r--r--   0 runner    (1001) docker     (123)      717 2023-03-22 16:18:56.000000 xarray-2023.3.0/ci/requirements/environment-windows-py311.yml
--rw-r--r--   0 runner    (1001) docker     (123)      716 2023-03-22 16:18:56.000000 xarray-2023.3.0/ci/requirements/environment-windows.yml
--rw-r--r--   0 runner    (1001) docker     (123)      647 2023-03-22 16:18:56.000000 xarray-2023.3.0/ci/requirements/environment.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1285 2023-03-22 16:18:56.000000 xarray-2023.3.0/ci/requirements/min-all-deps.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1232 2023-03-22 16:18:56.000000 xarray-2023.3.0/conftest.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.171301 xarray-2023.3.0/design_notes/
--rw-r--r--   0 runner    (1001) docker     (123)    28105 2023-03-22 16:18:56.000000 xarray-2023.3.0/design_notes/flexible_indexes_notes.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.171301 xarray-2023.3.0/doc/
--rw-r--r--   0 runner    (1001) docker     (123)     8471 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/Makefile
--rw-r--r--   0 runner    (1001) docker     (123)      189 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/README.rst
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.179301 xarray-2023.3.0/doc/_static/
--rw-r--r--   0 runner    (1001) docker     (123)       46 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)    31185 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/advanced_selection_interpolation.svg
--rw-r--r--   0 runner    (1001) docker     (123)   114027 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/ci.png
--rw-r--r--   0 runner    (1001) docker     (123)    13488 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/dask_array.png
--rwxr-xr-x   0 runner    (1001) docker     (123)       63 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/dataset-diagram-build.sh
--rw-r--r--   0 runner    (1001) docker     (123)    13358 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/dataset-diagram-logo.pdf
--rw-r--r--   0 runner    (1001) docker     (123)   117124 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/dataset-diagram-logo.png
--rw-r--r--   0 runner    (1001) docker     (123)    66565 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/dataset-diagram-logo.svg
--rw-r--r--   0 runner    (1001) docker     (123)    11200 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/dataset-diagram-logo.tex
--rw-r--r--   0 runner    (1001) docker     (123)   183796 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/dataset-diagram-square-logo.png
--rw-r--r--   0 runner    (1001) docker     (123)    10947 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/dataset-diagram-square-logo.tex
--rw-r--r--   0 runner    (1001) docker     (123)    45348 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/dataset-diagram.png
--rw-r--r--   0 runner    (1001) docker     (123)    10875 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/dataset-diagram.tex
--rw-r--r--   0 runner    (1001) docker     (123)     4286 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/favicon.ico
--rw-r--r--   0 runner    (1001) docker     (123)     3519 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/index_api.svg
--rw-r--r--   0 runner    (1001) docker     (123)     2528 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/index_contribute.svg
--rw-r--r--   0 runner    (1001) docker     (123)     3977 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/index_getting_started.svg
--rw-r--r--   0 runner    (1001) docker     (123)     6429 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/index_user_guide.svg
--rw-r--r--   0 runner    (1001) docker     (123)    24992 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/numfocus_logo.png
--rw-r--r--   0 runner    (1001) docker     (123)   104979 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/opendap-prism-tmax.png
--rw-r--r--   0 runner    (1001) docker     (123)     4887 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/style.css
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.183301 xarray-2023.3.0/doc/_static/thumbnails/
--rw-r--r--   0 runner    (1001) docker     (123)    32739 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/thumbnails/ERA5-GRIB-example.png
--rw-r--r--   0 runner    (1001) docker     (123)    77903 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/thumbnails/ROMS_ocean_model.png
--rw-r--r--   0 runner    (1001) docker     (123)    26018 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/thumbnails/area_weighted_temperature.png
--rw-r--r--   0 runner    (1001) docker     (123)   454794 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/thumbnails/monthly-means.png
--rw-r--r--   0 runner    (1001) docker     (123)    57609 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/thumbnails/multidimensional-coords.png
--rw-r--r--   0 runner    (1001) docker     (123)    37844 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/thumbnails/toy-weather-data.png
--rw-r--r--   0 runner    (1001) docker     (123)    43053 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/thumbnails/visualization_gallery.png
--rw-r--r--   0 runner    (1001) docker     (123)   664021 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_static/view-docs.png
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.159301 xarray-2023.3.0/doc/_templates/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.183301 xarray-2023.3.0/doc/_templates/autosummary/
--rw-r--r--   0 runner    (1001) docker     (123)      151 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_templates/autosummary/accessor.rst
--rw-r--r--   0 runner    (1001) docker     (123)      160 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_templates/autosummary/accessor_attribute.rst
--rw-r--r--   0 runner    (1001) docker     (123)      168 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_templates/autosummary/accessor_callable.rst
--rw-r--r--   0 runner    (1001) docker     (123)      157 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/_templates/autosummary/accessor_method.rst
--rw-r--r--   0 runner    (1001) docker     (123)    19714 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/api-hidden.rst
--rw-r--r--   0 runner    (1001) docker     (123)    21288 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/api.rst
--rw-r--r--   0 runner    (1001) docker     (123)    14961 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/conf.py
--rw-r--r--   0 runner    (1001) docker     (123)    35835 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/contributing.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1200 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/developers-meeting.rst
--rw-r--r--   0 runner    (1001) docker     (123)     9097 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/ecosystem.rst
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.183301 xarray-2023.3.0/doc/examples/
--rw-r--r--   0 runner    (1001) docker     (123)     2823 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/examples/ERA5-GRIB-example.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)     7270 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/examples/ROMS_ocean_model.ipynb
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.187301 xarray-2023.3.0/doc/examples/_code/
--rw-r--r--   0 runner    (1001) docker     (123)      703 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/examples/_code/accessor_example.py
--rw-r--r--   0 runner    (1001) docker     (123)    28228 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/examples/apply_ufunc_vectorize_1d.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)     6187 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/examples/area_weighted_temperature.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)     1107 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/examples/blank_template.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)     7510 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/examples/monthly-means.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)   445711 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/examples/monthly_means_output.png
--rw-r--r--   0 runner    (1001) docker     (123)     6742 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/examples/multidimensional-coords.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)     8569 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/examples/visualization_gallery.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)     8734 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/examples/weather-data.ipynb
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.187301 xarray-2023.3.0/doc/gallery/
--rw-r--r--   0 runner    (1001) docker     (123)       30 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/gallery/README.txt
--rw-r--r--   0 runner    (1001) docker     (123)     1285 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/gallery/plot_cartopy_facetgrid.py
--rw-r--r--   0 runner    (1001) docker     (123)     1035 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/gallery/plot_colorbar_center.py
--rw-r--r--   0 runner    (1001) docker     (123)      848 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/gallery/plot_control_colorbar.py
--rw-r--r--   0 runner    (1001) docker     (123)      908 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/gallery/plot_lines_from_2d.py
--rw-r--r--   0 runner    (1001) docker     (123)     1339 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/gallery/plot_rasterio.py
--rw-r--r--   0 runner    (1001) docker     (123)      844 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/gallery/plot_rasterio_rgb.py
--rw-r--r--   0 runner    (1001) docker     (123)      747 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/gallery.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1844 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/gallery.yml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.187301 xarray-2023.3.0/doc/getting-started-guide/
--rw-r--r--   0 runner    (1001) docker     (123)    10728 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/getting-started-guide/faq.rst
--rw-r--r--   0 runner    (1001) docker     (123)      346 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/getting-started-guide/index.rst
--rw-r--r--   0 runner    (1001) docker     (123)     7020 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/getting-started-guide/installing.rst
--rw-r--r--   0 runner    (1001) docker     (123)     7747 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/getting-started-guide/quick-overview.rst
--rw-r--r--   0 runner    (1001) docker     (123)     5851 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/getting-started-guide/why-xarray.rst
--rw-r--r--   0 runner    (1001) docker     (123)     4535 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/howdoi.rst
--rw-r--r--   0 runner    (1001) docker     (123)     2799 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/index.rst
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.187301 xarray-2023.3.0/doc/internals/
--rw-r--r--   0 runner    (1001) docker     (123)     1416 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/internals/duck-arrays-integration.rst
--rw-r--r--   0 runner    (1001) docker     (123)     3946 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/internals/extending-xarray.rst
--rw-r--r--   0 runner    (1001) docker     (123)    17684 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/internals/how-to-add-new-backend.rst
--rw-r--r--   0 runner    (1001) docker     (123)      490 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/internals/index.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1561 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/internals/variable-objects.rst
--rw-r--r--   0 runner    (1001) docker     (123)     3083 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/internals/zarr-encoding-spec.rst
--rw-r--r--   0 runner    (1001) docker     (123)    12008 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/roadmap.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1087 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/tutorials-and-videos.rst
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.191300 xarray-2023.3.0/doc/user-guide/
--rw-r--r--   0 runner    (1001) docker     (123)    11116 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/combining.rst
--rw-r--r--   0 runner    (1001) docker     (123)    23757 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/computation.rst
--rw-r--r--   0 runner    (1001) docker     (123)    23127 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/dask.rst
--rw-r--r--   0 runner    (1001) docker     (123)    21446 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/data-structures.rst
--rw-r--r--   0 runner    (1001) docker     (123)     2812 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/duckarrays.rst
--rw-r--r--   0 runner    (1001) docker     (123)     7383 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/groupby.rst
--rw-r--r--   0 runner    (1001) docker     (123)      428 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/index.rst
--rw-r--r--   0 runner    (1001) docker     (123)    27219 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/indexing.rst
--rw-r--r--   0 runner    (1001) docker     (123)    10483 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/interpolation.rst
--rw-r--r--   0 runner    (1001) docker     (123)    48338 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/io.rst
--rw-r--r--   0 runner    (1001) docker     (123)      844 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/options.rst
--rw-r--r--   0 runner    (1001) docker     (123)     8704 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/pandas.rst
--rw-r--r--   0 runner    (1001) docker     (123)    31542 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/plotting.rst
--rw-r--r--   0 runner    (1001) docker     (123)    10658 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/reshaping.rst
--rw-r--r--   0 runner    (1001) docker     (123)     6179 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/terminology.rst
--rw-r--r--   0 runner    (1001) docker     (123)     8119 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/time-series.rst
--rw-r--r--   0 runner    (1001) docker     (123)     8818 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/user-guide/weather-climate.rst
--rw-r--r--   0 runner    (1001) docker     (123)     2479 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/videos.yml
--rw-r--r--   0 runner    (1001) docker     (123)   312986 2023-03-22 16:18:56.000000 xarray-2023.3.0/doc/whats-new.rst
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.195300 xarray-2023.3.0/licenses/
--rw-r--r--   0 runner    (1001) docker     (123)     1485 2023-03-22 16:18:56.000000 xarray-2023.3.0/licenses/DASK_LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)    18656 2023-03-22 16:18:56.000000 xarray-2023.3.0/licenses/ICOMOON_LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1543 2023-03-22 16:18:56.000000 xarray-2023.3.0/licenses/NUMPY_LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1678 2023-03-22 16:18:56.000000 xarray-2023.3.0/licenses/PANDAS_LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)    12761 2023-03-22 16:18:56.000000 xarray-2023.3.0/licenses/PYTHON_LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1531 2023-03-22 16:18:56.000000 xarray-2023.3.0/licenses/SCIKIT_LEARN_LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1498 2023-03-22 16:18:56.000000 xarray-2023.3.0/licenses/SEABORN_LICENSE
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.195300 xarray-2023.3.0/properties/
--rw-r--r--   0 runner    (1001) docker     (123)      993 2023-03-22 16:18:56.000000 xarray-2023.3.0/properties/README.md
--rw-r--r--   0 runner    (1001) docker     (123)      244 2023-03-22 16:18:56.000000 xarray-2023.3.0/properties/conftest.py
--rw-r--r--   0 runner    (1001) docker     (123)     1397 2023-03-22 16:18:56.000000 xarray-2023.3.0/properties/test_encode_decode.py
--rw-r--r--   0 runner    (1001) docker     (123)     3075 2023-03-22 16:18:56.000000 xarray-2023.3.0/properties/test_pandas_roundtrip.py
--rw-r--r--   0 runner    (1001) docker     (123)     1776 2023-03-22 16:18:56.000000 xarray-2023.3.0/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)      282 2023-03-22 16:18:56.000000 xarray-2023.3.0/requirements.txt
--rw-r--r--   0 runner    (1001) docker     (123)     4510 2023-03-22 16:19:16.235300 xarray-2023.3.0/setup.cfg
--rwxr-xr-x   0 runner    (1001) docker     (123)      103 2023-03-22 16:18:56.000000 xarray-2023.3.0/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.195300 xarray-2023.3.0/xarray/
--rw-r--r--   0 runner    (1001) docker     (123)     2916 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.203301 xarray-2023.3.0/xarray/backends/
--rw-r--r--   0 runner    (1001) docker     (123)     1743 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    64280 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/api.py
--rw-r--r--   0 runner    (1001) docker     (123)     4600 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/cfgrib_.py
--rw-r--r--   0 runner    (1001) docker     (123)    13583 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/common.py
--rw-r--r--   0 runner    (1001) docker     (123)    12264 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/file_manager.py
--rw-r--r--   0 runner    (1001) docker     (123)    13481 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/h5netcdf_.py
--rw-r--r--   0 runner    (1001) docker     (123)     5595 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/locks.py
--rw-r--r--   0 runner    (1001) docker     (123)     3661 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/lru_cache.py
--rw-r--r--   0 runner    (1001) docker     (123)     1392 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/memory.py
--rw-r--r--   0 runner    (1001) docker     (123)    19828 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/netCDF4_.py
--rw-r--r--   0 runner    (1001) docker     (123)     4163 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/netcdf3.py
--rw-r--r--   0 runner    (1001) docker     (123)     7330 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/plugins.py
--rw-r--r--   0 runner    (1001) docker     (123)     5455 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/pseudonetcdf_.py
--rw-r--r--   0 runner    (1001) docker     (123)     6022 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/pydap_.py
--rw-r--r--   0 runner    (1001) docker     (123)     4569 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/pynio_.py
--rw-r--r--   0 runner    (1001) docker     (123)    13425 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/rasterio_.py
--rw-r--r--   0 runner    (1001) docker     (123)    10398 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/scipy_.py
--rw-r--r--   0 runner    (1001) docker     (123)     1561 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/store.py
--rw-r--r--   0 runner    (1001) docker     (123)    33580 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/backends/zarr.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.203301 xarray-2023.3.0/xarray/coding/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/coding/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    13824 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/coding/calendar_ops.py
--rw-r--r--   0 runner    (1001) docker     (123)    47050 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/coding/cftime_offsets.py
--rw-r--r--   0 runner    (1001) docker     (123)    29866 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/coding/cftimeindex.py
--rw-r--r--   0 runner    (1001) docker     (123)     9256 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/coding/frequencies.py
--rw-r--r--   0 runner    (1001) docker     (123)     7959 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/coding/strings.py
--rw-r--r--   0 runner    (1001) docker     (123)    27010 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/coding/times.py
--rw-r--r--   0 runner    (1001) docker     (123)    13492 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/coding/variables.py
--rw-r--r--   0 runner    (1001) docker     (123)    32695 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/conventions.py
--rw-r--r--   0 runner    (1001) docker     (123)     9712 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/convert.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.215300 xarray-2023.3.0/xarray/core/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   293555 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/_aggregations.py
--rw-r--r--   0 runner    (1001) docker     (123)    26253 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/_typed_ops.py
--rw-r--r--   0 runner    (1001) docker     (123)    30052 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/_typed_ops.pyi
--rw-r--r--   0 runner    (1001) docker     (123)    19990 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/accessor_dt.py
--rw-r--r--   0 runner    (1001) docker     (123)    86739 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/accessor_str.py
--rw-r--r--   0 runner    (1001) docker     (123)    37445 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/alignment.py
--rw-r--r--   0 runner    (1001) docker     (123)     4406 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/arithmetic.py
--rw-r--r--   0 runner    (1001) docker     (123)    37654 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/combine.py
--rw-r--r--   0 runner    (1001) docker     (123)    61997 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/common.py
--rw-r--r--   0 runner    (1001) docker     (123)    75142 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/computation.py
--rw-r--r--   0 runner    (1001) docker     (123)    28097 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/concat.py
--rw-r--r--   0 runner    (1001) docker     (123)    16433 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/coordinates.py
--rw-r--r--   0 runner    (1001) docker     (123)     4000 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/dask_array_ops.py
--rw-r--r--   0 runner    (1001) docker     (123)   244423 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/dataarray.py
--rw-r--r--   0 runner    (1001) docker     (123)   353763 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/dataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     4869 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/dtypes.py
--rw-r--r--   0 runner    (1001) docker     (123)    22628 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/duck_array_ops.py
--rw-r--r--   0 runner    (1001) docker     (123)     3516 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/extensions.py
--rw-r--r--   0 runner    (1001) docker     (123)    27651 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/formatting.py
--rw-r--r--   0 runner    (1001) docker     (123)    10205 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/formatting_html.py
--rw-r--r--   0 runner    (1001) docker     (123)    50717 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/groupby.py
--rw-r--r--   0 runner    (1001) docker     (123)    53462 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/indexes.py
--rw-r--r--   0 runner    (1001) docker     (123)    55309 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/indexing.py
--rw-r--r--   0 runner    (1001) docker     (123)    39506 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/merge.py
--rw-r--r--   0 runner    (1001) docker     (123)    26320 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/missing.py
--rw-r--r--   0 runner    (1001) docker     (123)     5630 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/nanops.py
--rw-r--r--   0 runner    (1001) docker     (123)     1593 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/npcompat.py
--rw-r--r--   0 runner    (1001) docker     (123)     8078 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/nputils.py
--rw-r--r--   0 runner    (1001) docker     (123)     9945 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/ops.py
--rw-r--r--   0 runner    (1001) docker     (123)    11050 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/options.py
--rw-r--r--   0 runner    (1001) docker     (123)    22304 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/parallel.py
--rw-r--r--   0 runner    (1001) docker     (123)     3473 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/pdcompat.py
--rw-r--r--   0 runner    (1001) docker     (123)     2551 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/pycompat.py
--rw-r--r--   0 runner    (1001) docker     (123)    14733 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/resample.py
--rw-r--r--   0 runner    (1001) docker     (123)    19489 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/resample_cftime.py
--rw-r--r--   0 runner    (1001) docker     (123)    40289 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/rolling.py
--rw-r--r--   0 runner    (1001) docker     (123)     5745 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/rolling_exp.py
--rw-r--r--   0 runner    (1001) docker     (123)     6413 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/types.py
--rw-r--r--   0 runner    (1001) docker     (123)    35281 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/utils.py
--rw-r--r--   0 runner    (1001) docker     (123)   119492 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/variable.py
--rw-r--r--   0 runner    (1001) docker     (123)    19090 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/core/weighted.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.215300 xarray-2023.3.0/xarray/indexes/
--rw-r--r--   0 runner    (1001) docker     (123)      226 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/indexes/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.215300 xarray-2023.3.0/xarray/plot/
--rw-r--r--   0 runner    (1001) docker     (123)      573 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/plot/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    41974 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/plot/accessor.py
--rw-r--r--   0 runner    (1001) docker     (123)    85980 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/plot/dataarray_plot.py
--rw-r--r--   0 runner    (1001) docker     (123)    30817 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/plot/dataset_plot.py
--rw-r--r--   0 runner    (1001) docker     (123)    37227 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/plot/facetgrid.py
--rw-r--r--   0 runner    (1001) docker     (123)    59511 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/plot/utils.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/py.typed
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.215300 xarray-2023.3.0/xarray/static/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/static/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.219300 xarray-2023.3.0/xarray/static/css/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/static/css/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6075 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/static/css/style.css
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.219300 xarray-2023.3.0/xarray/static/html/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/static/html/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1343 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/static/html/icons-svg-inline.html
--rw-r--r--   0 runner    (1001) docker     (123)    14507 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/testing.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.231300 xarray-2023.3.0/xarray/tests/
--rw-r--r--   0 runner    (1001) docker     (123)     8206 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2145 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/conftest.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.231300 xarray-2023.3.0/xarray/tests/data/
--rw-r--r--   0 runner    (1001) docker     (123)     1184 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/data/bears.nc
--rw-r--r--   0 runner    (1001) docker     (123)     5232 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/data/example.grib
--rw-r--r--   0 runner    (1001) docker     (123)      783 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/data/example.ict
--rw-r--r--   0 runner    (1001) docker     (123)      608 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/data/example.uamiv
--rw-r--r--   0 runner    (1001) docker     (123)     1736 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/data/example_1.nc
--rw-r--r--   0 runner    (1001) docker     (123)      470 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/data/example_1.nc.gz
--rw-r--r--   0 runner    (1001) docker     (123)    20093 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_accessor_dt.py
--rw-r--r--   0 runner    (1001) docker     (123)   121928 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_accessor_str.py
--rw-r--r--   0 runner    (1001) docker     (123)     3705 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_array_api.py
--rw-r--r--   0 runner    (1001) docker     (123)   227702 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_backends.py
--rw-r--r--   0 runner    (1001) docker     (123)     7152 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_backends_api.py
--rw-r--r--   0 runner    (1001) docker     (123)      774 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_backends_common.py
--rw-r--r--   0 runner    (1001) docker     (123)     7176 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_backends_file_manager.py
--rw-r--r--   0 runner    (1001) docker     (123)      366 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_backends_locks.py
--rw-r--r--   0 runner    (1001) docker     (123)     2300 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_backends_lru_cache.py
--rw-r--r--   0 runner    (1001) docker     (123)     7536 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_calendar_ops.py
--rw-r--r--   0 runner    (1001) docker     (123)    44905 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_cftime_offsets.py
--rw-r--r--   0 runner    (1001) docker     (123)    40106 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_cftimeindex.py
--rw-r--r--   0 runner    (1001) docker     (123)     9248 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_cftimeindex_resample.py
--rw-r--r--   0 runner    (1001) docker     (123)    11478 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_coarsen.py
--rw-r--r--   0 runner    (1001) docker     (123)     5162 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_coding.py
--rw-r--r--   0 runner    (1001) docker     (123)     8071 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_coding_strings.py
--rw-r--r--   0 runner    (1001) docker     (123)    43161 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_coding_times.py
--rw-r--r--   0 runner    (1001) docker     (123)    44271 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_combine.py
--rw-r--r--   0 runner    (1001) docker     (123)    76074 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_computation.py
--rw-r--r--   0 runner    (1001) docker     (123)    46022 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_concat.py
--rw-r--r--   0 runner    (1001) docker     (123)    18739 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_conventions.py
--rw-r--r--   0 runner    (1001) docker     (123)     1681 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_cupy.py
--rw-r--r--   0 runner    (1001) docker     (123)    59762 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_dask.py
--rw-r--r--   0 runner    (1001) docker     (123)   245036 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_dataarray.py
--rw-r--r--   0 runner    (1001) docker     (123)   256583 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_dataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     4300 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_deprecation_helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)     8962 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_distributed.py
--rw-r--r--   0 runner    (1001) docker     (123)     3472 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_dtypes.py
--rw-r--r--   0 runner    (1001) docker     (123)    30666 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_duck_array_ops.py
--rw-r--r--   0 runner    (1001) docker     (123)     2737 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_extensions.py
--rw-r--r--   0 runner    (1001) docker     (123)    24804 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_formatting.py
--rw-r--r--   0 runner    (1001) docker     (123)     6549 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_formatting_html.py
--rw-r--r--   0 runner    (1001) docker     (123)    76624 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_groupby.py
--rw-r--r--   0 runner    (1001) docker     (123)    25785 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_indexes.py
--rw-r--r--   0 runner    (1001) docker     (123)    31184 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_indexing.py
--rw-r--r--   0 runner    (1001) docker     (123)    29906 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_interp.py
--rw-r--r--   0 runner    (1001) docker     (123)    18119 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_merge.py
--rw-r--r--   0 runner    (1001) docker     (123)    23834 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_missing.py
--rw-r--r--   0 runner    (1001) docker     (123)      987 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_nputils.py
--rw-r--r--   0 runner    (1001) docker     (123)     7670 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_options.py
--rw-r--r--   0 runner    (1001) docker     (123)   118673 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_plot.py
--rw-r--r--   0 runner    (1001) docker     (123)     7971 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_plugins.py
--rw-r--r--   0 runner    (1001) docker     (123)      200 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_print_versions.py
--rw-r--r--   0 runner    (1001) docker     (123)    31207 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_rolling.py
--rw-r--r--   0 runner    (1001) docker     (123)    28760 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_sparse.py
--rw-r--r--   0 runner    (1001) docker     (123)     4723 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_testing.py
--rw-r--r--   0 runner    (1001) docker     (123)      982 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_tutorial.py
--rw-r--r--   0 runner    (1001) docker     (123)     4738 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_ufuncs.py
--rw-r--r--   0 runner    (1001) docker     (123)   188860 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_units.py
--rw-r--r--   0 runner    (1001) docker     (123)    11185 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)   108521 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_variable.py
--rw-r--r--   0 runner    (1001) docker     (123)    24189 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tests/test_weighted.py
--rw-r--r--   0 runner    (1001) docker     (123)     9523 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/tutorial.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.235300 xarray-2023.3.0/xarray/util/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4272 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/util/deprecation_helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)    17583 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/util/generate_aggregations.py
--rw-r--r--   0 runner    (1001) docker     (123)     9194 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/util/generate_ops.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     5319 2023-03-22 16:18:56.000000 xarray-2023.3.0/xarray/util/print_versions.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-22 16:19:16.199301 xarray-2023.3.0/xarray.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     3495 2023-03-22 16:19:16.000000 xarray-2023.3.0/xarray.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     9698 2023-03-22 16:19:16.000000 xarray-2023.3.0/xarray.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-03-22 16:19:16.000000 xarray-2023.3.0/xarray.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-03-22 16:19:15.000000 xarray-2023.3.0/xarray.egg-info/not-zip-safe
--rw-r--r--   0 runner    (1001) docker     (123)      722 2023-03-22 16:19:16.000000 xarray-2023.3.0/xarray.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        7 2023-03-22 16:19:16.000000 xarray-2023.3.0/xarray.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.160274 xarray-2023.4.0/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.116285 xarray-2023.4.0/.binder/
+-rw-r--r--   0 runner    (1001) docker     (123)      533 2023-04-14 17:26:35.000000 xarray-2023.4.0/.binder/environment.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      297 2023-04-14 17:26:35.000000 xarray-2023.4.0/.codecov.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      115 2023-04-14 17:26:35.000000 xarray-2023.4.0/.git-blame-ignore-revs
+-rw-r--r--   0 runner    (1001) docker     (123)      125 2023-04-14 17:26:35.000000 xarray-2023.4.0/.git_archival.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      138 2023-04-14 17:26:35.000000 xarray-2023.4.0/.gitattributes
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.120284 xarray-2023.4.0/.github/
+-rw-r--r--   0 runner    (1001) docker     (123)       62 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/FUNDING.yml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.120284 xarray-2023.4.0/.github/ISSUE_TEMPLATE/
+-rw-r--r--   0 runner    (1001) docker     (123)     2738 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/ISSUE_TEMPLATE/bugreport.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      702 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/ISSUE_TEMPLATE/config.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      490 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/ISSUE_TEMPLATE/misc.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1158 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/ISSUE_TEMPLATE/newfeature.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      258 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/PULL_REQUEST_TEMPLATE.md
+-rw-r--r--   0 runner    (1001) docker     (123)     1167 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/config.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      156 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/dependabot.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1242 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/labeler.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     2133 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/stale.yml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.120284 xarray-2023.4.0/.github/workflows/
+-rw-r--r--   0 runner    (1001) docker     (123)     2748 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/workflows/benchmarks.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     6642 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/workflows/ci-additional.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)     5047 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/workflows/ci.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)     1163 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/workflows/configure-testpypi-version.py
+-rw-r--r--   0 runner    (1001) docker     (123)      298 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/workflows/label-all.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      221 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/workflows/label-prs.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     2446 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/workflows/parse_logs.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1360 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/workflows/publish-test-results.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)     2454 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/workflows/pypi-release.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)     2259 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/workflows/testpypi-release.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)     2735 2023-04-14 17:26:35.000000 xarray-2023.4.0/.github/workflows/upstream-dev-ci.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      865 2023-04-14 17:26:35.000000 xarray-2023.4.0/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)      163 2023-04-14 17:26:35.000000 xarray-2023.4.0/.pep8speaks.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1689 2023-04-14 17:26:35.000000 xarray-2023.4.0/.pre-commit-config.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      383 2023-04-14 17:26:35.000000 xarray-2023.4.0/.readthedocs.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)     3064 2023-04-14 17:26:35.000000 xarray-2023.4.0/CITATION.cff
+-rw-r--r--   0 runner    (1001) docker     (123)     3230 2023-04-14 17:26:35.000000 xarray-2023.4.0/CODE_OF_CONDUCT.md
+-rw-r--r--   0 runner    (1001) docker     (123)      127 2023-04-14 17:26:35.000000 xarray-2023.4.0/CONTRIBUTING.md
+-rw-r--r--   0 runner    (1001) docker     (123)     4538 2023-04-14 17:26:35.000000 xarray-2023.4.0/HOW_TO_RELEASE.md
+-rw-r--r--   0 runner    (1001) docker     (123)    10273 2023-04-14 17:26:35.000000 xarray-2023.4.0/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     3495 2023-04-14 17:26:50.160274 xarray-2023.4.0/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     8944 2023-04-14 17:26:35.000000 xarray-2023.4.0/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.120284 xarray-2023.4.0/asv_bench/
+-rw-r--r--   0 runner    (1001) docker     (123)     6311 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/asv.conf.json
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.120284 xarray-2023.4.0/asv_bench/benchmarks/
+-rw-r--r--   0 runner    (1001) docker     (123)     7991 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/README_CI.md
+-rw-r--r--   0 runner    (1001) docker     (123)     1654 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1648 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/alignment.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1192 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/combine.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1872 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/dataarray_missing.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21598 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/dataset_io.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4421 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/groupby.py
+-rw-r--r--   0 runner    (1001) docker     (123)      500 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/import.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5373 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/indexing.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1492 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/interp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2443 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/merge.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1674 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/pandas.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1021 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/polyfit.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1379 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/reindexing.py
+-rw-r--r--   0 runner    (1001) docker     (123)      784 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/renaming.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1037 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/repr.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4603 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/rolling.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1860 2023-04-14 17:26:35.000000 xarray-2023.4.0/asv_bench/benchmarks/unstacking.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.124283 xarray-2023.4.0/ci/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1232 2023-04-14 17:26:35.000000 xarray-2023.4.0/ci/install-upstream-wheels.sh
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6565 2023-04-14 17:26:35.000000 xarray-2023.4.0/ci/min_deps_check.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.124283 xarray-2023.4.0/ci/requirements/
+-rw-r--r--   0 runner    (1001) docker     (123)      596 2023-04-14 17:26:35.000000 xarray-2023.4.0/ci/requirements/all-but-dask.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      237 2023-04-14 17:26:35.000000 xarray-2023.4.0/ci/requirements/bare-minimum.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      812 2023-04-14 17:26:35.000000 xarray-2023.4.0/ci/requirements/doc.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      656 2023-04-14 17:26:35.000000 xarray-2023.4.0/ci/requirements/environment-py311.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      631 2023-04-14 17:26:35.000000 xarray-2023.4.0/ci/requirements/environment-windows-py311.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      630 2023-04-14 17:26:35.000000 xarray-2023.4.0/ci/requirements/environment-windows.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      653 2023-04-14 17:26:35.000000 xarray-2023.4.0/ci/requirements/environment.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1289 2023-04-14 17:26:35.000000 xarray-2023.4.0/ci/requirements/min-all-deps.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1232 2023-04-14 17:26:35.000000 xarray-2023.4.0/conftest.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.124283 xarray-2023.4.0/design_notes/
+-rw-r--r--   0 runner    (1001) docker     (123)    28105 2023-04-14 17:26:35.000000 xarray-2023.4.0/design_notes/flexible_indexes_notes.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.124283 xarray-2023.4.0/doc/
+-rw-r--r--   0 runner    (1001) docker     (123)     8471 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/Makefile
+-rw-r--r--   0 runner    (1001) docker     (123)      189 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/README.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.128282 xarray-2023.4.0/doc/_static/
+-rw-r--r--   0 runner    (1001) docker     (123)       46 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)    31185 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/advanced_selection_interpolation.svg
+-rw-r--r--   0 runner    (1001) docker     (123)   114027 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/ci.png
+-rw-r--r--   0 runner    (1001) docker     (123)    13488 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/dask_array.png
+-rwxr-xr-x   0 runner    (1001) docker     (123)       63 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/dataset-diagram-build.sh
+-rw-r--r--   0 runner    (1001) docker     (123)    13358 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/dataset-diagram-logo.pdf
+-rw-r--r--   0 runner    (1001) docker     (123)   117124 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/dataset-diagram-logo.png
+-rw-r--r--   0 runner    (1001) docker     (123)    66565 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/dataset-diagram-logo.svg
+-rw-r--r--   0 runner    (1001) docker     (123)    11200 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/dataset-diagram-logo.tex
+-rw-r--r--   0 runner    (1001) docker     (123)   183796 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/dataset-diagram-square-logo.png
+-rw-r--r--   0 runner    (1001) docker     (123)    10947 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/dataset-diagram-square-logo.tex
+-rw-r--r--   0 runner    (1001) docker     (123)    45348 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/dataset-diagram.png
+-rw-r--r--   0 runner    (1001) docker     (123)    10875 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/dataset-diagram.tex
+-rw-r--r--   0 runner    (1001) docker     (123)     4286 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/favicon.ico
+-rw-r--r--   0 runner    (1001) docker     (123)     3519 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/index_api.svg
+-rw-r--r--   0 runner    (1001) docker     (123)     2528 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/index_contribute.svg
+-rw-r--r--   0 runner    (1001) docker     (123)     3977 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/index_getting_started.svg
+-rw-r--r--   0 runner    (1001) docker     (123)     6429 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/index_user_guide.svg
+-rw-r--r--   0 runner    (1001) docker     (123)    24992 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/numfocus_logo.png
+-rw-r--r--   0 runner    (1001) docker     (123)   104979 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/opendap-prism-tmax.png
+-rw-r--r--   0 runner    (1001) docker     (123)     4761 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/style.css
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.132281 xarray-2023.4.0/doc/_static/thumbnails/
+-rw-r--r--   0 runner    (1001) docker     (123)    32739 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/thumbnails/ERA5-GRIB-example.png
+-rw-r--r--   0 runner    (1001) docker     (123)    77903 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/thumbnails/ROMS_ocean_model.png
+-rw-r--r--   0 runner    (1001) docker     (123)    26018 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/thumbnails/area_weighted_temperature.png
+-rw-r--r--   0 runner    (1001) docker     (123)   454794 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/thumbnails/monthly-means.png
+-rw-r--r--   0 runner    (1001) docker     (123)    57609 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/thumbnails/multidimensional-coords.png
+-rw-r--r--   0 runner    (1001) docker     (123)    37844 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/thumbnails/toy-weather-data.png
+-rw-r--r--   0 runner    (1001) docker     (123)    43053 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/thumbnails/visualization_gallery.png
+-rw-r--r--   0 runner    (1001) docker     (123)   664021 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_static/view-docs.png
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.112286 xarray-2023.4.0/doc/_templates/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.132281 xarray-2023.4.0/doc/_templates/autosummary/
+-rw-r--r--   0 runner    (1001) docker     (123)      151 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_templates/autosummary/accessor.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      160 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_templates/autosummary/accessor_attribute.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      168 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_templates/autosummary/accessor_callable.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      157 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/_templates/autosummary/accessor_method.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    19245 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/api-hidden.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    21348 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/api.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    14644 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/conf.py
+-rw-r--r--   0 runner    (1001) docker     (123)    42873 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/contributing.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1200 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/developers-meeting.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     9097 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/ecosystem.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.132281 xarray-2023.4.0/doc/examples/
+-rw-r--r--   0 runner    (1001) docker     (123)     2823 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/examples/ERA5-GRIB-example.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)     7270 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/examples/ROMS_ocean_model.ipynb
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.132281 xarray-2023.4.0/doc/examples/_code/
+-rw-r--r--   0 runner    (1001) docker     (123)      703 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/examples/_code/accessor_example.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28228 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/examples/apply_ufunc_vectorize_1d.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)     6187 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/examples/area_weighted_temperature.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)     1107 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/examples/blank_template.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)     7510 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/examples/monthly-means.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)   445711 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/examples/monthly_means_output.png
+-rw-r--r--   0 runner    (1001) docker     (123)     6742 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/examples/multidimensional-coords.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)     8569 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/examples/visualization_gallery.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)     8734 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/examples/weather-data.ipynb
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.132281 xarray-2023.4.0/doc/gallery/
+-rw-r--r--   0 runner    (1001) docker     (123)       30 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/gallery/README.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1285 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/gallery/plot_cartopy_facetgrid.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1035 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/gallery/plot_colorbar_center.py
+-rw-r--r--   0 runner    (1001) docker     (123)      848 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/gallery/plot_control_colorbar.py
+-rw-r--r--   0 runner    (1001) docker     (123)      908 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/gallery/plot_lines_from_2d.py
+-rw-r--r--   0 runner    (1001) docker     (123)      747 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/gallery.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1844 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/gallery.yml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.136280 xarray-2023.4.0/doc/getting-started-guide/
+-rw-r--r--   0 runner    (1001) docker     (123)    20697 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/getting-started-guide/faq.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      346 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/getting-started-guide/index.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     6801 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/getting-started-guide/installing.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     7747 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/getting-started-guide/quick-overview.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     5851 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/getting-started-guide/why-xarray.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     4535 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/howdoi.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     2799 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/index.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.136280 xarray-2023.4.0/doc/internals/
+-rw-r--r--   0 runner    (1001) docker     (123)     1416 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/internals/duck-arrays-integration.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     4040 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/internals/extending-xarray.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    17684 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/internals/how-to-add-new-backend.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      490 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/internals/index.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1561 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/internals/variable-objects.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     3083 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/internals/zarr-encoding-spec.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    12008 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/roadmap.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1087 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/tutorials-and-videos.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.136280 xarray-2023.4.0/doc/user-guide/
+-rw-r--r--   0 runner    (1001) docker     (123)    11116 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/combining.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    29078 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/computation.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    23127 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/dask.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    21446 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/data-structures.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     2812 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/duckarrays.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     7383 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/groupby.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      428 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/index.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    27433 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/indexing.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    10483 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/interpolation.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    47085 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/io.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      844 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/options.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     8704 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/pandas.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    31542 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/plotting.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    11220 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/reshaping.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     6179 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/terminology.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     8365 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/time-series.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     9199 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/user-guide/weather-climate.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     2479 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/videos.yml
+-rw-r--r--   0 runner    (1001) docker     (123)   317501 2023-04-14 17:26:35.000000 xarray-2023.4.0/doc/whats-new.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.136280 xarray-2023.4.0/licenses/
+-rw-r--r--   0 runner    (1001) docker     (123)     1485 2023-04-14 17:26:35.000000 xarray-2023.4.0/licenses/DASK_LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)    18656 2023-04-14 17:26:35.000000 xarray-2023.4.0/licenses/ICOMOON_LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1543 2023-04-14 17:26:35.000000 xarray-2023.4.0/licenses/NUMPY_LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1678 2023-04-14 17:26:35.000000 xarray-2023.4.0/licenses/PANDAS_LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)    12761 2023-04-14 17:26:35.000000 xarray-2023.4.0/licenses/PYTHON_LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1531 2023-04-14 17:26:35.000000 xarray-2023.4.0/licenses/SCIKIT_LEARN_LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1498 2023-04-14 17:26:35.000000 xarray-2023.4.0/licenses/SEABORN_LICENSE
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.140279 xarray-2023.4.0/properties/
+-rw-r--r--   0 runner    (1001) docker     (123)      993 2023-04-14 17:26:35.000000 xarray-2023.4.0/properties/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)      244 2023-04-14 17:26:35.000000 xarray-2023.4.0/properties/conftest.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1397 2023-04-14 17:26:35.000000 xarray-2023.4.0/properties/test_encode_decode.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3075 2023-04-14 17:26:35.000000 xarray-2023.4.0/properties/test_pandas_roundtrip.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1760 2023-04-14 17:26:35.000000 xarray-2023.4.0/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)      282 2023-04-14 17:26:35.000000 xarray-2023.4.0/requirements.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     4488 2023-04-14 17:26:50.160274 xarray-2023.4.0/setup.cfg
+-rwxr-xr-x   0 runner    (1001) docker     (123)      103 2023-04-14 17:26:35.000000 xarray-2023.4.0/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.140279 xarray-2023.4.0/xarray/
+-rw-r--r--   0 runner    (1001) docker     (123)     2843 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.140279 xarray-2023.4.0/xarray/backends/
+-rw-r--r--   0 runner    (1001) docker     (123)     1708 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    64180 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/api.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13561 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/common.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12264 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/file_manager.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13947 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/h5netcdf_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5595 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/locks.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3661 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/lru_cache.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1392 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/memory.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20307 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/netCDF4_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4163 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/netcdf3.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8139 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/plugins.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5696 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/pseudonetcdf_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6472 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/pydap_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4893 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/pynio_.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10902 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/scipy_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2062 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/store.py
+-rw-r--r--   0 runner    (1001) docker     (123)    34243 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/backends/zarr.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.144278 xarray-2023.4.0/xarray/coding/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/coding/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13824 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/coding/calendar_ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)    47274 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/coding/cftime_offsets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    29864 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/coding/cftimeindex.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9256 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/coding/frequencies.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7959 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/coding/strings.py
+-rw-r--r--   0 runner    (1001) docker     (123)    27896 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/coding/times.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19049 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/coding/variables.py
+-rw-r--r--   0 runner    (1001) docker     (123)    29000 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/conventions.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9712 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/convert.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.148277 xarray-2023.4.0/xarray/core/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   293555 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/_aggregations.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26253 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/_typed_ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30052 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/_typed_ops.pyi
+-rw-r--r--   0 runner    (1001) docker     (123)    20004 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/accessor_dt.py
+-rw-r--r--   0 runner    (1001) docker     (123)    86739 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/accessor_str.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37538 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/alignment.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4406 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/arithmetic.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37654 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/combine.py
+-rw-r--r--   0 runner    (1001) docker     (123)    61997 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/common.py
+-rw-r--r--   0 runner    (1001) docker     (123)    75080 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/computation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28097 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/concat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16433 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/coordinates.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4000 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/dask_array_ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)   254214 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/dataarray.py
+-rw-r--r--   0 runner    (1001) docker     (123)   354135 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/dataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4869 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/dtypes.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22628 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/duck_array_ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3516 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/extensions.py
+-rw-r--r--   0 runner    (1001) docker     (123)    27908 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/formatting.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10214 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/formatting_html.py
+-rw-r--r--   0 runner    (1001) docker     (123)    52176 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/groupby.py
+-rw-r--r--   0 runner    (1001) docker     (123)    54154 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/indexes.py
+-rw-r--r--   0 runner    (1001) docker     (123)    57705 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/indexing.py
+-rw-r--r--   0 runner    (1001) docker     (123)    39490 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/merge.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26320 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/missing.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5630 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/nanops.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1593 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/npcompat.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8209 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/nputils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9945 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11050 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/options.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22317 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/parallel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3903 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/pdcompat.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2551 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/pycompat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13973 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/resample.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19469 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/resample_cftime.py
+-rw-r--r--   0 runner    (1001) docker     (123)    40289 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/rolling.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5745 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/rolling_exp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6413 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/types.py
+-rw-r--r--   0 runner    (1001) docker     (123)    35281 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)   119875 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/variable.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19090 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/core/weighted.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.148277 xarray-2023.4.0/xarray/indexes/
+-rw-r--r--   0 runner    (1001) docker     (123)      226 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/indexes/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.152276 xarray-2023.4.0/xarray/plot/
+-rw-r--r--   0 runner    (1001) docker     (123)      573 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/plot/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    41974 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/plot/accessor.py
+-rw-r--r--   0 runner    (1001) docker     (123)    85980 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/plot/dataarray_plot.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30818 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/plot/dataset_plot.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37227 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/plot/facetgrid.py
+-rw-r--r--   0 runner    (1001) docker     (123)    59520 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/plot/utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/py.typed
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.152276 xarray-2023.4.0/xarray/static/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/static/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.152276 xarray-2023.4.0/xarray/static/css/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/static/css/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6075 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/static/css/style.css
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.152276 xarray-2023.4.0/xarray/static/html/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/static/html/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1343 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/static/html/icons-svg-inline.html
+-rw-r--r--   0 runner    (1001) docker     (123)    14507 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/testing.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.160274 xarray-2023.4.0/xarray/tests/
+-rw-r--r--   0 runner    (1001) docker     (123)     8789 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2145 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/conftest.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.160274 xarray-2023.4.0/xarray/tests/data/
+-rw-r--r--   0 runner    (1001) docker     (123)     1184 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/data/bears.nc
+-rw-r--r--   0 runner    (1001) docker     (123)     5232 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/data/example.grib
+-rw-r--r--   0 runner    (1001) docker     (123)      783 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/data/example.ict
+-rw-r--r--   0 runner    (1001) docker     (123)      608 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/data/example.uamiv
+-rw-r--r--   0 runner    (1001) docker     (123)     1736 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/data/example_1.nc
+-rw-r--r--   0 runner    (1001) docker     (123)      470 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/data/example_1.nc.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    20566 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_accessor_dt.py
+-rw-r--r--   0 runner    (1001) docker     (123)   121928 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_accessor_str.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3705 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_array_api.py
+-rw-r--r--   0 runner    (1001) docker     (123)   205405 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_backends.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7152 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_backends_api.py
+-rw-r--r--   0 runner    (1001) docker     (123)      774 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_backends_common.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7176 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_backends_file_manager.py
+-rw-r--r--   0 runner    (1001) docker     (123)      366 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_backends_locks.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2300 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_backends_lru_cache.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7536 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_calendar_ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)    44969 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_cftime_offsets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    40106 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_cftimeindex.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9248 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_cftimeindex_resample.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11478 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_coarsen.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5162 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_coding.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8071 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_coding_strings.py
+-rw-r--r--   0 runner    (1001) docker     (123)    43161 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_coding_times.py
+-rw-r--r--   0 runner    (1001) docker     (123)    44271 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_combine.py
+-rw-r--r--   0 runner    (1001) docker     (123)    77115 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_computation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    46086 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_concat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18885 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_conventions.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1681 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_cupy.py
+-rw-r--r--   0 runner    (1001) docker     (123)    59984 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_dask.py
+-rw-r--r--   0 runner    (1001) docker     (123)   246009 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_dataarray.py
+-rw-r--r--   0 runner    (1001) docker     (123)   259858 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_dataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4300 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_deprecation_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7699 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_distributed.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3472 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_dtypes.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30666 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_duck_array_ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2737 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_extensions.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24804 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_formatting.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6549 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_formatting_html.py
+-rw-r--r--   0 runner    (1001) docker     (123)    79061 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_groupby.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25785 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_indexes.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31184 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_indexing.py
+-rw-r--r--   0 runner    (1001) docker     (123)    29970 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_interp.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18119 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_merge.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23834 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_missing.py
+-rw-r--r--   0 runner    (1001) docker     (123)      987 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_nputils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7670 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_options.py
+-rw-r--r--   0 runner    (1001) docker     (123)   119036 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_plot.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10344 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_plugins.py
+-rw-r--r--   0 runner    (1001) docker     (123)      200 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_print_versions.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31207 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_rolling.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28760 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_sparse.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4723 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_testing.py
+-rw-r--r--   0 runner    (1001) docker     (123)      982 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_tutorial.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4738 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_ufuncs.py
+-rw-r--r--   0 runner    (1001) docker     (123)   188860 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_units.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11253 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)   109955 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_variable.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24189 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tests/test_weighted.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7254 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/tutorial.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.160274 xarray-2023.4.0/xarray/util/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4272 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/util/deprecation_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17583 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/util/generate_aggregations.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9194 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/util/generate_ops.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     5219 2023-04-14 17:26:35.000000 xarray-2023.4.0/xarray/util/print_versions.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-14 17:26:50.140279 xarray-2023.4.0/xarray.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     3495 2023-04-14 17:26:50.000000 xarray-2023.4.0/xarray.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     9633 2023-04-14 17:26:50.000000 xarray-2023.4.0/xarray.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-14 17:26:50.000000 xarray-2023.4.0/xarray.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-14 17:26:49.000000 xarray-2023.4.0/xarray.egg-info/not-zip-safe
+-rw-r--r--   0 runner    (1001) docker     (123)      671 2023-04-14 17:26:50.000000 xarray-2023.4.0/xarray.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        7 2023-04-14 17:26:50.000000 xarray-2023.4.0/xarray.egg-info/top_level.txt
```

### Comparing `xarray-2023.3.0/.binder/environment.yml` & `xarray-2023.4.0/.binder/environment.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.github/ISSUE_TEMPLATE/bugreport.yml` & `xarray-2023.4.0/.github/ISSUE_TEMPLATE/bugreport.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.github/ISSUE_TEMPLATE/config.yml` & `xarray-2023.4.0/.github/ISSUE_TEMPLATE/config.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.github/ISSUE_TEMPLATE/newfeature.yml` & `xarray-2023.4.0/.github/ISSUE_TEMPLATE/newfeature.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.github/labeler.yml` & `xarray-2023.4.0/.github/labeler.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.github/stale.yml` & `xarray-2023.4.0/.github/stale.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.github/workflows/benchmarks.yml` & `xarray-2023.4.0/.github/workflows/benchmarks.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.github/workflows/ci-additional.yaml` & `xarray-2023.4.0/.github/workflows/ci-additional.yaml`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.github/workflows/ci.yaml` & `xarray-2023.4.0/.github/workflows/ci.yaml`

 * *Files 1% similar despite different names*

```diff
@@ -121,14 +121,15 @@
 
       - name: Import xarray
         run: |
           python -c "import xarray"
 
       - name: Run tests
         run: python -m pytest -n 4
+          --timeout 180
           --cov=xarray
           --cov-report=xml
           --junitxml=pytest.xml
           $PYTEST_EXTRA_FLAGS
 
       - name: Upload test results
         if: always()
```

### Comparing `xarray-2023.3.0/.github/workflows/configure-testpypi-version.py` & `xarray-2023.4.0/.github/workflows/configure-testpypi-version.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.github/workflows/parse_logs.py` & `xarray-2023.4.0/.github/workflows/parse_logs.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.github/workflows/publish-test-results.yaml` & `xarray-2023.4.0/.github/workflows/publish-test-results.yaml`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.github/workflows/pypi-release.yaml` & `xarray-2023.4.0/.github/workflows/pypi-release.yaml`

 * *Files 4% similar despite different names*

```diff
@@ -68,15 +68,15 @@
         run: |
           python -m pip install --upgrade pip
           python -m pip install dist/xarray*.whl
           python -m xarray.util.print_versions
 
       - name: Publish package to TestPyPI
         if: github.event_name == 'push'
-        uses: pypa/gh-action-pypi-publish@v1.8.1
+        uses: pypa/gh-action-pypi-publish@v1.8.5
         with:
           user: __token__
           password: ${{ secrets.TESTPYPI_TOKEN }}
           repository_url: https://test.pypi.org/legacy/
           verbose: true
 
 
@@ -86,12 +86,12 @@
     runs-on: ubuntu-latest
     steps:
       - uses: actions/download-artifact@v3
         with:
           name: releases
           path: dist
       - name: Publish package to PyPI
-        uses: pypa/gh-action-pypi-publish@v1.8.1
+        uses: pypa/gh-action-pypi-publish@v1.8.5
         with:
           user: __token__
           password: ${{ secrets.PYPI_TOKEN }}
           verbose: true
```

### Comparing `xarray-2023.3.0/.github/workflows/testpypi-release.yaml` & `xarray-2023.4.0/.github/workflows/testpypi-release.yaml`

 * *Files 0% similar despite different names*

```diff
@@ -74,13 +74,13 @@
         run: |
           python -m pip install --upgrade pip
           python -m pip install dist/xarray*.whl
           python -m xarray.util.print_versions
 
       - name: Publish package to TestPyPI
         if: github.event_name == 'push'
-        uses: pypa/gh-action-pypi-publish@v1.8.1
+        uses: pypa/gh-action-pypi-publish@v1.8.5
         with:
           user: __token__
           password: ${{ secrets.TESTPYPI_TOKEN }}
           repository_url: https://test.pypi.org/legacy/
           verbose: true
```

### Comparing `xarray-2023.3.0/.github/workflows/upstream-dev-ci.yaml` & `xarray-2023.4.0/.github/workflows/upstream-dev-ci.yaml`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.gitignore` & `xarray-2023.4.0/.gitignore`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/.pre-commit-config.yaml` & `xarray-2023.4.0/.pre-commit-config.yaml`

 * *Files 8% similar despite different names*

```diff
@@ -12,33 +12,32 @@
     rev: v0.3.1
     hooks:
       - id: absolufy-imports
         name: absolufy-imports
         files: ^xarray/
   - repo: https://github.com/charliermarsh/ruff-pre-commit
     # Ruff version.
-    rev: 'v0.0.254'
+    rev: 'v0.0.261'
     hooks:
       - id: ruff
         args: ["--fix"]
   # https://github.com/python/black#version-control-integration
   - repo: https://github.com/psf/black
-    rev: 23.1.0
+    rev: 23.3.0
     hooks:
-      - id: black
       - id: black-jupyter
   - repo: https://github.com/keewis/blackdoc
     rev: v0.3.8
     hooks:
       - id: blackdoc
         exclude: "generate_aggregations.py"
-        additional_dependencies: ["black==23.1.0"]
+        additional_dependencies: ["black==23.3.0"]
       - id: blackdoc-autoupdate-black
   - repo: https://github.com/pre-commit/mirrors-mypy
-    rev: v1.1.1
+    rev: v1.2.0
     hooks:
       - id: mypy
         # Copied from setup.cfg
         exclude: "properties|asv_bench"
         # This is slow and so we take it out of the fast-path; requires passing
         # `--hook-stage manual` to pre-commit
         stages: [manual]
```

### Comparing `xarray-2023.3.0/CITATION.cff` & `xarray-2023.4.0/CITATION.cff`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/CODE_OF_CONDUCT.md` & `xarray-2023.4.0/CODE_OF_CONDUCT.md`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/HOW_TO_RELEASE.md` & `xarray-2023.4.0/HOW_TO_RELEASE.md`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/LICENSE` & `xarray-2023.4.0/LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/PKG-INFO` & `xarray-2023.4.0/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: xarray
-Version: 2023.3.0
+Version: 2023.4.0
 Summary: N-D labeled arrays and datasets in Python
 Home-page: https://github.com/pydata/xarray
 Author: xarray Developers
 Author-email: xarray@googlegroups.com
 License: Apache-2.0
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: License :: OSI Approved :: Apache Software License
```

### Comparing `xarray-2023.3.0/README.md` & `xarray-2023.4.0/README.md`

 * *Files 0% similar despite different names*

```diff
@@ -7,15 +7,15 @@
 [![Available on pypi](https://img.shields.io/pypi/v/xarray.svg)](https://pypi.python.org/pypi/xarray/)
 [![Formatted with black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/python/black)
 [![Checked with mypy](http://www.mypy-lang.org/static/mypy_badge.svg)](http://mypy-lang.org/)
 [![Mirror on zendoo](https://zenodo.org/badge/DOI/10.5281/zenodo.598201.svg)](https://doi.org/10.5281/zenodo.598201)
 [![Examples on binder](https://img.shields.io/badge/launch-binder-579ACA.svg?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFkAAABZCAMAAABi1XidAAAB8lBMVEX///9XmsrmZYH1olJXmsr1olJXmsrmZYH1olJXmsr1olJXmsrmZYH1olL1olJXmsr1olJXmsrmZYH1olL1olJXmsrmZYH1olJXmsr1olL1olJXmsrmZYH1olL1olJXmsrmZYH1olL1olL0nFf1olJXmsrmZYH1olJXmsq8dZb1olJXmsrmZYH1olJXmspXmspXmsr1olL1olJXmsrmZYH1olJXmsr1olL1olJXmsrmZYH1olL1olLeaIVXmsrmZYH1olL1olL1olJXmsrmZYH1olLna31Xmsr1olJXmsr1olJXmsrmZYH1olLqoVr1olJXmsr1olJXmsrmZYH1olL1olKkfaPobXvviGabgadXmsqThKuofKHmZ4Dobnr1olJXmsr1olJXmspXmsr1olJXmsrfZ4TuhWn1olL1olJXmsqBi7X1olJXmspZmslbmMhbmsdemsVfl8ZgmsNim8Jpk8F0m7R4m7F5nLB6jbh7jbiDirOEibOGnKaMhq+PnaCVg6qWg6qegKaff6WhnpKofKGtnomxeZy3noG6dZi+n3vCcpPDcpPGn3bLb4/Mb47UbIrVa4rYoGjdaIbeaIXhoWHmZYHobXvpcHjqdHXreHLroVrsfG/uhGnuh2bwj2Hxk17yl1vzmljzm1j0nlX1olL3AJXWAAAAbXRSTlMAEBAQHx8gICAuLjAwMDw9PUBAQEpQUFBXV1hgYGBkcHBwcXl8gICAgoiIkJCQlJicnJ2goKCmqK+wsLC4usDAwMjP0NDQ1NbW3Nzg4ODi5+3v8PDw8/T09PX29vb39/f5+fr7+/z8/Pz9/v7+zczCxgAABC5JREFUeAHN1ul3k0UUBvCb1CTVpmpaitAGSLSpSuKCLWpbTKNJFGlcSMAFF63iUmRccNG6gLbuxkXU66JAUef/9LSpmXnyLr3T5AO/rzl5zj137p136BISy44fKJXuGN/d19PUfYeO67Znqtf2KH33Id1psXoFdW30sPZ1sMvs2D060AHqws4FHeJojLZqnw53cmfvg+XR8mC0OEjuxrXEkX5ydeVJLVIlV0e10PXk5k7dYeHu7Cj1j+49uKg7uLU61tGLw1lq27ugQYlclHC4bgv7VQ+TAyj5Zc/UjsPvs1sd5cWryWObtvWT2EPa4rtnWW3JkpjggEpbOsPr7F7EyNewtpBIslA7p43HCsnwooXTEc3UmPmCNn5lrqTJxy6nRmcavGZVt/3Da2pD5NHvsOHJCrdc1G2r3DITpU7yic7w/7Rxnjc0kt5GC4djiv2Sz3Fb2iEZg41/ddsFDoyuYrIkmFehz0HR2thPgQqMyQYb2OtB0WxsZ3BeG3+wpRb1vzl2UYBog8FfGhttFKjtAclnZYrRo9ryG9uG/FZQU4AEg8ZE9LjGMzTmqKXPLnlWVnIlQQTvxJf8ip7VgjZjyVPrjw1te5otM7RmP7xm+sK2Gv9I8Gi++BRbEkR9EBw8zRUcKxwp73xkaLiqQb+kGduJTNHG72zcW9LoJgqQxpP3/Tj//c3yB0tqzaml05/+orHLksVO+95kX7/7qgJvnjlrfr2Ggsyx0eoy9uPzN5SPd86aXggOsEKW2Prz7du3VID3/tzs/sSRs2w7ovVHKtjrX2pd7ZMlTxAYfBAL9jiDwfLkq55Tm7ifhMlTGPyCAs7RFRhn47JnlcB9RM5T97ASuZXIcVNuUDIndpDbdsfrqsOppeXl5Y+XVKdjFCTh+zGaVuj0d9zy05PPK3QzBamxdwtTCrzyg/2Rvf2EstUjordGwa/kx9mSJLr8mLLtCW8HHGJc2R5hS219IiF6PnTusOqcMl57gm0Z8kanKMAQg0qSyuZfn7zItsbGyO9QlnxY0eCuD1XL2ys/MsrQhltE7Ug0uFOzufJFE2PxBo/YAx8XPPdDwWN0MrDRYIZF0mSMKCNHgaIVFoBbNoLJ7tEQDKxGF0kcLQimojCZopv0OkNOyWCCg9XMVAi7ARJzQdM2QUh0gmBozjc3Skg6dSBRqDGYSUOu66Zg+I2fNZs/M3/f/Grl/XnyF1Gw3VKCez0PN5IUfFLqvgUN4C0qNqYs5YhPL+aVZYDE4IpUk57oSFnJm4FyCqqOE0jhY2SMyLFoo56zyo6becOS5UVDdj7Vih0zp+tcMhwRpBeLyqtIjlJKAIZSbI8SGSF3k0pA3mR5tHuwPFoa7N7reoq2bqCsAk1HqCu5uvI1n6JuRXI+S1Mco54YmYTwcn6Aeic+kssXi8XpXC4V3t7/ADuTNKaQJdScAAAAAElFTkSuQmCC)](https://mybinder.org/v2/gh/pydata/xarray/main?urlpath=lab/tree/doc/examples/weather-data.ipynb)
 [![Twitter](https://img.shields.io/twitter/follow/xarray_dev?style=social)](https://twitter.com/xarray_dev)
 
-**xarray** (formerly **xray**) is an open source project and Python
+**xarray** (pronounced "ex-array", formerly known as **xray**) is an open source project and Python
 package that makes working with labelled multi-dimensional arrays
 simple, efficient, and fun!
 
 Xarray introduces labels in the form of dimensions, coordinates and
 attributes on top of raw [NumPy](https://www.numpy.org)-like arrays,
 which allows for a more intuitive, more concise, and less error-prone
 developer experience. The package includes a large and growing library
```

### Comparing `xarray-2023.3.0/asv_bench/asv.conf.json` & `xarray-2023.4.0/asv_bench/asv.conf.json`

 * *Files 1% similar despite different names*

```diff
@@ -64,15 +64,16 @@
         "netcdf4": [""],
         "scipy": [""],
         "bottleneck": [""],
         "dask": [""],
         "distributed": [""],
         "flox": [""],
         "numpy_groupies": [""],
-        "sparse": [""]
+        "sparse": [""],
+        "cftime": [""]
     },
 
 
     // Combinations of libraries/python versions can be excluded/included
     // from the set to test. Each entry is a dictionary containing additional
     // key-value pairs to include/exclude.
     //
```

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/README_CI.md` & `xarray-2023.4.0/asv_bench/benchmarks/README_CI.md`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/__init__.py` & `xarray-2023.4.0/asv_bench/benchmarks/__init__.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/combine.py` & `xarray-2023.4.0/asv_bench/benchmarks/combine.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/dataarray_missing.py` & `xarray-2023.4.0/asv_bench/benchmarks/dataarray_missing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/dataset_io.py` & `xarray-2023.4.0/asv_bench/benchmarks/dataset_io.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/groupby.py` & `xarray-2023.4.0/asv_bench/benchmarks/groupby.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,7 +1,9 @@
+# import flox to avoid the cost of first import
+import flox.xarray  # noqa
 import numpy as np
 import pandas as pd
 
 import xarray as xr
 
 from . import _skip_slow, parameterized, requires_dask
 
@@ -23,45 +25,45 @@
     @parameterized(["ndim"], [(1, 2)])
     def time_init(self, ndim):
         getattr(self, f"ds{ndim}d").groupby("b")
 
     @parameterized(["method", "ndim"], [("sum", "mean"), (1, 2)])
     def time_agg_small_num_groups(self, method, ndim):
         ds = getattr(self, f"ds{ndim}d")
-        getattr(ds.groupby("a"), method)()
+        getattr(ds.groupby("a"), method)().compute()
 
     @parameterized(["method", "ndim"], [("sum", "mean"), (1, 2)])
     def time_agg_large_num_groups(self, method, ndim):
         ds = getattr(self, f"ds{ndim}d")
-        getattr(ds.groupby("b"), method)()
+        getattr(ds.groupby("b"), method)().compute()
 
     def time_binary_op_1d(self):
-        self.ds1d.groupby("b") - self.ds1d_mean
+        (self.ds1d.groupby("b") - self.ds1d_mean).compute()
 
     def time_binary_op_2d(self):
-        self.ds2d.groupby("b") - self.ds2d_mean
+        (self.ds2d.groupby("b") - self.ds2d_mean).compute()
 
     def peakmem_binary_op_1d(self):
-        self.ds1d.groupby("b") - self.ds1d_mean
+        (self.ds1d.groupby("b") - self.ds1d_mean).compute()
 
     def peakmem_binary_op_2d(self):
-        self.ds2d.groupby("b") - self.ds2d_mean
+        (self.ds2d.groupby("b") - self.ds2d_mean).compute()
 
 
 class GroupByDask(GroupBy):
     def setup(self, *args, **kwargs):
         requires_dask()
         super().setup(**kwargs)
 
         self.ds1d = self.ds1d.sel(dim_0=slice(None, None, 2))
         self.ds1d["c"] = self.ds1d["c"].chunk({"dim_0": 50})
         self.ds2d = self.ds2d.sel(dim_0=slice(None, None, 2))
         self.ds2d["c"] = self.ds2d["c"].chunk({"dim_0": 50, "z": 5})
-        self.ds1d_mean = self.ds1d.groupby("b").mean()
-        self.ds2d_mean = self.ds2d.groupby("b").mean()
+        self.ds1d_mean = self.ds1d.groupby("b").mean().compute()
+        self.ds2d_mean = self.ds2d.groupby("b").mean().compute()
 
 
 class GroupByPandasDataFrame(GroupBy):
     """Run groupby tests using pandas DataFrame."""
 
     def setup(self, *args, **kwargs):
         # Skip testing in CI as it won't ever change in a commit:
@@ -84,15 +86,15 @@
     def setup(self, *args, **kwargs):
         # Skip testing in CI as it won't ever change in a commit:
         _skip_slow()
 
         requires_dask()
         super().setup(**kwargs)
         self.ds1d = self.ds1d.chunk({"dim_0": 50}).to_dataframe()
-        self.ds1d_mean = self.ds1d.groupby("b").mean()
+        self.ds1d_mean = self.ds1d.groupby("b").mean().compute()
 
     def time_binary_op_2d(self):
         raise NotImplementedError
 
     def peakmem_binary_op_2d(self):
         raise NotImplementedError
 
@@ -112,20 +114,20 @@
     @parameterized(["ndim"], [(1, 2)])
     def time_init(self, ndim):
         getattr(self, f"ds{ndim}d").resample(time="D")
 
     @parameterized(["method", "ndim"], [("sum", "mean"), (1, 2)])
     def time_agg_small_num_groups(self, method, ndim):
         ds = getattr(self, f"ds{ndim}d")
-        getattr(ds.resample(time="3M"), method)()
+        getattr(ds.resample(time="3M"), method)().compute()
 
     @parameterized(["method", "ndim"], [("sum", "mean"), (1, 2)])
     def time_agg_large_num_groups(self, method, ndim):
         ds = getattr(self, f"ds{ndim}d")
-        getattr(ds.resample(time="48H"), method)()
+        getattr(ds.resample(time="48H"), method)().compute()
 
 
 class ResampleDask(Resample):
     def setup(self, *args, **kwargs):
         requires_dask()
         super().setup(**kwargs)
         self.ds1d = self.ds1d.chunk({"time": 50})
```

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/indexing.py` & `xarray-2023.4.0/asv_bench/benchmarks/indexing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/interp.py` & `xarray-2023.4.0/asv_bench/benchmarks/interp.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/merge.py` & `xarray-2023.4.0/asv_bench/benchmarks/merge.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/pandas.py` & `xarray-2023.4.0/asv_bench/benchmarks/pandas.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/polyfit.py` & `xarray-2023.4.0/asv_bench/benchmarks/polyfit.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/reindexing.py` & `xarray-2023.4.0/asv_bench/benchmarks/reindexing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/renaming.py` & `xarray-2023.4.0/asv_bench/benchmarks/renaming.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/repr.py` & `xarray-2023.4.0/asv_bench/benchmarks/repr.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/rolling.py` & `xarray-2023.4.0/asv_bench/benchmarks/rolling.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/asv_bench/benchmarks/unstacking.py` & `xarray-2023.4.0/asv_bench/benchmarks/unstacking.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/ci/install-upstream-wheels.sh` & `xarray-2023.4.0/ci/install-upstream-wheels.sh`

 * *Files 10% similar despite different names*

```diff
@@ -10,15 +10,14 @@
     pandas \
     matplotlib \
     dask \
     distributed \
     fsspec \
     zarr \
     cftime \
-    rasterio \
     packaging \
     pint \
     bottleneck \
     sparse \
     flox \
     h5netcdf \
     xarray
@@ -35,17 +34,15 @@
 python -m pip install \
     --no-deps \
     --upgrade \
     git+https://github.com/dask/dask \
     git+https://github.com/dask/distributed \
     git+https://github.com/zarr-developers/zarr \
     git+https://github.com/Unidata/cftime \
-    git+https://github.com/rasterio/rasterio \
     git+https://github.com/pypa/packaging \
     git+https://github.com/hgrecco/pint \
     git+https://github.com/pydata/bottleneck \
     git+https://github.com/pydata/sparse \
     git+https://github.com/intake/filesystem_spec \
     git+https://github.com/SciTools/nc-time-axis \
     git+https://github.com/xarray-contrib/flox \
     git+https://github.com/h5netcdf/h5netcdf
-python -m pip install pytest-timeout
```

### Comparing `xarray-2023.3.0/ci/min_deps_check.py` & `xarray-2023.4.0/ci/min_deps_check.py`

 * *Files 1% similar despite different names*

```diff
@@ -22,14 +22,15 @@
     "mypy",
     "pip",
     "setuptools",
     "pytest",
     "pytest-cov",
     "pytest-env",
     "pytest-xdist",
+    "pytest-timeout",
 }
 
 POLICY_MONTHS = {"python": 24, "numpy": 18}
 POLICY_MONTHS_DEFAULT = 12
 POLICY_OVERRIDE: dict[str, tuple[int, int]] = {}
 errors = []
```

### Comparing `xarray-2023.3.0/ci/requirements/all-but-dask.yml` & `xarray-2023.4.0/ci/requirements/all-but-dask.yml`

 * *Files 13% similar despite different names*

```diff
@@ -6,15 +6,14 @@
   - python=3.10
   - black
   - aiobotocore
   - boto3
   - bottleneck
   - cartopy
   - cdms2
-  - cfgrib
   - cftime
   - coveralls
   - flox
   - h5netcdf
   - h5py
   - hdf5
   - hypothesis
@@ -22,23 +21,24 @@
   - matplotlib-base
   - nc-time-axis
   - netcdf4
   - numba
   - numbagg
   - numpy<1.24
   - packaging
-  - pandas<2
+  - pandas
   - pint
   - pip
   - pseudonetcdf
   - pydap
   - pytest
   - pytest-cov
   - pytest-env
   - pytest-xdist
+  - pytest-timeout
   - rasterio
   - scipy
   - seaborn
   - sparse
   - toolz
   - typing_extensions
   - zarr
```

### Comparing `xarray-2023.3.0/ci/requirements/doc.yml` & `xarray-2023.4.0/ci/requirements/doc.yml`

 * *Files 14% similar despite different names*

```diff
@@ -3,28 +3,27 @@
   # Don't change to pkgs/main, as it causes random timeouts in readthedocs
   - conda-forge
   - nodefaults
 dependencies:
   - python=3.10
   - bottleneck
   - cartopy
-  - cfgrib>=0.9
   - dask-core>=2022.1
   - h5netcdf>=0.13
   - ipykernel
   - ipython
   - iris>=2.3
   - jupyter_client
   - matplotlib-base
   - nbsphinx
   - netcdf4>=1.5
   - numba
   - numpy>=1.21,<1.24
   - packaging>=21.3
-  - pandas>=1.4,<2
+  - pandas>=1.4
   - pooch
   - pip
   - pre-commit
   - pyproj
   - rasterio>=1.1
   - scipy!=1.10.0
   - seaborn
```

### Comparing `xarray-2023.3.0/ci/requirements/environment-py311.yml` & `xarray-2023.4.0/ci/requirements/environment-py311.yml`

 * *Files 3% similar despite different names*

```diff
@@ -4,15 +4,14 @@
   - nodefaults
 dependencies:
   - aiobotocore
   - boto3
   - bottleneck
   - cartopy
   # - cdms2
-  - cfgrib
   - cftime
   - dask-core
   - distributed
   - flox
   - fsspec!=2021.7.0
   - h5netcdf
   - h5py
@@ -24,25 +23,26 @@
   - nc-time-axis
   - netcdf4
   # - numba
   # - numbagg
   - numexpr
   - numpy
   - packaging
-  - pandas<2
+  - pandas
   - pint
   - pip
   - pooch
   - pre-commit
   - pseudonetcdf
   - pydap
   - pytest
   - pytest-cov
   - pytest-env
   - pytest-xdist
+  - pytest-timeout
   - rasterio
   - scipy
   - seaborn
   # - sparse
   - toolz
   - typing_extensions
   - zarr
```

### Comparing `xarray-2023.3.0/ci/requirements/environment-windows-py311.yml` & `xarray-2023.4.0/ci/requirements/environment-windows-py311.yml`

 * *Files 15% similar despite different names*

```diff
@@ -2,15 +2,14 @@
 channels:
   - conda-forge
 dependencies:
   - boto3
   - bottleneck
   - cartopy
   # - cdms2  # Not available on Windows
-  # - cfgrib  # Causes Python interpreter crash on Windows: https://github.com/pydata/xarray/pull/3340
   - cftime
   - dask-core
   - distributed
   - flox
   - fsspec!=2021.7.0
   - h5netcdf
   - h5py
@@ -21,24 +20,25 @@
   - matplotlib-base
   - nc-time-axis
   - netcdf4
   # - numba
   # - numbagg
   - numpy
   - packaging
-  - pandas<2
+  - pandas
   - pint
   - pip
   - pre-commit
   - pseudonetcdf
   - pydap
   - pytest
   - pytest-cov
   - pytest-env
   - pytest-xdist
+  - pytest-timeout
   - rasterio
   - scipy
   - seaborn
   # - sparse
   - toolz
   - typing_extensions
   - zarr
```

### Comparing `xarray-2023.3.0/ci/requirements/environment-windows.yml` & `xarray-2023.4.0/ci/requirements/environment-windows.yml`

 * *Files 16% similar despite different names*

```diff
@@ -2,15 +2,14 @@
 channels:
   - conda-forge
 dependencies:
   - boto3
   - bottleneck
   - cartopy
   # - cdms2  # Not available on Windows
-  # - cfgrib  # Causes Python interpreter crash on Windows: https://github.com/pydata/xarray/pull/3340
   - cftime
   - dask-core
   - distributed
   - flox
   - fsspec!=2021.7.0
   - h5netcdf
   - h5py
@@ -21,24 +20,25 @@
   - matplotlib-base
   - nc-time-axis
   - netcdf4
   - numba
   - numbagg
   - numpy<1.24
   - packaging
-  - pandas<2
+  - pandas
   - pint
   - pip
   - pre-commit
   - pseudonetcdf
   - pydap
   - pytest
   - pytest-cov
   - pytest-env
   - pytest-xdist
+  - pytest-timeout
   - rasterio
   - scipy
   - seaborn
   - sparse
   - toolz
   - typing_extensions
   - zarr
```

### Comparing `xarray-2023.3.0/ci/requirements/environment.yml` & `xarray-2023.4.0/ci/requirements/environment.yml`

 * *Files 14% similar despite different names*

```diff
@@ -4,15 +4,14 @@
   - nodefaults
 dependencies:
   - aiobotocore
   - boto3
   - bottleneck
   - cartopy
   - cdms2
-  - cfgrib
   - cftime
   - dask-core
   - distributed
   - flox
   - fsspec!=2021.7.0
   - h5netcdf
   - h5py
@@ -24,25 +23,26 @@
   - nc-time-axis
   - netcdf4
   - numba
   - numbagg
   - numexpr
   - numpy<1.24
   - packaging
-  - pandas<2
+  - pandas
   - pint
   - pip
   - pooch
   - pre-commit
   - pseudonetcdf
   - pydap
   - pytest
   - pytest-cov
   - pytest-env
   - pytest-xdist
+  - pytest-timeout
   - rasterio
   - scipy
   - seaborn
   - sparse
   - toolz
   - typing_extensions
   - zarr
```

### Comparing `xarray-2023.3.0/ci/requirements/min-all-deps.yml` & `xarray-2023.4.0/ci/requirements/min-all-deps.yml`

 * *Files 2% similar despite different names*

```diff
@@ -8,15 +8,14 @@
   # When upgrading python, numpy, or pandas, must also change
   # doc/user-guide/installing.rst, doc/user-guide/plotting.rst and setup.py.
   - python=3.9
   - boto3=1.20
   - bottleneck=1.3
   - cartopy=0.20
   - cdms2=3.1
-  - cfgrib=0.9
   - cftime=1.5
   - coveralls
   - dask-core=2022.1
   - distributed=2022.1
   - flox=0.5
   - h5netcdf=0.13
   # h5py and hdf5 tend to cause conflicts
@@ -40,14 +39,15 @@
   - pip
   - pseudonetcdf=3.2
   - pydap=3.2
   - pytest
   - pytest-cov
   - pytest-env
   - pytest-xdist
+  - pytest-timeout
   - rasterio=1.2
   - scipy=1.7
   - seaborn=0.11
   - sparse=0.13
   - toolz=0.11
   - typing_extensions=4.0
   - zarr=2.10
```

### Comparing `xarray-2023.3.0/conftest.py` & `xarray-2023.4.0/conftest.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/design_notes/flexible_indexes_notes.md` & `xarray-2023.4.0/design_notes/flexible_indexes_notes.md`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/Makefile` & `xarray-2023.4.0/doc/Makefile`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/advanced_selection_interpolation.svg` & `xarray-2023.4.0/doc/_static/advanced_selection_interpolation.svg`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/ci.png` & `xarray-2023.4.0/doc/_static/ci.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/dask_array.png` & `xarray-2023.4.0/doc/_static/dask_array.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/dataset-diagram-logo.pdf` & `xarray-2023.4.0/doc/_static/dataset-diagram-logo.pdf`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/dataset-diagram-logo.png` & `xarray-2023.4.0/doc/_static/dataset-diagram-logo.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/dataset-diagram-logo.svg` & `xarray-2023.4.0/doc/_static/dataset-diagram-logo.svg`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/dataset-diagram-logo.tex` & `xarray-2023.4.0/doc/_static/dataset-diagram-logo.tex`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/dataset-diagram-square-logo.png` & `xarray-2023.4.0/doc/_static/dataset-diagram-square-logo.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/dataset-diagram-square-logo.tex` & `xarray-2023.4.0/doc/_static/dataset-diagram-square-logo.tex`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/dataset-diagram.png` & `xarray-2023.4.0/doc/_static/dataset-diagram.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/dataset-diagram.tex` & `xarray-2023.4.0/doc/_static/dataset-diagram.tex`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/favicon.ico` & `xarray-2023.4.0/doc/_static/favicon.ico`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/index_api.svg` & `xarray-2023.4.0/doc/_static/index_api.svg`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/index_contribute.svg` & `xarray-2023.4.0/doc/_static/index_contribute.svg`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/index_getting_started.svg` & `xarray-2023.4.0/doc/_static/index_getting_started.svg`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/index_user_guide.svg` & `xarray-2023.4.0/doc/_static/index_user_guide.svg`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/numfocus_logo.png` & `xarray-2023.4.0/doc/_static/numfocus_logo.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/opendap-prism-tmax.png` & `xarray-2023.4.0/doc/_static/opendap-prism-tmax.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/style.css` & `xarray-2023.4.0/doc/_static/style.css`

 * *Files 8% similar despite different names*

```diff
@@ -168,48 +168,43 @@
   display: block;
 }
 
 .bd-sidebar .nav > li > a {
   display: block;
   padding: 0.25rem 1.5rem;
   font-size: 90%;
-  color: rgba(0, 0, 0, 0.65);
 }
 
 .bd-sidebar .nav > li > a:hover {
-  color: rgba(0, 0, 0, 0.85);
   text-decoration: none;
   background-color: transparent;
 }
 
 .bd-sidebar .nav > .active > a,
 .bd-sidebar .nav > .active:hover > a {
   font-weight: 400;
-  color: #130654;
   /* adjusted from original
   color: rgba(0, 0, 0, 0.85);
   background-color: transparent; */
 }
 
 .bd-sidebar .nav > li > ul {
   list-style: none;
   padding: 0.25rem 1.5rem;
 }
 
 .bd-sidebar .nav > li > ul > li > a {
   display: block;
   padding: 0.25rem 1.5rem;
   font-size: 90%;
-  color: rgba(0, 0, 0, 0.65);
 }
 
 .bd-sidebar .nav > li > ul > .active > a,
 .bd-sidebar .nav > li > ul > .active:hover > a {
   font-weight: 400;
-  color: #542437;
 }
 
 dt:target {
   background-color: initial;
 }
 
 /* Offsetting anchored elements within the main content to adjust for fixed header
```

### Comparing `xarray-2023.3.0/doc/_static/thumbnails/ERA5-GRIB-example.png` & `xarray-2023.4.0/doc/_static/thumbnails/ERA5-GRIB-example.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/thumbnails/ROMS_ocean_model.png` & `xarray-2023.4.0/doc/_static/thumbnails/ROMS_ocean_model.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/thumbnails/area_weighted_temperature.png` & `xarray-2023.4.0/doc/_static/thumbnails/area_weighted_temperature.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/thumbnails/monthly-means.png` & `xarray-2023.4.0/doc/_static/thumbnails/monthly-means.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/thumbnails/multidimensional-coords.png` & `xarray-2023.4.0/doc/_static/thumbnails/multidimensional-coords.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/thumbnails/toy-weather-data.png` & `xarray-2023.4.0/doc/_static/thumbnails/toy-weather-data.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/thumbnails/visualization_gallery.png` & `xarray-2023.4.0/doc/_static/thumbnails/visualization_gallery.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/_static/view-docs.png` & `xarray-2023.4.0/doc/_static/view-docs.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/api-hidden.rst` & `xarray-2023.4.0/doc/api-hidden.rst`

 * *Files 2% similar despite different names*

```diff
@@ -230,14 +230,15 @@
    Variable.T
    Variable.attrs
    Variable.chunks
    Variable.data
    Variable.dims
    Variable.dtype
    Variable.encoding
+   Variable.reset_encoding
    Variable.imag
    Variable.nbytes
    Variable.ndim
    Variable.real
    Variable.shape
    Variable.size
    Variable.sizes
@@ -370,18 +371,16 @@
    CFTimeIndex.intersection
    CFTimeIndex.is_
    CFTimeIndex.is_boolean
    CFTimeIndex.is_categorical
    CFTimeIndex.is_floating
    CFTimeIndex.is_integer
    CFTimeIndex.is_interval
-   CFTimeIndex.is_mixed
    CFTimeIndex.is_numeric
    CFTimeIndex.is_object
-   CFTimeIndex.is_type_compatible
    CFTimeIndex.isin
    CFTimeIndex.isna
    CFTimeIndex.isnull
    CFTimeIndex.item
    CFTimeIndex.join
    CFTimeIndex.map
    CFTimeIndex.max
@@ -394,29 +393,27 @@
    CFTimeIndex.ravel
    CFTimeIndex.reindex
    CFTimeIndex.rename
    CFTimeIndex.repeat
    CFTimeIndex.round
    CFTimeIndex.searchsorted
    CFTimeIndex.set_names
-   CFTimeIndex.set_value
    CFTimeIndex.shift
    CFTimeIndex.slice_indexer
    CFTimeIndex.slice_locs
    CFTimeIndex.sort
    CFTimeIndex.sort_values
    CFTimeIndex.sortlevel
    CFTimeIndex.strftime
    CFTimeIndex.symmetric_difference
    CFTimeIndex.take
    CFTimeIndex.to_datetimeindex
    CFTimeIndex.to_flat_index
    CFTimeIndex.to_frame
    CFTimeIndex.to_list
-   CFTimeIndex.to_native_types
    CFTimeIndex.to_numpy
    CFTimeIndex.to_series
    CFTimeIndex.tolist
    CFTimeIndex.transpose
    CFTimeIndex.union
    CFTimeIndex.unique
    CFTimeIndex.value_counts
@@ -433,16 +430,14 @@
    CFTimeIndex.dtype
    CFTimeIndex.empty
    CFTimeIndex.freq
    CFTimeIndex.has_duplicates
    CFTimeIndex.hasnans
    CFTimeIndex.hour
    CFTimeIndex.inferred_type
-   CFTimeIndex.is_all_dates
-   CFTimeIndex.is_monotonic
    CFTimeIndex.is_monotonic_increasing
    CFTimeIndex.is_monotonic_decreasing
    CFTimeIndex.is_unique
    CFTimeIndex.microsecond
    CFTimeIndex.minute
    CFTimeIndex.month
    CFTimeIndex.name
@@ -479,15 +474,14 @@
    backends.NetCDF4DataStore.sync
    backends.NetCDF4DataStore.autoclose
    backends.NetCDF4DataStore.ds
    backends.NetCDF4DataStore.format
    backends.NetCDF4DataStore.is_remote
    backends.NetCDF4DataStore.lock
 
-   backends.NetCDF4BackendEntrypoint.available
    backends.NetCDF4BackendEntrypoint.description
    backends.NetCDF4BackendEntrypoint.url
    backends.NetCDF4BackendEntrypoint.guess_can_open
    backends.NetCDF4BackendEntrypoint.open_dataset
 
    backends.H5NetCDFStore.autoclose
    backends.H5NetCDFStore.close
@@ -512,45 +506,42 @@
    backends.H5NetCDFStore.set_variable
    backends.H5NetCDFStore.set_variables
    backends.H5NetCDFStore.store
    backends.H5NetCDFStore.store_dataset
    backends.H5NetCDFStore.sync
    backends.H5NetCDFStore.ds
 
-   backends.H5netcdfBackendEntrypoint.available
    backends.H5netcdfBackendEntrypoint.description
    backends.H5netcdfBackendEntrypoint.url
    backends.H5netcdfBackendEntrypoint.guess_can_open
    backends.H5netcdfBackendEntrypoint.open_dataset
 
    backends.PseudoNetCDFDataStore.close
    backends.PseudoNetCDFDataStore.get_attrs
    backends.PseudoNetCDFDataStore.get_dimensions
    backends.PseudoNetCDFDataStore.get_encoding
    backends.PseudoNetCDFDataStore.get_variables
    backends.PseudoNetCDFDataStore.open
    backends.PseudoNetCDFDataStore.open_store_variable
    backends.PseudoNetCDFDataStore.ds
 
-   backends.PseudoNetCDFBackendEntrypoint.available
    backends.PseudoNetCDFBackendEntrypoint.description
    backends.PseudoNetCDFBackendEntrypoint.url
    backends.PseudoNetCDFBackendEntrypoint.guess_can_open
    backends.PseudoNetCDFBackendEntrypoint.open_dataset
 
    backends.PydapDataStore.close
    backends.PydapDataStore.get_attrs
    backends.PydapDataStore.get_dimensions
    backends.PydapDataStore.get_encoding
    backends.PydapDataStore.get_variables
    backends.PydapDataStore.load
    backends.PydapDataStore.open
    backends.PydapDataStore.open_store_variable
 
-   backends.PydapBackendEntrypoint.available
    backends.PydapBackendEntrypoint.description
    backends.PydapBackendEntrypoint.url
    backends.PydapBackendEntrypoint.guess_can_open
    backends.PydapBackendEntrypoint.open_dataset
 
    backends.ScipyDataStore.close
    backends.ScipyDataStore.encode
@@ -570,15 +561,14 @@
    backends.ScipyDataStore.set_variable
    backends.ScipyDataStore.set_variables
    backends.ScipyDataStore.store
    backends.ScipyDataStore.store_dataset
    backends.ScipyDataStore.sync
    backends.ScipyDataStore.ds
 
-   backends.ScipyBackendEntrypoint.available
    backends.ScipyBackendEntrypoint.description
    backends.ScipyBackendEntrypoint.url
    backends.ScipyBackendEntrypoint.guess_can_open
    backends.ScipyBackendEntrypoint.open_dataset
 
    backends.ZarrStore.close
    backends.ZarrStore.encode_attribute
@@ -591,21 +581,19 @@
    backends.ZarrStore.set_attributes
    backends.ZarrStore.set_dimensions
    backends.ZarrStore.set_variables
    backends.ZarrStore.store
    backends.ZarrStore.sync
    backends.ZarrStore.ds
 
-   backends.ZarrBackendEntrypoint.available
    backends.ZarrBackendEntrypoint.description
    backends.ZarrBackendEntrypoint.url
    backends.ZarrBackendEntrypoint.guess_can_open
    backends.ZarrBackendEntrypoint.open_dataset
 
-   backends.StoreBackendEntrypoint.available
    backends.StoreBackendEntrypoint.description
    backends.StoreBackendEntrypoint.url
    backends.StoreBackendEntrypoint.guess_can_open
    backends.StoreBackendEntrypoint.open_dataset
 
    backends.FileManager.acquire
    backends.FileManager.acquire_context
```

### Comparing `xarray-2023.3.0/doc/api.rst` & `xarray-2023.4.0/doc/api.rst`

 * *Files 1% similar despite different names*

```diff
@@ -108,14 +108,15 @@
    Dataset.expand_dims
    Dataset.drop_vars
    Dataset.drop_indexes
    Dataset.drop_duplicates
    Dataset.drop_dims
    Dataset.set_coords
    Dataset.reset_coords
+   Dataset.reset_encoding
    Dataset.convert_calendar
    Dataset.interp_calendar
    Dataset.get_index
 
 Comparisons
 -----------
 
@@ -299,14 +300,15 @@
    DataArray.rename
    DataArray.swap_dims
    DataArray.expand_dims
    DataArray.drop_vars
    DataArray.drop_indexes
    DataArray.drop_duplicates
    DataArray.reset_coords
+   DataArray.reset_encoding
    DataArray.copy
    DataArray.convert_calendar
    DataArray.interp_calendar
    DataArray.get_index
    DataArray.astype
    DataArray.item
 
@@ -591,15 +593,14 @@
 
 .. autosummary::
    :toctree: generated/
 
    load_dataset
    open_dataset
    open_mfdataset
-   open_rasterio
    open_zarr
    save_mfdataset
    Dataset.as_numpy
    Dataset.from_dataframe
    Dataset.from_dict
    Dataset.to_array
    Dataset.to_dataframe
@@ -637,14 +638,15 @@
    DataArray.to_index
    DataArray.to_iris
    DataArray.to_masked_array
    DataArray.to_netcdf
    DataArray.to_numpy
    DataArray.to_pandas
    DataArray.to_series
+   DataArray.to_zarr
    DataArray.chunk
    DataArray.close
    DataArray.compute
    DataArray.persist
    DataArray.load
    DataArray.unify_chunks
 
@@ -1050,15 +1052,14 @@
 Tutorial
 ========
 
 .. autosummary::
    :toctree: generated/
 
    tutorial.open_dataset
-   tutorial.open_rasterio
    tutorial.load_dataset
 
 Testing
 =======
 
 .. autosummary::
    :toctree: generated/
@@ -1092,14 +1093,15 @@
    Context
    register_dataset_accessor
    register_dataarray_accessor
    Dataset.set_close
    backends.BackendArray
    backends.BackendEntrypoint
    backends.list_engines
+   backends.refresh_engines
 
 Default, pandas-backed indexes built-in Xarray:
 
    indexes.PandasIndex
    indexes.PandasMultiIndex
 
 These backends provide a low-level interface for lazily loading data from
```

### Comparing `xarray-2023.3.0/doc/conf.py` & `xarray-2023.4.0/doc/conf.py`

 * *Files 2% similar despite different names*

```diff
@@ -46,28 +46,19 @@
 
 with suppress(ImportError):
     import matplotlib
 
     matplotlib.use("Agg")
 
 try:
-    import rasterio  # noqa: F401
-except ImportError:
-    allowed_failures.update(
-        ["gallery/plot_rasterio_rgb.py", "gallery/plot_rasterio.py"]
-    )
-
-try:
     import cartopy  # noqa: F401
 except ImportError:
     allowed_failures.update(
         [
             "gallery/plot_cartopy_facetgrid.py",
-            "gallery/plot_rasterio_rgb.py",
-            "gallery/plot_rasterio.py",
         ]
     )
 
 nbsphinx_allow_errors = True
 
 # -- General configuration ------------------------------------------------
 
@@ -327,15 +318,14 @@
     "iris": ("https://scitools-iris.readthedocs.io/en/latest", None),
     "numpy": ("https://numpy.org/doc/stable", None),
     "scipy": ("https://docs.scipy.org/doc/scipy", None),
     "numba": ("https://numba.readthedocs.io/en/stable/", None),
     "matplotlib": ("https://matplotlib.org/stable/", None),
     "dask": ("https://docs.dask.org/en/latest", None),
     "cftime": ("https://unidata.github.io/cftime", None),
-    "rasterio": ("https://rasterio.readthedocs.io/en/latest", None),
     "sparse": ("https://sparse.pydata.org/en/latest/", None),
 }
 
 
 # based on numpy doc/source/conf.py
 def linkcode_resolve(domain, info):
     """
```

### Comparing `xarray-2023.3.0/doc/contributing.rst` & `xarray-2023.4.0/doc/contributing.rst`

 * *Files 18% similar despite different names*

```diff
@@ -1,52 +1,74 @@
 .. _contributing:
 
 **********************
 Contributing to xarray
 **********************
 
-
 .. note::
 
   Large parts of this document came from the `Pandas Contributing
   Guide <http://pandas.pydata.org/pandas-docs/stable/contributing.html>`_.
 
+Overview
+========
+
+We welcome your skills and enthusiasm at the xarray project!. There are numerous opportunities to
+contribute beyond just writing code.
+All contributions, including bug reports, bug fixes, documentation improvements, enhancement suggestions,
+and other ideas are welcome.
+
+If you have any questions on the process or how to fix something feel free to ask us!
+The recommended place to ask a question is  on `GitHub Discussions <https://github.com/pydata/xarray/discussions>`_
+, but we also have a `Discord <https://discord.com/invite/wEKPCt4PDu>`_ and a
+`mailing list <https://groups.google.com/g/xarray>`_. There is also a
+`"python-xarray" tag on Stack Overflow <https://stackoverflow.com/questions/tagged/python-xarray>`_ which we monitor for questions.
+
+We also have a biweekly community call, details of which are announced on the
+`Developers meeting <https://docs.xarray.dev/en/stable/developers-meeting.html>`_.
+You are very welcome to join! Though we would love to hear from you, there is no expectation to
+contribute during the meeting either - you are always welcome to just sit in and listen.
+
+This project is a community effort, and everyone is welcome to contribute. Everyone within the community
+is expected to abide by our `code of conduct <https://github.com/pydata/xarray/blob/main/CODE_OF_CONDUCT.md>`_.
+
 Where to start?
 ===============
 
-All contributions, bug reports, bug fixes, documentation improvements,
-enhancements, and ideas are welcome.
-
 If you are brand new to *xarray* or open-source development, we recommend going
 through the `GitHub "issues" tab <https://github.com/pydata/xarray/issues>`_
-to find issues that interest you. There are a number of issues listed under
-`Documentation <https://github.com/pydata/xarray/labels/topic-documentation>`_
+to find issues that interest you.
+Some issues are particularly suited for new contributors by the label `Documentation <https://github.com/pydata/xarray/labels/topic-documentation>`_
 and `good first issue
-<https://github.com/pydata/xarray/labels/contrib-good-first-issue>`_
-where you could start out. Once you've found an interesting issue, you can
-return here to get your development environment setup.
+<https://github.com/pydata/xarray/labels/contrib-good-first-issue>`_ where you could start out.
+These are well documented issues, that do not require a deep understanding of the internals of xarray.
 
-Feel free to ask questions on the `mailing list
-<https://groups.google.com/g/xarray>`_.
+Once you've found an interesting issue, you can return here to get your development environment setup.
+The xarray project does not assign issues. Issues are "assigned" by opening a Pull Request(PR).
 
 .. _contributing.bug_reports:
 
 Bug reports and enhancement requests
 ====================================
 
 Bug reports are an important part of making *xarray* more stable. Having a complete bug
-report will allow others to reproduce the bug and provide insight into fixing. See
-this `stackoverflow article for tips on
-writing a good bug report <https://stackoverflow.com/help/mcve>`_ .
+report will allow others to reproduce the bug and provide insight into fixing.
 
 Trying out the bug-producing code on the *main* branch is often a worthwhile exercise
 to confirm that the bug still exists. It is also worth searching existing bug reports and
 pull requests to see if the issue has already been reported and/or fixed.
 
-Bug reports must:
+Submitting a bug report
+-----------------------
+
+If you find a bug in the code or documentation, do not hesitate to submit a ticket to the
+`Issue Tracker <https://github.com/pydata/xarray/issues>`_.
+You are also welcome to post feature requests or pull requests.
+
+If you are reporting a bug, please use the provided template which includes the following:
 
 #. Include a short, self-contained Python snippet reproducing the problem.
    You can format the code nicely by using `GitHub Flavored Markdown
    <http://github.github.com/github-flavored-markdown/>`_::
 
       ```python
       import xarray as xr
@@ -63,34 +85,28 @@
       xr.show_versions()
 
       ...
       ```
 
 #. Explain why the current behavior is wrong/not desired and what you expect instead.
 
-The issue will then show up to the *xarray* community and be open to comments/ideas
-from others.
+The issue will then show up to the *xarray* community and be open to comments/ideas from others.
 
-.. _contributing.github:
+See this `stackoverflow article for tips on writing a good bug report <https://stackoverflow.com/help/mcve>`_ .
 
-Working with the code
-=====================
+
+.. _contributing.github:
 
 Now that you have an issue you want to fix, enhancement to add, or documentation
 to improve, you need to learn how to work with GitHub and the *xarray* code base.
 
 .. _contributing.version_control:
 
 Version control, Git, and GitHub
---------------------------------
-
-To the new user, working with Git is one of the more daunting aspects of contributing
-to *xarray*.  It can very quickly become overwhelming, but sticking to the guidelines
-below will help keep the process straightforward and mostly trouble free.  As always,
-if you are having difficulties please feel free to ask for help.
+================================
 
 The code is hosted on `GitHub <https://www.github.com/pydata/xarray>`_. To
 contribute you will need to sign up for a `free GitHub account
 <https://github.com/signup/free>`_. We use `Git <http://git-scm.com/>`_ for
 version control to allow many people to work together on the project.
 
 Some great resources for learning Git:
@@ -108,63 +124,136 @@
 
 .. note::
 
     The following instructions assume you want to learn how to interact with github via the git command-line utility,
     but contributors who are new to git may find it easier to use other tools instead such as
     `Github Desktop <https://desktop.github.com/>`_.
 
-.. _contributing.forking:
+Development workflow
+====================
+
+To keep your work well organized, with readable history, and in turn make it easier for project
+maintainers to see what you've done, and why you did it, we recommend you to follow workflow:
 
-Forking
--------
+1. `Create an account <https://github.com/>`_ on GitHub if you do not already have one.
 
-You will need your own fork to work on the code. Go to the `xarray project
-page <https://github.com/pydata/xarray>`_ and hit the ``Fork`` button. You will
-want to clone your fork to your machine::
+2. You will need your own fork to work on the code. Go to the `xarray project
+   page <https://github.com/pydata/xarray>`_ and hit the ``Fork`` button near the top of the page.
+   This creates a copy of the code under your account on the GitHub server.
+
+3. Clone your fork to your machine::
 
     git clone https://github.com/your-user-name/xarray.git
     cd xarray
     git remote add upstream https://github.com/pydata/xarray.git
 
-This creates the directory `xarray` and connects your repository to
-the upstream (main project) *xarray* repository.
-
-Creating a branch
------------------
+   This creates the directory `xarray` and connects your repository to
+   the upstream (main project) *xarray* repository.
 
-You want your ``main`` branch to reflect only production-ready code, so create a
-feature branch before making your changes. For example::
-
-    git branch shiny-new-feature
-    git checkout shiny-new-feature
+Creating a development environment
+----------------------------------
 
-The above can be simplified to::
+To test out code changes locally, you'll need to build *xarray* from source, which requires you to
+`create a local development environment <https://docs.xarray.dev/en/stable/contributing.html#creating-a-development-environment>`_.
 
-    git checkout -b shiny-new-feature
+Update the ``main`` branch
+--------------------------
 
-This changes your working directory to the shiny-new-feature branch.  Keep any
-changes in this branch specific to one bug or feature so it is clear
-what the branch brings to *xarray*. You can have many "shiny-new-features"
-and switch in between them using the ``git checkout`` command.
+First make sure you have followed `Setting up xarray for development
+<https://docs.xarray.dev/en/stable/contributing.html#creating-a-development-environment>`_
 
-To update this branch, you need to retrieve the changes from the ``main`` branch::
+Before starting a new set of changes, fetch all changes from ``upstream/main``, and start a new
+feature branch from that. From time to time you should fetch the upstream changes from GitHub: ::
 
     git fetch upstream
     git merge upstream/main
 
 This will combine your commits with the latest *xarray* git ``main``.  If this
 leads to merge conflicts, you must resolve these before submitting your pull
 request.  If you have uncommitted changes, you will need to ``git stash`` them
 prior to updating.  This will effectively store your changes, which can be
 reapplied after updating.
 
+Create a new feature branch
+---------------------------
+
+Create a branch to save your changes, even before you start making changes. You want your
+``main branch`` to contain only production-ready code::
+
+    git checkout -b shiny-new-feature
+
+This changes your working directory to the ``shiny-new-feature`` branch.  Keep any changes in this
+branch specific to one bug or feature so it is clear what the branch brings to *xarray*. You can have
+many "shiny-new-features" and switch in between them using the ``git checkout`` command.
+
+Generally, you will want to keep your feature branches on your public GitHub fork of xarray. To do this,
+you ``git push`` this new branch up to your GitHub repo. Generally (if you followed the instructions in
+these pages, and by default), git will have a link to your fork of the GitHub repo, called ``origin``.
+You push up to your own fork with: ::
+
+    git push origin shiny-new-feature
+
+In git >= 1.7 you can ensure that the link is correctly set by using the ``--set-upstream`` option: ::
+
+    git push --set-upstream origin shiny-new-feature
+
+From now on git will know that ``shiny-new-feature`` is related to the ``shiny-new-feature branch`` in the GitHub repo.
+
+The editing workflow
+--------------------
+
+1. Make some changes
+
+2. See which files have changed with ``git status``. You'll see a listing like this one: ::
+
+    # On branch shiny-new-feature
+    # Changed but not updated:
+    #   (use "git add <file>..." to update what will be committed)
+    #   (use "git checkout -- <file>..." to discard changes in working directory)
+    #
+    #  modified:   README
+
+3. Check what the actual changes are with ``git diff``.
+
+4. Build the `documentation run <https://docs.xarray.dev/en/stable/contributing.html#building-the-documentation>`_
+for the documentation changes.
+
+`Run the test suite <https://docs.xarray.dev/en/stable/contributing.html#running-the-test-suite>`_ for code changes.
+
+Commit and push your changes
+----------------------------
+
+1. To commit all modified files into the local copy of your repo, do ``git commit -am 'A commit message'``.
+
+2. To push the changes up to your forked repo on GitHub, do a ``git push``.
+
+Open a pull request
+-------------------
+
+When you're ready or need feedback on your code, open a Pull Request (PR) so that the xarray developers can
+give feedback and eventually include your suggested code into the ``main`` branch.
+`Pull requests (PRs) on GitHub <https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests>`_
+are the mechanism for contributing to xarray's code and documentation.
+
+Enter a title for the set of changes with some explanation of what you've done.
+Follow the PR template, which looks like this. ::
+
+    [ ]Closes #xxxx
+    [ ]Tests added
+    [ ]User visible changes (including notable bug fixes) are documented in whats-new.rst
+    [ ]New functions/methods are listed in api.rst
+
+Mention anything you'd like particular attention for - such as a complicated change or some code you are not happy with.
+If you don't think your request is ready to be merged, just say so in your pull request message and use
+the "Draft PR" feature of GitHub. This is a good way of getting some preliminary code review.
+
 .. _contributing.dev_env:
 
 Creating a development environment
-----------------------------------
+==================================
 
 To test out code changes locally, you'll need to build *xarray* from source, which
 requires a Python environment. If you're making documentation changes, you can
 skip to :ref:`contributing.documentation` but you won't be able to build the
 documentation locally before pushing your changes.
 
 .. note::
@@ -178,15 +267,15 @@
 
     To speed up this feedback loop or for more complex development tasks you should build and test xarray locally.
 
 
 .. _contributing.dev_python:
 
 Creating a Python Environment
-~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+-----------------------------
 
 Before starting any development, you'll need to create an isolated xarray
 development environment:
 
 - Install either `Anaconda <https://www.anaconda.com/download/>`_ or `miniconda
   <https://conda.io/miniconda.html>`_
 - Make sure your conda is up to date (``conda update conda``)
@@ -236,14 +325,30 @@
 
 To return to your root environment::
 
       conda deactivate
 
 See the full `conda docs here <http://conda.pydata.org/docs>`__.
 
+Install pre-commit hooks
+------------------------
+
+We highly recommend that you setup `pre-commit <https://pre-commit.com/>`_ hooks to automatically
+run all the above tools every time you make a git commit. To install the hooks::
+
+    python -m pip install pre-commit
+    pre-commit install
+
+This can be done by running: ::
+
+    pre-commit run
+
+from the root of the xarray repository. You can skip the pre-commit checks with
+``git commit --no-verify``.
+
 .. _contributing.documentation:
 
 Contributing to the documentation
 =================================
 
 If you're not the developer type, contributing to the documentation is still of
 huge value. You don't even have to be an expert on *xarray* to do so! In fact,
@@ -359,14 +464,68 @@
 evocations, Sphinx will try to only build the pages that have been modified.
 
 If you want to do a full clean build, do::
 
     make clean
     make html
 
+Writing ReST pages
+------------------
+
+Most documentation is either in the docstrings of individual classes and methods, in explicit
+``.rst`` files, or in examples and tutorials. All of these use the
+`ReST <https://docutils.sourceforge.io/rst.html>`_ syntax and are processed by
+`Sphinx <https://www.sphinx-doc.org/en/master/>`_.
+
+This section contains additional information and conventions how ReST is used in the
+xarray documentation.
+
+Section formatting
+~~~~~~~~~~~~~~~~~~
+
+We aim to follow the recommendations from the
+`Python documentation <https://devguide.python.org/documentation/start-documenting/index.html#sections>`_
+and the `Sphinx reStructuredText documentation <https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html#sections>`_
+for section markup characters,
+
+- ``*`` with overline, for chapters
+
+- ``=``, for heading
+
+- ``-``, for sections
+
+- ``~``, for subsections
+
+- ``**`` text ``**``, for **bold** text
+
+Referring to other documents and sections
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+`Sphinx  <https://www.sphinx-doc.org/en/master/>`_ allows internal
+`references <https://www.sphinx-doc.org/en/master/usage/restructuredtext/roles.html>`_ between documents.
+
+Documents can be linked with the ``:doc:`` directive:
+
+::
+
+    See the :doc:`/getting-started-guide/installing`
+
+    See the :doc:`/getting-started-guide/quick-overview`
+
+will render as:
+
+See the `Installation <https://docs.xarray.dev/en/stable/getting-started-guide/installing.html>`_
+
+See the `Quick Overview <https://docs.xarray.dev/en/stable/getting-started-guide/quick-overview.html>`_
+
+Including figures and files
+---------------------------
+
+Image files can be directly included in pages with the ``image::`` directive.
+
 .. _contributing.code:
 
 Contributing to the code base
 =============================
 
 .. contents:: Code Base:
    :local:
@@ -486,17 +645,15 @@
 <https://numpy.org/doc/stable/reference/routines.testing.html>`_.
 
 Writing tests
 ~~~~~~~~~~~~~
 
 All tests should go into the ``tests`` subdirectory of the specific package.
 This folder contains many current examples of tests, and we suggest looking to these for
-inspiration.  If your test requires working with files or
-network connectivity, there is more information on the `testing page
-<https://github.com/pydata/xarray/wiki/Testing>`_ of the wiki.
+inspiration.
 
 The ``xarray.testing`` module has many special ``assert`` functions that
 make it easier to make statements about whether DataArray or Dataset objects are
 equivalent. The easiest way to verify that your code is correct is to
 explicitly construct the result you expect, then compare the actual result to
 the expected correct result::
```

### Comparing `xarray-2023.3.0/doc/developers-meeting.rst` & `xarray-2023.4.0/doc/developers-meeting.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/ecosystem.rst` & `xarray-2023.4.0/doc/ecosystem.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/examples/ERA5-GRIB-example.ipynb` & `xarray-2023.4.0/doc/examples/ERA5-GRIB-example.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/examples/ROMS_ocean_model.ipynb` & `xarray-2023.4.0/doc/examples/ROMS_ocean_model.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/examples/_code/accessor_example.py` & `xarray-2023.4.0/doc/examples/_code/accessor_example.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/examples/apply_ufunc_vectorize_1d.ipynb` & `xarray-2023.4.0/doc/examples/apply_ufunc_vectorize_1d.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/examples/area_weighted_temperature.ipynb` & `xarray-2023.4.0/doc/examples/area_weighted_temperature.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/examples/blank_template.ipynb` & `xarray-2023.4.0/doc/examples/blank_template.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/examples/monthly-means.ipynb` & `xarray-2023.4.0/doc/examples/monthly-means.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/examples/monthly_means_output.png` & `xarray-2023.4.0/doc/examples/monthly_means_output.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/examples/multidimensional-coords.ipynb` & `xarray-2023.4.0/doc/examples/multidimensional-coords.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/examples/visualization_gallery.ipynb` & `xarray-2023.4.0/doc/examples/visualization_gallery.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/examples/weather-data.ipynb` & `xarray-2023.4.0/doc/examples/weather-data.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/gallery/plot_cartopy_facetgrid.py` & `xarray-2023.4.0/doc/gallery/plot_cartopy_facetgrid.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/gallery/plot_colorbar_center.py` & `xarray-2023.4.0/doc/gallery/plot_colorbar_center.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/gallery/plot_control_colorbar.py` & `xarray-2023.4.0/doc/gallery/plot_control_colorbar.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/gallery/plot_lines_from_2d.py` & `xarray-2023.4.0/doc/gallery/plot_lines_from_2d.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/gallery.rst` & `xarray-2023.4.0/doc/gallery.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/gallery.yml` & `xarray-2023.4.0/doc/gallery.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/getting-started-guide/installing.rst` & `xarray-2023.4.0/doc/getting-started-guide/installing.rst`

 * *Files 9% similar despite different names*

```diff
@@ -37,20 +37,16 @@
 - `zarr <https://zarr.readthedocs.io>`__: for chunked, compressed, N-dimensional arrays.
 - `cftime <https://unidata.github.io/cftime>`__: recommended if you
   want to encode/decode datetimes for non-standard calendars or dates before
   year 1678 or after year 2262.
 - `PseudoNetCDF <http://github.com/barronh/pseudonetcdf/>`__: recommended
   for accessing CAMx, GEOS-Chem (bpch), NOAA ARL files, ICARTT files
   (ffi1001) and many other.
-- `rasterio <https://github.com/rasterio/rasterio>`__: for reading GeoTiffs and
-  other gridded raster datasets.
 - `iris <https://github.com/scitools/iris>`__: for conversion to and from iris'
   Cube objects
-- `cfgrib <https://github.com/ecmwf/cfgrib>`__: for reading GRIB files via the
-  *ECMWF ecCodes* library.
 
 For accelerating xarray
 ~~~~~~~~~~~~~~~~~~~~~~~
 
 - `scipy <https://scipy.org/>`__: necessary to enable the interpolation features for
   xarray objects
 - `bottleneck <https://github.com/pydata/bottleneck>`__: speeds up
```

### Comparing `xarray-2023.3.0/doc/getting-started-guide/quick-overview.rst` & `xarray-2023.4.0/doc/getting-started-guide/quick-overview.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/getting-started-guide/why-xarray.rst` & `xarray-2023.4.0/doc/getting-started-guide/why-xarray.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/howdoi.rst` & `xarray-2023.4.0/doc/howdoi.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/index.rst` & `xarray-2023.4.0/doc/index.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/internals/duck-arrays-integration.rst` & `xarray-2023.4.0/doc/internals/duck-arrays-integration.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/internals/extending-xarray.rst` & `xarray-2023.4.0/doc/internals/extending-xarray.rst`

 * *Files 3% similar despite different names*

```diff
@@ -1,22 +1,22 @@
 
-Extending xarray
-================
+Extending xarray using accessors
+================================
 
 .. ipython:: python
     :suppress:
 
     import xarray as xr
 
 
-Xarray is designed as a general purpose library, and hence tries to avoid
+Xarray is designed as a general purpose library and hence tries to avoid
 including overly domain specific functionality. But inevitably, the need for more
 domain specific logic arises.
 
-One standard solution to this problem is to subclass Dataset and/or DataArray to
+One potential solution to this problem is to subclass Dataset and/or DataArray to
 add domain specific functionality. However, inheritance is not very robust. It's
 easy to inadvertently use internal APIs when subclassing, which means that your
 code may break when xarray upgrades. Furthermore, many builtin methods will
 only return native xarray objects.
 
 The standard advice is to use :issue:`composition over inheritance <706>`, but
 reimplementing an API as large as xarray's on your own objects can be an onerous
@@ -25,15 +25,17 @@
 If you simply want the ability to call a function with the syntax of a
 method call, then the builtin :py:meth:`~xarray.DataArray.pipe` method (copied
 from pandas) may suffice.
 
 To resolve this issue for more complex cases, xarray has the
 :py:func:`~xarray.register_dataset_accessor` and
 :py:func:`~xarray.register_dataarray_accessor` decorators for adding custom
-"accessors" on xarray objects. Here's how you might use these decorators to
+"accessors" on xarray objects, thereby "extending" the functionality of your xarray object.
+
+Here's how you might use these decorators to
 write a custom "geo" accessor implementing a geography specific extension to
 xarray:
 
 .. literalinclude:: ../examples/_code/accessor_example.py
 
 In general, the only restriction on the accessor class is that the ``__init__`` method
 must have a single parameter: the ``Dataset`` or ``DataArray`` object it is supposed
```

### Comparing `xarray-2023.3.0/doc/internals/how-to-add-new-backend.rst` & `xarray-2023.4.0/doc/internals/how-to-add-new-backend.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/internals/variable-objects.rst` & `xarray-2023.4.0/doc/internals/variable-objects.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/internals/zarr-encoding-spec.rst` & `xarray-2023.4.0/doc/internals/zarr-encoding-spec.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/roadmap.rst` & `xarray-2023.4.0/doc/roadmap.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/tutorials-and-videos.rst` & `xarray-2023.4.0/doc/tutorials-and-videos.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/user-guide/combining.rst` & `xarray-2023.4.0/doc/user-guide/combining.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/user-guide/computation.rst` & `xarray-2023.4.0/doc/user-guide/dask.rst`

 * *Files 20% similar despite different names*

```diff
@@ -1,815 +1,577 @@
 .. currentmodule:: xarray
 
-.. _comput:
+.. _dask:
 
-###########
-Computation
-###########
+Parallel computing with Dask
+============================
 
+Xarray integrates with `Dask <https://dask.org/>`__ to support parallel
+computations and streaming computation on datasets that don't fit into memory.
+Currently, Dask is an entirely optional feature for xarray. However, the
+benefits of using Dask are sufficiently strong that Dask may become a required
+dependency in a future version of xarray.
 
-The labels associated with :py:class:`~xarray.DataArray` and
-:py:class:`~xarray.Dataset` objects enables some powerful shortcuts for
-computation, notably including aggregation and broadcasting by dimension
-names.
+For a full example of how to use xarray's Dask integration, read the
+`blog post introducing xarray and Dask`_. More up-to-date examples
+may be found at the `Pangeo project's gallery <http://gallery.pangeo.io/>`_
+and at the `Dask examples website <https://examples.dask.org/xarray.html>`_.
 
-Basic array math
-================
+.. _blog post introducing xarray and Dask: https://stephanhoyer.com/2015/06/11/xray-dask-out-of-core-labeled-arrays/
 
-Arithmetic operations with a single DataArray automatically vectorize (like
-numpy) over all array values:
+What is a Dask array?
+---------------------
 
-.. ipython:: python
-    :suppress:
-
-    import numpy as np
-    import pandas as pd
-    import xarray as xr
-
-    np.random.seed(123456)
-
-.. ipython:: python
-
-    arr = xr.DataArray(
-        np.random.RandomState(0).randn(2, 3), [("x", ["a", "b"]), ("y", [10, 20, 30])]
-    )
-    arr - 3
-    abs(arr)
-
-You can also use any of numpy's or scipy's many `ufunc`__ functions directly on
-a DataArray:
-
-__ https://numpy.org/doc/stable/reference/ufuncs.html
-
-.. ipython:: python
-
-    np.sin(arr)
-
-Use :py:func:`~xarray.where` to conditionally switch between values:
-
-.. ipython:: python
-
-    xr.where(arr > 0, "positive", "negative")
-
-Use `@` to perform matrix multiplication:
-
-.. ipython:: python
+.. image:: ../_static/dask_array.png
+   :width: 40 %
+   :align: right
+   :alt: A Dask array
 
-    arr @ arr
+Dask divides arrays into many small pieces, called *chunks*, each of which is
+presumed to be small enough to fit into memory.
 
-Data arrays also implement many :py:class:`numpy.ndarray` methods:
+Unlike NumPy, which has eager evaluation, operations on Dask arrays are lazy.
+Operations queue up a series of tasks mapped over blocks, and no computation is
+performed until you actually ask values to be computed (e.g., to print results
+to your screen or write to disk). At that point, data is loaded into memory
+and computation proceeds in a streaming fashion, block-by-block.
 
-.. ipython:: python
+The actual computation is controlled by a multi-processing or thread pool,
+which allows Dask to take full advantage of multiple processors available on
+most modern computers.
 
-    arr.round(2)
-    arr.T
+For more details, read the `Dask documentation <https://docs.dask.org/>`__.
+Note that xarray only makes use of ``dask.array`` and ``dask.delayed``.
 
-.. _missing_values:
+.. _dask.io:
 
-Missing values
-==============
+Reading and writing data
+------------------------
 
-Xarray objects borrow the :py:meth:`~xarray.DataArray.isnull`,
-:py:meth:`~xarray.DataArray.notnull`, :py:meth:`~xarray.DataArray.count`,
-:py:meth:`~xarray.DataArray.dropna`, :py:meth:`~xarray.DataArray.fillna`,
-:py:meth:`~xarray.DataArray.ffill`, and :py:meth:`~xarray.DataArray.bfill`
-methods for working with missing data from pandas:
+The usual way to create a ``Dataset`` filled with Dask arrays is to load the
+data from a netCDF file or files. You can do this by supplying a ``chunks``
+argument to :py:func:`~xarray.open_dataset` or using the
+:py:func:`~xarray.open_mfdataset` function.
 
 .. ipython:: python
+    :suppress:
 
-    x = xr.DataArray([0, 1, np.nan, np.nan, 2], dims=["x"])
-    x.isnull()
-    x.notnull()
-    x.count()
-    x.dropna(dim="x")
-    x.fillna(-1)
-    x.ffill("x")
-    x.bfill("x")
-
-Like pandas, xarray uses the float value ``np.nan`` (not-a-number) to represent
-missing values.
+    import os
 
-Xarray objects also have an :py:meth:`~xarray.DataArray.interpolate_na` method
-for filling missing values via 1D interpolation.
+    import numpy as np
+    import pandas as pd
+    import xarray as xr
 
-.. ipython:: python
+    np.random.seed(123456)
+    np.set_printoptions(precision=3, linewidth=100, threshold=100, edgeitems=3)
 
-    x = xr.DataArray(
-        [0, 1, np.nan, np.nan, 2],
-        dims=["x"],
-        coords={"xx": xr.Variable("x", [0, 1, 1.1, 1.9, 3])},
+    ds = xr.Dataset(
+        {
+            "temperature": (
+                ("time", "latitude", "longitude"),
+                np.random.randn(30, 180, 180),
+            ),
+            "time": pd.date_range("2015-01-01", periods=30),
+            "longitude": np.arange(180),
+            "latitude": np.arange(89.5, -90.5, -1),
+        }
     )
-    x.interpolate_na(dim="x", method="linear", use_coordinate="xx")
-
-Note that xarray slightly diverges from the pandas ``interpolate`` syntax by
-providing the ``use_coordinate`` keyword which facilitates a clear specification
-of which values to use as the index in the interpolation.
-Xarray also provides the ``max_gap`` keyword argument to limit the interpolation to
-data gaps of length ``max_gap`` or smaller. See :py:meth:`~xarray.DataArray.interpolate_na`
-for more.
-
-.. _agg:
-
-Aggregation
-===========
-
-Aggregation methods have been updated to take a `dim` argument instead of
-`axis`. This allows for very intuitive syntax for aggregation methods that are
-applied along particular dimension(s):
-
-.. ipython:: python
-
-    arr.sum(dim="x")
-    arr.std(["x", "y"])
-    arr.min()
-
-
-If you need to figure out the axis number for a dimension yourself (say,
-for wrapping code designed to work with numpy arrays), you can use the
-:py:meth:`~xarray.DataArray.get_axis_num` method:
-
-.. ipython:: python
-
-    arr.get_axis_num("y")
-
-These operations automatically skip missing values, like in pandas:
-
-.. ipython:: python
-
-    xr.DataArray([1, 2, np.nan, 3]).mean()
-
-If desired, you can disable this behavior by invoking the aggregation method
-with ``skipna=False``.
-
-.. _comput.rolling:
-
-Rolling window operations
-=========================
-
-``DataArray`` objects include a :py:meth:`~xarray.DataArray.rolling` method. This
-method supports rolling window aggregation:
+    ds.to_netcdf("example-data.nc")
 
 .. ipython:: python
 
-    arr = xr.DataArray(np.arange(0, 7.5, 0.5).reshape(3, 5), dims=("x", "y"))
-    arr
+    ds = xr.open_dataset("example-data.nc", chunks={"time": 10})
+    ds
 
-:py:meth:`~xarray.DataArray.rolling` is applied along one dimension using the
-name of the dimension as a key (e.g. ``y``) and the window size as the value
-(e.g. ``3``).  We get back a ``Rolling`` object:
+In this example ``latitude`` and ``longitude`` do not appear in the ``chunks``
+dict, so only one chunk will be used along those dimensions.  It is also
+entirely equivalent to opening a dataset using :py:func:`~xarray.open_dataset`
+and then chunking the data using the ``chunk`` method, e.g.,
+``xr.open_dataset('example-data.nc').chunk({'time': 10})``.
 
-.. ipython:: python
+To open multiple files simultaneously in parallel using Dask delayed,
+use :py:func:`~xarray.open_mfdataset`::
 
-    arr.rolling(y=3)
+    xr.open_mfdataset('my/files/*.nc', parallel=True)
 
-Aggregation and summary methods can be applied directly to the ``Rolling``
-object:
+This function will automatically concatenate and merge datasets into one in
+the simple cases that it understands (see :py:func:`~xarray.combine_by_coords`
+for the full disclaimer). By default, :py:func:`~xarray.open_mfdataset` will chunk each
+netCDF file into a single Dask array; again, supply the ``chunks`` argument to
+control the size of the resulting Dask arrays. In more complex cases, you can
+open each file individually using :py:func:`~xarray.open_dataset` and merge the result, as
+described in :ref:`combining data`. Passing the keyword argument ``parallel=True`` to
+:py:func:`~xarray.open_mfdataset` will speed up the reading of large multi-file datasets by
+executing those read tasks in parallel using ``dask.delayed``.
 
-.. ipython:: python
+.. warning::
 
-    r = arr.rolling(y=3)
-    r.reduce(np.std)
-    r.mean()
+    :py:func:`~xarray.open_mfdataset` called without ``chunks`` argument will return
+    dask arrays with chunk sizes equal to the individual files. Re-chunking
+    the dataset after creation with ``ds.chunk()`` will lead to an ineffective use of
+    memory and is not recommended.
 
-Aggregation results are assigned the coordinate at the end of each window by
-default, but can be centered by passing ``center=True`` when constructing the
-``Rolling`` object:
+You'll notice that printing a dataset still shows a preview of array values,
+even if they are actually Dask arrays. We can do this quickly with Dask because
+we only need to compute the first few values (typically from the first block).
+To reveal the true nature of an array, print a DataArray:
 
 .. ipython:: python
 
-    r = arr.rolling(y=3, center=True)
-    r.mean()
+    ds.temperature
 
-As can be seen above, aggregations of windows which overlap the border of the
-array produce ``nan``\s.  Setting ``min_periods`` in the call to ``rolling``
-changes the minimum number of observations within the window required to have
-a value when aggregating:
+Once you've manipulated a Dask array, you can still write a dataset too big to
+fit into memory back to disk by using :py:meth:`~xarray.Dataset.to_netcdf` in the
+usual way.
 
 .. ipython:: python
 
-    r = arr.rolling(y=3, min_periods=2)
-    r.mean()
-    r = arr.rolling(y=3, center=True, min_periods=2)
-    r.mean()
-
-From version 0.17, xarray supports multidimensional rolling,
-
-.. ipython:: python
-
-    r = arr.rolling(x=2, y=3, min_periods=2)
-    r.mean()
-
-.. tip::
-
-   Note that rolling window aggregations are faster and use less memory when bottleneck_ is installed. This only applies to numpy-backed xarray objects with 1d-rolling.
-
-.. _bottleneck: https://github.com/pydata/bottleneck
-
-We can also manually iterate through ``Rolling`` objects:
-
-.. code:: python
-
-    for label, arr_window in r:
-        # arr_window is a view of x
-        ...
-
-.. _comput.rolling_exp:
-
-While ``rolling`` provides a simple moving average, ``DataArray`` also supports
-an exponential moving average with :py:meth:`~xarray.DataArray.rolling_exp`.
-This is similar to pandas' ``ewm`` method. numbagg_ is required.
+    ds.to_netcdf("manipulated-example-data.nc")
 
-.. _numbagg: https://github.com/numbagg/numbagg
-
-.. code:: python
-
-    arr.rolling_exp(y=3).mean()
-
-The ``rolling_exp`` method takes a ``window_type`` kwarg, which can be ``'alpha'``,
-``'com'`` (for ``center-of-mass``), ``'span'``, and ``'halflife'``. The default is
-``span``.
-
-Finally, the rolling object has a ``construct`` method which returns a
-view of the original ``DataArray`` with the windowed dimension in
-the last position.
-You can use this for more advanced rolling operations such as strided rolling,
-windowed rolling, convolution, short-time FFT etc.
+By setting the ``compute`` argument to ``False``, :py:meth:`~xarray.Dataset.to_netcdf`
+will return a ``dask.delayed`` object that can be computed later.
 
 .. ipython:: python
 
-    # rolling with 2-point stride
-    rolling_da = r.construct(x="x_win", y="y_win", stride=2)
-    rolling_da
-    rolling_da.mean(["x_win", "y_win"], skipna=False)
+    from dask.diagnostics import ProgressBar
 
-Because the ``DataArray`` given by ``r.construct('window_dim')`` is a view
-of the original array, it is memory efficient.
-You can also use ``construct`` to compute a weighted rolling sum:
+    # or distributed.progress when using the distributed scheduler
+    delayed_obj = ds.to_netcdf("manipulated-example-data.nc", compute=False)
+    with ProgressBar():
+        results = delayed_obj.compute()
 
 .. ipython:: python
+    :suppress:
 
-    weight = xr.DataArray([0.25, 0.5, 0.25], dims=["window"])
-    arr.rolling(y=3).construct(y="window").dot(weight)
+    os.remove("manipulated-example-data.nc")  # Was not opened.
 
 .. note::
-  numpy's Nan-aggregation functions such as ``nansum`` copy the original array.
-  In xarray, we internally use these functions in our aggregation methods
-  (such as ``.sum()``) if ``skipna`` argument is not specified or set to True.
-  This means ``rolling_da.mean('window_dim')`` is memory inefficient.
-  To avoid this, use ``skipna=False`` as the above example.
-
 
-.. _comput.weighted:
+    When using Dask's distributed scheduler to write NETCDF4 files,
+    it may be necessary to set the environment variable `HDF5_USE_FILE_LOCKING=FALSE`
+    to avoid competing locks within the HDF5 SWMR file locking scheme. Note that
+    writing netCDF files with Dask's distributed scheduler is only supported for
+    the `netcdf4` backend.
 
-Weighted array reductions
-=========================
-
-:py:class:`DataArray` and :py:class:`Dataset` objects include :py:meth:`DataArray.weighted`
-and :py:meth:`Dataset.weighted` array reduction methods. They currently
-support weighted ``sum``, ``mean``, ``std``, ``var`` and ``quantile``.
+A dataset can also be converted to a Dask DataFrame using :py:meth:`~xarray.Dataset.to_dask_dataframe`.
 
 .. ipython:: python
+    :okwarning:
 
-    coords = dict(month=("month", [1, 2, 3]))
-
-    prec = xr.DataArray([1.1, 1.0, 0.9], dims=("month",), coords=coords)
-    weights = xr.DataArray([31, 28, 31], dims=("month",), coords=coords)
-
-Create a weighted object:
+    df = ds.to_dask_dataframe()
+    df
 
-.. ipython:: python
-
-    weighted_prec = prec.weighted(weights)
-    weighted_prec
+Dask DataFrames do not support multi-indexes so the coordinate variables from the dataset are included as columns in the Dask DataFrame.
 
-Calculate the weighted sum:
 
-.. ipython:: python
+Using Dask with xarray
+----------------------
 
-    weighted_prec.sum()
-
-Calculate the weighted mean:
-
-.. ipython:: python
-
-    weighted_prec.mean(dim="month")
-
-Calculate the weighted quantile:
-
-.. ipython:: python
-
-    weighted_prec.quantile(q=0.5, dim="month")
-
-The weighted sum corresponds to:
-
-.. ipython:: python
+Nearly all existing xarray methods (including those for indexing, computation,
+concatenating and grouped operations) have been extended to work automatically
+with Dask arrays. When you load data as a Dask array in an xarray data
+structure, almost all xarray operations will keep it as a Dask array; when this
+is not possible, they will raise an exception rather than unexpectedly loading
+data into memory. Converting a Dask array into memory generally requires an
+explicit conversion step. One notable exception is indexing operations: to
+enable label based indexing, xarray will automatically load coordinate labels
+into memory.
 
-    weighted_sum = (prec * weights).sum()
-    weighted_sum
-
-the weighted mean to:
-
-.. ipython:: python
-
-    weighted_mean = weighted_sum / weights.sum()
-    weighted_mean
-
-the weighted variance to:
-
-.. ipython:: python
+.. tip::
 
-    weighted_var = weighted_prec.sum_of_squares() / weights.sum()
-    weighted_var
+   By default, dask uses its multi-threaded scheduler, which distributes work across
+   multiple cores and allows for processing some datasets that do not fit into memory.
+   For running across a cluster, `setup the distributed scheduler <https://docs.dask.org/en/latest/setup.html>`_.
 
-and the weighted standard deviation to:
+The easiest way to convert an xarray data structure from lazy Dask arrays into
+*eager*, in-memory NumPy arrays is to use the :py:meth:`~xarray.Dataset.load` method:
 
 .. ipython:: python
 
-    weighted_std = np.sqrt(weighted_var)
-    weighted_std
+    ds.load()
 
-However, the functions also take missing values in the data into account:
+You can also access :py:attr:`~xarray.DataArray.values`, which will always be a
+NumPy array:
 
-.. ipython:: python
+.. ipython::
+    :verbatim:
 
-    data = xr.DataArray([np.NaN, 2, 4])
-    weights = xr.DataArray([8, 1, 1])
+    In [5]: ds.temperature.values
+    Out[5]:
+    array([[[  4.691e-01,  -2.829e-01, ...,  -5.577e-01,   3.814e-01],
+            [  1.337e+00,  -1.531e+00, ...,   8.726e-01,  -1.538e+00],
+            ...
+    # truncated for brevity
 
-    data.weighted(weights).mean()
+Explicit conversion by wrapping a DataArray with ``np.asarray`` also works:
 
-Using ``(data * weights).sum() / weights.sum()`` would (incorrectly) result
-in 0.6.
+.. ipython::
+    :verbatim:
 
+    In [5]: np.asarray(ds.temperature)
+    Out[5]:
+    array([[[  4.691e-01,  -2.829e-01, ...,  -5.577e-01,   3.814e-01],
+            [  1.337e+00,  -1.531e+00, ...,   8.726e-01,  -1.538e+00],
+            ...
 
-If the weights add up to to 0, ``sum`` returns 0:
+Alternatively you can load the data into memory but keep the arrays as
+Dask arrays using the :py:meth:`~xarray.Dataset.persist` method:
 
 .. ipython:: python
 
-    data = xr.DataArray([1.0, 1.0])
-    weights = xr.DataArray([-1.0, 1.0])
-
-    data.weighted(weights).sum()
-
-and ``mean``, ``std`` and ``var`` return ``NaN``:
+    persisted = ds.persist()
 
-.. ipython:: python
+:py:meth:`~xarray.Dataset.persist` is particularly useful when using a
+distributed cluster because the data will be loaded into distributed memory
+across your machines and be much faster to use than reading repeatedly from
+disk.
 
-    data.weighted(weights).mean()
+.. warning::
 
+   On a single machine :py:meth:`~xarray.Dataset.persist` will try to load all of
+   your data into memory. You should make sure that your dataset is not larger than
+   available memory.
 
 .. note::
-  ``weights`` must be a :py:class:`DataArray` and cannot contain missing values.
-  Missing values can be replaced manually by ``weights.fillna(0)``.
-
-.. _compute.coarsen:
 
-Coarsen large arrays
-====================
+   For more on the differences between :py:meth:`~xarray.Dataset.persist` and
+   :py:meth:`~xarray.Dataset.compute` see this `Stack Overflow answer on the differences between client persist and client compute <https://stackoverflow.com/questions/41806850/dask-difference-between-client-persist-and-client-compute>`_ and the `Dask documentation <https://distributed.dask.org/en/latest/manage-computation.html#dask-collections-to-futures>`_.
 
-:py:class:`DataArray` and :py:class:`Dataset` objects include a
-:py:meth:`~xarray.DataArray.coarsen` and :py:meth:`~xarray.Dataset.coarsen`
-methods. This supports block aggregation along multiple dimensions,
+For performance you may wish to consider chunk sizes.  The correct choice of
+chunk size depends both on your data and on the operations you want to perform.
+With xarray, both converting data to a Dask arrays and converting the chunk
+sizes of Dask arrays is done with the :py:meth:`~xarray.Dataset.chunk` method:
 
 .. ipython:: python
 
-    x = np.linspace(0, 10, 300)
-    t = pd.date_range("1999-12-15", periods=364)
-    da = xr.DataArray(
-        np.sin(x) * np.cos(np.linspace(0, 1, 364)[:, np.newaxis]),
-        dims=["time", "x"],
-        coords={"time": t, "x": x},
-    )
-    da
-
-In order to take a block mean for every 7 days along ``time`` dimension and
-every 2 points along ``x`` dimension,
-
-.. ipython:: python
-
-    da.coarsen(time=7, x=2).mean()
-
-:py:meth:`~xarray.DataArray.coarsen` raises an ``ValueError`` if the data
-length is not a multiple of the corresponding window size.
-You can choose ``boundary='trim'`` or ``boundary='pad'`` options for trimming
-the excess entries or padding ``nan`` to insufficient entries,
+    rechunked = ds.chunk({"latitude": 100, "longitude": 100})
 
-.. ipython:: python
+.. warning::
 
-    da.coarsen(time=30, x=2, boundary="trim").mean()
+    Rechunking an existing dask array created with :py:func:`~xarray.open_mfdataset`
+    is not recommended (see above).
 
-If you want to apply a specific function to coordinate, you can pass the
-function or method name to ``coord_func`` option,
+You can view the size of existing chunks on an array by viewing the
+:py:attr:`~xarray.Dataset.chunks` attribute:
 
 .. ipython:: python
 
-    da.coarsen(time=7, x=2, coord_func={"time": "min"}).mean()
+    rechunked.chunks
 
-You can also :ref:`use coarsen to reshape<reshape.coarsen>` without applying a computation.
+If there are not consistent chunksizes between all the arrays in a dataset
+along a particular dimension, an exception is raised when you try to access
+``.chunks``.
 
-.. _compute.using_coordinates:
+.. note::
 
-Computation using Coordinates
-=============================
+    In the future, we would like to enable automatic alignment of Dask
+    chunksizes (but not the other way around). We might also require that all
+    arrays in a dataset share the same chunking alignment. Neither of these
+    are currently done.
 
-Xarray objects have some handy methods for the computation with their
-coordinates. :py:meth:`~xarray.DataArray.differentiate` computes derivatives by
-central finite differences using their coordinates,
+NumPy ufuncs like ``np.sin`` transparently work on all xarray objects, including those
+that store lazy Dask arrays:
 
 .. ipython:: python
 
-    a = xr.DataArray([0, 1, 2, 3], dims=["x"], coords=[[0.1, 0.11, 0.2, 0.3]])
-    a
-    a.differentiate("x")
-
-This method can be used also for multidimensional arrays,
-
-.. ipython:: python
+    import numpy as np
 
-    a = xr.DataArray(
-        np.arange(8).reshape(4, 2), dims=["x", "y"], coords={"x": [0.1, 0.11, 0.2, 0.3]}
-    )
-    a.differentiate("x")
+    np.sin(rechunked)
 
-:py:meth:`~xarray.DataArray.integrate` computes integration based on
-trapezoidal rule using their coordinates,
+To access Dask arrays directly, use the
+:py:attr:`DataArray.data <xarray.DataArray.data>` attribute. This attribute exposes
+array data either as a Dask array or as a NumPy array, depending on whether it has been
+loaded into Dask or not:
 
 .. ipython:: python
 
-    a.integrate("x")
+    ds.temperature.data
 
 .. note::
-    These methods are limited to simple cartesian geometry. Differentiation
-    and integration along multidimensional coordinate are not supported.
 
+    ``.data`` is also used to expose other "computable" array backends beyond Dask and
+    NumPy (e.g. sparse and pint arrays).
 
-.. _compute.polyfit:
+.. _dask.automatic-parallelization:
 
-Fitting polynomials
-===================
+Automatic parallelization with ``apply_ufunc`` and ``map_blocks``
+-----------------------------------------------------------------
 
-Xarray objects provide an interface for performing linear or polynomial regressions
-using the least-squares method. :py:meth:`~xarray.DataArray.polyfit` computes the
-best fitting coefficients along a given dimension and for a given order,
+Almost all of xarray's built-in operations work on Dask arrays. If you want to
+use a function that isn't wrapped by xarray, and have it applied in parallel on
+each block of your xarray object, you have three options:
+
+1. Extract Dask arrays from xarray objects (``.data``) and use Dask directly.
+2. Use :py:func:`~xarray.apply_ufunc` to apply functions that consume and return NumPy arrays.
+3. Use :py:func:`~xarray.map_blocks`, :py:meth:`Dataset.map_blocks` or :py:meth:`DataArray.map_blocks`
+   to apply functions that consume and return xarray objects.
+
+
+``apply_ufunc``
+~~~~~~~~~~~~~~~
+
+:py:func:`~xarray.apply_ufunc` automates `embarrassingly parallel
+<https://en.wikipedia.org/wiki/Embarrassingly_parallel>`__ "map" type operations
+where a function written for processing NumPy arrays should be repeatedly
+applied to xarray objects containing Dask arrays. It works similarly to
+:py:func:`dask.array.map_blocks` and :py:func:`dask.array.blockwise`, but without
+requiring an intermediate layer of abstraction.
+
+For the best performance when using Dask's multi-threaded scheduler, wrap a
+function that already releases the global interpreter lock, which fortunately
+already includes most NumPy and Scipy functions. Here we show an example
+using NumPy operations and a fast function from
+`bottleneck <https://github.com/pydata/bottleneck>`__, which
+we use to calculate `Spearman's rank-correlation coefficient <https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient>`__:
 
-.. ipython:: python
+.. code-block:: python
 
-    x = xr.DataArray(np.arange(10), dims=["x"], name="x")
-    a = xr.DataArray(3 + 4 * x, dims=["x"], coords={"x": x})
-    out = a.polyfit(dim="x", deg=1, full=True)
-    out
+    import numpy as np
+    import xarray as xr
+    import bottleneck
 
-The method outputs a dataset containing the coefficients (and more if `full=True`).
-The inverse operation is done with :py:meth:`~xarray.polyval`,
 
-.. ipython:: python
+    def covariance_gufunc(x, y):
+        return (
+            (x - x.mean(axis=-1, keepdims=True)) * (y - y.mean(axis=-1, keepdims=True))
+        ).mean(axis=-1)
 
-    xr.polyval(coord=x, coeffs=out.polyfit_coefficients)
 
-.. note::
-    These methods replicate the behaviour of :py:func:`numpy.polyfit` and :py:func:`numpy.polyval`.
+    def pearson_correlation_gufunc(x, y):
+        return covariance_gufunc(x, y) / (x.std(axis=-1) * y.std(axis=-1))
 
 
-.. _compute.curvefit:
+    def spearman_correlation_gufunc(x, y):
+        x_ranks = bottleneck.rankdata(x, axis=-1)
+        y_ranks = bottleneck.rankdata(y, axis=-1)
+        return pearson_correlation_gufunc(x_ranks, y_ranks)
 
-Fitting arbitrary functions
-===========================
 
-Xarray objects also provide an interface for fitting more complex functions using
-:py:func:`scipy.optimize.curve_fit`. :py:meth:`~xarray.DataArray.curvefit` accepts
-user-defined functions and can fit along multiple coordinates.
+    def spearman_correlation(x, y, dim):
+        return xr.apply_ufunc(
+            spearman_correlation_gufunc,
+            x,
+            y,
+            input_core_dims=[[dim], [dim]],
+            dask="parallelized",
+            output_dtypes=[float],
+        )
 
-For example, we can fit a relationship between two ``DataArray`` objects, maintaining
-a unique fit at each spatial coordinate but aggregating over the time dimension:
+The only aspect of this example that is different from standard usage of
+``apply_ufunc()`` is that we needed to supply the ``output_dtypes`` arguments.
+(Read up on :ref:`comput.wrapping-custom` for an explanation of the
+"core dimensions" listed in ``input_core_dims``.)
+
+Our new ``spearman_correlation()`` function achieves near linear speedup
+when run on large arrays across the four cores on my laptop. It would also
+work as a streaming operation, when run on arrays loaded from disk:
 
-.. ipython:: python
+.. ipython::
+    :verbatim:
 
-    def exponential(x, a, xc):
-        return np.exp((x - xc) / a)
+    In [56]: rs = np.random.RandomState(0)
 
+    In [57]: array1 = xr.DataArray(rs.randn(1000, 100000), dims=["place", "time"])  # 800MB
 
-    x = np.arange(-5, 5, 0.1)
-    t = np.arange(-5, 5, 0.1)
-    X, T = np.meshgrid(x, t)
-    Z1 = np.random.uniform(low=-5, high=5, size=X.shape)
-    Z2 = exponential(Z1, 3, X)
-    Z3 = exponential(Z1, 1, -X)
+    In [58]: array2 = array1 + 0.5 * rs.randn(1000, 100000)
 
-    ds = xr.Dataset(
-        data_vars=dict(
-            var1=(["t", "x"], Z1), var2=(["t", "x"], Z2), var3=(["t", "x"], Z3)
-        ),
-        coords={"t": t, "x": x},
-    )
-    ds[["var2", "var3"]].curvefit(
-        coords=ds.var1,
-        func=exponential,
-        reduce_dims="t",
-        bounds={"a": (0.5, 5), "xc": (-5, 5)},
-    )
+    # using one core, on NumPy arrays
+    In [61]: %time _ = spearman_correlation(array1, array2, 'time')
+    CPU times: user 21.6 s, sys: 2.84 s, total: 24.5 s
+    Wall time: 24.9 s
 
-We can also fit multi-dimensional functions, and even use a wrapper function to
-simultaneously fit a summation of several functions, such as this field containing
-two gaussian peaks:
+    In [8]: chunked1 = array1.chunk({"place": 10})
 
-.. ipython:: python
+    In [9]: chunked2 = array2.chunk({"place": 10})
 
-    def gaussian_2d(coords, a, xc, yc, xalpha, yalpha):
-        x, y = coords
-        z = a * np.exp(
-            -np.square(x - xc) / 2 / np.square(xalpha)
-            - np.square(y - yc) / 2 / np.square(yalpha)
-        )
-        return z
+    # using all my laptop's cores, with Dask
+    In [63]: r = spearman_correlation(chunked1, chunked2, "time").compute()
 
+    In [64]: %time _ = r.compute()
+    CPU times: user 30.9 s, sys: 1.74 s, total: 32.6 s
+    Wall time: 4.59 s
 
-    def multi_peak(coords, *args):
-        z = np.zeros(coords[0].shape)
-        for i in range(len(args) // 5):
-            z += gaussian_2d(coords, *args[i * 5 : i * 5 + 5])
-        return z
-
-
-    x = np.arange(-5, 5, 0.1)
-    y = np.arange(-5, 5, 0.1)
-    X, Y = np.meshgrid(x, y)
-
-    n_peaks = 2
-    names = ["a", "xc", "yc", "xalpha", "yalpha"]
-    names = [f"{name}{i}" for i in range(n_peaks) for name in names]
-    Z = gaussian_2d((X, Y), 3, 1, 1, 2, 1) + gaussian_2d((X, Y), 2, -1, -2, 1, 1)
-    Z += np.random.normal(scale=0.1, size=Z.shape)
-
-    da = xr.DataArray(Z, dims=["y", "x"], coords={"y": y, "x": x})
-    da.curvefit(
-        coords=["x", "y"],
-        func=multi_peak,
-        param_names=names,
-        kwargs={"maxfev": 10000},
-    )
-
-.. note::
-    This method replicates the behavior of :py:func:`scipy.optimize.curve_fit`.
+One limitation of ``apply_ufunc()`` is that it cannot be applied to arrays with
+multiple chunks along a core dimension:
 
+.. ipython::
+    :verbatim:
 
-.. _compute.broadcasting:
-
-Broadcasting by dimension name
-==============================
+    In [63]: spearman_correlation(chunked1, chunked2, "place")
+    ValueError: dimension 'place' on 0th function argument to apply_ufunc with
+    dask='parallelized' consists of multiple chunks, but is also a core
+    dimension. To fix, rechunk into a single Dask array chunk along this
+    dimension, i.e., ``.rechunk({'place': -1})``, but beware that this may
+    significantly increase memory usage.
+
+This reflects the nature of core dimensions, in contrast to broadcast (non-core)
+dimensions that allow operations to be split into arbitrary chunks for
+application.
 
-``DataArray`` objects automatically align themselves ("broadcasting" in
-the numpy parlance) by dimension name instead of axis order. With xarray, you
-do not need to transpose arrays or insert dimensions of length 1 to get array
-operations to work, as commonly done in numpy with :py:func:`numpy.reshape` or
-:py:data:`numpy.newaxis`.
+.. tip::
 
-This is best illustrated by a few examples. Consider two one-dimensional
-arrays with different sizes aligned along different dimensions:
+    For the majority of NumPy functions that are already wrapped by Dask, it's
+    usually a better idea to use the pre-existing ``dask.array`` function, by
+    using either a pre-existing xarray methods or
+    :py:func:`~xarray.apply_ufunc()` with ``dask='allowed'``. Dask can often
+    have a more efficient implementation that makes use of the specialized
+    structure of a problem, unlike the generic speedups offered by
+    ``dask='parallelized'``.
 
-.. ipython:: python
 
-    a = xr.DataArray([1, 2], [("x", ["a", "b"])])
-    a
-    b = xr.DataArray([-1, -2, -3], [("y", [10, 20, 30])])
-    b
+``map_blocks``
+~~~~~~~~~~~~~~
 
-With xarray, we can apply binary mathematical operations to these arrays, and
-their dimensions are expanded automatically:
+Functions that consume and return xarray objects can be easily applied in parallel using :py:func:`map_blocks`.
+Your function will receive an xarray Dataset or DataArray subset to one chunk
+along each chunked dimension.
 
 .. ipython:: python
 
-    a * b
+    ds.temperature
 
-Moreover, dimensions are always reordered to the order in which they first
-appeared:
+This DataArray has 3 chunks each with length 10 along the time dimension.
+At compute time, a function applied with :py:func:`map_blocks` will receive a DataArray corresponding to a single block of shape 10x180x180
+(time x latitude x longitude) with values loaded. The following snippet illustrates how to check the shape of the object
+received by the applied function.
 
 .. ipython:: python
 
-    c = xr.DataArray(np.arange(6).reshape(3, 2), [b["y"], a["x"]])
-    c
-    a + c
+    def func(da):
+        print(da.sizes)
+        return da.time
 
-This means, for example, that you always subtract an array from its transpose:
 
-.. ipython:: python
+    mapped = xr.map_blocks(func, ds.temperature)
+    mapped
 
-    c - c.T
+Notice that the :py:meth:`map_blocks` call printed
+``Frozen({'time': 0, 'latitude': 0, 'longitude': 0})`` to screen.
+``func`` is received 0-sized blocks! :py:meth:`map_blocks` needs to know what the final result
+looks like in terms of dimensions, shapes etc. It does so by running the provided function on 0-shaped
+inputs (*automated inference*). This works in many cases, but not all. If automatic inference does not
+work for your function, provide the ``template`` kwarg (see below).
 
-You can explicitly broadcast xarray data structures by using the
-:py:func:`~xarray.broadcast` function:
+In this case, automatic inference has worked so let's check that the result is as expected.
 
 .. ipython:: python
 
-    a2, b2 = xr.broadcast(a, b)
-    a2
-    b2
+    mapped.load(scheduler="single-threaded")
+    mapped.identical(ds.time)
 
-.. _math automatic alignment:
+Note that we use ``.load(scheduler="single-threaded")`` to execute the computation.
+This executes the Dask graph in `serial` using a for loop, but allows for printing to screen and other
+debugging techniques. We can easily see that our function is receiving blocks of shape 10x180x180 and
+the returned result is identical to ``ds.time`` as expected.
 
-Automatic alignment
-===================
 
-Xarray enforces alignment between *index* :ref:`coordinates` (that is,
-coordinates with the same name as a dimension, marked by ``*``) on objects used
-in binary operations.
-
-Similarly to pandas, this alignment is automatic for arithmetic on binary
-operations. The default result of a binary operation is by the *intersection*
-(not the union) of coordinate labels:
+Here is a common example where automated inference will not work.
 
 .. ipython:: python
+    :okexcept:
 
-    arr = xr.DataArray(np.arange(3), [("x", range(3))])
-    arr + arr[:-1]
+    def func(da):
+        print(da.sizes)
+        return da.isel(time=[1])
 
-If coordinate values for a dimension are missing on either argument, all
-matching dimensions must have the same size:
 
-.. ipython::
-    :verbatim:
+    mapped = xr.map_blocks(func, ds.temperature)
 
-    In [1]: arr + xr.DataArray([1, 2], dims="x")
-    ValueError: arguments without labels along dimension 'x' cannot be aligned because they have different dimension size(s) {2} than the size of the aligned dimension labels: 3
-
-
-However, one can explicitly change this default automatic alignment type ("inner")
-via :py:func:`~xarray.set_options()` in context manager:
-
-.. ipython:: python
-
-    with xr.set_options(arithmetic_join="outer"):
-        arr + arr[:1]
-    arr + arr[:1]
-
-Before loops or performance critical code, it's a good idea to align arrays
-explicitly (e.g., by putting them in the same Dataset or using
-:py:func:`~xarray.align`) to avoid the overhead of repeated alignment with each
-operation. See :ref:`align and reindex` for more details.
+``func`` cannot be run on 0-shaped inputs because it is not possible to extract element 1 along a
+dimension of size 0. In this case we need to tell :py:func:`map_blocks` what the returned result looks
+like using the ``template`` kwarg. ``template`` must be an xarray Dataset or DataArray (depending on
+what the function returns) with dimensions, shapes, chunk sizes, attributes, coordinate variables *and* data
+variables that look exactly like the expected result. The variables should be dask-backed and hence not
+incur much memory cost.
 
 .. note::
 
-    There is no automatic alignment between arguments when performing in-place
-    arithmetic operations such as ``+=``. You will need to use
-    :ref:`manual alignment<align and reindex>`. This ensures in-place
-    arithmetic never needs to modify data types.
+    Note that when ``template`` is provided, ``attrs`` from ``template`` are copied over to the result. Any
+    ``attrs`` set in ``func`` will be ignored.
 
-.. _coordinates math:
-
-Coordinates
-===========
-
-Although index coordinates are aligned, other coordinates are not, and if their
-values conflict, they will be dropped. This is necessary, for example, because
-indexing turns 1D coordinates into scalar coordinates:
 
 .. ipython:: python
 
-    arr[0]
-    arr[1]
-    # notice that the scalar coordinate 'x' is silently dropped
-    arr[1] - arr[0]
-
-Still, xarray will persist other coordinates in arithmetic, as long as there
-are no conflicting values:
-
-.. ipython:: python
+    template = ds.temperature.isel(time=[1, 11, 21])
+    mapped = xr.map_blocks(func, ds.temperature, template=template)
 
-    # only one argument has the 'x' coordinate
-    arr[0] + 1
-    # both arguments have the same 'x' coordinate
-    arr[0] - arr[0]
 
-Math with datasets
-==================
-
-Datasets support arithmetic operations by automatically looping over all data
-variables:
+Notice that the 0-shaped sizes were not printed to screen. Since ``template`` has been provided
+:py:func:`map_blocks` does not need to infer it by running ``func`` on 0-shaped inputs.
 
 .. ipython:: python
 
-    ds = xr.Dataset(
-        {
-            "x_and_y": (("x", "y"), np.random.randn(3, 5)),
-            "x_only": ("x", np.random.randn(3)),
-        },
-        coords=arr.coords,
-    )
-    ds > 0
-
-Datasets support most of the same methods found on data arrays:
+    mapped.identical(template)
 
-.. ipython:: python
 
-    ds.mean(dim="x")
-    abs(ds)
-
-Datasets also support NumPy ufuncs (requires NumPy v1.13 or newer), or
-alternatively you can use :py:meth:`~xarray.Dataset.map` to map a function
-to each variable in a dataset:
+:py:func:`map_blocks` also allows passing ``args`` and ``kwargs`` down to the user function ``func``.
+``func`` will be executed as ``func(block_xarray, *args, **kwargs)`` so ``args`` must be a list and ``kwargs`` must be a dictionary.
 
 .. ipython:: python
 
-    np.sin(ds)
-    ds.map(np.sin)
+    def func(obj, a, b=0):
+        return obj + a + b
 
-Datasets also use looping over variables for *broadcasting* in binary
-arithmetic. You can do arithmetic between any ``DataArray`` and a dataset:
 
-.. ipython:: python
+    mapped = ds.map_blocks(func, args=[10], kwargs={"b": 10})
+    expected = ds + 10 + 10
+    mapped.identical(expected)
 
-    ds + arr
+.. ipython:: python
+    :suppress:
 
-Arithmetic between two datasets matches data variables of the same name:
+    ds.close()  # Closes "example-data.nc".
+    os.remove("example-data.nc")
 
-.. ipython:: python
+.. tip::
 
-    ds2 = xr.Dataset({"x_and_y": 0, "x_only": 100})
-    ds - ds2
+   As :py:func:`map_blocks` loads each block into memory, reduce as much as possible objects consumed by user functions.
+   For example, drop useless variables before calling ``func`` with :py:func:`map_blocks`.
 
-Similarly to index based alignment, the result has the intersection of all
-matching data variables.
 
-.. _comput.wrapping-custom:
 
-Wrapping custom computation
-===========================
+Chunking and performance
+------------------------
 
-It doesn't always make sense to do computation directly with xarray objects:
+The ``chunks`` parameter has critical performance implications when using Dask
+arrays. If your chunks are too small, queueing up operations will be extremely
+slow, because Dask will translate each operation into a huge number of
+operations mapped across chunks. Computation on Dask arrays with small chunks
+can also be slow, because each operation on a chunk has some fixed overhead from
+the Python interpreter and the Dask task executor.
 
-  - In the inner loop of performance limited code, using xarray can add
-    considerable overhead compared to using NumPy or native Python types.
-    This is particularly true when working with scalars or small arrays (less
-    than ~1e6 elements). Keeping track of labels and ensuring their consistency
-    adds overhead, and xarray's core itself is not especially fast, because it's
-    written in Python rather than a compiled language like C. Also, xarray's
-    high level label-based APIs removes low-level control over how operations
-    are implemented.
-  - Even if speed doesn't matter, it can be important to wrap existing code, or
-    to support alternative interfaces that don't use xarray objects.
+Conversely, if your chunks are too big, some of your computation may be wasted,
+because Dask only computes results one chunk at a time.
 
-For these reasons, it is often well-advised to write low-level routines that
-work with NumPy arrays, and to wrap these routines to work with xarray objects.
-However, adding support for labels on both :py:class:`~xarray.Dataset` and
-:py:class:`~xarray.DataArray` can be a bit of a chore.
+A good rule of thumb is to create arrays with a minimum chunksize of at least
+one million elements (e.g., a 1000x1000 matrix). With large arrays (10+ GB), the
+cost of queueing up Dask operations can be noticeable, and you may need even
+larger chunksizes.
 
-To make this easier, xarray supplies the :py:func:`~xarray.apply_ufunc` helper
-function, designed for wrapping functions that support broadcasting and
-vectorization on unlabeled arrays in the style of a NumPy
-`universal function <https://numpy.org/doc/stable/reference/ufuncs.html>`_ ("ufunc" for short).
-``apply_ufunc`` takes care of everything needed for an idiomatic xarray wrapper,
-including alignment, broadcasting, looping over ``Dataset`` variables (if
-needed), and merging of coordinates. In fact, many internal xarray
-functions/methods are written using ``apply_ufunc``.
+.. tip::
 
-Simple functions that act independently on each value should work without
-any additional arguments:
+   Check out the `dask documentation on chunks <https://docs.dask.org/en/latest/array-chunks.html>`_.
 
-.. ipython:: python
 
-    squared_error = lambda x, y: (x - y) ** 2
-    arr1 = xr.DataArray([0, 1, 2, 3], dims="x")
-    xr.apply_ufunc(squared_error, arr1, 1)
+Optimization Tips
+-----------------
 
-For using more complex operations that consider some array values collectively,
-it's important to understand the idea of "core dimensions" from NumPy's
-`generalized ufuncs <https://numpy.org/doc/stable/reference/c-api/generalized-ufuncs.html>`_. Core dimensions are defined as dimensions
-that should *not* be broadcast over. Usually, they correspond to the fundamental
-dimensions over which an operation is defined, e.g., the summed axis in
-``np.sum``. A good clue that core dimensions are needed is the presence of an
-``axis`` argument on the corresponding NumPy function.
+With analysis pipelines involving both spatial subsetting and temporal resampling, Dask performance
+can become very slow or memory hungry in certain cases. Here are some optimization tips we have found
+through experience:
 
-With ``apply_ufunc``, core dimensions are recognized by name, and then moved to
-the last dimension of any input arguments before applying the given function.
-This means that for functions that accept an ``axis`` argument, you usually need
-to set ``axis=-1``. As an example, here is how we would wrap
-:py:func:`numpy.linalg.norm` to calculate the vector norm:
+1. Do your spatial and temporal indexing (e.g. ``.sel()`` or ``.isel()``) early in the pipeline, especially before calling ``resample()`` or ``groupby()``. Grouping and resampling triggers some computation on all the blocks, which in theory should commute with indexing, but this optimization hasn't been implemented in Dask yet. (See `Dask issue #746 <https://github.com/dask/dask/issues/746>`_).
 
-.. code-block:: python
+2. More generally, ``groupby()`` is a costly operation and will perform a lot better if the ``flox`` package is installed.
+   See the `flox documentation <https://flox.readthedocs.io>`_ for more. By default Xarray will use ``flox`` if installed.
 
-    def vector_norm(x, dim, ord=None):
-        return xr.apply_ufunc(
-            np.linalg.norm, x, input_core_dims=[[dim]], kwargs={"ord": ord, "axis": -1}
-        )
+3. Save intermediate results to disk as a netCDF files (using ``to_netcdf()``) and then load them again with ``open_dataset()`` for further computations. For example, if subtracting temporal mean from a dataset, save the temporal mean to disk before subtracting. Again, in theory, Dask should be able to do the computation in a streaming fashion, but in practice this is a fail case for the Dask scheduler, because it tries to keep every chunk of an array that it computes in memory. (See `Dask issue #874 <https://github.com/dask/dask/issues/874>`_)
 
-.. ipython:: python
-    :suppress:
+4. Specify smaller chunks across space when using :py:meth:`~xarray.open_mfdataset` (e.g., ``chunks={'latitude': 10, 'longitude': 10}``). This makes spatial subsetting easier, because there's no risk you will load subsets of data which span multiple chunks. On individual files, prefer to subset before chunking (suggestion 1).
 
-    def vector_norm(x, dim, ord=None):
-        return xr.apply_ufunc(
-            np.linalg.norm, x, input_core_dims=[[dim]], kwargs={"ord": ord, "axis": -1}
-        )
+5. Chunk as early as possible, and avoid rechunking as much as possible. Always pass the ``chunks={}`` argument to :py:func:`~xarray.open_mfdataset` to avoid redundant file reads.
 
-.. ipython:: python
+6. Using the h5netcdf package by passing ``engine='h5netcdf'`` to :py:meth:`~xarray.open_mfdataset` can be quicker than the default ``engine='netcdf4'`` that uses the netCDF4 package.
 
-    vector_norm(arr1, dim="x")
+7. Find `best practices specific to Dask arrays in the documentation <https://docs.dask.org/en/latest/array-best-practices.html>`_.
 
-Because ``apply_ufunc`` follows a standard convention for ufuncs, it plays
-nicely with tools for building vectorized functions, like
-:py:func:`numpy.broadcast_arrays` and :py:class:`numpy.vectorize`. For high performance
-needs, consider using :doc:`Numba's vectorize and guvectorize <numba:user/vectorize>`.
-
-In addition to wrapping functions, ``apply_ufunc`` can automatically parallelize
-many functions when using dask by setting ``dask='parallelized'``. See
-:ref:`dask.automatic-parallelization` for details.
-
-:py:func:`~xarray.apply_ufunc` also supports some advanced options for
-controlling alignment of variables and the form of the result. See the
-docstring for full details and more examples.
+8. The `dask diagnostics <https://docs.dask.org/en/latest/understanding-performance.html>`_ can be useful in identifying performance bottlenecks.
```

### Comparing `xarray-2023.3.0/doc/user-guide/dask.rst` & `xarray-2023.4.0/doc/getting-started-guide/faq.rst`

 * *Files 20% similar despite different names*

```diff
@@ -1,577 +1,440 @@
-.. currentmodule:: xarray
+.. _faq:
 
-.. _dask:
-
-Parallel computing with Dask
-============================
-
-Xarray integrates with `Dask <https://dask.org/>`__ to support parallel
-computations and streaming computation on datasets that don't fit into memory.
-Currently, Dask is an entirely optional feature for xarray. However, the
-benefits of using Dask are sufficiently strong that Dask may become a required
-dependency in a future version of xarray.
-
-For a full example of how to use xarray's Dask integration, read the
-`blog post introducing xarray and Dask`_. More up-to-date examples
-may be found at the `Pangeo project's gallery <http://gallery.pangeo.io/>`_
-and at the `Dask examples website <https://examples.dask.org/xarray.html>`_.
-
-.. _blog post introducing xarray and Dask: https://stephanhoyer.com/2015/06/11/xray-dask-out-of-core-labeled-arrays/
-
-What is a Dask array?
----------------------
-
-.. image:: ../_static/dask_array.png
-   :width: 40 %
-   :align: right
-   :alt: A Dask array
-
-Dask divides arrays into many small pieces, called *chunks*, each of which is
-presumed to be small enough to fit into memory.
-
-Unlike NumPy, which has eager evaluation, operations on Dask arrays are lazy.
-Operations queue up a series of tasks mapped over blocks, and no computation is
-performed until you actually ask values to be computed (e.g., to print results
-to your screen or write to disk). At that point, data is loaded into memory
-and computation proceeds in a streaming fashion, block-by-block.
-
-The actual computation is controlled by a multi-processing or thread pool,
-which allows Dask to take full advantage of multiple processors available on
-most modern computers.
-
-For more details, read the `Dask documentation <https://docs.dask.org/>`__.
-Note that xarray only makes use of ``dask.array`` and ``dask.delayed``.
-
-.. _dask.io:
-
-Reading and writing data
-------------------------
-
-The usual way to create a ``Dataset`` filled with Dask arrays is to load the
-data from a netCDF file or files. You can do this by supplying a ``chunks``
-argument to :py:func:`~xarray.open_dataset` or using the
-:py:func:`~xarray.open_mfdataset` function.
+Frequently Asked Questions
+==========================
 
 .. ipython:: python
     :suppress:
 
-    import os
-
     import numpy as np
     import pandas as pd
     import xarray as xr
 
     np.random.seed(123456)
-    np.set_printoptions(precision=3, linewidth=100, threshold=100, edgeitems=3)
-
-    ds = xr.Dataset(
-        {
-            "temperature": (
-                ("time", "latitude", "longitude"),
-                np.random.randn(30, 180, 180),
-            ),
-            "time": pd.date_range("2015-01-01", periods=30),
-            "longitude": np.arange(180),
-            "latitude": np.arange(89.5, -90.5, -1),
-        }
-    )
-    ds.to_netcdf("example-data.nc")
-
-.. ipython:: python
-
-    ds = xr.open_dataset("example-data.nc", chunks={"time": 10})
-    ds
 
-In this example ``latitude`` and ``longitude`` do not appear in the ``chunks``
-dict, so only one chunk will be used along those dimensions.  It is also
-entirely equivalent to opening a dataset using :py:func:`~xarray.open_dataset`
-and then chunking the data using the ``chunk`` method, e.g.,
-``xr.open_dataset('example-data.nc').chunk({'time': 10})``.
-
-To open multiple files simultaneously in parallel using Dask delayed,
-use :py:func:`~xarray.open_mfdataset`::
-
-    xr.open_mfdataset('my/files/*.nc', parallel=True)
-
-This function will automatically concatenate and merge datasets into one in
-the simple cases that it understands (see :py:func:`~xarray.combine_by_coords`
-for the full disclaimer). By default, :py:func:`~xarray.open_mfdataset` will chunk each
-netCDF file into a single Dask array; again, supply the ``chunks`` argument to
-control the size of the resulting Dask arrays. In more complex cases, you can
-open each file individually using :py:func:`~xarray.open_dataset` and merge the result, as
-described in :ref:`combining data`. Passing the keyword argument ``parallel=True`` to
-:py:func:`~xarray.open_mfdataset` will speed up the reading of large multi-file datasets by
-executing those read tasks in parallel using ``dask.delayed``.
-
-.. warning::
-
-    :py:func:`~xarray.open_mfdataset` called without ``chunks`` argument will return
-    dask arrays with chunk sizes equal to the individual files. Re-chunking
-    the dataset after creation with ``ds.chunk()`` will lead to an ineffective use of
-    memory and is not recommended.
-
-You'll notice that printing a dataset still shows a preview of array values,
-even if they are actually Dask arrays. We can do this quickly with Dask because
-we only need to compute the first few values (typically from the first block).
-To reveal the true nature of an array, print a DataArray:
 
-.. ipython:: python
-
-    ds.temperature
+Your documentation keeps mentioning pandas. What is pandas?
+-----------------------------------------------------------
 
-Once you've manipulated a Dask array, you can still write a dataset too big to
-fit into memory back to disk by using :py:meth:`~xarray.Dataset.to_netcdf` in the
-usual way.
+pandas_ is a very popular data analysis package in Python
+with wide usage in many fields. Our API is heavily inspired by pandas —
+this is why there are so many references to pandas.
 
-.. ipython:: python
+.. _pandas: https://pandas.pydata.org
 
-    ds.to_netcdf("manipulated-example-data.nc")
 
-By setting the ``compute`` argument to ``False``, :py:meth:`~xarray.Dataset.to_netcdf`
-will return a ``dask.delayed`` object that can be computed later.
+Do I need to know pandas to use xarray?
+---------------------------------------
 
-.. ipython:: python
+No! Our API is heavily inspired by pandas so while knowing pandas will let you
+become productive more quickly, knowledge of pandas is not necessary to use xarray.
 
-    from dask.diagnostics import ProgressBar
 
-    # or distributed.progress when using the distributed scheduler
-    delayed_obj = ds.to_netcdf("manipulated-example-data.nc", compute=False)
-    with ProgressBar():
-        results = delayed_obj.compute()
+Should I use xarray instead of pandas?
+--------------------------------------
 
-.. ipython:: python
-    :suppress:
+It's not an either/or choice! xarray provides robust support for converting
+back and forth between the tabular data-structures of pandas and its own
+multi-dimensional data-structures.
 
-    os.remove("manipulated-example-data.nc")  # Was not opened.
+That said, you should only bother with xarray if some aspect of data is
+fundamentally multi-dimensional. If your data is unstructured or
+one-dimensional, pandas is usually the right choice: it has better performance
+for common operations such as ``groupby`` and you'll find far more usage
+examples online.
 
-.. note::
 
-    When using Dask's distributed scheduler to write NETCDF4 files,
-    it may be necessary to set the environment variable `HDF5_USE_FILE_LOCKING=FALSE`
-    to avoid competing locks within the HDF5 SWMR file locking scheme. Note that
-    writing netCDF files with Dask's distributed scheduler is only supported for
-    the `netcdf4` backend.
+Why is pandas not enough?
+-------------------------
 
-A dataset can also be converted to a Dask DataFrame using :py:meth:`~xarray.Dataset.to_dask_dataframe`.
+pandas is a fantastic library for analysis of low-dimensional labelled data -
+if it can be sensibly described as "rows and columns", pandas is probably the
+right choice.  However, sometimes we want to use higher dimensional arrays
+(`ndim > 2`), or arrays for which the order of dimensions (e.g., columns vs
+rows) shouldn't really matter. For example, the images of a movie can be
+natively represented as an array with four dimensions: time, row, column and
+color.
 
-.. ipython:: python
-    :okwarning:
+pandas has historically supported N-dimensional panels, but deprecated them in
+version 0.20 in favor of xarray data structures. There are now built-in methods
+on both sides to convert between pandas and xarray, allowing for more focused
+development effort. Xarray objects have a much richer model of dimensionality -
+if you were using Panels:
 
-    df = ds.to_dask_dataframe()
-    df
+- You need to create a new factory type for each dimensionality.
+- You can't do math between NDPanels with different dimensionality.
+- Each dimension in a NDPanel has a name (e.g., 'labels', 'items',
+  'major_axis', etc.) but the dimension names refer to order, not their
+  meaning. You can't specify an operation as to be applied along the "time"
+  axis.
+- You often have to manually convert collections of pandas arrays
+  (Series, DataFrames, etc) to have the same number of dimensions.
+  In contrast, this sort of data structure fits very naturally in an
+  xarray ``Dataset``.
 
-Dask DataFrames do not support multi-indexes so the coordinate variables from the dataset are included as columns in the Dask DataFrame.
+You can :ref:`read about switching from Panels to xarray here <panel transition>`.
+pandas gets a lot of things right, but many science, engineering and complex
+analytics use cases need fully multi-dimensional data structures.
 
+How do xarray data structures differ from those found in pandas?
+----------------------------------------------------------------
 
-Using Dask with xarray
-----------------------
+The main distinguishing feature of xarray's ``DataArray`` over labeled arrays in
+pandas is that dimensions can have names (e.g., "time", "latitude",
+"longitude"). Names are much easier to keep track of than axis numbers, and
+xarray uses dimension names for indexing, aggregation and broadcasting. Not only
+can you write ``x.sel(time='2000-01-01')`` and  ``x.mean(dim='time')``, but
+operations like ``x - x.mean(dim='time')`` always work, no matter the order
+of the "time" dimension. You never need to reshape arrays (e.g., with
+``np.newaxis``) to align them for arithmetic operations in xarray.
 
-Nearly all existing xarray methods (including those for indexing, computation,
-concatenating and grouped operations) have been extended to work automatically
-with Dask arrays. When you load data as a Dask array in an xarray data
-structure, almost all xarray operations will keep it as a Dask array; when this
-is not possible, they will raise an exception rather than unexpectedly loading
-data into memory. Converting a Dask array into memory generally requires an
-explicit conversion step. One notable exception is indexing operations: to
-enable label based indexing, xarray will automatically load coordinate labels
-into memory.
 
-.. tip::
+Why don't aggregations return Python scalars?
+---------------------------------------------
 
-   By default, dask uses its multi-threaded scheduler, which distributes work across
-   multiple cores and allows for processing some datasets that do not fit into memory.
-   For running across a cluster, `setup the distributed scheduler <https://docs.dask.org/en/latest/setup.html>`_.
+Xarray tries hard to be self-consistent: operations on a ``DataArray`` (resp.
+``Dataset``) return another ``DataArray`` (resp. ``Dataset``) object. In
+particular, operations returning scalar values (e.g. indexing or aggregations
+like ``mean`` or ``sum`` applied to all axes) will also return xarray objects.
 
-The easiest way to convert an xarray data structure from lazy Dask arrays into
-*eager*, in-memory NumPy arrays is to use the :py:meth:`~xarray.Dataset.load` method:
+Unfortunately, this means we sometimes have to explicitly cast our results from
+xarray when using them in other libraries. As an illustration, the following
+code fragment
 
 .. ipython:: python
 
-    ds.load()
+    arr = xr.DataArray([1, 2, 3])
+    pd.Series({"x": arr[0], "mean": arr.mean(), "std": arr.std()})
 
-You can also access :py:attr:`~xarray.DataArray.values`, which will always be a
-NumPy array:
+does not yield the pandas DataFrame we expected. We need to specify the type
+conversion ourselves:
 
-.. ipython::
-    :verbatim:
+.. ipython:: python
 
-    In [5]: ds.temperature.values
-    Out[5]:
-    array([[[  4.691e-01,  -2.829e-01, ...,  -5.577e-01,   3.814e-01],
-            [  1.337e+00,  -1.531e+00, ...,   8.726e-01,  -1.538e+00],
-            ...
-    # truncated for brevity
-
-Explicit conversion by wrapping a DataArray with ``np.asarray`` also works:
-
-.. ipython::
-    :verbatim:
-
-    In [5]: np.asarray(ds.temperature)
-    Out[5]:
-    array([[[  4.691e-01,  -2.829e-01, ...,  -5.577e-01,   3.814e-01],
-            [  1.337e+00,  -1.531e+00, ...,   8.726e-01,  -1.538e+00],
-            ...
+    pd.Series({"x": arr[0], "mean": arr.mean(), "std": arr.std()}, dtype=float)
 
-Alternatively you can load the data into memory but keep the arrays as
-Dask arrays using the :py:meth:`~xarray.Dataset.persist` method:
+Alternatively, we could use the ``item`` method or the ``float`` constructor to
+convert values one at a time
 
 .. ipython:: python
 
-    persisted = ds.persist()
-
-:py:meth:`~xarray.Dataset.persist` is particularly useful when using a
-distributed cluster because the data will be loaded into distributed memory
-across your machines and be much faster to use than reading repeatedly from
-disk.
+    pd.Series({"x": arr[0].item(), "mean": float(arr.mean())})
 
-.. warning::
 
-   On a single machine :py:meth:`~xarray.Dataset.persist` will try to load all of
-   your data into memory. You should make sure that your dataset is not larger than
-   available memory.
+.. _approach to metadata:
 
-.. note::
+What is your approach to metadata?
+----------------------------------
 
-   For more on the differences between :py:meth:`~xarray.Dataset.persist` and
-   :py:meth:`~xarray.Dataset.compute` see this `Stack Overflow answer on the differences between client persist and client compute <https://stackoverflow.com/questions/41806850/dask-difference-between-client-persist-and-client-compute>`_ and the `Dask documentation <https://distributed.dask.org/en/latest/manage-computation.html#dask-collections-to-futures>`_.
+We are firm believers in the power of labeled data! In addition to dimensions
+and coordinates, xarray supports arbitrary metadata in the form of global
+(Dataset) and variable specific (DataArray) attributes (``attrs``).
 
-For performance you may wish to consider chunk sizes.  The correct choice of
-chunk size depends both on your data and on the operations you want to perform.
-With xarray, both converting data to a Dask arrays and converting the chunk
-sizes of Dask arrays is done with the :py:meth:`~xarray.Dataset.chunk` method:
+Automatic interpretation of labels is powerful but also reduces flexibility.
+With xarray, we draw a firm line between labels that the library understands
+(``dims`` and ``coords``) and labels for users and user code (``attrs``). For
+example, we do not automatically interpret and enforce units or `CF
+conventions`_. (An exception is serialization to and from netCDF files.)
 
-.. ipython:: python
+.. _CF conventions: https://cfconventions.org/latest.html
 
-    rechunked = ds.chunk({"latitude": 100, "longitude": 100})
+An implication of this choice is that we do not propagate ``attrs`` through
+most operations unless explicitly flagged (some methods have a ``keep_attrs``
+option, and there is a global flag, accessible with :py:func:`xarray.set_options`,
+for setting this to be always True or False). Similarly, xarray does not check
+for conflicts between ``attrs`` when combining arrays and datasets, unless
+explicitly requested with the option ``compat='identical'``. The guiding
+principle is that metadata should not be allowed to get in the way.
 
-.. warning::
+What other netCDF related Python libraries should I know about?
+---------------------------------------------------------------
 
-    Rechunking an existing dask array created with :py:func:`~xarray.open_mfdataset`
-    is not recommended (see above).
+`netCDF4-python`__ provides a lower level interface for working with
+netCDF and OpenDAP datasets in Python. We use netCDF4-python internally in
+xarray, and have contributed a number of improvements and fixes upstream. Xarray
+does not yet support all of netCDF4-python's features, such as modifying files
+on-disk.
 
-You can view the size of existing chunks on an array by viewing the
-:py:attr:`~xarray.Dataset.chunks` attribute:
+__ https://unidata.github.io/netcdf4-python/
 
-.. ipython:: python
+Iris_ (supported by the UK Met office) provides similar tools for in-
+memory manipulation of labeled arrays, aimed specifically at weather and
+climate data needs. Indeed, the Iris :py:class:`~iris.cube.Cube` was direct
+inspiration for xarray's :py:class:`~xarray.DataArray`. Xarray and Iris take very
+different approaches to handling metadata: Iris strictly interprets
+`CF conventions`_. Iris particularly shines at mapping, thanks to its
+integration with Cartopy_.
 
-    rechunked.chunks
+.. _Iris: https://scitools-iris.readthedocs.io/en/stable/
+.. _Cartopy: https://scitools.org.uk/cartopy/docs/latest/
 
-If there are not consistent chunksizes between all the arrays in a dataset
-along a particular dimension, an exception is raised when you try to access
-``.chunks``.
+`UV-CDAT`__ is another Python library that implements in-memory netCDF-like
+variables and `tools for working with climate data`__.
 
-.. note::
+__ https://uvcdat.llnl.gov/
+__ https://drclimate.wordpress.com/2014/01/02/a-beginners-guide-to-scripting-with-uv-cdat/
 
-    In the future, we would like to enable automatic alignment of Dask
-    chunksizes (but not the other way around). We might also require that all
-    arrays in a dataset share the same chunking alignment. Neither of these
-    are currently done.
+We think the design decisions we have made for xarray (namely, basing it on
+pandas) make it a faster and more flexible data analysis tool. That said, Iris
+and CDAT have some great domain specific functionality, and xarray includes
+methods for converting back and forth between xarray and these libraries. See
+:py:meth:`~xarray.DataArray.to_iris` and :py:meth:`~xarray.DataArray.to_cdms2`
+for more details.
 
-NumPy ufuncs like ``np.sin`` transparently work on all xarray objects, including those
-that store lazy Dask arrays:
+What other projects leverage xarray?
+------------------------------------
 
-.. ipython:: python
+See section :ref:`ecosystem`.
 
-    import numpy as np
+How do I open format X file as an xarray dataset?
+-------------------------------------------------
 
-    np.sin(rechunked)
+To open format X file in xarray, you need to know the `format of the data <https://docs.xarray.dev/en/stable/user-guide/io.html#csv-and-other-formats-supported-by-pandas/>`_ you want to read. If the format is supported, you can use the appropriate function provided by xarray. The following table provides functions used for different file formats in xarray, as well as links to other packages that can be used:
 
-To access Dask arrays directly, use the
-:py:attr:`DataArray.data <xarray.DataArray.data>` attribute. This attribute exposes
-array data either as a Dask array or as a NumPy array, depending on whether it has been
-loaded into Dask or not:
+.. csv-table::
+   :header: "File Format", "Open via", " Related Packages"
+   :widths: 15, 45, 15
 
-.. ipython:: python
+   "NetCDF (.nc, .nc4, .cdf)","``open_dataset()`` OR ``open_mfdataset()``", "`netCDF4 <https://pypi.org/project/netCDF4/>`_, `netcdf <https://pypi.org/project/netcdf/>`_ , `cdms2 <https://cdms.readthedocs.io/en/latest/cdms2.html>`_"
+   "HDF5 (.h5, .hdf5)","``open_dataset()`` OR ``open_mfdataset()``", "`h5py <https://www.h5py.org/>`_, `pytables <https://www.pytables.org/>`_ "
+   "GRIB (.grb, .grib)", "``open_dataset()``", "`cfgrib <https://pypi.org/project/cfgrib/>`_, `pygrib <https://pypi.org/project/pygrib/>`_"
+   "CSV (.csv)","``open_dataset()``", "`pandas`_ , `dask <https://www.dask.org/>`_"
+   "Zarr (.zarr)","``open_dataset()`` OR ``open_mfdataset()``", "`zarr <https://pypi.org/project/zarr/>`_ , `dask <https://www.dask.org/>`_ "
 
-    ds.temperature.data
+.. _pandas: https://pandas.pydata.org
 
-.. note::
+If you are unable to open a file in xarray:
 
-    ``.data`` is also used to expose other "computable" array backends beyond Dask and
-    NumPy (e.g. sparse and pint arrays).
+- You should check that you are having all necessary dependencies installed, including any optional dependencies (like scipy, h5netcdf, cfgrib etc as mentioned below) that may be required for the specific use case.
 
-.. _dask.automatic-parallelization:
+- If all necessary dependencies are installed but the file still cannot be opened, you must check if there are any specialized backends available for the specific file format you are working with. You can consult the xarray documentation or the documentation for the file format to determine if a specialized backend is required, and if so, how to install and use it with xarray.
 
-Automatic parallelization with ``apply_ufunc`` and ``map_blocks``
------------------------------------------------------------------
+- If the file format is not supported by xarray or any of its available backends, the user may need to use a different library or tool to work with the file. You can consult the documentation for the file format to determine which tools are recommended for working with it.
 
-Almost all of xarray's built-in operations work on Dask arrays. If you want to
-use a function that isn't wrapped by xarray, and have it applied in parallel on
-each block of your xarray object, you have three options:
+Xarray provides a default engine to read files, which is usually determined by the file extension or type. If you don't specify the engine, xarray will try to guess it based on the file extension or type, and may fall back to a different engine if it cannot determine the correct one.
 
-1. Extract Dask arrays from xarray objects (``.data``) and use Dask directly.
-2. Use :py:func:`~xarray.apply_ufunc` to apply functions that consume and return NumPy arrays.
-3. Use :py:func:`~xarray.map_blocks`, :py:meth:`Dataset.map_blocks` or :py:meth:`DataArray.map_blocks`
-   to apply functions that consume and return xarray objects.
+Therefore, it's good practice to always specify the engine explicitly, to ensure that the correct backend is used and especially when working with complex data formats or non-standard file extensions.
 
+:py:func:`xarray.backends.list_engines` is a function in xarray that returns a dictionary of available engines and their BackendEntrypoint objects.
 
-``apply_ufunc``
-~~~~~~~~~~~~~~~
+You can use the `engine` argument to specify the backend when calling ``open_dataset()`` or other reading functions in xarray, as shown below:
 
-:py:func:`~xarray.apply_ufunc` automates `embarrassingly parallel
-<https://en.wikipedia.org/wiki/Embarrassingly_parallel>`__ "map" type operations
-where a function written for processing NumPy arrays should be repeatedly
-applied to xarray objects containing Dask arrays. It works similarly to
-:py:func:`dask.array.map_blocks` and :py:func:`dask.array.blockwise`, but without
-requiring an intermediate layer of abstraction.
+NetCDF
+~~~~~~
+If you are reading a netCDF file with a ".nc" extension, the default engine is `netcdf4`. However if you have files with non-standard extensions or if the file format is ambiguous. Specify the engine explicitly, to ensure that the correct backend is used.
 
-For the best performance when using Dask's multi-threaded scheduler, wrap a
-function that already releases the global interpreter lock, which fortunately
-already includes most NumPy and Scipy functions. Here we show an example
-using NumPy operations and a fast function from
-`bottleneck <https://github.com/pydata/bottleneck>`__, which
-we use to calculate `Spearman's rank-correlation coefficient <https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient>`__:
+Use :py:func:`~xarray.open_dataset` to open a NetCDF file and return an xarray Dataset object.
 
-.. code-block:: python
+.. code:: python
 
-    import numpy as np
     import xarray as xr
-    import bottleneck
 
+    # use xarray to open the file and return an xarray.Dataset object using netcdf4 engine
 
-    def covariance_gufunc(x, y):
-        return (
-            (x - x.mean(axis=-1, keepdims=True)) * (y - y.mean(axis=-1, keepdims=True))
-        ).mean(axis=-1)
+    ds = xr.open_dataset("/path/to/my/file.nc", engine="netcdf4")
 
+    # Print Dataset object
 
-    def pearson_correlation_gufunc(x, y):
-        return covariance_gufunc(x, y) / (x.std(axis=-1) * y.std(axis=-1))
+    print(ds)
 
+    # use xarray to open the file and return an xarray.Dataset object using scipy engine
 
-    def spearman_correlation_gufunc(x, y):
-        x_ranks = bottleneck.rankdata(x, axis=-1)
-        y_ranks = bottleneck.rankdata(y, axis=-1)
-        return pearson_correlation_gufunc(x_ranks, y_ranks)
+    ds = xr.open_dataset("/path/to/my/file.nc", engine="scipy")
 
+We recommend installing `scipy` via conda using the below given code:
 
-    def spearman_correlation(x, y, dim):
-        return xr.apply_ufunc(
-            spearman_correlation_gufunc,
-            x,
-            y,
-            input_core_dims=[[dim], [dim]],
-            dask="parallelized",
-            output_dtypes=[float],
-        )
+::
 
-The only aspect of this example that is different from standard usage of
-``apply_ufunc()`` is that we needed to supply the ``output_dtypes`` arguments.
-(Read up on :ref:`comput.wrapping-custom` for an explanation of the
-"core dimensions" listed in ``input_core_dims``.)
+    conda install scipy
 
-Our new ``spearman_correlation()`` function achieves near linear speedup
-when run on large arrays across the four cores on my laptop. It would also
-work as a streaming operation, when run on arrays loaded from disk:
+HDF5
+~~~~
+Use :py:func:`~xarray.open_dataset` to open an HDF5 file and return an xarray Dataset object.
 
-.. ipython::
-    :verbatim:
+You should specify the `engine` keyword argument when reading HDF5 files with xarray, as there are multiple backends that can be used to read HDF5 files, and xarray may not always be able to automatically detect the correct one based on the file extension or file format.
 
-    In [56]: rs = np.random.RandomState(0)
+To read HDF5 files with xarray, you can use the :py:func:`~xarray.open_dataset` function from the `h5netcdf` backend, as follows:
 
-    In [57]: array1 = xr.DataArray(rs.randn(1000, 100000), dims=["place", "time"])  # 800MB
+.. code:: python
 
-    In [58]: array2 = array1 + 0.5 * rs.randn(1000, 100000)
-
-    # using one core, on NumPy arrays
-    In [61]: %time _ = spearman_correlation(array1, array2, 'time')
-    CPU times: user 21.6 s, sys: 2.84 s, total: 24.5 s
-    Wall time: 24.9 s
+    import xarray as xr
 
-    In [8]: chunked1 = array1.chunk({"place": 10})
+    # Open HDF5 file as an xarray Dataset
 
-    In [9]: chunked2 = array2.chunk({"place": 10})
+    ds = xr.open_dataset("path/to/hdf5/file.hdf5", engine="h5netcdf")
 
-    # using all my laptop's cores, with Dask
-    In [63]: r = spearman_correlation(chunked1, chunked2, "time").compute()
+    # Print Dataset object
 
-    In [64]: %time _ = r.compute()
-    CPU times: user 30.9 s, sys: 1.74 s, total: 32.6 s
-    Wall time: 4.59 s
+    print(ds)
 
-One limitation of ``apply_ufunc()`` is that it cannot be applied to arrays with
-multiple chunks along a core dimension:
+We recommend you to install `h5netcdf` library using the below given code:
 
-.. ipython::
-    :verbatim:
+::
 
-    In [63]: spearman_correlation(chunked1, chunked2, "place")
-    ValueError: dimension 'place' on 0th function argument to apply_ufunc with
-    dask='parallelized' consists of multiple chunks, but is also a core
-    dimension. To fix, rechunk into a single Dask array chunk along this
-    dimension, i.e., ``.rechunk({'place': -1})``, but beware that this may
-    significantly increase memory usage.
+    conda install -c conda-forge h5netcdf
 
-This reflects the nature of core dimensions, in contrast to broadcast (non-core)
-dimensions that allow operations to be split into arbitrary chunks for
-application.
+If you want to use the `netCDF4` backend to read a file with a ".h5" extension (which is typically associated with HDF5 file format), you can specify the engine argument as follows:
 
-.. tip::
+.. code:: python
 
-    For the majority of NumPy functions that are already wrapped by Dask, it's
-    usually a better idea to use the pre-existing ``dask.array`` function, by
-    using either a pre-existing xarray methods or
-    :py:func:`~xarray.apply_ufunc()` with ``dask='allowed'``. Dask can often
-    have a more efficient implementation that makes use of the specialized
-    structure of a problem, unlike the generic speedups offered by
-    ``dask='parallelized'``.
+    ds = xr.open_dataset("path/to/file.h5", engine="netcdf4")
 
+GRIB
+~~~~
+You should specify the `engine` keyword argument when reading GRIB files with xarray, as there are multiple backends that can be used to read GRIB files, and xarray may not always be able to automatically detect the correct one based on the file extension or file format.
 
-``map_blocks``
-~~~~~~~~~~~~~~
+Use the :py:func:`~xarray.open_dataset` function from the `cfgrib` package to open a GRIB file as an xarray Dataset.
 
-Functions that consume and return xarray objects can be easily applied in parallel using :py:func:`map_blocks`.
-Your function will receive an xarray Dataset or DataArray subset to one chunk
-along each chunked dimension.
+.. code:: python
 
-.. ipython:: python
+    import xarray as xr
 
-    ds.temperature
+    # define the path to your GRIB file and the engine you want to use to open the file
+    # use ``open_dataset()`` to open the file with the specified engine and return an xarray.Dataset object
 
-This DataArray has 3 chunks each with length 10 along the time dimension.
-At compute time, a function applied with :py:func:`map_blocks` will receive a DataArray corresponding to a single block of shape 10x180x180
-(time x latitude x longitude) with values loaded. The following snippet illustrates how to check the shape of the object
-received by the applied function.
+    ds = xr.open_dataset("path/to/your/file.grib", engine="cfgrib")
 
-.. ipython:: python
+    # Print Dataset object
 
-    def func(da):
-        print(da.sizes)
-        return da.time
-
-
-    mapped = xr.map_blocks(func, ds.temperature)
-    mapped
-
-Notice that the :py:meth:`map_blocks` call printed
-``Frozen({'time': 0, 'latitude': 0, 'longitude': 0})`` to screen.
-``func`` is received 0-sized blocks! :py:meth:`map_blocks` needs to know what the final result
-looks like in terms of dimensions, shapes etc. It does so by running the provided function on 0-shaped
-inputs (*automated inference*). This works in many cases, but not all. If automatic inference does not
-work for your function, provide the ``template`` kwarg (see below).
+    print(ds)
 
-In this case, automatic inference has worked so let's check that the result is as expected.
+We recommend installing `cfgrib` via conda using the below given code:
 
-.. ipython:: python
+::
 
-    mapped.load(scheduler="single-threaded")
-    mapped.identical(ds.time)
+    conda install -c conda-forge cfgrib
 
-Note that we use ``.load(scheduler="single-threaded")`` to execute the computation.
-This executes the Dask graph in `serial` using a for loop, but allows for printing to screen and other
-debugging techniques. We can easily see that our function is receiving blocks of shape 10x180x180 and
-the returned result is identical to ``ds.time`` as expected.
+CSV
+~~~
+By default, xarray uses the built-in `pandas` library to read CSV files. In general, you don't need to specify the engine keyword argument when reading CSV files with xarray, as the default `pandas` engine is usually sufficient for most use cases. If you are working with very large CSV files or if you need to perform certain types of data processing that are not supported by the default `pandas` engine, you may want to use a different backend.
+In such cases, you can specify the engine argument when reading the CSV file with xarray.
 
+To read CSV files with xarray, use the :py:func:`~xarray.open_dataset` function and specify the path to the CSV file as follows:
 
-Here is a common example where automated inference will not work.
+.. code:: python
 
-.. ipython:: python
-    :okexcept:
+    import xarray as xr
+    import pandas as pd
 
-    def func(da):
-        print(da.sizes)
-        return da.isel(time=[1])
+    # Load CSV file into pandas DataFrame using the "c" engine
 
+    df = pd.read_csv("your_file.csv", engine="c")
 
-    mapped = xr.map_blocks(func, ds.temperature)
+    # Convert `:py:func:pandas` DataFrame to xarray.Dataset
 
-``func`` cannot be run on 0-shaped inputs because it is not possible to extract element 1 along a
-dimension of size 0. In this case we need to tell :py:func:`map_blocks` what the returned result looks
-like using the ``template`` kwarg. ``template`` must be an xarray Dataset or DataArray (depending on
-what the function returns) with dimensions, shapes, chunk sizes, attributes, coordinate variables *and* data
-variables that look exactly like the expected result. The variables should be dask-backed and hence not
-incur much memory cost.
+    ds = xr.Dataset.from_dataframe(df)
 
-.. note::
+    # Prints the resulting xarray dataset
 
-    Note that when ``template`` is provided, ``attrs`` from ``template`` are copied over to the result. Any
-    ``attrs`` set in ``func`` will be ignored.
+    print(ds)
 
+Zarr
+~~~~
+When opening a Zarr dataset with xarray, the `engine` is automatically detected based on the file extension or the type of input provided. If the dataset is stored in a directory with a ".zarr" extension, xarray will automatically use the "zarr" engine.
 
-.. ipython:: python
+To read zarr files with xarray, use the :py:func:`~xarray.open_dataset` function and specify the path to the zarr file as follows:
 
-    template = ds.temperature.isel(time=[1, 11, 21])
-    mapped = xr.map_blocks(func, ds.temperature, template=template)
+.. code:: python
 
+    import xarray as xr
 
-Notice that the 0-shaped sizes were not printed to screen. Since ``template`` has been provided
-:py:func:`map_blocks` does not need to infer it by running ``func`` on 0-shaped inputs.
+    # use xarray to open the file and return an xarray.Dataset object using zarr engine
 
-.. ipython:: python
+    ds = xr.open_dataset("path/to/your/file.zarr", engine="zarr")
 
-    mapped.identical(template)
+    # Print Dataset object
 
+    print(ds)
 
-:py:func:`map_blocks` also allows passing ``args`` and ``kwargs`` down to the user function ``func``.
-``func`` will be executed as ``func(block_xarray, *args, **kwargs)`` so ``args`` must be a list and ``kwargs`` must be a dictionary.
+We recommend installing `zarr` via conda using the below given code:
 
-.. ipython:: python
+::
 
-    def func(obj, a, b=0):
-        return obj + a + b
+    conda install -c conda-forge zarr
 
+There may be situations where you need to specify the engine manually using the `engine` keyword argument. For example, if you have a Zarr dataset stored in a file with a different extension (e.g., ".npy"), you will need to specify the engine as "zarr" explicitly when opening the dataset.
 
-    mapped = ds.map_blocks(func, args=[10], kwargs={"b": 10})
-    expected = ds + 10 + 10
-    mapped.identical(expected)
+Some packages may have additional functionality beyond what is shown here. You can refer to the documentation for each package for more information.
 
-.. ipython:: python
-    :suppress:
+How does xarray handle missing values?
+--------------------------------------
 
-    ds.close()  # Closes "example-data.nc".
-    os.remove("example-data.nc")
+**xarray can handle missing values using ``np.NaN``**
 
-.. tip::
+- ``np.NaN`` is  used to represent missing values in labeled arrays and datasets. It is a commonly used standard for representing missing or undefined numerical data in scientific computing. ``np.NaN`` is a constant value in NumPy that represents "Not a Number" or missing values.
 
-   As :py:func:`map_blocks` loads each block into memory, reduce as much as possible objects consumed by user functions.
-   For example, drop useless variables before calling ``func`` with :py:func:`map_blocks`.
+- Most of xarray's computation methods are designed to automatically handle missing values appropriately.
 
+  For example, when performing operations like addition or multiplication on arrays that contain missing values, xarray will automatically ignore the missing values and only perform the operation on the valid data. This makes it easy to work with data that may contain missing or undefined values without having to worry about handling them explicitly.
 
+- Many of xarray's `aggregation methods <https://docs.xarray.dev/en/stable/user-guide/computation.html#aggregation>`_, such as ``sum()``, ``mean()``, ``min()``, ``max()``, and others, have a skipna argument that controls whether missing values (represented by NaN) should be skipped (True) or treated as NaN (False) when performing the calculation.
 
-Chunking and performance
-------------------------
+  By default, ``skipna`` is set to `True`, so missing values are ignored when computing the result. However, you can set ``skipna`` to `False` if you want missing values to be treated as NaN and included in the calculation.
 
-The ``chunks`` parameter has critical performance implications when using Dask
-arrays. If your chunks are too small, queueing up operations will be extremely
-slow, because Dask will translate each operation into a huge number of
-operations mapped across chunks. Computation on Dask arrays with small chunks
-can also be slow, because each operation on a chunk has some fixed overhead from
-the Python interpreter and the Dask task executor.
+- On `plotting <https://docs.xarray.dev/en/stable/user-guide/plotting.html#missing-values>`_ an xarray dataset or array that contains missing values, xarray will simply leave the missing values as blank spaces in the plot.
 
-Conversely, if your chunks are too big, some of your computation may be wasted,
-because Dask only computes results one chunk at a time.
+- We have a set of `methods <https://docs.xarray.dev/en/stable/user-guide/computation.html#missing-values>`_ for manipulating missing and filling values.
 
-A good rule of thumb is to create arrays with a minimum chunksize of at least
-one million elements (e.g., a 1000x1000 matrix). With large arrays (10+ GB), the
-cost of queueing up Dask operations can be noticeable, and you may need even
-larger chunksizes.
+How should I cite xarray?
+-------------------------
 
-.. tip::
+If you are using xarray and would like to cite it in academic publication, we
+would certainly appreciate it. We recommend two citations.
 
-   Check out the `dask documentation on chunks <https://docs.dask.org/en/latest/array-chunks.html>`_.
+  1. At a minimum, we recommend citing the xarray overview journal article,
+     published in the Journal of Open Research Software.
 
+     - Hoyer, S. & Hamman, J., (2017). xarray: N-D labeled Arrays and
+       Datasets in Python. Journal of Open Research Software. 5(1), p.10.
+       DOI: https://doi.org/10.5334/jors.148
 
-Optimization Tips
------------------
+       Here’s an example of a BibTeX entry::
 
-With analysis pipelines involving both spatial subsetting and temporal resampling, Dask performance
-can become very slow or memory hungry in certain cases. Here are some optimization tips we have found
-through experience:
+           @article{hoyer2017xarray,
+             title     = {xarray: {N-D} labeled arrays and datasets in {Python}},
+             author    = {Hoyer, S. and J. Hamman},
+             journal   = {Journal of Open Research Software},
+             volume    = {5},
+             number    = {1},
+             year      = {2017},
+             publisher = {Ubiquity Press},
+             doi       = {10.5334/jors.148},
+             url       = {https://doi.org/10.5334/jors.148}
+           }
 
-1. Do your spatial and temporal indexing (e.g. ``.sel()`` or ``.isel()``) early in the pipeline, especially before calling ``resample()`` or ``groupby()``. Grouping and resampling triggers some computation on all the blocks, which in theory should commute with indexing, but this optimization hasn't been implemented in Dask yet. (See `Dask issue #746 <https://github.com/dask/dask/issues/746>`_).
+  2. You may also want to cite a specific version of the xarray package. We
+     provide a `Zenodo citation and DOI <https://doi.org/10.5281/zenodo.598201>`_
+     for this purpose:
 
-2. More generally, ``groupby()`` is a costly operation and will perform a lot better if the ``flox`` package is installed.
-   See the `flox documentation <https://flox.readthedocs.io>`_ for more. By default Xarray will use ``flox`` if installed.
+        .. image:: https://zenodo.org/badge/doi/10.5281/zenodo.598201.svg
+           :target: https://doi.org/10.5281/zenodo.598201
 
-3. Save intermediate results to disk as a netCDF files (using ``to_netcdf()``) and then load them again with ``open_dataset()`` for further computations. For example, if subtracting temporal mean from a dataset, save the temporal mean to disk before subtracting. Again, in theory, Dask should be able to do the computation in a streaming fashion, but in practice this is a fail case for the Dask scheduler, because it tries to keep every chunk of an array that it computes in memory. (See `Dask issue #874 <https://github.com/dask/dask/issues/874>`_)
+       An example BibTeX entry::
 
-4. Specify smaller chunks across space when using :py:meth:`~xarray.open_mfdataset` (e.g., ``chunks={'latitude': 10, 'longitude': 10}``). This makes spatial subsetting easier, because there's no risk you will load subsets of data which span multiple chunks. On individual files, prefer to subset before chunking (suggestion 1).
+           @misc{xarray_v0_8_0,
+                 author = {Stephan Hoyer and Clark Fitzgerald and Joe Hamman and others},
+                 title  = {xarray: v0.8.0},
+                 month  = aug,
+                 year   = 2016,
+                 doi    = {10.5281/zenodo.59499},
+                 url    = {https://doi.org/10.5281/zenodo.59499}
+                }
 
-5. Chunk as early as possible, and avoid rechunking as much as possible. Always pass the ``chunks={}`` argument to :py:func:`~xarray.open_mfdataset` to avoid redundant file reads.
+.. _public api:
 
-6. Using the h5netcdf package by passing ``engine='h5netcdf'`` to :py:meth:`~xarray.open_mfdataset` can be quicker than the default ``engine='netcdf4'`` that uses the netCDF4 package.
+What parts of xarray are considered public API?
+-----------------------------------------------
 
-7. Find `best practices specific to Dask arrays in the documentation <https://docs.dask.org/en/latest/array-best-practices.html>`_.
+As a rule, only functions/methods documented in our :ref:`api` are considered
+part of xarray's public API. Everything else (in particular, everything in
+``xarray.core`` that is not also exposed in the top level ``xarray`` namespace)
+is considered a private implementation detail that may change at any time.
 
-8. The `dask diagnostics <https://docs.dask.org/en/latest/understanding-performance.html>`_ can be useful in identifying performance bottlenecks.
+Objects that exist to facilitate xarray's fluent interface on ``DataArray`` and
+``Dataset`` objects are a special case. For convenience, we document them in
+the API docs, but only their methods and the ``DataArray``/``Dataset``
+methods/properties to construct them (e.g., ``.plot()``, ``.groupby()``,
+``.str``) are considered public API. Constructors and other details of the
+internal classes used to implemented them (i.e.,
+``xarray.plot.plotting._PlotMethods``, ``xarray.core.groupby.DataArrayGroupBy``,
+``xarray.core.accessor_str.StringAccessor``) are not.
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `xarray-2023.3.0/doc/user-guide/data-structures.rst` & `xarray-2023.4.0/doc/user-guide/data-structures.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/user-guide/duckarrays.rst` & `xarray-2023.4.0/doc/user-guide/duckarrays.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/user-guide/groupby.rst` & `xarray-2023.4.0/doc/user-guide/groupby.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/user-guide/indexing.rst` & `xarray-2023.4.0/doc/user-guide/indexing.rst`

 * *Files 1% similar despite different names*

```diff
@@ -348,15 +348,14 @@
 dimensions:
 
 .. ipython:: python
 
     ind_x = xr.DataArray([0, 1], dims=["x"])
     ind_y = xr.DataArray([0, 1], dims=["y"])
     da[ind_x, ind_y]  # orthogonal indexing
-    da[ind_x, ind_x]  # vectorized indexing
 
 Slices or sequences/arrays without named-dimensions are treated as if they have
 the same dimension which is indexed along:
 
 .. ipython:: python
 
     # Because [0, 1] is used to index along dimension 'x',
@@ -395,14 +394,20 @@
 
     ds = da.to_dataset(name="bar")
     ds.isel(x=xr.DataArray([0, 1, 2], dims=["points"]))
 
 Vectorized indexing may be used to extract information from the nearest
 grid cells of interest, for example, the nearest climate model grid cells
 to a collection specified weather station latitudes and longitudes.
+To trigger vectorized indexing behavior
+you will need to provide the selection dimensions with a new
+shared output dimension name. In the example below, the selections
+of the closest latitude and longitude are renamed to an output
+dimension named "points":
+
 
 .. ipython:: python
 
     ds = xr.tutorial.open_dataset("air_temperature")
 
     # Define target latitude and longitude (where weather stations might be)
     target_lon = xr.DataArray([200, 201, 202, 205], dims="points")
```

### Comparing `xarray-2023.3.0/doc/user-guide/interpolation.rst` & `xarray-2023.4.0/doc/user-guide/interpolation.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/user-guide/io.rst` & `xarray-2023.4.0/doc/user-guide/io.rst`

 * *Files 2% similar despite different names*

```diff
@@ -250,39 +250,30 @@
 
 .. _CF conventions: http://cfconventions.org/
 
 You can view this encoding information (among others) in the
 :py:attr:`DataArray.encoding` and
 :py:attr:`DataArray.encoding` attributes:
 
-.. ipython::
-    :verbatim:
+.. ipython:: python
 
-    In [1]: ds_disk["y"].encoding
-    Out[1]:
-    {'zlib': False,
-     'shuffle': False,
-     'complevel': 0,
-     'fletcher32': False,
-     'contiguous': True,
-     'chunksizes': None,
-     'source': 'saved_on_disk.nc',
-     'original_shape': (5,),
-     'dtype': dtype('int64'),
-     'units': 'days since 2000-01-01 00:00:00',
-     'calendar': 'proleptic_gregorian'}
-
-    In [9]: ds_disk.encoding
-    Out[9]:
-    {'unlimited_dims': set(),
-     'source': 'saved_on_disk.nc'}
+    ds_disk["y"].encoding
+    ds_disk.encoding
 
 Note that all operations that manipulate variables other than indexing
 will remove encoding information.
 
+In some cases it is useful to intentionally reset a dataset's original encoding values.
+This can be done with either the :py:meth:`Dataset.reset_encoding` or
+:py:meth:`DataArray.reset_encoding` methods.
+
+.. ipython:: python
+
+    ds_no_encoding = ds_disk.reset_encoding()
+    ds_no_encoding.encoding
 
 .. _combining multiple files:
 
 Reading multi-file datasets
 ...........................
 
 NetCDF files are often encountered in collections, e.g., with different files
@@ -613,14 +604,21 @@
 
 (The suffix ``.zarr`` is optional--just a reminder that a zarr store lives
 there.) If the directory does not exist, it will be created. If a zarr
 store is already present at that path, an error will be raised, preventing it
 from being overwritten. To override this behavior and overwrite an existing
 store, add ``mode='w'`` when invoking :py:meth:`~Dataset.to_zarr`.
 
+DataArrays can also be saved to disk using the :py:meth:`DataArray.to_zarr` method,
+and loaded from disk using the :py:func:`open_dataarray` function with `engine='zarr'`.
+Similar to :py:meth:`DataArray.to_netcdf`, :py:meth:`DataArray.to_zarr` will
+convert the ``DataArray`` to a ``Dataset`` before saving, and then convert back
+when loading, ensuring that the ``DataArray`` that is loaded is always exactly
+the same as the one that was saved.
+
 .. note::
 
     xarray does not write NCZarr attributes. Therefore, NCZarr data must be
     opened in read-only mode.
 
 To store variable length strings, convert them to object arrays first with
 ``dtype=object``.
@@ -1153,54 +1151,15 @@
 search indices or other automated data discovery tools.
 
 .. _io.rasterio:
 
 Rasterio
 --------
 
-GeoTIFFs and other gridded raster datasets can be opened using `rasterio`_, if
-rasterio is installed. Here is an example of how to use
-:py:func:`open_rasterio` to read one of rasterio's `test files`_:
-
-.. deprecated:: 0.20.0
-
-        Deprecated in favor of rioxarray.
-        For information about transitioning, see:
-        `rioxarray getting started docs<https://corteva.github.io/rioxarray/stable/getting_started/getting_started.html>``
-
-.. ipython::
-    :verbatim:
-
-    In [7]: rio = xr.open_rasterio("RGB.byte.tif")
-
-    In [8]: rio
-    Out[8]:
-    <xarray.DataArray (band: 3, y: 718, x: 791)>
-    [1703814 values with dtype=uint8]
-    Coordinates:
-      * band     (band) int64 1 2 3
-      * y        (y) float64 2.827e+06 2.826e+06 2.826e+06 2.826e+06 2.826e+06 ...
-      * x        (x) float64 1.021e+05 1.024e+05 1.027e+05 1.03e+05 1.033e+05 ...
-    Attributes:
-        res:        (300.0379266750948, 300.041782729805)
-        transform:  (300.0379266750948, 0.0, 101985.0, 0.0, -300.041782729805, 28...
-        is_tiled:   0
-        crs:        +init=epsg:32618
-
-
-The ``x`` and ``y`` coordinates are generated out of the file's metadata
-(``bounds``, ``width``, ``height``), and they can be understood as cartesian
-coordinates defined in the file's projection provided by the ``crs`` attribute.
-``crs`` is a PROJ4 string which can be parsed by e.g. `pyproj`_ or rasterio.
-See :ref:`/examples/visualization_gallery.ipynb#Parsing-rasterio-geocoordinates`
-for an example of how to convert these to longitudes and latitudes.
-
-
-Additionally, you can use `rioxarray`_ for reading in GeoTiff, netCDF or other
-GDAL readable raster data using `rasterio`_ as well as for exporting to a geoTIFF.
+GDAL readable raster data using `rasterio`_  such as GeoTIFFs can be opened using the `rioxarray`_ extension.
 `rioxarray`_ can also handle geospatial related tasks such as re-projecting and clipping.
 
 .. ipython::
     :verbatim:
 
     In [1]: import rioxarray
 
@@ -1253,15 +1212,15 @@
     shutil.rmtree("path/to/directory.zarr")
 
 GRIB format via cfgrib
 ----------------------
 
 Xarray supports reading GRIB files via ECMWF cfgrib_ python driver,
 if it is installed. To open a GRIB file supply ``engine='cfgrib'``
-to :py:func:`open_dataset`:
+to :py:func:`open_dataset` after installing cfgrib_:
 
 .. ipython::
     :verbatim:
 
     In [1]: ds_grib = xr.open_dataset("example.grib", engine="cfgrib")
 
 We recommend installing cfgrib via conda::
```

### Comparing `xarray-2023.3.0/doc/user-guide/options.rst` & `xarray-2023.4.0/doc/user-guide/options.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/user-guide/pandas.rst` & `xarray-2023.4.0/doc/user-guide/pandas.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/user-guide/plotting.rst` & `xarray-2023.4.0/doc/user-guide/plotting.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/user-guide/reshaping.rst` & `xarray-2023.4.0/doc/user-guide/reshaping.rst`

 * *Files 4% similar despite different names*

```diff
@@ -1,14 +1,19 @@
 .. _reshape:
 
 ###############################
 Reshaping and reorganizing data
 ###############################
 
-These methods allow you to reorganize your data by changing dimensions, array shape, order of values, or indexes.
+Reshaping and reorganizing data refers to the process of changing the structure or organization of data by modifying dimensions, array shapes, order of values, or indexes. Xarray provides several methods to accomplish these tasks.
+
+These methods are particularly useful for reshaping xarray objects for use in machine learning packages, such as scikit-learn, that usually require two-dimensional numpy arrays as inputs. Reshaping can also be required before passing data to external visualization tools, for example geospatial data might expect input organized into a particular format corresponding to stacks of satellite images.
+
+Importing the library
+---------------------
 
 .. ipython:: python
     :suppress:
 
     import numpy as np
     import pandas as pd
     import xarray as xr
```

### Comparing `xarray-2023.3.0/doc/user-guide/terminology.rst` & `xarray-2023.4.0/doc/user-guide/terminology.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/user-guide/time-series.rst` & `xarray-2023.4.0/doc/user-guide/time-series.rst`

 * *Files 4% similar despite different names*

```diff
@@ -221,14 +221,21 @@
 You can also supply an arbitrary reduction function to aggregate over each
 resampling group:
 
 .. ipython:: python
 
     ds.resample(time="6H").reduce(np.mean)
 
+You can also resample on the time dimension while applying reducing along other dimensions at the same time
+by specifying the `dim` keyword argument
+
+.. code-block:: python
+
+    ds.resample(time="6H").mean(dim=["time", "latitude", "longitude"])
+
 For upsampling, xarray provides six methods: ``asfreq``, ``ffill``, ``bfill``, ``pad``,
 ``nearest`` and ``interpolate``. ``interpolate`` extends ``scipy.interpolate.interp1d``
 and supports all of its schemes. All of these resampling operations work on both
 Dataset and DataArray objects with an arbitrary number of dimensions.
 
 In order to limit the scope of the methods ``ffill``, ``bfill``, ``pad`` and
 ``nearest`` the ``tolerance`` argument can be set in coordinate units.
```

### Comparing `xarray-2023.3.0/doc/user-guide/weather-climate.rst` & `xarray-2023.4.0/doc/user-guide/weather-climate.rst`

 * *Files 4% similar despite different names*

```diff
@@ -53,39 +53,45 @@
 
 .. _`MetPy`: https://unidata.github.io/MetPy/dev/index.html
 .. _`metpy documentation`:	https://unidata.github.io/MetPy/dev/tutorials/xarray_tutorial.html#coordinates
 .. _`Cartopy`: https://scitools.org.uk/cartopy/docs/latest/crs/projections.html
 
 .. _CFTimeIndex:
 
-Non-standard calendars and dates outside the Timestamp-valid range
-------------------------------------------------------------------
+Non-standard calendars and dates outside the nanosecond-precision range
+-----------------------------------------------------------------------
 
 Through the standalone ``cftime`` library and a custom subclass of
 :py:class:`pandas.Index`, xarray supports a subset of the indexing
 functionality enabled through the standard :py:class:`pandas.DatetimeIndex` for
 dates from non-standard calendars commonly used in climate science or dates
-using a standard calendar, but outside the `Timestamp-valid range`_
+using a standard calendar, but outside the `nanosecond-precision range`_
 (approximately between years 1678 and 2262).
 
 .. note::
 
    As of xarray version 0.11, by default, :py:class:`cftime.datetime` objects
    will be used to represent times (either in indexes, as a
    :py:class:`~xarray.CFTimeIndex`, or in data arrays with dtype object) if
    any of the following are true:
 
    - The dates are from a non-standard calendar
-   - Any dates are outside the Timestamp-valid range.
+   - Any dates are outside the nanosecond-precision range.
 
    Otherwise pandas-compatible dates from a standard calendar will be
    represented with the ``np.datetime64[ns]`` data type, enabling the use of a
    :py:class:`pandas.DatetimeIndex` or arrays with dtype ``np.datetime64[ns]``
    and their full set of associated features.
 
+   As of pandas version 2.0.0, pandas supports non-nanosecond precision datetime
+   values.  For the time being, xarray still automatically casts datetime values
+   to nanosecond-precision for backwards compatibility with older pandas
+   versions; however, this is something we would like to relax going forward.
+   See :issue:`7493` for more discussion.
+
 For example, you can create a DataArray indexed by a time
 coordinate with dates from a no-leap calendar and a
 :py:class:`~xarray.CFTimeIndex` will automatically be used:
 
 .. ipython:: python
 
     from itertools import product
@@ -231,10 +237,10 @@
 
 - And resampling along the time dimension for data indexed by a :py:class:`~xarray.CFTimeIndex`:
 
 .. ipython:: python
 
     da.resample(time="81T", closed="right", label="right", offset="3T").mean()
 
-.. _Timestamp-valid range: https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timestamp-limitations
+.. _nanosecond-precision range: https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timestamp-limitations
 .. _ISO 8601 standard: https://en.wikipedia.org/wiki/ISO_8601
 .. _partial datetime string indexing: https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#partial-string-indexing
```

### Comparing `xarray-2023.3.0/doc/videos.yml` & `xarray-2023.4.0/doc/videos.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/doc/whats-new.rst` & `xarray-2023.4.0/doc/whats-new.rst`

 * *Files 0% similar despite different names*

```diff
@@ -11,14 +11,102 @@
     import xarray as xray
     import xarray
     import xarray as xr
 
     np.random.seed(123456)
 
 
+.. _whats-new.2023.04.0:
+
+v2023.04.0 (April 14, 2023)
+---------------------------
+
+This release includes support for pandas v2, allows refreshing of backend engines in a session, and removes deprecated backends
+for ``rasterio`` and ``cfgrib``.
+
+Thanks to our 19 contributors:
+Chinemere, Tom Coleman, Deepak Cherian, Harshitha, Illviljan, Jessica Scheick, Joe Hamman, Justus Magin, Kai Mühlbauer, Kwonil-Kim, Mary Gathoni, Michael Niklas, Pierre, Scott Henderson, Shreyal Gupta, Spencer Clark,  mccloskey, nishtha981, veenstrajelmer
+
+We welcome the following new contributors to Xarray!:
+Mary Gathoni, Harshitha, veenstrajelmer, Chinemere, nishtha981, Shreyal Gupta, Kwonil-Kim, mccloskey.
+
+New Features
+~~~~~~~~~~~~
+- New methods to reset an objects encoding (:py:meth:`Dataset.reset_encoding`, :py:meth:`DataArray.reset_encoding`).
+  (:issue:`7686`, :pull:`7689`).
+  By `Joe Hamman <https://github.com/jhamman>`_.
+- Allow refreshing backend engines with :py:meth:`xarray.backends.refresh_engines` (:issue:`7478`, :pull:`7523`).
+  By `Michael Niklas <https://github.com/headtr1ck>`_.
+- Added ability to save ``DataArray`` objects directly to Zarr using :py:meth:`~xarray.DataArray.to_zarr`.
+  (:issue:`7692`, :pull:`7693`) .
+  By `Joe Hamman <https://github.com/jhamman>`_.
+
+Breaking changes
+~~~~~~~~~~~~~~~~
+- Remove deprecated rasterio backend in favor of rioxarray  (:pull:`7392`).
+  By `Scott Henderson <https://github.com/scottyhq>`_.
+
+Deprecations
+~~~~~~~~~~~~
+
+Performance
+~~~~~~~~~~~
+- Optimize alignment with ``join="exact", copy=False`` by avoiding copies. (:pull:`7736`)
+  By `Deepak Cherian <https://github.com/dcherian>`_.
+- Avoid unnecessary copies of ``CFTimeIndex``. (:pull:`7735`)
+  By `Deepak Cherian <https://github.com/dcherian>`_.
+
+Bug fixes
+~~~~~~~~~
+
+- Fix :py:meth:`xr.polyval` with non-system standard integer coeffs (:pull:`7619`).
+  By `Shreyal Gupta <https://github.com/Ravenin7>`_ and `Michael Niklas <https://github.com/headtr1ck>`_.
+- Improve error message when trying to open a file which you do not have permission to read (:issue:`6523`, :pull:`7629`).
+  By `Thomas Coleman <https://github.com/ColemanTom>`_.
+- Proper plotting when passing :py:class:`~matplotlib.colors.BoundaryNorm` type argument in :py:meth:`DataArray.plot`. (:issue:`4061`, :issue:`7014`,:pull:`7553`)
+  By `Jelmer Veenstra <https://github.com/veenstrajelmer>`_.
+- Ensure the formatting of time encoding reference dates outside the range of
+  nanosecond-precision datetimes remains the same under pandas version 2.0.0
+  (:issue:`7420`, :pull:`7441`).
+  By `Justus Magin <https://github.com/keewis>`_ and
+  `Spencer Clark  <https://github.com/spencerkclark>`_.
+- Various `dtype` related fixes needed to support `pandas>=2.0` (:pull:`7724`)
+  By `Justus Magin <https://github.com/keewis>`_.
+- Preserve boolean dtype within encoding (:issue:`7652`, :pull:`7720`).
+  By `Kai Mühlbauer <https://github.com/kmuehlbauer>`_
+
+Documentation
+~~~~~~~~~~~~~
+
+- Update FAQ page on how do I open format X file as an xarray dataset? (:issue:`1285`, :pull:`7638`) using :py:func:`~xarray.open_dataset`
+  By `Harshitha <https://github.com/harshitha1201>`_ , `Tom Nicholas <https://github.com/TomNicholas>`_.
+
+Internal Changes
+~~~~~~~~~~~~~~~~
+
+- Don't assume that arrays read from disk will be Numpy arrays. This is a step toward
+  enabling reads from a Zarr store using the `Kvikio <https://docs.rapids.ai/api/kvikio/stable/api.html#zarr>`_
+  or `TensorStore <https://google.github.io/tensorstore/>`_ libraries.
+  (:pull:`6874`). By `Deepak Cherian <https://github.com/dcherian>`_.
+
+- Remove internal support for reading GRIB files through the ``cfgrib`` backend. ``cfgrib`` now uses the external
+  backend interface, so no existing code should break.
+  By `Deepak Cherian <https://github.com/dcherian>`_.
+- Implement CF coding functions in ``VariableCoders`` (:pull:`7719`).
+  By `Kai Mühlbauer <https://github.com/kmuehlbauer>`_
+
+- Added a config.yml file with messages for the welcome bot when a Github user creates their first ever issue or pull request or has their first PR merged. (:issue:`7685`, :pull:`7685`)
+  By `Nishtha P <https://github.com/nishthap981>`_.
+
+- Ensure that only nanosecond-precision :py:class:`pd.Timestamp` objects
+  continue to be used internally under pandas version 2.0.0.  This is mainly to
+  ease the transition to this latest version of pandas.  It should be relaxed
+  when addressing :issue:`7493`.  By `Spencer Clark
+  <https://github.com/spencerkclark>`_ (:issue:`7707`, :pull:`7731`).
+
 .. _whats-new.2023.03.0:
 
 v2023.03.0 (March 22, 2023)
 ---------------------------
 
 This release brings many bug fixes, and some new features. The maximum pandas version is pinned to ``<2`` until we can support the new pandas datetime types.
 Thanks to our 19 contributors:
```

### Comparing `xarray-2023.3.0/licenses/DASK_LICENSE` & `xarray-2023.4.0/licenses/DASK_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/licenses/ICOMOON_LICENSE` & `xarray-2023.4.0/licenses/ICOMOON_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/licenses/NUMPY_LICENSE` & `xarray-2023.4.0/licenses/NUMPY_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/licenses/PANDAS_LICENSE` & `xarray-2023.4.0/licenses/PANDAS_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/licenses/PYTHON_LICENSE` & `xarray-2023.4.0/licenses/PYTHON_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/licenses/SCIKIT_LEARN_LICENSE` & `xarray-2023.4.0/licenses/SCIKIT_LEARN_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/licenses/SEABORN_LICENSE` & `xarray-2023.4.0/licenses/SEABORN_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/properties/README.md` & `xarray-2023.4.0/properties/README.md`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/properties/test_encode_decode.py` & `xarray-2023.4.0/properties/test_encode_decode.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/properties/test_pandas_roundtrip.py` & `xarray-2023.4.0/properties/test_pandas_roundtrip.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/pyproject.toml` & `xarray-2023.4.0/pyproject.toml`

 * *Files 2% similar despite different names*

```diff
@@ -53,15 +53,14 @@
   "netCDF4.*",
   "netcdftime.*",
   "pandas.*",
   "pooch.*",
   "PseudoNetCDF.*",
   "pydap.*",
   "pytest.*",
-  "rasterio.*",
   "scipy.*",
   "seaborn.*",
   "setuptools",
   "sparse.*",
   "toolz.*",
   "zarr.*",
 ]
```

### Comparing `xarray-2023.3.0/setup.cfg` & `xarray-2023.4.0/setup.cfg`

 * *Files 2% similar despite different names*

```diff
@@ -71,28 +71,26 @@
 [options]
 packages = find:
 zip_safe = False  # https://mypy.readthedocs.io/en/latest/installed_packages.html
 include_package_data = True
 python_requires = >=3.9
 install_requires = 
 	numpy >= 1.21  # recommended to use >= 1.22 for full quantile method support
-	pandas >= 1.4, <2
+	pandas >= 1.4
 	packaging >= 21.3
 
 [options.extras_require]
 io = 
 	netCDF4
 	h5netcdf
 	scipy
 	pydap; python_version<"3.10" # see https://github.com/pydap/pydap/issues/268
 	zarr
 	fsspec
 	cftime
-	rasterio
-	cfgrib
 	pooch
 accel = 
 	scipy
 	bottleneck
 	numbagg
 	flox
 parallel =
```

### Comparing `xarray-2023.3.0/xarray/__init__.py` & `xarray-2023.4.0/xarray/__init__.py`

 * *Files 5% similar despite different names*

```diff
@@ -3,15 +3,14 @@
     load_dataarray,
     load_dataset,
     open_dataarray,
     open_dataset,
     open_mfdataset,
     save_mfdataset,
 )
-from xarray.backends.rasterio_ import open_rasterio
 from xarray.backends.zarr import open_zarr
 from xarray.coding.cftime_offsets import cftime_range, date_range, date_range_like
 from xarray.coding.cftimeindex import CFTimeIndex
 from xarray.coding.frequencies import infer_freq
 from xarray.conventions import SerializationWarning, decode_cf
 from xarray.core.alignment import align, broadcast
 from xarray.core.combine import combine_by_coords, combine_nested
@@ -81,15 +80,14 @@
     "load_dataset",
     "map_blocks",
     "merge",
     "ones_like",
     "open_dataarray",
     "open_dataset",
     "open_mfdataset",
-    "open_rasterio",
     "open_zarr",
     "polyval",
     "register_dataarray_accessor",
     "register_dataset_accessor",
     "save_mfdataset",
     "set_options",
     "show_versions",
```

### Comparing `xarray-2023.3.0/xarray/backends/__init__.py` & `xarray-2023.4.0/xarray/backends/__init__.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,23 +1,22 @@
 """Backend objects for saving and loading data
 
 DataStores provide a uniform interface for saving and loading data in different
 formats. They should not be used directly, but rather through Dataset objects.
 """
-from xarray.backends.cfgrib_ import CfGribDataStore
 from xarray.backends.common import AbstractDataStore, BackendArray, BackendEntrypoint
 from xarray.backends.file_manager import (
     CachingFileManager,
     DummyFileManager,
     FileManager,
 )
 from xarray.backends.h5netcdf_ import H5netcdfBackendEntrypoint, H5NetCDFStore
 from xarray.backends.memory import InMemoryDataStore
 from xarray.backends.netCDF4_ import NetCDF4BackendEntrypoint, NetCDF4DataStore
-from xarray.backends.plugins import list_engines
+from xarray.backends.plugins import list_engines, refresh_engines
 from xarray.backends.pseudonetcdf_ import (
     PseudoNetCDFBackendEntrypoint,
     PseudoNetCDFDataStore,
 )
 from xarray.backends.pydap_ import PydapBackendEntrypoint, PydapDataStore
 from xarray.backends.pynio_ import NioDataStore
 from xarray.backends.scipy_ import ScipyBackendEntrypoint, ScipyDataStore
@@ -26,15 +25,14 @@
 
 __all__ = [
     "AbstractDataStore",
     "BackendArray",
     "BackendEntrypoint",
     "FileManager",
     "CachingFileManager",
-    "CfGribDataStore",
     "DummyFileManager",
     "InMemoryDataStore",
     "NetCDF4DataStore",
     "PydapDataStore",
     "NioDataStore",
     "ScipyDataStore",
     "H5NetCDFStore",
@@ -44,8 +42,9 @@
     "NetCDF4BackendEntrypoint",
     "PseudoNetCDFBackendEntrypoint",
     "PydapBackendEntrypoint",
     "ScipyBackendEntrypoint",
     "StoreBackendEntrypoint",
     "ZarrBackendEntrypoint",
     "list_engines",
+    "refresh_engines",
 ]
```

### Comparing `xarray-2023.3.0/xarray/backends/api.py` & `xarray-2023.4.0/xarray/backends/api.py`

 * *Files 1% similar despite different names*

```diff
@@ -39,15 +39,15 @@
         JoinOptions,
         NestedSequence,
     )
 
     T_NetcdfEngine = Literal["netcdf4", "scipy", "h5netcdf"]
     T_Engine = Union[
         T_NetcdfEngine,
-        Literal["pydap", "pynio", "pseudonetcdf", "cfgrib", "zarr"],
+        Literal["pydap", "pynio", "pseudonetcdf", "zarr"],
         type[BackendEntrypoint],
         str,  # no nice typing support for custom backends
         None,
     ]
     T_Chunks = Union[int, dict[Any, Any], Literal["auto"], None]
     T_NetcdfTypes = Literal[
         "NETCDF4", "NETCDF4_CLASSIC", "NETCDF3_64BIT", "NETCDF3_CLASSIC"
@@ -60,15 +60,14 @@
 ENGINES = {
     "netcdf4": backends.NetCDF4DataStore.open,
     "scipy": backends.ScipyDataStore,
     "pydap": backends.PydapDataStore.open,
     "h5netcdf": backends.H5NetCDFStore.open,
     "pynio": backends.NioDataStore,
     "pseudonetcdf": backends.PseudoNetCDFDataStore.open,
-    "cfgrib": backends.CfGribDataStore,
     "zarr": backends.ZarrStore.open_group,
 }
 
 
 def _get_default_engine_remote_uri() -> Literal["netcdf4", "pydap"]:
     engine: Literal["netcdf4", "pydap"]
     try:
@@ -383,15 +382,15 @@
     ----------
     filename_or_obj : str, Path, file-like or DataStore
         Strings and Path objects are interpreted as a path to a netCDF file
         or an OpenDAP URL and opened with python-netCDF4, unless the filename
         ends with .gz, in which case the file is gunzipped and opened with
         scipy.io.netcdf (only netCDF3 supported). Byte-strings or file-like
         objects are opened by scipy.io.netcdf (netCDF3) or h5py (netCDF4/HDF).
-    engine : {"netcdf4", "scipy", "pydap", "h5netcdf", "pynio", "cfgrib", \
+    engine : {"netcdf4", "scipy", "pydap", "h5netcdf", "pynio", \
         "pseudonetcdf", "zarr", None}, installed backend \
         or subclass of xarray.backends.BackendEntrypoint, optional
         Engine to use when reading files. If not provided, the default engine
         is chosen based on available dependencies, with a preference for
         "netcdf4". A custom backend class (a subclass of ``BackendEntrypoint``)
         can also be used.
     chunks : int, dict, 'auto' or None, optional
@@ -475,15 +474,15 @@
 
         - 'group': path to the netCDF4 group in the given file to open given as
           a str,supported by "netcdf4", "h5netcdf", "zarr".
         - 'lock': resource lock to use when reading data from disk. Only
           relevant when using dask or another form of parallelism. By default,
           appropriate locks are chosen to safely read and write files with the
           currently active dask scheduler. Supported by "netcdf4", "h5netcdf",
-          "scipy", "pynio", "pseudonetcdf", "cfgrib".
+          "scipy", "pynio", "pseudonetcdf".
 
         See engine open function for kwargs accepted by each specific engine.
 
     Returns
     -------
     dataset : Dataset
         The newly created dataset.
@@ -572,15 +571,15 @@
     ----------
     filename_or_obj : str, Path, file-like or DataStore
         Strings and Path objects are interpreted as a path to a netCDF file
         or an OpenDAP URL and opened with python-netCDF4, unless the filename
         ends with .gz, in which case the file is gunzipped and opened with
         scipy.io.netcdf (only netCDF3 supported). Byte-strings or file-like
         objects are opened by scipy.io.netcdf (netCDF3) or h5py (netCDF4/HDF).
-    engine : {"netcdf4", "scipy", "pydap", "h5netcdf", "pynio", "cfgrib", \
+    engine : {"netcdf4", "scipy", "pydap", "h5netcdf", "pynio", \
         "pseudonetcdf", "zarr", None}, installed backend \
         or subclass of xarray.backends.BackendEntrypoint, optional
         Engine to use when reading files. If not provided, the default engine
         is chosen based on available dependencies, with a preference for
         "netcdf4".
     chunks : int, dict, 'auto' or None, optional
         If chunks is provided, it is used to load the new dataset into dask
@@ -662,15 +661,15 @@
 
         - 'group': path to the netCDF4 group in the given file to open given as
           a str,supported by "netcdf4", "h5netcdf", "zarr".
         - 'lock': resource lock to use when reading data from disk. Only
           relevant when using dask or another form of parallelism. By default,
           appropriate locks are chosen to safely read and write files with the
           currently active dask scheduler. Supported by "netcdf4", "h5netcdf",
-          "scipy", "pynio", "pseudonetcdf", "cfgrib".
+          "scipy", "pynio", "pseudonetcdf".
 
         See engine open function for kwargs accepted by each specific engine.
 
     Notes
     -----
     This is designed to be fully compatible with `DataArray.to_netcdf`. Saving
     using `DataArray.to_netcdf` and then loading with this function will
@@ -799,15 +798,15 @@
            of all non-null values.
          * "override": skip comparing and pick variable from first dataset
 
     preprocess : callable, optional
         If provided, call this function on each dataset prior to concatenation.
         You can find the file-name from which each dataset was loaded in
         ``ds.encoding["source"]``.
-    engine : {"netcdf4", "scipy", "pydap", "h5netcdf", "pynio", "cfgrib", \
+    engine : {"netcdf4", "scipy", "pydap", "h5netcdf", "pynio", \
         "pseudonetcdf", "zarr", None}, installed backend \
         or subclass of xarray.backends.BackendEntrypoint, optional
         Engine to use when reading files. If not provided, the default engine
         is chosen based on available dependencies, with a preference for
         "netcdf4".
     data_vars : {"minimal", "different", "all"} or list of str, default: "all"
         These data variables will be concatenated together:
```

### Comparing `xarray-2023.3.0/xarray/backends/cfgrib_.py` & `xarray-2023.4.0/xarray/backends/pynio_.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,139 +1,155 @@
 from __future__ import annotations
 
-import os
 import warnings
+from collections.abc import Iterable
+from typing import TYPE_CHECKING, Any
 
 import numpy as np
 
 from xarray.backends.common import (
     BACKEND_ENTRYPOINTS,
     AbstractDataStore,
     BackendArray,
     BackendEntrypoint,
     _normalize_path,
 )
-from xarray.backends.locks import SerializableLock, ensure_lock
+from xarray.backends.file_manager import CachingFileManager
+from xarray.backends.locks import (
+    HDF5_LOCK,
+    NETCDFC_LOCK,
+    SerializableLock,
+    combine_locks,
+    ensure_lock,
+)
 from xarray.backends.store import StoreBackendEntrypoint
 from xarray.core import indexing
-from xarray.core.utils import Frozen, FrozenDict, close_on_error, module_available
+from xarray.core.utils import Frozen, FrozenDict, close_on_error
 from xarray.core.variable import Variable
 
-# FIXME: Add a dedicated lock, even if ecCodes is supposed to be thread-safe
-#   in most circumstances. See:
-#       https://confluence.ecmwf.int/display/ECC/Frequently+Asked+Questions
-ECCODES_LOCK = SerializableLock()
+if TYPE_CHECKING:
+    import os
+    from io import BufferedIOBase
+
+    from xarray.core.dataset import Dataset
+
+# PyNIO can invoke netCDF libraries internally
+# Add a dedicated lock just in case NCL as well isn't thread-safe.
+NCL_LOCK = SerializableLock()
+PYNIO_LOCK = combine_locks([HDF5_LOCK, NETCDFC_LOCK, NCL_LOCK])
 
 
-class CfGribArrayWrapper(BackendArray):
-    def __init__(self, datastore, array):
+class NioArrayWrapper(BackendArray):
+    def __init__(self, variable_name, datastore):
         self.datastore = datastore
+        self.variable_name = variable_name
+        array = self.get_array()
         self.shape = array.shape
-        self.dtype = array.dtype
-        self.array = array
+        self.dtype = np.dtype(array.typecode())
+
+    def get_array(self, needs_lock=True):
+        ds = self.datastore._manager.acquire(needs_lock)
+        return ds.variables[self.variable_name]
 
     def __getitem__(self, key):
         return indexing.explicit_indexing_adapter(
             key, self.shape, indexing.IndexingSupport.BASIC, self._getitem
         )
 
     def _getitem(self, key):
         with self.datastore.lock:
-            return self.array[key]
+            array = self.get_array(needs_lock=False)
 
+            if key == () and self.ndim == 0:
+                return array.get_value()
 
-class CfGribDataStore(AbstractDataStore):
-    """
-    Implements the ``xr.AbstractDataStore`` read-only API for a GRIB file.
-    """
+            return array[key]
 
-    def __init__(self, filename, lock=None, **backend_kwargs):
-        try:
-            import cfgrib
-        # cfgrib throws a RuntimeError if eccodes is not installed
-        except (ImportError, RuntimeError) as err:
-            warnings.warn(
-                "Failed to load cfgrib - most likely there is a problem accessing the ecCodes library. "
-                "Try `import cfgrib` to get the full error message"
-            )
-            raise err
+
+class NioDataStore(AbstractDataStore):
+    """Store for accessing datasets via PyNIO"""
+
+    def __init__(self, filename, mode="r", lock=None, **kwargs):
+        import Nio
+
+        warnings.warn(
+            "The PyNIO backend is Deprecated and will be removed from Xarray in a future release. "
+            "See https://github.com/pydata/xarray/issues/4491 for more information",
+            DeprecationWarning,
+        )
 
         if lock is None:
-            lock = ECCODES_LOCK
+            lock = PYNIO_LOCK
         self.lock = ensure_lock(lock)
-        self.ds = cfgrib.open_file(filename, **backend_kwargs)
+        self._manager = CachingFileManager(
+            Nio.open_file, filename, lock=lock, mode=mode, kwargs=kwargs
+        )
+        # xarray provides its own support for FillValue,
+        # so turn off PyNIO's support for the same.
+        self.ds.set_option("MaskedArrayMode", "MaskedNever")
+
+    @property
+    def ds(self):
+        return self._manager.acquire()
 
     def open_store_variable(self, name, var):
-        if isinstance(var.data, np.ndarray):
-            data = var.data
-        else:
-            wrapped_array = CfGribArrayWrapper(self, var.data)
-            data = indexing.LazilyIndexedArray(wrapped_array)
-
-        encoding = self.ds.encoding.copy()
-        encoding["original_shape"] = var.data.shape
-
-        return Variable(var.dimensions, data, var.attributes, encoding)
+        data = indexing.LazilyIndexedArray(NioArrayWrapper(name, self))
+        return Variable(var.dimensions, data, var.attributes)
 
     def get_variables(self):
         return FrozenDict(
             (k, self.open_store_variable(k, v)) for k, v in self.ds.variables.items()
         )
 
     def get_attrs(self):
         return Frozen(self.ds.attributes)
 
     def get_dimensions(self):
         return Frozen(self.ds.dimensions)
 
     def get_encoding(self):
-        dims = self.get_dimensions()
-        return {"unlimited_dims": {k for k, v in dims.items() if v is None}}
+        return {
+            "unlimited_dims": {k for k in self.ds.dimensions if self.ds.unlimited(k)}
+        }
 
+    def close(self):
+        self._manager.close()
 
-class CfgribfBackendEntrypoint(BackendEntrypoint):
-    available = module_available("cfgrib")
 
-    def guess_can_open(self, filename_or_obj):
-        try:
-            _, ext = os.path.splitext(filename_or_obj)
-        except TypeError:
-            return False
-        return ext in {".grib", ".grib2", ".grb", ".grb2"}
+class PynioBackendEntrypoint(BackendEntrypoint):
+    """
+    PyNIO backend
 
-    def open_dataset(
+        .. deprecated:: 0.20.0
+
+        Deprecated as PyNIO is no longer supported. See
+        https://github.com/pydata/xarray/issues/4491 for more information
+    """
+
+    def open_dataset(  # type: ignore[override]  # allow LSP violation, not supporting **kwargs
         self,
-        filename_or_obj,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
         *,
         mask_and_scale=True,
         decode_times=True,
         concat_characters=True,
         decode_coords=True,
-        drop_variables=None,
+        drop_variables: str | Iterable[str] | None = None,
         use_cftime=None,
         decode_timedelta=None,
+        mode="r",
         lock=None,
-        indexpath="{path}.{short_hash}.idx",
-        filter_by_keys={},
-        read_keys=[],
-        encode_cf=("parameter", "time", "geography", "vertical"),
-        squeeze=True,
-        time_dims=("time", "step"),
-    ):
+    ) -> Dataset:
         filename_or_obj = _normalize_path(filename_or_obj)
-        store = CfGribDataStore(
+        store = NioDataStore(
             filename_or_obj,
-            indexpath=indexpath,
-            filter_by_keys=filter_by_keys,
-            read_keys=read_keys,
-            encode_cf=encode_cf,
-            squeeze=squeeze,
-            time_dims=time_dims,
+            mode=mode,
             lock=lock,
         )
+
         store_entrypoint = StoreBackendEntrypoint()
         with close_on_error(store):
             ds = store_entrypoint.open_dataset(
                 store,
                 mask_and_scale=mask_and_scale,
                 decode_times=decode_times,
                 concat_characters=concat_characters,
@@ -141,8 +157,8 @@
                 drop_variables=drop_variables,
                 use_cftime=use_cftime,
                 decode_timedelta=decode_timedelta,
             )
         return ds
 
 
-BACKEND_ENTRYPOINTS["cfgrib"] = CfgribfBackendEntrypoint
+BACKEND_ENTRYPOINTS["pynio"] = ("Nio", PynioBackendEntrypoint)
```

### Comparing `xarray-2023.3.0/xarray/backends/common.py` & `xarray-2023.4.0/xarray/backends/common.py`

 * *Files 1% similar despite different names*

```diff
@@ -13,14 +13,16 @@
 from xarray.core import indexing
 from xarray.core.pycompat import is_duck_dask_array
 from xarray.core.utils import FrozenDict, NdimSizeLenMixin, is_remote_uri
 
 if TYPE_CHECKING:
     from io import BufferedIOBase
 
+    from xarray.core.dataset import Dataset
+
 # Create a logger object, but don't add any handlers. Leave that to user code.
 logger = logging.getLogger(__name__)
 
 
 NONE_VAR_NAME = "__values__"
 
 
@@ -80,17 +82,17 @@
             logger.debug(msg)
             time.sleep(1e-3 * next_delay)
 
 
 class BackendArray(NdimSizeLenMixin, indexing.ExplicitlyIndexed):
     __slots__ = ()
 
-    def __array__(self, dtype=None):
+    def get_duck_array(self, dtype: np.typing.DTypeLike = None):
         key = indexing.BasicIndexer((slice(None),) * self.ndim)
-        return np.asarray(self[key], dtype=dtype)
+        return self[key]  # type: ignore [index]
 
 
 class AbstractDataStore:
     __slots__ = ()
 
     def get_dimensions(self):  # pragma: no cover
         raise NotImplementedError()
@@ -373,30 +375,25 @@
     - ``guess_can_open`` method: it shall return ``True`` if the backend is able to open
       ``filename_or_obj``, ``False`` otherwise. The implementation of this
       method is not mandatory.
 
     Attributes
     ----------
 
-    available : bool, default: True
-        Indicate wether this backend is available given the installed packages.
-        The setting of this attribute is not mandatory.
     open_dataset_parameters : tuple, default: None
         A list of ``open_dataset`` method parameters.
         The setting of this attribute is not mandatory.
     description : str, default: ""
         A short string describing the engine.
         The setting of this attribute is not mandatory.
     url : str, default: ""
         A string with the URL to the backend's documentation.
         The setting of this attribute is not mandatory.
     """
 
-    available: ClassVar[bool] = True
-
     open_dataset_parameters: ClassVar[tuple | None] = None
     description: ClassVar[str] = ""
     url: ClassVar[str] = ""
 
     def __repr__(self) -> str:
         txt = f"<{type(self).__name__}>"
         if self.description:
@@ -404,28 +401,30 @@
         if self.url:
             txt += f"\n  Learn more at {self.url}"
         return txt
 
     def open_dataset(
         self,
         filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
+        *,
         drop_variables: str | Iterable[str] | None = None,
         **kwargs: Any,
-    ):
+    ) -> Dataset:
         """
         Backend open_dataset method used by Xarray in :py:func:`~xarray.open_dataset`.
         """
 
         raise NotImplementedError
 
     def guess_can_open(
         self,
         filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
-    ):
+    ) -> bool:
         """
         Backend open_dataset method used by Xarray in :py:func:`~xarray.open_dataset`.
         """
 
         return False
 
 
-BACKEND_ENTRYPOINTS: dict[str, type[BackendEntrypoint]] = {}
+# mapping of engine name to (module name, BackendEntrypoint Class)
+BACKEND_ENTRYPOINTS: dict[str, tuple[str | None, type[BackendEntrypoint]]] = {}
```

### Comparing `xarray-2023.3.0/xarray/backends/file_manager.py` & `xarray-2023.4.0/xarray/backends/file_manager.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/backends/h5netcdf_.py` & `xarray-2023.4.0/xarray/backends/h5netcdf_.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,12 +1,14 @@
 from __future__ import annotations
 
 import functools
 import io
 import os
+from collections.abc import Iterable
+from typing import TYPE_CHECKING, Any
 
 from packaging.version import Version
 
 from xarray.backends.common import (
     BACKEND_ENTRYPOINTS,
     BackendEntrypoint,
     WritableCFDataStore,
@@ -23,20 +25,25 @@
     _nc4_require_group,
 )
 from xarray.backends.store import StoreBackendEntrypoint
 from xarray.core import indexing
 from xarray.core.utils import (
     FrozenDict,
     is_remote_uri,
-    module_available,
     read_magic_number_from_file,
     try_read_magic_number_from_file_or_path,
 )
 from xarray.core.variable import Variable
 
+if TYPE_CHECKING:
+    from io import BufferedIOBase
+
+    from xarray.backends.common import AbstractDataStore
+    from xarray.core.dataset import Dataset
+
 
 class H5NetCDFArrayWrapper(BaseNetCDF4Array):
     def get_array(self, needs_lock=True):
         ds = self.datastore._acquire(needs_lock)
         return ds.variables[self.variable_name]
 
     def __getitem__(self, key):
@@ -361,50 +368,51 @@
     See Also
     --------
     backends.H5NetCDFStore
     backends.NetCDF4BackendEntrypoint
     backends.ScipyBackendEntrypoint
     """
 
-    available = module_available("h5netcdf")
     description = (
         "Open netCDF (.nc, .nc4 and .cdf) and most HDF5 files using h5netcdf in Xarray"
     )
     url = "https://docs.xarray.dev/en/stable/generated/xarray.backends.H5netcdfBackendEntrypoint.html"
 
-    def guess_can_open(self, filename_or_obj):
+    def guess_can_open(
+        self,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
+    ) -> bool:
         magic_number = try_read_magic_number_from_file_or_path(filename_or_obj)
         if magic_number is not None:
             return magic_number.startswith(b"\211HDF\r\n\032\n")
 
-        try:
+        if isinstance(filename_or_obj, (str, os.PathLike)):
             _, ext = os.path.splitext(filename_or_obj)
-        except TypeError:
-            return False
+            return ext in {".nc", ".nc4", ".cdf"}
 
-        return ext in {".nc", ".nc4", ".cdf"}
+        return False
 
-    def open_dataset(
+    def open_dataset(  # type: ignore[override]  # allow LSP violation, not supporting **kwargs
         self,
-        filename_or_obj,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
         *,
         mask_and_scale=True,
         decode_times=True,
         concat_characters=True,
         decode_coords=True,
-        drop_variables=None,
+        drop_variables: str | Iterable[str] | None = None,
         use_cftime=None,
         decode_timedelta=None,
         format=None,
         group=None,
         lock=None,
         invalid_netcdf=None,
         phony_dims=None,
         decode_vlen_strings=True,
-    ):
+    ) -> Dataset:
         filename_or_obj = _normalize_path(filename_or_obj)
         store = H5NetCDFStore.open(
             filename_or_obj,
             format=format,
             group=group,
             lock=lock,
             invalid_netcdf=invalid_netcdf,
@@ -423,8 +431,8 @@
             drop_variables=drop_variables,
             use_cftime=use_cftime,
             decode_timedelta=decode_timedelta,
         )
         return ds
 
 
-BACKEND_ENTRYPOINTS["h5netcdf"] = H5netcdfBackendEntrypoint
+BACKEND_ENTRYPOINTS["h5netcdf"] = ("h5netcdf", H5netcdfBackendEntrypoint)
```

### Comparing `xarray-2023.3.0/xarray/backends/locks.py` & `xarray-2023.4.0/xarray/backends/locks.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/backends/lru_cache.py` & `xarray-2023.4.0/xarray/backends/lru_cache.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/backends/memory.py` & `xarray-2023.4.0/xarray/backends/memory.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/backends/netCDF4_.py` & `xarray-2023.4.0/xarray/backends/netCDF4_.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,13 +1,15 @@
 from __future__ import annotations
 
 import functools
 import operator
 import os
+from collections.abc import Iterable
 from contextlib import suppress
+from typing import TYPE_CHECKING, Any
 
 import numpy as np
 
 from xarray import coding
 from xarray.backends.common import (
     BACKEND_ENTRYPOINTS,
     BackendArray,
@@ -29,19 +31,24 @@
 from xarray.backends.store import StoreBackendEntrypoint
 from xarray.coding.variables import pop_to
 from xarray.core import indexing
 from xarray.core.utils import (
     FrozenDict,
     close_on_error,
     is_remote_uri,
-    module_available,
     try_read_magic_number_from_path,
 )
 from xarray.core.variable import Variable
 
+if TYPE_CHECKING:
+    from io import BufferedIOBase
+
+    from xarray.backends.common import AbstractDataStore
+    from xarray.core.dataset import Dataset
+
 # This lookup table maps from dtype.byteorder to a readable endian
 # string used by netCDF4.
 _endian_lookup = {"=": "native", ">": "big", "<": "little", "|": "native"}
 
 
 NETCDF4_PYTHON_LOCK = combine_locks([NETCDFC_LOCK, HDF5_LOCK])
 
@@ -531,52 +538,56 @@
     See Also
     --------
     backends.NetCDF4DataStore
     backends.H5netcdfBackendEntrypoint
     backends.ScipyBackendEntrypoint
     """
 
-    available = module_available("netCDF4")
     description = (
         "Open netCDF (.nc, .nc4 and .cdf) and most HDF5 files using netCDF4 in Xarray"
     )
     url = "https://docs.xarray.dev/en/stable/generated/xarray.backends.NetCDF4BackendEntrypoint.html"
 
-    def guess_can_open(self, filename_or_obj):
+    def guess_can_open(
+        self,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
+    ) -> bool:
         if isinstance(filename_or_obj, str) and is_remote_uri(filename_or_obj):
             return True
         magic_number = try_read_magic_number_from_path(filename_or_obj)
         if magic_number is not None:
             # netcdf 3 or HDF5
             return magic_number.startswith((b"CDF", b"\211HDF\r\n\032\n"))
-        try:
+
+        if isinstance(filename_or_obj, (str, os.PathLike)):
             _, ext = os.path.splitext(filename_or_obj)
-        except TypeError:
-            return False
-        return ext in {".nc", ".nc4", ".cdf"}
+            return ext in {".nc", ".nc4", ".cdf"}
+
+        return False
 
-    def open_dataset(
+    def open_dataset(  # type: ignore[override]  # allow LSP violation, not supporting **kwargs
         self,
-        filename_or_obj,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
+        *,
         mask_and_scale=True,
         decode_times=True,
         concat_characters=True,
         decode_coords=True,
-        drop_variables=None,
+        drop_variables: str | Iterable[str] | None = None,
         use_cftime=None,
         decode_timedelta=None,
         group=None,
         mode="r",
         format="NETCDF4",
         clobber=True,
         diskless=False,
         persist=False,
         lock=None,
         autoclose=False,
-    ):
+    ) -> Dataset:
         filename_or_obj = _normalize_path(filename_or_obj)
         store = NetCDF4DataStore.open(
             filename_or_obj,
             mode=mode,
             format=format,
             group=group,
             clobber=clobber,
@@ -597,8 +608,8 @@
                 drop_variables=drop_variables,
                 use_cftime=use_cftime,
                 decode_timedelta=decode_timedelta,
             )
         return ds
 
 
-BACKEND_ENTRYPOINTS["netcdf4"] = NetCDF4BackendEntrypoint
+BACKEND_ENTRYPOINTS["netcdf4"] = ("netCDF4", NetCDF4BackendEntrypoint)
```

### Comparing `xarray-2023.3.0/xarray/backends/netcdf3.py` & `xarray-2023.4.0/xarray/backends/netcdf3.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/backends/plugins.py` & `xarray-2023.4.0/xarray/backends/plugins.py`

 * *Files 6% similar despite different names*

```diff
@@ -2,51 +2,58 @@
 
 import functools
 import inspect
 import itertools
 import sys
 import warnings
 from importlib.metadata import entry_points
-from typing import TYPE_CHECKING, Any
+from typing import TYPE_CHECKING, Any, Callable
 
 from xarray.backends.common import BACKEND_ENTRYPOINTS, BackendEntrypoint
+from xarray.core.utils import module_available
 
 if TYPE_CHECKING:
     import os
+    from importlib.metadata import EntryPoint
+
+    if sys.version_info >= (3, 10):
+        from importlib.metadata import EntryPoints
+    else:
+        EntryPoints = list[EntryPoint]
     from io import BufferedIOBase
 
     from xarray.backends.common import AbstractDataStore
 
 STANDARD_BACKENDS_ORDER = ["netcdf4", "h5netcdf", "scipy"]
 
 
-def remove_duplicates(entrypoints):
+def remove_duplicates(entrypoints: EntryPoints) -> list[EntryPoint]:
     # sort and group entrypoints by name
-    entrypoints = sorted(entrypoints, key=lambda ep: ep.name)
-    entrypoints_grouped = itertools.groupby(entrypoints, key=lambda ep: ep.name)
+    entrypoints_sorted = sorted(entrypoints, key=lambda ep: ep.name)
+    entrypoints_grouped = itertools.groupby(entrypoints_sorted, key=lambda ep: ep.name)
     # check if there are multiple entrypoints for the same name
     unique_entrypoints = []
-    for name, matches in entrypoints_grouped:
+    for name, _matches in entrypoints_grouped:
         # remove equal entrypoints
-        matches = list(set(matches))
+        matches = list(set(_matches))
         unique_entrypoints.append(matches[0])
         matches_len = len(matches)
         if matches_len > 1:
             all_module_names = [e.value.split(":")[0] for e in matches]
             selected_module_name = all_module_names[0]
             warnings.warn(
                 f"Found {matches_len} entrypoints for the engine name {name}:"
                 f"\n {all_module_names}.\n "
                 f"The entrypoint {selected_module_name} will be used.",
                 RuntimeWarning,
             )
     return unique_entrypoints
 
 
-def detect_parameters(open_dataset):
+def detect_parameters(open_dataset: Callable) -> tuple[str, ...]:
     signature = inspect.signature(open_dataset)
     parameters = signature.parameters
     parameters_list = []
     for name, param in parameters.items():
         if param.kind in (
             inspect.Parameter.VAR_KEYWORD,
             inspect.Parameter.VAR_POSITIONAL,
@@ -56,51 +63,57 @@
                 "*args and **kwargs is not supported"
             )
         if name != "self":
             parameters_list.append(name)
     return tuple(parameters_list)
 
 
-def backends_dict_from_pkg(entrypoints):
+def backends_dict_from_pkg(
+    entrypoints: list[EntryPoint],
+) -> dict[str, type[BackendEntrypoint]]:
     backend_entrypoints = {}
     for entrypoint in entrypoints:
         name = entrypoint.name
         try:
             backend = entrypoint.load()
             backend_entrypoints[name] = backend
         except Exception as ex:
             warnings.warn(f"Engine {name!r} loading failed:\n{ex}", RuntimeWarning)
     return backend_entrypoints
 
 
-def set_missing_parameters(backend_entrypoints):
-    for name, backend in backend_entrypoints.items():
+def set_missing_parameters(
+    backend_entrypoints: dict[str, type[BackendEntrypoint]]
+) -> None:
+    for _, backend in backend_entrypoints.items():
         if backend.open_dataset_parameters is None:
             open_dataset = backend.open_dataset
             backend.open_dataset_parameters = detect_parameters(open_dataset)
 
 
-def sort_backends(backend_entrypoints):
+def sort_backends(
+    backend_entrypoints: dict[str, type[BackendEntrypoint]]
+) -> dict[str, type[BackendEntrypoint]]:
     ordered_backends_entrypoints = {}
     for be_name in STANDARD_BACKENDS_ORDER:
         if backend_entrypoints.get(be_name, None) is not None:
             ordered_backends_entrypoints[be_name] = backend_entrypoints.pop(be_name)
     ordered_backends_entrypoints.update(
         {name: backend_entrypoints[name] for name in sorted(backend_entrypoints)}
     )
     return ordered_backends_entrypoints
 
 
-def build_engines(entrypoints) -> dict[str, BackendEntrypoint]:
-    backend_entrypoints = {}
-    for backend_name, backend in BACKEND_ENTRYPOINTS.items():
-        if backend.available:
+def build_engines(entrypoints: EntryPoints) -> dict[str, BackendEntrypoint]:
+    backend_entrypoints: dict[str, type[BackendEntrypoint]] = {}
+    for backend_name, (module_name, backend) in BACKEND_ENTRYPOINTS.items():
+        if module_name is None or module_available(module_name):
             backend_entrypoints[backend_name] = backend
-    entrypoints = remove_duplicates(entrypoints)
-    external_backend_entrypoints = backends_dict_from_pkg(entrypoints)
+    entrypoints_unique = remove_duplicates(entrypoints)
+    external_backend_entrypoints = backends_dict_from_pkg(entrypoints_unique)
     backend_entrypoints.update(external_backend_entrypoints)
     backend_entrypoints = sort_backends(backend_entrypoints)
     set_missing_parameters(backend_entrypoints)
     return {name: backend() for name, backend in backend_entrypoints.items()}
 
 
 @functools.lru_cache(maxsize=1)
@@ -118,32 +131,39 @@
     If available, more information is available about each backend via ``engs["eng_name"]``.
 
     # New selection mechanism introduced with Python 3.10. See GH6514.
     """
     if sys.version_info >= (3, 10):
         entrypoints = entry_points(group="xarray.backends")
     else:
-        entrypoints = entry_points().get("xarray.backends", ())
+        entrypoints = entry_points().get("xarray.backends", [])
     return build_engines(entrypoints)
 
 
+def refresh_engines() -> None:
+    """Refreshes the backend engines based on installed packages."""
+    list_engines.cache_clear()
+
+
 def guess_engine(
     store_spec: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
 ):
     engines = list_engines()
 
     for engine, backend in engines.items():
         try:
             if backend.guess_can_open(store_spec):
                 return engine
+        except PermissionError:
+            raise
         except Exception:
             warnings.warn(f"{engine!r} fails while guessing", RuntimeWarning)
 
     compatible_engines = []
-    for engine, backend_cls in BACKEND_ENTRYPOINTS.items():
+    for engine, (_, backend_cls) in BACKEND_ENTRYPOINTS.items():
         try:
             backend = backend_cls()
             if backend.guess_can_open(store_spec):
                 compatible_engines.append(engine)
         except Exception:
             warnings.warn(f"{engine!r} fails while guessing", RuntimeWarning)
```

### Comparing `xarray-2023.3.0/xarray/backends/pseudonetcdf_.py` & `xarray-2023.4.0/xarray/backends/pseudonetcdf_.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,25 +1,34 @@
 from __future__ import annotations
 
+from collections.abc import Iterable
+from typing import TYPE_CHECKING, Any
+
 import numpy as np
 
 from xarray.backends.common import (
     BACKEND_ENTRYPOINTS,
     AbstractDataStore,
     BackendArray,
     BackendEntrypoint,
     _normalize_path,
 )
 from xarray.backends.file_manager import CachingFileManager
 from xarray.backends.locks import HDF5_LOCK, NETCDFC_LOCK, combine_locks, ensure_lock
 from xarray.backends.store import StoreBackendEntrypoint
 from xarray.core import indexing
-from xarray.core.utils import Frozen, FrozenDict, close_on_error, module_available
+from xarray.core.utils import Frozen, FrozenDict, close_on_error
 from xarray.core.variable import Variable
 
+if TYPE_CHECKING:
+    import os
+    from io import BufferedIOBase
+
+    from xarray.core.dataset import Dataset
+
 # psuedonetcdf can invoke netCDF libraries internally
 PNETCDF_LOCK = combine_locks([HDF5_LOCK, NETCDFC_LOCK])
 
 
 class PncArrayWrapper(BackendArray):
     def __init__(self, variable_name, datastore):
         self.datastore = datastore
@@ -117,15 +126,14 @@
     https://pseudonetcdf.readthedocs.io
 
     See Also
     --------
     backends.PseudoNetCDFDataStore
     """
 
-    available = module_available("PseudoNetCDF")
     description = (
         "Open many atmospheric science data formats using PseudoNetCDF in Xarray"
     )
     url = "https://docs.xarray.dev/en/stable/generated/xarray.backends.PseudoNetCDFBackendEntrypoint.html"
 
     # *args and **kwargs are not allowed in open_backend_dataset_ kwargs,
     # unless the open_dataset_parameters are explicitly defined like this:
@@ -140,26 +148,26 @@
         "decode_timedelta",
         "mode",
         "lock",
     )
 
     def open_dataset(
         self,
-        filename_or_obj,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
         mask_and_scale=False,
         decode_times=True,
         concat_characters=True,
         decode_coords=True,
-        drop_variables=None,
+        drop_variables: str | Iterable[str] | None = None,
         use_cftime=None,
         decode_timedelta=None,
         mode=None,
         lock=None,
         **format_kwargs,
-    ):
+    ) -> Dataset:
         filename_or_obj = _normalize_path(filename_or_obj)
         store = PseudoNetCDFDataStore.open(
             filename_or_obj, lock=lock, mode=mode, **format_kwargs
         )
 
         store_entrypoint = StoreBackendEntrypoint()
         with close_on_error(store):
@@ -172,8 +180,8 @@
                 drop_variables=drop_variables,
                 use_cftime=use_cftime,
                 decode_timedelta=decode_timedelta,
             )
         return ds
 
 
-BACKEND_ENTRYPOINTS["pseudonetcdf"] = PseudoNetCDFBackendEntrypoint
+BACKEND_ENTRYPOINTS["pseudonetcdf"] = ("PseudoNetCDF", PseudoNetCDFBackendEntrypoint)
```

### Comparing `xarray-2023.3.0/xarray/backends/pydap_.py` & `xarray-2023.4.0/xarray/backends/pydap_.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,9 +1,12 @@
 from __future__ import annotations
 
+from collections.abc import Iterable
+from typing import TYPE_CHECKING, Any
+
 import numpy as np
 from packaging.version import Version
 
 from xarray.backends.common import (
     BACKEND_ENTRYPOINTS,
     AbstractDataStore,
     BackendArray,
@@ -15,18 +18,23 @@
 from xarray.core.pycompat import integer_types
 from xarray.core.utils import (
     Frozen,
     FrozenDict,
     close_on_error,
     is_dict_like,
     is_remote_uri,
-    module_available,
 )
 from xarray.core.variable import Variable
 
+if TYPE_CHECKING:
+    import os
+    from io import BufferedIOBase
+
+    from xarray.core.dataset import Dataset
+
 
 class PydapArrayWrapper(BackendArray):
     def __init__(self, array):
         self.array = array
 
     @property
     def shape(self) -> tuple[int, ...]:
@@ -42,14 +50,15 @@
         )
 
     def _getitem(self, key):
         # pull the data from the array attribute if possible, to avoid
         # downloading coordinate data twice
         array = getattr(self.array, "array", self.array)
         result = robust_getitem(array, key, catch=ValueError)
+        result = np.asarray(result)
         # in some cases, pydap doesn't squeeze axes automatically like numpy
         axis = tuple(n for n, k in enumerate(key) if isinstance(k, integer_types))
         if result.ndim + len(axis) != array.ndim and axis:
             result = np.squeeze(result, axis)
 
         return result
 
@@ -150,38 +159,41 @@
     https://www.pydap.org
 
     See Also
     --------
     backends.PydapDataStore
     """
 
-    available = module_available("pydap")
     description = "Open remote datasets via OPeNDAP using pydap in Xarray"
     url = "https://docs.xarray.dev/en/stable/generated/xarray.backends.PydapBackendEntrypoint.html"
 
-    def guess_can_open(self, filename_or_obj):
+    def guess_can_open(
+        self,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
+    ) -> bool:
         return isinstance(filename_or_obj, str) and is_remote_uri(filename_or_obj)
 
-    def open_dataset(
+    def open_dataset(  # type: ignore[override]  # allow LSP violation, not supporting **kwargs
         self,
-        filename_or_obj,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
+        *,
         mask_and_scale=True,
         decode_times=True,
         concat_characters=True,
         decode_coords=True,
-        drop_variables=None,
+        drop_variables: str | Iterable[str] | None = None,
         use_cftime=None,
         decode_timedelta=None,
         application=None,
         session=None,
         output_grid=None,
         timeout=None,
         verify=None,
         user_charset=None,
-    ):
+    ) -> Dataset:
         store = PydapDataStore.open(
             url=filename_or_obj,
             application=application,
             session=session,
             output_grid=output_grid,
             timeout=timeout,
             verify=verify,
@@ -199,8 +211,8 @@
                 drop_variables=drop_variables,
                 use_cftime=use_cftime,
                 decode_timedelta=decode_timedelta,
             )
             return ds
 
 
-BACKEND_ENTRYPOINTS["pydap"] = PydapBackendEntrypoint
+BACKEND_ENTRYPOINTS["pydap"] = ("pydap", PydapBackendEntrypoint)
```

### Comparing `xarray-2023.3.0/xarray/backends/scipy_.py` & `xarray-2023.4.0/xarray/backends/scipy_.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,12 +1,14 @@
 from __future__ import annotations
 
 import gzip
 import io
 import os
+from collections.abc import Iterable
+from typing import TYPE_CHECKING, Any
 
 import numpy as np
 
 from xarray.backends.common import (
     BACKEND_ENTRYPOINTS,
     BackendArray,
     BackendEntrypoint,
@@ -22,19 +24,24 @@
 )
 from xarray.backends.store import StoreBackendEntrypoint
 from xarray.core.indexing import NumpyIndexingAdapter
 from xarray.core.utils import (
     Frozen,
     FrozenDict,
     close_on_error,
-    module_available,
     try_read_magic_number_from_file_or_path,
 )
 from xarray.core.variable import Variable
 
+if TYPE_CHECKING:
+    from io import BufferedIOBase
+
+    from xarray.backends.common import AbstractDataStore
+    from xarray.core.dataset import Dataset
+
 
 def _decode_string(s):
     if isinstance(s, bytes):
         return s.decode("utf-8", "replace")
     return s
 
 
@@ -257,48 +264,51 @@
     See Also
     --------
     backends.ScipyDataStore
     backends.NetCDF4BackendEntrypoint
     backends.H5netcdfBackendEntrypoint
     """
 
-    available = module_available("scipy")
     description = "Open netCDF files (.nc, .nc4, .cdf and .gz) using scipy in Xarray"
     url = "https://docs.xarray.dev/en/stable/generated/xarray.backends.ScipyBackendEntrypoint.html"
 
-    def guess_can_open(self, filename_or_obj):
+    def guess_can_open(
+        self,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
+    ) -> bool:
         magic_number = try_read_magic_number_from_file_or_path(filename_or_obj)
         if magic_number is not None and magic_number.startswith(b"\x1f\x8b"):
-            with gzip.open(filename_or_obj) as f:
+            with gzip.open(filename_or_obj) as f:  # type: ignore[arg-type]
                 magic_number = try_read_magic_number_from_file_or_path(f)
         if magic_number is not None:
             return magic_number.startswith(b"CDF")
 
-        try:
+        if isinstance(filename_or_obj, (str, os.PathLike)):
             _, ext = os.path.splitext(filename_or_obj)
-        except TypeError:
-            return False
-        return ext in {".nc", ".nc4", ".cdf", ".gz"}
+            return ext in {".nc", ".nc4", ".cdf", ".gz"}
+
+        return False
 
-    def open_dataset(
+    def open_dataset(  # type: ignore[override]  # allow LSP violation, not supporting **kwargs
         self,
-        filename_or_obj,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
+        *,
         mask_and_scale=True,
         decode_times=True,
         concat_characters=True,
         decode_coords=True,
-        drop_variables=None,
+        drop_variables: str | Iterable[str] | None = None,
         use_cftime=None,
         decode_timedelta=None,
         mode="r",
         format=None,
         group=None,
         mmap=None,
         lock=None,
-    ):
+    ) -> Dataset:
         filename_or_obj = _normalize_path(filename_or_obj)
         store = ScipyDataStore(
             filename_or_obj, mode=mode, format=format, group=group, mmap=mmap, lock=lock
         )
 
         store_entrypoint = StoreBackendEntrypoint()
         with close_on_error(store):
@@ -311,8 +321,8 @@
                 drop_variables=drop_variables,
                 use_cftime=use_cftime,
                 decode_timedelta=decode_timedelta,
             )
         return ds
 
 
-BACKEND_ENTRYPOINTS["scipy"] = ScipyBackendEntrypoint
+BACKEND_ENTRYPOINTS["scipy"] = ("scipy", ScipyBackendEntrypoint)
```

### Comparing `xarray-2023.3.0/xarray/backends/store.py` & `xarray-2023.4.0/xarray/backends/store.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,40 +1,51 @@
 from __future__ import annotations
 
+from collections.abc import Iterable
+from typing import TYPE_CHECKING, Any
+
 from xarray import conventions
 from xarray.backends.common import (
     BACKEND_ENTRYPOINTS,
     AbstractDataStore,
     BackendEntrypoint,
 )
 from xarray.core.dataset import Dataset
 
+if TYPE_CHECKING:
+    import os
+    from io import BufferedIOBase
+
 
 class StoreBackendEntrypoint(BackendEntrypoint):
-    available = True
     description = "Open AbstractDataStore instances in Xarray"
     url = "https://docs.xarray.dev/en/stable/generated/xarray.backends.StoreBackendEntrypoint.html"
 
-    def guess_can_open(self, filename_or_obj):
+    def guess_can_open(
+        self,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
+    ) -> bool:
         return isinstance(filename_or_obj, AbstractDataStore)
 
-    def open_dataset(
+    def open_dataset(  # type: ignore[override]  # allow LSP violation, not supporting **kwargs
         self,
-        store,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
         *,
         mask_and_scale=True,
         decode_times=True,
         concat_characters=True,
         decode_coords=True,
-        drop_variables=None,
+        drop_variables: str | Iterable[str] | None = None,
         use_cftime=None,
         decode_timedelta=None,
-    ):
-        vars, attrs = store.load()
-        encoding = store.get_encoding()
+    ) -> Dataset:
+        assert isinstance(filename_or_obj, AbstractDataStore)
+
+        vars, attrs = filename_or_obj.load()
+        encoding = filename_or_obj.get_encoding()
 
         vars, attrs, coord_names = conventions.decode_cf_variables(
             vars,
             attrs,
             mask_and_scale=mask_and_scale,
             decode_times=decode_times,
             concat_characters=concat_characters,
@@ -42,14 +53,14 @@
             drop_variables=drop_variables,
             use_cftime=use_cftime,
             decode_timedelta=decode_timedelta,
         )
 
         ds = Dataset(vars, attrs=attrs)
         ds = ds.set_coords(coord_names.intersection(vars))
-        ds.set_close(store.close)
+        ds.set_close(filename_or_obj.close)
         ds.encoding = encoding
 
         return ds
 
 
-BACKEND_ENTRYPOINTS["store"] = StoreBackendEntrypoint
+BACKEND_ENTRYPOINTS["store"] = (None, StoreBackendEntrypoint)
```

### Comparing `xarray-2023.3.0/xarray/backends/zarr.py` & `xarray-2023.4.0/xarray/backends/zarr.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,12 +1,14 @@
 from __future__ import annotations
 
 import json
 import os
 import warnings
+from collections.abc import Iterable
+from typing import TYPE_CHECKING, Any
 
 import numpy as np
 
 from xarray import coding, conventions
 from xarray.backends.common import (
     BACKEND_ENTRYPOINTS,
     AbstractWritableDataStore,
@@ -18,18 +20,24 @@
 from xarray.backends.store import StoreBackendEntrypoint
 from xarray.core import indexing
 from xarray.core.pycompat import integer_types
 from xarray.core.utils import (
     FrozenDict,
     HiddenKeyDict,
     close_on_error,
-    module_available,
 )
 from xarray.core.variable import Variable
 
+if TYPE_CHECKING:
+    from io import BufferedIOBase
+
+    from xarray.backends.common import AbstractDataStore
+    from xarray.core.dataset import Dataset
+
+
 # need some special secret attributes to tell us the dimensions
 DIMENSION_KEY = "_ARRAY_DIMENSIONS"
 
 
 def encode_zarr_attr_value(value):
     """
     Encode a attribute value as something that can be serialized as json
@@ -63,25 +71,31 @@
 
         dtype = array.dtype
         self.dtype = dtype
 
     def get_array(self):
         return self.datastore.zarr_group[self.variable_name]
 
+    def _oindex(self, key):
+        return self.get_array().oindex[key]
+
     def __getitem__(self, key):
         array = self.get_array()
         if isinstance(key, indexing.BasicIndexer):
             return array[key.tuple]
         elif isinstance(key, indexing.VectorizedIndexer):
             return array.vindex[
                 indexing._arrayize_vectorized_indexer(key, self.shape).tuple
             ]
         else:
             assert isinstance(key, indexing.OuterIndexer)
-            return array.oindex[key.tuple]
+            return indexing.explicit_indexing_adapter(
+                key, array.shape, indexing.IndexingSupport.VECTORIZED, self._oindex
+            )
+
         # if self.ndim == 0:
         # could possibly have a work-around for 0d data here
 
 
 def _determine_zarr_chunks(enc_chunks, var_chunks, ndim, name, safe_chunks):
     """
     Given encoding chunks (possibly None or []) and variable chunks
@@ -853,44 +867,47 @@
     https://zarr.readthedocs.io/en/stable
 
     See Also
     --------
     backends.ZarrStore
     """
 
-    available = module_available("zarr")
     description = "Open zarr files (.zarr) using zarr in Xarray"
     url = "https://docs.xarray.dev/en/stable/generated/xarray.backends.ZarrBackendEntrypoint.html"
 
-    def guess_can_open(self, filename_or_obj):
-        try:
+    def guess_can_open(
+        self,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
+    ) -> bool:
+        if isinstance(filename_or_obj, (str, os.PathLike)):
             _, ext = os.path.splitext(filename_or_obj)
-        except TypeError:
-            return False
-        return ext in {".zarr"}
+            return ext in {".zarr"}
 
-    def open_dataset(
+        return False
+
+    def open_dataset(  # type: ignore[override]  # allow LSP violation, not supporting **kwargs
         self,
-        filename_or_obj,
+        filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
+        *,
         mask_and_scale=True,
         decode_times=True,
         concat_characters=True,
         decode_coords=True,
-        drop_variables=None,
+        drop_variables: str | Iterable[str] | None = None,
         use_cftime=None,
         decode_timedelta=None,
         group=None,
         mode="r",
         synchronizer=None,
         consolidated=None,
         chunk_store=None,
         storage_options=None,
         stacklevel=3,
         zarr_version=None,
-    ):
+    ) -> Dataset:
         filename_or_obj = _normalize_path(filename_or_obj)
         store = ZarrStore.open_group(
             filename_or_obj,
             group=group,
             mode=mode,
             synchronizer=synchronizer,
             consolidated=consolidated,
@@ -912,8 +929,8 @@
                 drop_variables=drop_variables,
                 use_cftime=use_cftime,
                 decode_timedelta=decode_timedelta,
             )
         return ds
 
 
-BACKEND_ENTRYPOINTS["zarr"] = ZarrBackendEntrypoint
+BACKEND_ENTRYPOINTS["zarr"] = ("zarr", ZarrBackendEntrypoint)
```

### Comparing `xarray-2023.3.0/xarray/coding/calendar_ops.py` & `xarray-2023.4.0/xarray/coding/calendar_ops.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/coding/cftime_offsets.py` & `xarray-2023.4.0/xarray/coding/cftime_offsets.py`

 * *Files 1% similar despite different names*

```diff
@@ -53,15 +53,20 @@
 from xarray.coding.times import (
     _is_standard_calendar,
     _should_cftime_be_used,
     convert_time_or_go_back,
     format_cftime_datetime,
 )
 from xarray.core.common import _contains_datetime_like_objects, is_np_datetime_like
-from xarray.core.pdcompat import NoDefault, count_not_none, no_default
+from xarray.core.pdcompat import (
+    NoDefault,
+    count_not_none,
+    nanosecond_precision_timestamp,
+    no_default,
+)
 from xarray.core.utils import emit_user_level_warning
 
 try:
     import cftime
 except ImportError:
     cftime = None
 
@@ -1282,16 +1287,18 @@
     use_cftime = _should_cftime_be_used(source, calendar, use_cftime)
 
     source_start = source.values.min()
     source_end = source.values.max()
     if is_np_datetime_like(source.dtype):
         # We want to use datetime fields (datetime64 object don't have them)
         source_calendar = "standard"
-        source_start = pd.Timestamp(source_start)
-        source_end = pd.Timestamp(source_end)
+        # TODO: the strict enforcement of nanosecond precision Timestamps can be
+        # relaxed when addressing GitHub issue #7493.
+        source_start = nanosecond_precision_timestamp(source_start)
+        source_end = nanosecond_precision_timestamp(source_end)
     else:
         if isinstance(source, CFTimeIndex):
             source_calendar = source.calendar
         else:  # DataArray
             source_calendar = source.dt.calendar
 
     if calendar == source_calendar and is_np_datetime_like(source.dtype) ^ use_cftime:
```

### Comparing `xarray-2023.3.0/xarray/coding/cftimeindex.py` & `xarray-2023.4.0/xarray/coding/cftimeindex.py`

 * *Files 0% similar despite different names*

```diff
@@ -609,15 +609,15 @@
         -------
         pandas.DatetimeIndex
 
         Raises
         ------
         ValueError
             If the CFTimeIndex contains dates that are not possible in the
-            standard calendar or outside the pandas.Timestamp-valid range.
+            standard calendar or outside the nanosecond-precision range.
 
         Warns
         -----
         RuntimeWarning
             If converting from a non-standard calendar to a DatetimeIndex.
 
         Warnings
```

### Comparing `xarray-2023.3.0/xarray/coding/frequencies.py` & `xarray-2023.4.0/xarray/coding/frequencies.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/coding/strings.py` & `xarray-2023.4.0/xarray/coding/strings.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/coding/times.py` & `xarray-2023.4.0/xarray/coding/times.py`

 * *Files 3% similar despite different names*

```diff
@@ -19,14 +19,15 @@
     safe_setitem,
     unpack_for_decoding,
     unpack_for_encoding,
 )
 from xarray.core import indexing
 from xarray.core.common import contains_cftime_datetimes, is_np_datetime_like
 from xarray.core.formatting import first_n_items, format_timestamp, last_item
+from xarray.core.pdcompat import nanosecond_precision_timestamp
 from xarray.core.pycompat import is_duck_dask_array
 from xarray.core.variable import Variable
 
 try:
     import cftime
 except ImportError:
     cftime = None
@@ -220,15 +221,17 @@
             "Cannot decode times from a non-standard calendar, {!r}, using "
             "pandas.".format(calendar)
         )
 
     delta, ref_date = _unpack_netcdf_time_units(units)
     delta = _netcdf_to_numpy_timeunit(delta)
     try:
-        ref_date = pd.Timestamp(ref_date)
+        # TODO: the strict enforcement of nanosecond precision Timestamps can be
+        # relaxed when addressing GitHub issue #7493.
+        ref_date = nanosecond_precision_timestamp(ref_date)
     except ValueError:
         # ValueError is raised by pd.Timestamp for non-ISO timestamp
         # strings, in which case we fall back to using cftime
         raise OutOfBoundsDatetime
 
     with warnings.catch_warnings():
         warnings.filterwarnings("ignore", "invalid value encountered", RuntimeWarning)
@@ -387,15 +390,17 @@
     unique time deltas in `dates`)
     """
     dates = np.asarray(dates).ravel()
     if np.asarray(dates).dtype == "datetime64[ns]":
         dates = to_datetime_unboxed(dates)
         dates = dates[pd.notnull(dates)]
         reference_date = dates[0] if len(dates) > 0 else "1970-01-01"
-        reference_date = pd.Timestamp(reference_date)
+        # TODO: the strict enforcement of nanosecond precision Timestamps can be
+        # relaxed when addressing GitHub issue #7493.
+        reference_date = nanosecond_precision_timestamp(reference_date)
     else:
         reference_date = dates[0] if len(dates) > 0 else "1970-01-01"
         reference_date = format_cftime_datetime(reference_date)
     unique_timedeltas = np.unique(np.diff(dates))
     units = _infer_time_units_from_diff(unique_timedeltas)
     return f"{units} since {reference_date}"
 
@@ -428,22 +433,24 @@
 def cftime_to_nptime(times, raise_on_invalid: bool = True) -> np.ndarray:
     """Given an array of cftime.datetime objects, return an array of
     numpy.datetime64 objects of the same size
 
     If raise_on_invalid is True (default), invalid dates trigger a ValueError.
     Otherwise, the invalid element is replaced by np.NaT."""
     times = np.asarray(times)
+    # TODO: the strict enforcement of nanosecond precision datetime values can
+    # be relaxed when addressing GitHub issue #7493.
     new = np.empty(times.shape, dtype="M8[ns]")
     for i, t in np.ndenumerate(times):
         try:
             # Use pandas.Timestamp in place of datetime.datetime, because
             # NumPy casts it safely it np.datetime64[ns] for dates outside
             # 1678 to 2262 (this is not currently the case for
             # datetime.datetime).
-            dt = pd.Timestamp(
+            dt = nanosecond_precision_timestamp(
                 t.year, t.month, t.day, t.hour, t.minute, t.second, t.microsecond
             )
         except ValueError as e:
             if raise_on_invalid:
                 raise ValueError(
                     "Cannot convert date {} to a date in the "
                     "standard calendar.  Reason: {}.".format(t, e)
@@ -494,14 +501,18 @@
     """Convert a single date to a new date_type (cftime.datetime or pd.Timestamp).
 
     If the new date is invalid, it goes back a day and tries again. If it is still
     invalid, goes back a second day.
 
     This is meant to convert end-of-month dates into a new calendar.
     """
+    # TODO: the strict enforcement of nanosecond precision Timestamps can be
+    # relaxed when addressing GitHub issue #7493.
+    if date_type == pd.Timestamp:
+        date_type = nanosecond_precision_timestamp
     try:
         return date_type(
             date.year,
             date.month,
             date.day,
             date.hour,
             date.minute,
@@ -637,15 +648,18 @@
         if not _is_standard_calendar(calendar) or dates.dtype.kind == "O":
             # parse with cftime instead
             raise OutOfBoundsDatetime
         assert dates.dtype == "datetime64[ns]"
 
         delta_units = _netcdf_to_numpy_timeunit(delta)
         time_delta = np.timedelta64(1, delta_units).astype("timedelta64[ns]")
-        ref_date = pd.Timestamp(_ref_date)
+
+        # TODO: the strict enforcement of nanosecond precision Timestamps can be
+        # relaxed when addressing GitHub issue #7493.
+        ref_date = nanosecond_precision_timestamp(_ref_date)
 
         # If the ref_date Timestamp is timezone-aware, convert to UTC and
         # make it timezone-naive (GH 2649).
         if ref_date.tz is not None:
             ref_date = ref_date.tz_convert(None)
 
         # Wrap the dates in a DatetimeIndex to do the subtraction to ensure
```

### Comparing `xarray-2023.3.0/xarray/coding/variables.py` & `xarray-2023.4.0/xarray/coding/variables.py`

 * *Files 18% similar despite different names*

```diff
@@ -65,23 +65,88 @@
     @property
     def dtype(self) -> np.dtype:
         return np.dtype(self._dtype)
 
     def __getitem__(self, key):
         return type(self)(self.array[key], self.func, self.dtype)
 
-    def __array__(self, dtype=None):
-        return self.func(self.array)
+    def get_duck_array(self):
+        return self.func(self.array.get_duck_array())
 
     def __repr__(self) -> str:
         return "{}({!r}, func={!r}, dtype={!r})".format(
             type(self).__name__, self.array, self.func, self.dtype
         )
 
 
+class NativeEndiannessArray(indexing.ExplicitlyIndexedNDArrayMixin):
+    """Decode arrays on the fly from non-native to native endianness
+
+    This is useful for decoding arrays from netCDF3 files (which are all
+    big endian) into native endianness, so they can be used with Cython
+    functions, such as those found in bottleneck and pandas.
+
+    >>> x = np.arange(5, dtype=">i2")
+
+    >>> x.dtype
+    dtype('>i2')
+
+    >>> NativeEndiannessArray(x).dtype
+    dtype('int16')
+
+    >>> indexer = indexing.BasicIndexer((slice(None),))
+    >>> NativeEndiannessArray(x)[indexer].dtype
+    dtype('int16')
+    """
+
+    __slots__ = ("array",)
+
+    def __init__(self, array) -> None:
+        self.array = indexing.as_indexable(array)
+
+    @property
+    def dtype(self) -> np.dtype:
+        return np.dtype(self.array.dtype.kind + str(self.array.dtype.itemsize))
+
+    def __getitem__(self, key) -> np.ndarray:
+        return np.asarray(self.array[key], dtype=self.dtype)
+
+
+class BoolTypeArray(indexing.ExplicitlyIndexedNDArrayMixin):
+    """Decode arrays on the fly from integer to boolean datatype
+
+    This is useful for decoding boolean arrays from integer typed netCDF
+    variables.
+
+    >>> x = np.array([1, 0, 1, 1, 0], dtype="i1")
+
+    >>> x.dtype
+    dtype('int8')
+
+    >>> BoolTypeArray(x).dtype
+    dtype('bool')
+
+    >>> indexer = indexing.BasicIndexer((slice(None),))
+    >>> BoolTypeArray(x)[indexer].dtype
+    dtype('bool')
+    """
+
+    __slots__ = ("array",)
+
+    def __init__(self, array) -> None:
+        self.array = indexing.as_indexable(array)
+
+    @property
+    def dtype(self) -> np.dtype:
+        return np.dtype("bool")
+
+    def __getitem__(self, key) -> np.ndarray:
+        return np.asarray(self.array[key], dtype=self.dtype)
+
+
 def lazy_elemwise_func(array, func: Callable, dtype: np.typing.DTypeLike):
     """Lazily apply an element-wise function to an array.
     Parameters
     ----------
     array : any valid value of Variable._data
     func : callable
         Function to apply to indexed slices of an array. For use with dask,
@@ -155,35 +220,37 @@
     def encode(self, variable: Variable, name: T_Name = None):
         dims, data, attrs, encoding = unpack_for_encoding(variable)
 
         dtype = np.dtype(encoding.get("dtype", data.dtype))
         fv = encoding.get("_FillValue")
         mv = encoding.get("missing_value")
 
-        if (
-            fv is not None
-            and mv is not None
-            and not duck_array_ops.allclose_or_equiv(fv, mv)
-        ):
+        fv_exists = fv is not None
+        mv_exists = mv is not None
+
+        if not fv_exists and not mv_exists:
+            return variable
+
+        if fv_exists and mv_exists and not duck_array_ops.allclose_or_equiv(fv, mv):
             raise ValueError(
                 f"Variable {name!r} has conflicting _FillValue ({fv}) and missing_value ({mv}). Cannot encode data."
             )
 
-        if fv is not None:
+        if fv_exists:
             # Ensure _FillValue is cast to same dtype as data's
             encoding["_FillValue"] = dtype.type(fv)
             fill_value = pop_to(encoding, attrs, "_FillValue", name=name)
             if not pd.isnull(fill_value):
                 data = duck_array_ops.fillna(data, fill_value)
 
-        if mv is not None:
+        if mv_exists:
             # Ensure missing_value is cast to same dtype as data's
             encoding["missing_value"] = dtype.type(mv)
             fill_value = pop_to(encoding, attrs, "missing_value", name=name)
-            if not pd.isnull(fill_value) and fv is None:
+            if not pd.isnull(fill_value) and not fv_exists:
                 data = duck_array_ops.fillna(data, fill_value)
 
         return Variable(dims, data, attrs, encoding, fastpath=True)
 
     def decode(self, variable: Variable, name: T_Name = None):
         dims, data, attrs, encoding = unpack_for_decoding(variable)
 
@@ -220,15 +287,15 @@
 
             return Variable(dims, data, attrs, encoding, fastpath=True)
         else:
             return variable
 
 
 def _scale_offset_decoding(data, scale_factor, add_offset, dtype: np.typing.DTypeLike):
-    data = np.array(data, dtype=dtype, copy=True)
+    data = data.astype(dtype=dtype, copy=True)
     if scale_factor is not None:
         data *= scale_factor
     if add_offset is not None:
         data += add_offset
     return data
 
 
@@ -345,7 +412,105 @@
                     SerializationWarning,
                     stacklevel=3,
                 )
 
             return Variable(dims, data, attrs, encoding, fastpath=True)
         else:
             return variable
+
+
+class DefaultFillvalueCoder(VariableCoder):
+    """Encode default _FillValue if needed."""
+
+    def encode(self, variable: Variable, name: T_Name = None) -> Variable:
+        dims, data, attrs, encoding = unpack_for_encoding(variable)
+        # make NaN the fill value for float types
+        if (
+            "_FillValue" not in attrs
+            and "_FillValue" not in encoding
+            and np.issubdtype(variable.dtype, np.floating)
+        ):
+            attrs["_FillValue"] = variable.dtype.type(np.nan)
+            return Variable(dims, data, attrs, encoding, fastpath=True)
+        else:
+            return variable
+
+    def decode(self, variable: Variable, name: T_Name = None) -> Variable:
+        raise NotImplementedError()
+
+
+class BooleanCoder(VariableCoder):
+    """Code boolean values."""
+
+    def encode(self, variable: Variable, name: T_Name = None) -> Variable:
+        if (
+            (variable.dtype == bool)
+            and ("dtype" not in variable.encoding)
+            and ("dtype" not in variable.attrs)
+        ):
+            dims, data, attrs, encoding = unpack_for_encoding(variable)
+            attrs["dtype"] = "bool"
+            data = duck_array_ops.astype(data, dtype="i1", copy=True)
+
+            return Variable(dims, data, attrs, encoding, fastpath=True)
+        else:
+            return variable
+
+    def decode(self, variable: Variable, name: T_Name = None) -> Variable:
+        if variable.attrs.get("dtype", False) == "bool":
+            dims, data, attrs, encoding = unpack_for_decoding(variable)
+            # overwrite (!) dtype in encoding, and remove from attrs
+            # needed for correct subsequent encoding
+            encoding["dtype"] = attrs.pop("dtype")
+            data = BoolTypeArray(data)
+            return Variable(dims, data, attrs, encoding, fastpath=True)
+        else:
+            return variable
+
+
+class EndianCoder(VariableCoder):
+    """Decode Endianness to native."""
+
+    def encode(self):
+        raise NotImplementedError()
+
+    def decode(self, variable: Variable, name: T_Name = None) -> Variable:
+        dims, data, attrs, encoding = unpack_for_decoding(variable)
+        if not data.dtype.isnative:
+            data = NativeEndiannessArray(data)
+            return Variable(dims, data, attrs, encoding, fastpath=True)
+        else:
+            return variable
+
+
+class NonStringCoder(VariableCoder):
+    """Encode NonString variables if dtypes differ."""
+
+    def encode(self, variable: Variable, name: T_Name = None) -> Variable:
+        if "dtype" in variable.encoding and variable.encoding["dtype"] not in (
+            "S1",
+            str,
+        ):
+            dims, data, attrs, encoding = unpack_for_encoding(variable)
+            dtype = np.dtype(encoding.pop("dtype"))
+            if dtype != variable.dtype:
+                if np.issubdtype(dtype, np.integer):
+                    if (
+                        np.issubdtype(variable.dtype, np.floating)
+                        and "_FillValue" not in variable.attrs
+                        and "missing_value" not in variable.attrs
+                    ):
+                        warnings.warn(
+                            f"saving variable {name} with floating "
+                            "point data as an integer dtype without "
+                            "any _FillValue to use for NaNs",
+                            SerializationWarning,
+                            stacklevel=10,
+                        )
+                    data = np.around(data)
+                data = data.astype(dtype=dtype)
+            return Variable(dims, data, attrs, encoding, fastpath=True)
+        else:
+            return variable
+
+    def decode(self):
+        raise NotImplementedError()
```

### Comparing `xarray-2023.3.0/xarray/conventions.py` & `xarray-2023.4.0/xarray/conventions.py`

 * *Files 4% similar despite different names*

```diff
@@ -6,15 +6,15 @@
 from typing import TYPE_CHECKING, Any, Union
 
 import numpy as np
 import pandas as pd
 
 from xarray.coding import strings, times, variables
 from xarray.coding.variables import SerializationWarning, pop_to
-from xarray.core import duck_array_ops, indexing
+from xarray.core import indexing
 from xarray.core.common import (
     _contains_datetime_like_objects,
     contains_cftime_datetimes,
 )
 from xarray.core.pycompat import is_duck_dask_array
 from xarray.core.variable import IndexVariable, Variable
 
@@ -44,131 +44,18 @@
     T_Name = Union[Hashable, None]
     T_Variables = Mapping[Any, Variable]
     T_Attrs = MutableMapping[Any, Any]
     T_DropVariables = Union[str, Iterable[Hashable], None]
     T_DatasetOrAbstractstore = Union[Dataset, AbstractDataStore]
 
 
-class NativeEndiannessArray(indexing.ExplicitlyIndexedNDArrayMixin):
-    """Decode arrays on the fly from non-native to native endianness
-
-    This is useful for decoding arrays from netCDF3 files (which are all
-    big endian) into native endianness, so they can be used with Cython
-    functions, such as those found in bottleneck and pandas.
-
-    >>> x = np.arange(5, dtype=">i2")
-
-    >>> x.dtype
-    dtype('>i2')
-
-    >>> NativeEndiannessArray(x).dtype
-    dtype('int16')
-
-    >>> indexer = indexing.BasicIndexer((slice(None),))
-    >>> NativeEndiannessArray(x)[indexer].dtype
-    dtype('int16')
-    """
-
-    __slots__ = ("array",)
-
-    def __init__(self, array):
-        self.array = indexing.as_indexable(array)
-
-    @property
-    def dtype(self):
-        return np.dtype(self.array.dtype.kind + str(self.array.dtype.itemsize))
-
-    def __getitem__(self, key):
-        return np.asarray(self.array[key], dtype=self.dtype)
-
-
-class BoolTypeArray(indexing.ExplicitlyIndexedNDArrayMixin):
-    """Decode arrays on the fly from integer to boolean datatype
-
-    This is useful for decoding boolean arrays from integer typed netCDF
-    variables.
-
-    >>> x = np.array([1, 0, 1, 1, 0], dtype="i1")
-
-    >>> x.dtype
-    dtype('int8')
-
-    >>> BoolTypeArray(x).dtype
-    dtype('bool')
-
-    >>> indexer = indexing.BasicIndexer((slice(None),))
-    >>> BoolTypeArray(x)[indexer].dtype
-    dtype('bool')
-    """
-
-    __slots__ = ("array",)
-
-    def __init__(self, array):
-        self.array = indexing.as_indexable(array)
-
-    @property
-    def dtype(self):
-        return np.dtype("bool")
-
-    def __getitem__(self, key):
-        return np.asarray(self.array[key], dtype=self.dtype)
-
-
 def _var_as_tuple(var: Variable) -> T_VarTuple:
     return var.dims, var.data, var.attrs.copy(), var.encoding.copy()
 
 
-def maybe_encode_nonstring_dtype(var: Variable, name: T_Name = None) -> Variable:
-    if "dtype" in var.encoding and var.encoding["dtype"] not in ("S1", str):
-        dims, data, attrs, encoding = _var_as_tuple(var)
-        dtype = np.dtype(encoding.pop("dtype"))
-        if dtype != var.dtype:
-            if np.issubdtype(dtype, np.integer):
-                if (
-                    np.issubdtype(var.dtype, np.floating)
-                    and "_FillValue" not in var.attrs
-                    and "missing_value" not in var.attrs
-                ):
-                    warnings.warn(
-                        f"saving variable {name} with floating "
-                        "point data as an integer dtype without "
-                        "any _FillValue to use for NaNs",
-                        SerializationWarning,
-                        stacklevel=10,
-                    )
-                data = np.around(data)
-            data = data.astype(dtype=dtype)
-        var = Variable(dims, data, attrs, encoding, fastpath=True)
-    return var
-
-
-def maybe_default_fill_value(var: Variable) -> Variable:
-    # make NaN the fill value for float types:
-    if (
-        "_FillValue" not in var.attrs
-        and "_FillValue" not in var.encoding
-        and np.issubdtype(var.dtype, np.floating)
-    ):
-        var.attrs["_FillValue"] = var.dtype.type(np.nan)
-    return var
-
-
-def maybe_encode_bools(var: Variable) -> Variable:
-    if (
-        (var.dtype == bool)
-        and ("dtype" not in var.encoding)
-        and ("dtype" not in var.attrs)
-    ):
-        dims, data, attrs, encoding = _var_as_tuple(var)
-        attrs["dtype"] = "bool"
-        data = duck_array_ops.astype(data, dtype="i1", copy=True)
-        var = Variable(dims, data, attrs, encoding, fastpath=True)
-    return var
-
-
 def _infer_dtype(array, name: T_Name = None) -> np.dtype:
     """Given an object array with no missing values, infer its dtype from its
     first element
     """
     if array.dtype.kind != "O":
         raise TypeError("infer_type must be called on a dtype=object array")
 
@@ -288,21 +175,21 @@
 
     for coder in [
         times.CFDatetimeCoder(),
         times.CFTimedeltaCoder(),
         variables.CFScaleOffsetCoder(),
         variables.CFMaskCoder(),
         variables.UnsignedIntegerCoder(),
+        variables.NonStringCoder(),
+        variables.DefaultFillvalueCoder(),
+        variables.BooleanCoder(),
     ]:
         var = coder.encode(var, name=name)
 
-    # TODO(shoyer): convert all of these to use coders, too:
-    var = maybe_encode_nonstring_dtype(var, name=name)
-    var = maybe_default_fill_value(var)
-    var = maybe_encode_bools(var)
+    # TODO(kmuehlbauer): check if ensure_dtype_not_object can be moved to backends:
     var = ensure_dtype_not_object(var, name=name)
 
     for attr_name in CF_RELATED_DATA:
         pop_to(var.encoding, var.attrs, attr_name)
     return var
 
 
@@ -385,27 +272,23 @@
             var = coder.decode(var, name=name)
 
     if decode_timedelta:
         var = times.CFTimedeltaCoder().decode(var, name=name)
     if decode_times:
         var = times.CFDatetimeCoder(use_cftime=use_cftime).decode(var, name=name)
 
-    dimensions, data, attributes, encoding = variables.unpack_for_decoding(var)
-    # TODO(shoyer): convert everything below to use coders
+    if decode_endianness and not var.dtype.isnative:
+        var = variables.EndianCoder().decode(var)
+        original_dtype = var.dtype
 
-    if decode_endianness and not data.dtype.isnative:
-        # do this last, so it's only done if we didn't already unmask/scale
-        data = NativeEndiannessArray(data)
-        original_dtype = data.dtype
+    var = variables.BooleanCoder().decode(var)
 
-    encoding.setdefault("dtype", original_dtype)
+    dimensions, data, attributes, encoding = variables.unpack_for_decoding(var)
 
-    if "dtype" in attributes and attributes["dtype"] == "bool":
-        del attributes["dtype"]
-        data = BoolTypeArray(data)
+    encoding.setdefault("dtype", original_dtype)
 
     if not is_duck_dask_array(data):
         data = indexing.LazilyIndexedArray(data)
 
     return Variable(dimensions, data, attributes, encoding=encoding, fastpath=True)
```

### Comparing `xarray-2023.3.0/xarray/convert.py` & `xarray-2023.4.0/xarray/convert.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/_aggregations.py` & `xarray-2023.4.0/xarray/core/_aggregations.py`

 * *Files 0% similar despite different names*

```diff
@@ -73,15 +73,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -145,15 +145,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([True, True, True, True, True, False], dtype=bool),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -217,15 +217,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([True, True, True, True, True, False], dtype=bool),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -295,15 +295,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -382,15 +382,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -473,15 +473,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -571,15 +571,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -678,15 +678,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -782,15 +782,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -886,15 +886,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -986,15 +986,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -1077,15 +1077,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -1170,15 +1170,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -1269,15 +1269,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -1335,15 +1335,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([True, True, True, True, True, False], dtype=bool),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ True,  True,  True,  True,  True, False])
         Coordinates:
@@ -1401,15 +1401,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([True, True, True, True, True, False], dtype=bool),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ True,  True,  True,  True,  True, False])
         Coordinates:
@@ -1473,15 +1473,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -1552,15 +1552,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -1635,15 +1635,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -1725,15 +1725,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -1822,15 +1822,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -1916,15 +1916,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -2010,15 +2010,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -2100,15 +2100,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -2183,15 +2183,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -2272,15 +2272,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -2384,15 +2384,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -2482,15 +2482,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([True, True, True, True, True, False], dtype=bool),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -2580,15 +2580,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([True, True, True, True, True, False], dtype=bool),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -2684,15 +2684,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -2800,15 +2800,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -2918,15 +2918,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -3043,15 +3043,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -3180,15 +3180,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -3314,15 +3314,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -3448,15 +3448,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -3578,15 +3578,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -3681,15 +3681,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -3782,15 +3782,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -3898,15 +3898,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -3996,15 +3996,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([True, True, True, True, True, False], dtype=bool),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -4094,15 +4094,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([True, True, True, True, True, False], dtype=bool),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -4198,15 +4198,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -4314,15 +4314,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -4432,15 +4432,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -4557,15 +4557,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -4694,15 +4694,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -4828,15 +4828,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -4962,15 +4962,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -5092,15 +5092,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -5195,15 +5195,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -5296,15 +5296,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> ds = xr.Dataset(dict(da=da))
         >>> ds
         <xarray.Dataset>
         Dimensions:  (time: 6)
@@ -5412,15 +5412,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -5503,15 +5503,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([True, True, True, True, True, False], dtype=bool),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ True,  True,  True,  True,  True, False])
         Coordinates:
@@ -5594,15 +5594,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([True, True, True, True, True, False], dtype=bool),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ True,  True,  True,  True,  True, False])
         Coordinates:
@@ -5691,15 +5691,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -5798,15 +5798,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -5907,15 +5907,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -6023,15 +6023,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -6149,15 +6149,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -6272,15 +6272,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -6395,15 +6395,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -6514,15 +6514,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -6609,15 +6609,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -6706,15 +6706,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -6818,15 +6818,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -6909,15 +6909,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([True, True, True, True, True, False], dtype=bool),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ True,  True,  True,  True,  True, False])
         Coordinates:
@@ -7000,15 +7000,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([True, True, True, True, True, False], dtype=bool),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ True,  True,  True,  True,  True, False])
         Coordinates:
@@ -7097,15 +7097,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -7204,15 +7204,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -7313,15 +7313,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -7429,15 +7429,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -7555,15 +7555,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -7678,15 +7678,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -7801,15 +7801,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -7920,15 +7920,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -8015,15 +8015,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
@@ -8112,15 +8112,15 @@
 
         Examples
         --------
         >>> da = xr.DataArray(
         ...     np.array([1, 2, 3, 1, 2, np.nan]),
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )
         >>> da
         <xarray.DataArray (time: 6)>
         array([ 1.,  2.,  3.,  1.,  2., nan])
         Coordinates:
```

### Comparing `xarray-2023.3.0/xarray/core/_typed_ops.py` & `xarray-2023.4.0/xarray/core/_typed_ops.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/_typed_ops.pyi` & `xarray-2023.4.0/xarray/core/_typed_ops.pyi`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/accessor_dt.py` & `xarray-2023.4.0/xarray/core/accessor_dt.py`

 * *Files 1% similar despite different names*

```diff
@@ -111,15 +111,15 @@
             chunks = (3,) + values.chunksize
             new_axis = 0
 
         return map_blocks(
             access_method, values, name, dtype=dtype, new_axis=new_axis, chunks=chunks
         )
     else:
-        return access_method(values, name)
+        return access_method(values, name).astype(dtype)
 
 
 def _round_through_series_or_index(values, name, freq):
     """Coerce an array of datetime-like values to a pandas Series or xarray
     CFTimeIndex and apply requested rounding
     """
     from xarray.coding.cftimeindex import CFTimeIndex
```

### Comparing `xarray-2023.3.0/xarray/core/accessor_str.py` & `xarray-2023.4.0/xarray/core/accessor_str.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/alignment.py` & `xarray-2023.4.0/xarray/core/alignment.py`

 * *Files 0% similar despite different names*

```diff
@@ -570,14 +570,16 @@
         self.find_matching_unindexed_dims()
         self.assert_no_index_conflict()
         self.align_indexes()
         self.assert_unindexed_dim_sizes_equal()
 
         if self.join == "override":
             self.override_indexes()
+        elif self.join == "exact" and not self.copy:
+            self.results = self.objects
         else:
             self.reindex_all()
 
 
 def align(
     *objects: DataAlignable,
     join: JoinOptions = "inner",
```

### Comparing `xarray-2023.3.0/xarray/core/arithmetic.py` & `xarray-2023.4.0/xarray/core/arithmetic.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/combine.py` & `xarray-2023.4.0/xarray/core/combine.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/common.py` & `xarray-2023.4.0/xarray/core/common.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/computation.py` & `xarray-2023.4.0/xarray/core/computation.py`

 * *Files 1% similar despite different names*

```diff
@@ -11,4687 +11,4683 @@
 000000a0: 7274 206f 7065 7261 746f 720a 696d 706f  rt operator.impo
 000000b0: 7274 2077 6172 6e69 6e67 730a 6672 6f6d  rt warnings.from
 000000c0: 2063 6f6c 6c65 6374 696f 6e73 2069 6d70   collections imp
 000000d0: 6f72 7420 436f 756e 7465 720a 6672 6f6d  ort Counter.from
 000000e0: 2063 6f6c 6c65 6374 696f 6e73 2e61 6263   collections.abc
 000000f0: 2069 6d70 6f72 7420 4861 7368 6162 6c65   import Hashable
 00000100: 2c20 4974 6572 6162 6c65 2c20 4d61 7070  , Iterable, Mapp
-00000110: 696e 672c 2053 6571 7565 6e63 650a 6672  ing, Sequence.fr
-00000120: 6f6d 2074 7970 696e 6720 696d 706f 7274  om typing import
-00000130: 2028 0a20 2020 2054 5950 455f 4348 4543   (.    TYPE_CHEC
-00000140: 4b49 4e47 2c0a 2020 2020 4162 7374 7261  KING,.    Abstra
-00000150: 6374 5365 742c 0a20 2020 2041 6e79 2c0a  ctSet,.    Any,.
-00000160: 2020 2020 4361 6c6c 6162 6c65 2c0a 2020      Callable,.  
-00000170: 2020 4c69 7465 7261 6c2c 0a20 2020 2054    Literal,.    T
-00000180: 7970 6556 6172 2c0a 2020 2020 556e 696f  ypeVar,.    Unio
-00000190: 6e2c 0a20 2020 206f 7665 726c 6f61 642c  n,.    overload,
-000001a0: 0a29 0a0a 696d 706f 7274 206e 756d 7079  .)..import numpy
-000001b0: 2061 7320 6e70 0a0a 6672 6f6d 2078 6172   as np..from xar
-000001c0: 7261 792e 636f 7265 2069 6d70 6f72 7420  ray.core import 
-000001d0: 6474 7970 6573 2c20 6475 636b 5f61 7272  dtypes, duck_arr
-000001e0: 6179 5f6f 7073 2c20 7574 696c 730a 6672  ay_ops, utils.fr
-000001f0: 6f6d 2078 6172 7261 792e 636f 7265 2e61  om xarray.core.a
-00000200: 6c69 676e 6d65 6e74 2069 6d70 6f72 7420  lignment import 
-00000210: 616c 6967 6e2c 2064 6565 705f 616c 6967  align, deep_alig
-00000220: 6e0a 6672 6f6d 2078 6172 7261 792e 636f  n.from xarray.co
-00000230: 7265 2e63 6f6d 6d6f 6e20 696d 706f 7274  re.common import
-00000240: 207a 6572 6f73 5f6c 696b 650a 6672 6f6d   zeros_like.from
-00000250: 2078 6172 7261 792e 636f 7265 2e64 7563   xarray.core.duc
-00000260: 6b5f 6172 7261 795f 6f70 7320 696d 706f  k_array_ops impo
-00000270: 7274 2064 6174 6574 696d 655f 746f 5f6e  rt datetime_to_n
-00000280: 756d 6572 6963 0a66 726f 6d20 7861 7272  umeric.from xarr
-00000290: 6179 2e63 6f72 652e 696e 6465 7865 7320  ay.core.indexes 
-000002a0: 696d 706f 7274 2049 6e64 6578 2c20 6669  import Index, fi
-000002b0: 6c74 6572 5f69 6e64 6578 6573 5f66 726f  lter_indexes_fro
-000002c0: 6d5f 636f 6f72 6473 0a66 726f 6d20 7861  m_coords.from xa
-000002d0: 7272 6179 2e63 6f72 652e 6d65 7267 6520  rray.core.merge 
-000002e0: 696d 706f 7274 206d 6572 6765 5f61 7474  import merge_att
-000002f0: 7273 2c20 6d65 7267 655f 636f 6f72 6469  rs, merge_coordi
-00000300: 6e61 7465 735f 7769 7468 6f75 745f 616c  nates_without_al
-00000310: 6967 6e0a 6672 6f6d 2078 6172 7261 792e  ign.from xarray.
-00000320: 636f 7265 2e6f 7074 696f 6e73 2069 6d70  core.options imp
-00000330: 6f72 7420 4f50 5449 4f4e 532c 205f 6765  ort OPTIONS, _ge
-00000340: 745f 6b65 6570 5f61 7474 7273 0a66 726f  t_keep_attrs.fro
-00000350: 6d20 7861 7272 6179 2e63 6f72 652e 7079  m xarray.core.py
-00000360: 636f 6d70 6174 2069 6d70 6f72 7420 6973  compat import is
-00000370: 5f64 7563 6b5f 6461 736b 5f61 7272 6179  _duck_dask_array
-00000380: 0a66 726f 6d20 7861 7272 6179 2e63 6f72  .from xarray.cor
-00000390: 652e 7479 7065 7320 696d 706f 7274 2044  e.types import D
-000003a0: 696d 732c 2054 5f44 6174 6141 7272 6179  ims, T_DataArray
-000003b0: 0a66 726f 6d20 7861 7272 6179 2e63 6f72  .from xarray.cor
-000003c0: 652e 7574 696c 7320 696d 706f 7274 2069  e.utils import i
-000003d0: 735f 6469 6374 5f6c 696b 652c 2069 735f  s_dict_like, is_
-000003e0: 7363 616c 6172 0a66 726f 6d20 7861 7272  scalar.from xarr
-000003f0: 6179 2e63 6f72 652e 7661 7269 6162 6c65  ay.core.variable
-00000400: 2069 6d70 6f72 7420 5661 7269 6162 6c65   import Variable
-00000410: 0a0a 6966 2054 5950 455f 4348 4543 4b49  ..if TYPE_CHECKI
-00000420: 4e47 3a0a 2020 2020 6672 6f6d 2078 6172  NG:.    from xar
-00000430: 7261 792e 636f 7265 2e63 6f6f 7264 696e  ray.core.coordin
-00000440: 6174 6573 2069 6d70 6f72 7420 436f 6f72  ates import Coor
-00000450: 6469 6e61 7465 730a 2020 2020 6672 6f6d  dinates.    from
-00000460: 2078 6172 7261 792e 636f 7265 2e64 6174   xarray.core.dat
-00000470: 6161 7272 6179 2069 6d70 6f72 7420 4461  aarray import Da
-00000480: 7461 4172 7261 790a 2020 2020 6672 6f6d  taArray.    from
-00000490: 2078 6172 7261 792e 636f 7265 2e64 6174   xarray.core.dat
-000004a0: 6173 6574 2069 6d70 6f72 7420 4461 7461  aset import Data
-000004b0: 7365 740a 2020 2020 6672 6f6d 2078 6172  set.    from xar
-000004c0: 7261 792e 636f 7265 2e74 7970 6573 2069  ray.core.types i
-000004d0: 6d70 6f72 7420 436f 6d62 696e 6541 7474  mport CombineAtt
-000004e0: 7273 4f70 7469 6f6e 732c 204a 6f69 6e4f  rsOptions, JoinO
-000004f0: 7074 696f 6e73 0a0a 5f4e 4f5f 4649 4c4c  ptions.._NO_FILL
-00000500: 5f56 414c 5545 203d 2075 7469 6c73 2e52  _VALUE = utils.R
-00000510: 6570 724f 626a 6563 7428 223c 6e6f 2d66  eprObject("<no-f
-00000520: 696c 6c2d 7661 6c75 653e 2229 0a5f 4445  ill-value>")._DE
-00000530: 4641 554c 545f 4e41 4d45 203d 2075 7469  FAULT_NAME = uti
-00000540: 6c73 2e52 6570 724f 626a 6563 7428 223c  ls.ReprObject("<
-00000550: 6465 6661 756c 742d 6e61 6d65 3e22 290a  default-name>").
-00000560: 5f4a 4f49 4e53 5f57 4954 484f 5554 5f46  _JOINS_WITHOUT_F
-00000570: 494c 4c5f 5641 4c55 4553 203d 2066 726f  ILL_VALUES = fro
-00000580: 7a65 6e73 6574 287b 2269 6e6e 6572 222c  zenset({"inner",
-00000590: 2022 6578 6163 7422 7d29 0a0a 0a64 6566   "exact"})...def
-000005a0: 205f 6669 7273 745f 6f66 5f74 7970 6528   _first_of_type(
-000005b0: 6172 6773 2c20 6b69 6e64 293a 0a20 2020  args, kind):.   
-000005c0: 2022 2222 5265 7475 726e 2065 6974 6865   """Return eithe
-000005d0: 7220 6669 7273 7420 6f62 6a65 6374 206f  r first object o
-000005e0: 6620 7479 7065 2027 6b69 6e64 2720 6f72  f type 'kind' or
-000005f0: 2072 6169 7365 2069 6620 6e6f 7420 666f   raise if not fo
-00000600: 756e 642e 2222 220a 2020 2020 666f 7220  und.""".    for 
-00000610: 6172 6720 696e 2061 7267 733a 0a20 2020  arg in args:.   
-00000620: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00000630: 6365 2861 7267 2c20 6b69 6e64 293a 0a20  ce(arg, kind):. 
-00000640: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00000650: 6e20 6172 670a 2020 2020 7261 6973 6520  n arg.    raise 
-00000660: 5661 6c75 6545 7272 6f72 2822 5468 6973  ValueError("This
-00000670: 2073 686f 756c 6420 6265 2075 6e72 6561   should be unrea
-00000680: 6368 6162 6c65 2e22 290a 0a0a 6465 6620  chable.")...def 
-00000690: 5f61 6c6c 5f6f 665f 7479 7065 2861 7267  _all_of_type(arg
-000006a0: 732c 206b 696e 6429 3a0a 2020 2020 2222  s, kind):.    ""
-000006b0: 2252 6574 7572 6e20 616c 6c20 6f62 6a65  "Return all obje
-000006c0: 6374 7320 6f66 2074 7970 6520 276b 696e  cts of type 'kin
-000006d0: 6427 2222 220a 2020 2020 7265 7475 726e  d'""".    return
-000006e0: 205b 6172 6720 666f 7220 6172 6720 696e   [arg for arg in
-000006f0: 2061 7267 7320 6966 2069 7369 6e73 7461   args if isinsta
-00000700: 6e63 6528 6172 672c 206b 696e 6429 5d0a  nce(arg, kind)].
-00000710: 0a0a 636c 6173 7320 5f55 4675 6e63 5369  ..class _UFuncSi
-00000720: 676e 6174 7572 653a 0a20 2020 2022 2222  gnature:.    """
-00000730: 436f 7265 2064 696d 656e 7369 6f6e 7320  Core dimensions 
-00000740: 7369 676e 6174 7572 6520 666f 7220 6120  signature for a 
-00000750: 6769 7665 6e20 6675 6e63 7469 6f6e 2e0a  given function..
-00000760: 0a20 2020 2042 6173 6564 206f 6e20 7468  .    Based on th
-00000770: 6520 7369 676e 6174 7572 6520 7072 6f76  e signature prov
-00000780: 6964 6564 2062 7920 6765 6e65 7261 6c69  ided by generali
-00000790: 7a65 6420 7566 756e 6373 2069 6e20 4e75  zed ufuncs in Nu
-000007a0: 6d50 792e 0a0a 2020 2020 4174 7472 6962  mPy...    Attrib
-000007b0: 7574 6573 0a20 2020 202d 2d2d 2d2d 2d2d  utes.    -------
-000007c0: 2d2d 2d0a 2020 2020 696e 7075 745f 636f  ---.    input_co
-000007d0: 7265 5f64 696d 7320 3a20 7475 706c 655b  re_dims : tuple[
-000007e0: 7475 706c 655d 0a20 2020 2020 2020 2043  tuple].        C
-000007f0: 6f72 6520 6469 6d65 6e73 696f 6e20 6e61  ore dimension na
-00000800: 6d65 7320 6f6e 2065 6163 6820 696e 7075  mes on each inpu
-00000810: 7420 7661 7269 6162 6c65 2e0a 2020 2020  t variable..    
-00000820: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
-00000830: 203a 2074 7570 6c65 5b74 7570 6c65 5d0a   : tuple[tuple].
-00000840: 2020 2020 2020 2020 436f 7265 2064 696d          Core dim
-00000850: 656e 7369 6f6e 206e 616d 6573 206f 6e20  ension names on 
-00000860: 6561 6368 206f 7574 7075 7420 7661 7269  each output vari
-00000870: 6162 6c65 2e0a 2020 2020 2222 220a 0a20  able..    """.. 
-00000880: 2020 205f 5f73 6c6f 7473 5f5f 203d 2028     __slots__ = (
-00000890: 0a20 2020 2020 2020 2022 696e 7075 745f  .        "input_
-000008a0: 636f 7265 5f64 696d 7322 2c0a 2020 2020  core_dims",.    
-000008b0: 2020 2020 226f 7574 7075 745f 636f 7265      "output_core
-000008c0: 5f64 696d 7322 2c0a 2020 2020 2020 2020  _dims",.        
-000008d0: 225f 616c 6c5f 696e 7075 745f 636f 7265  "_all_input_core
-000008e0: 5f64 696d 7322 2c0a 2020 2020 2020 2020  _dims",.        
-000008f0: 225f 616c 6c5f 6f75 7470 7574 5f63 6f72  "_all_output_cor
-00000900: 655f 6469 6d73 222c 0a20 2020 2020 2020  e_dims",.       
-00000910: 2022 5f61 6c6c 5f63 6f72 655f 6469 6d73   "_all_core_dims
-00000920: 222c 0a20 2020 2029 0a0a 2020 2020 6465  ",.    )..    de
-00000930: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00000940: 2069 6e70 7574 5f63 6f72 655f 6469 6d73   input_core_dims
-00000950: 2c20 6f75 7470 7574 5f63 6f72 655f 6469  , output_core_di
-00000960: 6d73 3d28 2829 2c29 293a 0a20 2020 2020  ms=((),)):.     
-00000970: 2020 2073 656c 662e 696e 7075 745f 636f     self.input_co
-00000980: 7265 5f64 696d 7320 3d20 7475 706c 6528  re_dims = tuple(
-00000990: 7475 706c 6528 6129 2066 6f72 2061 2069  tuple(a) for a i
-000009a0: 6e20 696e 7075 745f 636f 7265 5f64 696d  n input_core_dim
-000009b0: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-000009c0: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
-000009d0: 203d 2074 7570 6c65 2874 7570 6c65 2861   = tuple(tuple(a
-000009e0: 2920 666f 7220 6120 696e 206f 7574 7075  ) for a in outpu
-000009f0: 745f 636f 7265 5f64 696d 7329 0a20 2020  t_core_dims).   
-00000a00: 2020 2020 2073 656c 662e 5f61 6c6c 5f69       self._all_i
-00000a10: 6e70 7574 5f63 6f72 655f 6469 6d73 203d  nput_core_dims =
-00000a20: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-00000a30: 6c66 2e5f 616c 6c5f 6f75 7470 7574 5f63  lf._all_output_c
-00000a40: 6f72 655f 6469 6d73 203d 204e 6f6e 650a  ore_dims = None.
-00000a50: 2020 2020 2020 2020 7365 6c66 2e5f 616c          self._al
-00000a60: 6c5f 636f 7265 5f64 696d 7320 3d20 4e6f  l_core_dims = No
-00000a70: 6e65 0a0a 2020 2020 4070 726f 7065 7274  ne..    @propert
-00000a80: 790a 2020 2020 6465 6620 616c 6c5f 696e  y.    def all_in
-00000a90: 7075 745f 636f 7265 5f64 696d 7328 7365  put_core_dims(se
-00000aa0: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
-00000ab0: 7365 6c66 2e5f 616c 6c5f 696e 7075 745f  self._all_input_
-00000ac0: 636f 7265 5f64 696d 7320 6973 204e 6f6e  core_dims is Non
-00000ad0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00000ae0: 656c 662e 5f61 6c6c 5f69 6e70 7574 5f63  elf._all_input_c
-00000af0: 6f72 655f 6469 6d73 203d 2066 726f 7a65  ore_dims = froze
-00000b00: 6e73 6574 280a 2020 2020 2020 2020 2020  nset(.          
-00000b10: 2020 2020 2020 6469 6d20 666f 7220 6469        dim for di
-00000b20: 6d73 2069 6e20 7365 6c66 2e69 6e70 7574  ms in self.input
-00000b30: 5f63 6f72 655f 6469 6d73 2066 6f72 2064  _core_dims for d
-00000b40: 696d 2069 6e20 6469 6d73 0a20 2020 2020  im in dims.     
-00000b50: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00000b60: 2072 6574 7572 6e20 7365 6c66 2e5f 616c   return self._al
-00000b70: 6c5f 696e 7075 745f 636f 7265 5f64 696d  l_input_core_dim
-00000b80: 730a 0a20 2020 2040 7072 6f70 6572 7479  s..    @property
-00000b90: 0a20 2020 2064 6566 2061 6c6c 5f6f 7574  .    def all_out
-00000ba0: 7075 745f 636f 7265 5f64 696d 7328 7365  put_core_dims(se
-00000bb0: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
-00000bc0: 7365 6c66 2e5f 616c 6c5f 6f75 7470 7574  self._all_output
-00000bd0: 5f63 6f72 655f 6469 6d73 2069 7320 4e6f  _core_dims is No
-00000be0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00000bf0: 7365 6c66 2e5f 616c 6c5f 6f75 7470 7574  self._all_output
-00000c00: 5f63 6f72 655f 6469 6d73 203d 2066 726f  _core_dims = fro
-00000c10: 7a65 6e73 6574 280a 2020 2020 2020 2020  zenset(.        
-00000c20: 2020 2020 2020 2020 6469 6d20 666f 7220          dim for 
-00000c30: 6469 6d73 2069 6e20 7365 6c66 2e6f 7574  dims in self.out
-00000c40: 7075 745f 636f 7265 5f64 696d 7320 666f  put_core_dims fo
-00000c50: 7220 6469 6d20 696e 2064 696d 730a 2020  r dim in dims.  
-00000c60: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00000c70: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00000c80: 5f61 6c6c 5f6f 7574 7075 745f 636f 7265  _all_output_core
-00000c90: 5f64 696d 730a 0a20 2020 2040 7072 6f70  _dims..    @prop
-00000ca0: 6572 7479 0a20 2020 2064 6566 2061 6c6c  erty.    def all
-00000cb0: 5f63 6f72 655f 6469 6d73 2873 656c 6629  _core_dims(self)
-00000cc0: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
-00000cd0: 662e 5f61 6c6c 5f63 6f72 655f 6469 6d73  f._all_core_dims
-00000ce0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00000cf0: 2020 2020 2020 7365 6c66 2e5f 616c 6c5f        self._all_
-00000d00: 636f 7265 5f64 696d 7320 3d20 7365 6c66  core_dims = self
-00000d10: 2e61 6c6c 5f69 6e70 7574 5f63 6f72 655f  .all_input_core_
-00000d20: 6469 6d73 207c 2073 656c 662e 616c 6c5f  dims | self.all_
-00000d30: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
-00000d40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00000d50: 7365 6c66 2e5f 616c 6c5f 636f 7265 5f64  self._all_core_d
-00000d60: 696d 730a 0a20 2020 2040 7072 6f70 6572  ims..    @proper
-00000d70: 7479 0a20 2020 2064 6566 2064 696d 735f  ty.    def dims_
-00000d80: 6d61 7028 7365 6c66 293a 0a20 2020 2020  map(self):.     
-00000d90: 2020 2072 6574 7572 6e20 7b0a 2020 2020     return {.    
-00000da0: 2020 2020 2020 2020 636f 7265 5f64 696d          core_dim
-00000db0: 3a20 6622 6469 6d7b 6e7d 2220 666f 7220  : f"dim{n}" for 
-00000dc0: 6e2c 2063 6f72 655f 6469 6d20 696e 2065  n, core_dim in e
-00000dd0: 6e75 6d65 7261 7465 2873 6f72 7465 6428  numerate(sorted(
-00000de0: 7365 6c66 2e61 6c6c 5f63 6f72 655f 6469  self.all_core_di
-00000df0: 6d73 2929 0a20 2020 2020 2020 207d 0a0a  ms)).        }..
-00000e00: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-00000e10: 2020 6465 6620 6e75 6d5f 696e 7075 7473    def num_inputs
-00000e20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00000e30: 7265 7475 726e 206c 656e 2873 656c 662e  return len(self.
-00000e40: 696e 7075 745f 636f 7265 5f64 696d 7329  input_core_dims)
-00000e50: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00000e60: 2020 2020 6465 6620 6e75 6d5f 6f75 7470      def num_outp
-00000e70: 7574 7328 7365 6c66 293a 0a20 2020 2020  uts(self):.     
-00000e80: 2020 2072 6574 7572 6e20 6c65 6e28 7365     return len(se
-00000e90: 6c66 2e6f 7574 7075 745f 636f 7265 5f64  lf.output_core_d
-00000ea0: 696d 7329 0a0a 2020 2020 6465 6620 5f5f  ims)..    def __
-00000eb0: 6571 5f5f 2873 656c 662c 206f 7468 6572  eq__(self, other
-00000ec0: 293a 0a20 2020 2020 2020 2074 7279 3a0a  ):.        try:.
-00000ed0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00000ee0: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
-00000ef0: 2020 2020 2073 656c 662e 696e 7075 745f       self.input_
-00000f00: 636f 7265 5f64 696d 7320 3d3d 206f 7468  core_dims == oth
-00000f10: 6572 2e69 6e70 7574 5f63 6f72 655f 6469  er.input_core_di
-00000f20: 6d73 0a20 2020 2020 2020 2020 2020 2020  ms.             
-00000f30: 2020 2061 6e64 2073 656c 662e 6f75 7470     and self.outp
-00000f40: 7574 5f63 6f72 655f 6469 6d73 203d 3d20  ut_core_dims == 
-00000f50: 6f74 6865 722e 6f75 7470 7574 5f63 6f72  other.output_cor
-00000f60: 655f 6469 6d73 0a20 2020 2020 2020 2020  e_dims.         
-00000f70: 2020 2029 0a20 2020 2020 2020 2065 7863     ).        exc
-00000f80: 6570 7420 4174 7472 6962 7574 6545 7272  ept AttributeErr
-00000f90: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-00000fa0: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
-00000fb0: 2020 6465 6620 5f5f 6e65 5f5f 2873 656c    def __ne__(sel
-00000fc0: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
-00000fd0: 2020 2072 6574 7572 6e20 6e6f 7420 7365     return not se
-00000fe0: 6c66 203d 3d20 6f74 6865 720a 0a20 2020  lf == other..   
-00000ff0: 2064 6566 205f 5f72 6570 725f 5f28 7365   def __repr__(se
-00001000: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-00001010: 7572 6e20 227b 7d28 7b21 727d 2c20 7b21  urn "{}({!r}, {!
-00001020: 727d 2922 2e66 6f72 6d61 7428 0a20 2020  r})".format(.   
-00001030: 2020 2020 2020 2020 2074 7970 6528 7365           type(se
-00001040: 6c66 292e 5f5f 6e61 6d65 5f5f 2c0a 2020  lf).__name__,.  
-00001050: 2020 2020 2020 2020 2020 6c69 7374 2873            list(s
-00001060: 656c 662e 696e 7075 745f 636f 7265 5f64  elf.input_core_d
-00001070: 696d 7329 2c0a 2020 2020 2020 2020 2020  ims),.          
-00001080: 2020 6c69 7374 2873 656c 662e 6f75 7470    list(self.outp
-00001090: 7574 5f63 6f72 655f 6469 6d73 292c 0a20  ut_core_dims),. 
-000010a0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-000010b0: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
-000010c0: 0a20 2020 2020 2020 206c 6873 203d 2022  .        lhs = "
-000010d0: 2c22 2e6a 6f69 6e28 2228 7b7d 2922 2e66  ,".join("({})".f
-000010e0: 6f72 6d61 7428 222c 222e 6a6f 696e 2864  ormat(",".join(d
-000010f0: 696d 7329 2920 666f 7220 6469 6d73 2069  ims)) for dims i
-00001100: 6e20 7365 6c66 2e69 6e70 7574 5f63 6f72  n self.input_cor
-00001110: 655f 6469 6d73 290a 2020 2020 2020 2020  e_dims).        
-00001120: 7268 7320 3d20 222c 222e 6a6f 696e 2822  rhs = ",".join("
-00001130: 287b 7d29 222e 666f 726d 6174 2822 2c22  ({})".format(","
-00001140: 2e6a 6f69 6e28 6469 6d73 2929 2066 6f72  .join(dims)) for
-00001150: 2064 696d 7320 696e 2073 656c 662e 6f75   dims in self.ou
-00001160: 7470 7574 5f63 6f72 655f 6469 6d73 290a  tput_core_dims).
-00001170: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-00001180: 227b 6c68 737d 2d3e 7b72 6873 7d22 0a0a  "{lhs}->{rhs}"..
-00001190: 2020 2020 6465 6620 746f 5f67 7566 756e      def to_gufun
-000011a0: 635f 7374 7269 6e67 2873 656c 662c 2065  c_string(self, e
-000011b0: 7863 6c75 6465 5f64 696d 733d 6672 6f7a  xclude_dims=froz
-000011c0: 656e 7365 7428 2929 3a0a 2020 2020 2020  enset()):.      
-000011d0: 2020 2222 2243 7265 6174 6520 616e 2065    """Create an e
-000011e0: 7175 6976 616c 656e 7420 7369 676e 6174  quivalent signat
-000011f0: 7572 6520 7374 7269 6e67 2066 6f72 2061  ure string for a
-00001200: 204e 756d 5079 2067 7566 756e 632e 0a0a   NumPy gufunc...
-00001210: 2020 2020 2020 2020 556e 6c69 6b65 205f          Unlike _
-00001220: 5f73 7472 5f5f 2c20 6861 6e64 6c65 7320  _str__, handles 
-00001230: 6469 6d65 6e73 696f 6e73 2074 6861 7420  dimensions that 
-00001240: 646f 6e27 7420 6d61 7020 746f 2050 7974  don't map to Pyt
-00001250: 686f 6e0a 2020 2020 2020 2020 6964 656e  hon.        iden
-00001260: 7469 6669 6572 732e 0a0a 2020 2020 2020  tifiers...      
-00001270: 2020 416c 736f 2063 7265 6174 6573 2075    Also creates u
-00001280: 6e69 7175 6520 6e61 6d65 7320 666f 7220  nique names for 
-00001290: 696e 7075 745f 636f 7265 5f64 696d 7320  input_core_dims 
-000012a0: 636f 6e74 6169 6e65 6420 696e 2065 7863  contained in exc
-000012b0: 6c75 6465 5f64 696d 732e 0a20 2020 2020  lude_dims..     
-000012c0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-000012d0: 6e70 7574 5f63 6f72 655f 6469 6d73 203d  nput_core_dims =
-000012e0: 205b 0a20 2020 2020 2020 2020 2020 205b   [.            [
-000012f0: 7365 6c66 2e64 696d 735f 6d61 705b 6469  self.dims_map[di
-00001300: 6d5d 2066 6f72 2064 696d 2069 6e20 636f  m] for dim in co
-00001310: 7265 5f64 696d 735d 0a20 2020 2020 2020  re_dims].       
-00001320: 2020 2020 2066 6f72 2063 6f72 655f 6469       for core_di
-00001330: 6d73 2069 6e20 7365 6c66 2e69 6e70 7574  ms in self.input
-00001340: 5f63 6f72 655f 6469 6d73 0a20 2020 2020  _core_dims.     
-00001350: 2020 205d 0a20 2020 2020 2020 206f 7574     ].        out
-00001360: 7075 745f 636f 7265 5f64 696d 7320 3d20  put_core_dims = 
-00001370: 5b0a 2020 2020 2020 2020 2020 2020 5b73  [.            [s
-00001380: 656c 662e 6469 6d73 5f6d 6170 5b64 696d  elf.dims_map[dim
-00001390: 5d20 666f 7220 6469 6d20 696e 2063 6f72  ] for dim in cor
-000013a0: 655f 6469 6d73 5d0a 2020 2020 2020 2020  e_dims].        
-000013b0: 2020 2020 666f 7220 636f 7265 5f64 696d      for core_dim
-000013c0: 7320 696e 2073 656c 662e 6f75 7470 7574  s in self.output
-000013d0: 5f63 6f72 655f 6469 6d73 0a20 2020 2020  _core_dims.     
-000013e0: 2020 205d 0a0a 2020 2020 2020 2020 2320     ]..        # 
-000013f0: 656e 756d 6572 6174 6520 696e 7075 745f  enumerate input_
-00001400: 636f 7265 5f64 696d 7320 636f 6e74 6169  core_dims contai
-00001410: 6e65 6420 696e 2065 7863 6c75 6465 5f64  ned in exclude_d
-00001420: 696d 7320 746f 206d 616b 6520 7468 656d  ims to make them
-00001430: 2075 6e69 7175 650a 2020 2020 2020 2020   unique.        
-00001440: 6966 2065 7863 6c75 6465 5f64 696d 733a  if exclude_dims:
-00001450: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00001460: 6c75 6465 5f64 696d 7320 3d20 5b73 656c  lude_dims = [sel
-00001470: 662e 6469 6d73 5f6d 6170 5b64 696d 5d20  f.dims_map[dim] 
-00001480: 666f 7220 6469 6d20 696e 2065 7863 6c75  for dim in exclu
-00001490: 6465 5f64 696d 735d 0a0a 2020 2020 2020  de_dims]..      
-000014a0: 2020 2020 2020 636f 756e 7465 7220 3d20        counter = 
-000014b0: 436f 756e 7465 7228 290a 0a20 2020 2020  Counter()..     
-000014c0: 2020 2020 2020 2064 6566 205f 656e 756d         def _enum
-000014d0: 6572 6174 6528 6469 6d29 3a0a 2020 2020  erate(dim):.    
-000014e0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-000014f0: 696d 2069 6e20 6578 636c 7564 655f 6469  im in exclude_di
-00001500: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-00001510: 2020 2020 2020 2020 6e20 3d20 636f 756e          n = coun
-00001520: 7465 725b 6469 6d5d 0a20 2020 2020 2020  ter[dim].       
-00001530: 2020 2020 2020 2020 2020 2020 2063 6f75               cou
-00001540: 6e74 6572 2e75 7064 6174 6528 5b64 696d  nter.update([dim
-00001550: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00001560: 2020 2020 2020 2064 696d 203d 2066 227b         dim = f"{
-00001570: 6469 6d7d 5f7b 6e7d 220a 2020 2020 2020  dim}_{n}".      
-00001580: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00001590: 2064 696d 0a0a 2020 2020 2020 2020 2020   dim..          
-000015a0: 2020 696e 7075 745f 636f 7265 5f64 696d    input_core_dim
-000015b0: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
-000015c0: 2020 2020 2020 5b5f 656e 756d 6572 6174        [_enumerat
-000015d0: 6528 6469 6d29 2066 6f72 2064 696d 2069  e(dim) for dim i
-000015e0: 6e20 6172 675d 2066 6f72 2061 7267 2069  n arg] for arg i
-000015f0: 6e20 696e 7075 745f 636f 7265 5f64 696d  n input_core_dim
-00001600: 730a 2020 2020 2020 2020 2020 2020 5d0a  s.            ].
-00001610: 0a20 2020 2020 2020 2061 6c74 5f73 6967  .        alt_sig
-00001620: 6e61 7475 7265 203d 2074 7970 6528 7365  nature = type(se
-00001630: 6c66 2928 696e 7075 745f 636f 7265 5f64  lf)(input_core_d
-00001640: 696d 732c 206f 7574 7075 745f 636f 7265  ims, output_core
-00001650: 5f64 696d 7329 0a20 2020 2020 2020 2072  _dims).        r
-00001660: 6574 7572 6e20 7374 7228 616c 745f 7369  eturn str(alt_si
-00001670: 676e 6174 7572 6529 0a0a 0a64 6566 2072  gnature)...def r
-00001680: 6573 756c 745f 6e61 6d65 286f 626a 6563  esult_name(objec
-00001690: 7473 3a20 4974 6572 6162 6c65 5b41 6e79  ts: Iterable[Any
-000016a0: 5d29 202d 3e20 416e 793a 0a20 2020 2023  ]) -> Any:.    #
-000016b0: 2075 7365 2074 6865 2073 616d 6520 6e61   use the same na
-000016c0: 6d69 6e67 2068 6575 7269 7374 6963 7320  ming heuristics 
-000016d0: 6173 2070 616e 6461 733a 0a20 2020 2023  as pandas:.    #
-000016e0: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-000016f0: 636f 6d2f 626c 617a 652f 626c 617a 652f  com/blaze/blaze/
-00001700: 6973 7375 6573 2f34 3538 2369 7373 7565  issues/458#issue
-00001710: 636f 6d6d 656e 742d 3531 3933 3633 3536  comment-51936356
-00001720: 0a20 2020 206e 616d 6573 203d 207b 6765  .    names = {ge
-00001730: 7461 7474 7228 6f62 6a2c 2022 6e61 6d65  tattr(obj, "name
-00001740: 222c 205f 4445 4641 554c 545f 4e41 4d45  ", _DEFAULT_NAME
-00001750: 2920 666f 7220 6f62 6a20 696e 206f 626a  ) for obj in obj
-00001760: 6563 7473 7d0a 2020 2020 6e61 6d65 732e  ects}.    names.
-00001770: 6469 7363 6172 6428 5f44 4546 4155 4c54  discard(_DEFAULT
-00001780: 5f4e 414d 4529 0a20 2020 2069 6620 6c65  _NAME).    if le
-00001790: 6e28 6e61 6d65 7329 203d 3d20 313a 0a20  n(names) == 1:. 
-000017a0: 2020 2020 2020 2028 6e61 6d65 2c29 203d         (name,) =
-000017b0: 206e 616d 6573 0a20 2020 2065 6c73 653a   names.    else:
-000017c0: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
-000017d0: 4e6f 6e65 0a20 2020 2072 6574 7572 6e20  None.    return 
-000017e0: 6e61 6d65 0a0a 0a64 6566 205f 6765 745f  name...def _get_
-000017f0: 636f 6f72 6473 5f6c 6973 7428 6172 6773  coords_list(args
-00001800: 3a20 4974 6572 6162 6c65 5b41 6e79 5d29  : Iterable[Any])
-00001810: 202d 3e20 6c69 7374 5b43 6f6f 7264 696e   -> list[Coordin
-00001820: 6174 6573 5d3a 0a20 2020 2063 6f6f 7264  ates]:.    coord
-00001830: 735f 6c69 7374 203d 205b 5d0a 2020 2020  s_list = [].    
-00001840: 666f 7220 6172 6720 696e 2061 7267 733a  for arg in args:
-00001850: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00001860: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
-00001870: 203d 2061 7267 2e63 6f6f 7264 730a 2020   = arg.coords.  
-00001880: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
-00001890: 7269 6275 7465 4572 726f 723a 0a20 2020  ributeError:.   
-000018a0: 2020 2020 2020 2020 2070 6173 7320 2023           pass  #
-000018b0: 2073 6b69 7020 7468 6973 2061 7267 756d   skip this argum
-000018c0: 656e 740a 2020 2020 2020 2020 656c 7365  ent.        else
-000018d0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-000018e0: 6f72 6473 5f6c 6973 742e 6170 7065 6e64  ords_list.append
-000018f0: 2863 6f6f 7264 7329 0a20 2020 2072 6574  (coords).    ret
-00001900: 7572 6e20 636f 6f72 6473 5f6c 6973 740a  urn coords_list.
-00001910: 0a0a 6465 6620 6275 696c 645f 6f75 7470  ..def build_outp
-00001920: 7574 5f63 6f6f 7264 735f 616e 645f 696e  ut_coords_and_in
-00001930: 6465 7865 7328 0a20 2020 2061 7267 733a  dexes(.    args:
-00001940: 2049 7465 7261 626c 655b 416e 795d 2c0a   Iterable[Any],.
-00001950: 2020 2020 7369 676e 6174 7572 653a 205f      signature: _
-00001960: 5546 756e 6353 6967 6e61 7475 7265 2c0a  UFuncSignature,.
-00001970: 2020 2020 6578 636c 7564 655f 6469 6d73      exclude_dims
-00001980: 3a20 4162 7374 7261 6374 5365 7420 3d20  : AbstractSet = 
-00001990: 6672 6f7a 656e 7365 7428 292c 0a20 2020  frozenset(),.   
-000019a0: 2063 6f6d 6269 6e65 5f61 7474 7273 3a20   combine_attrs: 
-000019b0: 436f 6d62 696e 6541 7474 7273 4f70 7469  CombineAttrsOpti
-000019c0: 6f6e 7320 3d20 226f 7665 7272 6964 6522  ons = "override"
-000019d0: 2c0a 2920 2d3e 2074 7570 6c65 5b6c 6973  ,.) -> tuple[lis
-000019e0: 745b 6469 6374 5b41 6e79 2c20 5661 7269  t[dict[Any, Vari
-000019f0: 6162 6c65 5d5d 2c20 6c69 7374 5b64 6963  able]], list[dic
-00001a00: 745b 416e 792c 2049 6e64 6578 5d5d 5d3a  t[Any, Index]]]:
-00001a10: 0a20 2020 2022 2222 4275 696c 6420 6f75  .    """Build ou
-00001a20: 7470 7574 2063 6f6f 7264 696e 6174 6573  tput coordinates
-00001a30: 2061 6e64 2069 6e64 6578 6573 2066 6f72   and indexes for
-00001a40: 2061 6e20 6f70 6572 6174 696f 6e2e 0a0a   an operation...
-00001a50: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00001a60: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00001a70: 2020 6172 6773 203a 2049 7465 7261 626c    args : Iterabl
-00001a80: 650a 2020 2020 2020 2020 4c69 7374 206f  e.        List o
-00001a90: 6620 7261 7720 6f70 6572 6174 696f 6e20  f raw operation 
-00001aa0: 6172 6775 6d65 6e74 732e 2041 6e79 2076  arguments. Any v
-00001ab0: 616c 6964 2074 7970 6573 2066 6f72 2078  alid types for x
-00001ac0: 6172 7261 7920 6f70 6572 6174 696f 6e73  array operations
-00001ad0: 0a20 2020 2020 2020 2061 7265 204f 4b2c  .        are OK,
-00001ae0: 2065 2e67 2e2c 2073 6361 6c61 7273 2c20   e.g., scalars, 
-00001af0: 5661 7269 6162 6c65 2c20 4461 7461 4172  Variable, DataAr
-00001b00: 7261 792c 2044 6174 6173 6574 2e0a 2020  ray, Dataset..  
-00001b10: 2020 7369 676e 6174 7572 6520 3a20 5f55    signature : _U
-00001b20: 6675 6e63 5369 676e 6174 7572 650a 2020  funcSignature.  
-00001b30: 2020 2020 2020 436f 7265 2064 696d 656e        Core dimen
-00001b40: 7369 6f6e 7320 7369 676e 6174 7572 6520  sions signature 
-00001b50: 666f 7220 7468 6520 6f70 6572 6174 696f  for the operatio
-00001b60: 6e2e 0a20 2020 2065 7863 6c75 6465 5f64  n..    exclude_d
-00001b70: 696d 7320 3a20 7365 742c 206f 7074 696f  ims : set, optio
-00001b80: 6e61 6c0a 2020 2020 2020 2020 4469 6d65  nal.        Dime
-00001b90: 6e73 696f 6e73 2065 7863 6c75 6465 6420  nsions excluded 
-00001ba0: 6672 6f6d 2074 6865 206f 7065 7261 7469  from the operati
-00001bb0: 6f6e 2e20 436f 6f72 6469 6e61 7465 7320  on. Coordinates 
-00001bc0: 616c 6f6e 6720 7468 6573 650a 2020 2020  along these.    
-00001bd0: 2020 2020 6469 6d65 6e73 696f 6e73 2061      dimensions a
-00001be0: 7265 2064 726f 7070 6564 2e0a 2020 2020  re dropped..    
-00001bf0: 636f 6d62 696e 655f 6174 7472 7320 3a20  combine_attrs : 
-00001c00: 7b22 6472 6f70 222c 2022 6964 656e 7469  {"drop", "identi
-00001c10: 6361 6c22 2c20 226e 6f5f 636f 6e66 6c69  cal", "no_confli
-00001c20: 6374 7322 2c20 2264 726f 705f 636f 6e66  cts", "drop_conf
-00001c30: 6c69 6374 7322 2c20 5c0a 2020 2020 2020  licts", \.      
-00001c40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00001c50: 6f76 6572 7269 6465 227d 206f 7220 6361  override"} or ca
-00001c60: 6c6c 6162 6c65 2c20 6465 6661 756c 743a  llable, default:
-00001c70: 2022 6472 6f70 220a 2020 2020 2020 2020   "drop".        
-00001c80: 4120 6361 6c6c 6162 6c65 206f 7220 6120  A callable or a 
-00001c90: 7374 7269 6e67 2069 6e64 6963 6174 696e  string indicatin
-00001ca0: 6720 686f 7720 746f 2063 6f6d 6269 6e65  g how to combine
-00001cb0: 2061 7474 7273 206f 6620 7468 6520 6f62   attrs of the ob
-00001cc0: 6a65 6374 7320 6265 696e 670a 2020 2020  jects being.    
-00001cd0: 2020 2020 6d65 7267 6564 3a0a 0a20 2020      merged:..   
-00001ce0: 2020 2020 202d 2022 6472 6f70 223a 2065       - "drop": e
-00001cf0: 6d70 7479 2061 7474 7273 206f 6e20 7265  mpty attrs on re
-00001d00: 7475 726e 6564 2044 6174 6173 6574 2e0a  turned Dataset..
-00001d10: 2020 2020 2020 2020 2d20 2269 6465 6e74          - "ident
-00001d20: 6963 616c 223a 2061 6c6c 2061 7474 7273  ical": all attrs
-00001d30: 206d 7573 7420 6265 2074 6865 2073 616d   must be the sam
-00001d40: 6520 6f6e 2065 7665 7279 206f 626a 6563  e on every objec
-00001d50: 742e 0a20 2020 2020 2020 202d 2022 6e6f  t..        - "no
-00001d60: 5f63 6f6e 666c 6963 7473 223a 2061 7474  _conflicts": att
-00001d70: 7273 2066 726f 6d20 616c 6c20 6f62 6a65  rs from all obje
-00001d80: 6374 7320 6172 6520 636f 6d62 696e 6564  cts are combined
-00001d90: 2c20 616e 7920 7468 6174 2068 6176 650a  , any that have.
-00001da0: 2020 2020 2020 2020 2020 7468 6520 7361            the sa
-00001db0: 6d65 206e 616d 6520 6d75 7374 2061 6c73  me name must als
-00001dc0: 6f20 6861 7665 2074 6865 2073 616d 6520  o have the same 
-00001dd0: 7661 6c75 652e 0a20 2020 2020 2020 202d  value..        -
-00001de0: 2022 6472 6f70 5f63 6f6e 666c 6963 7473   "drop_conflicts
-00001df0: 223a 2061 7474 7273 2066 726f 6d20 616c  ": attrs from al
-00001e00: 6c20 6f62 6a65 6374 7320 6172 6520 636f  l objects are co
-00001e10: 6d62 696e 6564 2c20 616e 7920 7468 6174  mbined, any that
-00001e20: 2068 6176 650a 2020 2020 2020 2020 2020   have.          
-00001e30: 7468 6520 7361 6d65 206e 616d 6520 6275  the same name bu
-00001e40: 7420 6469 6666 6572 656e 7420 7661 6c75  t different valu
-00001e50: 6573 2061 7265 2064 726f 7070 6564 2e0a  es are dropped..
-00001e60: 2020 2020 2020 2020 2d20 226f 7665 7272          - "overr
-00001e70: 6964 6522 3a20 736b 6970 2063 6f6d 7061  ide": skip compa
-00001e80: 7269 6e67 2061 6e64 2063 6f70 7920 6174  ring and copy at
-00001e90: 7472 7320 6672 6f6d 2074 6865 2066 6972  trs from the fir
-00001ea0: 7374 2064 6174 6173 6574 2074 6f0a 2020  st dataset to.  
-00001eb0: 2020 2020 2020 2020 7468 6520 7265 7375          the resu
-00001ec0: 6c74 2e0a 0a20 2020 2020 2020 2049 6620  lt...        If 
-00001ed0: 6120 6361 6c6c 6162 6c65 2c20 6974 206d  a callable, it m
-00001ee0: 7573 7420 6578 7065 6374 2061 2073 6571  ust expect a seq
-00001ef0: 7565 6e63 6520 6f66 2060 6061 7474 7273  uence of ``attrs
-00001f00: 6060 2064 6963 7473 2061 6e64 2061 2063  `` dicts and a c
-00001f10: 6f6e 7465 7874 206f 626a 6563 740a 2020  ontext object.  
-00001f20: 2020 2020 2020 6173 2069 7473 206f 6e6c        as its onl
-00001f30: 7920 7061 7261 6d65 7465 7273 2e0a 0a20  y parameters... 
-00001f40: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-00001f50: 2d2d 2d2d 2d2d 0a20 2020 2044 6963 7469  ------.    Dicti
-00001f60: 6f6e 6172 6965 7320 6f66 2056 6172 6961  onaries of Varia
-00001f70: 626c 6520 616e 6420 496e 6465 7820 6f62  ble and Index ob
-00001f80: 6a65 6374 7320 7769 7468 206d 6572 6765  jects with merge
-00001f90: 6420 636f 6f72 6469 6e61 7465 732e 0a20  d coordinates.. 
-00001fa0: 2020 2022 2222 0a20 2020 2063 6f6f 7264     """.    coord
-00001fb0: 735f 6c69 7374 203d 205f 6765 745f 636f  s_list = _get_co
-00001fc0: 6f72 6473 5f6c 6973 7428 6172 6773 290a  ords_list(args).
-00001fd0: 0a20 2020 2069 6620 6c65 6e28 636f 6f72  .    if len(coor
-00001fe0: 6473 5f6c 6973 7429 203d 3d20 3120 616e  ds_list) == 1 an
-00001ff0: 6420 6e6f 7420 6578 636c 7564 655f 6469  d not exclude_di
-00002000: 6d73 3a0a 2020 2020 2020 2020 2320 7765  ms:.        # we
-00002010: 2063 616e 2073 6b69 7020 7468 6520 6578   can skip the ex
-00002020: 7065 6e73 6976 6520 6d65 7267 650a 2020  pensive merge.  
-00002030: 2020 2020 2020 2875 6e70 6163 6b65 645f        (unpacked_
-00002040: 636f 6f72 6473 2c29 203d 2063 6f6f 7264  coords,) = coord
-00002050: 735f 6c69 7374 0a20 2020 2020 2020 206d  s_list.        m
-00002060: 6572 6765 645f 7661 7273 203d 2064 6963  erged_vars = dic
-00002070: 7428 756e 7061 636b 6564 5f63 6f6f 7264  t(unpacked_coord
-00002080: 732e 7661 7269 6162 6c65 7329 0a20 2020  s.variables).   
-00002090: 2020 2020 206d 6572 6765 645f 696e 6465       merged_inde
-000020a0: 7865 7320 3d20 6469 6374 2875 6e70 6163  xes = dict(unpac
-000020b0: 6b65 645f 636f 6f72 6473 2e78 696e 6465  ked_coords.xinde
-000020c0: 7865 7329 0a20 2020 2065 6c73 653a 0a20  xes).    else:. 
-000020d0: 2020 2020 2020 206d 6572 6765 645f 7661         merged_va
-000020e0: 7273 2c20 6d65 7267 6564 5f69 6e64 6578  rs, merged_index
-000020f0: 6573 203d 206d 6572 6765 5f63 6f6f 7264  es = merge_coord
-00002100: 696e 6174 6573 5f77 6974 686f 7574 5f61  inates_without_a
-00002110: 6c69 676e 280a 2020 2020 2020 2020 2020  lign(.          
-00002120: 2020 636f 6f72 6473 5f6c 6973 742c 2065    coords_list, e
-00002130: 7863 6c75 6465 5f64 696d 733d 6578 636c  xclude_dims=excl
-00002140: 7564 655f 6469 6d73 2c20 636f 6d62 696e  ude_dims, combin
-00002150: 655f 6174 7472 733d 636f 6d62 696e 655f  e_attrs=combine_
-00002160: 6174 7472 730a 2020 2020 2020 2020 290a  attrs.        ).
-00002170: 0a20 2020 206f 7574 7075 745f 636f 6f72  .    output_coor
-00002180: 6473 203d 205b 5d0a 2020 2020 6f75 7470  ds = [].    outp
-00002190: 7574 5f69 6e64 6578 6573 203d 205b 5d0a  ut_indexes = [].
-000021a0: 2020 2020 666f 7220 6f75 7470 7574 5f64      for output_d
-000021b0: 696d 7320 696e 2073 6967 6e61 7475 7265  ims in signature
-000021c0: 2e6f 7574 7075 745f 636f 7265 5f64 696d  .output_core_dim
-000021d0: 733a 0a20 2020 2020 2020 2064 726f 7070  s:.        dropp
-000021e0: 6564 5f64 696d 7320 3d20 7369 676e 6174  ed_dims = signat
-000021f0: 7572 652e 616c 6c5f 696e 7075 745f 636f  ure.all_input_co
-00002200: 7265 5f64 696d 7320 2d20 7365 7428 6f75  re_dims - set(ou
-00002210: 7470 7574 5f64 696d 7329 0a20 2020 2020  tput_dims).     
-00002220: 2020 2069 6620 6472 6f70 7065 645f 6469     if dropped_di
-00002230: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-00002240: 6669 6c74 6572 6564 5f63 6f6f 7264 7320  filtered_coords 
-00002250: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00002260: 2020 2020 6b3a 2076 2066 6f72 206b 2c20      k: v for k, 
-00002270: 7620 696e 206d 6572 6765 645f 7661 7273  v in merged_vars
-00002280: 2e69 7465 6d73 2829 2069 6620 6472 6f70  .items() if drop
-00002290: 7065 645f 6469 6d73 2e69 7364 6973 6a6f  ped_dims.isdisjo
-000022a0: 696e 7428 762e 6469 6d73 290a 2020 2020  int(v.dims).    
-000022b0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-000022c0: 2020 2020 2020 6669 6c74 6572 6564 5f69        filtered_i
-000022d0: 6e64 6578 6573 203d 2066 696c 7465 725f  ndexes = filter_
-000022e0: 696e 6465 7865 735f 6672 6f6d 5f63 6f6f  indexes_from_coo
-000022f0: 7264 7328 0a20 2020 2020 2020 2020 2020  rds(.           
-00002300: 2020 2020 206d 6572 6765 645f 696e 6465       merged_inde
-00002310: 7865 732c 2073 6574 2866 696c 7465 7265  xes, set(filtere
-00002320: 645f 636f 6f72 6473 290a 2020 2020 2020  d_coords).      
-00002330: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00002340: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00002350: 2020 6669 6c74 6572 6564 5f63 6f6f 7264    filtered_coord
-00002360: 7320 3d20 6d65 7267 6564 5f76 6172 730a  s = merged_vars.
-00002370: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-00002380: 6572 6564 5f69 6e64 6578 6573 203d 206d  ered_indexes = m
-00002390: 6572 6765 645f 696e 6465 7865 730a 2020  erged_indexes.  
-000023a0: 2020 2020 2020 6f75 7470 7574 5f63 6f6f        output_coo
-000023b0: 7264 732e 6170 7065 6e64 2866 696c 7465  rds.append(filte
-000023c0: 7265 645f 636f 6f72 6473 290a 2020 2020  red_coords).    
-000023d0: 2020 2020 6f75 7470 7574 5f69 6e64 6578      output_index
-000023e0: 6573 2e61 7070 656e 6428 6669 6c74 6572  es.append(filter
-000023f0: 6564 5f69 6e64 6578 6573 290a 0a20 2020  ed_indexes)..   
-00002400: 2072 6574 7572 6e20 6f75 7470 7574 5f63   return output_c
-00002410: 6f6f 7264 732c 206f 7574 7075 745f 696e  oords, output_in
-00002420: 6465 7865 730a 0a0a 6465 6620 6170 706c  dexes...def appl
-00002430: 795f 6461 7461 6172 7261 795f 7666 756e  y_dataarray_vfun
-00002440: 6328 0a20 2020 2066 756e 632c 0a20 2020  c(.    func,.   
-00002450: 202a 6172 6773 2c0a 2020 2020 7369 676e   *args,.    sign
-00002460: 6174 7572 653a 205f 5546 756e 6353 6967  ature: _UFuncSig
-00002470: 6e61 7475 7265 2c0a 2020 2020 6a6f 696e  nature,.    join
-00002480: 3a20 4a6f 696e 4f70 7469 6f6e 7320 3d20  : JoinOptions = 
-00002490: 2269 6e6e 6572 222c 0a20 2020 2065 7863  "inner",.    exc
-000024a0: 6c75 6465 5f64 696d 733d 6672 6f7a 656e  lude_dims=frozen
-000024b0: 7365 7428 292c 0a20 2020 206b 6565 705f  set(),.    keep_
-000024c0: 6174 7472 733d 226f 7665 7272 6964 6522  attrs="override"
-000024d0: 2c0a 2920 2d3e 2074 7570 6c65 5b44 6174  ,.) -> tuple[Dat
-000024e0: 6141 7272 6179 2c20 2e2e 2e5d 207c 2044  aArray, ...] | D
-000024f0: 6174 6141 7272 6179 3a0a 2020 2020 2222  ataArray:.    ""
-00002500: 2241 7070 6c79 2061 2076 6172 6961 626c  "Apply a variabl
-00002510: 6520 6c65 7665 6c20 6675 6e63 7469 6f6e  e level function
-00002520: 206f 7665 7220 4461 7461 4172 7261 792c   over DataArray,
-00002530: 2056 6172 6961 626c 6520 616e 642f 6f72   Variable and/or
-00002540: 206e 6461 7272 6179 0a20 2020 206f 626a   ndarray.    obj
-00002550: 6563 7473 2e0a 2020 2020 2222 220a 2020  ects..    """.  
-00002560: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
-00002570: 7265 2e64 6174 6161 7272 6179 2069 6d70  re.dataarray imp
-00002580: 6f72 7420 4461 7461 4172 7261 790a 0a20  ort DataArray.. 
-00002590: 2020 2069 6620 6c65 6e28 6172 6773 2920     if len(args) 
-000025a0: 3e20 313a 0a20 2020 2020 2020 2061 7267  > 1:.        arg
-000025b0: 7320 3d20 6465 6570 5f61 6c69 676e 280a  s = deep_align(.
-000025c0: 2020 2020 2020 2020 2020 2020 6172 6773              args
-000025d0: 2c20 6a6f 696e 3d6a 6f69 6e2c 2063 6f70  , join=join, cop
-000025e0: 793d 4661 6c73 652c 2065 7863 6c75 6465  y=False, exclude
-000025f0: 3d65 7863 6c75 6465 5f64 696d 732c 2072  =exclude_dims, r
-00002600: 6169 7365 5f6f 6e5f 696e 7661 6c69 643d  aise_on_invalid=
-00002610: 4661 6c73 650a 2020 2020 2020 2020 290a  False.        ).
-00002620: 0a20 2020 206f 626a 7320 3d20 5f61 6c6c  .    objs = _all
-00002630: 5f6f 665f 7479 7065 2861 7267 732c 2044  _of_type(args, D
-00002640: 6174 6141 7272 6179 290a 0a20 2020 2069  ataArray)..    i
-00002650: 6620 6b65 6570 5f61 7474 7273 203d 3d20  f keep_attrs == 
-00002660: 2264 726f 7022 3a0a 2020 2020 2020 2020  "drop":.        
-00002670: 6e61 6d65 203d 2072 6573 756c 745f 6e61  name = result_na
-00002680: 6d65 2861 7267 7329 0a20 2020 2065 6c73  me(args).    els
-00002690: 653a 0a20 2020 2020 2020 2066 6972 7374  e:.        first
-000026a0: 5f6f 626a 203d 205f 6669 7273 745f 6f66  _obj = _first_of
-000026b0: 5f74 7970 6528 6172 6773 2c20 4461 7461  _type(args, Data
-000026c0: 4172 7261 7929 0a20 2020 2020 2020 206e  Array).        n
-000026d0: 616d 6520 3d20 6669 7273 745f 6f62 6a2e  ame = first_obj.
-000026e0: 6e61 6d65 0a20 2020 2072 6573 756c 745f  name.    result_
-000026f0: 636f 6f72 6473 2c20 7265 7375 6c74 5f69  coords, result_i
-00002700: 6e64 6578 6573 203d 2062 7569 6c64 5f6f  ndexes = build_o
-00002710: 7574 7075 745f 636f 6f72 6473 5f61 6e64  utput_coords_and
-00002720: 5f69 6e64 6578 6573 280a 2020 2020 2020  _indexes(.      
-00002730: 2020 6172 6773 2c20 7369 676e 6174 7572    args, signatur
-00002740: 652c 2065 7863 6c75 6465 5f64 696d 732c  e, exclude_dims,
-00002750: 2063 6f6d 6269 6e65 5f61 7474 7273 3d6b   combine_attrs=k
-00002760: 6565 705f 6174 7472 730a 2020 2020 290a  eep_attrs.    ).
-00002770: 0a20 2020 2064 6174 615f 7661 7273 203d  .    data_vars =
-00002780: 205b 6765 7461 7474 7228 612c 2022 7661   [getattr(a, "va
-00002790: 7269 6162 6c65 222c 2061 2920 666f 7220  riable", a) for 
-000027a0: 6120 696e 2061 7267 735d 0a20 2020 2072  a in args].    r
-000027b0: 6573 756c 745f 7661 7220 3d20 6675 6e63  esult_var = func
-000027c0: 282a 6461 7461 5f76 6172 7329 0a0a 2020  (*data_vars)..  
-000027d0: 2020 6f75 743a 2074 7570 6c65 5b44 6174    out: tuple[Dat
-000027e0: 6141 7272 6179 2c20 2e2e 2e5d 207c 2044  aArray, ...] | D
-000027f0: 6174 6141 7272 6179 0a20 2020 2069 6620  ataArray.    if 
-00002800: 7369 676e 6174 7572 652e 6e75 6d5f 6f75  signature.num_ou
-00002810: 7470 7574 7320 3e20 313a 0a20 2020 2020  tputs > 1:.     
-00002820: 2020 206f 7574 203d 2074 7570 6c65 280a     out = tuple(.
-00002830: 2020 2020 2020 2020 2020 2020 4461 7461              Data
-00002840: 4172 7261 7928 0a20 2020 2020 2020 2020  Array(.         
-00002850: 2020 2020 2020 2076 6172 6961 626c 652c         variable,
-00002860: 2063 6f6f 7264 733d 636f 6f72 6473 2c20   coords=coords, 
-00002870: 696e 6465 7865 733d 696e 6465 7865 732c  indexes=indexes,
-00002880: 206e 616d 653d 6e61 6d65 2c20 6661 7374   name=name, fast
-00002890: 7061 7468 3d54 7275 650a 2020 2020 2020  path=True.      
-000028a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000028b0: 2020 2020 666f 7220 7661 7269 6162 6c65      for variable
-000028c0: 2c20 636f 6f72 6473 2c20 696e 6465 7865  , coords, indexe
-000028d0: 7320 696e 207a 6970 280a 2020 2020 2020  s in zip(.      
-000028e0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-000028f0: 5f76 6172 2c20 7265 7375 6c74 5f63 6f6f  _var, result_coo
-00002900: 7264 732c 2072 6573 756c 745f 696e 6465  rds, result_inde
-00002910: 7865 730a 2020 2020 2020 2020 2020 2020  xes.            
-00002920: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
-00002930: 656c 7365 3a0a 2020 2020 2020 2020 2863  else:.        (c
-00002940: 6f6f 7264 732c 2920 3d20 7265 7375 6c74  oords,) = result
-00002950: 5f63 6f6f 7264 730a 2020 2020 2020 2020  _coords.        
-00002960: 2869 6e64 6578 6573 2c29 203d 2072 6573  (indexes,) = res
-00002970: 756c 745f 696e 6465 7865 730a 2020 2020  ult_indexes.    
-00002980: 2020 2020 6f75 7420 3d20 4461 7461 4172      out = DataAr
-00002990: 7261 7928 0a20 2020 2020 2020 2020 2020  ray(.           
-000029a0: 2072 6573 756c 745f 7661 722c 2063 6f6f   result_var, coo
-000029b0: 7264 733d 636f 6f72 6473 2c20 696e 6465  rds=coords, inde
-000029c0: 7865 733d 696e 6465 7865 732c 206e 616d  xes=indexes, nam
-000029d0: 653d 6e61 6d65 2c20 6661 7374 7061 7468  e=name, fastpath
-000029e0: 3d54 7275 650a 2020 2020 2020 2020 290a  =True.        ).
-000029f0: 0a20 2020 2061 7474 7273 203d 206d 6572  .    attrs = mer
-00002a00: 6765 5f61 7474 7273 285b 782e 6174 7472  ge_attrs([x.attr
-00002a10: 7320 666f 7220 7820 696e 206f 626a 735d  s for x in objs]
-00002a20: 2c20 636f 6d62 696e 655f 6174 7472 733d  , combine_attrs=
-00002a30: 6b65 6570 5f61 7474 7273 290a 2020 2020  keep_attrs).    
-00002a40: 6966 2069 7369 6e73 7461 6e63 6528 6f75  if isinstance(ou
-00002a50: 742c 2074 7570 6c65 293a 0a20 2020 2020  t, tuple):.     
-00002a60: 2020 2066 6f72 2064 6120 696e 206f 7574     for da in out
-00002a70: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
-00002a80: 2e61 7474 7273 203d 2061 7474 7273 0a20  .attrs = attrs. 
-00002a90: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00002aa0: 206f 7574 2e61 7474 7273 203d 2061 7474   out.attrs = att
-00002ab0: 7273 0a0a 2020 2020 7265 7475 726e 206f  rs..    return o
-00002ac0: 7574 0a0a 0a64 6566 206f 7264 6572 6564  ut...def ordered
-00002ad0: 5f73 6574 5f75 6e69 6f6e 2861 6c6c 5f6b  _set_union(all_k
-00002ae0: 6579 733a 206c 6973 745b 4974 6572 6162  eys: list[Iterab
-00002af0: 6c65 5d29 202d 3e20 4974 6572 6162 6c65  le]) -> Iterable
-00002b00: 3a0a 2020 2020 7265 7475 726e 207b 6b65  :.    return {ke
-00002b10: 793a 204e 6f6e 6520 666f 7220 6b65 7973  y: None for keys
-00002b20: 2069 6e20 616c 6c5f 6b65 7973 2066 6f72   in all_keys for
-00002b30: 206b 6579 2069 6e20 6b65 7973 7d2e 6b65   key in keys}.ke
-00002b40: 7973 2829 0a0a 0a64 6566 206f 7264 6572  ys()...def order
-00002b50: 6564 5f73 6574 5f69 6e74 6572 7365 6374  ed_set_intersect
-00002b60: 696f 6e28 616c 6c5f 6b65 7973 3a20 6c69  ion(all_keys: li
-00002b70: 7374 5b49 7465 7261 626c 655d 2920 2d3e  st[Iterable]) ->
-00002b80: 2049 7465 7261 626c 653a 0a20 2020 2069   Iterable:.    i
-00002b90: 6e74 6572 7365 6374 696f 6e20 3d20 7365  ntersection = se
-00002ba0: 7428 616c 6c5f 6b65 7973 5b30 5d29 0a20  t(all_keys[0]). 
-00002bb0: 2020 2066 6f72 206b 6579 7320 696e 2061     for keys in a
-00002bc0: 6c6c 5f6b 6579 735b 313a 5d3a 0a20 2020  ll_keys[1:]:.   
-00002bd0: 2020 2020 2069 6e74 6572 7365 6374 696f       intersectio
-00002be0: 6e2e 696e 7465 7273 6563 7469 6f6e 5f75  n.intersection_u
-00002bf0: 7064 6174 6528 6b65 7973 290a 2020 2020  pdate(keys).    
-00002c00: 7265 7475 726e 205b 6b65 7920 666f 7220  return [key for 
-00002c10: 6b65 7920 696e 2061 6c6c 5f6b 6579 735b  key in all_keys[
-00002c20: 305d 2069 6620 6b65 7920 696e 2069 6e74  0] if key in int
-00002c30: 6572 7365 6374 696f 6e5d 0a0a 0a64 6566  ersection]...def
-00002c40: 2061 7373 6572 745f 616e 645f 7265 7475   assert_and_retu
-00002c50: 726e 5f65 7861 6374 5f6d 6174 6368 2861  rn_exact_match(a
-00002c60: 6c6c 5f6b 6579 7329 3a0a 2020 2020 6669  ll_keys):.    fi
-00002c70: 7273 745f 6b65 7973 203d 2061 6c6c 5f6b  rst_keys = all_k
-00002c80: 6579 735b 305d 0a20 2020 2066 6f72 206b  eys[0].    for k
-00002c90: 6579 7320 696e 2061 6c6c 5f6b 6579 735b  eys in all_keys[
-00002ca0: 313a 5d3a 0a20 2020 2020 2020 2069 6620  1:]:.        if 
-00002cb0: 6b65 7973 2021 3d20 6669 7273 745f 6b65  keys != first_ke
-00002cc0: 7973 3a0a 2020 2020 2020 2020 2020 2020  ys:.            
-00002cd0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00002ce0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00002cf0: 2020 2265 7861 6374 206d 6174 6368 2072    "exact match r
-00002d00: 6571 7569 7265 6420 666f 7220 616c 6c20  equired for all 
-00002d10: 6461 7461 2076 6172 6961 626c 6520 6e61  data variable na
-00002d20: 6d65 732c 2022 0a20 2020 2020 2020 2020  mes, ".         
-00002d30: 2020 2020 2020 2066 2262 7574 207b 6b65         f"but {ke
-00002d40: 7973 2172 7d20 213d 207b 6669 7273 745f  ys!r} != {first_
-00002d50: 6b65 7973 2172 7d22 0a20 2020 2020 2020  keys!r}".       
-00002d60: 2020 2020 2029 0a20 2020 2072 6574 7572       ).    retur
-00002d70: 6e20 6669 7273 745f 6b65 7973 0a0a 0a5f  n first_keys..._
-00002d80: 4a4f 494e 4552 533a 2064 6963 745b 7374  JOINERS: dict[st
-00002d90: 722c 2043 616c 6c61 626c 655d 203d 207b  r, Callable] = {
-00002da0: 0a20 2020 2022 696e 6e65 7222 3a20 6f72  .    "inner": or
-00002db0: 6465 7265 645f 7365 745f 696e 7465 7273  dered_set_inters
-00002dc0: 6563 7469 6f6e 2c0a 2020 2020 226f 7574  ection,.    "out
-00002dd0: 6572 223a 206f 7264 6572 6564 5f73 6574  er": ordered_set
-00002de0: 5f75 6e69 6f6e 2c0a 2020 2020 226c 6566  _union,.    "lef
-00002df0: 7422 3a20 6f70 6572 6174 6f72 2e69 7465  t": operator.ite
-00002e00: 6d67 6574 7465 7228 3029 2c0a 2020 2020  mgetter(0),.    
-00002e10: 2272 6967 6874 223a 206f 7065 7261 746f  "right": operato
-00002e20: 722e 6974 656d 6765 7474 6572 282d 3129  r.itemgetter(-1)
-00002e30: 2c0a 2020 2020 2265 7861 6374 223a 2061  ,.    "exact": a
-00002e40: 7373 6572 745f 616e 645f 7265 7475 726e  ssert_and_return
-00002e50: 5f65 7861 6374 5f6d 6174 6368 2c0a 7d0a  _exact_match,.}.
-00002e60: 0a0a 6465 6620 6a6f 696e 5f64 6963 745f  ..def join_dict_
-00002e70: 6b65 7973 286f 626a 6563 7473 3a20 4974  keys(objects: It
-00002e80: 6572 6162 6c65 5b4d 6170 7069 6e67 207c  erable[Mapping |
-00002e90: 2041 6e79 5d2c 2068 6f77 3a20 7374 7220   Any], how: str 
-00002ea0: 3d20 2269 6e6e 6572 2229 202d 3e20 4974  = "inner") -> It
-00002eb0: 6572 6162 6c65 3a0a 2020 2020 6a6f 696e  erable:.    join
-00002ec0: 6572 203d 205f 4a4f 494e 4552 535b 686f  er = _JOINERS[ho
-00002ed0: 775d 0a20 2020 2061 6c6c 5f6b 6579 7320  w].    all_keys 
-00002ee0: 3d20 5b6f 626a 2e6b 6579 7328 2920 666f  = [obj.keys() fo
-00002ef0: 7220 6f62 6a20 696e 206f 626a 6563 7473  r obj in objects
-00002f00: 2069 6620 6861 7361 7474 7228 6f62 6a2c   if hasattr(obj,
-00002f10: 2022 6b65 7973 2229 5d0a 2020 2020 7265   "keys")].    re
-00002f20: 7475 726e 206a 6f69 6e65 7228 616c 6c5f  turn joiner(all_
-00002f30: 6b65 7973 290a 0a0a 6465 6620 636f 6c6c  keys)...def coll
-00002f40: 6563 745f 6469 6374 5f76 616c 7565 7328  ect_dict_values(
-00002f50: 0a20 2020 206f 626a 6563 7473 3a20 4974  .    objects: It
-00002f60: 6572 6162 6c65 5b4d 6170 7069 6e67 207c  erable[Mapping |
-00002f70: 2041 6e79 5d2c 206b 6579 733a 2049 7465   Any], keys: Ite
-00002f80: 7261 626c 652c 2066 696c 6c5f 7661 6c75  rable, fill_valu
-00002f90: 653a 206f 626a 6563 7420 3d20 4e6f 6e65  e: object = None
-00002fa0: 0a29 202d 3e20 6c69 7374 5b6c 6973 745d  .) -> list[list]
-00002fb0: 3a0a 2020 2020 7265 7475 726e 205b 0a20  :.    return [. 
-00002fc0: 2020 2020 2020 205b 6f62 6a2e 6765 7428         [obj.get(
-00002fd0: 6b65 792c 2066 696c 6c5f 7661 6c75 6529  key, fill_value)
-00002fe0: 2069 6620 6973 5f64 6963 745f 6c69 6b65   if is_dict_like
-00002ff0: 286f 626a 2920 656c 7365 206f 626a 2066  (obj) else obj f
-00003000: 6f72 206f 626a 2069 6e20 6f62 6a65 6374  or obj in object
-00003010: 735d 0a20 2020 2020 2020 2066 6f72 206b  s].        for k
-00003020: 6579 2069 6e20 6b65 7973 0a20 2020 205d  ey in keys.    ]
-00003030: 0a0a 0a64 6566 205f 6173 5f76 6172 6961  ...def _as_varia
-00003040: 626c 6573 5f6f 725f 7661 7269 6162 6c65  bles_or_variable
-00003050: 2861 7267 293a 0a20 2020 2074 7279 3a0a  (arg):.    try:.
-00003060: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00003070: 7267 2e76 6172 6961 626c 6573 0a20 2020  rg.variables.   
-00003080: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
-00003090: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
-000030a0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-000030b0: 2072 6574 7572 6e20 6172 672e 7661 7269   return arg.vari
-000030c0: 6162 6c65 0a20 2020 2020 2020 2065 7863  able.        exc
-000030d0: 6570 7420 4174 7472 6962 7574 6545 7272  ept AttributeErr
-000030e0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-000030f0: 7265 7475 726e 2061 7267 0a0a 0a64 6566  return arg...def
-00003100: 205f 756e 7061 636b 5f64 6963 745f 7475   _unpack_dict_tu
-00003110: 706c 6573 280a 2020 2020 7265 7375 6c74  ples(.    result
-00003120: 5f76 6172 733a 204d 6170 7069 6e67 5b41  _vars: Mapping[A
-00003130: 6e79 2c20 7475 706c 655b 5661 7269 6162  ny, tuple[Variab
-00003140: 6c65 2c20 2e2e 2e5d 5d2c 206e 756d 5f6f  le, ...]], num_o
-00003150: 7574 7075 7473 3a20 696e 740a 2920 2d3e  utputs: int.) ->
-00003160: 2074 7570 6c65 5b64 6963 745b 4861 7368   tuple[dict[Hash
-00003170: 6162 6c65 2c20 5661 7269 6162 6c65 5d2c  able, Variable],
-00003180: 202e 2e2e 5d3a 0a20 2020 206f 7574 3a20   ...]:.    out: 
-00003190: 7475 706c 655b 6469 6374 5b48 6173 6861  tuple[dict[Hasha
-000031a0: 626c 652c 2056 6172 6961 626c 655d 2c20  ble, Variable], 
-000031b0: 2e2e 2e5d 203d 2074 7570 6c65 287b 7d20  ...] = tuple({} 
-000031c0: 666f 7220 5f20 696e 2072 616e 6765 286e  for _ in range(n
-000031d0: 756d 5f6f 7574 7075 7473 2929 0a20 2020  um_outputs)).   
-000031e0: 2066 6f72 206e 616d 652c 2076 616c 7565   for name, value
-000031f0: 7320 696e 2072 6573 756c 745f 7661 7273  s in result_vars
-00003200: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00003210: 2020 666f 7220 7661 6c75 652c 2072 6573    for value, res
-00003220: 756c 7473 5f64 6963 7420 696e 207a 6970  ults_dict in zip
-00003230: 2876 616c 7565 732c 206f 7574 293a 0a20  (values, out):. 
-00003240: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00003250: 7473 5f64 6963 745b 6e61 6d65 5d20 3d20  ts_dict[name] = 
-00003260: 7661 6c75 650a 2020 2020 7265 7475 726e  value.    return
-00003270: 206f 7574 0a0a 0a64 6566 2061 7070 6c79   out...def apply
-00003280: 5f64 6963 745f 6f66 5f76 6172 6961 626c  _dict_of_variabl
-00003290: 6573 5f76 6675 6e63 280a 2020 2020 6675  es_vfunc(.    fu
-000032a0: 6e63 2c20 2a61 7267 732c 2073 6967 6e61  nc, *args, signa
-000032b0: 7475 7265 3a20 5f55 4675 6e63 5369 676e  ture: _UFuncSign
-000032c0: 6174 7572 652c 206a 6f69 6e3d 2269 6e6e  ature, join="inn
-000032d0: 6572 222c 2066 696c 6c5f 7661 6c75 653d  er", fill_value=
-000032e0: 4e6f 6e65 0a29 3a0a 2020 2020 2222 2241  None.):.    """A
-000032f0: 7070 6c79 2061 2076 6172 6961 626c 6520  pply a variable 
-00003300: 6c65 7665 6c20 6675 6e63 7469 6f6e 206f  level function o
-00003310: 7665 7220 6469 6374 7320 6f66 2044 6174  ver dicts of Dat
-00003320: 6141 7272 6179 2c20 4461 7461 4172 7261  aArray, DataArra
-00003330: 792c 0a20 2020 2056 6172 6961 626c 6520  y,.    Variable 
-00003340: 616e 6420 6e64 6172 7261 7920 6f62 6a65  and ndarray obje
-00003350: 6374 732e 0a20 2020 2022 2222 0a20 2020  cts..    """.   
-00003360: 2061 7267 7320 3d20 7475 706c 6528 5f61   args = tuple(_a
-00003370: 735f 7661 7269 6162 6c65 735f 6f72 5f76  s_variables_or_v
-00003380: 6172 6961 626c 6528 6172 6729 2066 6f72  ariable(arg) for
-00003390: 2061 7267 2069 6e20 6172 6773 290a 2020   arg in args).  
-000033a0: 2020 6e61 6d65 7320 3d20 6a6f 696e 5f64    names = join_d
-000033b0: 6963 745f 6b65 7973 2861 7267 732c 2068  ict_keys(args, h
-000033c0: 6f77 3d6a 6f69 6e29 0a20 2020 2067 726f  ow=join).    gro
-000033d0: 7570 6564 5f62 795f 6e61 6d65 203d 2063  uped_by_name = c
-000033e0: 6f6c 6c65 6374 5f64 6963 745f 7661 6c75  ollect_dict_valu
-000033f0: 6573 2861 7267 732c 206e 616d 6573 2c20  es(args, names, 
-00003400: 6669 6c6c 5f76 616c 7565 290a 0a20 2020  fill_value)..   
-00003410: 2072 6573 756c 745f 7661 7273 203d 207b   result_vars = {
-00003420: 7d0a 2020 2020 666f 7220 6e61 6d65 2c20  }.    for name, 
-00003430: 7661 7269 6162 6c65 5f61 7267 7320 696e  variable_args in
-00003440: 207a 6970 286e 616d 6573 2c20 6772 6f75   zip(names, grou
-00003450: 7065 645f 6279 5f6e 616d 6529 3a0a 2020  ped_by_name):.  
-00003460: 2020 2020 2020 7265 7375 6c74 5f76 6172        result_var
-00003470: 735b 6e61 6d65 5d20 3d20 6675 6e63 282a  s[name] = func(*
-00003480: 7661 7269 6162 6c65 5f61 7267 7329 0a0a  variable_args)..
-00003490: 2020 2020 6966 2073 6967 6e61 7475 7265      if signature
-000034a0: 2e6e 756d 5f6f 7574 7075 7473 203e 2031  .num_outputs > 1
-000034b0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000034c0: 205f 756e 7061 636b 5f64 6963 745f 7475   _unpack_dict_tu
-000034d0: 706c 6573 2872 6573 756c 745f 7661 7273  ples(result_vars
-000034e0: 2c20 7369 676e 6174 7572 652e 6e75 6d5f  , signature.num_
-000034f0: 6f75 7470 7574 7329 0a20 2020 2065 6c73  outputs).    els
-00003500: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
-00003510: 6e20 7265 7375 6c74 5f76 6172 730a 0a0a  n result_vars...
-00003520: 6465 6620 5f66 6173 745f 6461 7461 7365  def _fast_datase
-00003530: 7428 0a20 2020 2076 6172 6961 626c 6573  t(.    variables
-00003540: 3a20 6469 6374 5b48 6173 6861 626c 652c  : dict[Hashable,
-00003550: 2056 6172 6961 626c 655d 2c0a 2020 2020   Variable],.    
-00003560: 636f 6f72 645f 7661 7269 6162 6c65 733a  coord_variables:
-00003570: 204d 6170 7069 6e67 5b48 6173 6861 626c   Mapping[Hashabl
-00003580: 652c 2056 6172 6961 626c 655d 2c0a 2020  e, Variable],.  
-00003590: 2020 696e 6465 7865 733a 2064 6963 745b    indexes: dict[
-000035a0: 4861 7368 6162 6c65 2c20 496e 6465 785d  Hashable, Index]
-000035b0: 2c0a 2920 2d3e 2044 6174 6173 6574 3a0a  ,.) -> Dataset:.
-000035c0: 2020 2020 2222 2243 7265 6174 6520 6120      """Create a 
-000035d0: 6461 7461 7365 7420 6173 2071 7569 636b  dataset as quick
-000035e0: 6c79 2061 7320 706f 7373 6962 6c65 2e0a  ly as possible..
-000035f0: 0a20 2020 2042 6577 6172 653a 2074 6865  .    Beware: the
-00003600: 2060 7661 7269 6162 6c65 7360 2064 6963   `variables` dic
-00003610: 7420 6973 206d 6f64 6966 6965 6420 494e  t is modified IN
-00003620: 504c 4143 452e 0a20 2020 2022 2222 0a20  PLACE..    """. 
-00003630: 2020 2066 726f 6d20 7861 7272 6179 2e63     from xarray.c
-00003640: 6f72 652e 6461 7461 7365 7420 696d 706f  ore.dataset impo
-00003650: 7274 2044 6174 6173 6574 0a0a 2020 2020  rt Dataset..    
-00003660: 7661 7269 6162 6c65 732e 7570 6461 7465  variables.update
-00003670: 2863 6f6f 7264 5f76 6172 6961 626c 6573  (coord_variables
-00003680: 290a 2020 2020 636f 6f72 645f 6e61 6d65  ).    coord_name
-00003690: 7320 3d20 7365 7428 636f 6f72 645f 7661  s = set(coord_va
-000036a0: 7269 6162 6c65 7329 0a20 2020 2072 6574  riables).    ret
-000036b0: 7572 6e20 4461 7461 7365 742e 5f63 6f6e  urn Dataset._con
-000036c0: 7374 7275 6374 5f64 6972 6563 7428 7661  struct_direct(va
-000036d0: 7269 6162 6c65 732c 2063 6f6f 7264 5f6e  riables, coord_n
-000036e0: 616d 6573 2c20 696e 6465 7865 733d 696e  ames, indexes=in
-000036f0: 6465 7865 7329 0a0a 0a64 6566 2061 7070  dexes)...def app
-00003700: 6c79 5f64 6174 6173 6574 5f76 6675 6e63  ly_dataset_vfunc
-00003710: 280a 2020 2020 6675 6e63 2c0a 2020 2020  (.    func,.    
-00003720: 2a61 7267 732c 0a20 2020 2073 6967 6e61  *args,.    signa
-00003730: 7475 7265 3a20 5f55 4675 6e63 5369 676e  ture: _UFuncSign
-00003740: 6174 7572 652c 0a20 2020 206a 6f69 6e3d  ature,.    join=
-00003750: 2269 6e6e 6572 222c 0a20 2020 2064 6174  "inner",.    dat
-00003760: 6173 6574 5f6a 6f69 6e3d 2265 7861 6374  aset_join="exact
-00003770: 222c 0a20 2020 2066 696c 6c5f 7661 6c75  ",.    fill_valu
-00003780: 653d 5f4e 4f5f 4649 4c4c 5f56 414c 5545  e=_NO_FILL_VALUE
-00003790: 2c0a 2020 2020 6578 636c 7564 655f 6469  ,.    exclude_di
-000037a0: 6d73 3d66 726f 7a65 6e73 6574 2829 2c0a  ms=frozenset(),.
-000037b0: 2020 2020 6b65 6570 5f61 7474 7273 3d22      keep_attrs="
-000037c0: 6f76 6572 7269 6465 222c 0a29 202d 3e20  override",.) -> 
-000037d0: 4461 7461 7365 7420 7c20 7475 706c 655b  Dataset | tuple[
-000037e0: 4461 7461 7365 742c 202e 2e2e 5d3a 0a20  Dataset, ...]:. 
-000037f0: 2020 2022 2222 4170 706c 7920 6120 7661     """Apply a va
-00003800: 7269 6162 6c65 206c 6576 656c 2066 756e  riable level fun
-00003810: 6374 696f 6e20 6f76 6572 2044 6174 6173  ction over Datas
-00003820: 6574 2c20 6469 6374 206f 6620 4461 7461  et, dict of Data
-00003830: 4172 7261 792c 0a20 2020 2044 6174 6141  Array,.    DataA
-00003840: 7272 6179 2c20 5661 7269 6162 6c65 2061  rray, Variable a
-00003850: 6e64 2f6f 7220 6e64 6172 7261 7920 6f62  nd/or ndarray ob
-00003860: 6a65 6374 732e 0a20 2020 2022 2222 0a20  jects..    """. 
-00003870: 2020 2066 726f 6d20 7861 7272 6179 2e63     from xarray.c
-00003880: 6f72 652e 6461 7461 7365 7420 696d 706f  ore.dataset impo
-00003890: 7274 2044 6174 6173 6574 0a0a 2020 2020  rt Dataset..    
-000038a0: 6966 2064 6174 6173 6574 5f6a 6f69 6e20  if dataset_join 
-000038b0: 6e6f 7420 696e 205f 4a4f 494e 535f 5749  not in _JOINS_WI
-000038c0: 5448 4f55 545f 4649 4c4c 5f56 414c 5545  THOUT_FILL_VALUE
-000038d0: 5320 616e 6420 6669 6c6c 5f76 616c 7565  S and fill_value
-000038e0: 2069 7320 5f4e 4f5f 4649 4c4c 5f56 414c   is _NO_FILL_VAL
-000038f0: 5545 3a0a 2020 2020 2020 2020 7261 6973  UE:.        rais
-00003900: 6520 5479 7065 4572 726f 7228 0a20 2020  e TypeError(.   
-00003910: 2020 2020 2020 2020 2022 746f 2061 7070           "to app
-00003920: 6c79 2061 6e20 6f70 6572 6174 696f 6e20  ly an operation 
-00003930: 746f 2064 6174 6173 6574 7320 7769 7468  to datasets with
-00003940: 2064 6966 6665 7265 6e74 2022 0a20 2020   different ".   
-00003950: 2020 2020 2020 2020 2022 6461 7461 2076           "data v
-00003960: 6172 6961 626c 6573 2077 6974 6820 6170  ariables with ap
-00003970: 706c 795f 7566 756e 632c 2079 6f75 206d  ply_ufunc, you m
-00003980: 7573 7420 7375 7070 6c79 2074 6865 2022  ust supply the "
-00003990: 0a20 2020 2020 2020 2020 2020 2022 6461  .            "da
-000039a0: 7461 7365 745f 6669 6c6c 5f76 616c 7565  taset_fill_value
-000039b0: 2061 7267 756d 656e 742e 220a 2020 2020   argument.".    
-000039c0: 2020 2020 290a 0a20 2020 206f 626a 7320      )..    objs 
-000039d0: 3d20 5f61 6c6c 5f6f 665f 7479 7065 2861  = _all_of_type(a
-000039e0: 7267 732c 2044 6174 6173 6574 290a 0a20  rgs, Dataset).. 
-000039f0: 2020 2069 6620 6c65 6e28 6172 6773 2920     if len(args) 
-00003a00: 3e20 313a 0a20 2020 2020 2020 2061 7267  > 1:.        arg
-00003a10: 7320 3d20 6465 6570 5f61 6c69 676e 280a  s = deep_align(.
-00003a20: 2020 2020 2020 2020 2020 2020 6172 6773              args
-00003a30: 2c20 6a6f 696e 3d6a 6f69 6e2c 2063 6f70  , join=join, cop
-00003a40: 793d 4661 6c73 652c 2065 7863 6c75 6465  y=False, exclude
-00003a50: 3d65 7863 6c75 6465 5f64 696d 732c 2072  =exclude_dims, r
-00003a60: 6169 7365 5f6f 6e5f 696e 7661 6c69 643d  aise_on_invalid=
-00003a70: 4661 6c73 650a 2020 2020 2020 2020 290a  False.        ).
-00003a80: 0a20 2020 206c 6973 745f 6f66 5f63 6f6f  .    list_of_coo
-00003a90: 7264 732c 206c 6973 745f 6f66 5f69 6e64  rds, list_of_ind
-00003aa0: 6578 6573 203d 2062 7569 6c64 5f6f 7574  exes = build_out
-00003ab0: 7075 745f 636f 6f72 6473 5f61 6e64 5f69  put_coords_and_i
-00003ac0: 6e64 6578 6573 280a 2020 2020 2020 2020  ndexes(.        
-00003ad0: 6172 6773 2c20 7369 676e 6174 7572 652c  args, signature,
-00003ae0: 2065 7863 6c75 6465 5f64 696d 732c 2063   exclude_dims, c
-00003af0: 6f6d 6269 6e65 5f61 7474 7273 3d6b 6565  ombine_attrs=kee
-00003b00: 705f 6174 7472 730a 2020 2020 290a 2020  p_attrs.    ).  
-00003b10: 2020 6172 6773 203d 2074 7570 6c65 2867    args = tuple(g
-00003b20: 6574 6174 7472 2861 7267 2c20 2264 6174  etattr(arg, "dat
-00003b30: 615f 7661 7273 222c 2061 7267 2920 666f  a_vars", arg) fo
-00003b40: 7220 6172 6720 696e 2061 7267 7329 0a0a  r arg in args)..
-00003b50: 2020 2020 7265 7375 6c74 5f76 6172 7320      result_vars 
-00003b60: 3d20 6170 706c 795f 6469 6374 5f6f 665f  = apply_dict_of_
-00003b70: 7661 7269 6162 6c65 735f 7666 756e 6328  variables_vfunc(
-00003b80: 0a20 2020 2020 2020 2066 756e 632c 202a  .        func, *
-00003b90: 6172 6773 2c20 7369 676e 6174 7572 653d  args, signature=
-00003ba0: 7369 676e 6174 7572 652c 206a 6f69 6e3d  signature, join=
-00003bb0: 6461 7461 7365 745f 6a6f 696e 2c20 6669  dataset_join, fi
-00003bc0: 6c6c 5f76 616c 7565 3d66 696c 6c5f 7661  ll_value=fill_va
-00003bd0: 6c75 650a 2020 2020 290a 0a20 2020 206f  lue.    )..    o
-00003be0: 7574 3a20 4461 7461 7365 7420 7c20 7475  ut: Dataset | tu
-00003bf0: 706c 655b 4461 7461 7365 742c 202e 2e2e  ple[Dataset, ...
-00003c00: 5d0a 2020 2020 6966 2073 6967 6e61 7475  ].    if signatu
-00003c10: 7265 2e6e 756d 5f6f 7574 7075 7473 203e  re.num_outputs >
-00003c20: 2031 3a0a 2020 2020 2020 2020 6f75 7420   1:.        out 
-00003c30: 3d20 7475 706c 6528 0a20 2020 2020 2020  = tuple(.       
-00003c40: 2020 2020 205f 6661 7374 5f64 6174 6173       _fast_datas
-00003c50: 6574 282a 6172 6773 290a 2020 2020 2020  et(*args).      
-00003c60: 2020 2020 2020 666f 7220 6172 6773 2069        for args i
-00003c70: 6e20 7a69 7028 7265 7375 6c74 5f76 6172  n zip(result_var
-00003c80: 732c 206c 6973 745f 6f66 5f63 6f6f 7264  s, list_of_coord
-00003c90: 732c 206c 6973 745f 6f66 5f69 6e64 6578  s, list_of_index
-00003ca0: 6573 290a 2020 2020 2020 2020 290a 2020  es).        ).  
-00003cb0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00003cc0: 2863 6f6f 7264 5f76 6172 732c 2920 3d20  (coord_vars,) = 
-00003cd0: 6c69 7374 5f6f 665f 636f 6f72 6473 0a20  list_of_coords. 
-00003ce0: 2020 2020 2020 2028 696e 6465 7865 732c         (indexes,
-00003cf0: 2920 3d20 6c69 7374 5f6f 665f 696e 6465  ) = list_of_inde
-00003d00: 7865 730a 2020 2020 2020 2020 6f75 7420  xes.        out 
-00003d10: 3d20 5f66 6173 745f 6461 7461 7365 7428  = _fast_dataset(
-00003d20: 7265 7375 6c74 5f76 6172 732c 2063 6f6f  result_vars, coo
-00003d30: 7264 5f76 6172 732c 2069 6e64 6578 6573  rd_vars, indexes
-00003d40: 3d69 6e64 6578 6573 290a 0a20 2020 2061  =indexes)..    a
-00003d50: 7474 7273 203d 206d 6572 6765 5f61 7474  ttrs = merge_att
-00003d60: 7273 285b 782e 6174 7472 7320 666f 7220  rs([x.attrs for 
-00003d70: 7820 696e 206f 626a 735d 2c20 636f 6d62  x in objs], comb
-00003d80: 696e 655f 6174 7472 733d 6b65 6570 5f61  ine_attrs=keep_a
-00003d90: 7474 7273 290a 2020 2020 6966 2069 7369  ttrs).    if isi
-00003da0: 6e73 7461 6e63 6528 6f75 742c 2074 7570  nstance(out, tup
-00003db0: 6c65 293a 0a20 2020 2020 2020 2066 6f72  le):.        for
-00003dc0: 2064 7320 696e 206f 7574 3a0a 2020 2020   ds in out:.    
-00003dd0: 2020 2020 2020 2020 6473 2e61 7474 7273          ds.attrs
-00003de0: 203d 2061 7474 7273 0a20 2020 2065 6c73   = attrs.    els
-00003df0: 653a 0a20 2020 2020 2020 206f 7574 2e61  e:.        out.a
-00003e00: 7474 7273 203d 2061 7474 7273 0a0a 2020  ttrs = attrs..  
-00003e10: 2020 7265 7475 726e 206f 7574 0a0a 0a64    return out...d
-00003e20: 6566 205f 6974 6572 5f6f 7665 725f 7365  ef _iter_over_se
-00003e30: 6c65 6374 696f 6e73 286f 626a 2c20 6469  lections(obj, di
-00003e40: 6d2c 2076 616c 7565 7329 3a0a 2020 2020  m, values):.    
-00003e50: 2222 2249 7465 7261 7465 206f 7665 7220  """Iterate over 
-00003e60: 7365 6c65 6374 696f 6e73 206f 6620 616e  selections of an
-00003e70: 2078 6172 7261 7920 6f62 6a65 6374 2069   xarray object i
-00003e80: 6e20 7468 6520 7072 6f76 6964 6564 206f  n the provided o
-00003e90: 7264 6572 2e22 2222 0a20 2020 2066 726f  rder.""".    fro
-00003ea0: 6d20 7861 7272 6179 2e63 6f72 652e 6772  m xarray.core.gr
-00003eb0: 6f75 7062 7920 696d 706f 7274 205f 6475  oupby import _du
-00003ec0: 6d6d 795f 636f 7079 0a0a 2020 2020 6475  mmy_copy..    du
-00003ed0: 6d6d 7920 3d20 4e6f 6e65 0a20 2020 2066  mmy = None.    f
-00003ee0: 6f72 2076 616c 7565 2069 6e20 7661 6c75  or value in valu
-00003ef0: 6573 3a0a 2020 2020 2020 2020 7472 793a  es:.        try:
-00003f00: 0a20 2020 2020 2020 2020 2020 206f 626a  .            obj
-00003f10: 5f73 656c 203d 206f 626a 2e73 656c 282a  _sel = obj.sel(*
-00003f20: 2a7b 6469 6d3a 2076 616c 7565 7d29 0a20  *{dim: value}). 
-00003f30: 2020 2020 2020 2065 7863 6570 7420 284b         except (K
-00003f40: 6579 4572 726f 722c 2049 6e64 6578 4572  eyError, IndexEr
-00003f50: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-00003f60: 2020 6966 2064 756d 6d79 2069 7320 4e6f    if dummy is No
-00003f70: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00003f80: 2020 2020 6475 6d6d 7920 3d20 5f64 756d      dummy = _dum
-00003f90: 6d79 5f63 6f70 7928 6f62 6a29 0a20 2020  my_copy(obj).   
-00003fa0: 2020 2020 2020 2020 206f 626a 5f73 656c           obj_sel
-00003fb0: 203d 2064 756d 6d79 0a20 2020 2020 2020   = dummy.       
-00003fc0: 2079 6965 6c64 206f 626a 5f73 656c 0a0a   yield obj_sel..
-00003fd0: 0a64 6566 2061 7070 6c79 5f67 726f 7570  .def apply_group
-00003fe0: 6279 5f66 756e 6328 6675 6e63 2c20 2a61  by_func(func, *a
-00003ff0: 7267 7329 3a0a 2020 2020 2222 2241 7070  rgs):.    """App
-00004000: 6c79 2061 2064 6174 6173 6574 206f 7220  ly a dataset or 
-00004010: 6461 7461 7272 6179 206c 6576 656c 2066  datarray level f
-00004020: 756e 6374 696f 6e20 6f76 6572 2047 726f  unction over Gro
-00004030: 7570 4279 2c20 4461 7461 7365 742c 0a20  upBy, Dataset,. 
-00004040: 2020 2044 6174 6141 7272 6179 2c20 5661     DataArray, Va
-00004050: 7269 6162 6c65 2061 6e64 2f6f 7220 6e64  riable and/or nd
-00004060: 6172 7261 7920 6f62 6a65 6374 732e 0a20  array objects.. 
-00004070: 2020 2022 2222 0a20 2020 2066 726f 6d20     """.    from 
-00004080: 7861 7272 6179 2e63 6f72 652e 6772 6f75  xarray.core.grou
-00004090: 7062 7920 696d 706f 7274 2047 726f 7570  pby import Group
-000040a0: 4279 2c20 7065 656b 5f61 740a 2020 2020  By, peek_at.    
-000040b0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-000040c0: 2e76 6172 6961 626c 6520 696d 706f 7274  .variable import
-000040d0: 2056 6172 6961 626c 650a 0a20 2020 2067   Variable..    g
-000040e0: 726f 7570 6279 7320 3d20 5b61 7267 2066  roupbys = [arg f
-000040f0: 6f72 2061 7267 2069 6e20 6172 6773 2069  or arg in args i
-00004100: 6620 6973 696e 7374 616e 6365 2861 7267  f isinstance(arg
-00004110: 2c20 4772 6f75 7042 7929 5d0a 2020 2020  , GroupBy)].    
-00004120: 6173 7365 7274 2067 726f 7570 6279 732c  assert groupbys,
-00004130: 2022 6d75 7374 2068 6176 6520 6174 206c   "must have at l
-00004140: 6561 7374 206f 6e65 2067 726f 7570 6279  east one groupby
-00004150: 2074 6f20 6974 6572 6174 6520 6f76 6572   to iterate over
-00004160: 220a 2020 2020 6669 7273 745f 6772 6f75  ".    first_grou
-00004170: 7062 7920 3d20 6772 6f75 7062 7973 5b30  pby = groupbys[0
-00004180: 5d0a 2020 2020 6966 2061 6e79 286e 6f74  ].    if any(not
-00004190: 2066 6972 7374 5f67 726f 7570 6279 2e5f   first_groupby._
-000041a0: 6772 6f75 702e 6571 7561 6c73 2867 622e  group.equals(gb.
-000041b0: 5f67 726f 7570 2920 666f 7220 6762 2069  _group) for gb i
-000041c0: 6e20 6772 6f75 7062 7973 5b31 3a5d 293a  n groupbys[1:]):
-000041d0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-000041e0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-000041f0: 2020 2020 2020 2022 6170 706c 795f 7566         "apply_uf
-00004200: 756e 6320 6361 6e20 6f6e 6c79 2070 6572  unc can only per
-00004210: 666f 726d 206f 7065 7261 7469 6f6e 7320  form operations 
-00004220: 6f76 6572 2022 0a20 2020 2020 2020 2020  over ".         
-00004230: 2020 2022 6d75 6c74 6970 6c65 2047 726f     "multiple Gro
-00004240: 7570 4279 206f 626a 6563 7473 2061 7420  upBy objects at 
-00004250: 6f6e 6365 2069 6620 7468 6579 2061 7265  once if they are
-00004260: 2061 6c6c 2022 0a20 2020 2020 2020 2020   all ".         
-00004270: 2020 2022 6772 6f75 7065 6420 7468 6520     "grouped the 
-00004280: 7361 6d65 2077 6179 220a 2020 2020 2020  same way".      
-00004290: 2020 290a 0a20 2020 2067 726f 7570 6564    )..    grouped
-000042a0: 5f64 696d 203d 2066 6972 7374 5f67 726f  _dim = first_gro
-000042b0: 7570 6279 2e5f 6772 6f75 702e 6e61 6d65  upby._group.name
-000042c0: 0a20 2020 2075 6e69 7175 655f 7661 6c75  .    unique_valu
-000042d0: 6573 203d 2066 6972 7374 5f67 726f 7570  es = first_group
-000042e0: 6279 2e5f 756e 6971 7565 5f63 6f6f 7264  by._unique_coord
-000042f0: 2e76 616c 7565 730a 0a20 2020 2069 7465  .values..    ite
-00004300: 7261 746f 7273 203d 205b 5d0a 2020 2020  rators = [].    
-00004310: 666f 7220 6172 6720 696e 2061 7267 733a  for arg in args:
-00004320: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00004330: 7374 616e 6365 2861 7267 2c20 4772 6f75  stance(arg, Grou
-00004340: 7042 7929 3a0a 2020 2020 2020 2020 2020  pBy):.          
-00004350: 2020 6974 6572 6174 6f72 203d 2028 7661    iterator = (va
-00004360: 6c75 6520 666f 7220 5f2c 2076 616c 7565  lue for _, value
-00004370: 2069 6e20 6172 6729 0a20 2020 2020 2020   in arg).       
-00004380: 2065 6c69 6620 6861 7361 7474 7228 6172   elif hasattr(ar
-00004390: 672c 2022 6469 6d73 2229 2061 6e64 2067  g, "dims") and g
-000043a0: 726f 7570 6564 5f64 696d 2069 6e20 6172  rouped_dim in ar
-000043b0: 672e 6469 6d73 3a0a 2020 2020 2020 2020  g.dims:.        
-000043c0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000043d0: 6528 6172 672c 2056 6172 6961 626c 6529  e(arg, Variable)
-000043e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000043f0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00004400: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00004410: 2020 2020 2020 2020 2267 726f 7570 6279          "groupby
-00004420: 206f 7065 7261 7469 6f6e 7320 6361 6e6e   operations cann
-00004430: 6f74 2062 6520 7065 7266 6f72 6d65 6420  ot be performed 
-00004440: 7769 7468 2022 0a20 2020 2020 2020 2020  with ".         
-00004450: 2020 2020 2020 2020 2020 2022 7861 7272             "xarr
-00004460: 6179 2e56 6172 6961 626c 6520 6f62 6a65  ay.Variable obje
-00004470: 6374 7320 7468 6174 2073 6861 7265 2061  cts that share a
-00004480: 2064 696d 656e 7369 6f6e 2077 6974 6820   dimension with 
-00004490: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000044a0: 2020 2020 2020 2274 6865 2067 726f 7570        "the group
-000044b0: 6564 2064 696d 656e 7369 6f6e 220a 2020  ed dimension".  
-000044c0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-000044d0: 2020 2020 2020 2020 2020 2020 6974 6572              iter
-000044e0: 6174 6f72 203d 205f 6974 6572 5f6f 7665  ator = _iter_ove
-000044f0: 725f 7365 6c65 6374 696f 6e73 2861 7267  r_selections(arg
-00004500: 2c20 6772 6f75 7065 645f 6469 6d2c 2075  , grouped_dim, u
-00004510: 6e69 7175 655f 7661 6c75 6573 290a 2020  nique_values).  
-00004520: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00004530: 2020 2020 2020 2020 6974 6572 6174 6f72          iterator
-00004540: 203d 2069 7465 7274 6f6f 6c73 2e72 6570   = itertools.rep
-00004550: 6561 7428 6172 6729 0a20 2020 2020 2020  eat(arg).       
-00004560: 2069 7465 7261 746f 7273 2e61 7070 656e   iterators.appen
-00004570: 6428 6974 6572 6174 6f72 290a 0a20 2020  d(iterator)..   
-00004580: 2061 7070 6c69 6564 203d 2028 6675 6e63   applied = (func
-00004590: 282a 7a69 7070 6564 5f61 7267 7329 2066  (*zipped_args) f
-000045a0: 6f72 207a 6970 7065 645f 6172 6773 2069  or zipped_args i
-000045b0: 6e20 7a69 7028 2a69 7465 7261 746f 7273  n zip(*iterators
-000045c0: 2929 0a20 2020 2061 7070 6c69 6564 5f65  )).    applied_e
-000045d0: 7861 6d70 6c65 2c20 6170 706c 6965 6420  xample, applied 
-000045e0: 3d20 7065 656b 5f61 7428 6170 706c 6965  = peek_at(applie
-000045f0: 6429 0a20 2020 2063 6f6d 6269 6e65 203d  d).    combine =
-00004600: 2066 6972 7374 5f67 726f 7570 6279 2e5f   first_groupby._
-00004610: 636f 6d62 696e 650a 2020 2020 6966 2069  combine.    if i
-00004620: 7369 6e73 7461 6e63 6528 6170 706c 6965  sinstance(applie
-00004630: 645f 6578 616d 706c 652c 2074 7570 6c65  d_example, tuple
-00004640: 293a 0a20 2020 2020 2020 2063 6f6d 6269  ):.        combi
-00004650: 6e65 6420 3d20 7475 706c 6528 636f 6d62  ned = tuple(comb
-00004660: 696e 6528 6f75 7470 7574 2920 666f 7220  ine(output) for 
-00004670: 6f75 7470 7574 2069 6e20 7a69 7028 2a61  output in zip(*a
-00004680: 7070 6c69 6564 2929 0a20 2020 2065 6c73  pplied)).    els
-00004690: 653a 0a20 2020 2020 2020 2063 6f6d 6269  e:.        combi
-000046a0: 6e65 6420 3d20 636f 6d62 696e 6528 6170  ned = combine(ap
-000046b0: 706c 6965 6429 0a20 2020 2072 6574 7572  plied).    retur
-000046c0: 6e20 636f 6d62 696e 6564 0a0a 0a64 6566  n combined...def
-000046d0: 2075 6e69 6669 6564 5f64 696d 5f73 697a   unified_dim_siz
-000046e0: 6573 280a 2020 2020 7661 7269 6162 6c65  es(.    variable
-000046f0: 733a 2049 7465 7261 626c 655b 5661 7269  s: Iterable[Vari
-00004700: 6162 6c65 5d2c 2065 7863 6c75 6465 5f64  able], exclude_d
-00004710: 696d 733a 2041 6273 7472 6163 7453 6574  ims: AbstractSet
-00004720: 203d 2066 726f 7a65 6e73 6574 2829 0a29   = frozenset().)
-00004730: 202d 3e20 6469 6374 5b48 6173 6861 626c   -> dict[Hashabl
-00004740: 652c 2069 6e74 5d3a 0a20 2020 2064 696d  e, int]:.    dim
-00004750: 5f73 697a 6573 3a20 6469 6374 5b48 6173  _sizes: dict[Has
-00004760: 6861 626c 652c 2069 6e74 5d20 3d20 7b7d  hable, int] = {}
-00004770: 0a0a 2020 2020 666f 7220 7661 7220 696e  ..    for var in
-00004780: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-00004790: 2020 2020 6966 206c 656e 2873 6574 2876      if len(set(v
-000047a0: 6172 2e64 696d 7329 2920 3c20 6c65 6e28  ar.dims)) < len(
-000047b0: 7661 722e 6469 6d73 293a 0a20 2020 2020  var.dims):.     
-000047c0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000047d0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-000047e0: 2020 2020 2020 2020 2022 6272 6f61 6463           "broadc
-000047f0: 6173 7469 6e67 2063 616e 6e6f 7420 6861  asting cannot ha
-00004800: 6e64 6c65 2064 7570 6c69 6361 7465 2022  ndle duplicate "
-00004810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004820: 2066 2264 696d 656e 7369 6f6e 7320 6f6e   f"dimensions on
-00004830: 2061 2076 6172 6961 626c 653a 207b 6c69   a variable: {li
-00004840: 7374 2876 6172 2e64 696d 7329 7d22 0a20  st(var.dims)}". 
-00004850: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00004860: 2020 2020 2066 6f72 2064 696d 2c20 7369       for dim, si
-00004870: 7a65 2069 6e20 7a69 7028 7661 722e 6469  ze in zip(var.di
-00004880: 6d73 2c20 7661 722e 7368 6170 6529 3a0a  ms, var.shape):.
-00004890: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-000048a0: 696d 206e 6f74 2069 6e20 6578 636c 7564  im not in exclud
-000048b0: 655f 6469 6d73 3a0a 2020 2020 2020 2020  e_dims:.        
-000048c0: 2020 2020 2020 2020 6966 2064 696d 206e          if dim n
-000048d0: 6f74 2069 6e20 6469 6d5f 7369 7a65 733a  ot in dim_sizes:
-000048e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000048f0: 2020 2020 2064 696d 5f73 697a 6573 5b64       dim_sizes[d
-00004900: 696d 5d20 3d20 7369 7a65 0a20 2020 2020  im] = size.     
-00004910: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00004920: 6469 6d5f 7369 7a65 735b 6469 6d5d 2021  dim_sizes[dim] !
-00004930: 3d20 7369 7a65 3a0a 2020 2020 2020 2020  = size:.        
-00004940: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00004950: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-00004960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004970: 2020 2020 2020 226f 7065 7261 6e64 7320        "operands 
-00004980: 6361 6e6e 6f74 2062 6520 6272 6f61 6463  cannot be broadc
-00004990: 6173 7420 746f 6765 7468 6572 2022 0a20  ast together ". 
-000049a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049b0: 2020 2020 2020 2022 7769 7468 206d 6973         "with mis
-000049c0: 6d61 7463 6865 6420 6c65 6e67 7468 7320  matched lengths 
-000049d0: 666f 7220 6469 6d65 6e73 696f 6e20 220a  for dimension ".
+00000110: 696e 672c 2053 6571 7565 6e63 652c 2053  ing, Sequence, S
+00000120: 6574 0a66 726f 6d20 7479 7069 6e67 2069  et.from typing i
+00000130: 6d70 6f72 7420 5459 5045 5f43 4845 434b  mport TYPE_CHECK
+00000140: 494e 472c 2041 6e79 2c20 4361 6c6c 6162  ING, Any, Callab
+00000150: 6c65 2c20 4c69 7465 7261 6c2c 2054 7970  le, Literal, Typ
+00000160: 6556 6172 2c20 556e 696f 6e2c 206f 7665  eVar, Union, ove
+00000170: 726c 6f61 640a 0a69 6d70 6f72 7420 6e75  rload..import nu
+00000180: 6d70 7920 6173 206e 700a 0a66 726f 6d20  mpy as np..from 
+00000190: 7861 7272 6179 2e63 6f72 6520 696d 706f  xarray.core impo
+000001a0: 7274 2064 7479 7065 732c 2064 7563 6b5f  rt dtypes, duck_
+000001b0: 6172 7261 795f 6f70 732c 2075 7469 6c73  array_ops, utils
+000001c0: 0a66 726f 6d20 7861 7272 6179 2e63 6f72  .from xarray.cor
+000001d0: 652e 616c 6967 6e6d 656e 7420 696d 706f  e.alignment impo
+000001e0: 7274 2061 6c69 676e 2c20 6465 6570 5f61  rt align, deep_a
+000001f0: 6c69 676e 0a66 726f 6d20 7861 7272 6179  lign.from xarray
+00000200: 2e63 6f72 652e 636f 6d6d 6f6e 2069 6d70  .core.common imp
+00000210: 6f72 7420 7a65 726f 735f 6c69 6b65 0a66  ort zeros_like.f
+00000220: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
+00000230: 6475 636b 5f61 7272 6179 5f6f 7073 2069  duck_array_ops i
+00000240: 6d70 6f72 7420 6461 7465 7469 6d65 5f74  mport datetime_t
+00000250: 6f5f 6e75 6d65 7269 630a 6672 6f6d 2078  o_numeric.from x
+00000260: 6172 7261 792e 636f 7265 2e69 6e64 6578  array.core.index
+00000270: 6573 2069 6d70 6f72 7420 496e 6465 782c  es import Index,
+00000280: 2066 696c 7465 725f 696e 6465 7865 735f   filter_indexes_
+00000290: 6672 6f6d 5f63 6f6f 7264 730a 6672 6f6d  from_coords.from
+000002a0: 2078 6172 7261 792e 636f 7265 2e6d 6572   xarray.core.mer
+000002b0: 6765 2069 6d70 6f72 7420 6d65 7267 655f  ge import merge_
+000002c0: 6174 7472 732c 206d 6572 6765 5f63 6f6f  attrs, merge_coo
+000002d0: 7264 696e 6174 6573 5f77 6974 686f 7574  rdinates_without
+000002e0: 5f61 6c69 676e 0a66 726f 6d20 7861 7272  _align.from xarr
+000002f0: 6179 2e63 6f72 652e 6f70 7469 6f6e 7320  ay.core.options 
+00000300: 696d 706f 7274 204f 5054 494f 4e53 2c20  import OPTIONS, 
+00000310: 5f67 6574 5f6b 6565 705f 6174 7472 730a  _get_keep_attrs.
+00000320: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
+00000330: 2e70 7963 6f6d 7061 7420 696d 706f 7274  .pycompat import
+00000340: 2069 735f 6475 636b 5f64 6173 6b5f 6172   is_duck_dask_ar
+00000350: 7261 790a 6672 6f6d 2078 6172 7261 792e  ray.from xarray.
+00000360: 636f 7265 2e74 7970 6573 2069 6d70 6f72  core.types impor
+00000370: 7420 4469 6d73 2c20 545f 4461 7461 4172  t Dims, T_DataAr
+00000380: 7261 790a 6672 6f6d 2078 6172 7261 792e  ray.from xarray.
+00000390: 636f 7265 2e75 7469 6c73 2069 6d70 6f72  core.utils impor
+000003a0: 7420 6973 5f64 6963 745f 6c69 6b65 2c20  t is_dict_like, 
+000003b0: 6973 5f73 6361 6c61 720a 6672 6f6d 2078  is_scalar.from x
+000003c0: 6172 7261 792e 636f 7265 2e76 6172 6961  array.core.varia
+000003d0: 626c 6520 696d 706f 7274 2056 6172 6961  ble import Varia
+000003e0: 626c 650a 0a69 6620 5459 5045 5f43 4845  ble..if TYPE_CHE
+000003f0: 434b 494e 473a 0a20 2020 2066 726f 6d20  CKING:.    from 
+00000400: 7861 7272 6179 2e63 6f72 652e 636f 6f72  xarray.core.coor
+00000410: 6469 6e61 7465 7320 696d 706f 7274 2043  dinates import C
+00000420: 6f6f 7264 696e 6174 6573 0a20 2020 2066  oordinates.    f
+00000430: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
+00000440: 6461 7461 6172 7261 7920 696d 706f 7274  dataarray import
+00000450: 2044 6174 6141 7272 6179 0a20 2020 2066   DataArray.    f
+00000460: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
+00000470: 6461 7461 7365 7420 696d 706f 7274 2044  dataset import D
+00000480: 6174 6173 6574 0a20 2020 2066 726f 6d20  ataset.    from 
+00000490: 7861 7272 6179 2e63 6f72 652e 7479 7065  xarray.core.type
+000004a0: 7320 696d 706f 7274 2043 6f6d 6269 6e65  s import Combine
+000004b0: 4174 7472 734f 7074 696f 6e73 2c20 4a6f  AttrsOptions, Jo
+000004c0: 696e 4f70 7469 6f6e 730a 0a5f 4e4f 5f46  inOptions.._NO_F
+000004d0: 494c 4c5f 5641 4c55 4520 3d20 7574 696c  ILL_VALUE = util
+000004e0: 732e 5265 7072 4f62 6a65 6374 2822 3c6e  s.ReprObject("<n
+000004f0: 6f2d 6669 6c6c 2d76 616c 7565 3e22 290a  o-fill-value>").
+00000500: 5f44 4546 4155 4c54 5f4e 414d 4520 3d20  _DEFAULT_NAME = 
+00000510: 7574 696c 732e 5265 7072 4f62 6a65 6374  utils.ReprObject
+00000520: 2822 3c64 6566 6175 6c74 2d6e 616d 653e  ("<default-name>
+00000530: 2229 0a5f 4a4f 494e 535f 5749 5448 4f55  ")._JOINS_WITHOU
+00000540: 545f 4649 4c4c 5f56 414c 5545 5320 3d20  T_FILL_VALUES = 
+00000550: 6672 6f7a 656e 7365 7428 7b22 696e 6e65  frozenset({"inne
+00000560: 7222 2c20 2265 7861 6374 227d 290a 0a0a  r", "exact"})...
+00000570: 6465 6620 5f66 6972 7374 5f6f 665f 7479  def _first_of_ty
+00000580: 7065 2861 7267 732c 206b 696e 6429 3a0a  pe(args, kind):.
+00000590: 2020 2020 2222 2252 6574 7572 6e20 6569      """Return ei
+000005a0: 7468 6572 2066 6972 7374 206f 626a 6563  ther first objec
+000005b0: 7420 6f66 2074 7970 6520 276b 696e 6427  t of type 'kind'
+000005c0: 206f 7220 7261 6973 6520 6966 206e 6f74   or raise if not
+000005d0: 2066 6f75 6e64 2e22 2222 0a20 2020 2066   found.""".    f
+000005e0: 6f72 2061 7267 2069 6e20 6172 6773 3a0a  or arg in args:.
+000005f0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00000600: 7461 6e63 6528 6172 672c 206b 696e 6429  tance(arg, kind)
+00000610: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00000620: 7475 726e 2061 7267 0a20 2020 2072 6169  turn arg.    rai
+00000630: 7365 2056 616c 7565 4572 726f 7228 2254  se ValueError("T
+00000640: 6869 7320 7368 6f75 6c64 2062 6520 756e  his should be un
+00000650: 7265 6163 6861 626c 652e 2229 0a0a 0a64  reachable.")...d
+00000660: 6566 205f 616c 6c5f 6f66 5f74 7970 6528  ef _all_of_type(
+00000670: 6172 6773 2c20 6b69 6e64 293a 0a20 2020  args, kind):.   
+00000680: 2022 2222 5265 7475 726e 2061 6c6c 206f   """Return all o
+00000690: 626a 6563 7473 206f 6620 7479 7065 2027  bjects of type '
+000006a0: 6b69 6e64 2722 2222 0a20 2020 2072 6574  kind'""".    ret
+000006b0: 7572 6e20 5b61 7267 2066 6f72 2061 7267  urn [arg for arg
+000006c0: 2069 6e20 6172 6773 2069 6620 6973 696e   in args if isin
+000006d0: 7374 616e 6365 2861 7267 2c20 6b69 6e64  stance(arg, kind
+000006e0: 295d 0a0a 0a63 6c61 7373 205f 5546 756e  )]...class _UFun
+000006f0: 6353 6967 6e61 7475 7265 3a0a 2020 2020  cSignature:.    
+00000700: 2222 2243 6f72 6520 6469 6d65 6e73 696f  """Core dimensio
+00000710: 6e73 2073 6967 6e61 7475 7265 2066 6f72  ns signature for
+00000720: 2061 2067 6976 656e 2066 756e 6374 696f   a given functio
+00000730: 6e2e 0a0a 2020 2020 4261 7365 6420 6f6e  n...    Based on
+00000740: 2074 6865 2073 6967 6e61 7475 7265 2070   the signature p
+00000750: 726f 7669 6465 6420 6279 2067 656e 6572  rovided by gener
+00000760: 616c 697a 6564 2075 6675 6e63 7320 696e  alized ufuncs in
+00000770: 204e 756d 5079 2e0a 0a20 2020 2041 7474   NumPy...    Att
+00000780: 7269 6275 7465 730a 2020 2020 2d2d 2d2d  ributes.    ----
+00000790: 2d2d 2d2d 2d2d 0a20 2020 2069 6e70 7574  ------.    input
+000007a0: 5f63 6f72 655f 6469 6d73 203a 2074 7570  _core_dims : tup
+000007b0: 6c65 5b74 7570 6c65 5d0a 2020 2020 2020  le[tuple].      
+000007c0: 2020 436f 7265 2064 696d 656e 7369 6f6e    Core dimension
+000007d0: 206e 616d 6573 206f 6e20 6561 6368 2069   names on each i
+000007e0: 6e70 7574 2076 6172 6961 626c 652e 0a20  nput variable.. 
+000007f0: 2020 206f 7574 7075 745f 636f 7265 5f64     output_core_d
+00000800: 696d 7320 3a20 7475 706c 655b 7475 706c  ims : tuple[tupl
+00000810: 655d 0a20 2020 2020 2020 2043 6f72 6520  e].        Core 
+00000820: 6469 6d65 6e73 696f 6e20 6e61 6d65 7320  dimension names 
+00000830: 6f6e 2065 6163 6820 6f75 7470 7574 2076  on each output v
+00000840: 6172 6961 626c 652e 0a20 2020 2022 2222  ariable..    """
+00000850: 0a0a 2020 2020 5f5f 736c 6f74 735f 5f20  ..    __slots__ 
+00000860: 3d20 280a 2020 2020 2020 2020 2269 6e70  = (.        "inp
+00000870: 7574 5f63 6f72 655f 6469 6d73 222c 0a20  ut_core_dims",. 
+00000880: 2020 2020 2020 2022 6f75 7470 7574 5f63         "output_c
+00000890: 6f72 655f 6469 6d73 222c 0a20 2020 2020  ore_dims",.     
+000008a0: 2020 2022 5f61 6c6c 5f69 6e70 7574 5f63     "_all_input_c
+000008b0: 6f72 655f 6469 6d73 222c 0a20 2020 2020  ore_dims",.     
+000008c0: 2020 2022 5f61 6c6c 5f6f 7574 7075 745f     "_all_output_
+000008d0: 636f 7265 5f64 696d 7322 2c0a 2020 2020  core_dims",.    
+000008e0: 2020 2020 225f 616c 6c5f 636f 7265 5f64      "_all_core_d
+000008f0: 696d 7322 2c0a 2020 2020 290a 0a20 2020  ims",.    )..   
+00000900: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00000910: 6c66 2c20 696e 7075 745f 636f 7265 5f64  lf, input_core_d
+00000920: 696d 732c 206f 7574 7075 745f 636f 7265  ims, output_core
+00000930: 5f64 696d 733d 2828 292c 2929 3a0a 2020  _dims=((),)):.  
+00000940: 2020 2020 2020 7365 6c66 2e69 6e70 7574        self.input
+00000950: 5f63 6f72 655f 6469 6d73 203d 2074 7570  _core_dims = tup
+00000960: 6c65 2874 7570 6c65 2861 2920 666f 7220  le(tuple(a) for 
+00000970: 6120 696e 2069 6e70 7574 5f63 6f72 655f  a in input_core_
+00000980: 6469 6d73 290a 2020 2020 2020 2020 7365  dims).        se
+00000990: 6c66 2e6f 7574 7075 745f 636f 7265 5f64  lf.output_core_d
+000009a0: 696d 7320 3d20 7475 706c 6528 7475 706c  ims = tuple(tupl
+000009b0: 6528 6129 2066 6f72 2061 2069 6e20 6f75  e(a) for a in ou
+000009c0: 7470 7574 5f63 6f72 655f 6469 6d73 290a  tput_core_dims).
+000009d0: 2020 2020 2020 2020 7365 6c66 2e5f 616c          self._al
+000009e0: 6c5f 696e 7075 745f 636f 7265 5f64 696d  l_input_core_dim
+000009f0: 7320 3d20 4e6f 6e65 0a20 2020 2020 2020  s = None.       
+00000a00: 2073 656c 662e 5f61 6c6c 5f6f 7574 7075   self._all_outpu
+00000a10: 745f 636f 7265 5f64 696d 7320 3d20 4e6f  t_core_dims = No
+00000a20: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
+00000a30: 5f61 6c6c 5f63 6f72 655f 6469 6d73 203d  _all_core_dims =
+00000a40: 204e 6f6e 650a 0a20 2020 2040 7072 6f70   None..    @prop
+00000a50: 6572 7479 0a20 2020 2064 6566 2061 6c6c  erty.    def all
+00000a60: 5f69 6e70 7574 5f63 6f72 655f 6469 6d73  _input_core_dims
+00000a70: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00000a80: 6966 2073 656c 662e 5f61 6c6c 5f69 6e70  if self._all_inp
+00000a90: 7574 5f63 6f72 655f 6469 6d73 2069 7320  ut_core_dims is 
+00000aa0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00000ab0: 2020 7365 6c66 2e5f 616c 6c5f 696e 7075    self._all_inpu
+00000ac0: 745f 636f 7265 5f64 696d 7320 3d20 6672  t_core_dims = fr
+00000ad0: 6f7a 656e 7365 7428 0a20 2020 2020 2020  ozenset(.       
+00000ae0: 2020 2020 2020 2020 2064 696d 2066 6f72           dim for
+00000af0: 2064 696d 7320 696e 2073 656c 662e 696e   dims in self.in
+00000b00: 7075 745f 636f 7265 5f64 696d 7320 666f  put_core_dims fo
+00000b10: 7220 6469 6d20 696e 2064 696d 730a 2020  r dim in dims.  
+00000b20: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00000b30: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00000b40: 5f61 6c6c 5f69 6e70 7574 5f63 6f72 655f  _all_input_core_
+00000b50: 6469 6d73 0a0a 2020 2020 4070 726f 7065  dims..    @prope
+00000b60: 7274 790a 2020 2020 6465 6620 616c 6c5f  rty.    def all_
+00000b70: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
+00000b80: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00000b90: 6966 2073 656c 662e 5f61 6c6c 5f6f 7574  if self._all_out
+00000ba0: 7075 745f 636f 7265 5f64 696d 7320 6973  put_core_dims is
+00000bb0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00000bc0: 2020 2073 656c 662e 5f61 6c6c 5f6f 7574     self._all_out
+00000bd0: 7075 745f 636f 7265 5f64 696d 7320 3d20  put_core_dims = 
+00000be0: 6672 6f7a 656e 7365 7428 0a20 2020 2020  frozenset(.     
+00000bf0: 2020 2020 2020 2020 2020 2064 696d 2066             dim f
+00000c00: 6f72 2064 696d 7320 696e 2073 656c 662e  or dims in self.
+00000c10: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
+00000c20: 2066 6f72 2064 696d 2069 6e20 6469 6d73   for dim in dims
+00000c30: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00000c40: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00000c50: 6c66 2e5f 616c 6c5f 6f75 7470 7574 5f63  lf._all_output_c
+00000c60: 6f72 655f 6469 6d73 0a0a 2020 2020 4070  ore_dims..    @p
+00000c70: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+00000c80: 616c 6c5f 636f 7265 5f64 696d 7328 7365  all_core_dims(se
+00000c90: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
+00000ca0: 7365 6c66 2e5f 616c 6c5f 636f 7265 5f64  self._all_core_d
+00000cb0: 696d 7320 6973 204e 6f6e 653a 0a20 2020  ims is None:.   
+00000cc0: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
+00000cd0: 6c6c 5f63 6f72 655f 6469 6d73 203d 2073  ll_core_dims = s
+00000ce0: 656c 662e 616c 6c5f 696e 7075 745f 636f  elf.all_input_co
+00000cf0: 7265 5f64 696d 7320 7c20 7365 6c66 2e61  re_dims | self.a
+00000d00: 6c6c 5f6f 7574 7075 745f 636f 7265 5f64  ll_output_core_d
+00000d10: 696d 730a 2020 2020 2020 2020 7265 7475  ims.        retu
+00000d20: 726e 2073 656c 662e 5f61 6c6c 5f63 6f72  rn self._all_cor
+00000d30: 655f 6469 6d73 0a0a 2020 2020 4070 726f  e_dims..    @pro
+00000d40: 7065 7274 790a 2020 2020 6465 6620 6469  perty.    def di
+00000d50: 6d73 5f6d 6170 2873 656c 6629 3a0a 2020  ms_map(self):.  
+00000d60: 2020 2020 2020 7265 7475 726e 207b 0a20        return {. 
+00000d70: 2020 2020 2020 2020 2020 2063 6f72 655f             core_
+00000d80: 6469 6d3a 2066 2264 696d 7b6e 7d22 2066  dim: f"dim{n}" f
+00000d90: 6f72 206e 2c20 636f 7265 5f64 696d 2069  or n, core_dim i
+00000da0: 6e20 656e 756d 6572 6174 6528 736f 7274  n enumerate(sort
+00000db0: 6564 2873 656c 662e 616c 6c5f 636f 7265  ed(self.all_core
+00000dc0: 5f64 696d 7329 290a 2020 2020 2020 2020  _dims)).        
+00000dd0: 7d0a 0a20 2020 2040 7072 6f70 6572 7479  }..    @property
+00000de0: 0a20 2020 2064 6566 206e 756d 5f69 6e70  .    def num_inp
+00000df0: 7574 7328 7365 6c66 293a 0a20 2020 2020  uts(self):.     
+00000e00: 2020 2072 6574 7572 6e20 6c65 6e28 7365     return len(se
+00000e10: 6c66 2e69 6e70 7574 5f63 6f72 655f 6469  lf.input_core_di
+00000e20: 6d73 290a 0a20 2020 2040 7072 6f70 6572  ms)..    @proper
+00000e30: 7479 0a20 2020 2064 6566 206e 756d 5f6f  ty.    def num_o
+00000e40: 7574 7075 7473 2873 656c 6629 3a0a 2020  utputs(self):.  
+00000e50: 2020 2020 2020 7265 7475 726e 206c 656e        return len
+00000e60: 2873 656c 662e 6f75 7470 7574 5f63 6f72  (self.output_cor
+00000e70: 655f 6469 6d73 290a 0a20 2020 2064 6566  e_dims)..    def
+00000e80: 205f 5f65 715f 5f28 7365 6c66 2c20 6f74   __eq__(self, ot
+00000e90: 6865 7229 3a0a 2020 2020 2020 2020 7472  her):.        tr
+00000ea0: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
+00000eb0: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
+00000ec0: 2020 2020 2020 2020 7365 6c66 2e69 6e70          self.inp
+00000ed0: 7574 5f63 6f72 655f 6469 6d73 203d 3d20  ut_core_dims == 
+00000ee0: 6f74 6865 722e 696e 7075 745f 636f 7265  other.input_core
+00000ef0: 5f64 696d 730a 2020 2020 2020 2020 2020  _dims.          
+00000f00: 2020 2020 2020 616e 6420 7365 6c66 2e6f        and self.o
+00000f10: 7574 7075 745f 636f 7265 5f64 696d 7320  utput_core_dims 
+00000f20: 3d3d 206f 7468 6572 2e6f 7574 7075 745f  == other.output_
+00000f30: 636f 7265 5f64 696d 730a 2020 2020 2020  core_dims.      
+00000f40: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00000f50: 6578 6365 7074 2041 7474 7269 6275 7465  except Attribute
+00000f60: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+00000f70: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00000f80: 0a20 2020 2064 6566 205f 5f6e 655f 5f28  .    def __ne__(
+00000f90: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
+00000fa0: 2020 2020 2020 7265 7475 726e 206e 6f74        return not
+00000fb0: 2073 656c 6620 3d3d 206f 7468 6572 0a0a   self == other..
+00000fc0: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
+00000fd0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00000fe0: 7265 7475 726e 2022 7b7d 287b 2172 7d2c  return "{}({!r},
+00000ff0: 207b 2172 7d29 222e 666f 726d 6174 280a   {!r})".format(.
+00001000: 2020 2020 2020 2020 2020 2020 7479 7065              type
+00001010: 2873 656c 6629 2e5f 5f6e 616d 655f 5f2c  (self).__name__,
+00001020: 0a20 2020 2020 2020 2020 2020 206c 6973  .            lis
+00001030: 7428 7365 6c66 2e69 6e70 7574 5f63 6f72  t(self.input_cor
+00001040: 655f 6469 6d73 292c 0a20 2020 2020 2020  e_dims),.       
+00001050: 2020 2020 206c 6973 7428 7365 6c66 2e6f       list(self.o
+00001060: 7574 7075 745f 636f 7265 5f64 696d 7329  utput_core_dims)
+00001070: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00001080: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
+00001090: 6629 3a0a 2020 2020 2020 2020 6c68 7320  f):.        lhs 
+000010a0: 3d20 222c 222e 6a6f 696e 2822 287b 7d29  = ",".join("({})
+000010b0: 222e 666f 726d 6174 2822 2c22 2e6a 6f69  ".format(",".joi
+000010c0: 6e28 6469 6d73 2929 2066 6f72 2064 696d  n(dims)) for dim
+000010d0: 7320 696e 2073 656c 662e 696e 7075 745f  s in self.input_
+000010e0: 636f 7265 5f64 696d 7329 0a20 2020 2020  core_dims).     
+000010f0: 2020 2072 6873 203d 2022 2c22 2e6a 6f69     rhs = ",".joi
+00001100: 6e28 2228 7b7d 2922 2e66 6f72 6d61 7428  n("({})".format(
+00001110: 222c 222e 6a6f 696e 2864 696d 7329 2920  ",".join(dims)) 
+00001120: 666f 7220 6469 6d73 2069 6e20 7365 6c66  for dims in self
+00001130: 2e6f 7574 7075 745f 636f 7265 5f64 696d  .output_core_dim
+00001140: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
+00001150: 6e20 6622 7b6c 6873 7d2d 3e7b 7268 737d  n f"{lhs}->{rhs}
+00001160: 220a 0a20 2020 2064 6566 2074 6f5f 6775  "..    def to_gu
+00001170: 6675 6e63 5f73 7472 696e 6728 7365 6c66  func_string(self
+00001180: 2c20 6578 636c 7564 655f 6469 6d73 3d66  , exclude_dims=f
+00001190: 726f 7a65 6e73 6574 2829 293a 0a20 2020  rozenset()):.   
+000011a0: 2020 2020 2022 2222 4372 6561 7465 2061       """Create a
+000011b0: 6e20 6571 7569 7661 6c65 6e74 2073 6967  n equivalent sig
+000011c0: 6e61 7475 7265 2073 7472 696e 6720 666f  nature string fo
+000011d0: 7220 6120 4e75 6d50 7920 6775 6675 6e63  r a NumPy gufunc
+000011e0: 2e0a 0a20 2020 2020 2020 2055 6e6c 696b  ...        Unlik
+000011f0: 6520 5f5f 7374 725f 5f2c 2068 616e 646c  e __str__, handl
+00001200: 6573 2064 696d 656e 7369 6f6e 7320 7468  es dimensions th
+00001210: 6174 2064 6f6e 2774 206d 6170 2074 6f20  at don't map to 
+00001220: 5079 7468 6f6e 0a20 2020 2020 2020 2069  Python.        i
+00001230: 6465 6e74 6966 6965 7273 2e0a 0a20 2020  dentifiers...   
+00001240: 2020 2020 2041 6c73 6f20 6372 6561 7465       Also create
+00001250: 7320 756e 6971 7565 206e 616d 6573 2066  s unique names f
+00001260: 6f72 2069 6e70 7574 5f63 6f72 655f 6469  or input_core_di
+00001270: 6d73 2063 6f6e 7461 696e 6564 2069 6e20  ms contained in 
+00001280: 6578 636c 7564 655f 6469 6d73 2e0a 2020  exclude_dims..  
+00001290: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000012a0: 2020 696e 7075 745f 636f 7265 5f64 696d    input_core_dim
+000012b0: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+000012c0: 2020 5b73 656c 662e 6469 6d73 5f6d 6170    [self.dims_map
+000012d0: 5b64 696d 5d20 666f 7220 6469 6d20 696e  [dim] for dim in
+000012e0: 2063 6f72 655f 6469 6d73 5d0a 2020 2020   core_dims].    
+000012f0: 2020 2020 2020 2020 666f 7220 636f 7265          for core
+00001300: 5f64 696d 7320 696e 2073 656c 662e 696e  _dims in self.in
+00001310: 7075 745f 636f 7265 5f64 696d 730a 2020  put_core_dims.  
+00001320: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00001330: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
+00001340: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+00001350: 205b 7365 6c66 2e64 696d 735f 6d61 705b   [self.dims_map[
+00001360: 6469 6d5d 2066 6f72 2064 696d 2069 6e20  dim] for dim in 
+00001370: 636f 7265 5f64 696d 735d 0a20 2020 2020  core_dims].     
+00001380: 2020 2020 2020 2066 6f72 2063 6f72 655f         for core_
+00001390: 6469 6d73 2069 6e20 7365 6c66 2e6f 7574  dims in self.out
+000013a0: 7075 745f 636f 7265 5f64 696d 730a 2020  put_core_dims.  
+000013b0: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
+000013c0: 2023 2065 6e75 6d65 7261 7465 2069 6e70   # enumerate inp
+000013d0: 7574 5f63 6f72 655f 6469 6d73 2063 6f6e  ut_core_dims con
+000013e0: 7461 696e 6564 2069 6e20 6578 636c 7564  tained in exclud
+000013f0: 655f 6469 6d73 2074 6f20 6d61 6b65 2074  e_dims to make t
+00001400: 6865 6d20 756e 6971 7565 0a20 2020 2020  hem unique.     
+00001410: 2020 2069 6620 6578 636c 7564 655f 6469     if exclude_di
+00001420: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+00001430: 6578 636c 7564 655f 6469 6d73 203d 205b  exclude_dims = [
+00001440: 7365 6c66 2e64 696d 735f 6d61 705b 6469  self.dims_map[di
+00001450: 6d5d 2066 6f72 2064 696d 2069 6e20 6578  m] for dim in ex
+00001460: 636c 7564 655f 6469 6d73 5d0a 0a20 2020  clude_dims]..   
+00001470: 2020 2020 2020 2020 2063 6f75 6e74 6572           counter
+00001480: 203d 2043 6f75 6e74 6572 2829 0a0a 2020   = Counter()..  
+00001490: 2020 2020 2020 2020 2020 6465 6620 5f65            def _e
+000014a0: 6e75 6d65 7261 7465 2864 696d 293a 0a20  numerate(dim):. 
+000014b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000014c0: 6620 6469 6d20 696e 2065 7863 6c75 6465  f dim in exclude
+000014d0: 5f64 696d 733a 0a20 2020 2020 2020 2020  _dims:.         
+000014e0: 2020 2020 2020 2020 2020 206e 203d 2063             n = c
+000014f0: 6f75 6e74 6572 5b64 696d 5d0a 2020 2020  ounter[dim].    
+00001500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001510: 636f 756e 7465 722e 7570 6461 7465 285b  counter.update([
+00001520: 6469 6d5d 290a 2020 2020 2020 2020 2020  dim]).          
+00001530: 2020 2020 2020 2020 2020 6469 6d20 3d20            dim = 
+00001540: 6622 7b64 696d 7d5f 7b6e 7d22 0a20 2020  f"{dim}_{n}".   
+00001550: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00001560: 7572 6e20 6469 6d0a 0a20 2020 2020 2020  urn dim..       
+00001570: 2020 2020 2069 6e70 7574 5f63 6f72 655f       input_core_
+00001580: 6469 6d73 203d 205b 0a20 2020 2020 2020  dims = [.       
+00001590: 2020 2020 2020 2020 205b 5f65 6e75 6d65           [_enume
+000015a0: 7261 7465 2864 696d 2920 666f 7220 6469  rate(dim) for di
+000015b0: 6d20 696e 2061 7267 5d20 666f 7220 6172  m in arg] for ar
+000015c0: 6720 696e 2069 6e70 7574 5f63 6f72 655f  g in input_core_
+000015d0: 6469 6d73 0a20 2020 2020 2020 2020 2020  dims.           
+000015e0: 205d 0a0a 2020 2020 2020 2020 616c 745f   ]..        alt_
+000015f0: 7369 676e 6174 7572 6520 3d20 7479 7065  signature = type
+00001600: 2873 656c 6629 2869 6e70 7574 5f63 6f72  (self)(input_cor
+00001610: 655f 6469 6d73 2c20 6f75 7470 7574 5f63  e_dims, output_c
+00001620: 6f72 655f 6469 6d73 290a 2020 2020 2020  ore_dims).      
+00001630: 2020 7265 7475 726e 2073 7472 2861 6c74    return str(alt
+00001640: 5f73 6967 6e61 7475 7265 290a 0a0a 6465  _signature)...de
+00001650: 6620 7265 7375 6c74 5f6e 616d 6528 6f62  f result_name(ob
+00001660: 6a65 6374 733a 2049 7465 7261 626c 655b  jects: Iterable[
+00001670: 416e 795d 2920 2d3e 2041 6e79 3a0a 2020  Any]) -> Any:.  
+00001680: 2020 2320 7573 6520 7468 6520 7361 6d65    # use the same
+00001690: 206e 616d 696e 6720 6865 7572 6973 7469   naming heuristi
+000016a0: 6373 2061 7320 7061 6e64 6173 3a0a 2020  cs as pandas:.  
+000016b0: 2020 2320 6874 7470 733a 2f2f 6769 7468    # https://gith
+000016c0: 7562 2e63 6f6d 2f62 6c61 7a65 2f62 6c61  ub.com/blaze/bla
+000016d0: 7a65 2f69 7373 7565 732f 3435 3823 6973  ze/issues/458#is
+000016e0: 7375 6563 6f6d 6d65 6e74 2d35 3139 3336  suecomment-51936
+000016f0: 3335 360a 2020 2020 6e61 6d65 7320 3d20  356.    names = 
+00001700: 7b67 6574 6174 7472 286f 626a 2c20 226e  {getattr(obj, "n
+00001710: 616d 6522 2c20 5f44 4546 4155 4c54 5f4e  ame", _DEFAULT_N
+00001720: 414d 4529 2066 6f72 206f 626a 2069 6e20  AME) for obj in 
+00001730: 6f62 6a65 6374 737d 0a20 2020 206e 616d  objects}.    nam
+00001740: 6573 2e64 6973 6361 7264 285f 4445 4641  es.discard(_DEFA
+00001750: 554c 545f 4e41 4d45 290a 2020 2020 6966  ULT_NAME).    if
+00001760: 206c 656e 286e 616d 6573 2920 3d3d 2031   len(names) == 1
+00001770: 3a0a 2020 2020 2020 2020 286e 616d 652c  :.        (name,
+00001780: 2920 3d20 6e61 6d65 730a 2020 2020 656c  ) = names.    el
+00001790: 7365 3a0a 2020 2020 2020 2020 6e61 6d65  se:.        name
+000017a0: 203d 204e 6f6e 650a 2020 2020 7265 7475   = None.    retu
+000017b0: 726e 206e 616d 650a 0a0a 6465 6620 5f67  rn name...def _g
+000017c0: 6574 5f63 6f6f 7264 735f 6c69 7374 2861  et_coords_list(a
+000017d0: 7267 733a 2049 7465 7261 626c 655b 416e  rgs: Iterable[An
+000017e0: 795d 2920 2d3e 206c 6973 745b 436f 6f72  y]) -> list[Coor
+000017f0: 6469 6e61 7465 735d 3a0a 2020 2020 636f  dinates]:.    co
+00001800: 6f72 6473 5f6c 6973 7420 3d20 5b5d 0a20  ords_list = []. 
+00001810: 2020 2066 6f72 2061 7267 2069 6e20 6172     for arg in ar
+00001820: 6773 3a0a 2020 2020 2020 2020 7472 793a  gs:.        try:
+00001830: 0a20 2020 2020 2020 2020 2020 2063 6f6f  .            coo
+00001840: 7264 7320 3d20 6172 672e 636f 6f72 6473  rds = arg.coords
+00001850: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00001860: 4174 7472 6962 7574 6545 7272 6f72 3a0a  AttributeError:.
+00001870: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00001880: 2020 2320 736b 6970 2074 6869 7320 6172    # skip this ar
+00001890: 6775 6d65 6e74 0a20 2020 2020 2020 2065  gument.        e
+000018a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000018b0: 2063 6f6f 7264 735f 6c69 7374 2e61 7070   coords_list.app
+000018c0: 656e 6428 636f 6f72 6473 290a 2020 2020  end(coords).    
+000018d0: 7265 7475 726e 2063 6f6f 7264 735f 6c69  return coords_li
+000018e0: 7374 0a0a 0a64 6566 2062 7569 6c64 5f6f  st...def build_o
+000018f0: 7574 7075 745f 636f 6f72 6473 5f61 6e64  utput_coords_and
+00001900: 5f69 6e64 6578 6573 280a 2020 2020 6172  _indexes(.    ar
+00001910: 6773 3a20 4974 6572 6162 6c65 5b41 6e79  gs: Iterable[Any
+00001920: 5d2c 0a20 2020 2073 6967 6e61 7475 7265  ],.    signature
+00001930: 3a20 5f55 4675 6e63 5369 676e 6174 7572  : _UFuncSignatur
+00001940: 652c 0a20 2020 2065 7863 6c75 6465 5f64  e,.    exclude_d
+00001950: 696d 733a 2053 6574 203d 2066 726f 7a65  ims: Set = froze
+00001960: 6e73 6574 2829 2c0a 2020 2020 636f 6d62  nset(),.    comb
+00001970: 696e 655f 6174 7472 733a 2043 6f6d 6269  ine_attrs: Combi
+00001980: 6e65 4174 7472 734f 7074 696f 6e73 203d  neAttrsOptions =
+00001990: 2022 6f76 6572 7269 6465 222c 0a29 202d   "override",.) -
+000019a0: 3e20 7475 706c 655b 6c69 7374 5b64 6963  > tuple[list[dic
+000019b0: 745b 416e 792c 2056 6172 6961 626c 655d  t[Any, Variable]
+000019c0: 5d2c 206c 6973 745b 6469 6374 5b41 6e79  ], list[dict[Any
+000019d0: 2c20 496e 6465 785d 5d5d 3a0a 2020 2020  , Index]]]:.    
+000019e0: 2222 2242 7569 6c64 206f 7574 7075 7420  """Build output 
+000019f0: 636f 6f72 6469 6e61 7465 7320 616e 6420  coordinates and 
+00001a00: 696e 6465 7865 7320 666f 7220 616e 206f  indexes for an o
+00001a10: 7065 7261 7469 6f6e 2e0a 0a20 2020 2050  peration...    P
+00001a20: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00001a30: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2061 7267  --------.    arg
+00001a40: 7320 3a20 4974 6572 6162 6c65 0a20 2020  s : Iterable.   
+00001a50: 2020 2020 204c 6973 7420 6f66 2072 6177       List of raw
+00001a60: 206f 7065 7261 7469 6f6e 2061 7267 756d   operation argum
+00001a70: 656e 7473 2e20 416e 7920 7661 6c69 6420  ents. Any valid 
+00001a80: 7479 7065 7320 666f 7220 7861 7272 6179  types for xarray
+00001a90: 206f 7065 7261 7469 6f6e 730a 2020 2020   operations.    
+00001aa0: 2020 2020 6172 6520 4f4b 2c20 652e 672e      are OK, e.g.
+00001ab0: 2c20 7363 616c 6172 732c 2056 6172 6961  , scalars, Varia
+00001ac0: 626c 652c 2044 6174 6141 7272 6179 2c20  ble, DataArray, 
+00001ad0: 4461 7461 7365 742e 0a20 2020 2073 6967  Dataset..    sig
+00001ae0: 6e61 7475 7265 203a 205f 5566 756e 6353  nature : _UfuncS
+00001af0: 6967 6e61 7475 7265 0a20 2020 2020 2020  ignature.       
+00001b00: 2043 6f72 6520 6469 6d65 6e73 696f 6e73   Core dimensions
+00001b10: 2073 6967 6e61 7475 7265 2066 6f72 2074   signature for t
+00001b20: 6865 206f 7065 7261 7469 6f6e 2e0a 2020  he operation..  
+00001b30: 2020 6578 636c 7564 655f 6469 6d73 203a    exclude_dims :
+00001b40: 2073 6574 2c20 6f70 7469 6f6e 616c 0a20   set, optional. 
+00001b50: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+00001b60: 7320 6578 636c 7564 6564 2066 726f 6d20  s excluded from 
+00001b70: 7468 6520 6f70 6572 6174 696f 6e2e 2043  the operation. C
+00001b80: 6f6f 7264 696e 6174 6573 2061 6c6f 6e67  oordinates along
+00001b90: 2074 6865 7365 0a20 2020 2020 2020 2064   these.        d
+00001ba0: 696d 656e 7369 6f6e 7320 6172 6520 6472  imensions are dr
+00001bb0: 6f70 7065 642e 0a20 2020 2063 6f6d 6269  opped..    combi
+00001bc0: 6e65 5f61 7474 7273 203a 207b 2264 726f  ne_attrs : {"dro
+00001bd0: 7022 2c20 2269 6465 6e74 6963 616c 222c  p", "identical",
+00001be0: 2022 6e6f 5f63 6f6e 666c 6963 7473 222c   "no_conflicts",
+00001bf0: 2022 6472 6f70 5f63 6f6e 666c 6963 7473   "drop_conflicts
+00001c00: 222c 205c 0a20 2020 2020 2020 2020 2020  ", \.           
+00001c10: 2020 2020 2020 2020 2020 226f 7665 7272            "overr
+00001c20: 6964 6522 7d20 6f72 2063 616c 6c61 626c  ide"} or callabl
+00001c30: 652c 2064 6566 6175 6c74 3a20 2264 726f  e, default: "dro
+00001c40: 7022 0a20 2020 2020 2020 2041 2063 616c  p".        A cal
+00001c50: 6c61 626c 6520 6f72 2061 2073 7472 696e  lable or a strin
+00001c60: 6720 696e 6469 6361 7469 6e67 2068 6f77  g indicating how
+00001c70: 2074 6f20 636f 6d62 696e 6520 6174 7472   to combine attr
+00001c80: 7320 6f66 2074 6865 206f 626a 6563 7473  s of the objects
+00001c90: 2062 6569 6e67 0a20 2020 2020 2020 206d   being.        m
+00001ca0: 6572 6765 643a 0a0a 2020 2020 2020 2020  erged:..        
+00001cb0: 2d20 2264 726f 7022 3a20 656d 7074 7920  - "drop": empty 
+00001cc0: 6174 7472 7320 6f6e 2072 6574 7572 6e65  attrs on returne
+00001cd0: 6420 4461 7461 7365 742e 0a20 2020 2020  d Dataset..     
+00001ce0: 2020 202d 2022 6964 656e 7469 6361 6c22     - "identical"
+00001cf0: 3a20 616c 6c20 6174 7472 7320 6d75 7374  : all attrs must
+00001d00: 2062 6520 7468 6520 7361 6d65 206f 6e20   be the same on 
+00001d10: 6576 6572 7920 6f62 6a65 6374 2e0a 2020  every object..  
+00001d20: 2020 2020 2020 2d20 226e 6f5f 636f 6e66        - "no_conf
+00001d30: 6c69 6374 7322 3a20 6174 7472 7320 6672  licts": attrs fr
+00001d40: 6f6d 2061 6c6c 206f 626a 6563 7473 2061  om all objects a
+00001d50: 7265 2063 6f6d 6269 6e65 642c 2061 6e79  re combined, any
+00001d60: 2074 6861 7420 6861 7665 0a20 2020 2020   that have.     
+00001d70: 2020 2020 2074 6865 2073 616d 6520 6e61       the same na
+00001d80: 6d65 206d 7573 7420 616c 736f 2068 6176  me must also hav
+00001d90: 6520 7468 6520 7361 6d65 2076 616c 7565  e the same value
+00001da0: 2e0a 2020 2020 2020 2020 2d20 2264 726f  ..        - "dro
+00001db0: 705f 636f 6e66 6c69 6374 7322 3a20 6174  p_conflicts": at
+00001dc0: 7472 7320 6672 6f6d 2061 6c6c 206f 626a  trs from all obj
+00001dd0: 6563 7473 2061 7265 2063 6f6d 6269 6e65  ects are combine
+00001de0: 642c 2061 6e79 2074 6861 7420 6861 7665  d, any that have
+00001df0: 0a20 2020 2020 2020 2020 2074 6865 2073  .          the s
+00001e00: 616d 6520 6e61 6d65 2062 7574 2064 6966  ame name but dif
+00001e10: 6665 7265 6e74 2076 616c 7565 7320 6172  ferent values ar
+00001e20: 6520 6472 6f70 7065 642e 0a20 2020 2020  e dropped..     
+00001e30: 2020 202d 2022 6f76 6572 7269 6465 223a     - "override":
+00001e40: 2073 6b69 7020 636f 6d70 6172 696e 6720   skip comparing 
+00001e50: 616e 6420 636f 7079 2061 7474 7273 2066  and copy attrs f
+00001e60: 726f 6d20 7468 6520 6669 7273 7420 6461  rom the first da
+00001e70: 7461 7365 7420 746f 0a20 2020 2020 2020  taset to.       
+00001e80: 2020 2074 6865 2072 6573 756c 742e 0a0a     the result...
+00001e90: 2020 2020 2020 2020 4966 2061 2063 616c          If a cal
+00001ea0: 6c61 626c 652c 2069 7420 6d75 7374 2065  lable, it must e
+00001eb0: 7870 6563 7420 6120 7365 7175 656e 6365  xpect a sequence
+00001ec0: 206f 6620 6060 6174 7472 7360 6020 6469   of ``attrs`` di
+00001ed0: 6374 7320 616e 6420 6120 636f 6e74 6578  cts and a contex
+00001ee0: 7420 6f62 6a65 6374 0a20 2020 2020 2020  t object.       
+00001ef0: 2061 7320 6974 7320 6f6e 6c79 2070 6172   as its only par
+00001f00: 616d 6574 6572 732e 0a0a 2020 2020 5265  ameters...    Re
+00001f10: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00001f20: 2d0a 2020 2020 4469 6374 696f 6e61 7269  -.    Dictionari
+00001f30: 6573 206f 6620 5661 7269 6162 6c65 2061  es of Variable a
+00001f40: 6e64 2049 6e64 6578 206f 626a 6563 7473  nd Index objects
+00001f50: 2077 6974 6820 6d65 7267 6564 2063 6f6f   with merged coo
+00001f60: 7264 696e 6174 6573 2e0a 2020 2020 2222  rdinates..    ""
+00001f70: 220a 2020 2020 636f 6f72 6473 5f6c 6973  ".    coords_lis
+00001f80: 7420 3d20 5f67 6574 5f63 6f6f 7264 735f  t = _get_coords_
+00001f90: 6c69 7374 2861 7267 7329 0a0a 2020 2020  list(args)..    
+00001fa0: 6966 206c 656e 2863 6f6f 7264 735f 6c69  if len(coords_li
+00001fb0: 7374 2920 3d3d 2031 2061 6e64 206e 6f74  st) == 1 and not
+00001fc0: 2065 7863 6c75 6465 5f64 696d 733a 0a20   exclude_dims:. 
+00001fd0: 2020 2020 2020 2023 2077 6520 6361 6e20         # we can 
+00001fe0: 736b 6970 2074 6865 2065 7870 656e 7369  skip the expensi
+00001ff0: 7665 206d 6572 6765 0a20 2020 2020 2020  ve merge.       
+00002000: 2028 756e 7061 636b 6564 5f63 6f6f 7264   (unpacked_coord
+00002010: 732c 2920 3d20 636f 6f72 6473 5f6c 6973  s,) = coords_lis
+00002020: 740a 2020 2020 2020 2020 6d65 7267 6564  t.        merged
+00002030: 5f76 6172 7320 3d20 6469 6374 2875 6e70  _vars = dict(unp
+00002040: 6163 6b65 645f 636f 6f72 6473 2e76 6172  acked_coords.var
+00002050: 6961 626c 6573 290a 2020 2020 2020 2020  iables).        
+00002060: 6d65 7267 6564 5f69 6e64 6578 6573 203d  merged_indexes =
+00002070: 2064 6963 7428 756e 7061 636b 6564 5f63   dict(unpacked_c
+00002080: 6f6f 7264 732e 7869 6e64 6578 6573 290a  oords.xindexes).
+00002090: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000020a0: 2020 6d65 7267 6564 5f76 6172 732c 206d    merged_vars, m
+000020b0: 6572 6765 645f 696e 6465 7865 7320 3d20  erged_indexes = 
+000020c0: 6d65 7267 655f 636f 6f72 6469 6e61 7465  merge_coordinate
+000020d0: 735f 7769 7468 6f75 745f 616c 6967 6e28  s_without_align(
+000020e0: 0a20 2020 2020 2020 2020 2020 2063 6f6f  .            coo
+000020f0: 7264 735f 6c69 7374 2c20 6578 636c 7564  rds_list, exclud
+00002100: 655f 6469 6d73 3d65 7863 6c75 6465 5f64  e_dims=exclude_d
+00002110: 696d 732c 2063 6f6d 6269 6e65 5f61 7474  ims, combine_att
+00002120: 7273 3d63 6f6d 6269 6e65 5f61 7474 7273  rs=combine_attrs
+00002130: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00002140: 6f75 7470 7574 5f63 6f6f 7264 7320 3d20  output_coords = 
+00002150: 5b5d 0a20 2020 206f 7574 7075 745f 696e  [].    output_in
+00002160: 6465 7865 7320 3d20 5b5d 0a20 2020 2066  dexes = [].    f
+00002170: 6f72 206f 7574 7075 745f 6469 6d73 2069  or output_dims i
+00002180: 6e20 7369 676e 6174 7572 652e 6f75 7470  n signature.outp
+00002190: 7574 5f63 6f72 655f 6469 6d73 3a0a 2020  ut_core_dims:.  
+000021a0: 2020 2020 2020 6472 6f70 7065 645f 6469        dropped_di
+000021b0: 6d73 203d 2073 6967 6e61 7475 7265 2e61  ms = signature.a
+000021c0: 6c6c 5f69 6e70 7574 5f63 6f72 655f 6469  ll_input_core_di
+000021d0: 6d73 202d 2073 6574 286f 7574 7075 745f  ms - set(output_
+000021e0: 6469 6d73 290a 2020 2020 2020 2020 6966  dims).        if
+000021f0: 2064 726f 7070 6564 5f64 696d 733a 0a20   dropped_dims:. 
+00002200: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+00002210: 7265 645f 636f 6f72 6473 203d 207b 0a20  red_coords = {. 
+00002220: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00002230: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
+00002240: 6d65 7267 6564 5f76 6172 732e 6974 656d  merged_vars.item
+00002250: 7328 2920 6966 2064 726f 7070 6564 5f64  s() if dropped_d
+00002260: 696d 732e 6973 6469 736a 6f69 6e74 2876  ims.isdisjoint(v
+00002270: 2e64 696d 7329 0a20 2020 2020 2020 2020  .dims).         
+00002280: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+00002290: 2066 696c 7465 7265 645f 696e 6465 7865   filtered_indexe
+000022a0: 7320 3d20 6669 6c74 6572 5f69 6e64 6578  s = filter_index
+000022b0: 6573 5f66 726f 6d5f 636f 6f72 6473 280a  es_from_coords(.
+000022c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000022d0: 6d65 7267 6564 5f69 6e64 6578 6573 2c20  merged_indexes, 
+000022e0: 7365 7428 6669 6c74 6572 6564 5f63 6f6f  set(filtered_coo
+000022f0: 7264 7329 0a20 2020 2020 2020 2020 2020  rds).           
+00002300: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
+00002310: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00002320: 7465 7265 645f 636f 6f72 6473 203d 206d  tered_coords = m
+00002330: 6572 6765 645f 7661 7273 0a20 2020 2020  erged_vars.     
+00002340: 2020 2020 2020 2066 696c 7465 7265 645f         filtered_
+00002350: 696e 6465 7865 7320 3d20 6d65 7267 6564  indexes = merged
+00002360: 5f69 6e64 6578 6573 0a20 2020 2020 2020  _indexes.       
+00002370: 206f 7574 7075 745f 636f 6f72 6473 2e61   output_coords.a
+00002380: 7070 656e 6428 6669 6c74 6572 6564 5f63  ppend(filtered_c
+00002390: 6f6f 7264 7329 0a20 2020 2020 2020 206f  oords).        o
+000023a0: 7574 7075 745f 696e 6465 7865 732e 6170  utput_indexes.ap
+000023b0: 7065 6e64 2866 696c 7465 7265 645f 696e  pend(filtered_in
+000023c0: 6465 7865 7329 0a0a 2020 2020 7265 7475  dexes)..    retu
+000023d0: 726e 206f 7574 7075 745f 636f 6f72 6473  rn output_coords
+000023e0: 2c20 6f75 7470 7574 5f69 6e64 6578 6573  , output_indexes
+000023f0: 0a0a 0a64 6566 2061 7070 6c79 5f64 6174  ...def apply_dat
+00002400: 6161 7272 6179 5f76 6675 6e63 280a 2020  aarray_vfunc(.  
+00002410: 2020 6675 6e63 2c0a 2020 2020 2a61 7267    func,.    *arg
+00002420: 732c 0a20 2020 2073 6967 6e61 7475 7265  s,.    signature
+00002430: 3a20 5f55 4675 6e63 5369 676e 6174 7572  : _UFuncSignatur
+00002440: 652c 0a20 2020 206a 6f69 6e3a 204a 6f69  e,.    join: Joi
+00002450: 6e4f 7074 696f 6e73 203d 2022 696e 6e65  nOptions = "inne
+00002460: 7222 2c0a 2020 2020 6578 636c 7564 655f  r",.    exclude_
+00002470: 6469 6d73 3d66 726f 7a65 6e73 6574 2829  dims=frozenset()
+00002480: 2c0a 2020 2020 6b65 6570 5f61 7474 7273  ,.    keep_attrs
+00002490: 3d22 6f76 6572 7269 6465 222c 0a29 202d  ="override",.) -
+000024a0: 3e20 7475 706c 655b 4461 7461 4172 7261  > tuple[DataArra
+000024b0: 792c 202e 2e2e 5d20 7c20 4461 7461 4172  y, ...] | DataAr
+000024c0: 7261 793a 0a20 2020 2022 2222 4170 706c  ray:.    """Appl
+000024d0: 7920 6120 7661 7269 6162 6c65 206c 6576  y a variable lev
+000024e0: 656c 2066 756e 6374 696f 6e20 6f76 6572  el function over
+000024f0: 2044 6174 6141 7272 6179 2c20 5661 7269   DataArray, Vari
+00002500: 6162 6c65 2061 6e64 2f6f 7220 6e64 6172  able and/or ndar
+00002510: 7261 790a 2020 2020 6f62 6a65 6374 732e  ray.    objects.
+00002520: 0a20 2020 2022 2222 0a20 2020 2066 726f  .    """.    fro
+00002530: 6d20 7861 7272 6179 2e63 6f72 652e 6461  m xarray.core.da
+00002540: 7461 6172 7261 7920 696d 706f 7274 2044  taarray import D
+00002550: 6174 6141 7272 6179 0a0a 2020 2020 6966  ataArray..    if
+00002560: 206c 656e 2861 7267 7329 203e 2031 3a0a   len(args) > 1:.
+00002570: 2020 2020 2020 2020 6172 6773 203d 2064          args = d
+00002580: 6565 705f 616c 6967 6e28 0a20 2020 2020  eep_align(.     
+00002590: 2020 2020 2020 2061 7267 732c 206a 6f69         args, joi
+000025a0: 6e3d 6a6f 696e 2c20 636f 7079 3d46 616c  n=join, copy=Fal
+000025b0: 7365 2c20 6578 636c 7564 653d 6578 636c  se, exclude=excl
+000025c0: 7564 655f 6469 6d73 2c20 7261 6973 655f  ude_dims, raise_
+000025d0: 6f6e 5f69 6e76 616c 6964 3d46 616c 7365  on_invalid=False
+000025e0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000025f0: 6f62 6a73 203d 205f 616c 6c5f 6f66 5f74  objs = _all_of_t
+00002600: 7970 6528 6172 6773 2c20 4461 7461 4172  ype(args, DataAr
+00002610: 7261 7929 0a0a 2020 2020 6966 206b 6565  ray)..    if kee
+00002620: 705f 6174 7472 7320 3d3d 2022 6472 6f70  p_attrs == "drop
+00002630: 223a 0a20 2020 2020 2020 206e 616d 6520  ":.        name 
+00002640: 3d20 7265 7375 6c74 5f6e 616d 6528 6172  = result_name(ar
+00002650: 6773 290a 2020 2020 656c 7365 3a0a 2020  gs).    else:.  
+00002660: 2020 2020 2020 6669 7273 745f 6f62 6a20        first_obj 
+00002670: 3d20 5f66 6972 7374 5f6f 665f 7479 7065  = _first_of_type
+00002680: 2861 7267 732c 2044 6174 6141 7272 6179  (args, DataArray
+00002690: 290a 2020 2020 2020 2020 6e61 6d65 203d  ).        name =
+000026a0: 2066 6972 7374 5f6f 626a 2e6e 616d 650a   first_obj.name.
+000026b0: 2020 2020 7265 7375 6c74 5f63 6f6f 7264      result_coord
+000026c0: 732c 2072 6573 756c 745f 696e 6465 7865  s, result_indexe
+000026d0: 7320 3d20 6275 696c 645f 6f75 7470 7574  s = build_output
+000026e0: 5f63 6f6f 7264 735f 616e 645f 696e 6465  _coords_and_inde
+000026f0: 7865 7328 0a20 2020 2020 2020 2061 7267  xes(.        arg
+00002700: 732c 2073 6967 6e61 7475 7265 2c20 6578  s, signature, ex
+00002710: 636c 7564 655f 6469 6d73 2c20 636f 6d62  clude_dims, comb
+00002720: 696e 655f 6174 7472 733d 6b65 6570 5f61  ine_attrs=keep_a
+00002730: 7474 7273 0a20 2020 2029 0a0a 2020 2020  ttrs.    )..    
+00002740: 6461 7461 5f76 6172 7320 3d20 5b67 6574  data_vars = [get
+00002750: 6174 7472 2861 2c20 2276 6172 6961 626c  attr(a, "variabl
+00002760: 6522 2c20 6129 2066 6f72 2061 2069 6e20  e", a) for a in 
+00002770: 6172 6773 5d0a 2020 2020 7265 7375 6c74  args].    result
+00002780: 5f76 6172 203d 2066 756e 6328 2a64 6174  _var = func(*dat
+00002790: 615f 7661 7273 290a 0a20 2020 206f 7574  a_vars)..    out
+000027a0: 3a20 7475 706c 655b 4461 7461 4172 7261  : tuple[DataArra
+000027b0: 792c 202e 2e2e 5d20 7c20 4461 7461 4172  y, ...] | DataAr
+000027c0: 7261 790a 2020 2020 6966 2073 6967 6e61  ray.    if signa
+000027d0: 7475 7265 2e6e 756d 5f6f 7574 7075 7473  ture.num_outputs
+000027e0: 203e 2031 3a0a 2020 2020 2020 2020 6f75   > 1:.        ou
+000027f0: 7420 3d20 7475 706c 6528 0a20 2020 2020  t = tuple(.     
+00002800: 2020 2020 2020 2044 6174 6141 7272 6179         DataArray
+00002810: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00002820: 2020 7661 7269 6162 6c65 2c20 636f 6f72    variable, coor
+00002830: 6473 3d63 6f6f 7264 732c 2069 6e64 6578  ds=coords, index
+00002840: 6573 3d69 6e64 6578 6573 2c20 6e61 6d65  es=indexes, name
+00002850: 3d6e 616d 652c 2066 6173 7470 6174 683d  =name, fastpath=
+00002860: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00002870: 2029 0a20 2020 2020 2020 2020 2020 2066   ).            f
+00002880: 6f72 2076 6172 6961 626c 652c 2063 6f6f  or variable, coo
+00002890: 7264 732c 2069 6e64 6578 6573 2069 6e20  rds, indexes in 
+000028a0: 7a69 7028 0a20 2020 2020 2020 2020 2020  zip(.           
+000028b0: 2020 2020 2072 6573 756c 745f 7661 722c       result_var,
+000028c0: 2072 6573 756c 745f 636f 6f72 6473 2c20   result_coords, 
+000028d0: 7265 7375 6c74 5f69 6e64 6578 6573 0a20  result_indexes. 
+000028e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000028f0: 2020 2020 2029 0a20 2020 2065 6c73 653a       ).    else:
+00002900: 0a20 2020 2020 2020 2028 636f 6f72 6473  .        (coords
+00002910: 2c29 203d 2072 6573 756c 745f 636f 6f72  ,) = result_coor
+00002920: 6473 0a20 2020 2020 2020 2028 696e 6465  ds.        (inde
+00002930: 7865 732c 2920 3d20 7265 7375 6c74 5f69  xes,) = result_i
+00002940: 6e64 6578 6573 0a20 2020 2020 2020 206f  ndexes.        o
+00002950: 7574 203d 2044 6174 6141 7272 6179 280a  ut = DataArray(.
+00002960: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00002970: 6c74 5f76 6172 2c20 636f 6f72 6473 3d63  lt_var, coords=c
+00002980: 6f6f 7264 732c 2069 6e64 6578 6573 3d69  oords, indexes=i
+00002990: 6e64 6578 6573 2c20 6e61 6d65 3d6e 616d  ndexes, name=nam
+000029a0: 652c 2066 6173 7470 6174 683d 5472 7565  e, fastpath=True
+000029b0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000029c0: 6174 7472 7320 3d20 6d65 7267 655f 6174  attrs = merge_at
+000029d0: 7472 7328 5b78 2e61 7474 7273 2066 6f72  trs([x.attrs for
+000029e0: 2078 2069 6e20 6f62 6a73 5d2c 2063 6f6d   x in objs], com
+000029f0: 6269 6e65 5f61 7474 7273 3d6b 6565 705f  bine_attrs=keep_
+00002a00: 6174 7472 7329 0a20 2020 2069 6620 6973  attrs).    if is
+00002a10: 696e 7374 616e 6365 286f 7574 2c20 7475  instance(out, tu
+00002a20: 706c 6529 3a0a 2020 2020 2020 2020 666f  ple):.        fo
+00002a30: 7220 6461 2069 6e20 6f75 743a 0a20 2020  r da in out:.   
+00002a40: 2020 2020 2020 2020 2064 612e 6174 7472           da.attr
+00002a50: 7320 3d20 6174 7472 730a 2020 2020 656c  s = attrs.    el
+00002a60: 7365 3a0a 2020 2020 2020 2020 6f75 742e  se:.        out.
+00002a70: 6174 7472 7320 3d20 6174 7472 730a 0a20  attrs = attrs.. 
+00002a80: 2020 2072 6574 7572 6e20 6f75 740a 0a0a     return out...
+00002a90: 6465 6620 6f72 6465 7265 645f 7365 745f  def ordered_set_
+00002aa0: 756e 696f 6e28 616c 6c5f 6b65 7973 3a20  union(all_keys: 
+00002ab0: 6c69 7374 5b49 7465 7261 626c 655d 2920  list[Iterable]) 
+00002ac0: 2d3e 2049 7465 7261 626c 653a 0a20 2020  -> Iterable:.   
+00002ad0: 2072 6574 7572 6e20 7b6b 6579 3a20 4e6f   return {key: No
+00002ae0: 6e65 2066 6f72 206b 6579 7320 696e 2061  ne for keys in a
+00002af0: 6c6c 5f6b 6579 7320 666f 7220 6b65 7920  ll_keys for key 
+00002b00: 696e 206b 6579 737d 2e6b 6579 7328 290a  in keys}.keys().
+00002b10: 0a0a 6465 6620 6f72 6465 7265 645f 7365  ..def ordered_se
+00002b20: 745f 696e 7465 7273 6563 7469 6f6e 2861  t_intersection(a
+00002b30: 6c6c 5f6b 6579 733a 206c 6973 745b 4974  ll_keys: list[It
+00002b40: 6572 6162 6c65 5d29 202d 3e20 4974 6572  erable]) -> Iter
+00002b50: 6162 6c65 3a0a 2020 2020 696e 7465 7273  able:.    inters
+00002b60: 6563 7469 6f6e 203d 2073 6574 2861 6c6c  ection = set(all
+00002b70: 5f6b 6579 735b 305d 290a 2020 2020 666f  _keys[0]).    fo
+00002b80: 7220 6b65 7973 2069 6e20 616c 6c5f 6b65  r keys in all_ke
+00002b90: 7973 5b31 3a5d 3a0a 2020 2020 2020 2020  ys[1:]:.        
+00002ba0: 696e 7465 7273 6563 7469 6f6e 2e69 6e74  intersection.int
+00002bb0: 6572 7365 6374 696f 6e5f 7570 6461 7465  ersection_update
+00002bc0: 286b 6579 7329 0a20 2020 2072 6574 7572  (keys).    retur
+00002bd0: 6e20 5b6b 6579 2066 6f72 206b 6579 2069  n [key for key i
+00002be0: 6e20 616c 6c5f 6b65 7973 5b30 5d20 6966  n all_keys[0] if
+00002bf0: 206b 6579 2069 6e20 696e 7465 7273 6563   key in intersec
+00002c00: 7469 6f6e 5d0a 0a0a 6465 6620 6173 7365  tion]...def asse
+00002c10: 7274 5f61 6e64 5f72 6574 7572 6e5f 6578  rt_and_return_ex
+00002c20: 6163 745f 6d61 7463 6828 616c 6c5f 6b65  act_match(all_ke
+00002c30: 7973 293a 0a20 2020 2066 6972 7374 5f6b  ys):.    first_k
+00002c40: 6579 7320 3d20 616c 6c5f 6b65 7973 5b30  eys = all_keys[0
+00002c50: 5d0a 2020 2020 666f 7220 6b65 7973 2069  ].    for keys i
+00002c60: 6e20 616c 6c5f 6b65 7973 5b31 3a5d 3a0a  n all_keys[1:]:.
+00002c70: 2020 2020 2020 2020 6966 206b 6579 7320          if keys 
+00002c80: 213d 2066 6972 7374 5f6b 6579 733a 0a20  != first_keys:. 
+00002c90: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00002ca0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00002cb0: 2020 2020 2020 2020 2020 2020 2022 6578               "ex
+00002cc0: 6163 7420 6d61 7463 6820 7265 7175 6972  act match requir
+00002cd0: 6564 2066 6f72 2061 6c6c 2064 6174 6120  ed for all data 
+00002ce0: 7661 7269 6162 6c65 206e 616d 6573 2c20  variable names, 
+00002cf0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00002d00: 2020 6622 6275 7420 7b6b 6579 7321 727d    f"but {keys!r}
+00002d10: 2021 3d20 7b66 6972 7374 5f6b 6579 7321   != {first_keys!
+00002d20: 727d 220a 2020 2020 2020 2020 2020 2020  r}".            
+00002d30: 290a 2020 2020 7265 7475 726e 2066 6972  ).    return fir
+00002d40: 7374 5f6b 6579 730a 0a0a 5f4a 4f49 4e45  st_keys..._JOINE
+00002d50: 5253 3a20 6469 6374 5b73 7472 2c20 4361  RS: dict[str, Ca
+00002d60: 6c6c 6162 6c65 5d20 3d20 7b0a 2020 2020  llable] = {.    
+00002d70: 2269 6e6e 6572 223a 206f 7264 6572 6564  "inner": ordered
+00002d80: 5f73 6574 5f69 6e74 6572 7365 6374 696f  _set_intersectio
+00002d90: 6e2c 0a20 2020 2022 6f75 7465 7222 3a20  n,.    "outer": 
+00002da0: 6f72 6465 7265 645f 7365 745f 756e 696f  ordered_set_unio
+00002db0: 6e2c 0a20 2020 2022 6c65 6674 223a 206f  n,.    "left": o
+00002dc0: 7065 7261 746f 722e 6974 656d 6765 7474  perator.itemgett
+00002dd0: 6572 2830 292c 0a20 2020 2022 7269 6768  er(0),.    "righ
+00002de0: 7422 3a20 6f70 6572 6174 6f72 2e69 7465  t": operator.ite
+00002df0: 6d67 6574 7465 7228 2d31 292c 0a20 2020  mgetter(-1),.   
+00002e00: 2022 6578 6163 7422 3a20 6173 7365 7274   "exact": assert
+00002e10: 5f61 6e64 5f72 6574 7572 6e5f 6578 6163  _and_return_exac
+00002e20: 745f 6d61 7463 682c 0a7d 0a0a 0a64 6566  t_match,.}...def
+00002e30: 206a 6f69 6e5f 6469 6374 5f6b 6579 7328   join_dict_keys(
+00002e40: 6f62 6a65 6374 733a 2049 7465 7261 626c  objects: Iterabl
+00002e50: 655b 4d61 7070 696e 6720 7c20 416e 795d  e[Mapping | Any]
+00002e60: 2c20 686f 773a 2073 7472 203d 2022 696e  , how: str = "in
+00002e70: 6e65 7222 2920 2d3e 2049 7465 7261 626c  ner") -> Iterabl
+00002e80: 653a 0a20 2020 206a 6f69 6e65 7220 3d20  e:.    joiner = 
+00002e90: 5f4a 4f49 4e45 5253 5b68 6f77 5d0a 2020  _JOINERS[how].  
+00002ea0: 2020 616c 6c5f 6b65 7973 203d 205b 6f62    all_keys = [ob
+00002eb0: 6a2e 6b65 7973 2829 2066 6f72 206f 626a  j.keys() for obj
+00002ec0: 2069 6e20 6f62 6a65 6374 7320 6966 2068   in objects if h
+00002ed0: 6173 6174 7472 286f 626a 2c20 226b 6579  asattr(obj, "key
+00002ee0: 7322 295d 0a20 2020 2072 6574 7572 6e20  s")].    return 
+00002ef0: 6a6f 696e 6572 2861 6c6c 5f6b 6579 7329  joiner(all_keys)
+00002f00: 0a0a 0a64 6566 2063 6f6c 6c65 6374 5f64  ...def collect_d
+00002f10: 6963 745f 7661 6c75 6573 280a 2020 2020  ict_values(.    
+00002f20: 6f62 6a65 6374 733a 2049 7465 7261 626c  objects: Iterabl
+00002f30: 655b 4d61 7070 696e 6720 7c20 416e 795d  e[Mapping | Any]
+00002f40: 2c20 6b65 7973 3a20 4974 6572 6162 6c65  , keys: Iterable
+00002f50: 2c20 6669 6c6c 5f76 616c 7565 3a20 6f62  , fill_value: ob
+00002f60: 6a65 6374 203d 204e 6f6e 650a 2920 2d3e  ject = None.) ->
+00002f70: 206c 6973 745b 6c69 7374 5d3a 0a20 2020   list[list]:.   
+00002f80: 2072 6574 7572 6e20 5b0a 2020 2020 2020   return [.      
+00002f90: 2020 5b6f 626a 2e67 6574 286b 6579 2c20    [obj.get(key, 
+00002fa0: 6669 6c6c 5f76 616c 7565 2920 6966 2069  fill_value) if i
+00002fb0: 735f 6469 6374 5f6c 696b 6528 6f62 6a29  s_dict_like(obj)
+00002fc0: 2065 6c73 6520 6f62 6a20 666f 7220 6f62   else obj for ob
+00002fd0: 6a20 696e 206f 626a 6563 7473 5d0a 2020  j in objects].  
+00002fe0: 2020 2020 2020 666f 7220 6b65 7920 696e        for key in
+00002ff0: 206b 6579 730a 2020 2020 5d0a 0a0a 6465   keys.    ]...de
+00003000: 6620 5f61 735f 7661 7269 6162 6c65 735f  f _as_variables_
+00003010: 6f72 5f76 6172 6961 626c 6528 6172 6729  or_variable(arg)
+00003020: 3a0a 2020 2020 7472 793a 0a20 2020 2020  :.    try:.     
+00003030: 2020 2072 6574 7572 6e20 6172 672e 7661     return arg.va
+00003040: 7269 6162 6c65 730a 2020 2020 6578 6365  riables.    exce
+00003050: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
+00003060: 723a 0a20 2020 2020 2020 2074 7279 3a0a  r:.        try:.
+00003070: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00003080: 726e 2061 7267 2e76 6172 6961 626c 650a  rn arg.variable.
+00003090: 2020 2020 2020 2020 6578 6365 7074 2041          except A
+000030a0: 7474 7269 6275 7465 4572 726f 723a 0a20  ttributeError:. 
+000030b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000030c0: 6e20 6172 670a 0a0a 6465 6620 5f75 6e70  n arg...def _unp
+000030d0: 6163 6b5f 6469 6374 5f74 7570 6c65 7328  ack_dict_tuples(
+000030e0: 0a20 2020 2072 6573 756c 745f 7661 7273  .    result_vars
+000030f0: 3a20 4d61 7070 696e 675b 416e 792c 2074  : Mapping[Any, t
+00003100: 7570 6c65 5b56 6172 6961 626c 652c 202e  uple[Variable, .
+00003110: 2e2e 5d5d 2c20 6e75 6d5f 6f75 7470 7574  ..]], num_output
+00003120: 733a 2069 6e74 0a29 202d 3e20 7475 706c  s: int.) -> tupl
+00003130: 655b 6469 6374 5b48 6173 6861 626c 652c  e[dict[Hashable,
+00003140: 2056 6172 6961 626c 655d 2c20 2e2e 2e5d   Variable], ...]
+00003150: 3a0a 2020 2020 6f75 743a 2074 7570 6c65  :.    out: tuple
+00003160: 5b64 6963 745b 4861 7368 6162 6c65 2c20  [dict[Hashable, 
+00003170: 5661 7269 6162 6c65 5d2c 202e 2e2e 5d20  Variable], ...] 
+00003180: 3d20 7475 706c 6528 7b7d 2066 6f72 205f  = tuple({} for _
+00003190: 2069 6e20 7261 6e67 6528 6e75 6d5f 6f75   in range(num_ou
+000031a0: 7470 7574 7329 290a 2020 2020 666f 7220  tputs)).    for 
+000031b0: 6e61 6d65 2c20 7661 6c75 6573 2069 6e20  name, values in 
+000031c0: 7265 7375 6c74 5f76 6172 732e 6974 656d  result_vars.item
+000031d0: 7328 293a 0a20 2020 2020 2020 2066 6f72  s():.        for
+000031e0: 2076 616c 7565 2c20 7265 7375 6c74 735f   value, results_
+000031f0: 6469 6374 2069 6e20 7a69 7028 7661 6c75  dict in zip(valu
+00003200: 6573 2c20 6f75 7429 3a0a 2020 2020 2020  es, out):.      
+00003210: 2020 2020 2020 7265 7375 6c74 735f 6469        results_di
+00003220: 6374 5b6e 616d 655d 203d 2076 616c 7565  ct[name] = value
+00003230: 0a20 2020 2072 6574 7572 6e20 6f75 740a  .    return out.
+00003240: 0a0a 6465 6620 6170 706c 795f 6469 6374  ..def apply_dict
+00003250: 5f6f 665f 7661 7269 6162 6c65 735f 7666  _of_variables_vf
+00003260: 756e 6328 0a20 2020 2066 756e 632c 202a  unc(.    func, *
+00003270: 6172 6773 2c20 7369 676e 6174 7572 653a  args, signature:
+00003280: 205f 5546 756e 6353 6967 6e61 7475 7265   _UFuncSignature
+00003290: 2c20 6a6f 696e 3d22 696e 6e65 7222 2c20  , join="inner", 
+000032a0: 6669 6c6c 5f76 616c 7565 3d4e 6f6e 650a  fill_value=None.
+000032b0: 293a 0a20 2020 2022 2222 4170 706c 7920  ):.    """Apply 
+000032c0: 6120 7661 7269 6162 6c65 206c 6576 656c  a variable level
+000032d0: 2066 756e 6374 696f 6e20 6f76 6572 2064   function over d
+000032e0: 6963 7473 206f 6620 4461 7461 4172 7261  icts of DataArra
+000032f0: 792c 2044 6174 6141 7272 6179 2c0a 2020  y, DataArray,.  
+00003300: 2020 5661 7269 6162 6c65 2061 6e64 206e    Variable and n
+00003310: 6461 7272 6179 206f 626a 6563 7473 2e0a  darray objects..
+00003320: 2020 2020 2222 220a 2020 2020 6172 6773      """.    args
+00003330: 203d 2074 7570 6c65 285f 6173 5f76 6172   = tuple(_as_var
+00003340: 6961 626c 6573 5f6f 725f 7661 7269 6162  iables_or_variab
+00003350: 6c65 2861 7267 2920 666f 7220 6172 6720  le(arg) for arg 
+00003360: 696e 2061 7267 7329 0a20 2020 206e 616d  in args).    nam
+00003370: 6573 203d 206a 6f69 6e5f 6469 6374 5f6b  es = join_dict_k
+00003380: 6579 7328 6172 6773 2c20 686f 773d 6a6f  eys(args, how=jo
+00003390: 696e 290a 2020 2020 6772 6f75 7065 645f  in).    grouped_
+000033a0: 6279 5f6e 616d 6520 3d20 636f 6c6c 6563  by_name = collec
+000033b0: 745f 6469 6374 5f76 616c 7565 7328 6172  t_dict_values(ar
+000033c0: 6773 2c20 6e61 6d65 732c 2066 696c 6c5f  gs, names, fill_
+000033d0: 7661 6c75 6529 0a0a 2020 2020 7265 7375  value)..    resu
+000033e0: 6c74 5f76 6172 7320 3d20 7b7d 0a20 2020  lt_vars = {}.   
+000033f0: 2066 6f72 206e 616d 652c 2076 6172 6961   for name, varia
+00003400: 626c 655f 6172 6773 2069 6e20 7a69 7028  ble_args in zip(
+00003410: 6e61 6d65 732c 2067 726f 7570 6564 5f62  names, grouped_b
+00003420: 795f 6e61 6d65 293a 0a20 2020 2020 2020  y_name):.       
+00003430: 2072 6573 756c 745f 7661 7273 5b6e 616d   result_vars[nam
+00003440: 655d 203d 2066 756e 6328 2a76 6172 6961  e] = func(*varia
+00003450: 626c 655f 6172 6773 290a 0a20 2020 2069  ble_args)..    i
+00003460: 6620 7369 676e 6174 7572 652e 6e75 6d5f  f signature.num_
+00003470: 6f75 7470 7574 7320 3e20 313a 0a20 2020  outputs > 1:.   
+00003480: 2020 2020 2072 6574 7572 6e20 5f75 6e70       return _unp
+00003490: 6163 6b5f 6469 6374 5f74 7570 6c65 7328  ack_dict_tuples(
+000034a0: 7265 7375 6c74 5f76 6172 732c 2073 6967  result_vars, sig
+000034b0: 6e61 7475 7265 2e6e 756d 5f6f 7574 7075  nature.num_outpu
+000034c0: 7473 290a 2020 2020 656c 7365 3a0a 2020  ts).    else:.  
+000034d0: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+000034e0: 756c 745f 7661 7273 0a0a 0a64 6566 205f  ult_vars...def _
+000034f0: 6661 7374 5f64 6174 6173 6574 280a 2020  fast_dataset(.  
+00003500: 2020 7661 7269 6162 6c65 733a 2064 6963    variables: dic
+00003510: 745b 4861 7368 6162 6c65 2c20 5661 7269  t[Hashable, Vari
+00003520: 6162 6c65 5d2c 0a20 2020 2063 6f6f 7264  able],.    coord
+00003530: 5f76 6172 6961 626c 6573 3a20 4d61 7070  _variables: Mapp
+00003540: 696e 675b 4861 7368 6162 6c65 2c20 5661  ing[Hashable, Va
+00003550: 7269 6162 6c65 5d2c 0a20 2020 2069 6e64  riable],.    ind
+00003560: 6578 6573 3a20 6469 6374 5b48 6173 6861  exes: dict[Hasha
+00003570: 626c 652c 2049 6e64 6578 5d2c 0a29 202d  ble, Index],.) -
+00003580: 3e20 4461 7461 7365 743a 0a20 2020 2022  > Dataset:.    "
+00003590: 2222 4372 6561 7465 2061 2064 6174 6173  ""Create a datas
+000035a0: 6574 2061 7320 7175 6963 6b6c 7920 6173  et as quickly as
+000035b0: 2070 6f73 7369 626c 652e 0a0a 2020 2020   possible...    
+000035c0: 4265 7761 7265 3a20 7468 6520 6076 6172  Beware: the `var
+000035d0: 6961 626c 6573 6020 6469 6374 2069 7320  iables` dict is 
+000035e0: 6d6f 6469 6669 6564 2049 4e50 4c41 4345  modified INPLACE
+000035f0: 2e0a 2020 2020 2222 220a 2020 2020 6672  ..    """.    fr
+00003600: 6f6d 2078 6172 7261 792e 636f 7265 2e64  om xarray.core.d
+00003610: 6174 6173 6574 2069 6d70 6f72 7420 4461  ataset import Da
+00003620: 7461 7365 740a 0a20 2020 2076 6172 6961  taset..    varia
+00003630: 626c 6573 2e75 7064 6174 6528 636f 6f72  bles.update(coor
+00003640: 645f 7661 7269 6162 6c65 7329 0a20 2020  d_variables).   
+00003650: 2063 6f6f 7264 5f6e 616d 6573 203d 2073   coord_names = s
+00003660: 6574 2863 6f6f 7264 5f76 6172 6961 626c  et(coord_variabl
+00003670: 6573 290a 2020 2020 7265 7475 726e 2044  es).    return D
+00003680: 6174 6173 6574 2e5f 636f 6e73 7472 7563  ataset._construc
+00003690: 745f 6469 7265 6374 2876 6172 6961 626c  t_direct(variabl
+000036a0: 6573 2c20 636f 6f72 645f 6e61 6d65 732c  es, coord_names,
+000036b0: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
+000036c0: 290a 0a0a 6465 6620 6170 706c 795f 6461  )...def apply_da
+000036d0: 7461 7365 745f 7666 756e 6328 0a20 2020  taset_vfunc(.   
+000036e0: 2066 756e 632c 0a20 2020 202a 6172 6773   func,.    *args
+000036f0: 2c0a 2020 2020 7369 676e 6174 7572 653a  ,.    signature:
+00003700: 205f 5546 756e 6353 6967 6e61 7475 7265   _UFuncSignature
+00003710: 2c0a 2020 2020 6a6f 696e 3d22 696e 6e65  ,.    join="inne
+00003720: 7222 2c0a 2020 2020 6461 7461 7365 745f  r",.    dataset_
+00003730: 6a6f 696e 3d22 6578 6163 7422 2c0a 2020  join="exact",.  
+00003740: 2020 6669 6c6c 5f76 616c 7565 3d5f 4e4f    fill_value=_NO
+00003750: 5f46 494c 4c5f 5641 4c55 452c 0a20 2020  _FILL_VALUE,.   
+00003760: 2065 7863 6c75 6465 5f64 696d 733d 6672   exclude_dims=fr
+00003770: 6f7a 656e 7365 7428 292c 0a20 2020 206b  ozenset(),.    k
+00003780: 6565 705f 6174 7472 733d 226f 7665 7272  eep_attrs="overr
+00003790: 6964 6522 2c0a 2920 2d3e 2044 6174 6173  ide",.) -> Datas
+000037a0: 6574 207c 2074 7570 6c65 5b44 6174 6173  et | tuple[Datas
+000037b0: 6574 2c20 2e2e 2e5d 3a0a 2020 2020 2222  et, ...]:.    ""
+000037c0: 2241 7070 6c79 2061 2076 6172 6961 626c  "Apply a variabl
+000037d0: 6520 6c65 7665 6c20 6675 6e63 7469 6f6e  e level function
+000037e0: 206f 7665 7220 4461 7461 7365 742c 2064   over Dataset, d
+000037f0: 6963 7420 6f66 2044 6174 6141 7272 6179  ict of DataArray
+00003800: 2c0a 2020 2020 4461 7461 4172 7261 792c  ,.    DataArray,
+00003810: 2056 6172 6961 626c 6520 616e 642f 6f72   Variable and/or
+00003820: 206e 6461 7272 6179 206f 626a 6563 7473   ndarray objects
+00003830: 2e0a 2020 2020 2222 220a 2020 2020 6672  ..    """.    fr
+00003840: 6f6d 2078 6172 7261 792e 636f 7265 2e64  om xarray.core.d
+00003850: 6174 6173 6574 2069 6d70 6f72 7420 4461  ataset import Da
+00003860: 7461 7365 740a 0a20 2020 2069 6620 6461  taset..    if da
+00003870: 7461 7365 745f 6a6f 696e 206e 6f74 2069  taset_join not i
+00003880: 6e20 5f4a 4f49 4e53 5f57 4954 484f 5554  n _JOINS_WITHOUT
+00003890: 5f46 494c 4c5f 5641 4c55 4553 2061 6e64  _FILL_VALUES and
+000038a0: 2066 696c 6c5f 7661 6c75 6520 6973 205f   fill_value is _
+000038b0: 4e4f 5f46 494c 4c5f 5641 4c55 453a 0a20  NO_FILL_VALUE:. 
+000038c0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+000038d0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+000038e0: 2020 2020 2274 6f20 6170 706c 7920 616e      "to apply an
+000038f0: 206f 7065 7261 7469 6f6e 2074 6f20 6461   operation to da
+00003900: 7461 7365 7473 2077 6974 6820 6469 6666  tasets with diff
+00003910: 6572 656e 7420 220a 2020 2020 2020 2020  erent ".        
+00003920: 2020 2020 2264 6174 6120 7661 7269 6162      "data variab
+00003930: 6c65 7320 7769 7468 2061 7070 6c79 5f75  les with apply_u
+00003940: 6675 6e63 2c20 796f 7520 6d75 7374 2073  func, you must s
+00003950: 7570 706c 7920 7468 6520 220a 2020 2020  upply the ".    
+00003960: 2020 2020 2020 2020 2264 6174 6173 6574          "dataset
+00003970: 5f66 696c 6c5f 7661 6c75 6520 6172 6775  _fill_value argu
+00003980: 6d65 6e74 2e22 0a20 2020 2020 2020 2029  ment.".        )
+00003990: 0a0a 2020 2020 6f62 6a73 203d 205f 616c  ..    objs = _al
+000039a0: 6c5f 6f66 5f74 7970 6528 6172 6773 2c20  l_of_type(args, 
+000039b0: 4461 7461 7365 7429 0a0a 2020 2020 6966  Dataset)..    if
+000039c0: 206c 656e 2861 7267 7329 203e 2031 3a0a   len(args) > 1:.
+000039d0: 2020 2020 2020 2020 6172 6773 203d 2064          args = d
+000039e0: 6565 705f 616c 6967 6e28 0a20 2020 2020  eep_align(.     
+000039f0: 2020 2020 2020 2061 7267 732c 206a 6f69         args, joi
+00003a00: 6e3d 6a6f 696e 2c20 636f 7079 3d46 616c  n=join, copy=Fal
+00003a10: 7365 2c20 6578 636c 7564 653d 6578 636c  se, exclude=excl
+00003a20: 7564 655f 6469 6d73 2c20 7261 6973 655f  ude_dims, raise_
+00003a30: 6f6e 5f69 6e76 616c 6964 3d46 616c 7365  on_invalid=False
+00003a40: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00003a50: 6c69 7374 5f6f 665f 636f 6f72 6473 2c20  list_of_coords, 
+00003a60: 6c69 7374 5f6f 665f 696e 6465 7865 7320  list_of_indexes 
+00003a70: 3d20 6275 696c 645f 6f75 7470 7574 5f63  = build_output_c
+00003a80: 6f6f 7264 735f 616e 645f 696e 6465 7865  oords_and_indexe
+00003a90: 7328 0a20 2020 2020 2020 2061 7267 732c  s(.        args,
+00003aa0: 2073 6967 6e61 7475 7265 2c20 6578 636c   signature, excl
+00003ab0: 7564 655f 6469 6d73 2c20 636f 6d62 696e  ude_dims, combin
+00003ac0: 655f 6174 7472 733d 6b65 6570 5f61 7474  e_attrs=keep_att
+00003ad0: 7273 0a20 2020 2029 0a20 2020 2061 7267  rs.    ).    arg
+00003ae0: 7320 3d20 7475 706c 6528 6765 7461 7474  s = tuple(getatt
+00003af0: 7228 6172 672c 2022 6461 7461 5f76 6172  r(arg, "data_var
+00003b00: 7322 2c20 6172 6729 2066 6f72 2061 7267  s", arg) for arg
+00003b10: 2069 6e20 6172 6773 290a 0a20 2020 2072   in args)..    r
+00003b20: 6573 756c 745f 7661 7273 203d 2061 7070  esult_vars = app
+00003b30: 6c79 5f64 6963 745f 6f66 5f76 6172 6961  ly_dict_of_varia
+00003b40: 626c 6573 5f76 6675 6e63 280a 2020 2020  bles_vfunc(.    
+00003b50: 2020 2020 6675 6e63 2c20 2a61 7267 732c      func, *args,
+00003b60: 2073 6967 6e61 7475 7265 3d73 6967 6e61   signature=signa
+00003b70: 7475 7265 2c20 6a6f 696e 3d64 6174 6173  ture, join=datas
+00003b80: 6574 5f6a 6f69 6e2c 2066 696c 6c5f 7661  et_join, fill_va
+00003b90: 6c75 653d 6669 6c6c 5f76 616c 7565 0a20  lue=fill_value. 
+00003ba0: 2020 2029 0a0a 2020 2020 6f75 743a 2044     )..    out: D
+00003bb0: 6174 6173 6574 207c 2074 7570 6c65 5b44  ataset | tuple[D
+00003bc0: 6174 6173 6574 2c20 2e2e 2e5d 0a20 2020  ataset, ...].   
+00003bd0: 2069 6620 7369 676e 6174 7572 652e 6e75   if signature.nu
+00003be0: 6d5f 6f75 7470 7574 7320 3e20 313a 0a20  m_outputs > 1:. 
+00003bf0: 2020 2020 2020 206f 7574 203d 2074 7570         out = tup
+00003c00: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+00003c10: 5f66 6173 745f 6461 7461 7365 7428 2a61  _fast_dataset(*a
+00003c20: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
+00003c30: 2066 6f72 2061 7267 7320 696e 207a 6970   for args in zip
+00003c40: 2872 6573 756c 745f 7661 7273 2c20 6c69  (result_vars, li
+00003c50: 7374 5f6f 665f 636f 6f72 6473 2c20 6c69  st_of_coords, li
+00003c60: 7374 5f6f 665f 696e 6465 7865 7329 0a20  st_of_indexes). 
+00003c70: 2020 2020 2020 2029 0a20 2020 2065 6c73         ).    els
+00003c80: 653a 0a20 2020 2020 2020 2028 636f 6f72  e:.        (coor
+00003c90: 645f 7661 7273 2c29 203d 206c 6973 745f  d_vars,) = list_
+00003ca0: 6f66 5f63 6f6f 7264 730a 2020 2020 2020  of_coords.      
+00003cb0: 2020 2869 6e64 6578 6573 2c29 203d 206c    (indexes,) = l
+00003cc0: 6973 745f 6f66 5f69 6e64 6578 6573 0a20  ist_of_indexes. 
+00003cd0: 2020 2020 2020 206f 7574 203d 205f 6661         out = _fa
+00003ce0: 7374 5f64 6174 6173 6574 2872 6573 756c  st_dataset(resul
+00003cf0: 745f 7661 7273 2c20 636f 6f72 645f 7661  t_vars, coord_va
+00003d00: 7273 2c20 696e 6465 7865 733d 696e 6465  rs, indexes=inde
+00003d10: 7865 7329 0a0a 2020 2020 6174 7472 7320  xes)..    attrs 
+00003d20: 3d20 6d65 7267 655f 6174 7472 7328 5b78  = merge_attrs([x
+00003d30: 2e61 7474 7273 2066 6f72 2078 2069 6e20  .attrs for x in 
+00003d40: 6f62 6a73 5d2c 2063 6f6d 6269 6e65 5f61  objs], combine_a
+00003d50: 7474 7273 3d6b 6565 705f 6174 7472 7329  ttrs=keep_attrs)
+00003d60: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+00003d70: 6365 286f 7574 2c20 7475 706c 6529 3a0a  ce(out, tuple):.
+00003d80: 2020 2020 2020 2020 666f 7220 6473 2069          for ds i
+00003d90: 6e20 6f75 743a 0a20 2020 2020 2020 2020  n out:.         
+00003da0: 2020 2064 732e 6174 7472 7320 3d20 6174     ds.attrs = at
+00003db0: 7472 730a 2020 2020 656c 7365 3a0a 2020  trs.    else:.  
+00003dc0: 2020 2020 2020 6f75 742e 6174 7472 7320        out.attrs 
+00003dd0: 3d20 6174 7472 730a 0a20 2020 2072 6574  = attrs..    ret
+00003de0: 7572 6e20 6f75 740a 0a0a 6465 6620 5f69  urn out...def _i
+00003df0: 7465 725f 6f76 6572 5f73 656c 6563 7469  ter_over_selecti
+00003e00: 6f6e 7328 6f62 6a2c 2064 696d 2c20 7661  ons(obj, dim, va
+00003e10: 6c75 6573 293a 0a20 2020 2022 2222 4974  lues):.    """It
+00003e20: 6572 6174 6520 6f76 6572 2073 656c 6563  erate over selec
+00003e30: 7469 6f6e 7320 6f66 2061 6e20 7861 7272  tions of an xarr
+00003e40: 6179 206f 626a 6563 7420 696e 2074 6865  ay object in the
+00003e50: 2070 726f 7669 6465 6420 6f72 6465 722e   provided order.
+00003e60: 2222 220a 2020 2020 6672 6f6d 2078 6172  """.    from xar
+00003e70: 7261 792e 636f 7265 2e67 726f 7570 6279  ray.core.groupby
+00003e80: 2069 6d70 6f72 7420 5f64 756d 6d79 5f63   import _dummy_c
+00003e90: 6f70 790a 0a20 2020 2064 756d 6d79 203d  opy..    dummy =
+00003ea0: 204e 6f6e 650a 2020 2020 666f 7220 7661   None.    for va
+00003eb0: 6c75 6520 696e 2076 616c 7565 733a 0a20  lue in values:. 
+00003ec0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00003ed0: 2020 2020 2020 2020 6f62 6a5f 7365 6c20          obj_sel 
+00003ee0: 3d20 6f62 6a2e 7365 6c28 2a2a 7b64 696d  = obj.sel(**{dim
+00003ef0: 3a20 7661 6c75 657d 290a 2020 2020 2020  : value}).      
+00003f00: 2020 6578 6365 7074 2028 4b65 7945 7272    except (KeyErr
+00003f10: 6f72 2c20 496e 6465 7845 7272 6f72 293a  or, IndexError):
+00003f20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00003f30: 6475 6d6d 7920 6973 204e 6f6e 653a 0a20  dummy is None:. 
+00003f40: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00003f50: 756d 6d79 203d 205f 6475 6d6d 795f 636f  ummy = _dummy_co
+00003f60: 7079 286f 626a 290a 2020 2020 2020 2020  py(obj).        
+00003f70: 2020 2020 6f62 6a5f 7365 6c20 3d20 6475      obj_sel = du
+00003f80: 6d6d 790a 2020 2020 2020 2020 7969 656c  mmy.        yiel
+00003f90: 6420 6f62 6a5f 7365 6c0a 0a0a 6465 6620  d obj_sel...def 
+00003fa0: 6170 706c 795f 6772 6f75 7062 795f 6675  apply_groupby_fu
+00003fb0: 6e63 2866 756e 632c 202a 6172 6773 293a  nc(func, *args):
+00003fc0: 0a20 2020 2022 2222 4170 706c 7920 6120  .    """Apply a 
+00003fd0: 6461 7461 7365 7420 6f72 2064 6174 6172  dataset or datar
+00003fe0: 7261 7920 6c65 7665 6c20 6675 6e63 7469  ray level functi
+00003ff0: 6f6e 206f 7665 7220 4772 6f75 7042 792c  on over GroupBy,
+00004000: 2044 6174 6173 6574 2c0a 2020 2020 4461   Dataset,.    Da
+00004010: 7461 4172 7261 792c 2056 6172 6961 626c  taArray, Variabl
+00004020: 6520 616e 642f 6f72 206e 6461 7272 6179  e and/or ndarray
+00004030: 206f 626a 6563 7473 2e0a 2020 2020 2222   objects..    ""
+00004040: 220a 2020 2020 6672 6f6d 2078 6172 7261  ".    from xarra
+00004050: 792e 636f 7265 2e67 726f 7570 6279 2069  y.core.groupby i
+00004060: 6d70 6f72 7420 4772 6f75 7042 792c 2070  mport GroupBy, p
+00004070: 6565 6b5f 6174 0a20 2020 2066 726f 6d20  eek_at.    from 
+00004080: 7861 7272 6179 2e63 6f72 652e 7661 7269  xarray.core.vari
+00004090: 6162 6c65 2069 6d70 6f72 7420 5661 7269  able import Vari
+000040a0: 6162 6c65 0a0a 2020 2020 6772 6f75 7062  able..    groupb
+000040b0: 7973 203d 205b 6172 6720 666f 7220 6172  ys = [arg for ar
+000040c0: 6720 696e 2061 7267 7320 6966 2069 7369  g in args if isi
+000040d0: 6e73 7461 6e63 6528 6172 672c 2047 726f  nstance(arg, Gro
+000040e0: 7570 4279 295d 0a20 2020 2061 7373 6572  upBy)].    asser
+000040f0: 7420 6772 6f75 7062 7973 2c20 226d 7573  t groupbys, "mus
+00004100: 7420 6861 7665 2061 7420 6c65 6173 7420  t have at least 
+00004110: 6f6e 6520 6772 6f75 7062 7920 746f 2069  one groupby to i
+00004120: 7465 7261 7465 206f 7665 7222 0a20 2020  terate over".   
+00004130: 2066 6972 7374 5f67 726f 7570 6279 203d   first_groupby =
+00004140: 2067 726f 7570 6279 735b 305d 0a20 2020   groupbys[0].   
+00004150: 2069 6620 616e 7928 6e6f 7420 6669 7273   if any(not firs
+00004160: 745f 6772 6f75 7062 792e 5f67 726f 7570  t_groupby._group
+00004170: 2e65 7175 616c 7328 6762 2e5f 6772 6f75  .equals(gb._grou
+00004180: 7029 2066 6f72 2067 6220 696e 2067 726f  p) for gb in gro
+00004190: 7570 6279 735b 313a 5d29 3a0a 2020 2020  upbys[1:]):.    
+000041a0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+000041b0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+000041c0: 2020 2261 7070 6c79 5f75 6675 6e63 2063    "apply_ufunc c
+000041d0: 616e 206f 6e6c 7920 7065 7266 6f72 6d20  an only perform 
+000041e0: 6f70 6572 6174 696f 6e73 206f 7665 7220  operations over 
+000041f0: 220a 2020 2020 2020 2020 2020 2020 226d  ".            "m
+00004200: 756c 7469 706c 6520 4772 6f75 7042 7920  ultiple GroupBy 
+00004210: 6f62 6a65 6374 7320 6174 206f 6e63 6520  objects at once 
+00004220: 6966 2074 6865 7920 6172 6520 616c 6c20  if they are all 
+00004230: 220a 2020 2020 2020 2020 2020 2020 2267  ".            "g
+00004240: 726f 7570 6564 2074 6865 2073 616d 6520  rouped the same 
+00004250: 7761 7922 0a20 2020 2020 2020 2029 0a0a  way".        )..
+00004260: 2020 2020 6772 6f75 7065 645f 6469 6d20      grouped_dim 
+00004270: 3d20 6669 7273 745f 6772 6f75 7062 792e  = first_groupby.
+00004280: 5f67 726f 7570 2e6e 616d 650a 2020 2020  _group.name.    
+00004290: 756e 6971 7565 5f76 616c 7565 7320 3d20  unique_values = 
+000042a0: 6669 7273 745f 6772 6f75 7062 792e 5f75  first_groupby._u
+000042b0: 6e69 7175 655f 636f 6f72 642e 7661 6c75  nique_coord.valu
+000042c0: 6573 0a0a 2020 2020 6974 6572 6174 6f72  es..    iterator
+000042d0: 7320 3d20 5b5d 0a20 2020 2066 6f72 2061  s = [].    for a
+000042e0: 7267 2069 6e20 6172 6773 3a0a 2020 2020  rg in args:.    
+000042f0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00004300: 6528 6172 672c 2047 726f 7570 4279 293a  e(arg, GroupBy):
+00004310: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
+00004320: 7261 746f 7220 3d20 2876 616c 7565 2066  rator = (value f
+00004330: 6f72 205f 2c20 7661 6c75 6520 696e 2061  or _, value in a
+00004340: 7267 290a 2020 2020 2020 2020 656c 6966  rg).        elif
+00004350: 2068 6173 6174 7472 2861 7267 2c20 2264   hasattr(arg, "d
+00004360: 696d 7322 2920 616e 6420 6772 6f75 7065  ims") and groupe
+00004370: 645f 6469 6d20 696e 2061 7267 2e64 696d  d_dim in arg.dim
+00004380: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+00004390: 6620 6973 696e 7374 616e 6365 2861 7267  f isinstance(arg
+000043a0: 2c20 5661 7269 6162 6c65 293a 0a20 2020  , Variable):.   
+000043b0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+000043c0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+000043d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043e0: 2020 2022 6772 6f75 7062 7920 6f70 6572     "groupby oper
+000043f0: 6174 696f 6e73 2063 616e 6e6f 7420 6265  ations cannot be
+00004400: 2070 6572 666f 726d 6564 2077 6974 6820   performed with 
+00004410: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00004420: 2020 2020 2020 2278 6172 7261 792e 5661        "xarray.Va
+00004430: 7269 6162 6c65 206f 626a 6563 7473 2074  riable objects t
+00004440: 6861 7420 7368 6172 6520 6120 6469 6d65  hat share a dime
+00004450: 6e73 696f 6e20 7769 7468 2022 0a20 2020  nsion with ".   
+00004460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004470: 2022 7468 6520 6772 6f75 7065 6420 6469   "the grouped di
+00004480: 6d65 6e73 696f 6e22 0a20 2020 2020 2020  mension".       
+00004490: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000044a0: 2020 2020 2020 2069 7465 7261 746f 7220         iterator 
+000044b0: 3d20 5f69 7465 725f 6f76 6572 5f73 656c  = _iter_over_sel
+000044c0: 6563 7469 6f6e 7328 6172 672c 2067 726f  ections(arg, gro
+000044d0: 7570 6564 5f64 696d 2c20 756e 6971 7565  uped_dim, unique
+000044e0: 5f76 616c 7565 7329 0a20 2020 2020 2020  _values).       
+000044f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00004500: 2020 2069 7465 7261 746f 7220 3d20 6974     iterator = it
+00004510: 6572 746f 6f6c 732e 7265 7065 6174 2861  ertools.repeat(a
+00004520: 7267 290a 2020 2020 2020 2020 6974 6572  rg).        iter
+00004530: 6174 6f72 732e 6170 7065 6e64 2869 7465  ators.append(ite
+00004540: 7261 746f 7229 0a0a 2020 2020 6170 706c  rator)..    appl
+00004550: 6965 6420 3d20 2866 756e 6328 2a7a 6970  ied = (func(*zip
+00004560: 7065 645f 6172 6773 2920 666f 7220 7a69  ped_args) for zi
+00004570: 7070 6564 5f61 7267 7320 696e 207a 6970  pped_args in zip
+00004580: 282a 6974 6572 6174 6f72 7329 290a 2020  (*iterators)).  
+00004590: 2020 6170 706c 6965 645f 6578 616d 706c    applied_exampl
+000045a0: 652c 2061 7070 6c69 6564 203d 2070 6565  e, applied = pee
+000045b0: 6b5f 6174 2861 7070 6c69 6564 290a 2020  k_at(applied).  
+000045c0: 2020 636f 6d62 696e 6520 3d20 6669 7273    combine = firs
+000045d0: 745f 6772 6f75 7062 792e 5f63 6f6d 6269  t_groupby._combi
+000045e0: 6e65 0a20 2020 2069 6620 6973 696e 7374  ne.    if isinst
+000045f0: 616e 6365 2861 7070 6c69 6564 5f65 7861  ance(applied_exa
+00004600: 6d70 6c65 2c20 7475 706c 6529 3a0a 2020  mple, tuple):.  
+00004610: 2020 2020 2020 636f 6d62 696e 6564 203d        combined =
+00004620: 2074 7570 6c65 2863 6f6d 6269 6e65 286f   tuple(combine(o
+00004630: 7574 7075 7429 2066 6f72 206f 7574 7075  utput) for outpu
+00004640: 7420 696e 207a 6970 282a 6170 706c 6965  t in zip(*applie
+00004650: 6429 290a 2020 2020 656c 7365 3a0a 2020  d)).    else:.  
+00004660: 2020 2020 2020 636f 6d62 696e 6564 203d        combined =
+00004670: 2063 6f6d 6269 6e65 2861 7070 6c69 6564   combine(applied
+00004680: 290a 2020 2020 7265 7475 726e 2063 6f6d  ).    return com
+00004690: 6269 6e65 640a 0a0a 6465 6620 756e 6966  bined...def unif
+000046a0: 6965 645f 6469 6d5f 7369 7a65 7328 0a20  ied_dim_sizes(. 
+000046b0: 2020 2076 6172 6961 626c 6573 3a20 4974     variables: It
+000046c0: 6572 6162 6c65 5b56 6172 6961 626c 655d  erable[Variable]
+000046d0: 2c20 6578 636c 7564 655f 6469 6d73 3a20  , exclude_dims: 
+000046e0: 5365 7420 3d20 6672 6f7a 656e 7365 7428  Set = frozenset(
+000046f0: 290a 2920 2d3e 2064 6963 745b 4861 7368  ).) -> dict[Hash
+00004700: 6162 6c65 2c20 696e 745d 3a0a 2020 2020  able, int]:.    
+00004710: 6469 6d5f 7369 7a65 733a 2064 6963 745b  dim_sizes: dict[
+00004720: 4861 7368 6162 6c65 2c20 696e 745d 203d  Hashable, int] =
+00004730: 207b 7d0a 0a20 2020 2066 6f72 2076 6172   {}..    for var
+00004740: 2069 6e20 7661 7269 6162 6c65 733a 0a20   in variables:. 
+00004750: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
+00004760: 7428 7661 722e 6469 6d73 2929 203c 206c  t(var.dims)) < l
+00004770: 656e 2876 6172 2e64 696d 7329 3a0a 2020  en(var.dims):.  
+00004780: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00004790: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+000047a0: 2020 2020 2020 2020 2020 2020 2262 726f              "bro
+000047b0: 6164 6361 7374 696e 6720 6361 6e6e 6f74  adcasting cannot
+000047c0: 2068 616e 646c 6520 6475 706c 6963 6174   handle duplicat
+000047d0: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+000047e0: 2020 2020 6622 6469 6d65 6e73 696f 6e73      f"dimensions
+000047f0: 206f 6e20 6120 7661 7269 6162 6c65 3a20   on a variable: 
+00004800: 7b6c 6973 7428 7661 722e 6469 6d73 297d  {list(var.dims)}
+00004810: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00004820: 2020 2020 2020 2020 666f 7220 6469 6d2c          for dim,
+00004830: 2073 697a 6520 696e 207a 6970 2876 6172   size in zip(var
+00004840: 2e64 696d 732c 2076 6172 2e73 6861 7065  .dims, var.shape
+00004850: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+00004860: 6620 6469 6d20 6e6f 7420 696e 2065 7863  f dim not in exc
+00004870: 6c75 6465 5f64 696d 733a 0a20 2020 2020  lude_dims:.     
+00004880: 2020 2020 2020 2020 2020 2069 6620 6469             if di
+00004890: 6d20 6e6f 7420 696e 2064 696d 5f73 697a  m not in dim_siz
+000048a0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+000048b0: 2020 2020 2020 2020 6469 6d5f 7369 7a65          dim_size
+000048c0: 735b 6469 6d5d 203d 2073 697a 650a 2020  s[dim] = size.  
+000048d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000048e0: 6966 2064 696d 5f73 697a 6573 5b64 696d  if dim_sizes[dim
+000048f0: 5d20 213d 2073 697a 653a 0a20 2020 2020  ] != size:.     
+00004900: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00004910: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00004920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004930: 2020 2020 2020 2020 2022 6f70 6572 616e           "operan
+00004940: 6473 2063 616e 6e6f 7420 6265 2062 726f  ds cannot be bro
+00004950: 6164 6361 7374 2074 6f67 6574 6865 7220  adcast together 
+00004960: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00004970: 2020 2020 2020 2020 2020 2277 6974 6820            "with 
+00004980: 6d69 736d 6174 6368 6564 206c 656e 6774  mismatched lengt
+00004990: 6873 2066 6f72 2064 696d 656e 7369 6f6e  hs for dimension
+000049a0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+000049b0: 2020 2020 2020 2020 2020 2066 227b 6469             f"{di
+000049c0: 6d7d 3a20 7b64 696d 5f73 697a 6573 5b64  m}: {dim_sizes[d
+000049d0: 696d 5d7d 2076 7320 7b73 697a 657d 220a  im]} vs {size}".
 000049e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049f0: 2020 2020 2020 2020 6622 7b64 696d 7d3a          f"{dim}:
-00004a00: 207b 6469 6d5f 7369 7a65 735b 6469 6d5d   {dim_sizes[dim]
-00004a10: 7d20 7673 207b 7369 7a65 7d22 0a20 2020  } vs {size}".   
-00004a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a30: 2029 0a20 2020 2072 6574 7572 6e20 6469   ).    return di
-00004a40: 6d5f 7369 7a65 730a 0a0a 534c 4943 455f  m_sizes...SLICE_
-00004a50: 4e4f 4e45 203d 2073 6c69 6365 284e 6f6e  NONE = slice(Non
-00004a60: 6529 0a0a 0a64 6566 2062 726f 6164 6361  e)...def broadca
-00004a70: 7374 5f63 6f6d 7061 745f 6461 7461 280a  st_compat_data(.
-00004a80: 2020 2020 7661 7269 6162 6c65 3a20 5661      variable: Va
-00004a90: 7269 6162 6c65 2c0a 2020 2020 6272 6f61  riable,.    broa
-00004aa0: 6463 6173 745f 6469 6d73 3a20 7475 706c  dcast_dims: tupl
-00004ab0: 655b 4861 7368 6162 6c65 2c20 2e2e 2e5d  e[Hashable, ...]
-00004ac0: 2c0a 2020 2020 636f 7265 5f64 696d 733a  ,.    core_dims:
-00004ad0: 2074 7570 6c65 5b48 6173 6861 626c 652c   tuple[Hashable,
-00004ae0: 202e 2e2e 5d2c 0a29 202d 3e20 416e 793a   ...],.) -> Any:
-00004af0: 0a20 2020 2064 6174 6120 3d20 7661 7269  .    data = vari
-00004b00: 6162 6c65 2e64 6174 610a 0a20 2020 206f  able.data..    o
-00004b10: 6c64 5f64 696d 7320 3d20 7661 7269 6162  ld_dims = variab
-00004b20: 6c65 2e64 696d 730a 2020 2020 6e65 775f  le.dims.    new_
-00004b30: 6469 6d73 203d 2062 726f 6164 6361 7374  dims = broadcast
-00004b40: 5f64 696d 7320 2b20 636f 7265 5f64 696d  _dims + core_dim
-00004b50: 730a 0a20 2020 2069 6620 6e65 775f 6469  s..    if new_di
-00004b60: 6d73 203d 3d20 6f6c 645f 6469 6d73 3a0a  ms == old_dims:.
-00004b70: 2020 2020 2020 2020 2320 6f70 7469 6d69          # optimi
-00004b80: 7a65 2066 6f72 2074 6865 2074 7970 6963  ze for the typic
-00004b90: 616c 2063 6173 650a 2020 2020 2020 2020  al case.        
-00004ba0: 7265 7475 726e 2064 6174 610a 0a20 2020  return data..   
-00004bb0: 2073 6574 5f6f 6c64 5f64 696d 7320 3d20   set_old_dims = 
-00004bc0: 7365 7428 6f6c 645f 6469 6d73 290a 2020  set(old_dims).  
-00004bd0: 2020 6d69 7373 696e 675f 636f 7265 5f64    missing_core_d
-00004be0: 696d 7320 3d20 5b64 2066 6f72 2064 2069  ims = [d for d i
-00004bf0: 6e20 636f 7265 5f64 696d 7320 6966 2064  n core_dims if d
-00004c00: 206e 6f74 2069 6e20 7365 745f 6f6c 645f   not in set_old_
-00004c10: 6469 6d73 5d0a 2020 2020 6966 206d 6973  dims].    if mis
-00004c20: 7369 6e67 5f63 6f72 655f 6469 6d73 3a0a  sing_core_dims:.
-00004c30: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00004c40: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00004c50: 2020 2020 2020 226f 7065 7261 6e64 2074        "operand t
-00004c60: 6f20 6170 706c 795f 7566 756e 6320 6861  o apply_ufunc ha
-00004c70: 7320 7265 7175 6972 6564 2063 6f72 6520  s required core 
-00004c80: 6469 6d65 6e73 696f 6e73 207b 7d2c 2062  dimensions {}, b
-00004c90: 7574 2022 0a20 2020 2020 2020 2020 2020  ut ".           
-00004ca0: 2022 736f 6d65 206f 6620 7468 6573 6520   "some of these 
-00004cb0: 6469 6d65 6e73 696f 6e73 2061 7265 2061  dimensions are a
-00004cc0: 6273 656e 7420 6f6e 2061 6e20 696e 7075  bsent on an inpu
-00004cd0: 7420 7661 7269 6162 6c65 3a20 7b7d 222e  t variable: {}".
-00004ce0: 666f 726d 6174 280a 2020 2020 2020 2020  format(.        
-00004cf0: 2020 2020 2020 2020 6c69 7374 2863 6f72          list(cor
-00004d00: 655f 6469 6d73 292c 206d 6973 7369 6e67  e_dims), missing
-00004d10: 5f63 6f72 655f 6469 6d73 0a20 2020 2020  _core_dims.     
-00004d20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00004d30: 2029 0a0a 2020 2020 7365 745f 6e65 775f   )..    set_new_
-00004d40: 6469 6d73 203d 2073 6574 286e 6577 5f64  dims = set(new_d
-00004d50: 696d 7329 0a20 2020 2075 6e65 7870 6563  ims).    unexpec
-00004d60: 7465 645f 6469 6d73 203d 205b 6420 666f  ted_dims = [d fo
-00004d70: 7220 6420 696e 206f 6c64 5f64 696d 7320  r d in old_dims 
-00004d80: 6966 2064 206e 6f74 2069 6e20 7365 745f  if d not in set_
-00004d90: 6e65 775f 6469 6d73 5d0a 2020 2020 6966  new_dims].    if
-00004da0: 2075 6e65 7870 6563 7465 645f 6469 6d73   unexpected_dims
-00004db0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00004dc0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00004dd0: 2020 2020 2020 2020 226f 7065 7261 6e64          "operand
-00004de0: 2074 6f20 6170 706c 795f 7566 756e 6320   to apply_ufunc 
-00004df0: 656e 636f 756e 7465 7265 6420 756e 6578  encountered unex
-00004e00: 7065 6374 6564 2022 0a20 2020 2020 2020  pected ".       
-00004e10: 2020 2020 2066 2264 696d 656e 7369 6f6e       f"dimension
-00004e20: 7320 7b75 6e65 7870 6563 7465 645f 6469  s {unexpected_di
-00004e30: 6d73 2172 7d20 6f6e 2061 6e20 696e 7075  ms!r} on an inpu
-00004e40: 7420 7661 7269 6162 6c65 3a20 7468 6573  t variable: thes
-00004e50: 6520 6172 6520 636f 7265 2022 0a20 2020  e are core ".   
-00004e60: 2020 2020 2020 2020 2022 6469 6d65 6e73           "dimens
-00004e70: 696f 6e73 206f 6e20 6f74 6865 7220 696e  ions on other in
-00004e80: 7075 7420 6f72 206f 7574 7075 7420 7661  put or output va
-00004e90: 7269 6162 6c65 7322 0a20 2020 2020 2020  riables".       
-00004ea0: 2029 0a0a 2020 2020 2320 666f 7220 636f   )..    # for co
-00004eb0: 6e73 6973 7465 6e63 7920 7769 7468 206e  nsistency with n
-00004ec0: 756d 7079 2c20 6b65 6570 2062 726f 6164  umpy, keep broad
-00004ed0: 6361 7374 2064 696d 656e 7369 6f6e 7320  cast dimensions 
-00004ee0: 746f 2074 6865 206c 6566 740a 2020 2020  to the left.    
-00004ef0: 6f6c 645f 6272 6f61 6463 6173 745f 6469  old_broadcast_di
-00004f00: 6d73 203d 2074 7570 6c65 2864 2066 6f72  ms = tuple(d for
-00004f10: 2064 2069 6e20 6272 6f61 6463 6173 745f   d in broadcast_
-00004f20: 6469 6d73 2069 6620 6420 696e 2073 6574  dims if d in set
-00004f30: 5f6f 6c64 5f64 696d 7329 0a20 2020 2072  _old_dims).    r
-00004f40: 656f 7264 6572 6564 5f64 696d 7320 3d20  eordered_dims = 
-00004f50: 6f6c 645f 6272 6f61 6463 6173 745f 6469  old_broadcast_di
-00004f60: 6d73 202b 2063 6f72 655f 6469 6d73 0a20  ms + core_dims. 
-00004f70: 2020 2069 6620 7265 6f72 6465 7265 645f     if reordered_
-00004f80: 6469 6d73 2021 3d20 6f6c 645f 6469 6d73  dims != old_dims
-00004f90: 3a0a 2020 2020 2020 2020 6f72 6465 7220  :.        order 
-00004fa0: 3d20 7475 706c 6528 6f6c 645f 6469 6d73  = tuple(old_dims
-00004fb0: 2e69 6e64 6578 2864 2920 666f 7220 6420  .index(d) for d 
-00004fc0: 696e 2072 656f 7264 6572 6564 5f64 696d  in reordered_dim
-00004fd0: 7329 0a20 2020 2020 2020 2064 6174 6120  s).        data 
-00004fe0: 3d20 6475 636b 5f61 7272 6179 5f6f 7073  = duck_array_ops
-00004ff0: 2e74 7261 6e73 706f 7365 2864 6174 612c  .transpose(data,
-00005000: 206f 7264 6572 290a 0a20 2020 2069 6620   order)..    if 
-00005010: 6e65 775f 6469 6d73 2021 3d20 7265 6f72  new_dims != reor
-00005020: 6465 7265 645f 6469 6d73 3a0a 2020 2020  dered_dims:.    
-00005030: 2020 2020 6b65 795f 7061 7274 733a 206c      key_parts: l
-00005040: 6973 745b 736c 6963 6520 7c20 4e6f 6e65  ist[slice | None
-00005050: 5d20 3d20 5b5d 0a20 2020 2020 2020 2066  ] = [].        f
-00005060: 6f72 2064 696d 2069 6e20 6e65 775f 6469  or dim in new_di
-00005070: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-00005080: 6966 2064 696d 2069 6e20 7365 745f 6f6c  if dim in set_ol
-00005090: 645f 6469 6d73 3a0a 2020 2020 2020 2020  d_dims:.        
-000050a0: 2020 2020 2020 2020 6b65 795f 7061 7274          key_part
-000050b0: 732e 6170 7065 6e64 2853 4c49 4345 5f4e  s.append(SLICE_N
-000050c0: 4f4e 4529 0a20 2020 2020 2020 2020 2020  ONE).           
-000050d0: 2065 6c69 6620 6b65 795f 7061 7274 733a   elif key_parts:
-000050e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000050f0: 2023 206e 6f20 6e65 6564 2074 6f20 696e   # no need to in
-00005100: 7365 7274 206e 6577 2061 7865 7320 6174  sert new axes at
-00005110: 2074 6865 2062 6567 696e 6e69 6e67 2074   the beginning t
-00005120: 6861 7420 6172 6520 616c 7265 6164 790a  hat are already.
-00005130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005140: 2320 6861 6e64 6c65 6420 6279 2062 726f  # handled by bro
-00005150: 6164 6361 7374 696e 670a 2020 2020 2020  adcasting.      
-00005160: 2020 2020 2020 2020 2020 6b65 795f 7061            key_pa
-00005170: 7274 732e 6170 7065 6e64 286e 702e 6e65  rts.append(np.ne
-00005180: 7761 7869 7329 0a20 2020 2020 2020 2064  waxis).        d
-00005190: 6174 6120 3d20 6461 7461 5b74 7570 6c65  ata = data[tuple
-000051a0: 286b 6579 5f70 6172 7473 295d 0a0a 2020  (key_parts)]..  
-000051b0: 2020 7265 7475 726e 2064 6174 610a 0a0a    return data...
-000051c0: 6465 6620 5f76 6563 746f 7269 7a65 2866  def _vectorize(f
-000051d0: 756e 632c 2073 6967 6e61 7475 7265 2c20  unc, signature, 
-000051e0: 6f75 7470 7574 5f64 7479 7065 732c 2065  output_dtypes, e
-000051f0: 7863 6c75 6465 5f64 696d 7329 3a0a 2020  xclude_dims):.  
-00005200: 2020 6966 2073 6967 6e61 7475 7265 2e61    if signature.a
-00005210: 6c6c 5f63 6f72 655f 6469 6d73 3a0a 2020  ll_core_dims:.  
-00005220: 2020 2020 2020 6675 6e63 203d 206e 702e        func = np.
-00005230: 7665 6374 6f72 697a 6528 0a20 2020 2020  vectorize(.     
-00005240: 2020 2020 2020 2066 756e 632c 0a20 2020         func,.   
-00005250: 2020 2020 2020 2020 206f 7479 7065 733d           otypes=
-00005260: 6f75 7470 7574 5f64 7479 7065 732c 0a20  output_dtypes,. 
-00005270: 2020 2020 2020 2020 2020 2073 6967 6e61             signa
-00005280: 7475 7265 3d73 6967 6e61 7475 7265 2e74  ture=signature.t
-00005290: 6f5f 6775 6675 6e63 5f73 7472 696e 6728  o_gufunc_string(
-000052a0: 6578 636c 7564 655f 6469 6d73 292c 0a20  exclude_dims),. 
-000052b0: 2020 2020 2020 2029 0a20 2020 2065 6c73         ).    els
-000052c0: 653a 0a20 2020 2020 2020 2066 756e 6320  e:.        func 
-000052d0: 3d20 6e70 2e76 6563 746f 7269 7a65 2866  = np.vectorize(f
-000052e0: 756e 632c 206f 7479 7065 733d 6f75 7470  unc, otypes=outp
-000052f0: 7574 5f64 7479 7065 7329 0a0a 2020 2020  ut_dtypes)..    
-00005300: 7265 7475 726e 2066 756e 630a 0a0a 6465  return func...de
-00005310: 6620 6170 706c 795f 7661 7269 6162 6c65  f apply_variable
-00005320: 5f75 6675 6e63 280a 2020 2020 6675 6e63  _ufunc(.    func
-00005330: 2c0a 2020 2020 2a61 7267 732c 0a20 2020  ,.    *args,.   
-00005340: 2073 6967 6e61 7475 7265 3a20 5f55 4675   signature: _UFu
-00005350: 6e63 5369 676e 6174 7572 652c 0a20 2020  ncSignature,.   
-00005360: 2065 7863 6c75 6465 5f64 696d 733d 6672   exclude_dims=fr
-00005370: 6f7a 656e 7365 7428 292c 0a20 2020 2064  ozenset(),.    d
-00005380: 6173 6b3d 2266 6f72 6269 6464 656e 222c  ask="forbidden",
-00005390: 0a20 2020 206f 7574 7075 745f 6474 7970  .    output_dtyp
-000053a0: 6573 3d4e 6f6e 652c 0a20 2020 2076 6563  es=None,.    vec
-000053b0: 746f 7269 7a65 3d46 616c 7365 2c0a 2020  torize=False,.  
-000053c0: 2020 6b65 6570 5f61 7474 7273 3d22 6f76    keep_attrs="ov
-000053d0: 6572 7269 6465 222c 0a20 2020 2064 6173  erride",.    das
-000053e0: 6b5f 6775 6675 6e63 5f6b 7761 7267 733d  k_gufunc_kwargs=
-000053f0: 4e6f 6e65 2c0a 2920 2d3e 2056 6172 6961  None,.) -> Varia
-00005400: 626c 6520 7c20 7475 706c 655b 5661 7269  ble | tuple[Vari
-00005410: 6162 6c65 2c20 2e2e 2e5d 3a0a 2020 2020  able, ...]:.    
-00005420: 2222 2241 7070 6c79 2061 206e 6461 7272  """Apply a ndarr
-00005430: 6179 206c 6576 656c 2066 756e 6374 696f  ay level functio
-00005440: 6e20 6f76 6572 2056 6172 6961 626c 6520  n over Variable 
-00005450: 616e 642f 6f72 206e 6461 7272 6179 206f  and/or ndarray o
-00005460: 626a 6563 7473 2e22 2222 0a20 2020 2066  bjects.""".    f
-00005470: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
-00005480: 7661 7269 6162 6c65 2069 6d70 6f72 7420  variable import 
-00005490: 5661 7269 6162 6c65 2c20 6173 5f63 6f6d  Variable, as_com
-000054a0: 7061 7469 626c 655f 6461 7461 0a0a 2020  patible_data..  
-000054b0: 2020 6469 6d5f 7369 7a65 7320 3d20 756e    dim_sizes = un
-000054c0: 6966 6965 645f 6469 6d5f 7369 7a65 7328  ified_dim_sizes(
-000054d0: 0a20 2020 2020 2020 2028 6120 666f 7220  .        (a for 
-000054e0: 6120 696e 2061 7267 7320 6966 2068 6173  a in args if has
-000054f0: 6174 7472 2861 2c20 2264 696d 7322 2929  attr(a, "dims"))
-00005500: 2c20 6578 636c 7564 655f 6469 6d73 3d65  , exclude_dims=e
-00005510: 7863 6c75 6465 5f64 696d 730a 2020 2020  xclude_dims.    
-00005520: 290a 2020 2020 6272 6f61 6463 6173 745f  ).    broadcast_
-00005530: 6469 6d73 203d 2074 7570 6c65 280a 2020  dims = tuple(.  
-00005540: 2020 2020 2020 6469 6d20 666f 7220 6469        dim for di
-00005550: 6d20 696e 2064 696d 5f73 697a 6573 2069  m in dim_sizes i
-00005560: 6620 6469 6d20 6e6f 7420 696e 2073 6967  f dim not in sig
-00005570: 6e61 7475 7265 2e61 6c6c 5f63 6f72 655f  nature.all_core_
-00005580: 6469 6d73 0a20 2020 2029 0a20 2020 206f  dims.    ).    o
-00005590: 7574 7075 745f 6469 6d73 203d 205b 6272  utput_dims = [br
-000055a0: 6f61 6463 6173 745f 6469 6d73 202b 206f  oadcast_dims + o
-000055b0: 7574 2066 6f72 206f 7574 2069 6e20 7369  ut for out in si
-000055c0: 676e 6174 7572 652e 6f75 7470 7574 5f63  gnature.output_c
-000055d0: 6f72 655f 6469 6d73 5d0a 0a20 2020 2069  ore_dims]..    i
-000055e0: 6e70 7574 5f64 6174 6120 3d20 5b0a 2020  nput_data = [.  
-000055f0: 2020 2020 2020 6272 6f61 6463 6173 745f        broadcast_
-00005600: 636f 6d70 6174 5f64 6174 6128 6172 672c  compat_data(arg,
-00005610: 2062 726f 6164 6361 7374 5f64 696d 732c   broadcast_dims,
-00005620: 2063 6f72 655f 6469 6d73 290a 2020 2020   core_dims).    
-00005630: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00005640: 6528 6172 672c 2056 6172 6961 626c 6529  e(arg, Variable)
-00005650: 0a20 2020 2020 2020 2065 6c73 6520 6172  .        else ar
-00005660: 670a 2020 2020 2020 2020 666f 7220 6172  g.        for ar
-00005670: 672c 2063 6f72 655f 6469 6d73 2069 6e20  g, core_dims in 
-00005680: 7a69 7028 6172 6773 2c20 7369 676e 6174  zip(args, signat
-00005690: 7572 652e 696e 7075 745f 636f 7265 5f64  ure.input_core_d
-000056a0: 696d 7329 0a20 2020 205d 0a0a 2020 2020  ims).    ]..    
-000056b0: 6966 2061 6e79 2869 735f 6475 636b 5f64  if any(is_duck_d
-000056c0: 6173 6b5f 6172 7261 7928 6172 7261 7929  ask_array(array)
-000056d0: 2066 6f72 2061 7272 6179 2069 6e20 696e   for array in in
-000056e0: 7075 745f 6461 7461 293a 0a20 2020 2020  put_data):.     
-000056f0: 2020 2069 6620 6461 736b 203d 3d20 2266     if dask == "f
-00005700: 6f72 6269 6464 656e 223a 0a20 2020 2020  orbidden":.     
-00005710: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00005720: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-00005730: 2020 2020 2020 2020 2022 6170 706c 795f           "apply_
-00005740: 7566 756e 6320 656e 636f 756e 7465 7265  ufunc encountere
-00005750: 6420 6120 6461 736b 2061 7272 6179 206f  d a dask array o
-00005760: 6e20 616e 2022 0a20 2020 2020 2020 2020  n an ".         
-00005770: 2020 2020 2020 2022 6172 6775 6d65 6e74         "argument
-00005780: 2c20 6275 7420 6861 6e64 6c69 6e67 2066  , but handling f
-00005790: 6f72 2064 6173 6b20 6172 7261 7973 2068  or dask arrays h
-000057a0: 6173 206e 6f74 2022 0a20 2020 2020 2020  as not ".       
-000057b0: 2020 2020 2020 2020 2022 6265 656e 2065           "been e
-000057c0: 6e61 626c 6564 2e20 4569 7468 6572 2073  nabled. Either s
-000057d0: 6574 2074 6865 2060 6064 6173 6b60 6020  et the ``dask`` 
-000057e0: 6172 6775 6d65 6e74 2022 0a20 2020 2020  argument ".     
-000057f0: 2020 2020 2020 2020 2020 2022 6f72 206c             "or l
-00005800: 6f61 6420 796f 7572 2064 6174 6120 696e  oad your data in
-00005810: 746f 206d 656d 6f72 7920 6669 7273 7420  to memory first 
-00005820: 7769 7468 2022 0a20 2020 2020 2020 2020  with ".         
-00005830: 2020 2020 2020 2022 6060 2e6c 6f61 6428         "``.load(
-00005840: 2960 6020 6f72 2060 602e 636f 6d70 7574  )`` or ``.comput
-00005850: 6528 2960 6022 0a20 2020 2020 2020 2020  e()``".         
-00005860: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
-00005870: 6620 6461 736b 203d 3d20 2270 6172 616c  f dask == "paral
-00005880: 6c65 6c69 7a65 6422 3a0a 2020 2020 2020  lelized":.      
-00005890: 2020 2020 2020 6e75 6d70 795f 6675 6e63        numpy_func
-000058a0: 203d 2066 756e 630a 0a20 2020 2020 2020   = func..       
-000058b0: 2020 2020 2069 6620 6461 736b 5f67 7566       if dask_guf
-000058c0: 756e 635f 6b77 6172 6773 2069 7320 4e6f  unc_kwargs is No
-000058d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000058e0: 2020 2020 6461 736b 5f67 7566 756e 635f      dask_gufunc_
-000058f0: 6b77 6172 6773 203d 207b 7d0a 2020 2020  kwargs = {}.    
-00005900: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00005910: 2020 2020 2020 2020 2020 2020 2020 6461                da
-00005920: 736b 5f67 7566 756e 635f 6b77 6172 6773  sk_gufunc_kwargs
-00005930: 203d 2064 6173 6b5f 6775 6675 6e63 5f6b   = dask_gufunc_k
-00005940: 7761 7267 732e 636f 7079 2829 0a0a 2020  wargs.copy()..  
-00005950: 2020 2020 2020 2020 2020 616c 6c6f 775f            allow_
-00005960: 7265 6368 756e 6b20 3d20 6461 736b 5f67  rechunk = dask_g
-00005970: 7566 756e 635f 6b77 6172 6773 2e67 6574  ufunc_kwargs.get
-00005980: 2822 616c 6c6f 775f 7265 6368 756e 6b22  ("allow_rechunk"
-00005990: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-000059a0: 2020 2020 6966 2061 6c6c 6f77 5f72 6563      if allow_rec
-000059b0: 6875 6e6b 2069 7320 4e6f 6e65 3a0a 2020  hunk is None:.  
-000059c0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000059d0: 7220 6e2c 2028 6461 7461 2c20 636f 7265  r n, (data, core
-000059e0: 5f64 696d 7329 2069 6e20 656e 756d 6572  _dims) in enumer
-000059f0: 6174 6528 0a20 2020 2020 2020 2020 2020  ate(.           
-00005a00: 2020 2020 2020 2020 207a 6970 2869 6e70           zip(inp
-00005a10: 7574 5f64 6174 612c 2073 6967 6e61 7475  ut_data, signatu
-00005a20: 7265 2e69 6e70 7574 5f63 6f72 655f 6469  re.input_core_di
-00005a30: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
-00005a40: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00005a50: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00005a60: 5f64 7563 6b5f 6461 736b 5f61 7272 6179  _duck_dask_array
-00005a70: 2864 6174 6129 3a0a 2020 2020 2020 2020  (data):.        
-00005a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a90: 2320 636f 7265 2064 696d 656e 7369 6f6e  # core dimension
-00005aa0: 7320 6361 6e6e 6f74 2073 7061 6e20 6d75  s cannot span mu
-00005ab0: 6c74 6970 6c65 2063 6875 6e6b 730a 2020  ltiple chunks.  
-00005ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ad0: 2020 2020 2020 666f 7220 6178 6973 2c20        for axis, 
-00005ae0: 6469 6d20 696e 2065 6e75 6d65 7261 7465  dim in enumerate
-00005af0: 2863 6f72 655f 6469 6d73 2c20 7374 6172  (core_dims, star
-00005b00: 743d 2d6c 656e 2863 6f72 655f 6469 6d73  t=-len(core_dims
-00005b10: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+000049f0: 2020 2020 290a 2020 2020 7265 7475 726e      ).    return
+00004a00: 2064 696d 5f73 697a 6573 0a0a 0a53 4c49   dim_sizes...SLI
+00004a10: 4345 5f4e 4f4e 4520 3d20 736c 6963 6528  CE_NONE = slice(
+00004a20: 4e6f 6e65 290a 0a0a 6465 6620 6272 6f61  None)...def broa
+00004a30: 6463 6173 745f 636f 6d70 6174 5f64 6174  dcast_compat_dat
+00004a40: 6128 0a20 2020 2076 6172 6961 626c 653a  a(.    variable:
+00004a50: 2056 6172 6961 626c 652c 0a20 2020 2062   Variable,.    b
+00004a60: 726f 6164 6361 7374 5f64 696d 733a 2074  roadcast_dims: t
+00004a70: 7570 6c65 5b48 6173 6861 626c 652c 202e  uple[Hashable, .
+00004a80: 2e2e 5d2c 0a20 2020 2063 6f72 655f 6469  ..],.    core_di
+00004a90: 6d73 3a20 7475 706c 655b 4861 7368 6162  ms: tuple[Hashab
+00004aa0: 6c65 2c20 2e2e 2e5d 2c0a 2920 2d3e 2041  le, ...],.) -> A
+00004ab0: 6e79 3a0a 2020 2020 6461 7461 203d 2076  ny:.    data = v
+00004ac0: 6172 6961 626c 652e 6461 7461 0a0a 2020  ariable.data..  
+00004ad0: 2020 6f6c 645f 6469 6d73 203d 2076 6172    old_dims = var
+00004ae0: 6961 626c 652e 6469 6d73 0a20 2020 206e  iable.dims.    n
+00004af0: 6577 5f64 696d 7320 3d20 6272 6f61 6463  ew_dims = broadc
+00004b00: 6173 745f 6469 6d73 202b 2063 6f72 655f  ast_dims + core_
+00004b10: 6469 6d73 0a0a 2020 2020 6966 206e 6577  dims..    if new
+00004b20: 5f64 696d 7320 3d3d 206f 6c64 5f64 696d  _dims == old_dim
+00004b30: 733a 0a20 2020 2020 2020 2023 206f 7074  s:.        # opt
+00004b40: 696d 697a 6520 666f 7220 7468 6520 7479  imize for the ty
+00004b50: 7069 6361 6c20 6361 7365 0a20 2020 2020  pical case.     
+00004b60: 2020 2072 6574 7572 6e20 6461 7461 0a0a     return data..
+00004b70: 2020 2020 7365 745f 6f6c 645f 6469 6d73      set_old_dims
+00004b80: 203d 2073 6574 286f 6c64 5f64 696d 7329   = set(old_dims)
+00004b90: 0a20 2020 206d 6973 7369 6e67 5f63 6f72  .    missing_cor
+00004ba0: 655f 6469 6d73 203d 205b 6420 666f 7220  e_dims = [d for 
+00004bb0: 6420 696e 2063 6f72 655f 6469 6d73 2069  d in core_dims i
+00004bc0: 6620 6420 6e6f 7420 696e 2073 6574 5f6f  f d not in set_o
+00004bd0: 6c64 5f64 696d 735d 0a20 2020 2069 6620  ld_dims].    if 
+00004be0: 6d69 7373 696e 675f 636f 7265 5f64 696d  missing_core_dim
+00004bf0: 733a 0a20 2020 2020 2020 2072 6169 7365  s:.        raise
+00004c00: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00004c10: 2020 2020 2020 2020 2022 6f70 6572 616e           "operan
+00004c20: 6420 746f 2061 7070 6c79 5f75 6675 6e63  d to apply_ufunc
+00004c30: 2068 6173 2072 6571 7569 7265 6420 636f   has required co
+00004c40: 7265 2064 696d 656e 7369 6f6e 7320 7b7d  re dimensions {}
+00004c50: 2c20 6275 7420 220a 2020 2020 2020 2020  , but ".        
+00004c60: 2020 2020 2273 6f6d 6520 6f66 2074 6865      "some of the
+00004c70: 7365 2064 696d 656e 7369 6f6e 7320 6172  se dimensions ar
+00004c80: 6520 6162 7365 6e74 206f 6e20 616e 2069  e absent on an i
+00004c90: 6e70 7574 2076 6172 6961 626c 653a 207b  nput variable: {
+00004ca0: 7d22 2e66 6f72 6d61 7428 0a20 2020 2020  }".format(.     
+00004cb0: 2020 2020 2020 2020 2020 206c 6973 7428             list(
+00004cc0: 636f 7265 5f64 696d 7329 2c20 6d69 7373  core_dims), miss
+00004cd0: 696e 675f 636f 7265 5f64 696d 730a 2020  ing_core_dims.  
+00004ce0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00004cf0: 2020 2020 290a 0a20 2020 2073 6574 5f6e      )..    set_n
+00004d00: 6577 5f64 696d 7320 3d20 7365 7428 6e65  ew_dims = set(ne
+00004d10: 775f 6469 6d73 290a 2020 2020 756e 6578  w_dims).    unex
+00004d20: 7065 6374 6564 5f64 696d 7320 3d20 5b64  pected_dims = [d
+00004d30: 2066 6f72 2064 2069 6e20 6f6c 645f 6469   for d in old_di
+00004d40: 6d73 2069 6620 6420 6e6f 7420 696e 2073  ms if d not in s
+00004d50: 6574 5f6e 6577 5f64 696d 735d 0a20 2020  et_new_dims].   
+00004d60: 2069 6620 756e 6578 7065 6374 6564 5f64   if unexpected_d
+00004d70: 696d 733a 0a20 2020 2020 2020 2072 6169  ims:.        rai
+00004d80: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00004d90: 2020 2020 2020 2020 2020 2022 6f70 6572             "oper
+00004da0: 616e 6420 746f 2061 7070 6c79 5f75 6675  and to apply_ufu
+00004db0: 6e63 2065 6e63 6f75 6e74 6572 6564 2075  nc encountered u
+00004dc0: 6e65 7870 6563 7465 6420 220a 2020 2020  nexpected ".    
+00004dd0: 2020 2020 2020 2020 6622 6469 6d65 6e73          f"dimens
+00004de0: 696f 6e73 207b 756e 6578 7065 6374 6564  ions {unexpected
+00004df0: 5f64 696d 7321 727d 206f 6e20 616e 2069  _dims!r} on an i
+00004e00: 6e70 7574 2076 6172 6961 626c 653a 2074  nput variable: t
+00004e10: 6865 7365 2061 7265 2063 6f72 6520 220a  hese are core ".
+00004e20: 2020 2020 2020 2020 2020 2020 2264 696d              "dim
+00004e30: 656e 7369 6f6e 7320 6f6e 206f 7468 6572  ensions on other
+00004e40: 2069 6e70 7574 206f 7220 6f75 7470 7574   input or output
+00004e50: 2076 6172 6961 626c 6573 220a 2020 2020   variables".    
+00004e60: 2020 2020 290a 0a20 2020 2023 2066 6f72      )..    # for
+00004e70: 2063 6f6e 7369 7374 656e 6379 2077 6974   consistency wit
+00004e80: 6820 6e75 6d70 792c 206b 6565 7020 6272  h numpy, keep br
+00004e90: 6f61 6463 6173 7420 6469 6d65 6e73 696f  oadcast dimensio
+00004ea0: 6e73 2074 6f20 7468 6520 6c65 6674 0a20  ns to the left. 
+00004eb0: 2020 206f 6c64 5f62 726f 6164 6361 7374     old_broadcast
+00004ec0: 5f64 696d 7320 3d20 7475 706c 6528 6420  _dims = tuple(d 
+00004ed0: 666f 7220 6420 696e 2062 726f 6164 6361  for d in broadca
+00004ee0: 7374 5f64 696d 7320 6966 2064 2069 6e20  st_dims if d in 
+00004ef0: 7365 745f 6f6c 645f 6469 6d73 290a 2020  set_old_dims).  
+00004f00: 2020 7265 6f72 6465 7265 645f 6469 6d73    reordered_dims
+00004f10: 203d 206f 6c64 5f62 726f 6164 6361 7374   = old_broadcast
+00004f20: 5f64 696d 7320 2b20 636f 7265 5f64 696d  _dims + core_dim
+00004f30: 730a 2020 2020 6966 2072 656f 7264 6572  s.    if reorder
+00004f40: 6564 5f64 696d 7320 213d 206f 6c64 5f64  ed_dims != old_d
+00004f50: 696d 733a 0a20 2020 2020 2020 206f 7264  ims:.        ord
+00004f60: 6572 203d 2074 7570 6c65 286f 6c64 5f64  er = tuple(old_d
+00004f70: 696d 732e 696e 6465 7828 6429 2066 6f72  ims.index(d) for
+00004f80: 2064 2069 6e20 7265 6f72 6465 7265 645f   d in reordered_
+00004f90: 6469 6d73 290a 2020 2020 2020 2020 6461  dims).        da
+00004fa0: 7461 203d 2064 7563 6b5f 6172 7261 795f  ta = duck_array_
+00004fb0: 6f70 732e 7472 616e 7370 6f73 6528 6461  ops.transpose(da
+00004fc0: 7461 2c20 6f72 6465 7229 0a0a 2020 2020  ta, order)..    
+00004fd0: 6966 206e 6577 5f64 696d 7320 213d 2072  if new_dims != r
+00004fe0: 656f 7264 6572 6564 5f64 696d 733a 0a20  eordered_dims:. 
+00004ff0: 2020 2020 2020 206b 6579 5f70 6172 7473         key_parts
+00005000: 3a20 6c69 7374 5b73 6c69 6365 207c 204e  : list[slice | N
+00005010: 6f6e 655d 203d 205b 5d0a 2020 2020 2020  one] = [].      
+00005020: 2020 666f 7220 6469 6d20 696e 206e 6577    for dim in new
+00005030: 5f64 696d 733a 0a20 2020 2020 2020 2020  _dims:.         
+00005040: 2020 2069 6620 6469 6d20 696e 2073 6574     if dim in set
+00005050: 5f6f 6c64 5f64 696d 733a 0a20 2020 2020  _old_dims:.     
+00005060: 2020 2020 2020 2020 2020 206b 6579 5f70             key_p
+00005070: 6172 7473 2e61 7070 656e 6428 534c 4943  arts.append(SLIC
+00005080: 455f 4e4f 4e45 290a 2020 2020 2020 2020  E_NONE).        
+00005090: 2020 2020 656c 6966 206b 6579 5f70 6172      elif key_par
+000050a0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+000050b0: 2020 2020 2320 6e6f 206e 6565 6420 746f      # no need to
+000050c0: 2069 6e73 6572 7420 6e65 7720 6178 6573   insert new axes
+000050d0: 2061 7420 7468 6520 6265 6769 6e6e 696e   at the beginnin
+000050e0: 6720 7468 6174 2061 7265 2061 6c72 6561  g that are alrea
+000050f0: 6479 0a20 2020 2020 2020 2020 2020 2020  dy.             
+00005100: 2020 2023 2068 616e 646c 6564 2062 7920     # handled by 
+00005110: 6272 6f61 6463 6173 7469 6e67 0a20 2020  broadcasting.   
+00005120: 2020 2020 2020 2020 2020 2020 206b 6579               key
+00005130: 5f70 6172 7473 2e61 7070 656e 6428 6e70  _parts.append(np
+00005140: 2e6e 6577 6178 6973 290a 2020 2020 2020  .newaxis).      
+00005150: 2020 6461 7461 203d 2064 6174 615b 7475    data = data[tu
+00005160: 706c 6528 6b65 795f 7061 7274 7329 5d0a  ple(key_parts)].
+00005170: 0a20 2020 2072 6574 7572 6e20 6461 7461  .    return data
+00005180: 0a0a 0a64 6566 205f 7665 6374 6f72 697a  ...def _vectoriz
+00005190: 6528 6675 6e63 2c20 7369 676e 6174 7572  e(func, signatur
+000051a0: 652c 206f 7574 7075 745f 6474 7970 6573  e, output_dtypes
+000051b0: 2c20 6578 636c 7564 655f 6469 6d73 293a  , exclude_dims):
+000051c0: 0a20 2020 2069 6620 7369 676e 6174 7572  .    if signatur
+000051d0: 652e 616c 6c5f 636f 7265 5f64 696d 733a  e.all_core_dims:
+000051e0: 0a20 2020 2020 2020 2066 756e 6320 3d20  .        func = 
+000051f0: 6e70 2e76 6563 746f 7269 7a65 280a 2020  np.vectorize(.  
+00005200: 2020 2020 2020 2020 2020 6675 6e63 2c0a            func,.
+00005210: 2020 2020 2020 2020 2020 2020 6f74 7970              otyp
+00005220: 6573 3d6f 7574 7075 745f 6474 7970 6573  es=output_dtypes
+00005230: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
+00005240: 676e 6174 7572 653d 7369 676e 6174 7572  gnature=signatur
+00005250: 652e 746f 5f67 7566 756e 635f 7374 7269  e.to_gufunc_stri
+00005260: 6e67 2865 7863 6c75 6465 5f64 696d 7329  ng(exclude_dims)
+00005270: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00005280: 656c 7365 3a0a 2020 2020 2020 2020 6675  else:.        fu
+00005290: 6e63 203d 206e 702e 7665 6374 6f72 697a  nc = np.vectoriz
+000052a0: 6528 6675 6e63 2c20 6f74 7970 6573 3d6f  e(func, otypes=o
+000052b0: 7574 7075 745f 6474 7970 6573 290a 0a20  utput_dtypes).. 
+000052c0: 2020 2072 6574 7572 6e20 6675 6e63 0a0a     return func..
+000052d0: 0a64 6566 2061 7070 6c79 5f76 6172 6961  .def apply_varia
+000052e0: 626c 655f 7566 756e 6328 0a20 2020 2066  ble_ufunc(.    f
+000052f0: 756e 632c 0a20 2020 202a 6172 6773 2c0a  unc,.    *args,.
+00005300: 2020 2020 7369 676e 6174 7572 653a 205f      signature: _
+00005310: 5546 756e 6353 6967 6e61 7475 7265 2c0a  UFuncSignature,.
+00005320: 2020 2020 6578 636c 7564 655f 6469 6d73      exclude_dims
+00005330: 3d66 726f 7a65 6e73 6574 2829 2c0a 2020  =frozenset(),.  
+00005340: 2020 6461 736b 3d22 666f 7262 6964 6465    dask="forbidde
+00005350: 6e22 2c0a 2020 2020 6f75 7470 7574 5f64  n",.    output_d
+00005360: 7479 7065 733d 4e6f 6e65 2c0a 2020 2020  types=None,.    
+00005370: 7665 6374 6f72 697a 653d 4661 6c73 652c  vectorize=False,
+00005380: 0a20 2020 206b 6565 705f 6174 7472 733d  .    keep_attrs=
+00005390: 226f 7665 7272 6964 6522 2c0a 2020 2020  "override",.    
+000053a0: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
+000053b0: 6773 3d4e 6f6e 652c 0a29 202d 3e20 5661  gs=None,.) -> Va
+000053c0: 7269 6162 6c65 207c 2074 7570 6c65 5b56  riable | tuple[V
+000053d0: 6172 6961 626c 652c 202e 2e2e 5d3a 0a20  ariable, ...]:. 
+000053e0: 2020 2022 2222 4170 706c 7920 6120 6e64     """Apply a nd
+000053f0: 6172 7261 7920 6c65 7665 6c20 6675 6e63  array level func
+00005400: 7469 6f6e 206f 7665 7220 5661 7269 6162  tion over Variab
+00005410: 6c65 2061 6e64 2f6f 7220 6e64 6172 7261  le and/or ndarra
+00005420: 7920 6f62 6a65 6374 732e 2222 220a 2020  y objects.""".  
+00005430: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
+00005440: 7265 2e76 6172 6961 626c 6520 696d 706f  re.variable impo
+00005450: 7274 2056 6172 6961 626c 652c 2061 735f  rt Variable, as_
+00005460: 636f 6d70 6174 6962 6c65 5f64 6174 610a  compatible_data.
+00005470: 0a20 2020 2064 696d 5f73 697a 6573 203d  .    dim_sizes =
+00005480: 2075 6e69 6669 6564 5f64 696d 5f73 697a   unified_dim_siz
+00005490: 6573 280a 2020 2020 2020 2020 2861 2066  es(.        (a f
+000054a0: 6f72 2061 2069 6e20 6172 6773 2069 6620  or a in args if 
+000054b0: 6861 7361 7474 7228 612c 2022 6469 6d73  hasattr(a, "dims
+000054c0: 2229 292c 2065 7863 6c75 6465 5f64 696d  ")), exclude_dim
+000054d0: 733d 6578 636c 7564 655f 6469 6d73 0a20  s=exclude_dims. 
+000054e0: 2020 2029 0a20 2020 2062 726f 6164 6361     ).    broadca
+000054f0: 7374 5f64 696d 7320 3d20 7475 706c 6528  st_dims = tuple(
+00005500: 0a20 2020 2020 2020 2064 696d 2066 6f72  .        dim for
+00005510: 2064 696d 2069 6e20 6469 6d5f 7369 7a65   dim in dim_size
+00005520: 7320 6966 2064 696d 206e 6f74 2069 6e20  s if dim not in 
+00005530: 7369 676e 6174 7572 652e 616c 6c5f 636f  signature.all_co
+00005540: 7265 5f64 696d 730a 2020 2020 290a 2020  re_dims.    ).  
+00005550: 2020 6f75 7470 7574 5f64 696d 7320 3d20    output_dims = 
+00005560: 5b62 726f 6164 6361 7374 5f64 696d 7320  [broadcast_dims 
+00005570: 2b20 6f75 7420 666f 7220 6f75 7420 696e  + out for out in
+00005580: 2073 6967 6e61 7475 7265 2e6f 7574 7075   signature.outpu
+00005590: 745f 636f 7265 5f64 696d 735d 0a0a 2020  t_core_dims]..  
+000055a0: 2020 696e 7075 745f 6461 7461 203d 205b    input_data = [
+000055b0: 0a20 2020 2020 2020 2062 726f 6164 6361  .        broadca
+000055c0: 7374 5f63 6f6d 7061 745f 6461 7461 2861  st_compat_data(a
+000055d0: 7267 2c20 6272 6f61 6463 6173 745f 6469  rg, broadcast_di
+000055e0: 6d73 2c20 636f 7265 5f64 696d 7329 0a20  ms, core_dims). 
+000055f0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00005600: 616e 6365 2861 7267 2c20 5661 7269 6162  ance(arg, Variab
+00005610: 6c65 290a 2020 2020 2020 2020 656c 7365  le).        else
+00005620: 2061 7267 0a20 2020 2020 2020 2066 6f72   arg.        for
+00005630: 2061 7267 2c20 636f 7265 5f64 696d 7320   arg, core_dims 
+00005640: 696e 207a 6970 2861 7267 732c 2073 6967  in zip(args, sig
+00005650: 6e61 7475 7265 2e69 6e70 7574 5f63 6f72  nature.input_cor
+00005660: 655f 6469 6d73 290a 2020 2020 5d0a 0a20  e_dims).    ].. 
+00005670: 2020 2069 6620 616e 7928 6973 5f64 7563     if any(is_duc
+00005680: 6b5f 6461 736b 5f61 7272 6179 2861 7272  k_dask_array(arr
+00005690: 6179 2920 666f 7220 6172 7261 7920 696e  ay) for array in
+000056a0: 2069 6e70 7574 5f64 6174 6129 3a0a 2020   input_data):.  
+000056b0: 2020 2020 2020 6966 2064 6173 6b20 3d3d        if dask ==
+000056c0: 2022 666f 7262 6964 6465 6e22 3a0a 2020   "forbidden":.  
+000056d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000056e0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+000056f0: 2020 2020 2020 2020 2020 2020 2261 7070              "app
+00005700: 6c79 5f75 6675 6e63 2065 6e63 6f75 6e74  ly_ufunc encount
+00005710: 6572 6564 2061 2064 6173 6b20 6172 7261  ered a dask arra
+00005720: 7920 6f6e 2061 6e20 220a 2020 2020 2020  y on an ".      
+00005730: 2020 2020 2020 2020 2020 2261 7267 756d            "argum
+00005740: 656e 742c 2062 7574 2068 616e 646c 696e  ent, but handlin
+00005750: 6720 666f 7220 6461 736b 2061 7272 6179  g for dask array
+00005760: 7320 6861 7320 6e6f 7420 220a 2020 2020  s has not ".    
+00005770: 2020 2020 2020 2020 2020 2020 2262 6565              "bee
+00005780: 6e20 656e 6162 6c65 642e 2045 6974 6865  n enabled. Eithe
+00005790: 7220 7365 7420 7468 6520 6060 6461 736b  r set the ``dask
+000057a0: 6060 2061 7267 756d 656e 7420 220a 2020  `` argument ".  
+000057b0: 2020 2020 2020 2020 2020 2020 2020 226f                "o
+000057c0: 7220 6c6f 6164 2079 6f75 7220 6461 7461  r load your data
+000057d0: 2069 6e74 6f20 6d65 6d6f 7279 2066 6972   into memory fir
+000057e0: 7374 2077 6974 6820 220a 2020 2020 2020  st with ".      
+000057f0: 2020 2020 2020 2020 2020 2260 602e 6c6f            "``.lo
+00005800: 6164 2829 6060 206f 7220 6060 2e63 6f6d  ad()`` or ``.com
+00005810: 7075 7465 2829 6060 220a 2020 2020 2020  pute()``".      
+00005820: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00005830: 656c 6966 2064 6173 6b20 3d3d 2022 7061  elif dask == "pa
+00005840: 7261 6c6c 656c 697a 6564 223a 0a20 2020  rallelized":.   
+00005850: 2020 2020 2020 2020 206e 756d 7079 5f66           numpy_f
+00005860: 756e 6320 3d20 6675 6e63 0a0a 2020 2020  unc = func..    
+00005870: 2020 2020 2020 2020 6966 2064 6173 6b5f          if dask_
+00005880: 6775 6675 6e63 5f6b 7761 7267 7320 6973  gufunc_kwargs is
+00005890: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000058a0: 2020 2020 2020 2064 6173 6b5f 6775 6675         dask_gufu
+000058b0: 6e63 5f6b 7761 7267 7320 3d20 7b7d 0a20  nc_kwargs = {}. 
+000058c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000058d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000058e0: 2064 6173 6b5f 6775 6675 6e63 5f6b 7761   dask_gufunc_kwa
+000058f0: 7267 7320 3d20 6461 736b 5f67 7566 756e  rgs = dask_gufun
+00005900: 635f 6b77 6172 6773 2e63 6f70 7928 290a  c_kwargs.copy().
+00005910: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
+00005920: 6f77 5f72 6563 6875 6e6b 203d 2064 6173  ow_rechunk = das
+00005930: 6b5f 6775 6675 6e63 5f6b 7761 7267 732e  k_gufunc_kwargs.
+00005940: 6765 7428 2261 6c6c 6f77 5f72 6563 6875  get("allow_rechu
+00005950: 6e6b 222c 204e 6f6e 6529 0a20 2020 2020  nk", None).     
+00005960: 2020 2020 2020 2069 6620 616c 6c6f 775f         if allow_
+00005970: 7265 6368 756e 6b20 6973 204e 6f6e 653a  rechunk is None:
+00005980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005990: 2066 6f72 206e 2c20 2864 6174 612c 2063   for n, (data, c
+000059a0: 6f72 655f 6469 6d73 2920 696e 2065 6e75  ore_dims) in enu
+000059b0: 6d65 7261 7465 280a 2020 2020 2020 2020  merate(.        
+000059c0: 2020 2020 2020 2020 2020 2020 7a69 7028              zip(
+000059d0: 696e 7075 745f 6461 7461 2c20 7369 676e  input_data, sign
+000059e0: 6174 7572 652e 696e 7075 745f 636f 7265  ature.input_core
+000059f0: 5f64 696d 7329 0a20 2020 2020 2020 2020  _dims).         
+00005a00: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+00005a10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00005a20: 2069 735f 6475 636b 5f64 6173 6b5f 6172   is_duck_dask_ar
+00005a30: 7261 7928 6461 7461 293a 0a20 2020 2020  ray(data):.     
+00005a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a50: 2020 2023 2063 6f72 6520 6469 6d65 6e73     # core dimens
+00005a60: 696f 6e73 2063 616e 6e6f 7420 7370 616e  ions cannot span
+00005a70: 206d 756c 7469 706c 6520 6368 756e 6b73   multiple chunks
+00005a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005a90: 2020 2020 2020 2020 2066 6f72 2061 7869           for axi
+00005aa0: 732c 2064 696d 2069 6e20 656e 756d 6572  s, dim in enumer
+00005ab0: 6174 6528 636f 7265 5f64 696d 732c 2073  ate(core_dims, s
+00005ac0: 7461 7274 3d2d 6c65 6e28 636f 7265 5f64  tart=-len(core_d
+00005ad0: 696d 7329 293a 0a20 2020 2020 2020 2020  ims)):.         
+00005ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005af0: 2020 2069 6620 6c65 6e28 6461 7461 2e63     if len(data.c
+00005b00: 6875 6e6b 735b 6178 6973 5d29 2021 3d20  hunks[axis]) != 
+00005b10: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
 00005b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b30: 6966 206c 656e 2864 6174 612e 6368 756e  if len(data.chun
-00005b40: 6b73 5b61 7869 735d 2920 213d 2031 3a0a  ks[axis]) != 1:.
+00005b30: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00005b40: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
 00005b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b70: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00005b80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00005b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ba0: 2020 2020 2020 6622 6469 6d65 6e73 696f        f"dimensio
-00005bb0: 6e20 7b64 696d 7d20 6f6e 207b 6e7d 7468  n {dim} on {n}th
-00005bc0: 2066 756e 6374 696f 6e20 6172 6775 6d65   function argume
-00005bd0: 6e74 2074 6f20 220a 2020 2020 2020 2020  nt to ".        
-00005be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005bf0: 2020 2020 2020 2020 2020 2020 2261 7070              "app
-00005c00: 6c79 5f75 6675 6e63 2077 6974 6820 6461  ly_ufunc with da
-00005c10: 736b 3d27 7061 7261 6c6c 656c 697a 6564  sk='parallelized
-00005c20: 2720 636f 6e73 6973 7473 206f 6620 220a  ' consists of ".
-00005c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c50: 2020 2020 226d 756c 7469 706c 6520 6368      "multiple ch
-00005c60: 756e 6b73 2c20 6275 7420 6973 2061 6c73  unks, but is als
-00005c70: 6f20 6120 636f 7265 2064 696d 656e 7369  o a core dimensi
-00005c80: 6f6e 2e20 546f 2022 0a20 2020 2020 2020  on. To ".       
-00005c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ca0: 2020 2020 2020 2020 2020 2020 2022 6669               "fi
-00005cb0: 782c 2065 6974 6865 7220 7265 6368 756e  x, either rechun
-00005cc0: 6b20 696e 746f 2061 2073 696e 676c 6520  k into a single 
-00005cd0: 6461 736b 2061 7272 6179 2063 6875 6e6b  dask array chunk
-00005ce0: 2061 6c6f 6e67 2022 0a20 2020 2020 2020   along ".       
-00005cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d00: 2020 2020 2020 2020 2020 2020 2066 2274               f"t
-00005d10: 6869 7320 6469 6d65 6e73 696f 6e2c 2069  his dimension, i
-00005d20: 2e65 2e2c 2060 602e 6368 756e 6b28 6469  .e., ``.chunk(di
-00005d30: 6374 287b 6469 6d7d 3d2d 3129 2960 602c  ct({dim}=-1))``,
-00005d40: 206f 7220 220a 2020 2020 2020 2020 2020   or ".          
-00005d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d60: 2020 2020 2020 2020 2020 2270 6173 7320            "pass 
-00005d70: 6060 616c 6c6f 775f 7265 6368 756e 6b3d  ``allow_rechunk=
-00005d80: 5472 7565 6060 2069 6e20 6060 6461 736b  True`` in ``dask
-00005d90: 5f67 7566 756e 635f 6b77 6172 6773 6060  _gufunc_kwargs``
-00005da0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00005db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005dc0: 2020 2020 2020 2022 6275 7420 6265 7761         "but bewa
-00005dd0: 7265 2074 6861 7420 7468 6973 206d 6179  re that this may
-00005de0: 2073 6967 6e69 6669 6361 6e74 6c79 2069   significantly i
-00005df0: 6e63 7265 6173 6520 6d65 6d6f 7279 2075  ncrease memory u
-00005e00: 7361 6765 2e22 0a20 2020 2020 2020 2020  sage.".         
-00005e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00005e30: 2020 2020 2020 2020 2064 6173 6b5f 6775           dask_gu
-00005e40: 6675 6e63 5f6b 7761 7267 735b 2261 6c6c  func_kwargs["all
-00005e50: 6f77 5f72 6563 6875 6e6b 225d 203d 2054  ow_rechunk"] = T
-00005e60: 7275 650a 0a20 2020 2020 2020 2020 2020  rue..           
-00005e70: 206f 7574 7075 745f 7369 7a65 7320 3d20   output_sizes = 
-00005e80: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
-00005e90: 6773 2e70 6f70 2822 6f75 7470 7574 5f73  gs.pop("output_s
-00005ea0: 697a 6573 222c 207b 7d29 0a20 2020 2020  izes", {}).     
-00005eb0: 2020 2020 2020 2069 6620 6f75 7470 7574         if output
-00005ec0: 5f73 697a 6573 3a0a 2020 2020 2020 2020  _sizes:.        
-00005ed0: 2020 2020 2020 2020 6f75 7470 7574 5f73          output_s
-00005ee0: 697a 6573 5f72 656e 616d 6564 203d 207b  izes_renamed = {
-00005ef0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00005f00: 2020 666f 7220 6b65 792c 2076 616c 7565    for key, value
-00005f10: 2069 6e20 6f75 7470 7574 5f73 697a 6573   in output_sizes
-00005f20: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00005f30: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00005f40: 206b 6579 206e 6f74 2069 6e20 7369 676e   key not in sign
-00005f50: 6174 7572 652e 616c 6c5f 6f75 7470 7574  ature.all_output
-00005f60: 5f63 6f72 655f 6469 6d73 3a0a 2020 2020  _core_dims:.    
-00005f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f80: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00005f90: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00005fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fb0: 2020 6622 6469 6d65 6e73 696f 6e20 277b    f"dimension '{
-00005fc0: 6b65 797d 2720 696e 2027 6f75 7470 7574  key}' in 'output
-00005fd0: 5f73 697a 6573 2720 6d75 7374 2063 6f72  _sizes' must cor
-00005fe0: 7265 7370 6f6e 6420 746f 206f 7574 7075  respond to outpu
-00005ff0: 745f 636f 7265 5f64 696d 7322 0a20 2020  t_core_dims".   
-00006000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006010: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00006020: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-00006030: 745f 7369 7a65 735f 7265 6e61 6d65 645b  t_sizes_renamed[
-00006040: 7369 676e 6174 7572 652e 6469 6d73 5f6d  signature.dims_m
-00006050: 6170 5b6b 6579 5d5d 203d 2076 616c 7565  ap[key]] = value
-00006060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006070: 2064 6173 6b5f 6775 6675 6e63 5f6b 7761   dask_gufunc_kwa
-00006080: 7267 735b 226f 7574 7075 745f 7369 7a65  rgs["output_size
-00006090: 7322 5d20 3d20 6f75 7470 7574 5f73 697a  s"] = output_siz
-000060a0: 6573 5f72 656e 616d 6564 0a0a 2020 2020  es_renamed..    
-000060b0: 2020 2020 2020 2020 666f 7220 6b65 7920          for key 
-000060c0: 696e 2073 6967 6e61 7475 7265 2e61 6c6c  in signature.all
-000060d0: 5f6f 7574 7075 745f 636f 7265 5f64 696d  _output_core_dim
-000060e0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000060f0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00006100: 2020 2020 2020 2020 2020 2020 6b65 7920              key 
-00006110: 6e6f 7420 696e 2073 6967 6e61 7475 7265  not in signature
-00006120: 2e61 6c6c 5f69 6e70 7574 5f63 6f72 655f  .all_input_core_
-00006130: 6469 6d73 206f 7220 6b65 7920 696e 2065  dims or key in e
-00006140: 7863 6c75 6465 5f64 696d 730a 2020 2020  xclude_dims.    
-00006150: 2020 2020 2020 2020 2020 2020 2920 616e              ) an
-00006160: 6420 6b65 7920 6e6f 7420 696e 206f 7574  d key not in out
-00006170: 7075 745f 7369 7a65 733a 0a20 2020 2020  put_sizes:.     
-00006180: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00006190: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000061a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000061b0: 2020 2020 2020 2020 2066 2264 696d 656e           f"dimen
-000061c0: 7369 6f6e 2027 7b6b 6579 7d27 2069 6e20  sion '{key}' in 
-000061d0: 276f 7574 7075 745f 636f 7265 5f64 696d  'output_core_dim
-000061e0: 7327 206e 6565 6473 2063 6f72 7265 7370  s' needs corresp
-000061f0: 6f6e 6469 6e67 2028 6469 6d2c 2073 697a  onding (dim, siz
-00006200: 6529 2069 6e20 276f 7574 7075 745f 7369  e) in 'output_si
-00006210: 7a65 7327 220a 2020 2020 2020 2020 2020  zes'".          
-00006220: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00006230: 2020 2020 2020 2020 2064 6566 2066 756e           def fun
-00006240: 6328 2a61 7272 6179 7329 3a0a 2020 2020  c(*arrays):.    
-00006250: 2020 2020 2020 2020 2020 2020 696d 706f              impo
-00006260: 7274 2064 6173 6b2e 6172 7261 7920 6173  rt dask.array as
-00006270: 2064 610a 0a20 2020 2020 2020 2020 2020   da..           
-00006280: 2020 2020 2072 6573 203d 2064 612e 6170       res = da.ap
-00006290: 706c 795f 6775 6675 6e63 280a 2020 2020  ply_gufunc(.    
-000062a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000062b0: 6e75 6d70 795f 6675 6e63 2c0a 2020 2020  numpy_func,.    
+00005b60: 2020 2020 2020 2020 2066 2264 696d 656e           f"dimen
+00005b70: 7369 6f6e 207b 6469 6d7d 206f 6e20 7b6e  sion {dim} on {n
+00005b80: 7d74 6820 6675 6e63 7469 6f6e 2061 7267  }th function arg
+00005b90: 756d 656e 7420 746f 2022 0a20 2020 2020  ument to ".     
+00005ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005bb0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00005bc0: 6170 706c 795f 7566 756e 6320 7769 7468  apply_ufunc with
+00005bd0: 2064 6173 6b3d 2770 6172 616c 6c65 6c69   dask='paralleli
+00005be0: 7a65 6427 2063 6f6e 7369 7374 7320 6f66  zed' consists of
+00005bf0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00005c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c10: 2020 2020 2020 2022 6d75 6c74 6970 6c65         "multiple
+00005c20: 2063 6875 6e6b 732c 2062 7574 2069 7320   chunks, but is 
+00005c30: 616c 736f 2061 2063 6f72 6520 6469 6d65  also a core dime
+00005c40: 6e73 696f 6e2e 2054 6f20 220a 2020 2020  nsion. To ".    
+00005c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c70: 2266 6978 2c20 6569 7468 6572 2072 6563  "fix, either rec
+00005c80: 6875 6e6b 2069 6e74 6f20 6120 7369 6e67  hunk into a sing
+00005c90: 6c65 2064 6173 6b20 6172 7261 7920 6368  le dask array ch
+00005ca0: 756e 6b20 616c 6f6e 6720 220a 2020 2020  unk along ".    
+00005cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005cd0: 6622 7468 6973 2064 696d 656e 7369 6f6e  f"this dimension
+00005ce0: 2c20 692e 652e 2c20 6060 2e63 6875 6e6b  , i.e., ``.chunk
+00005cf0: 2864 6963 7428 7b64 696d 7d3d 2d31 2929  (dict({dim}=-1))
+00005d00: 6060 2c20 6f72 2022 0a20 2020 2020 2020  ``, or ".       
+00005d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d20: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
+00005d30: 7373 2060 6061 6c6c 6f77 5f72 6563 6875  ss ``allow_rechu
+00005d40: 6e6b 3d54 7275 6560 6020 696e 2060 6064  nk=True`` in ``d
+00005d50: 6173 6b5f 6775 6675 6e63 5f6b 7761 7267  ask_gufunc_kwarg
+00005d60: 7360 6020 220a 2020 2020 2020 2020 2020  s`` ".          
+00005d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d80: 2020 2020 2020 2020 2020 2262 7574 2062            "but b
+00005d90: 6577 6172 6520 7468 6174 2074 6869 7320  eware that this 
+00005da0: 6d61 7920 7369 676e 6966 6963 616e 746c  may significantl
+00005db0: 7920 696e 6372 6561 7365 206d 656d 6f72  y increase memor
+00005dc0: 7920 7573 6167 652e 220a 2020 2020 2020  y usage.".      
+00005dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005de0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00005df0: 2020 2020 2020 2020 2020 2020 6461 736b              dask
+00005e00: 5f67 7566 756e 635f 6b77 6172 6773 5b22  _gufunc_kwargs["
+00005e10: 616c 6c6f 775f 7265 6368 756e 6b22 5d20  allow_rechunk"] 
+00005e20: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
+00005e30: 2020 2020 6f75 7470 7574 5f73 697a 6573      output_sizes
+00005e40: 203d 2064 6173 6b5f 6775 6675 6e63 5f6b   = dask_gufunc_k
+00005e50: 7761 7267 732e 706f 7028 226f 7574 7075  wargs.pop("outpu
+00005e60: 745f 7369 7a65 7322 2c20 7b7d 290a 2020  t_sizes", {}).  
+00005e70: 2020 2020 2020 2020 2020 6966 206f 7574            if out
+00005e80: 7075 745f 7369 7a65 733a 0a20 2020 2020  put_sizes:.     
+00005e90: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+00005ea0: 745f 7369 7a65 735f 7265 6e61 6d65 6420  t_sizes_renamed 
+00005eb0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+00005ec0: 2020 2020 2066 6f72 206b 6579 2c20 7661       for key, va
+00005ed0: 6c75 6520 696e 206f 7574 7075 745f 7369  lue in output_si
+00005ee0: 7a65 732e 6974 656d 7328 293a 0a20 2020  zes.items():.   
+00005ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f00: 2069 6620 6b65 7920 6e6f 7420 696e 2073   if key not in s
+00005f10: 6967 6e61 7475 7265 2e61 6c6c 5f6f 7574  ignature.all_out
+00005f20: 7075 745f 636f 7265 5f64 696d 733a 0a20  put_core_dims:. 
+00005f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f40: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00005f50: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+00005f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f70: 2020 2020 2066 2264 696d 656e 7369 6f6e       f"dimension
+00005f80: 2027 7b6b 6579 7d27 2069 6e20 276f 7574   '{key}' in 'out
+00005f90: 7075 745f 7369 7a65 7327 206d 7573 7420  put_sizes' must 
+00005fa0: 636f 7272 6573 706f 6e64 2074 6f20 6f75  correspond to ou
+00005fb0: 7470 7574 5f63 6f72 655f 6469 6d73 220a  tput_core_dims".
+00005fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fd0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00005fe0: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+00005ff0: 7470 7574 5f73 697a 6573 5f72 656e 616d  tput_sizes_renam
+00006000: 6564 5b73 6967 6e61 7475 7265 2e64 696d  ed[signature.dim
+00006010: 735f 6d61 705b 6b65 795d 5d20 3d20 7661  s_map[key]] = va
+00006020: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
+00006030: 2020 2020 6461 736b 5f67 7566 756e 635f      dask_gufunc_
+00006040: 6b77 6172 6773 5b22 6f75 7470 7574 5f73  kwargs["output_s
+00006050: 697a 6573 225d 203d 206f 7574 7075 745f  izes"] = output_
+00006060: 7369 7a65 735f 7265 6e61 6d65 640a 0a20  sizes_renamed.. 
+00006070: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+00006080: 6579 2069 6e20 7369 676e 6174 7572 652e  ey in signature.
+00006090: 616c 6c5f 6f75 7470 7574 5f63 6f72 655f  all_output_core_
+000060a0: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
+000060b0: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+000060c0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+000060d0: 6579 206e 6f74 2069 6e20 7369 676e 6174  ey not in signat
+000060e0: 7572 652e 616c 6c5f 696e 7075 745f 636f  ure.all_input_co
+000060f0: 7265 5f64 696d 7320 6f72 206b 6579 2069  re_dims or key i
+00006100: 6e20 6578 636c 7564 655f 6469 6d73 0a20  n exclude_dims. 
+00006110: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00006120: 2061 6e64 206b 6579 206e 6f74 2069 6e20   and key not in 
+00006130: 6f75 7470 7574 5f73 697a 6573 3a0a 2020  output_sizes:.  
+00006140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006150: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00006160: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00006170: 2020 2020 2020 2020 2020 2020 6622 6469              f"di
+00006180: 6d65 6e73 696f 6e20 277b 6b65 797d 2720  mension '{key}' 
+00006190: 696e 2027 6f75 7470 7574 5f63 6f72 655f  in 'output_core_
+000061a0: 6469 6d73 2720 6e65 6564 7320 636f 7272  dims' needs corr
+000061b0: 6573 706f 6e64 696e 6720 2864 696d 2c20  esponding (dim, 
+000061c0: 7369 7a65 2920 696e 2027 6f75 7470 7574  size) in 'output
+000061d0: 5f73 697a 6573 2722 0a20 2020 2020 2020  _sizes'".       
+000061e0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+000061f0: 2020 2020 2020 2020 2020 2020 6465 6620              def 
+00006200: 6675 6e63 282a 6172 7261 7973 293a 0a20  func(*arrays):. 
+00006210: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00006220: 6d70 6f72 7420 6461 736b 2e61 7272 6179  mport dask.array
+00006230: 2061 7320 6461 0a0a 2020 2020 2020 2020   as da..        
+00006240: 2020 2020 2020 2020 7265 7320 3d20 6461          res = da
+00006250: 2e61 7070 6c79 5f67 7566 756e 6328 0a20  .apply_gufunc(. 
+00006260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006270: 2020 206e 756d 7079 5f66 756e 632c 0a20     numpy_func,. 
+00006280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006290: 2020 2073 6967 6e61 7475 7265 2e74 6f5f     signature.to_
+000062a0: 6775 6675 6e63 5f73 7472 696e 6728 6578  gufunc_string(ex
+000062b0: 636c 7564 655f 6469 6d73 292c 0a20 2020  clude_dims),.   
 000062c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000062d0: 7369 676e 6174 7572 652e 746f 5f67 7566  signature.to_guf
-000062e0: 756e 635f 7374 7269 6e67 2865 7863 6c75  unc_string(exclu
-000062f0: 6465 5f64 696d 7329 2c0a 2020 2020 2020  de_dims),.      
-00006300: 2020 2020 2020 2020 2020 2020 2020 2a61                *a
-00006310: 7272 6179 732c 0a20 2020 2020 2020 2020  rrays,.         
-00006320: 2020 2020 2020 2020 2020 2076 6563 746f             vecto
-00006330: 7269 7a65 3d76 6563 746f 7269 7a65 2c0a  rize=vectorize,.
-00006340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006350: 2020 2020 6f75 7470 7574 5f64 7479 7065      output_dtype
-00006360: 733d 6f75 7470 7574 5f64 7479 7065 732c  s=output_dtypes,
+000062d0: 202a 6172 7261 7973 2c0a 2020 2020 2020   *arrays,.      
+000062e0: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+000062f0: 6374 6f72 697a 653d 7665 6374 6f72 697a  ctorize=vectoriz
+00006300: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00006310: 2020 2020 2020 206f 7574 7075 745f 6474         output_dt
+00006320: 7970 6573 3d6f 7574 7075 745f 6474 7970  ypes=output_dtyp
+00006330: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+00006340: 2020 2020 2020 2020 2a2a 6461 736b 5f67          **dask_g
+00006350: 7566 756e 635f 6b77 6172 6773 2c0a 2020  ufunc_kwargs,.  
+00006360: 2020 2020 2020 2020 2020 2020 2020 290a                ).
 00006370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006380: 2020 2020 202a 2a64 6173 6b5f 6775 6675       **dask_gufu
-00006390: 6e63 5f6b 7761 7267 732c 0a20 2020 2020  nc_kwargs,.     
-000063a0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000063b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000063c0: 7475 726e 2072 6573 0a0a 2020 2020 2020  turn res..      
-000063d0: 2020 656c 6966 2064 6173 6b20 3d3d 2022    elif dask == "
-000063e0: 616c 6c6f 7765 6422 3a0a 2020 2020 2020  allowed":.      
-000063f0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-00006400: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00006410: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00006420: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00006430: 2020 2020 2020 2022 756e 6b6e 6f77 6e20         "unknown 
-00006440: 7365 7474 696e 6720 666f 7220 6461 736b  setting for dask
-00006450: 2061 7272 6179 2068 616e 646c 696e 6720   array handling 
-00006460: 696e 2022 0a20 2020 2020 2020 2020 2020  in ".           
-00006470: 2020 2020 2022 6170 706c 795f 7566 756e       "apply_ufun
-00006480: 633a 207b 7d22 2e66 6f72 6d61 7428 6461  c: {}".format(da
-00006490: 736b 290a 2020 2020 2020 2020 2020 2020  sk).            
-000064a0: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-000064b0: 2020 2020 6966 2076 6563 746f 7269 7a65      if vectorize
-000064c0: 3a0a 2020 2020 2020 2020 2020 2020 6675  :.            fu
-000064d0: 6e63 203d 205f 7665 6374 6f72 697a 6528  nc = _vectorize(
-000064e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000064f0: 2066 756e 632c 2073 6967 6e61 7475 7265   func, signature
-00006500: 2c20 6f75 7470 7574 5f64 7479 7065 733d  , output_dtypes=
-00006510: 6f75 7470 7574 5f64 7479 7065 732c 2065  output_dtypes, e
-00006520: 7863 6c75 6465 5f64 696d 733d 6578 636c  xclude_dims=excl
-00006530: 7564 655f 6469 6d73 0a20 2020 2020 2020  ude_dims.       
-00006540: 2020 2020 2029 0a0a 2020 2020 7265 7375       )..    resu
-00006550: 6c74 5f64 6174 6120 3d20 6675 6e63 282a  lt_data = func(*
-00006560: 696e 7075 745f 6461 7461 290a 0a20 2020  input_data)..   
-00006570: 2069 6620 7369 676e 6174 7572 652e 6e75   if signature.nu
-00006580: 6d5f 6f75 7470 7574 7320 3d3d 2031 3a0a  m_outputs == 1:.
-00006590: 2020 2020 2020 2020 7265 7375 6c74 5f64          result_d
-000065a0: 6174 6120 3d20 2872 6573 756c 745f 6461  ata = (result_da
-000065b0: 7461 2c29 0a20 2020 2065 6c69 6620 280a  ta,).    elif (.
-000065c0: 2020 2020 2020 2020 6e6f 7420 6973 696e          not isin
-000065d0: 7374 616e 6365 2872 6573 756c 745f 6461  stance(result_da
-000065e0: 7461 2c20 7475 706c 6529 206f 7220 6c65  ta, tuple) or le
-000065f0: 6e28 7265 7375 6c74 5f64 6174 6129 2021  n(result_data) !
-00006600: 3d20 7369 676e 6174 7572 652e 6e75 6d5f  = signature.num_
-00006610: 6f75 7470 7574 730a 2020 2020 293a 0a20  outputs.    ):. 
-00006620: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00006630: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-00006640: 2020 2020 2022 6170 706c 6965 6420 6675       "applied fu
-00006650: 6e63 7469 6f6e 2064 6f65 7320 6e6f 7420  nction does not 
-00006660: 6861 7665 2074 6865 206e 756d 6265 7220  have the number 
-00006670: 6f66 2022 0a20 2020 2020 2020 2020 2020  of ".           
-00006680: 2022 6f75 7470 7574 7320 7370 6563 6966   "outputs specif
-00006690: 6965 6420 696e 2074 6865 2075 6675 6e63  ied in the ufunc
-000066a0: 2073 6967 6e61 7475 7265 2e20 220a 2020   signature. ".  
-000066b0: 2020 2020 2020 2020 2020 2252 6573 756c            "Resul
-000066c0: 7420 6973 206e 6f74 2061 2074 7570 6c65  t is not a tuple
-000066d0: 206f 6620 7b7d 2065 6c65 6d65 6e74 733a   of {} elements:
-000066e0: 207b 2172 7d22 2e66 6f72 6d61 7428 0a20   {!r}".format(. 
-000066f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00006700: 6967 6e61 7475 7265 2e6e 756d 5f6f 7574  ignature.num_out
-00006710: 7075 7473 2c20 7265 7375 6c74 5f64 6174  puts, result_dat
-00006720: 610a 2020 2020 2020 2020 2020 2020 290a  a.            ).
-00006730: 2020 2020 2020 2020 290a 0a20 2020 206f          )..    o
-00006740: 626a 7320 3d20 5f61 6c6c 5f6f 665f 7479  bjs = _all_of_ty
-00006750: 7065 2861 7267 732c 2056 6172 6961 626c  pe(args, Variabl
-00006760: 6529 0a20 2020 2061 7474 7273 203d 206d  e).    attrs = m
-00006770: 6572 6765 5f61 7474 7273 280a 2020 2020  erge_attrs(.    
-00006780: 2020 2020 5b6f 626a 2e61 7474 7273 2066      [obj.attrs f
-00006790: 6f72 206f 626a 2069 6e20 6f62 6a73 5d2c  or obj in objs],
-000067a0: 0a20 2020 2020 2020 2063 6f6d 6269 6e65  .        combine
-000067b0: 5f61 7474 7273 3d6b 6565 705f 6174 7472  _attrs=keep_attr
-000067c0: 732c 0a20 2020 2029 0a0a 2020 2020 6f75  s,.    )..    ou
-000067d0: 7470 7574 3a20 6c69 7374 5b56 6172 6961  tput: list[Varia
-000067e0: 626c 655d 203d 205b 5d0a 2020 2020 666f  ble] = [].    fo
-000067f0: 7220 6469 6d73 2c20 6461 7461 2069 6e20  r dims, data in 
-00006800: 7a69 7028 6f75 7470 7574 5f64 696d 732c  zip(output_dims,
-00006810: 2072 6573 756c 745f 6461 7461 293a 0a20   result_data):. 
-00006820: 2020 2020 2020 2064 6174 6120 3d20 6173         data = as
-00006830: 5f63 6f6d 7061 7469 626c 655f 6461 7461  _compatible_data
-00006840: 2864 6174 6129 0a20 2020 2020 2020 2069  (data).        i
-00006850: 6620 6461 7461 2e6e 6469 6d20 213d 206c  f data.ndim != l
-00006860: 656e 2864 696d 7329 3a0a 2020 2020 2020  en(dims):.      
-00006870: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00006880: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00006890: 2020 2020 2020 2020 2261 7070 6c69 6564          "applied
-000068a0: 2066 756e 6374 696f 6e20 7265 7475 726e   function return
-000068b0: 6564 2064 6174 6120 7769 7468 2075 6e65  ed data with une
-000068c0: 7870 6563 7465 6420 220a 2020 2020 2020  xpected ".      
-000068d0: 2020 2020 2020 2020 2020 6622 6e75 6d62            f"numb
-000068e0: 6572 206f 6620 6469 6d65 6e73 696f 6e73  er of dimensions
-000068f0: 2e20 5265 6365 6976 6564 207b 6461 7461  . Received {data
-00006900: 2e6e 6469 6d7d 2064 696d 656e 7369 6f6e  .ndim} dimension
-00006910: 2873 2920 6275 7420 220a 2020 2020 2020  (s) but ".      
-00006920: 2020 2020 2020 2020 2020 6622 6578 7065            f"expe
-00006930: 6374 6564 207b 6c65 6e28 6469 6d73 297d  cted {len(dims)}
-00006940: 2064 696d 656e 7369 6f6e 7320 7769 7468   dimensions with
-00006950: 206e 616d 6573 3a20 7b64 696d 7321 727d   names: {dims!r}
-00006960: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00006970: 0a20 2020 2020 2020 2076 6172 203d 2056  .        var = V
-00006980: 6172 6961 626c 6528 6469 6d73 2c20 6461  ariable(dims, da
-00006990: 7461 2c20 6661 7374 7061 7468 3d54 7275  ta, fastpath=Tru
-000069a0: 6529 0a20 2020 2020 2020 2066 6f72 2064  e).        for d
-000069b0: 696d 2c20 6e65 775f 7369 7a65 2069 6e20  im, new_size in 
-000069c0: 7661 722e 7369 7a65 732e 6974 656d 7328  var.sizes.items(
-000069d0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-000069e0: 6620 6469 6d20 696e 2064 696d 5f73 697a  f dim in dim_siz
-000069f0: 6573 2061 6e64 206e 6577 5f73 697a 6520  es and new_size 
-00006a00: 213d 2064 696d 5f73 697a 6573 5b64 696d  != dim_sizes[dim
-00006a10: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00006a20: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00006a30: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00006a40: 2020 2020 2020 2020 2022 7369 7a65 206f           "size o
-00006a50: 6620 6469 6d65 6e73 696f 6e20 7b21 727d  f dimension {!r}
-00006a60: 206f 6e20 696e 7075 7473 2077 6173 2075   on inputs was u
-00006a70: 6e65 7870 6563 7465 646c 7920 220a 2020  nexpectedly ".  
-00006a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a90: 2020 2263 6861 6e67 6564 2062 7920 6170    "changed by ap
-00006aa0: 706c 6965 6420 6675 6e63 7469 6f6e 2066  plied function f
-00006ab0: 726f 6d20 7b7d 2074 6f20 7b7d 2e20 4f6e  rom {} to {}. On
-00006ac0: 6c79 2022 0a20 2020 2020 2020 2020 2020  ly ".           
-00006ad0: 2020 2020 2020 2020 2022 6469 6d65 6e73           "dimens
-00006ae0: 696f 6e73 2073 7065 6369 6669 6564 2069  ions specified i
-00006af0: 6e20 6060 6578 636c 7564 655f 6469 6d73  n ``exclude_dims
-00006b00: 6060 2077 6974 6820 220a 2020 2020 2020  `` with ".      
-00006b10: 2020 2020 2020 2020 2020 2020 2020 2278                "x
-00006b20: 6172 7261 792e 6170 706c 795f 7566 756e  array.apply_ufun
-00006b30: 6320 6172 6520 616c 6c6f 7765 6420 746f  c are allowed to
-00006b40: 2063 6861 6e67 6520 7369 7a65 2e22 2e66   change size.".f
-00006b50: 6f72 6d61 7428 0a20 2020 2020 2020 2020  ormat(.         
-00006b60: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00006b70: 696d 2c20 6469 6d5f 7369 7a65 735b 6469  im, dim_sizes[di
-00006b80: 6d5d 2c20 6e65 775f 7369 7a65 0a20 2020  m], new_size.   
-00006b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ba0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00006bb0: 2020 2029 0a0a 2020 2020 2020 2020 7661     )..        va
-00006bc0: 722e 6174 7472 7320 3d20 6174 7472 730a  r.attrs = attrs.
-00006bd0: 2020 2020 2020 2020 6f75 7470 7574 2e61          output.a
-00006be0: 7070 656e 6428 7661 7229 0a0a 2020 2020  ppend(var)..    
-00006bf0: 6966 2073 6967 6e61 7475 7265 2e6e 756d  if signature.num
-00006c00: 5f6f 7574 7075 7473 203d 3d20 313a 0a20  _outputs == 1:. 
-00006c10: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
-00006c20: 7470 7574 5b30 5d0a 2020 2020 656c 7365  tput[0].    else
-00006c30: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00006c40: 2074 7570 6c65 286f 7574 7075 7429 0a0a   tuple(output)..
-00006c50: 0a64 6566 2061 7070 6c79 5f61 7272 6179  .def apply_array
-00006c60: 5f75 6675 6e63 2866 756e 632c 202a 6172  _ufunc(func, *ar
-00006c70: 6773 2c20 6461 736b 3d22 666f 7262 6964  gs, dask="forbid
-00006c80: 6465 6e22 293a 0a20 2020 2022 2222 4170  den"):.    """Ap
-00006c90: 706c 7920 6120 6e64 6172 7261 7920 6c65  ply a ndarray le
-00006ca0: 7665 6c20 6675 6e63 7469 6f6e 206f 7665  vel function ove
-00006cb0: 7220 6e64 6172 7261 7920 6f62 6a65 6374  r ndarray object
-00006cc0: 732e 2222 220a 2020 2020 6966 2061 6e79  s.""".    if any
-00006cd0: 2869 735f 6475 636b 5f64 6173 6b5f 6172  (is_duck_dask_ar
-00006ce0: 7261 7928 6172 6729 2066 6f72 2061 7267  ray(arg) for arg
-00006cf0: 2069 6e20 6172 6773 293a 0a20 2020 2020   in args):.     
-00006d00: 2020 2069 6620 6461 736b 203d 3d20 2266     if dask == "f
-00006d10: 6f72 6269 6464 656e 223a 0a20 2020 2020  orbidden":.     
-00006d20: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00006d30: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-00006d40: 2020 2020 2020 2020 2022 6170 706c 795f           "apply_
-00006d50: 7566 756e 6320 656e 636f 756e 7465 7265  ufunc encountere
-00006d60: 6420 6120 6461 736b 2061 7272 6179 206f  d a dask array o
-00006d70: 6e20 616e 2022 0a20 2020 2020 2020 2020  n an ".         
-00006d80: 2020 2020 2020 2022 6172 6775 6d65 6e74         "argument
-00006d90: 2c20 6275 7420 6861 6e64 6c69 6e67 2066  , but handling f
-00006da0: 6f72 2064 6173 6b20 6172 7261 7973 2068  or dask arrays h
-00006db0: 6173 206e 6f74 2022 0a20 2020 2020 2020  as not ".       
-00006dc0: 2020 2020 2020 2020 2022 6265 656e 2065           "been e
-00006dd0: 6e61 626c 6564 2e20 4569 7468 6572 2073  nabled. Either s
-00006de0: 6574 2074 6865 2060 6064 6173 6b60 6020  et the ``dask`` 
-00006df0: 6172 6775 6d65 6e74 2022 0a20 2020 2020  argument ".     
-00006e00: 2020 2020 2020 2020 2020 2022 6f72 206c             "or l
-00006e10: 6f61 6420 796f 7572 2064 6174 6120 696e  oad your data in
-00006e20: 746f 206d 656d 6f72 7920 6669 7273 7420  to memory first 
-00006e30: 7769 7468 2022 0a20 2020 2020 2020 2020  with ".         
-00006e40: 2020 2020 2020 2022 6060 2e6c 6f61 6428         "``.load(
-00006e50: 2960 6020 6f72 2060 602e 636f 6d70 7574  )`` or ``.comput
-00006e60: 6528 2960 6022 0a20 2020 2020 2020 2020  e()``".         
-00006e70: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
-00006e80: 6620 6461 736b 203d 3d20 2270 6172 616c  f dask == "paral
-00006e90: 6c65 6c69 7a65 6422 3a0a 2020 2020 2020  lelized":.      
-00006ea0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00006eb0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00006ec0: 2020 2020 2020 2020 2263 616e 6e6f 7420          "cannot 
-00006ed0: 7573 6520 6461 736b 3d27 7061 7261 6c6c  use dask='parall
-00006ee0: 656c 697a 6564 2720 666f 7220 6170 706c  elized' for appl
-00006ef0: 795f 7566 756e 6320 220a 2020 2020 2020  y_ufunc ".      
-00006f00: 2020 2020 2020 2020 2020 2275 6e6c 6573            "unles
-00006f10: 7320 6174 206c 6561 7374 206f 6e65 2069  s at least one i
-00006f20: 6e70 7574 2069 7320 616e 2078 6172 7261  nput is an xarra
-00006f30: 7920 6f62 6a65 6374 220a 2020 2020 2020  y object".      
-00006f40: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00006f50: 656c 6966 2064 6173 6b20 3d3d 2022 616c  elif dask == "al
-00006f60: 6c6f 7765 6422 3a0a 2020 2020 2020 2020  lowed":.        
-00006f70: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-00006f80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00006f90: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00006fa0: 726f 7228 6622 756e 6b6e 6f77 6e20 7365  ror(f"unknown se
-00006fb0: 7474 696e 6720 666f 7220 6461 736b 2061  tting for dask a
-00006fc0: 7272 6179 2068 616e 646c 696e 673a 207b  rray handling: {
-00006fd0: 6461 736b 7d22 290a 2020 2020 7265 7475  dask}").    retu
-00006fe0: 726e 2066 756e 6328 2a61 7267 7329 0a0a  rn func(*args)..
-00006ff0: 0a64 6566 2061 7070 6c79 5f75 6675 6e63  .def apply_ufunc
-00007000: 280a 2020 2020 6675 6e63 3a20 4361 6c6c  (.    func: Call
-00007010: 6162 6c65 2c0a 2020 2020 2a61 7267 733a  able,.    *args:
-00007020: 2041 6e79 2c0a 2020 2020 696e 7075 745f   Any,.    input_
-00007030: 636f 7265 5f64 696d 733a 2053 6571 7565  core_dims: Seque
-00007040: 6e63 655b 5365 7175 656e 6365 5d20 7c20  nce[Sequence] | 
-00007050: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00007060: 206f 7574 7075 745f 636f 7265 5f64 696d   output_core_dim
-00007070: 733a 2053 6571 7565 6e63 655b 5365 7175  s: Sequence[Sequ
-00007080: 656e 6365 5d20 7c20 4e6f 6e65 203d 2028  ence] | None = (
-00007090: 2829 2c29 2c0a 2020 2020 6578 636c 7564  (),),.    exclud
-000070a0: 655f 6469 6d73 3a20 4162 7374 7261 6374  e_dims: Abstract
-000070b0: 5365 7420 3d20 6672 6f7a 656e 7365 7428  Set = frozenset(
-000070c0: 292c 0a20 2020 2076 6563 746f 7269 7a65  ),.    vectorize
-000070d0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-000070e0: 2020 2020 6a6f 696e 3a20 4a6f 696e 4f70      join: JoinOp
-000070f0: 7469 6f6e 7320 3d20 2265 7861 6374 222c  tions = "exact",
-00007100: 0a20 2020 2064 6174 6173 6574 5f6a 6f69  .    dataset_joi
-00007110: 6e3a 2073 7472 203d 2022 6578 6163 7422  n: str = "exact"
-00007120: 2c0a 2020 2020 6461 7461 7365 745f 6669  ,.    dataset_fi
-00007130: 6c6c 5f76 616c 7565 3a20 6f62 6a65 6374  ll_value: object
-00007140: 203d 205f 4e4f 5f46 494c 4c5f 5641 4c55   = _NO_FILL_VALU
-00007150: 452c 0a20 2020 206b 6565 705f 6174 7472  E,.    keep_attr
-00007160: 733a 2062 6f6f 6c20 7c20 7374 7220 7c20  s: bool | str | 
-00007170: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00007180: 206b 7761 7267 733a 204d 6170 7069 6e67   kwargs: Mapping
-00007190: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-000071a0: 2020 2020 6461 736b 3a20 7374 7220 3d20      dask: str = 
-000071b0: 2266 6f72 6269 6464 656e 222c 0a20 2020  "forbidden",.   
-000071c0: 206f 7574 7075 745f 6474 7970 6573 3a20   output_dtypes: 
-000071d0: 5365 7175 656e 6365 207c 204e 6f6e 6520  Sequence | None 
-000071e0: 3d20 4e6f 6e65 2c0a 2020 2020 6f75 7470  = None,.    outp
-000071f0: 7574 5f73 697a 6573 3a20 4d61 7070 696e  ut_sizes: Mappin
-00007200: 675b 416e 792c 2069 6e74 5d20 7c20 4e6f  g[Any, int] | No
-00007210: 6e65 203d 204e 6f6e 652c 0a20 2020 206d  ne = None,.    m
-00007220: 6574 613a 2041 6e79 203d 204e 6f6e 652c  eta: Any = None,
-00007230: 0a20 2020 2064 6173 6b5f 6775 6675 6e63  .    dask_gufunc
-00007240: 5f6b 7761 7267 733a 2064 6963 745b 7374  _kwargs: dict[st
-00007250: 722c 2041 6e79 5d20 7c20 4e6f 6e65 203d  r, Any] | None =
-00007260: 204e 6f6e 652c 0a29 202d 3e20 416e 793a   None,.) -> Any:
-00007270: 0a20 2020 2022 2222 4170 706c 7920 6120  .    """Apply a 
-00007280: 7665 6374 6f72 697a 6564 2066 756e 6374  vectorized funct
-00007290: 696f 6e20 666f 7220 756e 6c61 6265 6c65  ion for unlabele
-000072a0: 6420 6172 7261 7973 206f 6e20 7861 7272  d arrays on xarr
-000072b0: 6179 206f 626a 6563 7473 2e0a 0a20 2020  ay objects...   
-000072c0: 2054 6865 2066 756e 6374 696f 6e20 7769   The function wi
-000072d0: 6c6c 2062 6520 6d61 7070 6564 206f 7665  ll be mapped ove
-000072e0: 7220 7468 6520 6461 7461 2076 6172 6961  r the data varia
-000072f0: 626c 6528 7329 206f 6620 7468 6520 696e  ble(s) of the in
-00007300: 7075 740a 2020 2020 6172 6775 6d65 6e74  put.    argument
-00007310: 7320 7573 696e 6720 7861 7272 6179 2773  s using xarray's
-00007320: 2073 7461 6e64 6172 6420 7275 6c65 7320   standard rules 
-00007330: 666f 7220 6c61 6265 6c65 6420 636f 6d70  for labeled comp
-00007340: 7574 6174 696f 6e2c 2069 6e63 6c75 6469  utation, includi
-00007350: 6e67 0a20 2020 2061 6c69 676e 6d65 6e74  ng.    alignment
-00007360: 2c20 6272 6f61 6463 6173 7469 6e67 2c20  , broadcasting, 
-00007370: 6c6f 6f70 696e 6720 6f76 6572 2047 726f  looping over Gro
-00007380: 7570 4279 2f44 6174 6173 6574 2076 6172  upBy/Dataset var
-00007390: 6961 626c 6573 2c20 616e 640a 2020 2020  iables, and.    
-000073a0: 6d65 7267 696e 6720 6f66 2063 6f6f 7264  merging of coord
-000073b0: 696e 6174 6573 2e0a 0a20 2020 2050 6172  inates...    Par
-000073c0: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-000073d0: 2d2d 2d2d 2d2d 0a20 2020 2066 756e 6320  ------.    func 
-000073e0: 3a20 6361 6c6c 6162 6c65 0a20 2020 2020  : callable.     
-000073f0: 2020 2046 756e 6374 696f 6e20 746f 2063     Function to c
-00007400: 616c 6c20 6c69 6b65 2060 6066 756e 6328  all like ``func(
-00007410: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-00007420: 6060 206f 6e20 756e 6c61 6265 6c65 6420  `` on unlabeled 
-00007430: 6172 7261 7973 0a20 2020 2020 2020 2028  arrays.        (
-00007440: 6060 2e64 6174 6160 6029 2074 6861 7420  ``.data``) that 
-00007450: 7265 7475 726e 7320 616e 2061 7272 6179  returns an array
-00007460: 206f 7220 7475 706c 6520 6f66 2061 7272   or tuple of arr
-00007470: 6179 732e 2049 6620 6d75 6c74 6970 6c65  ays. If multiple
-00007480: 0a20 2020 2020 2020 2061 7267 756d 656e  .        argumen
-00007490: 7473 2077 6974 6820 6e6f 6e2d 6d61 7463  ts with non-matc
-000074a0: 6869 6e67 2064 696d 656e 7369 6f6e 7320  hing dimensions 
-000074b0: 6172 6520 7375 7070 6c69 6564 2c20 7468  are supplied, th
-000074c0: 6973 2066 756e 6374 696f 6e20 6973 0a20  is function is. 
-000074d0: 2020 2020 2020 2065 7870 6563 7465 6420         expected 
-000074e0: 746f 2076 6563 746f 7269 7a65 2028 6272  to vectorize (br
-000074f0: 6f61 6463 6173 7429 206f 7665 7220 6178  oadcast) over ax
-00007500: 6573 206f 6620 706f 7369 7469 6f6e 616c  es of positional
-00007510: 2061 7267 756d 656e 7473 2069 6e0a 2020   arguments in.  
-00007520: 2020 2020 2020 7468 6520 7374 796c 6520        the style 
-00007530: 6f66 204e 756d 5079 2075 6e69 7665 7273  of NumPy univers
-00007540: 616c 2066 756e 6374 696f 6e73 205b 315d  al functions [1]
-00007550: 5f20 2869 6620 7468 6973 2069 7320 6e6f  _ (if this is no
-00007560: 7420 7468 6520 6361 7365 2c0a 2020 2020  t the case,.    
-00007570: 2020 2020 7365 7420 6060 7665 6374 6f72      set ``vector
-00007580: 697a 653d 5472 7565 6060 292e 2049 6620  ize=True``). If 
-00007590: 7468 6973 2066 756e 6374 696f 6e20 7265  this function re
-000075a0: 7475 726e 7320 6d75 6c74 6970 6c65 206f  turns multiple o
-000075b0: 7574 7075 7473 2c20 796f 750a 2020 2020  utputs, you.    
-000075c0: 2020 2020 6d75 7374 2073 6574 2060 606f      must set ``o
-000075d0: 7574 7075 745f 636f 7265 5f64 696d 7360  utput_core_dims`
-000075e0: 6020 6173 2077 656c 6c2e 0a20 2020 202a  ` as well..    *
-000075f0: 6172 6773 203a 2044 6174 6173 6574 2c20  args : Dataset, 
-00007600: 4461 7461 4172 7261 792c 2044 6174 6141  DataArray, DataA
-00007610: 7272 6179 4772 6f75 7042 792c 2044 6174  rrayGroupBy, Dat
-00007620: 6173 6574 4772 6f75 7042 792c 2056 6172  asetGroupBy, Var
-00007630: 6961 626c 652c 205c 0a20 2020 2020 2020  iable, \.       
-00007640: 206e 756d 7079 2e6e 6461 7272 6179 2c20   numpy.ndarray, 
-00007650: 6461 736b 2e61 7272 6179 2e41 7272 6179  dask.array.Array
-00007660: 206f 7220 7363 616c 6172 0a20 2020 2020   or scalar.     
-00007670: 2020 204d 6978 206f 6620 6c61 6265 6c65     Mix of labele
-00007680: 6420 616e 642f 6f72 2075 6e6c 6162 656c  d and/or unlabel
-00007690: 6564 2061 7272 6179 7320 746f 2077 6869  ed arrays to whi
-000076a0: 6368 2074 6f20 6170 706c 7920 7468 6520  ch to apply the 
-000076b0: 6675 6e63 7469 6f6e 2e0a 2020 2020 696e  function..    in
-000076c0: 7075 745f 636f 7265 5f64 696d 7320 3a20  put_core_dims : 
-000076d0: 7365 7175 656e 6365 206f 6620 7365 7175  sequence of sequ
-000076e0: 656e 6365 2c20 6f70 7469 6f6e 616c 0a20  ence, optional. 
-000076f0: 2020 2020 2020 204c 6973 7420 6f66 2074         List of t
-00007700: 6865 2073 616d 6520 6c65 6e67 7468 2061  he same length a
-00007710: 7320 6060 6172 6773 6060 2067 6976 696e  s ``args`` givin
-00007720: 6720 7468 6520 6c69 7374 206f 6620 636f  g the list of co
-00007730: 7265 2064 696d 656e 7369 6f6e 730a 2020  re dimensions.  
-00007740: 2020 2020 2020 6f6e 2065 6163 6820 696e        on each in
-00007750: 7075 7420 6172 6775 6d65 6e74 2074 6861  put argument tha
-00007760: 7420 7368 6f75 6c64 206e 6f74 2062 6520  t should not be 
-00007770: 6272 6f61 6463 6173 742e 2042 7920 6465  broadcast. By de
-00007780: 6661 756c 742c 2077 650a 2020 2020 2020  fault, we.      
-00007790: 2020 6173 7375 6d65 2074 6865 7265 2061    assume there a
-000077a0: 7265 206e 6f20 636f 7265 2064 696d 656e  re no core dimen
-000077b0: 7369 6f6e 7320 6f6e 2061 6e79 2069 6e70  sions on any inp
-000077c0: 7574 2061 7267 756d 656e 7473 2e0a 0a20  ut arguments... 
-000077d0: 2020 2020 2020 2046 6f72 2065 7861 6d70         For examp
-000077e0: 6c65 2c20 6060 696e 7075 745f 636f 7265  le, ``input_core
-000077f0: 5f64 696d 733d 5b5b 5d2c 205b 2774 696d  _dims=[[], ['tim
-00007800: 6527 5d5d 6060 2069 6e64 6963 6174 6573  e']]`` indicates
-00007810: 2074 6861 7420 616c 6c0a 2020 2020 2020   that all.      
-00007820: 2020 6469 6d65 6e73 696f 6e73 206f 6e20    dimensions on 
-00007830: 7468 6520 6669 7273 7420 6172 6775 6d65  the first argume
-00007840: 6e74 2061 6e64 2061 6c6c 2064 696d 656e  nt and all dimen
-00007850: 7369 6f6e 7320 6f74 6865 7220 7468 616e  sions other than
-00007860: 2027 7469 6d65 270a 2020 2020 2020 2020   'time'.        
-00007870: 6f6e 2074 6865 2073 6563 6f6e 6420 6172  on the second ar
-00007880: 6775 6d65 6e74 2073 686f 756c 6420 6265  gument should be
-00007890: 2062 726f 6164 6361 7374 2e0a 0a20 2020   broadcast...   
-000078a0: 2020 2020 2043 6f72 6520 6469 6d65 6e73       Core dimens
-000078b0: 696f 6e73 2061 7265 2061 7574 6f6d 6174  ions are automat
-000078c0: 6963 616c 6c79 206d 6f76 6564 2074 6f20  ically moved to 
-000078d0: 7468 6520 6c61 7374 2061 7865 7320 6f66  the last axes of
-000078e0: 2069 6e70 7574 0a20 2020 2020 2020 2076   input.        v
-000078f0: 6172 6961 626c 6573 2062 6566 6f72 6520  ariables before 
-00007900: 6170 706c 7969 6e67 2060 6066 756e 6360  applying ``func`
-00007910: 602c 2077 6869 6368 2066 6163 696c 6974  `, which facilit
-00007920: 6174 6573 2075 7369 6e67 204e 756d 5079  ates using NumPy
-00007930: 2073 7479 6c65 0a20 2020 2020 2020 2067   style.        g
-00007940: 656e 6572 616c 697a 6564 2075 6675 6e63  eneralized ufunc
-00007950: 7320 5b32 5d5f 2e0a 2020 2020 6f75 7470  s [2]_..    outp
-00007960: 7574 5f63 6f72 655f 6469 6d73 203a 206c  ut_core_dims : l
-00007970: 6973 7420 6f66 2074 7570 6c65 2c20 6f70  ist of tuple, op
-00007980: 7469 6f6e 616c 0a20 2020 2020 2020 204c  tional.        L
-00007990: 6973 7420 6f66 2074 6865 2073 616d 6520  ist of the same 
-000079a0: 6c65 6e67 7468 2061 7320 7468 6520 6e75  length as the nu
-000079b0: 6d62 6572 206f 6620 6f75 7470 7574 2061  mber of output a
-000079c0: 7267 756d 656e 7473 2066 726f 6d0a 2020  rguments from.  
-000079d0: 2020 2020 2020 6060 6675 6e63 6060 2c20        ``func``, 
-000079e0: 6769 7669 6e67 2074 6865 206c 6973 7420  giving the list 
-000079f0: 6f66 2063 6f72 6520 6469 6d65 6e73 696f  of core dimensio
-00007a00: 6e73 206f 6e20 6561 6368 206f 7574 7075  ns on each outpu
-00007a10: 7420 7468 6174 2077 6572 650a 2020 2020  t that were.    
-00007a20: 2020 2020 6e6f 7420 6272 6f61 6463 6173      not broadcas
-00007a30: 7420 6f6e 2074 6865 2069 6e70 7574 732e  t on the inputs.
-00007a40: 2042 7920 6465 6661 756c 742c 2077 6520   By default, we 
-00007a50: 6173 7375 6d65 2074 6861 7420 6060 6675  assume that ``fu
-00007a60: 6e63 6060 0a20 2020 2020 2020 206f 7574  nc``.        out
-00007a70: 7075 7473 2065 7861 6374 6c79 206f 6e65  puts exactly one
-00007a80: 2061 7272 6179 2c20 7769 7468 2061 7865   array, with axe
-00007a90: 7320 636f 7272 6573 706f 6e64 696e 6720  s corresponding 
-00007aa0: 746f 2065 6163 6820 6272 6f61 6463 6173  to each broadcas
-00007ab0: 740a 2020 2020 2020 2020 6469 6d65 6e73  t.        dimens
-00007ac0: 696f 6e2e 0a0a 2020 2020 2020 2020 436f  ion...        Co
-00007ad0: 7265 2064 696d 656e 7369 6f6e 7320 6172  re dimensions ar
-00007ae0: 6520 6173 7375 6d65 6420 746f 2061 7070  e assumed to app
-00007af0: 6561 7220 6173 2074 6865 206c 6173 7420  ear as the last 
-00007b00: 6469 6d65 6e73 696f 6e73 206f 6620 6561  dimensions of ea
-00007b10: 6368 0a20 2020 2020 2020 206f 7574 7075  ch.        outpu
-00007b20: 7420 696e 2074 6865 2070 726f 7669 6465  t in the provide
-00007b30: 6420 6f72 6465 722e 0a20 2020 2065 7863  d order..    exc
-00007b40: 6c75 6465 5f64 696d 7320 3a20 7365 742c  lude_dims : set,
-00007b50: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00007b60: 2020 436f 7265 2064 696d 656e 7369 6f6e    Core dimension
-00007b70: 7320 6f6e 2074 6865 2069 6e70 7574 7320  s on the inputs 
-00007b80: 746f 2065 7863 6c75 6465 2066 726f 6d20  to exclude from 
-00007b90: 616c 6967 6e6d 656e 7420 616e 640a 2020  alignment and.  
-00007ba0: 2020 2020 2020 6272 6f61 6463 6173 7469        broadcasti
-00007bb0: 6e67 2065 6e74 6972 656c 792e 2041 6e79  ng entirely. Any
-00007bc0: 2069 6e70 7574 2063 6f6f 7264 696e 6174   input coordinat
-00007bd0: 6573 2061 6c6f 6e67 2074 6865 7365 2064  es along these d
-00007be0: 696d 656e 7369 6f6e 730a 2020 2020 2020  imensions.      
-00007bf0: 2020 7769 6c6c 2062 6520 6472 6f70 7065    will be droppe
-00007c00: 642e 2045 6163 6820 6578 636c 7564 6564  d. Each excluded
-00007c10: 2064 696d 656e 7369 6f6e 206d 7573 7420   dimension must 
-00007c20: 616c 736f 2061 7070 6561 7220 696e 0a20  also appear in. 
-00007c30: 2020 2020 2020 2060 6069 6e70 7574 5f63         ``input_c
-00007c40: 6f72 655f 6469 6d73 6060 2066 6f72 2061  ore_dims`` for a
-00007c50: 7420 6c65 6173 7420 6f6e 6520 6172 6775  t least one argu
-00007c60: 6d65 6e74 2e20 4f6e 6c79 2064 696d 656e  ment. Only dimen
-00007c70: 7369 6f6e 7320 6c69 7374 6564 0a20 2020  sions listed.   
-00007c80: 2020 2020 2068 6572 6520 6172 6520 616c       here are al
-00007c90: 6c6f 7765 6420 746f 2063 6861 6e67 6520  lowed to change 
-00007ca0: 7369 7a65 2062 6574 7765 656e 2069 6e70  size between inp
-00007cb0: 7574 2061 6e64 206f 7574 7075 7420 6f62  ut and output ob
-00007cc0: 6a65 6374 732e 0a20 2020 2076 6563 746f  jects..    vecto
-00007cd0: 7269 7a65 203a 2062 6f6f 6c2c 206f 7074  rize : bool, opt
-00007ce0: 696f 6e61 6c0a 2020 2020 2020 2020 4966  ional.        If
-00007cf0: 2054 7275 652c 2074 6865 6e20 6173 7375   True, then assu
-00007d00: 6d65 2060 6066 756e 6360 6020 6f6e 6c79  me ``func`` only
-00007d10: 2074 616b 6573 2061 7272 6179 7320 6465   takes arrays de
-00007d20: 6669 6e65 6420 6f76 6572 2063 6f72 650a  fined over core.
-00007d30: 2020 2020 2020 2020 6469 6d65 6e73 696f          dimensio
-00007d40: 6e73 2061 7320 696e 7075 7420 616e 6420  ns as input and 
-00007d50: 7665 6374 6f72 697a 6520 6974 2061 7574  vectorize it aut
-00007d60: 6f6d 6174 6963 616c 6c79 2077 6974 680a  omatically with.
-00007d70: 2020 2020 2020 2020 3a70 793a 6675 6e63          :py:func
-00007d80: 3a60 6e75 6d70 792e 7665 6374 6f72 697a  :`numpy.vectoriz
-00007d90: 6560 2e20 5468 6973 206f 7074 696f 6e20  e`. This option 
-00007da0: 6578 6973 7473 2066 6f72 2063 6f6e 7665  exists for conve
-00007db0: 6e69 656e 6365 2c20 6275 7420 6973 0a20  nience, but is. 
-00007dc0: 2020 2020 2020 2061 6c6d 6f73 7420 616c         almost al
-00007dd0: 7761 7973 2073 6c6f 7765 7220 7468 616e  ways slower than
-00007de0: 2073 7570 706c 7969 6e67 2061 2070 7265   supplying a pre
-00007df0: 2d76 6563 746f 7269 7a65 6420 6675 6e63  -vectorized func
-00007e00: 7469 6f6e 2e0a 2020 2020 6a6f 696e 203a  tion..    join :
-00007e10: 207b 226f 7574 6572 222c 2022 696e 6e65   {"outer", "inne
-00007e20: 7222 2c20 226c 6566 7422 2c20 2272 6967  r", "left", "rig
-00007e30: 6874 222c 2022 6578 6163 7422 7d2c 2064  ht", "exact"}, d
-00007e40: 6566 6175 6c74 3a20 2265 7861 6374 220a  efault: "exact".
-00007e50: 2020 2020 2020 2020 4d65 7468 6f64 2066          Method f
-00007e60: 6f72 206a 6f69 6e69 6e67 2074 6865 2069  or joining the i
-00007e70: 6e64 6578 6573 206f 6620 7468 6520 7061  ndexes of the pa
-00007e80: 7373 6564 206f 626a 6563 7473 2061 6c6f  ssed objects alo
-00007e90: 6e67 2065 6163 680a 2020 2020 2020 2020  ng each.        
-00007ea0: 6469 6d65 6e73 696f 6e2c 2061 6e64 2074  dimension, and t
-00007eb0: 6865 2076 6172 6961 626c 6573 206f 6620  he variables of 
-00007ec0: 4461 7461 7365 7420 6f62 6a65 6374 7320  Dataset objects 
-00007ed0: 7769 7468 206d 6973 6d61 7463 6865 640a  with mismatched.
-00007ee0: 2020 2020 2020 2020 6461 7461 2076 6172          data var
-00007ef0: 6961 626c 6573 3a0a 0a20 2020 2020 2020  iables:..       
-00007f00: 202d 2027 6f75 7465 7227 3a20 7573 6520   - 'outer': use 
-00007f10: 7468 6520 756e 696f 6e20 6f66 206f 626a  the union of obj
-00007f20: 6563 7420 696e 6465 7865 730a 2020 2020  ect indexes.    
-00007f30: 2020 2020 2d20 2769 6e6e 6572 273a 2075      - 'inner': u
-00007f40: 7365 2074 6865 2069 6e74 6572 7365 6374  se the intersect
-00007f50: 696f 6e20 6f66 206f 626a 6563 7420 696e  ion of object in
-00007f60: 6465 7865 730a 2020 2020 2020 2020 2d20  dexes.        - 
-00007f70: 276c 6566 7427 3a20 7573 6520 696e 6465  'left': use inde
-00007f80: 7865 7320 6672 6f6d 2074 6865 2066 6972  xes from the fir
-00007f90: 7374 206f 626a 6563 7420 7769 7468 2065  st object with e
-00007fa0: 6163 6820 6469 6d65 6e73 696f 6e0a 2020  ach dimension.  
-00007fb0: 2020 2020 2020 2d20 2772 6967 6874 273a        - 'right':
-00007fc0: 2075 7365 2069 6e64 6578 6573 2066 726f   use indexes fro
-00007fd0: 6d20 7468 6520 6c61 7374 206f 626a 6563  m the last objec
-00007fe0: 7420 7769 7468 2065 6163 6820 6469 6d65  t with each dime
-00007ff0: 6e73 696f 6e0a 2020 2020 2020 2020 2d20  nsion.        - 
-00008000: 2765 7861 6374 273a 2072 6169 7365 2060  'exact': raise `
-00008010: 5661 6c75 6545 7272 6f72 6020 696e 7374  ValueError` inst
-00008020: 6561 6420 6f66 2061 6c69 676e 696e 6720  ead of aligning 
-00008030: 7768 656e 2069 6e64 6578 6573 2074 6f20  when indexes to 
-00008040: 6265 0a20 2020 2020 2020 2020 2061 6c69  be.          ali
-00008050: 676e 6564 2061 7265 206e 6f74 2065 7175  gned are not equ
-00008060: 616c 0a20 2020 2064 6174 6173 6574 5f6a  al.    dataset_j
-00008070: 6f69 6e20 3a20 7b22 6f75 7465 7222 2c20  oin : {"outer", 
-00008080: 2269 6e6e 6572 222c 2022 6c65 6674 222c  "inner", "left",
-00008090: 2022 7269 6768 7422 2c20 2265 7861 6374   "right", "exact
-000080a0: 227d 2c20 6465 6661 756c 743a 2022 6578  "}, default: "ex
-000080b0: 6163 7422 0a20 2020 2020 2020 204d 6574  act".        Met
-000080c0: 686f 6420 666f 7220 6a6f 696e 696e 6720  hod for joining 
-000080d0: 7661 7269 6162 6c65 7320 6f66 2044 6174  variables of Dat
-000080e0: 6173 6574 206f 626a 6563 7473 2077 6974  aset objects wit
-000080f0: 6820 6d69 736d 6174 6368 6564 0a20 2020  h mismatched.   
-00008100: 2020 2020 2064 6174 6120 7661 7269 6162       data variab
-00008110: 6c65 732e 0a0a 2020 2020 2020 2020 2d20  les...        - 
-00008120: 276f 7574 6572 273a 2074 616b 6520 7661  'outer': take va
-00008130: 7269 6162 6c65 7320 6672 6f6d 2062 6f74  riables from bot
-00008140: 6820 4461 7461 7365 7420 6f62 6a65 6374  h Dataset object
-00008150: 730a 2020 2020 2020 2020 2d20 2769 6e6e  s.        - 'inn
-00008160: 6572 273a 2074 616b 6520 6f6e 6c79 206f  er': take only o
-00008170: 7665 726c 6170 7065 6420 7661 7269 6162  verlapped variab
-00008180: 6c65 730a 2020 2020 2020 2020 2d20 276c  les.        - 'l
-00008190: 6566 7427 3a20 7461 6b65 206f 6e6c 7920  eft': take only 
-000081a0: 7661 7269 6162 6c65 7320 6672 6f6d 2074  variables from t
-000081b0: 6865 2066 6972 7374 206f 626a 6563 740a  he first object.
-000081c0: 2020 2020 2020 2020 2d20 2772 6967 6874          - 'right
-000081d0: 273a 2074 616b 6520 6f6e 6c79 2076 6172  ': take only var
-000081e0: 6961 626c 6573 2066 726f 6d20 7468 6520  iables from the 
-000081f0: 6c61 7374 206f 626a 6563 740a 2020 2020  last object.    
-00008200: 2020 2020 2d20 2765 7861 6374 273a 2064      - 'exact': d
-00008210: 6174 6120 7661 7269 6162 6c65 7320 6f6e  ata variables on
-00008220: 2061 6c6c 2044 6174 6173 6574 206f 626a   all Dataset obj
-00008230: 6563 7473 206d 7573 7420 6d61 7463 6820  ects must match 
-00008240: 6578 6163 746c 790a 2020 2020 6461 7461  exactly.    data
-00008250: 7365 745f 6669 6c6c 5f76 616c 7565 203a  set_fill_value :
-00008260: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00008270: 2020 5661 6c75 6520 7573 6564 2069 6e20    Value used in 
-00008280: 706c 6163 6520 6f66 206d 6973 7369 6e67  place of missing
-00008290: 2076 6172 6961 626c 6573 206f 6e20 4461   variables on Da
-000082a0: 7461 7365 7420 696e 7075 7473 2077 6865  taset inputs whe
-000082b0: 6e20 7468 650a 2020 2020 2020 2020 6461  n the.        da
-000082c0: 7461 7365 7473 2064 6f20 6e6f 7420 7368  tasets do not sh
-000082d0: 6172 6520 7468 6520 6578 6163 7420 7361  are the exact sa
-000082e0: 6d65 2060 6064 6174 615f 7661 7273 6060  me ``data_vars``
-000082f0: 2e20 5265 7175 6972 6564 2069 660a 2020  . Required if.  
-00008300: 2020 2020 2020 6060 6461 7461 7365 745f        ``dataset_
-00008310: 6a6f 696e 206e 6f74 2069 6e20 7b27 696e  join not in {'in
-00008320: 6e65 7227 2c20 2765 7861 6374 277d 6060  ner', 'exact'}``
-00008330: 2c20 6f74 6865 7277 6973 6520 6967 6e6f  , otherwise igno
-00008340: 7265 642e 0a20 2020 206b 6565 705f 6174  red..    keep_at
-00008350: 7472 7320 3a20 7b22 6472 6f70 222c 2022  trs : {"drop", "
-00008360: 6964 656e 7469 6361 6c22 2c20 226e 6f5f  identical", "no_
-00008370: 636f 6e66 6c69 6374 7322 2c20 2264 726f  conflicts", "dro
-00008380: 705f 636f 6e66 6c69 6374 7322 2c20 226f  p_conflicts", "o
-00008390: 7665 7272 6964 6522 7d20 6f72 2062 6f6f  verride"} or boo
-000083a0: 6c2c 206f 7074 696f 6e61 6c0a 2020 2020  l, optional.    
-000083b0: 2020 2020 2d20 2764 726f 7027 206f 7220      - 'drop' or 
-000083c0: 4661 6c73 653a 2065 6d70 7479 2061 7474  False: empty att
-000083d0: 7273 206f 6e20 7265 7475 726e 6564 2078  rs on returned x
-000083e0: 6172 7261 7920 6f62 6a65 6374 2e0a 2020  array object..  
-000083f0: 2020 2020 2020 2d20 2769 6465 6e74 6963        - 'identic
-00008400: 616c 273a 2061 6c6c 2061 7474 7273 206d  al': all attrs m
-00008410: 7573 7420 6265 2074 6865 2073 616d 6520  ust be the same 
-00008420: 6f6e 2065 7665 7279 206f 626a 6563 742e  on every object.
-00008430: 0a20 2020 2020 2020 202d 2027 6e6f 5f63  .        - 'no_c
-00008440: 6f6e 666c 6963 7473 273a 2061 7474 7273  onflicts': attrs
-00008450: 2066 726f 6d20 616c 6c20 6f62 6a65 6374   from all object
-00008460: 7320 6172 6520 636f 6d62 696e 6564 2c20  s are combined, 
-00008470: 616e 7920 7468 6174 2068 6176 6520 7468  any that have th
-00008480: 6520 7361 6d65 206e 616d 6520 6d75 7374  e same name must
-00008490: 2061 6c73 6f20 6861 7665 2074 6865 2073   also have the s
-000084a0: 616d 6520 7661 6c75 652e 0a20 2020 2020  ame value..     
-000084b0: 2020 202d 2027 6472 6f70 5f63 6f6e 666c     - 'drop_confl
-000084c0: 6963 7473 273a 2061 7474 7273 2066 726f  icts': attrs fro
-000084d0: 6d20 616c 6c20 6f62 6a65 6374 7320 6172  m all objects ar
-000084e0: 6520 636f 6d62 696e 6564 2c20 616e 7920  e combined, any 
-000084f0: 7468 6174 2068 6176 6520 7468 6520 7361  that have the sa
-00008500: 6d65 206e 616d 6520 6275 7420 6469 6666  me name but diff
-00008510: 6572 656e 7420 7661 6c75 6573 2061 7265  erent values are
-00008520: 2064 726f 7070 6564 2e0a 2020 2020 2020   dropped..      
-00008530: 2020 2d20 276f 7665 7272 6964 6527 206f    - 'override' o
-00008540: 7220 5472 7565 3a20 736b 6970 2063 6f6d  r True: skip com
-00008550: 7061 7269 6e67 2061 6e64 2063 6f70 7920  paring and copy 
-00008560: 6174 7472 7320 6672 6f6d 2074 6865 2066  attrs from the f
-00008570: 6972 7374 206f 626a 6563 7420 746f 2074  irst object to t
-00008580: 6865 2072 6573 756c 742e 0a20 2020 206b  he result..    k
-00008590: 7761 7267 7320 3a20 6469 6374 2c20 6f70  wargs : dict, op
-000085a0: 7469 6f6e 616c 0a20 2020 2020 2020 204f  tional.        O
-000085b0: 7074 696f 6e61 6c20 6b65 7977 6f72 6420  ptional keyword 
-000085c0: 6172 6775 6d65 6e74 7320 7061 7373 6564  arguments passed
-000085d0: 2064 6972 6563 746c 7920 6f6e 2074 6f20   directly on to 
-000085e0: 6361 6c6c 2060 6066 756e 6360 602e 0a20  call ``func``.. 
-000085f0: 2020 2064 6173 6b20 3a20 7b22 666f 7262     dask : {"forb
-00008600: 6964 6465 6e22 2c20 2261 6c6c 6f77 6564  idden", "allowed
-00008610: 222c 2022 7061 7261 6c6c 656c 697a 6564  ", "parallelized
-00008620: 227d 2c20 6465 6661 756c 743a 2022 666f  "}, default: "fo
-00008630: 7262 6964 6465 6e22 0a20 2020 2020 2020  rbidden".       
-00008640: 2048 6f77 2074 6f20 6861 6e64 6c65 2061   How to handle a
-00008650: 7070 6c79 696e 6720 746f 206f 626a 6563  pplying to objec
-00008660: 7473 2063 6f6e 7461 696e 696e 6720 6c61  ts containing la
-00008670: 7a79 2064 6174 6120 696e 2074 6865 2066  zy data in the f
-00008680: 6f72 6d20 6f66 0a20 2020 2020 2020 2064  orm of.        d
-00008690: 6173 6b20 6172 7261 7973 3a0a 0a20 2020  ask arrays:..   
-000086a0: 2020 2020 202d 2027 666f 7262 6964 6465       - 'forbidde
-000086b0: 6e27 2028 6465 6661 756c 7429 3a20 7261  n' (default): ra
-000086c0: 6973 6520 616e 2065 7272 6f72 2069 6620  ise an error if 
-000086d0: 6120 6461 736b 2061 7272 6179 2069 7320  a dask array is 
-000086e0: 656e 636f 756e 7465 7265 642e 0a20 2020  encountered..   
-000086f0: 2020 2020 202d 2027 616c 6c6f 7765 6427       - 'allowed'
-00008700: 3a20 7061 7373 2064 6173 6b20 6172 7261  : pass dask arra
-00008710: 7973 2064 6972 6563 746c 7920 6f6e 2074  ys directly on t
-00008720: 6f20 6060 6675 6e63 6060 2e20 5072 6566  o ``func``. Pref
-00008730: 6572 2074 6869 7320 6f70 7469 6f6e 2069  er this option i
-00008740: 660a 2020 2020 2020 2020 2020 6060 6675  f.          ``fu
-00008750: 6e63 6060 206e 6174 6976 656c 7920 7375  nc`` natively su
-00008760: 7070 6f72 7473 2064 6173 6b20 6172 7261  pports dask arra
-00008770: 7973 2e0a 2020 2020 2020 2020 2d20 2770  ys..        - 'p
-00008780: 6172 616c 6c65 6c69 7a65 6427 3a20 6175  arallelized': au
-00008790: 746f 6d61 7469 6361 6c6c 7920 7061 7261  tomatically para
-000087a0: 6c6c 656c 697a 6520 6060 6675 6e63 6060  llelize ``func``
-000087b0: 2069 6620 616e 7920 6f66 2074 6865 0a20   if any of the. 
-000087c0: 2020 2020 2020 2020 2069 6e70 7574 7320           inputs 
-000087d0: 6172 6520 6120 6461 736b 2061 7272 6179  are a dask array
-000087e0: 2062 7920 7573 696e 6720 3a70 793a 6675   by using :py:fu
-000087f0: 6e63 3a60 6461 736b 2e61 7272 6179 2e61  nc:`dask.array.a
-00008800: 7070 6c79 5f67 7566 756e 6360 2e20 4d75  pply_gufunc`. Mu
-00008810: 6c74 6970 6c65 206f 7574 7075 740a 2020  ltiple output.  
-00008820: 2020 2020 2020 2020 6172 6775 6d65 6e74          argument
-00008830: 7320 6172 6520 7375 7070 6f72 7465 642e  s are supported.
-00008840: 204f 6e6c 7920 7573 6520 7468 6973 206f   Only use this o
-00008850: 7074 696f 6e20 6966 2060 6066 756e 6360  ption if ``func`
-00008860: 6020 646f 6573 206e 6f74 206e 6174 6976  ` does not nativ
-00008870: 656c 790a 2020 2020 2020 2020 2020 7375  ely.          su
-00008880: 7070 6f72 7420 6461 736b 2061 7272 6179  pport dask array
-00008890: 7320 2865 2e67 2e20 636f 6e76 6572 7473  s (e.g. converts
-000088a0: 2074 6865 6d20 746f 206e 756d 7079 2061   them to numpy a
-000088b0: 7272 6179 7329 2e0a 2020 2020 6461 736b  rrays)..    dask
-000088c0: 5f67 7566 756e 635f 6b77 6172 6773 203a  _gufunc_kwargs :
-000088d0: 2064 6963 742c 206f 7074 696f 6e61 6c0a   dict, optional.
-000088e0: 2020 2020 2020 2020 4f70 7469 6f6e 616c          Optional
-000088f0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-00008900: 7473 2070 6173 7365 6420 746f 203a 7079  ts passed to :py
-00008910: 3a66 756e 633a 6064 6173 6b2e 6172 7261  :func:`dask.arra
-00008920: 792e 6170 706c 795f 6775 6675 6e63 6020  y.apply_gufunc` 
-00008930: 6966 0a20 2020 2020 2020 2064 6173 6b3d  if.        dask=
-00008940: 2770 6172 616c 6c65 6c69 7a65 6427 2e20  'parallelized'. 
-00008950: 506f 7373 6962 6c65 206b 6579 776f 7264  Possible keyword
-00008960: 7320 6172 6520 6060 6f75 7470 7574 5f73  s are ``output_s
-00008970: 697a 6573 6060 2c20 6060 616c 6c6f 775f  izes``, ``allow_
-00008980: 7265 6368 756e 6b60 600a 2020 2020 2020  rechunk``.      
-00008990: 2020 616e 6420 6060 6d65 7461 6060 2e0a    and ``meta``..
-000089a0: 2020 2020 6f75 7470 7574 5f64 7479 7065      output_dtype
-000089b0: 7320 3a20 6c69 7374 206f 6620 6474 7970  s : list of dtyp
-000089c0: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
-000089d0: 2020 2020 4f70 7469 6f6e 616c 206c 6973      Optional lis
-000089e0: 7420 6f66 206f 7574 7075 7420 6474 7970  t of output dtyp
-000089f0: 6573 2e20 4f6e 6c79 2075 7365 6420 6966  es. Only used if
-00008a00: 2060 6064 6173 6b3d 2770 6172 616c 6c65   ``dask='paralle
-00008a10: 6c69 7a65 6427 6060 206f 720a 2020 2020  lized'`` or.    
-00008a20: 2020 2020 6060 7665 6374 6f72 697a 653d      ``vectorize=
-00008a30: 5472 7565 6060 2e0a 2020 2020 6f75 7470  True``..    outp
-00008a40: 7574 5f73 697a 6573 203a 2064 6963 742c  ut_sizes : dict,
-00008a50: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00008a60: 2020 4f70 7469 6f6e 616c 206d 6170 7069    Optional mappi
-00008a70: 6e67 2066 726f 6d20 6469 6d65 6e73 696f  ng from dimensio
-00008a80: 6e20 6e61 6d65 7320 746f 2073 697a 6573  n names to sizes
-00008a90: 2066 6f72 206f 7574 7075 7473 2e20 4f6e   for outputs. On
-00008aa0: 6c79 2075 7365 640a 2020 2020 2020 2020  ly used.        
-00008ab0: 6966 2064 6173 6b3d 2770 6172 616c 6c65  if dask='paralle
-00008ac0: 6c69 7a65 6427 2061 6e64 206e 6577 2064  lized' and new d
-00008ad0: 696d 656e 7369 6f6e 7320 286e 6f74 2066  imensions (not f
-00008ae0: 6f75 6e64 206f 6e20 696e 7075 7473 2920  ound on inputs) 
-00008af0: 6170 7065 6172 0a20 2020 2020 2020 206f  appear.        o
-00008b00: 6e20 6f75 7470 7574 732e 2060 606f 7574  n outputs. ``out
-00008b10: 7075 745f 7369 7a65 7360 6020 7368 6f75  put_sizes`` shou
-00008b20: 6c64 2062 6520 6769 7665 6e20 696e 2074  ld be given in t
-00008b30: 6865 2060 6064 6173 6b5f 6775 6675 6e63  he ``dask_gufunc
-00008b40: 5f6b 7761 7267 7360 600a 2020 2020 2020  _kwargs``.      
-00008b50: 2020 7061 7261 6d65 7465 722e 2049 7420    parameter. It 
-00008b60: 7769 6c6c 2062 6520 7265 6d6f 7665 6420  will be removed 
-00008b70: 6173 2064 6972 6563 7420 7061 7261 6d65  as direct parame
-00008b80: 7465 7220 696e 2061 2066 7574 7572 6520  ter in a future 
-00008b90: 7665 7273 696f 6e2e 0a20 2020 206d 6574  version..    met
-00008ba0: 6120 3a20 6f70 7469 6f6e 616c 0a20 2020  a : optional.   
-00008bb0: 2020 2020 2053 697a 652d 3020 6f62 6a65       Size-0 obje
-00008bc0: 6374 2072 6570 7265 7365 6e74 696e 6720  ct representing 
-00008bd0: 7468 6520 7479 7065 206f 6620 6172 7261  the type of arra
-00008be0: 7920 7772 6170 7065 6420 6279 2064 6173  y wrapped by das
-00008bf0: 6b20 6172 7261 792e 2050 6173 7365 6420  k array. Passed 
-00008c00: 6f6e 2074 6f0a 2020 2020 2020 2020 3a70  on to.        :p
-00008c10: 793a 6675 6e63 3a60 6461 736b 2e61 7272  y:func:`dask.arr
-00008c20: 6179 2e61 7070 6c79 5f67 7566 756e 6360  ay.apply_gufunc`
-00008c30: 2e20 6060 6d65 7461 6060 2073 686f 756c  . ``meta`` shoul
-00008c40: 6420 6265 2067 6976 656e 2069 6e20 7468  d be given in th
-00008c50: 650a 2020 2020 2020 2020 6060 6461 736b  e.        ``dask
-00008c60: 5f67 7566 756e 635f 6b77 6172 6773 6060  _gufunc_kwargs``
-00008c70: 2070 6172 616d 6574 6572 202e 2049 7420   parameter . It 
-00008c80: 7769 6c6c 2062 6520 7265 6d6f 7665 6420  will be removed 
-00008c90: 6173 2064 6972 6563 7420 7061 7261 6d65  as direct parame
-00008ca0: 7465 720a 2020 2020 2020 2020 6120 6675  ter.        a fu
-00008cb0: 7475 7265 2076 6572 7369 6f6e 2e0a 0a20  ture version... 
-00008cc0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-00008cd0: 2d2d 2d2d 2d2d 0a20 2020 2053 696e 676c  ------.    Singl
-00008ce0: 6520 7661 6c75 6520 6f72 2074 7570 6c65  e value or tuple
-00008cf0: 206f 6620 4461 7461 7365 742c 2044 6174   of Dataset, Dat
-00008d00: 6141 7272 6179 2c20 5661 7269 6162 6c65  aArray, Variable
-00008d10: 2c20 6461 736b 2e61 7272 6179 2e41 7272  , dask.array.Arr
-00008d20: 6179 206f 720a 2020 2020 6e75 6d70 792e  ay or.    numpy.
-00008d30: 6e64 6172 7261 792c 2074 6865 2066 6972  ndarray, the fir
-00008d40: 7374 2074 7970 6520 6f6e 2074 6861 7420  st type on that 
-00008d50: 6c69 7374 2074 6f20 6170 7065 6172 206f  list to appear o
-00008d60: 6e20 616e 2069 6e70 7574 2e0a 0a20 2020  n an input...   
-00008d70: 204e 6f74 6573 0a20 2020 202d 2d2d 2d2d   Notes.    -----
-00008d80: 0a20 2020 2054 6869 7320 6675 6e63 7469  .    This functi
-00008d90: 6f6e 2069 7320 6465 7369 676e 6564 2066  on is designed f
-00008da0: 6f72 2074 6865 206d 6f72 6520 636f 6d6d  or the more comm
-00008db0: 6f6e 2063 6173 6520 7768 6572 6520 6060  on case where ``
-00008dc0: 6675 6e63 6060 2063 616e 2077 6f72 6b20  func`` can work 
-00008dd0: 6f6e 206e 756d 7079 0a20 2020 2061 7272  on numpy.    arr
-00008de0: 6179 732e 2049 6620 6060 6675 6e63 6060  ays. If ``func``
-00008df0: 206e 6565 6473 2074 6f20 6d61 6e69 7075   needs to manipu
-00008e00: 6c61 7465 2061 2077 686f 6c65 2078 6172  late a whole xar
-00008e10: 7261 7920 6f62 6a65 6374 2073 7562 7365  ray object subse
-00008e20: 7420 746f 2065 6163 6820 626c 6f63 6b0a  t to each block.
-00008e30: 2020 2020 6974 2069 7320 706f 7373 6962      it is possib
-00008e40: 6c65 2074 6f20 7573 6520 3a70 793a 6675  le to use :py:fu
-00008e50: 6e63 3a60 7861 7272 6179 2e6d 6170 5f62  nc:`xarray.map_b
-00008e60: 6c6f 636b 7360 2e0a 0a20 2020 204e 6f74  locks`...    Not
-00008e70: 6520 7468 6174 2064 7565 2074 6f20 7468  e that due to th
-00008e80: 6520 6f76 6572 6865 6164 203a 7079 3a66  e overhead :py:f
-00008e90: 756e 633a 6078 6172 7261 792e 6d61 705f  unc:`xarray.map_
-00008ea0: 626c 6f63 6b73 6020 6973 2063 6f6e 7369  blocks` is consi
-00008eb0: 6465 7261 626c 7920 736c 6f77 6572 2074  derably slower t
-00008ec0: 6861 6e20 6060 6170 706c 795f 7566 756e  han ``apply_ufun
-00008ed0: 6360 602e 0a0a 2020 2020 4578 616d 706c  c``...    Exampl
-00008ee0: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
-00008ef0: 2020 2020 4361 6c63 756c 6174 6520 7468      Calculate th
-00008f00: 6520 7665 6374 6f72 206d 6167 6e69 7475  e vector magnitu
-00008f10: 6465 206f 6620 7477 6f20 6172 6775 6d65  de of two argume
-00008f20: 6e74 733a 0a0a 2020 2020 3e3e 3e20 6465  nts:..    >>> de
-00008f30: 6620 6d61 676e 6974 7564 6528 612c 2062  f magnitude(a, b
-00008f40: 293a 0a20 2020 202e 2e2e 2020 2020 2066  ):.    ...     f
-00008f50: 756e 6320 3d20 6c61 6d62 6461 2078 2c20  unc = lambda x, 
-00008f60: 793a 206e 702e 7371 7274 2878 2a2a 3220  y: np.sqrt(x**2 
-00008f70: 2b20 792a 2a32 290a 2020 2020 2e2e 2e20  + y**2).    ... 
-00008f80: 2020 2020 7265 7475 726e 2078 722e 6170      return xr.ap
-00008f90: 706c 795f 7566 756e 6328 6675 6e63 2c20  ply_ufunc(func, 
-00008fa0: 612c 2062 290a 2020 2020 2e2e 2e0a 0a20  a, b).    ..... 
-00008fb0: 2020 2059 6f75 2063 616e 206e 6f77 2061     You can now a
-00008fc0: 7070 6c79 2060 606d 6167 6e69 7475 6465  pply ``magnitude
-00008fd0: 2829 6060 2074 6f20 3a70 793a 636c 6173  ()`` to :py:clas
-00008fe0: 733a 6044 6174 6141 7272 6179 6020 616e  s:`DataArray` an
-00008ff0: 6420 3a70 793a 636c 6173 733a 6044 6174  d :py:class:`Dat
-00009000: 6173 6574 600a 2020 2020 6f62 6a65 6374  aset`.    object
-00009010: 732c 2077 6974 6820 6175 746f 6d61 7469  s, with automati
-00009020: 6361 6c6c 7920 7072 6573 6572 7665 6420  cally preserved 
-00009030: 6469 6d65 6e73 696f 6e73 2061 6e64 2063  dimensions and c
-00009040: 6f6f 7264 696e 6174 6573 2c20 652e 672e  oordinates, e.g.
-00009050: 2c0a 0a20 2020 203e 3e3e 2061 7272 6179  ,..    >>> array
-00009060: 203d 2078 722e 4461 7461 4172 7261 7928   = xr.DataArray(
-00009070: 5b31 2c20 322c 2033 5d2c 2063 6f6f 7264  [1, 2, 3], coord
-00009080: 733d 5b28 2278 222c 205b 302e 312c 2030  s=[("x", [0.1, 0
-00009090: 2e32 2c20 302e 335d 295d 290a 2020 2020  .2, 0.3])]).    
-000090a0: 3e3e 3e20 6d61 676e 6974 7564 6528 6172  >>> magnitude(ar
-000090b0: 7261 792c 202d 6172 7261 7929 0a20 2020  ray, -array).   
-000090c0: 203c 7861 7272 6179 2e44 6174 6141 7272   <xarray.DataArr
-000090d0: 6179 2028 783a 2033 293e 0a20 2020 2061  ay (x: 3)>.    a
-000090e0: 7272 6179 285b 312e 3431 3432 3133 3536  rray([1.41421356
-000090f0: 2c20 322e 3832 3834 3237 3132 2c20 342e  , 2.82842712, 4.
-00009100: 3234 3236 3430 3639 5d29 0a20 2020 2043  24264069]).    C
-00009110: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-00009120: 2020 2a20 7820 2020 2020 2020 2028 7829    * x        (x)
-00009130: 2066 6c6f 6174 3634 2030 2e31 2030 2e32   float64 0.1 0.2
-00009140: 2030 2e33 0a0a 2020 2020 506c 6169 6e20   0.3..    Plain 
-00009150: 7363 616c 6172 732c 206e 756d 7079 2061  scalars, numpy a
-00009160: 7272 6179 7320 616e 6420 6120 6d69 7820  rrays and a mix 
-00009170: 6f66 2074 6865 7365 2077 6974 6820 7861  of these with xa
-00009180: 7272 6179 206f 626a 6563 7473 2069 7320  rray objects is 
-00009190: 616c 736f 0a20 2020 2073 7570 706f 7274  also.    support
-000091a0: 6564 3a0a 0a20 2020 203e 3e3e 206d 6167  ed:..    >>> mag
-000091b0: 6e69 7475 6465 2833 2c20 3429 0a20 2020  nitude(3, 4).   
-000091c0: 2035 2e30 0a20 2020 203e 3e3e 206d 6167   5.0.    >>> mag
-000091d0: 6e69 7475 6465 2833 2c20 6e70 2e61 7272  nitude(3, np.arr
-000091e0: 6179 285b 302c 2034 5d29 290a 2020 2020  ay([0, 4])).    
-000091f0: 6172 7261 7928 5b33 2e2c 2035 2e5d 290a  array([3., 5.]).
-00009200: 2020 2020 3e3e 3e20 6d61 676e 6974 7564      >>> magnitud
-00009210: 6528 6172 7261 792c 2030 290a 2020 2020  e(array, 0).    
-00009220: 3c78 6172 7261 792e 4461 7461 4172 7261  <xarray.DataArra
-00009230: 7920 2878 3a20 3329 3e0a 2020 2020 6172  y (x: 3)>.    ar
-00009240: 7261 7928 5b31 2e2c 2032 2e2c 2033 2e5d  ray([1., 2., 3.]
-00009250: 290a 2020 2020 436f 6f72 6469 6e61 7465  ).    Coordinate
-00009260: 733a 0a20 2020 2020 202a 2078 2020 2020  s:.      * x    
-00009270: 2020 2020 2878 2920 666c 6f61 7436 3420      (x) float64 
-00009280: 302e 3120 302e 3220 302e 330a 0a20 2020  0.1 0.2 0.3..   
-00009290: 204f 7468 6572 2065 7861 6d70 6c65 7320   Other examples 
-000092a0: 6f66 2068 6f77 2079 6f75 2063 6f75 6c64  of how you could
-000092b0: 2075 7365 2060 6061 7070 6c79 5f75 6675   use ``apply_ufu
-000092c0: 6e63 6060 2074 6f20 7772 6974 6520 6675  nc`` to write fu
-000092d0: 6e63 7469 6f6e 7320 746f 0a20 2020 2028  nctions to.    (
-000092e0: 7665 7279 206e 6561 726c 7929 2072 6570  very nearly) rep
-000092f0: 6c69 6361 7465 2065 7869 7374 696e 6720  licate existing 
-00009300: 7861 7272 6179 2066 756e 6374 696f 6e61  xarray functiona
-00009310: 6c69 7479 3a0a 0a20 2020 2043 6f6d 7075  lity:..    Compu
-00009320: 7465 2074 6865 206d 6561 6e20 2860 602e  te the mean (``.
-00009330: 6d65 616e 6060 2920 6f76 6572 206f 6e65  mean``) over one
-00009340: 2064 696d 656e 7369 6f6e 3a0a 0a20 2020   dimension:..   
-00009350: 203e 3e3e 2064 6566 206d 6561 6e28 6f62   >>> def mean(ob
-00009360: 6a2c 2064 696d 293a 0a20 2020 202e 2e2e  j, dim):.    ...
-00009370: 2020 2020 2023 206e 6f74 653a 2061 7070       # note: app
-00009380: 6c79 2061 6c77 6179 7320 6d6f 7665 7320  ly always moves 
-00009390: 636f 7265 2064 696d 656e 7369 6f6e 7320  core dimensions 
-000093a0: 746f 2074 6865 2065 6e64 0a20 2020 202e  to the end.    .
-000093b0: 2e2e 2020 2020 2072 6574 7572 6e20 6170  ..     return ap
-000093c0: 706c 795f 7566 756e 6328 0a20 2020 202e  ply_ufunc(.    .
-000093d0: 2e2e 2020 2020 2020 2020 206e 702e 6d65  ..         np.me
-000093e0: 616e 2c20 6f62 6a2c 2069 6e70 7574 5f63  an, obj, input_c
-000093f0: 6f72 655f 6469 6d73 3d5b 5b64 696d 5d5d  ore_dims=[[dim]]
-00009400: 2c20 6b77 6172 6773 3d7b 2261 7869 7322  , kwargs={"axis"
-00009410: 3a20 2d31 7d0a 2020 2020 2e2e 2e20 2020  : -1}.    ...   
-00009420: 2020 290a 2020 2020 2e2e 2e0a 0a20 2020    ).    .....   
-00009430: 2049 6e6e 6572 2070 726f 6475 6374 206f   Inner product o
-00009440: 7665 7220 6120 7370 6563 6966 6963 2064  ver a specific d
-00009450: 696d 656e 7369 6f6e 2028 6c69 6b65 203a  imension (like :
-00009460: 7079 3a66 756e 633a 6064 6f74 6029 3a0a  py:func:`dot`):.
-00009470: 0a20 2020 203e 3e3e 2064 6566 205f 696e  .    >>> def _in
-00009480: 6e65 7228 782c 2079 293a 0a20 2020 202e  ner(x, y):.    .
-00009490: 2e2e 2020 2020 2072 6573 756c 7420 3d20  ..     result = 
-000094a0: 6e70 2e6d 6174 6d75 6c28 785b 2e2e 2e2c  np.matmul(x[...,
-000094b0: 206e 702e 6e65 7761 7869 732c 203a 5d2c   np.newaxis, :],
-000094c0: 2079 5b2e 2e2e 2c20 3a2c 206e 702e 6e65   y[..., :, np.ne
-000094d0: 7761 7869 735d 290a 2020 2020 2e2e 2e20  waxis]).    ... 
-000094e0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-000094f0: 745b 2e2e 2e2c 2030 2c20 305d 0a20 2020  t[..., 0, 0].   
-00009500: 202e 2e2e 0a20 2020 203e 3e3e 2064 6566   ....    >>> def
-00009510: 2069 6e6e 6572 5f70 726f 6475 6374 2861   inner_product(a
-00009520: 2c20 622c 2064 696d 293a 0a20 2020 202e  , b, dim):.    .
-00009530: 2e2e 2020 2020 2072 6574 7572 6e20 6170  ..     return ap
-00009540: 706c 795f 7566 756e 6328 5f69 6e6e 6572  ply_ufunc(_inner
-00009550: 2c20 612c 2062 2c20 696e 7075 745f 636f  , a, b, input_co
-00009560: 7265 5f64 696d 733d 5b5b 6469 6d5d 2c20  re_dims=[[dim], 
-00009570: 5b64 696d 5d5d 290a 2020 2020 2e2e 2e0a  [dim]]).    ....
-00009580: 0a20 2020 2053 7461 636b 206f 626a 6563  .    Stack objec
-00009590: 7473 2061 6c6f 6e67 2061 206e 6577 2064  ts along a new d
-000095a0: 696d 656e 7369 6f6e 2028 6c69 6b65 203a  imension (like :
-000095b0: 7079 3a66 756e 633a 6063 6f6e 6361 7460  py:func:`concat`
-000095c0: 293a 0a0a 2020 2020 3e3e 3e20 6465 6620  ):..    >>> def 
-000095d0: 7374 6163 6b28 6f62 6a65 6374 732c 2064  stack(objects, d
-000095e0: 696d 2c20 6e65 775f 636f 6f72 6429 3a0a  im, new_coord):.
-000095f0: 2020 2020 2e2e 2e20 2020 2020 2320 6e6f      ...     # no
-00009600: 7465 3a20 7468 6973 2076 6572 7369 6f6e  te: this version
-00009610: 2064 6f65 7320 6e6f 7420 7374 6163 6b20   does not stack 
-00009620: 636f 6f72 6469 6e61 7465 730a 2020 2020  coordinates.    
-00009630: 2e2e 2e20 2020 2020 6675 6e63 203d 206c  ...     func = l
-00009640: 616d 6264 6120 2a78 3a20 6e70 2e73 7461  ambda *x: np.sta
-00009650: 636b 2878 2c20 6178 6973 3d2d 3129 0a20  ck(x, axis=-1). 
-00009660: 2020 202e 2e2e 2020 2020 2072 6573 756c     ...     resul
-00009670: 7420 3d20 6170 706c 795f 7566 756e 6328  t = apply_ufunc(
-00009680: 0a20 2020 202e 2e2e 2020 2020 2020 2020  .    ...        
-00009690: 2066 756e 632c 0a20 2020 202e 2e2e 2020   func,.    ...  
-000096a0: 2020 2020 2020 202a 6f62 6a65 6374 732c         *objects,
-000096b0: 0a20 2020 202e 2e2e 2020 2020 2020 2020  .    ...        
-000096c0: 206f 7574 7075 745f 636f 7265 5f64 696d   output_core_dim
-000096d0: 733d 5b5b 6469 6d5d 5d2c 0a20 2020 202e  s=[[dim]],.    .
-000096e0: 2e2e 2020 2020 2020 2020 206a 6f69 6e3d  ..         join=
-000096f0: 226f 7574 6572 222c 0a20 2020 202e 2e2e  "outer",.    ...
-00009700: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
-00009710: 5f66 696c 6c5f 7661 6c75 653d 6e70 2e6e  _fill_value=np.n
-00009720: 616e 0a20 2020 202e 2e2e 2020 2020 2029  an.    ...     )
-00009730: 0a20 2020 202e 2e2e 2020 2020 2072 6573  .    ...     res
-00009740: 756c 745b 6469 6d5d 203d 206e 6577 5f63  ult[dim] = new_c
-00009750: 6f6f 7264 0a20 2020 202e 2e2e 2020 2020  oord.    ...    
-00009760: 2072 6574 7572 6e20 7265 7375 6c74 0a20   return result. 
-00009770: 2020 202e 2e2e 0a0a 2020 2020 4966 2079     .....    If y
-00009780: 6f75 7220 6675 6e63 7469 6f6e 2069 7320  our function is 
-00009790: 6e6f 7420 7665 6374 6f72 697a 6564 2062  not vectorized b
-000097a0: 7574 2063 616e 2062 6520 6170 706c 6965  ut can be applie
-000097b0: 6420 6f6e 6c79 2074 6f20 636f 7265 0a20  d only to core. 
-000097c0: 2020 2064 696d 656e 7369 6f6e 732c 2079     dimensions, y
-000097d0: 6f75 2063 616e 2075 7365 2060 6076 6563  ou can use ``vec
-000097e0: 746f 7269 7a65 3d54 7275 6560 6020 746f  torize=True`` to
-000097f0: 2074 7572 6e20 696e 746f 2061 2076 6563   turn into a vec
-00009800: 746f 7269 7a65 640a 2020 2020 6675 6e63  torized.    func
-00009810: 7469 6f6e 2e20 5468 6973 2077 7261 7073  tion. This wraps
-00009820: 203a 7079 3a66 756e 633a 606e 756d 7079   :py:func:`numpy
-00009830: 2e76 6563 746f 7269 7a65 602c 2073 6f20  .vectorize`, so 
-00009840: 7468 6520 6f70 6572 6174 696f 6e20 6973  the operation is
-00009850: 6e27 740a 2020 2020 7465 7272 6962 6c79  n't.    terribly
-00009860: 2066 6173 742e 2048 6572 6520 7765 276c   fast. Here we'l
-00009870: 6c20 7573 6520 6974 2074 6f20 6361 6c63  l use it to calc
-00009880: 756c 6174 6520 7468 6520 6469 7374 616e  ulate the distan
-00009890: 6365 2062 6574 7765 656e 0a20 2020 2065  ce between.    e
-000098a0: 6d70 6972 6963 616c 2073 616d 706c 6573  mpirical samples
-000098b0: 2066 726f 6d20 7477 6f20 7072 6f62 6162   from two probab
-000098c0: 696c 6974 7920 6469 7374 7269 6275 7469  ility distributi
-000098d0: 6f6e 732c 2075 7369 6e67 2061 2073 6369  ons, using a sci
-000098e0: 7079 0a20 2020 2066 756e 6374 696f 6e20  py.    function 
-000098f0: 7468 6174 206e 6565 6473 2074 6f20 6265  that needs to be
-00009900: 2061 7070 6c69 6564 2074 6f20 7665 6374   applied to vect
-00009910: 6f72 733a 0a0a 2020 2020 3e3e 3e20 696d  ors:..    >>> im
-00009920: 706f 7274 2073 6369 7079 2e73 7461 7473  port scipy.stats
-00009930: 0a20 2020 203e 3e3e 2064 6566 2065 6172  .    >>> def ear
-00009940: 7468 5f6d 6f76 6572 5f64 6973 7461 6e63  th_mover_distanc
-00009950: 6528 6669 7273 745f 7361 6d70 6c65 732c  e(first_samples,
-00009960: 2073 6563 6f6e 645f 7361 6d70 6c65 732c   second_samples,
-00009970: 2064 696d 3d22 656e 7365 6d62 6c65 2229   dim="ensemble")
-00009980: 3a0a 2020 2020 2e2e 2e20 2020 2020 7265  :.    ...     re
-00009990: 7475 726e 2061 7070 6c79 5f75 6675 6e63  turn apply_ufunc
-000099a0: 280a 2020 2020 2e2e 2e20 2020 2020 2020  (.    ...       
-000099b0: 2020 7363 6970 792e 7374 6174 732e 7761    scipy.stats.wa
-000099c0: 7373 6572 7374 6569 6e5f 6469 7374 616e  sserstein_distan
-000099d0: 6365 2c0a 2020 2020 2e2e 2e20 2020 2020  ce,.    ...     
-000099e0: 2020 2020 6669 7273 745f 7361 6d70 6c65      first_sample
-000099f0: 732c 0a20 2020 202e 2e2e 2020 2020 2020  s,.    ...      
-00009a00: 2020 2073 6563 6f6e 645f 7361 6d70 6c65     second_sample
-00009a10: 732c 0a20 2020 202e 2e2e 2020 2020 2020  s,.    ...      
-00009a20: 2020 2069 6e70 7574 5f63 6f72 655f 6469     input_core_di
-00009a30: 6d73 3d5b 5b64 696d 5d2c 205b 6469 6d5d  ms=[[dim], [dim]
-00009a40: 5d2c 0a20 2020 202e 2e2e 2020 2020 2020  ],.    ...      
-00009a50: 2020 2076 6563 746f 7269 7a65 3d54 7275     vectorize=Tru
-00009a60: 652c 0a20 2020 202e 2e2e 2020 2020 2029  e,.    ...     )
-00009a70: 0a20 2020 202e 2e2e 0a0a 2020 2020 4d6f  .    .....    Mo
-00009a80: 7374 206f 6620 4e75 6d50 7927 7320 6275  st of NumPy's bu
-00009a90: 696c 7469 6e20 6675 6e63 7469 6f6e 7320  iltin functions 
-00009aa0: 616c 7265 6164 7920 6272 6f61 6463 6173  already broadcas
-00009ab0: 7420 7468 6569 7220 696e 7075 7473 0a20  t their inputs. 
-00009ac0: 2020 2061 7070 726f 7072 6961 7465 6c79     appropriately
-00009ad0: 2066 6f72 2075 7365 2069 6e20 6060 6170   for use in ``ap
-00009ae0: 706c 795f 7566 756e 6360 602e 2059 6f75  ply_ufunc``. You
-00009af0: 206d 6179 2066 696e 6420 6865 6c70 6572   may find helper
-00009b00: 2066 756e 6374 696f 6e73 2073 7563 6820   functions such 
-00009b10: 6173 0a20 2020 203a 7079 3a66 756e 633a  as.    :py:func:
-00009b20: 606e 756d 7079 2e62 726f 6164 6361 7374  `numpy.broadcast
-00009b30: 5f61 7272 6179 7360 2068 656c 7066 756c  _arrays` helpful
-00009b40: 2069 6e20 7772 6974 696e 6720 796f 7572   in writing your
-00009b50: 2066 756e 6374 696f 6e2e 2060 6061 7070   function. ``app
-00009b60: 6c79 5f75 6675 6e63 6060 2061 6c73 6f0a  ly_ufunc`` also.
-00009b70: 2020 2020 776f 726b 7320 7765 6c6c 2077      works well w
-00009b80: 6974 6820 3a70 793a 6675 6e63 3a60 6e75  ith :py:func:`nu
-00009b90: 6d62 612e 7665 6374 6f72 697a 6560 2061  mba.vectorize` a
-00009ba0: 6e64 203a 7079 3a66 756e 633a 606e 756d  nd :py:func:`num
-00009bb0: 6261 2e67 7576 6563 746f 7269 7a65 602e  ba.guvectorize`.
-00009bc0: 0a0a 2020 2020 5365 6520 416c 736f 0a20  ..    See Also. 
-00009bd0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-00009be0: 6e75 6d70 792e 6272 6f61 6463 6173 745f  numpy.broadcast_
-00009bf0: 6172 7261 7973 0a20 2020 206e 756d 6261  arrays.    numba
-00009c00: 2e76 6563 746f 7269 7a65 0a20 2020 206e  .vectorize.    n
-00009c10: 756d 6261 2e67 7576 6563 746f 7269 7a65  umba.guvectorize
-00009c20: 0a20 2020 2064 6173 6b2e 6172 7261 792e  .    dask.array.
-00009c30: 6170 706c 795f 6775 6675 6e63 0a20 2020  apply_gufunc.   
-00009c40: 2078 6172 7261 792e 6d61 705f 626c 6f63   xarray.map_bloc
-00009c50: 6b73 0a20 2020 203a 7265 663a 6064 6173  ks.    :ref:`das
-00009c60: 6b2e 6175 746f 6d61 7469 632d 7061 7261  k.automatic-para
-00009c70: 6c6c 656c 697a 6174 696f 6e60 0a20 2020  llelization`.   
-00009c80: 2020 2020 2055 7365 7220 6775 6964 6520       User guide 
-00009c90: 6465 7363 7269 6269 6e67 203a 7079 3a66  describing :py:f
-00009ca0: 756e 633a 6061 7070 6c79 5f75 6675 6e63  unc:`apply_ufunc
-00009cb0: 6020 616e 6420 3a70 793a 6675 6e63 3a60  ` and :py:func:`
-00009cc0: 6d61 705f 626c 6f63 6b73 602e 0a0a 2020  map_blocks`...  
-00009cd0: 2020 5265 6665 7265 6e63 6573 0a20 2020    References.   
-00009ce0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00009cf0: 2e2e 205b 315d 2068 7474 7073 3a2f 2f6e  .. [1] https://n
-00009d00: 756d 7079 2e6f 7267 2f64 6f63 2f73 7461  umpy.org/doc/sta
-00009d10: 626c 652f 7265 6665 7265 6e63 652f 7566  ble/reference/uf
-00009d20: 756e 6373 2e68 746d 6c0a 2020 2020 2e2e  uncs.html.    ..
-00009d30: 205b 325d 2068 7474 7073 3a2f 2f6e 756d   [2] https://num
-00009d40: 7079 2e6f 7267 2f64 6f63 2f73 7461 626c  py.org/doc/stabl
-00009d50: 652f 7265 6665 7265 6e63 652f 632d 6170  e/reference/c-ap
-00009d60: 692f 6765 6e65 7261 6c69 7a65 642d 7566  i/generalized-uf
-00009d70: 756e 6373 2e68 746d 6c0a 2020 2020 2222  uncs.html.    ""
-00009d80: 220a 2020 2020 6672 6f6d 2078 6172 7261  ".    from xarra
-00009d90: 792e 636f 7265 2e64 6174 6161 7272 6179  y.core.dataarray
-00009da0: 2069 6d70 6f72 7420 4461 7461 4172 7261   import DataArra
-00009db0: 790a 2020 2020 6672 6f6d 2078 6172 7261  y.    from xarra
-00009dc0: 792e 636f 7265 2e67 726f 7570 6279 2069  y.core.groupby i
-00009dd0: 6d70 6f72 7420 4772 6f75 7042 790a 2020  mport GroupBy.  
-00009de0: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
-00009df0: 7265 2e76 6172 6961 626c 6520 696d 706f  re.variable impo
-00009e00: 7274 2056 6172 6961 626c 650a 0a20 2020  rt Variable..   
-00009e10: 2069 6620 696e 7075 745f 636f 7265 5f64   if input_core_d
-00009e20: 696d 7320 6973 204e 6f6e 653a 0a20 2020  ims is None:.   
-00009e30: 2020 2020 2069 6e70 7574 5f63 6f72 655f       input_core_
-00009e40: 6469 6d73 203d 2028 2829 2c29 202a 2028  dims = ((),) * (
-00009e50: 6c65 6e28 6172 6773 2929 0a20 2020 2065  len(args)).    e
-00009e60: 6c69 6620 6c65 6e28 696e 7075 745f 636f  lif len(input_co
-00009e70: 7265 5f64 696d 7329 2021 3d20 6c65 6e28  re_dims) != len(
-00009e80: 6172 6773 293a 0a20 2020 2020 2020 2072  args):.        r
-00009e90: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00009ea0: 0a20 2020 2020 2020 2020 2020 2066 2269  .            f"i
-00009eb0: 6e70 7574 5f63 6f72 655f 6469 6d73 206d  nput_core_dims m
-00009ec0: 7573 7420 6265 204e 6f6e 6520 6f72 2061  ust be None or a
-00009ed0: 2074 7570 6c65 2077 6974 6820 7468 6520   tuple with the 
-00009ee0: 6c65 6e67 7468 2073 616d 6520 746f 2022  length same to "
-00009ef0: 0a20 2020 2020 2020 2020 2020 2066 2274  .            f"t
-00009f00: 6865 206e 756d 6265 7220 6f66 2061 7267  he number of arg
-00009f10: 756d 656e 7473 2e20 220a 2020 2020 2020  uments. ".      
-00009f20: 2020 2020 2020 6622 4769 7665 6e20 7b6c        f"Given {l
-00009f30: 656e 2869 6e70 7574 5f63 6f72 655f 6469  en(input_core_di
-00009f40: 6d73 297d 2069 6e70 7574 5f63 6f72 655f  ms)} input_core_
-00009f50: 6469 6d73 3a20 7b69 6e70 7574 5f63 6f72  dims: {input_cor
-00009f60: 655f 6469 6d73 7d2c 2022 0a20 2020 2020  e_dims}, ".     
-00009f70: 2020 2020 2020 2066 2220 6275 7420 6e75         f" but nu
-00009f80: 6d62 6572 206f 6620 6172 6773 2069 7320  mber of args is 
-00009f90: 7b6c 656e 2861 7267 7329 7d2e 220a 2020  {len(args)}.".  
-00009fa0: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
-00009fb0: 6b77 6172 6773 2069 7320 4e6f 6e65 3a0a  kwargs is None:.
-00009fc0: 2020 2020 2020 2020 6b77 6172 6773 203d          kwargs =
-00009fd0: 207b 7d0a 0a20 2020 2073 6967 6e61 7475   {}..    signatu
-00009fe0: 7265 203d 205f 5546 756e 6353 6967 6e61  re = _UFuncSigna
-00009ff0: 7475 7265 2869 6e70 7574 5f63 6f72 655f  ture(input_core_
-0000a000: 6469 6d73 2c20 6f75 7470 7574 5f63 6f72  dims, output_cor
-0000a010: 655f 6469 6d73 290a 0a20 2020 2069 6620  e_dims)..    if 
-0000a020: 6578 636c 7564 655f 6469 6d73 3a0a 2020  exclude_dims:.  
-0000a030: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-0000a040: 6e73 7461 6e63 6528 6578 636c 7564 655f  nstance(exclude_
-0000a050: 6469 6d73 2c20 7365 7429 3a0a 2020 2020  dims, set):.    
-0000a060: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-0000a070: 7065 4572 726f 7228 0a20 2020 2020 2020  peError(.       
-0000a080: 2020 2020 2020 2020 2066 2245 7870 6563           f"Expec
-0000a090: 7465 6420 6578 636c 7564 655f 6469 6d73  ted exclude_dims
-0000a0a0: 2074 6f20 6265 2061 2027 7365 7427 2e20   to be a 'set'. 
-0000a0b0: 5265 6365 6976 6564 2027 7b74 7970 6528  Received '{type(
-0000a0c0: 6578 636c 7564 655f 6469 6d73 292e 5f5f  exclude_dims).__
-0000a0d0: 6e61 6d65 5f5f 7d27 2069 6e73 7465 6164  name__}' instead
-0000a0e0: 2e22 0a20 2020 2020 2020 2020 2020 2029  .".            )
-0000a0f0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000a100: 6578 636c 7564 655f 6469 6d73 203c 3d20  exclude_dims <= 
-0000a110: 7369 676e 6174 7572 652e 616c 6c5f 636f  signature.all_co
-0000a120: 7265 5f64 696d 733a 0a20 2020 2020 2020  re_dims:.       
-0000a130: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0000a140: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0000a150: 2020 2020 2020 2066 2265 6163 6820 6469         f"each di
-0000a160: 6d65 6e73 696f 6e20 696e 2060 6578 636c  mension in `excl
-0000a170: 7564 655f 6469 6d73 6020 6d75 7374 2061  ude_dims` must a
-0000a180: 6c73 6f20 6265 2061 2022 0a20 2020 2020  lso be a ".     
-0000a190: 2020 2020 2020 2020 2020 2066 2263 6f72             f"cor
-0000a1a0: 6520 6469 6d65 6e73 696f 6e20 696e 2074  e dimension in t
-0000a1b0: 6865 2066 756e 6374 696f 6e20 7369 676e  he function sign
-0000a1c0: 6174 7572 652e 2022 0a20 2020 2020 2020  ature. ".       
-0000a1d0: 2020 2020 2020 2020 2066 2250 6c65 6173           f"Pleas
-0000a1e0: 6520 6d61 6b65 207b 2865 7863 6c75 6465  e make {(exclude
-0000a1f0: 5f64 696d 7320 2d20 7369 676e 6174 7572  _dims - signatur
-0000a200: 652e 616c 6c5f 636f 7265 5f64 696d 7329  e.all_core_dims)
-0000a210: 7d20 6120 636f 7265 2064 696d 656e 7369  } a core dimensi
-0000a220: 6f6e 220a 2020 2020 2020 2020 2020 2020  on".            
-0000a230: 290a 0a20 2020 2023 2068 616e 646c 6520  )..    # handle 
-0000a240: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
-0000a250: 6773 0a20 2020 2069 6620 6461 736b 203d  gs.    if dask =
-0000a260: 3d20 2270 6172 616c 6c65 6c69 7a65 6422  = "parallelized"
-0000a270: 3a0a 2020 2020 2020 2020 6966 2064 6173  :.        if das
-0000a280: 6b5f 6775 6675 6e63 5f6b 7761 7267 7320  k_gufunc_kwargs 
-0000a290: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0000a2a0: 2020 2020 2064 6173 6b5f 6775 6675 6e63       dask_gufunc
-0000a2b0: 5f6b 7761 7267 7320 3d20 7b7d 0a20 2020  _kwargs = {}.   
-0000a2c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000a2d0: 2020 2020 2020 2064 6173 6b5f 6775 6675         dask_gufu
-0000a2e0: 6e63 5f6b 7761 7267 7320 3d20 6461 736b  nc_kwargs = dask
-0000a2f0: 5f67 7566 756e 635f 6b77 6172 6773 2e63  _gufunc_kwargs.c
-0000a300: 6f70 7928 290a 2020 2020 2020 2020 2320  opy().        # 
-0000a310: 746f 646f 3a20 7265 6d6f 7665 2077 6172  todo: remove war
-0000a320: 6e69 6e67 7320 6166 7465 7220 6465 7072  nings after depr
-0000a330: 6563 6174 696f 6e20 6379 636c 650a 2020  ecation cycle.  
-0000a340: 2020 2020 2020 6966 206d 6574 6120 6973        if meta is
-0000a350: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000a360: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
-0000a370: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
-0000a380: 2020 2020 2020 2260 606d 6574 6160 6020        "``meta`` 
-0000a390: 7368 6f75 6c64 2062 6520 6769 7665 6e20  should be given 
-0000a3a0: 696e 2074 6865 2060 6064 6173 6b5f 6775  in the ``dask_gu
-0000a3b0: 6675 6e63 5f6b 7761 7267 7360 6020 7061  func_kwargs`` pa
-0000a3c0: 7261 6d65 7465 722e 220a 2020 2020 2020  rameter.".      
-0000a3d0: 2020 2020 2020 2020 2020 2220 4974 2077            " It w
-0000a3e0: 696c 6c20 6265 2072 656d 6f76 6564 2061  ill be removed a
-0000a3f0: 7320 6469 7265 6374 2070 6172 616d 6574  s direct paramet
-0000a400: 6572 2069 6e20 6120 6675 7475 7265 2076  er in a future v
-0000a410: 6572 7369 6f6e 2e22 2c0a 2020 2020 2020  ersion.",.      
-0000a420: 2020 2020 2020 2020 2020 4675 7475 7265            Future
-0000a430: 5761 726e 696e 672c 0a20 2020 2020 2020  Warning,.       
-0000a440: 2020 2020 2020 2020 2073 7461 636b 6c65           stackle
-0000a450: 7665 6c3d 322c 0a20 2020 2020 2020 2020  vel=2,.         
-0000a460: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000a470: 2064 6173 6b5f 6775 6675 6e63 5f6b 7761   dask_gufunc_kwa
-0000a480: 7267 732e 7365 7464 6566 6175 6c74 2822  rgs.setdefault("
-0000a490: 6d65 7461 222c 206d 6574 6129 0a20 2020  meta", meta).   
-0000a4a0: 2020 2020 2069 6620 6f75 7470 7574 5f73       if output_s
-0000a4b0: 697a 6573 2069 7320 6e6f 7420 4e6f 6e65  izes is not None
-0000a4c0: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
-0000a4d0: 726e 696e 6773 2e77 6172 6e28 0a20 2020  rnings.warn(.   
-0000a4e0: 2020 2020 2020 2020 2020 2020 2022 6060               "``
-0000a4f0: 6f75 7470 7574 5f73 697a 6573 6060 2073  output_sizes`` s
-0000a500: 686f 756c 6420 6265 2067 6976 656e 2069  hould be given i
-0000a510: 6e20 7468 6520 6060 6461 736b 5f67 7566  n the ``dask_guf
-0000a520: 756e 635f 6b77 6172 6773 6060 2022 0a20  unc_kwargs`` ". 
-0000a530: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000a540: 7061 7261 6d65 7465 722e 2049 7420 7769  parameter. It wi
-0000a550: 6c6c 2062 6520 7265 6d6f 7665 6420 6173  ll be removed as
-0000a560: 2064 6972 6563 7420 7061 7261 6d65 7465   direct paramete
-0000a570: 7220 696e 2061 2066 7574 7572 6520 220a  r in a future ".
-0000a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a590: 2276 6572 7369 6f6e 2e22 2c0a 2020 2020  "version.",.    
-0000a5a0: 2020 2020 2020 2020 2020 2020 4675 7475              Futu
-0000a5b0: 7265 5761 726e 696e 672c 0a20 2020 2020  reWarning,.     
-0000a5c0: 2020 2020 2020 2020 2020 2073 7461 636b             stack
-0000a5d0: 6c65 7665 6c3d 322c 0a20 2020 2020 2020  level=2,.       
-0000a5e0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000a5f0: 2020 2064 6173 6b5f 6775 6675 6e63 5f6b     dask_gufunc_k
-0000a600: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
-0000a610: 2822 6f75 7470 7574 5f73 697a 6573 222c  ("output_sizes",
-0000a620: 206f 7574 7075 745f 7369 7a65 7329 0a0a   output_sizes)..
-0000a630: 2020 2020 6966 206b 7761 7267 733a 0a20      if kwargs:. 
-0000a640: 2020 2020 2020 2066 756e 6320 3d20 6675         func = fu
-0000a650: 6e63 746f 6f6c 732e 7061 7274 6961 6c28  nctools.partial(
-0000a660: 6675 6e63 2c20 2a2a 6b77 6172 6773 290a  func, **kwargs).
-0000a670: 0a20 2020 2069 6620 6b65 6570 5f61 7474  .    if keep_att
-0000a680: 7273 2069 7320 4e6f 6e65 3a0a 2020 2020  rs is None:.    
-0000a690: 2020 2020 6b65 6570 5f61 7474 7273 203d      keep_attrs =
-0000a6a0: 205f 6765 745f 6b65 6570 5f61 7474 7273   _get_keep_attrs
-0000a6b0: 2864 6566 6175 6c74 3d46 616c 7365 290a  (default=False).
-0000a6c0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-0000a6d0: 6365 286b 6565 705f 6174 7472 732c 2062  ce(keep_attrs, b
-0000a6e0: 6f6f 6c29 3a0a 2020 2020 2020 2020 6b65  ool):.        ke
-0000a6f0: 6570 5f61 7474 7273 203d 2022 6f76 6572  ep_attrs = "over
-0000a700: 7269 6465 2220 6966 206b 6565 705f 6174  ride" if keep_at
-0000a710: 7472 7320 656c 7365 2022 6472 6f70 220a  trs else "drop".
-0000a720: 0a20 2020 2076 6172 6961 626c 6573 5f76  .    variables_v
-0000a730: 6675 6e63 203d 2066 756e 6374 6f6f 6c73  func = functools
-0000a740: 2e70 6172 7469 616c 280a 2020 2020 2020  .partial(.      
-0000a750: 2020 6170 706c 795f 7661 7269 6162 6c65    apply_variable
-0000a760: 5f75 6675 6e63 2c0a 2020 2020 2020 2020  _ufunc,.        
-0000a770: 6675 6e63 2c0a 2020 2020 2020 2020 7369  func,.        si
-0000a780: 676e 6174 7572 653d 7369 676e 6174 7572  gnature=signatur
-0000a790: 652c 0a20 2020 2020 2020 2065 7863 6c75  e,.        exclu
-0000a7a0: 6465 5f64 696d 733d 6578 636c 7564 655f  de_dims=exclude_
-0000a7b0: 6469 6d73 2c0a 2020 2020 2020 2020 6b65  dims,.        ke
-0000a7c0: 6570 5f61 7474 7273 3d6b 6565 705f 6174  ep_attrs=keep_at
-0000a7d0: 7472 732c 0a20 2020 2020 2020 2064 6173  trs,.        das
-0000a7e0: 6b3d 6461 736b 2c0a 2020 2020 2020 2020  k=dask,.        
-0000a7f0: 7665 6374 6f72 697a 653d 7665 6374 6f72  vectorize=vector
-0000a800: 697a 652c 0a20 2020 2020 2020 206f 7574  ize,.        out
-0000a810: 7075 745f 6474 7970 6573 3d6f 7574 7075  put_dtypes=outpu
-0000a820: 745f 6474 7970 6573 2c0a 2020 2020 2020  t_dtypes,.      
-0000a830: 2020 6461 736b 5f67 7566 756e 635f 6b77    dask_gufunc_kw
-0000a840: 6172 6773 3d64 6173 6b5f 6775 6675 6e63  args=dask_gufunc
-0000a850: 5f6b 7761 7267 732c 0a20 2020 2029 0a0a  _kwargs,.    )..
-0000a860: 2020 2020 2320 6665 6564 2067 726f 7570      # feed group
-0000a870: 6279 2d61 7070 6c79 5f75 6675 6e63 2074  by-apply_ufunc t
-0000a880: 6872 6f75 6768 2061 7070 6c79 5f67 726f  hrough apply_gro
-0000a890: 7570 6279 5f66 756e 630a 2020 2020 6966  upby_func.    if
-0000a8a0: 2061 6e79 2869 7369 6e73 7461 6e63 6528   any(isinstance(
-0000a8b0: 612c 2047 726f 7570 4279 2920 666f 7220  a, GroupBy) for 
-0000a8c0: 6120 696e 2061 7267 7329 3a0a 2020 2020  a in args):.    
-0000a8d0: 2020 2020 7468 6973 5f61 7070 6c79 203d      this_apply =
-0000a8e0: 2066 756e 6374 6f6f 6c73 2e70 6172 7469   functools.parti
-0000a8f0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-0000a900: 6170 706c 795f 7566 756e 632c 0a20 2020  apply_ufunc,.   
-0000a910: 2020 2020 2020 2020 2066 756e 632c 0a20           func,. 
-0000a920: 2020 2020 2020 2020 2020 2069 6e70 7574             input
-0000a930: 5f63 6f72 655f 6469 6d73 3d69 6e70 7574  _core_dims=input
-0000a940: 5f63 6f72 655f 6469 6d73 2c0a 2020 2020  _core_dims,.    
-0000a950: 2020 2020 2020 2020 6f75 7470 7574 5f63          output_c
-0000a960: 6f72 655f 6469 6d73 3d6f 7574 7075 745f  ore_dims=output_
-0000a970: 636f 7265 5f64 696d 732c 0a20 2020 2020  core_dims,.     
-0000a980: 2020 2020 2020 2065 7863 6c75 6465 5f64         exclude_d
-0000a990: 696d 733d 6578 636c 7564 655f 6469 6d73  ims=exclude_dims
-0000a9a0: 2c0a 2020 2020 2020 2020 2020 2020 6a6f  ,.            jo
-0000a9b0: 696e 3d6a 6f69 6e2c 0a20 2020 2020 2020  in=join,.       
-0000a9c0: 2020 2020 2064 6174 6173 6574 5f6a 6f69       dataset_joi
-0000a9d0: 6e3d 6461 7461 7365 745f 6a6f 696e 2c0a  n=dataset_join,.
-0000a9e0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0000a9f0: 7365 745f 6669 6c6c 5f76 616c 7565 3d64  set_fill_value=d
-0000aa00: 6174 6173 6574 5f66 696c 6c5f 7661 6c75  ataset_fill_valu
-0000aa10: 652c 0a20 2020 2020 2020 2020 2020 206b  e,.            k
-0000aa20: 6565 705f 6174 7472 733d 6b65 6570 5f61  eep_attrs=keep_a
-0000aa30: 7474 7273 2c0a 2020 2020 2020 2020 2020  ttrs,.          
-0000aa40: 2020 6461 736b 3d64 6173 6b2c 0a20 2020    dask=dask,.   
-0000aa50: 2020 2020 2020 2020 2076 6563 746f 7269           vectori
-0000aa60: 7a65 3d76 6563 746f 7269 7a65 2c0a 2020  ze=vectorize,.  
-0000aa70: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-0000aa80: 5f64 7479 7065 733d 6f75 7470 7574 5f64  _dtypes=output_d
-0000aa90: 7479 7065 732c 0a20 2020 2020 2020 2020  types,.         
-0000aaa0: 2020 2064 6173 6b5f 6775 6675 6e63 5f6b     dask_gufunc_k
-0000aab0: 7761 7267 733d 6461 736b 5f67 7566 756e  wargs=dask_gufun
-0000aac0: 635f 6b77 6172 6773 2c0a 2020 2020 2020  c_kwargs,.      
-0000aad0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-0000aae0: 726e 2061 7070 6c79 5f67 726f 7570 6279  rn apply_groupby
-0000aaf0: 5f66 756e 6328 7468 6973 5f61 7070 6c79  _func(this_apply
-0000ab00: 2c20 2a61 7267 7329 0a20 2020 2023 2066  , *args).    # f
-0000ab10: 6565 6420 6461 7461 7365 7473 2061 7070  eed datasets app
-0000ab20: 6c79 5f76 6172 6961 626c 655f 7566 756e  ly_variable_ufun
-0000ab30: 6320 7468 726f 7567 6820 6170 706c 795f  c through apply_
-0000ab40: 6461 7461 7365 745f 7666 756e 630a 2020  dataset_vfunc.  
-0000ab50: 2020 656c 6966 2061 6e79 2869 735f 6469    elif any(is_di
-0000ab60: 6374 5f6c 696b 6528 6129 2066 6f72 2061  ct_like(a) for a
-0000ab70: 2069 6e20 6172 6773 293a 0a20 2020 2020   in args):.     
-0000ab80: 2020 2072 6574 7572 6e20 6170 706c 795f     return apply_
-0000ab90: 6461 7461 7365 745f 7666 756e 6328 0a20  dataset_vfunc(. 
-0000aba0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-0000abb0: 626c 6573 5f76 6675 6e63 2c0a 2020 2020  bles_vfunc,.    
-0000abc0: 2020 2020 2020 2020 2a61 7267 732c 0a20          *args,. 
-0000abd0: 2020 2020 2020 2020 2020 2073 6967 6e61             signa
-0000abe0: 7475 7265 3d73 6967 6e61 7475 7265 2c0a  ture=signature,.
-0000abf0: 2020 2020 2020 2020 2020 2020 6a6f 696e              join
-0000ac00: 3d6a 6f69 6e2c 0a20 2020 2020 2020 2020  =join,.         
-0000ac10: 2020 2065 7863 6c75 6465 5f64 696d 733d     exclude_dims=
-0000ac20: 6578 636c 7564 655f 6469 6d73 2c0a 2020  exclude_dims,.  
-0000ac30: 2020 2020 2020 2020 2020 6461 7461 7365            datase
-0000ac40: 745f 6a6f 696e 3d64 6174 6173 6574 5f6a  t_join=dataset_j
-0000ac50: 6f69 6e2c 0a20 2020 2020 2020 2020 2020  oin,.           
-0000ac60: 2066 696c 6c5f 7661 6c75 653d 6461 7461   fill_value=data
-0000ac70: 7365 745f 6669 6c6c 5f76 616c 7565 2c0a  set_fill_value,.
-0000ac80: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
-0000ac90: 5f61 7474 7273 3d6b 6565 705f 6174 7472  _attrs=keep_attr
-0000aca0: 732c 0a20 2020 2020 2020 2029 0a20 2020  s,.        ).   
-0000acb0: 2023 2066 6565 6420 4461 7461 4172 7261   # feed DataArra
-0000acc0: 7920 6170 706c 795f 7661 7269 6162 6c65  y apply_variable
-0000acd0: 5f75 6675 6e63 2074 6872 6f75 6768 2061  _ufunc through a
-0000ace0: 7070 6c79 5f64 6174 6161 7272 6179 5f76  pply_dataarray_v
-0000acf0: 6675 6e63 0a20 2020 2065 6c69 6620 616e  func.    elif an
-0000ad00: 7928 6973 696e 7374 616e 6365 2861 2c20  y(isinstance(a, 
-0000ad10: 4461 7461 4172 7261 7929 2066 6f72 2061  DataArray) for a
-0000ad20: 2069 6e20 6172 6773 293a 0a20 2020 2020   in args):.     
-0000ad30: 2020 2072 6574 7572 6e20 6170 706c 795f     return apply_
-0000ad40: 6461 7461 6172 7261 795f 7666 756e 6328  dataarray_vfunc(
-0000ad50: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-0000ad60: 6961 626c 6573 5f76 6675 6e63 2c0a 2020  iables_vfunc,.  
-0000ad70: 2020 2020 2020 2020 2020 2a61 7267 732c            *args,
-0000ad80: 0a20 2020 2020 2020 2020 2020 2073 6967  .            sig
-0000ad90: 6e61 7475 7265 3d73 6967 6e61 7475 7265  nature=signature
-0000ada0: 2c0a 2020 2020 2020 2020 2020 2020 6a6f  ,.            jo
-0000adb0: 696e 3d6a 6f69 6e2c 0a20 2020 2020 2020  in=join,.       
-0000adc0: 2020 2020 2065 7863 6c75 6465 5f64 696d       exclude_dim
-0000add0: 733d 6578 636c 7564 655f 6469 6d73 2c0a  s=exclude_dims,.
-0000ade0: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
-0000adf0: 5f61 7474 7273 3d6b 6565 705f 6174 7472  _attrs=keep_attr
-0000ae00: 732c 0a20 2020 2020 2020 2029 0a20 2020  s,.        ).   
-0000ae10: 2023 2066 6565 6420 5661 7269 6162 6c65   # feed Variable
-0000ae20: 7320 6469 7265 6374 6c79 2074 6872 6f75  s directly throu
-0000ae30: 6768 2061 7070 6c79 5f76 6172 6961 626c  gh apply_variabl
-0000ae40: 655f 7566 756e 630a 2020 2020 656c 6966  e_ufunc.    elif
-0000ae50: 2061 6e79 2869 7369 6e73 7461 6e63 6528   any(isinstance(
-0000ae60: 612c 2056 6172 6961 626c 6529 2066 6f72  a, Variable) for
-0000ae70: 2061 2069 6e20 6172 6773 293a 0a20 2020   a in args):.   
-0000ae80: 2020 2020 2072 6574 7572 6e20 7661 7269       return vari
-0000ae90: 6162 6c65 735f 7666 756e 6328 2a61 7267  ables_vfunc(*arg
-0000aea0: 7329 0a20 2020 2065 6c73 653a 0a20 2020  s).    else:.   
-0000aeb0: 2020 2020 2023 2066 6565 6420 616e 7974       # feed anyt
-0000aec0: 6869 6e67 2065 6c73 6520 7468 726f 7567  hing else throug
-0000aed0: 6820 6170 706c 795f 6172 7261 795f 7566  h apply_array_uf
-0000aee0: 756e 630a 2020 2020 2020 2020 7265 7475  unc.        retu
-0000aef0: 726e 2061 7070 6c79 5f61 7272 6179 5f75  rn apply_array_u
-0000af00: 6675 6e63 2866 756e 632c 202a 6172 6773  func(func, *args
-0000af10: 2c20 6461 736b 3d64 6173 6b29 0a0a 0a64  , dask=dask)...d
-0000af20: 6566 2063 6f76 280a 2020 2020 6461 5f61  ef cov(.    da_a
-0000af30: 3a20 545f 4461 7461 4172 7261 792c 2064  : T_DataArray, d
-0000af40: 615f 623a 2054 5f44 6174 6141 7272 6179  a_b: T_DataArray
-0000af50: 2c20 6469 6d3a 2044 696d 7320 3d20 4e6f  , dim: Dims = No
-0000af60: 6e65 2c20 6464 6f66 3a20 696e 7420 3d20  ne, ddof: int = 
-0000af70: 310a 2920 2d3e 2054 5f44 6174 6141 7272  1.) -> T_DataArr
-0000af80: 6179 3a0a 2020 2020 2222 220a 2020 2020  ay:.    """.    
-0000af90: 436f 6d70 7574 6520 636f 7661 7269 616e  Compute covarian
-0000afa0: 6365 2062 6574 7765 656e 2074 776f 2044  ce between two D
-0000afb0: 6174 6141 7272 6179 206f 626a 6563 7473  ataArray objects
-0000afc0: 2061 6c6f 6e67 2061 2073 6861 7265 6420   along a shared 
-0000afd0: 6469 6d65 6e73 696f 6e2e 0a0a 2020 2020  dimension...    
-0000afe0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-0000aff0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6461  ---------.    da
-0000b000: 5f61 203a 2044 6174 6141 7272 6179 0a20  _a : DataArray. 
-0000b010: 2020 2020 2020 2041 7272 6179 2074 6f20         Array to 
-0000b020: 636f 6d70 7574 652e 0a20 2020 2064 615f  compute..    da_
-0000b030: 6220 3a20 4461 7461 4172 7261 790a 2020  b : DataArray.  
-0000b040: 2020 2020 2020 4172 7261 7920 746f 2063        Array to c
-0000b050: 6f6d 7075 7465 2e0a 2020 2020 6469 6d20  ompute..    dim 
-0000b060: 3a20 7374 722c 2069 7465 7261 626c 6520  : str, iterable 
-0000b070: 6f66 2068 6173 6861 626c 652c 2022 2e2e  of hashable, "..
-0000b080: 2e22 206f 7220 4e6f 6e65 2c20 6f70 7469  ." or None, opti
-0000b090: 6f6e 616c 0a20 2020 2020 2020 2054 6865  onal.        The
-0000b0a0: 2064 696d 656e 7369 6f6e 2061 6c6f 6e67   dimension along
-0000b0b0: 2077 6869 6368 2074 6865 2063 6f76 6172   which the covar
-0000b0c0: 6961 6e63 6520 7769 6c6c 2062 6520 636f  iance will be co
-0000b0d0: 6d70 7574 6564 0a20 2020 2064 646f 6620  mputed.    ddof 
-0000b0e0: 3a20 696e 742c 2064 6566 6175 6c74 3a20  : int, default: 
-0000b0f0: 310a 2020 2020 2020 2020 4966 2064 646f  1.        If ddo
-0000b100: 663d 312c 2063 6f76 6172 6961 6e63 6520  f=1, covariance 
-0000b110: 6973 206e 6f72 6d61 6c69 7a65 6420 6279  is normalized by
-0000b120: 204e 2d31 2c20 6769 7669 6e67 2061 6e20   N-1, giving an 
-0000b130: 756e 6269 6173 6564 2065 7374 696d 6174  unbiased estimat
-0000b140: 652c 0a20 2020 2020 2020 2065 6c73 6520  e,.        else 
-0000b150: 6e6f 726d 616c 697a 6174 696f 6e20 6973  normalization is
-0000b160: 2062 7920 4e2e 0a0a 2020 2020 5265 7475   by N...    Retu
-0000b170: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
-0000b180: 2020 2020 636f 7661 7269 616e 6365 203a      covariance :
-0000b190: 2044 6174 6141 7272 6179 0a0a 2020 2020   DataArray..    
-0000b1a0: 5365 6520 416c 736f 0a20 2020 202d 2d2d  See Also.    ---
-0000b1b0: 2d2d 2d2d 2d0a 2020 2020 7061 6e64 6173  -----.    pandas
-0000b1c0: 2e53 6572 6965 732e 636f 7620 3a20 636f  .Series.cov : co
-0000b1d0: 7272 6573 706f 6e64 696e 6720 7061 6e64  rresponding pand
-0000b1e0: 6173 2066 756e 6374 696f 6e0a 2020 2020  as function.    
-0000b1f0: 7861 7272 6179 2e63 6f72 7220 3a20 7265  xarray.corr : re
-0000b200: 7370 6563 7469 7665 2066 756e 6374 696f  spective functio
-0000b210: 6e20 746f 2063 616c 6375 6c61 7465 2063  n to calculate c
-0000b220: 6f72 7265 6c61 7469 6f6e 0a0a 2020 2020  orrelation..    
-0000b230: 4578 616d 706c 6573 0a20 2020 202d 2d2d  Examples.    ---
-0000b240: 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20 6672  -----.    >>> fr
-0000b250: 6f6d 2078 6172 7261 7920 696d 706f 7274  om xarray import
-0000b260: 2044 6174 6141 7272 6179 0a20 2020 203e   DataArray.    >
-0000b270: 3e3e 2064 615f 6120 3d20 4461 7461 4172  >> da_a = DataAr
-0000b280: 7261 7928 0a20 2020 202e 2e2e 2020 2020  ray(.    ...    
-0000b290: 206e 702e 6172 7261 7928 5b5b 312c 2032   np.array([[1, 2
-0000b2a0: 2c20 335d 2c20 5b30 2e31 2c20 302e 322c  , 3], [0.1, 0.2,
-0000b2b0: 2030 2e33 5d2c 205b 332e 322c 2030 2e36   0.3], [3.2, 0.6
-0000b2c0: 2c20 312e 385d 5d29 2c0a 2020 2020 2e2e  , 1.8]]),.    ..
-0000b2d0: 2e20 2020 2020 6469 6d73 3d28 2273 7061  .     dims=("spa
-0000b2e0: 6365 222c 2022 7469 6d65 2229 2c0a 2020  ce", "time"),.  
-0000b2f0: 2020 2e2e 2e20 2020 2020 636f 6f72 6473    ...     coords
-0000b300: 3d5b 0a20 2020 202e 2e2e 2020 2020 2020  =[.    ...      
-0000b310: 2020 2028 2273 7061 6365 222c 205b 2249     ("space", ["I
-0000b320: 4122 2c20 2249 4c22 2c20 2249 4e22 5d29  A", "IL", "IN"])
-0000b330: 2c0a 2020 2020 2e2e 2e20 2020 2020 2020  ,.    ...       
-0000b340: 2020 2822 7469 6d65 222c 2070 642e 6461    ("time", pd.da
-0000b350: 7465 5f72 616e 6765 2822 3230 3030 2d30  te_range("2000-0
-0000b360: 312d 3031 222c 2066 7265 713d 2231 4422  1-01", freq="1D"
-0000b370: 2c20 7065 7269 6f64 733d 3329 292c 0a20  , periods=3)),. 
-0000b380: 2020 202e 2e2e 2020 2020 205d 2c0a 2020     ...     ],.  
-0000b390: 2020 2e2e 2e20 290a 2020 2020 3e3e 3e20    ... ).    >>> 
-0000b3a0: 6461 5f61 0a20 2020 203c 7861 7272 6179  da_a.    <xarray
-0000b3b0: 2e44 6174 6141 7272 6179 2028 7370 6163  .DataArray (spac
-0000b3c0: 653a 2033 2c20 7469 6d65 3a20 3329 3e0a  e: 3, time: 3)>.
-0000b3d0: 2020 2020 6172 7261 7928 5b5b 312e 202c      array([[1. ,
-0000b3e0: 2032 2e20 2c20 332e 205d 2c0a 2020 2020   2. , 3. ],.    
-0000b3f0: 2020 2020 2020 205b 302e 312c 2030 2e32         [0.1, 0.2
-0000b400: 2c20 302e 335d 2c0a 2020 2020 2020 2020  , 0.3],.        
-0000b410: 2020 205b 332e 322c 2030 2e36 2c20 312e     [3.2, 0.6, 1.
-0000b420: 385d 5d29 0a20 2020 2043 6f6f 7264 696e  8]]).    Coordin
-0000b430: 6174 6573 3a0a 2020 2020 2020 2a20 7370  ates:.      * sp
-0000b440: 6163 6520 2020 2028 7370 6163 6529 203c  ace    (space) <
-0000b450: 5532 2027 4941 2720 2749 4c27 2027 494e  U2 'IA' 'IL' 'IN
-0000b460: 270a 2020 2020 2020 2a20 7469 6d65 2020  '.      * time  
-0000b470: 2020 2028 7469 6d65 2920 6461 7465 7469     (time) dateti
-0000b480: 6d65 3634 5b6e 735d 2032 3030 302d 3031  me64[ns] 2000-01
-0000b490: 2d30 3120 3230 3030 2d30 312d 3032 2032  -01 2000-01-02 2
-0000b4a0: 3030 302d 3031 2d30 330a 2020 2020 3e3e  000-01-03.    >>
-0000b4b0: 3e20 6461 5f62 203d 2044 6174 6141 7272  > da_b = DataArr
-0000b4c0: 6179 280a 2020 2020 2e2e 2e20 2020 2020  ay(.    ...     
-0000b4d0: 6e70 2e61 7272 6179 285b 5b30 2e32 2c20  np.array([[0.2, 
-0000b4e0: 302e 342c 2030 2e36 5d2c 205b 3135 2c20  0.4, 0.6], [15, 
-0000b4f0: 3130 2c20 355d 2c20 5b33 2e32 2c20 302e  10, 5], [3.2, 0.
-0000b500: 362c 2031 2e38 5d5d 292c 0a20 2020 202e  6, 1.8]]),.    .
-0000b510: 2e2e 2020 2020 2064 696d 733d 2822 7370  ..     dims=("sp
-0000b520: 6163 6522 2c20 2274 696d 6522 292c 0a20  ace", "time"),. 
-0000b530: 2020 202e 2e2e 2020 2020 2063 6f6f 7264     ...     coord
-0000b540: 733d 5b0a 2020 2020 2e2e 2e20 2020 2020  s=[.    ...     
-0000b550: 2020 2020 2822 7370 6163 6522 2c20 5b22      ("space", ["
-0000b560: 4941 222c 2022 494c 222c 2022 494e 225d  IA", "IL", "IN"]
-0000b570: 292c 0a20 2020 202e 2e2e 2020 2020 2020  ),.    ...      
-0000b580: 2020 2028 2274 696d 6522 2c20 7064 2e64     ("time", pd.d
-0000b590: 6174 655f 7261 6e67 6528 2232 3030 302d  ate_range("2000-
-0000b5a0: 3031 2d30 3122 2c20 6672 6571 3d22 3144  01-01", freq="1D
-0000b5b0: 222c 2070 6572 696f 6473 3d33 2929 2c0a  ", periods=3)),.
-0000b5c0: 2020 2020 2e2e 2e20 2020 2020 5d2c 0a20      ...     ],. 
-0000b5d0: 2020 202e 2e2e 2029 0a20 2020 203e 3e3e     ... ).    >>>
-0000b5e0: 2064 615f 620a 2020 2020 3c78 6172 7261   da_b.    <xarra
-0000b5f0: 792e 4461 7461 4172 7261 7920 2873 7061  y.DataArray (spa
-0000b600: 6365 3a20 332c 2074 696d 653a 2033 293e  ce: 3, time: 3)>
-0000b610: 0a20 2020 2061 7272 6179 285b 5b20 302e  .    array([[ 0.
-0000b620: 322c 2020 302e 342c 2020 302e 365d 2c0a  2,  0.4,  0.6],.
-0000b630: 2020 2020 2020 2020 2020 205b 3135 2e20             [15. 
-0000b640: 2c20 3130 2e20 2c20 2035 2e20 5d2c 0a20  , 10. ,  5. ],. 
-0000b650: 2020 2020 2020 2020 2020 5b20 332e 322c            [ 3.2,
-0000b660: 2020 302e 362c 2020 312e 385d 5d29 0a20    0.6,  1.8]]). 
-0000b670: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-0000b680: 2020 2020 2020 2a20 7370 6163 6520 2020        * space   
-0000b690: 2028 7370 6163 6529 203c 5532 2027 4941   (space) <U2 'IA
-0000b6a0: 2720 2749 4c27 2027 494e 270a 2020 2020  ' 'IL' 'IN'.    
-0000b6b0: 2020 2a20 7469 6d65 2020 2020 2028 7469    * time     (ti
-0000b6c0: 6d65 2920 6461 7465 7469 6d65 3634 5b6e  me) datetime64[n
-0000b6d0: 735d 2032 3030 302d 3031 2d30 3120 3230  s] 2000-01-01 20
-0000b6e0: 3030 2d30 312d 3032 2032 3030 302d 3031  00-01-02 2000-01
-0000b6f0: 2d30 330a 2020 2020 3e3e 3e20 7872 2e63  -03.    >>> xr.c
-0000b700: 6f76 2864 615f 612c 2064 615f 6229 0a20  ov(da_a, da_b). 
-0000b710: 2020 203c 7861 7272 6179 2e44 6174 6141     <xarray.DataA
-0000b720: 7272 6179 2028 293e 0a20 2020 2061 7272  rray ()>.    arr
-0000b730: 6179 282d 332e 3533 3035 3535 3536 290a  ay(-3.53055556).
-0000b740: 2020 2020 3e3e 3e20 7872 2e63 6f76 2864      >>> xr.cov(d
-0000b750: 615f 612c 2064 615f 622c 2064 696d 3d22  a_a, da_b, dim="
-0000b760: 7469 6d65 2229 0a20 2020 203c 7861 7272  time").    <xarr
-0000b770: 6179 2e44 6174 6141 7272 6179 2028 7370  ay.DataArray (sp
-0000b780: 6163 653a 2033 293e 0a20 2020 2061 7272  ace: 3)>.    arr
-0000b790: 6179 285b 2030 2e32 2020 2020 2020 202c  ay([ 0.2       ,
-0000b7a0: 202d 302e 3520 2020 2020 2020 2c20 2031   -0.5       ,  1
-0000b7b0: 2e36 3933 3333 3333 335d 290a 2020 2020  .69333333]).    
-0000b7c0: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
-0000b7d0: 2020 202a 2073 7061 6365 2020 2020 2873     * space    (s
-0000b7e0: 7061 6365 2920 3c55 3220 2749 4127 2027  pace) <U2 'IA' '
-0000b7f0: 494c 2720 2749 4e27 0a20 2020 2022 2222  IL' 'IN'.    """
-0000b800: 0a20 2020 2066 726f 6d20 7861 7272 6179  .    from xarray
-0000b810: 2e63 6f72 652e 6461 7461 6172 7261 7920  .core.dataarray 
-0000b820: 696d 706f 7274 2044 6174 6141 7272 6179  import DataArray
-0000b830: 0a0a 2020 2020 6966 2061 6e79 286e 6f74  ..    if any(not
-0000b840: 2069 7369 6e73 7461 6e63 6528 6172 722c   isinstance(arr,
-0000b850: 2044 6174 6141 7272 6179 2920 666f 7220   DataArray) for 
-0000b860: 6172 7220 696e 205b 6461 5f61 2c20 6461  arr in [da_a, da
-0000b870: 5f62 5d29 3a0a 2020 2020 2020 2020 7261  _b]):.        ra
-0000b880: 6973 6520 5479 7065 4572 726f 7228 0a20  ise TypeError(. 
-0000b890: 2020 2020 2020 2020 2020 2022 4f6e 6c79             "Only
-0000b8a0: 2078 722e 4461 7461 4172 7261 7920 6973   xr.DataArray is
-0000b8b0: 2073 7570 706f 7274 6564 2e22 0a20 2020   supported.".   
-0000b8c0: 2020 2020 2020 2020 2022 4769 7665 6e20           "Given 
-0000b8d0: 7b7d 2e22 2e66 6f72 6d61 7428 5b74 7970  {}.".format([typ
-0000b8e0: 6528 6172 7229 2066 6f72 2061 7272 2069  e(arr) for arr i
-0000b8f0: 6e20 5b64 615f 612c 2064 615f 625d 5d29  n [da_a, da_b]])
-0000b900: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0000b910: 7265 7475 726e 205f 636f 765f 636f 7272  return _cov_corr
-0000b920: 2864 615f 612c 2064 615f 622c 2064 696d  (da_a, da_b, dim
-0000b930: 3d64 696d 2c20 6464 6f66 3d64 646f 662c  =dim, ddof=ddof,
-0000b940: 206d 6574 686f 643d 2263 6f76 2229 0a0a   method="cov")..
-0000b950: 0a64 6566 2063 6f72 7228 6461 5f61 3a20  .def corr(da_a: 
-0000b960: 545f 4461 7461 4172 7261 792c 2064 615f  T_DataArray, da_
-0000b970: 623a 2054 5f44 6174 6141 7272 6179 2c20  b: T_DataArray, 
-0000b980: 6469 6d3a 2044 696d 7320 3d20 4e6f 6e65  dim: Dims = None
-0000b990: 2920 2d3e 2054 5f44 6174 6141 7272 6179  ) -> T_DataArray
-0000b9a0: 3a0a 2020 2020 2222 220a 2020 2020 436f  :.    """.    Co
-0000b9b0: 6d70 7574 6520 7468 6520 5065 6172 736f  mpute the Pearso
-0000b9c0: 6e20 636f 7272 656c 6174 696f 6e20 636f  n correlation co
-0000b9d0: 6566 6669 6369 656e 7420 6265 7477 6565  efficient betwee
-0000b9e0: 6e0a 2020 2020 7477 6f20 4461 7461 4172  n.    two DataAr
-0000b9f0: 7261 7920 6f62 6a65 6374 7320 616c 6f6e  ray objects alon
-0000ba00: 6720 6120 7368 6172 6564 2064 696d 656e  g a shared dimen
-0000ba10: 7369 6f6e 2e0a 0a20 2020 2050 6172 616d  sion...    Param
-0000ba20: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-0000ba30: 2d2d 2d2d 0a20 2020 2064 615f 6120 3a20  ----.    da_a : 
-0000ba40: 4461 7461 4172 7261 790a 2020 2020 2020  DataArray.      
-0000ba50: 2020 4172 7261 7920 746f 2063 6f6d 7075    Array to compu
-0000ba60: 7465 2e0a 2020 2020 6461 5f62 203a 2044  te..    da_b : D
-0000ba70: 6174 6141 7272 6179 0a20 2020 2020 2020  ataArray.       
-0000ba80: 2041 7272 6179 2074 6f20 636f 6d70 7574   Array to comput
-0000ba90: 652e 0a20 2020 2064 696d 203a 2073 7472  e..    dim : str
-0000baa0: 2c20 6974 6572 6162 6c65 206f 6620 6861  , iterable of ha
-0000bab0: 7368 6162 6c65 2c20 222e 2e2e 2220 6f72  shable, "..." or
-0000bac0: 204e 6f6e 652c 206f 7074 696f 6e61 6c0a   None, optional.
-0000bad0: 2020 2020 2020 2020 5468 6520 6469 6d65          The dime
-0000bae0: 6e73 696f 6e20 616c 6f6e 6720 7768 6963  nsion along whic
-0000baf0: 6820 7468 6520 636f 7272 656c 6174 696f  h the correlatio
-0000bb00: 6e20 7769 6c6c 2062 6520 636f 6d70 7574  n will be comput
-0000bb10: 6564 0a0a 2020 2020 5265 7475 726e 730a  ed..    Returns.
-0000bb20: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-0000bb30: 636f 7272 656c 6174 696f 6e3a 2044 6174  correlation: Dat
-0000bb40: 6141 7272 6179 0a0a 2020 2020 5365 6520  aArray..    See 
-0000bb50: 416c 736f 0a20 2020 202d 2d2d 2d2d 2d2d  Also.    -------
-0000bb60: 2d0a 2020 2020 7061 6e64 6173 2e53 6572  -.    pandas.Ser
-0000bb70: 6965 732e 636f 7272 203a 2063 6f72 7265  ies.corr : corre
-0000bb80: 7370 6f6e 6469 6e67 2070 616e 6461 7320  sponding pandas 
-0000bb90: 6675 6e63 7469 6f6e 0a20 2020 2078 6172  function.    xar
-0000bba0: 7261 792e 636f 7620 3a20 756e 6465 726c  ray.cov : underl
-0000bbb0: 7969 6e67 2063 6f76 6172 6961 6e63 6520  ying covariance 
-0000bbc0: 6675 6e63 7469 6f6e 0a0a 2020 2020 4578  function..    Ex
-0000bbd0: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
-0000bbe0: 2d2d 2d0a 2020 2020 3e3e 3e20 6672 6f6d  ---.    >>> from
-0000bbf0: 2078 6172 7261 7920 696d 706f 7274 2044   xarray import D
-0000bc00: 6174 6141 7272 6179 0a20 2020 203e 3e3e  ataArray.    >>>
-0000bc10: 2064 615f 6120 3d20 4461 7461 4172 7261   da_a = DataArra
-0000bc20: 7928 0a20 2020 202e 2e2e 2020 2020 206e  y(.    ...     n
-0000bc30: 702e 6172 7261 7928 5b5b 312c 2032 2c20  p.array([[1, 2, 
-0000bc40: 335d 2c20 5b30 2e31 2c20 302e 322c 2030  3], [0.1, 0.2, 0
-0000bc50: 2e33 5d2c 205b 332e 322c 2030 2e36 2c20  .3], [3.2, 0.6, 
-0000bc60: 312e 385d 5d29 2c0a 2020 2020 2e2e 2e20  1.8]]),.    ... 
-0000bc70: 2020 2020 6469 6d73 3d28 2273 7061 6365      dims=("space
-0000bc80: 222c 2022 7469 6d65 2229 2c0a 2020 2020  ", "time"),.    
-0000bc90: 2e2e 2e20 2020 2020 636f 6f72 6473 3d5b  ...     coords=[
-0000bca0: 0a20 2020 202e 2e2e 2020 2020 2020 2020  .    ...        
-0000bcb0: 2028 2273 7061 6365 222c 205b 2249 4122   ("space", ["IA"
-0000bcc0: 2c20 2249 4c22 2c20 2249 4e22 5d29 2c0a  , "IL", "IN"]),.
-0000bcd0: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-0000bce0: 2822 7469 6d65 222c 2070 642e 6461 7465  ("time", pd.date
-0000bcf0: 5f72 616e 6765 2822 3230 3030 2d30 312d  _range("2000-01-
-0000bd00: 3031 222c 2066 7265 713d 2231 4422 2c20  01", freq="1D", 
-0000bd10: 7065 7269 6f64 733d 3329 292c 0a20 2020  periods=3)),.   
-0000bd20: 202e 2e2e 2020 2020 205d 2c0a 2020 2020   ...     ],.    
-0000bd30: 2e2e 2e20 290a 2020 2020 3e3e 3e20 6461  ... ).    >>> da
-0000bd40: 5f61 0a20 2020 203c 7861 7272 6179 2e44  _a.    <xarray.D
-0000bd50: 6174 6141 7272 6179 2028 7370 6163 653a  ataArray (space:
-0000bd60: 2033 2c20 7469 6d65 3a20 3329 3e0a 2020   3, time: 3)>.  
-0000bd70: 2020 6172 7261 7928 5b5b 312e 202c 2032    array([[1. , 2
-0000bd80: 2e20 2c20 332e 205d 2c0a 2020 2020 2020  . , 3. ],.      
-0000bd90: 2020 2020 205b 302e 312c 2030 2e32 2c20       [0.1, 0.2, 
-0000bda0: 302e 335d 2c0a 2020 2020 2020 2020 2020  0.3],.          
-0000bdb0: 205b 332e 322c 2030 2e36 2c20 312e 385d   [3.2, 0.6, 1.8]
-0000bdc0: 5d29 0a20 2020 2043 6f6f 7264 696e 6174  ]).    Coordinat
-0000bdd0: 6573 3a0a 2020 2020 2020 2a20 7370 6163  es:.      * spac
-0000bde0: 6520 2020 2028 7370 6163 6529 203c 5532  e    (space) <U2
-0000bdf0: 2027 4941 2720 2749 4c27 2027 494e 270a   'IA' 'IL' 'IN'.
-0000be00: 2020 2020 2020 2a20 7469 6d65 2020 2020        * time    
-0000be10: 2028 7469 6d65 2920 6461 7465 7469 6d65   (time) datetime
-0000be20: 3634 5b6e 735d 2032 3030 302d 3031 2d30  64[ns] 2000-01-0
-0000be30: 3120 3230 3030 2d30 312d 3032 2032 3030  1 2000-01-02 200
-0000be40: 302d 3031 2d30 330a 2020 2020 3e3e 3e20  0-01-03.    >>> 
-0000be50: 6461 5f62 203d 2044 6174 6141 7272 6179  da_b = DataArray
-0000be60: 280a 2020 2020 2e2e 2e20 2020 2020 6e70  (.    ...     np
-0000be70: 2e61 7272 6179 285b 5b30 2e32 2c20 302e  .array([[0.2, 0.
-0000be80: 342c 2030 2e36 5d2c 205b 3135 2c20 3130  4, 0.6], [15, 10
-0000be90: 2c20 355d 2c20 5b33 2e32 2c20 302e 362c  , 5], [3.2, 0.6,
-0000bea0: 2031 2e38 5d5d 292c 0a20 2020 202e 2e2e   1.8]]),.    ...
-0000beb0: 2020 2020 2064 696d 733d 2822 7370 6163       dims=("spac
-0000bec0: 6522 2c20 2274 696d 6522 292c 0a20 2020  e", "time"),.   
-0000bed0: 202e 2e2e 2020 2020 2063 6f6f 7264 733d   ...     coords=
-0000bee0: 5b0a 2020 2020 2e2e 2e20 2020 2020 2020  [.    ...       
-0000bef0: 2020 2822 7370 6163 6522 2c20 5b22 4941    ("space", ["IA
-0000bf00: 222c 2022 494c 222c 2022 494e 225d 292c  ", "IL", "IN"]),
-0000bf10: 0a20 2020 202e 2e2e 2020 2020 2020 2020  .    ...        
-0000bf20: 2028 2274 696d 6522 2c20 7064 2e64 6174   ("time", pd.dat
-0000bf30: 655f 7261 6e67 6528 2232 3030 302d 3031  e_range("2000-01
-0000bf40: 2d30 3122 2c20 6672 6571 3d22 3144 222c  -01", freq="1D",
-0000bf50: 2070 6572 696f 6473 3d33 2929 2c0a 2020   periods=3)),.  
-0000bf60: 2020 2e2e 2e20 2020 2020 5d2c 0a20 2020    ...     ],.   
-0000bf70: 202e 2e2e 2029 0a20 2020 203e 3e3e 2064   ... ).    >>> d
-0000bf80: 615f 620a 2020 2020 3c78 6172 7261 792e  a_b.    <xarray.
-0000bf90: 4461 7461 4172 7261 7920 2873 7061 6365  DataArray (space
-0000bfa0: 3a20 332c 2074 696d 653a 2033 293e 0a20  : 3, time: 3)>. 
-0000bfb0: 2020 2061 7272 6179 285b 5b20 302e 322c     array([[ 0.2,
-0000bfc0: 2020 302e 342c 2020 302e 365d 2c0a 2020    0.4,  0.6],.  
-0000bfd0: 2020 2020 2020 2020 205b 3135 2e20 2c20           [15. , 
-0000bfe0: 3130 2e20 2c20 2035 2e20 5d2c 0a20 2020  10. ,  5. ],.   
-0000bff0: 2020 2020 2020 2020 5b20 332e 322c 2020          [ 3.2,  
-0000c000: 302e 362c 2020 312e 385d 5d29 0a20 2020  0.6,  1.8]]).   
-0000c010: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
-0000c020: 2020 2020 2a20 7370 6163 6520 2020 2028      * space    (
-0000c030: 7370 6163 6529 203c 5532 2027 4941 2720  space) <U2 'IA' 
-0000c040: 2749 4c27 2027 494e 270a 2020 2020 2020  'IL' 'IN'.      
-0000c050: 2a20 7469 6d65 2020 2020 2028 7469 6d65  * time     (time
-0000c060: 2920 6461 7465 7469 6d65 3634 5b6e 735d  ) datetime64[ns]
-0000c070: 2032 3030 302d 3031 2d30 3120 3230 3030   2000-01-01 2000
-0000c080: 2d30 312d 3032 2032 3030 302d 3031 2d30  -01-02 2000-01-0
-0000c090: 330a 2020 2020 3e3e 3e20 7872 2e63 6f72  3.    >>> xr.cor
-0000c0a0: 7228 6461 5f61 2c20 6461 5f62 290a 2020  r(da_a, da_b).  
-0000c0b0: 2020 3c78 6172 7261 792e 4461 7461 4172    <xarray.DataAr
-0000c0c0: 7261 7920 2829 3e0a 2020 2020 6172 7261  ray ()>.    arra
-0000c0d0: 7928 2d30 2e35 3730 3837 3737 3729 0a20  y(-0.57087777). 
-0000c0e0: 2020 203e 3e3e 2078 722e 636f 7272 2864     >>> xr.corr(d
-0000c0f0: 615f 612c 2064 615f 622c 2064 696d 3d22  a_a, da_b, dim="
-0000c100: 7469 6d65 2229 0a20 2020 203c 7861 7272  time").    <xarr
-0000c110: 6179 2e44 6174 6141 7272 6179 2028 7370  ay.DataArray (sp
-0000c120: 6163 653a 2033 293e 0a20 2020 2061 7272  ace: 3)>.    arr
-0000c130: 6179 285b 2031 2e2c 202d 312e 2c20 2031  ay([ 1., -1.,  1
-0000c140: 2e5d 290a 2020 2020 436f 6f72 6469 6e61  .]).    Coordina
-0000c150: 7465 733a 0a20 2020 2020 202a 2073 7061  tes:.      * spa
-0000c160: 6365 2020 2020 2873 7061 6365 2920 3c55  ce    (space) <U
-0000c170: 3220 2749 4127 2027 494c 2720 2749 4e27  2 'IA' 'IL' 'IN'
-0000c180: 0a20 2020 2022 2222 0a20 2020 2066 726f  .    """.    fro
-0000c190: 6d20 7861 7272 6179 2e63 6f72 652e 6461  m xarray.core.da
-0000c1a0: 7461 6172 7261 7920 696d 706f 7274 2044  taarray import D
-0000c1b0: 6174 6141 7272 6179 0a0a 2020 2020 6966  ataArray..    if
-0000c1c0: 2061 6e79 286e 6f74 2069 7369 6e73 7461   any(not isinsta
-0000c1d0: 6e63 6528 6172 722c 2044 6174 6141 7272  nce(arr, DataArr
-0000c1e0: 6179 2920 666f 7220 6172 7220 696e 205b  ay) for arr in [
-0000c1f0: 6461 5f61 2c20 6461 5f62 5d29 3a0a 2020  da_a, da_b]):.  
-0000c200: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-0000c210: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0000c220: 2020 2022 4f6e 6c79 2078 722e 4461 7461     "Only xr.Data
-0000c230: 4172 7261 7920 6973 2073 7570 706f 7274  Array is support
-0000c240: 6564 2e22 0a20 2020 2020 2020 2020 2020  ed.".           
-0000c250: 2022 4769 7665 6e20 7b7d 2e22 2e66 6f72   "Given {}.".for
-0000c260: 6d61 7428 5b74 7970 6528 6172 7229 2066  mat([type(arr) f
-0000c270: 6f72 2061 7272 2069 6e20 5b64 615f 612c  or arr in [da_a,
-0000c280: 2064 615f 625d 5d29 0a20 2020 2020 2020   da_b]]).       
-0000c290: 2029 0a0a 2020 2020 7265 7475 726e 205f   )..    return _
-0000c2a0: 636f 765f 636f 7272 2864 615f 612c 2064  cov_corr(da_a, d
-0000c2b0: 615f 622c 2064 696d 3d64 696d 2c20 6d65  a_b, dim=dim, me
-0000c2c0: 7468 6f64 3d22 636f 7272 2229 0a0a 0a64  thod="corr")...d
-0000c2d0: 6566 205f 636f 765f 636f 7272 280a 2020  ef _cov_corr(.  
-0000c2e0: 2020 6461 5f61 3a20 545f 4461 7461 4172    da_a: T_DataAr
-0000c2f0: 7261 792c 0a20 2020 2064 615f 623a 2054  ray,.    da_b: T
-0000c300: 5f44 6174 6141 7272 6179 2c0a 2020 2020  _DataArray,.    
-0000c310: 6469 6d3a 2044 696d 7320 3d20 4e6f 6e65  dim: Dims = None
-0000c320: 2c0a 2020 2020 6464 6f66 3a20 696e 7420  ,.    ddof: int 
-0000c330: 3d20 302c 0a20 2020 206d 6574 686f 643a  = 0,.    method:
-0000c340: 204c 6974 6572 616c 5b22 636f 7622 2c20   Literal["cov", 
-0000c350: 2263 6f72 7222 2c20 4e6f 6e65 5d20 3d20  "corr", None] = 
-0000c360: 4e6f 6e65 2c0a 2920 2d3e 2054 5f44 6174  None,.) -> T_Dat
-0000c370: 6141 7272 6179 3a0a 2020 2020 2222 220a  aArray:.    """.
-0000c380: 2020 2020 496e 7465 726e 616c 206d 6574      Internal met
-0000c390: 686f 6420 666f 7220 7872 2e63 6f76 2829  hod for xr.cov()
-0000c3a0: 2061 6e64 2078 722e 636f 7272 2829 2073   and xr.corr() s
-0000c3b0: 6f20 6f6e 6c79 2068 6176 6520 746f 0a20  o only have to. 
-0000c3c0: 2020 2073 616e 6974 697a 6520 7468 6520     sanitize the 
-0000c3d0: 696e 7075 7420 6172 7261 7973 206f 6e63  input arrays onc
-0000c3e0: 6520 616e 6420 7765 2064 6f6e 2774 2072  e and we don't r
-0000c3f0: 6570 6561 7420 636f 6465 2e0a 2020 2020  epeat code..    
-0000c400: 2222 220a 2020 2020 2320 312e 2042 726f  """.    # 1. Bro
-0000c410: 6164 6361 7374 2074 6865 2074 776f 2061  adcast the two a
-0000c420: 7272 6179 730a 2020 2020 6461 5f61 2c20  rrays.    da_a, 
-0000c430: 6461 5f62 203d 2061 6c69 676e 2864 615f  da_b = align(da_
-0000c440: 612c 2064 615f 622c 206a 6f69 6e3d 2269  a, da_b, join="i
-0000c450: 6e6e 6572 222c 2063 6f70 793d 4661 6c73  nner", copy=Fals
-0000c460: 6529 0a0a 2020 2020 2320 322e 2049 676e  e)..    # 2. Ign
-0000c470: 6f72 6520 7468 6520 6e61 6e73 0a20 2020  ore the nans.   
-0000c480: 2076 616c 6964 5f76 616c 7565 7320 3d20   valid_values = 
-0000c490: 6461 5f61 2e6e 6f74 6e75 6c6c 2829 2026  da_a.notnull() &
-0000c4a0: 2064 615f 622e 6e6f 746e 756c 6c28 290a   da_b.notnull().
-0000c4b0: 2020 2020 6461 5f61 203d 2064 615f 612e      da_a = da_a.
-0000c4c0: 7768 6572 6528 7661 6c69 645f 7661 6c75  where(valid_valu
-0000c4d0: 6573 290a 2020 2020 6461 5f62 203d 2064  es).    da_b = d
-0000c4e0: 615f 622e 7768 6572 6528 7661 6c69 645f  a_b.where(valid_
-0000c4f0: 7661 6c75 6573 290a 2020 2020 7661 6c69  values).    vali
-0000c500: 645f 636f 756e 7420 3d20 7661 6c69 645f  d_count = valid_
-0000c510: 7661 6c75 6573 2e73 756d 2864 696d 2920  values.sum(dim) 
-0000c520: 2d20 6464 6f66 0a0a 2020 2020 2320 332e  - ddof..    # 3.
-0000c530: 2044 6574 7265 6e64 2061 6c6f 6e67 2074   Detrend along t
-0000c540: 6865 2067 6976 656e 2064 696d 0a20 2020  he given dim.   
-0000c550: 2064 656d 6561 6e65 645f 6461 5f61 203d   demeaned_da_a =
-0000c560: 2064 615f 6120 2d20 6461 5f61 2e6d 6561   da_a - da_a.mea
-0000c570: 6e28 6469 6d3d 6469 6d29 0a20 2020 2064  n(dim=dim).    d
-0000c580: 656d 6561 6e65 645f 6461 5f62 203d 2064  emeaned_da_b = d
-0000c590: 615f 6220 2d20 6461 5f62 2e6d 6561 6e28  a_b - da_b.mean(
-0000c5a0: 6469 6d3d 6469 6d29 0a0a 2020 2020 2320  dim=dim)..    # 
-0000c5b0: 342e 2043 6f6d 7075 7465 2063 6f76 6172  4. Compute covar
-0000c5c0: 6961 6e63 6520 616c 6f6e 6720 7468 6520  iance along the 
-0000c5d0: 6769 7665 6e20 6469 6d0a 2020 2020 2320  given dim.    # 
-0000c5e0: 4e2e 422e 2060 736b 6970 6e61 3d54 7275  N.B. `skipna=Tru
-0000c5f0: 6560 2069 7320 7265 7175 6972 6564 206f  e` is required o
-0000c600: 7220 6175 746f 2d63 6f76 6172 6961 6e63  r auto-covarianc
-0000c610: 6520 6973 2063 6f6d 7075 7465 6420 696e  e is computed in
-0000c620: 636f 7272 6563 746c 792e 2045 2e67 2e0a  correctly. E.g..
-0000c630: 2020 2020 2320 5472 7920 7872 2e63 6f76      # Try xr.cov
-0000c640: 2864 612c 6461 2920 666f 7220 6461 203d  (da,da) for da =
-0000c650: 2078 722e 4461 7461 4172 7261 7928 5b5b   xr.DataArray([[
-0000c660: 312c 2032 5d2c 205b 312c 206e 702e 6e61  1, 2], [1, np.na
-0000c670: 6e5d 5d2c 2064 696d 733d 5b22 7822 2c20  n]], dims=["x", 
-0000c680: 2274 696d 6522 5d29 0a20 2020 2063 6f76  "time"]).    cov
-0000c690: 203d 2028 6465 6d65 616e 6564 5f64 615f   = (demeaned_da_
-0000c6a0: 612e 636f 6e6a 2829 202a 2064 656d 6561  a.conj() * demea
-0000c6b0: 6e65 645f 6461 5f62 292e 7375 6d28 0a20  ned_da_b).sum(. 
-0000c6c0: 2020 2020 2020 2064 696d 3d64 696d 2c20         dim=dim, 
-0000c6d0: 736b 6970 6e61 3d54 7275 652c 206d 696e  skipna=True, min
-0000c6e0: 5f63 6f75 6e74 3d31 0a20 2020 2029 202f  _count=1.    ) /
-0000c6f0: 2028 7661 6c69 645f 636f 756e 7429 0a0a   (valid_count)..
-0000c700: 2020 2020 6966 206d 6574 686f 6420 3d3d      if method ==
-0000c710: 2022 636f 7622 3a0a 2020 2020 2020 2020   "cov":.        
-0000c720: 7265 7475 726e 2063 6f76 2020 2320 7479  return cov  # ty
-0000c730: 7065 3a20 6967 6e6f 7265 5b72 6574 7572  pe: ignore[retur
-0000c740: 6e2d 7661 6c75 655d 0a0a 2020 2020 656c  n-value]..    el
-0000c750: 7365 3a0a 2020 2020 2020 2020 2320 636f  se:.        # co
-0000c760: 6d70 7574 6520 7374 6420 2b20 636f 7272  mpute std + corr
-0000c770: 0a20 2020 2020 2020 2064 615f 615f 7374  .        da_a_st
-0000c780: 6420 3d20 6461 5f61 2e73 7464 2864 696d  d = da_a.std(dim
-0000c790: 3d64 696d 290a 2020 2020 2020 2020 6461  =dim).        da
-0000c7a0: 5f62 5f73 7464 203d 2064 615f 622e 7374  _b_std = da_b.st
-0000c7b0: 6428 6469 6d3d 6469 6d29 0a20 2020 2020  d(dim=dim).     
-0000c7c0: 2020 2063 6f72 7220 3d20 636f 7620 2f20     corr = cov / 
-0000c7d0: 2864 615f 615f 7374 6420 2a20 6461 5f62  (da_a_std * da_b
-0000c7e0: 5f73 7464 290a 2020 2020 2020 2020 7265  _std).        re
-0000c7f0: 7475 726e 2063 6f72 7220 2023 2074 7970  turn corr  # typ
-0000c800: 653a 2069 676e 6f72 655b 7265 7475 726e  e: ignore[return
-0000c810: 2d76 616c 7565 5d0a 0a0a 6465 6620 6372  -value]...def cr
-0000c820: 6f73 7328 0a20 2020 2061 3a20 4461 7461  oss(.    a: Data
+00006380: 2072 6574 7572 6e20 7265 730a 0a20 2020   return res..   
+00006390: 2020 2020 2065 6c69 6620 6461 736b 203d       elif dask =
+000063a0: 3d20 2261 6c6c 6f77 6564 223a 0a20 2020  = "allowed":.   
+000063b0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+000063c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000063d0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+000063e0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+000063f0: 2020 2020 2020 2020 2020 2275 6e6b 6e6f            "unkno
+00006400: 776e 2073 6574 7469 6e67 2066 6f72 2064  wn setting for d
+00006410: 6173 6b20 6172 7261 7920 6861 6e64 6c69  ask array handli
+00006420: 6e67 2069 6e20 220a 2020 2020 2020 2020  ng in ".        
+00006430: 2020 2020 2020 2020 2261 7070 6c79 5f75          "apply_u
+00006440: 6675 6e63 3a20 7b7d 222e 666f 726d 6174  func: {}".format
+00006450: 2864 6173 6b29 0a20 2020 2020 2020 2020  (dask).         
+00006460: 2020 2029 0a20 2020 2065 6c73 653a 0a20     ).    else:. 
+00006470: 2020 2020 2020 2069 6620 7665 6374 6f72         if vector
+00006480: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
+00006490: 2066 756e 6320 3d20 5f76 6563 746f 7269   func = _vectori
+000064a0: 7a65 280a 2020 2020 2020 2020 2020 2020  ze(.            
+000064b0: 2020 2020 6675 6e63 2c20 7369 676e 6174      func, signat
+000064c0: 7572 652c 206f 7574 7075 745f 6474 7970  ure, output_dtyp
+000064d0: 6573 3d6f 7574 7075 745f 6474 7970 6573  es=output_dtypes
+000064e0: 2c20 6578 636c 7564 655f 6469 6d73 3d65  , exclude_dims=e
+000064f0: 7863 6c75 6465 5f64 696d 730a 2020 2020  xclude_dims.    
+00006500: 2020 2020 2020 2020 290a 0a20 2020 2072          )..    r
+00006510: 6573 756c 745f 6461 7461 203d 2066 756e  esult_data = fun
+00006520: 6328 2a69 6e70 7574 5f64 6174 6129 0a0a  c(*input_data)..
+00006530: 2020 2020 6966 2073 6967 6e61 7475 7265      if signature
+00006540: 2e6e 756d 5f6f 7574 7075 7473 203d 3d20  .num_outputs == 
+00006550: 313a 0a20 2020 2020 2020 2072 6573 756c  1:.        resul
+00006560: 745f 6461 7461 203d 2028 7265 7375 6c74  t_data = (result
+00006570: 5f64 6174 612c 290a 2020 2020 656c 6966  _data,).    elif
+00006580: 2028 0a20 2020 2020 2020 206e 6f74 2069   (.        not i
+00006590: 7369 6e73 7461 6e63 6528 7265 7375 6c74  sinstance(result
+000065a0: 5f64 6174 612c 2074 7570 6c65 2920 6f72  _data, tuple) or
+000065b0: 206c 656e 2872 6573 756c 745f 6461 7461   len(result_data
+000065c0: 2920 213d 2073 6967 6e61 7475 7265 2e6e  ) != signature.n
+000065d0: 756d 5f6f 7574 7075 7473 0a20 2020 2029  um_outputs.    )
+000065e0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+000065f0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00006600: 2020 2020 2020 2020 2261 7070 6c69 6564          "applied
+00006610: 2066 756e 6374 696f 6e20 646f 6573 206e   function does n
+00006620: 6f74 2068 6176 6520 7468 6520 6e75 6d62  ot have the numb
+00006630: 6572 206f 6620 220a 2020 2020 2020 2020  er of ".        
+00006640: 2020 2020 226f 7574 7075 7473 2073 7065      "outputs spe
+00006650: 6369 6669 6564 2069 6e20 7468 6520 7566  cified in the uf
+00006660: 756e 6320 7369 676e 6174 7572 652e 2022  unc signature. "
+00006670: 0a20 2020 2020 2020 2020 2020 2022 5265  .            "Re
+00006680: 7375 6c74 2069 7320 6e6f 7420 6120 7475  sult is not a tu
+00006690: 706c 6520 6f66 207b 7d20 656c 656d 656e  ple of {} elemen
+000066a0: 7473 3a20 7b21 727d 222e 666f 726d 6174  ts: {!r}".format
+000066b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000066c0: 2020 7369 676e 6174 7572 652e 6e75 6d5f    signature.num_
+000066d0: 6f75 7470 7574 732c 2072 6573 756c 745f  outputs, result_
+000066e0: 6461 7461 0a20 2020 2020 2020 2020 2020  data.           
+000066f0: 2029 0a20 2020 2020 2020 2029 0a0a 2020   ).        )..  
+00006700: 2020 6f62 6a73 203d 205f 616c 6c5f 6f66    objs = _all_of
+00006710: 5f74 7970 6528 6172 6773 2c20 5661 7269  _type(args, Vari
+00006720: 6162 6c65 290a 2020 2020 6174 7472 7320  able).    attrs 
+00006730: 3d20 6d65 7267 655f 6174 7472 7328 0a20  = merge_attrs(. 
+00006740: 2020 2020 2020 205b 6f62 6a2e 6174 7472         [obj.attr
+00006750: 7320 666f 7220 6f62 6a20 696e 206f 626a  s for obj in obj
+00006760: 735d 2c0a 2020 2020 2020 2020 636f 6d62  s],.        comb
+00006770: 696e 655f 6174 7472 733d 6b65 6570 5f61  ine_attrs=keep_a
+00006780: 7474 7273 2c0a 2020 2020 290a 0a20 2020  ttrs,.    )..   
+00006790: 206f 7574 7075 743a 206c 6973 745b 5661   output: list[Va
+000067a0: 7269 6162 6c65 5d20 3d20 5b5d 0a20 2020  riable] = [].   
+000067b0: 2066 6f72 2064 696d 732c 2064 6174 6120   for dims, data 
+000067c0: 696e 207a 6970 286f 7574 7075 745f 6469  in zip(output_di
+000067d0: 6d73 2c20 7265 7375 6c74 5f64 6174 6129  ms, result_data)
+000067e0: 3a0a 2020 2020 2020 2020 6461 7461 203d  :.        data =
+000067f0: 2061 735f 636f 6d70 6174 6962 6c65 5f64   as_compatible_d
+00006800: 6174 6128 6461 7461 290a 2020 2020 2020  ata(data).      
+00006810: 2020 6966 2064 6174 612e 6e64 696d 2021    if data.ndim !
+00006820: 3d20 6c65 6e28 6469 6d73 293a 0a20 2020  = len(dims):.   
+00006830: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00006840: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00006850: 2020 2020 2020 2020 2020 2022 6170 706c             "appl
+00006860: 6965 6420 6675 6e63 7469 6f6e 2072 6574  ied function ret
+00006870: 7572 6e65 6420 6461 7461 2077 6974 6820  urned data with 
+00006880: 756e 6578 7065 6374 6564 2022 0a20 2020  unexpected ".   
+00006890: 2020 2020 2020 2020 2020 2020 2066 226e               f"n
+000068a0: 756d 6265 7220 6f66 2064 696d 656e 7369  umber of dimensi
+000068b0: 6f6e 732e 2052 6563 6569 7665 6420 7b64  ons. Received {d
+000068c0: 6174 612e 6e64 696d 7d20 6469 6d65 6e73  ata.ndim} dimens
+000068d0: 696f 6e28 7329 2062 7574 2022 0a20 2020  ion(s) but ".   
+000068e0: 2020 2020 2020 2020 2020 2020 2066 2265               f"e
+000068f0: 7870 6563 7465 6420 7b6c 656e 2864 696d  xpected {len(dim
+00006900: 7329 7d20 6469 6d65 6e73 696f 6e73 2077  s)} dimensions w
+00006910: 6974 6820 6e61 6d65 733a 207b 6469 6d73  ith names: {dims
+00006920: 2172 7d22 0a20 2020 2020 2020 2020 2020  !r}".           
+00006930: 2029 0a0a 2020 2020 2020 2020 7661 7220   )..        var 
+00006940: 3d20 5661 7269 6162 6c65 2864 696d 732c  = Variable(dims,
+00006950: 2064 6174 612c 2066 6173 7470 6174 683d   data, fastpath=
+00006960: 5472 7565 290a 2020 2020 2020 2020 666f  True).        fo
+00006970: 7220 6469 6d2c 206e 6577 5f73 697a 6520  r dim, new_size 
+00006980: 696e 2076 6172 2e73 697a 6573 2e69 7465  in var.sizes.ite
+00006990: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+000069a0: 2020 6966 2064 696d 2069 6e20 6469 6d5f    if dim in dim_
+000069b0: 7369 7a65 7320 616e 6420 6e65 775f 7369  sizes and new_si
+000069c0: 7a65 2021 3d20 6469 6d5f 7369 7a65 735b  ze != dim_sizes[
+000069d0: 6469 6d5d 3a0a 2020 2020 2020 2020 2020  dim]:.          
+000069e0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+000069f0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00006a00: 2020 2020 2020 2020 2020 2020 2273 697a              "siz
+00006a10: 6520 6f66 2064 696d 656e 7369 6f6e 207b  e of dimension {
+00006a20: 2172 7d20 6f6e 2069 6e70 7574 7320 7761  !r} on inputs wa
+00006a30: 7320 756e 6578 7065 6374 6564 6c79 2022  s unexpectedly "
+00006a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006a50: 2020 2020 2022 6368 616e 6765 6420 6279       "changed by
+00006a60: 2061 7070 6c69 6564 2066 756e 6374 696f   applied functio
+00006a70: 6e20 6672 6f6d 207b 7d20 746f 207b 7d2e  n from {} to {}.
+00006a80: 204f 6e6c 7920 220a 2020 2020 2020 2020   Only ".        
+00006a90: 2020 2020 2020 2020 2020 2020 2264 696d              "dim
+00006aa0: 656e 7369 6f6e 7320 7370 6563 6966 6965  ensions specifie
+00006ab0: 6420 696e 2060 6065 7863 6c75 6465 5f64  d in ``exclude_d
+00006ac0: 696d 7360 6020 7769 7468 2022 0a20 2020  ims`` with ".   
+00006ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ae0: 2022 7861 7272 6179 2e61 7070 6c79 5f75   "xarray.apply_u
+00006af0: 6675 6e63 2061 7265 2061 6c6c 6f77 6564  func are allowed
+00006b00: 2074 6f20 6368 616e 6765 2073 697a 652e   to change size.
+00006b10: 222e 666f 726d 6174 280a 2020 2020 2020  ".format(.      
+00006b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b30: 2020 6469 6d2c 2064 696d 5f73 697a 6573    dim, dim_sizes
+00006b40: 5b64 696d 5d2c 206e 6577 5f73 697a 650a  [dim], new_size.
+00006b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b60: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00006b70: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00006b80: 2076 6172 2e61 7474 7273 203d 2061 7474   var.attrs = att
+00006b90: 7273 0a20 2020 2020 2020 206f 7574 7075  rs.        outpu
+00006ba0: 742e 6170 7065 6e64 2876 6172 290a 0a20  t.append(var).. 
+00006bb0: 2020 2069 6620 7369 676e 6174 7572 652e     if signature.
+00006bc0: 6e75 6d5f 6f75 7470 7574 7320 3d3d 2031  num_outputs == 1
+00006bd0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00006be0: 206f 7574 7075 745b 305d 0a20 2020 2065   output[0].    e
+00006bf0: 6c73 653a 0a20 2020 2020 2020 2072 6574  lse:.        ret
+00006c00: 7572 6e20 7475 706c 6528 6f75 7470 7574  urn tuple(output
+00006c10: 290a 0a0a 6465 6620 6170 706c 795f 6172  )...def apply_ar
+00006c20: 7261 795f 7566 756e 6328 6675 6e63 2c20  ray_ufunc(func, 
+00006c30: 2a61 7267 732c 2064 6173 6b3d 2266 6f72  *args, dask="for
+00006c40: 6269 6464 656e 2229 3a0a 2020 2020 2222  bidden"):.    ""
+00006c50: 2241 7070 6c79 2061 206e 6461 7272 6179  "Apply a ndarray
+00006c60: 206c 6576 656c 2066 756e 6374 696f 6e20   level function 
+00006c70: 6f76 6572 206e 6461 7272 6179 206f 626a  over ndarray obj
+00006c80: 6563 7473 2e22 2222 0a20 2020 2069 6620  ects.""".    if 
+00006c90: 616e 7928 6973 5f64 7563 6b5f 6461 736b  any(is_duck_dask
+00006ca0: 5f61 7272 6179 2861 7267 2920 666f 7220  _array(arg) for 
+00006cb0: 6172 6720 696e 2061 7267 7329 3a0a 2020  arg in args):.  
+00006cc0: 2020 2020 2020 6966 2064 6173 6b20 3d3d        if dask ==
+00006cd0: 2022 666f 7262 6964 6465 6e22 3a0a 2020   "forbidden":.  
+00006ce0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00006cf0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00006d00: 2020 2020 2020 2020 2020 2020 2261 7070              "app
+00006d10: 6c79 5f75 6675 6e63 2065 6e63 6f75 6e74  ly_ufunc encount
+00006d20: 6572 6564 2061 2064 6173 6b20 6172 7261  ered a dask arra
+00006d30: 7920 6f6e 2061 6e20 220a 2020 2020 2020  y on an ".      
+00006d40: 2020 2020 2020 2020 2020 2261 7267 756d            "argum
+00006d50: 656e 742c 2062 7574 2068 616e 646c 696e  ent, but handlin
+00006d60: 6720 666f 7220 6461 736b 2061 7272 6179  g for dask array
+00006d70: 7320 6861 7320 6e6f 7420 220a 2020 2020  s has not ".    
+00006d80: 2020 2020 2020 2020 2020 2020 2262 6565              "bee
+00006d90: 6e20 656e 6162 6c65 642e 2045 6974 6865  n enabled. Eithe
+00006da0: 7220 7365 7420 7468 6520 6060 6461 736b  r set the ``dask
+00006db0: 6060 2061 7267 756d 656e 7420 220a 2020  `` argument ".  
+00006dc0: 2020 2020 2020 2020 2020 2020 2020 226f                "o
+00006dd0: 7220 6c6f 6164 2079 6f75 7220 6461 7461  r load your data
+00006de0: 2069 6e74 6f20 6d65 6d6f 7279 2066 6972   into memory fir
+00006df0: 7374 2077 6974 6820 220a 2020 2020 2020  st with ".      
+00006e00: 2020 2020 2020 2020 2020 2260 602e 6c6f            "``.lo
+00006e10: 6164 2829 6060 206f 7220 6060 2e63 6f6d  ad()`` or ``.com
+00006e20: 7075 7465 2829 6060 220a 2020 2020 2020  pute()``".      
+00006e30: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00006e40: 656c 6966 2064 6173 6b20 3d3d 2022 7061  elif dask == "pa
+00006e50: 7261 6c6c 656c 697a 6564 223a 0a20 2020  rallelized":.   
+00006e60: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00006e70: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00006e80: 2020 2020 2020 2020 2020 2022 6361 6e6e             "cann
+00006e90: 6f74 2075 7365 2064 6173 6b3d 2770 6172  ot use dask='par
+00006ea0: 616c 6c65 6c69 7a65 6427 2066 6f72 2061  allelized' for a
+00006eb0: 7070 6c79 5f75 6675 6e63 2022 0a20 2020  pply_ufunc ".   
+00006ec0: 2020 2020 2020 2020 2020 2020 2022 756e               "un
+00006ed0: 6c65 7373 2061 7420 6c65 6173 7420 6f6e  less at least on
+00006ee0: 6520 696e 7075 7420 6973 2061 6e20 7861  e input is an xa
+00006ef0: 7272 6179 206f 626a 6563 7422 0a20 2020  rray object".   
+00006f00: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00006f10: 2020 2065 6c69 6620 6461 736b 203d 3d20     elif dask == 
+00006f20: 2261 6c6c 6f77 6564 223a 0a20 2020 2020  "allowed":.     
+00006f30: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+00006f40: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00006f50: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00006f60: 6545 7272 6f72 2866 2275 6e6b 6e6f 776e  eError(f"unknown
+00006f70: 2073 6574 7469 6e67 2066 6f72 2064 6173   setting for das
+00006f80: 6b20 6172 7261 7920 6861 6e64 6c69 6e67  k array handling
+00006f90: 3a20 7b64 6173 6b7d 2229 0a20 2020 2072  : {dask}").    r
+00006fa0: 6574 7572 6e20 6675 6e63 282a 6172 6773  eturn func(*args
+00006fb0: 290a 0a0a 6465 6620 6170 706c 795f 7566  )...def apply_uf
+00006fc0: 756e 6328 0a20 2020 2066 756e 633a 2043  unc(.    func: C
+00006fd0: 616c 6c61 626c 652c 0a20 2020 202a 6172  allable,.    *ar
+00006fe0: 6773 3a20 416e 792c 0a20 2020 2069 6e70  gs: Any,.    inp
+00006ff0: 7574 5f63 6f72 655f 6469 6d73 3a20 5365  ut_core_dims: Se
+00007000: 7175 656e 6365 5b53 6571 7565 6e63 655d  quence[Sequence]
+00007010: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00007020: 2020 2020 6f75 7470 7574 5f63 6f72 655f      output_core_
+00007030: 6469 6d73 3a20 5365 7175 656e 6365 5b53  dims: Sequence[S
+00007040: 6571 7565 6e63 655d 207c 204e 6f6e 6520  equence] | None 
+00007050: 3d20 2828 292c 292c 0a20 2020 2065 7863  = ((),),.    exc
+00007060: 6c75 6465 5f64 696d 733a 2053 6574 203d  lude_dims: Set =
+00007070: 2066 726f 7a65 6e73 6574 2829 2c0a 2020   frozenset(),.  
+00007080: 2020 7665 6374 6f72 697a 653a 2062 6f6f    vectorize: boo
+00007090: 6c20 3d20 4661 6c73 652c 0a20 2020 206a  l = False,.    j
+000070a0: 6f69 6e3a 204a 6f69 6e4f 7074 696f 6e73  oin: JoinOptions
+000070b0: 203d 2022 6578 6163 7422 2c0a 2020 2020   = "exact",.    
+000070c0: 6461 7461 7365 745f 6a6f 696e 3a20 7374  dataset_join: st
+000070d0: 7220 3d20 2265 7861 6374 222c 0a20 2020  r = "exact",.   
+000070e0: 2064 6174 6173 6574 5f66 696c 6c5f 7661   dataset_fill_va
+000070f0: 6c75 653a 206f 626a 6563 7420 3d20 5f4e  lue: object = _N
+00007100: 4f5f 4649 4c4c 5f56 414c 5545 2c0a 2020  O_FILL_VALUE,.  
+00007110: 2020 6b65 6570 5f61 7474 7273 3a20 626f    keep_attrs: bo
+00007120: 6f6c 207c 2073 7472 207c 204e 6f6e 6520  ol | str | None 
+00007130: 3d20 4e6f 6e65 2c0a 2020 2020 6b77 6172  = None,.    kwar
+00007140: 6773 3a20 4d61 7070 696e 6720 7c20 4e6f  gs: Mapping | No
+00007150: 6e65 203d 204e 6f6e 652c 0a20 2020 2064  ne = None,.    d
+00007160: 6173 6b3a 2073 7472 203d 2022 666f 7262  ask: str = "forb
+00007170: 6964 6465 6e22 2c0a 2020 2020 6f75 7470  idden",.    outp
+00007180: 7574 5f64 7479 7065 733a 2053 6571 7565  ut_dtypes: Seque
+00007190: 6e63 6520 7c20 4e6f 6e65 203d 204e 6f6e  nce | None = Non
+000071a0: 652c 0a20 2020 206f 7574 7075 745f 7369  e,.    output_si
+000071b0: 7a65 733a 204d 6170 7069 6e67 5b41 6e79  zes: Mapping[Any
+000071c0: 2c20 696e 745d 207c 204e 6f6e 6520 3d20  , int] | None = 
+000071d0: 4e6f 6e65 2c0a 2020 2020 6d65 7461 3a20  None,.    meta: 
+000071e0: 416e 7920 3d20 4e6f 6e65 2c0a 2020 2020  Any = None,.    
+000071f0: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
+00007200: 6773 3a20 6469 6374 5b73 7472 2c20 416e  gs: dict[str, An
+00007210: 795d 207c 204e 6f6e 6520 3d20 4e6f 6e65  y] | None = None
+00007220: 2c0a 2920 2d3e 2041 6e79 3a0a 2020 2020  ,.) -> Any:.    
+00007230: 2222 2241 7070 6c79 2061 2076 6563 746f  """Apply a vecto
+00007240: 7269 7a65 6420 6675 6e63 7469 6f6e 2066  rized function f
+00007250: 6f72 2075 6e6c 6162 656c 6564 2061 7272  or unlabeled arr
+00007260: 6179 7320 6f6e 2078 6172 7261 7920 6f62  ays on xarray ob
+00007270: 6a65 6374 732e 0a0a 2020 2020 5468 6520  jects...    The 
+00007280: 6675 6e63 7469 6f6e 2077 696c 6c20 6265  function will be
+00007290: 206d 6170 7065 6420 6f76 6572 2074 6865   mapped over the
+000072a0: 2064 6174 6120 7661 7269 6162 6c65 2873   data variable(s
+000072b0: 2920 6f66 2074 6865 2069 6e70 7574 0a20  ) of the input. 
+000072c0: 2020 2061 7267 756d 656e 7473 2075 7369     arguments usi
+000072d0: 6e67 2078 6172 7261 7927 7320 7374 616e  ng xarray's stan
+000072e0: 6461 7264 2072 756c 6573 2066 6f72 206c  dard rules for l
+000072f0: 6162 656c 6564 2063 6f6d 7075 7461 7469  abeled computati
+00007300: 6f6e 2c20 696e 636c 7564 696e 670a 2020  on, including.  
+00007310: 2020 616c 6967 6e6d 656e 742c 2062 726f    alignment, bro
+00007320: 6164 6361 7374 696e 672c 206c 6f6f 7069  adcasting, loopi
+00007330: 6e67 206f 7665 7220 4772 6f75 7042 792f  ng over GroupBy/
+00007340: 4461 7461 7365 7420 7661 7269 6162 6c65  Dataset variable
+00007350: 732c 2061 6e64 0a20 2020 206d 6572 6769  s, and.    mergi
+00007360: 6e67 206f 6620 636f 6f72 6469 6e61 7465  ng of coordinate
+00007370: 732e 0a0a 2020 2020 5061 7261 6d65 7465  s...    Paramete
+00007380: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00007390: 2d0a 2020 2020 6675 6e63 203a 2063 616c  -.    func : cal
+000073a0: 6c61 626c 650a 2020 2020 2020 2020 4675  lable.        Fu
+000073b0: 6e63 7469 6f6e 2074 6f20 6361 6c6c 206c  nction to call l
+000073c0: 696b 6520 6060 6675 6e63 282a 6172 6773  ike ``func(*args
+000073d0: 2c20 2a2a 6b77 6172 6773 2960 6020 6f6e  , **kwargs)`` on
+000073e0: 2075 6e6c 6162 656c 6564 2061 7272 6179   unlabeled array
+000073f0: 730a 2020 2020 2020 2020 2860 602e 6461  s.        (``.da
+00007400: 7461 6060 2920 7468 6174 2072 6574 7572  ta``) that retur
+00007410: 6e73 2061 6e20 6172 7261 7920 6f72 2074  ns an array or t
+00007420: 7570 6c65 206f 6620 6172 7261 7973 2e20  uple of arrays. 
+00007430: 4966 206d 756c 7469 706c 650a 2020 2020  If multiple.    
+00007440: 2020 2020 6172 6775 6d65 6e74 7320 7769      arguments wi
+00007450: 7468 206e 6f6e 2d6d 6174 6368 696e 6720  th non-matching 
+00007460: 6469 6d65 6e73 696f 6e73 2061 7265 2073  dimensions are s
+00007470: 7570 706c 6965 642c 2074 6869 7320 6675  upplied, this fu
+00007480: 6e63 7469 6f6e 2069 730a 2020 2020 2020  nction is.      
+00007490: 2020 6578 7065 6374 6564 2074 6f20 7665    expected to ve
+000074a0: 6374 6f72 697a 6520 2862 726f 6164 6361  ctorize (broadca
+000074b0: 7374 2920 6f76 6572 2061 7865 7320 6f66  st) over axes of
+000074c0: 2070 6f73 6974 696f 6e61 6c20 6172 6775   positional argu
+000074d0: 6d65 6e74 7320 696e 0a20 2020 2020 2020  ments in.       
+000074e0: 2074 6865 2073 7479 6c65 206f 6620 4e75   the style of Nu
+000074f0: 6d50 7920 756e 6976 6572 7361 6c20 6675  mPy universal fu
+00007500: 6e63 7469 6f6e 7320 5b31 5d5f 2028 6966  nctions [1]_ (if
+00007510: 2074 6869 7320 6973 206e 6f74 2074 6865   this is not the
+00007520: 2063 6173 652c 0a20 2020 2020 2020 2073   case,.        s
+00007530: 6574 2060 6076 6563 746f 7269 7a65 3d54  et ``vectorize=T
+00007540: 7275 6560 6029 2e20 4966 2074 6869 7320  rue``). If this 
+00007550: 6675 6e63 7469 6f6e 2072 6574 7572 6e73  function returns
+00007560: 206d 756c 7469 706c 6520 6f75 7470 7574   multiple output
+00007570: 732c 2079 6f75 0a20 2020 2020 2020 206d  s, you.        m
+00007580: 7573 7420 7365 7420 6060 6f75 7470 7574  ust set ``output
+00007590: 5f63 6f72 655f 6469 6d73 6060 2061 7320  _core_dims`` as 
+000075a0: 7765 6c6c 2e0a 2020 2020 2a61 7267 7320  well..    *args 
+000075b0: 3a20 4461 7461 7365 742c 2044 6174 6141  : Dataset, DataA
+000075c0: 7272 6179 2c20 4461 7461 4172 7261 7947  rray, DataArrayG
+000075d0: 726f 7570 4279 2c20 4461 7461 7365 7447  roupBy, DatasetG
+000075e0: 726f 7570 4279 2c20 5661 7269 6162 6c65  roupBy, Variable
+000075f0: 2c20 5c0a 2020 2020 2020 2020 6e75 6d70  , \.        nump
+00007600: 792e 6e64 6172 7261 792c 2064 6173 6b2e  y.ndarray, dask.
+00007610: 6172 7261 792e 4172 7261 7920 6f72 2073  array.Array or s
+00007620: 6361 6c61 720a 2020 2020 2020 2020 4d69  calar.        Mi
+00007630: 7820 6f66 206c 6162 656c 6564 2061 6e64  x of labeled and
+00007640: 2f6f 7220 756e 6c61 6265 6c65 6420 6172  /or unlabeled ar
+00007650: 7261 7973 2074 6f20 7768 6963 6820 746f  rays to which to
+00007660: 2061 7070 6c79 2074 6865 2066 756e 6374   apply the funct
+00007670: 696f 6e2e 0a20 2020 2069 6e70 7574 5f63  ion..    input_c
+00007680: 6f72 655f 6469 6d73 203a 2073 6571 7565  ore_dims : seque
+00007690: 6e63 6520 6f66 2073 6571 7565 6e63 652c  nce of sequence,
+000076a0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+000076b0: 2020 4c69 7374 206f 6620 7468 6520 7361    List of the sa
+000076c0: 6d65 206c 656e 6774 6820 6173 2060 6061  me length as ``a
+000076d0: 7267 7360 6020 6769 7669 6e67 2074 6865  rgs`` giving the
+000076e0: 206c 6973 7420 6f66 2063 6f72 6520 6469   list of core di
+000076f0: 6d65 6e73 696f 6e73 0a20 2020 2020 2020  mensions.       
+00007700: 206f 6e20 6561 6368 2069 6e70 7574 2061   on each input a
+00007710: 7267 756d 656e 7420 7468 6174 2073 686f  rgument that sho
+00007720: 756c 6420 6e6f 7420 6265 2062 726f 6164  uld not be broad
+00007730: 6361 7374 2e20 4279 2064 6566 6175 6c74  cast. By default
+00007740: 2c20 7765 0a20 2020 2020 2020 2061 7373  , we.        ass
+00007750: 756d 6520 7468 6572 6520 6172 6520 6e6f  ume there are no
+00007760: 2063 6f72 6520 6469 6d65 6e73 696f 6e73   core dimensions
+00007770: 206f 6e20 616e 7920 696e 7075 7420 6172   on any input ar
+00007780: 6775 6d65 6e74 732e 0a0a 2020 2020 2020  guments...      
+00007790: 2020 466f 7220 6578 616d 706c 652c 2060    For example, `
+000077a0: 6069 6e70 7574 5f63 6f72 655f 6469 6d73  `input_core_dims
+000077b0: 3d5b 5b5d 2c20 5b27 7469 6d65 275d 5d60  =[[], ['time']]`
+000077c0: 6020 696e 6469 6361 7465 7320 7468 6174  ` indicates that
+000077d0: 2061 6c6c 0a20 2020 2020 2020 2064 696d   all.        dim
+000077e0: 656e 7369 6f6e 7320 6f6e 2074 6865 2066  ensions on the f
+000077f0: 6972 7374 2061 7267 756d 656e 7420 616e  irst argument an
+00007800: 6420 616c 6c20 6469 6d65 6e73 696f 6e73  d all dimensions
+00007810: 206f 7468 6572 2074 6861 6e20 2774 696d   other than 'tim
+00007820: 6527 0a20 2020 2020 2020 206f 6e20 7468  e'.        on th
+00007830: 6520 7365 636f 6e64 2061 7267 756d 656e  e second argumen
+00007840: 7420 7368 6f75 6c64 2062 6520 6272 6f61  t should be broa
+00007850: 6463 6173 742e 0a0a 2020 2020 2020 2020  dcast...        
+00007860: 436f 7265 2064 696d 656e 7369 6f6e 7320  Core dimensions 
+00007870: 6172 6520 6175 746f 6d61 7469 6361 6c6c  are automaticall
+00007880: 7920 6d6f 7665 6420 746f 2074 6865 206c  y moved to the l
+00007890: 6173 7420 6178 6573 206f 6620 696e 7075  ast axes of inpu
+000078a0: 740a 2020 2020 2020 2020 7661 7269 6162  t.        variab
+000078b0: 6c65 7320 6265 666f 7265 2061 7070 6c79  les before apply
+000078c0: 696e 6720 6060 6675 6e63 6060 2c20 7768  ing ``func``, wh
+000078d0: 6963 6820 6661 6369 6c69 7461 7465 7320  ich facilitates 
+000078e0: 7573 696e 6720 4e75 6d50 7920 7374 796c  using NumPy styl
+000078f0: 650a 2020 2020 2020 2020 6765 6e65 7261  e.        genera
+00007900: 6c69 7a65 6420 7566 756e 6373 205b 325d  lized ufuncs [2]
+00007910: 5f2e 0a20 2020 206f 7574 7075 745f 636f  _..    output_co
+00007920: 7265 5f64 696d 7320 3a20 6c69 7374 206f  re_dims : list o
+00007930: 6620 7475 706c 652c 206f 7074 696f 6e61  f tuple, optiona
+00007940: 6c0a 2020 2020 2020 2020 4c69 7374 206f  l.        List o
+00007950: 6620 7468 6520 7361 6d65 206c 656e 6774  f the same lengt
+00007960: 6820 6173 2074 6865 206e 756d 6265 7220  h as the number 
+00007970: 6f66 206f 7574 7075 7420 6172 6775 6d65  of output argume
+00007980: 6e74 7320 6672 6f6d 0a20 2020 2020 2020  nts from.       
+00007990: 2060 6066 756e 6360 602c 2067 6976 696e   ``func``, givin
+000079a0: 6720 7468 6520 6c69 7374 206f 6620 636f  g the list of co
+000079b0: 7265 2064 696d 656e 7369 6f6e 7320 6f6e  re dimensions on
+000079c0: 2065 6163 6820 6f75 7470 7574 2074 6861   each output tha
+000079d0: 7420 7765 7265 0a20 2020 2020 2020 206e  t were.        n
+000079e0: 6f74 2062 726f 6164 6361 7374 206f 6e20  ot broadcast on 
+000079f0: 7468 6520 696e 7075 7473 2e20 4279 2064  the inputs. By d
+00007a00: 6566 6175 6c74 2c20 7765 2061 7373 756d  efault, we assum
+00007a10: 6520 7468 6174 2060 6066 756e 6360 600a  e that ``func``.
+00007a20: 2020 2020 2020 2020 6f75 7470 7574 7320          outputs 
+00007a30: 6578 6163 746c 7920 6f6e 6520 6172 7261  exactly one arra
+00007a40: 792c 2077 6974 6820 6178 6573 2063 6f72  y, with axes cor
+00007a50: 7265 7370 6f6e 6469 6e67 2074 6f20 6561  responding to ea
+00007a60: 6368 2062 726f 6164 6361 7374 0a20 2020  ch broadcast.   
+00007a70: 2020 2020 2064 696d 656e 7369 6f6e 2e0a       dimension..
+00007a80: 0a20 2020 2020 2020 2043 6f72 6520 6469  .        Core di
+00007a90: 6d65 6e73 696f 6e73 2061 7265 2061 7373  mensions are ass
+00007aa0: 756d 6564 2074 6f20 6170 7065 6172 2061  umed to appear a
+00007ab0: 7320 7468 6520 6c61 7374 2064 696d 656e  s the last dimen
+00007ac0: 7369 6f6e 7320 6f66 2065 6163 680a 2020  sions of each.  
+00007ad0: 2020 2020 2020 6f75 7470 7574 2069 6e20        output in 
+00007ae0: 7468 6520 7072 6f76 6964 6564 206f 7264  the provided ord
+00007af0: 6572 2e0a 2020 2020 6578 636c 7564 655f  er..    exclude_
+00007b00: 6469 6d73 203a 2073 6574 2c20 6f70 7469  dims : set, opti
+00007b10: 6f6e 616c 0a20 2020 2020 2020 2043 6f72  onal.        Cor
+00007b20: 6520 6469 6d65 6e73 696f 6e73 206f 6e20  e dimensions on 
+00007b30: 7468 6520 696e 7075 7473 2074 6f20 6578  the inputs to ex
+00007b40: 636c 7564 6520 6672 6f6d 2061 6c69 676e  clude from align
+00007b50: 6d65 6e74 2061 6e64 0a20 2020 2020 2020  ment and.       
+00007b60: 2062 726f 6164 6361 7374 696e 6720 656e   broadcasting en
+00007b70: 7469 7265 6c79 2e20 416e 7920 696e 7075  tirely. Any inpu
+00007b80: 7420 636f 6f72 6469 6e61 7465 7320 616c  t coordinates al
+00007b90: 6f6e 6720 7468 6573 6520 6469 6d65 6e73  ong these dimens
+00007ba0: 696f 6e73 0a20 2020 2020 2020 2077 696c  ions.        wil
+00007bb0: 6c20 6265 2064 726f 7070 6564 2e20 4561  l be dropped. Ea
+00007bc0: 6368 2065 7863 6c75 6465 6420 6469 6d65  ch excluded dime
+00007bd0: 6e73 696f 6e20 6d75 7374 2061 6c73 6f20  nsion must also 
+00007be0: 6170 7065 6172 2069 6e0a 2020 2020 2020  appear in.      
+00007bf0: 2020 6060 696e 7075 745f 636f 7265 5f64    ``input_core_d
+00007c00: 696d 7360 6020 666f 7220 6174 206c 6561  ims`` for at lea
+00007c10: 7374 206f 6e65 2061 7267 756d 656e 742e  st one argument.
+00007c20: 204f 6e6c 7920 6469 6d65 6e73 696f 6e73   Only dimensions
+00007c30: 206c 6973 7465 640a 2020 2020 2020 2020   listed.        
+00007c40: 6865 7265 2061 7265 2061 6c6c 6f77 6564  here are allowed
+00007c50: 2074 6f20 6368 616e 6765 2073 697a 6520   to change size 
+00007c60: 6265 7477 6565 6e20 696e 7075 7420 616e  between input an
+00007c70: 6420 6f75 7470 7574 206f 626a 6563 7473  d output objects
+00007c80: 2e0a 2020 2020 7665 6374 6f72 697a 6520  ..    vectorize 
+00007c90: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
+00007ca0: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
+00007cb0: 2c20 7468 656e 2061 7373 756d 6520 6060  , then assume ``
+00007cc0: 6675 6e63 6060 206f 6e6c 7920 7461 6b65  func`` only take
+00007cd0: 7320 6172 7261 7973 2064 6566 696e 6564  s arrays defined
+00007ce0: 206f 7665 7220 636f 7265 0a20 2020 2020   over core.     
+00007cf0: 2020 2064 696d 656e 7369 6f6e 7320 6173     dimensions as
+00007d00: 2069 6e70 7574 2061 6e64 2076 6563 746f   input and vecto
+00007d10: 7269 7a65 2069 7420 6175 746f 6d61 7469  rize it automati
+00007d20: 6361 6c6c 7920 7769 7468 0a20 2020 2020  cally with.     
+00007d30: 2020 203a 7079 3a66 756e 633a 606e 756d     :py:func:`num
+00007d40: 7079 2e76 6563 746f 7269 7a65 602e 2054  py.vectorize`. T
+00007d50: 6869 7320 6f70 7469 6f6e 2065 7869 7374  his option exist
+00007d60: 7320 666f 7220 636f 6e76 656e 6965 6e63  s for convenienc
+00007d70: 652c 2062 7574 2069 730a 2020 2020 2020  e, but is.      
+00007d80: 2020 616c 6d6f 7374 2061 6c77 6179 7320    almost always 
+00007d90: 736c 6f77 6572 2074 6861 6e20 7375 7070  slower than supp
+00007da0: 6c79 696e 6720 6120 7072 652d 7665 6374  lying a pre-vect
+00007db0: 6f72 697a 6564 2066 756e 6374 696f 6e2e  orized function.
+00007dc0: 0a20 2020 206a 6f69 6e20 3a20 7b22 6f75  .    join : {"ou
+00007dd0: 7465 7222 2c20 2269 6e6e 6572 222c 2022  ter", "inner", "
+00007de0: 6c65 6674 222c 2022 7269 6768 7422 2c20  left", "right", 
+00007df0: 2265 7861 6374 227d 2c20 6465 6661 756c  "exact"}, defaul
+00007e00: 743a 2022 6578 6163 7422 0a20 2020 2020  t: "exact".     
+00007e10: 2020 204d 6574 686f 6420 666f 7220 6a6f     Method for jo
+00007e20: 696e 696e 6720 7468 6520 696e 6465 7865  ining the indexe
+00007e30: 7320 6f66 2074 6865 2070 6173 7365 6420  s of the passed 
+00007e40: 6f62 6a65 6374 7320 616c 6f6e 6720 6561  objects along ea
+00007e50: 6368 0a20 2020 2020 2020 2064 696d 656e  ch.        dimen
+00007e60: 7369 6f6e 2c20 616e 6420 7468 6520 7661  sion, and the va
+00007e70: 7269 6162 6c65 7320 6f66 2044 6174 6173  riables of Datas
+00007e80: 6574 206f 626a 6563 7473 2077 6974 6820  et objects with 
+00007e90: 6d69 736d 6174 6368 6564 0a20 2020 2020  mismatched.     
+00007ea0: 2020 2064 6174 6120 7661 7269 6162 6c65     data variable
+00007eb0: 733a 0a0a 2020 2020 2020 2020 2d20 276f  s:..        - 'o
+00007ec0: 7574 6572 273a 2075 7365 2074 6865 2075  uter': use the u
+00007ed0: 6e69 6f6e 206f 6620 6f62 6a65 6374 2069  nion of object i
+00007ee0: 6e64 6578 6573 0a20 2020 2020 2020 202d  ndexes.        -
+00007ef0: 2027 696e 6e65 7227 3a20 7573 6520 7468   'inner': use th
+00007f00: 6520 696e 7465 7273 6563 7469 6f6e 206f  e intersection o
+00007f10: 6620 6f62 6a65 6374 2069 6e64 6578 6573  f object indexes
+00007f20: 0a20 2020 2020 2020 202d 2027 6c65 6674  .        - 'left
+00007f30: 273a 2075 7365 2069 6e64 6578 6573 2066  ': use indexes f
+00007f40: 726f 6d20 7468 6520 6669 7273 7420 6f62  rom the first ob
+00007f50: 6a65 6374 2077 6974 6820 6561 6368 2064  ject with each d
+00007f60: 696d 656e 7369 6f6e 0a20 2020 2020 2020  imension.       
+00007f70: 202d 2027 7269 6768 7427 3a20 7573 6520   - 'right': use 
+00007f80: 696e 6465 7865 7320 6672 6f6d 2074 6865  indexes from the
+00007f90: 206c 6173 7420 6f62 6a65 6374 2077 6974   last object wit
+00007fa0: 6820 6561 6368 2064 696d 656e 7369 6f6e  h each dimension
+00007fb0: 0a20 2020 2020 2020 202d 2027 6578 6163  .        - 'exac
+00007fc0: 7427 3a20 7261 6973 6520 6056 616c 7565  t': raise `Value
+00007fd0: 4572 726f 7260 2069 6e73 7465 6164 206f  Error` instead o
+00007fe0: 6620 616c 6967 6e69 6e67 2077 6865 6e20  f aligning when 
+00007ff0: 696e 6465 7865 7320 746f 2062 650a 2020  indexes to be.  
+00008000: 2020 2020 2020 2020 616c 6967 6e65 6420          aligned 
+00008010: 6172 6520 6e6f 7420 6571 7561 6c0a 2020  are not equal.  
+00008020: 2020 6461 7461 7365 745f 6a6f 696e 203a    dataset_join :
+00008030: 207b 226f 7574 6572 222c 2022 696e 6e65   {"outer", "inne
+00008040: 7222 2c20 226c 6566 7422 2c20 2272 6967  r", "left", "rig
+00008050: 6874 222c 2022 6578 6163 7422 7d2c 2064  ht", "exact"}, d
+00008060: 6566 6175 6c74 3a20 2265 7861 6374 220a  efault: "exact".
+00008070: 2020 2020 2020 2020 4d65 7468 6f64 2066          Method f
+00008080: 6f72 206a 6f69 6e69 6e67 2076 6172 6961  or joining varia
+00008090: 626c 6573 206f 6620 4461 7461 7365 7420  bles of Dataset 
+000080a0: 6f62 6a65 6374 7320 7769 7468 206d 6973  objects with mis
+000080b0: 6d61 7463 6865 640a 2020 2020 2020 2020  matched.        
+000080c0: 6461 7461 2076 6172 6961 626c 6573 2e0a  data variables..
+000080d0: 0a20 2020 2020 2020 202d 2027 6f75 7465  .        - 'oute
+000080e0: 7227 3a20 7461 6b65 2076 6172 6961 626c  r': take variabl
+000080f0: 6573 2066 726f 6d20 626f 7468 2044 6174  es from both Dat
+00008100: 6173 6574 206f 626a 6563 7473 0a20 2020  aset objects.   
+00008110: 2020 2020 202d 2027 696e 6e65 7227 3a20       - 'inner': 
+00008120: 7461 6b65 206f 6e6c 7920 6f76 6572 6c61  take only overla
+00008130: 7070 6564 2076 6172 6961 626c 6573 0a20  pped variables. 
+00008140: 2020 2020 2020 202d 2027 6c65 6674 273a         - 'left':
+00008150: 2074 616b 6520 6f6e 6c79 2076 6172 6961   take only varia
+00008160: 626c 6573 2066 726f 6d20 7468 6520 6669  bles from the fi
+00008170: 7273 7420 6f62 6a65 6374 0a20 2020 2020  rst object.     
+00008180: 2020 202d 2027 7269 6768 7427 3a20 7461     - 'right': ta
+00008190: 6b65 206f 6e6c 7920 7661 7269 6162 6c65  ke only variable
+000081a0: 7320 6672 6f6d 2074 6865 206c 6173 7420  s from the last 
+000081b0: 6f62 6a65 6374 0a20 2020 2020 2020 202d  object.        -
+000081c0: 2027 6578 6163 7427 3a20 6461 7461 2076   'exact': data v
+000081d0: 6172 6961 626c 6573 206f 6e20 616c 6c20  ariables on all 
+000081e0: 4461 7461 7365 7420 6f62 6a65 6374 7320  Dataset objects 
+000081f0: 6d75 7374 206d 6174 6368 2065 7861 6374  must match exact
+00008200: 6c79 0a20 2020 2064 6174 6173 6574 5f66  ly.    dataset_f
+00008210: 696c 6c5f 7661 6c75 6520 3a20 6f70 7469  ill_value : opti
+00008220: 6f6e 616c 0a20 2020 2020 2020 2056 616c  onal.        Val
+00008230: 7565 2075 7365 6420 696e 2070 6c61 6365  ue used in place
+00008240: 206f 6620 6d69 7373 696e 6720 7661 7269   of missing vari
+00008250: 6162 6c65 7320 6f6e 2044 6174 6173 6574  ables on Dataset
+00008260: 2069 6e70 7574 7320 7768 656e 2074 6865   inputs when the
+00008270: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
+00008280: 7320 646f 206e 6f74 2073 6861 7265 2074  s do not share t
+00008290: 6865 2065 7861 6374 2073 616d 6520 6060  he exact same ``
+000082a0: 6461 7461 5f76 6172 7360 602e 2052 6571  data_vars``. Req
+000082b0: 7569 7265 6420 6966 0a20 2020 2020 2020  uired if.       
+000082c0: 2060 6064 6174 6173 6574 5f6a 6f69 6e20   ``dataset_join 
+000082d0: 6e6f 7420 696e 207b 2769 6e6e 6572 272c  not in {'inner',
+000082e0: 2027 6578 6163 7427 7d60 602c 206f 7468   'exact'}``, oth
+000082f0: 6572 7769 7365 2069 676e 6f72 6564 2e0a  erwise ignored..
+00008300: 2020 2020 6b65 6570 5f61 7474 7273 203a      keep_attrs :
+00008310: 207b 2264 726f 7022 2c20 2269 6465 6e74   {"drop", "ident
+00008320: 6963 616c 222c 2022 6e6f 5f63 6f6e 666c  ical", "no_confl
+00008330: 6963 7473 222c 2022 6472 6f70 5f63 6f6e  icts", "drop_con
+00008340: 666c 6963 7473 222c 2022 6f76 6572 7269  flicts", "overri
+00008350: 6465 227d 206f 7220 626f 6f6c 2c20 6f70  de"} or bool, op
+00008360: 7469 6f6e 616c 0a20 2020 2020 2020 202d  tional.        -
+00008370: 2027 6472 6f70 2720 6f72 2046 616c 7365   'drop' or False
+00008380: 3a20 656d 7074 7920 6174 7472 7320 6f6e  : empty attrs on
+00008390: 2072 6574 7572 6e65 6420 7861 7272 6179   returned xarray
+000083a0: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
+000083b0: 202d 2027 6964 656e 7469 6361 6c27 3a20   - 'identical': 
+000083c0: 616c 6c20 6174 7472 7320 6d75 7374 2062  all attrs must b
+000083d0: 6520 7468 6520 7361 6d65 206f 6e20 6576  e the same on ev
+000083e0: 6572 7920 6f62 6a65 6374 2e0a 2020 2020  ery object..    
+000083f0: 2020 2020 2d20 276e 6f5f 636f 6e66 6c69      - 'no_confli
+00008400: 6374 7327 3a20 6174 7472 7320 6672 6f6d  cts': attrs from
+00008410: 2061 6c6c 206f 626a 6563 7473 2061 7265   all objects are
+00008420: 2063 6f6d 6269 6e65 642c 2061 6e79 2074   combined, any t
+00008430: 6861 7420 6861 7665 2074 6865 2073 616d  hat have the sam
+00008440: 6520 6e61 6d65 206d 7573 7420 616c 736f  e name must also
+00008450: 2068 6176 6520 7468 6520 7361 6d65 2076   have the same v
+00008460: 616c 7565 2e0a 2020 2020 2020 2020 2d20  alue..        - 
+00008470: 2764 726f 705f 636f 6e66 6c69 6374 7327  'drop_conflicts'
+00008480: 3a20 6174 7472 7320 6672 6f6d 2061 6c6c  : attrs from all
+00008490: 206f 626a 6563 7473 2061 7265 2063 6f6d   objects are com
+000084a0: 6269 6e65 642c 2061 6e79 2074 6861 7420  bined, any that 
+000084b0: 6861 7665 2074 6865 2073 616d 6520 6e61  have the same na
+000084c0: 6d65 2062 7574 2064 6966 6665 7265 6e74  me but different
+000084d0: 2076 616c 7565 7320 6172 6520 6472 6f70   values are drop
+000084e0: 7065 642e 0a20 2020 2020 2020 202d 2027  ped..        - '
+000084f0: 6f76 6572 7269 6465 2720 6f72 2054 7275  override' or Tru
+00008500: 653a 2073 6b69 7020 636f 6d70 6172 696e  e: skip comparin
+00008510: 6720 616e 6420 636f 7079 2061 7474 7273  g and copy attrs
+00008520: 2066 726f 6d20 7468 6520 6669 7273 7420   from the first 
+00008530: 6f62 6a65 6374 2074 6f20 7468 6520 7265  object to the re
+00008540: 7375 6c74 2e0a 2020 2020 6b77 6172 6773  sult..    kwargs
+00008550: 203a 2064 6963 742c 206f 7074 696f 6e61   : dict, optiona
+00008560: 6c0a 2020 2020 2020 2020 4f70 7469 6f6e  l.        Option
+00008570: 616c 206b 6579 776f 7264 2061 7267 756d  al keyword argum
+00008580: 656e 7473 2070 6173 7365 6420 6469 7265  ents passed dire
+00008590: 6374 6c79 206f 6e20 746f 2063 616c 6c20  ctly on to call 
+000085a0: 6060 6675 6e63 6060 2e0a 2020 2020 6461  ``func``..    da
+000085b0: 736b 203a 207b 2266 6f72 6269 6464 656e  sk : {"forbidden
+000085c0: 222c 2022 616c 6c6f 7765 6422 2c20 2270  ", "allowed", "p
+000085d0: 6172 616c 6c65 6c69 7a65 6422 7d2c 2064  arallelized"}, d
+000085e0: 6566 6175 6c74 3a20 2266 6f72 6269 6464  efault: "forbidd
+000085f0: 656e 220a 2020 2020 2020 2020 486f 7720  en".        How 
+00008600: 746f 2068 616e 646c 6520 6170 706c 7969  to handle applyi
+00008610: 6e67 2074 6f20 6f62 6a65 6374 7320 636f  ng to objects co
+00008620: 6e74 6169 6e69 6e67 206c 617a 7920 6461  ntaining lazy da
+00008630: 7461 2069 6e20 7468 6520 666f 726d 206f  ta in the form o
+00008640: 660a 2020 2020 2020 2020 6461 736b 2061  f.        dask a
+00008650: 7272 6179 733a 0a0a 2020 2020 2020 2020  rrays:..        
+00008660: 2d20 2766 6f72 6269 6464 656e 2720 2864  - 'forbidden' (d
+00008670: 6566 6175 6c74 293a 2072 6169 7365 2061  efault): raise a
+00008680: 6e20 6572 726f 7220 6966 2061 2064 6173  n error if a das
+00008690: 6b20 6172 7261 7920 6973 2065 6e63 6f75  k array is encou
+000086a0: 6e74 6572 6564 2e0a 2020 2020 2020 2020  ntered..        
+000086b0: 2d20 2761 6c6c 6f77 6564 273a 2070 6173  - 'allowed': pas
+000086c0: 7320 6461 736b 2061 7272 6179 7320 6469  s dask arrays di
+000086d0: 7265 6374 6c79 206f 6e20 746f 2060 6066  rectly on to ``f
+000086e0: 756e 6360 602e 2050 7265 6665 7220 7468  unc``. Prefer th
+000086f0: 6973 206f 7074 696f 6e20 6966 0a20 2020  is option if.   
+00008700: 2020 2020 2020 2060 6066 756e 6360 6020         ``func`` 
+00008710: 6e61 7469 7665 6c79 2073 7570 706f 7274  natively support
+00008720: 7320 6461 736b 2061 7272 6179 732e 0a20  s dask arrays.. 
+00008730: 2020 2020 2020 202d 2027 7061 7261 6c6c         - 'parall
+00008740: 656c 697a 6564 273a 2061 7574 6f6d 6174  elized': automat
+00008750: 6963 616c 6c79 2070 6172 616c 6c65 6c69  ically paralleli
+00008760: 7a65 2060 6066 756e 6360 6020 6966 2061  ze ``func`` if a
+00008770: 6e79 206f 6620 7468 650a 2020 2020 2020  ny of the.      
+00008780: 2020 2020 696e 7075 7473 2061 7265 2061      inputs are a
+00008790: 2064 6173 6b20 6172 7261 7920 6279 2075   dask array by u
+000087a0: 7369 6e67 203a 7079 3a66 756e 633a 6064  sing :py:func:`d
+000087b0: 6173 6b2e 6172 7261 792e 6170 706c 795f  ask.array.apply_
+000087c0: 6775 6675 6e63 602e 204d 756c 7469 706c  gufunc`. Multipl
+000087d0: 6520 6f75 7470 7574 0a20 2020 2020 2020  e output.       
+000087e0: 2020 2061 7267 756d 656e 7473 2061 7265     arguments are
+000087f0: 2073 7570 706f 7274 6564 2e20 4f6e 6c79   supported. Only
+00008800: 2075 7365 2074 6869 7320 6f70 7469 6f6e   use this option
+00008810: 2069 6620 6060 6675 6e63 6060 2064 6f65   if ``func`` doe
+00008820: 7320 6e6f 7420 6e61 7469 7665 6c79 0a20  s not natively. 
+00008830: 2020 2020 2020 2020 2073 7570 706f 7274           support
+00008840: 2064 6173 6b20 6172 7261 7973 2028 652e   dask arrays (e.
+00008850: 672e 2063 6f6e 7665 7274 7320 7468 656d  g. converts them
+00008860: 2074 6f20 6e75 6d70 7920 6172 7261 7973   to numpy arrays
+00008870: 292e 0a20 2020 2064 6173 6b5f 6775 6675  )..    dask_gufu
+00008880: 6e63 5f6b 7761 7267 7320 3a20 6469 6374  nc_kwargs : dict
+00008890: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+000088a0: 2020 204f 7074 696f 6e61 6c20 6b65 7977     Optional keyw
+000088b0: 6f72 6420 6172 6775 6d65 6e74 7320 7061  ord arguments pa
+000088c0: 7373 6564 2074 6f20 3a70 793a 6675 6e63  ssed to :py:func
+000088d0: 3a60 6461 736b 2e61 7272 6179 2e61 7070  :`dask.array.app
+000088e0: 6c79 5f67 7566 756e 6360 2069 660a 2020  ly_gufunc` if.  
+000088f0: 2020 2020 2020 6461 736b 3d27 7061 7261        dask='para
+00008900: 6c6c 656c 697a 6564 272e 2050 6f73 7369  llelized'. Possi
+00008910: 626c 6520 6b65 7977 6f72 6473 2061 7265  ble keywords are
+00008920: 2060 606f 7574 7075 745f 7369 7a65 7360   ``output_sizes`
+00008930: 602c 2060 6061 6c6c 6f77 5f72 6563 6875  `, ``allow_rechu
+00008940: 6e6b 6060 0a20 2020 2020 2020 2061 6e64  nk``.        and
+00008950: 2060 606d 6574 6160 602e 0a20 2020 206f   ``meta``..    o
+00008960: 7574 7075 745f 6474 7970 6573 203a 206c  utput_dtypes : l
+00008970: 6973 7420 6f66 2064 7479 7065 2c20 6f70  ist of dtype, op
+00008980: 7469 6f6e 616c 0a20 2020 2020 2020 204f  tional.        O
+00008990: 7074 696f 6e61 6c20 6c69 7374 206f 6620  ptional list of 
+000089a0: 6f75 7470 7574 2064 7479 7065 732e 204f  output dtypes. O
+000089b0: 6e6c 7920 7573 6564 2069 6620 6060 6461  nly used if ``da
+000089c0: 736b 3d27 7061 7261 6c6c 656c 697a 6564  sk='parallelized
+000089d0: 2760 6020 6f72 0a20 2020 2020 2020 2060  '`` or.        `
+000089e0: 6076 6563 746f 7269 7a65 3d54 7275 6560  `vectorize=True`
+000089f0: 602e 0a20 2020 206f 7574 7075 745f 7369  `..    output_si
+00008a00: 7a65 7320 3a20 6469 6374 2c20 6f70 7469  zes : dict, opti
+00008a10: 6f6e 616c 0a20 2020 2020 2020 204f 7074  onal.        Opt
+00008a20: 696f 6e61 6c20 6d61 7070 696e 6720 6672  ional mapping fr
+00008a30: 6f6d 2064 696d 656e 7369 6f6e 206e 616d  om dimension nam
+00008a40: 6573 2074 6f20 7369 7a65 7320 666f 7220  es to sizes for 
+00008a50: 6f75 7470 7574 732e 204f 6e6c 7920 7573  outputs. Only us
+00008a60: 6564 0a20 2020 2020 2020 2069 6620 6461  ed.        if da
+00008a70: 736b 3d27 7061 7261 6c6c 656c 697a 6564  sk='parallelized
+00008a80: 2720 616e 6420 6e65 7720 6469 6d65 6e73  ' and new dimens
+00008a90: 696f 6e73 2028 6e6f 7420 666f 756e 6420  ions (not found 
+00008aa0: 6f6e 2069 6e70 7574 7329 2061 7070 6561  on inputs) appea
+00008ab0: 720a 2020 2020 2020 2020 6f6e 206f 7574  r.        on out
+00008ac0: 7075 7473 2e20 6060 6f75 7470 7574 5f73  puts. ``output_s
+00008ad0: 697a 6573 6060 2073 686f 756c 6420 6265  izes`` should be
+00008ae0: 2067 6976 656e 2069 6e20 7468 6520 6060   given in the ``
+00008af0: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
+00008b00: 6773 6060 0a20 2020 2020 2020 2070 6172  gs``.        par
+00008b10: 616d 6574 6572 2e20 4974 2077 696c 6c20  ameter. It will 
+00008b20: 6265 2072 656d 6f76 6564 2061 7320 6469  be removed as di
+00008b30: 7265 6374 2070 6172 616d 6574 6572 2069  rect parameter i
+00008b40: 6e20 6120 6675 7475 7265 2076 6572 7369  n a future versi
+00008b50: 6f6e 2e0a 2020 2020 6d65 7461 203a 206f  on..    meta : o
+00008b60: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00008b70: 5369 7a65 2d30 206f 626a 6563 7420 7265  Size-0 object re
+00008b80: 7072 6573 656e 7469 6e67 2074 6865 2074  presenting the t
+00008b90: 7970 6520 6f66 2061 7272 6179 2077 7261  ype of array wra
+00008ba0: 7070 6564 2062 7920 6461 736b 2061 7272  pped by dask arr
+00008bb0: 6179 2e20 5061 7373 6564 206f 6e20 746f  ay. Passed on to
+00008bc0: 0a20 2020 2020 2020 203a 7079 3a66 756e  .        :py:fun
+00008bd0: 633a 6064 6173 6b2e 6172 7261 792e 6170  c:`dask.array.ap
+00008be0: 706c 795f 6775 6675 6e63 602e 2060 606d  ply_gufunc`. ``m
+00008bf0: 6574 6160 6020 7368 6f75 6c64 2062 6520  eta`` should be 
+00008c00: 6769 7665 6e20 696e 2074 6865 0a20 2020  given in the.   
+00008c10: 2020 2020 2060 6064 6173 6b5f 6775 6675       ``dask_gufu
+00008c20: 6e63 5f6b 7761 7267 7360 6020 7061 7261  nc_kwargs`` para
+00008c30: 6d65 7465 7220 2e20 4974 2077 696c 6c20  meter . It will 
+00008c40: 6265 2072 656d 6f76 6564 2061 7320 6469  be removed as di
+00008c50: 7265 6374 2070 6172 616d 6574 6572 0a20  rect parameter. 
+00008c60: 2020 2020 2020 2061 2066 7574 7572 6520         a future 
+00008c70: 7665 7273 696f 6e2e 0a0a 2020 2020 5265  version...    Re
+00008c80: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00008c90: 2d0a 2020 2020 5369 6e67 6c65 2076 616c  -.    Single val
+00008ca0: 7565 206f 7220 7475 706c 6520 6f66 2044  ue or tuple of D
+00008cb0: 6174 6173 6574 2c20 4461 7461 4172 7261  ataset, DataArra
+00008cc0: 792c 2056 6172 6961 626c 652c 2064 6173  y, Variable, das
+00008cd0: 6b2e 6172 7261 792e 4172 7261 7920 6f72  k.array.Array or
+00008ce0: 0a20 2020 206e 756d 7079 2e6e 6461 7272  .    numpy.ndarr
+00008cf0: 6179 2c20 7468 6520 6669 7273 7420 7479  ay, the first ty
+00008d00: 7065 206f 6e20 7468 6174 206c 6973 7420  pe on that list 
+00008d10: 746f 2061 7070 6561 7220 6f6e 2061 6e20  to appear on an 
+00008d20: 696e 7075 742e 0a0a 2020 2020 4e6f 7465  input...    Note
+00008d30: 730a 2020 2020 2d2d 2d2d 2d0a 2020 2020  s.    -----.    
+00008d40: 5468 6973 2066 756e 6374 696f 6e20 6973  This function is
+00008d50: 2064 6573 6967 6e65 6420 666f 7220 7468   designed for th
+00008d60: 6520 6d6f 7265 2063 6f6d 6d6f 6e20 6361  e more common ca
+00008d70: 7365 2077 6865 7265 2060 6066 756e 6360  se where ``func`
+00008d80: 6020 6361 6e20 776f 726b 206f 6e20 6e75  ` can work on nu
+00008d90: 6d70 790a 2020 2020 6172 7261 7973 2e20  mpy.    arrays. 
+00008da0: 4966 2060 6066 756e 6360 6020 6e65 6564  If ``func`` need
+00008db0: 7320 746f 206d 616e 6970 756c 6174 6520  s to manipulate 
+00008dc0: 6120 7768 6f6c 6520 7861 7272 6179 206f  a whole xarray o
+00008dd0: 626a 6563 7420 7375 6273 6574 2074 6f20  bject subset to 
+00008de0: 6561 6368 2062 6c6f 636b 0a20 2020 2069  each block.    i
+00008df0: 7420 6973 2070 6f73 7369 626c 6520 746f  t is possible to
+00008e00: 2075 7365 203a 7079 3a66 756e 633a 6078   use :py:func:`x
+00008e10: 6172 7261 792e 6d61 705f 626c 6f63 6b73  array.map_blocks
+00008e20: 602e 0a0a 2020 2020 4e6f 7465 2074 6861  `...    Note tha
+00008e30: 7420 6475 6520 746f 2074 6865 206f 7665  t due to the ove
+00008e40: 7268 6561 6420 3a70 793a 6675 6e63 3a60  rhead :py:func:`
+00008e50: 7861 7272 6179 2e6d 6170 5f62 6c6f 636b  xarray.map_block
+00008e60: 7360 2069 7320 636f 6e73 6964 6572 6162  s` is considerab
+00008e70: 6c79 2073 6c6f 7765 7220 7468 616e 2060  ly slower than `
+00008e80: 6061 7070 6c79 5f75 6675 6e63 6060 2e0a  `apply_ufunc``..
+00008e90: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
+00008ea0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2043    --------.    C
+00008eb0: 616c 6375 6c61 7465 2074 6865 2076 6563  alculate the vec
+00008ec0: 746f 7220 6d61 676e 6974 7564 6520 6f66  tor magnitude of
+00008ed0: 2074 776f 2061 7267 756d 656e 7473 3a0a   two arguments:.
+00008ee0: 0a20 2020 203e 3e3e 2064 6566 206d 6167  .    >>> def mag
+00008ef0: 6e69 7475 6465 2861 2c20 6229 3a0a 2020  nitude(a, b):.  
+00008f00: 2020 2e2e 2e20 2020 2020 6675 6e63 203d    ...     func =
+00008f10: 206c 616d 6264 6120 782c 2079 3a20 6e70   lambda x, y: np
+00008f20: 2e73 7172 7428 782a 2a32 202b 2079 2a2a  .sqrt(x**2 + y**
+00008f30: 3229 0a20 2020 202e 2e2e 2020 2020 2072  2).    ...     r
+00008f40: 6574 7572 6e20 7872 2e61 7070 6c79 5f75  eturn xr.apply_u
+00008f50: 6675 6e63 2866 756e 632c 2061 2c20 6229  func(func, a, b)
+00008f60: 0a20 2020 202e 2e2e 0a0a 2020 2020 596f  .    .....    Yo
+00008f70: 7520 6361 6e20 6e6f 7720 6170 706c 7920  u can now apply 
+00008f80: 6060 6d61 676e 6974 7564 6528 2960 6020  ``magnitude()`` 
+00008f90: 746f 203a 7079 3a63 6c61 7373 3a60 4461  to :py:class:`Da
+00008fa0: 7461 4172 7261 7960 2061 6e64 203a 7079  taArray` and :py
+00008fb0: 3a63 6c61 7373 3a60 4461 7461 7365 7460  :class:`Dataset`
+00008fc0: 0a20 2020 206f 626a 6563 7473 2c20 7769  .    objects, wi
+00008fd0: 7468 2061 7574 6f6d 6174 6963 616c 6c79  th automatically
+00008fe0: 2070 7265 7365 7276 6564 2064 696d 656e   preserved dimen
+00008ff0: 7369 6f6e 7320 616e 6420 636f 6f72 6469  sions and coordi
+00009000: 6e61 7465 732c 2065 2e67 2e2c 0a0a 2020  nates, e.g.,..  
+00009010: 2020 3e3e 3e20 6172 7261 7920 3d20 7872    >>> array = xr
+00009020: 2e44 6174 6141 7272 6179 285b 312c 2032  .DataArray([1, 2
+00009030: 2c20 335d 2c20 636f 6f72 6473 3d5b 2822  , 3], coords=[("
+00009040: 7822 2c20 5b30 2e31 2c20 302e 322c 2030  x", [0.1, 0.2, 0
+00009050: 2e33 5d29 5d29 0a20 2020 203e 3e3e 206d  .3])]).    >>> m
+00009060: 6167 6e69 7475 6465 2861 7272 6179 2c20  agnitude(array, 
+00009070: 2d61 7272 6179 290a 2020 2020 3c78 6172  -array).    <xar
+00009080: 7261 792e 4461 7461 4172 7261 7920 2878  ray.DataArray (x
+00009090: 3a20 3329 3e0a 2020 2020 6172 7261 7928  : 3)>.    array(
+000090a0: 5b31 2e34 3134 3231 3335 362c 2032 2e38  [1.41421356, 2.8
+000090b0: 3238 3432 3731 322c 2034 2e32 3432 3634  2842712, 4.24264
+000090c0: 3036 395d 290a 2020 2020 436f 6f72 6469  069]).    Coordi
+000090d0: 6e61 7465 733a 0a20 2020 2020 202a 2078  nates:.      * x
+000090e0: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
+000090f0: 7436 3420 302e 3120 302e 3220 302e 330a  t64 0.1 0.2 0.3.
+00009100: 0a20 2020 2050 6c61 696e 2073 6361 6c61  .    Plain scala
+00009110: 7273 2c20 6e75 6d70 7920 6172 7261 7973  rs, numpy arrays
+00009120: 2061 6e64 2061 206d 6978 206f 6620 7468   and a mix of th
+00009130: 6573 6520 7769 7468 2078 6172 7261 7920  ese with xarray 
+00009140: 6f62 6a65 6374 7320 6973 2061 6c73 6f0a  objects is also.
+00009150: 2020 2020 7375 7070 6f72 7465 643a 0a0a      supported:..
+00009160: 2020 2020 3e3e 3e20 6d61 676e 6974 7564      >>> magnitud
+00009170: 6528 332c 2034 290a 2020 2020 352e 300a  e(3, 4).    5.0.
+00009180: 2020 2020 3e3e 3e20 6d61 676e 6974 7564      >>> magnitud
+00009190: 6528 332c 206e 702e 6172 7261 7928 5b30  e(3, np.array([0
+000091a0: 2c20 345d 2929 0a20 2020 2061 7272 6179  , 4])).    array
+000091b0: 285b 332e 2c20 352e 5d29 0a20 2020 203e  ([3., 5.]).    >
+000091c0: 3e3e 206d 6167 6e69 7475 6465 2861 7272  >> magnitude(arr
+000091d0: 6179 2c20 3029 0a20 2020 203c 7861 7272  ay, 0).    <xarr
+000091e0: 6179 2e44 6174 6141 7272 6179 2028 783a  ay.DataArray (x:
+000091f0: 2033 293e 0a20 2020 2061 7272 6179 285b   3)>.    array([
+00009200: 312e 2c20 322e 2c20 332e 5d29 0a20 2020  1., 2., 3.]).   
+00009210: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+00009220: 2020 2020 2a20 7820 2020 2020 2020 2028      * x        (
+00009230: 7829 2066 6c6f 6174 3634 2030 2e31 2030  x) float64 0.1 0
+00009240: 2e32 2030 2e33 0a0a 2020 2020 4f74 6865  .2 0.3..    Othe
+00009250: 7220 6578 616d 706c 6573 206f 6620 686f  r examples of ho
+00009260: 7720 796f 7520 636f 756c 6420 7573 6520  w you could use 
+00009270: 6060 6170 706c 795f 7566 756e 6360 6020  ``apply_ufunc`` 
+00009280: 746f 2077 7269 7465 2066 756e 6374 696f  to write functio
+00009290: 6e73 2074 6f0a 2020 2020 2876 6572 7920  ns to.    (very 
+000092a0: 6e65 6172 6c79 2920 7265 706c 6963 6174  nearly) replicat
+000092b0: 6520 6578 6973 7469 6e67 2078 6172 7261  e existing xarra
+000092c0: 7920 6675 6e63 7469 6f6e 616c 6974 793a  y functionality:
+000092d0: 0a0a 2020 2020 436f 6d70 7574 6520 7468  ..    Compute th
+000092e0: 6520 6d65 616e 2028 6060 2e6d 6561 6e60  e mean (``.mean`
+000092f0: 6029 206f 7665 7220 6f6e 6520 6469 6d65  `) over one dime
+00009300: 6e73 696f 6e3a 0a0a 2020 2020 3e3e 3e20  nsion:..    >>> 
+00009310: 6465 6620 6d65 616e 286f 626a 2c20 6469  def mean(obj, di
+00009320: 6d29 3a0a 2020 2020 2e2e 2e20 2020 2020  m):.    ...     
+00009330: 2320 6e6f 7465 3a20 6170 706c 7920 616c  # note: apply al
+00009340: 7761 7973 206d 6f76 6573 2063 6f72 6520  ways moves core 
+00009350: 6469 6d65 6e73 696f 6e73 2074 6f20 7468  dimensions to th
+00009360: 6520 656e 640a 2020 2020 2e2e 2e20 2020  e end.    ...   
+00009370: 2020 7265 7475 726e 2061 7070 6c79 5f75    return apply_u
+00009380: 6675 6e63 280a 2020 2020 2e2e 2e20 2020  func(.    ...   
+00009390: 2020 2020 2020 6e70 2e6d 6561 6e2c 206f        np.mean, o
+000093a0: 626a 2c20 696e 7075 745f 636f 7265 5f64  bj, input_core_d
+000093b0: 696d 733d 5b5b 6469 6d5d 5d2c 206b 7761  ims=[[dim]], kwa
+000093c0: 7267 733d 7b22 6178 6973 223a 202d 317d  rgs={"axis": -1}
+000093d0: 0a20 2020 202e 2e2e 2020 2020 2029 0a20  .    ...     ). 
+000093e0: 2020 202e 2e2e 0a0a 2020 2020 496e 6e65     .....    Inne
+000093f0: 7220 7072 6f64 7563 7420 6f76 6572 2061  r product over a
+00009400: 2073 7065 6369 6669 6320 6469 6d65 6e73   specific dimens
+00009410: 696f 6e20 286c 696b 6520 3a70 793a 6675  ion (like :py:fu
+00009420: 6e63 3a60 646f 7460 293a 0a0a 2020 2020  nc:`dot`):..    
+00009430: 3e3e 3e20 6465 6620 5f69 6e6e 6572 2878  >>> def _inner(x
+00009440: 2c20 7929 3a0a 2020 2020 2e2e 2e20 2020  , y):.    ...   
+00009450: 2020 7265 7375 6c74 203d 206e 702e 6d61    result = np.ma
+00009460: 746d 756c 2878 5b2e 2e2e 2c20 6e70 2e6e  tmul(x[..., np.n
+00009470: 6577 6178 6973 2c20 3a5d 2c20 795b 2e2e  ewaxis, :], y[..
+00009480: 2e2c 203a 2c20 6e70 2e6e 6577 6178 6973  ., :, np.newaxis
+00009490: 5d29 0a20 2020 202e 2e2e 2020 2020 2072  ]).    ...     r
+000094a0: 6574 7572 6e20 7265 7375 6c74 5b2e 2e2e  eturn result[...
+000094b0: 2c20 302c 2030 5d0a 2020 2020 2e2e 2e0a  , 0, 0].    ....
+000094c0: 2020 2020 3e3e 3e20 6465 6620 696e 6e65      >>> def inne
+000094d0: 725f 7072 6f64 7563 7428 612c 2062 2c20  r_product(a, b, 
+000094e0: 6469 6d29 3a0a 2020 2020 2e2e 2e20 2020  dim):.    ...   
+000094f0: 2020 7265 7475 726e 2061 7070 6c79 5f75    return apply_u
+00009500: 6675 6e63 285f 696e 6e65 722c 2061 2c20  func(_inner, a, 
+00009510: 622c 2069 6e70 7574 5f63 6f72 655f 6469  b, input_core_di
+00009520: 6d73 3d5b 5b64 696d 5d2c 205b 6469 6d5d  ms=[[dim], [dim]
+00009530: 5d29 0a20 2020 202e 2e2e 0a0a 2020 2020  ]).    .....    
+00009540: 5374 6163 6b20 6f62 6a65 6374 7320 616c  Stack objects al
+00009550: 6f6e 6720 6120 6e65 7720 6469 6d65 6e73  ong a new dimens
+00009560: 696f 6e20 286c 696b 6520 3a70 793a 6675  ion (like :py:fu
+00009570: 6e63 3a60 636f 6e63 6174 6029 3a0a 0a20  nc:`concat`):.. 
+00009580: 2020 203e 3e3e 2064 6566 2073 7461 636b     >>> def stack
+00009590: 286f 626a 6563 7473 2c20 6469 6d2c 206e  (objects, dim, n
+000095a0: 6577 5f63 6f6f 7264 293a 0a20 2020 202e  ew_coord):.    .
+000095b0: 2e2e 2020 2020 2023 206e 6f74 653a 2074  ..     # note: t
+000095c0: 6869 7320 7665 7273 696f 6e20 646f 6573  his version does
+000095d0: 206e 6f74 2073 7461 636b 2063 6f6f 7264   not stack coord
+000095e0: 696e 6174 6573 0a20 2020 202e 2e2e 2020  inates.    ...  
+000095f0: 2020 2066 756e 6320 3d20 6c61 6d62 6461     func = lambda
+00009600: 202a 783a 206e 702e 7374 6163 6b28 782c   *x: np.stack(x,
+00009610: 2061 7869 733d 2d31 290a 2020 2020 2e2e   axis=-1).    ..
+00009620: 2e20 2020 2020 7265 7375 6c74 203d 2061  .     result = a
+00009630: 7070 6c79 5f75 6675 6e63 280a 2020 2020  pply_ufunc(.    
+00009640: 2e2e 2e20 2020 2020 2020 2020 6675 6e63  ...         func
+00009650: 2c0a 2020 2020 2e2e 2e20 2020 2020 2020  ,.    ...       
+00009660: 2020 2a6f 626a 6563 7473 2c0a 2020 2020    *objects,.    
+00009670: 2e2e 2e20 2020 2020 2020 2020 6f75 7470  ...         outp
+00009680: 7574 5f63 6f72 655f 6469 6d73 3d5b 5b64  ut_core_dims=[[d
+00009690: 696d 5d5d 2c0a 2020 2020 2e2e 2e20 2020  im]],.    ...   
+000096a0: 2020 2020 2020 6a6f 696e 3d22 6f75 7465        join="oute
+000096b0: 7222 2c0a 2020 2020 2e2e 2e20 2020 2020  r",.    ...     
+000096c0: 2020 2020 6461 7461 7365 745f 6669 6c6c      dataset_fill
+000096d0: 5f76 616c 7565 3d6e 702e 6e61 6e0a 2020  _value=np.nan.  
+000096e0: 2020 2e2e 2e20 2020 2020 290a 2020 2020    ...     ).    
+000096f0: 2e2e 2e20 2020 2020 7265 7375 6c74 5b64  ...     result[d
+00009700: 696d 5d20 3d20 6e65 775f 636f 6f72 640a  im] = new_coord.
+00009710: 2020 2020 2e2e 2e20 2020 2020 7265 7475      ...     retu
+00009720: 726e 2072 6573 756c 740a 2020 2020 2e2e  rn result.    ..
+00009730: 2e0a 0a20 2020 2049 6620 796f 7572 2066  ...    If your f
+00009740: 756e 6374 696f 6e20 6973 206e 6f74 2076  unction is not v
+00009750: 6563 746f 7269 7a65 6420 6275 7420 6361  ectorized but ca
+00009760: 6e20 6265 2061 7070 6c69 6564 206f 6e6c  n be applied onl
+00009770: 7920 746f 2063 6f72 650a 2020 2020 6469  y to core.    di
+00009780: 6d65 6e73 696f 6e73 2c20 796f 7520 6361  mensions, you ca
+00009790: 6e20 7573 6520 6060 7665 6374 6f72 697a  n use ``vectoriz
+000097a0: 653d 5472 7565 6060 2074 6f20 7475 726e  e=True`` to turn
+000097b0: 2069 6e74 6f20 6120 7665 6374 6f72 697a   into a vectoriz
+000097c0: 6564 0a20 2020 2066 756e 6374 696f 6e2e  ed.    function.
+000097d0: 2054 6869 7320 7772 6170 7320 3a70 793a   This wraps :py:
+000097e0: 6675 6e63 3a60 6e75 6d70 792e 7665 6374  func:`numpy.vect
+000097f0: 6f72 697a 6560 2c20 736f 2074 6865 206f  orize`, so the o
+00009800: 7065 7261 7469 6f6e 2069 736e 2774 0a20  peration isn't. 
+00009810: 2020 2074 6572 7269 626c 7920 6661 7374     terribly fast
+00009820: 2e20 4865 7265 2077 6527 6c6c 2075 7365  . Here we'll use
+00009830: 2069 7420 746f 2063 616c 6375 6c61 7465   it to calculate
+00009840: 2074 6865 2064 6973 7461 6e63 6520 6265   the distance be
+00009850: 7477 6565 6e0a 2020 2020 656d 7069 7269  tween.    empiri
+00009860: 6361 6c20 7361 6d70 6c65 7320 6672 6f6d  cal samples from
+00009870: 2074 776f 2070 726f 6261 6269 6c69 7479   two probability
+00009880: 2064 6973 7472 6962 7574 696f 6e73 2c20   distributions, 
+00009890: 7573 696e 6720 6120 7363 6970 790a 2020  using a scipy.  
+000098a0: 2020 6675 6e63 7469 6f6e 2074 6861 7420    function that 
+000098b0: 6e65 6564 7320 746f 2062 6520 6170 706c  needs to be appl
+000098c0: 6965 6420 746f 2076 6563 746f 7273 3a0a  ied to vectors:.
+000098d0: 0a20 2020 203e 3e3e 2069 6d70 6f72 7420  .    >>> import 
+000098e0: 7363 6970 792e 7374 6174 730a 2020 2020  scipy.stats.    
+000098f0: 3e3e 3e20 6465 6620 6561 7274 685f 6d6f  >>> def earth_mo
+00009900: 7665 725f 6469 7374 616e 6365 2866 6972  ver_distance(fir
+00009910: 7374 5f73 616d 706c 6573 2c20 7365 636f  st_samples, seco
+00009920: 6e64 5f73 616d 706c 6573 2c20 6469 6d3d  nd_samples, dim=
+00009930: 2265 6e73 656d 626c 6522 293a 0a20 2020  "ensemble"):.   
+00009940: 202e 2e2e 2020 2020 2072 6574 7572 6e20   ...     return 
+00009950: 6170 706c 795f 7566 756e 6328 0a20 2020  apply_ufunc(.   
+00009960: 202e 2e2e 2020 2020 2020 2020 2073 6369   ...         sci
+00009970: 7079 2e73 7461 7473 2e77 6173 7365 7273  py.stats.wassers
+00009980: 7465 696e 5f64 6973 7461 6e63 652c 0a20  tein_distance,. 
+00009990: 2020 202e 2e2e 2020 2020 2020 2020 2066     ...         f
+000099a0: 6972 7374 5f73 616d 706c 6573 2c0a 2020  irst_samples,.  
+000099b0: 2020 2e2e 2e20 2020 2020 2020 2020 7365    ...         se
+000099c0: 636f 6e64 5f73 616d 706c 6573 2c0a 2020  cond_samples,.  
+000099d0: 2020 2e2e 2e20 2020 2020 2020 2020 696e    ...         in
+000099e0: 7075 745f 636f 7265 5f64 696d 733d 5b5b  put_core_dims=[[
+000099f0: 6469 6d5d 2c20 5b64 696d 5d5d 2c0a 2020  dim], [dim]],.  
+00009a00: 2020 2e2e 2e20 2020 2020 2020 2020 7665    ...         ve
+00009a10: 6374 6f72 697a 653d 5472 7565 2c0a 2020  ctorize=True,.  
+00009a20: 2020 2e2e 2e20 2020 2020 290a 2020 2020    ...     ).    
+00009a30: 2e2e 2e0a 0a20 2020 204d 6f73 7420 6f66  .....    Most of
+00009a40: 204e 756d 5079 2773 2062 7569 6c74 696e   NumPy's builtin
+00009a50: 2066 756e 6374 696f 6e73 2061 6c72 6561   functions alrea
+00009a60: 6479 2062 726f 6164 6361 7374 2074 6865  dy broadcast the
+00009a70: 6972 2069 6e70 7574 730a 2020 2020 6170  ir inputs.    ap
+00009a80: 7072 6f70 7269 6174 656c 7920 666f 7220  propriately for 
+00009a90: 7573 6520 696e 2060 6061 7070 6c79 5f75  use in ``apply_u
+00009aa0: 6675 6e63 6060 2e20 596f 7520 6d61 7920  func``. You may 
+00009ab0: 6669 6e64 2068 656c 7065 7220 6675 6e63  find helper func
+00009ac0: 7469 6f6e 7320 7375 6368 2061 730a 2020  tions such as.  
+00009ad0: 2020 3a70 793a 6675 6e63 3a60 6e75 6d70    :py:func:`nump
+00009ae0: 792e 6272 6f61 6463 6173 745f 6172 7261  y.broadcast_arra
+00009af0: 7973 6020 6865 6c70 6675 6c20 696e 2077  ys` helpful in w
+00009b00: 7269 7469 6e67 2079 6f75 7220 6675 6e63  riting your func
+00009b10: 7469 6f6e 2e20 6060 6170 706c 795f 7566  tion. ``apply_uf
+00009b20: 756e 6360 6020 616c 736f 0a20 2020 2077  unc`` also.    w
+00009b30: 6f72 6b73 2077 656c 6c20 7769 7468 203a  orks well with :
+00009b40: 7079 3a66 756e 633a 606e 756d 6261 2e76  py:func:`numba.v
+00009b50: 6563 746f 7269 7a65 6020 616e 6420 3a70  ectorize` and :p
+00009b60: 793a 6675 6e63 3a60 6e75 6d62 612e 6775  y:func:`numba.gu
+00009b70: 7665 6374 6f72 697a 6560 2e0a 0a20 2020  vectorize`...   
+00009b80: 2053 6565 2041 6c73 6f0a 2020 2020 2d2d   See Also.    --
+00009b90: 2d2d 2d2d 2d2d 0a20 2020 206e 756d 7079  ------.    numpy
+00009ba0: 2e62 726f 6164 6361 7374 5f61 7272 6179  .broadcast_array
+00009bb0: 730a 2020 2020 6e75 6d62 612e 7665 6374  s.    numba.vect
+00009bc0: 6f72 697a 650a 2020 2020 6e75 6d62 612e  orize.    numba.
+00009bd0: 6775 7665 6374 6f72 697a 650a 2020 2020  guvectorize.    
+00009be0: 6461 736b 2e61 7272 6179 2e61 7070 6c79  dask.array.apply
+00009bf0: 5f67 7566 756e 630a 2020 2020 7861 7272  _gufunc.    xarr
+00009c00: 6179 2e6d 6170 5f62 6c6f 636b 730a 2020  ay.map_blocks.  
+00009c10: 2020 3a72 6566 3a60 6461 736b 2e61 7574    :ref:`dask.aut
+00009c20: 6f6d 6174 6963 2d70 6172 616c 6c65 6c69  omatic-paralleli
+00009c30: 7a61 7469 6f6e 600a 2020 2020 2020 2020  zation`.        
+00009c40: 5573 6572 2067 7569 6465 2064 6573 6372  User guide descr
+00009c50: 6962 696e 6720 3a70 793a 6675 6e63 3a60  ibing :py:func:`
+00009c60: 6170 706c 795f 7566 756e 6360 2061 6e64  apply_ufunc` and
+00009c70: 203a 7079 3a66 756e 633a 606d 6170 5f62   :py:func:`map_b
+00009c80: 6c6f 636b 7360 2e0a 0a20 2020 2052 6566  locks`...    Ref
+00009c90: 6572 656e 6365 730a 2020 2020 2d2d 2d2d  erences.    ----
+00009ca0: 2d2d 2d2d 2d2d 0a20 2020 202e 2e20 5b31  ------.    .. [1
+00009cb0: 5d20 6874 7470 733a 2f2f 6e75 6d70 792e  ] https://numpy.
+00009cc0: 6f72 672f 646f 632f 7374 6162 6c65 2f72  org/doc/stable/r
+00009cd0: 6566 6572 656e 6365 2f75 6675 6e63 732e  eference/ufuncs.
+00009ce0: 6874 6d6c 0a20 2020 202e 2e20 5b32 5d20  html.    .. [2] 
+00009cf0: 6874 7470 733a 2f2f 6e75 6d70 792e 6f72  https://numpy.or
+00009d00: 672f 646f 632f 7374 6162 6c65 2f72 6566  g/doc/stable/ref
+00009d10: 6572 656e 6365 2f63 2d61 7069 2f67 656e  erence/c-api/gen
+00009d20: 6572 616c 697a 6564 2d75 6675 6e63 732e  eralized-ufuncs.
+00009d30: 6874 6d6c 0a20 2020 2022 2222 0a20 2020  html.    """.   
+00009d40: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
+00009d50: 652e 6461 7461 6172 7261 7920 696d 706f  e.dataarray impo
+00009d60: 7274 2044 6174 6141 7272 6179 0a20 2020  rt DataArray.   
+00009d70: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
+00009d80: 652e 6772 6f75 7062 7920 696d 706f 7274  e.groupby import
+00009d90: 2047 726f 7570 4279 0a20 2020 2066 726f   GroupBy.    fro
+00009da0: 6d20 7861 7272 6179 2e63 6f72 652e 7661  m xarray.core.va
+00009db0: 7269 6162 6c65 2069 6d70 6f72 7420 5661  riable import Va
+00009dc0: 7269 6162 6c65 0a0a 2020 2020 6966 2069  riable..    if i
+00009dd0: 6e70 7574 5f63 6f72 655f 6469 6d73 2069  nput_core_dims i
+00009de0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00009df0: 696e 7075 745f 636f 7265 5f64 696d 7320  input_core_dims 
+00009e00: 3d20 2828 292c 2920 2a20 286c 656e 2861  = ((),) * (len(a
+00009e10: 7267 7329 290a 2020 2020 656c 6966 206c  rgs)).    elif l
+00009e20: 656e 2869 6e70 7574 5f63 6f72 655f 6469  en(input_core_di
+00009e30: 6d73 2920 213d 206c 656e 2861 7267 7329  ms) != len(args)
+00009e40: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+00009e50: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00009e60: 2020 2020 2020 2020 6622 696e 7075 745f          f"input_
+00009e70: 636f 7265 5f64 696d 7320 6d75 7374 2062  core_dims must b
+00009e80: 6520 4e6f 6e65 206f 7220 6120 7475 706c  e None or a tupl
+00009e90: 6520 7769 7468 2074 6865 206c 656e 6774  e with the lengt
+00009ea0: 6820 7361 6d65 2074 6f20 220a 2020 2020  h same to ".    
+00009eb0: 2020 2020 2020 2020 6622 7468 6520 6e75          f"the nu
+00009ec0: 6d62 6572 206f 6620 6172 6775 6d65 6e74  mber of argument
+00009ed0: 732e 2022 0a20 2020 2020 2020 2020 2020  s. ".           
+00009ee0: 2066 2247 6976 656e 207b 6c65 6e28 696e   f"Given {len(in
+00009ef0: 7075 745f 636f 7265 5f64 696d 7329 7d20  put_core_dims)} 
+00009f00: 696e 7075 745f 636f 7265 5f64 696d 733a  input_core_dims:
+00009f10: 207b 696e 7075 745f 636f 7265 5f64 696d   {input_core_dim
+00009f20: 737d 2c20 220a 2020 2020 2020 2020 2020  s}, ".          
+00009f30: 2020 6622 2062 7574 206e 756d 6265 7220    f" but number 
+00009f40: 6f66 2061 7267 7320 6973 207b 6c65 6e28  of args is {len(
+00009f50: 6172 6773 297d 2e22 0a20 2020 2020 2020  args)}.".       
+00009f60: 2029 0a0a 2020 2020 6966 206b 7761 7267   )..    if kwarg
+00009f70: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00009f80: 2020 206b 7761 7267 7320 3d20 7b7d 0a0a     kwargs = {}..
+00009f90: 2020 2020 7369 676e 6174 7572 6520 3d20      signature = 
+00009fa0: 5f55 4675 6e63 5369 676e 6174 7572 6528  _UFuncSignature(
+00009fb0: 696e 7075 745f 636f 7265 5f64 696d 732c  input_core_dims,
+00009fc0: 206f 7574 7075 745f 636f 7265 5f64 696d   output_core_dim
+00009fd0: 7329 0a0a 2020 2020 6966 2065 7863 6c75  s)..    if exclu
+00009fe0: 6465 5f64 696d 733a 0a20 2020 2020 2020  de_dims:.       
+00009ff0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+0000a000: 6365 2865 7863 6c75 6465 5f64 696d 732c  ce(exclude_dims,
+0000a010: 2073 6574 293a 0a20 2020 2020 2020 2020   set):.         
+0000a020: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+0000a030: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000a040: 2020 2020 6622 4578 7065 6374 6564 2065      f"Expected e
+0000a050: 7863 6c75 6465 5f64 696d 7320 746f 2062  xclude_dims to b
+0000a060: 6520 6120 2773 6574 272e 2052 6563 6569  e a 'set'. Recei
+0000a070: 7665 6420 277b 7479 7065 2865 7863 6c75  ved '{type(exclu
+0000a080: 6465 5f64 696d 7329 2e5f 5f6e 616d 655f  de_dims).__name_
+0000a090: 5f7d 2720 696e 7374 6561 642e 220a 2020  _}' instead.".  
+0000a0a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000a0b0: 2020 2020 6966 206e 6f74 2065 7863 6c75      if not exclu
+0000a0c0: 6465 5f64 696d 7320 3c3d 2073 6967 6e61  de_dims <= signa
+0000a0d0: 7475 7265 2e61 6c6c 5f63 6f72 655f 6469  ture.all_core_di
+0000a0e0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+0000a0f0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0000a100: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000a110: 2020 6622 6561 6368 2064 696d 656e 7369    f"each dimensi
+0000a120: 6f6e 2069 6e20 6065 7863 6c75 6465 5f64  on in `exclude_d
+0000a130: 696d 7360 206d 7573 7420 616c 736f 2062  ims` must also b
+0000a140: 6520 6120 220a 2020 2020 2020 2020 2020  e a ".          
+0000a150: 2020 2020 2020 6622 636f 7265 2064 696d        f"core dim
+0000a160: 656e 7369 6f6e 2069 6e20 7468 6520 6675  ension in the fu
+0000a170: 6e63 7469 6f6e 2073 6967 6e61 7475 7265  nction signature
+0000a180: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+0000a190: 2020 2020 6622 506c 6561 7365 206d 616b      f"Please mak
+0000a1a0: 6520 7b28 6578 636c 7564 655f 6469 6d73  e {(exclude_dims
+0000a1b0: 202d 2073 6967 6e61 7475 7265 2e61 6c6c   - signature.all
+0000a1c0: 5f63 6f72 655f 6469 6d73 297d 2061 2063  _core_dims)} a c
+0000a1d0: 6f72 6520 6469 6d65 6e73 696f 6e22 0a20  ore dimension". 
+0000a1e0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000a1f0: 2020 2320 6861 6e64 6c65 2064 6173 6b5f    # handle dask_
+0000a200: 6775 6675 6e63 5f6b 7761 7267 730a 2020  gufunc_kwargs.  
+0000a210: 2020 6966 2064 6173 6b20 3d3d 2022 7061    if dask == "pa
+0000a220: 7261 6c6c 656c 697a 6564 223a 0a20 2020  rallelized":.   
+0000a230: 2020 2020 2069 6620 6461 736b 5f67 7566       if dask_guf
+0000a240: 756e 635f 6b77 6172 6773 2069 7320 4e6f  unc_kwargs is No
+0000a250: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000a260: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
+0000a270: 6773 203d 207b 7d0a 2020 2020 2020 2020  gs = {}.        
+0000a280: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000a290: 2020 6461 736b 5f67 7566 756e 635f 6b77    dask_gufunc_kw
+0000a2a0: 6172 6773 203d 2064 6173 6b5f 6775 6675  args = dask_gufu
+0000a2b0: 6e63 5f6b 7761 7267 732e 636f 7079 2829  nc_kwargs.copy()
+0000a2c0: 0a20 2020 2020 2020 2023 2074 6f64 6f3a  .        # todo:
+0000a2d0: 2072 656d 6f76 6520 7761 726e 696e 6773   remove warnings
+0000a2e0: 2061 6674 6572 2064 6570 7265 6361 7469   after deprecati
+0000a2f0: 6f6e 2063 7963 6c65 0a20 2020 2020 2020  on cycle.       
+0000a300: 2069 6620 6d65 7461 2069 7320 6e6f 7420   if meta is not 
+0000a310: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000a320: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
+0000a330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a340: 2022 6060 6d65 7461 6060 2073 686f 756c   "``meta`` shoul
+0000a350: 6420 6265 2067 6976 656e 2069 6e20 7468  d be given in th
+0000a360: 6520 6060 6461 736b 5f67 7566 756e 635f  e ``dask_gufunc_
+0000a370: 6b77 6172 6773 6060 2070 6172 616d 6574  kwargs`` paramet
+0000a380: 6572 2e22 0a20 2020 2020 2020 2020 2020  er.".           
+0000a390: 2020 2020 2022 2049 7420 7769 6c6c 2062       " It will b
+0000a3a0: 6520 7265 6d6f 7665 6420 6173 2064 6972  e removed as dir
+0000a3b0: 6563 7420 7061 7261 6d65 7465 7220 696e  ect parameter in
+0000a3c0: 2061 2066 7574 7572 6520 7665 7273 696f   a future versio
+0000a3d0: 6e2e 222c 0a20 2020 2020 2020 2020 2020  n.",.           
+0000a3e0: 2020 2020 2046 7574 7572 6557 6172 6e69       FutureWarni
+0000a3f0: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
+0000a400: 2020 2020 7374 6163 6b6c 6576 656c 3d32      stacklevel=2
+0000a410: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000a420: 2020 2020 2020 2020 2020 2020 6461 736b              dask
+0000a430: 5f67 7566 756e 635f 6b77 6172 6773 2e73  _gufunc_kwargs.s
+0000a440: 6574 6465 6661 756c 7428 226d 6574 6122  etdefault("meta"
+0000a450: 2c20 6d65 7461 290a 2020 2020 2020 2020  , meta).        
+0000a460: 6966 206f 7574 7075 745f 7369 7a65 7320  if output_sizes 
+0000a470: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000a480: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0000a490: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
+0000a4a0: 2020 2020 2020 2020 2260 606f 7574 7075          "``outpu
+0000a4b0: 745f 7369 7a65 7360 6020 7368 6f75 6c64  t_sizes`` should
+0000a4c0: 2062 6520 6769 7665 6e20 696e 2074 6865   be given in the
+0000a4d0: 2060 6064 6173 6b5f 6775 6675 6e63 5f6b   ``dask_gufunc_k
+0000a4e0: 7761 7267 7360 6020 220a 2020 2020 2020  wargs`` ".      
+0000a4f0: 2020 2020 2020 2020 2020 2270 6172 616d            "param
+0000a500: 6574 6572 2e20 4974 2077 696c 6c20 6265  eter. It will be
+0000a510: 2072 656d 6f76 6564 2061 7320 6469 7265   removed as dire
+0000a520: 6374 2070 6172 616d 6574 6572 2069 6e20  ct parameter in 
+0000a530: 6120 6675 7475 7265 2022 0a20 2020 2020  a future ".     
+0000a540: 2020 2020 2020 2020 2020 2022 7665 7273             "vers
+0000a550: 696f 6e2e 222c 0a20 2020 2020 2020 2020  ion.",.         
+0000a560: 2020 2020 2020 2046 7574 7572 6557 6172         FutureWar
+0000a570: 6e69 6e67 2c0a 2020 2020 2020 2020 2020  ning,.          
+0000a580: 2020 2020 2020 7374 6163 6b6c 6576 656c        stacklevel
+0000a590: 3d32 2c0a 2020 2020 2020 2020 2020 2020  =2,.            
+0000a5a0: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
+0000a5b0: 736b 5f67 7566 756e 635f 6b77 6172 6773  sk_gufunc_kwargs
+0000a5c0: 2e73 6574 6465 6661 756c 7428 226f 7574  .setdefault("out
+0000a5d0: 7075 745f 7369 7a65 7322 2c20 6f75 7470  put_sizes", outp
+0000a5e0: 7574 5f73 697a 6573 290a 0a20 2020 2069  ut_sizes)..    i
+0000a5f0: 6620 6b77 6172 6773 3a0a 2020 2020 2020  f kwargs:.      
+0000a600: 2020 6675 6e63 203d 2066 756e 6374 6f6f    func = functoo
+0000a610: 6c73 2e70 6172 7469 616c 2866 756e 632c  ls.partial(func,
+0000a620: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+0000a630: 6966 206b 6565 705f 6174 7472 7320 6973  if keep_attrs is
+0000a640: 204e 6f6e 653a 0a20 2020 2020 2020 206b   None:.        k
+0000a650: 6565 705f 6174 7472 7320 3d20 5f67 6574  eep_attrs = _get
+0000a660: 5f6b 6565 705f 6174 7472 7328 6465 6661  _keep_attrs(defa
+0000a670: 756c 743d 4661 6c73 6529 0a0a 2020 2020  ult=False)..    
+0000a680: 6966 2069 7369 6e73 7461 6e63 6528 6b65  if isinstance(ke
+0000a690: 6570 5f61 7474 7273 2c20 626f 6f6c 293a  ep_attrs, bool):
+0000a6a0: 0a20 2020 2020 2020 206b 6565 705f 6174  .        keep_at
+0000a6b0: 7472 7320 3d20 226f 7665 7272 6964 6522  trs = "override"
+0000a6c0: 2069 6620 6b65 6570 5f61 7474 7273 2065   if keep_attrs e
+0000a6d0: 6c73 6520 2264 726f 7022 0a0a 2020 2020  lse "drop"..    
+0000a6e0: 7661 7269 6162 6c65 735f 7666 756e 6320  variables_vfunc 
+0000a6f0: 3d20 6675 6e63 746f 6f6c 732e 7061 7274  = functools.part
+0000a700: 6961 6c28 0a20 2020 2020 2020 2061 7070  ial(.        app
+0000a710: 6c79 5f76 6172 6961 626c 655f 7566 756e  ly_variable_ufun
+0000a720: 632c 0a20 2020 2020 2020 2066 756e 632c  c,.        func,
+0000a730: 0a20 2020 2020 2020 2073 6967 6e61 7475  .        signatu
+0000a740: 7265 3d73 6967 6e61 7475 7265 2c0a 2020  re=signature,.  
+0000a750: 2020 2020 2020 6578 636c 7564 655f 6469        exclude_di
+0000a760: 6d73 3d65 7863 6c75 6465 5f64 696d 732c  ms=exclude_dims,
+0000a770: 0a20 2020 2020 2020 206b 6565 705f 6174  .        keep_at
+0000a780: 7472 733d 6b65 6570 5f61 7474 7273 2c0a  trs=keep_attrs,.
+0000a790: 2020 2020 2020 2020 6461 736b 3d64 6173          dask=das
+0000a7a0: 6b2c 0a20 2020 2020 2020 2076 6563 746f  k,.        vecto
+0000a7b0: 7269 7a65 3d76 6563 746f 7269 7a65 2c0a  rize=vectorize,.
+0000a7c0: 2020 2020 2020 2020 6f75 7470 7574 5f64          output_d
+0000a7d0: 7479 7065 733d 6f75 7470 7574 5f64 7479  types=output_dty
+0000a7e0: 7065 732c 0a20 2020 2020 2020 2064 6173  pes,.        das
+0000a7f0: 6b5f 6775 6675 6e63 5f6b 7761 7267 733d  k_gufunc_kwargs=
+0000a800: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
+0000a810: 6773 2c0a 2020 2020 290a 0a20 2020 2023  gs,.    )..    #
+0000a820: 2066 6565 6420 6772 6f75 7062 792d 6170   feed groupby-ap
+0000a830: 706c 795f 7566 756e 6320 7468 726f 7567  ply_ufunc throug
+0000a840: 6820 6170 706c 795f 6772 6f75 7062 795f  h apply_groupby_
+0000a850: 6675 6e63 0a20 2020 2069 6620 616e 7928  func.    if any(
+0000a860: 6973 696e 7374 616e 6365 2861 2c20 4772  isinstance(a, Gr
+0000a870: 6f75 7042 7929 2066 6f72 2061 2069 6e20  oupBy) for a in 
+0000a880: 6172 6773 293a 0a20 2020 2020 2020 2074  args):.        t
+0000a890: 6869 735f 6170 706c 7920 3d20 6675 6e63  his_apply = func
+0000a8a0: 746f 6f6c 732e 7061 7274 6961 6c28 0a20  tools.partial(. 
+0000a8b0: 2020 2020 2020 2020 2020 2061 7070 6c79             apply
+0000a8c0: 5f75 6675 6e63 2c0a 2020 2020 2020 2020  _ufunc,.        
+0000a8d0: 2020 2020 6675 6e63 2c0a 2020 2020 2020      func,.      
+0000a8e0: 2020 2020 2020 696e 7075 745f 636f 7265        input_core
+0000a8f0: 5f64 696d 733d 696e 7075 745f 636f 7265  _dims=input_core
+0000a900: 5f64 696d 732c 0a20 2020 2020 2020 2020  _dims,.         
+0000a910: 2020 206f 7574 7075 745f 636f 7265 5f64     output_core_d
+0000a920: 696d 733d 6f75 7470 7574 5f63 6f72 655f  ims=output_core_
+0000a930: 6469 6d73 2c0a 2020 2020 2020 2020 2020  dims,.          
+0000a940: 2020 6578 636c 7564 655f 6469 6d73 3d65    exclude_dims=e
+0000a950: 7863 6c75 6465 5f64 696d 732c 0a20 2020  xclude_dims,.   
+0000a960: 2020 2020 2020 2020 206a 6f69 6e3d 6a6f           join=jo
+0000a970: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
+0000a980: 6461 7461 7365 745f 6a6f 696e 3d64 6174  dataset_join=dat
+0000a990: 6173 6574 5f6a 6f69 6e2c 0a20 2020 2020  aset_join,.     
+0000a9a0: 2020 2020 2020 2064 6174 6173 6574 5f66         dataset_f
+0000a9b0: 696c 6c5f 7661 6c75 653d 6461 7461 7365  ill_value=datase
+0000a9c0: 745f 6669 6c6c 5f76 616c 7565 2c0a 2020  t_fill_value,.  
+0000a9d0: 2020 2020 2020 2020 2020 6b65 6570 5f61            keep_a
+0000a9e0: 7474 7273 3d6b 6565 705f 6174 7472 732c  ttrs=keep_attrs,
+0000a9f0: 0a20 2020 2020 2020 2020 2020 2064 6173  .            das
+0000aa00: 6b3d 6461 736b 2c0a 2020 2020 2020 2020  k=dask,.        
+0000aa10: 2020 2020 7665 6374 6f72 697a 653d 7665      vectorize=ve
+0000aa20: 6374 6f72 697a 652c 0a20 2020 2020 2020  ctorize,.       
+0000aa30: 2020 2020 206f 7574 7075 745f 6474 7970       output_dtyp
+0000aa40: 6573 3d6f 7574 7075 745f 6474 7970 6573  es=output_dtypes
+0000aa50: 2c0a 2020 2020 2020 2020 2020 2020 6461  ,.            da
+0000aa60: 736b 5f67 7566 756e 635f 6b77 6172 6773  sk_gufunc_kwargs
+0000aa70: 3d64 6173 6b5f 6775 6675 6e63 5f6b 7761  =dask_gufunc_kwa
+0000aa80: 7267 732c 0a20 2020 2020 2020 2029 0a20  rgs,.        ). 
+0000aa90: 2020 2020 2020 2072 6574 7572 6e20 6170         return ap
+0000aaa0: 706c 795f 6772 6f75 7062 795f 6675 6e63  ply_groupby_func
+0000aab0: 2874 6869 735f 6170 706c 792c 202a 6172  (this_apply, *ar
+0000aac0: 6773 290a 2020 2020 2320 6665 6564 2064  gs).    # feed d
+0000aad0: 6174 6173 6574 7320 6170 706c 795f 7661  atasets apply_va
+0000aae0: 7269 6162 6c65 5f75 6675 6e63 2074 6872  riable_ufunc thr
+0000aaf0: 6f75 6768 2061 7070 6c79 5f64 6174 6173  ough apply_datas
+0000ab00: 6574 5f76 6675 6e63 0a20 2020 2065 6c69  et_vfunc.    eli
+0000ab10: 6620 616e 7928 6973 5f64 6963 745f 6c69  f any(is_dict_li
+0000ab20: 6b65 2861 2920 666f 7220 6120 696e 2061  ke(a) for a in a
+0000ab30: 7267 7329 3a0a 2020 2020 2020 2020 7265  rgs):.        re
+0000ab40: 7475 726e 2061 7070 6c79 5f64 6174 6173  turn apply_datas
+0000ab50: 6574 5f76 6675 6e63 280a 2020 2020 2020  et_vfunc(.      
+0000ab60: 2020 2020 2020 7661 7269 6162 6c65 735f        variables_
+0000ab70: 7666 756e 632c 0a20 2020 2020 2020 2020  vfunc,.         
+0000ab80: 2020 202a 6172 6773 2c0a 2020 2020 2020     *args,.      
+0000ab90: 2020 2020 2020 7369 676e 6174 7572 653d        signature=
+0000aba0: 7369 676e 6174 7572 652c 0a20 2020 2020  signature,.     
+0000abb0: 2020 2020 2020 206a 6f69 6e3d 6a6f 696e         join=join
+0000abc0: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
+0000abd0: 636c 7564 655f 6469 6d73 3d65 7863 6c75  clude_dims=exclu
+0000abe0: 6465 5f64 696d 732c 0a20 2020 2020 2020  de_dims,.       
+0000abf0: 2020 2020 2064 6174 6173 6574 5f6a 6f69       dataset_joi
+0000ac00: 6e3d 6461 7461 7365 745f 6a6f 696e 2c0a  n=dataset_join,.
+0000ac10: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
+0000ac20: 5f76 616c 7565 3d64 6174 6173 6574 5f66  _value=dataset_f
+0000ac30: 696c 6c5f 7661 6c75 652c 0a20 2020 2020  ill_value,.     
+0000ac40: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
+0000ac50: 733d 6b65 6570 5f61 7474 7273 2c0a 2020  s=keep_attrs,.  
+0000ac60: 2020 2020 2020 290a 2020 2020 2320 6665        ).    # fe
+0000ac70: 6564 2044 6174 6141 7272 6179 2061 7070  ed DataArray app
+0000ac80: 6c79 5f76 6172 6961 626c 655f 7566 756e  ly_variable_ufun
+0000ac90: 6320 7468 726f 7567 6820 6170 706c 795f  c through apply_
+0000aca0: 6461 7461 6172 7261 795f 7666 756e 630a  dataarray_vfunc.
+0000acb0: 2020 2020 656c 6966 2061 6e79 2869 7369      elif any(isi
+0000acc0: 6e73 7461 6e63 6528 612c 2044 6174 6141  nstance(a, DataA
+0000acd0: 7272 6179 2920 666f 7220 6120 696e 2061  rray) for a in a
+0000ace0: 7267 7329 3a0a 2020 2020 2020 2020 7265  rgs):.        re
+0000acf0: 7475 726e 2061 7070 6c79 5f64 6174 6161  turn apply_dataa
+0000ad00: 7272 6179 5f76 6675 6e63 280a 2020 2020  rray_vfunc(.    
+0000ad10: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+0000ad20: 735f 7666 756e 632c 0a20 2020 2020 2020  s_vfunc,.       
+0000ad30: 2020 2020 202a 6172 6773 2c0a 2020 2020       *args,.    
+0000ad40: 2020 2020 2020 2020 7369 676e 6174 7572          signatur
+0000ad50: 653d 7369 676e 6174 7572 652c 0a20 2020  e=signature,.   
+0000ad60: 2020 2020 2020 2020 206a 6f69 6e3d 6a6f           join=jo
+0000ad70: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
+0000ad80: 6578 636c 7564 655f 6469 6d73 3d65 7863  exclude_dims=exc
+0000ad90: 6c75 6465 5f64 696d 732c 0a20 2020 2020  lude_dims,.     
+0000ada0: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
+0000adb0: 733d 6b65 6570 5f61 7474 7273 2c0a 2020  s=keep_attrs,.  
+0000adc0: 2020 2020 2020 290a 2020 2020 2320 6665        ).    # fe
+0000add0: 6564 2056 6172 6961 626c 6573 2064 6972  ed Variables dir
+0000ade0: 6563 746c 7920 7468 726f 7567 6820 6170  ectly through ap
+0000adf0: 706c 795f 7661 7269 6162 6c65 5f75 6675  ply_variable_ufu
+0000ae00: 6e63 0a20 2020 2065 6c69 6620 616e 7928  nc.    elif any(
+0000ae10: 6973 696e 7374 616e 6365 2861 2c20 5661  isinstance(a, Va
+0000ae20: 7269 6162 6c65 2920 666f 7220 6120 696e  riable) for a in
+0000ae30: 2061 7267 7329 3a0a 2020 2020 2020 2020   args):.        
+0000ae40: 7265 7475 726e 2076 6172 6961 626c 6573  return variables
+0000ae50: 5f76 6675 6e63 282a 6172 6773 290a 2020  _vfunc(*args).  
+0000ae60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000ae70: 2320 6665 6564 2061 6e79 7468 696e 6720  # feed anything 
+0000ae80: 656c 7365 2074 6872 6f75 6768 2061 7070  else through app
+0000ae90: 6c79 5f61 7272 6179 5f75 6675 6e63 0a20  ly_array_ufunc. 
+0000aea0: 2020 2020 2020 2072 6574 7572 6e20 6170         return ap
+0000aeb0: 706c 795f 6172 7261 795f 7566 756e 6328  ply_array_ufunc(
+0000aec0: 6675 6e63 2c20 2a61 7267 732c 2064 6173  func, *args, das
+0000aed0: 6b3d 6461 736b 290a 0a0a 6465 6620 636f  k=dask)...def co
+0000aee0: 7628 0a20 2020 2064 615f 613a 2054 5f44  v(.    da_a: T_D
+0000aef0: 6174 6141 7272 6179 2c20 6461 5f62 3a20  ataArray, da_b: 
+0000af00: 545f 4461 7461 4172 7261 792c 2064 696d  T_DataArray, dim
+0000af10: 3a20 4469 6d73 203d 204e 6f6e 652c 2064  : Dims = None, d
+0000af20: 646f 663a 2069 6e74 203d 2031 0a29 202d  dof: int = 1.) -
+0000af30: 3e20 545f 4461 7461 4172 7261 793a 0a20  > T_DataArray:. 
+0000af40: 2020 2022 2222 0a20 2020 2043 6f6d 7075     """.    Compu
+0000af50: 7465 2063 6f76 6172 6961 6e63 6520 6265  te covariance be
+0000af60: 7477 6565 6e20 7477 6f20 4461 7461 4172  tween two DataAr
+0000af70: 7261 7920 6f62 6a65 6374 7320 616c 6f6e  ray objects alon
+0000af80: 6720 6120 7368 6172 6564 2064 696d 656e  g a shared dimen
+0000af90: 7369 6f6e 2e0a 0a20 2020 2050 6172 616d  sion...    Param
+0000afa0: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+0000afb0: 2d2d 2d2d 0a20 2020 2064 615f 6120 3a20  ----.    da_a : 
+0000afc0: 4461 7461 4172 7261 790a 2020 2020 2020  DataArray.      
+0000afd0: 2020 4172 7261 7920 746f 2063 6f6d 7075    Array to compu
+0000afe0: 7465 2e0a 2020 2020 6461 5f62 203a 2044  te..    da_b : D
+0000aff0: 6174 6141 7272 6179 0a20 2020 2020 2020  ataArray.       
+0000b000: 2041 7272 6179 2074 6f20 636f 6d70 7574   Array to comput
+0000b010: 652e 0a20 2020 2064 696d 203a 2073 7472  e..    dim : str
+0000b020: 2c20 6974 6572 6162 6c65 206f 6620 6861  , iterable of ha
+0000b030: 7368 6162 6c65 2c20 222e 2e2e 2220 6f72  shable, "..." or
+0000b040: 204e 6f6e 652c 206f 7074 696f 6e61 6c0a   None, optional.
+0000b050: 2020 2020 2020 2020 5468 6520 6469 6d65          The dime
+0000b060: 6e73 696f 6e20 616c 6f6e 6720 7768 6963  nsion along whic
+0000b070: 6820 7468 6520 636f 7661 7269 616e 6365  h the covariance
+0000b080: 2077 696c 6c20 6265 2063 6f6d 7075 7465   will be compute
+0000b090: 640a 2020 2020 6464 6f66 203a 2069 6e74  d.    ddof : int
+0000b0a0: 2c20 6465 6661 756c 743a 2031 0a20 2020  , default: 1.   
+0000b0b0: 2020 2020 2049 6620 6464 6f66 3d31 2c20       If ddof=1, 
+0000b0c0: 636f 7661 7269 616e 6365 2069 7320 6e6f  covariance is no
+0000b0d0: 726d 616c 697a 6564 2062 7920 4e2d 312c  rmalized by N-1,
+0000b0e0: 2067 6976 696e 6720 616e 2075 6e62 6961   giving an unbia
+0000b0f0: 7365 6420 6573 7469 6d61 7465 2c0a 2020  sed estimate,.  
+0000b100: 2020 2020 2020 656c 7365 206e 6f72 6d61        else norma
+0000b110: 6c69 7a61 7469 6f6e 2069 7320 6279 204e  lization is by N
+0000b120: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
+0000b130: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2063     -------.    c
+0000b140: 6f76 6172 6961 6e63 6520 3a20 4461 7461  ovariance : Data
+0000b150: 4172 7261 790a 0a20 2020 2053 6565 2041  Array..    See A
+0000b160: 6c73 6f0a 2020 2020 2d2d 2d2d 2d2d 2d2d  lso.    --------
+0000b170: 0a20 2020 2070 616e 6461 732e 5365 7269  .    pandas.Seri
+0000b180: 6573 2e63 6f76 203a 2063 6f72 7265 7370  es.cov : corresp
+0000b190: 6f6e 6469 6e67 2070 616e 6461 7320 6675  onding pandas fu
+0000b1a0: 6e63 7469 6f6e 0a20 2020 2078 6172 7261  nction.    xarra
+0000b1b0: 792e 636f 7272 203a 2072 6573 7065 6374  y.corr : respect
+0000b1c0: 6976 6520 6675 6e63 7469 6f6e 2074 6f20  ive function to 
+0000b1d0: 6361 6c63 756c 6174 6520 636f 7272 656c  calculate correl
+0000b1e0: 6174 696f 6e0a 0a20 2020 2045 7861 6d70  ation..    Examp
+0000b1f0: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
+0000b200: 0a20 2020 203e 3e3e 2066 726f 6d20 7861  .    >>> from xa
+0000b210: 7272 6179 2069 6d70 6f72 7420 4461 7461  rray import Data
+0000b220: 4172 7261 790a 2020 2020 3e3e 3e20 6461  Array.    >>> da
+0000b230: 5f61 203d 2044 6174 6141 7272 6179 280a  _a = DataArray(.
+0000b240: 2020 2020 2e2e 2e20 2020 2020 6e70 2e61      ...     np.a
+0000b250: 7272 6179 285b 5b31 2c20 322c 2033 5d2c  rray([[1, 2, 3],
+0000b260: 205b 302e 312c 2030 2e32 2c20 302e 335d   [0.1, 0.2, 0.3]
+0000b270: 2c20 5b33 2e32 2c20 302e 362c 2031 2e38  , [3.2, 0.6, 1.8
+0000b280: 5d5d 292c 0a20 2020 202e 2e2e 2020 2020  ]]),.    ...    
+0000b290: 2064 696d 733d 2822 7370 6163 6522 2c20   dims=("space", 
+0000b2a0: 2274 696d 6522 292c 0a20 2020 202e 2e2e  "time"),.    ...
+0000b2b0: 2020 2020 2063 6f6f 7264 733d 5b0a 2020       coords=[.  
+0000b2c0: 2020 2e2e 2e20 2020 2020 2020 2020 2822    ...         ("
+0000b2d0: 7370 6163 6522 2c20 5b22 4941 222c 2022  space", ["IA", "
+0000b2e0: 494c 222c 2022 494e 225d 292c 0a20 2020  IL", "IN"]),.   
+0000b2f0: 202e 2e2e 2020 2020 2020 2020 2028 2274   ...         ("t
+0000b300: 696d 6522 2c20 7064 2e64 6174 655f 7261  ime", pd.date_ra
+0000b310: 6e67 6528 2232 3030 302d 3031 2d30 3122  nge("2000-01-01"
+0000b320: 2c20 6672 6571 3d22 3144 222c 2070 6572  , freq="1D", per
+0000b330: 696f 6473 3d33 2929 2c0a 2020 2020 2e2e  iods=3)),.    ..
+0000b340: 2e20 2020 2020 5d2c 0a20 2020 202e 2e2e  .     ],.    ...
+0000b350: 2029 0a20 2020 203e 3e3e 2064 615f 610a   ).    >>> da_a.
+0000b360: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
+0000b370: 4172 7261 7920 2873 7061 6365 3a20 332c  Array (space: 3,
+0000b380: 2074 696d 653a 2033 293e 0a20 2020 2061   time: 3)>.    a
+0000b390: 7272 6179 285b 5b31 2e20 2c20 322e 202c  rray([[1. , 2. ,
+0000b3a0: 2033 2e20 5d2c 0a20 2020 2020 2020 2020   3. ],.         
+0000b3b0: 2020 5b30 2e31 2c20 302e 322c 2030 2e33    [0.1, 0.2, 0.3
+0000b3c0: 5d2c 0a20 2020 2020 2020 2020 2020 5b33  ],.           [3
+0000b3d0: 2e32 2c20 302e 362c 2031 2e38 5d5d 290a  .2, 0.6, 1.8]]).
+0000b3e0: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
+0000b3f0: 0a20 2020 2020 202a 2073 7061 6365 2020  .      * space  
+0000b400: 2020 2873 7061 6365 2920 3c55 3220 2749    (space) <U2 'I
+0000b410: 4127 2027 494c 2720 2749 4e27 0a20 2020  A' 'IL' 'IN'.   
+0000b420: 2020 202a 2074 696d 6520 2020 2020 2874     * time     (t
+0000b430: 696d 6529 2064 6174 6574 696d 6536 345b  ime) datetime64[
+0000b440: 6e73 5d20 3230 3030 2d30 312d 3031 2032  ns] 2000-01-01 2
+0000b450: 3030 302d 3031 2d30 3220 3230 3030 2d30  000-01-02 2000-0
+0000b460: 312d 3033 0a20 2020 203e 3e3e 2064 615f  1-03.    >>> da_
+0000b470: 6220 3d20 4461 7461 4172 7261 7928 0a20  b = DataArray(. 
+0000b480: 2020 202e 2e2e 2020 2020 206e 702e 6172     ...     np.ar
+0000b490: 7261 7928 5b5b 302e 322c 2030 2e34 2c20  ray([[0.2, 0.4, 
+0000b4a0: 302e 365d 2c20 5b31 352c 2031 302c 2035  0.6], [15, 10, 5
+0000b4b0: 5d2c 205b 332e 322c 2030 2e36 2c20 312e  ], [3.2, 0.6, 1.
+0000b4c0: 385d 5d29 2c0a 2020 2020 2e2e 2e20 2020  8]]),.    ...   
+0000b4d0: 2020 6469 6d73 3d28 2273 7061 6365 222c    dims=("space",
+0000b4e0: 2022 7469 6d65 2229 2c0a 2020 2020 2e2e   "time"),.    ..
+0000b4f0: 2e20 2020 2020 636f 6f72 6473 3d5b 0a20  .     coords=[. 
+0000b500: 2020 202e 2e2e 2020 2020 2020 2020 2028     ...         (
+0000b510: 2273 7061 6365 222c 205b 2249 4122 2c20  "space", ["IA", 
+0000b520: 2249 4c22 2c20 2249 4e22 5d29 2c0a 2020  "IL", "IN"]),.  
+0000b530: 2020 2e2e 2e20 2020 2020 2020 2020 2822    ...         ("
+0000b540: 7469 6d65 222c 2070 642e 6461 7465 5f72  time", pd.date_r
+0000b550: 616e 6765 2822 3230 3030 2d30 312d 3031  ange("2000-01-01
+0000b560: 222c 2066 7265 713d 2231 4422 2c20 7065  ", freq="1D", pe
+0000b570: 7269 6f64 733d 3329 292c 0a20 2020 202e  riods=3)),.    .
+0000b580: 2e2e 2020 2020 205d 2c0a 2020 2020 2e2e  ..     ],.    ..
+0000b590: 2e20 290a 2020 2020 3e3e 3e20 6461 5f62  . ).    >>> da_b
+0000b5a0: 0a20 2020 203c 7861 7272 6179 2e44 6174  .    <xarray.Dat
+0000b5b0: 6141 7272 6179 2028 7370 6163 653a 2033  aArray (space: 3
+0000b5c0: 2c20 7469 6d65 3a20 3329 3e0a 2020 2020  , time: 3)>.    
+0000b5d0: 6172 7261 7928 5b5b 2030 2e32 2c20 2030  array([[ 0.2,  0
+0000b5e0: 2e34 2c20 2030 2e36 5d2c 0a20 2020 2020  .4,  0.6],.     
+0000b5f0: 2020 2020 2020 5b31 352e 202c 2031 302e        [15. , 10.
+0000b600: 202c 2020 352e 205d 2c0a 2020 2020 2020   ,  5. ],.      
+0000b610: 2020 2020 205b 2033 2e32 2c20 2030 2e36       [ 3.2,  0.6
+0000b620: 2c20 2031 2e38 5d5d 290a 2020 2020 436f  ,  1.8]]).    Co
+0000b630: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
+0000b640: 202a 2073 7061 6365 2020 2020 2873 7061   * space    (spa
+0000b650: 6365 2920 3c55 3220 2749 4127 2027 494c  ce) <U2 'IA' 'IL
+0000b660: 2720 2749 4e27 0a20 2020 2020 202a 2074  ' 'IN'.      * t
+0000b670: 696d 6520 2020 2020 2874 696d 6529 2064  ime     (time) d
+0000b680: 6174 6574 696d 6536 345b 6e73 5d20 3230  atetime64[ns] 20
+0000b690: 3030 2d30 312d 3031 2032 3030 302d 3031  00-01-01 2000-01
+0000b6a0: 2d30 3220 3230 3030 2d30 312d 3033 0a20  -02 2000-01-03. 
+0000b6b0: 2020 203e 3e3e 2078 722e 636f 7628 6461     >>> xr.cov(da
+0000b6c0: 5f61 2c20 6461 5f62 290a 2020 2020 3c78  _a, da_b).    <x
+0000b6d0: 6172 7261 792e 4461 7461 4172 7261 7920  array.DataArray 
+0000b6e0: 2829 3e0a 2020 2020 6172 7261 7928 2d33  ()>.    array(-3
+0000b6f0: 2e35 3330 3535 3535 3629 0a20 2020 203e  .53055556).    >
+0000b700: 3e3e 2078 722e 636f 7628 6461 5f61 2c20  >> xr.cov(da_a, 
+0000b710: 6461 5f62 2c20 6469 6d3d 2274 696d 6522  da_b, dim="time"
+0000b720: 290a 2020 2020 3c78 6172 7261 792e 4461  ).    <xarray.Da
+0000b730: 7461 4172 7261 7920 2873 7061 6365 3a20  taArray (space: 
+0000b740: 3329 3e0a 2020 2020 6172 7261 7928 5b20  3)>.    array([ 
+0000b750: 302e 3220 2020 2020 2020 2c20 2d30 2e35  0.2       , -0.5
+0000b760: 2020 2020 2020 202c 2020 312e 3639 3333         ,  1.6933
+0000b770: 3333 3333 5d29 0a20 2020 2043 6f6f 7264  3333]).    Coord
+0000b780: 696e 6174 6573 3a0a 2020 2020 2020 2a20  inates:.      * 
+0000b790: 7370 6163 6520 2020 2028 7370 6163 6529  space    (space)
+0000b7a0: 203c 5532 2027 4941 2720 2749 4c27 2027   <U2 'IA' 'IL' '
+0000b7b0: 494e 270a 2020 2020 2222 220a 2020 2020  IN'.    """.    
+0000b7c0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
+0000b7d0: 2e64 6174 6161 7272 6179 2069 6d70 6f72  .dataarray impor
+0000b7e0: 7420 4461 7461 4172 7261 790a 0a20 2020  t DataArray..   
+0000b7f0: 2069 6620 616e 7928 6e6f 7420 6973 696e   if any(not isin
+0000b800: 7374 616e 6365 2861 7272 2c20 4461 7461  stance(arr, Data
+0000b810: 4172 7261 7929 2066 6f72 2061 7272 2069  Array) for arr i
+0000b820: 6e20 5b64 615f 612c 2064 615f 625d 293a  n [da_a, da_b]):
+0000b830: 0a20 2020 2020 2020 2072 6169 7365 2054  .        raise T
+0000b840: 7970 6545 7272 6f72 280a 2020 2020 2020  ypeError(.      
+0000b850: 2020 2020 2020 224f 6e6c 7920 7872 2e44        "Only xr.D
+0000b860: 6174 6141 7272 6179 2069 7320 7375 7070  ataArray is supp
+0000b870: 6f72 7465 642e 220a 2020 2020 2020 2020  orted.".        
+0000b880: 2020 2020 2247 6976 656e 207b 7d2e 222e      "Given {}.".
+0000b890: 666f 726d 6174 285b 7479 7065 2861 7272  format([type(arr
+0000b8a0: 2920 666f 7220 6172 7220 696e 205b 6461  ) for arr in [da
+0000b8b0: 5f61 2c20 6461 5f62 5d5d 290a 2020 2020  _a, da_b]]).    
+0000b8c0: 2020 2020 290a 0a20 2020 2072 6574 7572      )..    retur
+0000b8d0: 6e20 5f63 6f76 5f63 6f72 7228 6461 5f61  n _cov_corr(da_a
+0000b8e0: 2c20 6461 5f62 2c20 6469 6d3d 6469 6d2c  , da_b, dim=dim,
+0000b8f0: 2064 646f 663d 6464 6f66 2c20 6d65 7468   ddof=ddof, meth
+0000b900: 6f64 3d22 636f 7622 290a 0a0a 6465 6620  od="cov")...def 
+0000b910: 636f 7272 2864 615f 613a 2054 5f44 6174  corr(da_a: T_Dat
+0000b920: 6141 7272 6179 2c20 6461 5f62 3a20 545f  aArray, da_b: T_
+0000b930: 4461 7461 4172 7261 792c 2064 696d 3a20  DataArray, dim: 
+0000b940: 4469 6d73 203d 204e 6f6e 6529 202d 3e20  Dims = None) -> 
+0000b950: 545f 4461 7461 4172 7261 793a 0a20 2020  T_DataArray:.   
+0000b960: 2022 2222 0a20 2020 2043 6f6d 7075 7465   """.    Compute
+0000b970: 2074 6865 2050 6561 7273 6f6e 2063 6f72   the Pearson cor
+0000b980: 7265 6c61 7469 6f6e 2063 6f65 6666 6963  relation coeffic
+0000b990: 6965 6e74 2062 6574 7765 656e 0a20 2020  ient between.   
+0000b9a0: 2074 776f 2044 6174 6141 7272 6179 206f   two DataArray o
+0000b9b0: 626a 6563 7473 2061 6c6f 6e67 2061 2073  bjects along a s
+0000b9c0: 6861 7265 6420 6469 6d65 6e73 696f 6e2e  hared dimension.
+0000b9d0: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+0000b9e0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+0000b9f0: 2020 2020 6461 5f61 203a 2044 6174 6141      da_a : DataA
+0000ba00: 7272 6179 0a20 2020 2020 2020 2041 7272  rray.        Arr
+0000ba10: 6179 2074 6f20 636f 6d70 7574 652e 0a20  ay to compute.. 
+0000ba20: 2020 2064 615f 6220 3a20 4461 7461 4172     da_b : DataAr
+0000ba30: 7261 790a 2020 2020 2020 2020 4172 7261  ray.        Arra
+0000ba40: 7920 746f 2063 6f6d 7075 7465 2e0a 2020  y to compute..  
+0000ba50: 2020 6469 6d20 3a20 7374 722c 2069 7465    dim : str, ite
+0000ba60: 7261 626c 6520 6f66 2068 6173 6861 626c  rable of hashabl
+0000ba70: 652c 2022 2e2e 2e22 206f 7220 4e6f 6e65  e, "..." or None
+0000ba80: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+0000ba90: 2020 2054 6865 2064 696d 656e 7369 6f6e     The dimension
+0000baa0: 2061 6c6f 6e67 2077 6869 6368 2074 6865   along which the
+0000bab0: 2063 6f72 7265 6c61 7469 6f6e 2077 696c   correlation wil
+0000bac0: 6c20 6265 2063 6f6d 7075 7465 640a 0a20  l be computed.. 
+0000bad0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
+0000bae0: 2d2d 2d2d 2d2d 0a20 2020 2063 6f72 7265  ------.    corre
+0000baf0: 6c61 7469 6f6e 3a20 4461 7461 4172 7261  lation: DataArra
+0000bb00: 790a 0a20 2020 2053 6565 2041 6c73 6f0a  y..    See Also.
+0000bb10: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0000bb20: 2070 616e 6461 732e 5365 7269 6573 2e63   pandas.Series.c
+0000bb30: 6f72 7220 3a20 636f 7272 6573 706f 6e64  orr : correspond
+0000bb40: 696e 6720 7061 6e64 6173 2066 756e 6374  ing pandas funct
+0000bb50: 696f 6e0a 2020 2020 7861 7272 6179 2e63  ion.    xarray.c
+0000bb60: 6f76 203a 2075 6e64 6572 6c79 696e 6720  ov : underlying 
+0000bb70: 636f 7661 7269 616e 6365 2066 756e 6374  covariance funct
+0000bb80: 696f 6e0a 0a20 2020 2045 7861 6d70 6c65  ion..    Example
+0000bb90: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20  s.    --------. 
+0000bba0: 2020 203e 3e3e 2066 726f 6d20 7861 7272     >>> from xarr
+0000bbb0: 6179 2069 6d70 6f72 7420 4461 7461 4172  ay import DataAr
+0000bbc0: 7261 790a 2020 2020 3e3e 3e20 6461 5f61  ray.    >>> da_a
+0000bbd0: 203d 2044 6174 6141 7272 6179 280a 2020   = DataArray(.  
+0000bbe0: 2020 2e2e 2e20 2020 2020 6e70 2e61 7272    ...     np.arr
+0000bbf0: 6179 285b 5b31 2c20 322c 2033 5d2c 205b  ay([[1, 2, 3], [
+0000bc00: 302e 312c 2030 2e32 2c20 302e 335d 2c20  0.1, 0.2, 0.3], 
+0000bc10: 5b33 2e32 2c20 302e 362c 2031 2e38 5d5d  [3.2, 0.6, 1.8]]
+0000bc20: 292c 0a20 2020 202e 2e2e 2020 2020 2064  ),.    ...     d
+0000bc30: 696d 733d 2822 7370 6163 6522 2c20 2274  ims=("space", "t
+0000bc40: 696d 6522 292c 0a20 2020 202e 2e2e 2020  ime"),.    ...  
+0000bc50: 2020 2063 6f6f 7264 733d 5b0a 2020 2020     coords=[.    
+0000bc60: 2e2e 2e20 2020 2020 2020 2020 2822 7370  ...         ("sp
+0000bc70: 6163 6522 2c20 5b22 4941 222c 2022 494c  ace", ["IA", "IL
+0000bc80: 222c 2022 494e 225d 292c 0a20 2020 202e  ", "IN"]),.    .
+0000bc90: 2e2e 2020 2020 2020 2020 2028 2274 696d  ..         ("tim
+0000bca0: 6522 2c20 7064 2e64 6174 655f 7261 6e67  e", pd.date_rang
+0000bcb0: 6528 2232 3030 302d 3031 2d30 3122 2c20  e("2000-01-01", 
+0000bcc0: 6672 6571 3d22 3144 222c 2070 6572 696f  freq="1D", perio
+0000bcd0: 6473 3d33 2929 2c0a 2020 2020 2e2e 2e20  ds=3)),.    ... 
+0000bce0: 2020 2020 5d2c 0a20 2020 202e 2e2e 2029      ],.    ... )
+0000bcf0: 0a20 2020 203e 3e3e 2064 615f 610a 2020  .    >>> da_a.  
+0000bd00: 2020 3c78 6172 7261 792e 4461 7461 4172    <xarray.DataAr
+0000bd10: 7261 7920 2873 7061 6365 3a20 332c 2074  ray (space: 3, t
+0000bd20: 696d 653a 2033 293e 0a20 2020 2061 7272  ime: 3)>.    arr
+0000bd30: 6179 285b 5b31 2e20 2c20 322e 202c 2033  ay([[1. , 2. , 3
+0000bd40: 2e20 5d2c 0a20 2020 2020 2020 2020 2020  . ],.           
+0000bd50: 5b30 2e31 2c20 302e 322c 2030 2e33 5d2c  [0.1, 0.2, 0.3],
+0000bd60: 0a20 2020 2020 2020 2020 2020 5b33 2e32  .           [3.2
+0000bd70: 2c20 302e 362c 2031 2e38 5d5d 290a 2020  , 0.6, 1.8]]).  
+0000bd80: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+0000bd90: 2020 2020 202a 2073 7061 6365 2020 2020       * space    
+0000bda0: 2873 7061 6365 2920 3c55 3220 2749 4127  (space) <U2 'IA'
+0000bdb0: 2027 494c 2720 2749 4e27 0a20 2020 2020   'IL' 'IN'.     
+0000bdc0: 202a 2074 696d 6520 2020 2020 2874 696d   * time     (tim
+0000bdd0: 6529 2064 6174 6574 696d 6536 345b 6e73  e) datetime64[ns
+0000bde0: 5d20 3230 3030 2d30 312d 3031 2032 3030  ] 2000-01-01 200
+0000bdf0: 302d 3031 2d30 3220 3230 3030 2d30 312d  0-01-02 2000-01-
+0000be00: 3033 0a20 2020 203e 3e3e 2064 615f 6220  03.    >>> da_b 
+0000be10: 3d20 4461 7461 4172 7261 7928 0a20 2020  = DataArray(.   
+0000be20: 202e 2e2e 2020 2020 206e 702e 6172 7261   ...     np.arra
+0000be30: 7928 5b5b 302e 322c 2030 2e34 2c20 302e  y([[0.2, 0.4, 0.
+0000be40: 365d 2c20 5b31 352c 2031 302c 2035 5d2c  6], [15, 10, 5],
+0000be50: 205b 332e 322c 2030 2e36 2c20 312e 385d   [3.2, 0.6, 1.8]
+0000be60: 5d29 2c0a 2020 2020 2e2e 2e20 2020 2020  ]),.    ...     
+0000be70: 6469 6d73 3d28 2273 7061 6365 222c 2022  dims=("space", "
+0000be80: 7469 6d65 2229 2c0a 2020 2020 2e2e 2e20  time"),.    ... 
+0000be90: 2020 2020 636f 6f72 6473 3d5b 0a20 2020      coords=[.   
+0000bea0: 202e 2e2e 2020 2020 2020 2020 2028 2273   ...         ("s
+0000beb0: 7061 6365 222c 205b 2249 4122 2c20 2249  pace", ["IA", "I
+0000bec0: 4c22 2c20 2249 4e22 5d29 2c0a 2020 2020  L", "IN"]),.    
+0000bed0: 2e2e 2e20 2020 2020 2020 2020 2822 7469  ...         ("ti
+0000bee0: 6d65 222c 2070 642e 6461 7465 5f72 616e  me", pd.date_ran
+0000bef0: 6765 2822 3230 3030 2d30 312d 3031 222c  ge("2000-01-01",
+0000bf00: 2066 7265 713d 2231 4422 2c20 7065 7269   freq="1D", peri
+0000bf10: 6f64 733d 3329 292c 0a20 2020 202e 2e2e  ods=3)),.    ...
+0000bf20: 2020 2020 205d 2c0a 2020 2020 2e2e 2e20       ],.    ... 
+0000bf30: 290a 2020 2020 3e3e 3e20 6461 5f62 0a20  ).    >>> da_b. 
+0000bf40: 2020 203c 7861 7272 6179 2e44 6174 6141     <xarray.DataA
+0000bf50: 7272 6179 2028 7370 6163 653a 2033 2c20  rray (space: 3, 
+0000bf60: 7469 6d65 3a20 3329 3e0a 2020 2020 6172  time: 3)>.    ar
+0000bf70: 7261 7928 5b5b 2030 2e32 2c20 2030 2e34  ray([[ 0.2,  0.4
+0000bf80: 2c20 2030 2e36 5d2c 0a20 2020 2020 2020  ,  0.6],.       
+0000bf90: 2020 2020 5b31 352e 202c 2031 302e 202c      [15. , 10. ,
+0000bfa0: 2020 352e 205d 2c0a 2020 2020 2020 2020    5. ],.        
+0000bfb0: 2020 205b 2033 2e32 2c20 2030 2e36 2c20     [ 3.2,  0.6, 
+0000bfc0: 2031 2e38 5d5d 290a 2020 2020 436f 6f72   1.8]]).    Coor
+0000bfd0: 6469 6e61 7465 733a 0a20 2020 2020 202a  dinates:.      *
+0000bfe0: 2073 7061 6365 2020 2020 2873 7061 6365   space    (space
+0000bff0: 2920 3c55 3220 2749 4127 2027 494c 2720  ) <U2 'IA' 'IL' 
+0000c000: 2749 4e27 0a20 2020 2020 202a 2074 696d  'IN'.      * tim
+0000c010: 6520 2020 2020 2874 696d 6529 2064 6174  e     (time) dat
+0000c020: 6574 696d 6536 345b 6e73 5d20 3230 3030  etime64[ns] 2000
+0000c030: 2d30 312d 3031 2032 3030 302d 3031 2d30  -01-01 2000-01-0
+0000c040: 3220 3230 3030 2d30 312d 3033 0a20 2020  2 2000-01-03.   
+0000c050: 203e 3e3e 2078 722e 636f 7272 2864 615f   >>> xr.corr(da_
+0000c060: 612c 2064 615f 6229 0a20 2020 203c 7861  a, da_b).    <xa
+0000c070: 7272 6179 2e44 6174 6141 7272 6179 2028  rray.DataArray (
+0000c080: 293e 0a20 2020 2061 7272 6179 282d 302e  )>.    array(-0.
+0000c090: 3537 3038 3737 3737 290a 2020 2020 3e3e  57087777).    >>
+0000c0a0: 3e20 7872 2e63 6f72 7228 6461 5f61 2c20  > xr.corr(da_a, 
+0000c0b0: 6461 5f62 2c20 6469 6d3d 2274 696d 6522  da_b, dim="time"
+0000c0c0: 290a 2020 2020 3c78 6172 7261 792e 4461  ).    <xarray.Da
+0000c0d0: 7461 4172 7261 7920 2873 7061 6365 3a20  taArray (space: 
+0000c0e0: 3329 3e0a 2020 2020 6172 7261 7928 5b20  3)>.    array([ 
+0000c0f0: 312e 2c20 2d31 2e2c 2020 312e 5d29 0a20  1., -1.,  1.]). 
+0000c100: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+0000c110: 2020 2020 2020 2a20 7370 6163 6520 2020        * space   
+0000c120: 2028 7370 6163 6529 203c 5532 2027 4941   (space) <U2 'IA
+0000c130: 2720 2749 4c27 2027 494e 270a 2020 2020  ' 'IL' 'IN'.    
+0000c140: 2222 220a 2020 2020 6672 6f6d 2078 6172  """.    from xar
+0000c150: 7261 792e 636f 7265 2e64 6174 6161 7272  ray.core.dataarr
+0000c160: 6179 2069 6d70 6f72 7420 4461 7461 4172  ay import DataAr
+0000c170: 7261 790a 0a20 2020 2069 6620 616e 7928  ray..    if any(
+0000c180: 6e6f 7420 6973 696e 7374 616e 6365 2861  not isinstance(a
+0000c190: 7272 2c20 4461 7461 4172 7261 7929 2066  rr, DataArray) f
+0000c1a0: 6f72 2061 7272 2069 6e20 5b64 615f 612c  or arr in [da_a,
+0000c1b0: 2064 615f 625d 293a 0a20 2020 2020 2020   da_b]):.       
+0000c1c0: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+0000c1d0: 280a 2020 2020 2020 2020 2020 2020 224f  (.            "O
+0000c1e0: 6e6c 7920 7872 2e44 6174 6141 7272 6179  nly xr.DataArray
+0000c1f0: 2069 7320 7375 7070 6f72 7465 642e 220a   is supported.".
+0000c200: 2020 2020 2020 2020 2020 2020 2247 6976              "Giv
+0000c210: 656e 207b 7d2e 222e 666f 726d 6174 285b  en {}.".format([
+0000c220: 7479 7065 2861 7272 2920 666f 7220 6172  type(arr) for ar
+0000c230: 7220 696e 205b 6461 5f61 2c20 6461 5f62  r in [da_a, da_b
+0000c240: 5d5d 290a 2020 2020 2020 2020 290a 0a20  ]]).        ).. 
+0000c250: 2020 2072 6574 7572 6e20 5f63 6f76 5f63     return _cov_c
+0000c260: 6f72 7228 6461 5f61 2c20 6461 5f62 2c20  orr(da_a, da_b, 
+0000c270: 6469 6d3d 6469 6d2c 206d 6574 686f 643d  dim=dim, method=
+0000c280: 2263 6f72 7222 290a 0a0a 6465 6620 5f63  "corr")...def _c
+0000c290: 6f76 5f63 6f72 7228 0a20 2020 2064 615f  ov_corr(.    da_
+0000c2a0: 613a 2054 5f44 6174 6141 7272 6179 2c0a  a: T_DataArray,.
+0000c2b0: 2020 2020 6461 5f62 3a20 545f 4461 7461      da_b: T_Data
+0000c2c0: 4172 7261 792c 0a20 2020 2064 696d 3a20  Array,.    dim: 
+0000c2d0: 4469 6d73 203d 204e 6f6e 652c 0a20 2020  Dims = None,.   
+0000c2e0: 2064 646f 663a 2069 6e74 203d 2030 2c0a   ddof: int = 0,.
+0000c2f0: 2020 2020 6d65 7468 6f64 3a20 4c69 7465      method: Lite
+0000c300: 7261 6c5b 2263 6f76 222c 2022 636f 7272  ral["cov", "corr
+0000c310: 222c 204e 6f6e 655d 203d 204e 6f6e 652c  ", None] = None,
+0000c320: 0a29 202d 3e20 545f 4461 7461 4172 7261  .) -> T_DataArra
+0000c330: 793a 0a20 2020 2022 2222 0a20 2020 2049  y:.    """.    I
+0000c340: 6e74 6572 6e61 6c20 6d65 7468 6f64 2066  nternal method f
+0000c350: 6f72 2078 722e 636f 7628 2920 616e 6420  or xr.cov() and 
+0000c360: 7872 2e63 6f72 7228 2920 736f 206f 6e6c  xr.corr() so onl
+0000c370: 7920 6861 7665 2074 6f0a 2020 2020 7361  y have to.    sa
+0000c380: 6e69 7469 7a65 2074 6865 2069 6e70 7574  nitize the input
+0000c390: 2061 7272 6179 7320 6f6e 6365 2061 6e64   arrays once and
+0000c3a0: 2077 6520 646f 6e27 7420 7265 7065 6174   we don't repeat
+0000c3b0: 2063 6f64 652e 0a20 2020 2022 2222 0a20   code..    """. 
+0000c3c0: 2020 2023 2031 2e20 4272 6f61 6463 6173     # 1. Broadcas
+0000c3d0: 7420 7468 6520 7477 6f20 6172 7261 7973  t the two arrays
+0000c3e0: 0a20 2020 2064 615f 612c 2064 615f 6220  .    da_a, da_b 
+0000c3f0: 3d20 616c 6967 6e28 6461 5f61 2c20 6461  = align(da_a, da
+0000c400: 5f62 2c20 6a6f 696e 3d22 696e 6e65 7222  _b, join="inner"
+0000c410: 2c20 636f 7079 3d46 616c 7365 290a 0a20  , copy=False).. 
+0000c420: 2020 2023 2032 2e20 4967 6e6f 7265 2074     # 2. Ignore t
+0000c430: 6865 206e 616e 730a 2020 2020 7661 6c69  he nans.    vali
+0000c440: 645f 7661 6c75 6573 203d 2064 615f 612e  d_values = da_a.
+0000c450: 6e6f 746e 756c 6c28 2920 2620 6461 5f62  notnull() & da_b
+0000c460: 2e6e 6f74 6e75 6c6c 2829 0a20 2020 2064  .notnull().    d
+0000c470: 615f 6120 3d20 6461 5f61 2e77 6865 7265  a_a = da_a.where
+0000c480: 2876 616c 6964 5f76 616c 7565 7329 0a20  (valid_values). 
+0000c490: 2020 2064 615f 6220 3d20 6461 5f62 2e77     da_b = da_b.w
+0000c4a0: 6865 7265 2876 616c 6964 5f76 616c 7565  here(valid_value
+0000c4b0: 7329 0a20 2020 2076 616c 6964 5f63 6f75  s).    valid_cou
+0000c4c0: 6e74 203d 2076 616c 6964 5f76 616c 7565  nt = valid_value
+0000c4d0: 732e 7375 6d28 6469 6d29 202d 2064 646f  s.sum(dim) - ddo
+0000c4e0: 660a 0a20 2020 2023 2033 2e20 4465 7472  f..    # 3. Detr
+0000c4f0: 656e 6420 616c 6f6e 6720 7468 6520 6769  end along the gi
+0000c500: 7665 6e20 6469 6d0a 2020 2020 6465 6d65  ven dim.    deme
+0000c510: 616e 6564 5f64 615f 6120 3d20 6461 5f61  aned_da_a = da_a
+0000c520: 202d 2064 615f 612e 6d65 616e 2864 696d   - da_a.mean(dim
+0000c530: 3d64 696d 290a 2020 2020 6465 6d65 616e  =dim).    demean
+0000c540: 6564 5f64 615f 6220 3d20 6461 5f62 202d  ed_da_b = da_b -
+0000c550: 2064 615f 622e 6d65 616e 2864 696d 3d64   da_b.mean(dim=d
+0000c560: 696d 290a 0a20 2020 2023 2034 2e20 436f  im)..    # 4. Co
+0000c570: 6d70 7574 6520 636f 7661 7269 616e 6365  mpute covariance
+0000c580: 2061 6c6f 6e67 2074 6865 2067 6976 656e   along the given
+0000c590: 2064 696d 0a20 2020 2023 204e 2e42 2e20   dim.    # N.B. 
+0000c5a0: 6073 6b69 706e 613d 5472 7565 6020 6973  `skipna=True` is
+0000c5b0: 2072 6571 7569 7265 6420 6f72 2061 7574   required or aut
+0000c5c0: 6f2d 636f 7661 7269 616e 6365 2069 7320  o-covariance is 
+0000c5d0: 636f 6d70 7574 6564 2069 6e63 6f72 7265  computed incorre
+0000c5e0: 6374 6c79 2e20 452e 672e 0a20 2020 2023  ctly. E.g..    #
+0000c5f0: 2054 7279 2078 722e 636f 7628 6461 2c64   Try xr.cov(da,d
+0000c600: 6129 2066 6f72 2064 6120 3d20 7872 2e44  a) for da = xr.D
+0000c610: 6174 6141 7272 6179 285b 5b31 2c20 325d  ataArray([[1, 2]
+0000c620: 2c20 5b31 2c20 6e70 2e6e 616e 5d5d 2c20  , [1, np.nan]], 
+0000c630: 6469 6d73 3d5b 2278 222c 2022 7469 6d65  dims=["x", "time
+0000c640: 225d 290a 2020 2020 636f 7620 3d20 2864  "]).    cov = (d
+0000c650: 656d 6561 6e65 645f 6461 5f61 2e63 6f6e  emeaned_da_a.con
+0000c660: 6a28 2920 2a20 6465 6d65 616e 6564 5f64  j() * demeaned_d
+0000c670: 615f 6229 2e73 756d 280a 2020 2020 2020  a_b).sum(.      
+0000c680: 2020 6469 6d3d 6469 6d2c 2073 6b69 706e    dim=dim, skipn
+0000c690: 613d 5472 7565 2c20 6d69 6e5f 636f 756e  a=True, min_coun
+0000c6a0: 743d 310a 2020 2020 2920 2f20 2876 616c  t=1.    ) / (val
+0000c6b0: 6964 5f63 6f75 6e74 290a 0a20 2020 2069  id_count)..    i
+0000c6c0: 6620 6d65 7468 6f64 203d 3d20 2263 6f76  f method == "cov
+0000c6d0: 223a 0a20 2020 2020 2020 2072 6574 7572  ":.        retur
+0000c6e0: 6e20 636f 7620 2023 2074 7970 653a 2069  n cov  # type: i
+0000c6f0: 676e 6f72 655b 7265 7475 726e 2d76 616c  gnore[return-val
+0000c700: 7565 5d0a 0a20 2020 2065 6c73 653a 0a20  ue]..    else:. 
+0000c710: 2020 2020 2020 2023 2063 6f6d 7075 7465         # compute
+0000c720: 2073 7464 202b 2063 6f72 720a 2020 2020   std + corr.    
+0000c730: 2020 2020 6461 5f61 5f73 7464 203d 2064      da_a_std = d
+0000c740: 615f 612e 7374 6428 6469 6d3d 6469 6d29  a_a.std(dim=dim)
+0000c750: 0a20 2020 2020 2020 2064 615f 625f 7374  .        da_b_st
+0000c760: 6420 3d20 6461 5f62 2e73 7464 2864 696d  d = da_b.std(dim
+0000c770: 3d64 696d 290a 2020 2020 2020 2020 636f  =dim).        co
+0000c780: 7272 203d 2063 6f76 202f 2028 6461 5f61  rr = cov / (da_a
+0000c790: 5f73 7464 202a 2064 615f 625f 7374 6429  _std * da_b_std)
+0000c7a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000c7b0: 636f 7272 2020 2320 7479 7065 3a20 6967  corr  # type: ig
+0000c7c0: 6e6f 7265 5b72 6574 7572 6e2d 7661 6c75  nore[return-valu
+0000c7d0: 655d 0a0a 0a64 6566 2063 726f 7373 280a  e]...def cross(.
+0000c7e0: 2020 2020 613a 2044 6174 6141 7272 6179      a: DataArray
+0000c7f0: 207c 2056 6172 6961 626c 652c 2062 3a20   | Variable, b: 
+0000c800: 4461 7461 4172 7261 7920 7c20 5661 7269  DataArray | Vari
+0000c810: 6162 6c65 2c20 2a2c 2064 696d 3a20 4861  able, *, dim: Ha
+0000c820: 7368 6162 6c65 0a29 202d 3e20 4461 7461  shable.) -> Data
 0000c830: 4172 7261 7920 7c20 5661 7269 6162 6c65  Array | Variable
-0000c840: 2c20 623a 2044 6174 6141 7272 6179 207c  , b: DataArray |
-0000c850: 2056 6172 6961 626c 652c 202a 2c20 6469   Variable, *, di
-0000c860: 6d3a 2048 6173 6861 626c 650a 2920 2d3e  m: Hashable.) ->
-0000c870: 2044 6174 6141 7272 6179 207c 2056 6172   DataArray | Var
-0000c880: 6961 626c 653a 0a20 2020 2022 2222 0a20  iable:.    """. 
-0000c890: 2020 2043 6f6d 7075 7465 2074 6865 2063     Compute the c
-0000c8a0: 726f 7373 2070 726f 6475 6374 206f 6620  ross product of 
-0000c8b0: 7477 6f20 2861 7272 6179 7320 6f66 2920  two (arrays of) 
-0000c8c0: 7665 6374 6f72 732e 0a0a 2020 2020 5468  vectors...    Th
-0000c8d0: 6520 6372 6f73 7320 7072 6f64 7563 7420  e cross product 
-0000c8e0: 6f66 2060 6160 2061 6e64 2060 6260 2069  of `a` and `b` i
-0000c8f0: 6e20 3a6d 6174 683a 6052 5e33 6020 6973  n :math:`R^3` is
-0000c900: 2061 2076 6563 746f 720a 2020 2020 7065   a vector.    pe
-0000c910: 7270 656e 6469 6375 6c61 7220 746f 2062  rpendicular to b
-0000c920: 6f74 6820 6061 6020 616e 6420 6062 602e  oth `a` and `b`.
-0000c930: 2054 6865 2076 6563 746f 7273 2069 6e20   The vectors in 
-0000c940: 6061 6020 616e 6420 6062 6020 6172 650a  `a` and `b` are.
-0000c950: 2020 2020 6465 6669 6e65 6420 6279 2074      defined by t
-0000c960: 6865 2076 616c 7565 7320 616c 6f6e 6720  he values along 
-0000c970: 7468 6520 6469 6d65 6e73 696f 6e20 6064  the dimension `d
-0000c980: 696d 6020 616e 6420 6361 6e20 6861 7665  im` and can have
-0000c990: 2073 697a 6573 0a20 2020 2031 2c20 3220   sizes.    1, 2 
-0000c9a0: 6f72 2033 2e20 5768 6572 6520 7468 6520  or 3. Where the 
-0000c9b0: 7369 7a65 206f 6620 6569 7468 6572 2060  size of either `
-0000c9c0: 6160 206f 7220 6062 6020 6973 0a20 2020  a` or `b` is.   
-0000c9d0: 2031 206f 7220 322c 2074 6865 2072 656d   1 or 2, the rem
-0000c9e0: 6169 6e69 6e67 2063 6f6d 706f 6e65 6e74  aining component
-0000c9f0: 7320 6f66 2074 6865 2069 6e70 7574 2076  s of the input v
-0000ca00: 6563 746f 7220 6973 2061 7373 756d 6564  ector is assumed
-0000ca10: 2074 6f0a 2020 2020 6265 207a 6572 6f20   to.    be zero 
-0000ca20: 616e 6420 7468 6520 6372 6f73 7320 7072  and the cross pr
-0000ca30: 6f64 7563 7420 6361 6c63 756c 6174 6564  oduct calculated
-0000ca40: 2061 6363 6f72 6469 6e67 6c79 2e20 496e   accordingly. In
-0000ca50: 2063 6173 6573 2077 6865 7265 0a20 2020   cases where.   
-0000ca60: 2062 6f74 6820 696e 7075 7420 7665 6374   both input vect
-0000ca70: 6f72 7320 6861 7665 2064 696d 656e 7369  ors have dimensi
-0000ca80: 6f6e 2032 2c20 7468 6520 7a2d 636f 6d70  on 2, the z-comp
-0000ca90: 6f6e 656e 7420 6f66 2074 6865 2063 726f  onent of the cro
-0000caa0: 7373 0a20 2020 2070 726f 6475 6374 2069  ss.    product i
-0000cab0: 7320 7265 7475 726e 6564 2e0a 0a20 2020  s returned...   
-0000cac0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-0000cad0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2061  ----------.    a
-0000cae0: 2c20 6220 3a20 4461 7461 4172 7261 7920  , b : DataArray 
-0000caf0: 6f72 2056 6172 6961 626c 650a 2020 2020  or Variable.    
-0000cb00: 2020 2020 436f 6d70 6f6e 656e 7473 206f      Components o
-0000cb10: 6620 7468 6520 6669 7273 7420 616e 6420  f the first and 
-0000cb20: 7365 636f 6e64 2076 6563 746f 7228 7329  second vector(s)
-0000cb30: 2e0a 2020 2020 6469 6d20 3a20 6861 7368  ..    dim : hash
-0000cb40: 6162 6c65 0a20 2020 2020 2020 2054 6865  able.        The
-0000cb50: 2064 696d 656e 7369 6f6e 2061 6c6f 6e67   dimension along
-0000cb60: 2077 6869 6368 2074 6865 2063 726f 7373   which the cross
-0000cb70: 2070 726f 6475 6374 2077 696c 6c20 6265   product will be
-0000cb80: 2063 6f6d 7075 7465 642e 0a20 2020 2020   computed..     
-0000cb90: 2020 204d 7573 7420 6265 2061 7661 696c     Must be avail
-0000cba0: 6162 6c65 2069 6e20 626f 7468 2076 6563  able in both vec
-0000cbb0: 746f 7273 2e0a 0a20 2020 2045 7861 6d70  tors...    Examp
-0000cbc0: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
-0000cbd0: 0a20 2020 2056 6563 746f 7220 6372 6f73  .    Vector cros
-0000cbe0: 732d 7072 6f64 7563 7420 7769 7468 2033  s-product with 3
-0000cbf0: 2064 696d 656e 7369 6f6e 733a 0a0a 2020   dimensions:..  
-0000cc00: 2020 3e3e 3e20 6120 3d20 7872 2e44 6174    >>> a = xr.Dat
-0000cc10: 6141 7272 6179 285b 312c 2032 2c20 335d  aArray([1, 2, 3]
-0000cc20: 290a 2020 2020 3e3e 3e20 6220 3d20 7872  ).    >>> b = xr
-0000cc30: 2e44 6174 6141 7272 6179 285b 342c 2035  .DataArray([4, 5
-0000cc40: 2c20 365d 290a 2020 2020 3e3e 3e20 7872  , 6]).    >>> xr
-0000cc50: 2e63 726f 7373 2861 2c20 622c 2064 696d  .cross(a, b, dim
-0000cc60: 3d22 6469 6d5f 3022 290a 2020 2020 3c78  ="dim_0").    <x
-0000cc70: 6172 7261 792e 4461 7461 4172 7261 7920  array.DataArray 
-0000cc80: 2864 696d 5f30 3a20 3329 3e0a 2020 2020  (dim_0: 3)>.    
-0000cc90: 6172 7261 7928 5b2d 332c 2020 362c 202d  array([-3,  6, -
-0000cca0: 335d 290a 2020 2020 4469 6d65 6e73 696f  3]).    Dimensio
-0000ccb0: 6e73 2077 6974 686f 7574 2063 6f6f 7264  ns without coord
-0000ccc0: 696e 6174 6573 3a20 6469 6d5f 300a 0a20  inates: dim_0.. 
-0000ccd0: 2020 2056 6563 746f 7220 6372 6f73 732d     Vector cross-
-0000cce0: 7072 6f64 7563 7420 7769 7468 2032 2064  product with 2 d
-0000ccf0: 696d 656e 7369 6f6e 732c 2072 6574 7572  imensions, retur
-0000cd00: 6e73 2069 6e20 7468 6520 7065 7270 656e  ns in the perpen
-0000cd10: 6469 6375 6c61 720a 2020 2020 6469 7265  dicular.    dire
-0000cd20: 6374 696f 6e3a 0a0a 2020 2020 3e3e 3e20  ction:..    >>> 
-0000cd30: 6120 3d20 7872 2e44 6174 6141 7272 6179  a = xr.DataArray
-0000cd40: 285b 312c 2032 5d29 0a20 2020 203e 3e3e  ([1, 2]).    >>>
-0000cd50: 2062 203d 2078 722e 4461 7461 4172 7261   b = xr.DataArra
-0000cd60: 7928 5b34 2c20 355d 290a 2020 2020 3e3e  y([4, 5]).    >>
-0000cd70: 3e20 7872 2e63 726f 7373 2861 2c20 622c  > xr.cross(a, b,
-0000cd80: 2064 696d 3d22 6469 6d5f 3022 290a 2020   dim="dim_0").  
-0000cd90: 2020 3c78 6172 7261 792e 4461 7461 4172    <xarray.DataAr
-0000cda0: 7261 7920 2829 3e0a 2020 2020 6172 7261  ray ()>.    arra
-0000cdb0: 7928 2d33 290a 0a20 2020 2056 6563 746f  y(-3)..    Vecto
-0000cdc0: 7220 6372 6f73 732d 7072 6f64 7563 7420  r cross-product 
-0000cdd0: 7769 7468 2033 2064 696d 656e 7369 6f6e  with 3 dimension
-0000cde0: 7320 6275 7420 7a65 726f 7320 6174 2074  s but zeros at t
-0000cdf0: 6865 206c 6173 7420 6178 6973 0a20 2020  he last axis.   
-0000ce00: 2079 6965 6c64 7320 7468 6520 7361 6d65   yields the same
-0000ce10: 2072 6573 756c 7473 2061 7320 7769 7468   results as with
-0000ce20: 2032 2064 696d 656e 7369 6f6e 733a 0a0a   2 dimensions:..
-0000ce30: 2020 2020 3e3e 3e20 6120 3d20 7872 2e44      >>> a = xr.D
-0000ce40: 6174 6141 7272 6179 285b 312c 2032 2c20  ataArray([1, 2, 
-0000ce50: 305d 290a 2020 2020 3e3e 3e20 6220 3d20  0]).    >>> b = 
-0000ce60: 7872 2e44 6174 6141 7272 6179 285b 342c  xr.DataArray([4,
-0000ce70: 2035 2c20 305d 290a 2020 2020 3e3e 3e20   5, 0]).    >>> 
-0000ce80: 7872 2e63 726f 7373 2861 2c20 622c 2064  xr.cross(a, b, d
-0000ce90: 696d 3d22 6469 6d5f 3022 290a 2020 2020  im="dim_0").    
-0000cea0: 3c78 6172 7261 792e 4461 7461 4172 7261  <xarray.DataArra
-0000ceb0: 7920 2864 696d 5f30 3a20 3329 3e0a 2020  y (dim_0: 3)>.  
-0000cec0: 2020 6172 7261 7928 5b20 302c 2020 302c    array([ 0,  0,
-0000ced0: 202d 335d 290a 2020 2020 4469 6d65 6e73   -3]).    Dimens
-0000cee0: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
-0000cef0: 7264 696e 6174 6573 3a20 6469 6d5f 300a  rdinates: dim_0.
-0000cf00: 0a20 2020 204f 6e65 2076 6563 746f 7220  .    One vector 
-0000cf10: 7769 7468 2064 696d 656e 7369 6f6e 2032  with dimension 2
-0000cf20: 3a0a 0a20 2020 203e 3e3e 2061 203d 2078  :..    >>> a = x
-0000cf30: 722e 4461 7461 4172 7261 7928 0a20 2020  r.DataArray(.   
-0000cf40: 202e 2e2e 2020 2020 205b 312c 2032 5d2c   ...     [1, 2],
-0000cf50: 0a20 2020 202e 2e2e 2020 2020 2064 696d  .    ...     dim
-0000cf60: 733d 5b22 6361 7274 6573 6961 6e22 5d2c  s=["cartesian"],
-0000cf70: 0a20 2020 202e 2e2e 2020 2020 2063 6f6f  .    ...     coo
-0000cf80: 7264 733d 6469 6374 2863 6172 7465 7369  rds=dict(cartesi
-0000cf90: 616e 3d28 5b22 6361 7274 6573 6961 6e22  an=(["cartesian"
-0000cfa0: 5d2c 205b 2278 222c 2022 7922 5d29 292c  ], ["x", "y"])),
-0000cfb0: 0a20 2020 202e 2e2e 2029 0a20 2020 203e  .    ... ).    >
-0000cfc0: 3e3e 2062 203d 2078 722e 4461 7461 4172  >> b = xr.DataAr
-0000cfd0: 7261 7928 0a20 2020 202e 2e2e 2020 2020  ray(.    ...    
-0000cfe0: 205b 342c 2035 2c20 365d 2c0a 2020 2020   [4, 5, 6],.    
-0000cff0: 2e2e 2e20 2020 2020 6469 6d73 3d5b 2263  ...     dims=["c
-0000d000: 6172 7465 7369 616e 225d 2c0a 2020 2020  artesian"],.    
-0000d010: 2e2e 2e20 2020 2020 636f 6f72 6473 3d64  ...     coords=d
-0000d020: 6963 7428 6361 7274 6573 6961 6e3d 285b  ict(cartesian=([
-0000d030: 2263 6172 7465 7369 616e 225d 2c20 5b22  "cartesian"], ["
-0000d040: 7822 2c20 2279 222c 2022 7a22 5d29 292c  x", "y", "z"])),
-0000d050: 0a20 2020 202e 2e2e 2029 0a20 2020 203e  .    ... ).    >
-0000d060: 3e3e 2078 722e 6372 6f73 7328 612c 2062  >> xr.cross(a, b
-0000d070: 2c20 6469 6d3d 2263 6172 7465 7369 616e  , dim="cartesian
-0000d080: 2229 0a20 2020 203c 7861 7272 6179 2e44  ").    <xarray.D
-0000d090: 6174 6141 7272 6179 2028 6361 7274 6573  ataArray (cartes
-0000d0a0: 6961 6e3a 2033 293e 0a20 2020 2061 7272  ian: 3)>.    arr
-0000d0b0: 6179 285b 3132 2c20 2d36 2c20 2d33 5d29  ay([12, -6, -3])
-0000d0c0: 0a20 2020 2043 6f6f 7264 696e 6174 6573  .    Coordinates
-0000d0d0: 3a0a 2020 2020 2020 2a20 6361 7274 6573  :.      * cartes
-0000d0e0: 6961 6e20 2028 6361 7274 6573 6961 6e29  ian  (cartesian)
-0000d0f0: 203c 5531 2027 7827 2027 7927 2027 7a27   <U1 'x' 'y' 'z'
-0000d100: 0a0a 2020 2020 4f6e 6520 7665 6374 6f72  ..    One vector
-0000d110: 2077 6974 6820 6469 6d65 6e73 696f 6e20   with dimension 
-0000d120: 3220 6275 7420 636f 6f72 6473 2069 6e20  2 but coords in 
-0000d130: 6f74 6865 7220 706f 7369 7469 6f6e 733a  other positions:
-0000d140: 0a0a 2020 2020 3e3e 3e20 6120 3d20 7872  ..    >>> a = xr
-0000d150: 2e44 6174 6141 7272 6179 280a 2020 2020  .DataArray(.    
-0000d160: 2e2e 2e20 2020 2020 5b31 2c20 325d 2c0a  ...     [1, 2],.
-0000d170: 2020 2020 2e2e 2e20 2020 2020 6469 6d73      ...     dims
-0000d180: 3d5b 2263 6172 7465 7369 616e 225d 2c0a  =["cartesian"],.
-0000d190: 2020 2020 2e2e 2e20 2020 2020 636f 6f72      ...     coor
-0000d1a0: 6473 3d64 6963 7428 6361 7274 6573 6961  ds=dict(cartesia
-0000d1b0: 6e3d 285b 2263 6172 7465 7369 616e 225d  n=(["cartesian"]
-0000d1c0: 2c20 5b22 7822 2c20 227a 225d 2929 2c0a  , ["x", "z"])),.
-0000d1d0: 2020 2020 2e2e 2e20 290a 2020 2020 3e3e      ... ).    >>
-0000d1e0: 3e20 6220 3d20 7872 2e44 6174 6141 7272  > b = xr.DataArr
-0000d1f0: 6179 280a 2020 2020 2e2e 2e20 2020 2020  ay(.    ...     
-0000d200: 5b34 2c20 352c 2036 5d2c 0a20 2020 202e  [4, 5, 6],.    .
-0000d210: 2e2e 2020 2020 2064 696d 733d 5b22 6361  ..     dims=["ca
-0000d220: 7274 6573 6961 6e22 5d2c 0a20 2020 202e  rtesian"],.    .
-0000d230: 2e2e 2020 2020 2063 6f6f 7264 733d 6469  ..     coords=di
-0000d240: 6374 2863 6172 7465 7369 616e 3d28 5b22  ct(cartesian=(["
-0000d250: 6361 7274 6573 6961 6e22 5d2c 205b 2278  cartesian"], ["x
-0000d260: 222c 2022 7922 2c20 227a 225d 2929 2c0a  ", "y", "z"])),.
-0000d270: 2020 2020 2e2e 2e20 290a 2020 2020 3e3e      ... ).    >>
-0000d280: 3e20 7872 2e63 726f 7373 2861 2c20 622c  > xr.cross(a, b,
-0000d290: 2064 696d 3d22 6361 7274 6573 6961 6e22   dim="cartesian"
-0000d2a0: 290a 2020 2020 3c78 6172 7261 792e 4461  ).    <xarray.Da
-0000d2b0: 7461 4172 7261 7920 2863 6172 7465 7369  taArray (cartesi
-0000d2c0: 616e 3a20 3329 3e0a 2020 2020 6172 7261  an: 3)>.    arra
-0000d2d0: 7928 5b2d 3130 2c20 2020 322c 2020 2035  y([-10,   2,   5
-0000d2e0: 5d29 0a20 2020 2043 6f6f 7264 696e 6174  ]).    Coordinat
-0000d2f0: 6573 3a0a 2020 2020 2020 2a20 6361 7274  es:.      * cart
-0000d300: 6573 6961 6e20 2028 6361 7274 6573 6961  esian  (cartesia
-0000d310: 6e29 203c 5531 2027 7827 2027 7927 2027  n) <U1 'x' 'y' '
-0000d320: 7a27 0a0a 2020 2020 4d75 6c74 6970 6c65  z'..    Multiple
-0000d330: 2076 6563 746f 7220 6372 6f73 732d 7072   vector cross-pr
-0000d340: 6f64 7563 7473 2e20 4e6f 7465 2074 6861  oducts. Note tha
-0000d350: 7420 7468 6520 6469 7265 6374 696f 6e20  t the direction 
-0000d360: 6f66 2074 6865 0a20 2020 2063 726f 7373  of the.    cross
-0000d370: 2070 726f 6475 6374 2076 6563 746f 7220   product vector 
-0000d380: 6973 2064 6566 696e 6564 2062 7920 7468  is defined by th
-0000d390: 6520 7269 6768 742d 6861 6e64 2072 756c  e right-hand rul
-0000d3a0: 653a 0a0a 2020 2020 3e3e 3e20 6120 3d20  e:..    >>> a = 
-0000d3b0: 7872 2e44 6174 6141 7272 6179 280a 2020  xr.DataArray(.  
-0000d3c0: 2020 2e2e 2e20 2020 2020 5b5b 312c 2032    ...     [[1, 2
-0000d3d0: 2c20 335d 2c20 5b34 2c20 352c 2036 5d5d  , 3], [4, 5, 6]]
-0000d3e0: 2c0a 2020 2020 2e2e 2e20 2020 2020 6469  ,.    ...     di
-0000d3f0: 6d73 3d28 2274 696d 6522 2c20 2263 6172  ms=("time", "car
-0000d400: 7465 7369 616e 2229 2c0a 2020 2020 2e2e  tesian"),.    ..
-0000d410: 2e20 2020 2020 636f 6f72 6473 3d64 6963  .     coords=dic
-0000d420: 7428 0a20 2020 202e 2e2e 2020 2020 2020  t(.    ...      
-0000d430: 2020 2074 696d 653d 285b 2274 696d 6522     time=(["time"
-0000d440: 5d2c 205b 302c 2031 5d29 2c0a 2020 2020  ], [0, 1]),.    
-0000d450: 2e2e 2e20 2020 2020 2020 2020 6361 7274  ...         cart
-0000d460: 6573 6961 6e3d 285b 2263 6172 7465 7369  esian=(["cartesi
-0000d470: 616e 225d 2c20 5b22 7822 2c20 2279 222c  an"], ["x", "y",
-0000d480: 2022 7a22 5d29 2c0a 2020 2020 2e2e 2e20   "z"]),.    ... 
-0000d490: 2020 2020 292c 0a20 2020 202e 2e2e 2029      ),.    ... )
-0000d4a0: 0a20 2020 203e 3e3e 2062 203d 2078 722e  .    >>> b = xr.
-0000d4b0: 4461 7461 4172 7261 7928 0a20 2020 202e  DataArray(.    .
-0000d4c0: 2e2e 2020 2020 205b 5b34 2c20 352c 2036  ..     [[4, 5, 6
-0000d4d0: 5d2c 205b 312c 2032 2c20 335d 5d2c 0a20  ], [1, 2, 3]],. 
-0000d4e0: 2020 202e 2e2e 2020 2020 2064 696d 733d     ...     dims=
-0000d4f0: 2822 7469 6d65 222c 2022 6361 7274 6573  ("time", "cartes
-0000d500: 6961 6e22 292c 0a20 2020 202e 2e2e 2020  ian"),.    ...  
-0000d510: 2020 2063 6f6f 7264 733d 6469 6374 280a     coords=dict(.
-0000d520: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-0000d530: 7469 6d65 3d28 5b22 7469 6d65 225d 2c20  time=(["time"], 
-0000d540: 5b30 2c20 315d 292c 0a20 2020 202e 2e2e  [0, 1]),.    ...
-0000d550: 2020 2020 2020 2020 2063 6172 7465 7369           cartesi
-0000d560: 616e 3d28 5b22 6361 7274 6573 6961 6e22  an=(["cartesian"
-0000d570: 5d2c 205b 2278 222c 2022 7922 2c20 227a  ], ["x", "y", "z
-0000d580: 225d 292c 0a20 2020 202e 2e2e 2020 2020  "]),.    ...    
-0000d590: 2029 2c0a 2020 2020 2e2e 2e20 290a 2020   ),.    ... ).  
-0000d5a0: 2020 3e3e 3e20 7872 2e63 726f 7373 2861    >>> xr.cross(a
-0000d5b0: 2c20 622c 2064 696d 3d22 6361 7274 6573  , b, dim="cartes
-0000d5c0: 6961 6e22 290a 2020 2020 3c78 6172 7261  ian").    <xarra
-0000d5d0: 792e 4461 7461 4172 7261 7920 2874 696d  y.DataArray (tim
-0000d5e0: 653a 2032 2c20 6361 7274 6573 6961 6e3a  e: 2, cartesian:
-0000d5f0: 2033 293e 0a20 2020 2061 7272 6179 285b   3)>.    array([
-0000d600: 5b2d 332c 2020 362c 202d 335d 2c0a 2020  [-3,  6, -3],.  
-0000d610: 2020 2020 2020 2020 205b 2033 2c20 2d36           [ 3, -6
-0000d620: 2c20 2033 5d5d 290a 2020 2020 436f 6f72  ,  3]]).    Coor
-0000d630: 6469 6e61 7465 733a 0a20 2020 2020 202a  dinates:.      *
-0000d640: 2074 696d 6520 2020 2020 2020 2874 696d   time       (tim
-0000d650: 6529 2069 6e74 3634 2030 2031 0a20 2020  e) int64 0 1.   
-0000d660: 2020 202a 2063 6172 7465 7369 616e 2020     * cartesian  
-0000d670: 2863 6172 7465 7369 616e 2920 3c55 3120  (cartesian) <U1 
-0000d680: 2778 2720 2779 2720 277a 270a 0a20 2020  'x' 'y' 'z'..   
-0000d690: 2043 726f 7373 2063 616e 2062 6520 6361   Cross can be ca
-0000d6a0: 6c6c 6564 206f 6e20 4461 7461 7365 7473  lled on Datasets
-0000d6b0: 2062 7920 636f 6e76 6572 7469 6e67 2074   by converting t
-0000d6c0: 6f20 4461 7461 4172 7261 7973 2061 6e64  o DataArrays and
-0000d6d0: 206c 6174 6572 0a20 2020 2062 6163 6b20   later.    back 
-0000d6e0: 746f 2061 2044 6174 6173 6574 3a0a 0a20  to a Dataset:.. 
-0000d6f0: 2020 203e 3e3e 2064 735f 6120 3d20 7872     >>> ds_a = xr
-0000d700: 2e44 6174 6173 6574 2864 6963 7428 783d  .Dataset(dict(x=
-0000d710: 2822 6469 6d5f 3022 2c20 5b31 5d29 2c20  ("dim_0", [1]), 
-0000d720: 793d 2822 6469 6d5f 3022 2c20 5b32 5d29  y=("dim_0", [2])
-0000d730: 2c20 7a3d 2822 6469 6d5f 3022 2c20 5b33  , z=("dim_0", [3
-0000d740: 5d29 2929 0a20 2020 203e 3e3e 2064 735f  ]))).    >>> ds_
-0000d750: 6220 3d20 7872 2e44 6174 6173 6574 2864  b = xr.Dataset(d
-0000d760: 6963 7428 783d 2822 6469 6d5f 3022 2c20  ict(x=("dim_0", 
-0000d770: 5b34 5d29 2c20 793d 2822 6469 6d5f 3022  [4]), y=("dim_0"
-0000d780: 2c20 5b35 5d29 2c20 7a3d 2822 6469 6d5f  , [5]), z=("dim_
-0000d790: 3022 2c20 5b36 5d29 2929 0a20 2020 203e  0", [6]))).    >
-0000d7a0: 3e3e 2063 203d 2078 722e 6372 6f73 7328  >> c = xr.cross(
-0000d7b0: 0a20 2020 202e 2e2e 2020 2020 2064 735f  .    ...     ds_
-0000d7c0: 612e 746f 5f61 7272 6179 2822 6361 7274  a.to_array("cart
-0000d7d0: 6573 6961 6e22 292c 2064 735f 622e 746f  esian"), ds_b.to
-0000d7e0: 5f61 7272 6179 2822 6361 7274 6573 6961  _array("cartesia
-0000d7f0: 6e22 292c 2064 696d 3d22 6361 7274 6573  n"), dim="cartes
-0000d800: 6961 6e22 0a20 2020 202e 2e2e 2029 0a20  ian".    ... ). 
-0000d810: 2020 203e 3e3e 2063 2e74 6f5f 6461 7461     >>> c.to_data
-0000d820: 7365 7428 6469 6d3d 2263 6172 7465 7369  set(dim="cartesi
-0000d830: 616e 2229 0a20 2020 203c 7861 7272 6179  an").    <xarray
-0000d840: 2e44 6174 6173 6574 3e0a 2020 2020 4469  .Dataset>.    Di
-0000d850: 6d65 6e73 696f 6e73 3a20 2028 6469 6d5f  mensions:  (dim_
-0000d860: 303a 2031 290a 2020 2020 4469 6d65 6e73  0: 1).    Dimens
-0000d870: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
-0000d880: 7264 696e 6174 6573 3a20 6469 6d5f 300a  rdinates: dim_0.
-0000d890: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
-0000d8a0: 6573 3a0a 2020 2020 2020 2020 7820 2020  es:.        x   
-0000d8b0: 2020 2020 2028 6469 6d5f 3029 2069 6e74       (dim_0) int
-0000d8c0: 3634 202d 330a 2020 2020 2020 2020 7920  64 -3.        y 
-0000d8d0: 2020 2020 2020 2028 6469 6d5f 3029 2069         (dim_0) i
-0000d8e0: 6e74 3634 2036 0a20 2020 2020 2020 207a  nt64 6.        z
-0000d8f0: 2020 2020 2020 2020 2864 696d 5f30 2920          (dim_0) 
-0000d900: 696e 7436 3420 2d33 0a0a 2020 2020 5365  int64 -3..    Se
-0000d910: 6520 416c 736f 0a20 2020 202d 2d2d 2d2d  e Also.    -----
-0000d920: 2d2d 2d0a 2020 2020 6e75 6d70 792e 6372  ---.    numpy.cr
-0000d930: 6f73 7320 3a20 436f 7272 6573 706f 6e64  oss : Correspond
-0000d940: 696e 6720 6e75 6d70 7920 6675 6e63 7469  ing numpy functi
-0000d950: 6f6e 0a20 2020 2022 2222 0a0a 2020 2020  on.    """..    
-0000d960: 6966 2064 696d 206e 6f74 2069 6e20 612e  if dim not in a.
-0000d970: 6469 6d73 3a0a 2020 2020 2020 2020 7261  dims:.        ra
-0000d980: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-0000d990: 2244 696d 656e 7369 6f6e 207b 6469 6d21  "Dimension {dim!
-0000d9a0: 727d 206e 6f74 206f 6e20 6122 290a 2020  r} not on a").  
-0000d9b0: 2020 656c 6966 2064 696d 206e 6f74 2069    elif dim not i
-0000d9c0: 6e20 622e 6469 6d73 3a0a 2020 2020 2020  n b.dims:.      
-0000d9d0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0000d9e0: 6f72 2866 2244 696d 656e 7369 6f6e 207b  or(f"Dimension {
-0000d9f0: 6469 6d21 727d 206e 6f74 206f 6e20 6222  dim!r} not on b"
-0000da00: 290a 0a20 2020 2069 6620 6e6f 7420 3120  )..    if not 1 
-0000da10: 3c3d 2061 2e73 697a 6573 5b64 696d 5d20  <= a.sizes[dim] 
-0000da20: 3c3d 2033 3a0a 2020 2020 2020 2020 7261  <= 3:.        ra
-0000da30: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-0000da40: 2020 2020 2020 2020 2020 2020 6622 5468              f"Th
-0000da50: 6520 7369 7a65 206f 6620 7b64 696d 2172  e size of {dim!r
-0000da60: 7d20 6f6e 2061 206d 7573 7420 6265 2031  } on a must be 1
-0000da70: 2c20 322c 206f 7220 3320 746f 2062 6520  , 2, or 3 to be 
-0000da80: 220a 2020 2020 2020 2020 2020 2020 6622  ".            f"
-0000da90: 636f 6d70 6174 6962 6c65 2077 6974 6820  compatible with 
-0000daa0: 6120 6372 6f73 7320 7072 6f64 7563 7420  a cross product 
-0000dab0: 6275 7420 6973 207b 612e 7369 7a65 735b  but is {a.sizes[
-0000dac0: 6469 6d5d 7d22 0a20 2020 2020 2020 2029  dim]}".        )
-0000dad0: 0a20 2020 2065 6c69 6620 6e6f 7420 3120  .    elif not 1 
-0000dae0: 3c3d 2062 2e73 697a 6573 5b64 696d 5d20  <= b.sizes[dim] 
-0000daf0: 3c3d 2033 3a0a 2020 2020 2020 2020 7261  <= 3:.        ra
-0000db00: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-0000db10: 2020 2020 2020 2020 2020 2020 6622 5468              f"Th
-0000db20: 6520 7369 7a65 206f 6620 7b64 696d 2172  e size of {dim!r
-0000db30: 7d20 6f6e 2062 206d 7573 7420 6265 2031  } on b must be 1
-0000db40: 2c20 322c 206f 7220 3320 746f 2062 6520  , 2, or 3 to be 
-0000db50: 220a 2020 2020 2020 2020 2020 2020 6622  ".            f"
-0000db60: 636f 6d70 6174 6962 6c65 2077 6974 6820  compatible with 
-0000db70: 6120 6372 6f73 7320 7072 6f64 7563 7420  a cross product 
-0000db80: 6275 7420 6973 207b 622e 7369 7a65 735b  but is {b.sizes[
-0000db90: 6469 6d5d 7d22 0a20 2020 2020 2020 2029  dim]}".        )
-0000dba0: 0a0a 2020 2020 616c 6c5f 6469 6d73 203d  ..    all_dims =
-0000dbb0: 206c 6973 7428 6469 6374 2e66 726f 6d6b   list(dict.fromk
-0000dbc0: 6579 7328 612e 6469 6d73 202b 2062 2e64  eys(a.dims + b.d
-0000dbd0: 696d 7329 290a 0a20 2020 2069 6620 612e  ims))..    if a.
-0000dbe0: 7369 7a65 735b 6469 6d5d 2021 3d20 622e  sizes[dim] != b.
-0000dbf0: 7369 7a65 735b 6469 6d5d 3a0a 2020 2020  sizes[dim]:.    
-0000dc00: 2020 2020 2320 4172 7261 7973 2068 6176      # Arrays hav
-0000dc10: 6520 6469 6666 6572 656e 7420 7369 7a65  e different size
-0000dc20: 732e 2041 7070 656e 6420 7a65 726f 7320  s. Append zeros 
-0000dc30: 7768 6572 6520 7468 6520 736d 616c 6c65  where the smalle
-0000dc40: 720a 2020 2020 2020 2020 2320 6172 7261  r.        # arra
-0000dc50: 7920 6973 206d 6973 7369 6e67 2061 2076  y is missing a v
-0000dc60: 616c 7565 2c20 7a65 726f 7320 7769 6c6c  alue, zeros will
-0000dc70: 206e 6f74 2061 6666 6563 7420 6e70 2e63   not affect np.c
-0000dc80: 726f 7373 3a0a 0a20 2020 2020 2020 2069  ross:..        i
-0000dc90: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-0000dca0: 6e6f 7420 6973 696e 7374 616e 6365 2861  not isinstance(a
-0000dcb0: 2c20 5661 7269 6162 6c65 2920 2023 204f  , Variable)  # O
-0000dcc0: 6e6c 7920 7573 6564 2074 6f20 6d61 6b65  nly used to make
-0000dcd0: 206d 7970 7920 6861 7070 792e 0a20 2020   mypy happy..   
-0000dce0: 2020 2020 2020 2020 2061 6e64 2064 696d           and dim
-0000dcf0: 2069 6e20 6765 7461 7474 7228 612c 2022   in getattr(a, "
-0000dd00: 636f 6f72 6473 222c 207b 7d29 0a20 2020  coords", {}).   
-0000dd10: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
-0000dd20: 2069 7369 6e73 7461 6e63 6528 622c 2056   isinstance(b, V
-0000dd30: 6172 6961 626c 6529 2020 2320 4f6e 6c79  ariable)  # Only
-0000dd40: 2075 7365 6420 746f 206d 616b 6520 6d79   used to make my
-0000dd50: 7079 2068 6170 7079 2e0a 2020 2020 2020  py happy..      
-0000dd60: 2020 2020 2020 616e 6420 6469 6d20 696e        and dim in
-0000dd70: 2067 6574 6174 7472 2862 2c20 2263 6f6f   getattr(b, "coo
-0000dd80: 7264 7322 2c20 7b7d 290a 2020 2020 2020  rds", {}).      
-0000dd90: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-0000dda0: 2023 2049 6620 7468 6520 6172 7261 7973   # If the arrays
-0000ddb0: 2068 6176 6520 636f 6f72 6473 2077 6520   have coords we 
-0000ddc0: 6b6e 6f77 2077 6869 6368 2069 6e64 6578  know which index
-0000ddd0: 6573 2074 6f20 6669 6c6c 0a20 2020 2020  es to fill.     
-0000dde0: 2020 2020 2020 2023 2077 6974 6820 7a65         # with ze
-0000ddf0: 726f 733a 0a20 2020 2020 2020 2020 2020  ros:.           
-0000de00: 2061 2c20 6220 3d20 616c 6967 6e28 0a20   a, b = align(. 
-0000de10: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000de20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000de30: 2020 622c 0a20 2020 2020 2020 2020 2020    b,.           
-0000de40: 2020 2020 2066 696c 6c5f 7661 6c75 653d       fill_value=
-0000de50: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
-0000de60: 2020 206a 6f69 6e3d 226f 7574 6572 222c     join="outer",
-0000de70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000de80: 2065 7863 6c75 6465 3d73 6574 2861 6c6c   exclude=set(all
-0000de90: 5f64 696d 7329 202d 207b 6469 6d7d 2c0a  _dims) - {dim},.
-0000dea0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000deb0: 2020 2020 2020 656c 6966 206d 696e 2861        elif min(a
-0000dec0: 2e73 697a 6573 5b64 696d 5d2c 2062 2e73  .sizes[dim], b.s
-0000ded0: 697a 6573 5b64 696d 5d29 203d 3d20 323a  izes[dim]) == 2:
-0000dee0: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-0000def0: 6620 7468 6520 6172 7261 7920 646f 6573  f the array does
-0000df00: 6e27 7420 6861 7665 2063 6f6f 7264 7320  n't have coords 
-0000df10: 7765 2063 616e 206f 6e6c 7920 696e 6665  we can only infe
-0000df20: 720a 2020 2020 2020 2020 2020 2020 2320  r.            # 
-0000df30: 7468 6174 2069 7420 6861 7320 636f 6d70  that it has comp
-0000df40: 6f73 6974 6520 7661 6c75 6573 2069 6620  osite values if 
-0000df50: 7468 6520 7369 7a65 2069 7320 6174 206c  the size is at l
-0000df60: 6561 7374 2032 2e0a 2020 2020 2020 2020  east 2..        
-0000df70: 2020 2020 2320 4f6e 6365 2070 6164 6465      # Once padde
-0000df80: 642c 2072 6563 6875 6e6b 2074 6865 2070  d, rechunk the p
-0000df90: 6164 6465 6420 6172 7261 7920 6265 6361  added array beca
-0000dfa0: 7573 6520 6170 706c 795f 7566 756e 630a  use apply_ufunc.
-0000dfb0: 2020 2020 2020 2020 2020 2020 2320 7265              # re
-0000dfc0: 7175 6972 6573 2063 6f72 6520 6469 6d65  quires core dime
-0000dfd0: 6e73 696f 6e73 206e 6f74 2074 6f20 6265  nsions not to be
-0000dfe0: 2063 6875 6e6b 6564 3a0a 2020 2020 2020   chunked:.      
-0000dff0: 2020 2020 2020 6966 2061 2e73 697a 6573        if a.sizes
-0000e000: 5b64 696d 5d20 3c20 622e 7369 7a65 735b  [dim] < b.sizes[
-0000e010: 6469 6d5d 3a0a 2020 2020 2020 2020 2020  dim]:.          
-0000e020: 2020 2020 2020 6120 3d20 612e 7061 6428        a = a.pad(
-0000e030: 7b64 696d 3a20 2830 2c20 3129 7d2c 2063  {dim: (0, 1)}, c
-0000e040: 6f6e 7374 616e 745f 7661 6c75 6573 3d30  onstant_values=0
-0000e050: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000e060: 2020 2320 544f 444f 3a20 5368 6f75 6c64    # TODO: Should
-0000e070: 2070 6164 206f 7220 6170 706c 795f 7566   pad or apply_uf
-0000e080: 756e 6320 6861 6e64 6c65 2063 6f72 7265  unc handle corre
-0000e090: 6374 2063 6875 6e6b 696e 673f 0a20 2020  ct chunking?.   
-0000e0a0: 2020 2020 2020 2020 2020 2020 2061 203d               a =
-0000e0b0: 2061 2e63 6875 6e6b 287b 6469 6d3a 202d   a.chunk({dim: -
-0000e0c0: 317d 2920 6966 2069 735f 6475 636b 5f64  1}) if is_duck_d
-0000e0d0: 6173 6b5f 6172 7261 7928 612e 6461 7461  ask_array(a.data
-0000e0e0: 2920 656c 7365 2061 0a20 2020 2020 2020  ) else a.       
-0000e0f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000e100: 2020 2020 2020 2020 2020 2062 203d 2062             b = b
-0000e110: 2e70 6164 287b 6469 6d3a 2028 302c 2031  .pad({dim: (0, 1
-0000e120: 297d 2c20 636f 6e73 7461 6e74 5f76 616c  )}, constant_val
-0000e130: 7565 733d 3029 0a20 2020 2020 2020 2020  ues=0).         
-0000e140: 2020 2020 2020 2023 2054 4f44 4f3a 2053         # TODO: S
-0000e150: 686f 756c 6420 7061 6420 6f72 2061 7070  hould pad or app
-0000e160: 6c79 5f75 6675 6e63 2068 616e 646c 6520  ly_ufunc handle 
-0000e170: 636f 7272 6563 7420 6368 756e 6b69 6e67  correct chunking
-0000e180: 3f0a 2020 2020 2020 2020 2020 2020 2020  ?.              
-0000e190: 2020 6220 3d20 622e 6368 756e 6b28 7b64    b = b.chunk({d
-0000e1a0: 696d 3a20 2d31 7d29 2069 6620 6973 5f64  im: -1}) if is_d
-0000e1b0: 7563 6b5f 6461 736b 5f61 7272 6179 2862  uck_dask_array(b
-0000e1c0: 2e64 6174 6129 2065 6c73 6520 620a 2020  .data) else b.  
-0000e1d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000e1e0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000e1f0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-0000e200: 2020 2020 2020 2020 2020 6622 7b64 696d            f"{dim
-0000e210: 2172 7d20 6f6e 207b 2761 2720 6966 2061  !r} on {'a' if a
-0000e220: 2e73 697a 6573 5b64 696d 5d20 3d3d 2031  .sizes[dim] == 1
-0000e230: 2065 6c73 6520 2762 277d 2069 7320 696e   else 'b'} is in
-0000e240: 636f 6d70 6174 6962 6c65 3a22 0a20 2020  compatible:".   
-0000e250: 2020 2020 2020 2020 2020 2020 2022 2064               " d
-0000e260: 696d 656e 7369 6f6e 7320 7769 7468 6f75  imensions withou
-0000e270: 7420 636f 6f72 6469 6e61 7465 7320 6d75  t coordinates mu
-0000e280: 7374 2068 6176 6520 6861 7665 2061 206c  st have have a l
-0000e290: 656e 6774 6820 6f66 2032 206f 7220 3322  ength of 2 or 3"
-0000e2a0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-0000e2b0: 2020 2020 6320 3d20 6170 706c 795f 7566      c = apply_uf
-0000e2c0: 756e 6328 0a20 2020 2020 2020 206e 702e  unc(.        np.
-0000e2d0: 6372 6f73 732c 0a20 2020 2020 2020 2061  cross,.        a
-0000e2e0: 2c0a 2020 2020 2020 2020 622c 0a20 2020  ,.        b,.   
-0000e2f0: 2020 2020 2069 6e70 7574 5f63 6f72 655f       input_core_
-0000e300: 6469 6d73 3d5b 5b64 696d 5d2c 205b 6469  dims=[[dim], [di
-0000e310: 6d5d 5d2c 0a20 2020 2020 2020 206f 7574  m]],.        out
-0000e320: 7075 745f 636f 7265 5f64 696d 733d 5b5b  put_core_dims=[[
-0000e330: 6469 6d5d 2069 6620 612e 7369 7a65 735b  dim] if a.sizes[
-0000e340: 6469 6d5d 203d 3d20 3320 656c 7365 205b  dim] == 3 else [
-0000e350: 5d5d 2c0a 2020 2020 2020 2020 6461 736b  ]],.        dask
-0000e360: 3d22 7061 7261 6c6c 656c 697a 6564 222c  ="parallelized",
-0000e370: 0a20 2020 2020 2020 206f 7574 7075 745f  .        output_
-0000e380: 6474 7970 6573 3d5b 6e70 2e72 6573 756c  dtypes=[np.resul
-0000e390: 745f 7479 7065 2861 2c20 6229 5d2c 0a20  t_type(a, b)],. 
-0000e3a0: 2020 2029 0a20 2020 2063 203d 2063 2e74     ).    c = c.t
-0000e3b0: 7261 6e73 706f 7365 282a 616c 6c5f 6469  ranspose(*all_di
-0000e3c0: 6d73 2c20 6d69 7373 696e 675f 6469 6d73  ms, missing_dims
-0000e3d0: 3d22 6967 6e6f 7265 2229 0a0a 2020 2020  ="ignore")..    
-0000e3e0: 7265 7475 726e 2063 0a0a 0a64 6566 2064  return c...def d
-0000e3f0: 6f74 280a 2020 2020 2a61 7272 6179 732c  ot(.    *arrays,
-0000e400: 0a20 2020 2064 696d 733a 2044 696d 7320  .    dims: Dims 
-0000e410: 3d20 4e6f 6e65 2c0a 2020 2020 2a2a 6b77  = None,.    **kw
-0000e420: 6172 6773 3a20 416e 792c 0a29 3a0a 2020  args: Any,.):.  
-0000e430: 2020 2222 2247 656e 6572 616c 697a 6564    """Generalized
-0000e440: 2064 6f74 2070 726f 6475 6374 2066 6f72   dot product for
-0000e450: 2078 6172 7261 7920 6f62 6a65 6374 732e   xarray objects.
-0000e460: 204c 696b 6520 6e70 2e65 696e 7375 6d2c   Like np.einsum,
-0000e470: 2062 7574 0a20 2020 2070 726f 7669 6465   but.    provide
-0000e480: 7320 6120 7369 6d70 6c65 7220 696e 7465  s a simpler inte
-0000e490: 7266 6163 6520 6261 7365 6420 6f6e 2061  rface based on a
-0000e4a0: 7272 6179 2064 696d 656e 7369 6f6e 732e  rray dimensions.
-0000e4b0: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-0000e4c0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-0000e4d0: 2020 2020 2a61 7272 6179 7320 3a20 4461      *arrays : Da
-0000e4e0: 7461 4172 7261 7920 6f72 2056 6172 6961  taArray or Varia
-0000e4f0: 626c 650a 2020 2020 2020 2020 4172 7261  ble.        Arra
-0000e500: 7973 2074 6f20 636f 6d70 7574 652e 0a20  ys to compute.. 
-0000e510: 2020 2064 696d 7320 3a20 7374 722c 2069     dims : str, i
-0000e520: 7465 7261 626c 6520 6f66 2068 6173 6861  terable of hasha
-0000e530: 626c 652c 2022 2e2e 2e22 206f 7220 4e6f  ble, "..." or No
-0000e540: 6e65 2c20 6f70 7469 6f6e 616c 0a20 2020  ne, optional.   
-0000e550: 2020 2020 2057 6869 6368 2064 696d 656e       Which dimen
-0000e560: 7369 6f6e 7320 746f 2073 756d 206f 7665  sions to sum ove
-0000e570: 722e 2045 6c6c 6970 7369 7320 2827 2e2e  r. Ellipsis ('..
-0000e580: 2e27 2920 7375 6d73 206f 7665 7220 616c  .') sums over al
-0000e590: 6c20 6469 6d65 6e73 696f 6e73 2e0a 2020  l dimensions..  
-0000e5a0: 2020 2020 2020 4966 206e 6f74 2073 7065        If not spe
-0000e5b0: 6369 6669 6564 2c20 7468 656e 2061 6c6c  cified, then all
-0000e5c0: 2074 6865 2063 6f6d 6d6f 6e20 6469 6d65   the common dime
-0000e5d0: 6e73 696f 6e73 2061 7265 2073 756d 6d65  nsions are summe
-0000e5e0: 6420 6f76 6572 2e0a 2020 2020 2a2a 6b77  d over..    **kw
-0000e5f0: 6172 6773 203a 2064 6963 740a 2020 2020  args : dict.    
-0000e600: 2020 2020 4164 6469 7469 6f6e 616c 206b      Additional k
-0000e610: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-0000e620: 2070 6173 7365 6420 746f 206e 756d 7079   passed to numpy
-0000e630: 2e65 696e 7375 6d20 6f72 0a20 2020 2020  .einsum or.     
-0000e640: 2020 2064 6173 6b2e 6172 7261 792e 6569     dask.array.ei
-0000e650: 6e73 756d 0a0a 2020 2020 5265 7475 726e  nsum..    Return
-0000e660: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-0000e670: 2020 4461 7461 4172 7261 790a 0a20 2020    DataArray..   
-0000e680: 2045 7861 6d70 6c65 730a 2020 2020 2d2d   Examples.    --
-0000e690: 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e 2064  ------.    >>> d
-0000e6a0: 615f 6120 3d20 7872 2e44 6174 6141 7272  a_a = xr.DataArr
-0000e6b0: 6179 286e 702e 6172 616e 6765 2833 202a  ay(np.arange(3 *
-0000e6c0: 2032 292e 7265 7368 6170 6528 332c 2032   2).reshape(3, 2
-0000e6d0: 292c 2064 696d 733d 5b22 6122 2c20 2262  ), dims=["a", "b
-0000e6e0: 225d 290a 2020 2020 3e3e 3e20 6461 5f62  "]).    >>> da_b
-0000e6f0: 203d 2078 722e 4461 7461 4172 7261 7928   = xr.DataArray(
-0000e700: 6e70 2e61 7261 6e67 6528 3320 2a20 3220  np.arange(3 * 2 
-0000e710: 2a20 3229 2e72 6573 6861 7065 2833 2c20  * 2).reshape(3, 
-0000e720: 322c 2032 292c 2064 696d 733d 5b22 6122  2, 2), dims=["a"
-0000e730: 2c20 2262 222c 2022 6322 5d29 0a20 2020  , "b", "c"]).   
-0000e740: 203e 3e3e 2064 615f 6320 3d20 7872 2e44   >>> da_c = xr.D
-0000e750: 6174 6141 7272 6179 286e 702e 6172 616e  ataArray(np.aran
-0000e760: 6765 2832 202a 2033 292e 7265 7368 6170  ge(2 * 3).reshap
-0000e770: 6528 322c 2033 292c 2064 696d 733d 5b22  e(2, 3), dims=["
-0000e780: 6322 2c20 2264 225d 290a 0a20 2020 203e  c", "d"])..    >
-0000e790: 3e3e 2064 615f 610a 2020 2020 3c78 6172  >> da_a.    <xar
-0000e7a0: 7261 792e 4461 7461 4172 7261 7920 2861  ray.DataArray (a
-0000e7b0: 3a20 332c 2062 3a20 3229 3e0a 2020 2020  : 3, b: 2)>.    
-0000e7c0: 6172 7261 7928 5b5b 302c 2031 5d2c 0a20  array([[0, 1],. 
-0000e7d0: 2020 2020 2020 2020 2020 5b32 2c20 335d            [2, 3]
-0000e7e0: 2c0a 2020 2020 2020 2020 2020 205b 342c  ,.           [4,
-0000e7f0: 2035 5d5d 290a 2020 2020 4469 6d65 6e73   5]]).    Dimens
-0000e800: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
-0000e810: 7264 696e 6174 6573 3a20 612c 2062 0a0a  rdinates: a, b..
-0000e820: 2020 2020 3e3e 3e20 6461 5f62 0a20 2020      >>> da_b.   
-0000e830: 203c 7861 7272 6179 2e44 6174 6141 7272   <xarray.DataArr
-0000e840: 6179 2028 613a 2033 2c20 623a 2032 2c20  ay (a: 3, b: 2, 
-0000e850: 633a 2032 293e 0a20 2020 2061 7272 6179  c: 2)>.    array
-0000e860: 285b 5b5b 2030 2c20 2031 5d2c 0a20 2020  ([[[ 0,  1],.   
-0000e870: 2020 2020 2020 2020 205b 2032 2c20 2033           [ 2,  3
-0000e880: 5d5d 2c0a 2020 2020 3c42 4c41 4e4b 4c49  ]],.    <BLANKLI
-0000e890: 4e45 3e0a 2020 2020 2020 2020 2020 205b  NE>.           [
-0000e8a0: 5b20 342c 2020 355d 2c0a 2020 2020 2020  [ 4,  5],.      
-0000e8b0: 2020 2020 2020 5b20 362c 2020 375d 5d2c        [ 6,  7]],
-0000e8c0: 0a20 2020 203c 424c 414e 4b4c 494e 453e  .    <BLANKLINE>
-0000e8d0: 0a20 2020 2020 2020 2020 2020 5b5b 2038  .           [[ 8
-0000e8e0: 2c20 2039 5d2c 0a20 2020 2020 2020 2020  ,  9],.         
-0000e8f0: 2020 205b 3130 2c20 3131 5d5d 5d29 0a20     [10, 11]]]). 
-0000e900: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
-0000e910: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
-0000e920: 733a 2061 2c20 622c 2063 0a0a 2020 2020  s: a, b, c..    
-0000e930: 3e3e 3e20 6461 5f63 0a20 2020 203c 7861  >>> da_c.    <xa
-0000e940: 7272 6179 2e44 6174 6141 7272 6179 2028  rray.DataArray (
-0000e950: 633a 2032 2c20 643a 2033 293e 0a20 2020  c: 2, d: 3)>.   
-0000e960: 2061 7272 6179 285b 5b30 2c20 312c 2032   array([[0, 1, 2
-0000e970: 5d2c 0a20 2020 2020 2020 2020 2020 5b33  ],.           [3
-0000e980: 2c20 342c 2035 5d5d 290a 2020 2020 4469  , 4, 5]]).    Di
-0000e990: 6d65 6e73 696f 6e73 2077 6974 686f 7574  mensions without
-0000e9a0: 2063 6f6f 7264 696e 6174 6573 3a20 632c   coordinates: c,
-0000e9b0: 2064 0a0a 2020 2020 3e3e 3e20 7872 2e64   d..    >>> xr.d
-0000e9c0: 6f74 2864 615f 612c 2064 615f 622c 2064  ot(da_a, da_b, d
-0000e9d0: 696d 733d 5b22 6122 2c20 2262 225d 290a  ims=["a", "b"]).
-0000e9e0: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
-0000e9f0: 4172 7261 7920 2863 3a20 3229 3e0a 2020  Array (c: 2)>.  
-0000ea00: 2020 6172 7261 7928 5b31 3130 2c20 3132    array([110, 12
-0000ea10: 355d 290a 2020 2020 4469 6d65 6e73 696f  5]).    Dimensio
-0000ea20: 6e73 2077 6974 686f 7574 2063 6f6f 7264  ns without coord
-0000ea30: 696e 6174 6573 3a20 630a 0a20 2020 203e  inates: c..    >
-0000ea40: 3e3e 2078 722e 646f 7428 6461 5f61 2c20  >> xr.dot(da_a, 
-0000ea50: 6461 5f62 2c20 6469 6d73 3d5b 2261 225d  da_b, dims=["a"]
-0000ea60: 290a 2020 2020 3c78 6172 7261 792e 4461  ).    <xarray.Da
-0000ea70: 7461 4172 7261 7920 2862 3a20 322c 2063  taArray (b: 2, c
-0000ea80: 3a20 3229 3e0a 2020 2020 6172 7261 7928  : 2)>.    array(
-0000ea90: 5b5b 3430 2c20 3436 5d2c 0a20 2020 2020  [[40, 46],.     
-0000eaa0: 2020 2020 2020 5b37 302c 2037 395d 5d29        [70, 79]])
-0000eab0: 0a20 2020 2044 696d 656e 7369 6f6e 7320  .    Dimensions 
-0000eac0: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
-0000ead0: 7465 733a 2062 2c20 630a 0a20 2020 203e  tes: b, c..    >
-0000eae0: 3e3e 2078 722e 646f 7428 6461 5f61 2c20  >> xr.dot(da_a, 
-0000eaf0: 6461 5f62 2c20 6461 5f63 2c20 6469 6d73  da_b, da_c, dims
-0000eb00: 3d5b 2262 222c 2022 6322 5d29 0a20 2020  =["b", "c"]).   
-0000eb10: 203c 7861 7272 6179 2e44 6174 6141 7272   <xarray.DataArr
-0000eb20: 6179 2028 613a 2033 2c20 643a 2033 293e  ay (a: 3, d: 3)>
-0000eb30: 0a20 2020 2061 7272 6179 285b 5b20 2039  .    array([[  9
-0000eb40: 2c20 2031 342c 2020 3139 5d2c 0a20 2020  ,  14,  19],.   
-0000eb50: 2020 2020 2020 2020 5b20 3933 2c20 3135          [ 93, 15
-0000eb60: 302c 2032 3037 5d2c 0a20 2020 2020 2020  0, 207],.       
-0000eb70: 2020 2020 5b32 3733 2c20 3434 362c 2036      [273, 446, 6
-0000eb80: 3139 5d5d 290a 2020 2020 4469 6d65 6e73  19]]).    Dimens
-0000eb90: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
-0000eba0: 7264 696e 6174 6573 3a20 612c 2064 0a0a  rdinates: a, d..
-0000ebb0: 2020 2020 3e3e 3e20 7872 2e64 6f74 2864      >>> xr.dot(d
-0000ebc0: 615f 612c 2064 615f 6229 0a20 2020 203c  a_a, da_b).    <
-0000ebd0: 7861 7272 6179 2e44 6174 6141 7272 6179  xarray.DataArray
-0000ebe0: 2028 633a 2032 293e 0a20 2020 2061 7272   (c: 2)>.    arr
-0000ebf0: 6179 285b 3131 302c 2031 3235 5d29 0a20  ay([110, 125]). 
-0000ec00: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
-0000ec10: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
-0000ec20: 733a 2063 0a0a 2020 2020 3e3e 3e20 7872  s: c..    >>> xr
-0000ec30: 2e64 6f74 2864 615f 612c 2064 615f 622c  .dot(da_a, da_b,
-0000ec40: 2064 696d 733d 2e2e 2e29 0a20 2020 203c   dims=...).    <
-0000ec50: 7861 7272 6179 2e44 6174 6141 7272 6179  xarray.DataArray
-0000ec60: 2028 293e 0a20 2020 2061 7272 6179 2832   ()>.    array(2
-0000ec70: 3335 290a 2020 2020 2222 220a 2020 2020  35).    """.    
-0000ec80: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-0000ec90: 2e64 6174 6161 7272 6179 2069 6d70 6f72  .dataarray impor
-0000eca0: 7420 4461 7461 4172 7261 790a 2020 2020  t DataArray.    
-0000ecb0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-0000ecc0: 2e76 6172 6961 626c 6520 696d 706f 7274  .variable import
-0000ecd0: 2056 6172 6961 626c 650a 0a20 2020 2069   Variable..    i
-0000ece0: 6620 616e 7928 6e6f 7420 6973 696e 7374  f any(not isinst
-0000ecf0: 616e 6365 2861 7272 2c20 2856 6172 6961  ance(arr, (Varia
-0000ed00: 626c 652c 2044 6174 6141 7272 6179 2929  ble, DataArray))
-0000ed10: 2066 6f72 2061 7272 2069 6e20 6172 7261   for arr in arra
-0000ed20: 7973 293a 0a20 2020 2020 2020 2072 6169  ys):.        rai
-0000ed30: 7365 2054 7970 6545 7272 6f72 280a 2020  se TypeError(.  
-0000ed40: 2020 2020 2020 2020 2020 224f 6e6c 7920            "Only 
-0000ed50: 7872 2e44 6174 6141 7272 6179 2061 6e64  xr.DataArray and
-0000ed60: 2078 722e 5661 7269 6162 6c65 2061 7265   xr.Variable are
-0000ed70: 2073 7570 706f 7274 6564 2e22 0a20 2020   supported.".   
-0000ed80: 2020 2020 2020 2020 2022 4769 7665 6e20           "Given 
-0000ed90: 7b7d 2e22 2e66 6f72 6d61 7428 5b74 7970  {}.".format([typ
-0000eda0: 6528 6172 7229 2066 6f72 2061 7272 2069  e(arr) for arr i
-0000edb0: 6e20 6172 7261 7973 5d29 0a20 2020 2020  n arrays]).     
-0000edc0: 2020 2029 0a0a 2020 2020 6966 206c 656e     )..    if len
-0000edd0: 2861 7272 6179 7329 203d 3d20 303a 0a20  (arrays) == 0:. 
-0000ede0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-0000edf0: 6545 7272 6f72 2822 4174 206c 6561 7374  eError("At least
-0000ee00: 206f 6e65 2061 7272 6179 2073 686f 756c   one array shoul
-0000ee10: 6420 6265 2067 6976 656e 2e22 290a 0a20  d be given.").. 
-0000ee20: 2020 2063 6f6d 6d6f 6e5f 6469 6d73 3a20     common_dims: 
-0000ee30: 7365 745b 4861 7368 6162 6c65 5d20 3d20  set[Hashable] = 
-0000ee40: 7365 742e 696e 7465 7273 6563 7469 6f6e  set.intersection
-0000ee50: 282a 2873 6574 2861 7272 2e64 696d 7329  (*(set(arr.dims)
-0000ee60: 2066 6f72 2061 7272 2069 6e20 6172 7261   for arr in arra
-0000ee70: 7973 2929 0a20 2020 2061 6c6c 5f64 696d  ys)).    all_dim
-0000ee80: 7320 3d20 5b5d 0a20 2020 2066 6f72 2061  s = [].    for a
-0000ee90: 7272 2069 6e20 6172 7261 7973 3a0a 2020  rr in arrays:.  
-0000eea0: 2020 2020 2020 616c 6c5f 6469 6d73 202b        all_dims +
-0000eeb0: 3d20 5b64 2066 6f72 2064 2069 6e20 6172  = [d for d in ar
-0000eec0: 722e 6469 6d73 2069 6620 6420 6e6f 7420  r.dims if d not 
-0000eed0: 696e 2061 6c6c 5f64 696d 735d 0a0a 2020  in all_dims]..  
-0000eee0: 2020 6569 6e73 756d 5f61 7865 7320 3d20    einsum_axes = 
-0000eef0: 2261 6263 6465 6667 6869 6a6b 6c6d 6e6f  "abcdefghijklmno
-0000ef00: 7071 7273 7475 7677 7879 7a22 0a20 2020  pqrstuvwxyz".   
-0000ef10: 2064 696d 5f6d 6170 203d 207b 643a 2065   dim_map = {d: e
-0000ef20: 696e 7375 6d5f 6178 6573 5b69 5d20 666f  insum_axes[i] fo
-0000ef30: 7220 692c 2064 2069 6e20 656e 756d 6572  r i, d in enumer
-0000ef40: 6174 6528 616c 6c5f 6469 6d73 297d 0a0a  ate(all_dims)}..
-0000ef50: 2020 2020 6966 2064 696d 7320 6973 202e      if dims is .
-0000ef60: 2e2e 3a0a 2020 2020 2020 2020 6469 6d73  ..:.        dims
-0000ef70: 203d 2061 6c6c 5f64 696d 730a 2020 2020   = all_dims.    
-0000ef80: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-0000ef90: 6469 6d73 2c20 7374 7229 3a0a 2020 2020  dims, str):.    
-0000efa0: 2020 2020 6469 6d73 203d 2028 6469 6d73      dims = (dims
-0000efb0: 2c29 0a20 2020 2065 6c69 6620 6469 6d73  ,).    elif dims
-0000efc0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000efd0: 2020 2320 6669 6e64 2064 696d 656e 7369    # find dimensi
-0000efe0: 6f6e 7320 7468 6174 206f 6363 7572 206d  ons that occur m
-0000eff0: 6f72 6520 7468 616e 206f 6e65 2074 696d  ore than one tim
-0000f000: 6573 0a20 2020 2020 2020 2064 696d 5f63  es.        dim_c
-0000f010: 6f75 6e74 733a 2043 6f75 6e74 6572 203d  ounts: Counter =
-0000f020: 2043 6f75 6e74 6572 2829 0a20 2020 2020   Counter().     
-0000f030: 2020 2066 6f72 2061 7272 2069 6e20 6172     for arr in ar
-0000f040: 7261 7973 3a0a 2020 2020 2020 2020 2020  rays:.          
-0000f050: 2020 6469 6d5f 636f 756e 7473 2e75 7064    dim_counts.upd
-0000f060: 6174 6528 6172 722e 6469 6d73 290a 2020  ate(arr.dims).  
-0000f070: 2020 2020 2020 6469 6d73 203d 2074 7570        dims = tup
-0000f080: 6c65 2864 2066 6f72 2064 2c20 6320 696e  le(d for d, c in
-0000f090: 2064 696d 5f63 6f75 6e74 732e 6974 656d   dim_counts.item
-0000f0a0: 7328 2920 6966 2063 203e 2031 290a 0a20  s() if c > 1).. 
-0000f0b0: 2020 2064 6f74 5f64 696d 733a 2073 6574     dot_dims: set
-0000f0c0: 5b48 6173 6861 626c 655d 203d 2073 6574  [Hashable] = set
-0000f0d0: 2864 696d 7329 0a0a 2020 2020 2320 6469  (dims)..    # di
-0000f0e0: 6d65 6e73 696f 6e73 2074 6f20 6265 2070  mensions to be p
-0000f0f0: 6172 616c 6c65 6c69 7a65 640a 2020 2020  arallelized.    
-0000f100: 6272 6f61 6463 6173 745f 6469 6d73 203d  broadcast_dims =
-0000f110: 2063 6f6d 6d6f 6e5f 6469 6d73 202d 2064   common_dims - d
-0000f120: 6f74 5f64 696d 730a 2020 2020 696e 7075  ot_dims.    inpu
-0000f130: 745f 636f 7265 5f64 696d 7320 3d20 5b0a  t_core_dims = [.
-0000f140: 2020 2020 2020 2020 5b64 2066 6f72 2064          [d for d
-0000f150: 2069 6e20 6172 722e 6469 6d73 2069 6620   in arr.dims if 
-0000f160: 6420 6e6f 7420 696e 2062 726f 6164 6361  d not in broadca
-0000f170: 7374 5f64 696d 735d 2066 6f72 2061 7272  st_dims] for arr
-0000f180: 2069 6e20 6172 7261 7973 0a20 2020 205d   in arrays.    ]
-0000f190: 0a20 2020 206f 7574 7075 745f 636f 7265  .    output_core
-0000f1a0: 5f64 696d 7320 3d20 5b0a 2020 2020 2020  _dims = [.      
-0000f1b0: 2020 5b64 2066 6f72 2064 2069 6e20 616c    [d for d in al
-0000f1c0: 6c5f 6469 6d73 2069 6620 6420 6e6f 7420  l_dims if d not 
-0000f1d0: 696e 2064 6f74 5f64 696d 7320 616e 6420  in dot_dims and 
-0000f1e0: 6420 6e6f 7420 696e 2062 726f 6164 6361  d not in broadca
-0000f1f0: 7374 5f64 696d 735d 0a20 2020 205d 0a0a  st_dims].    ]..
-0000f200: 2020 2020 2320 636f 6e73 7472 7563 7420      # construct 
-0000f210: 6569 6e73 756d 2073 7562 7363 7269 7074  einsum subscript
-0000f220: 732c 2073 7563 6820 6173 2027 2e2e 2e61  s, such as '...a
-0000f230: 6263 2c2e 2e2e 6162 2d3e 2e2e 2e63 270a  bc,...ab->...c'.
-0000f240: 2020 2020 2320 4e6f 7465 3a20 696e 7075      # Note: inpu
-0000f250: 745f 636f 7265 5f64 696d 7320 6172 6520  t_core_dims are 
-0000f260: 616c 7761 7973 206d 6f76 6564 2074 6f20  always moved to 
-0000f270: 7468 6520 6c61 7374 2070 6f73 6974 696f  the last positio
-0000f280: 6e0a 2020 2020 7375 6273 6372 6970 7473  n.    subscripts
-0000f290: 5f6c 6973 7420 3d20 5b0a 2020 2020 2020  _list = [.      
-0000f2a0: 2020 222e 2e2e 2220 2b20 2222 2e6a 6f69    "..." + "".joi
-0000f2b0: 6e28 6469 6d5f 6d61 705b 645d 2066 6f72  n(dim_map[d] for
-0000f2c0: 2064 2069 6e20 6473 2920 666f 7220 6473   d in ds) for ds
-0000f2d0: 2069 6e20 696e 7075 745f 636f 7265 5f64   in input_core_d
-0000f2e0: 696d 730a 2020 2020 5d0a 2020 2020 7375  ims.    ].    su
-0000f2f0: 6273 6372 6970 7473 203d 2022 2c22 2e6a  bscripts = ",".j
-0000f300: 6f69 6e28 7375 6273 6372 6970 7473 5f6c  oin(subscripts_l
-0000f310: 6973 7429 0a20 2020 2073 7562 7363 7269  ist).    subscri
-0000f320: 7074 7320 2b3d 2022 2d3e 2e2e 2e22 202b  pts += "->..." +
-0000f330: 2022 222e 6a6f 696e 2864 696d 5f6d 6170   "".join(dim_map
-0000f340: 5b64 5d20 666f 7220 6420 696e 206f 7574  [d] for d in out
-0000f350: 7075 745f 636f 7265 5f64 696d 735b 305d  put_core_dims[0]
-0000f360: 290a 0a20 2020 206a 6f69 6e20 3d20 4f50  )..    join = OP
-0000f370: 5449 4f4e 535b 2261 7269 7468 6d65 7469  TIONS["arithmeti
-0000f380: 635f 6a6f 696e 225d 0a20 2020 2023 2075  c_join"].    # u
-0000f390: 7369 6e67 2022 696e 6e65 7222 2065 6d75  sing "inner" emu
-0000f3a0: 6c61 7465 7320 6028 6120 2a20 6229 2e73  lates `(a * b).s
-0000f3b0: 756d 2829 6020 666f 7220 616c 6c20 6a6f  um()` for all jo
-0000f3c0: 696e 7320 2865 7863 6570 7420 2265 7861  ins (except "exa
-0000f3d0: 6374 2229 0a20 2020 2069 6620 6a6f 696e  ct").    if join
-0000f3e0: 2021 3d20 2265 7861 6374 223a 0a20 2020   != "exact":.   
-0000f3f0: 2020 2020 206a 6f69 6e20 3d20 2269 6e6e       join = "inn
-0000f400: 6572 220a 0a20 2020 2023 2073 7562 7363  er"..    # subsc
-0000f410: 7269 7074 7320 7368 6f75 6c64 2062 6520  ripts should be 
-0000f420: 7061 7373 6564 2074 6f20 6e70 2e65 696e  passed to np.ein
-0000f430: 7375 6d20 6173 2061 7267 2c20 6e6f 7420  sum as arg, not 
-0000f440: 6173 206b 7761 7267 732e 2057 6520 6e65  as kwargs. We ne
-0000f450: 6564 0a20 2020 2023 2074 6f20 636f 6e73  ed.    # to cons
-0000f460: 7472 7563 7420 6120 7061 7274 6961 6c20  truct a partial 
-0000f470: 6675 6e63 7469 6f6e 2066 6f72 2061 7070  function for app
-0000f480: 6c79 5f75 6675 6e63 2074 6f20 776f 726b  ly_ufunc to work
-0000f490: 2e0a 2020 2020 6675 6e63 203d 2066 756e  ..    func = fun
-0000f4a0: 6374 6f6f 6c73 2e70 6172 7469 616c 2864  ctools.partial(d
-0000f4b0: 7563 6b5f 6172 7261 795f 6f70 732e 6569  uck_array_ops.ei
-0000f4c0: 6e73 756d 2c20 7375 6273 6372 6970 7473  nsum, subscripts
-0000f4d0: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
-0000f4e0: 7265 7375 6c74 203d 2061 7070 6c79 5f75  result = apply_u
-0000f4f0: 6675 6e63 280a 2020 2020 2020 2020 6675  func(.        fu
-0000f500: 6e63 2c0a 2020 2020 2020 2020 2a61 7272  nc,.        *arr
-0000f510: 6179 732c 0a20 2020 2020 2020 2069 6e70  ays,.        inp
-0000f520: 7574 5f63 6f72 655f 6469 6d73 3d69 6e70  ut_core_dims=inp
-0000f530: 7574 5f63 6f72 655f 6469 6d73 2c0a 2020  ut_core_dims,.  
-0000f540: 2020 2020 2020 6f75 7470 7574 5f63 6f72        output_cor
-0000f550: 655f 6469 6d73 3d6f 7574 7075 745f 636f  e_dims=output_co
-0000f560: 7265 5f64 696d 732c 0a20 2020 2020 2020  re_dims,.       
-0000f570: 206a 6f69 6e3d 6a6f 696e 2c0a 2020 2020   join=join,.    
-0000f580: 2020 2020 6461 736b 3d22 616c 6c6f 7765      dask="allowe
-0000f590: 6422 2c0a 2020 2020 290a 2020 2020 7265  d",.    ).    re
-0000f5a0: 7475 726e 2072 6573 756c 742e 7472 616e  turn result.tran
-0000f5b0: 7370 6f73 6528 2a61 6c6c 5f64 696d 732c  spose(*all_dims,
-0000f5c0: 206d 6973 7369 6e67 5f64 696d 733d 2269   missing_dims="i
-0000f5d0: 676e 6f72 6522 290a 0a0a 6465 6620 7768  gnore")...def wh
-0000f5e0: 6572 6528 636f 6e64 2c20 782c 2079 2c20  ere(cond, x, y, 
-0000f5f0: 6b65 6570 5f61 7474 7273 3d4e 6f6e 6529  keep_attrs=None)
-0000f600: 3a0a 2020 2020 2222 2252 6574 7572 6e20  :.    """Return 
-0000f610: 656c 656d 656e 7473 2066 726f 6d20 6078  elements from `x
-0000f620: 6020 6f72 2060 7960 2064 6570 656e 6469  ` or `y` dependi
-0000f630: 6e67 206f 6e20 6063 6f6e 6460 2e0a 0a20  ng on `cond`... 
-0000f640: 2020 2050 6572 666f 726d 7320 7861 7272     Performs xarr
-0000f650: 6179 2d6c 696b 6520 6272 6f61 6463 6173  ay-like broadcas
-0000f660: 7469 6e67 2061 6372 6f73 7320 696e 7075  ting across inpu
-0000f670: 7420 6172 6775 6d65 6e74 732e 0a0a 2020  t arguments...  
-0000f680: 2020 416c 6c20 6469 6d65 6e73 696f 6e20    All dimension 
-0000f690: 636f 6f72 6469 6e61 7465 7320 6f6e 2060  coordinates on `
-0000f6a0: 7860 2061 6e64 2060 7960 2020 6d75 7374  x` and `y`  must
-0000f6b0: 2062 6520 616c 6967 6e65 6420 7769 7468   be aligned with
-0000f6c0: 2065 6163 680a 2020 2020 6f74 6865 7220   each.    other 
-0000f6d0: 616e 6420 7769 7468 2060 636f 6e64 602e  and with `cond`.
-0000f6e0: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-0000f6f0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-0000f700: 2020 2020 636f 6e64 203a 2073 6361 6c61      cond : scala
-0000f710: 722c 2061 7272 6179 2c20 5661 7269 6162  r, array, Variab
-0000f720: 6c65 2c20 4461 7461 4172 7261 7920 6f72  le, DataArray or
-0000f730: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
-0000f740: 2057 6865 6e20 5472 7565 2c20 7265 7475   When True, retu
-0000f750: 726e 2076 616c 7565 7320 6672 6f6d 2060  rn values from `
-0000f760: 7860 2c20 6f74 6865 7277 6973 6520 7265  x`, otherwise re
-0000f770: 7475 726e 7320 7661 6c75 6573 2066 726f  turns values fro
-0000f780: 6d20 6079 602e 0a20 2020 2078 203a 2073  m `y`..    x : s
-0000f790: 6361 6c61 722c 2061 7272 6179 2c20 5661  calar, array, Va
-0000f7a0: 7269 6162 6c65 2c20 4461 7461 4172 7261  riable, DataArra
-0000f7b0: 7920 6f72 2044 6174 6173 6574 0a20 2020  y or Dataset.   
-0000f7c0: 2020 2020 2076 616c 7565 7320 746f 2063       values to c
-0000f7d0: 686f 6f73 6520 6672 6f6d 2077 6865 7265  hoose from where
-0000f7e0: 2060 636f 6e64 6020 6973 2054 7275 650a   `cond` is True.
-0000f7f0: 2020 2020 7920 3a20 7363 616c 6172 2c20      y : scalar, 
-0000f800: 6172 7261 792c 2056 6172 6961 626c 652c  array, Variable,
-0000f810: 2044 6174 6141 7272 6179 206f 7220 4461   DataArray or Da
-0000f820: 7461 7365 740a 2020 2020 2020 2020 7661  taset.        va
-0000f830: 6c75 6573 2074 6f20 6368 6f6f 7365 2066  lues to choose f
-0000f840: 726f 6d20 7768 6572 6520 6063 6f6e 6460  rom where `cond`
-0000f850: 2069 7320 4661 6c73 650a 2020 2020 6b65   is False.    ke
-0000f860: 6570 5f61 7474 7273 203a 2062 6f6f 6c20  ep_attrs : bool 
-0000f870: 6f72 2073 7472 206f 7220 6361 6c6c 6162  or str or callab
-0000f880: 6c65 2c20 6f70 7469 6f6e 616c 0a20 2020  le, optional.   
-0000f890: 2020 2020 2048 6f77 2074 6f20 7472 6561       How to trea
-0000f8a0: 7420 6174 7472 732e 2049 6620 5472 7565  t attrs. If True
-0000f8b0: 2c20 6b65 6570 2074 6865 2061 7474 7273  , keep the attrs
-0000f8c0: 206f 6620 6078 602e 0a0a 2020 2020 5265   of `x`...    Re
-0000f8d0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-0000f8e0: 2d0a 2020 2020 4461 7461 7365 742c 2044  -.    Dataset, D
-0000f8f0: 6174 6141 7272 6179 2c20 5661 7269 6162  ataArray, Variab
-0000f900: 6c65 206f 7220 6172 7261 790a 2020 2020  le or array.    
-0000f910: 2020 2020 496e 2070 7269 6f72 6974 7920      In priority 
-0000f920: 6f72 6465 723a 2044 6174 6173 6574 2c20  order: Dataset, 
-0000f930: 4461 7461 4172 7261 792c 2056 6172 6961  DataArray, Varia
-0000f940: 626c 6520 6f72 2061 7272 6179 2c20 7768  ble or array, wh
-0000f950: 6963 6865 7665 720a 2020 2020 2020 2020  ichever.        
-0000f960: 7479 7065 2061 7070 6561 7273 2061 7320  type appears as 
-0000f970: 616e 2069 6e70 7574 2061 7267 756d 656e  an input argumen
-0000f980: 742e 0a0a 2020 2020 4578 616d 706c 6573  t...    Examples
-0000f990: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
-0000f9a0: 2020 3e3e 3e20 7820 3d20 7872 2e44 6174    >>> x = xr.Dat
-0000f9b0: 6141 7272 6179 280a 2020 2020 2e2e 2e20  aArray(.    ... 
-0000f9c0: 2020 2020 302e 3120 2a20 6e70 2e61 7261      0.1 * np.ara
-0000f9d0: 6e67 6528 3130 292c 0a20 2020 202e 2e2e  nge(10),.    ...
-0000f9e0: 2020 2020 2064 696d 733d 5b22 6c61 7422       dims=["lat"
-0000f9f0: 5d2c 0a20 2020 202e 2e2e 2020 2020 2063  ],.    ...     c
-0000fa00: 6f6f 7264 733d 7b22 6c61 7422 3a20 6e70  oords={"lat": np
-0000fa10: 2e61 7261 6e67 6528 3130 297d 2c0a 2020  .arange(10)},.  
-0000fa20: 2020 2e2e 2e20 2020 2020 6e61 6d65 3d22    ...     name="
-0000fa30: 7373 7422 2c0a 2020 2020 2e2e 2e20 290a  sst",.    ... ).
-0000fa40: 2020 2020 3e3e 3e20 780a 2020 2020 3c78      >>> x.    <x
-0000fa50: 6172 7261 792e 4461 7461 4172 7261 7920  array.DataArray 
-0000fa60: 2773 7374 2720 286c 6174 3a20 3130 293e  'sst' (lat: 10)>
-0000fa70: 0a20 2020 2061 7272 6179 285b 302e 202c  .    array([0. ,
-0000fa80: 2030 2e31 2c20 302e 322c 2030 2e33 2c20   0.1, 0.2, 0.3, 
-0000fa90: 302e 342c 2030 2e35 2c20 302e 362c 2030  0.4, 0.5, 0.6, 0
-0000faa0: 2e37 2c20 302e 382c 2030 2e39 5d29 0a20  .7, 0.8, 0.9]). 
-0000fab0: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-0000fac0: 2020 2020 2020 2a20 6c61 7420 2020 2020        * lat     
-0000fad0: 2028 6c61 7429 2069 6e74 3634 2030 2031   (lat) int64 0 1
-0000fae0: 2032 2033 2034 2035 2036 2037 2038 2039   2 3 4 5 6 7 8 9
-0000faf0: 0a0a 2020 2020 3e3e 3e20 7872 2e77 6865  ..    >>> xr.whe
-0000fb00: 7265 2878 203c 2030 2e35 2c20 782c 2078  re(x < 0.5, x, x
-0000fb10: 202a 2031 3030 290a 2020 2020 3c78 6172   * 100).    <xar
-0000fb20: 7261 792e 4461 7461 4172 7261 7920 2773  ray.DataArray 's
-0000fb30: 7374 2720 286c 6174 3a20 3130 293e 0a20  st' (lat: 10)>. 
-0000fb40: 2020 2061 7272 6179 285b 2030 2e20 2c20     array([ 0. , 
-0000fb50: 2030 2e31 2c20 2030 2e32 2c20 2030 2e33   0.1,  0.2,  0.3
-0000fb60: 2c20 2030 2e34 2c20 3530 2e20 2c20 3630  ,  0.4, 50. , 60
-0000fb70: 2e20 2c20 3730 2e20 2c20 3830 2e20 2c20  . , 70. , 80. , 
-0000fb80: 3930 2e20 5d29 0a20 2020 2043 6f6f 7264  90. ]).    Coord
-0000fb90: 696e 6174 6573 3a0a 2020 2020 2020 2a20  inates:.      * 
-0000fba0: 6c61 7420 2020 2020 2028 6c61 7429 2069  lat      (lat) i
-0000fbb0: 6e74 3634 2030 2031 2032 2033 2034 2035  nt64 0 1 2 3 4 5
-0000fbc0: 2036 2037 2038 2039 0a0a 2020 2020 3e3e   6 7 8 9..    >>
-0000fbd0: 3e20 7920 3d20 7872 2e44 6174 6141 7272  > y = xr.DataArr
-0000fbe0: 6179 280a 2020 2020 2e2e 2e20 2020 2020  ay(.    ...     
-0000fbf0: 302e 3120 2a20 6e70 2e61 7261 6e67 6528  0.1 * np.arange(
-0000fc00: 3929 2e72 6573 6861 7065 2833 2c20 3329  9).reshape(3, 3)
-0000fc10: 2c0a 2020 2020 2e2e 2e20 2020 2020 6469  ,.    ...     di
-0000fc20: 6d73 3d5b 226c 6174 222c 2022 6c6f 6e22  ms=["lat", "lon"
-0000fc30: 5d2c 0a20 2020 202e 2e2e 2020 2020 2063  ],.    ...     c
-0000fc40: 6f6f 7264 733d 7b22 6c61 7422 3a20 6e70  oords={"lat": np
-0000fc50: 2e61 7261 6e67 6528 3329 2c20 226c 6f6e  .arange(3), "lon
-0000fc60: 223a 2031 3020 2b20 6e70 2e61 7261 6e67  ": 10 + np.arang
-0000fc70: 6528 3329 7d2c 0a20 2020 202e 2e2e 2020  e(3)},.    ...  
-0000fc80: 2020 206e 616d 653d 2273 7374 222c 0a20     name="sst",. 
-0000fc90: 2020 202e 2e2e 2029 0a20 2020 203e 3e3e     ... ).    >>>
-0000fca0: 2079 0a20 2020 203c 7861 7272 6179 2e44   y.    <xarray.D
-0000fcb0: 6174 6141 7272 6179 2027 7373 7427 2028  ataArray 'sst' (
-0000fcc0: 6c61 743a 2033 2c20 6c6f 6e3a 2033 293e  lat: 3, lon: 3)>
-0000fcd0: 0a20 2020 2061 7272 6179 285b 5b30 2e20  .    array([[0. 
-0000fce0: 2c20 302e 312c 2030 2e32 5d2c 0a20 2020  , 0.1, 0.2],.   
-0000fcf0: 2020 2020 2020 2020 5b30 2e33 2c20 302e          [0.3, 0.
-0000fd00: 342c 2030 2e35 5d2c 0a20 2020 2020 2020  4, 0.5],.       
-0000fd10: 2020 2020 5b30 2e36 2c20 302e 372c 2030      [0.6, 0.7, 0
-0000fd20: 2e38 5d5d 290a 2020 2020 436f 6f72 6469  .8]]).    Coordi
-0000fd30: 6e61 7465 733a 0a20 2020 2020 202a 206c  nates:.      * l
-0000fd40: 6174 2020 2020 2020 286c 6174 2920 696e  at      (lat) in
-0000fd50: 7436 3420 3020 3120 320a 2020 2020 2020  t64 0 1 2.      
-0000fd60: 2a20 6c6f 6e20 2020 2020 2028 6c6f 6e29  * lon      (lon)
-0000fd70: 2069 6e74 3634 2031 3020 3131 2031 320a   int64 10 11 12.
-0000fd80: 0a20 2020 203e 3e3e 2078 722e 7768 6572  .    >>> xr.wher
-0000fd90: 6528 792e 6c61 7420 3c20 312c 2079 2c20  e(y.lat < 1, y, 
-0000fda0: 2d31 290a 2020 2020 3c78 6172 7261 792e  -1).    <xarray.
-0000fdb0: 4461 7461 4172 7261 7920 286c 6174 3a20  DataArray (lat: 
-0000fdc0: 332c 206c 6f6e 3a20 3329 3e0a 2020 2020  3, lon: 3)>.    
-0000fdd0: 6172 7261 7928 5b5b 2030 2e20 2c20 2030  array([[ 0. ,  0
-0000fde0: 2e31 2c20 2030 2e32 5d2c 0a20 2020 2020  .1,  0.2],.     
-0000fdf0: 2020 2020 2020 5b2d 312e 202c 202d 312e        [-1. , -1.
-0000fe00: 202c 202d 312e 205d 2c0a 2020 2020 2020   , -1. ],.      
-0000fe10: 2020 2020 205b 2d31 2e20 2c20 2d31 2e20       [-1. , -1. 
-0000fe20: 2c20 2d31 2e20 5d5d 290a 2020 2020 436f  , -1. ]]).    Co
-0000fe30: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
-0000fe40: 202a 206c 6174 2020 2020 2020 286c 6174   * lat      (lat
-0000fe50: 2920 696e 7436 3420 3020 3120 320a 2020  ) int64 0 1 2.  
-0000fe60: 2020 2020 2a20 6c6f 6e20 2020 2020 2028      * lon      (
-0000fe70: 6c6f 6e29 2069 6e74 3634 2031 3020 3131  lon) int64 10 11
-0000fe80: 2031 320a 0a20 2020 203e 3e3e 2063 6f6e   12..    >>> con
-0000fe90: 6420 3d20 7872 2e44 6174 6141 7272 6179  d = xr.DataArray
-0000fea0: 285b 5472 7565 2c20 4661 6c73 655d 2c20  ([True, False], 
-0000feb0: 6469 6d73 3d5b 2278 225d 290a 2020 2020  dims=["x"]).    
-0000fec0: 3e3e 3e20 7820 3d20 7872 2e44 6174 6141  >>> x = xr.DataA
-0000fed0: 7272 6179 285b 312c 2032 5d2c 2064 696d  rray([1, 2], dim
-0000fee0: 733d 5b22 7922 5d29 0a20 2020 203e 3e3e  s=["y"]).    >>>
-0000fef0: 2078 722e 7768 6572 6528 636f 6e64 2c20   xr.where(cond, 
-0000ff00: 782c 2030 290a 2020 2020 3c78 6172 7261  x, 0).    <xarra
-0000ff10: 792e 4461 7461 4172 7261 7920 2878 3a20  y.DataArray (x: 
-0000ff20: 322c 2079 3a20 3229 3e0a 2020 2020 6172  2, y: 2)>.    ar
-0000ff30: 7261 7928 5b5b 312c 2032 5d2c 0a20 2020  ray([[1, 2],.   
-0000ff40: 2020 2020 2020 2020 5b30 2c20 305d 5d29          [0, 0]])
-0000ff50: 0a20 2020 2044 696d 656e 7369 6f6e 7320  .    Dimensions 
-0000ff60: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
-0000ff70: 7465 733a 2078 2c20 790a 0a20 2020 2053  tes: x, y..    S
-0000ff80: 6565 2041 6c73 6f0a 2020 2020 2d2d 2d2d  ee Also.    ----
-0000ff90: 2d2d 2d2d 0a20 2020 206e 756d 7079 2e77  ----.    numpy.w
-0000ffa0: 6865 7265 203a 2063 6f72 7265 7370 6f6e  here : correspon
-0000ffb0: 6469 6e67 206e 756d 7079 2066 756e 6374  ding numpy funct
-0000ffc0: 696f 6e0a 2020 2020 4461 7461 7365 742e  ion.    Dataset.
-0000ffd0: 7768 6572 652c 2044 6174 6141 7272 6179  where, DataArray
-0000ffe0: 2e77 6865 7265 203a 0a20 2020 2020 2020  .where :.       
-0000fff0: 2065 7175 6976 616c 656e 7420 6d65 7468   equivalent meth
-00010000: 6f64 730a 2020 2020 2222 220a 2020 2020  ods.    """.    
-00010010: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-00010020: 2e64 6174 6173 6574 2069 6d70 6f72 7420  .dataset import 
-00010030: 4461 7461 7365 740a 0a20 2020 2069 6620  Dataset..    if 
-00010040: 6b65 6570 5f61 7474 7273 2069 7320 4e6f  keep_attrs is No
-00010050: 6e65 3a0a 2020 2020 2020 2020 6b65 6570  ne:.        keep
-00010060: 5f61 7474 7273 203d 205f 6765 745f 6b65  _attrs = _get_ke
-00010070: 6570 5f61 7474 7273 2864 6566 6175 6c74  ep_attrs(default
-00010080: 3d46 616c 7365 290a 0a20 2020 2023 2061  =False)..    # a
-00010090: 6c69 676e 6d65 6e74 2066 6f72 2074 6872  lignment for thr
-000100a0: 6565 2061 7267 756d 656e 7473 2069 7320  ee arguments is 
-000100b0: 636f 6d70 6c69 6361 7465 642c 2073 6f20  complicated, so 
-000100c0: 646f 6e27 7420 7375 7070 6f72 7420 6974  don't support it
-000100d0: 2079 6574 0a20 2020 2072 6573 756c 7420   yet.    result 
-000100e0: 3d20 6170 706c 795f 7566 756e 6328 0a20  = apply_ufunc(. 
-000100f0: 2020 2020 2020 2064 7563 6b5f 6172 7261         duck_arra
-00010100: 795f 6f70 732e 7768 6572 652c 0a20 2020  y_ops.where,.   
-00010110: 2020 2020 2063 6f6e 642c 0a20 2020 2020       cond,.     
-00010120: 2020 2078 2c0a 2020 2020 2020 2020 792c     x,.        y,
-00010130: 0a20 2020 2020 2020 206a 6f69 6e3d 2265  .        join="e
-00010140: 7861 6374 222c 0a20 2020 2020 2020 2064  xact",.        d
-00010150: 6174 6173 6574 5f6a 6f69 6e3d 2265 7861  ataset_join="exa
-00010160: 6374 222c 0a20 2020 2020 2020 2064 6173  ct",.        das
-00010170: 6b3d 2261 6c6c 6f77 6564 222c 0a20 2020  k="allowed",.   
-00010180: 2020 2020 206b 6565 705f 6174 7472 733d       keep_attrs=
-00010190: 6b65 6570 5f61 7474 7273 2c0a 2020 2020  keep_attrs,.    
-000101a0: 290a 0a20 2020 2023 206b 6565 7020 7468  )..    # keep th
-000101b0: 6520 6174 7472 6962 7574 6573 206f 6620  e attributes of 
-000101c0: 782c 2074 6865 2073 6563 6f6e 6420 7061  x, the second pa
-000101d0: 7261 6d65 7465 722c 2062 7920 6465 6661  rameter, by defa
-000101e0: 756c 7420 746f 0a20 2020 2023 2062 6520  ult to.    # be 
-000101f0: 636f 6e73 6973 7465 6e74 2077 6974 6820  consistent with 
-00010200: 7468 6520 6077 6865 7265 6020 6d65 7468  the `where` meth
-00010210: 6f64 206f 6620 6044 6174 6141 7272 6179  od of `DataArray
-00010220: 6020 616e 6420 6044 6174 6173 6574 600a  ` and `Dataset`.
-00010230: 2020 2020 2320 7265 6275 696c 6420 7468      # rebuild th
-00010240: 6520 6174 7472 7320 6672 6f6d 2078 2061  e attrs from x a
-00010250: 7420 6561 6368 206c 6576 656c 206f 6620  t each level of 
-00010260: 7468 6520 6f75 7470 7574 2c20 7768 6963  the output, whic
-00010270: 6820 636f 756c 6420 6265 0a20 2020 2023  h could be.    #
-00010280: 2044 6174 6173 6574 2c20 4461 7461 4172   Dataset, DataAr
-00010290: 7261 792c 206f 7220 5661 7269 6162 6c65  ray, or Variable
-000102a0: 2c20 616e 6420 616c 736f 2068 616e 646c  , and also handl
-000102b0: 6520 636f 6f72 6473 0a20 2020 2069 6620  e coords.    if 
-000102c0: 6b65 6570 5f61 7474 7273 2069 7320 5472  keep_attrs is Tr
-000102d0: 7565 2061 6e64 2068 6173 6174 7472 2872  ue and hasattr(r
-000102e0: 6573 756c 742c 2022 6174 7472 7322 293a  esult, "attrs"):
-000102f0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00010300: 7374 616e 6365 2879 2c20 4461 7461 7365  stance(y, Datase
-00010310: 7429 2061 6e64 206e 6f74 2069 7369 6e73  t) and not isins
-00010320: 7461 6e63 6528 782c 2044 6174 6173 6574  tance(x, Dataset
-00010330: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-00010340: 2068 616e 646c 6520 7370 6563 6961 6c20   handle special 
-00010350: 6361 7365 2077 6865 7265 2078 2067 6574  case where x get
-00010360: 7320 7072 6f6d 6f74 6564 2074 6f20 4461  s promoted to Da
-00010370: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
-00010380: 2020 7265 7375 6c74 2e61 7474 7273 203d    result.attrs =
-00010390: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
-000103a0: 6966 2067 6574 6174 7472 2878 2c20 226e  if getattr(x, "n
-000103b0: 616d 6522 2c20 4e6f 6e65 2920 696e 2072  ame", None) in r
-000103c0: 6573 756c 742e 6461 7461 5f76 6172 733a  esult.data_vars:
-000103d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000103e0: 2072 6573 756c 745b 782e 6e61 6d65 5d2e   result[x.name].
-000103f0: 6174 7472 7320 3d20 6765 7461 7474 7228  attrs = getattr(
-00010400: 782c 2022 6174 7472 7322 2c20 7b7d 290a  x, "attrs", {}).
-00010410: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00010420: 2020 2020 2020 2020 2020 2320 6f74 6865            # othe
-00010430: 7277 6973 652c 2066 696c 6c20 696e 2067  rwise, fill in g
-00010440: 6c6f 6261 6c20 6174 7472 7320 616e 6420  lobal attrs and 
-00010450: 7661 7269 6162 6c65 2061 7474 7273 2028  variable attrs (
-00010460: 6966 2074 6865 7920 6578 6973 7429 0a20  if they exist). 
-00010470: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00010480: 742e 6174 7472 7320 3d20 6765 7461 7474  t.attrs = getatt
-00010490: 7228 782c 2022 6174 7472 7322 2c20 7b7d  r(x, "attrs", {}
-000104a0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-000104b0: 7220 7620 696e 2067 6574 6174 7472 2872  r v in getattr(r
-000104c0: 6573 756c 742c 2022 6461 7461 5f76 6172  esult, "data_var
-000104d0: 7322 2c20 5b5d 293a 0a20 2020 2020 2020  s", []):.       
-000104e0: 2020 2020 2020 2020 2072 6573 756c 745b           result[
-000104f0: 765d 2e61 7474 7273 203d 2067 6574 6174  v].attrs = getat
-00010500: 7472 2867 6574 6174 7472 2878 2c20 762c  tr(getattr(x, v,
-00010510: 204e 6f6e 6529 2c20 2261 7474 7273 222c   None), "attrs",
-00010520: 207b 7d29 0a20 2020 2020 2020 2066 6f72   {}).        for
-00010530: 2063 2069 6e20 6765 7461 7474 7228 7265   c in getattr(re
-00010540: 7375 6c74 2c20 2263 6f6f 7264 7322 2c20  sult, "coords", 
-00010550: 5b5d 293a 0a20 2020 2020 2020 2020 2020  []):.           
-00010560: 2023 2061 6c77 6179 7320 6669 6c6c 2063   # always fill c
-00010570: 6f6f 7264 2061 7474 7273 206f 6620 780a  oord attrs of x.
-00010580: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00010590: 6c74 5b63 5d2e 6174 7472 7320 3d20 6765  lt[c].attrs = ge
-000105a0: 7461 7474 7228 6765 7461 7474 7228 782c  tattr(getattr(x,
-000105b0: 2063 2c20 4e6f 6e65 292c 2022 6174 7472   c, None), "attr
-000105c0: 7322 2c20 7b7d 290a 0a20 2020 2072 6574  s", {})..    ret
-000105d0: 7572 6e20 7265 7375 6c74 0a0a 0a40 6f76  urn result...@ov
-000105e0: 6572 6c6f 6164 0a64 6566 2070 6f6c 7976  erload.def polyv
-000105f0: 616c 280a 2020 2020 636f 6f72 643a 2044  al(.    coord: D
-00010600: 6174 6141 7272 6179 2c20 636f 6566 6673  ataArray, coeffs
-00010610: 3a20 4461 7461 4172 7261 792c 2064 6567  : DataArray, deg
-00010620: 7265 655f 6469 6d3a 2048 6173 6861 626c  ree_dim: Hashabl
-00010630: 6520 3d20 2264 6567 7265 6522 0a29 202d  e = "degree".) -
-00010640: 3e20 4461 7461 4172 7261 793a 0a20 2020  > DataArray:.   
-00010650: 202e 2e2e 0a0a 0a40 6f76 6572 6c6f 6164   ......@overload
-00010660: 0a64 6566 2070 6f6c 7976 616c 280a 2020  .def polyval(.  
-00010670: 2020 636f 6f72 643a 2044 6174 6141 7272    coord: DataArr
-00010680: 6179 2c20 636f 6566 6673 3a20 4461 7461  ay, coeffs: Data
-00010690: 7365 742c 2064 6567 7265 655f 6469 6d3a  set, degree_dim:
-000106a0: 2048 6173 6861 626c 6520 3d20 2264 6567   Hashable = "deg
-000106b0: 7265 6522 0a29 202d 3e20 4461 7461 7365  ree".) -> Datase
-000106c0: 743a 0a20 2020 202e 2e2e 0a0a 0a40 6f76  t:.    ......@ov
-000106d0: 6572 6c6f 6164 0a64 6566 2070 6f6c 7976  erload.def polyv
-000106e0: 616c 280a 2020 2020 636f 6f72 643a 2044  al(.    coord: D
-000106f0: 6174 6173 6574 2c20 636f 6566 6673 3a20  ataset, coeffs: 
-00010700: 4461 7461 4172 7261 792c 2064 6567 7265  DataArray, degre
-00010710: 655f 6469 6d3a 2048 6173 6861 626c 6520  e_dim: Hashable 
-00010720: 3d20 2264 6567 7265 6522 0a29 202d 3e20  = "degree".) -> 
-00010730: 4461 7461 7365 743a 0a20 2020 202e 2e2e  Dataset:.    ...
-00010740: 0a0a 0a40 6f76 6572 6c6f 6164 0a64 6566  ...@overload.def
-00010750: 2070 6f6c 7976 616c 280a 2020 2020 636f   polyval(.    co
-00010760: 6f72 643a 2044 6174 6173 6574 2c20 636f  ord: Dataset, co
-00010770: 6566 6673 3a20 4461 7461 7365 742c 2064  effs: Dataset, d
-00010780: 6567 7265 655f 6469 6d3a 2048 6173 6861  egree_dim: Hasha
-00010790: 626c 6520 3d20 2264 6567 7265 6522 0a29  ble = "degree".)
-000107a0: 202d 3e20 4461 7461 7365 743a 0a20 2020   -> Dataset:.   
-000107b0: 202e 2e2e 0a0a 0a40 6f76 6572 6c6f 6164   ......@overload
-000107c0: 0a64 6566 2070 6f6c 7976 616c 280a 2020  .def polyval(.  
-000107d0: 2020 636f 6f72 643a 2044 6174 6173 6574    coord: Dataset
-000107e0: 207c 2044 6174 6141 7272 6179 2c0a 2020   | DataArray,.  
-000107f0: 2020 636f 6566 6673 3a20 4461 7461 7365    coeffs: Datase
-00010800: 7420 7c20 4461 7461 4172 7261 792c 0a20  t | DataArray,. 
-00010810: 2020 2064 6567 7265 655f 6469 6d3a 2048     degree_dim: H
-00010820: 6173 6861 626c 6520 3d20 2264 6567 7265  ashable = "degre
-00010830: 6522 2c0a 2920 2d3e 2044 6174 6173 6574  e",.) -> Dataset
-00010840: 207c 2044 6174 6141 7272 6179 3a0a 2020   | DataArray:.  
-00010850: 2020 2e2e 2e0a 0a0a 6465 6620 706f 6c79    ......def poly
-00010860: 7661 6c28 0a20 2020 2063 6f6f 7264 3a20  val(.    coord: 
-00010870: 4461 7461 7365 7420 7c20 4461 7461 4172  Dataset | DataAr
-00010880: 7261 792c 0a20 2020 2063 6f65 6666 733a  ray,.    coeffs:
-00010890: 2044 6174 6173 6574 207c 2044 6174 6141   Dataset | DataA
-000108a0: 7272 6179 2c0a 2020 2020 6465 6772 6565  rray,.    degree
-000108b0: 5f64 696d 3a20 4861 7368 6162 6c65 203d  _dim: Hashable =
-000108c0: 2022 6465 6772 6565 222c 0a29 202d 3e20   "degree",.) -> 
-000108d0: 4461 7461 7365 7420 7c20 4461 7461 4172  Dataset | DataAr
-000108e0: 7261 793a 0a20 2020 2022 2222 4576 616c  ray:.    """Eval
-000108f0: 7561 7465 2061 2070 6f6c 796e 6f6d 6961  uate a polynomia
-00010900: 6c20 6174 2073 7065 6369 6669 6320 7661  l at specific va
-00010910: 6c75 6573 0a0a 2020 2020 5061 7261 6d65  lues..    Parame
-00010920: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-00010930: 2d2d 2d0a 2020 2020 636f 6f72 6420 3a20  ---.    coord : 
-00010940: 4461 7461 4172 7261 7920 6f72 2044 6174  DataArray or Dat
-00010950: 6173 6574 0a20 2020 2020 2020 2056 616c  aset.        Val
-00010960: 7565 7320 6174 2077 6869 6368 2074 6f20  ues at which to 
-00010970: 6576 616c 7561 7465 2074 6865 2070 6f6c  evaluate the pol
-00010980: 796e 6f6d 6961 6c2e 0a20 2020 2063 6f65  ynomial..    coe
-00010990: 6666 7320 3a20 4461 7461 4172 7261 7920  ffs : DataArray 
-000109a0: 6f72 2044 6174 6173 6574 0a20 2020 2020  or Dataset.     
-000109b0: 2020 2043 6f65 6666 6963 6965 6e74 7320     Coefficients 
-000109c0: 6f66 2074 6865 2070 6f6c 796e 6f6d 6961  of the polynomia
-000109d0: 6c2e 0a20 2020 2064 6567 7265 655f 6469  l..    degree_di
-000109e0: 6d20 3a20 4861 7368 6162 6c65 2c20 6465  m : Hashable, de
-000109f0: 6661 756c 743a 2022 6465 6772 6565 220a  fault: "degree".
-00010a00: 2020 2020 2020 2020 4e61 6d65 206f 6620          Name of 
-00010a10: 7468 6520 706f 6c79 6e6f 6d69 616c 2064  the polynomial d
-00010a20: 6567 7265 6520 6469 6d65 6e73 696f 6e20  egree dimension 
-00010a30: 696e 2060 636f 6566 6673 602e 0a0a 2020  in `coeffs`...  
-00010a40: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
-00010a50: 2d2d 2d2d 2d0a 2020 2020 4461 7461 4172  -----.    DataAr
-00010a60: 7261 7920 6f72 2044 6174 6173 6574 0a20  ray or Dataset. 
-00010a70: 2020 2020 2020 2045 7661 6c75 6174 6564         Evaluated
-00010a80: 2070 6f6c 796e 6f6d 6961 6c2e 0a0a 2020   polynomial...  
-00010a90: 2020 5365 6520 416c 736f 0a20 2020 202d    See Also.    -
-00010aa0: 2d2d 2d2d 2d2d 2d0a 2020 2020 7861 7272  -------.    xarr
-00010ab0: 6179 2e44 6174 6141 7272 6179 2e70 6f6c  ay.DataArray.pol
-00010ac0: 7966 6974 0a20 2020 206e 756d 7079 2e70  yfit.    numpy.p
-00010ad0: 6f6c 796e 6f6d 6961 6c2e 706f 6c79 6e6f  olynomial.polyno
-00010ae0: 6d69 616c 2e70 6f6c 7976 616c 0a20 2020  mial.polyval.   
-00010af0: 2022 2222 0a0a 2020 2020 6966 2064 6567   """..    if deg
-00010b00: 7265 655f 6469 6d20 6e6f 7420 696e 2063  ree_dim not in c
-00010b10: 6f65 6666 732e 5f69 6e64 6578 6573 3a0a  oeffs._indexes:.
-00010b20: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00010b30: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00010b40: 2020 2020 2020 6622 4469 6d65 6e73 696f        f"Dimensio
-00010b50: 6e20 607b 6465 6772 6565 5f64 696d 7d60  n `{degree_dim}`
-00010b60: 2073 686f 756c 6420 6265 2061 2063 6f6f   should be a coo
-00010b70: 7264 696e 6174 6520 7661 7269 6162 6c65  rdinate variable
-00010b80: 2077 6974 6820 6c61 6265 6c73 2e22 0a20   with labels.". 
-00010b90: 2020 2020 2020 2029 0a20 2020 2069 6620         ).    if 
-00010ba0: 6e6f 7420 6e70 2e69 7373 7562 6474 7970  not np.issubdtyp
-00010bb0: 6528 636f 6566 6673 5b64 6567 7265 655f  e(coeffs[degree_
-00010bc0: 6469 6d5d 2e64 7479 7065 2c20 696e 7429  dim].dtype, int)
-00010bd0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00010be0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00010bf0: 2020 2020 2020 2020 6622 4469 6d65 6e73          f"Dimens
-00010c00: 696f 6e20 607b 6465 6772 6565 5f64 696d  ion `{degree_dim
-00010c10: 7d60 2073 686f 756c 6420 6265 206f 6620  }` should be of 
-00010c20: 696e 7465 6765 7220 6474 7970 652e 2052  integer dtype. R
-00010c30: 6563 6569 7665 6420 7b63 6f65 6666 735b  eceived {coeffs[
-00010c40: 6465 6772 6565 5f64 696d 5d2e 6474 7970  degree_dim].dtyp
-00010c50: 657d 2069 6e73 7465 6164 2e22 0a20 2020  e} instead.".   
-00010c60: 2020 2020 2029 0a20 2020 206d 6178 5f64       ).    max_d
-00010c70: 6567 203d 2063 6f65 6666 735b 6465 6772  eg = coeffs[degr
-00010c80: 6565 5f64 696d 5d2e 6d61 7828 292e 6974  ee_dim].max().it
-00010c90: 656d 2829 0a20 2020 2063 6f65 6666 7320  em().    coeffs 
-00010ca0: 3d20 636f 6566 6673 2e72 6569 6e64 6578  = coeffs.reindex
-00010cb0: 280a 2020 2020 2020 2020 7b64 6567 7265  (.        {degre
-00010cc0: 655f 6469 6d3a 206e 702e 6172 616e 6765  e_dim: np.arange
-00010cd0: 286d 6178 5f64 6567 202b 2031 297d 2c20  (max_deg + 1)}, 
-00010ce0: 6669 6c6c 5f76 616c 7565 3d30 2c20 636f  fill_value=0, co
-00010cf0: 7079 3d46 616c 7365 0a20 2020 2029 0a20  py=False.    ). 
-00010d00: 2020 2063 6f6f 7264 203d 205f 656e 7375     coord = _ensu
-00010d10: 7265 5f6e 756d 6572 6963 2863 6f6f 7264  re_numeric(coord
-00010d20: 290a 0a20 2020 2023 2075 7369 6e67 2048  )..    # using H
-00010d30: 6f72 6e65 7227 7320 6d65 7468 6f64 0a20  orner's method. 
-00010d40: 2020 2023 2068 7474 7073 3a2f 2f65 6e2e     # https://en.
-00010d50: 7769 6b69 7065 6469 612e 6f72 672f 7769  wikipedia.org/wi
-00010d60: 6b69 2f48 6f72 6e65 7225 3237 735f 6d65  ki/Horner%27s_me
-00010d70: 7468 6f64 0a20 2020 2072 6573 203d 207a  thod.    res = z
-00010d80: 6572 6f73 5f6c 696b 6528 636f 6f72 6429  eros_like(coord)
-00010d90: 202b 2063 6f65 6666 732e 6973 656c 287b   + coeffs.isel({
-00010da0: 6465 6772 6565 5f64 696d 3a20 6d61 785f  degree_dim: max_
-00010db0: 6465 677d 2c20 6472 6f70 3d54 7275 6529  deg}, drop=True)
-00010dc0: 0a20 2020 2066 6f72 2064 6567 2069 6e20  .    for deg in 
-00010dd0: 7261 6e67 6528 6d61 785f 6465 6720 2d20  range(max_deg - 
-00010de0: 312c 202d 312c 202d 3129 3a0a 2020 2020  1, -1, -1):.    
-00010df0: 2020 2020 7265 7320 2a3d 2063 6f6f 7264      res *= coord
-00010e00: 0a20 2020 2020 2020 2072 6573 202b 3d20  .        res += 
-00010e10: 636f 6566 6673 2e69 7365 6c28 7b64 6567  coeffs.isel({deg
-00010e20: 7265 655f 6469 6d3a 2064 6567 7d2c 2064  ree_dim: deg}, d
-00010e30: 726f 703d 5472 7565 290a 0a20 2020 2072  rop=True)..    r
-00010e40: 6574 7572 6e20 7265 730a 0a0a 6465 6620  eturn res...def 
-00010e50: 5f65 6e73 7572 655f 6e75 6d65 7269 6328  _ensure_numeric(
-00010e60: 6461 7461 3a20 4461 7461 7365 7420 7c20  data: Dataset | 
-00010e70: 4461 7461 4172 7261 7929 202d 3e20 4461  DataArray) -> Da
-00010e80: 7461 7365 7420 7c20 4461 7461 4172 7261  taset | DataArra
-00010e90: 793a 0a20 2020 2022 2222 436f 6e76 6572  y:.    """Conver
-00010ea0: 7473 2061 6c6c 2064 6174 6574 696d 6536  ts all datetime6
-00010eb0: 3420 7661 7269 6162 6c65 7320 746f 2066  4 variables to f
-00010ec0: 6c6f 6174 3634 0a0a 2020 2020 5061 7261  loat64..    Para
-00010ed0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-00010ee0: 2d2d 2d2d 2d0a 2020 2020 6461 7461 203a  -----.    data :
-00010ef0: 2044 6174 6141 7272 6179 206f 7220 4461   DataArray or Da
-00010f00: 7461 7365 740a 2020 2020 2020 2020 5661  taset.        Va
-00010f10: 7269 6162 6c65 7320 7769 7468 2070 6f73  riables with pos
-00010f20: 7369 626c 6520 6461 7465 7469 6d65 2064  sible datetime d
-00010f30: 7479 7065 732e 0a0a 2020 2020 5265 7475  types...    Retu
-00010f40: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
-00010f50: 2020 2020 4461 7461 4172 7261 7920 6f72      DataArray or
-00010f60: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
-00010f70: 2056 6172 6961 626c 6573 2077 6974 6820   Variables with 
-00010f80: 6461 7465 7469 6d65 3634 2064 7479 7065  datetime64 dtype
-00010f90: 7320 636f 6e76 6572 7465 6420 746f 2066  s converted to f
-00010fa0: 6c6f 6174 3634 2e0a 2020 2020 2222 220a  loat64..    """.
-00010fb0: 2020 2020 6672 6f6d 2078 6172 7261 792e      from xarray.
-00010fc0: 636f 7265 2e64 6174 6173 6574 2069 6d70  core.dataset imp
-00010fd0: 6f72 7420 4461 7461 7365 740a 0a20 2020  ort Dataset..   
-00010fe0: 2064 6566 205f 6366 6f66 6673 6574 2878   def _cfoffset(x
-00010ff0: 3a20 4461 7461 4172 7261 7929 202d 3e20  : DataArray) -> 
-00011000: 416e 793a 0a20 2020 2020 2020 2073 6361  Any:.        sca
-00011010: 6c61 7220 3d20 782e 636f 6d70 7574 6528  lar = x.compute(
-00011020: 292e 6461 7461 5b30 5d0a 2020 2020 2020  ).data[0].      
-00011030: 2020 6966 206e 6f74 2069 735f 7363 616c    if not is_scal
-00011040: 6172 2873 6361 6c61 7229 3a0a 2020 2020  ar(scalar):.    
-00011050: 2020 2020 2020 2020 2320 7765 2064 6f20          # we do 
-00011060: 6e6f 7420 6765 7420 6120 7363 616c 6172  not get a scalar
-00011070: 2062 6163 6b20 6f6e 2064 6173 6b20 3d3d   back on dask ==
-00011080: 2032 3032 312e 3034 2e31 0a20 2020 2020   2021.04.1.     
-00011090: 2020 2020 2020 2073 6361 6c61 7220 3d20         scalar = 
-000110a0: 7363 616c 6172 2e69 7465 6d28 290a 2020  scalar.item().  
-000110b0: 2020 2020 2020 7265 7475 726e 2074 7970        return typ
-000110c0: 6528 7363 616c 6172 2928 3139 3730 2c20  e(scalar)(1970, 
-000110d0: 312c 2031 290a 0a20 2020 2064 6566 2074  1, 1)..    def t
-000110e0: 6f5f 666c 6f61 7461 626c 6528 783a 2044  o_floatable(x: D
-000110f0: 6174 6141 7272 6179 2920 2d3e 2044 6174  ataArray) -> Dat
-00011100: 6141 7272 6179 3a0a 2020 2020 2020 2020  aArray:.        
-00011110: 6966 2078 2e64 7479 7065 2e6b 696e 6420  if x.dtype.kind 
-00011120: 696e 2022 4d4f 223a 0a20 2020 2020 2020  in "MO":.       
-00011130: 2020 2020 2023 2064 6174 6574 696d 6573       # datetimes
-00011140: 2028 4346 496e 6465 7865 7320 6172 6520   (CFIndexes are 
-00011150: 6f62 6a65 6374 2074 7970 6529 0a20 2020  object type).   
-00011160: 2020 2020 2020 2020 206f 6666 7365 7420           offset 
-00011170: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00011180: 2020 2020 6e70 2e64 6174 6574 696d 6536      np.datetime6
-00011190: 3428 2231 3937 302d 3031 2d30 3122 2920  4("1970-01-01") 
-000111a0: 6966 2078 2e64 7479 7065 2e6b 696e 6420  if x.dtype.kind 
-000111b0: 3d3d 2022 4d22 2065 6c73 6520 5f63 666f  == "M" else _cfo
-000111c0: 6666 7365 7428 7829 0a20 2020 2020 2020  ffset(x).       
-000111d0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000111e0: 2020 2072 6574 7572 6e20 782e 636f 7079     return x.copy
-000111f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00011200: 2020 6461 7461 3d64 6174 6574 696d 655f    data=datetime_
-00011210: 746f 5f6e 756d 6572 6963 2878 2e64 6174  to_numeric(x.dat
-00011220: 612c 206f 6666 7365 743d 6f66 6673 6574  a, offset=offset
-00011230: 2c20 6461 7465 7469 6d65 5f75 6e69 743d  , datetime_unit=
-00011240: 226e 7322 292c 0a20 2020 2020 2020 2020  "ns"),.         
-00011250: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
-00011260: 6620 782e 6474 7970 652e 6b69 6e64 203d  f x.dtype.kind =
-00011270: 3d20 226d 223a 0a20 2020 2020 2020 2020  = "m":.         
-00011280: 2020 2023 2074 696d 6564 656c 7461 730a     # timedeltas.
-00011290: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000112a0: 726e 2078 2e61 7374 7970 6528 666c 6f61  rn x.astype(floa
-000112b0: 7429 0a20 2020 2020 2020 2072 6574 7572  t).        retur
-000112c0: 6e20 780a 0a20 2020 2069 6620 6973 696e  n x..    if isin
-000112d0: 7374 616e 6365 2864 6174 612c 2044 6174  stance(data, Dat
-000112e0: 6173 6574 293a 0a20 2020 2020 2020 2072  aset):.        r
-000112f0: 6574 7572 6e20 6461 7461 2e6d 6170 2874  eturn data.map(t
-00011300: 6f5f 666c 6f61 7461 626c 6529 0a20 2020  o_floatable).   
-00011310: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
-00011320: 6574 7572 6e20 746f 5f66 6c6f 6174 6162  eturn to_floatab
-00011330: 6c65 2864 6174 6129 0a0a 0a64 6566 205f  le(data)...def _
-00011340: 6361 6c63 5f69 6478 6d69 6e6d 6178 280a  calc_idxminmax(.
-00011350: 2020 2020 2a2c 0a20 2020 2061 7272 6179      *,.    array
-00011360: 2c0a 2020 2020 6675 6e63 3a20 4361 6c6c  ,.    func: Call
-00011370: 6162 6c65 2c0a 2020 2020 6469 6d3a 2048  able,.    dim: H
-00011380: 6173 6861 626c 6520 7c20 4e6f 6e65 203d  ashable | None =
-00011390: 204e 6f6e 652c 0a20 2020 2073 6b69 706e   None,.    skipn
-000113a0: 613a 2062 6f6f 6c20 7c20 4e6f 6e65 203d  a: bool | None =
-000113b0: 204e 6f6e 652c 0a20 2020 2066 696c 6c5f   None,.    fill_
-000113c0: 7661 6c75 653a 2041 6e79 203d 2064 7479  value: Any = dty
-000113d0: 7065 732e 4e41 2c0a 2020 2020 6b65 6570  pes.NA,.    keep
-000113e0: 5f61 7474 7273 3a20 626f 6f6c 207c 204e  _attrs: bool | N
-000113f0: 6f6e 6520 3d20 4e6f 6e65 2c0a 293a 0a20  one = None,.):. 
-00011400: 2020 2022 2222 4170 706c 7920 636f 6d6d     """Apply comm
-00011410: 6f6e 206f 7065 7261 7469 6f6e 7320 666f  on operations fo
-00011420: 7220 6964 786d 696e 2061 6e64 2069 6478  r idxmin and idx
-00011430: 6d61 782e 2222 220a 2020 2020 2320 5468  max.""".    # Th
-00011440: 6973 2066 756e 6374 696f 6e20 646f 6573  is function does
-00011450: 6e27 7420 6d61 6b65 2073 656e 7365 2066  n't make sense f
-00011460: 6f72 2073 6361 6c61 7273 2073 6f20 646f  or scalars so do
-00011470: 6e27 7420 7472 790a 2020 2020 6966 206e  n't try.    if n
-00011480: 6f74 2061 7272 6179 2e6e 6469 6d3a 0a20  ot array.ndim:. 
-00011490: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000114a0: 7565 4572 726f 7228 2254 6869 7320 6675  ueError("This fu
-000114b0: 6e63 7469 6f6e 2064 6f65 7320 6e6f 7420  nction does not 
-000114c0: 6170 706c 7920 666f 7220 7363 616c 6172  apply for scalar
-000114d0: 7322 290a 0a20 2020 2069 6620 6469 6d20  s")..    if dim 
-000114e0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000114f0: 2020 2020 2070 6173 7320 2023 2055 7365       pass  # Use
-00011500: 2074 6865 2064 696d 2069 6620 6176 6169   the dim if avai
-00011510: 6c61 626c 650a 2020 2020 656c 6966 2061  lable.    elif a
-00011520: 7272 6179 2e6e 6469 6d20 3d3d 2031 3a0a  rray.ndim == 1:.
-00011530: 2020 2020 2020 2020 2320 6974 2069 7320          # it is 
-00011540: 6f6b 6179 2074 6f20 6775 6573 7320 7468  okay to guess th
-00011550: 6520 6469 6d20 6966 2074 6865 7265 2069  e dim if there i
-00011560: 7320 6f6e 6c79 2031 0a20 2020 2020 2020  s only 1.       
-00011570: 2064 696d 203d 2061 7272 6179 2e64 696d   dim = array.dim
-00011580: 735b 305d 0a20 2020 2065 6c73 653a 0a20  s[0].    else:. 
-00011590: 2020 2020 2020 2023 2054 6865 2064 696d         # The dim
-000115a0: 2069 7320 6e6f 7420 7370 6563 6966 6965   is not specifie
-000115b0: 6420 616e 6420 616d 6269 6775 6f75 732e  d and ambiguous.
-000115c0: 2020 446f 6e27 7420 6775 6573 732e 0a20    Don't guess.. 
-000115d0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000115e0: 7565 4572 726f 7228 224d 7573 7420 7375  ueError("Must su
-000115f0: 7070 6c79 2027 6469 6d27 2061 7267 756d  pply 'dim' argum
-00011600: 656e 7420 666f 7220 6d75 6c74 6964 696d  ent for multidim
-00011610: 656e 7369 6f6e 616c 2061 7272 6179 7322  ensional arrays"
-00011620: 290a 0a20 2020 2069 6620 6469 6d20 6e6f  )..    if dim no
-00011630: 7420 696e 2061 7272 6179 2e64 696d 733a  t in array.dims:
-00011640: 0a20 2020 2020 2020 2072 6169 7365 204b  .        raise K
-00011650: 6579 4572 726f 7228 6627 4469 6d65 6e73  eyError(f'Dimens
-00011660: 696f 6e20 227b 6469 6d7d 2220 6e6f 7420  ion "{dim}" not 
-00011670: 696e 2064 696d 656e 7369 6f6e 2729 0a20  in dimension'). 
-00011680: 2020 2069 6620 6469 6d20 6e6f 7420 696e     if dim not in
-00011690: 2061 7272 6179 2e63 6f6f 7264 733a 0a20   array.coords:. 
-000116a0: 2020 2020 2020 2072 6169 7365 204b 6579         raise Key
-000116b0: 4572 726f 7228 6627 4469 6d65 6e73 696f  Error(f'Dimensio
-000116c0: 6e20 227b 6469 6d7d 2220 646f 6573 206e  n "{dim}" does n
-000116d0: 6f74 2068 6176 6520 636f 6f72 6469 6e61  ot have coordina
-000116e0: 7465 7327 290a 0a20 2020 2023 2054 6865  tes')..    # The
-000116f0: 7365 2061 7265 2064 7479 7065 7320 7769  se are dtypes wi
-00011700: 7468 204e 614e 2076 616c 7565 7320 6172  th NaN values ar
-00011710: 676d 696e 2061 6e64 2061 7267 6d61 7820  gmin and argmax 
-00011720: 6361 6e20 6861 6e64 6c65 0a20 2020 206e  can handle.    n
-00011730: 615f 6474 7970 6573 203d 2022 6366 4f22  a_dtypes = "cfO"
-00011740: 0a0a 2020 2020 6966 2073 6b69 706e 6120  ..    if skipna 
-00011750: 6f72 2028 736b 6970 6e61 2069 7320 4e6f  or (skipna is No
-00011760: 6e65 2061 6e64 2061 7272 6179 2e64 7479  ne and array.dty
-00011770: 7065 2e6b 696e 6420 696e 206e 615f 6474  pe.kind in na_dt
-00011780: 7970 6573 293a 0a20 2020 2020 2020 2023  ypes):.        #
-00011790: 204e 6565 6420 746f 2073 6b69 7020 4e61   Need to skip Na
-000117a0: 4e20 7661 6c75 6573 2073 696e 6365 2061  N values since a
-000117b0: 7267 6d69 6e20 616e 6420 6172 676d 6178  rgmin and argmax
-000117c0: 2063 616e 2774 2068 616e 646c 6520 7468   can't handle th
-000117d0: 656d 0a20 2020 2020 2020 2061 6c6c 6e61  em.        allna
-000117e0: 203d 2061 7272 6179 2e69 736e 756c 6c28   = array.isnull(
-000117f0: 292e 616c 6c28 6469 6d29 0a20 2020 2020  ).all(dim).     
-00011800: 2020 2061 7272 6179 203d 2061 7272 6179     array = array
-00011810: 2e77 6865 7265 287e 616c 6c6e 612c 2030  .where(~allna, 0
-00011820: 290a 0a20 2020 2023 2054 6869 7320 7769  )..    # This wi
-00011830: 6c6c 2072 756e 2061 7267 6d69 6e20 6f72  ll run argmin or
-00011840: 2061 7267 6d61 782e 0a20 2020 2069 6e64   argmax..    ind
-00011850: 7820 3d20 6675 6e63 2861 7272 6179 2c20  x = func(array, 
-00011860: 6469 6d3d 6469 6d2c 2061 7869 733d 4e6f  dim=dim, axis=No
-00011870: 6e65 2c20 6b65 6570 5f61 7474 7273 3d6b  ne, keep_attrs=k
-00011880: 6565 705f 6174 7472 732c 2073 6b69 706e  eep_attrs, skipn
-00011890: 613d 736b 6970 6e61 290a 0a20 2020 2023  a=skipna)..    #
-000118a0: 2048 616e 646c 6520 6461 736b 2061 7272   Handle dask arr
-000118b0: 6179 732e 0a20 2020 2069 6620 6973 5f64  ays..    if is_d
-000118c0: 7563 6b5f 6461 736b 5f61 7272 6179 2861  uck_dask_array(a
-000118d0: 7272 6179 2e64 6174 6129 3a0a 2020 2020  rray.data):.    
-000118e0: 2020 2020 696d 706f 7274 2064 6173 6b2e      import dask.
-000118f0: 6172 7261 790a 0a20 2020 2020 2020 2063  array..        c
-00011900: 6875 6e6b 7320 3d20 6469 6374 287a 6970  hunks = dict(zip
-00011910: 2861 7272 6179 2e64 696d 732c 2061 7272  (array.dims, arr
-00011920: 6179 2e63 6875 6e6b 7329 290a 2020 2020  ay.chunks)).    
-00011930: 2020 2020 6461 736b 5f63 6f6f 7264 203d      dask_coord =
-00011940: 2064 6173 6b2e 6172 7261 792e 6672 6f6d   dask.array.from
-00011950: 5f61 7272 6179 2861 7272 6179 5b64 696d  _array(array[dim
-00011960: 5d2e 6461 7461 2c20 6368 756e 6b73 3d63  ].data, chunks=c
-00011970: 6875 6e6b 735b 6469 6d5d 290a 2020 2020  hunks[dim]).    
-00011980: 2020 2020 7265 7320 3d20 696e 6478 2e63      res = indx.c
-00011990: 6f70 7928 6461 7461 3d64 6173 6b5f 636f  opy(data=dask_co
-000119a0: 6f72 645b 696e 6478 2e64 6174 612e 7261  ord[indx.data.ra
-000119b0: 7665 6c28 295d 2e72 6573 6861 7065 2869  vel()].reshape(i
-000119c0: 6e64 782e 7368 6170 6529 290a 2020 2020  ndx.shape)).    
-000119d0: 2020 2020 2320 7765 206e 6565 6420 746f      # we need to
-000119e0: 2061 7474 6163 6820 6261 636b 2074 6865   attach back the
-000119f0: 2064 696d 206e 616d 650a 2020 2020 2020   dim name.      
-00011a00: 2020 7265 732e 6e61 6d65 203d 2064 696d    res.name = dim
-00011a10: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00011a20: 2020 2072 6573 203d 2061 7272 6179 5b64     res = array[d
-00011a30: 696d 5d5b 2869 6e64 782c 295d 0a20 2020  im][(indx,)].   
-00011a40: 2020 2020 2023 2054 6865 2064 696d 2069       # The dim i
-00011a50: 7320 676f 6e65 2062 7574 2077 6520 6e65  s gone but we ne
-00011a60: 6564 2074 6f20 7265 6d6f 7665 2074 6865  ed to remove the
-00011a70: 2063 6f72 7265 7370 6f6e 6469 6e67 2063   corresponding c
-00011a80: 6f6f 7264 696e 6174 652e 0a20 2020 2020  oordinate..     
-00011a90: 2020 2064 656c 2072 6573 2e63 6f6f 7264     del res.coord
-00011aa0: 735b 6469 6d5d 0a0a 2020 2020 6966 2073  s[dim]..    if s
-00011ab0: 6b69 706e 6120 6f72 2028 736b 6970 6e61  kipna or (skipna
-00011ac0: 2069 7320 4e6f 6e65 2061 6e64 2061 7272   is None and arr
-00011ad0: 6179 2e64 7479 7065 2e6b 696e 6420 696e  ay.dtype.kind in
-00011ae0: 206e 615f 6474 7970 6573 293a 0a20 2020   na_dtypes):.   
-00011af0: 2020 2020 2023 2050 7574 2074 6865 204e       # Put the N
-00011b00: 614e 2076 616c 7565 7320 6261 636b 2069  aN values back i
-00011b10: 6e20 6166 7465 7220 7265 6d6f 7669 6e67  n after removing
-00011b20: 2074 6865 6d0a 2020 2020 2020 2020 7265   them.        re
-00011b30: 7320 3d20 7265 732e 7768 6572 6528 7e61  s = res.where(~a
-00011b40: 6c6c 6e61 2c20 6669 6c6c 5f76 616c 7565  llna, fill_value
-00011b50: 290a 0a20 2020 2023 2043 6f70 7920 6174  )..    # Copy at
-00011b60: 7472 6962 7574 6573 2066 726f 6d20 6172  tributes from ar
-00011b70: 676d 696e 2f61 7267 6d61 782c 2069 6620  gmin/argmax, if 
-00011b80: 616e 790a 2020 2020 7265 732e 6174 7472  any.    res.attr
-00011b90: 7320 3d20 696e 6478 2e61 7474 7273 0a0a  s = indx.attrs..
-00011ba0: 2020 2020 7265 7475 726e 2072 6573 0a0a      return res..
-00011bb0: 0a5f 5420 3d20 5479 7065 5661 7228 225f  ._T = TypeVar("_
-00011bc0: 5422 2c20 626f 756e 643d 556e 696f 6e5b  T", bound=Union[
-00011bd0: 2244 6174 6173 6574 222c 2022 4461 7461  "Dataset", "Data
-00011be0: 4172 7261 7922 5d29 0a5f 5520 3d20 5479  Array"])._U = Ty
-00011bf0: 7065 5661 7228 225f 5522 2c20 626f 756e  peVar("_U", boun
-00011c00: 643d 556e 696f 6e5b 2244 6174 6173 6574  d=Union["Dataset
-00011c10: 222c 2022 4461 7461 4172 7261 7922 5d29  ", "DataArray"])
-00011c20: 0a5f 5620 3d20 5479 7065 5661 7228 225f  ._V = TypeVar("_
-00011c30: 5622 2c20 626f 756e 643d 556e 696f 6e5b  V", bound=Union[
-00011c40: 2244 6174 6173 6574 222c 2022 4461 7461  "Dataset", "Data
-00011c50: 4172 7261 7922 5d29 0a0a 0a40 6f76 6572  Array"])...@over
+0000c840: 3a0a 2020 2020 2222 220a 2020 2020 436f  :.    """.    Co
+0000c850: 6d70 7574 6520 7468 6520 6372 6f73 7320  mpute the cross 
+0000c860: 7072 6f64 7563 7420 6f66 2074 776f 2028  product of two (
+0000c870: 6172 7261 7973 206f 6629 2076 6563 746f  arrays of) vecto
+0000c880: 7273 2e0a 0a20 2020 2054 6865 2063 726f  rs...    The cro
+0000c890: 7373 2070 726f 6475 6374 206f 6620 6061  ss product of `a
+0000c8a0: 6020 616e 6420 6062 6020 696e 203a 6d61  ` and `b` in :ma
+0000c8b0: 7468 3a60 525e 3360 2069 7320 6120 7665  th:`R^3` is a ve
+0000c8c0: 6374 6f72 0a20 2020 2070 6572 7065 6e64  ctor.    perpend
+0000c8d0: 6963 756c 6172 2074 6f20 626f 7468 2060  icular to both `
+0000c8e0: 6160 2061 6e64 2060 6260 2e20 5468 6520  a` and `b`. The 
+0000c8f0: 7665 6374 6f72 7320 696e 2060 6160 2061  vectors in `a` a
+0000c900: 6e64 2060 6260 2061 7265 0a20 2020 2064  nd `b` are.    d
+0000c910: 6566 696e 6564 2062 7920 7468 6520 7661  efined by the va
+0000c920: 6c75 6573 2061 6c6f 6e67 2074 6865 2064  lues along the d
+0000c930: 696d 656e 7369 6f6e 2060 6469 6d60 2061  imension `dim` a
+0000c940: 6e64 2063 616e 2068 6176 6520 7369 7a65  nd can have size
+0000c950: 730a 2020 2020 312c 2032 206f 7220 332e  s.    1, 2 or 3.
+0000c960: 2057 6865 7265 2074 6865 2073 697a 6520   Where the size 
+0000c970: 6f66 2065 6974 6865 7220 6061 6020 6f72  of either `a` or
+0000c980: 2060 6260 2069 730a 2020 2020 3120 6f72   `b` is.    1 or
+0000c990: 2032 2c20 7468 6520 7265 6d61 696e 696e   2, the remainin
+0000c9a0: 6720 636f 6d70 6f6e 656e 7473 206f 6620  g components of 
+0000c9b0: 7468 6520 696e 7075 7420 7665 6374 6f72  the input vector
+0000c9c0: 2069 7320 6173 7375 6d65 6420 746f 0a20   is assumed to. 
+0000c9d0: 2020 2062 6520 7a65 726f 2061 6e64 2074     be zero and t
+0000c9e0: 6865 2063 726f 7373 2070 726f 6475 6374  he cross product
+0000c9f0: 2063 616c 6375 6c61 7465 6420 6163 636f   calculated acco
+0000ca00: 7264 696e 676c 792e 2049 6e20 6361 7365  rdingly. In case
+0000ca10: 7320 7768 6572 650a 2020 2020 626f 7468  s where.    both
+0000ca20: 2069 6e70 7574 2076 6563 746f 7273 2068   input vectors h
+0000ca30: 6176 6520 6469 6d65 6e73 696f 6e20 322c  ave dimension 2,
+0000ca40: 2074 6865 207a 2d63 6f6d 706f 6e65 6e74   the z-component
+0000ca50: 206f 6620 7468 6520 6372 6f73 730a 2020   of the cross.  
+0000ca60: 2020 7072 6f64 7563 7420 6973 2072 6574    product is ret
+0000ca70: 7572 6e65 642e 0a0a 2020 2020 5061 7261  urned...    Para
+0000ca80: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+0000ca90: 2d2d 2d2d 2d0a 2020 2020 612c 2062 203a  -----.    a, b :
+0000caa0: 2044 6174 6141 7272 6179 206f 7220 5661   DataArray or Va
+0000cab0: 7269 6162 6c65 0a20 2020 2020 2020 2043  riable.        C
+0000cac0: 6f6d 706f 6e65 6e74 7320 6f66 2074 6865  omponents of the
+0000cad0: 2066 6972 7374 2061 6e64 2073 6563 6f6e   first and secon
+0000cae0: 6420 7665 6374 6f72 2873 292e 0a20 2020  d vector(s)..   
+0000caf0: 2064 696d 203a 2068 6173 6861 626c 650a   dim : hashable.
+0000cb00: 2020 2020 2020 2020 5468 6520 6469 6d65          The dime
+0000cb10: 6e73 696f 6e20 616c 6f6e 6720 7768 6963  nsion along whic
+0000cb20: 6820 7468 6520 6372 6f73 7320 7072 6f64  h the cross prod
+0000cb30: 7563 7420 7769 6c6c 2062 6520 636f 6d70  uct will be comp
+0000cb40: 7574 6564 2e0a 2020 2020 2020 2020 4d75  uted..        Mu
+0000cb50: 7374 2062 6520 6176 6169 6c61 626c 6520  st be available 
+0000cb60: 696e 2062 6f74 6820 7665 6374 6f72 732e  in both vectors.
+0000cb70: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
+0000cb80: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+0000cb90: 5665 6374 6f72 2063 726f 7373 2d70 726f  Vector cross-pro
+0000cba0: 6475 6374 2077 6974 6820 3320 6469 6d65  duct with 3 dime
+0000cbb0: 6e73 696f 6e73 3a0a 0a20 2020 203e 3e3e  nsions:..    >>>
+0000cbc0: 2061 203d 2078 722e 4461 7461 4172 7261   a = xr.DataArra
+0000cbd0: 7928 5b31 2c20 322c 2033 5d29 0a20 2020  y([1, 2, 3]).   
+0000cbe0: 203e 3e3e 2062 203d 2078 722e 4461 7461   >>> b = xr.Data
+0000cbf0: 4172 7261 7928 5b34 2c20 352c 2036 5d29  Array([4, 5, 6])
+0000cc00: 0a20 2020 203e 3e3e 2078 722e 6372 6f73  .    >>> xr.cros
+0000cc10: 7328 612c 2062 2c20 6469 6d3d 2264 696d  s(a, b, dim="dim
+0000cc20: 5f30 2229 0a20 2020 203c 7861 7272 6179  _0").    <xarray
+0000cc30: 2e44 6174 6141 7272 6179 2028 6469 6d5f  .DataArray (dim_
+0000cc40: 303a 2033 293e 0a20 2020 2061 7272 6179  0: 3)>.    array
+0000cc50: 285b 2d33 2c20 2036 2c20 2d33 5d29 0a20  ([-3,  6, -3]). 
+0000cc60: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
+0000cc70: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
+0000cc80: 733a 2064 696d 5f30 0a0a 2020 2020 5665  s: dim_0..    Ve
+0000cc90: 6374 6f72 2063 726f 7373 2d70 726f 6475  ctor cross-produ
+0000cca0: 6374 2077 6974 6820 3220 6469 6d65 6e73  ct with 2 dimens
+0000ccb0: 696f 6e73 2c20 7265 7475 726e 7320 696e  ions, returns in
+0000ccc0: 2074 6865 2070 6572 7065 6e64 6963 756c   the perpendicul
+0000ccd0: 6172 0a20 2020 2064 6972 6563 7469 6f6e  ar.    direction
+0000cce0: 3a0a 0a20 2020 203e 3e3e 2061 203d 2078  :..    >>> a = x
+0000ccf0: 722e 4461 7461 4172 7261 7928 5b31 2c20  r.DataArray([1, 
+0000cd00: 325d 290a 2020 2020 3e3e 3e20 6220 3d20  2]).    >>> b = 
+0000cd10: 7872 2e44 6174 6141 7272 6179 285b 342c  xr.DataArray([4,
+0000cd20: 2035 5d29 0a20 2020 203e 3e3e 2078 722e   5]).    >>> xr.
+0000cd30: 6372 6f73 7328 612c 2062 2c20 6469 6d3d  cross(a, b, dim=
+0000cd40: 2264 696d 5f30 2229 0a20 2020 203c 7861  "dim_0").    <xa
+0000cd50: 7272 6179 2e44 6174 6141 7272 6179 2028  rray.DataArray (
+0000cd60: 293e 0a20 2020 2061 7272 6179 282d 3329  )>.    array(-3)
+0000cd70: 0a0a 2020 2020 5665 6374 6f72 2063 726f  ..    Vector cro
+0000cd80: 7373 2d70 726f 6475 6374 2077 6974 6820  ss-product with 
+0000cd90: 3320 6469 6d65 6e73 696f 6e73 2062 7574  3 dimensions but
+0000cda0: 207a 6572 6f73 2061 7420 7468 6520 6c61   zeros at the la
+0000cdb0: 7374 2061 7869 730a 2020 2020 7969 656c  st axis.    yiel
+0000cdc0: 6473 2074 6865 2073 616d 6520 7265 7375  ds the same resu
+0000cdd0: 6c74 7320 6173 2077 6974 6820 3220 6469  lts as with 2 di
+0000cde0: 6d65 6e73 696f 6e73 3a0a 0a20 2020 203e  mensions:..    >
+0000cdf0: 3e3e 2061 203d 2078 722e 4461 7461 4172  >> a = xr.DataAr
+0000ce00: 7261 7928 5b31 2c20 322c 2030 5d29 0a20  ray([1, 2, 0]). 
+0000ce10: 2020 203e 3e3e 2062 203d 2078 722e 4461     >>> b = xr.Da
+0000ce20: 7461 4172 7261 7928 5b34 2c20 352c 2030  taArray([4, 5, 0
+0000ce30: 5d29 0a20 2020 203e 3e3e 2078 722e 6372  ]).    >>> xr.cr
+0000ce40: 6f73 7328 612c 2062 2c20 6469 6d3d 2264  oss(a, b, dim="d
+0000ce50: 696d 5f30 2229 0a20 2020 203c 7861 7272  im_0").    <xarr
+0000ce60: 6179 2e44 6174 6141 7272 6179 2028 6469  ay.DataArray (di
+0000ce70: 6d5f 303a 2033 293e 0a20 2020 2061 7272  m_0: 3)>.    arr
+0000ce80: 6179 285b 2030 2c20 2030 2c20 2d33 5d29  ay([ 0,  0, -3])
+0000ce90: 0a20 2020 2044 696d 656e 7369 6f6e 7320  .    Dimensions 
+0000cea0: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
+0000ceb0: 7465 733a 2064 696d 5f30 0a0a 2020 2020  tes: dim_0..    
+0000cec0: 4f6e 6520 7665 6374 6f72 2077 6974 6820  One vector with 
+0000ced0: 6469 6d65 6e73 696f 6e20 323a 0a0a 2020  dimension 2:..  
+0000cee0: 2020 3e3e 3e20 6120 3d20 7872 2e44 6174    >>> a = xr.Dat
+0000cef0: 6141 7272 6179 280a 2020 2020 2e2e 2e20  aArray(.    ... 
+0000cf00: 2020 2020 5b31 2c20 325d 2c0a 2020 2020      [1, 2],.    
+0000cf10: 2e2e 2e20 2020 2020 6469 6d73 3d5b 2263  ...     dims=["c
+0000cf20: 6172 7465 7369 616e 225d 2c0a 2020 2020  artesian"],.    
+0000cf30: 2e2e 2e20 2020 2020 636f 6f72 6473 3d64  ...     coords=d
+0000cf40: 6963 7428 6361 7274 6573 6961 6e3d 285b  ict(cartesian=([
+0000cf50: 2263 6172 7465 7369 616e 225d 2c20 5b22  "cartesian"], ["
+0000cf60: 7822 2c20 2279 225d 2929 2c0a 2020 2020  x", "y"])),.    
+0000cf70: 2e2e 2e20 290a 2020 2020 3e3e 3e20 6220  ... ).    >>> b 
+0000cf80: 3d20 7872 2e44 6174 6141 7272 6179 280a  = xr.DataArray(.
+0000cf90: 2020 2020 2e2e 2e20 2020 2020 5b34 2c20      ...     [4, 
+0000cfa0: 352c 2036 5d2c 0a20 2020 202e 2e2e 2020  5, 6],.    ...  
+0000cfb0: 2020 2064 696d 733d 5b22 6361 7274 6573     dims=["cartes
+0000cfc0: 6961 6e22 5d2c 0a20 2020 202e 2e2e 2020  ian"],.    ...  
+0000cfd0: 2020 2063 6f6f 7264 733d 6469 6374 2863     coords=dict(c
+0000cfe0: 6172 7465 7369 616e 3d28 5b22 6361 7274  artesian=(["cart
+0000cff0: 6573 6961 6e22 5d2c 205b 2278 222c 2022  esian"], ["x", "
+0000d000: 7922 2c20 227a 225d 2929 2c0a 2020 2020  y", "z"])),.    
+0000d010: 2e2e 2e20 290a 2020 2020 3e3e 3e20 7872  ... ).    >>> xr
+0000d020: 2e63 726f 7373 2861 2c20 622c 2064 696d  .cross(a, b, dim
+0000d030: 3d22 6361 7274 6573 6961 6e22 290a 2020  ="cartesian").  
+0000d040: 2020 3c78 6172 7261 792e 4461 7461 4172    <xarray.DataAr
+0000d050: 7261 7920 2863 6172 7465 7369 616e 3a20  ray (cartesian: 
+0000d060: 3329 3e0a 2020 2020 6172 7261 7928 5b31  3)>.    array([1
+0000d070: 322c 202d 362c 202d 335d 290a 2020 2020  2, -6, -3]).    
+0000d080: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
+0000d090: 2020 202a 2063 6172 7465 7369 616e 2020     * cartesian  
+0000d0a0: 2863 6172 7465 7369 616e 2920 3c55 3120  (cartesian) <U1 
+0000d0b0: 2778 2720 2779 2720 277a 270a 0a20 2020  'x' 'y' 'z'..   
+0000d0c0: 204f 6e65 2076 6563 746f 7220 7769 7468   One vector with
+0000d0d0: 2064 696d 656e 7369 6f6e 2032 2062 7574   dimension 2 but
+0000d0e0: 2063 6f6f 7264 7320 696e 206f 7468 6572   coords in other
+0000d0f0: 2070 6f73 6974 696f 6e73 3a0a 0a20 2020   positions:..   
+0000d100: 203e 3e3e 2061 203d 2078 722e 4461 7461   >>> a = xr.Data
+0000d110: 4172 7261 7928 0a20 2020 202e 2e2e 2020  Array(.    ...  
+0000d120: 2020 205b 312c 2032 5d2c 0a20 2020 202e     [1, 2],.    .
+0000d130: 2e2e 2020 2020 2064 696d 733d 5b22 6361  ..     dims=["ca
+0000d140: 7274 6573 6961 6e22 5d2c 0a20 2020 202e  rtesian"],.    .
+0000d150: 2e2e 2020 2020 2063 6f6f 7264 733d 6469  ..     coords=di
+0000d160: 6374 2863 6172 7465 7369 616e 3d28 5b22  ct(cartesian=(["
+0000d170: 6361 7274 6573 6961 6e22 5d2c 205b 2278  cartesian"], ["x
+0000d180: 222c 2022 7a22 5d29 292c 0a20 2020 202e  ", "z"])),.    .
+0000d190: 2e2e 2029 0a20 2020 203e 3e3e 2062 203d  .. ).    >>> b =
+0000d1a0: 2078 722e 4461 7461 4172 7261 7928 0a20   xr.DataArray(. 
+0000d1b0: 2020 202e 2e2e 2020 2020 205b 342c 2035     ...     [4, 5
+0000d1c0: 2c20 365d 2c0a 2020 2020 2e2e 2e20 2020  , 6],.    ...   
+0000d1d0: 2020 6469 6d73 3d5b 2263 6172 7465 7369    dims=["cartesi
+0000d1e0: 616e 225d 2c0a 2020 2020 2e2e 2e20 2020  an"],.    ...   
+0000d1f0: 2020 636f 6f72 6473 3d64 6963 7428 6361    coords=dict(ca
+0000d200: 7274 6573 6961 6e3d 285b 2263 6172 7465  rtesian=(["carte
+0000d210: 7369 616e 225d 2c20 5b22 7822 2c20 2279  sian"], ["x", "y
+0000d220: 222c 2022 7a22 5d29 292c 0a20 2020 202e  ", "z"])),.    .
+0000d230: 2e2e 2029 0a20 2020 203e 3e3e 2078 722e  .. ).    >>> xr.
+0000d240: 6372 6f73 7328 612c 2062 2c20 6469 6d3d  cross(a, b, dim=
+0000d250: 2263 6172 7465 7369 616e 2229 0a20 2020  "cartesian").   
+0000d260: 203c 7861 7272 6179 2e44 6174 6141 7272   <xarray.DataArr
+0000d270: 6179 2028 6361 7274 6573 6961 6e3a 2033  ay (cartesian: 3
+0000d280: 293e 0a20 2020 2061 7272 6179 285b 2d31  )>.    array([-1
+0000d290: 302c 2020 2032 2c20 2020 355d 290a 2020  0,   2,   5]).  
+0000d2a0: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+0000d2b0: 2020 2020 202a 2063 6172 7465 7369 616e       * cartesian
+0000d2c0: 2020 2863 6172 7465 7369 616e 2920 3c55    (cartesian) <U
+0000d2d0: 3120 2778 2720 2779 2720 277a 270a 0a20  1 'x' 'y' 'z'.. 
+0000d2e0: 2020 204d 756c 7469 706c 6520 7665 6374     Multiple vect
+0000d2f0: 6f72 2063 726f 7373 2d70 726f 6475 6374  or cross-product
+0000d300: 732e 204e 6f74 6520 7468 6174 2074 6865  s. Note that the
+0000d310: 2064 6972 6563 7469 6f6e 206f 6620 7468   direction of th
+0000d320: 650a 2020 2020 6372 6f73 7320 7072 6f64  e.    cross prod
+0000d330: 7563 7420 7665 6374 6f72 2069 7320 6465  uct vector is de
+0000d340: 6669 6e65 6420 6279 2074 6865 2072 6967  fined by the rig
+0000d350: 6874 2d68 616e 6420 7275 6c65 3a0a 0a20  ht-hand rule:.. 
+0000d360: 2020 203e 3e3e 2061 203d 2078 722e 4461     >>> a = xr.Da
+0000d370: 7461 4172 7261 7928 0a20 2020 202e 2e2e  taArray(.    ...
+0000d380: 2020 2020 205b 5b31 2c20 322c 2033 5d2c       [[1, 2, 3],
+0000d390: 205b 342c 2035 2c20 365d 5d2c 0a20 2020   [4, 5, 6]],.   
+0000d3a0: 202e 2e2e 2020 2020 2064 696d 733d 2822   ...     dims=("
+0000d3b0: 7469 6d65 222c 2022 6361 7274 6573 6961  time", "cartesia
+0000d3c0: 6e22 292c 0a20 2020 202e 2e2e 2020 2020  n"),.    ...    
+0000d3d0: 2063 6f6f 7264 733d 6469 6374 280a 2020   coords=dict(.  
+0000d3e0: 2020 2e2e 2e20 2020 2020 2020 2020 7469    ...         ti
+0000d3f0: 6d65 3d28 5b22 7469 6d65 225d 2c20 5b30  me=(["time"], [0
+0000d400: 2c20 315d 292c 0a20 2020 202e 2e2e 2020  , 1]),.    ...  
+0000d410: 2020 2020 2020 2063 6172 7465 7369 616e         cartesian
+0000d420: 3d28 5b22 6361 7274 6573 6961 6e22 5d2c  =(["cartesian"],
+0000d430: 205b 2278 222c 2022 7922 2c20 227a 225d   ["x", "y", "z"]
+0000d440: 292c 0a20 2020 202e 2e2e 2020 2020 2029  ),.    ...     )
+0000d450: 2c0a 2020 2020 2e2e 2e20 290a 2020 2020  ,.    ... ).    
+0000d460: 3e3e 3e20 6220 3d20 7872 2e44 6174 6141  >>> b = xr.DataA
+0000d470: 7272 6179 280a 2020 2020 2e2e 2e20 2020  rray(.    ...   
+0000d480: 2020 5b5b 342c 2035 2c20 365d 2c20 5b31    [[4, 5, 6], [1
+0000d490: 2c20 322c 2033 5d5d 2c0a 2020 2020 2e2e  , 2, 3]],.    ..
+0000d4a0: 2e20 2020 2020 6469 6d73 3d28 2274 696d  .     dims=("tim
+0000d4b0: 6522 2c20 2263 6172 7465 7369 616e 2229  e", "cartesian")
+0000d4c0: 2c0a 2020 2020 2e2e 2e20 2020 2020 636f  ,.    ...     co
+0000d4d0: 6f72 6473 3d64 6963 7428 0a20 2020 202e  ords=dict(.    .
+0000d4e0: 2e2e 2020 2020 2020 2020 2074 696d 653d  ..         time=
+0000d4f0: 285b 2274 696d 6522 5d2c 205b 302c 2031  (["time"], [0, 1
+0000d500: 5d29 2c0a 2020 2020 2e2e 2e20 2020 2020  ]),.    ...     
+0000d510: 2020 2020 6361 7274 6573 6961 6e3d 285b      cartesian=([
+0000d520: 2263 6172 7465 7369 616e 225d 2c20 5b22  "cartesian"], ["
+0000d530: 7822 2c20 2279 222c 2022 7a22 5d29 2c0a  x", "y", "z"]),.
+0000d540: 2020 2020 2e2e 2e20 2020 2020 292c 0a20      ...     ),. 
+0000d550: 2020 202e 2e2e 2029 0a20 2020 203e 3e3e     ... ).    >>>
+0000d560: 2078 722e 6372 6f73 7328 612c 2062 2c20   xr.cross(a, b, 
+0000d570: 6469 6d3d 2263 6172 7465 7369 616e 2229  dim="cartesian")
+0000d580: 0a20 2020 203c 7861 7272 6179 2e44 6174  .    <xarray.Dat
+0000d590: 6141 7272 6179 2028 7469 6d65 3a20 322c  aArray (time: 2,
+0000d5a0: 2063 6172 7465 7369 616e 3a20 3329 3e0a   cartesian: 3)>.
+0000d5b0: 2020 2020 6172 7261 7928 5b5b 2d33 2c20      array([[-3, 
+0000d5c0: 2036 2c20 2d33 5d2c 0a20 2020 2020 2020   6, -3],.       
+0000d5d0: 2020 2020 5b20 332c 202d 362c 2020 335d      [ 3, -6,  3]
+0000d5e0: 5d29 0a20 2020 2043 6f6f 7264 696e 6174  ]).    Coordinat
+0000d5f0: 6573 3a0a 2020 2020 2020 2a20 7469 6d65  es:.      * time
+0000d600: 2020 2020 2020 2028 7469 6d65 2920 696e         (time) in
+0000d610: 7436 3420 3020 310a 2020 2020 2020 2a20  t64 0 1.      * 
+0000d620: 6361 7274 6573 6961 6e20 2028 6361 7274  cartesian  (cart
+0000d630: 6573 6961 6e29 203c 5531 2027 7827 2027  esian) <U1 'x' '
+0000d640: 7927 2027 7a27 0a0a 2020 2020 4372 6f73  y' 'z'..    Cros
+0000d650: 7320 6361 6e20 6265 2063 616c 6c65 6420  s can be called 
+0000d660: 6f6e 2044 6174 6173 6574 7320 6279 2063  on Datasets by c
+0000d670: 6f6e 7665 7274 696e 6720 746f 2044 6174  onverting to Dat
+0000d680: 6141 7272 6179 7320 616e 6420 6c61 7465  aArrays and late
+0000d690: 720a 2020 2020 6261 636b 2074 6f20 6120  r.    back to a 
+0000d6a0: 4461 7461 7365 743a 0a0a 2020 2020 3e3e  Dataset:..    >>
+0000d6b0: 3e20 6473 5f61 203d 2078 722e 4461 7461  > ds_a = xr.Data
+0000d6c0: 7365 7428 6469 6374 2878 3d28 2264 696d  set(dict(x=("dim
+0000d6d0: 5f30 222c 205b 315d 292c 2079 3d28 2264  _0", [1]), y=("d
+0000d6e0: 696d 5f30 222c 205b 325d 292c 207a 3d28  im_0", [2]), z=(
+0000d6f0: 2264 696d 5f30 222c 205b 335d 2929 290a  "dim_0", [3]))).
+0000d700: 2020 2020 3e3e 3e20 6473 5f62 203d 2078      >>> ds_b = x
+0000d710: 722e 4461 7461 7365 7428 6469 6374 2878  r.Dataset(dict(x
+0000d720: 3d28 2264 696d 5f30 222c 205b 345d 292c  =("dim_0", [4]),
+0000d730: 2079 3d28 2264 696d 5f30 222c 205b 355d   y=("dim_0", [5]
+0000d740: 292c 207a 3d28 2264 696d 5f30 222c 205b  ), z=("dim_0", [
+0000d750: 365d 2929 290a 2020 2020 3e3e 3e20 6320  6]))).    >>> c 
+0000d760: 3d20 7872 2e63 726f 7373 280a 2020 2020  = xr.cross(.    
+0000d770: 2e2e 2e20 2020 2020 6473 5f61 2e74 6f5f  ...     ds_a.to_
+0000d780: 6172 7261 7928 2263 6172 7465 7369 616e  array("cartesian
+0000d790: 2229 2c20 6473 5f62 2e74 6f5f 6172 7261  "), ds_b.to_arra
+0000d7a0: 7928 2263 6172 7465 7369 616e 2229 2c20  y("cartesian"), 
+0000d7b0: 6469 6d3d 2263 6172 7465 7369 616e 220a  dim="cartesian".
+0000d7c0: 2020 2020 2e2e 2e20 290a 2020 2020 3e3e      ... ).    >>
+0000d7d0: 3e20 632e 746f 5f64 6174 6173 6574 2864  > c.to_dataset(d
+0000d7e0: 696d 3d22 6361 7274 6573 6961 6e22 290a  im="cartesian").
+0000d7f0: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
+0000d800: 7365 743e 0a20 2020 2044 696d 656e 7369  set>.    Dimensi
+0000d810: 6f6e 733a 2020 2864 696d 5f30 3a20 3129  ons:  (dim_0: 1)
+0000d820: 0a20 2020 2044 696d 656e 7369 6f6e 7320  .    Dimensions 
+0000d830: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
+0000d840: 7465 733a 2064 696d 5f30 0a20 2020 2044  tes: dim_0.    D
+0000d850: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+0000d860: 2020 2020 2020 2078 2020 2020 2020 2020         x        
+0000d870: 2864 696d 5f30 2920 696e 7436 3420 2d33  (dim_0) int64 -3
+0000d880: 0a20 2020 2020 2020 2079 2020 2020 2020  .        y      
+0000d890: 2020 2864 696d 5f30 2920 696e 7436 3420    (dim_0) int64 
+0000d8a0: 360a 2020 2020 2020 2020 7a20 2020 2020  6.        z     
+0000d8b0: 2020 2028 6469 6d5f 3029 2069 6e74 3634     (dim_0) int64
+0000d8c0: 202d 330a 0a20 2020 2053 6565 2041 6c73   -3..    See Als
+0000d8d0: 6f0a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20  o.    --------. 
+0000d8e0: 2020 206e 756d 7079 2e63 726f 7373 203a     numpy.cross :
+0000d8f0: 2043 6f72 7265 7370 6f6e 6469 6e67 206e   Corresponding n
+0000d900: 756d 7079 2066 756e 6374 696f 6e0a 2020  umpy function.  
+0000d910: 2020 2222 220a 0a20 2020 2069 6620 6469    """..    if di
+0000d920: 6d20 6e6f 7420 696e 2061 2e64 696d 733a  m not in a.dims:
+0000d930: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
+0000d940: 616c 7565 4572 726f 7228 6622 4469 6d65  alueError(f"Dime
+0000d950: 6e73 696f 6e20 7b64 696d 2172 7d20 6e6f  nsion {dim!r} no
+0000d960: 7420 6f6e 2061 2229 0a20 2020 2065 6c69  t on a").    eli
+0000d970: 6620 6469 6d20 6e6f 7420 696e 2062 2e64  f dim not in b.d
+0000d980: 696d 733a 0a20 2020 2020 2020 2072 6169  ims:.        rai
+0000d990: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
+0000d9a0: 4469 6d65 6e73 696f 6e20 7b64 696d 2172  Dimension {dim!r
+0000d9b0: 7d20 6e6f 7420 6f6e 2062 2229 0a0a 2020  } not on b")..  
+0000d9c0: 2020 6966 206e 6f74 2031 203c 3d20 612e    if not 1 <= a.
+0000d9d0: 7369 7a65 735b 6469 6d5d 203c 3d20 333a  sizes[dim] <= 3:
+0000d9e0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
+0000d9f0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+0000da00: 2020 2020 2020 2066 2254 6865 2073 697a         f"The siz
+0000da10: 6520 6f66 207b 6469 6d21 727d 206f 6e20  e of {dim!r} on 
+0000da20: 6120 6d75 7374 2062 6520 312c 2032 2c20  a must be 1, 2, 
+0000da30: 6f72 2033 2074 6f20 6265 2022 0a20 2020  or 3 to be ".   
+0000da40: 2020 2020 2020 2020 2066 2263 6f6d 7061           f"compa
+0000da50: 7469 626c 6520 7769 7468 2061 2063 726f  tible with a cro
+0000da60: 7373 2070 726f 6475 6374 2062 7574 2069  ss product but i
+0000da70: 7320 7b61 2e73 697a 6573 5b64 696d 5d7d  s {a.sizes[dim]}
+0000da80: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+0000da90: 656c 6966 206e 6f74 2031 203c 3d20 622e  elif not 1 <= b.
+0000daa0: 7369 7a65 735b 6469 6d5d 203c 3d20 333a  sizes[dim] <= 3:
+0000dab0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
+0000dac0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+0000dad0: 2020 2020 2020 2066 2254 6865 2073 697a         f"The siz
+0000dae0: 6520 6f66 207b 6469 6d21 727d 206f 6e20  e of {dim!r} on 
+0000daf0: 6220 6d75 7374 2062 6520 312c 2032 2c20  b must be 1, 2, 
+0000db00: 6f72 2033 2074 6f20 6265 2022 0a20 2020  or 3 to be ".   
+0000db10: 2020 2020 2020 2020 2066 2263 6f6d 7061           f"compa
+0000db20: 7469 626c 6520 7769 7468 2061 2063 726f  tible with a cro
+0000db30: 7373 2070 726f 6475 6374 2062 7574 2069  ss product but i
+0000db40: 7320 7b62 2e73 697a 6573 5b64 696d 5d7d  s {b.sizes[dim]}
+0000db50: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
+0000db60: 2061 6c6c 5f64 696d 7320 3d20 6c69 7374   all_dims = list
+0000db70: 2864 6963 742e 6672 6f6d 6b65 7973 2861  (dict.fromkeys(a
+0000db80: 2e64 696d 7320 2b20 622e 6469 6d73 2929  .dims + b.dims))
+0000db90: 0a0a 2020 2020 6966 2061 2e73 697a 6573  ..    if a.sizes
+0000dba0: 5b64 696d 5d20 213d 2062 2e73 697a 6573  [dim] != b.sizes
+0000dbb0: 5b64 696d 5d3a 0a20 2020 2020 2020 2023  [dim]:.        #
+0000dbc0: 2041 7272 6179 7320 6861 7665 2064 6966   Arrays have dif
+0000dbd0: 6665 7265 6e74 2073 697a 6573 2e20 4170  ferent sizes. Ap
+0000dbe0: 7065 6e64 207a 6572 6f73 2077 6865 7265  pend zeros where
+0000dbf0: 2074 6865 2073 6d61 6c6c 6572 0a20 2020   the smaller.   
+0000dc00: 2020 2020 2023 2061 7272 6179 2069 7320       # array is 
+0000dc10: 6d69 7373 696e 6720 6120 7661 6c75 652c  missing a value,
+0000dc20: 207a 6572 6f73 2077 696c 6c20 6e6f 7420   zeros will not 
+0000dc30: 6166 6665 6374 206e 702e 6372 6f73 733a  affect np.cross:
+0000dc40: 0a0a 2020 2020 2020 2020 6966 2028 0a20  ..        if (. 
+0000dc50: 2020 2020 2020 2020 2020 206e 6f74 2069             not i
+0000dc60: 7369 6e73 7461 6e63 6528 612c 2056 6172  sinstance(a, Var
+0000dc70: 6961 626c 6529 2020 2320 4f6e 6c79 2075  iable)  # Only u
+0000dc80: 7365 6420 746f 206d 616b 6520 6d79 7079  sed to make mypy
+0000dc90: 2068 6170 7079 2e0a 2020 2020 2020 2020   happy..        
+0000dca0: 2020 2020 616e 6420 6469 6d20 696e 2067      and dim in g
+0000dcb0: 6574 6174 7472 2861 2c20 2263 6f6f 7264  etattr(a, "coord
+0000dcc0: 7322 2c20 7b7d 290a 2020 2020 2020 2020  s", {}).        
+0000dcd0: 2020 2020 616e 6420 6e6f 7420 6973 696e      and not isin
+0000dce0: 7374 616e 6365 2862 2c20 5661 7269 6162  stance(b, Variab
+0000dcf0: 6c65 2920 2023 204f 6e6c 7920 7573 6564  le)  # Only used
+0000dd00: 2074 6f20 6d61 6b65 206d 7970 7920 6861   to make mypy ha
+0000dd10: 7070 792e 0a20 2020 2020 2020 2020 2020  ppy..           
+0000dd20: 2061 6e64 2064 696d 2069 6e20 6765 7461   and dim in geta
+0000dd30: 7474 7228 622c 2022 636f 6f72 6473 222c  ttr(b, "coords",
+0000dd40: 207b 7d29 0a20 2020 2020 2020 2029 3a0a   {}).        ):.
+0000dd50: 2020 2020 2020 2020 2020 2020 2320 4966              # If
+0000dd60: 2074 6865 2061 7272 6179 7320 6861 7665   the arrays have
+0000dd70: 2063 6f6f 7264 7320 7765 206b 6e6f 7720   coords we know 
+0000dd80: 7768 6963 6820 696e 6465 7865 7320 746f  which indexes to
+0000dd90: 2066 696c 6c0a 2020 2020 2020 2020 2020   fill.          
+0000dda0: 2020 2320 7769 7468 207a 6572 6f73 3a0a    # with zeros:.
+0000ddb0: 2020 2020 2020 2020 2020 2020 612c 2062              a, b
+0000ddc0: 203d 2061 6c69 676e 280a 2020 2020 2020   = align(.      
+0000ddd0: 2020 2020 2020 2020 2020 612c 0a20 2020            a,.   
+0000dde0: 2020 2020 2020 2020 2020 2020 2062 2c0a               b,.
+0000ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de00: 6669 6c6c 5f76 616c 7565 3d30 2c0a 2020  fill_value=0,.  
+0000de10: 2020 2020 2020 2020 2020 2020 2020 6a6f                jo
+0000de20: 696e 3d22 6f75 7465 7222 2c0a 2020 2020  in="outer",.    
+0000de30: 2020 2020 2020 2020 2020 2020 6578 636c              excl
+0000de40: 7564 653d 7365 7428 616c 6c5f 6469 6d73  ude=set(all_dims
+0000de50: 2920 2d20 7b64 696d 7d2c 0a20 2020 2020  ) - {dim},.     
+0000de60: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000de70: 2065 6c69 6620 6d69 6e28 612e 7369 7a65   elif min(a.size
+0000de80: 735b 6469 6d5d 2c20 622e 7369 7a65 735b  s[dim], b.sizes[
+0000de90: 6469 6d5d 2920 3d3d 2032 3a0a 2020 2020  dim]) == 2:.    
+0000dea0: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
+0000deb0: 2061 7272 6179 2064 6f65 736e 2774 2068   array doesn't h
+0000dec0: 6176 6520 636f 6f72 6473 2077 6520 6361  ave coords we ca
+0000ded0: 6e20 6f6e 6c79 2069 6e66 6572 0a20 2020  n only infer.   
+0000dee0: 2020 2020 2020 2020 2023 2074 6861 7420           # that 
+0000def0: 6974 2068 6173 2063 6f6d 706f 7369 7465  it has composite
+0000df00: 2076 616c 7565 7320 6966 2074 6865 2073   values if the s
+0000df10: 697a 6520 6973 2061 7420 6c65 6173 7420  ize is at least 
+0000df20: 322e 0a20 2020 2020 2020 2020 2020 2023  2..            #
+0000df30: 204f 6e63 6520 7061 6464 6564 2c20 7265   Once padded, re
+0000df40: 6368 756e 6b20 7468 6520 7061 6464 6564  chunk the padded
+0000df50: 2061 7272 6179 2062 6563 6175 7365 2061   array because a
+0000df60: 7070 6c79 5f75 6675 6e63 0a20 2020 2020  pply_ufunc.     
+0000df70: 2020 2020 2020 2023 2072 6571 7569 7265         # require
+0000df80: 7320 636f 7265 2064 696d 656e 7369 6f6e  s core dimension
+0000df90: 7320 6e6f 7420 746f 2062 6520 6368 756e  s not to be chun
+0000dfa0: 6b65 643a 0a20 2020 2020 2020 2020 2020  ked:.           
+0000dfb0: 2069 6620 612e 7369 7a65 735b 6469 6d5d   if a.sizes[dim]
+0000dfc0: 203c 2062 2e73 697a 6573 5b64 696d 5d3a   < b.sizes[dim]:
+0000dfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dfe0: 2061 203d 2061 2e70 6164 287b 6469 6d3a   a = a.pad({dim:
+0000dff0: 2028 302c 2031 297d 2c20 636f 6e73 7461   (0, 1)}, consta
+0000e000: 6e74 5f76 616c 7565 733d 3029 0a20 2020  nt_values=0).   
+0000e010: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+0000e020: 4f44 4f3a 2053 686f 756c 6420 7061 6420  ODO: Should pad 
+0000e030: 6f72 2061 7070 6c79 5f75 6675 6e63 2068  or apply_ufunc h
+0000e040: 616e 646c 6520 636f 7272 6563 7420 6368  andle correct ch
+0000e050: 756e 6b69 6e67 3f0a 2020 2020 2020 2020  unking?.        
+0000e060: 2020 2020 2020 2020 6120 3d20 612e 6368          a = a.ch
+0000e070: 756e 6b28 7b64 696d 3a20 2d31 7d29 2069  unk({dim: -1}) i
+0000e080: 6620 6973 5f64 7563 6b5f 6461 736b 5f61  f is_duck_dask_a
+0000e090: 7272 6179 2861 2e64 6174 6129 2065 6c73  rray(a.data) els
+0000e0a0: 6520 610a 2020 2020 2020 2020 2020 2020  e a.            
+0000e0b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000e0c0: 2020 2020 2020 6220 3d20 622e 7061 6428        b = b.pad(
+0000e0d0: 7b64 696d 3a20 2830 2c20 3129 7d2c 2063  {dim: (0, 1)}, c
+0000e0e0: 6f6e 7374 616e 745f 7661 6c75 6573 3d30  onstant_values=0
+0000e0f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000e100: 2020 2320 544f 444f 3a20 5368 6f75 6c64    # TODO: Should
+0000e110: 2070 6164 206f 7220 6170 706c 795f 7566   pad or apply_uf
+0000e120: 756e 6320 6861 6e64 6c65 2063 6f72 7265  unc handle corre
+0000e130: 6374 2063 6875 6e6b 696e 673f 0a20 2020  ct chunking?.   
+0000e140: 2020 2020 2020 2020 2020 2020 2062 203d               b =
+0000e150: 2062 2e63 6875 6e6b 287b 6469 6d3a 202d   b.chunk({dim: -
+0000e160: 317d 2920 6966 2069 735f 6475 636b 5f64  1}) if is_duck_d
+0000e170: 6173 6b5f 6172 7261 7928 622e 6461 7461  ask_array(b.data
+0000e180: 2920 656c 7365 2062 0a20 2020 2020 2020  ) else b.       
+0000e190: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000e1a0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000e1b0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000e1c0: 2020 2020 2066 227b 6469 6d21 727d 206f       f"{dim!r} o
+0000e1d0: 6e20 7b27 6127 2069 6620 612e 7369 7a65  n {'a' if a.size
+0000e1e0: 735b 6469 6d5d 203d 3d20 3120 656c 7365  s[dim] == 1 else
+0000e1f0: 2027 6227 7d20 6973 2069 6e63 6f6d 7061   'b'} is incompa
+0000e200: 7469 626c 653a 220a 2020 2020 2020 2020  tible:".        
+0000e210: 2020 2020 2020 2020 2220 6469 6d65 6e73          " dimens
+0000e220: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
+0000e230: 7264 696e 6174 6573 206d 7573 7420 6861  rdinates must ha
+0000e240: 7665 2068 6176 6520 6120 6c65 6e67 7468  ve have a length
+0000e250: 206f 6620 3220 6f72 2033 220a 2020 2020   of 2 or 3".    
+0000e260: 2020 2020 2020 2020 290a 0a20 2020 2063          )..    c
+0000e270: 203d 2061 7070 6c79 5f75 6675 6e63 280a   = apply_ufunc(.
+0000e280: 2020 2020 2020 2020 6e70 2e63 726f 7373          np.cross
+0000e290: 2c0a 2020 2020 2020 2020 612c 0a20 2020  ,.        a,.   
+0000e2a0: 2020 2020 2062 2c0a 2020 2020 2020 2020       b,.        
+0000e2b0: 696e 7075 745f 636f 7265 5f64 696d 733d  input_core_dims=
+0000e2c0: 5b5b 6469 6d5d 2c20 5b64 696d 5d5d 2c0a  [[dim], [dim]],.
+0000e2d0: 2020 2020 2020 2020 6f75 7470 7574 5f63          output_c
+0000e2e0: 6f72 655f 6469 6d73 3d5b 5b64 696d 5d20  ore_dims=[[dim] 
+0000e2f0: 6966 2061 2e73 697a 6573 5b64 696d 5d20  if a.sizes[dim] 
+0000e300: 3d3d 2033 2065 6c73 6520 5b5d 5d2c 0a20  == 3 else []],. 
+0000e310: 2020 2020 2020 2064 6173 6b3d 2270 6172         dask="par
+0000e320: 616c 6c65 6c69 7a65 6422 2c0a 2020 2020  allelized",.    
+0000e330: 2020 2020 6f75 7470 7574 5f64 7479 7065      output_dtype
+0000e340: 733d 5b6e 702e 7265 7375 6c74 5f74 7970  s=[np.result_typ
+0000e350: 6528 612c 2062 295d 2c0a 2020 2020 290a  e(a, b)],.    ).
+0000e360: 2020 2020 6320 3d20 632e 7472 616e 7370      c = c.transp
+0000e370: 6f73 6528 2a61 6c6c 5f64 696d 732c 206d  ose(*all_dims, m
+0000e380: 6973 7369 6e67 5f64 696d 733d 2269 676e  issing_dims="ign
+0000e390: 6f72 6522 290a 0a20 2020 2072 6574 7572  ore")..    retur
+0000e3a0: 6e20 630a 0a0a 6465 6620 646f 7428 0a20  n c...def dot(. 
+0000e3b0: 2020 202a 6172 7261 7973 2c0a 2020 2020     *arrays,.    
+0000e3c0: 6469 6d73 3a20 4469 6d73 203d 204e 6f6e  dims: Dims = Non
+0000e3d0: 652c 0a20 2020 202a 2a6b 7761 7267 733a  e,.    **kwargs:
+0000e3e0: 2041 6e79 2c0a 293a 0a20 2020 2022 2222   Any,.):.    """
+0000e3f0: 4765 6e65 7261 6c69 7a65 6420 646f 7420  Generalized dot 
+0000e400: 7072 6f64 7563 7420 666f 7220 7861 7272  product for xarr
+0000e410: 6179 206f 626a 6563 7473 2e20 4c69 6b65  ay objects. Like
+0000e420: 206e 702e 6569 6e73 756d 2c20 6275 740a   np.einsum, but.
+0000e430: 2020 2020 7072 6f76 6964 6573 2061 2073      provides a s
+0000e440: 696d 706c 6572 2069 6e74 6572 6661 6365  impler interface
+0000e450: 2062 6173 6564 206f 6e20 6172 7261 7920   based on array 
+0000e460: 6469 6d65 6e73 696f 6e73 2e0a 0a20 2020  dimensions...   
+0000e470: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+0000e480: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 202a  ----------.    *
+0000e490: 6172 7261 7973 203a 2044 6174 6141 7272  arrays : DataArr
+0000e4a0: 6179 206f 7220 5661 7269 6162 6c65 0a20  ay or Variable. 
+0000e4b0: 2020 2020 2020 2041 7272 6179 7320 746f         Arrays to
+0000e4c0: 2063 6f6d 7075 7465 2e0a 2020 2020 6469   compute..    di
+0000e4d0: 6d73 203a 2073 7472 2c20 6974 6572 6162  ms : str, iterab
+0000e4e0: 6c65 206f 6620 6861 7368 6162 6c65 2c20  le of hashable, 
+0000e4f0: 222e 2e2e 2220 6f72 204e 6f6e 652c 206f  "..." or None, o
+0000e500: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0000e510: 5768 6963 6820 6469 6d65 6e73 696f 6e73  Which dimensions
+0000e520: 2074 6f20 7375 6d20 6f76 6572 2e20 456c   to sum over. El
+0000e530: 6c69 7073 6973 2028 272e 2e2e 2729 2073  lipsis ('...') s
+0000e540: 756d 7320 6f76 6572 2061 6c6c 2064 696d  ums over all dim
+0000e550: 656e 7369 6f6e 732e 0a20 2020 2020 2020  ensions..       
+0000e560: 2049 6620 6e6f 7420 7370 6563 6966 6965   If not specifie
+0000e570: 642c 2074 6865 6e20 616c 6c20 7468 6520  d, then all the 
+0000e580: 636f 6d6d 6f6e 2064 696d 656e 7369 6f6e  common dimension
+0000e590: 7320 6172 6520 7375 6d6d 6564 206f 7665  s are summed ove
+0000e5a0: 722e 0a20 2020 202a 2a6b 7761 7267 7320  r..    **kwargs 
+0000e5b0: 3a20 6469 6374 0a20 2020 2020 2020 2041  : dict.        A
+0000e5c0: 6464 6974 696f 6e61 6c20 6b65 7977 6f72  dditional keywor
+0000e5d0: 6420 6172 6775 6d65 6e74 7320 7061 7373  d arguments pass
+0000e5e0: 6564 2074 6f20 6e75 6d70 792e 6569 6e73  ed to numpy.eins
+0000e5f0: 756d 206f 720a 2020 2020 2020 2020 6461  um or.        da
+0000e600: 736b 2e61 7272 6179 2e65 696e 7375 6d0a  sk.array.einsum.
+0000e610: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
+0000e620: 202d 2d2d 2d2d 2d2d 0a20 2020 2044 6174   -------.    Dat
+0000e630: 6141 7272 6179 0a0a 2020 2020 4578 616d  aArray..    Exam
+0000e640: 706c 6573 0a20 2020 202d 2d2d 2d2d 2d2d  ples.    -------
+0000e650: 2d0a 2020 2020 3e3e 3e20 6461 5f61 203d  -.    >>> da_a =
+0000e660: 2078 722e 4461 7461 4172 7261 7928 6e70   xr.DataArray(np
+0000e670: 2e61 7261 6e67 6528 3320 2a20 3229 2e72  .arange(3 * 2).r
+0000e680: 6573 6861 7065 2833 2c20 3229 2c20 6469  eshape(3, 2), di
+0000e690: 6d73 3d5b 2261 222c 2022 6222 5d29 0a20  ms=["a", "b"]). 
+0000e6a0: 2020 203e 3e3e 2064 615f 6220 3d20 7872     >>> da_b = xr
+0000e6b0: 2e44 6174 6141 7272 6179 286e 702e 6172  .DataArray(np.ar
+0000e6c0: 616e 6765 2833 202a 2032 202a 2032 292e  ange(3 * 2 * 2).
+0000e6d0: 7265 7368 6170 6528 332c 2032 2c20 3229  reshape(3, 2, 2)
+0000e6e0: 2c20 6469 6d73 3d5b 2261 222c 2022 6222  , dims=["a", "b"
+0000e6f0: 2c20 2263 225d 290a 2020 2020 3e3e 3e20  , "c"]).    >>> 
+0000e700: 6461 5f63 203d 2078 722e 4461 7461 4172  da_c = xr.DataAr
+0000e710: 7261 7928 6e70 2e61 7261 6e67 6528 3220  ray(np.arange(2 
+0000e720: 2a20 3329 2e72 6573 6861 7065 2832 2c20  * 3).reshape(2, 
+0000e730: 3329 2c20 6469 6d73 3d5b 2263 222c 2022  3), dims=["c", "
+0000e740: 6422 5d29 0a0a 2020 2020 3e3e 3e20 6461  d"])..    >>> da
+0000e750: 5f61 0a20 2020 203c 7861 7272 6179 2e44  _a.    <xarray.D
+0000e760: 6174 6141 7272 6179 2028 613a 2033 2c20  ataArray (a: 3, 
+0000e770: 623a 2032 293e 0a20 2020 2061 7272 6179  b: 2)>.    array
+0000e780: 285b 5b30 2c20 315d 2c0a 2020 2020 2020  ([[0, 1],.      
+0000e790: 2020 2020 205b 322c 2033 5d2c 0a20 2020       [2, 3],.   
+0000e7a0: 2020 2020 2020 2020 5b34 2c20 355d 5d29          [4, 5]])
+0000e7b0: 0a20 2020 2044 696d 656e 7369 6f6e 7320  .    Dimensions 
+0000e7c0: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
+0000e7d0: 7465 733a 2061 2c20 620a 0a20 2020 203e  tes: a, b..    >
+0000e7e0: 3e3e 2064 615f 620a 2020 2020 3c78 6172  >> da_b.    <xar
+0000e7f0: 7261 792e 4461 7461 4172 7261 7920 2861  ray.DataArray (a
+0000e800: 3a20 332c 2062 3a20 322c 2063 3a20 3229  : 3, b: 2, c: 2)
+0000e810: 3e0a 2020 2020 6172 7261 7928 5b5b 5b20  >.    array([[[ 
+0000e820: 302c 2020 315d 2c0a 2020 2020 2020 2020  0,  1],.        
+0000e830: 2020 2020 5b20 322c 2020 335d 5d2c 0a20      [ 2,  3]],. 
+0000e840: 2020 203c 424c 414e 4b4c 494e 453e 0a20     <BLANKLINE>. 
+0000e850: 2020 2020 2020 2020 2020 5b5b 2034 2c20            [[ 4, 
+0000e860: 2035 5d2c 0a20 2020 2020 2020 2020 2020   5],.           
+0000e870: 205b 2036 2c20 2037 5d5d 2c0a 2020 2020   [ 6,  7]],.    
+0000e880: 3c42 4c41 4e4b 4c49 4e45 3e0a 2020 2020  <BLANKLINE>.    
+0000e890: 2020 2020 2020 205b 5b20 382c 2020 395d         [[ 8,  9]
+0000e8a0: 2c0a 2020 2020 2020 2020 2020 2020 5b31  ,.            [1
+0000e8b0: 302c 2031 315d 5d5d 290a 2020 2020 4469  0, 11]]]).    Di
+0000e8c0: 6d65 6e73 696f 6e73 2077 6974 686f 7574  mensions without
+0000e8d0: 2063 6f6f 7264 696e 6174 6573 3a20 612c   coordinates: a,
+0000e8e0: 2062 2c20 630a 0a20 2020 203e 3e3e 2064   b, c..    >>> d
+0000e8f0: 615f 630a 2020 2020 3c78 6172 7261 792e  a_c.    <xarray.
+0000e900: 4461 7461 4172 7261 7920 2863 3a20 322c  DataArray (c: 2,
+0000e910: 2064 3a20 3329 3e0a 2020 2020 6172 7261   d: 3)>.    arra
+0000e920: 7928 5b5b 302c 2031 2c20 325d 2c0a 2020  y([[0, 1, 2],.  
+0000e930: 2020 2020 2020 2020 205b 332c 2034 2c20           [3, 4, 
+0000e940: 355d 5d29 0a20 2020 2044 696d 656e 7369  5]]).    Dimensi
+0000e950: 6f6e 7320 7769 7468 6f75 7420 636f 6f72  ons without coor
+0000e960: 6469 6e61 7465 733a 2063 2c20 640a 0a20  dinates: c, d.. 
+0000e970: 2020 203e 3e3e 2078 722e 646f 7428 6461     >>> xr.dot(da
+0000e980: 5f61 2c20 6461 5f62 2c20 6469 6d73 3d5b  _a, da_b, dims=[
+0000e990: 2261 222c 2022 6222 5d29 0a20 2020 203c  "a", "b"]).    <
+0000e9a0: 7861 7272 6179 2e44 6174 6141 7272 6179  xarray.DataArray
+0000e9b0: 2028 633a 2032 293e 0a20 2020 2061 7272   (c: 2)>.    arr
+0000e9c0: 6179 285b 3131 302c 2031 3235 5d29 0a20  ay([110, 125]). 
+0000e9d0: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
+0000e9e0: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
+0000e9f0: 733a 2063 0a0a 2020 2020 3e3e 3e20 7872  s: c..    >>> xr
+0000ea00: 2e64 6f74 2864 615f 612c 2064 615f 622c  .dot(da_a, da_b,
+0000ea10: 2064 696d 733d 5b22 6122 5d29 0a20 2020   dims=["a"]).   
+0000ea20: 203c 7861 7272 6179 2e44 6174 6141 7272   <xarray.DataArr
+0000ea30: 6179 2028 623a 2032 2c20 633a 2032 293e  ay (b: 2, c: 2)>
+0000ea40: 0a20 2020 2061 7272 6179 285b 5b34 302c  .    array([[40,
+0000ea50: 2034 365d 2c0a 2020 2020 2020 2020 2020   46],.          
+0000ea60: 205b 3730 2c20 3739 5d5d 290a 2020 2020   [70, 79]]).    
+0000ea70: 4469 6d65 6e73 696f 6e73 2077 6974 686f  Dimensions witho
+0000ea80: 7574 2063 6f6f 7264 696e 6174 6573 3a20  ut coordinates: 
+0000ea90: 622c 2063 0a0a 2020 2020 3e3e 3e20 7872  b, c..    >>> xr
+0000eaa0: 2e64 6f74 2864 615f 612c 2064 615f 622c  .dot(da_a, da_b,
+0000eab0: 2064 615f 632c 2064 696d 733d 5b22 6222   da_c, dims=["b"
+0000eac0: 2c20 2263 225d 290a 2020 2020 3c78 6172  , "c"]).    <xar
+0000ead0: 7261 792e 4461 7461 4172 7261 7920 2861  ray.DataArray (a
+0000eae0: 3a20 332c 2064 3a20 3329 3e0a 2020 2020  : 3, d: 3)>.    
+0000eaf0: 6172 7261 7928 5b5b 2020 392c 2020 3134  array([[  9,  14
+0000eb00: 2c20 2031 395d 2c0a 2020 2020 2020 2020  ,  19],.        
+0000eb10: 2020 205b 2039 332c 2031 3530 2c20 3230     [ 93, 150, 20
+0000eb20: 375d 2c0a 2020 2020 2020 2020 2020 205b  7],.           [
+0000eb30: 3237 332c 2034 3436 2c20 3631 395d 5d29  273, 446, 619]])
+0000eb40: 0a20 2020 2044 696d 656e 7369 6f6e 7320  .    Dimensions 
+0000eb50: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
+0000eb60: 7465 733a 2061 2c20 640a 0a20 2020 203e  tes: a, d..    >
+0000eb70: 3e3e 2078 722e 646f 7428 6461 5f61 2c20  >> xr.dot(da_a, 
+0000eb80: 6461 5f62 290a 2020 2020 3c78 6172 7261  da_b).    <xarra
+0000eb90: 792e 4461 7461 4172 7261 7920 2863 3a20  y.DataArray (c: 
+0000eba0: 3229 3e0a 2020 2020 6172 7261 7928 5b31  2)>.    array([1
+0000ebb0: 3130 2c20 3132 355d 290a 2020 2020 4469  10, 125]).    Di
+0000ebc0: 6d65 6e73 696f 6e73 2077 6974 686f 7574  mensions without
+0000ebd0: 2063 6f6f 7264 696e 6174 6573 3a20 630a   coordinates: c.
+0000ebe0: 0a20 2020 203e 3e3e 2078 722e 646f 7428  .    >>> xr.dot(
+0000ebf0: 6461 5f61 2c20 6461 5f62 2c20 6469 6d73  da_a, da_b, dims
+0000ec00: 3d2e 2e2e 290a 2020 2020 3c78 6172 7261  =...).    <xarra
+0000ec10: 792e 4461 7461 4172 7261 7920 2829 3e0a  y.DataArray ()>.
+0000ec20: 2020 2020 6172 7261 7928 3233 3529 0a20      array(235). 
+0000ec30: 2020 2022 2222 0a20 2020 2066 726f 6d20     """.    from 
+0000ec40: 7861 7272 6179 2e63 6f72 652e 6461 7461  xarray.core.data
+0000ec50: 6172 7261 7920 696d 706f 7274 2044 6174  array import Dat
+0000ec60: 6141 7272 6179 0a20 2020 2066 726f 6d20  aArray.    from 
+0000ec70: 7861 7272 6179 2e63 6f72 652e 7661 7269  xarray.core.vari
+0000ec80: 6162 6c65 2069 6d70 6f72 7420 5661 7269  able import Vari
+0000ec90: 6162 6c65 0a0a 2020 2020 6966 2061 6e79  able..    if any
+0000eca0: 286e 6f74 2069 7369 6e73 7461 6e63 6528  (not isinstance(
+0000ecb0: 6172 722c 2028 5661 7269 6162 6c65 2c20  arr, (Variable, 
+0000ecc0: 4461 7461 4172 7261 7929 2920 666f 7220  DataArray)) for 
+0000ecd0: 6172 7220 696e 2061 7272 6179 7329 3a0a  arr in arrays):.
+0000ece0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+0000ecf0: 7065 4572 726f 7228 0a20 2020 2020 2020  peError(.       
+0000ed00: 2020 2020 2022 4f6e 6c79 2078 722e 4461       "Only xr.Da
+0000ed10: 7461 4172 7261 7920 616e 6420 7872 2e56  taArray and xr.V
+0000ed20: 6172 6961 626c 6520 6172 6520 7375 7070  ariable are supp
+0000ed30: 6f72 7465 642e 220a 2020 2020 2020 2020  orted.".        
+0000ed40: 2020 2020 2247 6976 656e 207b 7d2e 222e      "Given {}.".
+0000ed50: 666f 726d 6174 285b 7479 7065 2861 7272  format([type(arr
+0000ed60: 2920 666f 7220 6172 7220 696e 2061 7272  ) for arr in arr
+0000ed70: 6179 735d 290a 2020 2020 2020 2020 290a  ays]).        ).
+0000ed80: 0a20 2020 2069 6620 6c65 6e28 6172 7261  .    if len(arra
+0000ed90: 7973 2920 3d3d 2030 3a0a 2020 2020 2020  ys) == 0:.      
+0000eda0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+0000edb0: 7228 2241 7420 6c65 6173 7420 6f6e 6520  r("At least one 
+0000edc0: 6172 7261 7920 7368 6f75 6c64 2062 6520  array should be 
+0000edd0: 6769 7665 6e2e 2229 0a0a 2020 2020 636f  given.")..    co
+0000ede0: 6d6d 6f6e 5f64 696d 733a 2073 6574 5b48  mmon_dims: set[H
+0000edf0: 6173 6861 626c 655d 203d 2073 6574 2e69  ashable] = set.i
+0000ee00: 6e74 6572 7365 6374 696f 6e28 2a28 7365  ntersection(*(se
+0000ee10: 7428 6172 722e 6469 6d73 2920 666f 7220  t(arr.dims) for 
+0000ee20: 6172 7220 696e 2061 7272 6179 7329 290a  arr in arrays)).
+0000ee30: 2020 2020 616c 6c5f 6469 6d73 203d 205b      all_dims = [
+0000ee40: 5d0a 2020 2020 666f 7220 6172 7220 696e  ].    for arr in
+0000ee50: 2061 7272 6179 733a 0a20 2020 2020 2020   arrays:.       
+0000ee60: 2061 6c6c 5f64 696d 7320 2b3d 205b 6420   all_dims += [d 
+0000ee70: 666f 7220 6420 696e 2061 7272 2e64 696d  for d in arr.dim
+0000ee80: 7320 6966 2064 206e 6f74 2069 6e20 616c  s if d not in al
+0000ee90: 6c5f 6469 6d73 5d0a 0a20 2020 2065 696e  l_dims]..    ein
+0000eea0: 7375 6d5f 6178 6573 203d 2022 6162 6364  sum_axes = "abcd
+0000eeb0: 6566 6768 696a 6b6c 6d6e 6f70 7172 7374  efghijklmnopqrst
+0000eec0: 7576 7778 797a 220a 2020 2020 6469 6d5f  uvwxyz".    dim_
+0000eed0: 6d61 7020 3d20 7b64 3a20 6569 6e73 756d  map = {d: einsum
+0000eee0: 5f61 7865 735b 695d 2066 6f72 2069 2c20  _axes[i] for i, 
+0000eef0: 6420 696e 2065 6e75 6d65 7261 7465 2861  d in enumerate(a
+0000ef00: 6c6c 5f64 696d 7329 7d0a 0a20 2020 2069  ll_dims)}..    i
+0000ef10: 6620 6469 6d73 2069 7320 2e2e 2e3a 0a20  f dims is ...:. 
+0000ef20: 2020 2020 2020 2064 696d 7320 3d20 616c         dims = al
+0000ef30: 6c5f 6469 6d73 0a20 2020 2065 6c69 6620  l_dims.    elif 
+0000ef40: 6973 696e 7374 616e 6365 2864 696d 732c  isinstance(dims,
+0000ef50: 2073 7472 293a 0a20 2020 2020 2020 2064   str):.        d
+0000ef60: 696d 7320 3d20 2864 696d 732c 290a 2020  ims = (dims,).  
+0000ef70: 2020 656c 6966 2064 696d 7320 6973 204e    elif dims is N
+0000ef80: 6f6e 653a 0a20 2020 2020 2020 2023 2066  one:.        # f
+0000ef90: 696e 6420 6469 6d65 6e73 696f 6e73 2074  ind dimensions t
+0000efa0: 6861 7420 6f63 6375 7220 6d6f 7265 2074  hat occur more t
+0000efb0: 6861 6e20 6f6e 6520 7469 6d65 730a 2020  han one times.  
+0000efc0: 2020 2020 2020 6469 6d5f 636f 756e 7473        dim_counts
+0000efd0: 3a20 436f 756e 7465 7220 3d20 436f 756e  : Counter = Coun
+0000efe0: 7465 7228 290a 2020 2020 2020 2020 666f  ter().        fo
+0000eff0: 7220 6172 7220 696e 2061 7272 6179 733a  r arr in arrays:
+0000f000: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+0000f010: 5f63 6f75 6e74 732e 7570 6461 7465 2861  _counts.update(a
+0000f020: 7272 2e64 696d 7329 0a20 2020 2020 2020  rr.dims).       
+0000f030: 2064 696d 7320 3d20 7475 706c 6528 6420   dims = tuple(d 
+0000f040: 666f 7220 642c 2063 2069 6e20 6469 6d5f  for d, c in dim_
+0000f050: 636f 756e 7473 2e69 7465 6d73 2829 2069  counts.items() i
+0000f060: 6620 6320 3e20 3129 0a0a 2020 2020 646f  f c > 1)..    do
+0000f070: 745f 6469 6d73 3a20 7365 745b 4861 7368  t_dims: set[Hash
+0000f080: 6162 6c65 5d20 3d20 7365 7428 6469 6d73  able] = set(dims
+0000f090: 290a 0a20 2020 2023 2064 696d 656e 7369  )..    # dimensi
+0000f0a0: 6f6e 7320 746f 2062 6520 7061 7261 6c6c  ons to be parall
+0000f0b0: 656c 697a 6564 0a20 2020 2062 726f 6164  elized.    broad
+0000f0c0: 6361 7374 5f64 696d 7320 3d20 636f 6d6d  cast_dims = comm
+0000f0d0: 6f6e 5f64 696d 7320 2d20 646f 745f 6469  on_dims - dot_di
+0000f0e0: 6d73 0a20 2020 2069 6e70 7574 5f63 6f72  ms.    input_cor
+0000f0f0: 655f 6469 6d73 203d 205b 0a20 2020 2020  e_dims = [.     
+0000f100: 2020 205b 6420 666f 7220 6420 696e 2061     [d for d in a
+0000f110: 7272 2e64 696d 7320 6966 2064 206e 6f74  rr.dims if d not
+0000f120: 2069 6e20 6272 6f61 6463 6173 745f 6469   in broadcast_di
+0000f130: 6d73 5d20 666f 7220 6172 7220 696e 2061  ms] for arr in a
+0000f140: 7272 6179 730a 2020 2020 5d0a 2020 2020  rrays.    ].    
+0000f150: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
+0000f160: 203d 205b 0a20 2020 2020 2020 205b 6420   = [.        [d 
+0000f170: 666f 7220 6420 696e 2061 6c6c 5f64 696d  for d in all_dim
+0000f180: 7320 6966 2064 206e 6f74 2069 6e20 646f  s if d not in do
+0000f190: 745f 6469 6d73 2061 6e64 2064 206e 6f74  t_dims and d not
+0000f1a0: 2069 6e20 6272 6f61 6463 6173 745f 6469   in broadcast_di
+0000f1b0: 6d73 5d0a 2020 2020 5d0a 0a20 2020 2023  ms].    ]..    #
+0000f1c0: 2063 6f6e 7374 7275 6374 2065 696e 7375   construct einsu
+0000f1d0: 6d20 7375 6273 6372 6970 7473 2c20 7375  m subscripts, su
+0000f1e0: 6368 2061 7320 272e 2e2e 6162 632c 2e2e  ch as '...abc,..
+0000f1f0: 2e61 622d 3e2e 2e2e 6327 0a20 2020 2023  .ab->...c'.    #
+0000f200: 204e 6f74 653a 2069 6e70 7574 5f63 6f72   Note: input_cor
+0000f210: 655f 6469 6d73 2061 7265 2061 6c77 6179  e_dims are alway
+0000f220: 7320 6d6f 7665 6420 746f 2074 6865 206c  s moved to the l
+0000f230: 6173 7420 706f 7369 7469 6f6e 0a20 2020  ast position.   
+0000f240: 2073 7562 7363 7269 7074 735f 6c69 7374   subscripts_list
+0000f250: 203d 205b 0a20 2020 2020 2020 2022 2e2e   = [.        "..
+0000f260: 2e22 202b 2022 222e 6a6f 696e 2864 696d  ." + "".join(dim
+0000f270: 5f6d 6170 5b64 5d20 666f 7220 6420 696e  _map[d] for d in
+0000f280: 2064 7329 2066 6f72 2064 7320 696e 2069   ds) for ds in i
+0000f290: 6e70 7574 5f63 6f72 655f 6469 6d73 0a20  nput_core_dims. 
+0000f2a0: 2020 205d 0a20 2020 2073 7562 7363 7269     ].    subscri
+0000f2b0: 7074 7320 3d20 222c 222e 6a6f 696e 2873  pts = ",".join(s
+0000f2c0: 7562 7363 7269 7074 735f 6c69 7374 290a  ubscripts_list).
+0000f2d0: 2020 2020 7375 6273 6372 6970 7473 202b      subscripts +
+0000f2e0: 3d20 222d 3e2e 2e2e 2220 2b20 2222 2e6a  = "->..." + "".j
+0000f2f0: 6f69 6e28 6469 6d5f 6d61 705b 645d 2066  oin(dim_map[d] f
+0000f300: 6f72 2064 2069 6e20 6f75 7470 7574 5f63  or d in output_c
+0000f310: 6f72 655f 6469 6d73 5b30 5d29 0a0a 2020  ore_dims[0])..  
+0000f320: 2020 6a6f 696e 203d 204f 5054 494f 4e53    join = OPTIONS
+0000f330: 5b22 6172 6974 686d 6574 6963 5f6a 6f69  ["arithmetic_joi
+0000f340: 6e22 5d0a 2020 2020 2320 7573 696e 6720  n"].    # using 
+0000f350: 2269 6e6e 6572 2220 656d 756c 6174 6573  "inner" emulates
+0000f360: 2060 2861 202a 2062 292e 7375 6d28 2960   `(a * b).sum()`
+0000f370: 2066 6f72 2061 6c6c 206a 6f69 6e73 2028   for all joins (
+0000f380: 6578 6365 7074 2022 6578 6163 7422 290a  except "exact").
+0000f390: 2020 2020 6966 206a 6f69 6e20 213d 2022      if join != "
+0000f3a0: 6578 6163 7422 3a0a 2020 2020 2020 2020  exact":.        
+0000f3b0: 6a6f 696e 203d 2022 696e 6e65 7222 0a0a  join = "inner"..
+0000f3c0: 2020 2020 2320 7375 6273 6372 6970 7473      # subscripts
+0000f3d0: 2073 686f 756c 6420 6265 2070 6173 7365   should be passe
+0000f3e0: 6420 746f 206e 702e 6569 6e73 756d 2061  d to np.einsum a
+0000f3f0: 7320 6172 672c 206e 6f74 2061 7320 6b77  s arg, not as kw
+0000f400: 6172 6773 2e20 5765 206e 6565 640a 2020  args. We need.  
+0000f410: 2020 2320 746f 2063 6f6e 7374 7275 6374    # to construct
+0000f420: 2061 2070 6172 7469 616c 2066 756e 6374   a partial funct
+0000f430: 696f 6e20 666f 7220 6170 706c 795f 7566  ion for apply_uf
+0000f440: 756e 6320 746f 2077 6f72 6b2e 0a20 2020  unc to work..   
+0000f450: 2066 756e 6320 3d20 6675 6e63 746f 6f6c   func = functool
+0000f460: 732e 7061 7274 6961 6c28 6475 636b 5f61  s.partial(duck_a
+0000f470: 7272 6179 5f6f 7073 2e65 696e 7375 6d2c  rray_ops.einsum,
+0000f480: 2073 7562 7363 7269 7074 732c 202a 2a6b   subscripts, **k
+0000f490: 7761 7267 7329 0a20 2020 2072 6573 756c  wargs).    resul
+0000f4a0: 7420 3d20 6170 706c 795f 7566 756e 6328  t = apply_ufunc(
+0000f4b0: 0a20 2020 2020 2020 2066 756e 632c 0a20  .        func,. 
+0000f4c0: 2020 2020 2020 202a 6172 7261 7973 2c0a         *arrays,.
+0000f4d0: 2020 2020 2020 2020 696e 7075 745f 636f          input_co
+0000f4e0: 7265 5f64 696d 733d 696e 7075 745f 636f  re_dims=input_co
+0000f4f0: 7265 5f64 696d 732c 0a20 2020 2020 2020  re_dims,.       
+0000f500: 206f 7574 7075 745f 636f 7265 5f64 696d   output_core_dim
+0000f510: 733d 6f75 7470 7574 5f63 6f72 655f 6469  s=output_core_di
+0000f520: 6d73 2c0a 2020 2020 2020 2020 6a6f 696e  ms,.        join
+0000f530: 3d6a 6f69 6e2c 0a20 2020 2020 2020 2064  =join,.        d
+0000f540: 6173 6b3d 2261 6c6c 6f77 6564 222c 0a20  ask="allowed",. 
+0000f550: 2020 2029 0a20 2020 2072 6574 7572 6e20     ).    return 
+0000f560: 7265 7375 6c74 2e74 7261 6e73 706f 7365  result.transpose
+0000f570: 282a 616c 6c5f 6469 6d73 2c20 6d69 7373  (*all_dims, miss
+0000f580: 696e 675f 6469 6d73 3d22 6967 6e6f 7265  ing_dims="ignore
+0000f590: 2229 0a0a 0a64 6566 2077 6865 7265 2863  ")...def where(c
+0000f5a0: 6f6e 642c 2078 2c20 792c 206b 6565 705f  ond, x, y, keep_
+0000f5b0: 6174 7472 733d 4e6f 6e65 293a 0a20 2020  attrs=None):.   
+0000f5c0: 2022 2222 5265 7475 726e 2065 6c65 6d65   """Return eleme
+0000f5d0: 6e74 7320 6672 6f6d 2060 7860 206f 7220  nts from `x` or 
+0000f5e0: 6079 6020 6465 7065 6e64 696e 6720 6f6e  `y` depending on
+0000f5f0: 2060 636f 6e64 602e 0a0a 2020 2020 5065   `cond`...    Pe
+0000f600: 7266 6f72 6d73 2078 6172 7261 792d 6c69  rforms xarray-li
+0000f610: 6b65 2062 726f 6164 6361 7374 696e 6720  ke broadcasting 
+0000f620: 6163 726f 7373 2069 6e70 7574 2061 7267  across input arg
+0000f630: 756d 656e 7473 2e0a 0a20 2020 2041 6c6c  uments...    All
+0000f640: 2064 696d 656e 7369 6f6e 2063 6f6f 7264   dimension coord
+0000f650: 696e 6174 6573 206f 6e20 6078 6020 616e  inates on `x` an
+0000f660: 6420 6079 6020 206d 7573 7420 6265 2061  d `y`  must be a
+0000f670: 6c69 676e 6564 2077 6974 6820 6561 6368  ligned with each
+0000f680: 0a20 2020 206f 7468 6572 2061 6e64 2077  .    other and w
+0000f690: 6974 6820 6063 6f6e 6460 2e0a 0a20 2020  ith `cond`...   
+0000f6a0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+0000f6b0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2063  ----------.    c
+0000f6c0: 6f6e 6420 3a20 7363 616c 6172 2c20 6172  ond : scalar, ar
+0000f6d0: 7261 792c 2056 6172 6961 626c 652c 2044  ray, Variable, D
+0000f6e0: 6174 6141 7272 6179 206f 7220 4461 7461  ataArray or Data
+0000f6f0: 7365 740a 2020 2020 2020 2020 5768 656e  set.        When
+0000f700: 2054 7275 652c 2072 6574 7572 6e20 7661   True, return va
+0000f710: 6c75 6573 2066 726f 6d20 6078 602c 206f  lues from `x`, o
+0000f720: 7468 6572 7769 7365 2072 6574 7572 6e73  therwise returns
+0000f730: 2076 616c 7565 7320 6672 6f6d 2060 7960   values from `y`
+0000f740: 2e0a 2020 2020 7820 3a20 7363 616c 6172  ..    x : scalar
+0000f750: 2c20 6172 7261 792c 2056 6172 6961 626c  , array, Variabl
+0000f760: 652c 2044 6174 6141 7272 6179 206f 7220  e, DataArray or 
+0000f770: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
+0000f780: 7661 6c75 6573 2074 6f20 6368 6f6f 7365  values to choose
+0000f790: 2066 726f 6d20 7768 6572 6520 6063 6f6e   from where `con
+0000f7a0: 6460 2069 7320 5472 7565 0a20 2020 2079  d` is True.    y
+0000f7b0: 203a 2073 6361 6c61 722c 2061 7272 6179   : scalar, array
+0000f7c0: 2c20 5661 7269 6162 6c65 2c20 4461 7461  , Variable, Data
+0000f7d0: 4172 7261 7920 6f72 2044 6174 6173 6574  Array or Dataset
+0000f7e0: 0a20 2020 2020 2020 2076 616c 7565 7320  .        values 
+0000f7f0: 746f 2063 686f 6f73 6520 6672 6f6d 2077  to choose from w
+0000f800: 6865 7265 2060 636f 6e64 6020 6973 2046  here `cond` is F
+0000f810: 616c 7365 0a20 2020 206b 6565 705f 6174  alse.    keep_at
+0000f820: 7472 7320 3a20 626f 6f6c 206f 7220 7374  trs : bool or st
+0000f830: 7220 6f72 2063 616c 6c61 626c 652c 206f  r or callable, o
+0000f840: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0000f850: 486f 7720 746f 2074 7265 6174 2061 7474  How to treat att
+0000f860: 7273 2e20 4966 2054 7275 652c 206b 6565  rs. If True, kee
+0000f870: 7020 7468 6520 6174 7472 7320 6f66 2060  p the attrs of `
+0000f880: 7860 2e0a 0a20 2020 2052 6574 7572 6e73  x`...    Returns
+0000f890: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+0000f8a0: 2044 6174 6173 6574 2c20 4461 7461 4172   Dataset, DataAr
+0000f8b0: 7261 792c 2056 6172 6961 626c 6520 6f72  ray, Variable or
+0000f8c0: 2061 7272 6179 0a20 2020 2020 2020 2049   array.        I
+0000f8d0: 6e20 7072 696f 7269 7479 206f 7264 6572  n priority order
+0000f8e0: 3a20 4461 7461 7365 742c 2044 6174 6141  : Dataset, DataA
+0000f8f0: 7272 6179 2c20 5661 7269 6162 6c65 206f  rray, Variable o
+0000f900: 7220 6172 7261 792c 2077 6869 6368 6576  r array, whichev
+0000f910: 6572 0a20 2020 2020 2020 2074 7970 6520  er.        type 
+0000f920: 6170 7065 6172 7320 6173 2061 6e20 696e  appears as an in
+0000f930: 7075 7420 6172 6775 6d65 6e74 2e0a 0a20  put argument... 
+0000f940: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+0000f950: 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e  --------.    >>>
+0000f960: 2078 203d 2078 722e 4461 7461 4172 7261   x = xr.DataArra
+0000f970: 7928 0a20 2020 202e 2e2e 2020 2020 2030  y(.    ...     0
+0000f980: 2e31 202a 206e 702e 6172 616e 6765 2831  .1 * np.arange(1
+0000f990: 3029 2c0a 2020 2020 2e2e 2e20 2020 2020  0),.    ...     
+0000f9a0: 6469 6d73 3d5b 226c 6174 225d 2c0a 2020  dims=["lat"],.  
+0000f9b0: 2020 2e2e 2e20 2020 2020 636f 6f72 6473    ...     coords
+0000f9c0: 3d7b 226c 6174 223a 206e 702e 6172 616e  ={"lat": np.aran
+0000f9d0: 6765 2831 3029 7d2c 0a20 2020 202e 2e2e  ge(10)},.    ...
+0000f9e0: 2020 2020 206e 616d 653d 2273 7374 222c       name="sst",
+0000f9f0: 0a20 2020 202e 2e2e 2029 0a20 2020 203e  .    ... ).    >
+0000fa00: 3e3e 2078 0a20 2020 203c 7861 7272 6179  >> x.    <xarray
+0000fa10: 2e44 6174 6141 7272 6179 2027 7373 7427  .DataArray 'sst'
+0000fa20: 2028 6c61 743a 2031 3029 3e0a 2020 2020   (lat: 10)>.    
+0000fa30: 6172 7261 7928 5b30 2e20 2c20 302e 312c  array([0. , 0.1,
+0000fa40: 2030 2e32 2c20 302e 332c 2030 2e34 2c20   0.2, 0.3, 0.4, 
+0000fa50: 302e 352c 2030 2e36 2c20 302e 372c 2030  0.5, 0.6, 0.7, 0
+0000fa60: 2e38 2c20 302e 395d 290a 2020 2020 436f  .8, 0.9]).    Co
+0000fa70: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
+0000fa80: 202a 206c 6174 2020 2020 2020 286c 6174   * lat      (lat
+0000fa90: 2920 696e 7436 3420 3020 3120 3220 3320  ) int64 0 1 2 3 
+0000faa0: 3420 3520 3620 3720 3820 390a 0a20 2020  4 5 6 7 8 9..   
+0000fab0: 203e 3e3e 2078 722e 7768 6572 6528 7820   >>> xr.where(x 
+0000fac0: 3c20 302e 352c 2078 2c20 7820 2a20 3130  < 0.5, x, x * 10
+0000fad0: 3029 0a20 2020 203c 7861 7272 6179 2e44  0).    <xarray.D
+0000fae0: 6174 6141 7272 6179 2027 7373 7427 2028  ataArray 'sst' (
+0000faf0: 6c61 743a 2031 3029 3e0a 2020 2020 6172  lat: 10)>.    ar
+0000fb00: 7261 7928 5b20 302e 202c 2020 302e 312c  ray([ 0. ,  0.1,
+0000fb10: 2020 302e 322c 2020 302e 332c 2020 302e    0.2,  0.3,  0.
+0000fb20: 342c 2035 302e 202c 2036 302e 202c 2037  4, 50. , 60. , 7
+0000fb30: 302e 202c 2038 302e 202c 2039 302e 205d  0. , 80. , 90. ]
+0000fb40: 290a 2020 2020 436f 6f72 6469 6e61 7465  ).    Coordinate
+0000fb50: 733a 0a20 2020 2020 202a 206c 6174 2020  s:.      * lat  
+0000fb60: 2020 2020 286c 6174 2920 696e 7436 3420      (lat) int64 
+0000fb70: 3020 3120 3220 3320 3420 3520 3620 3720  0 1 2 3 4 5 6 7 
+0000fb80: 3820 390a 0a20 2020 203e 3e3e 2079 203d  8 9..    >>> y =
+0000fb90: 2078 722e 4461 7461 4172 7261 7928 0a20   xr.DataArray(. 
+0000fba0: 2020 202e 2e2e 2020 2020 2030 2e31 202a     ...     0.1 *
+0000fbb0: 206e 702e 6172 616e 6765 2839 292e 7265   np.arange(9).re
+0000fbc0: 7368 6170 6528 332c 2033 292c 0a20 2020  shape(3, 3),.   
+0000fbd0: 202e 2e2e 2020 2020 2064 696d 733d 5b22   ...     dims=["
+0000fbe0: 6c61 7422 2c20 226c 6f6e 225d 2c0a 2020  lat", "lon"],.  
+0000fbf0: 2020 2e2e 2e20 2020 2020 636f 6f72 6473    ...     coords
+0000fc00: 3d7b 226c 6174 223a 206e 702e 6172 616e  ={"lat": np.aran
+0000fc10: 6765 2833 292c 2022 6c6f 6e22 3a20 3130  ge(3), "lon": 10
+0000fc20: 202b 206e 702e 6172 616e 6765 2833 297d   + np.arange(3)}
+0000fc30: 2c0a 2020 2020 2e2e 2e20 2020 2020 6e61  ,.    ...     na
+0000fc40: 6d65 3d22 7373 7422 2c0a 2020 2020 2e2e  me="sst",.    ..
+0000fc50: 2e20 290a 2020 2020 3e3e 3e20 790a 2020  . ).    >>> y.  
+0000fc60: 2020 3c78 6172 7261 792e 4461 7461 4172    <xarray.DataAr
+0000fc70: 7261 7920 2773 7374 2720 286c 6174 3a20  ray 'sst' (lat: 
+0000fc80: 332c 206c 6f6e 3a20 3329 3e0a 2020 2020  3, lon: 3)>.    
+0000fc90: 6172 7261 7928 5b5b 302e 202c 2030 2e31  array([[0. , 0.1
+0000fca0: 2c20 302e 325d 2c0a 2020 2020 2020 2020  , 0.2],.        
+0000fcb0: 2020 205b 302e 332c 2030 2e34 2c20 302e     [0.3, 0.4, 0.
+0000fcc0: 355d 2c0a 2020 2020 2020 2020 2020 205b  5],.           [
+0000fcd0: 302e 362c 2030 2e37 2c20 302e 385d 5d29  0.6, 0.7, 0.8]])
+0000fce0: 0a20 2020 2043 6f6f 7264 696e 6174 6573  .    Coordinates
+0000fcf0: 3a0a 2020 2020 2020 2a20 6c61 7420 2020  :.      * lat   
+0000fd00: 2020 2028 6c61 7429 2069 6e74 3634 2030     (lat) int64 0
+0000fd10: 2031 2032 0a20 2020 2020 202a 206c 6f6e   1 2.      * lon
+0000fd20: 2020 2020 2020 286c 6f6e 2920 696e 7436        (lon) int6
+0000fd30: 3420 3130 2031 3120 3132 0a0a 2020 2020  4 10 11 12..    
+0000fd40: 3e3e 3e20 7872 2e77 6865 7265 2879 2e6c  >>> xr.where(y.l
+0000fd50: 6174 203c 2031 2c20 792c 202d 3129 0a20  at < 1, y, -1). 
+0000fd60: 2020 203c 7861 7272 6179 2e44 6174 6141     <xarray.DataA
+0000fd70: 7272 6179 2028 6c61 743a 2033 2c20 6c6f  rray (lat: 3, lo
+0000fd80: 6e3a 2033 293e 0a20 2020 2061 7272 6179  n: 3)>.    array
+0000fd90: 285b 5b20 302e 202c 2020 302e 312c 2020  ([[ 0. ,  0.1,  
+0000fda0: 302e 325d 2c0a 2020 2020 2020 2020 2020  0.2],.          
+0000fdb0: 205b 2d31 2e20 2c20 2d31 2e20 2c20 2d31   [-1. , -1. , -1
+0000fdc0: 2e20 5d2c 0a20 2020 2020 2020 2020 2020  . ],.           
+0000fdd0: 5b2d 312e 202c 202d 312e 202c 202d 312e  [-1. , -1. , -1.
+0000fde0: 205d 5d29 0a20 2020 2043 6f6f 7264 696e   ]]).    Coordin
+0000fdf0: 6174 6573 3a0a 2020 2020 2020 2a20 6c61  ates:.      * la
+0000fe00: 7420 2020 2020 2028 6c61 7429 2069 6e74  t      (lat) int
+0000fe10: 3634 2030 2031 2032 0a20 2020 2020 202a  64 0 1 2.      *
+0000fe20: 206c 6f6e 2020 2020 2020 286c 6f6e 2920   lon      (lon) 
+0000fe30: 696e 7436 3420 3130 2031 3120 3132 0a0a  int64 10 11 12..
+0000fe40: 2020 2020 3e3e 3e20 636f 6e64 203d 2078      >>> cond = x
+0000fe50: 722e 4461 7461 4172 7261 7928 5b54 7275  r.DataArray([Tru
+0000fe60: 652c 2046 616c 7365 5d2c 2064 696d 733d  e, False], dims=
+0000fe70: 5b22 7822 5d29 0a20 2020 203e 3e3e 2078  ["x"]).    >>> x
+0000fe80: 203d 2078 722e 4461 7461 4172 7261 7928   = xr.DataArray(
+0000fe90: 5b31 2c20 325d 2c20 6469 6d73 3d5b 2279  [1, 2], dims=["y
+0000fea0: 225d 290a 2020 2020 3e3e 3e20 7872 2e77  "]).    >>> xr.w
+0000feb0: 6865 7265 2863 6f6e 642c 2078 2c20 3029  here(cond, x, 0)
+0000fec0: 0a20 2020 203c 7861 7272 6179 2e44 6174  .    <xarray.Dat
+0000fed0: 6141 7272 6179 2028 783a 2032 2c20 793a  aArray (x: 2, y:
+0000fee0: 2032 293e 0a20 2020 2061 7272 6179 285b   2)>.    array([
+0000fef0: 5b31 2c20 325d 2c0a 2020 2020 2020 2020  [1, 2],.        
+0000ff00: 2020 205b 302c 2030 5d5d 290a 2020 2020     [0, 0]]).    
+0000ff10: 4469 6d65 6e73 696f 6e73 2077 6974 686f  Dimensions witho
+0000ff20: 7574 2063 6f6f 7264 696e 6174 6573 3a20  ut coordinates: 
+0000ff30: 782c 2079 0a0a 2020 2020 5365 6520 416c  x, y..    See Al
+0000ff40: 736f 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  so.    --------.
+0000ff50: 2020 2020 6e75 6d70 792e 7768 6572 6520      numpy.where 
+0000ff60: 3a20 636f 7272 6573 706f 6e64 696e 6720  : corresponding 
+0000ff70: 6e75 6d70 7920 6675 6e63 7469 6f6e 0a20  numpy function. 
+0000ff80: 2020 2044 6174 6173 6574 2e77 6865 7265     Dataset.where
+0000ff90: 2c20 4461 7461 4172 7261 792e 7768 6572  , DataArray.wher
+0000ffa0: 6520 3a0a 2020 2020 2020 2020 6571 7569  e :.        equi
+0000ffb0: 7661 6c65 6e74 206d 6574 686f 6473 0a20  valent methods. 
+0000ffc0: 2020 2022 2222 0a20 2020 2066 726f 6d20     """.    from 
+0000ffd0: 7861 7272 6179 2e63 6f72 652e 6461 7461  xarray.core.data
+0000ffe0: 7365 7420 696d 706f 7274 2044 6174 6173  set import Datas
+0000fff0: 6574 0a0a 2020 2020 6966 206b 6565 705f  et..    if keep_
+00010000: 6174 7472 7320 6973 204e 6f6e 653a 0a20  attrs is None:. 
+00010010: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
+00010020: 7320 3d20 5f67 6574 5f6b 6565 705f 6174  s = _get_keep_at
+00010030: 7472 7328 6465 6661 756c 743d 4661 6c73  trs(default=Fals
+00010040: 6529 0a0a 2020 2020 2320 616c 6967 6e6d  e)..    # alignm
+00010050: 656e 7420 666f 7220 7468 7265 6520 6172  ent for three ar
+00010060: 6775 6d65 6e74 7320 6973 2063 6f6d 706c  guments is compl
+00010070: 6963 6174 6564 2c20 736f 2064 6f6e 2774  icated, so don't
+00010080: 2073 7570 706f 7274 2069 7420 7965 740a   support it yet.
+00010090: 2020 2020 7265 7375 6c74 203d 2061 7070      result = app
+000100a0: 6c79 5f75 6675 6e63 280a 2020 2020 2020  ly_ufunc(.      
+000100b0: 2020 6475 636b 5f61 7272 6179 5f6f 7073    duck_array_ops
+000100c0: 2e77 6865 7265 2c0a 2020 2020 2020 2020  .where,.        
+000100d0: 636f 6e64 2c0a 2020 2020 2020 2020 782c  cond,.        x,
+000100e0: 0a20 2020 2020 2020 2079 2c0a 2020 2020  .        y,.    
+000100f0: 2020 2020 6a6f 696e 3d22 6578 6163 7422      join="exact"
+00010100: 2c0a 2020 2020 2020 2020 6461 7461 7365  ,.        datase
+00010110: 745f 6a6f 696e 3d22 6578 6163 7422 2c0a  t_join="exact",.
+00010120: 2020 2020 2020 2020 6461 736b 3d22 616c          dask="al
+00010130: 6c6f 7765 6422 2c0a 2020 2020 2020 2020  lowed",.        
+00010140: 6b65 6570 5f61 7474 7273 3d6b 6565 705f  keep_attrs=keep_
+00010150: 6174 7472 732c 0a20 2020 2029 0a0a 2020  attrs,.    )..  
+00010160: 2020 2320 6b65 6570 2074 6865 2061 7474    # keep the att
+00010170: 7269 6275 7465 7320 6f66 2078 2c20 7468  ributes of x, th
+00010180: 6520 7365 636f 6e64 2070 6172 616d 6574  e second paramet
+00010190: 6572 2c20 6279 2064 6566 6175 6c74 2074  er, by default t
+000101a0: 6f0a 2020 2020 2320 6265 2063 6f6e 7369  o.    # be consi
+000101b0: 7374 656e 7420 7769 7468 2074 6865 2060  stent with the `
+000101c0: 7768 6572 6560 206d 6574 686f 6420 6f66  where` method of
+000101d0: 2060 4461 7461 4172 7261 7960 2061 6e64   `DataArray` and
+000101e0: 2060 4461 7461 7365 7460 0a20 2020 2023   `Dataset`.    #
+000101f0: 2072 6562 7569 6c64 2074 6865 2061 7474   rebuild the att
+00010200: 7273 2066 726f 6d20 7820 6174 2065 6163  rs from x at eac
+00010210: 6820 6c65 7665 6c20 6f66 2074 6865 206f  h level of the o
+00010220: 7574 7075 742c 2077 6869 6368 2063 6f75  utput, which cou
+00010230: 6c64 2062 650a 2020 2020 2320 4461 7461  ld be.    # Data
+00010240: 7365 742c 2044 6174 6141 7272 6179 2c20  set, DataArray, 
+00010250: 6f72 2056 6172 6961 626c 652c 2061 6e64  or Variable, and
+00010260: 2061 6c73 6f20 6861 6e64 6c65 2063 6f6f   also handle coo
+00010270: 7264 730a 2020 2020 6966 206b 6565 705f  rds.    if keep_
+00010280: 6174 7472 7320 6973 2054 7275 6520 616e  attrs is True an
+00010290: 6420 6861 7361 7474 7228 7265 7375 6c74  d hasattr(result
+000102a0: 2c20 2261 7474 7273 2229 3a0a 2020 2020  , "attrs"):.    
+000102b0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+000102c0: 6528 792c 2044 6174 6173 6574 2920 616e  e(y, Dataset) an
+000102d0: 6420 6e6f 7420 6973 696e 7374 616e 6365  d not isinstance
+000102e0: 2878 2c20 4461 7461 7365 7429 3a0a 2020  (x, Dataset):.  
+000102f0: 2020 2020 2020 2020 2020 2320 6861 6e64            # hand
+00010300: 6c65 2073 7065 6369 616c 2063 6173 6520  le special case 
+00010310: 7768 6572 6520 7820 6765 7473 2070 726f  where x gets pro
+00010320: 6d6f 7465 6420 746f 2044 6174 6173 6574  moted to Dataset
+00010330: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00010340: 756c 742e 6174 7472 7320 3d20 7b7d 0a20  ult.attrs = {}. 
+00010350: 2020 2020 2020 2020 2020 2069 6620 6765             if ge
+00010360: 7461 7474 7228 782c 2022 6e61 6d65 222c  tattr(x, "name",
+00010370: 204e 6f6e 6529 2069 6e20 7265 7375 6c74   None) in result
+00010380: 2e64 6174 615f 7661 7273 3a0a 2020 2020  .data_vars:.    
+00010390: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+000103a0: 6c74 5b78 2e6e 616d 655d 2e61 7474 7273  lt[x.name].attrs
+000103b0: 203d 2067 6574 6174 7472 2878 2c20 2261   = getattr(x, "a
+000103c0: 7474 7273 222c 207b 7d29 0a20 2020 2020  ttrs", {}).     
+000103d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000103e0: 2020 2020 2023 206f 7468 6572 7769 7365       # otherwise
+000103f0: 2c20 6669 6c6c 2069 6e20 676c 6f62 616c  , fill in global
+00010400: 2061 7474 7273 2061 6e64 2076 6172 6961   attrs and varia
+00010410: 626c 6520 6174 7472 7320 2869 6620 7468  ble attrs (if th
+00010420: 6579 2065 7869 7374 290a 2020 2020 2020  ey exist).      
+00010430: 2020 2020 2020 7265 7375 6c74 2e61 7474        result.att
+00010440: 7273 203d 2067 6574 6174 7472 2878 2c20  rs = getattr(x, 
+00010450: 2261 7474 7273 222c 207b 7d29 0a20 2020  "attrs", {}).   
+00010460: 2020 2020 2020 2020 2066 6f72 2076 2069           for v i
+00010470: 6e20 6765 7461 7474 7228 7265 7375 6c74  n getattr(result
+00010480: 2c20 2264 6174 615f 7661 7273 222c 205b  , "data_vars", [
+00010490: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+000104a0: 2020 2020 7265 7375 6c74 5b76 5d2e 6174      result[v].at
+000104b0: 7472 7320 3d20 6765 7461 7474 7228 6765  trs = getattr(ge
+000104c0: 7461 7474 7228 782c 2076 2c20 4e6f 6e65  tattr(x, v, None
+000104d0: 292c 2022 6174 7472 7322 2c20 7b7d 290a  ), "attrs", {}).
+000104e0: 2020 2020 2020 2020 666f 7220 6320 696e          for c in
+000104f0: 2067 6574 6174 7472 2872 6573 756c 742c   getattr(result,
+00010500: 2022 636f 6f72 6473 222c 205b 5d29 3a0a   "coords", []):.
+00010510: 2020 2020 2020 2020 2020 2020 2320 616c              # al
+00010520: 7761 7973 2066 696c 6c20 636f 6f72 6420  ways fill coord 
+00010530: 6174 7472 7320 6f66 2078 0a20 2020 2020  attrs of x.     
+00010540: 2020 2020 2020 2072 6573 756c 745b 635d         result[c]
+00010550: 2e61 7474 7273 203d 2067 6574 6174 7472  .attrs = getattr
+00010560: 2867 6574 6174 7472 2878 2c20 632c 204e  (getattr(x, c, N
+00010570: 6f6e 6529 2c20 2261 7474 7273 222c 207b  one), "attrs", {
+00010580: 7d29 0a0a 2020 2020 7265 7475 726e 2072  })..    return r
+00010590: 6573 756c 740a 0a0a 406f 7665 726c 6f61  esult...@overloa
+000105a0: 640a 6465 6620 706f 6c79 7661 6c28 0a20  d.def polyval(. 
+000105b0: 2020 2063 6f6f 7264 3a20 4461 7461 4172     coord: DataAr
+000105c0: 7261 792c 2063 6f65 6666 733a 2044 6174  ray, coeffs: Dat
+000105d0: 6141 7272 6179 2c20 6465 6772 6565 5f64  aArray, degree_d
+000105e0: 696d 3a20 4861 7368 6162 6c65 203d 2022  im: Hashable = "
+000105f0: 6465 6772 6565 220a 2920 2d3e 2044 6174  degree".) -> Dat
+00010600: 6141 7272 6179 3a0a 2020 2020 2e2e 2e0a  aArray:.    ....
+00010610: 0a0a 406f 7665 726c 6f61 640a 6465 6620  ..@overload.def 
+00010620: 706f 6c79 7661 6c28 0a20 2020 2063 6f6f  polyval(.    coo
+00010630: 7264 3a20 4461 7461 4172 7261 792c 2063  rd: DataArray, c
+00010640: 6f65 6666 733a 2044 6174 6173 6574 2c20  oeffs: Dataset, 
+00010650: 6465 6772 6565 5f64 696d 3a20 4861 7368  degree_dim: Hash
+00010660: 6162 6c65 203d 2022 6465 6772 6565 220a  able = "degree".
+00010670: 2920 2d3e 2044 6174 6173 6574 3a0a 2020  ) -> Dataset:.  
+00010680: 2020 2e2e 2e0a 0a0a 406f 7665 726c 6f61    ......@overloa
+00010690: 640a 6465 6620 706f 6c79 7661 6c28 0a20  d.def polyval(. 
+000106a0: 2020 2063 6f6f 7264 3a20 4461 7461 7365     coord: Datase
+000106b0: 742c 2063 6f65 6666 733a 2044 6174 6141  t, coeffs: DataA
+000106c0: 7272 6179 2c20 6465 6772 6565 5f64 696d  rray, degree_dim
+000106d0: 3a20 4861 7368 6162 6c65 203d 2022 6465  : Hashable = "de
+000106e0: 6772 6565 220a 2920 2d3e 2044 6174 6173  gree".) -> Datas
+000106f0: 6574 3a0a 2020 2020 2e2e 2e0a 0a0a 406f  et:.    ......@o
+00010700: 7665 726c 6f61 640a 6465 6620 706f 6c79  verload.def poly
+00010710: 7661 6c28 0a20 2020 2063 6f6f 7264 3a20  val(.    coord: 
+00010720: 4461 7461 7365 742c 2063 6f65 6666 733a  Dataset, coeffs:
+00010730: 2044 6174 6173 6574 2c20 6465 6772 6565   Dataset, degree
+00010740: 5f64 696d 3a20 4861 7368 6162 6c65 203d  _dim: Hashable =
+00010750: 2022 6465 6772 6565 220a 2920 2d3e 2044   "degree".) -> D
+00010760: 6174 6173 6574 3a0a 2020 2020 2e2e 2e0a  ataset:.    ....
+00010770: 0a0a 406f 7665 726c 6f61 640a 6465 6620  ..@overload.def 
+00010780: 706f 6c79 7661 6c28 0a20 2020 2063 6f6f  polyval(.    coo
+00010790: 7264 3a20 4461 7461 7365 7420 7c20 4461  rd: Dataset | Da
+000107a0: 7461 4172 7261 792c 0a20 2020 2063 6f65  taArray,.    coe
+000107b0: 6666 733a 2044 6174 6173 6574 207c 2044  ffs: Dataset | D
+000107c0: 6174 6141 7272 6179 2c0a 2020 2020 6465  ataArray,.    de
+000107d0: 6772 6565 5f64 696d 3a20 4861 7368 6162  gree_dim: Hashab
+000107e0: 6c65 203d 2022 6465 6772 6565 222c 0a29  le = "degree",.)
+000107f0: 202d 3e20 4461 7461 7365 7420 7c20 4461   -> Dataset | Da
+00010800: 7461 4172 7261 793a 0a20 2020 202e 2e2e  taArray:.    ...
+00010810: 0a0a 0a64 6566 2070 6f6c 7976 616c 280a  ...def polyval(.
+00010820: 2020 2020 636f 6f72 643a 2044 6174 6173      coord: Datas
+00010830: 6574 207c 2044 6174 6141 7272 6179 2c0a  et | DataArray,.
+00010840: 2020 2020 636f 6566 6673 3a20 4461 7461      coeffs: Data
+00010850: 7365 7420 7c20 4461 7461 4172 7261 792c  set | DataArray,
+00010860: 0a20 2020 2064 6567 7265 655f 6469 6d3a  .    degree_dim:
+00010870: 2048 6173 6861 626c 6520 3d20 2264 6567   Hashable = "deg
+00010880: 7265 6522 2c0a 2920 2d3e 2044 6174 6173  ree",.) -> Datas
+00010890: 6574 207c 2044 6174 6141 7272 6179 3a0a  et | DataArray:.
+000108a0: 2020 2020 2222 2245 7661 6c75 6174 6520      """Evaluate 
+000108b0: 6120 706f 6c79 6e6f 6d69 616c 2061 7420  a polynomial at 
+000108c0: 7370 6563 6966 6963 2076 616c 7565 730a  specific values.
+000108d0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+000108e0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+000108f0: 2020 2063 6f6f 7264 203a 2044 6174 6141     coord : DataA
+00010900: 7272 6179 206f 7220 4461 7461 7365 740a  rray or Dataset.
+00010910: 2020 2020 2020 2020 5661 6c75 6573 2061          Values a
+00010920: 7420 7768 6963 6820 746f 2065 7661 6c75  t which to evalu
+00010930: 6174 6520 7468 6520 706f 6c79 6e6f 6d69  ate the polynomi
+00010940: 616c 2e0a 2020 2020 636f 6566 6673 203a  al..    coeffs :
+00010950: 2044 6174 6141 7272 6179 206f 7220 4461   DataArray or Da
+00010960: 7461 7365 740a 2020 2020 2020 2020 436f  taset.        Co
+00010970: 6566 6669 6369 656e 7473 206f 6620 7468  efficients of th
+00010980: 6520 706f 6c79 6e6f 6d69 616c 2e0a 2020  e polynomial..  
+00010990: 2020 6465 6772 6565 5f64 696d 203a 2048    degree_dim : H
+000109a0: 6173 6861 626c 652c 2064 6566 6175 6c74  ashable, default
+000109b0: 3a20 2264 6567 7265 6522 0a20 2020 2020  : "degree".     
+000109c0: 2020 204e 616d 6520 6f66 2074 6865 2070     Name of the p
+000109d0: 6f6c 796e 6f6d 6961 6c20 6465 6772 6565  olynomial degree
+000109e0: 2064 696d 656e 7369 6f6e 2069 6e20 6063   dimension in `c
+000109f0: 6f65 6666 7360 2e0a 0a20 2020 2052 6574  oeffs`...    Ret
+00010a00: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+00010a10: 0a20 2020 2044 6174 6141 7272 6179 206f  .    DataArray o
+00010a20: 7220 4461 7461 7365 740a 2020 2020 2020  r Dataset.      
+00010a30: 2020 4576 616c 7561 7465 6420 706f 6c79    Evaluated poly
+00010a40: 6e6f 6d69 616c 2e0a 0a20 2020 2053 6565  nomial...    See
+00010a50: 2041 6c73 6f0a 2020 2020 2d2d 2d2d 2d2d   Also.    ------
+00010a60: 2d2d 0a20 2020 2078 6172 7261 792e 4461  --.    xarray.Da
+00010a70: 7461 4172 7261 792e 706f 6c79 6669 740a  taArray.polyfit.
+00010a80: 2020 2020 6e75 6d70 792e 706f 6c79 6e6f      numpy.polyno
+00010a90: 6d69 616c 2e70 6f6c 796e 6f6d 6961 6c2e  mial.polynomial.
+00010aa0: 706f 6c79 7661 6c0a 2020 2020 2222 220a  polyval.    """.
+00010ab0: 0a20 2020 2069 6620 6465 6772 6565 5f64  .    if degree_d
+00010ac0: 696d 206e 6f74 2069 6e20 636f 6566 6673  im not in coeffs
+00010ad0: 2e5f 696e 6465 7865 733a 0a20 2020 2020  ._indexes:.     
+00010ae0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00010af0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00010b00: 2066 2244 696d 656e 7369 6f6e 2060 7b64   f"Dimension `{d
+00010b10: 6567 7265 655f 6469 6d7d 6020 7368 6f75  egree_dim}` shou
+00010b20: 6c64 2062 6520 6120 636f 6f72 6469 6e61  ld be a coordina
+00010b30: 7465 2076 6172 6961 626c 6520 7769 7468  te variable with
+00010b40: 206c 6162 656c 732e 220a 2020 2020 2020   labels.".      
+00010b50: 2020 290a 2020 2020 6966 206e 6f74 206e    ).    if not n
+00010b60: 702e 6973 7375 6264 7479 7065 2863 6f65  p.issubdtype(coe
+00010b70: 6666 735b 6465 6772 6565 5f64 696d 5d2e  ffs[degree_dim].
+00010b80: 6474 7970 652c 206e 702e 696e 7465 6765  dtype, np.intege
+00010b90: 7229 3a0a 2020 2020 2020 2020 7261 6973  r):.        rais
+00010ba0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00010bb0: 2020 2020 2020 2020 2020 6622 4469 6d65            f"Dime
+00010bc0: 6e73 696f 6e20 607b 6465 6772 6565 5f64  nsion `{degree_d
+00010bd0: 696d 7d60 2073 686f 756c 6420 6265 206f  im}` should be o
+00010be0: 6620 696e 7465 6765 7220 6474 7970 652e  f integer dtype.
+00010bf0: 2052 6563 6569 7665 6420 7b63 6f65 6666   Received {coeff
+00010c00: 735b 6465 6772 6565 5f64 696d 5d2e 6474  s[degree_dim].dt
+00010c10: 7970 657d 2069 6e73 7465 6164 2e22 0a20  ype} instead.". 
+00010c20: 2020 2020 2020 2029 0a20 2020 206d 6178         ).    max
+00010c30: 5f64 6567 203d 2063 6f65 6666 735b 6465  _deg = coeffs[de
+00010c40: 6772 6565 5f64 696d 5d2e 6d61 7828 292e  gree_dim].max().
+00010c50: 6974 656d 2829 0a20 2020 2063 6f65 6666  item().    coeff
+00010c60: 7320 3d20 636f 6566 6673 2e72 6569 6e64  s = coeffs.reind
+00010c70: 6578 280a 2020 2020 2020 2020 7b64 6567  ex(.        {deg
+00010c80: 7265 655f 6469 6d3a 206e 702e 6172 616e  ree_dim: np.aran
+00010c90: 6765 286d 6178 5f64 6567 202b 2031 297d  ge(max_deg + 1)}
+00010ca0: 2c20 6669 6c6c 5f76 616c 7565 3d30 2c20  , fill_value=0, 
+00010cb0: 636f 7079 3d46 616c 7365 0a20 2020 2029  copy=False.    )
+00010cc0: 0a20 2020 2063 6f6f 7264 203d 205f 656e  .    coord = _en
+00010cd0: 7375 7265 5f6e 756d 6572 6963 2863 6f6f  sure_numeric(coo
+00010ce0: 7264 290a 0a20 2020 2023 2075 7369 6e67  rd)..    # using
+00010cf0: 2048 6f72 6e65 7227 7320 6d65 7468 6f64   Horner's method
+00010d00: 0a20 2020 2023 2068 7474 7073 3a2f 2f65  .    # https://e
+00010d10: 6e2e 7769 6b69 7065 6469 612e 6f72 672f  n.wikipedia.org/
+00010d20: 7769 6b69 2f48 6f72 6e65 7225 3237 735f  wiki/Horner%27s_
+00010d30: 6d65 7468 6f64 0a20 2020 2072 6573 203d  method.    res =
+00010d40: 207a 6572 6f73 5f6c 696b 6528 636f 6f72   zeros_like(coor
+00010d50: 6429 202b 2063 6f65 6666 732e 6973 656c  d) + coeffs.isel
+00010d60: 287b 6465 6772 6565 5f64 696d 3a20 6d61  ({degree_dim: ma
+00010d70: 785f 6465 677d 2c20 6472 6f70 3d54 7275  x_deg}, drop=Tru
+00010d80: 6529 0a20 2020 2066 6f72 2064 6567 2069  e).    for deg i
+00010d90: 6e20 7261 6e67 6528 6d61 785f 6465 6720  n range(max_deg 
+00010da0: 2d20 312c 202d 312c 202d 3129 3a0a 2020  - 1, -1, -1):.  
+00010db0: 2020 2020 2020 7265 7320 2a3d 2063 6f6f        res *= coo
+00010dc0: 7264 0a20 2020 2020 2020 2072 6573 202b  rd.        res +
+00010dd0: 3d20 636f 6566 6673 2e69 7365 6c28 7b64  = coeffs.isel({d
+00010de0: 6567 7265 655f 6469 6d3a 2064 6567 7d2c  egree_dim: deg},
+00010df0: 2064 726f 703d 5472 7565 290a 0a20 2020   drop=True)..   
+00010e00: 2072 6574 7572 6e20 7265 730a 0a0a 6465   return res...de
+00010e10: 6620 5f65 6e73 7572 655f 6e75 6d65 7269  f _ensure_numeri
+00010e20: 6328 6461 7461 3a20 4461 7461 7365 7420  c(data: Dataset 
+00010e30: 7c20 4461 7461 4172 7261 7929 202d 3e20  | DataArray) -> 
+00010e40: 4461 7461 7365 7420 7c20 4461 7461 4172  Dataset | DataAr
+00010e50: 7261 793a 0a20 2020 2022 2222 436f 6e76  ray:.    """Conv
+00010e60: 6572 7473 2061 6c6c 2064 6174 6574 696d  erts all datetim
+00010e70: 6536 3420 7661 7269 6162 6c65 7320 746f  e64 variables to
+00010e80: 2066 6c6f 6174 3634 0a0a 2020 2020 5061   float64..    Pa
+00010e90: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+00010ea0: 2d2d 2d2d 2d2d 2d0a 2020 2020 6461 7461  -------.    data
+00010eb0: 203a 2044 6174 6141 7272 6179 206f 7220   : DataArray or 
+00010ec0: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
+00010ed0: 5661 7269 6162 6c65 7320 7769 7468 2070  Variables with p
+00010ee0: 6f73 7369 626c 6520 6461 7465 7469 6d65  ossible datetime
+00010ef0: 2064 7479 7065 732e 0a0a 2020 2020 5265   dtypes...    Re
+00010f00: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00010f10: 2d0a 2020 2020 4461 7461 4172 7261 7920  -.    DataArray 
+00010f20: 6f72 2044 6174 6173 6574 0a20 2020 2020  or Dataset.     
+00010f30: 2020 2056 6172 6961 626c 6573 2077 6974     Variables wit
+00010f40: 6820 6461 7465 7469 6d65 3634 2064 7479  h datetime64 dty
+00010f50: 7065 7320 636f 6e76 6572 7465 6420 746f  pes converted to
+00010f60: 2066 6c6f 6174 3634 2e0a 2020 2020 2222   float64..    ""
+00010f70: 220a 2020 2020 6672 6f6d 2078 6172 7261  ".    from xarra
+00010f80: 792e 636f 7265 2e64 6174 6173 6574 2069  y.core.dataset i
+00010f90: 6d70 6f72 7420 4461 7461 7365 740a 0a20  mport Dataset.. 
+00010fa0: 2020 2064 6566 205f 6366 6f66 6673 6574     def _cfoffset
+00010fb0: 2878 3a20 4461 7461 4172 7261 7929 202d  (x: DataArray) -
+00010fc0: 3e20 416e 793a 0a20 2020 2020 2020 2073  > Any:.        s
+00010fd0: 6361 6c61 7220 3d20 782e 636f 6d70 7574  calar = x.comput
+00010fe0: 6528 292e 6461 7461 5b30 5d0a 2020 2020  e().data[0].    
+00010ff0: 2020 2020 6966 206e 6f74 2069 735f 7363      if not is_sc
+00011000: 616c 6172 2873 6361 6c61 7229 3a0a 2020  alar(scalar):.  
+00011010: 2020 2020 2020 2020 2020 2320 7765 2064            # we d
+00011020: 6f20 6e6f 7420 6765 7420 6120 7363 616c  o not get a scal
+00011030: 6172 2062 6163 6b20 6f6e 2064 6173 6b20  ar back on dask 
+00011040: 3d3d 2032 3032 312e 3034 2e31 0a20 2020  == 2021.04.1.   
+00011050: 2020 2020 2020 2020 2073 6361 6c61 7220           scalar 
+00011060: 3d20 7363 616c 6172 2e69 7465 6d28 290a  = scalar.item().
+00011070: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+00011080: 7970 6528 7363 616c 6172 2928 3139 3730  ype(scalar)(1970
+00011090: 2c20 312c 2031 290a 0a20 2020 2064 6566  , 1, 1)..    def
+000110a0: 2074 6f5f 666c 6f61 7461 626c 6528 783a   to_floatable(x:
+000110b0: 2044 6174 6141 7272 6179 2920 2d3e 2044   DataArray) -> D
+000110c0: 6174 6141 7272 6179 3a0a 2020 2020 2020  ataArray:.      
+000110d0: 2020 6966 2078 2e64 7479 7065 2e6b 696e    if x.dtype.kin
+000110e0: 6420 696e 2022 4d4f 223a 0a20 2020 2020  d in "MO":.     
+000110f0: 2020 2020 2020 2023 2064 6174 6574 696d         # datetim
+00011100: 6573 2028 4346 496e 6465 7865 7320 6172  es (CFIndexes ar
+00011110: 6520 6f62 6a65 6374 2074 7970 6529 0a20  e object type). 
+00011120: 2020 2020 2020 2020 2020 206f 6666 7365             offse
+00011130: 7420 3d20 280a 2020 2020 2020 2020 2020  t = (.          
+00011140: 2020 2020 2020 6e70 2e64 6174 6574 696d        np.datetim
+00011150: 6536 3428 2231 3937 302d 3031 2d30 3122  e64("1970-01-01"
+00011160: 2920 6966 2078 2e64 7479 7065 2e6b 696e  ) if x.dtype.kin
+00011170: 6420 3d3d 2022 4d22 2065 6c73 6520 5f63  d == "M" else _c
+00011180: 666f 6666 7365 7428 7829 0a20 2020 2020  foffset(x).     
+00011190: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000111a0: 2020 2020 2072 6574 7572 6e20 782e 636f       return x.co
+000111b0: 7079 280a 2020 2020 2020 2020 2020 2020  py(.            
+000111c0: 2020 2020 6461 7461 3d64 6174 6574 696d      data=datetim
+000111d0: 655f 746f 5f6e 756d 6572 6963 2878 2e64  e_to_numeric(x.d
+000111e0: 6174 612c 206f 6666 7365 743d 6f66 6673  ata, offset=offs
+000111f0: 6574 2c20 6461 7465 7469 6d65 5f75 6e69  et, datetime_uni
+00011200: 743d 226e 7322 292c 0a20 2020 2020 2020  t="ns"),.       
+00011210: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+00011220: 6c69 6620 782e 6474 7970 652e 6b69 6e64  lif x.dtype.kind
+00011230: 203d 3d20 226d 223a 0a20 2020 2020 2020   == "m":.       
+00011240: 2020 2020 2023 2074 696d 6564 656c 7461       # timedelta
+00011250: 730a 2020 2020 2020 2020 2020 2020 7265  s.            re
+00011260: 7475 726e 2078 2e61 7374 7970 6528 666c  turn x.astype(fl
+00011270: 6f61 7429 0a20 2020 2020 2020 2072 6574  oat).        ret
+00011280: 7572 6e20 780a 0a20 2020 2069 6620 6973  urn x..    if is
+00011290: 696e 7374 616e 6365 2864 6174 612c 2044  instance(data, D
+000112a0: 6174 6173 6574 293a 0a20 2020 2020 2020  ataset):.       
+000112b0: 2072 6574 7572 6e20 6461 7461 2e6d 6170   return data.map
+000112c0: 2874 6f5f 666c 6f61 7461 626c 6529 0a20  (to_floatable). 
+000112d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000112e0: 2072 6574 7572 6e20 746f 5f66 6c6f 6174   return to_float
+000112f0: 6162 6c65 2864 6174 6129 0a0a 0a64 6566  able(data)...def
+00011300: 205f 6361 6c63 5f69 6478 6d69 6e6d 6178   _calc_idxminmax
+00011310: 280a 2020 2020 2a2c 0a20 2020 2061 7272  (.    *,.    arr
+00011320: 6179 2c0a 2020 2020 6675 6e63 3a20 4361  ay,.    func: Ca
+00011330: 6c6c 6162 6c65 2c0a 2020 2020 6469 6d3a  llable,.    dim:
+00011340: 2048 6173 6861 626c 6520 7c20 4e6f 6e65   Hashable | None
+00011350: 203d 204e 6f6e 652c 0a20 2020 2073 6b69   = None,.    ski
+00011360: 706e 613a 2062 6f6f 6c20 7c20 4e6f 6e65  pna: bool | None
+00011370: 203d 204e 6f6e 652c 0a20 2020 2066 696c   = None,.    fil
+00011380: 6c5f 7661 6c75 653a 2041 6e79 203d 2064  l_value: Any = d
+00011390: 7479 7065 732e 4e41 2c0a 2020 2020 6b65  types.NA,.    ke
+000113a0: 6570 5f61 7474 7273 3a20 626f 6f6c 207c  ep_attrs: bool |
+000113b0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 293a   None = None,.):
+000113c0: 0a20 2020 2022 2222 4170 706c 7920 636f  .    """Apply co
+000113d0: 6d6d 6f6e 206f 7065 7261 7469 6f6e 7320  mmon operations 
+000113e0: 666f 7220 6964 786d 696e 2061 6e64 2069  for idxmin and i
+000113f0: 6478 6d61 782e 2222 220a 2020 2020 2320  dxmax.""".    # 
+00011400: 5468 6973 2066 756e 6374 696f 6e20 646f  This function do
+00011410: 6573 6e27 7420 6d61 6b65 2073 656e 7365  esn't make sense
+00011420: 2066 6f72 2073 6361 6c61 7273 2073 6f20   for scalars so 
+00011430: 646f 6e27 7420 7472 790a 2020 2020 6966  don't try.    if
+00011440: 206e 6f74 2061 7272 6179 2e6e 6469 6d3a   not array.ndim:
+00011450: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
+00011460: 616c 7565 4572 726f 7228 2254 6869 7320  alueError("This 
+00011470: 6675 6e63 7469 6f6e 2064 6f65 7320 6e6f  function does no
+00011480: 7420 6170 706c 7920 666f 7220 7363 616c  t apply for scal
+00011490: 6172 7322 290a 0a20 2020 2069 6620 6469  ars")..    if di
+000114a0: 6d20 6973 206e 6f74 204e 6f6e 653a 0a20  m is not None:. 
+000114b0: 2020 2020 2020 2070 6173 7320 2023 2055         pass  # U
+000114c0: 7365 2074 6865 2064 696d 2069 6620 6176  se the dim if av
+000114d0: 6169 6c61 626c 650a 2020 2020 656c 6966  ailable.    elif
+000114e0: 2061 7272 6179 2e6e 6469 6d20 3d3d 2031   array.ndim == 1
+000114f0: 3a0a 2020 2020 2020 2020 2320 6974 2069  :.        # it i
+00011500: 7320 6f6b 6179 2074 6f20 6775 6573 7320  s okay to guess 
+00011510: 7468 6520 6469 6d20 6966 2074 6865 7265  the dim if there
+00011520: 2069 7320 6f6e 6c79 2031 0a20 2020 2020   is only 1.     
+00011530: 2020 2064 696d 203d 2061 7272 6179 2e64     dim = array.d
+00011540: 696d 735b 305d 0a20 2020 2065 6c73 653a  ims[0].    else:
+00011550: 0a20 2020 2020 2020 2023 2054 6865 2064  .        # The d
+00011560: 696d 2069 7320 6e6f 7420 7370 6563 6966  im is not specif
+00011570: 6965 6420 616e 6420 616d 6269 6775 6f75  ied and ambiguou
+00011580: 732e 2020 446f 6e27 7420 6775 6573 732e  s.  Don't guess.
+00011590: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
+000115a0: 616c 7565 4572 726f 7228 224d 7573 7420  alueError("Must 
+000115b0: 7375 7070 6c79 2027 6469 6d27 2061 7267  supply 'dim' arg
+000115c0: 756d 656e 7420 666f 7220 6d75 6c74 6964  ument for multid
+000115d0: 696d 656e 7369 6f6e 616c 2061 7272 6179  imensional array
+000115e0: 7322 290a 0a20 2020 2069 6620 6469 6d20  s")..    if dim 
+000115f0: 6e6f 7420 696e 2061 7272 6179 2e64 696d  not in array.dim
+00011600: 733a 0a20 2020 2020 2020 2072 6169 7365  s:.        raise
+00011610: 204b 6579 4572 726f 7228 6627 4469 6d65   KeyError(f'Dime
+00011620: 6e73 696f 6e20 227b 6469 6d7d 2220 6e6f  nsion "{dim}" no
+00011630: 7420 696e 2064 696d 656e 7369 6f6e 2729  t in dimension')
+00011640: 0a20 2020 2069 6620 6469 6d20 6e6f 7420  .    if dim not 
+00011650: 696e 2061 7272 6179 2e63 6f6f 7264 733a  in array.coords:
+00011660: 0a20 2020 2020 2020 2072 6169 7365 204b  .        raise K
+00011670: 6579 4572 726f 7228 6627 4469 6d65 6e73  eyError(f'Dimens
+00011680: 696f 6e20 227b 6469 6d7d 2220 646f 6573  ion "{dim}" does
+00011690: 206e 6f74 2068 6176 6520 636f 6f72 6469   not have coordi
+000116a0: 6e61 7465 7327 290a 0a20 2020 2023 2054  nates')..    # T
+000116b0: 6865 7365 2061 7265 2064 7479 7065 7320  hese are dtypes 
+000116c0: 7769 7468 204e 614e 2076 616c 7565 7320  with NaN values 
+000116d0: 6172 676d 696e 2061 6e64 2061 7267 6d61  argmin and argma
+000116e0: 7820 6361 6e20 6861 6e64 6c65 0a20 2020  x can handle.   
+000116f0: 206e 615f 6474 7970 6573 203d 2022 6366   na_dtypes = "cf
+00011700: 4f22 0a0a 2020 2020 6966 2073 6b69 706e  O"..    if skipn
+00011710: 6120 6f72 2028 736b 6970 6e61 2069 7320  a or (skipna is 
+00011720: 4e6f 6e65 2061 6e64 2061 7272 6179 2e64  None and array.d
+00011730: 7479 7065 2e6b 696e 6420 696e 206e 615f  type.kind in na_
+00011740: 6474 7970 6573 293a 0a20 2020 2020 2020  dtypes):.       
+00011750: 2023 204e 6565 6420 746f 2073 6b69 7020   # Need to skip 
+00011760: 4e61 4e20 7661 6c75 6573 2073 696e 6365  NaN values since
+00011770: 2061 7267 6d69 6e20 616e 6420 6172 676d   argmin and argm
+00011780: 6178 2063 616e 2774 2068 616e 646c 6520  ax can't handle 
+00011790: 7468 656d 0a20 2020 2020 2020 2061 6c6c  them.        all
+000117a0: 6e61 203d 2061 7272 6179 2e69 736e 756c  na = array.isnul
+000117b0: 6c28 292e 616c 6c28 6469 6d29 0a20 2020  l().all(dim).   
+000117c0: 2020 2020 2061 7272 6179 203d 2061 7272       array = arr
+000117d0: 6179 2e77 6865 7265 287e 616c 6c6e 612c  ay.where(~allna,
+000117e0: 2030 290a 0a20 2020 2023 2054 6869 7320   0)..    # This 
+000117f0: 7769 6c6c 2072 756e 2061 7267 6d69 6e20  will run argmin 
+00011800: 6f72 2061 7267 6d61 782e 0a20 2020 2069  or argmax..    i
+00011810: 6e64 7820 3d20 6675 6e63 2861 7272 6179  ndx = func(array
+00011820: 2c20 6469 6d3d 6469 6d2c 2061 7869 733d  , dim=dim, axis=
+00011830: 4e6f 6e65 2c20 6b65 6570 5f61 7474 7273  None, keep_attrs
+00011840: 3d6b 6565 705f 6174 7472 732c 2073 6b69  =keep_attrs, ski
+00011850: 706e 613d 736b 6970 6e61 290a 0a20 2020  pna=skipna)..   
+00011860: 2023 2048 616e 646c 6520 6461 736b 2061   # Handle dask a
+00011870: 7272 6179 732e 0a20 2020 2069 6620 6973  rrays..    if is
+00011880: 5f64 7563 6b5f 6461 736b 5f61 7272 6179  _duck_dask_array
+00011890: 2861 7272 6179 2e64 6174 6129 3a0a 2020  (array.data):.  
+000118a0: 2020 2020 2020 696d 706f 7274 2064 6173        import das
+000118b0: 6b2e 6172 7261 790a 0a20 2020 2020 2020  k.array..       
+000118c0: 2063 6875 6e6b 7320 3d20 6469 6374 287a   chunks = dict(z
+000118d0: 6970 2861 7272 6179 2e64 696d 732c 2061  ip(array.dims, a
+000118e0: 7272 6179 2e63 6875 6e6b 7329 290a 2020  rray.chunks)).  
+000118f0: 2020 2020 2020 6461 736b 5f63 6f6f 7264        dask_coord
+00011900: 203d 2064 6173 6b2e 6172 7261 792e 6672   = dask.array.fr
+00011910: 6f6d 5f61 7272 6179 2861 7272 6179 5b64  om_array(array[d
+00011920: 696d 5d2e 6461 7461 2c20 6368 756e 6b73  im].data, chunks
+00011930: 3d63 6875 6e6b 735b 6469 6d5d 290a 2020  =chunks[dim]).  
+00011940: 2020 2020 2020 7265 7320 3d20 696e 6478        res = indx
+00011950: 2e63 6f70 7928 6461 7461 3d64 6173 6b5f  .copy(data=dask_
+00011960: 636f 6f72 645b 696e 6478 2e64 6174 612e  coord[indx.data.
+00011970: 7261 7665 6c28 295d 2e72 6573 6861 7065  ravel()].reshape
+00011980: 2869 6e64 782e 7368 6170 6529 290a 2020  (indx.shape)).  
+00011990: 2020 2020 2020 2320 7765 206e 6565 6420        # we need 
+000119a0: 746f 2061 7474 6163 6820 6261 636b 2074  to attach back t
+000119b0: 6865 2064 696d 206e 616d 650a 2020 2020  he dim name.    
+000119c0: 2020 2020 7265 732e 6e61 6d65 203d 2064      res.name = d
+000119d0: 696d 0a20 2020 2065 6c73 653a 0a20 2020  im.    else:.   
+000119e0: 2020 2020 2072 6573 203d 2061 7272 6179       res = array
+000119f0: 5b64 696d 5d5b 2869 6e64 782c 295d 0a20  [dim][(indx,)]. 
+00011a00: 2020 2020 2020 2023 2054 6865 2064 696d         # The dim
+00011a10: 2069 7320 676f 6e65 2062 7574 2077 6520   is gone but we 
+00011a20: 6e65 6564 2074 6f20 7265 6d6f 7665 2074  need to remove t
+00011a30: 6865 2063 6f72 7265 7370 6f6e 6469 6e67  he corresponding
+00011a40: 2063 6f6f 7264 696e 6174 652e 0a20 2020   coordinate..   
+00011a50: 2020 2020 2064 656c 2072 6573 2e63 6f6f       del res.coo
+00011a60: 7264 735b 6469 6d5d 0a0a 2020 2020 6966  rds[dim]..    if
+00011a70: 2073 6b69 706e 6120 6f72 2028 736b 6970   skipna or (skip
+00011a80: 6e61 2069 7320 4e6f 6e65 2061 6e64 2061  na is None and a
+00011a90: 7272 6179 2e64 7479 7065 2e6b 696e 6420  rray.dtype.kind 
+00011aa0: 696e 206e 615f 6474 7970 6573 293a 0a20  in na_dtypes):. 
+00011ab0: 2020 2020 2020 2023 2050 7574 2074 6865         # Put the
+00011ac0: 204e 614e 2076 616c 7565 7320 6261 636b   NaN values back
+00011ad0: 2069 6e20 6166 7465 7220 7265 6d6f 7669   in after removi
+00011ae0: 6e67 2074 6865 6d0a 2020 2020 2020 2020  ng them.        
+00011af0: 7265 7320 3d20 7265 732e 7768 6572 6528  res = res.where(
+00011b00: 7e61 6c6c 6e61 2c20 6669 6c6c 5f76 616c  ~allna, fill_val
+00011b10: 7565 290a 0a20 2020 2023 2043 6f70 7920  ue)..    # Copy 
+00011b20: 6174 7472 6962 7574 6573 2066 726f 6d20  attributes from 
+00011b30: 6172 676d 696e 2f61 7267 6d61 782c 2069  argmin/argmax, i
+00011b40: 6620 616e 790a 2020 2020 7265 732e 6174  f any.    res.at
+00011b50: 7472 7320 3d20 696e 6478 2e61 7474 7273  trs = indx.attrs
+00011b60: 0a0a 2020 2020 7265 7475 726e 2072 6573  ..    return res
+00011b70: 0a0a 0a5f 5420 3d20 5479 7065 5661 7228  ..._T = TypeVar(
+00011b80: 225f 5422 2c20 626f 756e 643d 556e 696f  "_T", bound=Unio
+00011b90: 6e5b 2244 6174 6173 6574 222c 2022 4461  n["Dataset", "Da
+00011ba0: 7461 4172 7261 7922 5d29 0a5f 5520 3d20  taArray"])._U = 
+00011bb0: 5479 7065 5661 7228 225f 5522 2c20 626f  TypeVar("_U", bo
+00011bc0: 756e 643d 556e 696f 6e5b 2244 6174 6173  und=Union["Datas
+00011bd0: 6574 222c 2022 4461 7461 4172 7261 7922  et", "DataArray"
+00011be0: 5d29 0a5f 5620 3d20 5479 7065 5661 7228  ])._V = TypeVar(
+00011bf0: 225f 5622 2c20 626f 756e 643d 556e 696f  "_V", bound=Unio
+00011c00: 6e5b 2244 6174 6173 6574 222c 2022 4461  n["Dataset", "Da
+00011c10: 7461 4172 7261 7922 5d29 0a0a 0a40 6f76  taArray"])...@ov
+00011c20: 6572 6c6f 6164 0a64 6566 2075 6e69 6679  erload.def unify
+00011c30: 5f63 6875 6e6b 7328 5f5f 6f62 6a3a 205f  _chunks(__obj: _
+00011c40: 5429 202d 3e20 7475 706c 655b 5f54 5d3a  T) -> tuple[_T]:
+00011c50: 0a20 2020 202e 2e2e 0a0a 0a40 6f76 6572  .    ......@over
 00011c60: 6c6f 6164 0a64 6566 2075 6e69 6679 5f63  load.def unify_c
-00011c70: 6875 6e6b 7328 5f5f 6f62 6a3a 205f 5429  hunks(__obj: _T)
-00011c80: 202d 3e20 7475 706c 655b 5f54 5d3a 0a20   -> tuple[_T]:. 
-00011c90: 2020 202e 2e2e 0a0a 0a40 6f76 6572 6c6f     ......@overlo
-00011ca0: 6164 0a64 6566 2075 6e69 6679 5f63 6875  ad.def unify_chu
-00011cb0: 6e6b 7328 5f5f 6f62 6a31 3a20 5f54 2c20  nks(__obj1: _T, 
-00011cc0: 5f5f 6f62 6a32 3a20 5f55 2920 2d3e 2074  __obj2: _U) -> t
-00011cd0: 7570 6c65 5b5f 542c 205f 555d 3a0a 2020  uple[_T, _U]:.  
-00011ce0: 2020 2e2e 2e0a 0a0a 406f 7665 726c 6f61    ......@overloa
-00011cf0: 640a 6465 6620 756e 6966 795f 6368 756e  d.def unify_chun
-00011d00: 6b73 285f 5f6f 626a 313a 205f 542c 205f  ks(__obj1: _T, _
-00011d10: 5f6f 626a 323a 205f 552c 205f 5f6f 626a  _obj2: _U, __obj
-00011d20: 333a 205f 5629 202d 3e20 7475 706c 655b  3: _V) -> tuple[
-00011d30: 5f54 2c20 5f55 2c20 5f56 5d3a 0a20 2020  _T, _U, _V]:.   
-00011d40: 202e 2e2e 0a0a 0a40 6f76 6572 6c6f 6164   ......@overload
-00011d50: 0a64 6566 2075 6e69 6679 5f63 6875 6e6b  .def unify_chunk
-00011d60: 7328 2a6f 626a 6563 7473 3a20 4461 7461  s(*objects: Data
-00011d70: 7365 7420 7c20 4461 7461 4172 7261 7929  set | DataArray)
-00011d80: 202d 3e20 7475 706c 655b 4461 7461 7365   -> tuple[Datase
-00011d90: 7420 7c20 4461 7461 4172 7261 792c 202e  t | DataArray, .
-00011da0: 2e2e 5d3a 0a20 2020 202e 2e2e 0a0a 0a64  ..]:.    ......d
-00011db0: 6566 2075 6e69 6679 5f63 6875 6e6b 7328  ef unify_chunks(
-00011dc0: 2a6f 626a 6563 7473 3a20 4461 7461 7365  *objects: Datase
-00011dd0: 7420 7c20 4461 7461 4172 7261 7929 202d  t | DataArray) -
-00011de0: 3e20 7475 706c 655b 4461 7461 7365 7420  > tuple[Dataset 
-00011df0: 7c20 4461 7461 4172 7261 792c 202e 2e2e  | DataArray, ...
-00011e00: 5d3a 0a20 2020 2022 2222 0a20 2020 2047  ]:.    """.    G
-00011e10: 6976 656e 2061 6e79 206e 756d 6265 7220  iven any number 
-00011e20: 6f66 2044 6174 6173 6574 2061 6e64 2f6f  of Dataset and/o
-00011e30: 7220 4461 7461 4172 7261 7920 6f62 6a65  r DataArray obje
-00011e40: 6374 732c 2072 6574 7572 6e73 0a20 2020  cts, returns.   
-00011e50: 206e 6577 206f 626a 6563 7473 2077 6974   new objects wit
-00011e60: 6820 756e 6966 6965 6420 6368 756e 6b20  h unified chunk 
-00011e70: 7369 7a65 2061 6c6f 6e67 2061 6c6c 2063  size along all c
-00011e80: 6875 6e6b 6564 2064 696d 656e 7369 6f6e  hunked dimension
-00011e90: 732e 0a0a 2020 2020 5265 7475 726e 730a  s...    Returns.
-00011ea0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-00011eb0: 756e 6966 6965 6420 2844 6174 6141 7272  unified (DataArr
-00011ec0: 6179 206f 7220 4461 7461 7365 7429 20e2  ay or Dataset) .
-00011ed0: 8093 2054 7570 6c65 206f 6620 6f62 6a65  .. Tuple of obje
-00011ee0: 6374 7320 7769 7468 2074 6865 2073 616d  cts with the sam
-00011ef0: 6520 7479 7065 2061 730a 2020 2020 2a6f  e type as.    *o
-00011f00: 626a 6563 7473 2077 6974 6820 636f 6e73  bjects with cons
-00011f10: 6973 7465 6e74 2063 6875 6e6b 2073 697a  istent chunk siz
-00011f20: 6573 2066 6f72 2061 6c6c 2064 6173 6b2d  es for all dask-
-00011f30: 6172 7261 7920 7661 7269 6162 6c65 730a  array variables.
-00011f40: 0a20 2020 2053 6565 2041 6c73 6f0a 2020  .    See Also.  
-00011f50: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064    --------.    d
-00011f60: 6173 6b2e 6172 7261 792e 636f 7265 2e75  ask.array.core.u
-00011f70: 6e69 6679 5f63 6875 6e6b 730a 2020 2020  nify_chunks.    
-00011f80: 2222 220a 2020 2020 6672 6f6d 2078 6172  """.    from xar
-00011f90: 7261 792e 636f 7265 2e64 6174 6161 7272  ray.core.dataarr
-00011fa0: 6179 2069 6d70 6f72 7420 4461 7461 4172  ay import DataAr
-00011fb0: 7261 790a 0a20 2020 2023 2043 6f6e 7665  ray..    # Conve
-00011fc0: 7274 2061 6c6c 206f 626a 6563 7473 2074  rt all objects t
-00011fd0: 6f20 6461 7461 7365 7473 0a20 2020 2064  o datasets.    d
-00011fe0: 6174 6173 6574 7320 3d20 5b0a 2020 2020  atasets = [.    
-00011ff0: 2020 2020 6f62 6a2e 5f74 6f5f 7465 6d70      obj._to_temp
-00012000: 5f64 6174 6173 6574 2829 2069 6620 6973  _dataset() if is
-00012010: 696e 7374 616e 6365 286f 626a 2c20 4461  instance(obj, Da
-00012020: 7461 4172 7261 7929 2065 6c73 6520 6f62  taArray) else ob
-00012030: 6a2e 636f 7079 2829 0a20 2020 2020 2020  j.copy().       
-00012040: 2066 6f72 206f 626a 2069 6e20 6f62 6a65   for obj in obje
-00012050: 6374 730a 2020 2020 5d0a 0a20 2020 2023  cts.    ]..    #
-00012060: 2047 6574 2061 7267 756d 656e 7473 2074   Get arguments t
-00012070: 6f20 7061 7373 2069 6e74 6f20 6461 736b  o pass into dask
-00012080: 2e61 7272 6179 2e63 6f72 652e 756e 6966  .array.core.unif
-00012090: 795f 6368 756e 6b73 0a20 2020 2075 6e69  y_chunks.    uni
-000120a0: 6679 5f63 6875 6e6b 735f 6172 6773 203d  fy_chunks_args =
-000120b0: 205b 5d0a 2020 2020 7369 7a65 733a 2064   [].    sizes: d
-000120c0: 6963 745b 4861 7368 6162 6c65 2c20 696e  ict[Hashable, in
-000120d0: 745d 203d 207b 7d0a 2020 2020 666f 7220  t] = {}.    for 
-000120e0: 6473 2069 6e20 6461 7461 7365 7473 3a0a  ds in datasets:.
-000120f0: 2020 2020 2020 2020 666f 7220 7620 696e          for v in
-00012100: 2064 732e 5f76 6172 6961 626c 6573 2e76   ds._variables.v
-00012110: 616c 7565 7328 293a 0a20 2020 2020 2020  alues():.       
-00012120: 2020 2020 2069 6620 762e 6368 756e 6b73       if v.chunks
-00012130: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00012140: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00012150: 4368 6563 6b20 7468 6174 2073 697a 6573  Check that sizes
-00012160: 206d 6174 6368 2061 6372 6f73 7320 6469   match across di
-00012170: 6666 6572 656e 7420 6461 7461 7365 7473  fferent datasets
-00012180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012190: 2066 6f72 2064 696d 2c20 7369 7a65 2069   for dim, size i
-000121a0: 6e20 762e 7369 7a65 732e 6974 656d 7328  n v.sizes.items(
-000121b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000121c0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-000121d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121e0: 2020 2020 6966 2073 697a 6573 5b64 696d      if sizes[dim
-000121f0: 5d20 213d 2073 697a 653a 0a20 2020 2020  ] != size:.     
-00012200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012210: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00012220: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-00012230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012240: 2020 2020 2020 2020 2066 2244 696d 656e           f"Dimen
-00012250: 7369 6f6e 207b 6469 6d21 727d 2073 697a  sion {dim!r} siz
-00012260: 6520 6d69 736d 6174 6368 3a20 7b73 697a  e mismatch: {siz
-00012270: 6573 5b64 696d 5d7d 2021 3d20 7b73 697a  es[dim]} != {siz
-00012280: 657d 220a 2020 2020 2020 2020 2020 2020  e}".            
+00011c70: 6875 6e6b 7328 5f5f 6f62 6a31 3a20 5f54  hunks(__obj1: _T
+00011c80: 2c20 5f5f 6f62 6a32 3a20 5f55 2920 2d3e  , __obj2: _U) ->
+00011c90: 2074 7570 6c65 5b5f 542c 205f 555d 3a0a   tuple[_T, _U]:.
+00011ca0: 2020 2020 2e2e 2e0a 0a0a 406f 7665 726c      ......@overl
+00011cb0: 6f61 640a 6465 6620 756e 6966 795f 6368  oad.def unify_ch
+00011cc0: 756e 6b73 285f 5f6f 626a 313a 205f 542c  unks(__obj1: _T,
+00011cd0: 205f 5f6f 626a 323a 205f 552c 205f 5f6f   __obj2: _U, __o
+00011ce0: 626a 333a 205f 5629 202d 3e20 7475 706c  bj3: _V) -> tupl
+00011cf0: 655b 5f54 2c20 5f55 2c20 5f56 5d3a 0a20  e[_T, _U, _V]:. 
+00011d00: 2020 202e 2e2e 0a0a 0a40 6f76 6572 6c6f     ......@overlo
+00011d10: 6164 0a64 6566 2075 6e69 6679 5f63 6875  ad.def unify_chu
+00011d20: 6e6b 7328 2a6f 626a 6563 7473 3a20 4461  nks(*objects: Da
+00011d30: 7461 7365 7420 7c20 4461 7461 4172 7261  taset | DataArra
+00011d40: 7929 202d 3e20 7475 706c 655b 4461 7461  y) -> tuple[Data
+00011d50: 7365 7420 7c20 4461 7461 4172 7261 792c  set | DataArray,
+00011d60: 202e 2e2e 5d3a 0a20 2020 202e 2e2e 0a0a   ...]:.    .....
+00011d70: 0a64 6566 2075 6e69 6679 5f63 6875 6e6b  .def unify_chunk
+00011d80: 7328 2a6f 626a 6563 7473 3a20 4461 7461  s(*objects: Data
+00011d90: 7365 7420 7c20 4461 7461 4172 7261 7929  set | DataArray)
+00011da0: 202d 3e20 7475 706c 655b 4461 7461 7365   -> tuple[Datase
+00011db0: 7420 7c20 4461 7461 4172 7261 792c 202e  t | DataArray, .
+00011dc0: 2e2e 5d3a 0a20 2020 2022 2222 0a20 2020  ..]:.    """.   
+00011dd0: 2047 6976 656e 2061 6e79 206e 756d 6265   Given any numbe
+00011de0: 7220 6f66 2044 6174 6173 6574 2061 6e64  r of Dataset and
+00011df0: 2f6f 7220 4461 7461 4172 7261 7920 6f62  /or DataArray ob
+00011e00: 6a65 6374 732c 2072 6574 7572 6e73 0a20  jects, returns. 
+00011e10: 2020 206e 6577 206f 626a 6563 7473 2077     new objects w
+00011e20: 6974 6820 756e 6966 6965 6420 6368 756e  ith unified chun
+00011e30: 6b20 7369 7a65 2061 6c6f 6e67 2061 6c6c  k size along all
+00011e40: 2063 6875 6e6b 6564 2064 696d 656e 7369   chunked dimensi
+00011e50: 6f6e 732e 0a0a 2020 2020 5265 7475 726e  ons...    Return
+00011e60: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
+00011e70: 2020 756e 6966 6965 6420 2844 6174 6141    unified (DataA
+00011e80: 7272 6179 206f 7220 4461 7461 7365 7429  rray or Dataset)
+00011e90: 20e2 8093 2054 7570 6c65 206f 6620 6f62   ... Tuple of ob
+00011ea0: 6a65 6374 7320 7769 7468 2074 6865 2073  jects with the s
+00011eb0: 616d 6520 7479 7065 2061 730a 2020 2020  ame type as.    
+00011ec0: 2a6f 626a 6563 7473 2077 6974 6820 636f  *objects with co
+00011ed0: 6e73 6973 7465 6e74 2063 6875 6e6b 2073  nsistent chunk s
+00011ee0: 697a 6573 2066 6f72 2061 6c6c 2064 6173  izes for all das
+00011ef0: 6b2d 6172 7261 7920 7661 7269 6162 6c65  k-array variable
+00011f00: 730a 0a20 2020 2053 6565 2041 6c73 6f0a  s..    See Also.
+00011f10: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00011f20: 2064 6173 6b2e 6172 7261 792e 636f 7265   dask.array.core
+00011f30: 2e75 6e69 6679 5f63 6875 6e6b 730a 2020  .unify_chunks.  
+00011f40: 2020 2222 220a 2020 2020 6672 6f6d 2078    """.    from x
+00011f50: 6172 7261 792e 636f 7265 2e64 6174 6161  array.core.dataa
+00011f60: 7272 6179 2069 6d70 6f72 7420 4461 7461  rray import Data
+00011f70: 4172 7261 790a 0a20 2020 2023 2043 6f6e  Array..    # Con
+00011f80: 7665 7274 2061 6c6c 206f 626a 6563 7473  vert all objects
+00011f90: 2074 6f20 6461 7461 7365 7473 0a20 2020   to datasets.   
+00011fa0: 2064 6174 6173 6574 7320 3d20 5b0a 2020   datasets = [.  
+00011fb0: 2020 2020 2020 6f62 6a2e 5f74 6f5f 7465        obj._to_te
+00011fc0: 6d70 5f64 6174 6173 6574 2829 2069 6620  mp_dataset() if 
+00011fd0: 6973 696e 7374 616e 6365 286f 626a 2c20  isinstance(obj, 
+00011fe0: 4461 7461 4172 7261 7929 2065 6c73 6520  DataArray) else 
+00011ff0: 6f62 6a2e 636f 7079 2829 0a20 2020 2020  obj.copy().     
+00012000: 2020 2066 6f72 206f 626a 2069 6e20 6f62     for obj in ob
+00012010: 6a65 6374 730a 2020 2020 5d0a 0a20 2020  jects.    ]..   
+00012020: 2023 2047 6574 2061 7267 756d 656e 7473   # Get arguments
+00012030: 2074 6f20 7061 7373 2069 6e74 6f20 6461   to pass into da
+00012040: 736b 2e61 7272 6179 2e63 6f72 652e 756e  sk.array.core.un
+00012050: 6966 795f 6368 756e 6b73 0a20 2020 2075  ify_chunks.    u
+00012060: 6e69 6679 5f63 6875 6e6b 735f 6172 6773  nify_chunks_args
+00012070: 203d 205b 5d0a 2020 2020 7369 7a65 733a   = [].    sizes:
+00012080: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
+00012090: 696e 745d 203d 207b 7d0a 2020 2020 666f  int] = {}.    fo
+000120a0: 7220 6473 2069 6e20 6461 7461 7365 7473  r ds in datasets
+000120b0: 3a0a 2020 2020 2020 2020 666f 7220 7620  :.        for v 
+000120c0: 696e 2064 732e 5f76 6172 6961 626c 6573  in ds._variables
+000120d0: 2e76 616c 7565 7328 293a 0a20 2020 2020  .values():.     
+000120e0: 2020 2020 2020 2069 6620 762e 6368 756e         if v.chun
+000120f0: 6b73 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ks is not None:.
+00012100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012110: 2320 4368 6563 6b20 7468 6174 2073 697a  # Check that siz
+00012120: 6573 206d 6174 6368 2061 6372 6f73 7320  es match across 
+00012130: 6469 6666 6572 656e 7420 6461 7461 7365  different datase
+00012140: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
+00012150: 2020 2066 6f72 2064 696d 2c20 7369 7a65     for dim, size
+00012160: 2069 6e20 762e 7369 7a65 732e 6974 656d   in v.sizes.item
+00012170: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00012180: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00012190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121a0: 2020 2020 2020 6966 2073 697a 6573 5b64        if sizes[d
+000121b0: 696d 5d20 213d 2073 697a 653a 0a20 2020  im] != size:.   
+000121c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121d0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000121e0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+000121f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012200: 2020 2020 2020 2020 2020 2066 2244 696d             f"Dim
+00012210: 656e 7369 6f6e 207b 6469 6d21 727d 2073  ension {dim!r} s
+00012220: 697a 6520 6d69 736d 6174 6368 3a20 7b73  ize mismatch: {s
+00012230: 697a 6573 5b64 696d 5d7d 2021 3d20 7b73  izes[dim]} != {s
+00012240: 697a 657d 220a 2020 2020 2020 2020 2020  ize}".          
+00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012260: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00012270: 2020 2020 2020 2020 6578 6365 7074 204b          except K
+00012280: 6579 4572 726f 723a 0a20 2020 2020 2020  eyError:.       
 00012290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000122b0: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-000122c0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-000122d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000122e0: 697a 6573 5b64 696d 5d20 3d20 7369 7a65  izes[dim] = size
-000122f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012300: 2075 6e69 6679 5f63 6875 6e6b 735f 6172   unify_chunks_ar
-00012310: 6773 202b 3d20 5b76 2e5f 6461 7461 2c20  gs += [v._data, 
-00012320: 762e 5f64 696d 735d 0a0a 2020 2020 2320  v._dims]..    # 
-00012330: 4e6f 2064 6173 6b20 6172 7261 7973 3a20  No dask arrays: 
-00012340: 5265 7475 726e 2069 6e70 7574 730a 2020  Return inputs.  
-00012350: 2020 6966 206e 6f74 2075 6e69 6679 5f63    if not unify_c
-00012360: 6875 6e6b 735f 6172 6773 3a0a 2020 2020  hunks_args:.    
-00012370: 2020 2020 7265 7475 726e 206f 626a 6563      return objec
-00012380: 7473 0a0a 2020 2020 2320 5275 6e20 6461  ts..    # Run da
-00012390: 736b 2e61 7272 6179 2e63 6f72 652e 756e  sk.array.core.un
-000123a0: 6966 795f 6368 756e 6b73 0a20 2020 2066  ify_chunks.    f
-000123b0: 726f 6d20 6461 736b 2e61 7272 6179 2e63  rom dask.array.c
-000123c0: 6f72 6520 696d 706f 7274 2075 6e69 6679  ore import unify
-000123d0: 5f63 6875 6e6b 730a 0a20 2020 205f 2c20  _chunks..    _, 
-000123e0: 6461 736b 5f64 6174 6120 3d20 756e 6966  dask_data = unif
-000123f0: 795f 6368 756e 6b73 282a 756e 6966 795f  y_chunks(*unify_
-00012400: 6368 756e 6b73 5f61 7267 7329 0a20 2020  chunks_args).   
-00012410: 2064 6173 6b5f 6461 7461 5f69 7465 7220   dask_data_iter 
-00012420: 3d20 6974 6572 2864 6173 6b5f 6461 7461  = iter(dask_data
-00012430: 290a 2020 2020 6f75 743a 206c 6973 745b  ).    out: list[
-00012440: 4461 7461 7365 7420 7c20 4461 7461 4172  Dataset | DataAr
-00012450: 7261 795d 203d 205b 5d0a 2020 2020 666f  ray] = [].    fo
-00012460: 7220 6f62 6a2c 2064 7320 696e 207a 6970  r obj, ds in zip
-00012470: 286f 626a 6563 7473 2c20 6461 7461 7365  (objects, datase
-00012480: 7473 293a 0a20 2020 2020 2020 2066 6f72  ts):.        for
-00012490: 206b 2c20 7620 696e 2064 732e 5f76 6172   k, v in ds._var
-000124a0: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
-000124b0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-000124c0: 2e63 6875 6e6b 7320 6973 206e 6f74 204e  .chunks is not N
-000124d0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000124e0: 2020 2020 2064 732e 5f76 6172 6961 626c       ds._variabl
-000124f0: 6573 5b6b 5d20 3d20 762e 636f 7079 2864  es[k] = v.copy(d
-00012500: 6174 613d 6e65 7874 2864 6173 6b5f 6461  ata=next(dask_da
-00012510: 7461 5f69 7465 7229 290a 2020 2020 2020  ta_iter)).      
-00012520: 2020 6f75 742e 6170 7065 6e64 286f 626a    out.append(obj
-00012530: 2e5f 6672 6f6d 5f74 656d 705f 6461 7461  ._from_temp_data
-00012540: 7365 7428 6473 2920 6966 2069 7369 6e73  set(ds) if isins
-00012550: 7461 6e63 6528 6f62 6a2c 2044 6174 6141  tance(obj, DataA
-00012560: 7272 6179 2920 656c 7365 2064 7329 0a0a  rray) else ds)..
-00012570: 2020 2020 7265 7475 726e 2074 7570 6c65      return tuple
-00012580: 286f 7574 290a                           (out).
+000122a0: 2073 697a 6573 5b64 696d 5d20 3d20 7369   sizes[dim] = si
+000122b0: 7a65 0a20 2020 2020 2020 2020 2020 2020  ze.             
+000122c0: 2020 2075 6e69 6679 5f63 6875 6e6b 735f     unify_chunks_
+000122d0: 6172 6773 202b 3d20 5b76 2e5f 6461 7461  args += [v._data
+000122e0: 2c20 762e 5f64 696d 735d 0a0a 2020 2020  , v._dims]..    
+000122f0: 2320 4e6f 2064 6173 6b20 6172 7261 7973  # No dask arrays
+00012300: 3a20 5265 7475 726e 2069 6e70 7574 730a  : Return inputs.
+00012310: 2020 2020 6966 206e 6f74 2075 6e69 6679      if not unify
+00012320: 5f63 6875 6e6b 735f 6172 6773 3a0a 2020  _chunks_args:.  
+00012330: 2020 2020 2020 7265 7475 726e 206f 626a        return obj
+00012340: 6563 7473 0a0a 2020 2020 2320 5275 6e20  ects..    # Run 
+00012350: 6461 736b 2e61 7272 6179 2e63 6f72 652e  dask.array.core.
+00012360: 756e 6966 795f 6368 756e 6b73 0a20 2020  unify_chunks.   
+00012370: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
+00012380: 2e63 6f72 6520 696d 706f 7274 2075 6e69  .core import uni
+00012390: 6679 5f63 6875 6e6b 730a 0a20 2020 205f  fy_chunks..    _
+000123a0: 2c20 6461 736b 5f64 6174 6120 3d20 756e  , dask_data = un
+000123b0: 6966 795f 6368 756e 6b73 282a 756e 6966  ify_chunks(*unif
+000123c0: 795f 6368 756e 6b73 5f61 7267 7329 0a20  y_chunks_args). 
+000123d0: 2020 2064 6173 6b5f 6461 7461 5f69 7465     dask_data_ite
+000123e0: 7220 3d20 6974 6572 2864 6173 6b5f 6461  r = iter(dask_da
+000123f0: 7461 290a 2020 2020 6f75 743a 206c 6973  ta).    out: lis
+00012400: 745b 4461 7461 7365 7420 7c20 4461 7461  t[Dataset | Data
+00012410: 4172 7261 795d 203d 205b 5d0a 2020 2020  Array] = [].    
+00012420: 666f 7220 6f62 6a2c 2064 7320 696e 207a  for obj, ds in z
+00012430: 6970 286f 626a 6563 7473 2c20 6461 7461  ip(objects, data
+00012440: 7365 7473 293a 0a20 2020 2020 2020 2066  sets):.        f
+00012450: 6f72 206b 2c20 7620 696e 2064 732e 5f76  or k, v in ds._v
+00012460: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
+00012470: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00012480: 2076 2e63 6875 6e6b 7320 6973 206e 6f74   v.chunks is not
+00012490: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000124a0: 2020 2020 2020 2064 732e 5f76 6172 6961         ds._varia
+000124b0: 626c 6573 5b6b 5d20 3d20 762e 636f 7079  bles[k] = v.copy
+000124c0: 2864 6174 613d 6e65 7874 2864 6173 6b5f  (data=next(dask_
+000124d0: 6461 7461 5f69 7465 7229 290a 2020 2020  data_iter)).    
+000124e0: 2020 2020 6f75 742e 6170 7065 6e64 286f      out.append(o
+000124f0: 626a 2e5f 6672 6f6d 5f74 656d 705f 6461  bj._from_temp_da
+00012500: 7461 7365 7428 6473 2920 6966 2069 7369  taset(ds) if isi
+00012510: 6e73 7461 6e63 6528 6f62 6a2c 2044 6174  nstance(obj, Dat
+00012520: 6141 7272 6179 2920 656c 7365 2064 7329  aArray) else ds)
+00012530: 0a0a 2020 2020 7265 7475 726e 2074 7570  ..    return tup
+00012540: 6c65 286f 7574 290a                      le(out).
```

### Comparing `xarray-2023.3.0/xarray/core/concat.py` & `xarray-2023.4.0/xarray/core/concat.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/coordinates.py` & `xarray-2023.4.0/xarray/core/coordinates.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/dask_array_ops.py` & `xarray-2023.4.0/xarray/core/dask_array_ops.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/dataarray.py` & `xarray-2023.4.0/xarray/core/dataarray.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 from __future__ import annotations
 
 import datetime
 import warnings
-from collections.abc import Hashable, Iterable, Mapping, Sequence
+from collections.abc import Hashable, Iterable, Mapping, MutableMapping, Sequence
 from os import PathLike
 from typing import TYPE_CHECKING, Any, Callable, Literal, NoReturn, cast, overload
 
 import numpy as np
 import pandas as pd
 
 from xarray.coding.calendar_ops import convert_calendar, interp_calendar
@@ -66,14 +66,15 @@
     except ImportError:
         cdms2_Variable = None
     try:
         from iris.cube import Cube as iris_Cube
     except ImportError:
         iris_Cube = None
 
+    from xarray.backends import ZarrStore
     from xarray.backends.api import T_NetcdfEngine, T_NetcdfTypes
     from xarray.core.groupby import DataArrayGroupBy
     from xarray.core.resample import DataArrayResample
     from xarray.core.rolling import DataArrayCoarsen, DataArrayRolling
     from xarray.core.types import (
         CoarsenBoundaryOptions,
         DatetimeLike,
@@ -873,14 +874,20 @@
         serialized."""
         return self.variable.encoding
 
     @encoding.setter
     def encoding(self, value: Mapping[Any, Any]) -> None:
         self.variable.encoding = dict(value)
 
+    def reset_encoding(self: T_DataArray) -> T_DataArray:
+        """Return a new DataArray without encoding on the array or any attached
+        coords."""
+        ds = self._to_temp_dataset().reset_encoding()
+        return self._from_temp_dataset(ds)
+
     @property
     def indexes(self) -> Indexes:
         """Mapping of pandas.Index objects used for label based indexing.
 
         Raises an error if this Dataset has indexes that cannot be coerced
         to pandas.Index objects.
 
@@ -3330,17 +3337,17 @@
               provided.
             - 'barycentric', 'krog', 'pchip', 'spline', 'akima': use their
               respective :py:class:`scipy.interpolate` classes.
 
         use_coordinate : bool or str, default: True
             Specifies which index to use as the x values in the interpolation
             formulated as `y = f(x)`. If False, values are treated as if
-            eqaully-spaced along ``dim``. If True, the IndexVariable `dim` is
+            equally-spaced along ``dim``. If True, the IndexVariable `dim` is
             used. If ``use_coordinate`` is a string, it specifies the name of a
-            coordinate variariable to use as the index.
+            coordinate variable to use as the index.
         limit : int or None, default: None
             Maximum number of consecutive NaNs to fill. Must be greater than 0
             or None for no limit. This filling is done regardless of the size of
             the gap in the data. To only interpolate over gaps less than a given length,
             see ``max_gap``.
         max_gap : int, float, str, pandas.Timedelta, numpy.timedelta64, datetime.timedelta, default: None
             Maximum size of gap, a continuous sequence of NaNs, that will be filled.
@@ -3845,15 +3852,15 @@
         group: str | None = None,
         engine: T_NetcdfEngine | None = None,
         encoding: Mapping[Hashable, Mapping[str, Any]] | None = None,
         unlimited_dims: Iterable[Hashable] | None = None,
         compute: bool = True,
         invalid_netcdf: bool = False,
     ) -> bytes | Delayed | None:
-        """Write dataset contents to a netCDF file.
+        """Write DataArray contents to a netCDF file.
 
         Parameters
         ----------
         path : str, path-like or None, optional
             Path to which to save this dataset. File-like objects are only
             supported by the scipy engine. If no path is provided, this
             function returns the resulting netCDF file as bytes; in this case,
@@ -3959,14 +3966,218 @@
             encoding=encoding,
             unlimited_dims=unlimited_dims,
             compute=compute,
             multifile=False,
             invalid_netcdf=invalid_netcdf,
         )
 
+    # compute=True (default) returns ZarrStore
+    @overload
+    def to_zarr(
+        self,
+        store: MutableMapping | str | PathLike[str] | None = None,
+        chunk_store: MutableMapping | str | PathLike | None = None,
+        mode: Literal["w", "w-", "a", "r+", None] = None,
+        synchronizer=None,
+        group: str | None = None,
+        encoding: Mapping | None = None,
+        compute: Literal[True] = True,
+        consolidated: bool | None = None,
+        append_dim: Hashable | None = None,
+        region: Mapping[str, slice] | None = None,
+        safe_chunks: bool = True,
+        storage_options: dict[str, str] | None = None,
+        zarr_version: int | None = None,
+    ) -> ZarrStore:
+        ...
+
+    # compute=False returns dask.Delayed
+    @overload
+    def to_zarr(
+        self,
+        store: MutableMapping | str | PathLike[str] | None = None,
+        chunk_store: MutableMapping | str | PathLike | None = None,
+        mode: Literal["w", "w-", "a", "r+", None] = None,
+        synchronizer=None,
+        group: str | None = None,
+        encoding: Mapping | None = None,
+        *,
+        compute: Literal[False],
+        consolidated: bool | None = None,
+        append_dim: Hashable | None = None,
+        region: Mapping[str, slice] | None = None,
+        safe_chunks: bool = True,
+        storage_options: dict[str, str] | None = None,
+        zarr_version: int | None = None,
+    ) -> Delayed:
+        ...
+
+    def to_zarr(
+        self,
+        store: MutableMapping | str | PathLike[str] | None = None,
+        chunk_store: MutableMapping | str | PathLike | None = None,
+        mode: Literal["w", "w-", "a", "r+", None] = None,
+        synchronizer=None,
+        group: str | None = None,
+        encoding: Mapping | None = None,
+        compute: bool = True,
+        consolidated: bool | None = None,
+        append_dim: Hashable | None = None,
+        region: Mapping[str, slice] | None = None,
+        safe_chunks: bool = True,
+        storage_options: dict[str, str] | None = None,
+        zarr_version: int | None = None,
+    ) -> ZarrStore | Delayed:
+        """Write DataArray contents to a Zarr store
+
+        Zarr chunks are determined in the following way:
+
+        - From the ``chunks`` attribute in each variable's ``encoding``
+          (can be set via `DataArray.chunk`).
+        - If the variable is a Dask array, from the dask chunks
+        - If neither Dask chunks nor encoding chunks are present, chunks will
+          be determined automatically by Zarr
+        - If both Dask chunks and encoding chunks are present, encoding chunks
+          will be used, provided that there is a many-to-one relationship between
+          encoding chunks and dask chunks (i.e. Dask chunks are bigger than and
+          evenly divide encoding chunks); otherwise raise a ``ValueError``.
+          This restriction ensures that no synchronization / locks are required
+          when writing. To disable this restriction, use ``safe_chunks=False``.
+
+        Parameters
+        ----------
+        store : MutableMapping, str or path-like, optional
+            Store or path to directory in local or remote file system.
+        chunk_store : MutableMapping, str or path-like, optional
+            Store or path to directory in local or remote file system only for Zarr
+            array chunks. Requires zarr-python v2.4.0 or later.
+        mode : {"w", "w-", "a", "r+", None}, optional
+            Persistence mode: "w" means create (overwrite if exists);
+            "w-" means create (fail if exists);
+            "a" means override existing variables (create if does not exist);
+            "r+" means modify existing array *values* only (raise an error if
+            any metadata or shapes would change).
+            The default mode is "a" if ``append_dim`` is set. Otherwise, it is
+            "r+" if ``region`` is set and ``w-`` otherwise.
+        synchronizer : object, optional
+            Zarr array synchronizer.
+        group : str, optional
+            Group path. (a.k.a. `path` in zarr terminology.)
+        encoding : dict, optional
+            Nested dictionary with variable names as keys and dictionaries of
+            variable specific encodings as values, e.g.,
+            ``{"my_variable": {"dtype": "int16", "scale_factor": 0.1,}, ...}``
+        compute : bool, default: True
+            If True write array data immediately, otherwise return a
+            ``dask.delayed.Delayed`` object that can be computed to write
+            array data later. Metadata is always updated eagerly.
+        consolidated : bool, optional
+            If True, apply zarr's `consolidate_metadata` function to the store
+            after writing metadata and read existing stores with consolidated
+            metadata; if False, do not. The default (`consolidated=None`) means
+            write consolidated metadata and attempt to read consolidated
+            metadata for existing stores (falling back to non-consolidated).
+
+            When the experimental ``zarr_version=3``, ``consolidated`` must be
+            either be ``None`` or ``False``.
+        append_dim : hashable, optional
+            If set, the dimension along which the data will be appended. All
+            other dimensions on overridden variables must remain the same size.
+        region : dict, optional
+            Optional mapping from dimension names to integer slices along
+            dataarray dimensions to indicate the region of existing zarr array(s)
+            in which to write this datarray's data. For example,
+            ``{'x': slice(0, 1000), 'y': slice(10000, 11000)}`` would indicate
+            that values should be written to the region ``0:1000`` along ``x``
+            and ``10000:11000`` along ``y``.
+
+            Two restrictions apply to the use of ``region``:
+
+            - If ``region`` is set, _all_ variables in a dataarray must have at
+              least one dimension in common with the region. Other variables
+              should be written in a separate call to ``to_zarr()``.
+            - Dimensions cannot be included in both ``region`` and
+              ``append_dim`` at the same time. To create empty arrays to fill
+              in with ``region``, use a separate call to ``to_zarr()`` with
+              ``compute=False``. See "Appending to existing Zarr stores" in
+              the reference documentation for full details.
+        safe_chunks : bool, default: True
+            If True, only allow writes to when there is a many-to-one relationship
+            between Zarr chunks (specified in encoding) and Dask chunks.
+            Set False to override this restriction; however, data may become corrupted
+            if Zarr arrays are written in parallel. This option may be useful in combination
+            with ``compute=False`` to initialize a Zarr store from an existing
+            DataArray with arbitrary chunk structure.
+        storage_options : dict, optional
+            Any additional parameters for the storage backend (ignored for local
+            paths).
+        zarr_version : int or None, optional
+            The desired zarr spec version to target (currently 2 or 3). The
+            default of None will attempt to determine the zarr version from
+            ``store`` when possible, otherwise defaulting to 2.
+
+        Returns
+        -------
+            * ``dask.delayed.Delayed`` if compute is False
+            * ZarrStore otherwise
+
+        References
+        ----------
+        https://zarr.readthedocs.io/
+
+        Notes
+        -----
+        Zarr chunking behavior:
+            If chunks are found in the encoding argument or attribute
+            corresponding to any DataArray, those chunks are used.
+            If a DataArray is a dask array, it is written with those chunks.
+            If not other chunks are found, Zarr uses its own heuristics to
+            choose automatic chunk sizes.
+
+        encoding:
+            The encoding attribute (if exists) of the DataArray(s) will be
+            used. Override any existing encodings by providing the ``encoding`` kwarg.
+
+        See Also
+        --------
+        Dataset.to_zarr
+        :ref:`io.zarr`
+            The I/O user guide, with more details and examples.
+        """
+        from xarray.backends.api import DATAARRAY_NAME, DATAARRAY_VARIABLE, to_zarr
+
+        if self.name is None:
+            # If no name is set then use a generic xarray name
+            dataset = self.to_dataset(name=DATAARRAY_VARIABLE)
+        elif self.name in self.coords or self.name in self.dims:
+            # The name is the same as one of the coords names, which the netCDF data model
+            # does not support, so rename it but keep track of the old name
+            dataset = self.to_dataset(name=DATAARRAY_VARIABLE)
+            dataset.attrs[DATAARRAY_NAME] = self.name
+        else:
+            # No problems with the name - so we're fine!
+            dataset = self.to_dataset()
+
+        return to_zarr(  # type: ignore[call-overload,misc]
+            dataset,
+            store=store,
+            chunk_store=chunk_store,
+            mode=mode,
+            synchronizer=synchronizer,
+            group=group,
+            encoding=encoding,
+            compute=compute,
+            consolidated=consolidated,
+            append_dim=append_dim,
+            region=region,
+            safe_chunks=safe_chunks,
+            storage_options=storage_options,
+            zarr_version=zarr_version,
+        )
+
     def to_dict(self, data: bool = True, encoding: bool = False) -> dict[str, Any]:
         """
         Convert this xarray.DataArray into a dictionary following xarray
         naming conventions.
 
         Converts all variables and attributes to native Python objects.
         Useful for converting to json. To avoid datetime incompatibility
```

### Comparing `xarray-2023.3.0/xarray/core/dataset.py` & `xarray-2023.4.0/xarray/core/dataset.py`

 * *Files 0% similar despite different names*

```diff
@@ -1337,20775 +1337,20798 @@
 00005380: 696e 670a 0a20 2020 2040 656e 636f 6469  ing..    @encodi
 00005390: 6e67 2e73 6574 7465 720a 2020 2020 6465  ng.setter.    de
 000053a0: 6620 656e 636f 6469 6e67 2873 656c 662c  f encoding(self,
 000053b0: 2076 616c 7565 3a20 4d61 7070 696e 675b   value: Mapping[
 000053c0: 416e 792c 2041 6e79 5d29 202d 3e20 4e6f  Any, Any]) -> No
 000053d0: 6e65 3a0a 2020 2020 2020 2020 7365 6c66  ne:.        self
 000053e0: 2e5f 656e 636f 6469 6e67 203d 2064 6963  ._encoding = dic
-000053f0: 7428 7661 6c75 6529 0a0a 2020 2020 4070  t(value)..    @p
-00005400: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00005410: 6469 6d73 2873 656c 6629 202d 3e20 4672  dims(self) -> Fr
-00005420: 6f7a 656e 5b48 6173 6861 626c 652c 2069  ozen[Hashable, i
-00005430: 6e74 5d3a 0a20 2020 2020 2020 2022 2222  nt]:.        """
-00005440: 4d61 7070 696e 6720 6672 6f6d 2064 696d  Mapping from dim
-00005450: 656e 7369 6f6e 206e 616d 6573 2074 6f20  ension names to 
-00005460: 6c65 6e67 7468 732e 0a0a 2020 2020 2020  lengths...      
-00005470: 2020 4361 6e6e 6f74 2062 6520 6d6f 6469    Cannot be modi
-00005480: 6669 6564 2064 6972 6563 746c 792c 2062  fied directly, b
-00005490: 7574 2069 7320 7570 6461 7465 6420 7768  ut is updated wh
-000054a0: 656e 2061 6464 696e 6720 6e65 7720 7661  en adding new va
-000054b0: 7269 6162 6c65 732e 0a0a 2020 2020 2020  riables...      
-000054c0: 2020 4e6f 7465 2074 6861 7420 7479 7065    Note that type
-000054d0: 206f 6620 7468 6973 206f 626a 6563 7420   of this object 
-000054e0: 6469 6666 6572 7320 6672 6f6d 2060 4461  differs from `Da
-000054f0: 7461 4172 7261 792e 6469 6d73 602e 0a20  taArray.dims`.. 
-00005500: 2020 2020 2020 2053 6565 2060 4461 7461         See `Data
-00005510: 7365 742e 7369 7a65 7360 2061 6e64 2060  set.sizes` and `
-00005520: 4461 7461 4172 7261 792e 7369 7a65 7360  DataArray.sizes`
-00005530: 2066 6f72 2063 6f6e 7369 7374 656e 746c   for consistentl
-00005540: 7920 6e61 6d65 640a 2020 2020 2020 2020  y named.        
-00005550: 7072 6f70 6572 7469 6573 2e0a 0a20 2020  properties...   
-00005560: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
-00005570: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-00005580: 2020 2020 2020 2044 6174 6173 6574 2e73         Dataset.s
-00005590: 697a 6573 0a20 2020 2020 2020 2044 6174  izes.        Dat
-000055a0: 6141 7272 6179 2e64 696d 730a 2020 2020  aArray.dims.    
-000055b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000055c0: 7265 7475 726e 2046 726f 7a65 6e28 7365  return Frozen(se
-000055d0: 6c66 2e5f 6469 6d73 290a 0a20 2020 2040  lf._dims)..    @
-000055e0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-000055f0: 2073 697a 6573 2873 656c 6629 202d 3e20   sizes(self) -> 
-00005600: 4672 6f7a 656e 5b48 6173 6861 626c 652c  Frozen[Hashable,
-00005610: 2069 6e74 5d3a 0a20 2020 2020 2020 2022   int]:.        "
-00005620: 2222 4d61 7070 696e 6720 6672 6f6d 2064  ""Mapping from d
-00005630: 696d 656e 7369 6f6e 206e 616d 6573 2074  imension names t
-00005640: 6f20 6c65 6e67 7468 732e 0a0a 2020 2020  o lengths...    
-00005650: 2020 2020 4361 6e6e 6f74 2062 6520 6d6f      Cannot be mo
-00005660: 6469 6669 6564 2064 6972 6563 746c 792c  dified directly,
-00005670: 2062 7574 2069 7320 7570 6461 7465 6420   but is updated 
-00005680: 7768 656e 2061 6464 696e 6720 6e65 7720  when adding new 
-00005690: 7661 7269 6162 6c65 732e 0a0a 2020 2020  variables...    
-000056a0: 2020 2020 5468 6973 2069 7320 616e 2061      This is an a
-000056b0: 6c69 6173 2066 6f72 2060 4461 7461 7365  lias for `Datase
-000056c0: 742e 6469 6d73 6020 7072 6f76 6964 6564  t.dims` provided
-000056d0: 2066 6f72 2074 6865 2062 656e 6566 6974   for the benefit
-000056e0: 206f 660a 2020 2020 2020 2020 636f 6e73   of.        cons
-000056f0: 6973 7465 6e63 7920 7769 7468 2060 4461  istency with `Da
-00005700: 7461 4172 7261 792e 7369 7a65 7360 2e0a  taArray.sizes`..
-00005710: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-00005720: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-00005730: 2d2d 0a20 2020 2020 2020 2044 6174 6141  --.        DataA
-00005740: 7272 6179 2e73 697a 6573 0a20 2020 2020  rray.sizes.     
-00005750: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00005760: 6574 7572 6e20 7365 6c66 2e64 696d 730a  eturn self.dims.
-00005770: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00005780: 2020 2064 6566 2064 7479 7065 7328 7365     def dtypes(se
-00005790: 6c66 2920 2d3e 2046 726f 7a65 6e5b 4861  lf) -> Frozen[Ha
-000057a0: 7368 6162 6c65 2c20 6e70 2e64 7479 7065  shable, np.dtype
-000057b0: 5d3a 0a20 2020 2020 2020 2022 2222 4d61  ]:.        """Ma
-000057c0: 7070 696e 6720 6672 6f6d 2064 6174 6120  pping from data 
-000057d0: 7661 7269 6162 6c65 206e 616d 6573 2074  variable names t
-000057e0: 6f20 6474 7970 6573 2e0a 0a20 2020 2020  o dtypes...     
-000057f0: 2020 2043 616e 6e6f 7420 6265 206d 6f64     Cannot be mod
-00005800: 6966 6965 6420 6469 7265 6374 6c79 2c20  ified directly, 
-00005810: 6275 7420 6973 2075 7064 6174 6564 2077  but is updated w
-00005820: 6865 6e20 6164 6469 6e67 206e 6577 2076  hen adding new v
-00005830: 6172 6961 626c 6573 2e0a 0a20 2020 2020  ariables...     
-00005840: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-00005850: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00005860: 2020 2020 2044 6174 6141 7272 6179 2e64       DataArray.d
-00005870: 7479 7065 0a20 2020 2020 2020 2022 2222  type.        """
-00005880: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00005890: 4672 6f7a 656e 280a 2020 2020 2020 2020  Frozen(.        
-000058a0: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
-000058b0: 2020 2020 2020 6e3a 2076 2e64 7479 7065        n: v.dtype
-000058c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000058d0: 2066 6f72 206e 2c20 7620 696e 2073 656c   for n, v in sel
-000058e0: 662e 5f76 6172 6961 626c 6573 2e69 7465  f._variables.ite
-000058f0: 6d73 2829 0a20 2020 2020 2020 2020 2020  ms().           
-00005900: 2020 2020 2069 6620 6e20 6e6f 7420 696e       if n not in
-00005910: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
-00005920: 6573 0a20 2020 2020 2020 2020 2020 207d  es.            }
-00005930: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00005940: 6465 6620 6c6f 6164 2873 656c 663a 2054  def load(self: T
-00005950: 5f44 6174 6173 6574 2c20 2a2a 6b77 6172  _Dataset, **kwar
-00005960: 6773 2920 2d3e 2054 5f44 6174 6173 6574  gs) -> T_Dataset
-00005970: 3a0a 2020 2020 2020 2020 2222 224d 616e  :.        """Man
-00005980: 7561 6c6c 7920 7472 6967 6765 7220 6c6f  ually trigger lo
-00005990: 6164 696e 6720 616e 642f 6f72 2063 6f6d  ading and/or com
-000059a0: 7075 7461 7469 6f6e 206f 6620 7468 6973  putation of this
-000059b0: 2064 6174 6173 6574 2773 2064 6174 610a   dataset's data.
-000059c0: 2020 2020 2020 2020 6672 6f6d 2064 6973          from dis
-000059d0: 6b20 6f72 2061 2072 656d 6f74 6520 736f  k or a remote so
-000059e0: 7572 6365 2069 6e74 6f20 6d65 6d6f 7279  urce into memory
-000059f0: 2061 6e64 2072 6574 7572 6e20 7468 6973   and return this
-00005a00: 2064 6174 6173 6574 2e0a 2020 2020 2020   dataset..      
-00005a10: 2020 556e 6c69 6b65 2063 6f6d 7075 7465    Unlike compute
-00005a20: 2c20 7468 6520 6f72 6967 696e 616c 2064  , the original d
-00005a30: 6174 6173 6574 2069 7320 6d6f 6469 6669  ataset is modifi
-00005a40: 6564 2061 6e64 2072 6574 7572 6e65 642e  ed and returned.
-00005a50: 0a0a 2020 2020 2020 2020 4e6f 726d 616c  ..        Normal
-00005a60: 6c79 2c20 6974 2073 686f 756c 6420 6e6f  ly, it should no
-00005a70: 7420 6265 206e 6563 6573 7361 7279 2074  t be necessary t
-00005a80: 6f20 6361 6c6c 2074 6869 7320 6d65 7468  o call this meth
-00005a90: 6f64 2069 6e20 7573 6572 2063 6f64 652c  od in user code,
-00005aa0: 0a20 2020 2020 2020 2062 6563 6175 7365  .        because
-00005ab0: 2061 6c6c 2078 6172 7261 7920 6675 6e63   all xarray func
-00005ac0: 7469 6f6e 7320 7368 6f75 6c64 2065 6974  tions should eit
-00005ad0: 6865 7220 776f 726b 206f 6e20 6465 6665  her work on defe
-00005ae0: 7272 6564 2064 6174 6120 6f72 0a20 2020  rred data or.   
-00005af0: 2020 2020 206c 6f61 6420 6461 7461 2061       load data a
-00005b00: 7574 6f6d 6174 6963 616c 6c79 2e20 486f  utomatically. Ho
-00005b10: 7765 7665 722c 2074 6869 7320 6d65 7468  wever, this meth
-00005b20: 6f64 2063 616e 2062 6520 6e65 6365 7373  od can be necess
-00005b30: 6172 7920 7768 656e 0a20 2020 2020 2020  ary when.       
-00005b40: 2077 6f72 6b69 6e67 2077 6974 6820 6d61   working with ma
-00005b50: 6e79 2066 696c 6520 6f62 6a65 6374 7320  ny file objects 
-00005b60: 6f6e 2064 6973 6b2e 0a0a 2020 2020 2020  on disk...      
-00005b70: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00005b80: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00005b90: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-00005ba0: 203a 2064 6963 740a 2020 2020 2020 2020   : dict.        
-00005bb0: 2020 2020 4164 6469 7469 6f6e 616c 206b      Additional k
-00005bc0: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-00005bd0: 2070 6173 7365 6420 6f6e 2074 6f20 6060   passed on to ``
-00005be0: 6461 736b 2e63 6f6d 7075 7465 6060 2e0a  dask.compute``..
-00005bf0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-00005c00: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-00005c10: 2d2d 0a20 2020 2020 2020 2064 6173 6b2e  --.        dask.
-00005c20: 636f 6d70 7574 650a 2020 2020 2020 2020  compute.        
-00005c30: 2222 220a 2020 2020 2020 2020 2320 6163  """.        # ac
-00005c40: 6365 7373 202e 6461 7461 2074 6f20 636f  cess .data to co
-00005c50: 6572 6365 2065 7665 7279 7468 696e 6720  erce everything 
-00005c60: 746f 206e 756d 7079 206f 7220 6461 736b  to numpy or dask
-00005c70: 2061 7272 6179 730a 2020 2020 2020 2020   arrays.        
-00005c80: 6c61 7a79 5f64 6174 6120 3d20 7b0a 2020  lazy_data = {.  
-00005c90: 2020 2020 2020 2020 2020 6b3a 2076 2e5f            k: v._
-00005ca0: 6461 7461 2066 6f72 206b 2c20 7620 696e  data for k, v in
-00005cb0: 2073 656c 662e 7661 7269 6162 6c65 732e   self.variables.
-00005cc0: 6974 656d 7328 2920 6966 2069 735f 6475  items() if is_du
-00005cd0: 636b 5f64 6173 6b5f 6172 7261 7928 762e  ck_dask_array(v.
-00005ce0: 5f64 6174 6129 0a20 2020 2020 2020 207d  _data).        }
-00005cf0: 0a20 2020 2020 2020 2069 6620 6c61 7a79  .        if lazy
-00005d00: 5f64 6174 613a 0a20 2020 2020 2020 2020  _data:.         
-00005d10: 2020 2069 6d70 6f72 7420 6461 736b 2e61     import dask.a
-00005d20: 7272 6179 2061 7320 6461 0a0a 2020 2020  rray as da..    
-00005d30: 2020 2020 2020 2020 2320 6576 616c 7561          # evalua
-00005d40: 7465 2061 6c6c 2074 6865 2064 6173 6b20  te all the dask 
-00005d50: 6172 7261 7973 2073 696d 756c 7461 6e65  arrays simultane
-00005d60: 6f75 736c 790a 2020 2020 2020 2020 2020  ously.          
-00005d70: 2020 6576 616c 7561 7465 645f 6461 7461    evaluated_data
-00005d80: 203d 2064 612e 636f 6d70 7574 6528 2a6c   = da.compute(*l
-00005d90: 617a 795f 6461 7461 2e76 616c 7565 7328  azy_data.values(
-00005da0: 292c 202a 2a6b 7761 7267 7329 0a0a 2020  ), **kwargs)..  
-00005db0: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
-00005dc0: 2064 6174 6120 696e 207a 6970 286c 617a   data in zip(laz
-00005dd0: 795f 6461 7461 2c20 6576 616c 7561 7465  y_data, evaluate
-00005de0: 645f 6461 7461 293a 0a20 2020 2020 2020  d_data):.       
-00005df0: 2020 2020 2020 2020 2073 656c 662e 7661           self.va
-00005e00: 7269 6162 6c65 735b 6b5d 2e64 6174 6120  riables[k].data 
-00005e10: 3d20 6461 7461 0a0a 2020 2020 2020 2020  = data..        
-00005e20: 2320 6c6f 6164 2065 7665 7279 7468 696e  # load everythin
-00005e30: 6720 656c 7365 2073 6571 7565 6e74 6961  g else sequentia
-00005e40: 6c6c 790a 2020 2020 2020 2020 666f 7220  lly.        for 
-00005e50: 6b2c 2076 2069 6e20 7365 6c66 2e76 6172  k, v in self.var
-00005e60: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
-00005e70: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00005e80: 206e 6f74 2069 6e20 6c61 7a79 5f64 6174   not in lazy_dat
-00005e90: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
-00005ea0: 2020 2076 2e6c 6f61 6428 290a 0a20 2020     v.load()..   
-00005eb0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00005ec0: 0a0a 2020 2020 6465 6620 5f5f 6461 736b  ..    def __dask
-00005ed0: 5f74 6f6b 656e 697a 655f 5f28 7365 6c66  _tokenize__(self
-00005ee0: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
-00005ef0: 6461 736b 2e62 6173 6520 696d 706f 7274  dask.base import
-00005f00: 206e 6f72 6d61 6c69 7a65 5f74 6f6b 656e   normalize_token
-00005f10: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00005f20: 206e 6f72 6d61 6c69 7a65 5f74 6f6b 656e   normalize_token
-00005f30: 280a 2020 2020 2020 2020 2020 2020 2874  (.            (t
-00005f40: 7970 6528 7365 6c66 292c 2073 656c 662e  ype(self), self.
-00005f50: 5f76 6172 6961 626c 6573 2c20 7365 6c66  _variables, self
-00005f60: 2e5f 636f 6f72 645f 6e61 6d65 732c 2073  ._coord_names, s
-00005f70: 656c 662e 5f61 7474 7273 290a 2020 2020  elf._attrs).    
-00005f80: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
-00005f90: 5f64 6173 6b5f 6772 6170 685f 5f28 7365  _dask_graph__(se
-00005fa0: 6c66 293a 0a20 2020 2020 2020 2067 7261  lf):.        gra
-00005fb0: 7068 7320 3d20 7b6b 3a20 762e 5f5f 6461  phs = {k: v.__da
-00005fc0: 736b 5f67 7261 7068 5f5f 2829 2066 6f72  sk_graph__() for
-00005fd0: 206b 2c20 7620 696e 2073 656c 662e 7661   k, v in self.va
-00005fe0: 7269 6162 6c65 732e 6974 656d 7328 297d  riables.items()}
-00005ff0: 0a20 2020 2020 2020 2067 7261 7068 7320  .        graphs 
-00006000: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
-00006010: 2069 6e20 6772 6170 6873 2e69 7465 6d73   in graphs.items
-00006020: 2829 2069 6620 7620 6973 206e 6f74 204e  () if v is not N
-00006030: 6f6e 657d 0a20 2020 2020 2020 2069 6620  one}.        if 
-00006040: 6e6f 7420 6772 6170 6873 3a0a 2020 2020  not graphs:.    
-00006050: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00006060: 6f6e 650a 2020 2020 2020 2020 656c 7365  one.        else
-00006070: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-00006080: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00006090: 2020 2066 726f 6d20 6461 736b 2e68 6967     from dask.hig
-000060a0: 686c 6576 656c 6772 6170 6820 696d 706f  hlevelgraph impo
-000060b0: 7274 2048 6967 684c 6576 656c 4772 6170  rt HighLevelGrap
-000060c0: 680a 0a20 2020 2020 2020 2020 2020 2020  h..             
-000060d0: 2020 2072 6574 7572 6e20 4869 6768 4c65     return HighLe
-000060e0: 7665 6c47 7261 7068 2e6d 6572 6765 282a  velGraph.merge(*
-000060f0: 6772 6170 6873 2e76 616c 7565 7328 2929  graphs.values())
-00006100: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00006110: 6570 7420 496d 706f 7274 4572 726f 723a  ept ImportError:
-00006120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006130: 2066 726f 6d20 6461 736b 2069 6d70 6f72   from dask impor
-00006140: 7420 7368 6172 6564 6963 740a 0a20 2020  t sharedict..   
-00006150: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00006160: 7572 6e20 7368 6172 6564 6963 742e 6d65  urn sharedict.me
-00006170: 7267 6528 2a67 7261 7068 732e 7661 6c75  rge(*graphs.valu
-00006180: 6573 2829 290a 0a20 2020 2064 6566 205f  es())..    def _
-00006190: 5f64 6173 6b5f 6b65 7973 5f5f 2873 656c  _dask_keys__(sel
-000061a0: 6629 3a0a 2020 2020 2020 2020 696d 706f  f):.        impo
-000061b0: 7274 2064 6173 6b0a 0a20 2020 2020 2020  rt dask..       
-000061c0: 2072 6574 7572 6e20 5b0a 2020 2020 2020   return [.      
-000061d0: 2020 2020 2020 762e 5f5f 6461 736b 5f6b        v.__dask_k
-000061e0: 6579 735f 5f28 290a 2020 2020 2020 2020  eys__().        
-000061f0: 2020 2020 666f 7220 7620 696e 2073 656c      for v in sel
-00006200: 662e 7661 7269 6162 6c65 732e 7661 6c75  f.variables.valu
-00006210: 6573 2829 0a20 2020 2020 2020 2020 2020  es().           
-00006220: 2069 6620 6461 736b 2e69 735f 6461 736b   if dask.is_dask
-00006230: 5f63 6f6c 6c65 6374 696f 6e28 7629 0a20  _collection(v). 
-00006240: 2020 2020 2020 205d 0a0a 2020 2020 6465         ]..    de
-00006250: 6620 5f5f 6461 736b 5f6c 6179 6572 735f  f __dask_layers_
-00006260: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-00006270: 2069 6d70 6f72 7420 6461 736b 0a0a 2020   import dask..  
-00006280: 2020 2020 2020 7265 7475 726e 2073 756d        return sum
-00006290: 280a 2020 2020 2020 2020 2020 2020 280a  (.            (.
-000062a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000062b0: 762e 5f5f 6461 736b 5f6c 6179 6572 735f  v.__dask_layers_
-000062c0: 5f28 290a 2020 2020 2020 2020 2020 2020  _().            
-000062d0: 2020 2020 666f 7220 7620 696e 2073 656c      for v in sel
-000062e0: 662e 7661 7269 6162 6c65 732e 7661 6c75  f.variables.valu
-000062f0: 6573 2829 0a20 2020 2020 2020 2020 2020  es().           
-00006300: 2020 2020 2069 6620 6461 736b 2e69 735f       if dask.is_
-00006310: 6461 736b 5f63 6f6c 6c65 6374 696f 6e28  dask_collection(
-00006320: 7629 0a20 2020 2020 2020 2020 2020 2029  v).            )
-00006330: 2c0a 2020 2020 2020 2020 2020 2020 2829  ,.            ()
-00006340: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00006350: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00006360: 6566 205f 5f64 6173 6b5f 6f70 7469 6d69  ef __dask_optimi
-00006370: 7a65 5f5f 2873 656c 6629 3a0a 2020 2020  ze__(self):.    
-00006380: 2020 2020 696d 706f 7274 2064 6173 6b2e      import dask.
-00006390: 6172 7261 7920 6173 2064 610a 0a20 2020  array as da..   
-000063a0: 2020 2020 2072 6574 7572 6e20 6461 2e41       return da.A
-000063b0: 7272 6179 2e5f 5f64 6173 6b5f 6f70 7469  rray.__dask_opti
-000063c0: 6d69 7a65 5f5f 0a0a 2020 2020 4070 726f  mize__..    @pro
-000063d0: 7065 7274 790a 2020 2020 6465 6620 5f5f  perty.    def __
-000063e0: 6461 736b 5f73 6368 6564 756c 6572 5f5f  dask_scheduler__
-000063f0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00006400: 696d 706f 7274 2064 6173 6b2e 6172 7261  import dask.arra
-00006410: 7920 6173 2064 610a 0a20 2020 2020 2020  y as da..       
-00006420: 2072 6574 7572 6e20 6461 2e41 7272 6179   return da.Array
-00006430: 2e5f 5f64 6173 6b5f 7363 6865 6475 6c65  .__dask_schedule
-00006440: 725f 5f0a 0a20 2020 2064 6566 205f 5f64  r__..    def __d
-00006450: 6173 6b5f 706f 7374 636f 6d70 7574 655f  ask_postcompute_
-00006460: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-00006470: 2072 6574 7572 6e20 7365 6c66 2e5f 6461   return self._da
-00006480: 736b 5f70 6f73 7463 6f6d 7075 7465 2c20  sk_postcompute, 
-00006490: 2829 0a0a 2020 2020 6465 6620 5f5f 6461  ()..    def __da
-000064a0: 736b 5f70 6f73 7470 6572 7369 7374 5f5f  sk_postpersist__
-000064b0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000064c0: 7265 7475 726e 2073 656c 662e 5f64 6173  return self._das
-000064d0: 6b5f 706f 7374 7065 7273 6973 742c 2028  k_postpersist, (
-000064e0: 290a 0a20 2020 2064 6566 205f 6461 736b  )..    def _dask
-000064f0: 5f70 6f73 7463 6f6d 7075 7465 2873 656c  _postcompute(sel
-00006500: 663a 2054 5f44 6174 6173 6574 2c20 7265  f: T_Dataset, re
-00006510: 7375 6c74 733a 2049 7465 7261 626c 655b  sults: Iterable[
-00006520: 5661 7269 6162 6c65 5d29 202d 3e20 545f  Variable]) -> T_
-00006530: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-00006540: 2069 6d70 6f72 7420 6461 736b 0a0a 2020   import dask..  
-00006550: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
-00006560: 3d20 7b7d 0a20 2020 2020 2020 2072 6573  = {}.        res
-00006570: 756c 7473 5f69 7465 7220 3d20 6974 6572  ults_iter = iter
-00006580: 2872 6573 756c 7473 290a 0a20 2020 2020  (results)..     
-00006590: 2020 2066 6f72 206b 2c20 7620 696e 2073     for k, v in s
-000065a0: 656c 662e 5f76 6172 6961 626c 6573 2e69  elf._variables.i
-000065b0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-000065c0: 2020 2020 6966 2064 6173 6b2e 6973 5f64      if dask.is_d
-000065d0: 6173 6b5f 636f 6c6c 6563 7469 6f6e 2876  ask_collection(v
-000065e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000065f0: 2020 2072 6562 7569 6c64 2c20 6172 6773     rebuild, args
-00006600: 203d 2076 2e5f 5f64 6173 6b5f 706f 7374   = v.__dask_post
-00006610: 636f 6d70 7574 655f 5f28 290a 2020 2020  compute__().    
-00006620: 2020 2020 2020 2020 2020 2020 7620 3d20              v = 
-00006630: 7265 6275 696c 6428 6e65 7874 2872 6573  rebuild(next(res
-00006640: 756c 7473 5f69 7465 7229 2c20 2a61 7267  ults_iter), *arg
-00006650: 7329 0a20 2020 2020 2020 2020 2020 2076  s).            v
-00006660: 6172 6961 626c 6573 5b6b 5d20 3d20 760a  ariables[k] = v.
-00006670: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00006680: 7479 7065 2873 656c 6629 2e5f 636f 6e73  type(self)._cons
-00006690: 7472 7563 745f 6469 7265 6374 280a 2020  truct_direct(.  
-000066a0: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-000066b0: 6c65 732c 0a20 2020 2020 2020 2020 2020  les,.           
-000066c0: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
-000066d0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-000066e0: 7365 6c66 2e5f 6469 6d73 2c0a 2020 2020  self._dims,.    
-000066f0: 2020 2020 2020 2020 7365 6c66 2e5f 6174          self._at
-00006700: 7472 732c 0a20 2020 2020 2020 2020 2020  trs,.           
-00006710: 2073 656c 662e 5f69 6e64 6578 6573 2c0a   self._indexes,.
-00006720: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006730: 2e5f 656e 636f 6469 6e67 2c0a 2020 2020  ._encoding,.    
-00006740: 2020 2020 2020 2020 7365 6c66 2e5f 636c          self._cl
-00006750: 6f73 652c 0a20 2020 2020 2020 2029 0a0a  ose,.        )..
-00006760: 2020 2020 6465 6620 5f64 6173 6b5f 706f      def _dask_po
-00006770: 7374 7065 7273 6973 7428 0a20 2020 2020  stpersist(.     
-00006780: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-00006790: 6574 2c20 6473 6b3a 204d 6170 7069 6e67  et, dsk: Mapping
-000067a0: 2c20 2a2c 2072 656e 616d 653a 204d 6170  , *, rename: Map
-000067b0: 7069 6e67 5b73 7472 2c20 7374 725d 207c  ping[str, str] |
-000067c0: 204e 6f6e 6520 3d20 4e6f 6e65 0a20 2020   None = None.   
-000067d0: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
-000067e0: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-000067f0: 736b 2069 6d70 6f72 7420 6973 5f64 6173  sk import is_das
-00006800: 6b5f 636f 6c6c 6563 7469 6f6e 0a20 2020  k_collection.   
-00006810: 2020 2020 2066 726f 6d20 6461 736b 2e68       from dask.h
-00006820: 6967 686c 6576 656c 6772 6170 6820 696d  ighlevelgraph im
-00006830: 706f 7274 2048 6967 684c 6576 656c 4772  port HighLevelGr
-00006840: 6170 680a 2020 2020 2020 2020 6672 6f6d  aph.        from
-00006850: 2064 6173 6b2e 6f70 7469 6d69 7a61 7469   dask.optimizati
-00006860: 6f6e 2069 6d70 6f72 7420 6375 6c6c 0a0a  on import cull..
-00006870: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-00006880: 7320 3d20 7b7d 0a0a 2020 2020 2020 2020  s = {}..        
-00006890: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
-000068a0: 2e5f 7661 7269 6162 6c65 732e 6974 656d  ._variables.item
-000068b0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-000068c0: 2069 6620 6e6f 7420 6973 5f64 6173 6b5f   if not is_dask_
-000068d0: 636f 6c6c 6563 7469 6f6e 2876 293a 0a20  collection(v):. 
-000068e0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000068f0: 6172 6961 626c 6573 5b6b 5d20 3d20 760a  ariables[k] = v.
-00006900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006910: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
-00006920: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00006930: 6e63 6528 6473 6b2c 2048 6967 684c 6576  nce(dsk, HighLev
-00006940: 656c 4772 6170 6829 3a0a 2020 2020 2020  elGraph):.      
-00006950: 2020 2020 2020 2020 2020 2320 6461 736b            # dask
-00006960: 203e 3d20 3230 3231 2e33 0a20 2020 2020   >= 2021.3.     
-00006970: 2020 2020 2020 2020 2020 2023 205f 5f64             # __d
-00006980: 6173 6b5f 706f 7374 7065 7273 6973 745f  ask_postpersist_
-00006990: 5f28 2920 7761 7320 6361 6c6c 6564 2062  _() was called b
-000069a0: 7920 6461 736b 2e68 6967 686c 6576 656c  y dask.highlevel
-000069b0: 6772 6170 682e 0a20 2020 2020 2020 2020  graph..         
-000069c0: 2020 2020 2020 2023 2044 6f6e 2774 2075         # Don't u
-000069d0: 7365 2064 736b 2e63 756c 6c28 292c 2061  se dsk.cull(), a
-000069e0: 7320 7765 206e 6565 6420 746f 2070 7265  s we need to pre
-000069f0: 7665 6e74 2070 6172 7469 616c 206c 6179  vent partial lay
-00006a00: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
-00006a10: 2020 2020 2023 2068 7474 7073 3a2f 2f67       # https://g
-00006a20: 6974 6875 622e 636f 6d2f 6461 736b 2f64  ithub.com/dask/d
-00006a30: 6173 6b2f 6973 7375 6573 2f37 3133 370a  ask/issues/7137.
-00006a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a50: 6c61 7965 7273 203d 2076 2e5f 5f64 6173  layers = v.__das
-00006a60: 6b5f 6c61 7965 7273 5f5f 2829 0a20 2020  k_layers__().   
-00006a70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00006a80: 7265 6e61 6d65 3a0a 2020 2020 2020 2020  rename:.        
-00006a90: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00006aa0: 7273 203d 205b 7265 6e61 6d65 2e67 6574  rs = [rename.get
-00006ab0: 286b 2c20 6b29 2066 6f72 206b 2069 6e20  (k, k) for k in 
-00006ac0: 6c61 7965 7273 5d0a 2020 2020 2020 2020  layers].        
-00006ad0: 2020 2020 2020 2020 6473 6b32 203d 2064          dsk2 = d
-00006ae0: 736b 2e63 756c 6c5f 6c61 7965 7273 286c  sk.cull_layers(l
-00006af0: 6179 6572 7329 0a20 2020 2020 2020 2020  ayers).         
-00006b00: 2020 2065 6c69 6620 7265 6e61 6d65 3a20     elif rename: 
-00006b10: 2023 2070 7261 676d 613a 206e 6f63 6f76   # pragma: nocov
-00006b20: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-00006b30: 2020 2023 2041 7420 7468 6520 6d6f 6d65     # At the mome
-00006b40: 6e74 206f 6620 7772 6974 696e 672c 2074  nt of writing, t
-00006b50: 6869 7320 6973 206f 6e6c 7920 666f 7220  his is only for 
-00006b60: 666f 7277 6172 6420 636f 6d70 6174 6962  forward compatib
-00006b70: 696c 6974 792e 0a20 2020 2020 2020 2020  ility..         
-00006b80: 2020 2020 2020 2023 2072 6570 6c61 6365         # replace
-00006b90: 5f6e 616d 655f 696e 5f6b 6579 2072 6571  _name_in_key req
-00006ba0: 7569 7265 7320 6461 736b 203e 3d20 3230  uires dask >= 20
-00006bb0: 3231 2e33 2e0a 2020 2020 2020 2020 2020  21.3..          
-00006bc0: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-00006bd0: 6261 7365 2069 6d70 6f72 7420 666c 6174  base import flat
-00006be0: 7465 6e2c 2072 6570 6c61 6365 5f6e 616d  ten, replace_nam
-00006bf0: 655f 696e 5f6b 6579 0a0a 2020 2020 2020  e_in_key..      
-00006c00: 2020 2020 2020 2020 2020 6b65 7973 203d            keys =
-00006c10: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
-00006c20: 2020 2020 2020 2072 6570 6c61 6365 5f6e         replace_n
-00006c30: 616d 655f 696e 5f6b 6579 286b 2c20 7265  ame_in_key(k, re
-00006c40: 6e61 6d65 2920 666f 7220 6b20 696e 2066  name) for k in f
-00006c50: 6c61 7474 656e 2876 2e5f 5f64 6173 6b5f  latten(v.__dask_
-00006c60: 6b65 7973 5f5f 2829 290a 2020 2020 2020  keys__()).      
-00006c70: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-00006c80: 2020 2020 2020 2020 2020 2020 6473 6b32              dsk2
-00006c90: 2c20 5f20 3d20 6375 6c6c 2864 736b 2c20  , _ = cull(dsk, 
-00006ca0: 6b65 7973 290a 2020 2020 2020 2020 2020  keys).          
-00006cb0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00006cc0: 2020 2020 2020 2020 2320 5f5f 6461 736b          # __dask
-00006cd0: 5f70 6f73 7470 6572 7369 7374 5f5f 2829  _postpersist__()
-00006ce0: 2077 6173 2063 616c 6c65 6420 6279 2064   was called by d
-00006cf0: 6173 6b2e 6f70 7469 6d69 7a65 206f 7220  ask.optimize or 
-00006d00: 6461 736b 2e70 6572 7369 7374 0a20 2020  dask.persist.   
-00006d10: 2020 2020 2020 2020 2020 2020 2064 736b               dsk
-00006d20: 322c 205f 203d 2063 756c 6c28 6473 6b2c  2, _ = cull(dsk,
-00006d30: 2076 2e5f 5f64 6173 6b5f 6b65 7973 5f5f   v.__dask_keys__
-00006d40: 2829 290a 0a20 2020 2020 2020 2020 2020  ())..           
-00006d50: 2072 6562 7569 6c64 2c20 6172 6773 203d   rebuild, args =
-00006d60: 2076 2e5f 5f64 6173 6b5f 706f 7374 7065   v.__dask_postpe
-00006d70: 7273 6973 745f 5f28 290a 2020 2020 2020  rsist__().      
-00006d80: 2020 2020 2020 2320 7265 6e61 6d65 2077        # rename w
-00006d90: 6173 2061 6464 6564 2069 6e20 6461 736b  as added in dask
-00006da0: 2032 3032 312e 330a 2020 2020 2020 2020   2021.3.        
-00006db0: 2020 2020 6b77 6172 6773 203d 207b 2272      kwargs = {"r
-00006dc0: 656e 616d 6522 3a20 7265 6e61 6d65 7d20  ename": rename} 
-00006dd0: 6966 2072 656e 616d 6520 656c 7365 207b  if rename else {
-00006de0: 7d0a 2020 2020 2020 2020 2020 2020 7661  }.            va
-00006df0: 7269 6162 6c65 735b 6b5d 203d 2072 6562  riables[k] = reb
-00006e00: 7569 6c64 2864 736b 322c 202a 6172 6773  uild(dsk2, *args
-00006e10: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
-00006e20: 2020 2020 2072 6574 7572 6e20 7479 7065       return type
-00006e30: 2873 656c 6629 2e5f 636f 6e73 7472 7563  (self)._construc
-00006e40: 745f 6469 7265 6374 280a 2020 2020 2020  t_direct(.      
-00006e50: 2020 2020 2020 7661 7269 6162 6c65 732c        variables,
-00006e60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00006e70: 662e 5f63 6f6f 7264 5f6e 616d 6573 2c0a  f._coord_names,.
-00006e80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006e90: 2e5f 6469 6d73 2c0a 2020 2020 2020 2020  ._dims,.        
-00006ea0: 2020 2020 7365 6c66 2e5f 6174 7472 732c      self._attrs,
-00006eb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00006ec0: 662e 5f69 6e64 6578 6573 2c0a 2020 2020  f._indexes,.    
-00006ed0: 2020 2020 2020 2020 7365 6c66 2e5f 656e          self._en
-00006ee0: 636f 6469 6e67 2c0a 2020 2020 2020 2020  coding,.        
-00006ef0: 2020 2020 7365 6c66 2e5f 636c 6f73 652c      self._close,
-00006f00: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00006f10: 6465 6620 636f 6d70 7574 6528 7365 6c66  def compute(self
-00006f20: 3a20 545f 4461 7461 7365 742c 202a 2a6b  : T_Dataset, **k
-00006f30: 7761 7267 7329 202d 3e20 545f 4461 7461  wargs) -> T_Data
-00006f40: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
-00006f50: 4d61 6e75 616c 6c79 2074 7269 6767 6572  Manually trigger
-00006f60: 206c 6f61 6469 6e67 2061 6e64 2f6f 7220   loading and/or 
-00006f70: 636f 6d70 7574 6174 696f 6e20 6f66 2074  computation of t
-00006f80: 6869 7320 6461 7461 7365 7427 7320 6461  his dataset's da
-00006f90: 7461 0a20 2020 2020 2020 2066 726f 6d20  ta.        from 
-00006fa0: 6469 736b 206f 7220 6120 7265 6d6f 7465  disk or a remote
-00006fb0: 2073 6f75 7263 6520 696e 746f 206d 656d   source into mem
-00006fc0: 6f72 7920 616e 6420 7265 7475 726e 2061  ory and return a
-00006fd0: 206e 6577 2064 6174 6173 6574 2e0a 2020   new dataset..  
-00006fe0: 2020 2020 2020 556e 6c69 6b65 206c 6f61        Unlike loa
-00006ff0: 642c 2074 6865 206f 7269 6769 6e61 6c20  d, the original 
-00007000: 6461 7461 7365 7420 6973 206c 6566 7420  dataset is left 
-00007010: 756e 616c 7465 7265 642e 0a0a 2020 2020  unaltered...    
-00007020: 2020 2020 4e6f 726d 616c 6c79 2c20 6974      Normally, it
-00007030: 2073 686f 756c 6420 6e6f 7420 6265 206e   should not be n
-00007040: 6563 6573 7361 7279 2074 6f20 6361 6c6c  ecessary to call
-00007050: 2074 6869 7320 6d65 7468 6f64 2069 6e20   this method in 
-00007060: 7573 6572 2063 6f64 652c 0a20 2020 2020  user code,.     
-00007070: 2020 2062 6563 6175 7365 2061 6c6c 2078     because all x
-00007080: 6172 7261 7920 6675 6e63 7469 6f6e 7320  array functions 
-00007090: 7368 6f75 6c64 2065 6974 6865 7220 776f  should either wo
-000070a0: 726b 206f 6e20 6465 6665 7272 6564 2064  rk on deferred d
-000070b0: 6174 6120 6f72 0a20 2020 2020 2020 206c  ata or.        l
-000070c0: 6f61 6420 6461 7461 2061 7574 6f6d 6174  oad data automat
-000070d0: 6963 616c 6c79 2e20 486f 7765 7665 722c  ically. However,
-000070e0: 2074 6869 7320 6d65 7468 6f64 2063 616e   this method can
-000070f0: 2062 6520 6e65 6365 7373 6172 7920 7768   be necessary wh
-00007100: 656e 0a20 2020 2020 2020 2077 6f72 6b69  en.        worki
-00007110: 6e67 2077 6974 6820 6d61 6e79 2066 696c  ng with many fil
-00007120: 6520 6f62 6a65 6374 7320 6f6e 2064 6973  e objects on dis
-00007130: 6b2e 0a0a 2020 2020 2020 2020 5061 7261  k...        Para
-00007140: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-00007150: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00007160: 2020 2a2a 6b77 6172 6773 203a 2064 6963    **kwargs : dic
-00007170: 740a 2020 2020 2020 2020 2020 2020 4164  t.            Ad
-00007180: 6469 7469 6f6e 616c 206b 6579 776f 7264  ditional keyword
-00007190: 2061 7267 756d 656e 7473 2070 6173 7365   arguments passe
-000071a0: 6420 6f6e 2074 6f20 6060 6461 736b 2e63  d on to ``dask.c
-000071b0: 6f6d 7075 7465 6060 2e0a 0a20 2020 2020  ompute``...     
-000071c0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-000071d0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-000071e0: 2020 2020 2064 6173 6b2e 636f 6d70 7574       dask.comput
-000071f0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
-00007200: 2020 2020 2020 6e65 7720 3d20 7365 6c66        new = self
-00007210: 2e63 6f70 7928 6465 6570 3d46 616c 7365  .copy(deep=False
-00007220: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00007230: 206e 6577 2e6c 6f61 6428 2a2a 6b77 6172   new.load(**kwar
-00007240: 6773 290a 0a20 2020 2064 6566 205f 7065  gs)..    def _pe
-00007250: 7273 6973 745f 696e 706c 6163 6528 7365  rsist_inplace(se
-00007260: 6c66 3a20 545f 4461 7461 7365 742c 202a  lf: T_Dataset, *
-00007270: 2a6b 7761 7267 7329 202d 3e20 545f 4461  *kwargs) -> T_Da
-00007280: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
-00007290: 2222 5065 7273 6973 7420 616c 6c20 4461  ""Persist all Da
-000072a0: 736b 2061 7272 6179 7320 696e 206d 656d  sk arrays in mem
-000072b0: 6f72 7922 2222 0a20 2020 2020 2020 2023  ory""".        #
-000072c0: 2061 6363 6573 7320 2e64 6174 6120 746f   access .data to
-000072d0: 2063 6f65 7263 6520 6576 6572 7974 6869   coerce everythi
-000072e0: 6e67 2074 6f20 6e75 6d70 7920 6f72 2064  ng to numpy or d
-000072f0: 6173 6b20 6172 7261 7973 0a20 2020 2020  ask arrays.     
-00007300: 2020 206c 617a 795f 6461 7461 203d 207b     lazy_data = {
-00007310: 0a20 2020 2020 2020 2020 2020 206b 3a20  .            k: 
-00007320: 762e 5f64 6174 6120 666f 7220 6b2c 2076  v._data for k, v
-00007330: 2069 6e20 7365 6c66 2e76 6172 6961 626c   in self.variabl
-00007340: 6573 2e69 7465 6d73 2829 2069 6620 6973  es.items() if is
-00007350: 5f64 7563 6b5f 6461 736b 5f61 7272 6179  _duck_dask_array
-00007360: 2876 2e5f 6461 7461 290a 2020 2020 2020  (v._data).      
-00007370: 2020 7d0a 2020 2020 2020 2020 6966 206c    }.        if l
-00007380: 617a 795f 6461 7461 3a0a 2020 2020 2020  azy_data:.      
-00007390: 2020 2020 2020 696d 706f 7274 2064 6173        import das
-000073a0: 6b0a 0a20 2020 2020 2020 2020 2020 2023  k..            #
-000073b0: 2065 7661 6c75 6174 6520 616c 6c20 7468   evaluate all th
-000073c0: 6520 6461 736b 2061 7272 6179 7320 7369  e dask arrays si
-000073d0: 6d75 6c74 616e 656f 7573 6c79 0a20 2020  multaneously.   
-000073e0: 2020 2020 2020 2020 2065 7661 6c75 6174           evaluat
-000073f0: 6564 5f64 6174 6120 3d20 6461 736b 2e70  ed_data = dask.p
-00007400: 6572 7369 7374 282a 6c61 7a79 5f64 6174  ersist(*lazy_dat
-00007410: 612e 7661 6c75 6573 2829 2c20 2a2a 6b77  a.values(), **kw
-00007420: 6172 6773 290a 0a20 2020 2020 2020 2020  args)..         
-00007430: 2020 2066 6f72 206b 2c20 6461 7461 2069     for k, data i
-00007440: 6e20 7a69 7028 6c61 7a79 5f64 6174 612c  n zip(lazy_data,
-00007450: 2065 7661 6c75 6174 6564 5f64 6174 6129   evaluated_data)
-00007460: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007470: 2020 7365 6c66 2e76 6172 6961 626c 6573    self.variables
-00007480: 5b6b 5d2e 6461 7461 203d 2064 6174 610a  [k].data = data.
-00007490: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000074a0: 7365 6c66 0a0a 2020 2020 6465 6620 7065  self..    def pe
-000074b0: 7273 6973 7428 7365 6c66 3a20 545f 4461  rsist(self: T_Da
-000074c0: 7461 7365 742c 202a 2a6b 7761 7267 7329  taset, **kwargs)
-000074d0: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
-000074e0: 2020 2020 2020 2022 2222 5472 6967 6765         """Trigge
-000074f0: 7220 636f 6d70 7574 6174 696f 6e2c 206b  r computation, k
-00007500: 6565 7069 6e67 2064 6174 6120 6173 2064  eeping data as d
-00007510: 6173 6b20 6172 7261 7973 0a0a 2020 2020  ask arrays..    
-00007520: 2020 2020 5468 6973 206f 7065 7261 7469      This operati
-00007530: 6f6e 2063 616e 2062 6520 7573 6564 2074  on can be used t
-00007540: 6f20 7472 6967 6765 7220 636f 6d70 7574  o trigger comput
-00007550: 6174 696f 6e20 6f6e 2075 6e64 6572 6c79  ation on underly
-00007560: 696e 6720 6461 736b 0a20 2020 2020 2020  ing dask.       
-00007570: 2061 7272 6179 732c 2073 696d 696c 6172   arrays, similar
-00007580: 2074 6f20 6060 2e63 6f6d 7075 7465 2829   to ``.compute()
-00007590: 6060 206f 7220 6060 2e6c 6f61 6428 2960  `` or ``.load()`
-000075a0: 602e 2020 486f 7765 7665 7220 7468 6973  `.  However this
-000075b0: 0a20 2020 2020 2020 206f 7065 7261 7469  .        operati
-000075c0: 6f6e 206b 6565 7073 2074 6865 2064 6174  on keeps the dat
-000075d0: 6120 6173 2064 6173 6b20 6172 7261 7973  a as dask arrays
-000075e0: 2e20 5468 6973 2069 7320 7061 7274 6963  . This is partic
-000075f0: 756c 6172 6c79 2075 7365 6675 6c0a 2020  ularly useful.  
-00007600: 2020 2020 2020 7768 656e 2075 7369 6e67        when using
-00007610: 2074 6865 2064 6173 6b2e 6469 7374 7269   the dask.distri
-00007620: 6275 7465 6420 7363 6865 6475 6c65 7220  buted scheduler 
-00007630: 616e 6420 796f 7520 7761 6e74 2074 6f20  and you want to 
-00007640: 6c6f 6164 2061 206c 6172 6765 0a20 2020  load a large.   
-00007650: 2020 2020 2061 6d6f 756e 7420 6f66 2064       amount of d
-00007660: 6174 6120 696e 746f 2064 6973 7472 6962  ata into distrib
-00007670: 7574 6564 206d 656d 6f72 792e 0a0a 2020  uted memory...  
-00007680: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00007690: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-000076a0: 2d2d 2d0a 2020 2020 2020 2020 2a2a 6b77  ---.        **kw
-000076b0: 6172 6773 203a 2064 6963 740a 2020 2020  args : dict.    
-000076c0: 2020 2020 2020 2020 4164 6469 7469 6f6e          Addition
-000076d0: 616c 206b 6579 776f 7264 2061 7267 756d  al keyword argum
-000076e0: 656e 7473 2070 6173 7365 6420 6f6e 2074  ents passed on t
-000076f0: 6f20 6060 6461 736b 2e70 6572 7369 7374  o ``dask.persist
-00007700: 6060 2e0a 0a20 2020 2020 2020 2053 6565  ``...        See
-00007710: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-00007720: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-00007730: 6173 6b2e 7065 7273 6973 740a 2020 2020  ask.persist.    
-00007740: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00007750: 6e65 7720 3d20 7365 6c66 2e63 6f70 7928  new = self.copy(
-00007760: 6465 6570 3d46 616c 7365 290a 2020 2020  deep=False).    
-00007770: 2020 2020 7265 7475 726e 206e 6577 2e5f      return new._
-00007780: 7065 7273 6973 745f 696e 706c 6163 6528  persist_inplace(
-00007790: 2a2a 6b77 6172 6773 290a 0a20 2020 2040  **kwargs)..    @
-000077a0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-000077b0: 6465 6620 5f63 6f6e 7374 7275 6374 5f64  def _construct_d
-000077c0: 6972 6563 7428 0a20 2020 2020 2020 2063  irect(.        c
-000077d0: 6c73 3a20 7479 7065 5b54 5f44 6174 6173  ls: type[T_Datas
-000077e0: 6574 5d2c 0a20 2020 2020 2020 2076 6172  et],.        var
-000077f0: 6961 626c 6573 3a20 6469 6374 5b41 6e79  iables: dict[Any
-00007800: 2c20 5661 7269 6162 6c65 5d2c 0a20 2020  , Variable],.   
-00007810: 2020 2020 2063 6f6f 7264 5f6e 616d 6573       coord_names
-00007820: 3a20 7365 745b 4861 7368 6162 6c65 5d2c  : set[Hashable],
-00007830: 0a20 2020 2020 2020 2064 696d 733a 2064  .        dims: d
-00007840: 6963 745b 416e 792c 2069 6e74 5d20 7c20  ict[Any, int] | 
-00007850: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00007860: 2020 2020 2061 7474 7273 3a20 6469 6374       attrs: dict
-00007870: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00007880: 2020 2020 2020 2020 696e 6465 7865 733a          indexes:
-00007890: 2064 6963 745b 416e 792c 2049 6e64 6578   dict[Any, Index
-000078a0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-000078b0: 0a20 2020 2020 2020 2065 6e63 6f64 696e  .        encodin
-000078c0: 673a 2064 6963 7420 7c20 4e6f 6e65 203d  g: dict | None =
-000078d0: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
-000078e0: 6c6f 7365 3a20 4361 6c6c 6162 6c65 5b5b  lose: Callable[[
-000078f0: 5d2c 204e 6f6e 655d 207c 204e 6f6e 6520  ], None] | None 
-00007900: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
-00007910: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-00007920: 2020 2020 2222 2253 686f 7274 6375 7420      """Shortcut 
-00007930: 6172 6f75 6e64 205f 5f69 6e69 745f 5f20  around __init__ 
-00007940: 666f 7220 696e 7465 726e 616c 2075 7365  for internal use
-00007950: 2077 6865 6e20 7765 2077 616e 7420 746f   when we want to
-00007960: 2073 6b69 700a 2020 2020 2020 2020 636f   skip.        co
-00007970: 7374 6c79 2076 616c 6964 6174 696f 6e0a  stly validation.
-00007980: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00007990: 2020 2020 6966 2064 696d 7320 6973 204e      if dims is N
-000079a0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000079b0: 2064 696d 7320 3d20 6361 6c63 756c 6174   dims = calculat
-000079c0: 655f 6469 6d65 6e73 696f 6e73 2876 6172  e_dimensions(var
-000079d0: 6961 626c 6573 290a 2020 2020 2020 2020  iables).        
-000079e0: 6966 2069 6e64 6578 6573 2069 7320 4e6f  if indexes is No
-000079f0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00007a00: 696e 6465 7865 7320 3d20 7b7d 0a20 2020  indexes = {}.   
-00007a10: 2020 2020 206f 626a 203d 206f 626a 6563       obj = objec
-00007a20: 742e 5f5f 6e65 775f 5f28 636c 7329 0a20  t.__new__(cls). 
-00007a30: 2020 2020 2020 206f 626a 2e5f 7661 7269         obj._vari
-00007a40: 6162 6c65 7320 3d20 7661 7269 6162 6c65  ables = variable
-00007a50: 730a 2020 2020 2020 2020 6f62 6a2e 5f63  s.        obj._c
-00007a60: 6f6f 7264 5f6e 616d 6573 203d 2063 6f6f  oord_names = coo
-00007a70: 7264 5f6e 616d 6573 0a20 2020 2020 2020  rd_names.       
-00007a80: 206f 626a 2e5f 6469 6d73 203d 2064 696d   obj._dims = dim
-00007a90: 730a 2020 2020 2020 2020 6f62 6a2e 5f69  s.        obj._i
-00007aa0: 6e64 6578 6573 203d 2069 6e64 6578 6573  ndexes = indexes
-00007ab0: 0a20 2020 2020 2020 206f 626a 2e5f 6174  .        obj._at
-00007ac0: 7472 7320 3d20 6174 7472 730a 2020 2020  trs = attrs.    
-00007ad0: 2020 2020 6f62 6a2e 5f63 6c6f 7365 203d      obj._close =
-00007ae0: 2063 6c6f 7365 0a20 2020 2020 2020 206f   close.        o
-00007af0: 626a 2e5f 656e 636f 6469 6e67 203d 2065  bj._encoding = e
-00007b00: 6e63 6f64 696e 670a 2020 2020 2020 2020  ncoding.        
-00007b10: 7265 7475 726e 206f 626a 0a0a 2020 2020  return obj..    
-00007b20: 6465 6620 5f72 6570 6c61 6365 280a 2020  def _replace(.  
-00007b30: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
-00007b40: 7461 7365 742c 0a20 2020 2020 2020 2076  taset,.        v
-00007b50: 6172 6961 626c 6573 3a20 6469 6374 5b48  ariables: dict[H
-00007b60: 6173 6861 626c 652c 2056 6172 6961 626c  ashable, Variabl
-00007b70: 655d 207c 204e 6f6e 6520 3d20 4e6f 6e65  e] | None = None
-00007b80: 2c0a 2020 2020 2020 2020 636f 6f72 645f  ,.        coord_
-00007b90: 6e61 6d65 733a 2073 6574 5b48 6173 6861  names: set[Hasha
-00007ba0: 626c 655d 207c 204e 6f6e 6520 3d20 4e6f  ble] | None = No
-00007bb0: 6e65 2c0a 2020 2020 2020 2020 6469 6d73  ne,.        dims
-00007bc0: 3a20 6469 6374 5b41 6e79 2c20 696e 745d  : dict[Any, int]
-00007bd0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00007be0: 2020 2020 2020 2020 6174 7472 733a 2064          attrs: d
-00007bf0: 6963 745b 4861 7368 6162 6c65 2c20 416e  ict[Hashable, An
-00007c00: 795d 207c 204e 6f6e 6520 7c20 4465 6661  y] | None | Defa
-00007c10: 756c 7420 3d20 5f64 6566 6175 6c74 2c0a  ult = _default,.
-00007c20: 2020 2020 2020 2020 696e 6465 7865 733a          indexes:
-00007c30: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
-00007c40: 496e 6465 785d 207c 204e 6f6e 6520 3d20  Index] | None = 
-00007c50: 4e6f 6e65 2c0a 2020 2020 2020 2020 656e  None,.        en
-00007c60: 636f 6469 6e67 3a20 6469 6374 207c 204e  coding: dict | N
-00007c70: 6f6e 6520 7c20 4465 6661 756c 7420 3d20  one | Default = 
-00007c80: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
-00007c90: 2020 696e 706c 6163 653a 2062 6f6f 6c20    inplace: bool 
-00007ca0: 3d20 4661 6c73 652c 0a20 2020 2029 202d  = False,.    ) -
-00007cb0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-00007cc0: 2020 2020 2022 2222 4661 7374 7061 7468       """Fastpath
-00007cd0: 2063 6f6e 7374 7275 6374 6f72 2066 6f72   constructor for
-00007ce0: 2069 6e74 6572 6e61 6c20 7573 652e 0a0a   internal use...
-00007cf0: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
-00007d00: 616e 206f 626a 6563 7420 7769 7468 206f  an object with o
-00007d10: 7074 696f 6e61 6c6c 7920 7769 7468 2072  ptionally with r
-00007d20: 6570 6c61 6365 6420 6174 7472 6962 7574  eplaced attribut
-00007d30: 6573 2e0a 0a20 2020 2020 2020 2045 7870  es...        Exp
-00007d40: 6c69 6369 746c 7920 7061 7373 6564 2061  licitly passed a
-00007d50: 7267 756d 656e 7473 2061 7265 202a 6e6f  rguments are *no
-00007d60: 742a 2063 6f70 6965 6420 7768 656e 2070  t* copied when p
-00007d70: 6c61 6365 6420 6f6e 2074 6865 206e 6577  laced on the new
-00007d80: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
-00007d90: 2e20 4974 2069 7320 7570 2074 6f20 7468  . It is up to th
-00007da0: 6520 6361 6c6c 6572 2074 6f20 656e 7375  e caller to ensu
-00007db0: 7265 2074 6861 7420 7468 6579 2068 6176  re that they hav
-00007dc0: 6520 7468 6520 7269 6768 7420 7479 7065  e the right type
-00007dd0: 0a20 2020 2020 2020 2061 6e64 2061 7265  .        and are
-00007de0: 206e 6f74 2075 7365 6420 656c 7365 7768   not used elsewh
-00007df0: 6572 652e 0a20 2020 2020 2020 2022 2222  ere..        """
-00007e00: 0a20 2020 2020 2020 2069 6620 696e 706c  .        if inpl
-00007e10: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
-00007e20: 2069 6620 7661 7269 6162 6c65 7320 6973   if variables is
-00007e30: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00007e40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007e50: 5f76 6172 6961 626c 6573 203d 2076 6172  _variables = var
-00007e60: 6961 626c 6573 0a20 2020 2020 2020 2020  iables.         
-00007e70: 2020 2069 6620 636f 6f72 645f 6e61 6d65     if coord_name
-00007e80: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
-00007e90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00007ea0: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
-00007eb0: 203d 2063 6f6f 7264 5f6e 616d 6573 0a20   = coord_names. 
-00007ec0: 2020 2020 2020 2020 2020 2069 6620 6469             if di
-00007ed0: 6d73 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ms is not None:.
-00007ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ef0: 7365 6c66 2e5f 6469 6d73 203d 2064 696d  self._dims = dim
-00007f00: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
-00007f10: 2061 7474 7273 2069 7320 6e6f 7420 5f64   attrs is not _d
-00007f20: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
-00007f30: 2020 2020 2020 2020 7365 6c66 2e5f 6174          self._at
-00007f40: 7472 7320 3d20 6174 7472 730a 2020 2020  trs = attrs.    
-00007f50: 2020 2020 2020 2020 6966 2069 6e64 6578          if index
-00007f60: 6573 2069 7320 6e6f 7420 4e6f 6e65 3a0a  es is not None:.
-00007f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f80: 7365 6c66 2e5f 696e 6465 7865 7320 3d20  self._indexes = 
-00007f90: 696e 6465 7865 730a 2020 2020 2020 2020  indexes.        
-00007fa0: 2020 2020 6966 2065 6e63 6f64 696e 6720      if encoding 
-00007fb0: 6973 206e 6f74 205f 6465 6661 756c 743a  is not _default:
-00007fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007fd0: 2073 656c 662e 5f65 6e63 6f64 696e 6720   self._encoding 
-00007fe0: 3d20 656e 636f 6469 6e67 0a20 2020 2020  = encoding.     
-00007ff0: 2020 2020 2020 206f 626a 203d 2073 656c         obj = sel
-00008000: 660a 2020 2020 2020 2020 656c 7365 3a0a  f.        else:.
-00008010: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-00008020: 6172 6961 626c 6573 2069 7320 4e6f 6e65  ariables is None
-00008030: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008040: 2020 7661 7269 6162 6c65 7320 3d20 7365    variables = se
-00008050: 6c66 2e5f 7661 7269 6162 6c65 732e 636f  lf._variables.co
-00008060: 7079 2829 0a20 2020 2020 2020 2020 2020  py().           
-00008070: 2069 6620 636f 6f72 645f 6e61 6d65 7320   if coord_names 
-00008080: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00008090: 2020 2020 2020 2020 2063 6f6f 7264 5f6e           coord_n
-000080a0: 616d 6573 203d 2073 656c 662e 5f63 6f6f  ames = self._coo
-000080b0: 7264 5f6e 616d 6573 2e63 6f70 7928 290a  rd_names.copy().
-000080c0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-000080d0: 696d 7320 6973 204e 6f6e 653a 0a20 2020  ims is None:.   
-000080e0: 2020 2020 2020 2020 2020 2020 2064 696d               dim
-000080f0: 7320 3d20 7365 6c66 2e5f 6469 6d73 2e63  s = self._dims.c
-00008100: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-00008110: 2020 6966 2061 7474 7273 2069 7320 5f64    if attrs is _d
-00008120: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
-00008130: 2020 2020 2020 2020 6174 7472 7320 3d20          attrs = 
-00008140: 636f 7079 2e63 6f70 7928 7365 6c66 2e5f  copy.copy(self._
-00008150: 6174 7472 7329 0a20 2020 2020 2020 2020  attrs).         
-00008160: 2020 2069 6620 696e 6465 7865 7320 6973     if indexes is
-00008170: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00008180: 2020 2020 2020 2069 6e64 6578 6573 203d         indexes =
-00008190: 2073 656c 662e 5f69 6e64 6578 6573 2e63   self._indexes.c
-000081a0: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-000081b0: 2020 6966 2065 6e63 6f64 696e 6720 6973    if encoding is
-000081c0: 205f 6465 6661 756c 743a 0a20 2020 2020   _default:.     
-000081d0: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
-000081e0: 696e 6720 3d20 636f 7079 2e63 6f70 7928  ing = copy.copy(
-000081f0: 7365 6c66 2e5f 656e 636f 6469 6e67 290a  self._encoding).
-00008200: 2020 2020 2020 2020 2020 2020 6f62 6a20              obj 
-00008210: 3d20 7365 6c66 2e5f 636f 6e73 7472 7563  = self._construc
-00008220: 745f 6469 7265 6374 280a 2020 2020 2020  t_direct(.      
-00008230: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-00008240: 6c65 732c 2063 6f6f 7264 5f6e 616d 6573  les, coord_names
-00008250: 2c20 6469 6d73 2c20 6174 7472 732c 2069  , dims, attrs, i
-00008260: 6e64 6578 6573 2c20 656e 636f 6469 6e67  ndexes, encoding
-00008270: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00008280: 2020 2020 2020 2072 6574 7572 6e20 6f62         return ob
-00008290: 6a0a 0a20 2020 2064 6566 205f 7265 706c  j..    def _repl
-000082a0: 6163 655f 7769 7468 5f6e 6577 5f64 696d  ace_with_new_dim
-000082b0: 7328 0a20 2020 2020 2020 2073 656c 663a  s(.        self:
-000082c0: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
-000082d0: 2020 2020 7661 7269 6162 6c65 733a 2064      variables: d
-000082e0: 6963 745b 4861 7368 6162 6c65 2c20 5661  ict[Hashable, Va
-000082f0: 7269 6162 6c65 5d2c 0a20 2020 2020 2020  riable],.       
-00008300: 2063 6f6f 7264 5f6e 616d 6573 3a20 7365   coord_names: se
-00008310: 7420 7c20 4e6f 6e65 203d 204e 6f6e 652c  t | None = None,
-00008320: 0a20 2020 2020 2020 2061 7474 7273 3a20  .        attrs: 
-00008330: 6469 6374 5b48 6173 6861 626c 652c 2041  dict[Hashable, A
-00008340: 6e79 5d20 7c20 4e6f 6e65 207c 2044 6566  ny] | None | Def
-00008350: 6175 6c74 203d 205f 6465 6661 756c 742c  ault = _default,
-00008360: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
-00008370: 3a20 6469 6374 5b48 6173 6861 626c 652c  : dict[Hashable,
-00008380: 2049 6e64 6578 5d20 7c20 4e6f 6e65 203d   Index] | None =
-00008390: 204e 6f6e 652c 0a20 2020 2020 2020 2069   None,.        i
-000083a0: 6e70 6c61 6365 3a20 626f 6f6c 203d 2046  nplace: bool = F
-000083b0: 616c 7365 2c0a 2020 2020 2920 2d3e 2054  alse,.    ) -> T
-000083c0: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-000083d0: 2020 2222 2252 6570 6c61 6365 2076 6172    """Replace var
-000083e0: 6961 626c 6573 2077 6974 6820 7265 6361  iables with reca
-000083f0: 6c63 756c 6174 6564 2064 696d 656e 7369  lculated dimensi
-00008400: 6f6e 732e 2222 220a 2020 2020 2020 2020  ons.""".        
-00008410: 6469 6d73 203d 2063 616c 6375 6c61 7465  dims = calculate
-00008420: 5f64 696d 656e 7369 6f6e 7328 7661 7269  _dimensions(vari
-00008430: 6162 6c65 7329 0a20 2020 2020 2020 2072  ables).        r
-00008440: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
-00008450: 6163 6528 0a20 2020 2020 2020 2020 2020  ace(.           
-00008460: 2076 6172 6961 626c 6573 2c20 636f 6f72   variables, coor
-00008470: 645f 6e61 6d65 732c 2064 696d 732c 2061  d_names, dims, a
-00008480: 7474 7273 2c20 696e 6465 7865 732c 2069  ttrs, indexes, i
-00008490: 6e70 6c61 6365 3d69 6e70 6c61 6365 0a20  nplace=inplace. 
-000084a0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-000084b0: 6620 5f72 6570 6c61 6365 5f76 6172 735f  f _replace_vars_
-000084c0: 616e 645f 6469 6d73 280a 2020 2020 2020  and_dims(.      
-000084d0: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
-000084e0: 742c 0a20 2020 2020 2020 2076 6172 6961  t,.        varia
-000084f0: 626c 6573 3a20 6469 6374 5b48 6173 6861  bles: dict[Hasha
-00008500: 626c 652c 2056 6172 6961 626c 655d 2c0a  ble, Variable],.
-00008510: 2020 2020 2020 2020 636f 6f72 645f 6e61          coord_na
-00008520: 6d65 733a 2073 6574 207c 204e 6f6e 6520  mes: set | None 
-00008530: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00008540: 6469 6d73 3a20 6469 6374 5b48 6173 6861  dims: dict[Hasha
-00008550: 626c 652c 2069 6e74 5d20 7c20 4e6f 6e65  ble, int] | None
-00008560: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00008570: 2061 7474 7273 3a20 6469 6374 5b48 6173   attrs: dict[Has
-00008580: 6861 626c 652c 2041 6e79 5d20 7c20 4e6f  hable, Any] | No
-00008590: 6e65 207c 2044 6566 6175 6c74 203d 205f  ne | Default = _
-000085a0: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
-000085b0: 2069 6e70 6c61 6365 3a20 626f 6f6c 203d   inplace: bool =
-000085c0: 2046 616c 7365 2c0a 2020 2020 2920 2d3e   False,.    ) ->
-000085d0: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-000085e0: 2020 2020 2222 2244 6570 7265 6361 7465      """Deprecate
-000085f0: 6420 7665 7273 696f 6e20 6f66 205f 7265  d version of _re
-00008600: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
-00008610: 696d 7328 292e 0a0a 2020 2020 2020 2020  ims()...        
-00008620: 556e 6c69 6b65 205f 7265 706c 6163 655f  Unlike _replace_
-00008630: 7769 7468 5f6e 6577 5f64 696d 7328 292c  with_new_dims(),
-00008640: 2074 6869 7320 6d65 7468 6f64 2061 6c77   this method alw
-00008650: 6179 7320 7265 6361 6c63 756c 6174 6573  ays recalculates
-00008660: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
-00008670: 2066 726f 6d20 7661 7269 6162 6c65 732e   from variables.
-00008680: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00008690: 2020 2020 2069 6620 6469 6d73 2069 7320       if dims is 
-000086a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000086b0: 2020 6469 6d73 203d 2063 616c 6375 6c61    dims = calcula
-000086c0: 7465 5f64 696d 656e 7369 6f6e 7328 7661  te_dimensions(va
-000086d0: 7269 6162 6c65 7329 0a20 2020 2020 2020  riables).       
-000086e0: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-000086f0: 706c 6163 6528 0a20 2020 2020 2020 2020  place(.         
-00008700: 2020 2076 6172 6961 626c 6573 2c20 636f     variables, co
-00008710: 6f72 645f 6e61 6d65 732c 2064 696d 732c  ord_names, dims,
-00008720: 2061 7474 7273 2c20 696e 6465 7865 733d   attrs, indexes=
-00008730: 4e6f 6e65 2c20 696e 706c 6163 653d 696e  None, inplace=in
-00008740: 706c 6163 650a 2020 2020 2020 2020 290a  place.        ).
-00008750: 0a20 2020 2064 6566 205f 6f76 6572 7772  .    def _overwr
-00008760: 6974 655f 696e 6465 7865 7328 0a20 2020  ite_indexes(.   
-00008770: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-00008780: 6173 6574 2c0a 2020 2020 2020 2020 696e  aset,.        in
-00008790: 6465 7865 733a 204d 6170 7069 6e67 5b48  dexes: Mapping[H
-000087a0: 6173 6861 626c 652c 2049 6e64 6578 5d2c  ashable, Index],
-000087b0: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-000087c0: 6573 3a20 4d61 7070 696e 675b 4861 7368  es: Mapping[Hash
-000087d0: 6162 6c65 2c20 5661 7269 6162 6c65 5d20  able, Variable] 
-000087e0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
-000087f0: 2020 2020 2020 2064 726f 705f 7661 7269         drop_vari
-00008800: 6162 6c65 733a 206c 6973 745b 4861 7368  ables: list[Hash
-00008810: 6162 6c65 5d20 7c20 4e6f 6e65 203d 204e  able] | None = N
-00008820: 6f6e 652c 0a20 2020 2020 2020 2064 726f  one,.        dro
-00008830: 705f 696e 6465 7865 733a 206c 6973 745b  p_indexes: list[
-00008840: 4861 7368 6162 6c65 5d20 7c20 4e6f 6e65  Hashable] | None
-00008850: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00008860: 2072 656e 616d 655f 6469 6d73 3a20 4d61   rename_dims: Ma
-00008870: 7070 696e 675b 4861 7368 6162 6c65 2c20  pping[Hashable, 
-00008880: 4861 7368 6162 6c65 5d20 7c20 4e6f 6e65  Hashable] | None
-00008890: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
-000088a0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-000088b0: 2020 2020 2022 2222 4d61 7962 6520 7265       """Maybe re
-000088c0: 706c 6163 6520 696e 6465 7865 732e 0a0a  place indexes...
-000088d0: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
-000088e0: 6374 696f 6e20 6d61 7920 646f 2061 206c  ction may do a l
-000088f0: 6f74 206d 6f72 6520 6465 7065 6e64 696e  ot more dependin
-00008900: 6720 6f6e 2069 6e64 6578 2071 7565 7279  g on index query
-00008910: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
-00008920: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
-00008930: 2020 2020 2020 2069 6620 6e6f 7420 696e         if not in
-00008940: 6465 7865 733a 0a20 2020 2020 2020 2020  dexes:.         
-00008950: 2020 2072 6574 7572 6e20 7365 6c66 0a0a     return self..
-00008960: 2020 2020 2020 2020 6966 2076 6172 6961          if varia
-00008970: 626c 6573 2069 7320 4e6f 6e65 3a0a 2020  bles is None:.  
-00008980: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-00008990: 6c65 7320 3d20 7b7d 0a20 2020 2020 2020  les = {}.       
-000089a0: 2069 6620 6472 6f70 5f76 6172 6961 626c   if drop_variabl
-000089b0: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-000089c0: 2020 2020 2020 2020 6472 6f70 5f76 6172          drop_var
-000089d0: 6961 626c 6573 203d 205b 5d0a 2020 2020  iables = [].    
-000089e0: 2020 2020 6966 2064 726f 705f 696e 6465      if drop_inde
-000089f0: 7865 7320 6973 204e 6f6e 653a 0a20 2020  xes is None:.   
-00008a00: 2020 2020 2020 2020 2064 726f 705f 696e           drop_in
-00008a10: 6465 7865 7320 3d20 5b5d 0a0a 2020 2020  dexes = []..    
-00008a20: 2020 2020 6e65 775f 7661 7269 6162 6c65      new_variable
-00008a30: 7320 3d20 7365 6c66 2e5f 7661 7269 6162  s = self._variab
-00008a40: 6c65 732e 636f 7079 2829 0a20 2020 2020  les.copy().     
-00008a50: 2020 206e 6577 5f63 6f6f 7264 5f6e 616d     new_coord_nam
-00008a60: 6573 203d 2073 656c 662e 5f63 6f6f 7264  es = self._coord
-00008a70: 5f6e 616d 6573 2e63 6f70 7928 290a 2020  _names.copy().  
-00008a80: 2020 2020 2020 6e65 775f 696e 6465 7865        new_indexe
-00008a90: 7320 3d20 6469 6374 2873 656c 662e 5f69  s = dict(self._i
-00008aa0: 6e64 6578 6573 290a 0a20 2020 2020 2020  ndexes)..       
-00008ab0: 2069 6e64 6578 5f76 6172 6961 626c 6573   index_variables
-00008ac0: 203d 207b 7d0a 2020 2020 2020 2020 6e6f   = {}.        no
-00008ad0: 5f69 6e64 6578 5f76 6172 6961 626c 6573  _index_variables
-00008ae0: 203d 207b 7d0a 2020 2020 2020 2020 666f   = {}.        fo
-00008af0: 7220 6e61 6d65 2c20 7661 7220 696e 2076  r name, var in v
-00008b00: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
-00008b10: 3a0a 2020 2020 2020 2020 2020 2020 6f6c  :.            ol
-00008b20: 645f 7661 7220 3d20 7365 6c66 2e5f 7661  d_var = self._va
-00008b30: 7269 6162 6c65 732e 6765 7428 6e61 6d65  riables.get(name
-00008b40: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00008b50: 206f 6c64 5f76 6172 2069 7320 6e6f 7420   old_var is not 
-00008b60: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00008b70: 2020 2020 2020 7661 722e 6174 7472 732e        var.attrs.
-00008b80: 7570 6461 7465 286f 6c64 5f76 6172 2e61  update(old_var.a
-00008b90: 7474 7273 290a 2020 2020 2020 2020 2020  ttrs).          
-00008ba0: 2020 2020 2020 7661 722e 656e 636f 6469        var.encodi
-00008bb0: 6e67 2e75 7064 6174 6528 6f6c 645f 7661  ng.update(old_va
-00008bc0: 722e 656e 636f 6469 6e67 290a 2020 2020  r.encoding).    
-00008bd0: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
-00008be0: 696e 2069 6e64 6578 6573 3a0a 2020 2020  in indexes:.    
-00008bf0: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00008c00: 785f 7661 7269 6162 6c65 735b 6e61 6d65  x_variables[name
-00008c10: 5d20 3d20 7661 720a 2020 2020 2020 2020  ] = var.        
-00008c20: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00008c30: 2020 2020 2020 2020 2020 6e6f 5f69 6e64            no_ind
-00008c40: 6578 5f76 6172 6961 626c 6573 5b6e 616d  ex_variables[nam
-00008c50: 655d 203d 2076 6172 0a0a 2020 2020 2020  e] = var..      
-00008c60: 2020 666f 7220 6e61 6d65 2069 6e20 696e    for name in in
-00008c70: 6465 7865 733a 0a20 2020 2020 2020 2020  dexes:.         
-00008c80: 2020 206e 6577 5f69 6e64 6578 6573 5b6e     new_indexes[n
-00008c90: 616d 655d 203d 2069 6e64 6578 6573 5b6e  ame] = indexes[n
-00008ca0: 616d 655d 0a0a 2020 2020 2020 2020 666f  ame]..        fo
-00008cb0: 7220 6e61 6d65 2c20 7661 7220 696e 2069  r name, var in i
-00008cc0: 6e64 6578 5f76 6172 6961 626c 6573 2e69  ndex_variables.i
-00008cd0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-00008ce0: 2020 2020 6e65 775f 636f 6f72 645f 6e61      new_coord_na
-00008cf0: 6d65 732e 6164 6428 6e61 6d65 290a 2020  mes.add(name).  
-00008d00: 2020 2020 2020 2020 2020 6e65 775f 7661            new_va
-00008d10: 7269 6162 6c65 735b 6e61 6d65 5d20 3d20  riables[name] = 
-00008d20: 7661 720a 0a20 2020 2020 2020 2023 2061  var..        # a
-00008d30: 7070 656e 6420 6e6f 2d69 6e64 6578 2076  ppend no-index v
-00008d40: 6172 6961 626c 6573 2061 7420 7468 6520  ariables at the 
-00008d50: 656e 640a 2020 2020 2020 2020 666f 7220  end.        for 
-00008d60: 6b20 696e 206e 6f5f 696e 6465 785f 7661  k in no_index_va
-00008d70: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-00008d80: 2020 2020 206e 6577 5f76 6172 6961 626c       new_variabl
-00008d90: 6573 2e70 6f70 286b 290a 2020 2020 2020  es.pop(k).      
-00008da0: 2020 6e65 775f 7661 7269 6162 6c65 732e    new_variables.
-00008db0: 7570 6461 7465 286e 6f5f 696e 6465 785f  update(no_index_
-00008dc0: 7661 7269 6162 6c65 7329 0a0a 2020 2020  variables)..    
-00008dd0: 2020 2020 666f 7220 6e61 6d65 2069 6e20      for name in 
-00008de0: 6472 6f70 5f69 6e64 6578 6573 3a0a 2020  drop_indexes:.  
-00008df0: 2020 2020 2020 2020 2020 6e65 775f 696e            new_in
-00008e00: 6465 7865 732e 706f 7028 6e61 6d65 290a  dexes.pop(name).
-00008e10: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
-00008e20: 6520 696e 2064 726f 705f 7661 7269 6162  e in drop_variab
-00008e30: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-00008e40: 206e 6577 5f76 6172 6961 626c 6573 2e70   new_variables.p
-00008e50: 6f70 286e 616d 6529 0a20 2020 2020 2020  op(name).       
-00008e60: 2020 2020 206e 6577 5f69 6e64 6578 6573       new_indexes
-00008e70: 2e70 6f70 286e 616d 652c 204e 6f6e 6529  .pop(name, None)
-00008e80: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00008e90: 5f63 6f6f 7264 5f6e 616d 6573 2e72 656d  _coord_names.rem
-00008ea0: 6f76 6528 6e61 6d65 290a 0a20 2020 2020  ove(name)..     
-00008eb0: 2020 2072 6570 6c61 6365 6420 3d20 7365     replaced = se
-00008ec0: 6c66 2e5f 7265 706c 6163 6528 0a20 2020  lf._replace(.   
-00008ed0: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-00008ee0: 6573 3d6e 6577 5f76 6172 6961 626c 6573  es=new_variables
-00008ef0: 2c20 636f 6f72 645f 6e61 6d65 733d 6e65  , coord_names=ne
-00008f00: 775f 636f 6f72 645f 6e61 6d65 732c 2069  w_coord_names, i
-00008f10: 6e64 6578 6573 3d6e 6577 5f69 6e64 6578  ndexes=new_index
-00008f20: 6573 0a20 2020 2020 2020 2029 0a0a 2020  es.        )..  
-00008f30: 2020 2020 2020 6966 2072 656e 616d 655f        if rename_
-00008f40: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
-00008f50: 2020 2320 736b 6970 2072 656e 616d 6520    # skip rename 
-00008f60: 696e 6465 7865 733a 2074 6865 7920 7368  indexes: they sh
-00008f70: 6f75 6c64 2061 6c72 6561 6479 2068 6176  ould already hav
-00008f80: 6520 7468 6520 7269 6768 7420 6e61 6d65  e the right name
-00008f90: 2873 290a 2020 2020 2020 2020 2020 2020  (s).            
-00008fa0: 6469 6d73 203d 2072 6570 6c61 6365 642e  dims = replaced.
-00008fb0: 5f72 656e 616d 655f 6469 6d73 2872 656e  _rename_dims(ren
-00008fc0: 616d 655f 6469 6d73 290a 2020 2020 2020  ame_dims).      
-00008fd0: 2020 2020 2020 6e65 775f 7661 7269 6162        new_variab
-00008fe0: 6c65 732c 206e 6577 5f63 6f6f 7264 5f6e  les, new_coord_n
-00008ff0: 616d 6573 203d 2072 6570 6c61 6365 642e  ames = replaced.
-00009000: 5f72 656e 616d 655f 7661 7273 287b 7d2c  _rename_vars({},
-00009010: 2072 656e 616d 655f 6469 6d73 290a 2020   rename_dims).  
-00009020: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00009030: 2072 6570 6c61 6365 642e 5f72 6570 6c61   replaced._repla
-00009040: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
-00009050: 2020 2020 7661 7269 6162 6c65 733d 6e65      variables=ne
-00009060: 775f 7661 7269 6162 6c65 732c 2063 6f6f  w_variables, coo
-00009070: 7264 5f6e 616d 6573 3d6e 6577 5f63 6f6f  rd_names=new_coo
-00009080: 7264 5f6e 616d 6573 2c20 6469 6d73 3d64  rd_names, dims=d
-00009090: 696d 730a 2020 2020 2020 2020 2020 2020  ims.            
-000090a0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-000090b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000090c0: 726e 2072 6570 6c61 6365 640a 0a20 2020  rn replaced..   
-000090d0: 2064 6566 2063 6f70 7928 0a20 2020 2020   def copy(.     
-000090e0: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-000090f0: 6574 2c20 6465 6570 3a20 626f 6f6c 203d  et, deep: bool =
-00009100: 2046 616c 7365 2c20 6461 7461 3a20 4d61   False, data: Ma
-00009110: 7070 696e 675b 416e 792c 2041 7272 6179  pping[Any, Array
-00009120: 4c69 6b65 5d20 7c20 4e6f 6e65 203d 204e  Like] | None = N
-00009130: 6f6e 650a 2020 2020 2920 2d3e 2054 5f44  one.    ) -> T_D
-00009140: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-00009150: 2222 2252 6574 7572 6e73 2061 2063 6f70  """Returns a cop
-00009160: 7920 6f66 2074 6869 7320 6461 7461 7365  y of this datase
-00009170: 742e 0a0a 2020 2020 2020 2020 4966 2060  t...        If `
-00009180: 6465 6570 3d54 7275 6560 2c20 6120 6465  deep=True`, a de
-00009190: 6570 2063 6f70 7920 6973 206d 6164 6520  ep copy is made 
-000091a0: 6f66 2065 6163 6820 6f66 2074 6865 2063  of each of the c
-000091b0: 6f6d 706f 6e65 6e74 2076 6172 6961 626c  omponent variabl
-000091c0: 6573 2e0a 2020 2020 2020 2020 4f74 6865  es..        Othe
-000091d0: 7277 6973 652c 2061 2073 6861 6c6c 6f77  rwise, a shallow
-000091e0: 2063 6f70 7920 6f66 2065 6163 6820 6f66   copy of each of
-000091f0: 2074 6865 2063 6f6d 706f 6e65 6e74 2076   the component v
-00009200: 6172 6961 626c 6520 6973 206d 6164 652c  ariable is made,
-00009210: 2073 6f0a 2020 2020 2020 2020 7468 6174   so.        that
-00009220: 2074 6865 2075 6e64 6572 6c79 696e 6720   the underlying 
-00009230: 6d65 6d6f 7279 2072 6567 696f 6e20 6f66  memory region of
-00009240: 2074 6865 206e 6577 2064 6174 6173 6574   the new dataset
-00009250: 2069 7320 7468 6520 7361 6d65 2061 7320   is the same as 
-00009260: 696e 0a20 2020 2020 2020 2074 6865 206f  in.        the o
-00009270: 7269 6769 6e61 6c20 6461 7461 7365 742e  riginal dataset.
-00009280: 0a0a 2020 2020 2020 2020 5573 6520 6064  ..        Use `d
-00009290: 6174 6160 2074 6f20 6372 6561 7465 2061  ata` to create a
-000092a0: 206e 6577 206f 626a 6563 7420 7769 7468   new object with
-000092b0: 2074 6865 2073 616d 6520 7374 7275 6374   the same struct
-000092c0: 7572 6520 6173 0a20 2020 2020 2020 206f  ure as.        o
-000092d0: 7269 6769 6e61 6c20 6275 7420 656e 7469  riginal but enti
-000092e0: 7265 6c79 206e 6577 2064 6174 612e 0a0a  rely new data...
-000092f0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00009300: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00009310: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6465  -----.        de
-00009320: 6570 203a 2062 6f6f 6c2c 2064 6566 6175  ep : bool, defau
-00009330: 6c74 3a20 4661 6c73 650a 2020 2020 2020  lt: False.      
-00009340: 2020 2020 2020 5768 6574 6865 7220 6561        Whether ea
-00009350: 6368 2063 6f6d 706f 6e65 6e74 2076 6172  ch component var
-00009360: 6961 626c 6520 6973 206c 6f61 6465 6420  iable is loaded 
-00009370: 696e 746f 206d 656d 6f72 7920 616e 6420  into memory and 
-00009380: 636f 7069 6564 206f 6e74 6f0a 2020 2020  copied onto.    
-00009390: 2020 2020 2020 2020 7468 6520 6e65 7720          the new 
-000093a0: 6f62 6a65 6374 2e20 4465 6661 756c 7420  object. Default 
-000093b0: 6973 2046 616c 7365 2e0a 2020 2020 2020  is False..      
-000093c0: 2020 6461 7461 203a 2064 6963 742d 6c69    data : dict-li
-000093d0: 6b65 206f 7220 4e6f 6e65 2c20 6f70 7469  ke or None, opti
-000093e0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-000093f0: 2044 6174 6120 746f 2075 7365 2069 6e20   Data to use in 
-00009400: 7468 6520 6e65 7720 6f62 6a65 6374 2e20  the new object. 
-00009410: 4561 6368 2069 7465 6d20 696e 2060 6461  Each item in `da
-00009420: 7461 6020 6d75 7374 2068 6176 6520 7361  ta` must have sa
-00009430: 6d65 0a20 2020 2020 2020 2020 2020 2073  me.            s
-00009440: 6861 7065 2061 7320 636f 7272 6573 706f  hape as correspo
-00009450: 6e64 696e 6720 6461 7461 2076 6172 6961  nding data varia
-00009460: 626c 6520 696e 206f 7269 6769 6e61 6c2e  ble in original.
-00009470: 2057 6865 6e20 6064 6174 6160 2069 730a   When `data` is.
-00009480: 2020 2020 2020 2020 2020 2020 7573 6564              used
-00009490: 2c20 6064 6565 7060 2069 7320 6967 6e6f  , `deep` is igno
-000094a0: 7265 6420 666f 7220 7468 6520 6461 7461  red for the data
-000094b0: 2076 6172 6961 626c 6573 2061 6e64 206f   variables and o
-000094c0: 6e6c 7920 7573 6564 2066 6f72 0a20 2020  nly used for.   
-000094d0: 2020 2020 2020 2020 2063 6f6f 7264 732e           coords.
-000094e0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-000094f0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00009500: 2d0a 2020 2020 2020 2020 6f62 6a65 6374  -.        object
-00009510: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
-00009520: 2020 2020 2020 204e 6577 206f 626a 6563         New objec
-00009530: 7420 7769 7468 2064 696d 656e 7369 6f6e  t with dimension
-00009540: 732c 2061 7474 7269 6275 7465 732c 2063  s, attributes, c
-00009550: 6f6f 7264 696e 6174 6573 2c20 6e61 6d65  oordinates, name
-00009560: 2c20 656e 636f 6469 6e67 2c0a 2020 2020  , encoding,.    
-00009570: 2020 2020 2020 2020 616e 6420 6f70 7469          and opti
-00009580: 6f6e 616c 6c79 2064 6174 6120 636f 7069  onally data copi
-00009590: 6564 2066 726f 6d20 6f72 6967 696e 616c  ed from original
-000095a0: 2e0a 0a20 2020 2020 2020 2045 7861 6d70  ...        Examp
-000095b0: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
-000095c0: 2d2d 2d2d 0a20 2020 2020 2020 2053 6861  ----.        Sha
-000095d0: 6c6c 6f77 2063 6f70 7920 7665 7273 7573  llow copy versus
-000095e0: 2064 6565 7020 636f 7079 0a0a 2020 2020   deep copy..    
-000095f0: 2020 2020 3e3e 3e20 6461 203d 2078 722e      >>> da = xr.
-00009600: 4461 7461 4172 7261 7928 6e70 2e72 616e  DataArray(np.ran
-00009610: 646f 6d2e 7261 6e64 6e28 322c 2033 2929  dom.randn(2, 3))
-00009620: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
-00009630: 3d20 7872 2e44 6174 6173 6574 280a 2020  = xr.Dataset(.  
-00009640: 2020 2020 2020 2e2e 2e20 2020 2020 7b22        ...     {"
-00009650: 666f 6f22 3a20 6461 2c20 2262 6172 223a  foo": da, "bar":
-00009660: 2028 2278 222c 205b 2d31 2c20 325d 297d   ("x", [-1, 2])}
-00009670: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-00009680: 2020 636f 6f72 6473 3d7b 2278 223a 205b    coords={"x": [
-00009690: 226f 6e65 222c 2022 7477 6f22 5d7d 2c0a  "one", "two"]},.
-000096a0: 2020 2020 2020 2020 2e2e 2e20 290a 2020          ... ).  
-000096b0: 2020 2020 2020 3e3e 3e20 6473 2e63 6f70        >>> ds.cop
-000096c0: 7928 290a 2020 2020 2020 2020 3c78 6172  y().        <xar
-000096d0: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
-000096e0: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
-000096f0: 2020 2864 696d 5f30 3a20 322c 2064 696d    (dim_0: 2, dim
-00009700: 5f31 3a20 332c 2078 3a20 3229 0a20 2020  _1: 3, x: 2).   
-00009710: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
-00009720: 3a0a 2020 2020 2020 2020 2020 2a20 7820  :.          * x 
-00009730: 2020 2020 2020 2028 7829 203c 5533 2027         (x) <U3 '
-00009740: 6f6e 6527 2027 7477 6f27 0a20 2020 2020  one' 'two'.     
-00009750: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
-00009760: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
-00009770: 733a 2064 696d 5f30 2c20 6469 6d5f 310a  s: dim_0, dim_1.
-00009780: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-00009790: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-000097a0: 2020 2020 666f 6f20 2020 2020 2028 6469      foo      (di
-000097b0: 6d5f 302c 2064 696d 5f31 2920 666c 6f61  m_0, dim_1) floa
-000097c0: 7436 3420 312e 3736 3420 302e 3430 3032  t64 1.764 0.4002
-000097d0: 2030 2e39 3738 3720 322e 3234 3120 312e   0.9787 2.241 1.
-000097e0: 3836 3820 2d30 2e39 3737 330a 2020 2020  868 -0.9773.    
-000097f0: 2020 2020 2020 2020 6261 7220 2020 2020          bar     
-00009800: 2028 7829 2069 6e74 3634 202d 3120 320a   (x) int64 -1 2.
-00009810: 0a20 2020 2020 2020 203e 3e3e 2064 735f  .        >>> ds_
-00009820: 3020 3d20 6473 2e63 6f70 7928 6465 6570  0 = ds.copy(deep
-00009830: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-00009840: 3e3e 3e20 6473 5f30 5b22 666f 6f22 5d5b  >>> ds_0["foo"][
-00009850: 302c 2030 5d20 3d20 370a 2020 2020 2020  0, 0] = 7.      
-00009860: 2020 3e3e 3e20 6473 5f30 0a20 2020 2020    >>> ds_0.     
-00009870: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
-00009880: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
-00009890: 6e73 696f 6e73 3a20 2028 6469 6d5f 303a  nsions:  (dim_0:
-000098a0: 2032 2c20 6469 6d5f 313a 2033 2c20 783a   2, dim_1: 3, x:
-000098b0: 2032 290a 2020 2020 2020 2020 436f 6f72   2).        Coor
-000098c0: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-000098d0: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
-000098e0: 2920 3c55 3320 276f 6e65 2720 2774 776f  ) <U3 'one' 'two
-000098f0: 270a 2020 2020 2020 2020 4469 6d65 6e73  '.        Dimens
-00009900: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
-00009910: 7264 696e 6174 6573 3a20 6469 6d5f 302c  rdinates: dim_0,
-00009920: 2064 696d 5f31 0a20 2020 2020 2020 2044   dim_1.        D
-00009930: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
-00009940: 2020 2020 2020 2020 2020 2066 6f6f 2020             foo  
-00009950: 2020 2020 2864 696d 5f30 2c20 6469 6d5f      (dim_0, dim_
-00009960: 3129 2066 6c6f 6174 3634 2037 2e30 2030  1) float64 7.0 0
-00009970: 2e34 3030 3220 302e 3937 3837 2032 2e32  .4002 0.9787 2.2
-00009980: 3431 2031 2e38 3638 202d 302e 3937 3733  41 1.868 -0.9773
-00009990: 0a20 2020 2020 2020 2020 2020 2062 6172  .            bar
-000099a0: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
-000099b0: 2d31 2032 0a0a 2020 2020 2020 2020 3e3e  -1 2..        >>
-000099c0: 3e20 6473 0a20 2020 2020 2020 203c 7861  > ds.        <xa
-000099d0: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
-000099e0: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
-000099f0: 3a20 2028 6469 6d5f 303a 2032 2c20 6469  :  (dim_0: 2, di
-00009a00: 6d5f 313a 2033 2c20 783a 2032 290a 2020  m_1: 3, x: 2).  
-00009a10: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
-00009a20: 733a 0a20 2020 2020 2020 2020 202a 2078  s:.          * x
-00009a30: 2020 2020 2020 2020 2878 2920 3c55 3320          (x) <U3 
-00009a40: 276f 6e65 2720 2774 776f 270a 2020 2020  'one' 'two'.    
-00009a50: 2020 2020 4469 6d65 6e73 696f 6e73 2077      Dimensions w
-00009a60: 6974 686f 7574 2063 6f6f 7264 696e 6174  ithout coordinat
-00009a70: 6573 3a20 6469 6d5f 302c 2064 696d 5f31  es: dim_0, dim_1
-00009a80: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-00009a90: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-00009aa0: 2020 2020 2066 6f6f 2020 2020 2020 2864       foo      (d
-00009ab0: 696d 5f30 2c20 6469 6d5f 3129 2066 6c6f  im_0, dim_1) flo
-00009ac0: 6174 3634 2037 2e30 2030 2e34 3030 3220  at64 7.0 0.4002 
-00009ad0: 302e 3937 3837 2032 2e32 3431 2031 2e38  0.9787 2.241 1.8
-00009ae0: 3638 202d 302e 3937 3733 0a20 2020 2020  68 -0.9773.     
-00009af0: 2020 2020 2020 2062 6172 2020 2020 2020         bar      
-00009b00: 2878 2920 696e 7436 3420 2d31 2032 0a0a  (x) int64 -1 2..
-00009b10: 2020 2020 2020 2020 4368 616e 6769 6e67          Changing
-00009b20: 2074 6865 2064 6174 6120 7573 696e 6720   the data using 
-00009b30: 7468 6520 6060 6461 7461 6060 2061 7267  the ``data`` arg
-00009b40: 756d 656e 7420 6d61 696e 7461 696e 7320  ument maintains 
-00009b50: 7468 650a 2020 2020 2020 2020 7374 7275  the.        stru
-00009b60: 6374 7572 6520 6f66 2074 6865 206f 7269  cture of the ori
-00009b70: 6769 6e61 6c20 6f62 6a65 6374 2c20 6275  ginal object, bu
-00009b80: 7420 7769 7468 2074 6865 206e 6577 2064  t with the new d
-00009b90: 6174 612e 204f 7269 6769 6e61 6c0a 2020  ata. Original.  
-00009ba0: 2020 2020 2020 6f62 6a65 6374 2069 7320        object is 
-00009bb0: 756e 6166 6665 6374 6564 2e0a 0a20 2020  unaffected...   
-00009bc0: 2020 2020 203e 3e3e 2064 732e 636f 7079       >>> ds.copy
-00009bd0: 2864 6174 613d 7b22 666f 6f22 3a20 6e70  (data={"foo": np
-00009be0: 2e61 7261 6e67 6528 3629 2e72 6573 6861  .arange(6).resha
-00009bf0: 7065 2832 2c20 3329 2c20 2262 6172 223a  pe(2, 3), "bar":
-00009c00: 205b 2261 222c 2022 6222 5d7d 290a 2020   ["a", "b"]}).  
-00009c10: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-00009c20: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-00009c30: 696d 656e 7369 6f6e 733a 2020 2864 696d  imensions:  (dim
-00009c40: 5f30 3a20 322c 2064 696d 5f31 3a20 332c  _0: 2, dim_1: 3,
-00009c50: 2078 3a20 3229 0a20 2020 2020 2020 2043   x: 2).        C
-00009c60: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-00009c70: 2020 2020 2020 2a20 7820 2020 2020 2020        * x       
-00009c80: 2028 7829 203c 5533 2027 6f6e 6527 2027   (x) <U3 'one' '
-00009c90: 7477 6f27 0a20 2020 2020 2020 2044 696d  two'.        Dim
-00009ca0: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
-00009cb0: 636f 6f72 6469 6e61 7465 733a 2064 696d  coordinates: dim
-00009cc0: 5f30 2c20 6469 6d5f 310a 2020 2020 2020  _0, dim_1.      
-00009cd0: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
-00009ce0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00009cf0: 6f20 2020 2020 2028 6469 6d5f 302c 2064  o      (dim_0, d
-00009d00: 696d 5f31 2920 696e 7436 3420 3020 3120  im_1) int64 0 1 
-00009d10: 3220 3320 3420 350a 2020 2020 2020 2020  2 3 4 5.        
-00009d20: 2020 2020 6261 7220 2020 2020 2028 7829      bar      (x)
-00009d30: 203c 5531 2027 6127 2027 6227 0a0a 2020   <U1 'a' 'b'..  
-00009d40: 2020 2020 2020 3e3e 3e20 6473 0a20 2020        >>> ds.   
-00009d50: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
-00009d60: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
-00009d70: 6d65 6e73 696f 6e73 3a20 2028 6469 6d5f  mensions:  (dim_
-00009d80: 303a 2032 2c20 6469 6d5f 313a 2033 2c20  0: 2, dim_1: 3, 
-00009d90: 783a 2032 290a 2020 2020 2020 2020 436f  x: 2).        Co
-00009da0: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
-00009db0: 2020 2020 202a 2078 2020 2020 2020 2020       * x        
-00009dc0: 2878 2920 3c55 3320 276f 6e65 2720 2774  (x) <U3 'one' 't
-00009dd0: 776f 270a 2020 2020 2020 2020 4469 6d65  wo'.        Dime
-00009de0: 6e73 696f 6e73 2077 6974 686f 7574 2063  nsions without c
-00009df0: 6f6f 7264 696e 6174 6573 3a20 6469 6d5f  oordinates: dim_
-00009e00: 302c 2064 696d 5f31 0a20 2020 2020 2020  0, dim_1.       
-00009e10: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
-00009e20: 0a20 2020 2020 2020 2020 2020 2066 6f6f  .            foo
-00009e30: 2020 2020 2020 2864 696d 5f30 2c20 6469        (dim_0, di
-00009e40: 6d5f 3129 2066 6c6f 6174 3634 2037 2e30  m_1) float64 7.0
-00009e50: 2030 2e34 3030 3220 302e 3937 3837 2032   0.4002 0.9787 2
-00009e60: 2e32 3431 2031 2e38 3638 202d 302e 3937  .241 1.868 -0.97
-00009e70: 3733 0a20 2020 2020 2020 2020 2020 2062  73.            b
-00009e80: 6172 2020 2020 2020 2878 2920 696e 7436  ar      (x) int6
-00009e90: 3420 2d31 2032 0a0a 2020 2020 2020 2020  4 -1 2..        
-00009ea0: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-00009eb0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00009ec0: 2020 7061 6e64 6173 2e44 6174 6146 7261    pandas.DataFra
-00009ed0: 6d65 2e63 6f70 790a 2020 2020 2020 2020  me.copy.        
-00009ee0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00009ef0: 726e 2073 656c 662e 5f63 6f70 7928 6465  rn self._copy(de
-00009f00: 6570 3d64 6565 702c 2064 6174 613d 6461  ep=deep, data=da
-00009f10: 7461 290a 0a20 2020 2064 6566 205f 636f  ta)..    def _co
-00009f20: 7079 280a 2020 2020 2020 2020 7365 6c66  py(.        self
-00009f30: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
-00009f40: 2020 2020 2064 6565 703a 2062 6f6f 6c20       deep: bool 
-00009f50: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-00009f60: 2064 6174 613a 204d 6170 7069 6e67 5b41   data: Mapping[A
-00009f70: 6e79 2c20 4172 7261 794c 696b 655d 207c  ny, ArrayLike] |
-00009f80: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00009f90: 2020 2020 2020 6d65 6d6f 3a20 6469 6374        memo: dict
-00009fa0: 5b69 6e74 2c20 416e 795d 207c 204e 6f6e  [int, Any] | Non
-00009fb0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
-00009fc0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
-00009fd0: 2020 2020 2020 6966 2064 6174 6120 6973        if data is
-00009fe0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00009ff0: 2020 2064 6174 6120 3d20 7b7d 0a20 2020     data = {}.   
-0000a000: 2020 2020 2065 6c69 6620 6e6f 7420 7574       elif not ut
-0000a010: 696c 732e 6973 5f64 6963 745f 6c69 6b65  ils.is_dict_like
-0000a020: 2864 6174 6129 3a0a 2020 2020 2020 2020  (data):.        
-0000a030: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000a040: 7272 6f72 2822 4461 7461 206d 7573 7420  rror("Data must 
-0000a050: 6265 2064 6963 742d 6c69 6b65 2229 0a0a  be dict-like")..
-0000a060: 2020 2020 2020 2020 6966 2064 6174 613a          if data:
-0000a070: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-0000a080: 5f6b 6579 7320 3d20 7365 7428 7365 6c66  _keys = set(self
-0000a090: 2e64 6174 615f 7661 7273 2e6b 6579 7328  .data_vars.keys(
-0000a0a0: 2929 0a20 2020 2020 2020 2020 2020 2064  )).            d
-0000a0b0: 6174 615f 6b65 7973 203d 2073 6574 2864  ata_keys = set(d
-0000a0c0: 6174 612e 6b65 7973 2829 290a 2020 2020  ata.keys()).    
-0000a0d0: 2020 2020 2020 2020 6b65 7973 5f6e 6f74          keys_not
-0000a0e0: 5f69 6e5f 7661 7273 203d 2064 6174 615f  _in_vars = data_
-0000a0f0: 6b65 7973 202d 2076 6172 5f6b 6579 730a  keys - var_keys.
-0000a100: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-0000a110: 6579 735f 6e6f 745f 696e 5f76 6172 733a  eys_not_in_vars:
-0000a120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a130: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0000a140: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0000a150: 2020 2020 2020 2022 4461 7461 206d 7573         "Data mus
-0000a160: 7420 6f6e 6c79 2063 6f6e 7461 696e 2076  t only contain v
-0000a170: 6172 6961 626c 6573 2069 6e20 6f72 6967  ariables in orig
-0000a180: 696e 616c 2022 0a20 2020 2020 2020 2020  inal ".         
-0000a190: 2020 2020 2020 2020 2020 2022 6461 7461             "data
-0000a1a0: 7365 742e 2045 7874 7261 2076 6172 6961  set. Extra varia
-0000a1b0: 626c 6573 3a20 7b7d 222e 666f 726d 6174  bles: {}".format
-0000a1c0: 286b 6579 735f 6e6f 745f 696e 5f76 6172  (keys_not_in_var
-0000a1d0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-0000a1e0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000a1f0: 206b 6579 735f 6d69 7373 696e 675f 6672   keys_missing_fr
-0000a200: 6f6d 5f64 6174 6120 3d20 7661 725f 6b65  om_data = var_ke
-0000a210: 7973 202d 2064 6174 615f 6b65 7973 0a20  ys - data_keys. 
-0000a220: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
-0000a230: 7973 5f6d 6973 7369 6e67 5f66 726f 6d5f  ys_missing_from_
-0000a240: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-0000a250: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000a260: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0000a270: 2020 2020 2020 2020 2020 2020 2244 6174              "Dat
-0000a280: 6120 6d75 7374 2063 6f6e 7461 696e 2061  a must contain a
-0000a290: 6c6c 2076 6172 6961 626c 6573 2069 6e20  ll variables in 
-0000a2a0: 6f72 6967 696e 616c 2022 0a20 2020 2020  original ".     
-0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000a2c0: 6461 7461 7365 742e 2044 6174 6120 6973  dataset. Data is
-0000a2d0: 206d 6973 7369 6e67 207b 7d22 2e66 6f72   missing {}".for
-0000a2e0: 6d61 7428 6b65 7973 5f6d 6973 7369 6e67  mat(keys_missing
-0000a2f0: 5f66 726f 6d5f 6461 7461 290a 2020 2020  _from_data).    
-0000a300: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0000a310: 2020 2020 2020 2069 6e64 6578 6573 2c20         indexes, 
-0000a320: 696e 6465 785f 7661 7273 203d 2073 656c  index_vars = sel
-0000a330: 662e 7869 6e64 6578 6573 2e63 6f70 795f  f.xindexes.copy_
-0000a340: 696e 6465 7865 7328 6465 6570 3d64 6565  indexes(deep=dee
-0000a350: 7029 0a0a 2020 2020 2020 2020 7661 7269  p)..        vari
-0000a360: 6162 6c65 7320 3d20 7b7d 0a20 2020 2020  ables = {}.     
-0000a370: 2020 2066 6f72 206b 2c20 7620 696e 2073     for k, v in s
-0000a380: 656c 662e 5f76 6172 6961 626c 6573 2e69  elf._variables.i
-0000a390: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0000a3a0: 2020 2020 6966 206b 2069 6e20 696e 6465      if k in inde
-0000a3b0: 785f 7661 7273 3a0a 2020 2020 2020 2020  x_vars:.        
-0000a3c0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0000a3d0: 735b 6b5d 203d 2069 6e64 6578 5f76 6172  s[k] = index_var
-0000a3e0: 735b 6b5d 0a20 2020 2020 2020 2020 2020  s[k].           
-0000a3f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000a400: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-0000a410: 5b6b 5d20 3d20 762e 5f63 6f70 7928 6465  [k] = v._copy(de
-0000a420: 6570 3d64 6565 702c 2064 6174 613d 6461  ep=deep, data=da
-0000a430: 7461 2e67 6574 286b 292c 206d 656d 6f3d  ta.get(k), memo=
-0000a440: 6d65 6d6f 290a 0a20 2020 2020 2020 2061  memo)..        a
-0000a450: 7474 7273 203d 2063 6f70 792e 6465 6570  ttrs = copy.deep
-0000a460: 636f 7079 2873 656c 662e 5f61 7474 7273  copy(self._attrs
-0000a470: 2c20 6d65 6d6f 2920 6966 2064 6565 7020  , memo) if deep 
-0000a480: 656c 7365 2063 6f70 792e 636f 7079 2873  else copy.copy(s
-0000a490: 656c 662e 5f61 7474 7273 290a 2020 2020  elf._attrs).    
-0000a4a0: 2020 2020 656e 636f 6469 6e67 203d 2028      encoding = (
-0000a4b0: 0a20 2020 2020 2020 2020 2020 2063 6f70  .            cop
-0000a4c0: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
-0000a4d0: 5f65 6e63 6f64 696e 672c 206d 656d 6f29  _encoding, memo)
-0000a4e0: 2069 6620 6465 6570 2065 6c73 6520 636f   if deep else co
-0000a4f0: 7079 2e63 6f70 7928 7365 6c66 2e5f 656e  py.copy(self._en
-0000a500: 636f 6469 6e67 290a 2020 2020 2020 2020  coding).        
-0000a510: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0000a520: 6e20 7365 6c66 2e5f 7265 706c 6163 6528  n self._replace(
-0000a530: 7661 7269 6162 6c65 732c 2069 6e64 6578  variables, index
-0000a540: 6573 3d69 6e64 6578 6573 2c20 6174 7472  es=indexes, attr
-0000a550: 733d 6174 7472 732c 2065 6e63 6f64 696e  s=attrs, encodin
-0000a560: 673d 656e 636f 6469 6e67 290a 0a20 2020  g=encoding)..   
-0000a570: 2064 6566 205f 5f63 6f70 795f 5f28 7365   def __copy__(se
-0000a580: 6c66 3a20 545f 4461 7461 7365 7429 202d  lf: T_Dataset) -
-0000a590: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-0000a5a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000a5b0: 2e5f 636f 7079 2864 6565 703d 4661 6c73  ._copy(deep=Fals
-0000a5c0: 6529 0a0a 2020 2020 6465 6620 5f5f 6465  e)..    def __de
-0000a5d0: 6570 636f 7079 5f5f 2873 656c 663a 2054  epcopy__(self: T
-0000a5e0: 5f44 6174 6173 6574 2c20 6d65 6d6f 3a20  _Dataset, memo: 
-0000a5f0: 6469 6374 5b69 6e74 2c20 416e 795d 207c  dict[int, Any] |
-0000a600: 204e 6f6e 6520 3d20 4e6f 6e65 2920 2d3e   None = None) ->
-0000a610: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-0000a620: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000a630: 5f63 6f70 7928 6465 6570 3d54 7275 652c  _copy(deep=True,
-0000a640: 206d 656d 6f3d 6d65 6d6f 290a 0a20 2020   memo=memo)..   
-0000a650: 2064 6566 2061 735f 6e75 6d70 7928 7365   def as_numpy(se
-0000a660: 6c66 3a20 545f 4461 7461 7365 7429 202d  lf: T_Dataset) -
-0000a670: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-0000a680: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000a690: 2043 6f65 7263 6573 2077 7261 7070 6564   Coerces wrapped
-0000a6a0: 2064 6174 6120 616e 6420 636f 6f72 6469   data and coordi
-0000a6b0: 6e61 7465 7320 696e 746f 206e 756d 7079  nates into numpy
-0000a6c0: 2061 7272 6179 732c 2072 6574 7572 6e69   arrays, returni
-0000a6d0: 6e67 2061 2044 6174 6173 6574 2e0a 0a20  ng a Dataset... 
-0000a6e0: 2020 2020 2020 2053 6565 2061 6c73 6f0a         See also.
-0000a6f0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0000a700: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
-0000a710: 6179 2e61 735f 6e75 6d70 790a 2020 2020  ay.as_numpy.    
-0000a720: 2020 2020 4461 7461 4172 7261 792e 746f      DataArray.to
-0000a730: 5f6e 756d 7079 203a 2052 6574 7572 6e73  _numpy : Returns
-0000a740: 206f 6e6c 7920 7468 6520 6461 7461 2061   only the data a
-0000a750: 7320 6120 6e75 6d70 792e 6e64 6172 7261  s a numpy.ndarra
-0000a760: 7920 6f62 6a65 6374 2e0a 2020 2020 2020  y object..      
-0000a770: 2020 2222 220a 2020 2020 2020 2020 6e75    """.        nu
-0000a780: 6d70 795f 7661 7269 6162 6c65 7320 3d20  mpy_variables = 
-0000a790: 7b6b 3a20 762e 6173 5f6e 756d 7079 2829  {k: v.as_numpy()
-0000a7a0: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
-0000a7b0: 662e 7661 7269 6162 6c65 732e 6974 656d  f.variables.item
-0000a7c0: 7328 297d 0a20 2020 2020 2020 2072 6574  s()}.        ret
-0000a7d0: 7572 6e20 7365 6c66 2e5f 7265 706c 6163  urn self._replac
-0000a7e0: 6528 7661 7269 6162 6c65 733d 6e75 6d70  e(variables=nump
-0000a7f0: 795f 7661 7269 6162 6c65 7329 0a0a 2020  y_variables)..  
-0000a800: 2020 6465 6620 5f63 6f70 795f 6c69 7374    def _copy_list
-0000a810: 6564 2873 656c 663a 2054 5f44 6174 6173  ed(self: T_Datas
-0000a820: 6574 2c20 6e61 6d65 733a 2049 7465 7261  et, names: Itera
-0000a830: 626c 655b 4861 7368 6162 6c65 5d29 202d  ble[Hashable]) -
-0000a840: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-0000a850: 2020 2020 2022 2222 4372 6561 7465 2061       """Create a
-0000a860: 206e 6577 2044 6174 6173 6574 2077 6974   new Dataset wit
-0000a870: 6820 7468 6520 6c69 7374 6564 2076 6172  h the listed var
-0000a880: 6961 626c 6573 2066 726f 6d20 7468 6973  iables from this
-0000a890: 2064 6174 6173 6574 2061 6e64 0a20 2020   dataset and.   
-0000a8a0: 2020 2020 2074 6865 2061 6c6c 2072 656c       the all rel
-0000a8b0: 6576 616e 7420 636f 6f72 6469 6e61 7465  evant coordinate
-0000a8c0: 732e 2053 6b69 7073 2061 6c6c 2076 616c  s. Skips all val
-0000a8d0: 6964 6174 696f 6e2e 0a20 2020 2020 2020  idation..       
-0000a8e0: 2022 2222 0a20 2020 2020 2020 2076 6172   """.        var
-0000a8f0: 6961 626c 6573 3a20 6469 6374 5b48 6173  iables: dict[Has
-0000a900: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
-0000a910: 203d 207b 7d0a 2020 2020 2020 2020 636f   = {}.        co
-0000a920: 6f72 645f 6e61 6d65 7320 3d20 7365 7428  ord_names = set(
-0000a930: 290a 2020 2020 2020 2020 696e 6465 7865  ).        indexe
-0000a940: 733a 2064 6963 745b 4861 7368 6162 6c65  s: dict[Hashable
-0000a950: 2c20 496e 6465 785d 203d 207b 7d0a 0a20  , Index] = {}.. 
-0000a960: 2020 2020 2020 2066 6f72 206e 616d 6520         for name 
-0000a970: 696e 206e 616d 6573 3a0a 2020 2020 2020  in names:.      
-0000a980: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000a990: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-0000a9a0: 626c 6573 5b6e 616d 655d 203d 2073 656c  bles[name] = sel
-0000a9b0: 662e 5f76 6172 6961 626c 6573 5b6e 616d  f._variables[nam
-0000a9c0: 655d 0a20 2020 2020 2020 2020 2020 2065  e].            e
-0000a9d0: 7863 6570 7420 4b65 7945 7272 6f72 3a0a  xcept KeyError:.
-0000a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9f0: 7265 665f 6e61 6d65 2c20 7661 725f 6e61  ref_name, var_na
-0000aa00: 6d65 2c20 7661 7220 3d20 5f67 6574 5f76  me, var = _get_v
-0000aa10: 6972 7475 616c 5f76 6172 6961 626c 6528  irtual_variable(
-0000aa20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000aa30: 2020 2020 2073 656c 662e 5f76 6172 6961       self._varia
-0000aa40: 626c 6573 2c20 6e61 6d65 2c20 7365 6c66  bles, name, self
-0000aa50: 2e64 696d 730a 2020 2020 2020 2020 2020  .dims.          
-0000aa60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000aa70: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0000aa80: 735b 7661 725f 6e61 6d65 5d20 3d20 7661  s[var_name] = va
-0000aa90: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-0000aaa0: 2020 6966 2072 6566 5f6e 616d 6520 696e    if ref_name in
-0000aab0: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
-0000aac0: 6573 206f 7220 7265 665f 6e61 6d65 2069  es or ref_name i
-0000aad0: 6e20 7365 6c66 2e64 696d 733a 0a20 2020  n self.dims:.   
-0000aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aaf0: 2063 6f6f 7264 5f6e 616d 6573 2e61 6464   coord_names.add
-0000ab00: 2876 6172 5f6e 616d 6529 0a20 2020 2020  (var_name).     
-0000ab10: 2020 2020 2020 2020 2020 2069 6620 2876             if (v
-0000ab20: 6172 5f6e 616d 652c 2920 3d3d 2076 6172  ar_name,) == var
-0000ab30: 2e64 696d 733a 0a20 2020 2020 2020 2020  .dims:.         
-0000ab40: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-0000ab50: 2c20 696e 6465 785f 7661 7273 203d 2063  , index_vars = c
-0000ab60: 7265 6174 655f 6465 6661 756c 745f 696e  reate_default_in
-0000ab70: 6465 785f 696d 706c 6963 6974 2876 6172  dex_implicit(var
-0000ab80: 2c20 6e61 6d65 7329 0a20 2020 2020 2020  , names).       
-0000ab90: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-0000aba0: 6578 6573 2e75 7064 6174 6528 7b6b 3a20  exes.update({k: 
-0000abb0: 696e 6465 7820 666f 7220 6b20 696e 2069  index for k in i
-0000abc0: 6e64 6578 5f76 6172 737d 290a 2020 2020  ndex_vars}).    
-0000abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000abe0: 7661 7269 6162 6c65 732e 7570 6461 7465  variables.update
-0000abf0: 2869 6e64 6578 5f76 6172 7329 0a20 2020  (index_vars).   
-0000ac00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac10: 2063 6f6f 7264 5f6e 616d 6573 2e75 7064   coord_names.upd
-0000ac20: 6174 6528 696e 6465 785f 7661 7273 290a  ate(index_vars).
-0000ac30: 0a20 2020 2020 2020 206e 6565 6465 645f  .        needed_
-0000ac40: 6469 6d73 3a20 4f72 6465 7265 6453 6574  dims: OrderedSet
-0000ac50: 5b48 6173 6861 626c 655d 203d 204f 7264  [Hashable] = Ord
-0000ac60: 6572 6564 5365 7428 290a 2020 2020 2020  eredSet().      
-0000ac70: 2020 666f 7220 7620 696e 2076 6172 6961    for v in varia
-0000ac80: 626c 6573 2e76 616c 7565 7328 293a 0a20  bles.values():. 
-0000ac90: 2020 2020 2020 2020 2020 206e 6565 6465             neede
-0000aca0: 645f 6469 6d73 2e75 7064 6174 6528 762e  d_dims.update(v.
-0000acb0: 6469 6d73 290a 0a20 2020 2020 2020 2064  dims)..        d
-0000acc0: 696d 7320 3d20 7b6b 3a20 7365 6c66 2e64  ims = {k: self.d
-0000acd0: 696d 735b 6b5d 2066 6f72 206b 2069 6e20  ims[k] for k in 
-0000ace0: 6e65 6564 6564 5f64 696d 737d 0a0a 2020  needed_dims}..  
-0000acf0: 2020 2020 2020 2320 7072 6573 6572 7665        # preserve
-0000ad00: 7320 6f72 6465 7269 6e67 206f 6620 636f  s ordering of co
-0000ad10: 6f72 6469 6e61 7465 730a 2020 2020 2020  ordinates.      
-0000ad20: 2020 666f 7220 6b20 696e 2073 656c 662e    for k in self.
-0000ad30: 5f76 6172 6961 626c 6573 3a0a 2020 2020  _variables:.    
-0000ad40: 2020 2020 2020 2020 6966 206b 206e 6f74          if k not
-0000ad50: 2069 6e20 7365 6c66 2e5f 636f 6f72 645f   in self._coord_
-0000ad60: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
-0000ad70: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-0000ad80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000ad90: 7365 7428 7365 6c66 2e76 6172 6961 626c  set(self.variabl
-0000ada0: 6573 5b6b 5d2e 6469 6d73 2920 3c3d 206e  es[k].dims) <= n
-0000adb0: 6565 6465 645f 6469 6d73 3a0a 2020 2020  eeded_dims:.    
-0000adc0: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-0000add0: 6162 6c65 735b 6b5d 203d 2073 656c 662e  ables[k] = self.
-0000ade0: 5f76 6172 6961 626c 6573 5b6b 5d0a 2020  _variables[k].  
-0000adf0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000ae00: 6f72 645f 6e61 6d65 732e 6164 6428 6b29  ord_names.add(k)
-0000ae10: 0a0a 2020 2020 2020 2020 696e 6465 7865  ..        indexe
-0000ae20: 732e 7570 6461 7465 2866 696c 7465 725f  s.update(filter_
-0000ae30: 696e 6465 7865 735f 6672 6f6d 5f63 6f6f  indexes_from_coo
-0000ae40: 7264 7328 7365 6c66 2e5f 696e 6465 7865  rds(self._indexe
-0000ae50: 732c 2063 6f6f 7264 5f6e 616d 6573 2929  s, coord_names))
-0000ae60: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000ae70: 2073 656c 662e 5f72 6570 6c61 6365 2876   self._replace(v
-0000ae80: 6172 6961 626c 6573 2c20 636f 6f72 645f  ariables, coord_
-0000ae90: 6e61 6d65 732c 2064 696d 732c 2069 6e64  names, dims, ind
-0000aea0: 6578 6573 3d69 6e64 6578 6573 290a 0a20  exes=indexes).. 
-0000aeb0: 2020 2064 6566 205f 636f 6e73 7472 7563     def _construc
-0000aec0: 745f 6461 7461 6172 7261 7928 7365 6c66  t_dataarray(self
-0000aed0: 2c20 6e61 6d65 3a20 4861 7368 6162 6c65  , name: Hashable
-0000aee0: 2920 2d3e 2044 6174 6141 7272 6179 3a0a  ) -> DataArray:.
-0000aef0: 2020 2020 2020 2020 2222 2243 6f6e 7374          """Const
-0000af00: 7275 6374 2061 2044 6174 6141 7272 6179  ruct a DataArray
-0000af10: 2062 7920 696e 6465 7869 6e67 2074 6869   by indexing thi
-0000af20: 7320 6461 7461 7365 7422 2222 0a20 2020  s dataset""".   
-0000af30: 2020 2020 2066 726f 6d20 7861 7272 6179       from xarray
-0000af40: 2e63 6f72 652e 6461 7461 6172 7261 7920  .core.dataarray 
-0000af50: 696d 706f 7274 2044 6174 6141 7272 6179  import DataArray
-0000af60: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
-0000af70: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-0000af80: 626c 6520 3d20 7365 6c66 2e5f 7661 7269  ble = self._vari
-0000af90: 6162 6c65 735b 6e61 6d65 5d0a 2020 2020  ables[name].    
-0000afa0: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
-0000afb0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-0000afc0: 205f 2c20 6e61 6d65 2c20 7661 7269 6162   _, name, variab
-0000afd0: 6c65 203d 205f 6765 745f 7669 7274 7561  le = _get_virtua
-0000afe0: 6c5f 7661 7269 6162 6c65 2873 656c 662e  l_variable(self.
-0000aff0: 5f76 6172 6961 626c 6573 2c20 6e61 6d65  _variables, name
-0000b000: 2c20 7365 6c66 2e64 696d 7329 0a0a 2020  , self.dims)..  
-0000b010: 2020 2020 2020 6e65 6564 6564 5f64 696d        needed_dim
-0000b020: 7320 3d20 7365 7428 7661 7269 6162 6c65  s = set(variable
-0000b030: 2e64 696d 7329 0a0a 2020 2020 2020 2020  .dims)..        
-0000b040: 636f 6f72 6473 3a20 6469 6374 5b48 6173  coords: dict[Has
-0000b050: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
-0000b060: 203d 207b 7d0a 2020 2020 2020 2020 2320   = {}.        # 
-0000b070: 7072 6573 6572 7665 206f 7264 6572 696e  preserve orderin
-0000b080: 670a 2020 2020 2020 2020 666f 7220 6b20  g.        for k 
-0000b090: 696e 2073 656c 662e 5f76 6172 6961 626c  in self._variabl
-0000b0a0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0000b0b0: 6966 206b 2069 6e20 7365 6c66 2e5f 636f  if k in self._co
-0000b0c0: 6f72 645f 6e61 6d65 7320 616e 6420 7365  ord_names and se
-0000b0d0: 7428 7365 6c66 2e76 6172 6961 626c 6573  t(self.variables
-0000b0e0: 5b6b 5d2e 6469 6d73 2920 3c3d 206e 6565  [k].dims) <= nee
-0000b0f0: 6465 645f 6469 6d73 3a0a 2020 2020 2020  ded_dims:.      
-0000b100: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
-0000b110: 5b6b 5d20 3d20 7365 6c66 2e76 6172 6961  [k] = self.varia
-0000b120: 626c 6573 5b6b 5d0a 0a20 2020 2020 2020  bles[k]..       
-0000b130: 2069 6e64 6578 6573 203d 2066 696c 7465   indexes = filte
-0000b140: 725f 696e 6465 7865 735f 6672 6f6d 5f63  r_indexes_from_c
-0000b150: 6f6f 7264 7328 7365 6c66 2e5f 696e 6465  oords(self._inde
-0000b160: 7865 732c 2073 6574 2863 6f6f 7264 7329  xes, set(coords)
-0000b170: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0000b180: 6e20 4461 7461 4172 7261 7928 7661 7269  n DataArray(vari
-0000b190: 6162 6c65 2c20 636f 6f72 6473 2c20 6e61  able, coords, na
-0000b1a0: 6d65 3d6e 616d 652c 2069 6e64 6578 6573  me=name, indexes
-0000b1b0: 3d69 6e64 6578 6573 2c20 6661 7374 7061  =indexes, fastpa
-0000b1c0: 7468 3d54 7275 6529 0a0a 2020 2020 4070  th=True)..    @p
-0000b1d0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-0000b1e0: 5f61 7474 725f 736f 7572 6365 7328 7365  _attr_sources(se
-0000b1f0: 6c66 2920 2d3e 2049 7465 7261 626c 655b  lf) -> Iterable[
-0000b200: 4d61 7070 696e 675b 4861 7368 6162 6c65  Mapping[Hashable
-0000b210: 2c20 416e 795d 5d3a 0a20 2020 2020 2020  , Any]]:.       
-0000b220: 2022 2222 506c 6163 6573 2074 6f20 6c6f   """Places to lo
-0000b230: 6f6b 2d75 7020 6974 656d 7320 666f 7220  ok-up items for 
-0000b240: 6174 7472 6962 7574 652d 7374 796c 6520  attribute-style 
-0000b250: 6163 6365 7373 2222 220a 2020 2020 2020  access""".      
-0000b260: 2020 7969 656c 6420 6672 6f6d 2073 656c    yield from sel
-0000b270: 662e 5f69 7465 6d5f 736f 7572 6365 730a  f._item_sources.
-0000b280: 2020 2020 2020 2020 7969 656c 6420 7365          yield se
-0000b290: 6c66 2e61 7474 7273 0a0a 2020 2020 4070  lf.attrs..    @p
-0000b2a0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-0000b2b0: 5f69 7465 6d5f 736f 7572 6365 7328 7365  _item_sources(se
-0000b2c0: 6c66 2920 2d3e 2049 7465 7261 626c 655b  lf) -> Iterable[
-0000b2d0: 4d61 7070 696e 675b 4861 7368 6162 6c65  Mapping[Hashable
-0000b2e0: 2c20 416e 795d 5d3a 0a20 2020 2020 2020  , Any]]:.       
-0000b2f0: 2022 2222 506c 6163 6573 2074 6f20 6c6f   """Places to lo
-0000b300: 6f6b 2d75 7020 6974 656d 7320 666f 7220  ok-up items for 
-0000b310: 6b65 792d 636f 6d70 6c65 7469 6f6e 2222  key-completion""
-0000b320: 220a 2020 2020 2020 2020 7969 656c 6420  ".        yield 
-0000b330: 7365 6c66 2e64 6174 615f 7661 7273 0a20  self.data_vars. 
-0000b340: 2020 2020 2020 2079 6965 6c64 2048 7962         yield Hyb
-0000b350: 7269 644d 6170 7069 6e67 5072 6f78 7928  ridMappingProxy(
-0000b360: 6b65 7973 3d73 656c 662e 5f63 6f6f 7264  keys=self._coord
-0000b370: 5f6e 616d 6573 2c20 6d61 7070 696e 673d  _names, mapping=
-0000b380: 7365 6c66 2e63 6f6f 7264 7329 0a0a 2020  self.coords)..  
-0000b390: 2020 2020 2020 2320 7669 7274 7561 6c20        # virtual 
-0000b3a0: 636f 6f72 6469 6e61 7465 730a 2020 2020  coordinates.    
-0000b3b0: 2020 2020 7969 656c 6420 4879 6272 6964      yield Hybrid
-0000b3c0: 4d61 7070 696e 6750 726f 7879 286b 6579  MappingProxy(key
-0000b3d0: 733d 7365 6c66 2e64 696d 732c 206d 6170  s=self.dims, map
-0000b3e0: 7069 6e67 3d73 656c 6629 0a0a 2020 2020  ping=self)..    
-0000b3f0: 6465 6620 5f5f 636f 6e74 6169 6e73 5f5f  def __contains__
-0000b400: 2873 656c 662c 206b 6579 3a20 6f62 6a65  (self, key: obje
-0000b410: 6374 2920 2d3e 2062 6f6f 6c3a 0a20 2020  ct) -> bool:.   
-0000b420: 2020 2020 2022 2222 5468 6520 2769 6e27       """The 'in'
-0000b430: 206f 7065 7261 746f 7220 7769 6c6c 2072   operator will r
-0000b440: 6574 7572 6e20 7472 7565 206f 7220 6661  eturn true or fa
-0000b450: 6c73 6520 6465 7065 6e64 696e 6720 6f6e  lse depending on
-0000b460: 2077 6865 7468 6572 0a20 2020 2020 2020   whether.       
-0000b470: 2027 6b65 7927 2069 7320 616e 2061 7272   'key' is an arr
-0000b480: 6179 2069 6e20 7468 6520 6461 7461 7365  ay in the datase
-0000b490: 7420 6f72 206e 6f74 2e0a 2020 2020 2020  t or not..      
-0000b4a0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-0000b4b0: 7475 726e 206b 6579 2069 6e20 7365 6c66  turn key in self
-0000b4c0: 2e5f 7661 7269 6162 6c65 730a 0a20 2020  ._variables..   
-0000b4d0: 2064 6566 205f 5f6c 656e 5f5f 2873 656c   def __len__(sel
-0000b4e0: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-0000b4f0: 2020 2072 6574 7572 6e20 6c65 6e28 7365     return len(se
-0000b500: 6c66 2e64 6174 615f 7661 7273 290a 0a20  lf.data_vars).. 
-0000b510: 2020 2064 6566 205f 5f62 6f6f 6c5f 5f28     def __bool__(
-0000b520: 7365 6c66 2920 2d3e 2062 6f6f 6c3a 0a20  self) -> bool:. 
-0000b530: 2020 2020 2020 2072 6574 7572 6e20 626f         return bo
-0000b540: 6f6c 2873 656c 662e 6461 7461 5f76 6172  ol(self.data_var
-0000b550: 7329 0a0a 2020 2020 6465 6620 5f5f 6974  s)..    def __it
-0000b560: 6572 5f5f 2873 656c 6629 202d 3e20 4974  er__(self) -> It
-0000b570: 6572 6174 6f72 5b48 6173 6861 626c 655d  erator[Hashable]
-0000b580: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000b590: 2069 7465 7228 7365 6c66 2e64 6174 615f   iter(self.data_
-0000b5a0: 7661 7273 290a 0a20 2020 2064 6566 205f  vars)..    def _
-0000b5b0: 5f61 7272 6179 5f5f 2873 656c 662c 2064  _array__(self, d
-0000b5c0: 7479 7065 3d4e 6f6e 6529 3a0a 2020 2020  type=None):.    
-0000b5d0: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-0000b5e0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0000b5f0: 2022 6361 6e6e 6f74 2064 6972 6563 746c   "cannot directl
-0000b600: 7920 636f 6e76 6572 7420 616e 2078 6172  y convert an xar
-0000b610: 7261 792e 4461 7461 7365 7420 696e 746f  ray.Dataset into
-0000b620: 2061 2022 0a20 2020 2020 2020 2020 2020   a ".           
-0000b630: 2022 6e75 6d70 7920 6172 7261 792e 2049   "numpy array. I
-0000b640: 6e73 7465 6164 2c20 6372 6561 7465 2061  nstead, create a
-0000b650: 6e20 7861 7272 6179 2e44 6174 6141 7272  n xarray.DataArr
-0000b660: 6179 2022 0a20 2020 2020 2020 2020 2020  ay ".           
-0000b670: 2022 6669 7273 742c 2065 6974 6865 7220   "first, either 
-0000b680: 7769 7468 2069 6e64 6578 696e 6720 6f6e  with indexing on
-0000b690: 2074 6865 2044 6174 6173 6574 206f 7220   the Dataset or 
-0000b6a0: 6279 2022 0a20 2020 2020 2020 2020 2020  by ".           
-0000b6b0: 2022 696e 766f 6b69 6e67 2074 6865 2060   "invoking the `
-0000b6c0: 746f 5f61 7272 6179 2829 6020 6d65 7468  to_array()` meth
-0000b6d0: 6f64 2e22 0a20 2020 2020 2020 2029 0a0a  od.".        )..
-0000b6e0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-0000b6f0: 2020 6465 6620 6e62 7974 6573 2873 656c    def nbytes(sel
-0000b700: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-0000b710: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
-0000b720: 6f74 616c 2062 7974 6573 2063 6f6e 7375  otal bytes consu
-0000b730: 6d65 6420 6279 2074 6865 2064 6174 6120  med by the data 
-0000b740: 6172 7261 7973 206f 6620 616c 6c20 7661  arrays of all va
-0000b750: 7269 6162 6c65 7320 696e 2074 6869 7320  riables in this 
-0000b760: 6461 7461 7365 742e 0a0a 2020 2020 2020  dataset...      
-0000b770: 2020 4966 2074 6865 2062 6163 6b65 6e64    If the backend
-0000b780: 2061 7272 6179 2066 6f72 2061 6e79 2076   array for any v
-0000b790: 6172 6961 626c 6520 646f 6573 206e 6f74  ariable does not
-0000b7a0: 2069 6e63 6c75 6465 2060 606e 6279 7465   include ``nbyte
-0000b7b0: 7360 602c 2065 7374 696d 6174 6573 0a20  s``, estimates. 
-0000b7c0: 2020 2020 2020 2074 6865 2074 6f74 616c         the total
-0000b7d0: 2062 7974 6573 2066 6f72 2074 6861 7420   bytes for that 
-0000b7e0: 6172 7261 7920 6261 7365 6420 6f6e 2074  array based on t
-0000b7f0: 6865 2060 6073 697a 6560 6020 616e 6420  he ``size`` and 
-0000b800: 6060 6474 7970 6560 602e 0a20 2020 2020  ``dtype``..     
-0000b810: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-0000b820: 6574 7572 6e20 7375 6d28 762e 6e62 7974  eturn sum(v.nbyt
-0000b830: 6573 2066 6f72 2076 2069 6e20 7365 6c66  es for v in self
-0000b840: 2e76 6172 6961 626c 6573 2e76 616c 7565  .variables.value
-0000b850: 7328 2929 0a0a 2020 2020 4070 726f 7065  s())..    @prope
-0000b860: 7274 790a 2020 2020 6465 6620 6c6f 6328  rty.    def loc(
-0000b870: 7365 6c66 3a20 545f 4461 7461 7365 7429  self: T_Dataset)
-0000b880: 202d 3e20 5f4c 6f63 496e 6465 7865 725b   -> _LocIndexer[
-0000b890: 545f 4461 7461 7365 745d 3a0a 2020 2020  T_Dataset]:.    
-0000b8a0: 2020 2020 2222 2241 7474 7269 6275 7465      """Attribute
-0000b8b0: 2066 6f72 206c 6f63 6174 696f 6e20 6261   for location ba
-0000b8c0: 7365 6420 696e 6465 7869 6e67 2e20 4f6e  sed indexing. On
-0000b8d0: 6c79 2073 7570 706f 7274 7320 5f5f 6765  ly supports __ge
-0000b8e0: 7469 7465 6d5f 5f2c 0a20 2020 2020 2020  titem__,.       
-0000b8f0: 2061 6e64 206f 6e6c 7920 7768 656e 2074   and only when t
-0000b900: 6865 206b 6579 2069 7320 6120 6469 6374  he key is a dict
-0000b910: 206f 6620 7468 6520 666f 726d 207b 6469   of the form {di
-0000b920: 6d3a 206c 6162 656c 737d 2e0a 2020 2020  m: labels}..    
-0000b930: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000b940: 7265 7475 726e 205f 4c6f 6349 6e64 6578  return _LocIndex
-0000b950: 6572 2873 656c 6629 0a0a 2020 2020 406f  er(self)..    @o
-0000b960: 7665 726c 6f61 640a 2020 2020 6465 6620  verload.    def 
-0000b970: 5f5f 6765 7469 7465 6d5f 5f28 7365 6c66  __getitem__(self
-0000b980: 2c20 6b65 793a 2048 6173 6861 626c 6529  , key: Hashable)
-0000b990: 202d 3e20 4461 7461 4172 7261 793a 0a20   -> DataArray:. 
-0000b9a0: 2020 2020 2020 202e 2e2e 0a0a 2020 2020         .....    
-0000b9b0: 2320 4d61 7070 696e 6720 6973 2049 7465  # Mapping is Ite
-0000b9c0: 7261 626c 650a 2020 2020 406f 7665 726c  rable.    @overl
-0000b9d0: 6f61 640a 2020 2020 6465 6620 5f5f 6765  oad.    def __ge
-0000b9e0: 7469 7465 6d5f 5f28 7365 6c66 3a20 545f  titem__(self: T_
-0000b9f0: 4461 7461 7365 742c 206b 6579 3a20 4974  Dataset, key: It
-0000ba00: 6572 6162 6c65 5b48 6173 6861 626c 655d  erable[Hashable]
-0000ba10: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-0000ba20: 2020 2020 2020 2020 2e2e 2e0a 0a20 2020          .....   
-0000ba30: 2064 6566 205f 5f67 6574 6974 656d 5f5f   def __getitem__
-0000ba40: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
-0000ba50: 545f 4461 7461 7365 742c 206b 6579 3a20  T_Dataset, key: 
-0000ba60: 4d61 7070 696e 675b 416e 792c 2041 6e79  Mapping[Any, Any
-0000ba70: 5d20 7c20 4861 7368 6162 6c65 207c 2049  ] | Hashable | I
-0000ba80: 7465 7261 626c 655b 4861 7368 6162 6c65  terable[Hashable
-0000ba90: 5d0a 2020 2020 2920 2d3e 2054 5f44 6174  ].    ) -> T_Dat
-0000baa0: 6173 6574 207c 2044 6174 6141 7272 6179  aset | DataArray
-0000bab0: 3a0a 2020 2020 2020 2020 2222 2241 6363  :.        """Acc
-0000bac0: 6573 7320 7661 7269 6162 6c65 7320 6f72  ess variables or
-0000bad0: 2063 6f6f 7264 696e 6174 6573 206f 6620   coordinates of 
-0000bae0: 7468 6973 2064 6174 6173 6574 2061 7320  this dataset as 
-0000baf0: 610a 2020 2020 2020 2020 3a70 793a 636c  a.        :py:cl
-0000bb00: 6173 733a 607e 7861 7272 6179 2e44 6174  ass:`~xarray.Dat
-0000bb10: 6141 7272 6179 6020 6f72 2061 2073 7562  aArray` or a sub
-0000bb20: 7365 7420 6f66 2076 6172 6961 626c 6573  set of variables
-0000bb30: 206f 7220 6120 696e 6465 7865 6420 6461   or a indexed da
-0000bb40: 7461 7365 742e 0a0a 2020 2020 2020 2020  taset...        
-0000bb50: 496e 6465 7869 6e67 2077 6974 6820 6120  Indexing with a 
-0000bb60: 6c69 7374 206f 6620 6e61 6d65 7320 7769  list of names wi
-0000bb70: 6c6c 2072 6574 7572 6e20 6120 6e65 7720  ll return a new 
-0000bb80: 6060 4461 7461 7365 7460 6020 6f62 6a65  ``Dataset`` obje
-0000bb90: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
-0000bba0: 2020 2020 2020 2020 6966 2075 7469 6c73          if utils
-0000bbb0: 2e69 735f 6469 6374 5f6c 696b 6528 6b65  .is_dict_like(ke
-0000bbc0: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
-0000bbd0: 7265 7475 726e 2073 656c 662e 6973 656c  return self.isel
-0000bbe0: 282a 2a6b 6579 290a 2020 2020 2020 2020  (**key).        
-0000bbf0: 6966 2075 7469 6c73 2e68 6173 6861 626c  if utils.hashabl
-0000bc00: 6528 6b65 7929 3a0a 2020 2020 2020 2020  e(key):.        
-0000bc10: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000bc20: 5f63 6f6e 7374 7275 6374 5f64 6174 6161  _construct_dataa
-0000bc30: 7272 6179 286b 6579 290a 2020 2020 2020  rray(key).      
-0000bc40: 2020 6966 2075 7469 6c73 2e69 7465 7261    if utils.itera
-0000bc50: 626c 655f 6f66 5f68 6173 6861 626c 6528  ble_of_hashable(
-0000bc60: 6b65 7929 3a0a 2020 2020 2020 2020 2020  key):.          
-0000bc70: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
-0000bc80: 6f70 795f 6c69 7374 6564 286b 6579 290a  opy_listed(key).
-0000bc90: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000bca0: 6c75 6545 7272 6f72 2866 2255 6e73 7570  lueError(f"Unsup
-0000bcb0: 706f 7274 6564 206b 6579 2d74 7970 6520  ported key-type 
-0000bcc0: 7b74 7970 6528 6b65 7929 7d22 290a 0a20  {type(key)}").. 
-0000bcd0: 2020 2064 6566 205f 5f73 6574 6974 656d     def __setitem
-0000bce0: 5f5f 280a 2020 2020 2020 2020 7365 6c66  __(.        self
-0000bcf0: 2c20 6b65 793a 2048 6173 6861 626c 6520  , key: Hashable 
-0000bd00: 7c20 4974 6572 6162 6c65 5b48 6173 6861  | Iterable[Hasha
-0000bd10: 626c 655d 207c 204d 6170 7069 6e67 2c20  ble] | Mapping, 
-0000bd20: 7661 6c75 653a 2041 6e79 0a20 2020 2029  value: Any.    )
-0000bd30: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000bd40: 2020 2222 2241 6464 2061 6e20 6172 7261    """Add an arra
-0000bd50: 7920 746f 2074 6869 7320 6461 7461 7365  y to this datase
-0000bd60: 742e 0a20 2020 2020 2020 204d 756c 7469  t..        Multi
-0000bd70: 706c 6520 6172 7261 7973 2063 616e 2062  ple arrays can b
-0000bd80: 6520 6164 6465 6420 6174 2074 6865 2073  e added at the s
-0000bd90: 616d 6520 7469 6d65 2c20 696e 2077 6869  ame time, in whi
-0000bda0: 6368 2063 6173 6520 6561 6368 206f 660a  ch case each of.
-0000bdb0: 2020 2020 2020 2020 7468 6520 666f 6c6c          the foll
-0000bdc0: 6f77 696e 6720 6f70 6572 6174 696f 6e73  owing operations
-0000bdd0: 2069 7320 6170 706c 6965 6420 746f 2074   is applied to t
-0000bde0: 6865 2072 6573 7065 6374 6976 6520 7661  he respective va
-0000bdf0: 6c75 652e 0a0a 2020 2020 2020 2020 4966  lue...        If
-0000be00: 206b 6579 2069 7320 6469 6374 2d6c 696b   key is dict-lik
-0000be10: 652c 2075 7064 6174 6520 616c 6c20 7661  e, update all va
-0000be20: 7269 6162 6c65 7320 696e 2074 6865 2064  riables in the d
-0000be30: 6174 6173 6574 0a20 2020 2020 2020 206f  ataset.        o
-0000be40: 6e65 2062 7920 6f6e 6520 7769 7468 2074  ne by one with t
-0000be50: 6865 2067 6976 656e 2076 616c 7565 2061  he given value a
-0000be60: 7420 7468 6520 6769 7665 6e20 6c6f 6361  t the given loca
-0000be70: 7469 6f6e 2e0a 2020 2020 2020 2020 4966  tion..        If
-0000be80: 2074 6865 2067 6976 656e 2076 616c 7565   the given value
-0000be90: 2069 7320 616c 736f 2061 2064 6174 6173   is also a datas
-0000bea0: 6574 2c20 7365 6c65 6374 2063 6f72 7265  et, select corre
-0000beb0: 7370 6f6e 6469 6e67 2076 6172 6961 626c  sponding variabl
-0000bec0: 6573 0a20 2020 2020 2020 2069 6e20 7468  es.        in th
-0000bed0: 6520 6769 7665 6e20 7661 6c75 6520 616e  e given value an
-0000bee0: 6420 696e 2074 6865 2064 6174 6173 6574  d in the dataset
-0000bef0: 2074 6f20 6265 2063 6861 6e67 6564 2e0a   to be changed..
-0000bf00: 0a20 2020 2020 2020 2049 6620 7661 6c75  .        If valu
-0000bf10: 6520 6973 2061 2060 0a20 2020 2020 2020  e is a `.       
-0000bf20: 2066 726f 6d20 2e64 6174 6161 7272 6179   from .dataarray
-0000bf30: 2069 6d70 6f72 7420 4461 7461 4172 7261   import DataArra
-0000bf40: 7960 2c20 6361 6c6c 2069 7473 2060 7365  y`, call its `se
-0000bf50: 6c65 6374 5f76 6172 7328 2960 206d 6574  lect_vars()` met
-0000bf60: 686f 642c 2072 656e 616d 6520 6974 0a20  hod, rename it. 
-0000bf70: 2020 2020 2020 2074 6f20 606b 6579 6020         to `key` 
-0000bf80: 616e 6420 6d65 7267 6520 7468 6520 636f  and merge the co
-0000bf90: 6e74 656e 7473 206f 6620 7468 6520 7265  ntents of the re
-0000bfa0: 7375 6c74 696e 6720 6461 7461 7365 7420  sulting dataset 
-0000bfb0: 696e 746f 2074 6869 730a 2020 2020 2020  into this.      
-0000bfc0: 2020 6461 7461 7365 742e 0a0a 2020 2020    dataset...    
-0000bfd0: 2020 2020 4966 2076 616c 7565 2069 7320      If value is 
-0000bfe0: 6120 6056 6172 6961 626c 6560 206f 626a  a `Variable` obj
-0000bff0: 6563 7420 286f 7220 7475 706c 6520 6f66  ect (or tuple of
-0000c000: 2066 6f72 6d0a 2020 2020 2020 2020 6060   form.        ``
-0000c010: 2864 696d 732c 2064 6174 615b 2c20 6174  (dims, data[, at
-0000c020: 7472 735d 2960 6029 2c20 6164 6420 6974  trs])``), add it
-0000c030: 2074 6f20 7468 6973 2064 6174 6173 6574   to this dataset
-0000c040: 2061 7320 6120 6e65 770a 2020 2020 2020   as a new.      
-0000c050: 2020 7661 7269 6162 6c65 2e0a 2020 2020    variable..    
-0000c060: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000c070: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-0000c080: 2e64 6174 6161 7272 6179 2069 6d70 6f72  .dataarray impor
-0000c090: 7420 4461 7461 4172 7261 790a 0a20 2020  t DataArray..   
-0000c0a0: 2020 2020 2069 6620 7574 696c 732e 6973       if utils.is
-0000c0b0: 5f64 6963 745f 6c69 6b65 286b 6579 293a  _dict_like(key):
-0000c0c0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-0000c0d0: 6865 636b 2066 6f72 2063 6f6e 7369 7374  heck for consist
-0000c0e0: 656e 6379 2061 6e64 2063 6f6e 7665 7274  ency and convert
-0000c0f0: 2076 616c 7565 2074 6f20 6461 7461 7365   value to datase
-0000c100: 740a 2020 2020 2020 2020 2020 2020 7661  t.            va
-0000c110: 6c75 6520 3d20 7365 6c66 2e5f 7365 7469  lue = self._seti
-0000c120: 7465 6d5f 6368 6563 6b28 6b65 792c 2076  tem_check(key, v
-0000c130: 616c 7565 290a 2020 2020 2020 2020 2020  alue).          
-0000c140: 2020 2320 6c6f 6f70 206f 7665 7220 6461    # loop over da
-0000c150: 7461 7365 7420 7661 7269 6162 6c65 7320  taset variables 
-0000c160: 616e 6420 7365 7420 6e65 7720 7661 6c75  and set new valu
-0000c170: 6573 0a20 2020 2020 2020 2020 2020 2070  es.            p
-0000c180: 726f 6365 7373 6564 203d 205b 5d0a 2020  rocessed = [].  
-0000c190: 2020 2020 2020 2020 2020 666f 7220 6e61            for na
-0000c1a0: 6d65 2c20 7661 7220 696e 2073 656c 662e  me, var in self.
-0000c1b0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0000c1c0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0000c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1e0: 2020 7661 725b 6b65 795d 203d 2076 616c    var[key] = val
-0000c1f0: 7565 5b6e 616d 655d 0a20 2020 2020 2020  ue[name].       
-0000c200: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-0000c210: 6365 7373 6564 2e61 7070 656e 6428 6e61  cessed.append(na
-0000c220: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0000c230: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-0000c240: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-0000c250: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000c260: 6620 7072 6f63 6573 7365 643a 0a20 2020  f processed:.   
-0000c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c280: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
-0000c290: 6d65 4572 726f 7228 0a20 2020 2020 2020  meError(.       
-0000c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2b0: 2020 2020 2022 416e 2065 7272 6f72 206f       "An error o
-0000c2c0: 6363 7572 7265 6420 7768 696c 6520 7365  ccurred while se
-0000c2d0: 7474 696e 6720 7661 6c75 6573 206f 6620  tting values of 
-0000c2e0: 7468 6522 0a20 2020 2020 2020 2020 2020  the".           
-0000c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c300: 2066 2220 7661 7269 6162 6c65 2027 7b6e   f" variable '{n
-0000c310: 616d 657d 272e 2054 6865 2066 6f6c 6c6f  ame}'. The follo
-0000c320: 7769 6e67 2076 6172 6961 626c 6573 2068  wing variables h
-0000c330: 6176 6522 0a20 2020 2020 2020 2020 2020  ave".           
-0000c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c350: 2066 2220 6265 656e 2073 7563 6365 7373   f" been success
-0000c360: 6675 6c6c 7920 7570 6461 7465 643a 5c6e  fully updated:\n
-0000c370: 7b70 726f 6365 7373 6564 7d22 0a20 2020  {processed}".   
-0000c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c390: 2020 2020 2029 2066 726f 6d20 650a 2020       ) from e.  
+000053f0: 7428 7661 6c75 6529 0a0a 2020 2020 6465  t(value)..    de
+00005400: 6620 7265 7365 745f 656e 636f 6469 6e67  f reset_encoding
+00005410: 2873 656c 663a 2054 5f44 6174 6173 6574  (self: T_Dataset
+00005420: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+00005430: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00005440: 6e20 6120 6e65 7720 4461 7461 7365 7420  n a new Dataset 
+00005450: 7769 7468 6f75 7420 656e 636f 6469 6e67  without encoding
+00005460: 206f 6e20 7468 6520 6461 7461 7365 7420   on the dataset 
+00005470: 6f72 2061 6e79 206f 6620 6974 730a 2020  or any of its.  
+00005480: 2020 2020 2020 7661 7269 6162 6c65 732f        variables/
+00005490: 636f 6f72 6473 2e22 2222 0a20 2020 2020  coords.""".     
+000054a0: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
+000054b0: 6b3a 2076 2e72 6573 6574 5f65 6e63 6f64  k: v.reset_encod
+000054c0: 696e 6728 2920 666f 7220 6b2c 2076 2069  ing() for k, v i
+000054d0: 6e20 7365 6c66 2e76 6172 6961 626c 6573  n self.variables
+000054e0: 2e69 7465 6d73 2829 7d0a 2020 2020 2020  .items()}.      
+000054f0: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+00005500: 6570 6c61 6365 2876 6172 6961 626c 6573  eplace(variables
+00005510: 3d76 6172 6961 626c 6573 2c20 656e 636f  =variables, enco
+00005520: 6469 6e67 3d7b 7d29 0a0a 2020 2020 4070  ding={})..    @p
+00005530: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+00005540: 6469 6d73 2873 656c 6629 202d 3e20 4672  dims(self) -> Fr
+00005550: 6f7a 656e 5b48 6173 6861 626c 652c 2069  ozen[Hashable, i
+00005560: 6e74 5d3a 0a20 2020 2020 2020 2022 2222  nt]:.        """
+00005570: 4d61 7070 696e 6720 6672 6f6d 2064 696d  Mapping from dim
+00005580: 656e 7369 6f6e 206e 616d 6573 2074 6f20  ension names to 
+00005590: 6c65 6e67 7468 732e 0a0a 2020 2020 2020  lengths...      
+000055a0: 2020 4361 6e6e 6f74 2062 6520 6d6f 6469    Cannot be modi
+000055b0: 6669 6564 2064 6972 6563 746c 792c 2062  fied directly, b
+000055c0: 7574 2069 7320 7570 6461 7465 6420 7768  ut is updated wh
+000055d0: 656e 2061 6464 696e 6720 6e65 7720 7661  en adding new va
+000055e0: 7269 6162 6c65 732e 0a0a 2020 2020 2020  riables...      
+000055f0: 2020 4e6f 7465 2074 6861 7420 7479 7065    Note that type
+00005600: 206f 6620 7468 6973 206f 626a 6563 7420   of this object 
+00005610: 6469 6666 6572 7320 6672 6f6d 2060 4461  differs from `Da
+00005620: 7461 4172 7261 792e 6469 6d73 602e 0a20  taArray.dims`.. 
+00005630: 2020 2020 2020 2053 6565 2060 4461 7461         See `Data
+00005640: 7365 742e 7369 7a65 7360 2061 6e64 2060  set.sizes` and `
+00005650: 4461 7461 4172 7261 792e 7369 7a65 7360  DataArray.sizes`
+00005660: 2066 6f72 2063 6f6e 7369 7374 656e 746c   for consistentl
+00005670: 7920 6e61 6d65 640a 2020 2020 2020 2020  y named.        
+00005680: 7072 6f70 6572 7469 6573 2e0a 0a20 2020  properties...   
+00005690: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+000056a0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+000056b0: 2020 2020 2020 2044 6174 6173 6574 2e73         Dataset.s
+000056c0: 697a 6573 0a20 2020 2020 2020 2044 6174  izes.        Dat
+000056d0: 6141 7272 6179 2e64 696d 730a 2020 2020  aArray.dims.    
+000056e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000056f0: 7265 7475 726e 2046 726f 7a65 6e28 7365  return Frozen(se
+00005700: 6c66 2e5f 6469 6d73 290a 0a20 2020 2040  lf._dims)..    @
+00005710: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00005720: 2073 697a 6573 2873 656c 6629 202d 3e20   sizes(self) -> 
+00005730: 4672 6f7a 656e 5b48 6173 6861 626c 652c  Frozen[Hashable,
+00005740: 2069 6e74 5d3a 0a20 2020 2020 2020 2022   int]:.        "
+00005750: 2222 4d61 7070 696e 6720 6672 6f6d 2064  ""Mapping from d
+00005760: 696d 656e 7369 6f6e 206e 616d 6573 2074  imension names t
+00005770: 6f20 6c65 6e67 7468 732e 0a0a 2020 2020  o lengths...    
+00005780: 2020 2020 4361 6e6e 6f74 2062 6520 6d6f      Cannot be mo
+00005790: 6469 6669 6564 2064 6972 6563 746c 792c  dified directly,
+000057a0: 2062 7574 2069 7320 7570 6461 7465 6420   but is updated 
+000057b0: 7768 656e 2061 6464 696e 6720 6e65 7720  when adding new 
+000057c0: 7661 7269 6162 6c65 732e 0a0a 2020 2020  variables...    
+000057d0: 2020 2020 5468 6973 2069 7320 616e 2061      This is an a
+000057e0: 6c69 6173 2066 6f72 2060 4461 7461 7365  lias for `Datase
+000057f0: 742e 6469 6d73 6020 7072 6f76 6964 6564  t.dims` provided
+00005800: 2066 6f72 2074 6865 2062 656e 6566 6974   for the benefit
+00005810: 206f 660a 2020 2020 2020 2020 636f 6e73   of.        cons
+00005820: 6973 7465 6e63 7920 7769 7468 2060 4461  istency with `Da
+00005830: 7461 4172 7261 792e 7369 7a65 7360 2e0a  taArray.sizes`..
+00005840: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+00005850: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+00005860: 2d2d 0a20 2020 2020 2020 2044 6174 6141  --.        DataA
+00005870: 7272 6179 2e73 697a 6573 0a20 2020 2020  rray.sizes.     
+00005880: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00005890: 6574 7572 6e20 7365 6c66 2e64 696d 730a  eturn self.dims.
+000058a0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+000058b0: 2020 2064 6566 2064 7479 7065 7328 7365     def dtypes(se
+000058c0: 6c66 2920 2d3e 2046 726f 7a65 6e5b 4861  lf) -> Frozen[Ha
+000058d0: 7368 6162 6c65 2c20 6e70 2e64 7479 7065  shable, np.dtype
+000058e0: 5d3a 0a20 2020 2020 2020 2022 2222 4d61  ]:.        """Ma
+000058f0: 7070 696e 6720 6672 6f6d 2064 6174 6120  pping from data 
+00005900: 7661 7269 6162 6c65 206e 616d 6573 2074  variable names t
+00005910: 6f20 6474 7970 6573 2e0a 0a20 2020 2020  o dtypes...     
+00005920: 2020 2043 616e 6e6f 7420 6265 206d 6f64     Cannot be mod
+00005930: 6966 6965 6420 6469 7265 6374 6c79 2c20  ified directly, 
+00005940: 6275 7420 6973 2075 7064 6174 6564 2077  but is updated w
+00005950: 6865 6e20 6164 6469 6e67 206e 6577 2076  hen adding new v
+00005960: 6172 6961 626c 6573 2e0a 0a20 2020 2020  ariables...     
+00005970: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+00005980: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00005990: 2020 2020 2044 6174 6141 7272 6179 2e64       DataArray.d
+000059a0: 7479 7065 0a20 2020 2020 2020 2022 2222  type.        """
+000059b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000059c0: 4672 6f7a 656e 280a 2020 2020 2020 2020  Frozen(.        
+000059d0: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
+000059e0: 2020 2020 2020 6e3a 2076 2e64 7479 7065        n: v.dtype
+000059f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005a00: 2066 6f72 206e 2c20 7620 696e 2073 656c   for n, v in sel
+00005a10: 662e 5f76 6172 6961 626c 6573 2e69 7465  f._variables.ite
+00005a20: 6d73 2829 0a20 2020 2020 2020 2020 2020  ms().           
+00005a30: 2020 2020 2069 6620 6e20 6e6f 7420 696e       if n not in
+00005a40: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
+00005a50: 6573 0a20 2020 2020 2020 2020 2020 207d  es.            }
+00005a60: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00005a70: 6465 6620 6c6f 6164 2873 656c 663a 2054  def load(self: T
+00005a80: 5f44 6174 6173 6574 2c20 2a2a 6b77 6172  _Dataset, **kwar
+00005a90: 6773 2920 2d3e 2054 5f44 6174 6173 6574  gs) -> T_Dataset
+00005aa0: 3a0a 2020 2020 2020 2020 2222 224d 616e  :.        """Man
+00005ab0: 7561 6c6c 7920 7472 6967 6765 7220 6c6f  ually trigger lo
+00005ac0: 6164 696e 6720 616e 642f 6f72 2063 6f6d  ading and/or com
+00005ad0: 7075 7461 7469 6f6e 206f 6620 7468 6973  putation of this
+00005ae0: 2064 6174 6173 6574 2773 2064 6174 610a   dataset's data.
+00005af0: 2020 2020 2020 2020 6672 6f6d 2064 6973          from dis
+00005b00: 6b20 6f72 2061 2072 656d 6f74 6520 736f  k or a remote so
+00005b10: 7572 6365 2069 6e74 6f20 6d65 6d6f 7279  urce into memory
+00005b20: 2061 6e64 2072 6574 7572 6e20 7468 6973   and return this
+00005b30: 2064 6174 6173 6574 2e0a 2020 2020 2020   dataset..      
+00005b40: 2020 556e 6c69 6b65 2063 6f6d 7075 7465    Unlike compute
+00005b50: 2c20 7468 6520 6f72 6967 696e 616c 2064  , the original d
+00005b60: 6174 6173 6574 2069 7320 6d6f 6469 6669  ataset is modifi
+00005b70: 6564 2061 6e64 2072 6574 7572 6e65 642e  ed and returned.
+00005b80: 0a0a 2020 2020 2020 2020 4e6f 726d 616c  ..        Normal
+00005b90: 6c79 2c20 6974 2073 686f 756c 6420 6e6f  ly, it should no
+00005ba0: 7420 6265 206e 6563 6573 7361 7279 2074  t be necessary t
+00005bb0: 6f20 6361 6c6c 2074 6869 7320 6d65 7468  o call this meth
+00005bc0: 6f64 2069 6e20 7573 6572 2063 6f64 652c  od in user code,
+00005bd0: 0a20 2020 2020 2020 2062 6563 6175 7365  .        because
+00005be0: 2061 6c6c 2078 6172 7261 7920 6675 6e63   all xarray func
+00005bf0: 7469 6f6e 7320 7368 6f75 6c64 2065 6974  tions should eit
+00005c00: 6865 7220 776f 726b 206f 6e20 6465 6665  her work on defe
+00005c10: 7272 6564 2064 6174 6120 6f72 0a20 2020  rred data or.   
+00005c20: 2020 2020 206c 6f61 6420 6461 7461 2061       load data a
+00005c30: 7574 6f6d 6174 6963 616c 6c79 2e20 486f  utomatically. Ho
+00005c40: 7765 7665 722c 2074 6869 7320 6d65 7468  wever, this meth
+00005c50: 6f64 2063 616e 2062 6520 6e65 6365 7373  od can be necess
+00005c60: 6172 7920 7768 656e 0a20 2020 2020 2020  ary when.       
+00005c70: 2077 6f72 6b69 6e67 2077 6974 6820 6d61   working with ma
+00005c80: 6e79 2066 696c 6520 6f62 6a65 6374 7320  ny file objects 
+00005c90: 6f6e 2064 6973 6b2e 0a0a 2020 2020 2020  on disk...      
+00005ca0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00005cb0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00005cc0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+00005cd0: 203a 2064 6963 740a 2020 2020 2020 2020   : dict.        
+00005ce0: 2020 2020 4164 6469 7469 6f6e 616c 206b      Additional k
+00005cf0: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+00005d00: 2070 6173 7365 6420 6f6e 2074 6f20 6060   passed on to ``
+00005d10: 6461 736b 2e63 6f6d 7075 7465 6060 2e0a  dask.compute``..
+00005d20: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+00005d30: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+00005d40: 2d2d 0a20 2020 2020 2020 2064 6173 6b2e  --.        dask.
+00005d50: 636f 6d70 7574 650a 2020 2020 2020 2020  compute.        
+00005d60: 2222 220a 2020 2020 2020 2020 2320 6163  """.        # ac
+00005d70: 6365 7373 202e 6461 7461 2074 6f20 636f  cess .data to co
+00005d80: 6572 6365 2065 7665 7279 7468 696e 6720  erce everything 
+00005d90: 746f 206e 756d 7079 206f 7220 6461 736b  to numpy or dask
+00005da0: 2061 7272 6179 730a 2020 2020 2020 2020   arrays.        
+00005db0: 6c61 7a79 5f64 6174 6120 3d20 7b0a 2020  lazy_data = {.  
+00005dc0: 2020 2020 2020 2020 2020 6b3a 2076 2e5f            k: v._
+00005dd0: 6461 7461 2066 6f72 206b 2c20 7620 696e  data for k, v in
+00005de0: 2073 656c 662e 7661 7269 6162 6c65 732e   self.variables.
+00005df0: 6974 656d 7328 2920 6966 2069 735f 6475  items() if is_du
+00005e00: 636b 5f64 6173 6b5f 6172 7261 7928 762e  ck_dask_array(v.
+00005e10: 5f64 6174 6129 0a20 2020 2020 2020 207d  _data).        }
+00005e20: 0a20 2020 2020 2020 2069 6620 6c61 7a79  .        if lazy
+00005e30: 5f64 6174 613a 0a20 2020 2020 2020 2020  _data:.         
+00005e40: 2020 2069 6d70 6f72 7420 6461 736b 2e61     import dask.a
+00005e50: 7272 6179 2061 7320 6461 0a0a 2020 2020  rray as da..    
+00005e60: 2020 2020 2020 2020 2320 6576 616c 7561          # evalua
+00005e70: 7465 2061 6c6c 2074 6865 2064 6173 6b20  te all the dask 
+00005e80: 6172 7261 7973 2073 696d 756c 7461 6e65  arrays simultane
+00005e90: 6f75 736c 790a 2020 2020 2020 2020 2020  ously.          
+00005ea0: 2020 6576 616c 7561 7465 645f 6461 7461    evaluated_data
+00005eb0: 203d 2064 612e 636f 6d70 7574 6528 2a6c   = da.compute(*l
+00005ec0: 617a 795f 6461 7461 2e76 616c 7565 7328  azy_data.values(
+00005ed0: 292c 202a 2a6b 7761 7267 7329 0a0a 2020  ), **kwargs)..  
+00005ee0: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
+00005ef0: 2064 6174 6120 696e 207a 6970 286c 617a   data in zip(laz
+00005f00: 795f 6461 7461 2c20 6576 616c 7561 7465  y_data, evaluate
+00005f10: 645f 6461 7461 293a 0a20 2020 2020 2020  d_data):.       
+00005f20: 2020 2020 2020 2020 2073 656c 662e 7661           self.va
+00005f30: 7269 6162 6c65 735b 6b5d 2e64 6174 6120  riables[k].data 
+00005f40: 3d20 6461 7461 0a0a 2020 2020 2020 2020  = data..        
+00005f50: 2320 6c6f 6164 2065 7665 7279 7468 696e  # load everythin
+00005f60: 6720 656c 7365 2073 6571 7565 6e74 6961  g else sequentia
+00005f70: 6c6c 790a 2020 2020 2020 2020 666f 7220  lly.        for 
+00005f80: 6b2c 2076 2069 6e20 7365 6c66 2e76 6172  k, v in self.var
+00005f90: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
+00005fa0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00005fb0: 206e 6f74 2069 6e20 6c61 7a79 5f64 6174   not in lazy_dat
+00005fc0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
+00005fd0: 2020 2076 2e6c 6f61 6428 290a 0a20 2020     v.load()..   
+00005fe0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00005ff0: 0a0a 2020 2020 6465 6620 5f5f 6461 736b  ..    def __dask
+00006000: 5f74 6f6b 656e 697a 655f 5f28 7365 6c66  _tokenize__(self
+00006010: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
+00006020: 6461 736b 2e62 6173 6520 696d 706f 7274  dask.base import
+00006030: 206e 6f72 6d61 6c69 7a65 5f74 6f6b 656e   normalize_token
+00006040: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00006050: 206e 6f72 6d61 6c69 7a65 5f74 6f6b 656e   normalize_token
+00006060: 280a 2020 2020 2020 2020 2020 2020 2874  (.            (t
+00006070: 7970 6528 7365 6c66 292c 2073 656c 662e  ype(self), self.
+00006080: 5f76 6172 6961 626c 6573 2c20 7365 6c66  _variables, self
+00006090: 2e5f 636f 6f72 645f 6e61 6d65 732c 2073  ._coord_names, s
+000060a0: 656c 662e 5f61 7474 7273 290a 2020 2020  elf._attrs).    
+000060b0: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
+000060c0: 5f64 6173 6b5f 6772 6170 685f 5f28 7365  _dask_graph__(se
+000060d0: 6c66 293a 0a20 2020 2020 2020 2067 7261  lf):.        gra
+000060e0: 7068 7320 3d20 7b6b 3a20 762e 5f5f 6461  phs = {k: v.__da
+000060f0: 736b 5f67 7261 7068 5f5f 2829 2066 6f72  sk_graph__() for
+00006100: 206b 2c20 7620 696e 2073 656c 662e 7661   k, v in self.va
+00006110: 7269 6162 6c65 732e 6974 656d 7328 297d  riables.items()}
+00006120: 0a20 2020 2020 2020 2067 7261 7068 7320  .        graphs 
+00006130: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
+00006140: 2069 6e20 6772 6170 6873 2e69 7465 6d73   in graphs.items
+00006150: 2829 2069 6620 7620 6973 206e 6f74 204e  () if v is not N
+00006160: 6f6e 657d 0a20 2020 2020 2020 2069 6620  one}.        if 
+00006170: 6e6f 7420 6772 6170 6873 3a0a 2020 2020  not graphs:.    
+00006180: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00006190: 6f6e 650a 2020 2020 2020 2020 656c 7365  one.        else
+000061a0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+000061b0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+000061c0: 2020 2066 726f 6d20 6461 736b 2e68 6967     from dask.hig
+000061d0: 686c 6576 656c 6772 6170 6820 696d 706f  hlevelgraph impo
+000061e0: 7274 2048 6967 684c 6576 656c 4772 6170  rt HighLevelGrap
+000061f0: 680a 0a20 2020 2020 2020 2020 2020 2020  h..             
+00006200: 2020 2072 6574 7572 6e20 4869 6768 4c65     return HighLe
+00006210: 7665 6c47 7261 7068 2e6d 6572 6765 282a  velGraph.merge(*
+00006220: 6772 6170 6873 2e76 616c 7565 7328 2929  graphs.values())
+00006230: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00006240: 6570 7420 496d 706f 7274 4572 726f 723a  ept ImportError:
+00006250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006260: 2066 726f 6d20 6461 736b 2069 6d70 6f72   from dask impor
+00006270: 7420 7368 6172 6564 6963 740a 0a20 2020  t sharedict..   
+00006280: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00006290: 7572 6e20 7368 6172 6564 6963 742e 6d65  urn sharedict.me
+000062a0: 7267 6528 2a67 7261 7068 732e 7661 6c75  rge(*graphs.valu
+000062b0: 6573 2829 290a 0a20 2020 2064 6566 205f  es())..    def _
+000062c0: 5f64 6173 6b5f 6b65 7973 5f5f 2873 656c  _dask_keys__(sel
+000062d0: 6629 3a0a 2020 2020 2020 2020 696d 706f  f):.        impo
+000062e0: 7274 2064 6173 6b0a 0a20 2020 2020 2020  rt dask..       
+000062f0: 2072 6574 7572 6e20 5b0a 2020 2020 2020   return [.      
+00006300: 2020 2020 2020 762e 5f5f 6461 736b 5f6b        v.__dask_k
+00006310: 6579 735f 5f28 290a 2020 2020 2020 2020  eys__().        
+00006320: 2020 2020 666f 7220 7620 696e 2073 656c      for v in sel
+00006330: 662e 7661 7269 6162 6c65 732e 7661 6c75  f.variables.valu
+00006340: 6573 2829 0a20 2020 2020 2020 2020 2020  es().           
+00006350: 2069 6620 6461 736b 2e69 735f 6461 736b   if dask.is_dask
+00006360: 5f63 6f6c 6c65 6374 696f 6e28 7629 0a20  _collection(v). 
+00006370: 2020 2020 2020 205d 0a0a 2020 2020 6465         ]..    de
+00006380: 6620 5f5f 6461 736b 5f6c 6179 6572 735f  f __dask_layers_
+00006390: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+000063a0: 2069 6d70 6f72 7420 6461 736b 0a0a 2020   import dask..  
+000063b0: 2020 2020 2020 7265 7475 726e 2073 756d        return sum
+000063c0: 280a 2020 2020 2020 2020 2020 2020 280a  (.            (.
+000063d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063e0: 762e 5f5f 6461 736b 5f6c 6179 6572 735f  v.__dask_layers_
+000063f0: 5f28 290a 2020 2020 2020 2020 2020 2020  _().            
+00006400: 2020 2020 666f 7220 7620 696e 2073 656c      for v in sel
+00006410: 662e 7661 7269 6162 6c65 732e 7661 6c75  f.variables.valu
+00006420: 6573 2829 0a20 2020 2020 2020 2020 2020  es().           
+00006430: 2020 2020 2069 6620 6461 736b 2e69 735f       if dask.is_
+00006440: 6461 736b 5f63 6f6c 6c65 6374 696f 6e28  dask_collection(
+00006450: 7629 0a20 2020 2020 2020 2020 2020 2029  v).            )
+00006460: 2c0a 2020 2020 2020 2020 2020 2020 2829  ,.            ()
+00006470: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00006480: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+00006490: 6566 205f 5f64 6173 6b5f 6f70 7469 6d69  ef __dask_optimi
+000064a0: 7a65 5f5f 2873 656c 6629 3a0a 2020 2020  ze__(self):.    
+000064b0: 2020 2020 696d 706f 7274 2064 6173 6b2e      import dask.
+000064c0: 6172 7261 7920 6173 2064 610a 0a20 2020  array as da..   
+000064d0: 2020 2020 2072 6574 7572 6e20 6461 2e41       return da.A
+000064e0: 7272 6179 2e5f 5f64 6173 6b5f 6f70 7469  rray.__dask_opti
+000064f0: 6d69 7a65 5f5f 0a0a 2020 2020 4070 726f  mize__..    @pro
+00006500: 7065 7274 790a 2020 2020 6465 6620 5f5f  perty.    def __
+00006510: 6461 736b 5f73 6368 6564 756c 6572 5f5f  dask_scheduler__
+00006520: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00006530: 696d 706f 7274 2064 6173 6b2e 6172 7261  import dask.arra
+00006540: 7920 6173 2064 610a 0a20 2020 2020 2020  y as da..       
+00006550: 2072 6574 7572 6e20 6461 2e41 7272 6179   return da.Array
+00006560: 2e5f 5f64 6173 6b5f 7363 6865 6475 6c65  .__dask_schedule
+00006570: 725f 5f0a 0a20 2020 2064 6566 205f 5f64  r__..    def __d
+00006580: 6173 6b5f 706f 7374 636f 6d70 7574 655f  ask_postcompute_
+00006590: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+000065a0: 2072 6574 7572 6e20 7365 6c66 2e5f 6461   return self._da
+000065b0: 736b 5f70 6f73 7463 6f6d 7075 7465 2c20  sk_postcompute, 
+000065c0: 2829 0a0a 2020 2020 6465 6620 5f5f 6461  ()..    def __da
+000065d0: 736b 5f70 6f73 7470 6572 7369 7374 5f5f  sk_postpersist__
+000065e0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000065f0: 7265 7475 726e 2073 656c 662e 5f64 6173  return self._das
+00006600: 6b5f 706f 7374 7065 7273 6973 742c 2028  k_postpersist, (
+00006610: 290a 0a20 2020 2064 6566 205f 6461 736b  )..    def _dask
+00006620: 5f70 6f73 7463 6f6d 7075 7465 2873 656c  _postcompute(sel
+00006630: 663a 2054 5f44 6174 6173 6574 2c20 7265  f: T_Dataset, re
+00006640: 7375 6c74 733a 2049 7465 7261 626c 655b  sults: Iterable[
+00006650: 5661 7269 6162 6c65 5d29 202d 3e20 545f  Variable]) -> T_
+00006660: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+00006670: 2069 6d70 6f72 7420 6461 736b 0a0a 2020   import dask..  
+00006680: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
+00006690: 3d20 7b7d 0a20 2020 2020 2020 2072 6573  = {}.        res
+000066a0: 756c 7473 5f69 7465 7220 3d20 6974 6572  ults_iter = iter
+000066b0: 2872 6573 756c 7473 290a 0a20 2020 2020  (results)..     
+000066c0: 2020 2066 6f72 206b 2c20 7620 696e 2073     for k, v in s
+000066d0: 656c 662e 5f76 6172 6961 626c 6573 2e69  elf._variables.i
+000066e0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+000066f0: 2020 2020 6966 2064 6173 6b2e 6973 5f64      if dask.is_d
+00006700: 6173 6b5f 636f 6c6c 6563 7469 6f6e 2876  ask_collection(v
+00006710: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00006720: 2020 2072 6562 7569 6c64 2c20 6172 6773     rebuild, args
+00006730: 203d 2076 2e5f 5f64 6173 6b5f 706f 7374   = v.__dask_post
+00006740: 636f 6d70 7574 655f 5f28 290a 2020 2020  compute__().    
+00006750: 2020 2020 2020 2020 2020 2020 7620 3d20              v = 
+00006760: 7265 6275 696c 6428 6e65 7874 2872 6573  rebuild(next(res
+00006770: 756c 7473 5f69 7465 7229 2c20 2a61 7267  ults_iter), *arg
+00006780: 7329 0a20 2020 2020 2020 2020 2020 2076  s).            v
+00006790: 6172 6961 626c 6573 5b6b 5d20 3d20 760a  ariables[k] = v.
+000067a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000067b0: 7479 7065 2873 656c 6629 2e5f 636f 6e73  type(self)._cons
+000067c0: 7472 7563 745f 6469 7265 6374 280a 2020  truct_direct(.  
+000067d0: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+000067e0: 6c65 732c 0a20 2020 2020 2020 2020 2020  les,.           
+000067f0: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
+00006800: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+00006810: 7365 6c66 2e5f 6469 6d73 2c0a 2020 2020  self._dims,.    
+00006820: 2020 2020 2020 2020 7365 6c66 2e5f 6174          self._at
+00006830: 7472 732c 0a20 2020 2020 2020 2020 2020  trs,.           
+00006840: 2073 656c 662e 5f69 6e64 6578 6573 2c0a   self._indexes,.
+00006850: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006860: 2e5f 656e 636f 6469 6e67 2c0a 2020 2020  ._encoding,.    
+00006870: 2020 2020 2020 2020 7365 6c66 2e5f 636c          self._cl
+00006880: 6f73 652c 0a20 2020 2020 2020 2029 0a0a  ose,.        )..
+00006890: 2020 2020 6465 6620 5f64 6173 6b5f 706f      def _dask_po
+000068a0: 7374 7065 7273 6973 7428 0a20 2020 2020  stpersist(.     
+000068b0: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+000068c0: 6574 2c20 6473 6b3a 204d 6170 7069 6e67  et, dsk: Mapping
+000068d0: 2c20 2a2c 2072 656e 616d 653a 204d 6170  , *, rename: Map
+000068e0: 7069 6e67 5b73 7472 2c20 7374 725d 207c  ping[str, str] |
+000068f0: 204e 6f6e 6520 3d20 4e6f 6e65 0a20 2020   None = None.   
+00006900: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
+00006910: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
+00006920: 736b 2069 6d70 6f72 7420 6973 5f64 6173  sk import is_das
+00006930: 6b5f 636f 6c6c 6563 7469 6f6e 0a20 2020  k_collection.   
+00006940: 2020 2020 2066 726f 6d20 6461 736b 2e68       from dask.h
+00006950: 6967 686c 6576 656c 6772 6170 6820 696d  ighlevelgraph im
+00006960: 706f 7274 2048 6967 684c 6576 656c 4772  port HighLevelGr
+00006970: 6170 680a 2020 2020 2020 2020 6672 6f6d  aph.        from
+00006980: 2064 6173 6b2e 6f70 7469 6d69 7a61 7469   dask.optimizati
+00006990: 6f6e 2069 6d70 6f72 7420 6375 6c6c 0a0a  on import cull..
+000069a0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+000069b0: 7320 3d20 7b7d 0a0a 2020 2020 2020 2020  s = {}..        
+000069c0: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
+000069d0: 2e5f 7661 7269 6162 6c65 732e 6974 656d  ._variables.item
+000069e0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+000069f0: 2069 6620 6e6f 7420 6973 5f64 6173 6b5f   if not is_dask_
+00006a00: 636f 6c6c 6563 7469 6f6e 2876 293a 0a20  collection(v):. 
+00006a10: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00006a20: 6172 6961 626c 6573 5b6b 5d20 3d20 760a  ariables[k] = v.
+00006a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a40: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
+00006a50: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00006a60: 6e63 6528 6473 6b2c 2048 6967 684c 6576  nce(dsk, HighLev
+00006a70: 656c 4772 6170 6829 3a0a 2020 2020 2020  elGraph):.      
+00006a80: 2020 2020 2020 2020 2020 2320 6461 736b            # dask
+00006a90: 203e 3d20 3230 3231 2e33 0a20 2020 2020   >= 2021.3.     
+00006aa0: 2020 2020 2020 2020 2020 2023 205f 5f64             # __d
+00006ab0: 6173 6b5f 706f 7374 7065 7273 6973 745f  ask_postpersist_
+00006ac0: 5f28 2920 7761 7320 6361 6c6c 6564 2062  _() was called b
+00006ad0: 7920 6461 736b 2e68 6967 686c 6576 656c  y dask.highlevel
+00006ae0: 6772 6170 682e 0a20 2020 2020 2020 2020  graph..         
+00006af0: 2020 2020 2020 2023 2044 6f6e 2774 2075         # Don't u
+00006b00: 7365 2064 736b 2e63 756c 6c28 292c 2061  se dsk.cull(), a
+00006b10: 7320 7765 206e 6565 6420 746f 2070 7265  s we need to pre
+00006b20: 7665 6e74 2070 6172 7469 616c 206c 6179  vent partial lay
+00006b30: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
+00006b40: 2020 2020 2023 2068 7474 7073 3a2f 2f67       # https://g
+00006b50: 6974 6875 622e 636f 6d2f 6461 736b 2f64  ithub.com/dask/d
+00006b60: 6173 6b2f 6973 7375 6573 2f37 3133 370a  ask/issues/7137.
+00006b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b80: 6c61 7965 7273 203d 2076 2e5f 5f64 6173  layers = v.__das
+00006b90: 6b5f 6c61 7965 7273 5f5f 2829 0a20 2020  k_layers__().   
+00006ba0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00006bb0: 7265 6e61 6d65 3a0a 2020 2020 2020 2020  rename:.        
+00006bc0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00006bd0: 7273 203d 205b 7265 6e61 6d65 2e67 6574  rs = [rename.get
+00006be0: 286b 2c20 6b29 2066 6f72 206b 2069 6e20  (k, k) for k in 
+00006bf0: 6c61 7965 7273 5d0a 2020 2020 2020 2020  layers].        
+00006c00: 2020 2020 2020 2020 6473 6b32 203d 2064          dsk2 = d
+00006c10: 736b 2e63 756c 6c5f 6c61 7965 7273 286c  sk.cull_layers(l
+00006c20: 6179 6572 7329 0a20 2020 2020 2020 2020  ayers).         
+00006c30: 2020 2065 6c69 6620 7265 6e61 6d65 3a20     elif rename: 
+00006c40: 2023 2070 7261 676d 613a 206e 6f63 6f76   # pragma: nocov
+00006c50: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+00006c60: 2020 2023 2041 7420 7468 6520 6d6f 6d65     # At the mome
+00006c70: 6e74 206f 6620 7772 6974 696e 672c 2074  nt of writing, t
+00006c80: 6869 7320 6973 206f 6e6c 7920 666f 7220  his is only for 
+00006c90: 666f 7277 6172 6420 636f 6d70 6174 6962  forward compatib
+00006ca0: 696c 6974 792e 0a20 2020 2020 2020 2020  ility..         
+00006cb0: 2020 2020 2020 2023 2072 6570 6c61 6365         # replace
+00006cc0: 5f6e 616d 655f 696e 5f6b 6579 2072 6571  _name_in_key req
+00006cd0: 7569 7265 7320 6461 736b 203e 3d20 3230  uires dask >= 20
+00006ce0: 3231 2e33 2e0a 2020 2020 2020 2020 2020  21.3..          
+00006cf0: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
+00006d00: 6261 7365 2069 6d70 6f72 7420 666c 6174  base import flat
+00006d10: 7465 6e2c 2072 6570 6c61 6365 5f6e 616d  ten, replace_nam
+00006d20: 655f 696e 5f6b 6579 0a0a 2020 2020 2020  e_in_key..      
+00006d30: 2020 2020 2020 2020 2020 6b65 7973 203d            keys =
+00006d40: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+00006d50: 2020 2020 2020 2072 6570 6c61 6365 5f6e         replace_n
+00006d60: 616d 655f 696e 5f6b 6579 286b 2c20 7265  ame_in_key(k, re
+00006d70: 6e61 6d65 2920 666f 7220 6b20 696e 2066  name) for k in f
+00006d80: 6c61 7474 656e 2876 2e5f 5f64 6173 6b5f  latten(v.__dask_
+00006d90: 6b65 7973 5f5f 2829 290a 2020 2020 2020  keys__()).      
+00006da0: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+00006db0: 2020 2020 2020 2020 2020 2020 6473 6b32              dsk2
+00006dc0: 2c20 5f20 3d20 6375 6c6c 2864 736b 2c20  , _ = cull(dsk, 
+00006dd0: 6b65 7973 290a 2020 2020 2020 2020 2020  keys).          
+00006de0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00006df0: 2020 2020 2020 2020 2320 5f5f 6461 736b          # __dask
+00006e00: 5f70 6f73 7470 6572 7369 7374 5f5f 2829  _postpersist__()
+00006e10: 2077 6173 2063 616c 6c65 6420 6279 2064   was called by d
+00006e20: 6173 6b2e 6f70 7469 6d69 7a65 206f 7220  ask.optimize or 
+00006e30: 6461 736b 2e70 6572 7369 7374 0a20 2020  dask.persist.   
+00006e40: 2020 2020 2020 2020 2020 2020 2064 736b               dsk
+00006e50: 322c 205f 203d 2063 756c 6c28 6473 6b2c  2, _ = cull(dsk,
+00006e60: 2076 2e5f 5f64 6173 6b5f 6b65 7973 5f5f   v.__dask_keys__
+00006e70: 2829 290a 0a20 2020 2020 2020 2020 2020  ())..           
+00006e80: 2072 6562 7569 6c64 2c20 6172 6773 203d   rebuild, args =
+00006e90: 2076 2e5f 5f64 6173 6b5f 706f 7374 7065   v.__dask_postpe
+00006ea0: 7273 6973 745f 5f28 290a 2020 2020 2020  rsist__().      
+00006eb0: 2020 2020 2020 2320 7265 6e61 6d65 2077        # rename w
+00006ec0: 6173 2061 6464 6564 2069 6e20 6461 736b  as added in dask
+00006ed0: 2032 3032 312e 330a 2020 2020 2020 2020   2021.3.        
+00006ee0: 2020 2020 6b77 6172 6773 203d 207b 2272      kwargs = {"r
+00006ef0: 656e 616d 6522 3a20 7265 6e61 6d65 7d20  ename": rename} 
+00006f00: 6966 2072 656e 616d 6520 656c 7365 207b  if rename else {
+00006f10: 7d0a 2020 2020 2020 2020 2020 2020 7661  }.            va
+00006f20: 7269 6162 6c65 735b 6b5d 203d 2072 6562  riables[k] = reb
+00006f30: 7569 6c64 2864 736b 322c 202a 6172 6773  uild(dsk2, *args
+00006f40: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+00006f50: 2020 2020 2072 6574 7572 6e20 7479 7065       return type
+00006f60: 2873 656c 6629 2e5f 636f 6e73 7472 7563  (self)._construc
+00006f70: 745f 6469 7265 6374 280a 2020 2020 2020  t_direct(.      
+00006f80: 2020 2020 2020 7661 7269 6162 6c65 732c        variables,
+00006f90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006fa0: 662e 5f63 6f6f 7264 5f6e 616d 6573 2c0a  f._coord_names,.
+00006fb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006fc0: 2e5f 6469 6d73 2c0a 2020 2020 2020 2020  ._dims,.        
+00006fd0: 2020 2020 7365 6c66 2e5f 6174 7472 732c      self._attrs,
+00006fe0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006ff0: 662e 5f69 6e64 6578 6573 2c0a 2020 2020  f._indexes,.    
+00007000: 2020 2020 2020 2020 7365 6c66 2e5f 656e          self._en
+00007010: 636f 6469 6e67 2c0a 2020 2020 2020 2020  coding,.        
+00007020: 2020 2020 7365 6c66 2e5f 636c 6f73 652c      self._close,
+00007030: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00007040: 6465 6620 636f 6d70 7574 6528 7365 6c66  def compute(self
+00007050: 3a20 545f 4461 7461 7365 742c 202a 2a6b  : T_Dataset, **k
+00007060: 7761 7267 7329 202d 3e20 545f 4461 7461  wargs) -> T_Data
+00007070: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
+00007080: 4d61 6e75 616c 6c79 2074 7269 6767 6572  Manually trigger
+00007090: 206c 6f61 6469 6e67 2061 6e64 2f6f 7220   loading and/or 
+000070a0: 636f 6d70 7574 6174 696f 6e20 6f66 2074  computation of t
+000070b0: 6869 7320 6461 7461 7365 7427 7320 6461  his dataset's da
+000070c0: 7461 0a20 2020 2020 2020 2066 726f 6d20  ta.        from 
+000070d0: 6469 736b 206f 7220 6120 7265 6d6f 7465  disk or a remote
+000070e0: 2073 6f75 7263 6520 696e 746f 206d 656d   source into mem
+000070f0: 6f72 7920 616e 6420 7265 7475 726e 2061  ory and return a
+00007100: 206e 6577 2064 6174 6173 6574 2e0a 2020   new dataset..  
+00007110: 2020 2020 2020 556e 6c69 6b65 206c 6f61        Unlike loa
+00007120: 642c 2074 6865 206f 7269 6769 6e61 6c20  d, the original 
+00007130: 6461 7461 7365 7420 6973 206c 6566 7420  dataset is left 
+00007140: 756e 616c 7465 7265 642e 0a0a 2020 2020  unaltered...    
+00007150: 2020 2020 4e6f 726d 616c 6c79 2c20 6974      Normally, it
+00007160: 2073 686f 756c 6420 6e6f 7420 6265 206e   should not be n
+00007170: 6563 6573 7361 7279 2074 6f20 6361 6c6c  ecessary to call
+00007180: 2074 6869 7320 6d65 7468 6f64 2069 6e20   this method in 
+00007190: 7573 6572 2063 6f64 652c 0a20 2020 2020  user code,.     
+000071a0: 2020 2062 6563 6175 7365 2061 6c6c 2078     because all x
+000071b0: 6172 7261 7920 6675 6e63 7469 6f6e 7320  array functions 
+000071c0: 7368 6f75 6c64 2065 6974 6865 7220 776f  should either wo
+000071d0: 726b 206f 6e20 6465 6665 7272 6564 2064  rk on deferred d
+000071e0: 6174 6120 6f72 0a20 2020 2020 2020 206c  ata or.        l
+000071f0: 6f61 6420 6461 7461 2061 7574 6f6d 6174  oad data automat
+00007200: 6963 616c 6c79 2e20 486f 7765 7665 722c  ically. However,
+00007210: 2074 6869 7320 6d65 7468 6f64 2063 616e   this method can
+00007220: 2062 6520 6e65 6365 7373 6172 7920 7768   be necessary wh
+00007230: 656e 0a20 2020 2020 2020 2077 6f72 6b69  en.        worki
+00007240: 6e67 2077 6974 6820 6d61 6e79 2066 696c  ng with many fil
+00007250: 6520 6f62 6a65 6374 7320 6f6e 2064 6973  e objects on dis
+00007260: 6b2e 0a0a 2020 2020 2020 2020 5061 7261  k...        Para
+00007270: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+00007280: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00007290: 2020 2a2a 6b77 6172 6773 203a 2064 6963    **kwargs : dic
+000072a0: 740a 2020 2020 2020 2020 2020 2020 4164  t.            Ad
+000072b0: 6469 7469 6f6e 616c 206b 6579 776f 7264  ditional keyword
+000072c0: 2061 7267 756d 656e 7473 2070 6173 7365   arguments passe
+000072d0: 6420 6f6e 2074 6f20 6060 6461 736b 2e63  d on to ``dask.c
+000072e0: 6f6d 7075 7465 6060 2e0a 0a20 2020 2020  ompute``...     
+000072f0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+00007300: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00007310: 2020 2020 2064 6173 6b2e 636f 6d70 7574       dask.comput
+00007320: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+00007330: 2020 2020 2020 6e65 7720 3d20 7365 6c66        new = self
+00007340: 2e63 6f70 7928 6465 6570 3d46 616c 7365  .copy(deep=False
+00007350: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00007360: 206e 6577 2e6c 6f61 6428 2a2a 6b77 6172   new.load(**kwar
+00007370: 6773 290a 0a20 2020 2064 6566 205f 7065  gs)..    def _pe
+00007380: 7273 6973 745f 696e 706c 6163 6528 7365  rsist_inplace(se
+00007390: 6c66 3a20 545f 4461 7461 7365 742c 202a  lf: T_Dataset, *
+000073a0: 2a6b 7761 7267 7329 202d 3e20 545f 4461  *kwargs) -> T_Da
+000073b0: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+000073c0: 2222 5065 7273 6973 7420 616c 6c20 4461  ""Persist all Da
+000073d0: 736b 2061 7272 6179 7320 696e 206d 656d  sk arrays in mem
+000073e0: 6f72 7922 2222 0a20 2020 2020 2020 2023  ory""".        #
+000073f0: 2061 6363 6573 7320 2e64 6174 6120 746f   access .data to
+00007400: 2063 6f65 7263 6520 6576 6572 7974 6869   coerce everythi
+00007410: 6e67 2074 6f20 6e75 6d70 7920 6f72 2064  ng to numpy or d
+00007420: 6173 6b20 6172 7261 7973 0a20 2020 2020  ask arrays.     
+00007430: 2020 206c 617a 795f 6461 7461 203d 207b     lazy_data = {
+00007440: 0a20 2020 2020 2020 2020 2020 206b 3a20  .            k: 
+00007450: 762e 5f64 6174 6120 666f 7220 6b2c 2076  v._data for k, v
+00007460: 2069 6e20 7365 6c66 2e76 6172 6961 626c   in self.variabl
+00007470: 6573 2e69 7465 6d73 2829 2069 6620 6973  es.items() if is
+00007480: 5f64 7563 6b5f 6461 736b 5f61 7272 6179  _duck_dask_array
+00007490: 2876 2e5f 6461 7461 290a 2020 2020 2020  (v._data).      
+000074a0: 2020 7d0a 2020 2020 2020 2020 6966 206c    }.        if l
+000074b0: 617a 795f 6461 7461 3a0a 2020 2020 2020  azy_data:.      
+000074c0: 2020 2020 2020 696d 706f 7274 2064 6173        import das
+000074d0: 6b0a 0a20 2020 2020 2020 2020 2020 2023  k..            #
+000074e0: 2065 7661 6c75 6174 6520 616c 6c20 7468   evaluate all th
+000074f0: 6520 6461 736b 2061 7272 6179 7320 7369  e dask arrays si
+00007500: 6d75 6c74 616e 656f 7573 6c79 0a20 2020  multaneously.   
+00007510: 2020 2020 2020 2020 2065 7661 6c75 6174           evaluat
+00007520: 6564 5f64 6174 6120 3d20 6461 736b 2e70  ed_data = dask.p
+00007530: 6572 7369 7374 282a 6c61 7a79 5f64 6174  ersist(*lazy_dat
+00007540: 612e 7661 6c75 6573 2829 2c20 2a2a 6b77  a.values(), **kw
+00007550: 6172 6773 290a 0a20 2020 2020 2020 2020  args)..         
+00007560: 2020 2066 6f72 206b 2c20 6461 7461 2069     for k, data i
+00007570: 6e20 7a69 7028 6c61 7a79 5f64 6174 612c  n zip(lazy_data,
+00007580: 2065 7661 6c75 6174 6564 5f64 6174 6129   evaluated_data)
+00007590: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000075a0: 2020 7365 6c66 2e76 6172 6961 626c 6573    self.variables
+000075b0: 5b6b 5d2e 6461 7461 203d 2064 6174 610a  [k].data = data.
+000075c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000075d0: 7365 6c66 0a0a 2020 2020 6465 6620 7065  self..    def pe
+000075e0: 7273 6973 7428 7365 6c66 3a20 545f 4461  rsist(self: T_Da
+000075f0: 7461 7365 742c 202a 2a6b 7761 7267 7329  taset, **kwargs)
+00007600: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
+00007610: 2020 2020 2020 2022 2222 5472 6967 6765         """Trigge
+00007620: 7220 636f 6d70 7574 6174 696f 6e2c 206b  r computation, k
+00007630: 6565 7069 6e67 2064 6174 6120 6173 2064  eeping data as d
+00007640: 6173 6b20 6172 7261 7973 0a0a 2020 2020  ask arrays..    
+00007650: 2020 2020 5468 6973 206f 7065 7261 7469      This operati
+00007660: 6f6e 2063 616e 2062 6520 7573 6564 2074  on can be used t
+00007670: 6f20 7472 6967 6765 7220 636f 6d70 7574  o trigger comput
+00007680: 6174 696f 6e20 6f6e 2075 6e64 6572 6c79  ation on underly
+00007690: 696e 6720 6461 736b 0a20 2020 2020 2020  ing dask.       
+000076a0: 2061 7272 6179 732c 2073 696d 696c 6172   arrays, similar
+000076b0: 2074 6f20 6060 2e63 6f6d 7075 7465 2829   to ``.compute()
+000076c0: 6060 206f 7220 6060 2e6c 6f61 6428 2960  `` or ``.load()`
+000076d0: 602e 2020 486f 7765 7665 7220 7468 6973  `.  However this
+000076e0: 0a20 2020 2020 2020 206f 7065 7261 7469  .        operati
+000076f0: 6f6e 206b 6565 7073 2074 6865 2064 6174  on keeps the dat
+00007700: 6120 6173 2064 6173 6b20 6172 7261 7973  a as dask arrays
+00007710: 2e20 5468 6973 2069 7320 7061 7274 6963  . This is partic
+00007720: 756c 6172 6c79 2075 7365 6675 6c0a 2020  ularly useful.  
+00007730: 2020 2020 2020 7768 656e 2075 7369 6e67        when using
+00007740: 2074 6865 2064 6173 6b2e 6469 7374 7269   the dask.distri
+00007750: 6275 7465 6420 7363 6865 6475 6c65 7220  buted scheduler 
+00007760: 616e 6420 796f 7520 7761 6e74 2074 6f20  and you want to 
+00007770: 6c6f 6164 2061 206c 6172 6765 0a20 2020  load a large.   
+00007780: 2020 2020 2061 6d6f 756e 7420 6f66 2064       amount of d
+00007790: 6174 6120 696e 746f 2064 6973 7472 6962  ata into distrib
+000077a0: 7574 6564 206d 656d 6f72 792e 0a0a 2020  uted memory...  
+000077b0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+000077c0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000077d0: 2d2d 2d0a 2020 2020 2020 2020 2a2a 6b77  ---.        **kw
+000077e0: 6172 6773 203a 2064 6963 740a 2020 2020  args : dict.    
+000077f0: 2020 2020 2020 2020 4164 6469 7469 6f6e          Addition
+00007800: 616c 206b 6579 776f 7264 2061 7267 756d  al keyword argum
+00007810: 656e 7473 2070 6173 7365 6420 6f6e 2074  ents passed on t
+00007820: 6f20 6060 6461 736b 2e70 6572 7369 7374  o ``dask.persist
+00007830: 6060 2e0a 0a20 2020 2020 2020 2053 6565  ``...        See
+00007840: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+00007850: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
+00007860: 6173 6b2e 7065 7273 6973 740a 2020 2020  ask.persist.    
+00007870: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00007880: 6e65 7720 3d20 7365 6c66 2e63 6f70 7928  new = self.copy(
+00007890: 6465 6570 3d46 616c 7365 290a 2020 2020  deep=False).    
+000078a0: 2020 2020 7265 7475 726e 206e 6577 2e5f      return new._
+000078b0: 7065 7273 6973 745f 696e 706c 6163 6528  persist_inplace(
+000078c0: 2a2a 6b77 6172 6773 290a 0a20 2020 2040  **kwargs)..    @
+000078d0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+000078e0: 6465 6620 5f63 6f6e 7374 7275 6374 5f64  def _construct_d
+000078f0: 6972 6563 7428 0a20 2020 2020 2020 2063  irect(.        c
+00007900: 6c73 3a20 7479 7065 5b54 5f44 6174 6173  ls: type[T_Datas
+00007910: 6574 5d2c 0a20 2020 2020 2020 2076 6172  et],.        var
+00007920: 6961 626c 6573 3a20 6469 6374 5b41 6e79  iables: dict[Any
+00007930: 2c20 5661 7269 6162 6c65 5d2c 0a20 2020  , Variable],.   
+00007940: 2020 2020 2063 6f6f 7264 5f6e 616d 6573       coord_names
+00007950: 3a20 7365 745b 4861 7368 6162 6c65 5d2c  : set[Hashable],
+00007960: 0a20 2020 2020 2020 2064 696d 733a 2064  .        dims: d
+00007970: 6963 745b 416e 792c 2069 6e74 5d20 7c20  ict[Any, int] | 
+00007980: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+00007990: 2020 2020 2061 7474 7273 3a20 6469 6374       attrs: dict
+000079a0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+000079b0: 2020 2020 2020 2020 696e 6465 7865 733a          indexes:
+000079c0: 2064 6963 745b 416e 792c 2049 6e64 6578   dict[Any, Index
+000079d0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+000079e0: 0a20 2020 2020 2020 2065 6e63 6f64 696e  .        encodin
+000079f0: 673a 2064 6963 7420 7c20 4e6f 6e65 203d  g: dict | None =
+00007a00: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
+00007a10: 6c6f 7365 3a20 4361 6c6c 6162 6c65 5b5b  lose: Callable[[
+00007a20: 5d2c 204e 6f6e 655d 207c 204e 6f6e 6520  ], None] | None 
+00007a30: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
+00007a40: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
+00007a50: 2020 2020 2222 2253 686f 7274 6375 7420      """Shortcut 
+00007a60: 6172 6f75 6e64 205f 5f69 6e69 745f 5f20  around __init__ 
+00007a70: 666f 7220 696e 7465 726e 616c 2075 7365  for internal use
+00007a80: 2077 6865 6e20 7765 2077 616e 7420 746f   when we want to
+00007a90: 2073 6b69 700a 2020 2020 2020 2020 636f   skip.        co
+00007aa0: 7374 6c79 2076 616c 6964 6174 696f 6e0a  stly validation.
+00007ab0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00007ac0: 2020 2020 6966 2064 696d 7320 6973 204e      if dims is N
+00007ad0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00007ae0: 2064 696d 7320 3d20 6361 6c63 756c 6174   dims = calculat
+00007af0: 655f 6469 6d65 6e73 696f 6e73 2876 6172  e_dimensions(var
+00007b00: 6961 626c 6573 290a 2020 2020 2020 2020  iables).        
+00007b10: 6966 2069 6e64 6578 6573 2069 7320 4e6f  if indexes is No
+00007b20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007b30: 696e 6465 7865 7320 3d20 7b7d 0a20 2020  indexes = {}.   
+00007b40: 2020 2020 206f 626a 203d 206f 626a 6563       obj = objec
+00007b50: 742e 5f5f 6e65 775f 5f28 636c 7329 0a20  t.__new__(cls). 
+00007b60: 2020 2020 2020 206f 626a 2e5f 7661 7269         obj._vari
+00007b70: 6162 6c65 7320 3d20 7661 7269 6162 6c65  ables = variable
+00007b80: 730a 2020 2020 2020 2020 6f62 6a2e 5f63  s.        obj._c
+00007b90: 6f6f 7264 5f6e 616d 6573 203d 2063 6f6f  oord_names = coo
+00007ba0: 7264 5f6e 616d 6573 0a20 2020 2020 2020  rd_names.       
+00007bb0: 206f 626a 2e5f 6469 6d73 203d 2064 696d   obj._dims = dim
+00007bc0: 730a 2020 2020 2020 2020 6f62 6a2e 5f69  s.        obj._i
+00007bd0: 6e64 6578 6573 203d 2069 6e64 6578 6573  ndexes = indexes
+00007be0: 0a20 2020 2020 2020 206f 626a 2e5f 6174  .        obj._at
+00007bf0: 7472 7320 3d20 6174 7472 730a 2020 2020  trs = attrs.    
+00007c00: 2020 2020 6f62 6a2e 5f63 6c6f 7365 203d      obj._close =
+00007c10: 2063 6c6f 7365 0a20 2020 2020 2020 206f   close.        o
+00007c20: 626a 2e5f 656e 636f 6469 6e67 203d 2065  bj._encoding = e
+00007c30: 6e63 6f64 696e 670a 2020 2020 2020 2020  ncoding.        
+00007c40: 7265 7475 726e 206f 626a 0a0a 2020 2020  return obj..    
+00007c50: 6465 6620 5f72 6570 6c61 6365 280a 2020  def _replace(.  
+00007c60: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
+00007c70: 7461 7365 742c 0a20 2020 2020 2020 2076  taset,.        v
+00007c80: 6172 6961 626c 6573 3a20 6469 6374 5b48  ariables: dict[H
+00007c90: 6173 6861 626c 652c 2056 6172 6961 626c  ashable, Variabl
+00007ca0: 655d 207c 204e 6f6e 6520 3d20 4e6f 6e65  e] | None = None
+00007cb0: 2c0a 2020 2020 2020 2020 636f 6f72 645f  ,.        coord_
+00007cc0: 6e61 6d65 733a 2073 6574 5b48 6173 6861  names: set[Hasha
+00007cd0: 626c 655d 207c 204e 6f6e 6520 3d20 4e6f  ble] | None = No
+00007ce0: 6e65 2c0a 2020 2020 2020 2020 6469 6d73  ne,.        dims
+00007cf0: 3a20 6469 6374 5b41 6e79 2c20 696e 745d  : dict[Any, int]
+00007d00: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00007d10: 2020 2020 2020 2020 6174 7472 733a 2064          attrs: d
+00007d20: 6963 745b 4861 7368 6162 6c65 2c20 416e  ict[Hashable, An
+00007d30: 795d 207c 204e 6f6e 6520 7c20 4465 6661  y] | None | Defa
+00007d40: 756c 7420 3d20 5f64 6566 6175 6c74 2c0a  ult = _default,.
+00007d50: 2020 2020 2020 2020 696e 6465 7865 733a          indexes:
+00007d60: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
+00007d70: 496e 6465 785d 207c 204e 6f6e 6520 3d20  Index] | None = 
+00007d80: 4e6f 6e65 2c0a 2020 2020 2020 2020 656e  None,.        en
+00007d90: 636f 6469 6e67 3a20 6469 6374 207c 204e  coding: dict | N
+00007da0: 6f6e 6520 7c20 4465 6661 756c 7420 3d20  one | Default = 
+00007db0: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+00007dc0: 2020 696e 706c 6163 653a 2062 6f6f 6c20    inplace: bool 
+00007dd0: 3d20 4661 6c73 652c 0a20 2020 2029 202d  = False,.    ) -
+00007de0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+00007df0: 2020 2020 2022 2222 4661 7374 7061 7468       """Fastpath
+00007e00: 2063 6f6e 7374 7275 6374 6f72 2066 6f72   constructor for
+00007e10: 2069 6e74 6572 6e61 6c20 7573 652e 0a0a   internal use...
+00007e20: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+00007e30: 616e 206f 626a 6563 7420 7769 7468 206f  an object with o
+00007e40: 7074 696f 6e61 6c6c 7920 7769 7468 2072  ptionally with r
+00007e50: 6570 6c61 6365 6420 6174 7472 6962 7574  eplaced attribut
+00007e60: 6573 2e0a 0a20 2020 2020 2020 2045 7870  es...        Exp
+00007e70: 6c69 6369 746c 7920 7061 7373 6564 2061  licitly passed a
+00007e80: 7267 756d 656e 7473 2061 7265 202a 6e6f  rguments are *no
+00007e90: 742a 2063 6f70 6965 6420 7768 656e 2070  t* copied when p
+00007ea0: 6c61 6365 6420 6f6e 2074 6865 206e 6577  laced on the new
+00007eb0: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
+00007ec0: 2e20 4974 2069 7320 7570 2074 6f20 7468  . It is up to th
+00007ed0: 6520 6361 6c6c 6572 2074 6f20 656e 7375  e caller to ensu
+00007ee0: 7265 2074 6861 7420 7468 6579 2068 6176  re that they hav
+00007ef0: 6520 7468 6520 7269 6768 7420 7479 7065  e the right type
+00007f00: 0a20 2020 2020 2020 2061 6e64 2061 7265  .        and are
+00007f10: 206e 6f74 2075 7365 6420 656c 7365 7768   not used elsewh
+00007f20: 6572 652e 0a20 2020 2020 2020 2022 2222  ere..        """
+00007f30: 0a20 2020 2020 2020 2069 6620 696e 706c  .        if inpl
+00007f40: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
+00007f50: 2069 6620 7661 7269 6162 6c65 7320 6973   if variables is
+00007f60: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00007f70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007f80: 5f76 6172 6961 626c 6573 203d 2076 6172  _variables = var
+00007f90: 6961 626c 6573 0a20 2020 2020 2020 2020  iables.         
+00007fa0: 2020 2069 6620 636f 6f72 645f 6e61 6d65     if coord_name
+00007fb0: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+00007fc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00007fd0: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
+00007fe0: 203d 2063 6f6f 7264 5f6e 616d 6573 0a20   = coord_names. 
+00007ff0: 2020 2020 2020 2020 2020 2069 6620 6469             if di
+00008000: 6d73 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ms is not None:.
+00008010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008020: 7365 6c66 2e5f 6469 6d73 203d 2064 696d  self._dims = dim
+00008030: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
+00008040: 2061 7474 7273 2069 7320 6e6f 7420 5f64   attrs is not _d
+00008050: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
+00008060: 2020 2020 2020 2020 7365 6c66 2e5f 6174          self._at
+00008070: 7472 7320 3d20 6174 7472 730a 2020 2020  trs = attrs.    
+00008080: 2020 2020 2020 2020 6966 2069 6e64 6578          if index
+00008090: 6573 2069 7320 6e6f 7420 4e6f 6e65 3a0a  es is not None:.
+000080a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000080b0: 7365 6c66 2e5f 696e 6465 7865 7320 3d20  self._indexes = 
+000080c0: 696e 6465 7865 730a 2020 2020 2020 2020  indexes.        
+000080d0: 2020 2020 6966 2065 6e63 6f64 696e 6720      if encoding 
+000080e0: 6973 206e 6f74 205f 6465 6661 756c 743a  is not _default:
+000080f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008100: 2073 656c 662e 5f65 6e63 6f64 696e 6720   self._encoding 
+00008110: 3d20 656e 636f 6469 6e67 0a20 2020 2020  = encoding.     
+00008120: 2020 2020 2020 206f 626a 203d 2073 656c         obj = sel
+00008130: 660a 2020 2020 2020 2020 656c 7365 3a0a  f.        else:.
+00008140: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+00008150: 6172 6961 626c 6573 2069 7320 4e6f 6e65  ariables is None
+00008160: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00008170: 2020 7661 7269 6162 6c65 7320 3d20 7365    variables = se
+00008180: 6c66 2e5f 7661 7269 6162 6c65 732e 636f  lf._variables.co
+00008190: 7079 2829 0a20 2020 2020 2020 2020 2020  py().           
+000081a0: 2069 6620 636f 6f72 645f 6e61 6d65 7320   if coord_names 
+000081b0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000081c0: 2020 2020 2020 2020 2063 6f6f 7264 5f6e           coord_n
+000081d0: 616d 6573 203d 2073 656c 662e 5f63 6f6f  ames = self._coo
+000081e0: 7264 5f6e 616d 6573 2e63 6f70 7928 290a  rd_names.copy().
+000081f0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00008200: 696d 7320 6973 204e 6f6e 653a 0a20 2020  ims is None:.   
+00008210: 2020 2020 2020 2020 2020 2020 2064 696d               dim
+00008220: 7320 3d20 7365 6c66 2e5f 6469 6d73 2e63  s = self._dims.c
+00008230: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
+00008240: 2020 6966 2061 7474 7273 2069 7320 5f64    if attrs is _d
+00008250: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
+00008260: 2020 2020 2020 2020 6174 7472 7320 3d20          attrs = 
+00008270: 636f 7079 2e63 6f70 7928 7365 6c66 2e5f  copy.copy(self._
+00008280: 6174 7472 7329 0a20 2020 2020 2020 2020  attrs).         
+00008290: 2020 2069 6620 696e 6465 7865 7320 6973     if indexes is
+000082a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000082b0: 2020 2020 2020 2069 6e64 6578 6573 203d         indexes =
+000082c0: 2073 656c 662e 5f69 6e64 6578 6573 2e63   self._indexes.c
+000082d0: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
+000082e0: 2020 6966 2065 6e63 6f64 696e 6720 6973    if encoding is
+000082f0: 205f 6465 6661 756c 743a 0a20 2020 2020   _default:.     
+00008300: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
+00008310: 696e 6720 3d20 636f 7079 2e63 6f70 7928  ing = copy.copy(
+00008320: 7365 6c66 2e5f 656e 636f 6469 6e67 290a  self._encoding).
+00008330: 2020 2020 2020 2020 2020 2020 6f62 6a20              obj 
+00008340: 3d20 7365 6c66 2e5f 636f 6e73 7472 7563  = self._construc
+00008350: 745f 6469 7265 6374 280a 2020 2020 2020  t_direct(.      
+00008360: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+00008370: 6c65 732c 2063 6f6f 7264 5f6e 616d 6573  les, coord_names
+00008380: 2c20 6469 6d73 2c20 6174 7472 732c 2069  , dims, attrs, i
+00008390: 6e64 6578 6573 2c20 656e 636f 6469 6e67  ndexes, encoding
+000083a0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000083b0: 2020 2020 2020 2072 6574 7572 6e20 6f62         return ob
+000083c0: 6a0a 0a20 2020 2064 6566 205f 7265 706c  j..    def _repl
+000083d0: 6163 655f 7769 7468 5f6e 6577 5f64 696d  ace_with_new_dim
+000083e0: 7328 0a20 2020 2020 2020 2073 656c 663a  s(.        self:
+000083f0: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
+00008400: 2020 2020 7661 7269 6162 6c65 733a 2064      variables: d
+00008410: 6963 745b 4861 7368 6162 6c65 2c20 5661  ict[Hashable, Va
+00008420: 7269 6162 6c65 5d2c 0a20 2020 2020 2020  riable],.       
+00008430: 2063 6f6f 7264 5f6e 616d 6573 3a20 7365   coord_names: se
+00008440: 7420 7c20 4e6f 6e65 203d 204e 6f6e 652c  t | None = None,
+00008450: 0a20 2020 2020 2020 2061 7474 7273 3a20  .        attrs: 
+00008460: 6469 6374 5b48 6173 6861 626c 652c 2041  dict[Hashable, A
+00008470: 6e79 5d20 7c20 4e6f 6e65 207c 2044 6566  ny] | None | Def
+00008480: 6175 6c74 203d 205f 6465 6661 756c 742c  ault = _default,
+00008490: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
+000084a0: 3a20 6469 6374 5b48 6173 6861 626c 652c  : dict[Hashable,
+000084b0: 2049 6e64 6578 5d20 7c20 4e6f 6e65 203d   Index] | None =
+000084c0: 204e 6f6e 652c 0a20 2020 2020 2020 2069   None,.        i
+000084d0: 6e70 6c61 6365 3a20 626f 6f6c 203d 2046  nplace: bool = F
+000084e0: 616c 7365 2c0a 2020 2020 2920 2d3e 2054  alse,.    ) -> T
+000084f0: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
+00008500: 2020 2222 2252 6570 6c61 6365 2076 6172    """Replace var
+00008510: 6961 626c 6573 2077 6974 6820 7265 6361  iables with reca
+00008520: 6c63 756c 6174 6564 2064 696d 656e 7369  lculated dimensi
+00008530: 6f6e 732e 2222 220a 2020 2020 2020 2020  ons.""".        
+00008540: 6469 6d73 203d 2063 616c 6375 6c61 7465  dims = calculate
+00008550: 5f64 696d 656e 7369 6f6e 7328 7661 7269  _dimensions(vari
+00008560: 6162 6c65 7329 0a20 2020 2020 2020 2072  ables).        r
+00008570: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
+00008580: 6163 6528 0a20 2020 2020 2020 2020 2020  ace(.           
+00008590: 2076 6172 6961 626c 6573 2c20 636f 6f72   variables, coor
+000085a0: 645f 6e61 6d65 732c 2064 696d 732c 2061  d_names, dims, a
+000085b0: 7474 7273 2c20 696e 6465 7865 732c 2069  ttrs, indexes, i
+000085c0: 6e70 6c61 6365 3d69 6e70 6c61 6365 0a20  nplace=inplace. 
+000085d0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+000085e0: 6620 5f72 6570 6c61 6365 5f76 6172 735f  f _replace_vars_
+000085f0: 616e 645f 6469 6d73 280a 2020 2020 2020  and_dims(.      
+00008600: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
+00008610: 742c 0a20 2020 2020 2020 2076 6172 6961  t,.        varia
+00008620: 626c 6573 3a20 6469 6374 5b48 6173 6861  bles: dict[Hasha
+00008630: 626c 652c 2056 6172 6961 626c 655d 2c0a  ble, Variable],.
+00008640: 2020 2020 2020 2020 636f 6f72 645f 6e61          coord_na
+00008650: 6d65 733a 2073 6574 207c 204e 6f6e 6520  mes: set | None 
+00008660: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00008670: 6469 6d73 3a20 6469 6374 5b48 6173 6861  dims: dict[Hasha
+00008680: 626c 652c 2069 6e74 5d20 7c20 4e6f 6e65  ble, int] | None
+00008690: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+000086a0: 2061 7474 7273 3a20 6469 6374 5b48 6173   attrs: dict[Has
+000086b0: 6861 626c 652c 2041 6e79 5d20 7c20 4e6f  hable, Any] | No
+000086c0: 6e65 207c 2044 6566 6175 6c74 203d 205f  ne | Default = _
+000086d0: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
+000086e0: 2069 6e70 6c61 6365 3a20 626f 6f6c 203d   inplace: bool =
+000086f0: 2046 616c 7365 2c0a 2020 2020 2920 2d3e   False,.    ) ->
+00008700: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
+00008710: 2020 2020 2222 2244 6570 7265 6361 7465      """Deprecate
+00008720: 6420 7665 7273 696f 6e20 6f66 205f 7265  d version of _re
+00008730: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
+00008740: 696d 7328 292e 0a0a 2020 2020 2020 2020  ims()...        
+00008750: 556e 6c69 6b65 205f 7265 706c 6163 655f  Unlike _replace_
+00008760: 7769 7468 5f6e 6577 5f64 696d 7328 292c  with_new_dims(),
+00008770: 2074 6869 7320 6d65 7468 6f64 2061 6c77   this method alw
+00008780: 6179 7320 7265 6361 6c63 756c 6174 6573  ays recalculates
+00008790: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
+000087a0: 2066 726f 6d20 7661 7269 6162 6c65 732e   from variables.
+000087b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000087c0: 2020 2020 2069 6620 6469 6d73 2069 7320       if dims is 
+000087d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000087e0: 2020 6469 6d73 203d 2063 616c 6375 6c61    dims = calcula
+000087f0: 7465 5f64 696d 656e 7369 6f6e 7328 7661  te_dimensions(va
+00008800: 7269 6162 6c65 7329 0a20 2020 2020 2020  riables).       
+00008810: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
+00008820: 706c 6163 6528 0a20 2020 2020 2020 2020  place(.         
+00008830: 2020 2076 6172 6961 626c 6573 2c20 636f     variables, co
+00008840: 6f72 645f 6e61 6d65 732c 2064 696d 732c  ord_names, dims,
+00008850: 2061 7474 7273 2c20 696e 6465 7865 733d   attrs, indexes=
+00008860: 4e6f 6e65 2c20 696e 706c 6163 653d 696e  None, inplace=in
+00008870: 706c 6163 650a 2020 2020 2020 2020 290a  place.        ).
+00008880: 0a20 2020 2064 6566 205f 6f76 6572 7772  .    def _overwr
+00008890: 6974 655f 696e 6465 7865 7328 0a20 2020  ite_indexes(.   
+000088a0: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
+000088b0: 6173 6574 2c0a 2020 2020 2020 2020 696e  aset,.        in
+000088c0: 6465 7865 733a 204d 6170 7069 6e67 5b48  dexes: Mapping[H
+000088d0: 6173 6861 626c 652c 2049 6e64 6578 5d2c  ashable, Index],
+000088e0: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
+000088f0: 6573 3a20 4d61 7070 696e 675b 4861 7368  es: Mapping[Hash
+00008900: 6162 6c65 2c20 5661 7269 6162 6c65 5d20  able, Variable] 
+00008910: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00008920: 2020 2020 2020 2064 726f 705f 7661 7269         drop_vari
+00008930: 6162 6c65 733a 206c 6973 745b 4861 7368  ables: list[Hash
+00008940: 6162 6c65 5d20 7c20 4e6f 6e65 203d 204e  able] | None = N
+00008950: 6f6e 652c 0a20 2020 2020 2020 2064 726f  one,.        dro
+00008960: 705f 696e 6465 7865 733a 206c 6973 745b  p_indexes: list[
+00008970: 4861 7368 6162 6c65 5d20 7c20 4e6f 6e65  Hashable] | None
+00008980: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00008990: 2072 656e 616d 655f 6469 6d73 3a20 4d61   rename_dims: Ma
+000089a0: 7070 696e 675b 4861 7368 6162 6c65 2c20  pping[Hashable, 
+000089b0: 4861 7368 6162 6c65 5d20 7c20 4e6f 6e65  Hashable] | None
+000089c0: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
+000089d0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+000089e0: 2020 2020 2022 2222 4d61 7962 6520 7265       """Maybe re
+000089f0: 706c 6163 6520 696e 6465 7865 732e 0a0a  place indexes...
+00008a00: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
+00008a10: 6374 696f 6e20 6d61 7920 646f 2061 206c  ction may do a l
+00008a20: 6f74 206d 6f72 6520 6465 7065 6e64 696e  ot more dependin
+00008a30: 6720 6f6e 2069 6e64 6578 2071 7565 7279  g on index query
+00008a40: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
+00008a50: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
+00008a60: 2020 2020 2020 2069 6620 6e6f 7420 696e         if not in
+00008a70: 6465 7865 733a 0a20 2020 2020 2020 2020  dexes:.         
+00008a80: 2020 2072 6574 7572 6e20 7365 6c66 0a0a     return self..
+00008a90: 2020 2020 2020 2020 6966 2076 6172 6961          if varia
+00008aa0: 626c 6573 2069 7320 4e6f 6e65 3a0a 2020  bles is None:.  
+00008ab0: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+00008ac0: 6c65 7320 3d20 7b7d 0a20 2020 2020 2020  les = {}.       
+00008ad0: 2069 6620 6472 6f70 5f76 6172 6961 626c   if drop_variabl
+00008ae0: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
+00008af0: 2020 2020 2020 2020 6472 6f70 5f76 6172          drop_var
+00008b00: 6961 626c 6573 203d 205b 5d0a 2020 2020  iables = [].    
+00008b10: 2020 2020 6966 2064 726f 705f 696e 6465      if drop_inde
+00008b20: 7865 7320 6973 204e 6f6e 653a 0a20 2020  xes is None:.   
+00008b30: 2020 2020 2020 2020 2064 726f 705f 696e           drop_in
+00008b40: 6465 7865 7320 3d20 5b5d 0a0a 2020 2020  dexes = []..    
+00008b50: 2020 2020 6e65 775f 7661 7269 6162 6c65      new_variable
+00008b60: 7320 3d20 7365 6c66 2e5f 7661 7269 6162  s = self._variab
+00008b70: 6c65 732e 636f 7079 2829 0a20 2020 2020  les.copy().     
+00008b80: 2020 206e 6577 5f63 6f6f 7264 5f6e 616d     new_coord_nam
+00008b90: 6573 203d 2073 656c 662e 5f63 6f6f 7264  es = self._coord
+00008ba0: 5f6e 616d 6573 2e63 6f70 7928 290a 2020  _names.copy().  
+00008bb0: 2020 2020 2020 6e65 775f 696e 6465 7865        new_indexe
+00008bc0: 7320 3d20 6469 6374 2873 656c 662e 5f69  s = dict(self._i
+00008bd0: 6e64 6578 6573 290a 0a20 2020 2020 2020  ndexes)..       
+00008be0: 2069 6e64 6578 5f76 6172 6961 626c 6573   index_variables
+00008bf0: 203d 207b 7d0a 2020 2020 2020 2020 6e6f   = {}.        no
+00008c00: 5f69 6e64 6578 5f76 6172 6961 626c 6573  _index_variables
+00008c10: 203d 207b 7d0a 2020 2020 2020 2020 666f   = {}.        fo
+00008c20: 7220 6e61 6d65 2c20 7661 7220 696e 2076  r name, var in v
+00008c30: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
+00008c40: 3a0a 2020 2020 2020 2020 2020 2020 6f6c  :.            ol
+00008c50: 645f 7661 7220 3d20 7365 6c66 2e5f 7661  d_var = self._va
+00008c60: 7269 6162 6c65 732e 6765 7428 6e61 6d65  riables.get(name
+00008c70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00008c80: 206f 6c64 5f76 6172 2069 7320 6e6f 7420   old_var is not 
+00008c90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00008ca0: 2020 2020 2020 7661 722e 6174 7472 732e        var.attrs.
+00008cb0: 7570 6461 7465 286f 6c64 5f76 6172 2e61  update(old_var.a
+00008cc0: 7474 7273 290a 2020 2020 2020 2020 2020  ttrs).          
+00008cd0: 2020 2020 2020 7661 722e 656e 636f 6469        var.encodi
+00008ce0: 6e67 2e75 7064 6174 6528 6f6c 645f 7661  ng.update(old_va
+00008cf0: 722e 656e 636f 6469 6e67 290a 2020 2020  r.encoding).    
+00008d00: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
+00008d10: 696e 2069 6e64 6578 6573 3a0a 2020 2020  in indexes:.    
+00008d20: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00008d30: 785f 7661 7269 6162 6c65 735b 6e61 6d65  x_variables[name
+00008d40: 5d20 3d20 7661 720a 2020 2020 2020 2020  ] = var.        
+00008d50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00008d60: 2020 2020 2020 2020 2020 6e6f 5f69 6e64            no_ind
+00008d70: 6578 5f76 6172 6961 626c 6573 5b6e 616d  ex_variables[nam
+00008d80: 655d 203d 2076 6172 0a0a 2020 2020 2020  e] = var..      
+00008d90: 2020 666f 7220 6e61 6d65 2069 6e20 696e    for name in in
+00008da0: 6465 7865 733a 0a20 2020 2020 2020 2020  dexes:.         
+00008db0: 2020 206e 6577 5f69 6e64 6578 6573 5b6e     new_indexes[n
+00008dc0: 616d 655d 203d 2069 6e64 6578 6573 5b6e  ame] = indexes[n
+00008dd0: 616d 655d 0a0a 2020 2020 2020 2020 666f  ame]..        fo
+00008de0: 7220 6e61 6d65 2c20 7661 7220 696e 2069  r name, var in i
+00008df0: 6e64 6578 5f76 6172 6961 626c 6573 2e69  ndex_variables.i
+00008e00: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+00008e10: 2020 2020 6e65 775f 636f 6f72 645f 6e61      new_coord_na
+00008e20: 6d65 732e 6164 6428 6e61 6d65 290a 2020  mes.add(name).  
+00008e30: 2020 2020 2020 2020 2020 6e65 775f 7661            new_va
+00008e40: 7269 6162 6c65 735b 6e61 6d65 5d20 3d20  riables[name] = 
+00008e50: 7661 720a 0a20 2020 2020 2020 2023 2061  var..        # a
+00008e60: 7070 656e 6420 6e6f 2d69 6e64 6578 2076  ppend no-index v
+00008e70: 6172 6961 626c 6573 2061 7420 7468 6520  ariables at the 
+00008e80: 656e 640a 2020 2020 2020 2020 666f 7220  end.        for 
+00008e90: 6b20 696e 206e 6f5f 696e 6465 785f 7661  k in no_index_va
+00008ea0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+00008eb0: 2020 2020 206e 6577 5f76 6172 6961 626c       new_variabl
+00008ec0: 6573 2e70 6f70 286b 290a 2020 2020 2020  es.pop(k).      
+00008ed0: 2020 6e65 775f 7661 7269 6162 6c65 732e    new_variables.
+00008ee0: 7570 6461 7465 286e 6f5f 696e 6465 785f  update(no_index_
+00008ef0: 7661 7269 6162 6c65 7329 0a0a 2020 2020  variables)..    
+00008f00: 2020 2020 666f 7220 6e61 6d65 2069 6e20      for name in 
+00008f10: 6472 6f70 5f69 6e64 6578 6573 3a0a 2020  drop_indexes:.  
+00008f20: 2020 2020 2020 2020 2020 6e65 775f 696e            new_in
+00008f30: 6465 7865 732e 706f 7028 6e61 6d65 290a  dexes.pop(name).
+00008f40: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
+00008f50: 6520 696e 2064 726f 705f 7661 7269 6162  e in drop_variab
+00008f60: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+00008f70: 206e 6577 5f76 6172 6961 626c 6573 2e70   new_variables.p
+00008f80: 6f70 286e 616d 6529 0a20 2020 2020 2020  op(name).       
+00008f90: 2020 2020 206e 6577 5f69 6e64 6578 6573       new_indexes
+00008fa0: 2e70 6f70 286e 616d 652c 204e 6f6e 6529  .pop(name, None)
+00008fb0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00008fc0: 5f63 6f6f 7264 5f6e 616d 6573 2e72 656d  _coord_names.rem
+00008fd0: 6f76 6528 6e61 6d65 290a 0a20 2020 2020  ove(name)..     
+00008fe0: 2020 2072 6570 6c61 6365 6420 3d20 7365     replaced = se
+00008ff0: 6c66 2e5f 7265 706c 6163 6528 0a20 2020  lf._replace(.   
+00009000: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+00009010: 6573 3d6e 6577 5f76 6172 6961 626c 6573  es=new_variables
+00009020: 2c20 636f 6f72 645f 6e61 6d65 733d 6e65  , coord_names=ne
+00009030: 775f 636f 6f72 645f 6e61 6d65 732c 2069  w_coord_names, i
+00009040: 6e64 6578 6573 3d6e 6577 5f69 6e64 6578  ndexes=new_index
+00009050: 6573 0a20 2020 2020 2020 2029 0a0a 2020  es.        )..  
+00009060: 2020 2020 2020 6966 2072 656e 616d 655f        if rename_
+00009070: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
+00009080: 2020 2320 736b 6970 2072 656e 616d 6520    # skip rename 
+00009090: 696e 6465 7865 733a 2074 6865 7920 7368  indexes: they sh
+000090a0: 6f75 6c64 2061 6c72 6561 6479 2068 6176  ould already hav
+000090b0: 6520 7468 6520 7269 6768 7420 6e61 6d65  e the right name
+000090c0: 2873 290a 2020 2020 2020 2020 2020 2020  (s).            
+000090d0: 6469 6d73 203d 2072 6570 6c61 6365 642e  dims = replaced.
+000090e0: 5f72 656e 616d 655f 6469 6d73 2872 656e  _rename_dims(ren
+000090f0: 616d 655f 6469 6d73 290a 2020 2020 2020  ame_dims).      
+00009100: 2020 2020 2020 6e65 775f 7661 7269 6162        new_variab
+00009110: 6c65 732c 206e 6577 5f63 6f6f 7264 5f6e  les, new_coord_n
+00009120: 616d 6573 203d 2072 6570 6c61 6365 642e  ames = replaced.
+00009130: 5f72 656e 616d 655f 7661 7273 287b 7d2c  _rename_vars({},
+00009140: 2072 656e 616d 655f 6469 6d73 290a 2020   rename_dims).  
+00009150: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00009160: 2072 6570 6c61 6365 642e 5f72 6570 6c61   replaced._repla
+00009170: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
+00009180: 2020 2020 7661 7269 6162 6c65 733d 6e65      variables=ne
+00009190: 775f 7661 7269 6162 6c65 732c 2063 6f6f  w_variables, coo
+000091a0: 7264 5f6e 616d 6573 3d6e 6577 5f63 6f6f  rd_names=new_coo
+000091b0: 7264 5f6e 616d 6573 2c20 6469 6d73 3d64  rd_names, dims=d
+000091c0: 696d 730a 2020 2020 2020 2020 2020 2020  ims.            
+000091d0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+000091e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000091f0: 726e 2072 6570 6c61 6365 640a 0a20 2020  rn replaced..   
+00009200: 2064 6566 2063 6f70 7928 0a20 2020 2020   def copy(.     
+00009210: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+00009220: 6574 2c20 6465 6570 3a20 626f 6f6c 203d  et, deep: bool =
+00009230: 2046 616c 7365 2c20 6461 7461 3a20 4d61   False, data: Ma
+00009240: 7070 696e 675b 416e 792c 2041 7272 6179  pping[Any, Array
+00009250: 4c69 6b65 5d20 7c20 4e6f 6e65 203d 204e  Like] | None = N
+00009260: 6f6e 650a 2020 2020 2920 2d3e 2054 5f44  one.    ) -> T_D
+00009270: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
+00009280: 2222 2252 6574 7572 6e73 2061 2063 6f70  """Returns a cop
+00009290: 7920 6f66 2074 6869 7320 6461 7461 7365  y of this datase
+000092a0: 742e 0a0a 2020 2020 2020 2020 4966 2060  t...        If `
+000092b0: 6465 6570 3d54 7275 6560 2c20 6120 6465  deep=True`, a de
+000092c0: 6570 2063 6f70 7920 6973 206d 6164 6520  ep copy is made 
+000092d0: 6f66 2065 6163 6820 6f66 2074 6865 2063  of each of the c
+000092e0: 6f6d 706f 6e65 6e74 2076 6172 6961 626c  omponent variabl
+000092f0: 6573 2e0a 2020 2020 2020 2020 4f74 6865  es..        Othe
+00009300: 7277 6973 652c 2061 2073 6861 6c6c 6f77  rwise, a shallow
+00009310: 2063 6f70 7920 6f66 2065 6163 6820 6f66   copy of each of
+00009320: 2074 6865 2063 6f6d 706f 6e65 6e74 2076   the component v
+00009330: 6172 6961 626c 6520 6973 206d 6164 652c  ariable is made,
+00009340: 2073 6f0a 2020 2020 2020 2020 7468 6174   so.        that
+00009350: 2074 6865 2075 6e64 6572 6c79 696e 6720   the underlying 
+00009360: 6d65 6d6f 7279 2072 6567 696f 6e20 6f66  memory region of
+00009370: 2074 6865 206e 6577 2064 6174 6173 6574   the new dataset
+00009380: 2069 7320 7468 6520 7361 6d65 2061 7320   is the same as 
+00009390: 696e 0a20 2020 2020 2020 2074 6865 206f  in.        the o
+000093a0: 7269 6769 6e61 6c20 6461 7461 7365 742e  riginal dataset.
+000093b0: 0a0a 2020 2020 2020 2020 5573 6520 6064  ..        Use `d
+000093c0: 6174 6160 2074 6f20 6372 6561 7465 2061  ata` to create a
+000093d0: 206e 6577 206f 626a 6563 7420 7769 7468   new object with
+000093e0: 2074 6865 2073 616d 6520 7374 7275 6374   the same struct
+000093f0: 7572 6520 6173 0a20 2020 2020 2020 206f  ure as.        o
+00009400: 7269 6769 6e61 6c20 6275 7420 656e 7469  riginal but enti
+00009410: 7265 6c79 206e 6577 2064 6174 612e 0a0a  rely new data...
+00009420: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00009430: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00009440: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6465  -----.        de
+00009450: 6570 203a 2062 6f6f 6c2c 2064 6566 6175  ep : bool, defau
+00009460: 6c74 3a20 4661 6c73 650a 2020 2020 2020  lt: False.      
+00009470: 2020 2020 2020 5768 6574 6865 7220 6561        Whether ea
+00009480: 6368 2063 6f6d 706f 6e65 6e74 2076 6172  ch component var
+00009490: 6961 626c 6520 6973 206c 6f61 6465 6420  iable is loaded 
+000094a0: 696e 746f 206d 656d 6f72 7920 616e 6420  into memory and 
+000094b0: 636f 7069 6564 206f 6e74 6f0a 2020 2020  copied onto.    
+000094c0: 2020 2020 2020 2020 7468 6520 6e65 7720          the new 
+000094d0: 6f62 6a65 6374 2e20 4465 6661 756c 7420  object. Default 
+000094e0: 6973 2046 616c 7365 2e0a 2020 2020 2020  is False..      
+000094f0: 2020 6461 7461 203a 2064 6963 742d 6c69    data : dict-li
+00009500: 6b65 206f 7220 4e6f 6e65 2c20 6f70 7469  ke or None, opti
+00009510: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00009520: 2044 6174 6120 746f 2075 7365 2069 6e20   Data to use in 
+00009530: 7468 6520 6e65 7720 6f62 6a65 6374 2e20  the new object. 
+00009540: 4561 6368 2069 7465 6d20 696e 2060 6461  Each item in `da
+00009550: 7461 6020 6d75 7374 2068 6176 6520 7361  ta` must have sa
+00009560: 6d65 0a20 2020 2020 2020 2020 2020 2073  me.            s
+00009570: 6861 7065 2061 7320 636f 7272 6573 706f  hape as correspo
+00009580: 6e64 696e 6720 6461 7461 2076 6172 6961  nding data varia
+00009590: 626c 6520 696e 206f 7269 6769 6e61 6c2e  ble in original.
+000095a0: 2057 6865 6e20 6064 6174 6160 2069 730a   When `data` is.
+000095b0: 2020 2020 2020 2020 2020 2020 7573 6564              used
+000095c0: 2c20 6064 6565 7060 2069 7320 6967 6e6f  , `deep` is igno
+000095d0: 7265 6420 666f 7220 7468 6520 6461 7461  red for the data
+000095e0: 2076 6172 6961 626c 6573 2061 6e64 206f   variables and o
+000095f0: 6e6c 7920 7573 6564 2066 6f72 0a20 2020  nly used for.   
+00009600: 2020 2020 2020 2020 2063 6f6f 7264 732e           coords.
+00009610: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00009620: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00009630: 2d0a 2020 2020 2020 2020 6f62 6a65 6374  -.        object
+00009640: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
+00009650: 2020 2020 2020 204e 6577 206f 626a 6563         New objec
+00009660: 7420 7769 7468 2064 696d 656e 7369 6f6e  t with dimension
+00009670: 732c 2061 7474 7269 6275 7465 732c 2063  s, attributes, c
+00009680: 6f6f 7264 696e 6174 6573 2c20 6e61 6d65  oordinates, name
+00009690: 2c20 656e 636f 6469 6e67 2c0a 2020 2020  , encoding,.    
+000096a0: 2020 2020 2020 2020 616e 6420 6f70 7469          and opti
+000096b0: 6f6e 616c 6c79 2064 6174 6120 636f 7069  onally data copi
+000096c0: 6564 2066 726f 6d20 6f72 6967 696e 616c  ed from original
+000096d0: 2e0a 0a20 2020 2020 2020 2045 7861 6d70  ...        Examp
+000096e0: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
+000096f0: 2d2d 2d2d 0a20 2020 2020 2020 2053 6861  ----.        Sha
+00009700: 6c6c 6f77 2063 6f70 7920 7665 7273 7573  llow copy versus
+00009710: 2064 6565 7020 636f 7079 0a0a 2020 2020   deep copy..    
+00009720: 2020 2020 3e3e 3e20 6461 203d 2078 722e      >>> da = xr.
+00009730: 4461 7461 4172 7261 7928 6e70 2e72 616e  DataArray(np.ran
+00009740: 646f 6d2e 7261 6e64 6e28 322c 2033 2929  dom.randn(2, 3))
+00009750: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
+00009760: 3d20 7872 2e44 6174 6173 6574 280a 2020  = xr.Dataset(.  
+00009770: 2020 2020 2020 2e2e 2e20 2020 2020 7b22        ...     {"
+00009780: 666f 6f22 3a20 6461 2c20 2262 6172 223a  foo": da, "bar":
+00009790: 2028 2278 222c 205b 2d31 2c20 325d 297d   ("x", [-1, 2])}
+000097a0: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
+000097b0: 2020 636f 6f72 6473 3d7b 2278 223a 205b    coords={"x": [
+000097c0: 226f 6e65 222c 2022 7477 6f22 5d7d 2c0a  "one", "two"]},.
+000097d0: 2020 2020 2020 2020 2e2e 2e20 290a 2020          ... ).  
+000097e0: 2020 2020 2020 3e3e 3e20 6473 2e63 6f70        >>> ds.cop
+000097f0: 7928 290a 2020 2020 2020 2020 3c78 6172  y().        <xar
+00009800: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+00009810: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+00009820: 2020 2864 696d 5f30 3a20 322c 2064 696d    (dim_0: 2, dim
+00009830: 5f31 3a20 332c 2078 3a20 3229 0a20 2020  _1: 3, x: 2).   
+00009840: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
+00009850: 3a0a 2020 2020 2020 2020 2020 2a20 7820  :.          * x 
+00009860: 2020 2020 2020 2028 7829 203c 5533 2027         (x) <U3 '
+00009870: 6f6e 6527 2027 7477 6f27 0a20 2020 2020  one' 'two'.     
+00009880: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
+00009890: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
+000098a0: 733a 2064 696d 5f30 2c20 6469 6d5f 310a  s: dim_0, dim_1.
+000098b0: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
+000098c0: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
+000098d0: 2020 2020 666f 6f20 2020 2020 2028 6469      foo      (di
+000098e0: 6d5f 302c 2064 696d 5f31 2920 666c 6f61  m_0, dim_1) floa
+000098f0: 7436 3420 312e 3736 3420 302e 3430 3032  t64 1.764 0.4002
+00009900: 2030 2e39 3738 3720 322e 3234 3120 312e   0.9787 2.241 1.
+00009910: 3836 3820 2d30 2e39 3737 330a 2020 2020  868 -0.9773.    
+00009920: 2020 2020 2020 2020 6261 7220 2020 2020          bar     
+00009930: 2028 7829 2069 6e74 3634 202d 3120 320a   (x) int64 -1 2.
+00009940: 0a20 2020 2020 2020 203e 3e3e 2064 735f  .        >>> ds_
+00009950: 3020 3d20 6473 2e63 6f70 7928 6465 6570  0 = ds.copy(deep
+00009960: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+00009970: 3e3e 3e20 6473 5f30 5b22 666f 6f22 5d5b  >>> ds_0["foo"][
+00009980: 302c 2030 5d20 3d20 370a 2020 2020 2020  0, 0] = 7.      
+00009990: 2020 3e3e 3e20 6473 5f30 0a20 2020 2020    >>> ds_0.     
+000099a0: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
+000099b0: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
+000099c0: 6e73 696f 6e73 3a20 2028 6469 6d5f 303a  nsions:  (dim_0:
+000099d0: 2032 2c20 6469 6d5f 313a 2033 2c20 783a   2, dim_1: 3, x:
+000099e0: 2032 290a 2020 2020 2020 2020 436f 6f72   2).        Coor
+000099f0: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
+00009a00: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
+00009a10: 2920 3c55 3320 276f 6e65 2720 2774 776f  ) <U3 'one' 'two
+00009a20: 270a 2020 2020 2020 2020 4469 6d65 6e73  '.        Dimens
+00009a30: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
+00009a40: 7264 696e 6174 6573 3a20 6469 6d5f 302c  rdinates: dim_0,
+00009a50: 2064 696d 5f31 0a20 2020 2020 2020 2044   dim_1.        D
+00009a60: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+00009a70: 2020 2020 2020 2020 2020 2066 6f6f 2020             foo  
+00009a80: 2020 2020 2864 696d 5f30 2c20 6469 6d5f      (dim_0, dim_
+00009a90: 3129 2066 6c6f 6174 3634 2037 2e30 2030  1) float64 7.0 0
+00009aa0: 2e34 3030 3220 302e 3937 3837 2032 2e32  .4002 0.9787 2.2
+00009ab0: 3431 2031 2e38 3638 202d 302e 3937 3733  41 1.868 -0.9773
+00009ac0: 0a20 2020 2020 2020 2020 2020 2062 6172  .            bar
+00009ad0: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
+00009ae0: 2d31 2032 0a0a 2020 2020 2020 2020 3e3e  -1 2..        >>
+00009af0: 3e20 6473 0a20 2020 2020 2020 203c 7861  > ds.        <xa
+00009b00: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
+00009b10: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
+00009b20: 3a20 2028 6469 6d5f 303a 2032 2c20 6469  :  (dim_0: 2, di
+00009b30: 6d5f 313a 2033 2c20 783a 2032 290a 2020  m_1: 3, x: 2).  
+00009b40: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
+00009b50: 733a 0a20 2020 2020 2020 2020 202a 2078  s:.          * x
+00009b60: 2020 2020 2020 2020 2878 2920 3c55 3320          (x) <U3 
+00009b70: 276f 6e65 2720 2774 776f 270a 2020 2020  'one' 'two'.    
+00009b80: 2020 2020 4469 6d65 6e73 696f 6e73 2077      Dimensions w
+00009b90: 6974 686f 7574 2063 6f6f 7264 696e 6174  ithout coordinat
+00009ba0: 6573 3a20 6469 6d5f 302c 2064 696d 5f31  es: dim_0, dim_1
+00009bb0: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
+00009bc0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+00009bd0: 2020 2020 2066 6f6f 2020 2020 2020 2864       foo      (d
+00009be0: 696d 5f30 2c20 6469 6d5f 3129 2066 6c6f  im_0, dim_1) flo
+00009bf0: 6174 3634 2037 2e30 2030 2e34 3030 3220  at64 7.0 0.4002 
+00009c00: 302e 3937 3837 2032 2e32 3431 2031 2e38  0.9787 2.241 1.8
+00009c10: 3638 202d 302e 3937 3733 0a20 2020 2020  68 -0.9773.     
+00009c20: 2020 2020 2020 2062 6172 2020 2020 2020         bar      
+00009c30: 2878 2920 696e 7436 3420 2d31 2032 0a0a  (x) int64 -1 2..
+00009c40: 2020 2020 2020 2020 4368 616e 6769 6e67          Changing
+00009c50: 2074 6865 2064 6174 6120 7573 696e 6720   the data using 
+00009c60: 7468 6520 6060 6461 7461 6060 2061 7267  the ``data`` arg
+00009c70: 756d 656e 7420 6d61 696e 7461 696e 7320  ument maintains 
+00009c80: 7468 650a 2020 2020 2020 2020 7374 7275  the.        stru
+00009c90: 6374 7572 6520 6f66 2074 6865 206f 7269  cture of the ori
+00009ca0: 6769 6e61 6c20 6f62 6a65 6374 2c20 6275  ginal object, bu
+00009cb0: 7420 7769 7468 2074 6865 206e 6577 2064  t with the new d
+00009cc0: 6174 612e 204f 7269 6769 6e61 6c0a 2020  ata. Original.  
+00009cd0: 2020 2020 2020 6f62 6a65 6374 2069 7320        object is 
+00009ce0: 756e 6166 6665 6374 6564 2e0a 0a20 2020  unaffected...   
+00009cf0: 2020 2020 203e 3e3e 2064 732e 636f 7079       >>> ds.copy
+00009d00: 2864 6174 613d 7b22 666f 6f22 3a20 6e70  (data={"foo": np
+00009d10: 2e61 7261 6e67 6528 3629 2e72 6573 6861  .arange(6).resha
+00009d20: 7065 2832 2c20 3329 2c20 2262 6172 223a  pe(2, 3), "bar":
+00009d30: 205b 2261 222c 2022 6222 5d7d 290a 2020   ["a", "b"]}).  
+00009d40: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
+00009d50: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
+00009d60: 696d 656e 7369 6f6e 733a 2020 2864 696d  imensions:  (dim
+00009d70: 5f30 3a20 322c 2064 696d 5f31 3a20 332c  _0: 2, dim_1: 3,
+00009d80: 2078 3a20 3229 0a20 2020 2020 2020 2043   x: 2).        C
+00009d90: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
+00009da0: 2020 2020 2020 2a20 7820 2020 2020 2020        * x       
+00009db0: 2028 7829 203c 5533 2027 6f6e 6527 2027   (x) <U3 'one' '
+00009dc0: 7477 6f27 0a20 2020 2020 2020 2044 696d  two'.        Dim
+00009dd0: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
+00009de0: 636f 6f72 6469 6e61 7465 733a 2064 696d  coordinates: dim
+00009df0: 5f30 2c20 6469 6d5f 310a 2020 2020 2020  _0, dim_1.      
+00009e00: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
+00009e10: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+00009e20: 6f20 2020 2020 2028 6469 6d5f 302c 2064  o      (dim_0, d
+00009e30: 696d 5f31 2920 696e 7436 3420 3020 3120  im_1) int64 0 1 
+00009e40: 3220 3320 3420 350a 2020 2020 2020 2020  2 3 4 5.        
+00009e50: 2020 2020 6261 7220 2020 2020 2028 7829      bar      (x)
+00009e60: 203c 5531 2027 6127 2027 6227 0a0a 2020   <U1 'a' 'b'..  
+00009e70: 2020 2020 2020 3e3e 3e20 6473 0a20 2020        >>> ds.   
+00009e80: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
+00009e90: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
+00009ea0: 6d65 6e73 696f 6e73 3a20 2028 6469 6d5f  mensions:  (dim_
+00009eb0: 303a 2032 2c20 6469 6d5f 313a 2033 2c20  0: 2, dim_1: 3, 
+00009ec0: 783a 2032 290a 2020 2020 2020 2020 436f  x: 2).        Co
+00009ed0: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
+00009ee0: 2020 2020 202a 2078 2020 2020 2020 2020       * x        
+00009ef0: 2878 2920 3c55 3320 276f 6e65 2720 2774  (x) <U3 'one' 't
+00009f00: 776f 270a 2020 2020 2020 2020 4469 6d65  wo'.        Dime
+00009f10: 6e73 696f 6e73 2077 6974 686f 7574 2063  nsions without c
+00009f20: 6f6f 7264 696e 6174 6573 3a20 6469 6d5f  oordinates: dim_
+00009f30: 302c 2064 696d 5f31 0a20 2020 2020 2020  0, dim_1.       
+00009f40: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
+00009f50: 0a20 2020 2020 2020 2020 2020 2066 6f6f  .            foo
+00009f60: 2020 2020 2020 2864 696d 5f30 2c20 6469        (dim_0, di
+00009f70: 6d5f 3129 2066 6c6f 6174 3634 2037 2e30  m_1) float64 7.0
+00009f80: 2030 2e34 3030 3220 302e 3937 3837 2032   0.4002 0.9787 2
+00009f90: 2e32 3431 2031 2e38 3638 202d 302e 3937  .241 1.868 -0.97
+00009fa0: 3733 0a20 2020 2020 2020 2020 2020 2062  73.            b
+00009fb0: 6172 2020 2020 2020 2878 2920 696e 7436  ar      (x) int6
+00009fc0: 3420 2d31 2032 0a0a 2020 2020 2020 2020  4 -1 2..        
+00009fd0: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+00009fe0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+00009ff0: 2020 7061 6e64 6173 2e44 6174 6146 7261    pandas.DataFra
+0000a000: 6d65 2e63 6f70 790a 2020 2020 2020 2020  me.copy.        
+0000a010: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0000a020: 726e 2073 656c 662e 5f63 6f70 7928 6465  rn self._copy(de
+0000a030: 6570 3d64 6565 702c 2064 6174 613d 6461  ep=deep, data=da
+0000a040: 7461 290a 0a20 2020 2064 6566 205f 636f  ta)..    def _co
+0000a050: 7079 280a 2020 2020 2020 2020 7365 6c66  py(.        self
+0000a060: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
+0000a070: 2020 2020 2064 6565 703a 2062 6f6f 6c20       deep: bool 
+0000a080: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+0000a090: 2064 6174 613a 204d 6170 7069 6e67 5b41   data: Mapping[A
+0000a0a0: 6e79 2c20 4172 7261 794c 696b 655d 207c  ny, ArrayLike] |
+0000a0b0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+0000a0c0: 2020 2020 2020 6d65 6d6f 3a20 6469 6374        memo: dict
+0000a0d0: 5b69 6e74 2c20 416e 795d 207c 204e 6f6e  [int, Any] | Non
+0000a0e0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
+0000a0f0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+0000a100: 2020 2020 2020 6966 2064 6174 6120 6973        if data is
+0000a110: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000a120: 2020 2064 6174 6120 3d20 7b7d 0a20 2020     data = {}.   
+0000a130: 2020 2020 2065 6c69 6620 6e6f 7420 7574       elif not ut
+0000a140: 696c 732e 6973 5f64 6963 745f 6c69 6b65  ils.is_dict_like
+0000a150: 2864 6174 6129 3a0a 2020 2020 2020 2020  (data):.        
+0000a160: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000a170: 7272 6f72 2822 4461 7461 206d 7573 7420  rror("Data must 
+0000a180: 6265 2064 6963 742d 6c69 6b65 2229 0a0a  be dict-like")..
+0000a190: 2020 2020 2020 2020 6966 2064 6174 613a          if data:
+0000a1a0: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
+0000a1b0: 5f6b 6579 7320 3d20 7365 7428 7365 6c66  _keys = set(self
+0000a1c0: 2e64 6174 615f 7661 7273 2e6b 6579 7328  .data_vars.keys(
+0000a1d0: 2929 0a20 2020 2020 2020 2020 2020 2064  )).            d
+0000a1e0: 6174 615f 6b65 7973 203d 2073 6574 2864  ata_keys = set(d
+0000a1f0: 6174 612e 6b65 7973 2829 290a 2020 2020  ata.keys()).    
+0000a200: 2020 2020 2020 2020 6b65 7973 5f6e 6f74          keys_not
+0000a210: 5f69 6e5f 7661 7273 203d 2064 6174 615f  _in_vars = data_
+0000a220: 6b65 7973 202d 2076 6172 5f6b 6579 730a  keys - var_keys.
+0000a230: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+0000a240: 6579 735f 6e6f 745f 696e 5f76 6172 733a  eys_not_in_vars:
+0000a250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a260: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000a270: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000a280: 2020 2020 2020 2022 4461 7461 206d 7573         "Data mus
+0000a290: 7420 6f6e 6c79 2063 6f6e 7461 696e 2076  t only contain v
+0000a2a0: 6172 6961 626c 6573 2069 6e20 6f72 6967  ariables in orig
+0000a2b0: 696e 616c 2022 0a20 2020 2020 2020 2020  inal ".         
+0000a2c0: 2020 2020 2020 2020 2020 2022 6461 7461             "data
+0000a2d0: 7365 742e 2045 7874 7261 2076 6172 6961  set. Extra varia
+0000a2e0: 626c 6573 3a20 7b7d 222e 666f 726d 6174  bles: {}".format
+0000a2f0: 286b 6579 735f 6e6f 745f 696e 5f76 6172  (keys_not_in_var
+0000a300: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0000a310: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000a320: 206b 6579 735f 6d69 7373 696e 675f 6672   keys_missing_fr
+0000a330: 6f6d 5f64 6174 6120 3d20 7661 725f 6b65  om_data = var_ke
+0000a340: 7973 202d 2064 6174 615f 6b65 7973 0a20  ys - data_keys. 
+0000a350: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
+0000a360: 7973 5f6d 6973 7369 6e67 5f66 726f 6d5f  ys_missing_from_
+0000a370: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+0000a380: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0000a390: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0000a3a0: 2020 2020 2020 2020 2020 2020 2244 6174              "Dat
+0000a3b0: 6120 6d75 7374 2063 6f6e 7461 696e 2061  a must contain a
+0000a3c0: 6c6c 2076 6172 6961 626c 6573 2069 6e20  ll variables in 
+0000a3d0: 6f72 6967 696e 616c 2022 0a20 2020 2020  original ".     
+0000a3e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000a3f0: 6461 7461 7365 742e 2044 6174 6120 6973  dataset. Data is
+0000a400: 206d 6973 7369 6e67 207b 7d22 2e66 6f72   missing {}".for
+0000a410: 6d61 7428 6b65 7973 5f6d 6973 7369 6e67  mat(keys_missing
+0000a420: 5f66 726f 6d5f 6461 7461 290a 2020 2020  _from_data).    
+0000a430: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0000a440: 2020 2020 2020 2069 6e64 6578 6573 2c20         indexes, 
+0000a450: 696e 6465 785f 7661 7273 203d 2073 656c  index_vars = sel
+0000a460: 662e 7869 6e64 6578 6573 2e63 6f70 795f  f.xindexes.copy_
+0000a470: 696e 6465 7865 7328 6465 6570 3d64 6565  indexes(deep=dee
+0000a480: 7029 0a0a 2020 2020 2020 2020 7661 7269  p)..        vari
+0000a490: 6162 6c65 7320 3d20 7b7d 0a20 2020 2020  ables = {}.     
+0000a4a0: 2020 2066 6f72 206b 2c20 7620 696e 2073     for k, v in s
+0000a4b0: 656c 662e 5f76 6172 6961 626c 6573 2e69  elf._variables.i
+0000a4c0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+0000a4d0: 2020 2020 6966 206b 2069 6e20 696e 6465      if k in inde
+0000a4e0: 785f 7661 7273 3a0a 2020 2020 2020 2020  x_vars:.        
+0000a4f0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+0000a500: 735b 6b5d 203d 2069 6e64 6578 5f76 6172  s[k] = index_var
+0000a510: 735b 6b5d 0a20 2020 2020 2020 2020 2020  s[k].           
+0000a520: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000a530: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+0000a540: 5b6b 5d20 3d20 762e 5f63 6f70 7928 6465  [k] = v._copy(de
+0000a550: 6570 3d64 6565 702c 2064 6174 613d 6461  ep=deep, data=da
+0000a560: 7461 2e67 6574 286b 292c 206d 656d 6f3d  ta.get(k), memo=
+0000a570: 6d65 6d6f 290a 0a20 2020 2020 2020 2061  memo)..        a
+0000a580: 7474 7273 203d 2063 6f70 792e 6465 6570  ttrs = copy.deep
+0000a590: 636f 7079 2873 656c 662e 5f61 7474 7273  copy(self._attrs
+0000a5a0: 2c20 6d65 6d6f 2920 6966 2064 6565 7020  , memo) if deep 
+0000a5b0: 656c 7365 2063 6f70 792e 636f 7079 2873  else copy.copy(s
+0000a5c0: 656c 662e 5f61 7474 7273 290a 2020 2020  elf._attrs).    
+0000a5d0: 2020 2020 656e 636f 6469 6e67 203d 2028      encoding = (
+0000a5e0: 0a20 2020 2020 2020 2020 2020 2063 6f70  .            cop
+0000a5f0: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
+0000a600: 5f65 6e63 6f64 696e 672c 206d 656d 6f29  _encoding, memo)
+0000a610: 2069 6620 6465 6570 2065 6c73 6520 636f   if deep else co
+0000a620: 7079 2e63 6f70 7928 7365 6c66 2e5f 656e  py.copy(self._en
+0000a630: 636f 6469 6e67 290a 2020 2020 2020 2020  coding).        
+0000a640: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0000a650: 6e20 7365 6c66 2e5f 7265 706c 6163 6528  n self._replace(
+0000a660: 7661 7269 6162 6c65 732c 2069 6e64 6578  variables, index
+0000a670: 6573 3d69 6e64 6578 6573 2c20 6174 7472  es=indexes, attr
+0000a680: 733d 6174 7472 732c 2065 6e63 6f64 696e  s=attrs, encodin
+0000a690: 673d 656e 636f 6469 6e67 290a 0a20 2020  g=encoding)..   
+0000a6a0: 2064 6566 205f 5f63 6f70 795f 5f28 7365   def __copy__(se
+0000a6b0: 6c66 3a20 545f 4461 7461 7365 7429 202d  lf: T_Dataset) -
+0000a6c0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+0000a6d0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000a6e0: 2e5f 636f 7079 2864 6565 703d 4661 6c73  ._copy(deep=Fals
+0000a6f0: 6529 0a0a 2020 2020 6465 6620 5f5f 6465  e)..    def __de
+0000a700: 6570 636f 7079 5f5f 2873 656c 663a 2054  epcopy__(self: T
+0000a710: 5f44 6174 6173 6574 2c20 6d65 6d6f 3a20  _Dataset, memo: 
+0000a720: 6469 6374 5b69 6e74 2c20 416e 795d 207c  dict[int, Any] |
+0000a730: 204e 6f6e 6520 3d20 4e6f 6e65 2920 2d3e   None = None) ->
+0000a740: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
+0000a750: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000a760: 5f63 6f70 7928 6465 6570 3d54 7275 652c  _copy(deep=True,
+0000a770: 206d 656d 6f3d 6d65 6d6f 290a 0a20 2020   memo=memo)..   
+0000a780: 2064 6566 2061 735f 6e75 6d70 7928 7365   def as_numpy(se
+0000a790: 6c66 3a20 545f 4461 7461 7365 7429 202d  lf: T_Dataset) -
+0000a7a0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+0000a7b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000a7c0: 2043 6f65 7263 6573 2077 7261 7070 6564   Coerces wrapped
+0000a7d0: 2064 6174 6120 616e 6420 636f 6f72 6469   data and coordi
+0000a7e0: 6e61 7465 7320 696e 746f 206e 756d 7079  nates into numpy
+0000a7f0: 2061 7272 6179 732c 2072 6574 7572 6e69   arrays, returni
+0000a800: 6e67 2061 2044 6174 6173 6574 2e0a 0a20  ng a Dataset... 
+0000a810: 2020 2020 2020 2053 6565 2061 6c73 6f0a         See also.
+0000a820: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0000a830: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
+0000a840: 6179 2e61 735f 6e75 6d70 790a 2020 2020  ay.as_numpy.    
+0000a850: 2020 2020 4461 7461 4172 7261 792e 746f      DataArray.to
+0000a860: 5f6e 756d 7079 203a 2052 6574 7572 6e73  _numpy : Returns
+0000a870: 206f 6e6c 7920 7468 6520 6461 7461 2061   only the data a
+0000a880: 7320 6120 6e75 6d70 792e 6e64 6172 7261  s a numpy.ndarra
+0000a890: 7920 6f62 6a65 6374 2e0a 2020 2020 2020  y object..      
+0000a8a0: 2020 2222 220a 2020 2020 2020 2020 6e75    """.        nu
+0000a8b0: 6d70 795f 7661 7269 6162 6c65 7320 3d20  mpy_variables = 
+0000a8c0: 7b6b 3a20 762e 6173 5f6e 756d 7079 2829  {k: v.as_numpy()
+0000a8d0: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
+0000a8e0: 662e 7661 7269 6162 6c65 732e 6974 656d  f.variables.item
+0000a8f0: 7328 297d 0a20 2020 2020 2020 2072 6574  s()}.        ret
+0000a900: 7572 6e20 7365 6c66 2e5f 7265 706c 6163  urn self._replac
+0000a910: 6528 7661 7269 6162 6c65 733d 6e75 6d70  e(variables=nump
+0000a920: 795f 7661 7269 6162 6c65 7329 0a0a 2020  y_variables)..  
+0000a930: 2020 6465 6620 5f63 6f70 795f 6c69 7374    def _copy_list
+0000a940: 6564 2873 656c 663a 2054 5f44 6174 6173  ed(self: T_Datas
+0000a950: 6574 2c20 6e61 6d65 733a 2049 7465 7261  et, names: Itera
+0000a960: 626c 655b 4861 7368 6162 6c65 5d29 202d  ble[Hashable]) -
+0000a970: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+0000a980: 2020 2020 2022 2222 4372 6561 7465 2061       """Create a
+0000a990: 206e 6577 2044 6174 6173 6574 2077 6974   new Dataset wit
+0000a9a0: 6820 7468 6520 6c69 7374 6564 2076 6172  h the listed var
+0000a9b0: 6961 626c 6573 2066 726f 6d20 7468 6973  iables from this
+0000a9c0: 2064 6174 6173 6574 2061 6e64 0a20 2020   dataset and.   
+0000a9d0: 2020 2020 2074 6865 2061 6c6c 2072 656c       the all rel
+0000a9e0: 6576 616e 7420 636f 6f72 6469 6e61 7465  evant coordinate
+0000a9f0: 732e 2053 6b69 7073 2061 6c6c 2076 616c  s. Skips all val
+0000aa00: 6964 6174 696f 6e2e 0a20 2020 2020 2020  idation..       
+0000aa10: 2022 2222 0a20 2020 2020 2020 2076 6172   """.        var
+0000aa20: 6961 626c 6573 3a20 6469 6374 5b48 6173  iables: dict[Has
+0000aa30: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
+0000aa40: 203d 207b 7d0a 2020 2020 2020 2020 636f   = {}.        co
+0000aa50: 6f72 645f 6e61 6d65 7320 3d20 7365 7428  ord_names = set(
+0000aa60: 290a 2020 2020 2020 2020 696e 6465 7865  ).        indexe
+0000aa70: 733a 2064 6963 745b 4861 7368 6162 6c65  s: dict[Hashable
+0000aa80: 2c20 496e 6465 785d 203d 207b 7d0a 0a20  , Index] = {}.. 
+0000aa90: 2020 2020 2020 2066 6f72 206e 616d 6520         for name 
+0000aaa0: 696e 206e 616d 6573 3a0a 2020 2020 2020  in names:.      
+0000aab0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000aac0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+0000aad0: 626c 6573 5b6e 616d 655d 203d 2073 656c  bles[name] = sel
+0000aae0: 662e 5f76 6172 6961 626c 6573 5b6e 616d  f._variables[nam
+0000aaf0: 655d 0a20 2020 2020 2020 2020 2020 2065  e].            e
+0000ab00: 7863 6570 7420 4b65 7945 7272 6f72 3a0a  xcept KeyError:.
+0000ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab20: 7265 665f 6e61 6d65 2c20 7661 725f 6e61  ref_name, var_na
+0000ab30: 6d65 2c20 7661 7220 3d20 5f67 6574 5f76  me, var = _get_v
+0000ab40: 6972 7475 616c 5f76 6172 6961 626c 6528  irtual_variable(
+0000ab50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ab60: 2020 2020 2073 656c 662e 5f76 6172 6961       self._varia
+0000ab70: 626c 6573 2c20 6e61 6d65 2c20 7365 6c66  bles, name, self
+0000ab80: 2e64 696d 730a 2020 2020 2020 2020 2020  .dims.          
+0000ab90: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000aba0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+0000abb0: 735b 7661 725f 6e61 6d65 5d20 3d20 7661  s[var_name] = va
+0000abc0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+0000abd0: 2020 6966 2072 6566 5f6e 616d 6520 696e    if ref_name in
+0000abe0: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
+0000abf0: 6573 206f 7220 7265 665f 6e61 6d65 2069  es or ref_name i
+0000ac00: 6e20 7365 6c66 2e64 696d 733a 0a20 2020  n self.dims:.   
+0000ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac20: 2063 6f6f 7264 5f6e 616d 6573 2e61 6464   coord_names.add
+0000ac30: 2876 6172 5f6e 616d 6529 0a20 2020 2020  (var_name).     
+0000ac40: 2020 2020 2020 2020 2020 2069 6620 2876             if (v
+0000ac50: 6172 5f6e 616d 652c 2920 3d3d 2076 6172  ar_name,) == var
+0000ac60: 2e64 696d 733a 0a20 2020 2020 2020 2020  .dims:.         
+0000ac70: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+0000ac80: 2c20 696e 6465 785f 7661 7273 203d 2063  , index_vars = c
+0000ac90: 7265 6174 655f 6465 6661 756c 745f 696e  reate_default_in
+0000aca0: 6465 785f 696d 706c 6963 6974 2876 6172  dex_implicit(var
+0000acb0: 2c20 6e61 6d65 7329 0a20 2020 2020 2020  , names).       
+0000acc0: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+0000acd0: 6578 6573 2e75 7064 6174 6528 7b6b 3a20  exes.update({k: 
+0000ace0: 696e 6465 7820 666f 7220 6b20 696e 2069  index for k in i
+0000acf0: 6e64 6578 5f76 6172 737d 290a 2020 2020  ndex_vars}).    
+0000ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad10: 7661 7269 6162 6c65 732e 7570 6461 7465  variables.update
+0000ad20: 2869 6e64 6578 5f76 6172 7329 0a20 2020  (index_vars).   
+0000ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad40: 2063 6f6f 7264 5f6e 616d 6573 2e75 7064   coord_names.upd
+0000ad50: 6174 6528 696e 6465 785f 7661 7273 290a  ate(index_vars).
+0000ad60: 0a20 2020 2020 2020 206e 6565 6465 645f  .        needed_
+0000ad70: 6469 6d73 3a20 4f72 6465 7265 6453 6574  dims: OrderedSet
+0000ad80: 5b48 6173 6861 626c 655d 203d 204f 7264  [Hashable] = Ord
+0000ad90: 6572 6564 5365 7428 290a 2020 2020 2020  eredSet().      
+0000ada0: 2020 666f 7220 7620 696e 2076 6172 6961    for v in varia
+0000adb0: 626c 6573 2e76 616c 7565 7328 293a 0a20  bles.values():. 
+0000adc0: 2020 2020 2020 2020 2020 206e 6565 6465             neede
+0000add0: 645f 6469 6d73 2e75 7064 6174 6528 762e  d_dims.update(v.
+0000ade0: 6469 6d73 290a 0a20 2020 2020 2020 2064  dims)..        d
+0000adf0: 696d 7320 3d20 7b6b 3a20 7365 6c66 2e64  ims = {k: self.d
+0000ae00: 696d 735b 6b5d 2066 6f72 206b 2069 6e20  ims[k] for k in 
+0000ae10: 6e65 6564 6564 5f64 696d 737d 0a0a 2020  needed_dims}..  
+0000ae20: 2020 2020 2020 2320 7072 6573 6572 7665        # preserve
+0000ae30: 7320 6f72 6465 7269 6e67 206f 6620 636f  s ordering of co
+0000ae40: 6f72 6469 6e61 7465 730a 2020 2020 2020  ordinates.      
+0000ae50: 2020 666f 7220 6b20 696e 2073 656c 662e    for k in self.
+0000ae60: 5f76 6172 6961 626c 6573 3a0a 2020 2020  _variables:.    
+0000ae70: 2020 2020 2020 2020 6966 206b 206e 6f74          if k not
+0000ae80: 2069 6e20 7365 6c66 2e5f 636f 6f72 645f   in self._coord_
+0000ae90: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
+0000aea0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0000aeb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000aec0: 7365 7428 7365 6c66 2e76 6172 6961 626c  set(self.variabl
+0000aed0: 6573 5b6b 5d2e 6469 6d73 2920 3c3d 206e  es[k].dims) <= n
+0000aee0: 6565 6465 645f 6469 6d73 3a0a 2020 2020  eeded_dims:.    
+0000aef0: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+0000af00: 6162 6c65 735b 6b5d 203d 2073 656c 662e  ables[k] = self.
+0000af10: 5f76 6172 6961 626c 6573 5b6b 5d0a 2020  _variables[k].  
+0000af20: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000af30: 6f72 645f 6e61 6d65 732e 6164 6428 6b29  ord_names.add(k)
+0000af40: 0a0a 2020 2020 2020 2020 696e 6465 7865  ..        indexe
+0000af50: 732e 7570 6461 7465 2866 696c 7465 725f  s.update(filter_
+0000af60: 696e 6465 7865 735f 6672 6f6d 5f63 6f6f  indexes_from_coo
+0000af70: 7264 7328 7365 6c66 2e5f 696e 6465 7865  rds(self._indexe
+0000af80: 732c 2063 6f6f 7264 5f6e 616d 6573 2929  s, coord_names))
+0000af90: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000afa0: 2073 656c 662e 5f72 6570 6c61 6365 2876   self._replace(v
+0000afb0: 6172 6961 626c 6573 2c20 636f 6f72 645f  ariables, coord_
+0000afc0: 6e61 6d65 732c 2064 696d 732c 2069 6e64  names, dims, ind
+0000afd0: 6578 6573 3d69 6e64 6578 6573 290a 0a20  exes=indexes).. 
+0000afe0: 2020 2064 6566 205f 636f 6e73 7472 7563     def _construc
+0000aff0: 745f 6461 7461 6172 7261 7928 7365 6c66  t_dataarray(self
+0000b000: 2c20 6e61 6d65 3a20 4861 7368 6162 6c65  , name: Hashable
+0000b010: 2920 2d3e 2044 6174 6141 7272 6179 3a0a  ) -> DataArray:.
+0000b020: 2020 2020 2020 2020 2222 2243 6f6e 7374          """Const
+0000b030: 7275 6374 2061 2044 6174 6141 7272 6179  ruct a DataArray
+0000b040: 2062 7920 696e 6465 7869 6e67 2074 6869   by indexing thi
+0000b050: 7320 6461 7461 7365 7422 2222 0a20 2020  s dataset""".   
+0000b060: 2020 2020 2066 726f 6d20 7861 7272 6179       from xarray
+0000b070: 2e63 6f72 652e 6461 7461 6172 7261 7920  .core.dataarray 
+0000b080: 696d 706f 7274 2044 6174 6141 7272 6179  import DataArray
+0000b090: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+0000b0a0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+0000b0b0: 626c 6520 3d20 7365 6c66 2e5f 7661 7269  ble = self._vari
+0000b0c0: 6162 6c65 735b 6e61 6d65 5d0a 2020 2020  ables[name].    
+0000b0d0: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+0000b0e0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+0000b0f0: 205f 2c20 6e61 6d65 2c20 7661 7269 6162   _, name, variab
+0000b100: 6c65 203d 205f 6765 745f 7669 7274 7561  le = _get_virtua
+0000b110: 6c5f 7661 7269 6162 6c65 2873 656c 662e  l_variable(self.
+0000b120: 5f76 6172 6961 626c 6573 2c20 6e61 6d65  _variables, name
+0000b130: 2c20 7365 6c66 2e64 696d 7329 0a0a 2020  , self.dims)..  
+0000b140: 2020 2020 2020 6e65 6564 6564 5f64 696d        needed_dim
+0000b150: 7320 3d20 7365 7428 7661 7269 6162 6c65  s = set(variable
+0000b160: 2e64 696d 7329 0a0a 2020 2020 2020 2020  .dims)..        
+0000b170: 636f 6f72 6473 3a20 6469 6374 5b48 6173  coords: dict[Has
+0000b180: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
+0000b190: 203d 207b 7d0a 2020 2020 2020 2020 2320   = {}.        # 
+0000b1a0: 7072 6573 6572 7665 206f 7264 6572 696e  preserve orderin
+0000b1b0: 670a 2020 2020 2020 2020 666f 7220 6b20  g.        for k 
+0000b1c0: 696e 2073 656c 662e 5f76 6172 6961 626c  in self._variabl
+0000b1d0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0000b1e0: 6966 206b 2069 6e20 7365 6c66 2e5f 636f  if k in self._co
+0000b1f0: 6f72 645f 6e61 6d65 7320 616e 6420 7365  ord_names and se
+0000b200: 7428 7365 6c66 2e76 6172 6961 626c 6573  t(self.variables
+0000b210: 5b6b 5d2e 6469 6d73 2920 3c3d 206e 6565  [k].dims) <= nee
+0000b220: 6465 645f 6469 6d73 3a0a 2020 2020 2020  ded_dims:.      
+0000b230: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
+0000b240: 5b6b 5d20 3d20 7365 6c66 2e76 6172 6961  [k] = self.varia
+0000b250: 626c 6573 5b6b 5d0a 0a20 2020 2020 2020  bles[k]..       
+0000b260: 2069 6e64 6578 6573 203d 2066 696c 7465   indexes = filte
+0000b270: 725f 696e 6465 7865 735f 6672 6f6d 5f63  r_indexes_from_c
+0000b280: 6f6f 7264 7328 7365 6c66 2e5f 696e 6465  oords(self._inde
+0000b290: 7865 732c 2073 6574 2863 6f6f 7264 7329  xes, set(coords)
+0000b2a0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0000b2b0: 6e20 4461 7461 4172 7261 7928 7661 7269  n DataArray(vari
+0000b2c0: 6162 6c65 2c20 636f 6f72 6473 2c20 6e61  able, coords, na
+0000b2d0: 6d65 3d6e 616d 652c 2069 6e64 6578 6573  me=name, indexes
+0000b2e0: 3d69 6e64 6578 6573 2c20 6661 7374 7061  =indexes, fastpa
+0000b2f0: 7468 3d54 7275 6529 0a0a 2020 2020 4070  th=True)..    @p
+0000b300: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+0000b310: 5f61 7474 725f 736f 7572 6365 7328 7365  _attr_sources(se
+0000b320: 6c66 2920 2d3e 2049 7465 7261 626c 655b  lf) -> Iterable[
+0000b330: 4d61 7070 696e 675b 4861 7368 6162 6c65  Mapping[Hashable
+0000b340: 2c20 416e 795d 5d3a 0a20 2020 2020 2020  , Any]]:.       
+0000b350: 2022 2222 506c 6163 6573 2074 6f20 6c6f   """Places to lo
+0000b360: 6f6b 2d75 7020 6974 656d 7320 666f 7220  ok-up items for 
+0000b370: 6174 7472 6962 7574 652d 7374 796c 6520  attribute-style 
+0000b380: 6163 6365 7373 2222 220a 2020 2020 2020  access""".      
+0000b390: 2020 7969 656c 6420 6672 6f6d 2073 656c    yield from sel
+0000b3a0: 662e 5f69 7465 6d5f 736f 7572 6365 730a  f._item_sources.
+0000b3b0: 2020 2020 2020 2020 7969 656c 6420 7365          yield se
+0000b3c0: 6c66 2e61 7474 7273 0a0a 2020 2020 4070  lf.attrs..    @p
+0000b3d0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+0000b3e0: 5f69 7465 6d5f 736f 7572 6365 7328 7365  _item_sources(se
+0000b3f0: 6c66 2920 2d3e 2049 7465 7261 626c 655b  lf) -> Iterable[
+0000b400: 4d61 7070 696e 675b 4861 7368 6162 6c65  Mapping[Hashable
+0000b410: 2c20 416e 795d 5d3a 0a20 2020 2020 2020  , Any]]:.       
+0000b420: 2022 2222 506c 6163 6573 2074 6f20 6c6f   """Places to lo
+0000b430: 6f6b 2d75 7020 6974 656d 7320 666f 7220  ok-up items for 
+0000b440: 6b65 792d 636f 6d70 6c65 7469 6f6e 2222  key-completion""
+0000b450: 220a 2020 2020 2020 2020 7969 656c 6420  ".        yield 
+0000b460: 7365 6c66 2e64 6174 615f 7661 7273 0a20  self.data_vars. 
+0000b470: 2020 2020 2020 2079 6965 6c64 2048 7962         yield Hyb
+0000b480: 7269 644d 6170 7069 6e67 5072 6f78 7928  ridMappingProxy(
+0000b490: 6b65 7973 3d73 656c 662e 5f63 6f6f 7264  keys=self._coord
+0000b4a0: 5f6e 616d 6573 2c20 6d61 7070 696e 673d  _names, mapping=
+0000b4b0: 7365 6c66 2e63 6f6f 7264 7329 0a0a 2020  self.coords)..  
+0000b4c0: 2020 2020 2020 2320 7669 7274 7561 6c20        # virtual 
+0000b4d0: 636f 6f72 6469 6e61 7465 730a 2020 2020  coordinates.    
+0000b4e0: 2020 2020 7969 656c 6420 4879 6272 6964      yield Hybrid
+0000b4f0: 4d61 7070 696e 6750 726f 7879 286b 6579  MappingProxy(key
+0000b500: 733d 7365 6c66 2e64 696d 732c 206d 6170  s=self.dims, map
+0000b510: 7069 6e67 3d73 656c 6629 0a0a 2020 2020  ping=self)..    
+0000b520: 6465 6620 5f5f 636f 6e74 6169 6e73 5f5f  def __contains__
+0000b530: 2873 656c 662c 206b 6579 3a20 6f62 6a65  (self, key: obje
+0000b540: 6374 2920 2d3e 2062 6f6f 6c3a 0a20 2020  ct) -> bool:.   
+0000b550: 2020 2020 2022 2222 5468 6520 2769 6e27       """The 'in'
+0000b560: 206f 7065 7261 746f 7220 7769 6c6c 2072   operator will r
+0000b570: 6574 7572 6e20 7472 7565 206f 7220 6661  eturn true or fa
+0000b580: 6c73 6520 6465 7065 6e64 696e 6720 6f6e  lse depending on
+0000b590: 2077 6865 7468 6572 0a20 2020 2020 2020   whether.       
+0000b5a0: 2027 6b65 7927 2069 7320 616e 2061 7272   'key' is an arr
+0000b5b0: 6179 2069 6e20 7468 6520 6461 7461 7365  ay in the datase
+0000b5c0: 7420 6f72 206e 6f74 2e0a 2020 2020 2020  t or not..      
+0000b5d0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+0000b5e0: 7475 726e 206b 6579 2069 6e20 7365 6c66  turn key in self
+0000b5f0: 2e5f 7661 7269 6162 6c65 730a 0a20 2020  ._variables..   
+0000b600: 2064 6566 205f 5f6c 656e 5f5f 2873 656c   def __len__(sel
+0000b610: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
+0000b620: 2020 2072 6574 7572 6e20 6c65 6e28 7365     return len(se
+0000b630: 6c66 2e64 6174 615f 7661 7273 290a 0a20  lf.data_vars).. 
+0000b640: 2020 2064 6566 205f 5f62 6f6f 6c5f 5f28     def __bool__(
+0000b650: 7365 6c66 2920 2d3e 2062 6f6f 6c3a 0a20  self) -> bool:. 
+0000b660: 2020 2020 2020 2072 6574 7572 6e20 626f         return bo
+0000b670: 6f6c 2873 656c 662e 6461 7461 5f76 6172  ol(self.data_var
+0000b680: 7329 0a0a 2020 2020 6465 6620 5f5f 6974  s)..    def __it
+0000b690: 6572 5f5f 2873 656c 6629 202d 3e20 4974  er__(self) -> It
+0000b6a0: 6572 6174 6f72 5b48 6173 6861 626c 655d  erator[Hashable]
+0000b6b0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000b6c0: 2069 7465 7228 7365 6c66 2e64 6174 615f   iter(self.data_
+0000b6d0: 7661 7273 290a 0a20 2020 2064 6566 205f  vars)..    def _
+0000b6e0: 5f61 7272 6179 5f5f 2873 656c 662c 2064  _array__(self, d
+0000b6f0: 7479 7065 3d4e 6f6e 6529 3a0a 2020 2020  type=None):.    
+0000b700: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+0000b710: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000b720: 2022 6361 6e6e 6f74 2064 6972 6563 746c   "cannot directl
+0000b730: 7920 636f 6e76 6572 7420 616e 2078 6172  y convert an xar
+0000b740: 7261 792e 4461 7461 7365 7420 696e 746f  ray.Dataset into
+0000b750: 2061 2022 0a20 2020 2020 2020 2020 2020   a ".           
+0000b760: 2022 6e75 6d70 7920 6172 7261 792e 2049   "numpy array. I
+0000b770: 6e73 7465 6164 2c20 6372 6561 7465 2061  nstead, create a
+0000b780: 6e20 7861 7272 6179 2e44 6174 6141 7272  n xarray.DataArr
+0000b790: 6179 2022 0a20 2020 2020 2020 2020 2020  ay ".           
+0000b7a0: 2022 6669 7273 742c 2065 6974 6865 7220   "first, either 
+0000b7b0: 7769 7468 2069 6e64 6578 696e 6720 6f6e  with indexing on
+0000b7c0: 2074 6865 2044 6174 6173 6574 206f 7220   the Dataset or 
+0000b7d0: 6279 2022 0a20 2020 2020 2020 2020 2020  by ".           
+0000b7e0: 2022 696e 766f 6b69 6e67 2074 6865 2060   "invoking the `
+0000b7f0: 746f 5f61 7272 6179 2829 6020 6d65 7468  to_array()` meth
+0000b800: 6f64 2e22 0a20 2020 2020 2020 2029 0a0a  od.".        )..
+0000b810: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+0000b820: 2020 6465 6620 6e62 7974 6573 2873 656c    def nbytes(sel
+0000b830: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
+0000b840: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+0000b850: 6f74 616c 2062 7974 6573 2063 6f6e 7375  otal bytes consu
+0000b860: 6d65 6420 6279 2074 6865 2064 6174 6120  med by the data 
+0000b870: 6172 7261 7973 206f 6620 616c 6c20 7661  arrays of all va
+0000b880: 7269 6162 6c65 7320 696e 2074 6869 7320  riables in this 
+0000b890: 6461 7461 7365 742e 0a0a 2020 2020 2020  dataset...      
+0000b8a0: 2020 4966 2074 6865 2062 6163 6b65 6e64    If the backend
+0000b8b0: 2061 7272 6179 2066 6f72 2061 6e79 2076   array for any v
+0000b8c0: 6172 6961 626c 6520 646f 6573 206e 6f74  ariable does not
+0000b8d0: 2069 6e63 6c75 6465 2060 606e 6279 7465   include ``nbyte
+0000b8e0: 7360 602c 2065 7374 696d 6174 6573 0a20  s``, estimates. 
+0000b8f0: 2020 2020 2020 2074 6865 2074 6f74 616c         the total
+0000b900: 2062 7974 6573 2066 6f72 2074 6861 7420   bytes for that 
+0000b910: 6172 7261 7920 6261 7365 6420 6f6e 2074  array based on t
+0000b920: 6865 2060 6073 697a 6560 6020 616e 6420  he ``size`` and 
+0000b930: 6060 6474 7970 6560 602e 0a20 2020 2020  ``dtype``..     
+0000b940: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+0000b950: 6574 7572 6e20 7375 6d28 762e 6e62 7974  eturn sum(v.nbyt
+0000b960: 6573 2066 6f72 2076 2069 6e20 7365 6c66  es for v in self
+0000b970: 2e76 6172 6961 626c 6573 2e76 616c 7565  .variables.value
+0000b980: 7328 2929 0a0a 2020 2020 4070 726f 7065  s())..    @prope
+0000b990: 7274 790a 2020 2020 6465 6620 6c6f 6328  rty.    def loc(
+0000b9a0: 7365 6c66 3a20 545f 4461 7461 7365 7429  self: T_Dataset)
+0000b9b0: 202d 3e20 5f4c 6f63 496e 6465 7865 725b   -> _LocIndexer[
+0000b9c0: 545f 4461 7461 7365 745d 3a0a 2020 2020  T_Dataset]:.    
+0000b9d0: 2020 2020 2222 2241 7474 7269 6275 7465      """Attribute
+0000b9e0: 2066 6f72 206c 6f63 6174 696f 6e20 6261   for location ba
+0000b9f0: 7365 6420 696e 6465 7869 6e67 2e20 4f6e  sed indexing. On
+0000ba00: 6c79 2073 7570 706f 7274 7320 5f5f 6765  ly supports __ge
+0000ba10: 7469 7465 6d5f 5f2c 0a20 2020 2020 2020  titem__,.       
+0000ba20: 2061 6e64 206f 6e6c 7920 7768 656e 2074   and only when t
+0000ba30: 6865 206b 6579 2069 7320 6120 6469 6374  he key is a dict
+0000ba40: 206f 6620 7468 6520 666f 726d 207b 6469   of the form {di
+0000ba50: 6d3a 206c 6162 656c 737d 2e0a 2020 2020  m: labels}..    
+0000ba60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000ba70: 7265 7475 726e 205f 4c6f 6349 6e64 6578  return _LocIndex
+0000ba80: 6572 2873 656c 6629 0a0a 2020 2020 406f  er(self)..    @o
+0000ba90: 7665 726c 6f61 640a 2020 2020 6465 6620  verload.    def 
+0000baa0: 5f5f 6765 7469 7465 6d5f 5f28 7365 6c66  __getitem__(self
+0000bab0: 2c20 6b65 793a 2048 6173 6861 626c 6529  , key: Hashable)
+0000bac0: 202d 3e20 4461 7461 4172 7261 793a 0a20   -> DataArray:. 
+0000bad0: 2020 2020 2020 202e 2e2e 0a0a 2020 2020         .....    
+0000bae0: 2320 4d61 7070 696e 6720 6973 2049 7465  # Mapping is Ite
+0000baf0: 7261 626c 650a 2020 2020 406f 7665 726c  rable.    @overl
+0000bb00: 6f61 640a 2020 2020 6465 6620 5f5f 6765  oad.    def __ge
+0000bb10: 7469 7465 6d5f 5f28 7365 6c66 3a20 545f  titem__(self: T_
+0000bb20: 4461 7461 7365 742c 206b 6579 3a20 4974  Dataset, key: It
+0000bb30: 6572 6162 6c65 5b48 6173 6861 626c 655d  erable[Hashable]
+0000bb40: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+0000bb50: 2020 2020 2020 2020 2e2e 2e0a 0a20 2020          .....   
+0000bb60: 2064 6566 205f 5f67 6574 6974 656d 5f5f   def __getitem__
+0000bb70: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
+0000bb80: 545f 4461 7461 7365 742c 206b 6579 3a20  T_Dataset, key: 
+0000bb90: 4d61 7070 696e 675b 416e 792c 2041 6e79  Mapping[Any, Any
+0000bba0: 5d20 7c20 4861 7368 6162 6c65 207c 2049  ] | Hashable | I
+0000bbb0: 7465 7261 626c 655b 4861 7368 6162 6c65  terable[Hashable
+0000bbc0: 5d0a 2020 2020 2920 2d3e 2054 5f44 6174  ].    ) -> T_Dat
+0000bbd0: 6173 6574 207c 2044 6174 6141 7272 6179  aset | DataArray
+0000bbe0: 3a0a 2020 2020 2020 2020 2222 2241 6363  :.        """Acc
+0000bbf0: 6573 7320 7661 7269 6162 6c65 7320 6f72  ess variables or
+0000bc00: 2063 6f6f 7264 696e 6174 6573 206f 6620   coordinates of 
+0000bc10: 7468 6973 2064 6174 6173 6574 2061 7320  this dataset as 
+0000bc20: 610a 2020 2020 2020 2020 3a70 793a 636c  a.        :py:cl
+0000bc30: 6173 733a 607e 7861 7272 6179 2e44 6174  ass:`~xarray.Dat
+0000bc40: 6141 7272 6179 6020 6f72 2061 2073 7562  aArray` or a sub
+0000bc50: 7365 7420 6f66 2076 6172 6961 626c 6573  set of variables
+0000bc60: 206f 7220 6120 696e 6465 7865 6420 6461   or a indexed da
+0000bc70: 7461 7365 742e 0a0a 2020 2020 2020 2020  taset...        
+0000bc80: 496e 6465 7869 6e67 2077 6974 6820 6120  Indexing with a 
+0000bc90: 6c69 7374 206f 6620 6e61 6d65 7320 7769  list of names wi
+0000bca0: 6c6c 2072 6574 7572 6e20 6120 6e65 7720  ll return a new 
+0000bcb0: 6060 4461 7461 7365 7460 6020 6f62 6a65  ``Dataset`` obje
+0000bcc0: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
+0000bcd0: 2020 2020 2020 2020 6966 2075 7469 6c73          if utils
+0000bce0: 2e69 735f 6469 6374 5f6c 696b 6528 6b65  .is_dict_like(ke
+0000bcf0: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
+0000bd00: 7265 7475 726e 2073 656c 662e 6973 656c  return self.isel
+0000bd10: 282a 2a6b 6579 290a 2020 2020 2020 2020  (**key).        
+0000bd20: 6966 2075 7469 6c73 2e68 6173 6861 626c  if utils.hashabl
+0000bd30: 6528 6b65 7929 3a0a 2020 2020 2020 2020  e(key):.        
+0000bd40: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000bd50: 5f63 6f6e 7374 7275 6374 5f64 6174 6161  _construct_dataa
+0000bd60: 7272 6179 286b 6579 290a 2020 2020 2020  rray(key).      
+0000bd70: 2020 6966 2075 7469 6c73 2e69 7465 7261    if utils.itera
+0000bd80: 626c 655f 6f66 5f68 6173 6861 626c 6528  ble_of_hashable(
+0000bd90: 6b65 7929 3a0a 2020 2020 2020 2020 2020  key):.          
+0000bda0: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
+0000bdb0: 6f70 795f 6c69 7374 6564 286b 6579 290a  opy_listed(key).
+0000bdc0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000bdd0: 6c75 6545 7272 6f72 2866 2255 6e73 7570  lueError(f"Unsup
+0000bde0: 706f 7274 6564 206b 6579 2d74 7970 6520  ported key-type 
+0000bdf0: 7b74 7970 6528 6b65 7929 7d22 290a 0a20  {type(key)}").. 
+0000be00: 2020 2064 6566 205f 5f73 6574 6974 656d     def __setitem
+0000be10: 5f5f 280a 2020 2020 2020 2020 7365 6c66  __(.        self
+0000be20: 2c20 6b65 793a 2048 6173 6861 626c 6520  , key: Hashable 
+0000be30: 7c20 4974 6572 6162 6c65 5b48 6173 6861  | Iterable[Hasha
+0000be40: 626c 655d 207c 204d 6170 7069 6e67 2c20  ble] | Mapping, 
+0000be50: 7661 6c75 653a 2041 6e79 0a20 2020 2029  value: Any.    )
+0000be60: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000be70: 2020 2222 2241 6464 2061 6e20 6172 7261    """Add an arra
+0000be80: 7920 746f 2074 6869 7320 6461 7461 7365  y to this datase
+0000be90: 742e 0a20 2020 2020 2020 204d 756c 7469  t..        Multi
+0000bea0: 706c 6520 6172 7261 7973 2063 616e 2062  ple arrays can b
+0000beb0: 6520 6164 6465 6420 6174 2074 6865 2073  e added at the s
+0000bec0: 616d 6520 7469 6d65 2c20 696e 2077 6869  ame time, in whi
+0000bed0: 6368 2063 6173 6520 6561 6368 206f 660a  ch case each of.
+0000bee0: 2020 2020 2020 2020 7468 6520 666f 6c6c          the foll
+0000bef0: 6f77 696e 6720 6f70 6572 6174 696f 6e73  owing operations
+0000bf00: 2069 7320 6170 706c 6965 6420 746f 2074   is applied to t
+0000bf10: 6865 2072 6573 7065 6374 6976 6520 7661  he respective va
+0000bf20: 6c75 652e 0a0a 2020 2020 2020 2020 4966  lue...        If
+0000bf30: 206b 6579 2069 7320 6469 6374 2d6c 696b   key is dict-lik
+0000bf40: 652c 2075 7064 6174 6520 616c 6c20 7661  e, update all va
+0000bf50: 7269 6162 6c65 7320 696e 2074 6865 2064  riables in the d
+0000bf60: 6174 6173 6574 0a20 2020 2020 2020 206f  ataset.        o
+0000bf70: 6e65 2062 7920 6f6e 6520 7769 7468 2074  ne by one with t
+0000bf80: 6865 2067 6976 656e 2076 616c 7565 2061  he given value a
+0000bf90: 7420 7468 6520 6769 7665 6e20 6c6f 6361  t the given loca
+0000bfa0: 7469 6f6e 2e0a 2020 2020 2020 2020 4966  tion..        If
+0000bfb0: 2074 6865 2067 6976 656e 2076 616c 7565   the given value
+0000bfc0: 2069 7320 616c 736f 2061 2064 6174 6173   is also a datas
+0000bfd0: 6574 2c20 7365 6c65 6374 2063 6f72 7265  et, select corre
+0000bfe0: 7370 6f6e 6469 6e67 2076 6172 6961 626c  sponding variabl
+0000bff0: 6573 0a20 2020 2020 2020 2069 6e20 7468  es.        in th
+0000c000: 6520 6769 7665 6e20 7661 6c75 6520 616e  e given value an
+0000c010: 6420 696e 2074 6865 2064 6174 6173 6574  d in the dataset
+0000c020: 2074 6f20 6265 2063 6861 6e67 6564 2e0a   to be changed..
+0000c030: 0a20 2020 2020 2020 2049 6620 7661 6c75  .        If valu
+0000c040: 6520 6973 2061 2060 0a20 2020 2020 2020  e is a `.       
+0000c050: 2066 726f 6d20 2e64 6174 6161 7272 6179   from .dataarray
+0000c060: 2069 6d70 6f72 7420 4461 7461 4172 7261   import DataArra
+0000c070: 7960 2c20 6361 6c6c 2069 7473 2060 7365  y`, call its `se
+0000c080: 6c65 6374 5f76 6172 7328 2960 206d 6574  lect_vars()` met
+0000c090: 686f 642c 2072 656e 616d 6520 6974 0a20  hod, rename it. 
+0000c0a0: 2020 2020 2020 2074 6f20 606b 6579 6020         to `key` 
+0000c0b0: 616e 6420 6d65 7267 6520 7468 6520 636f  and merge the co
+0000c0c0: 6e74 656e 7473 206f 6620 7468 6520 7265  ntents of the re
+0000c0d0: 7375 6c74 696e 6720 6461 7461 7365 7420  sulting dataset 
+0000c0e0: 696e 746f 2074 6869 730a 2020 2020 2020  into this.      
+0000c0f0: 2020 6461 7461 7365 742e 0a0a 2020 2020    dataset...    
+0000c100: 2020 2020 4966 2076 616c 7565 2069 7320      If value is 
+0000c110: 6120 6056 6172 6961 626c 6560 206f 626a  a `Variable` obj
+0000c120: 6563 7420 286f 7220 7475 706c 6520 6f66  ect (or tuple of
+0000c130: 2066 6f72 6d0a 2020 2020 2020 2020 6060   form.        ``
+0000c140: 2864 696d 732c 2064 6174 615b 2c20 6174  (dims, data[, at
+0000c150: 7472 735d 2960 6029 2c20 6164 6420 6974  trs])``), add it
+0000c160: 2074 6f20 7468 6973 2064 6174 6173 6574   to this dataset
+0000c170: 2061 7320 6120 6e65 770a 2020 2020 2020   as a new.      
+0000c180: 2020 7661 7269 6162 6c65 2e0a 2020 2020    variable..    
+0000c190: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000c1a0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
+0000c1b0: 2e64 6174 6161 7272 6179 2069 6d70 6f72  .dataarray impor
+0000c1c0: 7420 4461 7461 4172 7261 790a 0a20 2020  t DataArray..   
+0000c1d0: 2020 2020 2069 6620 7574 696c 732e 6973       if utils.is
+0000c1e0: 5f64 6963 745f 6c69 6b65 286b 6579 293a  _dict_like(key):
+0000c1f0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
+0000c200: 6865 636b 2066 6f72 2063 6f6e 7369 7374  heck for consist
+0000c210: 656e 6379 2061 6e64 2063 6f6e 7665 7274  ency and convert
+0000c220: 2076 616c 7565 2074 6f20 6461 7461 7365   value to datase
+0000c230: 740a 2020 2020 2020 2020 2020 2020 7661  t.            va
+0000c240: 6c75 6520 3d20 7365 6c66 2e5f 7365 7469  lue = self._seti
+0000c250: 7465 6d5f 6368 6563 6b28 6b65 792c 2076  tem_check(key, v
+0000c260: 616c 7565 290a 2020 2020 2020 2020 2020  alue).          
+0000c270: 2020 2320 6c6f 6f70 206f 7665 7220 6461    # loop over da
+0000c280: 7461 7365 7420 7661 7269 6162 6c65 7320  taset variables 
+0000c290: 616e 6420 7365 7420 6e65 7720 7661 6c75  and set new valu
+0000c2a0: 6573 0a20 2020 2020 2020 2020 2020 2070  es.            p
+0000c2b0: 726f 6365 7373 6564 203d 205b 5d0a 2020  rocessed = [].  
+0000c2c0: 2020 2020 2020 2020 2020 666f 7220 6e61            for na
+0000c2d0: 6d65 2c20 7661 7220 696e 2073 656c 662e  me, var in self.
+0000c2e0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0000c2f0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0000c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c310: 2020 7661 725b 6b65 795d 203d 2076 616c    var[key] = val
+0000c320: 7565 5b6e 616d 655d 0a20 2020 2020 2020  ue[name].       
+0000c330: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+0000c340: 6365 7373 6564 2e61 7070 656e 6428 6e61  cessed.append(na
+0000c350: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+0000c360: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+0000c370: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+0000c380: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000c390: 6620 7072 6f63 6573 7365 643a 0a20 2020  f processed:.   
 0000c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3d0: 7261 6973 6520 650a 0a20 2020 2020 2020  raise e..       
-0000c3e0: 2065 6c69 6620 7574 696c 732e 6861 7368   elif utils.hash
-0000c3f0: 6162 6c65 286b 6579 293a 0a20 2020 2020  able(key):.     
-0000c400: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0000c410: 616e 6365 2876 616c 7565 2c20 4461 7461  ance(value, Data
-0000c420: 7365 7429 3a0a 2020 2020 2020 2020 2020  set):.          
-0000c430: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-0000c440: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0000c450: 2020 2020 2020 2020 2020 2022 4361 6e6e             "Cann
-0000c460: 6f74 2061 7373 6967 6e20 6120 4461 7461  ot assign a Data
-0000c470: 7365 7420 746f 2061 2073 696e 676c 6520  set to a single 
-0000c480: 6b65 7920 2d20 6f6e 6c79 2061 2044 6174  key - only a Dat
-0000c490: 6141 7272 6179 206f 7220 5661 7269 6162  aArray or Variab
-0000c4a0: 6c65 2022 0a20 2020 2020 2020 2020 2020  le ".           
-0000c4b0: 2020 2020 2020 2020 2022 6f62 6a65 6374           "object
-0000c4c0: 2063 616e 2062 6520 7374 6f72 6564 2075   can be stored u
-0000c4d0: 6e64 6572 2061 2073 696e 676c 6520 6b65  nder a single ke
-0000c4e0: 792e 220a 2020 2020 2020 2020 2020 2020  y.".            
-0000c4f0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000c500: 2020 7365 6c66 2e75 7064 6174 6528 7b6b    self.update({k
-0000c510: 6579 3a20 7661 6c75 657d 290a 0a20 2020  ey: value})..   
-0000c520: 2020 2020 2065 6c69 6620 7574 696c 732e       elif utils.
-0000c530: 6974 6572 6162 6c65 5f6f 665f 6861 7368  iterable_of_hash
-0000c540: 6162 6c65 286b 6579 293a 0a20 2020 2020  able(key):.     
-0000c550: 2020 2020 2020 206b 6579 6c69 7374 203d         keylist =
-0000c560: 206c 6973 7428 6b65 7929 0a20 2020 2020   list(key).     
-0000c570: 2020 2020 2020 2069 6620 6c65 6e28 6b65         if len(ke
-0000c580: 796c 6973 7429 203d 3d20 303a 0a20 2020  ylist) == 0:.   
-0000c590: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000c5a0: 7365 2056 616c 7565 4572 726f 7228 2245  se ValueError("E
-0000c5b0: 6d70 7479 206c 6973 7420 6f66 2076 6172  mpty list of var
-0000c5c0: 6961 626c 6573 2074 6f20 6265 2073 6574  iables to be set
-0000c5d0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-0000c5e0: 6620 6c65 6e28 6b65 796c 6973 7429 203d  f len(keylist) =
-0000c5f0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-0000c600: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-0000c610: 287b 6b65 796c 6973 745b 305d 3a20 7661  ({keylist[0]: va
-0000c620: 6c75 657d 290a 2020 2020 2020 2020 2020  lue}).          
-0000c630: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000c640: 2020 2020 2020 2020 6966 206c 656e 286b          if len(k
-0000c650: 6579 6c69 7374 2920 213d 206c 656e 2876  eylist) != len(v
-0000c660: 616c 7565 293a 0a20 2020 2020 2020 2020  alue):.         
-0000c670: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000c680: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-0000c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c6a0: 2020 2020 2066 2244 6966 6665 7265 6e74       f"Different
-0000c6b0: 206c 656e 6774 6873 206f 6620 7661 7269   lengths of vari
-0000c6c0: 6162 6c65 7320 746f 2062 6520 7365 7420  ables to be set 
-0000c6d0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000c6e0: 2020 2020 2020 2020 2020 6622 287b 6c65            f"({le
-0000c6f0: 6e28 6b65 796c 6973 7429 7d29 2061 6e64  n(keylist)}) and
-0000c700: 2064 6174 6120 7573 6564 2061 7320 696e   data used as in
-0000c710: 7075 7420 666f 7220 220a 2020 2020 2020  put for ".      
-0000c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c730: 2020 6622 7365 7474 696e 6720 287b 6c65    f"setting ({le
-0000c740: 6e28 7661 6c75 6529 7d29 220a 2020 2020  n(value)})".    
-0000c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c760: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000c770: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000c780: 7661 6c75 652c 2044 6174 6173 6574 293a  value, Dataset):
-0000c790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c7a0: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-0000c7b0: 2864 6963 7428 7a69 7028 6b65 796c 6973  (dict(zip(keylis
-0000c7c0: 742c 2076 616c 7565 2e64 6174 615f 7661  t, value.data_va
-0000c7d0: 7273 2e76 616c 7565 7328 2929 2929 0a20  rs.values()))). 
-0000c7e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000c7f0: 6c69 6620 6973 696e 7374 616e 6365 2876  lif isinstance(v
-0000c800: 616c 7565 2c20 4461 7461 4172 7261 7929  alue, DataArray)
-0000c810: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c820: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000c830: 6545 7272 6f72 2822 4361 6e6e 6f74 2061  eError("Cannot a
-0000c840: 7373 6967 6e20 7369 6e67 6c65 2044 6174  ssign single Dat
-0000c850: 6141 7272 6179 2074 6f20 6d75 6c74 6970  aArray to multip
-0000c860: 6c65 206b 6579 7322 290a 2020 2020 2020  le keys").      
-0000c870: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000c3b0: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
+0000c3c0: 6d65 4572 726f 7228 0a20 2020 2020 2020  meError(.       
+0000c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3e0: 2020 2020 2022 416e 2065 7272 6f72 206f       "An error o
+0000c3f0: 6363 7572 7265 6420 7768 696c 6520 7365  ccurred while se
+0000c400: 7474 696e 6720 7661 6c75 6573 206f 6620  tting values of 
+0000c410: 7468 6522 0a20 2020 2020 2020 2020 2020  the".           
+0000c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c430: 2066 2220 7661 7269 6162 6c65 2027 7b6e   f" variable '{n
+0000c440: 616d 657d 272e 2054 6865 2066 6f6c 6c6f  ame}'. The follo
+0000c450: 7769 6e67 2076 6172 6961 626c 6573 2068  wing variables h
+0000c460: 6176 6522 0a20 2020 2020 2020 2020 2020  ave".           
+0000c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c480: 2066 2220 6265 656e 2073 7563 6365 7373   f" been success
+0000c490: 6675 6c6c 7920 7570 6461 7465 643a 5c6e  fully updated:\n
+0000c4a0: 7b70 726f 6365 7373 6564 7d22 0a20 2020  {processed}".   
+0000c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4c0: 2020 2020 2029 2066 726f 6d20 650a 2020       ) from e.  
+0000c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c500: 7261 6973 6520 650a 0a20 2020 2020 2020  raise e..       
+0000c510: 2065 6c69 6620 7574 696c 732e 6861 7368   elif utils.hash
+0000c520: 6162 6c65 286b 6579 293a 0a20 2020 2020  able(key):.     
+0000c530: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000c540: 616e 6365 2876 616c 7565 2c20 4461 7461  ance(value, Data
+0000c550: 7365 7429 3a0a 2020 2020 2020 2020 2020  set):.          
+0000c560: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+0000c570: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+0000c580: 2020 2020 2020 2020 2020 2022 4361 6e6e             "Cann
+0000c590: 6f74 2061 7373 6967 6e20 6120 4461 7461  ot assign a Data
+0000c5a0: 7365 7420 746f 2061 2073 696e 676c 6520  set to a single 
+0000c5b0: 6b65 7920 2d20 6f6e 6c79 2061 2044 6174  key - only a Dat
+0000c5c0: 6141 7272 6179 206f 7220 5661 7269 6162  aArray or Variab
+0000c5d0: 6c65 2022 0a20 2020 2020 2020 2020 2020  le ".           
+0000c5e0: 2020 2020 2020 2020 2022 6f62 6a65 6374           "object
+0000c5f0: 2063 616e 2062 6520 7374 6f72 6564 2075   can be stored u
+0000c600: 6e64 6572 2061 2073 696e 676c 6520 6b65  nder a single ke
+0000c610: 792e 220a 2020 2020 2020 2020 2020 2020  y.".            
+0000c620: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000c630: 2020 7365 6c66 2e75 7064 6174 6528 7b6b    self.update({k
+0000c640: 6579 3a20 7661 6c75 657d 290a 0a20 2020  ey: value})..   
+0000c650: 2020 2020 2065 6c69 6620 7574 696c 732e       elif utils.
+0000c660: 6974 6572 6162 6c65 5f6f 665f 6861 7368  iterable_of_hash
+0000c670: 6162 6c65 286b 6579 293a 0a20 2020 2020  able(key):.     
+0000c680: 2020 2020 2020 206b 6579 6c69 7374 203d         keylist =
+0000c690: 206c 6973 7428 6b65 7929 0a20 2020 2020   list(key).     
+0000c6a0: 2020 2020 2020 2069 6620 6c65 6e28 6b65         if len(ke
+0000c6b0: 796c 6973 7429 203d 3d20 303a 0a20 2020  ylist) == 0:.   
+0000c6c0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000c6d0: 7365 2056 616c 7565 4572 726f 7228 2245  se ValueError("E
+0000c6e0: 6d70 7479 206c 6973 7420 6f66 2076 6172  mpty list of var
+0000c6f0: 6961 626c 6573 2074 6f20 6265 2073 6574  iables to be set
+0000c700: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+0000c710: 6620 6c65 6e28 6b65 796c 6973 7429 203d  f len(keylist) =
+0000c720: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+0000c730: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
+0000c740: 287b 6b65 796c 6973 745b 305d 3a20 7661  ({keylist[0]: va
+0000c750: 6c75 657d 290a 2020 2020 2020 2020 2020  lue}).          
+0000c760: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000c770: 2020 2020 2020 2020 6966 206c 656e 286b          if len(k
+0000c780: 6579 6c69 7374 2920 213d 206c 656e 2876  eylist) != len(v
+0000c790: 616c 7565 293a 0a20 2020 2020 2020 2020  alue):.         
+0000c7a0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000c7b0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+0000c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c7d0: 2020 2020 2066 2244 6966 6665 7265 6e74       f"Different
+0000c7e0: 206c 656e 6774 6873 206f 6620 7661 7269   lengths of vari
+0000c7f0: 6162 6c65 7320 746f 2062 6520 7365 7420  ables to be set 
+0000c800: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000c810: 2020 2020 2020 2020 2020 6622 287b 6c65            f"({le
+0000c820: 6e28 6b65 796c 6973 7429 7d29 2061 6e64  n(keylist)}) and
+0000c830: 2064 6174 6120 7573 6564 2061 7320 696e   data used as in
+0000c840: 7075 7420 666f 7220 220a 2020 2020 2020  put for ".      
+0000c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c860: 2020 6622 7365 7474 696e 6720 287b 6c65    f"setting ({le
+0000c870: 6e28 7661 6c75 6529 7d29 220a 2020 2020  n(value)})".    
 0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c890: 2020 2020 7365 6c66 2e75 7064 6174 6528      self.update(
-0000c8a0: 6469 6374 287a 6970 286b 6579 6c69 7374  dict(zip(keylist
-0000c8b0: 2c20 7661 6c75 6529 2929 0a0a 2020 2020  , value)))..    
-0000c8c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000c8d0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000c8e0: 6545 7272 6f72 2866 2255 6e73 7570 706f  eError(f"Unsuppo
-0000c8f0: 7274 6564 206b 6579 2d74 7970 6520 7b74  rted key-type {t
-0000c900: 7970 6528 6b65 7929 7d22 290a 0a20 2020  ype(key)}")..   
-0000c910: 2064 6566 205f 7365 7469 7465 6d5f 6368   def _setitem_ch
-0000c920: 6563 6b28 7365 6c66 2c20 6b65 792c 2076  eck(self, key, v
-0000c930: 616c 7565 293a 0a20 2020 2020 2020 2022  alue):.        "
-0000c940: 2222 436f 6e73 6973 7465 6e63 7920 6368  ""Consistency ch
-0000c950: 6563 6b20 666f 7220 5f5f 7365 7469 7465  eck for __setite
-0000c960: 6d5f 5f0a 0a20 2020 2020 2020 2057 6865  m__..        Whe
-0000c970: 6e20 6173 7369 676e 696e 6720 7661 6c75  n assigning valu
-0000c980: 6573 2074 6f20 6120 7375 6273 6574 206f  es to a subset o
-0000c990: 6620 6120 4461 7461 7365 742c 2064 6f20  f a Dataset, do 
-0000c9a0: 636f 6e73 6973 7465 6e63 7920 6368 6563  consistency chec
-0000c9b0: 6b20 6265 666f 7265 6861 6e64 0a20 2020  k beforehand.   
-0000c9c0: 2020 2020 2074 6f20 6176 6f69 6420 6c65       to avoid le
-0000c9d0: 6176 696e 6720 7468 6520 6461 7461 7365  aving the datase
-0000c9e0: 7420 696e 2061 2070 6172 7469 616c 6c79  t in a partially
-0000c9f0: 2075 7064 6174 6564 2073 7461 7465 2077   updated state w
-0000ca00: 6865 6e20 616e 2065 7272 6f72 206f 6363  hen an error occ
-0000ca10: 7572 732e 0a20 2020 2020 2020 2022 2222  urs..        """
-0000ca20: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
-0000ca30: 7272 6179 2e63 6f72 652e 616c 6967 6e6d  rray.core.alignm
-0000ca40: 656e 7420 696d 706f 7274 2061 6c69 676e  ent import align
-0000ca50: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
-0000ca60: 7272 6179 2e63 6f72 652e 6461 7461 6172  rray.core.dataar
-0000ca70: 7261 7920 696d 706f 7274 2044 6174 6141  ray import DataA
-0000ca80: 7272 6179 0a0a 2020 2020 2020 2020 6966  rray..        if
-0000ca90: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
-0000caa0: 652c 2044 6174 6173 6574 293a 0a20 2020  e, Dataset):.   
-0000cab0: 2020 2020 2020 2020 206d 6973 7369 6e67           missing
-0000cac0: 5f76 6172 7320 3d20 5b0a 2020 2020 2020  _vars = [.      
-0000cad0: 2020 2020 2020 2020 2020 6e61 6d65 2066            name f
-0000cae0: 6f72 206e 616d 6520 696e 2076 616c 7565  or name in value
-0000caf0: 2e64 6174 615f 7661 7273 2069 6620 6e61  .data_vars if na
-0000cb00: 6d65 206e 6f74 2069 6e20 7365 6c66 2e64  me not in self.d
-0000cb10: 6174 615f 7661 7273 0a20 2020 2020 2020  ata_vars.       
-0000cb20: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
-0000cb30: 2020 2069 6620 6d69 7373 696e 675f 7661     if missing_va
-0000cb40: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-0000cb50: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000cb60: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0000cb70: 2020 2020 2020 2020 2020 6622 5661 7269            f"Vari
-0000cb80: 6162 6c65 7320 7b6d 6973 7369 6e67 5f76  ables {missing_v
-0000cb90: 6172 737d 2069 6e20 6e65 7720 7661 6c75  ars} in new valu
-0000cba0: 6573 220a 2020 2020 2020 2020 2020 2020  es".            
-0000cbb0: 2020 2020 2020 2020 6622 206e 6f74 2061          f" not a
-0000cbc0: 7661 696c 6162 6c65 2069 6e20 6f72 6967  vailable in orig
-0000cbd0: 696e 616c 2064 6174 6173 6574 3a5c 6e7b  inal dataset:\n{
-0000cbe0: 7365 6c66 7d22 0a20 2020 2020 2020 2020  self}".         
-0000cbf0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000cc00: 2065 6c69 6620 6e6f 7420 616e 7928 5b69   elif not any([i
-0000cc10: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
-0000cc20: 2074 2920 666f 7220 7420 696e 205b 4461   t) for t in [Da
-0000cc30: 7461 4172 7261 792c 204e 756d 6265 722c  taArray, Number,
-0000cc40: 2073 7472 5d5d 293a 0a20 2020 2020 2020   str]]):.       
-0000cc50: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-0000cc60: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0000cc70: 2020 2020 2020 2244 6174 6173 6574 2061        "Dataset a
-0000cc80: 7373 6967 6e6d 656e 7420 6f6e 6c79 2061  ssignment only a
-0000cc90: 6363 6570 7473 2044 6174 6141 7272 6179  ccepts DataArray
-0000cca0: 732c 2044 6174 6173 6574 732c 2061 6e64  s, Datasets, and
-0000ccb0: 2073 6361 6c61 7273 2e22 0a20 2020 2020   scalars.".     
-0000ccc0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000ccd0: 2020 6e65 775f 7661 6c75 6520 3d20 4461    new_value = Da
-0000cce0: 7461 7365 7428 290a 2020 2020 2020 2020  taset().        
-0000ccf0: 666f 7220 6e61 6d65 2c20 7661 7220 696e  for name, var in
-0000cd00: 2073 656c 662e 6974 656d 7328 293a 0a20   self.items():. 
-0000cd10: 2020 2020 2020 2020 2020 2023 2074 6573             # tes
-0000cd20: 7420 696e 6465 7869 6e67 0a20 2020 2020  t indexing.     
-0000cd30: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000cd40: 2020 2020 2020 2020 2020 2020 7661 725f              var_
-0000cd50: 6b20 3d20 7661 725b 6b65 795d 0a20 2020  k = var[key].   
-0000cd60: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0000cd70: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
-0000cd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd90: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000cda0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000cdb0: 2020 2020 2020 6622 5661 7269 6162 6c65        f"Variable
-0000cdc0: 2027 7b6e 616d 657d 273a 2069 6e64 6578   '{name}': index
-0000cdd0: 6572 207b 6b65 797d 206e 6f74 2061 7661  er {key} not ava
-0000cde0: 696c 6162 6c65 220a 2020 2020 2020 2020  ilable".        
-0000cdf0: 2020 2020 2020 2020 2920 6672 6f6d 2065          ) from e
-0000ce00: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000ce10: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
-0000ce20: 652c 2044 6174 6173 6574 293a 0a20 2020  e, Dataset):.   
-0000ce30: 2020 2020 2020 2020 2020 2020 2076 616c               val
-0000ce40: 203d 2076 616c 7565 5b6e 616d 655d 0a20   = value[name]. 
-0000ce50: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000ce60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ce70: 2076 616c 203d 2076 616c 7565 0a0a 2020   val = value..  
-0000ce80: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-0000ce90: 6e73 7461 6e63 6528 7661 6c2c 2044 6174  nstance(val, Dat
-0000cea0: 6141 7272 6179 293a 0a20 2020 2020 2020  aArray):.       
-0000ceb0: 2020 2020 2020 2020 2023 2063 6865 636b           # check
-0000cec0: 2063 6f6e 7369 7374 656e 6379 206f 6620   consistency of 
-0000ced0: 6469 6d65 6e73 696f 6e73 0a20 2020 2020  dimensions.     
-0000cee0: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
-0000cef0: 696d 2069 6e20 7661 6c2e 6469 6d73 3a0a  im in val.dims:.
-0000cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf10: 2020 2020 6966 2064 696d 206e 6f74 2069      if dim not i
-0000cf20: 6e20 7661 725f 6b2e 6469 6d73 3a0a 2020  n var_k.dims:.  
-0000cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf40: 2020 2020 2020 7261 6973 6520 4b65 7945        raise KeyE
-0000cf50: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0000cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf70: 2020 6622 5661 7269 6162 6c65 2027 7b6e    f"Variable '{n
-0000cf80: 616d 657d 273a 2064 696d 656e 7369 6f6e  ame}': dimension
-0000cf90: 2027 7b64 696d 7d27 2061 7070 6561 7273   '{dim}' appears
-0000cfa0: 2069 6e20 6e65 7720 7661 6c75 6573 2022   in new values "
-0000cfb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cfc0: 2020 2020 2020 2020 2020 2020 2066 2262               f"b
-0000cfd0: 7574 206e 6f74 2069 6e20 7468 6520 696e  ut not in the in
-0000cfe0: 6465 7865 6420 6f72 6967 696e 616c 2064  dexed original d
-0000cff0: 6174 6122 0a20 2020 2020 2020 2020 2020  ata".           
-0000d000: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0000d010: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000d020: 696d 7320 3d20 7475 706c 6528 6469 6d20  ims = tuple(dim 
-0000d030: 666f 7220 6469 6d20 696e 2076 6172 5f6b  for dim in var_k
-0000d040: 2e64 696d 7320 6966 2064 696d 2069 6e20  .dims if dim in 
-0000d050: 7661 6c2e 6469 6d73 290a 2020 2020 2020  val.dims).      
-0000d060: 2020 2020 2020 2020 2020 6966 2064 696d            if dim
-0000d070: 7320 213d 2076 616c 2e64 696d 733a 0a20  s != val.dims:. 
-0000d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d090: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0000d0a0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0000d0b0: 2020 2020 2020 2020 2020 2020 2066 2256               f"V
-0000d0c0: 6172 6961 626c 6520 277b 6e61 6d65 7d27  ariable '{name}'
-0000d0d0: 3a20 6469 6d65 6e73 696f 6e20 6f72 6465  : dimension orde
-0000d0e0: 7220 6469 6666 6572 7320 6265 7477 6565  r differs betwee
-0000d0f0: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
-0000d100: 2020 2020 2020 2020 2020 2066 2220 6f72             f" or
-0000d110: 6967 696e 616c 2061 6e64 206e 6577 2064  iginal and new d
-0000d120: 6174 613a 5c6e 7b64 696d 737d 5c6e 7673  ata:\n{dims}\nvs
-0000d130: 2e5c 6e7b 7661 6c2e 6469 6d73 7d22 0a20  .\n{val.dims}". 
-0000d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d150: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000d160: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000d170: 2020 2020 2020 2076 616c 203d 206e 702e         val = np.
-0000d180: 6172 7261 7928 7661 6c29 0a0a 2020 2020  array(val)..    
-0000d190: 2020 2020 2020 2020 2320 7479 7065 2063          # type c
-0000d1a0: 6f6e 7665 7273 696f 6e0a 2020 2020 2020  onversion.      
-0000d1b0: 2020 2020 2020 6e65 775f 7661 6c75 655b        new_value[
-0000d1c0: 6e61 6d65 5d20 3d20 7661 6c2e 6173 7479  name] = val.asty
-0000d1d0: 7065 2876 6172 5f6b 2e64 7479 7065 2c20  pe(var_k.dtype, 
-0000d1e0: 636f 7079 3d46 616c 7365 290a 0a20 2020  copy=False)..   
-0000d1f0: 2020 2020 2023 2063 6865 636b 2063 6f6e       # check con
-0000d200: 7369 7374 656e 6379 206f 6620 6469 6d65  sistency of dime
-0000d210: 6e73 696f 6e20 7369 7a65 7320 616e 6420  nsion sizes and 
-0000d220: 6469 6d65 6e73 696f 6e20 636f 6f72 6469  dimension coordi
-0000d230: 6e61 7465 730a 2020 2020 2020 2020 6966  nates.        if
-0000d240: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
-0000d250: 652c 2044 6174 6141 7272 6179 2920 6f72  e, DataArray) or
-0000d260: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
-0000d270: 652c 2044 6174 6173 6574 293a 0a20 2020  e, Dataset):.   
-0000d280: 2020 2020 2020 2020 2061 6c69 676e 2873           align(s
-0000d290: 656c 665b 6b65 795d 2c20 7661 6c75 652c  elf[key], value,
-0000d2a0: 206a 6f69 6e3d 2265 7861 6374 222c 2063   join="exact", c
-0000d2b0: 6f70 793d 4661 6c73 6529 0a0a 2020 2020  opy=False)..    
-0000d2c0: 2020 2020 7265 7475 726e 206e 6577 5f76      return new_v
-0000d2d0: 616c 7565 0a0a 2020 2020 6465 6620 5f5f  alue..    def __
-0000d2e0: 6465 6c69 7465 6d5f 5f28 7365 6c66 2c20  delitem__(self, 
-0000d2f0: 6b65 793a 2048 6173 6861 626c 6529 202d  key: Hashable) -
-0000d300: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000d310: 2222 2252 656d 6f76 6520 6120 7661 7269  """Remove a vari
-0000d320: 6162 6c65 2066 726f 6d20 7468 6973 2064  able from this d
-0000d330: 6174 6173 6574 2e22 2222 0a20 2020 2020  ataset.""".     
-0000d340: 2020 2061 7373 6572 745f 6e6f 5f69 6e64     assert_no_ind
-0000d350: 6578 5f63 6f72 7275 7074 6564 2873 656c  ex_corrupted(sel
-0000d360: 662e 7869 6e64 6578 6573 2c20 7b6b 6579  f.xindexes, {key
-0000d370: 7d29 0a0a 2020 2020 2020 2020 6966 206b  })..        if k
-0000d380: 6579 2069 6e20 7365 6c66 2e5f 696e 6465  ey in self._inde
-0000d390: 7865 733a 0a20 2020 2020 2020 2020 2020  xes:.           
-0000d3a0: 2064 656c 2073 656c 662e 5f69 6e64 6578   del self._index
-0000d3b0: 6573 5b6b 6579 5d0a 2020 2020 2020 2020  es[key].        
-0000d3c0: 6465 6c20 7365 6c66 2e5f 7661 7269 6162  del self._variab
-0000d3d0: 6c65 735b 6b65 795d 0a20 2020 2020 2020  les[key].       
-0000d3e0: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
-0000d3f0: 6573 2e64 6973 6361 7264 286b 6579 290a  es.discard(key).
-0000d400: 2020 2020 2020 2020 7365 6c66 2e5f 6469          self._di
-0000d410: 6d73 203d 2063 616c 6375 6c61 7465 5f64  ms = calculate_d
-0000d420: 696d 656e 7369 6f6e 7328 7365 6c66 2e5f  imensions(self._
-0000d430: 7661 7269 6162 6c65 7329 0a0a 2020 2020  variables)..    
-0000d440: 2320 6d75 7461 626c 6520 6f62 6a65 6374  # mutable object
-0000d450: 7320 7368 6f75 6c64 206e 6f74 2062 6520  s should not be 
-0000d460: 6861 7368 6162 6c65 0a20 2020 2023 2068  hashable.    # h
-0000d470: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-0000d480: 6d2f 7079 7468 6f6e 2f6d 7970 792f 6973  m/python/mypy/is
-0000d490: 7375 6573 2f34 3236 360a 2020 2020 5f5f  sues/4266.    __
-0000d4a0: 6861 7368 5f5f 203d 204e 6f6e 6520 2023  hash__ = None  #
-0000d4b0: 2074 7970 653a 2069 676e 6f72 655b 6173   type: ignore[as
-0000d4c0: 7369 676e 6d65 6e74 5d0a 0a20 2020 2064  signment]..    d
-0000d4d0: 6566 205f 616c 6c5f 636f 6d70 6174 2873  ef _all_compat(s
-0000d4e0: 656c 662c 206f 7468 6572 3a20 4461 7461  elf, other: Data
-0000d4f0: 7365 742c 2063 6f6d 7061 745f 7374 723a  set, compat_str:
-0000d500: 2073 7472 2920 2d3e 2062 6f6f 6c3a 0a20   str) -> bool:. 
-0000d510: 2020 2020 2020 2022 2222 4865 6c70 6572         """Helper
-0000d520: 2066 756e 6374 696f 6e20 666f 7220 6571   function for eq
-0000d530: 7561 6c73 2061 6e64 2069 6465 6e74 6963  uals and identic
-0000d540: 616c 2222 220a 0a20 2020 2020 2020 2023  al"""..        #
-0000d550: 2073 6f6d 6520 7374 6f72 6573 2028 652e   some stores (e.
-0000d560: 672e 2c20 7363 6970 7929 2064 6f20 6e6f  g., scipy) do no
-0000d570: 7420 7365 656d 2074 6f20 7072 6573 6572  t seem to preser
-0000d580: 7665 206f 7264 6572 2c20 736f 2064 6f6e  ve order, so don
-0000d590: 2774 0a20 2020 2020 2020 2023 2072 6571  't.        # req
-0000d5a0: 7569 7265 206d 6174 6368 696e 6720 6f72  uire matching or
-0000d5b0: 6465 7220 666f 7220 6571 7561 6c69 7479  der for equality
-0000d5c0: 0a20 2020 2020 2020 2064 6566 2063 6f6d  .        def com
-0000d5d0: 7061 7428 783a 2056 6172 6961 626c 652c  pat(x: Variable,
-0000d5e0: 2079 3a20 5661 7269 6162 6c65 2920 2d3e   y: Variable) ->
-0000d5f0: 2062 6f6f 6c3a 0a20 2020 2020 2020 2020   bool:.         
-0000d600: 2020 2072 6574 7572 6e20 6765 7461 7474     return getatt
-0000d610: 7228 782c 2063 6f6d 7061 745f 7374 7229  r(x, compat_str)
-0000d620: 2879 290a 0a20 2020 2020 2020 2072 6574  (y)..        ret
-0000d630: 7572 6e20 7365 6c66 2e5f 636f 6f72 645f  urn self._coord_
-0000d640: 6e61 6d65 7320 3d3d 206f 7468 6572 2e5f  names == other._
-0000d650: 636f 6f72 645f 6e61 6d65 7320 616e 6420  coord_names and 
-0000d660: 7574 696c 732e 6469 6374 5f65 7175 6976  utils.dict_equiv
-0000d670: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-0000d680: 6c66 2e5f 7661 7269 6162 6c65 732c 206f  lf._variables, o
-0000d690: 7468 6572 2e5f 7661 7269 6162 6c65 732c  ther._variables,
-0000d6a0: 2063 6f6d 7061 743d 636f 6d70 6174 0a20   compat=compat. 
-0000d6b0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0000d6c0: 6620 6272 6f61 6463 6173 745f 6571 7561  f broadcast_equa
-0000d6d0: 6c73 2873 656c 662c 206f 7468 6572 3a20  ls(self, other: 
-0000d6e0: 4461 7461 7365 7429 202d 3e20 626f 6f6c  Dataset) -> bool
-0000d6f0: 3a0a 2020 2020 2020 2020 2222 2254 776f  :.        """Two
-0000d700: 2044 6174 6173 6574 7320 6172 6520 6272   Datasets are br
-0000d710: 6f61 6463 6173 7420 6571 7561 6c20 6966  oadcast equal if
-0000d720: 2074 6865 7920 6172 6520 6571 7561 6c20   they are equal 
-0000d730: 6166 7465 720a 2020 2020 2020 2020 6272  after.        br
-0000d740: 6f61 6463 6173 7469 6e67 2061 6c6c 2076  oadcasting all v
-0000d750: 6172 6961 626c 6573 2061 6761 696e 7374  ariables against
-0000d760: 2065 6163 6820 6f74 6865 722e 0a0a 2020   each other...  
-0000d770: 2020 2020 2020 466f 7220 6578 616d 706c        For exampl
-0000d780: 652c 2076 6172 6961 626c 6573 2074 6861  e, variables tha
-0000d790: 7420 6172 6520 7363 616c 6172 2069 6e20  t are scalar in 
-0000d7a0: 6f6e 6520 6461 7461 7365 7420 6275 7420  one dataset but 
-0000d7b0: 6e6f 6e2d 7363 616c 6172 2069 6e0a 2020  non-scalar in.  
-0000d7c0: 2020 2020 2020 7468 6520 6f74 6865 7220        the other 
-0000d7d0: 6461 7461 7365 7420 6361 6e20 7374 696c  dataset can stil
-0000d7e0: 6c20 6265 2062 726f 6164 6361 7374 2065  l be broadcast e
-0000d7f0: 7175 616c 2069 6620 7468 6520 7468 6520  qual if the the 
-0000d800: 6e6f 6e2d 7363 616c 6172 0a20 2020 2020  non-scalar.     
-0000d810: 2020 2076 6172 6961 626c 6520 6973 2061     variable is a
-0000d820: 2063 6f6e 7374 616e 742e 0a0a 2020 2020   constant...    
-0000d830: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-0000d840: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-0000d850: 2020 2020 2020 4461 7461 7365 742e 6571        Dataset.eq
-0000d860: 7561 6c73 0a20 2020 2020 2020 2044 6174  uals.        Dat
-0000d870: 6173 6574 2e69 6465 6e74 6963 616c 0a20  aset.identical. 
-0000d880: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000d890: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000d8a0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000d8b0: 5f61 6c6c 5f63 6f6d 7061 7428 6f74 6865  _all_compat(othe
-0000d8c0: 722c 2022 6272 6f61 6463 6173 745f 6571  r, "broadcast_eq
-0000d8d0: 7561 6c73 2229 0a20 2020 2020 2020 2065  uals").        e
-0000d8e0: 7863 6570 7420 2854 7970 6545 7272 6f72  xcept (TypeError
-0000d8f0: 2c20 4174 7472 6962 7574 6545 7272 6f72  , AttributeError
-0000d900: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0000d910: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
-0000d920: 2064 6566 2065 7175 616c 7328 7365 6c66   def equals(self
-0000d930: 2c20 6f74 6865 723a 2044 6174 6173 6574  , other: Dataset
-0000d940: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-0000d950: 2020 2022 2222 5477 6f20 4461 7461 7365     """Two Datase
-0000d960: 7473 2061 7265 2065 7175 616c 2069 6620  ts are equal if 
-0000d970: 7468 6579 2068 6176 6520 6d61 7463 6869  they have matchi
-0000d980: 6e67 2076 6172 6961 626c 6573 2061 6e64  ng variables and
-0000d990: 0a20 2020 2020 2020 2063 6f6f 7264 696e  .        coordin
-0000d9a0: 6174 6573 2c20 616c 6c20 6f66 2077 6869  ates, all of whi
-0000d9b0: 6368 2061 7265 2065 7175 616c 2e0a 0a20  ch are equal... 
-0000d9c0: 2020 2020 2020 2044 6174 6173 6574 7320         Datasets 
-0000d9d0: 6361 6e20 7374 696c 6c20 6265 2065 7175  can still be equ
-0000d9e0: 616c 2028 6c69 6b65 2070 616e 6461 7320  al (like pandas 
-0000d9f0: 6f62 6a65 6374 7329 2069 6620 7468 6579  objects) if they
-0000da00: 2068 6176 6520 4e61 4e0a 2020 2020 2020   have NaN.      
-0000da10: 2020 7661 6c75 6573 2069 6e20 7468 6520    values in the 
-0000da20: 7361 6d65 206c 6f63 6174 696f 6e73 2e0a  same locations..
-0000da30: 0a20 2020 2020 2020 2054 6869 7320 6d65  .        This me
-0000da40: 7468 6f64 2069 7320 6e65 6365 7373 6172  thod is necessar
-0000da50: 7920 6265 6361 7573 6520 6076 3120 3d3d  y because `v1 ==
-0000da60: 2076 3260 2066 6f72 2060 6044 6174 6173   v2` for ``Datas
-0000da70: 6574 6060 0a20 2020 2020 2020 2064 6f65  et``.        doe
-0000da80: 7320 656c 656d 656e 742d 7769 7365 2063  s element-wise c
-0000da90: 6f6d 7061 7269 736f 6e73 2028 6c69 6b65  omparisons (like
-0000daa0: 206e 756d 7079 2e6e 6461 7272 6179 7329   numpy.ndarrays)
-0000dab0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-0000dac0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-0000dad0: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
-0000dae0: 6173 6574 2e62 726f 6164 6361 7374 5f65  aset.broadcast_e
-0000daf0: 7175 616c 730a 2020 2020 2020 2020 4461  quals.        Da
-0000db00: 7461 7365 742e 6964 656e 7469 6361 6c0a  taset.identical.
-0000db10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000db20: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000db30: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000db40: 2e5f 616c 6c5f 636f 6d70 6174 286f 7468  ._all_compat(oth
-0000db50: 6572 2c20 2265 7175 616c 7322 290a 2020  er, "equals").  
-0000db60: 2020 2020 2020 6578 6365 7074 2028 5479        except (Ty
-0000db70: 7065 4572 726f 722c 2041 7474 7269 6275  peError, Attribu
-0000db80: 7465 4572 726f 7229 3a0a 2020 2020 2020  teError):.      
-0000db90: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0000dba0: 7365 0a0a 2020 2020 6465 6620 6964 656e  se..    def iden
-0000dbb0: 7469 6361 6c28 7365 6c66 2c20 6f74 6865  tical(self, othe
-0000dbc0: 723a 2044 6174 6173 6574 2920 2d3e 2062  r: Dataset) -> b
-0000dbd0: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
-0000dbe0: 4c69 6b65 2065 7175 616c 732c 2062 7574  Like equals, but
-0000dbf0: 2061 6c73 6f20 6368 6563 6b73 2061 6c6c   also checks all
-0000dc00: 2064 6174 6173 6574 2061 7474 7269 6275   dataset attribu
-0000dc10: 7465 7320 616e 6420 7468 650a 2020 2020  tes and the.    
-0000dc20: 2020 2020 6174 7472 6962 7574 6573 206f      attributes o
-0000dc30: 6e20 616c 6c20 7661 7269 6162 6c65 7320  n all variables 
-0000dc40: 616e 6420 636f 6f72 6469 6e61 7465 732e  and coordinates.
-0000dc50: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-0000dc60: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-0000dc70: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
-0000dc80: 7365 742e 6272 6f61 6463 6173 745f 6571  set.broadcast_eq
-0000dc90: 7561 6c73 0a20 2020 2020 2020 2044 6174  uals.        Dat
-0000dca0: 6173 6574 2e65 7175 616c 730a 2020 2020  aset.equals.    
-0000dcb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000dcc0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000dcd0: 2072 6574 7572 6e20 7574 696c 732e 6469   return utils.di
-0000dce0: 6374 5f65 7175 6976 2873 656c 662e 6174  ct_equiv(self.at
-0000dcf0: 7472 732c 206f 7468 6572 2e61 7474 7273  trs, other.attrs
-0000dd00: 2920 616e 6420 7365 6c66 2e5f 616c 6c5f  ) and self._all_
-0000dd10: 636f 6d70 6174 280a 2020 2020 2020 2020  compat(.        
-0000dd20: 2020 2020 2020 2020 6f74 6865 722c 2022          other, "
-0000dd30: 6964 656e 7469 6361 6c22 0a20 2020 2020  identical".     
-0000dd40: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000dd50: 2065 7863 6570 7420 2854 7970 6545 7272   except (TypeErr
-0000dd60: 6f72 2c20 4174 7472 6962 7574 6545 7272  or, AttributeErr
-0000dd70: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-0000dd80: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
-0000dd90: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-0000dda0: 2064 6566 2069 6e64 6578 6573 2873 656c   def indexes(sel
-0000ddb0: 6629 202d 3e20 496e 6465 7865 735b 7064  f) -> Indexes[pd
-0000ddc0: 2e49 6e64 6578 5d3a 0a20 2020 2020 2020  .Index]:.       
-0000ddd0: 2022 2222 4d61 7070 696e 6720 6f66 2070   """Mapping of p
-0000dde0: 616e 6461 732e 496e 6465 7820 6f62 6a65  andas.Index obje
-0000ddf0: 6374 7320 7573 6564 2066 6f72 206c 6162  cts used for lab
-0000de00: 656c 2062 6173 6564 2069 6e64 6578 696e  el based indexin
-0000de10: 672e 0a0a 2020 2020 2020 2020 5261 6973  g...        Rais
-0000de20: 6573 2061 6e20 6572 726f 7220 6966 2074  es an error if t
-0000de30: 6869 7320 4461 7461 7365 7420 6861 7320  his Dataset has 
-0000de40: 696e 6465 7865 7320 7468 6174 2063 616e  indexes that can
-0000de50: 6e6f 7420 6265 2063 6f65 7263 6564 0a20  not be coerced. 
-0000de60: 2020 2020 2020 2074 6f20 7061 6e64 6173         to pandas
-0000de70: 2e49 6e64 6578 206f 626a 6563 7473 2e0a  .Index objects..
-0000de80: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-0000de90: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-0000dea0: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
-0000deb0: 6574 2e78 696e 6465 7865 730a 0a20 2020  et.xindexes..   
-0000dec0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000ded0: 2072 6574 7572 6e20 7365 6c66 2e78 696e   return self.xin
-0000dee0: 6465 7865 732e 746f 5f70 616e 6461 735f  dexes.to_pandas_
-0000def0: 696e 6465 7865 7328 290a 0a20 2020 2040  indexes()..    @
-0000df00: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-0000df10: 2078 696e 6465 7865 7328 7365 6c66 2920   xindexes(self) 
-0000df20: 2d3e 2049 6e64 6578 6573 5b49 6e64 6578  -> Indexes[Index
-0000df30: 5d3a 0a20 2020 2020 2020 2022 2222 4d61  ]:.        """Ma
-0000df40: 7070 696e 6720 6f66 2078 6172 7261 7920  pping of xarray 
-0000df50: 496e 6465 7820 6f62 6a65 6374 7320 7573  Index objects us
-0000df60: 6564 2066 6f72 206c 6162 656c 2062 6173  ed for label bas
-0000df70: 6564 2069 6e64 6578 696e 672e 2222 220a  ed indexing.""".
-0000df80: 2020 2020 2020 2020 7265 7475 726e 2049          return I
-0000df90: 6e64 6578 6573 2873 656c 662e 5f69 6e64  ndexes(self._ind
-0000dfa0: 6578 6573 2c20 7b6b 3a20 7365 6c66 2e5f  exes, {k: self._
-0000dfb0: 7661 7269 6162 6c65 735b 6b5d 2066 6f72  variables[k] for
-0000dfc0: 206b 2069 6e20 7365 6c66 2e5f 696e 6465   k in self._inde
-0000dfd0: 7865 737d 290a 0a20 2020 2040 7072 6f70  xes})..    @prop
-0000dfe0: 6572 7479 0a20 2020 2064 6566 2063 6f6f  erty.    def coo
-0000dff0: 7264 7328 7365 6c66 2920 2d3e 2044 6174  rds(self) -> Dat
-0000e000: 6173 6574 436f 6f72 6469 6e61 7465 733a  asetCoordinates:
-0000e010: 0a20 2020 2020 2020 2022 2222 4469 6374  .        """Dict
-0000e020: 696f 6e61 7279 206f 6620 7861 7272 6179  ionary of xarray
-0000e030: 2e44 6174 6141 7272 6179 206f 626a 6563  .DataArray objec
-0000e040: 7473 2063 6f72 7265 7370 6f6e 6469 6e67  ts corresponding
-0000e050: 2074 6f20 636f 6f72 6469 6e61 7465 0a20   to coordinate. 
-0000e060: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-0000e070: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000e080: 2020 2020 2072 6574 7572 6e20 4461 7461       return Data
-0000e090: 7365 7443 6f6f 7264 696e 6174 6573 2873  setCoordinates(s
-0000e0a0: 656c 6629 0a0a 2020 2020 4070 726f 7065  elf)..    @prope
-0000e0b0: 7274 790a 2020 2020 6465 6620 6461 7461  rty.    def data
-0000e0c0: 5f76 6172 7328 7365 6c66 2920 2d3e 2044  _vars(self) -> D
-0000e0d0: 6174 6156 6172 6961 626c 6573 3a0a 2020  ataVariables:.  
-0000e0e0: 2020 2020 2020 2222 2244 6963 7469 6f6e        """Diction
-0000e0f0: 6172 7920 6f66 2044 6174 6141 7272 6179  ary of DataArray
-0000e100: 206f 626a 6563 7473 2063 6f72 7265 7370   objects corresp
-0000e110: 6f6e 6469 6e67 2074 6f20 6461 7461 2076  onding to data v
-0000e120: 6172 6961 626c 6573 2222 220a 2020 2020  ariables""".    
-0000e130: 2020 2020 7265 7475 726e 2044 6174 6156      return DataV
-0000e140: 6172 6961 626c 6573 2873 656c 6629 0a0a  ariables(self)..
-0000e150: 2020 2020 6465 6620 7365 745f 636f 6f72      def set_coor
-0000e160: 6473 2873 656c 663a 2054 5f44 6174 6173  ds(self: T_Datas
-0000e170: 6574 2c20 6e61 6d65 733a 2048 6173 6861  et, names: Hasha
-0000e180: 626c 6520 7c20 4974 6572 6162 6c65 5b48  ble | Iterable[H
-0000e190: 6173 6861 626c 655d 2920 2d3e 2054 5f44  ashable]) -> T_D
-0000e1a0: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-0000e1b0: 2222 2247 6976 656e 206e 616d 6573 206f  """Given names o
-0000e1c0: 6620 6f6e 6520 6f72 206d 6f72 6520 7661  f one or more va
-0000e1d0: 7269 6162 6c65 732c 2073 6574 2074 6865  riables, set the
-0000e1e0: 6d20 6173 2063 6f6f 7264 696e 6174 6573  m as coordinates
-0000e1f0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-0000e200: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-0000e210: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0000e220: 6e61 6d65 7320 3a20 6861 7368 6162 6c65  names : hashable
-0000e230: 206f 7220 6974 6572 6162 6c65 206f 6620   or iterable of 
-0000e240: 6861 7368 6162 6c65 0a20 2020 2020 2020  hashable.       
-0000e250: 2020 2020 204e 616d 6528 7329 206f 6620       Name(s) of 
-0000e260: 7661 7269 6162 6c65 7320 696e 2074 6869  variables in thi
-0000e270: 7320 6461 7461 7365 7420 746f 2063 6f6e  s dataset to con
-0000e280: 7665 7274 2069 6e74 6f20 636f 6f72 6469  vert into coordi
-0000e290: 6e61 7465 732e 0a0a 2020 2020 2020 2020  nates...        
-0000e2a0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-0000e2b0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0000e2c0: 4461 7461 7365 740a 0a20 2020 2020 2020  Dataset..       
-0000e2d0: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-0000e2e0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-0000e2f0: 2020 2044 6174 6173 6574 2e73 7761 705f     Dataset.swap_
-0000e300: 6469 6d73 0a20 2020 2020 2020 2044 6174  dims.        Dat
-0000e310: 6173 6574 2e61 7373 6967 6e5f 636f 6f72  aset.assign_coor
-0000e320: 6473 0a20 2020 2020 2020 2022 2222 0a20  ds.        """. 
-0000e330: 2020 2020 2020 2023 2054 4f44 4f3a 2061         # TODO: a
-0000e340: 6c6c 6f77 2069 6e73 6572 7469 6e67 206e  llow inserting n
-0000e350: 6577 2063 6f6f 7264 696e 6174 6573 2077  ew coordinates w
-0000e360: 6974 6820 7468 6973 206d 6574 686f 642c  ith this method,
-0000e370: 206c 696b 650a 2020 2020 2020 2020 2320   like.        # 
-0000e380: 4461 7461 4672 616d 652e 7365 745f 696e  DataFrame.set_in
-0000e390: 6465 783f 0a20 2020 2020 2020 2023 206e  dex?.        # n
-0000e3a0: 622e 2063 6865 636b 2069 6e20 7365 6c66  b. check in self
-0000e3b0: 2e5f 7661 7269 6162 6c65 732c 206e 6f74  ._variables, not
-0000e3c0: 2073 656c 662e 6461 7461 5f76 6172 7320   self.data_vars 
-0000e3d0: 746f 2069 6e73 7572 6520 7468 6174 2074  to insure that t
-0000e3e0: 6865 0a20 2020 2020 2020 2023 206f 7065  he.        # ope
-0000e3f0: 7261 7469 6f6e 2069 7320 6964 656d 706f  ration is idempo
-0000e400: 7465 6e74 0a20 2020 2020 2020 2069 6620  tent.        if 
-0000e410: 6973 696e 7374 616e 6365 286e 616d 6573  isinstance(names
-0000e420: 2c20 7374 7229 206f 7220 6e6f 7420 6973  , str) or not is
-0000e430: 696e 7374 616e 6365 286e 616d 6573 2c20  instance(names, 
-0000e440: 4974 6572 6162 6c65 293a 0a20 2020 2020  Iterable):.     
-0000e450: 2020 2020 2020 206e 616d 6573 203d 205b         names = [
-0000e460: 6e61 6d65 735d 0a20 2020 2020 2020 2065  names].        e
-0000e470: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000e480: 206e 616d 6573 203d 206c 6973 7428 6e61   names = list(na
-0000e490: 6d65 7329 0a20 2020 2020 2020 2073 656c  mes).        sel
-0000e4a0: 662e 5f61 7373 6572 745f 616c 6c5f 696e  f._assert_all_in
-0000e4b0: 5f64 6174 6173 6574 286e 616d 6573 290a  _dataset(names).
-0000e4c0: 2020 2020 2020 2020 6f62 6a20 3d20 7365          obj = se
-0000e4d0: 6c66 2e63 6f70 7928 290a 2020 2020 2020  lf.copy().      
-0000e4e0: 2020 6f62 6a2e 5f63 6f6f 7264 5f6e 616d    obj._coord_nam
-0000e4f0: 6573 2e75 7064 6174 6528 6e61 6d65 7329  es.update(names)
-0000e500: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000e510: 6f62 6a0a 0a20 2020 2064 6566 2072 6573  obj..    def res
-0000e520: 6574 5f63 6f6f 7264 7328 0a20 2020 2020  et_coords(.     
-0000e530: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-0000e540: 6574 2c0a 2020 2020 2020 2020 6e61 6d65  et,.        name
-0000e550: 733a 2044 696d 7320 3d20 4e6f 6e65 2c0a  s: Dims = None,.
-0000e560: 2020 2020 2020 2020 6472 6f70 3a20 626f          drop: bo
-0000e570: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0000e580: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-0000e590: 2020 2020 2020 2020 2222 2247 6976 656e          """Given
-0000e5a0: 206e 616d 6573 206f 6620 636f 6f72 6469   names of coordi
-0000e5b0: 6e61 7465 732c 2072 6573 6574 2074 6865  nates, reset the
-0000e5c0: 6d20 746f 2062 6563 6f6d 6520 7661 7269  m to become vari
-0000e5d0: 6162 6c65 730a 0a20 2020 2020 2020 2050  ables..        P
-0000e5e0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-0000e5f0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0000e600: 2020 2020 206e 616d 6573 203a 2073 7472       names : str
-0000e610: 2c20 4974 6572 6162 6c65 206f 6620 4861  , Iterable of Ha
-0000e620: 7368 6162 6c65 206f 7220 4e6f 6e65 2c20  shable or None, 
-0000e630: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0000e640: 2020 2020 204e 616d 6528 7329 206f 6620       Name(s) of 
-0000e650: 6e6f 6e2d 696e 6465 7820 636f 6f72 6469  non-index coordi
-0000e660: 6e61 7465 7320 696e 2074 6869 7320 6461  nates in this da
-0000e670: 7461 7365 7420 746f 2072 6573 6574 2069  taset to reset i
-0000e680: 6e74 6f0a 2020 2020 2020 2020 2020 2020  nto.            
-0000e690: 7661 7269 6162 6c65 732e 2042 7920 6465  variables. By de
-0000e6a0: 6661 756c 742c 2061 6c6c 206e 6f6e 2d69  fault, all non-i
-0000e6b0: 6e64 6578 2063 6f6f 7264 696e 6174 6573  ndex coordinates
-0000e6c0: 2061 7265 2072 6573 6574 2e0a 2020 2020   are reset..    
-0000e6d0: 2020 2020 6472 6f70 203a 2062 6f6f 6c2c      drop : bool,
-0000e6e0: 2064 6566 6175 6c74 3a20 4661 6c73 650a   default: False.
-0000e6f0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-0000e700: 7275 652c 2072 656d 6f76 6520 636f 6f72  rue, remove coor
-0000e710: 6469 6e61 7465 7320 696e 7374 6561 6420  dinates instead 
-0000e720: 6f66 2063 6f6e 7665 7274 696e 6720 7468  of converting th
-0000e730: 656d 2069 6e74 6f0a 2020 2020 2020 2020  em into.        
-0000e740: 2020 2020 7661 7269 6162 6c65 732e 0a0a      variables...
-0000e750: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-0000e760: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-0000e770: 2020 2020 2020 2020 4461 7461 7365 740a          Dataset.
-0000e780: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000e790: 2020 2020 6966 206e 616d 6573 2069 7320      if names is 
-0000e7a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000e7b0: 2020 6e61 6d65 7320 3d20 7365 6c66 2e5f    names = self._
-0000e7c0: 636f 6f72 645f 6e61 6d65 7320 2d20 7365  coord_names - se
-0000e7d0: 7428 7365 6c66 2e5f 696e 6465 7865 7329  t(self._indexes)
-0000e7e0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000e7f0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0000e800: 696e 7374 616e 6365 286e 616d 6573 2c20  instance(names, 
-0000e810: 7374 7229 206f 7220 6e6f 7420 6973 696e  str) or not isin
-0000e820: 7374 616e 6365 286e 616d 6573 2c20 4974  stance(names, It
-0000e830: 6572 6162 6c65 293a 0a20 2020 2020 2020  erable):.       
-0000e840: 2020 2020 2020 2020 206e 616d 6573 203d           names =
-0000e850: 205b 6e61 6d65 735d 0a20 2020 2020 2020   [names].       
-0000e860: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000e870: 2020 2020 2020 2020 2020 206e 616d 6573             names
-0000e880: 203d 206c 6973 7428 6e61 6d65 7329 0a20   = list(names). 
-0000e890: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000e8a0: 5f61 7373 6572 745f 616c 6c5f 696e 5f64  _assert_all_in_d
-0000e8b0: 6174 6173 6574 286e 616d 6573 290a 2020  ataset(names).  
-0000e8c0: 2020 2020 2020 2020 2020 6261 645f 636f            bad_co
-0000e8d0: 6f72 6473 203d 2073 6574 286e 616d 6573  ords = set(names
-0000e8e0: 2920 2620 7365 7428 7365 6c66 2e5f 696e  ) & set(self._in
-0000e8f0: 6465 7865 7329 0a20 2020 2020 2020 2020  dexes).         
-0000e900: 2020 2069 6620 6261 645f 636f 6f72 6473     if bad_coords
-0000e910: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000e920: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0000e930: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000e940: 2020 2020 2020 2020 6622 6361 6e6e 6f74          f"cannot
-0000e950: 2072 656d 6f76 6520 696e 6465 7820 636f   remove index co
-0000e960: 6f72 6469 6e61 7465 7320 7769 7468 2072  ordinates with r
-0000e970: 6573 6574 5f63 6f6f 7264 733a 207b 6261  eset_coords: {ba
-0000e980: 645f 636f 6f72 6473 7d22 0a20 2020 2020  d_coords}".     
-0000e990: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000e9a0: 2020 2020 206f 626a 203d 2073 656c 662e       obj = self.
-0000e9b0: 636f 7079 2829 0a20 2020 2020 2020 206f  copy().        o
-0000e9c0: 626a 2e5f 636f 6f72 645f 6e61 6d65 732e  bj._coord_names.
-0000e9d0: 6469 6666 6572 656e 6365 5f75 7064 6174  difference_updat
-0000e9e0: 6528 6e61 6d65 7329 0a20 2020 2020 2020  e(names).       
-0000e9f0: 2069 6620 6472 6f70 3a0a 2020 2020 2020   if drop:.      
-0000ea00: 2020 2020 2020 666f 7220 6e61 6d65 2069        for name i
-0000ea10: 6e20 6e61 6d65 733a 0a20 2020 2020 2020  n names:.       
-0000ea20: 2020 2020 2020 2020 2064 656c 206f 626a           del obj
-0000ea30: 2e5f 7661 7269 6162 6c65 735b 6e61 6d65  ._variables[name
-0000ea40: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
-0000ea50: 206f 626a 0a0a 2020 2020 6465 6620 6475   obj..    def du
-0000ea60: 6d70 5f74 6f5f 7374 6f72 6528 7365 6c66  mp_to_store(self
-0000ea70: 2c20 7374 6f72 653a 2041 6273 7472 6163  , store: Abstrac
-0000ea80: 7444 6174 6153 746f 7265 2c20 2a2a 6b77  tDataStore, **kw
-0000ea90: 6172 6773 2920 2d3e 204e 6f6e 653a 0a20  args) -> None:. 
-0000eaa0: 2020 2020 2020 2022 2222 5374 6f72 6520         """Store 
-0000eab0: 6461 7461 7365 7420 636f 6e74 656e 7473  dataset contents
-0000eac0: 2074 6f20 6120 6261 636b 656e 6473 2e2a   to a backends.*
-0000ead0: 4461 7461 5374 6f72 6520 6f62 6a65 6374  DataStore object
-0000eae0: 2e22 2222 0a20 2020 2020 2020 2066 726f  .""".        fro
-0000eaf0: 6d20 7861 7272 6179 2e62 6163 6b65 6e64  m xarray.backend
-0000eb00: 732e 6170 6920 696d 706f 7274 2064 756d  s.api import dum
-0000eb10: 705f 746f 5f73 746f 7265 0a0a 2020 2020  p_to_store..    
-0000eb20: 2020 2020 2320 544f 444f 3a20 7265 6e61      # TODO: rena
-0000eb30: 6d65 2061 6e64 2f6f 7220 636c 6561 6e75  me and/or cleanu
-0000eb40: 7020 7468 6973 206d 6574 686f 6420 746f  p this method to
-0000eb50: 206d 616b 6520 6974 206d 6f72 6520 636f   make it more co
-0000eb60: 6e73 6973 7465 6e74 0a20 2020 2020 2020  nsistent.       
-0000eb70: 2023 2077 6974 6820 746f 5f6e 6574 6364   # with to_netcd
-0000eb80: 6628 290a 2020 2020 2020 2020 6475 6d70  f().        dump
-0000eb90: 5f74 6f5f 7374 6f72 6528 7365 6c66 2c20  _to_store(self, 
-0000eba0: 7374 6f72 652c 202a 2a6b 7761 7267 7329  store, **kwargs)
-0000ebb0: 0a0a 2020 2020 2320 7061 7468 3d4e 6f6e  ..    # path=Non
-0000ebc0: 6520 7772 6974 6573 2074 6f20 6279 7465  e writes to byte
-0000ebd0: 730a 2020 2020 406f 7665 726c 6f61 640a  s.    @overload.
-0000ebe0: 2020 2020 6465 6620 746f 5f6e 6574 6364      def to_netcd
-0000ebf0: 6628 0a20 2020 2020 2020 2073 656c 662c  f(.        self,
-0000ec00: 0a20 2020 2020 2020 2070 6174 683a 204e  .        path: N
-0000ec10: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-0000ec20: 2020 2020 6d6f 6465 3a20 4c69 7465 7261      mode: Litera
-0000ec30: 6c5b 2277 222c 2022 6122 5d20 3d20 2277  l["w", "a"] = "w
-0000ec40: 222c 0a20 2020 2020 2020 2066 6f72 6d61  ",.        forma
-0000ec50: 743a 2054 5f4e 6574 6364 6654 7970 6573  t: T_NetcdfTypes
-0000ec60: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-0000ec70: 2020 2020 2020 2020 6772 6f75 703a 2073          group: s
-0000ec80: 7472 207c 204e 6f6e 6520 3d20 4e6f 6e65  tr | None = None
-0000ec90: 2c0a 2020 2020 2020 2020 656e 6769 6e65  ,.        engine
-0000eca0: 3a20 545f 4e65 7463 6466 456e 6769 6e65  : T_NetcdfEngine
-0000ecb0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-0000ecc0: 2020 2020 2020 2020 656e 636f 6469 6e67          encoding
-0000ecd0: 3a20 4d61 7070 696e 675b 416e 792c 204d  : Mapping[Any, M
-0000ece0: 6170 7069 6e67 5b73 7472 2c20 416e 795d  apping[str, Any]
-0000ecf0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-0000ed00: 0a20 2020 2020 2020 2075 6e6c 696d 6974  .        unlimit
-0000ed10: 6564 5f64 696d 733a 2049 7465 7261 626c  ed_dims: Iterabl
-0000ed20: 655b 4861 7368 6162 6c65 5d20 7c20 4e6f  e[Hashable] | No
-0000ed30: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
-0000ed40: 2020 2063 6f6d 7075 7465 3a20 626f 6f6c     compute: bool
-0000ed50: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
-0000ed60: 2069 6e76 616c 6964 5f6e 6574 6364 663a   invalid_netcdf:
-0000ed70: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-0000ed80: 2020 2029 202d 3e20 6279 7465 733a 0a20     ) -> bytes:. 
-0000ed90: 2020 2020 2020 202e 2e2e 0a0a 2020 2020         .....    
-0000eda0: 2320 6465 6661 756c 7420 7265 7475 726e  # default return
-0000edb0: 204e 6f6e 650a 2020 2020 406f 7665 726c   None.    @overl
-0000edc0: 6f61 640a 2020 2020 6465 6620 746f 5f6e  oad.    def to_n
-0000edd0: 6574 6364 6628 0a20 2020 2020 2020 2073  etcdf(.        s
-0000ede0: 656c 662c 0a20 2020 2020 2020 2070 6174  elf,.        pat
-0000edf0: 683a 2073 7472 207c 2050 6174 684c 696b  h: str | PathLik
-0000ee00: 652c 0a20 2020 2020 2020 206d 6f64 653a  e,.        mode:
-0000ee10: 204c 6974 6572 616c 5b22 7722 2c20 2261   Literal["w", "a
-0000ee20: 225d 203d 2022 7722 2c0a 2020 2020 2020  "] = "w",.      
-0000ee30: 2020 666f 726d 6174 3a20 545f 4e65 7463    format: T_Netc
-0000ee40: 6466 5479 7065 7320 7c20 4e6f 6e65 203d  dfTypes | None =
-0000ee50: 204e 6f6e 652c 0a20 2020 2020 2020 2067   None,.        g
-0000ee60: 726f 7570 3a20 7374 7220 7c20 4e6f 6e65  roup: str | None
-0000ee70: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0000ee80: 2065 6e67 696e 653a 2054 5f4e 6574 6364   engine: T_Netcd
-0000ee90: 6645 6e67 696e 6520 7c20 4e6f 6e65 203d  fEngine | None =
-0000eea0: 204e 6f6e 652c 0a20 2020 2020 2020 2065   None,.        e
-0000eeb0: 6e63 6f64 696e 673a 204d 6170 7069 6e67  ncoding: Mapping
-0000eec0: 5b41 6e79 2c20 4d61 7070 696e 675b 7374  [Any, Mapping[st
-0000eed0: 722c 2041 6e79 5d5d 207c 204e 6f6e 6520  r, Any]] | None 
-0000eee0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0000eef0: 756e 6c69 6d69 7465 645f 6469 6d73 3a20  unlimited_dims: 
-0000ef00: 4974 6572 6162 6c65 5b48 6173 6861 626c  Iterable[Hashabl
-0000ef10: 655d 207c 204e 6f6e 6520 3d20 4e6f 6e65  e] | None = None
-0000ef20: 2c0a 2020 2020 2020 2020 636f 6d70 7574  ,.        comput
-0000ef30: 653a 204c 6974 6572 616c 5b54 7275 655d  e: Literal[True]
-0000ef40: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
-0000ef50: 2069 6e76 616c 6964 5f6e 6574 6364 663a   invalid_netcdf:
-0000ef60: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-0000ef70: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-0000ef80: 2020 2020 2020 2e2e 2e0a 0a20 2020 2023        .....    #
-0000ef90: 2063 6f6d 7075 7465 3d46 616c 7365 2072   compute=False r
-0000efa0: 6574 7572 6e73 2064 6173 6b2e 4465 6c61  eturns dask.Dela
-0000efb0: 7965 640a 2020 2020 406f 7665 726c 6f61  yed.    @overloa
-0000efc0: 640a 2020 2020 6465 6620 746f 5f6e 6574  d.    def to_net
-0000efd0: 6364 6628 0a20 2020 2020 2020 2073 656c  cdf(.        sel
-0000efe0: 662c 0a20 2020 2020 2020 2070 6174 683a  f,.        path:
-0000eff0: 2073 7472 207c 2050 6174 684c 696b 652c   str | PathLike,
-0000f000: 0a20 2020 2020 2020 206d 6f64 653a 204c  .        mode: L
-0000f010: 6974 6572 616c 5b22 7722 2c20 2261 225d  iteral["w", "a"]
-0000f020: 203d 2022 7722 2c0a 2020 2020 2020 2020   = "w",.        
-0000f030: 666f 726d 6174 3a20 545f 4e65 7463 6466  format: T_Netcdf
-0000f040: 5479 7065 7320 7c20 4e6f 6e65 203d 204e  Types | None = N
-0000f050: 6f6e 652c 0a20 2020 2020 2020 2067 726f  one,.        gro
-0000f060: 7570 3a20 7374 7220 7c20 4e6f 6e65 203d  up: str | None =
-0000f070: 204e 6f6e 652c 0a20 2020 2020 2020 2065   None,.        e
-0000f080: 6e67 696e 653a 2054 5f4e 6574 6364 6645  ngine: T_NetcdfE
-0000f090: 6e67 696e 6520 7c20 4e6f 6e65 203d 204e  ngine | None = N
-0000f0a0: 6f6e 652c 0a20 2020 2020 2020 2065 6e63  one,.        enc
-0000f0b0: 6f64 696e 673a 204d 6170 7069 6e67 5b41  oding: Mapping[A
-0000f0c0: 6e79 2c20 4d61 7070 696e 675b 7374 722c  ny, Mapping[str,
-0000f0d0: 2041 6e79 5d5d 207c 204e 6f6e 6520 3d20   Any]] | None = 
-0000f0e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 756e  None,.        un
-0000f0f0: 6c69 6d69 7465 645f 6469 6d73 3a20 4974  limited_dims: It
-0000f100: 6572 6162 6c65 5b48 6173 6861 626c 655d  erable[Hashable]
-0000f110: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-0000f120: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
-0000f130: 2020 2063 6f6d 7075 7465 3a20 4c69 7465     compute: Lite
-0000f140: 7261 6c5b 4661 6c73 655d 2c0a 2020 2020  ral[False],.    
-0000f150: 2020 2020 696e 7661 6c69 645f 6e65 7463      invalid_netc
-0000f160: 6466 3a20 626f 6f6c 203d 2046 616c 7365  df: bool = False
-0000f170: 2c0a 2020 2020 2920 2d3e 2044 656c 6179  ,.    ) -> Delay
-0000f180: 6564 3a0a 2020 2020 2020 2020 2e2e 2e0a  ed:.        ....
-0000f190: 0a20 2020 2064 6566 2074 6f5f 6e65 7463  .    def to_netc
-0000f1a0: 6466 280a 2020 2020 2020 2020 7365 6c66  df(.        self
-0000f1b0: 2c0a 2020 2020 2020 2020 7061 7468 3a20  ,.        path: 
-0000f1c0: 7374 7220 7c20 5061 7468 4c69 6b65 207c  str | PathLike |
-0000f1d0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-0000f1e0: 2020 2020 2020 6d6f 6465 3a20 4c69 7465        mode: Lite
-0000f1f0: 7261 6c5b 2277 222c 2022 6122 5d20 3d20  ral["w", "a"] = 
-0000f200: 2277 222c 0a20 2020 2020 2020 2066 6f72  "w",.        for
-0000f210: 6d61 743a 2054 5f4e 6574 6364 6654 7970  mat: T_NetcdfTyp
-0000f220: 6573 207c 204e 6f6e 6520 3d20 4e6f 6e65  es | None = None
-0000f230: 2c0a 2020 2020 2020 2020 6772 6f75 703a  ,.        group:
-0000f240: 2073 7472 207c 204e 6f6e 6520 3d20 4e6f   str | None = No
-0000f250: 6e65 2c0a 2020 2020 2020 2020 656e 6769  ne,.        engi
-0000f260: 6e65 3a20 545f 4e65 7463 6466 456e 6769  ne: T_NetcdfEngi
-0000f270: 6e65 207c 204e 6f6e 6520 3d20 4e6f 6e65  ne | None = None
-0000f280: 2c0a 2020 2020 2020 2020 656e 636f 6469  ,.        encodi
-0000f290: 6e67 3a20 4d61 7070 696e 675b 416e 792c  ng: Mapping[Any,
-0000f2a0: 204d 6170 7069 6e67 5b73 7472 2c20 416e   Mapping[str, An
-0000f2b0: 795d 5d20 7c20 4e6f 6e65 203d 204e 6f6e  y]] | None = Non
-0000f2c0: 652c 0a20 2020 2020 2020 2075 6e6c 696d  e,.        unlim
-0000f2d0: 6974 6564 5f64 696d 733a 2049 7465 7261  ited_dims: Itera
-0000f2e0: 626c 655b 4861 7368 6162 6c65 5d20 7c20  ble[Hashable] | 
-0000f2f0: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-0000f300: 2020 2020 2063 6f6d 7075 7465 3a20 626f       compute: bo
-0000f310: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
-0000f320: 2020 2069 6e76 616c 6964 5f6e 6574 6364     invalid_netcd
-0000f330: 663a 2062 6f6f 6c20 3d20 4661 6c73 652c  f: bool = False,
-0000f340: 0a20 2020 2029 202d 3e20 6279 7465 7320  .    ) -> bytes 
-0000f350: 7c20 4465 6c61 7965 6420 7c20 4e6f 6e65  | Delayed | None
-0000f360: 3a0a 2020 2020 2020 2020 2222 2257 7269  :.        """Wri
-0000f370: 7465 2064 6174 6173 6574 2063 6f6e 7465  te dataset conte
-0000f380: 6e74 7320 746f 2061 206e 6574 4344 4620  nts to a netCDF 
-0000f390: 6669 6c65 2e0a 0a20 2020 2020 2020 2050  file...        P
-0000f3a0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-0000f3b0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0000f3c0: 2020 2020 2070 6174 6820 3a20 7374 722c       path : str,
-0000f3d0: 2070 6174 682d 6c69 6b65 206f 7220 6669   path-like or fi
-0000f3e0: 6c65 2d6c 696b 652c 206f 7074 696f 6e61  le-like, optiona
-0000f3f0: 6c0a 2020 2020 2020 2020 2020 2020 5061  l.            Pa
-0000f400: 7468 2074 6f20 7768 6963 6820 746f 2073  th to which to s
-0000f410: 6176 6520 7468 6973 2064 6174 6173 6574  ave this dataset
-0000f420: 2e20 4669 6c65 2d6c 696b 6520 6f62 6a65  . File-like obje
-0000f430: 6374 7320 6172 6520 6f6e 6c79 0a20 2020  cts are only.   
-0000f440: 2020 2020 2020 2020 2073 7570 706f 7274           support
-0000f450: 6564 2062 7920 7468 6520 7363 6970 7920  ed by the scipy 
-0000f460: 656e 6769 6e65 2e20 4966 206e 6f20 7061  engine. If no pa
-0000f470: 7468 2069 7320 7072 6f76 6964 6564 2c20  th is provided, 
-0000f480: 7468 6973 0a20 2020 2020 2020 2020 2020  this.           
-0000f490: 2066 756e 6374 696f 6e20 7265 7475 726e   function return
-0000f4a0: 7320 7468 6520 7265 7375 6c74 696e 6720  s the resulting 
-0000f4b0: 6e65 7443 4446 2066 696c 6520 6173 2062  netCDF file as b
-0000f4c0: 7974 6573 3b20 696e 2074 6869 7320 6361  ytes; in this ca
-0000f4d0: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-0000f4e0: 7765 206e 6565 6420 746f 2075 7365 2073  we need to use s
-0000f4f0: 6369 7079 2c20 7768 6963 6820 646f 6573  cipy, which does
-0000f500: 206e 6f74 2073 7570 706f 7274 206e 6574   not support net
-0000f510: 4344 4620 7665 7273 696f 6e20 3420 2874  CDF version 4 (t
-0000f520: 6865 0a20 2020 2020 2020 2020 2020 2064  he.            d
-0000f530: 6566 6175 6c74 2066 6f72 6d61 7420 6265  efault format be
-0000f540: 636f 6d65 7320 4e45 5443 4446 335f 3634  comes NETCDF3_64
-0000f550: 4249 5429 2e0a 2020 2020 2020 2020 6d6f  BIT)..        mo
-0000f560: 6465 203a 207b 2277 222c 2022 6122 7d2c  de : {"w", "a"},
-0000f570: 2064 6566 6175 6c74 3a20 2277 220a 2020   default: "w".  
-0000f580: 2020 2020 2020 2020 2020 5772 6974 6520            Write 
-0000f590: 2827 7727 2920 6f72 2061 7070 656e 6420  ('w') or append 
-0000f5a0: 2827 6127 2920 6d6f 6465 2e20 4966 206d  ('a') mode. If m
-0000f5b0: 6f64 653d 2777 272c 2061 6e79 2065 7869  ode='w', any exi
-0000f5c0: 7374 696e 6720 6669 6c65 2061 740a 2020  sting file at.  
-0000f5d0: 2020 2020 2020 2020 2020 7468 6973 206c            this l
-0000f5e0: 6f63 6174 696f 6e20 7769 6c6c 2062 6520  ocation will be 
-0000f5f0: 6f76 6572 7772 6974 7465 6e2e 2049 6620  overwritten. If 
-0000f600: 6d6f 6465 3d27 6127 2c20 6578 6973 7469  mode='a', existi
-0000f610: 6e67 2076 6172 6961 626c 6573 0a20 2020  ng variables.   
-0000f620: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
-0000f630: 206f 7665 7277 7269 7474 656e 2e0a 2020   overwritten..  
-0000f640: 2020 2020 2020 666f 726d 6174 203a 207b        format : {
-0000f650: 224e 4554 4344 4634 222c 2022 4e45 5443  "NETCDF4", "NETC
-0000f660: 4446 345f 434c 4153 5349 4322 2c20 224e  DF4_CLASSIC", "N
-0000f670: 4554 4344 4633 5f36 3442 4954 222c 205c  ETCDF3_64BIT", \
-0000f680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f690: 2020 2022 4e45 5443 4446 335f 434c 4153     "NETCDF3_CLAS
-0000f6a0: 5349 4322 7d2c 206f 7074 696f 6e61 6c0a  SIC"}, optional.
-0000f6b0: 2020 2020 2020 2020 2020 2020 4669 6c65              File
-0000f6c0: 2066 6f72 6d61 7420 666f 7220 7468 6520   format for the 
-0000f6d0: 7265 7375 6c74 696e 6720 6e65 7443 4446  resulting netCDF
-0000f6e0: 2066 696c 653a 0a0a 2020 2020 2020 2020   file:..        
-0000f6f0: 2020 2020 2a20 4e45 5443 4446 343a 2044      * NETCDF4: D
-0000f700: 6174 6120 6973 2073 746f 7265 6420 696e  ata is stored in
-0000f710: 2061 6e20 4844 4635 2066 696c 652c 2075   an HDF5 file, u
-0000f720: 7369 6e67 206e 6574 4344 4634 2041 5049  sing netCDF4 API
-0000f730: 0a20 2020 2020 2020 2020 2020 2020 2066  .              f
-0000f740: 6561 7475 7265 732e 0a20 2020 2020 2020  eatures..       
-0000f750: 2020 2020 202a 204e 4554 4344 4634 5f43       * NETCDF4_C
-0000f760: 4c41 5353 4943 3a20 4461 7461 2069 7320  LASSIC: Data is 
-0000f770: 7374 6f72 6564 2069 6e20 616e 2048 4446  stored in an HDF
-0000f780: 3520 6669 6c65 2c20 7573 696e 6720 6f6e  5 file, using on
-0000f790: 6c79 0a20 2020 2020 2020 2020 2020 2020  ly.             
-0000f7a0: 206e 6574 4344 4620 3320 636f 6d70 6174   netCDF 3 compat
-0000f7b0: 6962 6c65 2041 5049 2066 6561 7475 7265  ible API feature
-0000f7c0: 732e 0a20 2020 2020 2020 2020 2020 202a  s..            *
-0000f7d0: 204e 4554 4344 4633 5f36 3442 4954 3a20   NETCDF3_64BIT: 
-0000f7e0: 3634 2d62 6974 206f 6666 7365 7420 7665  64-bit offset ve
-0000f7f0: 7273 696f 6e20 6f66 2074 6865 206e 6574  rsion of the net
-0000f800: 4344 4620 3320 6669 6c65 2066 6f72 6d61  CDF 3 file forma
-0000f810: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-0000f820: 2077 6869 6368 2066 756c 6c79 2073 7570   which fully sup
-0000f830: 706f 7274 7320 322b 2047 4220 6669 6c65  ports 2+ GB file
-0000f840: 732c 2062 7574 2069 7320 6f6e 6c79 2063  s, but is only c
-0000f850: 6f6d 7061 7469 626c 6520 7769 7468 0a20  ompatible with. 
-0000f860: 2020 2020 2020 2020 2020 2020 2063 6c69               cli
-0000f870: 656e 7473 206c 696e 6b65 6420 6167 6169  ents linked agai
-0000f880: 6e73 7420 6e65 7443 4446 2076 6572 7369  nst netCDF versi
-0000f890: 6f6e 2033 2e36 2e30 206f 7220 6c61 7465  on 3.6.0 or late
-0000f8a0: 722e 0a20 2020 2020 2020 2020 2020 202a  r..            *
-0000f8b0: 204e 4554 4344 4633 5f43 4c41 5353 4943   NETCDF3_CLASSIC
-0000f8c0: 3a20 5468 6520 636c 6173 7369 6320 6e65  : The classic ne
-0000f8d0: 7443 4446 2033 2066 696c 6520 666f 726d  tCDF 3 file form
-0000f8e0: 6174 2e20 4974 2064 6f65 7320 6e6f 740a  at. It does not.
-0000f8f0: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-0000f900: 6e64 6c65 2032 2b20 4742 2066 696c 6573  ndle 2+ GB files
-0000f910: 2076 6572 7920 7765 6c6c 2e0a 0a20 2020   very well...   
-0000f920: 2020 2020 2020 2020 2041 6c6c 2066 6f72           All for
-0000f930: 6d61 7473 2061 7265 2073 7570 706f 7274  mats are support
-0000f940: 6564 2062 7920 7468 6520 6e65 7443 4446  ed by the netCDF
-0000f950: 342d 7079 7468 6f6e 206c 6962 7261 7279  4-python library
-0000f960: 2e0a 2020 2020 2020 2020 2020 2020 7363  ..            sc
-0000f970: 6970 792e 696f 2e6e 6574 6364 6620 6f6e  ipy.io.netcdf on
-0000f980: 6c79 2073 7570 706f 7274 7320 7468 6520  ly supports the 
-0000f990: 6c61 7374 2074 776f 2066 6f72 6d61 7473  last two formats
-0000f9a0: 2e0a 0a20 2020 2020 2020 2020 2020 2054  ...            T
-0000f9b0: 6865 2064 6566 6175 6c74 2066 6f72 6d61  he default forma
-0000f9c0: 7420 6973 204e 4554 4344 4634 2069 6620  t is NETCDF4 if 
-0000f9d0: 796f 7520 6172 6520 7361 7669 6e67 2061  you are saving a
-0000f9e0: 2066 696c 6520 746f 2064 6973 6b20 616e   file to disk an
-0000f9f0: 640a 2020 2020 2020 2020 2020 2020 6861  d.            ha
-0000fa00: 7665 2074 6865 206e 6574 4344 4634 2d70  ve the netCDF4-p
-0000fa10: 7974 686f 6e20 6c69 6272 6172 7920 6176  ython library av
-0000fa20: 6169 6c61 626c 652e 204f 7468 6572 7769  ailable. Otherwi
-0000fa30: 7365 2c20 7861 7272 6179 2066 616c 6c73  se, xarray falls
-0000fa40: 0a20 2020 2020 2020 2020 2020 2062 6163  .            bac
-0000fa50: 6b20 746f 2075 7369 6e67 2073 6369 7079  k to using scipy
-0000fa60: 2074 6f20 7772 6974 6520 6e65 7443 4446   to write netCDF
-0000fa70: 2066 696c 6573 2061 6e64 2064 6566 6175   files and defau
-0000fa80: 6c74 7320 746f 2074 6865 0a20 2020 2020  lts to the.     
-0000fa90: 2020 2020 2020 204e 4554 4344 4633 5f36         NETCDF3_6
-0000faa0: 3442 4954 2066 6f72 6d61 7420 2873 6369  4BIT format (sci
-0000fab0: 7079 2064 6f65 7320 6e6f 7420 7375 7070  py does not supp
-0000fac0: 6f72 7420 6e65 7443 4446 3429 2e0a 2020  ort netCDF4)..  
-0000fad0: 2020 2020 2020 6772 6f75 7020 3a20 7374        group : st
-0000fae0: 722c 206f 7074 696f 6e61 6c0a 2020 2020  r, optional.    
-0000faf0: 2020 2020 2020 2020 5061 7468 2074 6f20          Path to 
-0000fb00: 7468 6520 6e65 7443 4446 3420 6772 6f75  the netCDF4 grou
-0000fb10: 7020 696e 2074 6865 2067 6976 656e 2066  p in the given f
-0000fb20: 696c 6520 746f 206f 7065 6e20 286f 6e6c  ile to open (onl
-0000fb30: 7920 776f 726b 7320 666f 720a 2020 2020  y works for.    
-0000fb40: 2020 2020 2020 2020 666f 726d 6174 3d27          format='
-0000fb50: 4e45 5443 4446 3427 292e 2054 6865 2067  NETCDF4'). The g
-0000fb60: 726f 7570 2873 2920 7769 6c6c 2062 6520  roup(s) will be 
-0000fb70: 6372 6561 7465 6420 6966 206e 6563 6573  created if neces
-0000fb80: 7361 7279 2e0a 2020 2020 2020 2020 656e  sary..        en
-0000fb90: 6769 6e65 203a 207b 226e 6574 6364 6634  gine : {"netcdf4
-0000fba0: 222c 2022 7363 6970 7922 2c20 2268 356e  ", "scipy", "h5n
-0000fbb0: 6574 6364 6622 7d2c 206f 7074 696f 6e61  etcdf"}, optiona
-0000fbc0: 6c0a 2020 2020 2020 2020 2020 2020 456e  l.            En
-0000fbd0: 6769 6e65 2074 6f20 7573 6520 7768 656e  gine to use when
-0000fbe0: 2077 7269 7469 6e67 206e 6574 4344 4620   writing netCDF 
-0000fbf0: 6669 6c65 732e 2049 6620 6e6f 7420 7072  files. If not pr
-0000fc00: 6f76 6964 6564 2c20 7468 650a 2020 2020  ovided, the.    
-0000fc10: 2020 2020 2020 2020 6465 6661 756c 7420          default 
-0000fc20: 656e 6769 6e65 2069 7320 6368 6f73 656e  engine is chosen
-0000fc30: 2062 6173 6564 206f 6e20 6176 6169 6c61   based on availa
-0000fc40: 626c 6520 6465 7065 6e64 656e 6369 6573  ble dependencies
-0000fc50: 2c20 7769 7468 2061 0a20 2020 2020 2020  , with a.       
-0000fc60: 2020 2020 2070 7265 6665 7265 6e63 6520       preference 
-0000fc70: 666f 7220 276e 6574 6364 6634 2720 6966  for 'netcdf4' if
-0000fc80: 2077 7269 7469 6e67 2074 6f20 6120 6669   writing to a fi
-0000fc90: 6c65 206f 6e20 6469 736b 2e0a 2020 2020  le on disk..    
-0000fca0: 2020 2020 656e 636f 6469 6e67 203a 2064      encoding : d
-0000fcb0: 6963 742c 206f 7074 696f 6e61 6c0a 2020  ict, optional.  
-0000fcc0: 2020 2020 2020 2020 2020 4e65 7374 6564            Nested
-0000fcd0: 2064 6963 7469 6f6e 6172 7920 7769 7468   dictionary with
-0000fce0: 2076 6172 6961 626c 6520 6e61 6d65 7320   variable names 
-0000fcf0: 6173 206b 6579 7320 616e 6420 6469 6374  as keys and dict
-0000fd00: 696f 6e61 7269 6573 206f 660a 2020 2020  ionaries of.    
-0000fd10: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0000fd20: 2073 7065 6369 6669 6320 656e 636f 6469   specific encodi
-0000fd30: 6e67 7320 6173 2076 616c 7565 732c 2065  ngs as values, e
-0000fd40: 2e67 2e2c 0a20 2020 2020 2020 2020 2020  .g.,.           
-0000fd50: 2060 607b 226d 795f 7661 7269 6162 6c65   ``{"my_variable
-0000fd60: 223a 207b 2264 7479 7065 223a 2022 696e  ": {"dtype": "in
-0000fd70: 7431 3622 2c20 2273 6361 6c65 5f66 6163  t16", "scale_fac
-0000fd80: 746f 7222 3a20 302e 312c 0a20 2020 2020  tor": 0.1,.     
-0000fd90: 2020 2020 2020 2022 7a6c 6962 223a 2054         "zlib": T
-0000fda0: 7275 657d 2c20 2e2e 2e7d 6060 0a0a 2020  rue}, ...}``..  
-0000fdb0: 2020 2020 2020 2020 2020 5468 6520 6068            The `h
-0000fdc0: 356e 6574 6364 6660 2065 6e67 696e 6520  5netcdf` engine 
-0000fdd0: 7375 7070 6f72 7473 2062 6f74 6820 7468  supports both th
-0000fde0: 6520 4e65 7443 4446 342d 7374 796c 6520  e NetCDF4-style 
-0000fdf0: 636f 6d70 7265 7373 696f 6e0a 2020 2020  compression.    
-0000fe00: 2020 2020 2020 2020 656e 636f 6469 6e67          encoding
-0000fe10: 2070 6172 616d 6574 6572 7320 6060 7b22   parameters ``{"
-0000fe20: 7a6c 6962 223a 2054 7275 652c 2022 636f  zlib": True, "co
-0000fe30: 6d70 6c65 7665 6c22 3a20 397d 6060 2061  mplevel": 9}`` a
-0000fe40: 6e64 2074 6865 2068 3570 790a 2020 2020  nd the h5py.    
-0000fe50: 2020 2020 2020 2020 6f6e 6573 2060 607b          ones ``{
-0000fe60: 2263 6f6d 7072 6573 7369 6f6e 223a 2022  "compression": "
-0000fe70: 677a 6970 222c 2022 636f 6d70 7265 7373  gzip", "compress
-0000fe80: 696f 6e5f 6f70 7473 223a 2039 7d60 602e  ion_opts": 9}``.
-0000fe90: 0a20 2020 2020 2020 2020 2020 2054 6869  .            Thi
-0000fea0: 7320 616c 6c6f 7773 2075 7369 6e67 2061  s allows using a
-0000feb0: 6e79 2063 6f6d 7072 6573 7369 6f6e 2070  ny compression p
-0000fec0: 6c75 6769 6e20 696e 7374 616c 6c65 6420  lugin installed 
-0000fed0: 696e 2074 6865 2048 4446 350a 2020 2020  in the HDF5.    
-0000fee0: 2020 2020 2020 2020 6c69 6272 6172 792c          library,
-0000fef0: 2065 2e67 2e20 4c5a 462e 0a0a 2020 2020   e.g. LZF...    
-0000ff00: 2020 2020 756e 6c69 6d69 7465 645f 6469      unlimited_di
-0000ff10: 6d73 203a 2069 7465 7261 626c 6520 6f66  ms : iterable of
-0000ff20: 2068 6173 6861 626c 652c 206f 7074 696f   hashable, optio
-0000ff30: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-0000ff40: 4469 6d65 6e73 696f 6e28 7329 2074 6861  Dimension(s) tha
-0000ff50: 7420 7368 6f75 6c64 2062 6520 7365 7269  t should be seri
-0000ff60: 616c 697a 6564 2061 7320 756e 6c69 6d69  alized as unlimi
-0000ff70: 7465 6420 6469 6d65 6e73 696f 6e73 2e0a  ted dimensions..
-0000ff80: 2020 2020 2020 2020 2020 2020 4279 2064              By d
-0000ff90: 6566 6175 6c74 2c20 6e6f 2064 696d 656e  efault, no dimen
-0000ffa0: 7369 6f6e 7320 6172 6520 7472 6561 7465  sions are treate
-0000ffb0: 6420 6173 2075 6e6c 696d 6974 6564 2064  d as unlimited d
-0000ffc0: 696d 656e 7369 6f6e 732e 0a20 2020 2020  imensions..     
-0000ffd0: 2020 2020 2020 204e 6f74 6520 7468 6174         Note that
-0000ffe0: 2075 6e6c 696d 6974 6564 5f64 696d 7320   unlimited_dims 
-0000fff0: 6d61 7920 616c 736f 2062 6520 7365 7420  may also be set 
-00010000: 7669 610a 2020 2020 2020 2020 2020 2020  via.            
-00010010: 6060 6461 7461 7365 742e 656e 636f 6469  ``dataset.encodi
-00010020: 6e67 5b22 756e 6c69 6d69 7465 645f 6469  ng["unlimited_di
-00010030: 6d73 225d 6060 2e0a 2020 2020 2020 2020  ms"]``..        
-00010040: 636f 6d70 7574 653a 2062 6f6f 6c2c 2064  compute: bool, d
-00010050: 6566 6175 6c74 3a20 5472 7565 0a20 2020  efault: True.   
-00010060: 2020 2020 2020 2020 2049 6620 7472 7565           If true
-00010070: 2063 6f6d 7075 7465 2069 6d6d 6564 6961   compute immedia
-00010080: 7465 6c79 2c20 6f74 6865 7277 6973 6520  tely, otherwise 
-00010090: 7265 7475 726e 2061 0a20 2020 2020 2020  return a.       
-000100a0: 2020 2020 2060 6064 6173 6b2e 6465 6c61       ``dask.dela
-000100b0: 7965 642e 4465 6c61 7965 6460 6020 6f62  yed.Delayed`` ob
-000100c0: 6a65 6374 2074 6861 7420 6361 6e20 6265  ject that can be
-000100d0: 2063 6f6d 7075 7465 6420 6c61 7465 722e   computed later.
-000100e0: 0a20 2020 2020 2020 2069 6e76 616c 6964  .        invalid
-000100f0: 5f6e 6574 6364 663a 2062 6f6f 6c2c 2064  _netcdf: bool, d
-00010100: 6566 6175 6c74 3a20 4661 6c73 650a 2020  efault: False.  
-00010110: 2020 2020 2020 2020 2020 4f6e 6c79 2076            Only v
-00010120: 616c 6964 2061 6c6f 6e67 2077 6974 6820  alid along with 
-00010130: 6060 656e 6769 6e65 3d22 6835 6e65 7463  ``engine="h5netc
-00010140: 6466 2260 602e 2049 6620 5472 7565 2c20  df"``. If True, 
-00010150: 616c 6c6f 7720 7772 6974 696e 670a 2020  allow writing.  
-00010160: 2020 2020 2020 2020 2020 6864 6635 2066            hdf5 f
-00010170: 696c 6573 2077 6869 6368 2061 7265 2069  iles which are i
-00010180: 6e76 616c 6964 206e 6574 6364 6620 6173  nvalid netcdf as
-00010190: 2064 6573 6372 6962 6564 2069 6e0a 2020   described in.  
-000101a0: 2020 2020 2020 2020 2020 6874 7470 733a            https:
-000101b0: 2f2f 6769 7468 7562 2e63 6f6d 2f68 356e  //github.com/h5n
-000101c0: 6574 6364 662f 6835 6e65 7463 6466 2e0a  etcdf/h5netcdf..
-000101d0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-000101e0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-000101f0: 0a20 2020 2020 2020 2020 2020 202a 2060  .            * `
-00010200: 6062 7974 6573 6060 2069 6620 7061 7468  `bytes`` if path
-00010210: 2069 7320 4e6f 6e65 0a20 2020 2020 2020   is None.       
-00010220: 2020 2020 202a 2060 6064 6173 6b2e 6465       * ``dask.de
-00010230: 6c61 7965 642e 4465 6c61 7965 6460 6020  layed.Delayed`` 
-00010240: 6966 2063 6f6d 7075 7465 2069 7320 4661  if compute is Fa
-00010250: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00010260: 2a20 4e6f 6e65 206f 7468 6572 7769 7365  * None otherwise
-00010270: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-00010280: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-00010290: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
-000102a0: 4172 7261 792e 746f 5f6e 6574 6364 660a  Array.to_netcdf.
-000102b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000102c0: 2020 2020 6966 2065 6e63 6f64 696e 6720      if encoding 
-000102d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000102e0: 2020 2020 2065 6e63 6f64 696e 6720 3d20       encoding = 
-000102f0: 7b7d 0a20 2020 2020 2020 2066 726f 6d20  {}.        from 
-00010300: 7861 7272 6179 2e62 6163 6b65 6e64 732e  xarray.backends.
-00010310: 6170 6920 696d 706f 7274 2074 6f5f 6e65  api import to_ne
-00010320: 7463 6466 0a0a 2020 2020 2020 2020 7265  tcdf..        re
-00010330: 7475 726e 2074 6f5f 6e65 7463 6466 2820  turn to_netcdf( 
-00010340: 2023 2074 7970 653a 2069 676e 6f72 6520   # type: ignore 
-00010350: 2023 206d 7970 7920 6361 6e6e 6f74 2072   # mypy cannot r
-00010360: 6573 6f6c 7665 2074 6865 206f 7665 726c  esolve the overl
-00010370: 6f61 6473 3a28 0a20 2020 2020 2020 2020  oads:(.         
-00010380: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00010390: 2020 2020 2070 6174 682c 0a20 2020 2020       path,.     
-000103a0: 2020 2020 2020 206d 6f64 653d 6d6f 6465         mode=mode
-000103b0: 2c0a 2020 2020 2020 2020 2020 2020 666f  ,.            fo
-000103c0: 726d 6174 3d66 6f72 6d61 742c 0a20 2020  rmat=format,.   
-000103d0: 2020 2020 2020 2020 2067 726f 7570 3d67           group=g
-000103e0: 726f 7570 2c0a 2020 2020 2020 2020 2020  roup,.          
-000103f0: 2020 656e 6769 6e65 3d65 6e67 696e 652c    engine=engine,
-00010400: 0a20 2020 2020 2020 2020 2020 2065 6e63  .            enc
-00010410: 6f64 696e 673d 656e 636f 6469 6e67 2c0a  oding=encoding,.
-00010420: 2020 2020 2020 2020 2020 2020 756e 6c69              unli
-00010430: 6d69 7465 645f 6469 6d73 3d75 6e6c 696d  mited_dims=unlim
-00010440: 6974 6564 5f64 696d 732c 0a20 2020 2020  ited_dims,.     
-00010450: 2020 2020 2020 2063 6f6d 7075 7465 3d63         compute=c
-00010460: 6f6d 7075 7465 2c0a 2020 2020 2020 2020  ompute,.        
-00010470: 2020 2020 6d75 6c74 6966 696c 653d 4661      multifile=Fa
-00010480: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00010490: 2069 6e76 616c 6964 5f6e 6574 6364 663d   invalid_netcdf=
-000104a0: 696e 7661 6c69 645f 6e65 7463 6466 2c0a  invalid_netcdf,.
-000104b0: 2020 2020 2020 2020 290a 0a20 2020 2023          )..    #
-000104c0: 2063 6f6d 7075 7465 3d54 7275 6520 2864   compute=True (d
-000104d0: 6566 6175 6c74 2920 7265 7475 726e 7320  efault) returns 
-000104e0: 5a61 7272 5374 6f72 650a 2020 2020 406f  ZarrStore.    @o
-000104f0: 7665 726c 6f61 640a 2020 2020 6465 6620  verload.    def 
-00010500: 746f 5f7a 6172 7228 0a20 2020 2020 2020  to_zarr(.       
-00010510: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
-00010520: 746f 7265 3a20 4d75 7461 626c 654d 6170  tore: MutableMap
-00010530: 7069 6e67 207c 2073 7472 207c 2050 6174  ping | str | Pat
-00010540: 684c 696b 655b 7374 725d 207c 204e 6f6e  hLike[str] | Non
-00010550: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00010560: 2020 6368 756e 6b5f 7374 6f72 653a 204d    chunk_store: M
-00010570: 7574 6162 6c65 4d61 7070 696e 6720 7c20  utableMapping | 
-00010580: 7374 7220 7c20 5061 7468 4c69 6b65 207c  str | PathLike |
-00010590: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-000105a0: 2020 2020 2020 6d6f 6465 3a20 4c69 7465        mode: Lite
-000105b0: 7261 6c5b 2277 222c 2022 772d 222c 2022  ral["w", "w-", "
-000105c0: 6122 2c20 2272 2b22 2c20 4e6f 6e65 5d20  a", "r+", None] 
-000105d0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-000105e0: 7379 6e63 6872 6f6e 697a 6572 3d4e 6f6e  synchronizer=Non
-000105f0: 652c 0a20 2020 2020 2020 2067 726f 7570  e,.        group
-00010600: 3a20 7374 7220 7c20 4e6f 6e65 203d 204e  : str | None = N
-00010610: 6f6e 652c 0a20 2020 2020 2020 2065 6e63  one,.        enc
-00010620: 6f64 696e 673a 204d 6170 7069 6e67 207c  oding: Mapping |
-00010630: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00010640: 2020 2020 2020 636f 6d70 7574 653a 204c        compute: L
-00010650: 6974 6572 616c 5b54 7275 655d 203d 2054  iteral[True] = T
-00010660: 7275 652c 0a20 2020 2020 2020 2063 6f6e  rue,.        con
-00010670: 736f 6c69 6461 7465 643a 2062 6f6f 6c20  solidated: bool 
-00010680: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
-00010690: 2020 2020 2020 2061 7070 656e 645f 6469         append_di
-000106a0: 6d3a 2048 6173 6861 626c 6520 7c20 4e6f  m: Hashable | No
-000106b0: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
-000106c0: 2020 2072 6567 696f 6e3a 204d 6170 7069     region: Mappi
-000106d0: 6e67 5b73 7472 2c20 736c 6963 655d 207c  ng[str, slice] |
-000106e0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-000106f0: 2020 2020 2020 7361 6665 5f63 6875 6e6b        safe_chunk
-00010700: 733a 2062 6f6f 6c20 3d20 5472 7565 2c0a  s: bool = True,.
-00010710: 2020 2020 2020 2020 7374 6f72 6167 655f          storage_
-00010720: 6f70 7469 6f6e 733a 2064 6963 745b 7374  options: dict[st
-00010730: 722c 2073 7472 5d20 7c20 4e6f 6e65 203d  r, str] | None =
-00010740: 204e 6f6e 652c 0a20 2020 2020 2020 207a   None,.        z
-00010750: 6172 725f 7665 7273 696f 6e3a 2069 6e74  arr_version: int
-00010760: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00010770: 2020 2020 2920 2d3e 205a 6172 7253 746f      ) -> ZarrSto
-00010780: 7265 3a0a 2020 2020 2020 2020 2e2e 2e0a  re:.        ....
-00010790: 0a20 2020 2023 2063 6f6d 7075 7465 3d46  .    # compute=F
-000107a0: 616c 7365 2072 6574 7572 6e73 2064 6173  alse returns das
-000107b0: 6b2e 4465 6c61 7965 640a 2020 2020 406f  k.Delayed.    @o
-000107c0: 7665 726c 6f61 640a 2020 2020 6465 6620  verload.    def 
-000107d0: 746f 5f7a 6172 7228 0a20 2020 2020 2020  to_zarr(.       
-000107e0: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
-000107f0: 746f 7265 3a20 4d75 7461 626c 654d 6170  tore: MutableMap
-00010800: 7069 6e67 207c 2073 7472 207c 2050 6174  ping | str | Pat
-00010810: 684c 696b 655b 7374 725d 207c 204e 6f6e  hLike[str] | Non
-00010820: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00010830: 2020 6368 756e 6b5f 7374 6f72 653a 204d    chunk_store: M
-00010840: 7574 6162 6c65 4d61 7070 696e 6720 7c20  utableMapping | 
-00010850: 7374 7220 7c20 5061 7468 4c69 6b65 207c  str | PathLike |
-00010860: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00010870: 2020 2020 2020 6d6f 6465 3a20 4c69 7465        mode: Lite
-00010880: 7261 6c5b 2277 222c 2022 772d 222c 2022  ral["w", "w-", "
-00010890: 6122 2c20 2272 2b22 2c20 4e6f 6e65 5d20  a", "r+", None] 
-000108a0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-000108b0: 7379 6e63 6872 6f6e 697a 6572 3d4e 6f6e  synchronizer=Non
-000108c0: 652c 0a20 2020 2020 2020 2067 726f 7570  e,.        group
-000108d0: 3a20 7374 7220 7c20 4e6f 6e65 203d 204e  : str | None = N
-000108e0: 6f6e 652c 0a20 2020 2020 2020 2065 6e63  one,.        enc
-000108f0: 6f64 696e 673a 204d 6170 7069 6e67 207c  oding: Mapping |
-00010900: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00010910: 2020 2020 2020 2a2c 0a20 2020 2020 2020        *,.       
-00010920: 2063 6f6d 7075 7465 3a20 4c69 7465 7261   compute: Litera
-00010930: 6c5b 4661 6c73 655d 2c0a 2020 2020 2020  l[False],.      
-00010940: 2020 636f 6e73 6f6c 6964 6174 6564 3a20    consolidated: 
-00010950: 626f 6f6c 207c 204e 6f6e 6520 3d20 4e6f  bool | None = No
-00010960: 6e65 2c0a 2020 2020 2020 2020 6170 7065  ne,.        appe
-00010970: 6e64 5f64 696d 3a20 4861 7368 6162 6c65  nd_dim: Hashable
-00010980: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00010990: 2020 2020 2020 2020 7265 6769 6f6e 3a20          region: 
-000109a0: 4d61 7070 696e 675b 7374 722c 2073 6c69  Mapping[str, sli
-000109b0: 6365 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ce] | None = Non
-000109c0: 652c 0a20 2020 2020 2020 2073 6166 655f  e,.        safe_
-000109d0: 6368 756e 6b73 3a20 626f 6f6c 203d 2054  chunks: bool = T
-000109e0: 7275 652c 0a20 2020 2020 2020 2073 746f  rue,.        sto
-000109f0: 7261 6765 5f6f 7074 696f 6e73 3a20 6469  rage_options: di
-00010a00: 6374 5b73 7472 2c20 7374 725d 207c 204e  ct[str, str] | N
-00010a10: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00010a20: 2920 2d3e 2044 656c 6179 6564 3a0a 2020  ) -> Delayed:.  
-00010a30: 2020 2020 2020 2e2e 2e0a 0a20 2020 2064        .....    d
-00010a40: 6566 2074 6f5f 7a61 7272 280a 2020 2020  ef to_zarr(.    
-00010a50: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00010a60: 2020 7374 6f72 653a 204d 7574 6162 6c65    store: Mutable
-00010a70: 4d61 7070 696e 6720 7c20 7374 7220 7c20  Mapping | str | 
-00010a80: 5061 7468 4c69 6b65 5b73 7472 5d20 7c20  PathLike[str] | 
-00010a90: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00010aa0: 2020 2020 2063 6875 6e6b 5f73 746f 7265       chunk_store
-00010ab0: 3a20 4d75 7461 626c 654d 6170 7069 6e67  : MutableMapping
-00010ac0: 207c 2073 7472 207c 2050 6174 684c 696b   | str | PathLik
-00010ad0: 6520 7c20 4e6f 6e65 203d 204e 6f6e 652c  e | None = None,
-00010ae0: 0a20 2020 2020 2020 206d 6f64 653a 204c  .        mode: L
-00010af0: 6974 6572 616c 5b22 7722 2c20 2277 2d22  iteral["w", "w-"
-00010b00: 2c20 2261 222c 2022 722b 222c 204e 6f6e  , "a", "r+", Non
-00010b10: 655d 203d 204e 6f6e 652c 0a20 2020 2020  e] = None,.     
-00010b20: 2020 2073 796e 6368 726f 6e69 7a65 723d     synchronizer=
-00010b30: 4e6f 6e65 2c0a 2020 2020 2020 2020 6772  None,.        gr
-00010b40: 6f75 703a 2073 7472 207c 204e 6f6e 6520  oup: str | None 
-00010b50: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00010b60: 656e 636f 6469 6e67 3a20 4d61 7070 696e  encoding: Mappin
-00010b70: 6720 7c20 4e6f 6e65 203d 204e 6f6e 652c  g | None = None,
-00010b80: 0a20 2020 2020 2020 2063 6f6d 7075 7465  .        compute
-00010b90: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
-00010ba0: 2020 2020 2020 2063 6f6e 736f 6c69 6461         consolida
-00010bb0: 7465 643a 2062 6f6f 6c20 7c20 4e6f 6e65  ted: bool | None
-00010bc0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00010bd0: 2061 7070 656e 645f 6469 6d3a 2048 6173   append_dim: Has
-00010be0: 6861 626c 6520 7c20 4e6f 6e65 203d 204e  hable | None = N
-00010bf0: 6f6e 652c 0a20 2020 2020 2020 2072 6567  one,.        reg
-00010c00: 696f 6e3a 204d 6170 7069 6e67 5b73 7472  ion: Mapping[str
-00010c10: 2c20 736c 6963 655d 207c 204e 6f6e 6520  , slice] | None 
-00010c20: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00010c30: 7361 6665 5f63 6875 6e6b 733a 2062 6f6f  safe_chunks: boo
-00010c40: 6c20 3d20 5472 7565 2c0a 2020 2020 2020  l = True,.      
-00010c50: 2020 7374 6f72 6167 655f 6f70 7469 6f6e    storage_option
-00010c60: 733a 2064 6963 745b 7374 722c 2073 7472  s: dict[str, str
-00010c70: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-00010c80: 0a20 2020 2020 2020 207a 6172 725f 7665  .        zarr_ve
-00010c90: 7273 696f 6e3a 2069 6e74 207c 204e 6f6e  rsion: int | Non
-00010ca0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
-00010cb0: 2d3e 205a 6172 7253 746f 7265 207c 2044  -> ZarrStore | D
-00010cc0: 656c 6179 6564 3a0a 2020 2020 2020 2020  elayed:.        
-00010cd0: 2222 2257 7269 7465 2064 6174 6173 6574  """Write dataset
-00010ce0: 2063 6f6e 7465 6e74 7320 746f 2061 207a   contents to a z
-00010cf0: 6172 7220 6772 6f75 702e 0a0a 2020 2020  arr group...    
-00010d00: 2020 2020 5a61 7272 2063 6875 6e6b 7320      Zarr chunks 
-00010d10: 6172 6520 6465 7465 726d 696e 6564 2069  are determined i
-00010d20: 6e20 7468 6520 666f 6c6c 6f77 696e 6720  n the following 
-00010d30: 7761 793a 0a0a 2020 2020 2020 2020 2d20  way:..        - 
-00010d40: 4672 6f6d 2074 6865 2060 6063 6875 6e6b  From the ``chunk
-00010d50: 7360 6020 6174 7472 6962 7574 6520 696e  s`` attribute in
-00010d60: 2065 6163 6820 7661 7269 6162 6c65 2773   each variable's
-00010d70: 2060 6065 6e63 6f64 696e 6760 600a 2020   ``encoding``.  
-00010d80: 2020 2020 2020 2020 2863 616e 2062 6520          (can be 
-00010d90: 7365 7420 7669 6120 6044 6174 6173 6574  set via `Dataset
-00010da0: 2e63 6875 6e6b 6029 2e0a 2020 2020 2020  .chunk`)..      
-00010db0: 2020 2d20 4966 2074 6865 2076 6172 6961    - If the varia
-00010dc0: 626c 6520 6973 2061 2044 6173 6b20 6172  ble is a Dask ar
-00010dd0: 7261 792c 2066 726f 6d20 7468 6520 6461  ray, from the da
-00010de0: 736b 2063 6875 6e6b 730a 2020 2020 2020  sk chunks.      
-00010df0: 2020 2d20 4966 206e 6569 7468 6572 2044    - If neither D
-00010e00: 6173 6b20 6368 756e 6b73 206e 6f72 2065  ask chunks nor e
-00010e10: 6e63 6f64 696e 6720 6368 756e 6b73 2061  ncoding chunks a
-00010e20: 7265 2070 7265 7365 6e74 2c20 6368 756e  re present, chun
-00010e30: 6b73 2077 696c 6c0a 2020 2020 2020 2020  ks will.        
-00010e40: 2020 6265 2064 6574 6572 6d69 6e65 6420    be determined 
-00010e50: 6175 746f 6d61 7469 6361 6c6c 7920 6279  automatically by
-00010e60: 205a 6172 720a 2020 2020 2020 2020 2d20   Zarr.        - 
-00010e70: 4966 2062 6f74 6820 4461 736b 2063 6875  If both Dask chu
-00010e80: 6e6b 7320 616e 6420 656e 636f 6469 6e67  nks and encoding
-00010e90: 2063 6875 6e6b 7320 6172 6520 7072 6573   chunks are pres
-00010ea0: 656e 742c 2065 6e63 6f64 696e 6720 6368  ent, encoding ch
-00010eb0: 756e 6b73 0a20 2020 2020 2020 2020 2077  unks.          w
-00010ec0: 696c 6c20 6265 2075 7365 642c 2070 726f  ill be used, pro
-00010ed0: 7669 6465 6420 7468 6174 2074 6865 7265  vided that there
-00010ee0: 2069 7320 6120 6d61 6e79 2d74 6f2d 6f6e   is a many-to-on
-00010ef0: 6520 7265 6c61 7469 6f6e 7368 6970 2062  e relationship b
-00010f00: 6574 7765 656e 0a20 2020 2020 2020 2020  etween.         
-00010f10: 2065 6e63 6f64 696e 6720 6368 756e 6b73   encoding chunks
-00010f20: 2061 6e64 2064 6173 6b20 6368 756e 6b73   and dask chunks
-00010f30: 2028 692e 652e 2044 6173 6b20 6368 756e   (i.e. Dask chun
-00010f40: 6b73 2061 7265 2062 6967 6765 7220 7468  ks are bigger th
-00010f50: 616e 2061 6e64 0a20 2020 2020 2020 2020  an and.         
-00010f60: 2065 7665 6e6c 7920 6469 7669 6465 2065   evenly divide e
-00010f70: 6e63 6f64 696e 6720 6368 756e 6b73 293b  ncoding chunks);
-00010f80: 206f 7468 6572 7769 7365 2072 6169 7365   otherwise raise
-00010f90: 2061 2060 6056 616c 7565 4572 726f 7260   a ``ValueError`
-00010fa0: 602e 0a20 2020 2020 2020 2020 2054 6869  `..          Thi
-00010fb0: 7320 7265 7374 7269 6374 696f 6e20 656e  s restriction en
-00010fc0: 7375 7265 7320 7468 6174 206e 6f20 7379  sures that no sy
-00010fd0: 6e63 6872 6f6e 697a 6174 696f 6e20 2f20  nchronization / 
-00010fe0: 6c6f 636b 7320 6172 6520 7265 7175 6972  locks are requir
-00010ff0: 6564 0a20 2020 2020 2020 2020 2077 6865  ed.          whe
-00011000: 6e20 7772 6974 696e 672e 2054 6f20 6469  n writing. To di
-00011010: 7361 626c 6520 7468 6973 2072 6573 7472  sable this restr
-00011020: 6963 7469 6f6e 2c20 7573 6520 6060 7361  iction, use ``sa
-00011030: 6665 5f63 6875 6e6b 733d 4661 6c73 6560  fe_chunks=False`
-00011040: 602e 0a0a 2020 2020 2020 2020 5061 7261  `...        Para
-00011050: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-00011060: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00011070: 2020 7374 6f72 6520 3a20 4d75 7461 626c    store : Mutabl
-00011080: 654d 6170 7069 6e67 2c20 7374 7220 6f72  eMapping, str or
-00011090: 2070 6174 682d 6c69 6b65 2c20 6f70 7469   path-like, opti
-000110a0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-000110b0: 2053 746f 7265 206f 7220 7061 7468 2074   Store or path t
-000110c0: 6f20 6469 7265 6374 6f72 7920 696e 206c  o directory in l
-000110d0: 6f63 616c 206f 7220 7265 6d6f 7465 2066  ocal or remote f
-000110e0: 696c 6520 7379 7374 656d 2e0a 2020 2020  ile system..    
-000110f0: 2020 2020 6368 756e 6b5f 7374 6f72 6520      chunk_store 
-00011100: 3a20 4d75 7461 626c 654d 6170 7069 6e67  : MutableMapping
-00011110: 2c20 7374 7220 6f72 2070 6174 682d 6c69  , str or path-li
-00011120: 6b65 2c20 6f70 7469 6f6e 616c 0a20 2020  ke, optional.   
-00011130: 2020 2020 2020 2020 2053 746f 7265 206f           Store o
-00011140: 7220 7061 7468 2074 6f20 6469 7265 6374  r path to direct
-00011150: 6f72 7920 696e 206c 6f63 616c 206f 7220  ory in local or 
-00011160: 7265 6d6f 7465 2066 696c 6520 7379 7374  remote file syst
-00011170: 656d 206f 6e6c 7920 666f 7220 5a61 7272  em only for Zarr
-00011180: 0a20 2020 2020 2020 2020 2020 2061 7272  .            arr
-00011190: 6179 2063 6875 6e6b 732e 2052 6571 7569  ay chunks. Requi
-000111a0: 7265 7320 7a61 7272 2d70 7974 686f 6e20  res zarr-python 
-000111b0: 7632 2e34 2e30 206f 7220 6c61 7465 722e  v2.4.0 or later.
-000111c0: 0a20 2020 2020 2020 206d 6f64 6520 3a20  .        mode : 
-000111d0: 7b22 7722 2c20 2277 2d22 2c20 2261 222c  {"w", "w-", "a",
-000111e0: 2022 722b 222c 204e 6f6e 657d 2c20 6f70   "r+", None}, op
-000111f0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00011200: 2020 2050 6572 7369 7374 656e 6365 206d     Persistence m
-00011210: 6f64 653a 2022 7722 206d 6561 6e73 2063  ode: "w" means c
-00011220: 7265 6174 6520 286f 7665 7277 7269 7465  reate (overwrite
-00011230: 2069 6620 6578 6973 7473 293b 0a20 2020   if exists);.   
-00011240: 2020 2020 2020 2020 2022 772d 2220 6d65           "w-" me
-00011250: 616e 7320 6372 6561 7465 2028 6661 696c  ans create (fail
-00011260: 2069 6620 6578 6973 7473 293b 0a20 2020   if exists);.   
-00011270: 2020 2020 2020 2020 2022 6122 206d 6561           "a" mea
-00011280: 6e73 206f 7665 7272 6964 6520 6578 6973  ns override exis
-00011290: 7469 6e67 2076 6172 6961 626c 6573 2028  ting variables (
-000112a0: 6372 6561 7465 2069 6620 646f 6573 206e  create if does n
-000112b0: 6f74 2065 7869 7374 293b 0a20 2020 2020  ot exist);.     
-000112c0: 2020 2020 2020 2022 722b 2220 6d65 616e         "r+" mean
-000112d0: 7320 6d6f 6469 6679 2065 7869 7374 696e  s modify existin
-000112e0: 6720 6172 7261 7920 2a76 616c 7565 732a  g array *values*
-000112f0: 206f 6e6c 7920 2872 6169 7365 2061 6e20   only (raise an 
-00011300: 6572 726f 7220 6966 0a20 2020 2020 2020  error if.       
-00011310: 2020 2020 2061 6e79 206d 6574 6164 6174       any metadat
-00011320: 6120 6f72 2073 6861 7065 7320 776f 756c  a or shapes woul
-00011330: 6420 6368 616e 6765 292e 0a20 2020 2020  d change)..     
-00011340: 2020 2020 2020 2054 6865 2064 6566 6175         The defau
-00011350: 6c74 206d 6f64 6520 6973 2022 6122 2069  lt mode is "a" i
-00011360: 6620 6060 6170 7065 6e64 5f64 696d 6060  f ``append_dim``
-00011370: 2069 7320 7365 742e 204f 7468 6572 7769   is set. Otherwi
-00011380: 7365 2c20 6974 2069 730a 2020 2020 2020  se, it is.      
-00011390: 2020 2020 2020 2272 2b22 2069 6620 6060        "r+" if ``
-000113a0: 7265 6769 6f6e 6060 2069 7320 7365 7420  region`` is set 
-000113b0: 616e 6420 6060 772d 6060 206f 7468 6572  and ``w-`` other
-000113c0: 7769 7365 2e0a 2020 2020 2020 2020 7379  wise..        sy
-000113d0: 6e63 6872 6f6e 697a 6572 203a 206f 626a  nchronizer : obj
-000113e0: 6563 742c 206f 7074 696f 6e61 6c0a 2020  ect, optional.  
-000113f0: 2020 2020 2020 2020 2020 5a61 7272 2061            Zarr a
-00011400: 7272 6179 2073 796e 6368 726f 6e69 7a65  rray synchronize
-00011410: 722e 0a20 2020 2020 2020 2067 726f 7570  r..        group
-00011420: 203a 2073 7472 2c20 6f70 7469 6f6e 616c   : str, optional
-00011430: 0a20 2020 2020 2020 2020 2020 2047 726f  .            Gro
-00011440: 7570 2070 6174 682e 2028 612e 6b2e 612e  up path. (a.k.a.
-00011450: 2060 7061 7468 6020 696e 207a 6172 7220   `path` in zarr 
-00011460: 7465 726d 696e 6f6c 6f67 792e 290a 2020  terminology.).  
-00011470: 2020 2020 2020 656e 636f 6469 6e67 203a        encoding :
-00011480: 2064 6963 742c 206f 7074 696f 6e61 6c0a   dict, optional.
-00011490: 2020 2020 2020 2020 2020 2020 4e65 7374              Nest
-000114a0: 6564 2064 6963 7469 6f6e 6172 7920 7769  ed dictionary wi
-000114b0: 7468 2076 6172 6961 626c 6520 6e61 6d65  th variable name
-000114c0: 7320 6173 206b 6579 7320 616e 6420 6469  s as keys and di
-000114d0: 6374 696f 6e61 7269 6573 206f 660a 2020  ctionaries of.  
-000114e0: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-000114f0: 6c65 2073 7065 6369 6669 6320 656e 636f  le specific enco
-00011500: 6469 6e67 7320 6173 2076 616c 7565 732c  dings as values,
-00011510: 2065 2e67 2e2c 0a20 2020 2020 2020 2020   e.g.,.         
-00011520: 2020 2060 607b 226d 795f 7661 7269 6162     ``{"my_variab
-00011530: 6c65 223a 207b 2264 7479 7065 223a 2022  le": {"dtype": "
-00011540: 696e 7431 3622 2c20 2273 6361 6c65 5f66  int16", "scale_f
-00011550: 6163 746f 7222 3a20 302e 312c 7d2c 202e  actor": 0.1,}, .
-00011560: 2e2e 7d60 600a 2020 2020 2020 2020 636f  ..}``.        co
-00011570: 6d70 7574 6520 3a20 626f 6f6c 2c20 6f70  mpute : bool, op
-00011580: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00011590: 2020 2049 6620 5472 7565 2077 7269 7465     If True write
-000115a0: 2061 7272 6179 2064 6174 6120 696d 6d65   array data imme
-000115b0: 6469 6174 656c 792c 206f 7468 6572 7769  diately, otherwi
-000115c0: 7365 2072 6574 7572 6e20 610a 2020 2020  se return a.    
-000115d0: 2020 2020 2020 2020 6060 6461 736b 2e64          ``dask.d
-000115e0: 656c 6179 6564 2e44 656c 6179 6564 6060  elayed.Delayed``
-000115f0: 206f 626a 6563 7420 7468 6174 2063 616e   object that can
-00011600: 2062 6520 636f 6d70 7574 6564 2074 6f20   be computed to 
-00011610: 7772 6974 650a 2020 2020 2020 2020 2020  write.          
-00011620: 2020 6172 7261 7920 6461 7461 206c 6174    array data lat
-00011630: 6572 2e20 4d65 7461 6461 7461 2069 7320  er. Metadata is 
-00011640: 616c 7761 7973 2075 7064 6174 6564 2065  always updated e
-00011650: 6167 6572 6c79 2e0a 2020 2020 2020 2020  agerly..        
-00011660: 636f 6e73 6f6c 6964 6174 6564 203a 2062  consolidated : b
-00011670: 6f6f 6c2c 206f 7074 696f 6e61 6c0a 2020  ool, optional.  
-00011680: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-00011690: 652c 2061 7070 6c79 207a 6172 7227 7320  e, apply zarr's 
-000116a0: 6063 6f6e 736f 6c69 6461 7465 5f6d 6574  `consolidate_met
-000116b0: 6164 6174 6160 2066 756e 6374 696f 6e20  adata` function 
-000116c0: 746f 2074 6865 2073 746f 7265 0a20 2020  to the store.   
-000116d0: 2020 2020 2020 2020 2061 6674 6572 2077           after w
-000116e0: 7269 7469 6e67 206d 6574 6164 6174 6120  riting metadata 
-000116f0: 616e 6420 7265 6164 2065 7869 7374 696e  and read existin
-00011700: 6720 7374 6f72 6573 2077 6974 6820 636f  g stores with co
-00011710: 6e73 6f6c 6964 6174 6564 0a20 2020 2020  nsolidated.     
-00011720: 2020 2020 2020 206d 6574 6164 6174 613b         metadata;
-00011730: 2069 6620 4661 6c73 652c 2064 6f20 6e6f   if False, do no
-00011740: 742e 2054 6865 2064 6566 6175 6c74 2028  t. The default (
-00011750: 6063 6f6e 736f 6c69 6461 7465 643d 4e6f  `consolidated=No
-00011760: 6e65 6029 206d 6561 6e73 0a20 2020 2020  ne`) means.     
-00011770: 2020 2020 2020 2077 7269 7465 2063 6f6e         write con
-00011780: 736f 6c69 6461 7465 6420 6d65 7461 6461  solidated metada
-00011790: 7461 2061 6e64 2061 7474 656d 7074 2074  ta and attempt t
-000117a0: 6f20 7265 6164 2063 6f6e 736f 6c69 6461  o read consolida
-000117b0: 7465 640a 2020 2020 2020 2020 2020 2020  ted.            
-000117c0: 6d65 7461 6461 7461 2066 6f72 2065 7869  metadata for exi
-000117d0: 7374 696e 6720 7374 6f72 6573 2028 6661  sting stores (fa
-000117e0: 6c6c 696e 6720 6261 636b 2074 6f20 6e6f  lling back to no
-000117f0: 6e2d 636f 6e73 6f6c 6964 6174 6564 292e  n-consolidated).
-00011800: 0a0a 2020 2020 2020 2020 2020 2020 5768  ..            Wh
-00011810: 656e 2074 6865 2065 7870 6572 696d 656e  en the experimen
-00011820: 7461 6c20 6060 7a61 7272 5f76 6572 7369  tal ``zarr_versi
-00011830: 6f6e 3d33 6060 2c20 6060 636f 6e73 6f6c  on=3``, ``consol
-00011840: 6964 6174 6564 6060 206d 7573 7420 6265  idated`` must be
-00011850: 0a20 2020 2020 2020 2020 2020 2065 6974  .            eit
-00011860: 6865 7220 6265 2060 604e 6f6e 6560 6020  her be ``None`` 
-00011870: 6f72 2060 6046 616c 7365 6060 2e0a 2020  or ``False``..  
-00011880: 2020 2020 2020 6170 7065 6e64 5f64 696d        append_dim
-00011890: 203a 2068 6173 6861 626c 652c 206f 7074   : hashable, opt
-000118a0: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-000118b0: 2020 4966 2073 6574 2c20 7468 6520 6469    If set, the di
-000118c0: 6d65 6e73 696f 6e20 616c 6f6e 6720 7768  mension along wh
-000118d0: 6963 6820 7468 6520 6461 7461 2077 696c  ich the data wil
-000118e0: 6c20 6265 2061 7070 656e 6465 642e 2041  l be appended. A
-000118f0: 6c6c 0a20 2020 2020 2020 2020 2020 206f  ll.            o
-00011900: 7468 6572 2064 696d 656e 7369 6f6e 7320  ther dimensions 
-00011910: 6f6e 206f 7665 7272 6964 6465 6e20 7661  on overridden va
-00011920: 7269 6162 6c65 7320 6d75 7374 2072 656d  riables must rem
-00011930: 6169 6e20 7468 6520 7361 6d65 2073 697a  ain the same siz
-00011940: 652e 0a20 2020 2020 2020 2072 6567 696f  e..        regio
-00011950: 6e20 3a20 6469 6374 2c20 6f70 7469 6f6e  n : dict, option
-00011960: 616c 0a20 2020 2020 2020 2020 2020 204f  al.            O
-00011970: 7074 696f 6e61 6c20 6d61 7070 696e 6720  ptional mapping 
-00011980: 6672 6f6d 2064 696d 656e 7369 6f6e 206e  from dimension n
-00011990: 616d 6573 2074 6f20 696e 7465 6765 7220  ames to integer 
-000119a0: 736c 6963 6573 2061 6c6f 6e67 0a20 2020  slices along.   
-000119b0: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
-000119c0: 2064 696d 656e 7369 6f6e 7320 746f 2069   dimensions to i
-000119d0: 6e64 6963 6174 6520 7468 6520 7265 6769  ndicate the regi
-000119e0: 6f6e 206f 6620 6578 6973 7469 6e67 207a  on of existing z
-000119f0: 6172 7220 6172 7261 7928 7329 0a20 2020  arr array(s).   
-00011a00: 2020 2020 2020 2020 2069 6e20 7768 6963           in whic
-00011a10: 6820 746f 2077 7269 7465 2074 6869 7320  h to write this 
-00011a20: 6461 7461 7365 7427 7320 6461 7461 2e20  dataset's data. 
-00011a30: 466f 7220 6578 616d 706c 652c 0a20 2020  For example,.   
-00011a40: 2020 2020 2020 2020 2060 607b 2778 273a           ``{'x':
-00011a50: 2073 6c69 6365 2830 2c20 3130 3030 292c   slice(0, 1000),
-00011a60: 2027 7927 3a20 736c 6963 6528 3130 3030   'y': slice(1000
-00011a70: 302c 2031 3130 3030 297d 6060 2077 6f75  0, 11000)}`` wou
-00011a80: 6c64 2069 6e64 6963 6174 650a 2020 2020  ld indicate.    
-00011a90: 2020 2020 2020 2020 7468 6174 2076 616c          that val
-00011aa0: 7565 7320 7368 6f75 6c64 2062 6520 7772  ues should be wr
-00011ab0: 6974 7465 6e20 746f 2074 6865 2072 6567  itten to the reg
-00011ac0: 696f 6e20 6060 303a 3130 3030 6060 2061  ion ``0:1000`` a
-00011ad0: 6c6f 6e67 2060 6078 6060 0a20 2020 2020  long ``x``.     
-00011ae0: 2020 2020 2020 2061 6e64 2060 6031 3030         and ``100
-00011af0: 3030 3a31 3130 3030 6060 2061 6c6f 6e67  00:11000`` along
-00011b00: 2060 6079 6060 2e0a 0a20 2020 2020 2020   ``y``...       
-00011b10: 2020 2020 2054 776f 2072 6573 7472 6963       Two restric
-00011b20: 7469 6f6e 7320 6170 706c 7920 746f 2074  tions apply to t
-00011b30: 6865 2075 7365 206f 6620 6060 7265 6769  he use of ``regi
-00011b40: 6f6e 6060 3a0a 0a20 2020 2020 2020 2020  on``:..         
-00011b50: 2020 202d 2049 6620 6060 7265 6769 6f6e     - If ``region
-00011b60: 6060 2069 7320 7365 742c 205f 616c 6c5f  `` is set, _all_
-00011b70: 2076 6172 6961 626c 6573 2069 6e20 6120   variables in a 
-00011b80: 6461 7461 7365 7420 6d75 7374 2068 6176  dataset must hav
-00011b90: 6520 6174 0a20 2020 2020 2020 2020 2020  e at.           
-00011ba0: 2020 206c 6561 7374 206f 6e65 2064 696d     least one dim
-00011bb0: 656e 7369 6f6e 2069 6e20 636f 6d6d 6f6e  ension in common
-00011bc0: 2077 6974 6820 7468 6520 7265 6769 6f6e   with the region
-00011bd0: 2e20 4f74 6865 7220 7661 7269 6162 6c65  . Other variable
-00011be0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00011bf0: 7368 6f75 6c64 2062 6520 7772 6974 7465  should be writte
-00011c00: 6e20 696e 2061 2073 6570 6172 6174 6520  n in a separate 
-00011c10: 6361 6c6c 2074 6f20 6060 746f 5f7a 6172  call to ``to_zar
-00011c20: 7228 2960 602e 0a20 2020 2020 2020 2020  r()``..         
-00011c30: 2020 202d 2044 696d 656e 7369 6f6e 7320     - Dimensions 
-00011c40: 6361 6e6e 6f74 2062 6520 696e 636c 7564  cannot be includ
-00011c50: 6564 2069 6e20 626f 7468 2060 6072 6567  ed in both ``reg
-00011c60: 696f 6e60 6020 616e 640a 2020 2020 2020  ion`` and.      
-00011c70: 2020 2020 2020 2020 6060 6170 7065 6e64          ``append
-00011c80: 5f64 696d 6060 2061 7420 7468 6520 7361  _dim`` at the sa
-00011c90: 6d65 2074 696d 652e 2054 6f20 6372 6561  me time. To crea
-00011ca0: 7465 2065 6d70 7479 2061 7272 6179 7320  te empty arrays 
-00011cb0: 746f 2066 696c 6c0a 2020 2020 2020 2020  to fill.        
-00011cc0: 2020 2020 2020 696e 2077 6974 6820 6060        in with ``
-00011cd0: 7265 6769 6f6e 6060 2c20 7573 6520 6120  region``, use a 
-00011ce0: 7365 7061 7261 7465 2063 616c 6c20 746f  separate call to
-00011cf0: 2060 6074 6f5f 7a61 7272 2829 6060 2077   ``to_zarr()`` w
-00011d00: 6974 680a 2020 2020 2020 2020 2020 2020  ith.            
-00011d10: 2020 6060 636f 6d70 7574 653d 4661 6c73    ``compute=Fals
-00011d20: 6560 602e 2053 6565 2022 4170 7065 6e64  e``. See "Append
-00011d30: 696e 6720 746f 2065 7869 7374 696e 6720  ing to existing 
-00011d40: 5a61 7272 2073 746f 7265 7322 2069 6e0a  Zarr stores" in.
-00011d50: 2020 2020 2020 2020 2020 2020 2020 7468                th
-00011d60: 6520 7265 6665 7265 6e63 6520 646f 6375  e reference docu
-00011d70: 6d65 6e74 6174 696f 6e20 666f 7220 6675  mentation for fu
-00011d80: 6c6c 2064 6574 6169 6c73 2e0a 2020 2020  ll details..    
-00011d90: 2020 2020 7361 6665 5f63 6875 6e6b 7320      safe_chunks 
-00011da0: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
-00011db0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00011dc0: 5472 7565 2c20 6f6e 6c79 2061 6c6c 6f77  True, only allow
-00011dd0: 2077 7269 7465 7320 746f 2077 6865 6e20   writes to when 
-00011de0: 7468 6572 6520 6973 2061 206d 616e 792d  there is a many-
-00011df0: 746f 2d6f 6e65 2072 656c 6174 696f 6e73  to-one relations
-00011e00: 6869 700a 2020 2020 2020 2020 2020 2020  hip.            
-00011e10: 6265 7477 6565 6e20 5a61 7272 2063 6875  between Zarr chu
-00011e20: 6e6b 7320 2873 7065 6369 6669 6564 2069  nks (specified i
-00011e30: 6e20 656e 636f 6469 6e67 2920 616e 6420  n encoding) and 
-00011e40: 4461 736b 2063 6875 6e6b 732e 0a20 2020  Dask chunks..   
-00011e50: 2020 2020 2020 2020 2053 6574 2046 616c           Set Fal
-00011e60: 7365 2074 6f20 6f76 6572 7269 6465 2074  se to override t
-00011e70: 6869 7320 7265 7374 7269 6374 696f 6e3b  his restriction;
-00011e80: 2068 6f77 6576 6572 2c20 6461 7461 206d   however, data m
-00011e90: 6179 2062 6563 6f6d 6520 636f 7272 7570  ay become corrup
-00011ea0: 7465 640a 2020 2020 2020 2020 2020 2020  ted.            
-00011eb0: 6966 205a 6172 7220 6172 7261 7973 2061  if Zarr arrays a
-00011ec0: 7265 2077 7269 7474 656e 2069 6e20 7061  re written in pa
-00011ed0: 7261 6c6c 656c 2e20 5468 6973 206f 7074  rallel. This opt
-00011ee0: 696f 6e20 6d61 7920 6265 2075 7365 6675  ion may be usefu
-00011ef0: 6c20 696e 2063 6f6d 6269 6e61 7469 6f6e  l in combination
-00011f00: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00011f10: 6820 6060 636f 6d70 7574 653d 4661 6c73  h ``compute=Fals
-00011f20: 6560 6020 746f 2069 6e69 7469 616c 697a  e`` to initializ
-00011f30: 6520 6120 5a61 7272 2066 726f 6d20 616e  e a Zarr from an
-00011f40: 2065 7869 7374 696e 670a 2020 2020 2020   existing.      
-00011f50: 2020 2020 2020 4461 7461 7365 7420 7769        Dataset wi
-00011f60: 7468 2061 7262 6974 7261 7279 2063 6875  th arbitrary chu
-00011f70: 6e6b 2073 7472 7563 7475 7265 2e0a 2020  nk structure..  
-00011f80: 2020 2020 2020 7374 6f72 6167 655f 6f70        storage_op
-00011f90: 7469 6f6e 7320 3a20 6469 6374 2c20 6f70  tions : dict, op
-00011fa0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00011fb0: 2020 2041 6e79 2061 6464 6974 696f 6e61     Any additiona
-00011fc0: 6c20 7061 7261 6d65 7465 7273 2066 6f72  l parameters for
-00011fd0: 2074 6865 2073 746f 7261 6765 2062 6163   the storage bac
-00011fe0: 6b65 6e64 2028 6967 6e6f 7265 6420 666f  kend (ignored fo
-00011ff0: 7220 6c6f 6361 6c0a 2020 2020 2020 2020  r local.        
-00012000: 2020 2020 7061 7468 7329 2e0a 2020 2020      paths)..    
-00012010: 2020 2020 7a61 7272 5f76 6572 7369 6f6e      zarr_version
-00012020: 203a 2069 6e74 206f 7220 4e6f 6e65 2c20   : int or None, 
-00012030: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00012040: 2020 2020 2054 6865 2064 6573 6972 6564       The desired
-00012050: 207a 6172 7220 7370 6563 2076 6572 7369   zarr spec versi
-00012060: 6f6e 2074 6f20 7461 7267 6574 2028 6375  on to target (cu
-00012070: 7272 656e 746c 7920 3220 6f72 2033 292e  rrently 2 or 3).
-00012080: 2054 6865 0a20 2020 2020 2020 2020 2020   The.           
-00012090: 2064 6566 6175 6c74 206f 6620 4e6f 6e65   default of None
-000120a0: 2077 696c 6c20 6174 7465 6d70 7420 746f   will attempt to
-000120b0: 2064 6574 6572 6d69 6e65 2074 6865 207a   determine the z
-000120c0: 6172 7220 7665 7273 696f 6e20 6672 6f6d  arr version from
-000120d0: 0a20 2020 2020 2020 2020 2020 2060 6073  .            ``s
-000120e0: 746f 7265 6060 2077 6865 6e20 706f 7373  tore`` when poss
-000120f0: 6962 6c65 2c20 6f74 6865 7277 6973 6520  ible, otherwise 
-00012100: 6465 6661 756c 7469 6e67 2074 6f20 322e  defaulting to 2.
-00012110: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00012120: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00012130: 2d0a 2020 2020 2020 2020 2020 2020 2a20  -.            * 
-00012140: 6060 6461 736b 2e64 656c 6179 6564 2e44  ``dask.delayed.D
-00012150: 656c 6179 6564 6060 2069 6620 636f 6d70  elayed`` if comp
-00012160: 7574 6520 6973 2046 616c 7365 0a20 2020  ute is False.   
-00012170: 2020 2020 2020 2020 202a 205a 6172 7253           * ZarrS
-00012180: 746f 7265 206f 7468 6572 7769 7365 0a0a  tore otherwise..
-00012190: 2020 2020 2020 2020 5265 6665 7265 6e63          Referenc
-000121a0: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
-000121b0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6874  -----.        ht
-000121c0: 7470 733a 2f2f 7a61 7272 2e72 6561 6474  tps://zarr.readt
-000121d0: 6865 646f 6373 2e69 6f2f 0a0a 2020 2020  hedocs.io/..    
-000121e0: 2020 2020 4e6f 7465 730a 2020 2020 2020      Notes.      
-000121f0: 2020 2d2d 2d2d 2d0a 2020 2020 2020 2020    -----.        
-00012200: 5a61 7272 2063 6875 6e6b 696e 6720 6265  Zarr chunking be
-00012210: 6861 7669 6f72 3a0a 2020 2020 2020 2020  havior:.        
-00012220: 2020 2020 4966 2063 6875 6e6b 7320 6172      If chunks ar
-00012230: 6520 666f 756e 6420 696e 2074 6865 2065  e found in the e
-00012240: 6e63 6f64 696e 6720 6172 6775 6d65 6e74  ncoding argument
-00012250: 206f 7220 6174 7472 6962 7574 650a 2020   or attribute.  
-00012260: 2020 2020 2020 2020 2020 636f 7272 6573            corres
-00012270: 706f 6e64 696e 6720 746f 2061 6e79 2044  ponding to any D
-00012280: 6174 6141 7272 6179 2c20 7468 6f73 6520  ataArray, those 
-00012290: 6368 756e 6b73 2061 7265 2075 7365 642e  chunks are used.
-000122a0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-000122b0: 6120 4461 7461 4172 7261 7920 6973 2061  a DataArray is a
-000122c0: 2064 6173 6b20 6172 7261 792c 2069 7420   dask array, it 
-000122d0: 6973 2077 7269 7474 656e 2077 6974 6820  is written with 
-000122e0: 7468 6f73 6520 6368 756e 6b73 2e0a 2020  those chunks..  
-000122f0: 2020 2020 2020 2020 2020 4966 206e 6f74            If not
-00012300: 206f 7468 6572 2063 6875 6e6b 7320 6172   other chunks ar
-00012310: 6520 666f 756e 642c 205a 6172 7220 7573  e found, Zarr us
-00012320: 6573 2069 7473 206f 776e 2068 6575 7269  es its own heuri
-00012330: 7374 6963 7320 746f 0a20 2020 2020 2020  stics to.       
-00012340: 2020 2020 2063 686f 6f73 6520 6175 746f       choose auto
-00012350: 6d61 7469 6320 6368 756e 6b20 7369 7a65  matic chunk size
-00012360: 732e 0a0a 2020 2020 2020 2020 656e 636f  s...        enco
-00012370: 6469 6e67 3a0a 2020 2020 2020 2020 2020  ding:.          
-00012380: 2020 5468 6520 656e 636f 6469 6e67 2061    The encoding a
-00012390: 7474 7269 6275 7465 2028 6966 2065 7869  ttribute (if exi
-000123a0: 7374 7329 206f 6620 7468 6520 4461 7461  sts) of the Data
-000123b0: 4172 7261 7928 7329 2077 696c 6c20 6265  Array(s) will be
-000123c0: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
-000123d0: 642e 204f 7665 7272 6964 6520 616e 7920  d. Override any 
-000123e0: 6578 6973 7469 6e67 2065 6e63 6f64 696e  existing encodin
-000123f0: 6773 2062 7920 7072 6f76 6964 696e 6720  gs by providing 
-00012400: 7468 6520 6060 656e 636f 6469 6e67 6060  the ``encoding``
-00012410: 206b 7761 7267 2e0a 0a20 2020 2020 2020   kwarg...       
-00012420: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-00012430: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-00012440: 2020 203a 7265 663a 6069 6f2e 7a61 7272     :ref:`io.zarr
-00012450: 600a 2020 2020 2020 2020 2020 2020 5468  `.            Th
-00012460: 6520 492f 4f20 7573 6572 2067 7569 6465  e I/O user guide
-00012470: 2c20 7769 7468 206d 6f72 6520 6465 7461  , with more deta
-00012480: 696c 7320 616e 6420 6578 616d 706c 6573  ils and examples
-00012490: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000124a0: 2020 2020 2020 6672 6f6d 2078 6172 7261        from xarra
-000124b0: 792e 6261 636b 656e 6473 2e61 7069 2069  y.backends.api i
-000124c0: 6d70 6f72 7420 746f 5f7a 6172 720a 0a20  mport to_zarr.. 
-000124d0: 2020 2020 2020 2072 6574 7572 6e20 746f         return to
-000124e0: 5f7a 6172 7228 2020 2320 7479 7065 3a20  _zarr(  # type: 
-000124f0: 6967 6e6f 7265 0a20 2020 2020 2020 2020  ignore.         
-00012500: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00012510: 2020 2020 2073 746f 7265 3d73 746f 7265       store=store
-00012520: 2c0a 2020 2020 2020 2020 2020 2020 6368  ,.            ch
-00012530: 756e 6b5f 7374 6f72 653d 6368 756e 6b5f  unk_store=chunk_
-00012540: 7374 6f72 652c 0a20 2020 2020 2020 2020  store,.         
-00012550: 2020 2073 746f 7261 6765 5f6f 7074 696f     storage_optio
-00012560: 6e73 3d73 746f 7261 6765 5f6f 7074 696f  ns=storage_optio
-00012570: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
-00012580: 6d6f 6465 3d6d 6f64 652c 0a20 2020 2020  mode=mode,.     
-00012590: 2020 2020 2020 2073 796e 6368 726f 6e69         synchroni
-000125a0: 7a65 723d 7379 6e63 6872 6f6e 697a 6572  zer=synchronizer
-000125b0: 2c0a 2020 2020 2020 2020 2020 2020 6772  ,.            gr
-000125c0: 6f75 703d 6772 6f75 702c 0a20 2020 2020  oup=group,.     
-000125d0: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
-000125e0: 656e 636f 6469 6e67 2c0a 2020 2020 2020  encoding,.      
-000125f0: 2020 2020 2020 636f 6d70 7574 653d 636f        compute=co
-00012600: 6d70 7574 652c 0a20 2020 2020 2020 2020  mpute,.         
-00012610: 2020 2063 6f6e 736f 6c69 6461 7465 643d     consolidated=
-00012620: 636f 6e73 6f6c 6964 6174 6564 2c0a 2020  consolidated,.  
-00012630: 2020 2020 2020 2020 2020 6170 7065 6e64            append
-00012640: 5f64 696d 3d61 7070 656e 645f 6469 6d2c  _dim=append_dim,
-00012650: 0a20 2020 2020 2020 2020 2020 2072 6567  .            reg
-00012660: 696f 6e3d 7265 6769 6f6e 2c0a 2020 2020  ion=region,.    
-00012670: 2020 2020 2020 2020 7361 6665 5f63 6875          safe_chu
-00012680: 6e6b 733d 7361 6665 5f63 6875 6e6b 732c  nks=safe_chunks,
-00012690: 0a20 2020 2020 2020 2020 2020 207a 6172  .            zar
-000126a0: 725f 7665 7273 696f 6e3d 7a61 7272 5f76  r_version=zarr_v
-000126b0: 6572 7369 6f6e 2c0a 2020 2020 2020 2020  ersion,.        
-000126c0: 290a 0a20 2020 2064 6566 205f 5f72 6570  )..    def __rep
-000126d0: 725f 5f28 7365 6c66 2920 2d3e 2073 7472  r__(self) -> str
-000126e0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000126f0: 2066 6f72 6d61 7474 696e 672e 6461 7461   formatting.data
-00012700: 7365 745f 7265 7072 2873 656c 6629 0a0a  set_repr(self)..
-00012710: 2020 2020 6465 6620 5f72 6570 725f 6874      def _repr_ht
-00012720: 6d6c 5f28 7365 6c66 2920 2d3e 2073 7472  ml_(self) -> str
-00012730: 3a0a 2020 2020 2020 2020 6966 204f 5054  :.        if OPT
-00012740: 494f 4e53 5b22 6469 7370 6c61 795f 7374  IONS["display_st
-00012750: 796c 6522 5d20 3d3d 2022 7465 7874 223a  yle"] == "text":
-00012760: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00012770: 7572 6e20 6622 3c70 7265 3e7b 6573 6361  urn f"<pre>{esca
-00012780: 7065 2872 6570 7228 7365 6c66 2929 7d3c  pe(repr(self))}<
-00012790: 2f70 7265 3e22 0a20 2020 2020 2020 2072  /pre>".        r
-000127a0: 6574 7572 6e20 666f 726d 6174 7469 6e67  eturn formatting
-000127b0: 5f68 746d 6c2e 6461 7461 7365 745f 7265  _html.dataset_re
-000127c0: 7072 2873 656c 6629 0a0a 2020 2020 6465  pr(self)..    de
-000127d0: 6620 696e 666f 2873 656c 662c 2062 7566  f info(self, buf
-000127e0: 3a20 494f 207c 204e 6f6e 6520 3d20 4e6f  : IO | None = No
-000127f0: 6e65 2920 2d3e 204e 6f6e 653a 0a20 2020  ne) -> None:.   
-00012800: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00012810: 2043 6f6e 6369 7365 2073 756d 6d61 7279   Concise summary
-00012820: 206f 6620 6120 4461 7461 7365 7420 7661   of a Dataset va
-00012830: 7269 6162 6c65 7320 616e 6420 6174 7472  riables and attr
-00012840: 6962 7574 6573 2e0a 0a20 2020 2020 2020  ibutes...       
-00012850: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00012860: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00012870: 2020 2020 2020 2062 7566 203a 2066 696c         buf : fil
-00012880: 652d 6c69 6b65 2c20 6465 6661 756c 743a  e-like, default:
-00012890: 2073 7973 2e73 7464 6f75 740a 2020 2020   sys.stdout.    
-000128a0: 2020 2020 2020 2020 7772 6974 6162 6c65          writable
-000128b0: 2062 7566 6665 720a 0a20 2020 2020 2020   buffer..       
-000128c0: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-000128d0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-000128e0: 2020 2070 616e 6461 732e 4461 7461 4672     pandas.DataFr
-000128f0: 616d 652e 6173 7369 676e 0a20 2020 2020  ame.assign.     
-00012900: 2020 206e 6364 756d 7020 3a20 6e65 7443     ncdump : netC
-00012910: 4446 2773 206e 6364 756d 700a 2020 2020  DF's ncdump.    
-00012920: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00012930: 6966 2062 7566 2069 7320 4e6f 6e65 3a20  if buf is None: 
-00012940: 2023 2070 7261 676d 613a 206e 6f20 636f   # pragma: no co
-00012950: 7665 720a 2020 2020 2020 2020 2020 2020  ver.            
-00012960: 6275 6620 3d20 7379 732e 7374 646f 7574  buf = sys.stdout
-00012970: 0a0a 2020 2020 2020 2020 6c69 6e65 7320  ..        lines 
-00012980: 3d20 5b5d 0a20 2020 2020 2020 206c 696e  = [].        lin
-00012990: 6573 2e61 7070 656e 6428 2278 6172 7261  es.append("xarra
-000129a0: 792e 4461 7461 7365 7420 7b22 290a 2020  y.Dataset {").  
-000129b0: 2020 2020 2020 6c69 6e65 732e 6170 7065        lines.appe
-000129c0: 6e64 2822 6469 6d65 6e73 696f 6e73 3a22  nd("dimensions:"
-000129d0: 290a 2020 2020 2020 2020 666f 7220 6e61  ).        for na
-000129e0: 6d65 2c20 7369 7a65 2069 6e20 7365 6c66  me, size in self
-000129f0: 2e64 696d 732e 6974 656d 7328 293a 0a20  .dims.items():. 
-00012a00: 2020 2020 2020 2020 2020 206c 696e 6573             lines
-00012a10: 2e61 7070 656e 6428 6622 5c74 7b6e 616d  .append(f"\t{nam
-00012a20: 657d 203d 207b 7369 7a65 7d20 3b22 290a  e} = {size} ;").
-00012a30: 2020 2020 2020 2020 6c69 6e65 732e 6170          lines.ap
-00012a40: 7065 6e64 2822 5c6e 7661 7269 6162 6c65  pend("\nvariable
-00012a50: 733a 2229 0a20 2020 2020 2020 2066 6f72  s:").        for
-00012a60: 206e 616d 652c 2064 6120 696e 2073 656c   name, da in sel
-00012a70: 662e 7661 7269 6162 6c65 732e 6974 656d  f.variables.item
-00012a80: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00012a90: 2064 696d 7320 3d20 222c 2022 2e6a 6f69   dims = ", ".joi
-00012aa0: 6e28 6d61 7028 7374 722c 2064 612e 6469  n(map(str, da.di
-00012ab0: 6d73 2929 0a20 2020 2020 2020 2020 2020  ms)).           
-00012ac0: 206c 696e 6573 2e61 7070 656e 6428 6622   lines.append(f"
-00012ad0: 5c74 7b64 612e 6474 7970 657d 207b 6e61  \t{da.dtype} {na
-00012ae0: 6d65 7d28 7b64 696d 737d 2920 3b22 290a  me}({dims}) ;").
-00012af0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00012b00: 6b2c 2076 2069 6e20 6461 2e61 7474 7273  k, v in da.attrs
-00012b10: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00012b20: 2020 2020 2020 2020 2020 6c69 6e65 732e            lines.
-00012b30: 6170 7065 6e64 2866 225c 745c 747b 6e61  append(f"\t\t{na
-00012b40: 6d65 7d3a 7b6b 7d20 3d20 7b76 7d20 3b22  me}:{k} = {v} ;"
-00012b50: 290a 2020 2020 2020 2020 6c69 6e65 732e  ).        lines.
-00012b60: 6170 7065 6e64 2822 5c6e 2f2f 2067 6c6f  append("\n// glo
-00012b70: 6261 6c20 6174 7472 6962 7574 6573 3a22  bal attributes:"
-00012b80: 290a 2020 2020 2020 2020 666f 7220 6b2c  ).        for k,
-00012b90: 2076 2069 6e20 7365 6c66 2e61 7474 7273   v in self.attrs
-00012ba0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00012bb0: 2020 2020 2020 6c69 6e65 732e 6170 7065        lines.appe
-00012bc0: 6e64 2866 225c 743a 7b6b 7d20 3d20 7b76  nd(f"\t:{k} = {v
-00012bd0: 7d20 3b22 290a 2020 2020 2020 2020 6c69  } ;").        li
-00012be0: 6e65 732e 6170 7065 6e64 2822 7d22 290a  nes.append("}").
-00012bf0: 0a20 2020 2020 2020 2062 7566 2e77 7269  .        buf.wri
-00012c00: 7465 2822 5c6e 222e 6a6f 696e 286c 696e  te("\n".join(lin
-00012c10: 6573 2929 0a0a 2020 2020 4070 726f 7065  es))..    @prope
-00012c20: 7274 790a 2020 2020 6465 6620 6368 756e  rty.    def chun
-00012c30: 6b73 2873 656c 6629 202d 3e20 4d61 7070  ks(self) -> Mapp
-00012c40: 696e 675b 4861 7368 6162 6c65 2c20 7475  ing[Hashable, tu
-00012c50: 706c 655b 696e 742c 202e 2e2e 5d5d 3a0a  ple[int, ...]]:.
-00012c60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00012c70: 2020 2020 4d61 7070 696e 6720 6672 6f6d      Mapping from
-00012c80: 2064 696d 656e 7369 6f6e 206e 616d 6573   dimension names
-00012c90: 2074 6f20 626c 6f63 6b20 6c65 6e67 7468   to block length
-00012ca0: 7320 666f 7220 7468 6973 2064 6174 6173  s for this datas
-00012cb0: 6574 2773 2064 6174 612c 206f 7220 4e6f  et's data, or No
-00012cc0: 6e65 2069 660a 2020 2020 2020 2020 7468  ne if.        th
-00012cd0: 6520 756e 6465 726c 7969 6e67 2064 6174  e underlying dat
-00012ce0: 6120 6973 206e 6f74 2061 2064 6173 6b20  a is not a dask 
-00012cf0: 6172 7261 792e 0a20 2020 2020 2020 2043  array..        C
-00012d00: 616e 6e6f 7420 6265 206d 6f64 6966 6965  annot be modifie
-00012d10: 6420 6469 7265 6374 6c79 2c20 6275 7420  d directly, but 
-00012d20: 6361 6e20 6265 206d 6f64 6966 6965 6420  can be modified 
-00012d30: 6279 2063 616c 6c69 6e67 202e 6368 756e  by calling .chun
-00012d40: 6b28 292e 0a0a 2020 2020 2020 2020 5361  k()...        Sa
-00012d50: 6d65 2061 7320 4461 7461 7365 742e 6368  me as Dataset.ch
-00012d60: 756e 6b73 697a 6573 2c20 6275 7420 6d61  unksizes, but ma
-00012d70: 696e 7461 696e 6564 2066 6f72 2062 6163  intained for bac
-00012d80: 6b77 6172 6473 2063 6f6d 7061 7469 6269  kwards compatibi
-00012d90: 6c69 7479 2e0a 0a20 2020 2020 2020 2053  lity...        S
-00012da0: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
-00012db0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00012dc0: 2044 6174 6173 6574 2e63 6875 6e6b 0a20   Dataset.chunk. 
-00012dd0: 2020 2020 2020 2044 6174 6173 6574 2e63         Dataset.c
-00012de0: 6875 6e6b 7369 7a65 730a 2020 2020 2020  hunksizes.      
-00012df0: 2020 7861 7272 6179 2e75 6e69 6679 5f63    xarray.unify_c
-00012e00: 6875 6e6b 730a 2020 2020 2020 2020 2222  hunks.        ""
-00012e10: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00012e20: 2067 6574 5f63 6875 6e6b 7369 7a65 7328   get_chunksizes(
-00012e30: 7365 6c66 2e76 6172 6961 626c 6573 2e76  self.variables.v
-00012e40: 616c 7565 7328 2929 0a0a 2020 2020 4070  alues())..    @p
-00012e50: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00012e60: 6368 756e 6b73 697a 6573 2873 656c 6629  chunksizes(self)
-00012e70: 202d 3e20 4d61 7070 696e 675b 4861 7368   -> Mapping[Hash
-00012e80: 6162 6c65 2c20 7475 706c 655b 696e 742c  able, tuple[int,
-00012e90: 202e 2e2e 5d5d 3a0a 2020 2020 2020 2020   ...]]:.        
-00012ea0: 2222 220a 2020 2020 2020 2020 4d61 7070  """.        Mapp
-00012eb0: 696e 6720 6672 6f6d 2064 696d 656e 7369  ing from dimensi
-00012ec0: 6f6e 206e 616d 6573 2074 6f20 626c 6f63  on names to bloc
-00012ed0: 6b20 6c65 6e67 7468 7320 666f 7220 7468  k lengths for th
-00012ee0: 6973 2064 6174 6173 6574 2773 2064 6174  is dataset's dat
-00012ef0: 612c 206f 7220 4e6f 6e65 2069 660a 2020  a, or None if.  
-00012f00: 2020 2020 2020 7468 6520 756e 6465 726c        the underl
-00012f10: 7969 6e67 2064 6174 6120 6973 206e 6f74  ying data is not
-00012f20: 2061 2064 6173 6b20 6172 7261 792e 0a20   a dask array.. 
-00012f30: 2020 2020 2020 2043 616e 6e6f 7420 6265         Cannot be
-00012f40: 206d 6f64 6966 6965 6420 6469 7265 6374   modified direct
-00012f50: 6c79 2c20 6275 7420 6361 6e20 6265 206d  ly, but can be m
-00012f60: 6f64 6966 6965 6420 6279 2063 616c 6c69  odified by calli
-00012f70: 6e67 202e 6368 756e 6b28 292e 0a0a 2020  ng .chunk()...  
-00012f80: 2020 2020 2020 5361 6d65 2061 7320 4461        Same as Da
-00012f90: 7461 7365 742e 6368 756e 6b73 2e0a 0a20  taset.chunks... 
-00012fa0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00012fb0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00012fc0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
-00012fd0: 2e63 6875 6e6b 0a20 2020 2020 2020 2044  .chunk.        D
-00012fe0: 6174 6173 6574 2e63 6875 6e6b 730a 2020  ataset.chunks.  
-00012ff0: 2020 2020 2020 7861 7272 6179 2e75 6e69        xarray.uni
-00013000: 6679 5f63 6875 6e6b 730a 2020 2020 2020  fy_chunks.      
-00013010: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00013020: 7475 726e 2067 6574 5f63 6875 6e6b 7369  turn get_chunksi
-00013030: 7a65 7328 7365 6c66 2e76 6172 6961 626c  zes(self.variabl
-00013040: 6573 2e76 616c 7565 7328 2929 0a0a 2020  es.values())..  
-00013050: 2020 6465 6620 6368 756e 6b28 0a20 2020    def chunk(.   
-00013060: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-00013070: 6173 6574 2c0a 2020 2020 2020 2020 6368  aset,.        ch
-00013080: 756e 6b73 3a20 280a 2020 2020 2020 2020  unks: (.        
-00013090: 2020 2020 696e 7420 7c20 4c69 7465 7261      int | Litera
-000130a0: 6c5b 2261 7574 6f22 5d20 7c20 4d61 7070  l["auto"] | Mapp
-000130b0: 696e 675b 416e 792c 204e 6f6e 6520 7c20  ing[Any, None | 
-000130c0: 696e 7420 7c20 7374 7220 7c20 7475 706c  int | str | tupl
-000130d0: 655b 696e 742c 202e 2e2e 5d5d 0a20 2020  e[int, ...]].   
-000130e0: 2020 2020 2029 203d 207b 7d2c 2020 2320       ) = {},  # 
-000130f0: 7b7d 2065 7665 6e20 7468 6f75 6768 2069  {} even though i
-00013100: 7427 7320 7465 6368 6e69 6361 6c6c 7920  t's technically 
-00013110: 756e 7361 6665 2c20 6973 2062 6569 6e67  unsafe, is being
-00013120: 2075 7365 6420 696e 7465 6e74 696f 6e61   used intentiona
-00013130: 6c6c 7920 6865 7265 2028 2334 3636 3729  lly here (#4667)
-00013140: 0a20 2020 2020 2020 206e 616d 655f 7072  .        name_pr
-00013150: 6566 6978 3a20 7374 7220 3d20 2278 6172  efix: str = "xar
-00013160: 7261 792d 222c 0a20 2020 2020 2020 2074  ray-",.        t
-00013170: 6f6b 656e 3a20 7374 7220 7c20 4e6f 6e65  oken: str | None
-00013180: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00013190: 206c 6f63 6b3a 2062 6f6f 6c20 3d20 4661   lock: bool = Fa
-000131a0: 6c73 652c 0a20 2020 2020 2020 2069 6e6c  lse,.        inl
-000131b0: 696e 655f 6172 7261 793a 2062 6f6f 6c20  ine_array: bool 
-000131c0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-000131d0: 202a 2a63 6875 6e6b 735f 6b77 6172 6773   **chunks_kwargs
-000131e0: 3a20 4e6f 6e65 207c 2069 6e74 207c 2073  : None | int | s
-000131f0: 7472 207c 2074 7570 6c65 5b69 6e74 2c20  tr | tuple[int, 
-00013200: 2e2e 2e5d 2c0a 2020 2020 2920 2d3e 2054  ...],.    ) -> T
-00013210: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-00013220: 2020 2222 2243 6f65 7263 6520 616c 6c20    """Coerce all 
-00013230: 6172 7261 7973 2069 6e20 7468 6973 2064  arrays in this d
-00013240: 6174 6173 6574 2069 6e74 6f20 6461 736b  ataset into dask
-00013250: 2061 7272 6179 7320 7769 7468 2074 6865   arrays with the
-00013260: 2067 6976 656e 0a20 2020 2020 2020 2063   given.        c
-00013270: 6875 6e6b 732e 0a0a 2020 2020 2020 2020  hunks...        
-00013280: 4e6f 6e2d 6461 736b 2061 7272 6179 7320  Non-dask arrays 
-00013290: 696e 2074 6869 7320 6461 7461 7365 7420  in this dataset 
-000132a0: 7769 6c6c 2062 6520 636f 6e76 6572 7465  will be converte
-000132b0: 6420 746f 2064 6173 6b20 6172 7261 7973  d to dask arrays
-000132c0: 2e20 4461 736b 0a20 2020 2020 2020 2061  . Dask.        a
-000132d0: 7272 6179 7320 7769 6c6c 2062 6520 7265  rrays will be re
-000132e0: 6368 756e 6b65 6420 746f 2074 6865 2067  chunked to the g
-000132f0: 6976 656e 2063 6875 6e6b 2073 697a 6573  iven chunk sizes
-00013300: 2e0a 0a20 2020 2020 2020 2049 6620 6e65  ...        If ne
-00013310: 6974 6865 7220 6368 756e 6b73 2069 7320  ither chunks is 
-00013320: 6e6f 7420 7072 6f76 6964 6564 2066 6f72  not provided for
-00013330: 206f 6e65 206f 7220 6d6f 7265 2064 696d   one or more dim
-00013340: 656e 7369 6f6e 732c 2063 6875 6e6b 0a20  ensions, chunk. 
-00013350: 2020 2020 2020 2073 697a 6573 2061 6c6f         sizes alo
-00013360: 6e67 2074 6861 7420 6469 6d65 6e73 696f  ng that dimensio
-00013370: 6e20 7769 6c6c 206e 6f74 2062 6520 7570  n will not be up
-00013380: 6461 7465 643b 206e 6f6e 2d64 6173 6b20  dated; non-dask 
-00013390: 6172 7261 7973 2077 696c 6c20 6265 0a20  arrays will be. 
-000133a0: 2020 2020 2020 2063 6f6e 7665 7274 6564         converted
-000133b0: 2069 6e74 6f20 6461 736b 2061 7272 6179   into dask array
-000133c0: 7320 7769 7468 2061 2073 696e 676c 6520  s with a single 
-000133d0: 626c 6f63 6b2e 0a0a 2020 2020 2020 2020  block...        
-000133e0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-000133f0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00013400: 2020 2020 2020 6368 756e 6b73 203a 2069        chunks : i
-00013410: 6e74 2c20 7475 706c 6520 6f66 2069 6e74  nt, tuple of int
-00013420: 2c20 2261 7574 6f22 206f 7220 6d61 7070  , "auto" or mapp
-00013430: 696e 6720 6f66 2068 6173 6861 626c 6520  ing of hashable 
-00013440: 746f 2069 6e74 2c20 6f70 7469 6f6e 616c  to int, optional
-00013450: 0a20 2020 2020 2020 2020 2020 2043 6875  .            Chu
-00013460: 6e6b 2073 697a 6573 2061 6c6f 6e67 2065  nk sizes along e
-00013470: 6163 6820 6469 6d65 6e73 696f 6e2c 2065  ach dimension, e
-00013480: 2e67 2e2c 2060 6035 6060 2c20 6060 2261  .g., ``5``, ``"a
-00013490: 7574 6f22 6060 2c20 6f72 0a20 2020 2020  uto"``, or.     
-000134a0: 2020 2020 2020 2060 607b 2278 223a 2035         ``{"x": 5
-000134b0: 2c20 2279 223a 2035 7d60 602e 0a20 2020  , "y": 5}``..   
-000134c0: 2020 2020 206e 616d 655f 7072 6566 6978       name_prefix
-000134d0: 203a 2073 7472 2c20 6465 6661 756c 743a   : str, default:
-000134e0: 2022 7861 7272 6179 2d22 0a20 2020 2020   "xarray-".     
-000134f0: 2020 2020 2020 2050 7265 6669 7820 666f         Prefix fo
-00013500: 7220 7468 6520 6e61 6d65 206f 6620 616e  r the name of an
-00013510: 7920 6e65 7720 6461 736b 2061 7272 6179  y new dask array
-00013520: 732e 0a20 2020 2020 2020 2074 6f6b 656e  s..        token
-00013530: 203a 2073 7472 2c20 6f70 7469 6f6e 616c   : str, optional
-00013540: 0a20 2020 2020 2020 2020 2020 2054 6f6b  .            Tok
-00013550: 656e 2075 6e69 7175 656c 7920 6964 656e  en uniquely iden
-00013560: 7469 6679 696e 6720 7468 6973 2064 6174  tifying this dat
-00013570: 6173 6574 2e0a 2020 2020 2020 2020 6c6f  aset..        lo
-00013580: 636b 203a 2062 6f6f 6c2c 2064 6566 6175  ck : bool, defau
-00013590: 6c74 3a20 4661 6c73 650a 2020 2020 2020  lt: False.      
-000135a0: 2020 2020 2020 5061 7373 6564 206f 6e20        Passed on 
-000135b0: 746f 203a 7079 3a66 756e 633a 6064 6173  to :py:func:`das
-000135c0: 6b2e 6172 7261 792e 6672 6f6d 5f61 7272  k.array.from_arr
-000135d0: 6179 602c 2069 6620 7468 6520 6172 7261  ay`, if the arra
-000135e0: 7920 6973 206e 6f74 0a20 2020 2020 2020  y is not.       
-000135f0: 2020 2020 2061 6c72 6561 6479 2061 7320       already as 
-00013600: 6461 736b 2061 7272 6179 2e0a 2020 2020  dask array..    
-00013610: 2020 2020 696e 6c69 6e65 5f61 7272 6179      inline_array
-00013620: 3a20 626f 6f6c 2c20 6465 6661 756c 743a  : bool, default:
-00013630: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-00013640: 2020 2050 6173 7365 6420 6f6e 2074 6f20     Passed on to 
-00013650: 3a70 793a 6675 6e63 3a60 6461 736b 2e61  :py:func:`dask.a
-00013660: 7272 6179 2e66 726f 6d5f 6172 7261 7960  rray.from_array`
-00013670: 2c20 6966 2074 6865 2061 7272 6179 2069  , if the array i
-00013680: 7320 6e6f 740a 2020 2020 2020 2020 2020  s not.          
-00013690: 2020 616c 7265 6164 7920 6173 2064 6173    already as das
-000136a0: 6b20 6172 7261 792e 0a20 2020 2020 2020  k array..       
-000136b0: 202a 2a63 6875 6e6b 735f 6b77 6172 6773   **chunks_kwargs
-000136c0: 203a 207b 6469 6d3a 2063 6875 6e6b 732c   : {dim: chunks,
-000136d0: 202e 2e2e 7d2c 206f 7074 696f 6e61 6c0a   ...}, optional.
-000136e0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-000136f0: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-00013700: 7320 666f 726d 206f 6620 6060 6368 756e  s form of ``chun
-00013710: 6b73 6060 2e0a 2020 2020 2020 2020 2020  ks``..          
-00013720: 2020 4f6e 6520 6f66 2063 6875 6e6b 7320    One of chunks 
-00013730: 6f72 2063 6875 6e6b 735f 6b77 6172 6773  or chunks_kwargs
-00013740: 206d 7573 7420 6265 2070 726f 7669 6465   must be provide
-00013750: 640a 0a20 2020 2020 2020 2052 6574 7572  d..        Retur
-00013760: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-00013770: 2d2d 0a20 2020 2020 2020 2063 6875 6e6b  --.        chunk
-00013780: 6564 203a 2078 6172 7261 792e 4461 7461  ed : xarray.Data
-00013790: 7365 740a 0a20 2020 2020 2020 2053 6565  set..        See
-000137a0: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-000137b0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
-000137c0: 6174 6173 6574 2e63 6875 6e6b 730a 2020  ataset.chunks.  
-000137d0: 2020 2020 2020 4461 7461 7365 742e 6368        Dataset.ch
-000137e0: 756e 6b73 697a 6573 0a20 2020 2020 2020  unksizes.       
-000137f0: 2078 6172 7261 792e 756e 6966 795f 6368   xarray.unify_ch
-00013800: 756e 6b73 0a20 2020 2020 2020 2064 6173  unks.        das
-00013810: 6b2e 6172 7261 792e 6672 6f6d 5f61 7272  k.array.from_arr
-00013820: 6179 0a20 2020 2020 2020 2022 2222 0a20  ay.        """. 
-00013830: 2020 2020 2020 2069 6620 6368 756e 6b73         if chunks
-00013840: 2069 7320 4e6f 6e65 2061 6e64 2063 6875   is None and chu
-00013850: 6e6b 735f 6b77 6172 6773 2069 7320 4e6f  nks_kwargs is No
-00013860: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00013870: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
-00013880: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00013890: 4e6f 6e65 2076 616c 7565 2066 6f72 2027  None value for '
-000138a0: 6368 756e 6b73 2720 6973 2064 6570 7265  chunks' is depre
-000138b0: 6361 7465 642e 2022 0a20 2020 2020 2020  cated. ".       
-000138c0: 2020 2020 2020 2020 2022 4974 2077 696c           "It wil
-000138d0: 6c20 7261 6973 6520 616e 2065 7272 6f72  l raise an error
-000138e0: 2069 6e20 7468 6520 6675 7475 7265 2e20   in the future. 
-000138f0: 5573 6520 696e 7374 6561 6420 277b 7d27  Use instead '{}'
-00013900: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00013910: 2020 2063 6174 6567 6f72 793d 4675 7475     category=Futu
-00013920: 7265 5761 726e 696e 672c 0a20 2020 2020  reWarning,.     
-00013930: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00013940: 2020 2020 2063 6875 6e6b 7320 3d20 7b7d       chunks = {}
-00013950: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-00013960: 6e73 7461 6e63 6528 6368 756e 6b73 2c20  nstance(chunks, 
-00013970: 284e 756d 6265 722c 2073 7472 2c20 696e  (Number, str, in
-00013980: 7429 293a 0a20 2020 2020 2020 2020 2020  t)):.           
-00013990: 2063 6875 6e6b 7320 3d20 6469 6374 2e66   chunks = dict.f
-000139a0: 726f 6d6b 6579 7328 7365 6c66 2e64 696d  romkeys(self.dim
-000139b0: 732c 2063 6875 6e6b 7329 0a20 2020 2020  s, chunks).     
-000139c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000139d0: 2020 2020 2063 6875 6e6b 7320 3d20 6569       chunks = ei
-000139e0: 7468 6572 5f64 6963 745f 6f72 5f6b 7761  ther_dict_or_kwa
-000139f0: 7267 7328 6368 756e 6b73 2c20 6368 756e  rgs(chunks, chun
-00013a00: 6b73 5f6b 7761 7267 732c 2022 6368 756e  ks_kwargs, "chun
-00013a10: 6b22 290a 0a20 2020 2020 2020 2062 6164  k")..        bad
-00013a20: 5f64 696d 7320 3d20 6368 756e 6b73 2e6b  _dims = chunks.k
-00013a30: 6579 7328 2920 2d20 7365 6c66 2e64 696d  eys() - self.dim
-00013a40: 732e 6b65 7973 2829 0a20 2020 2020 2020  s.keys().       
-00013a50: 2069 6620 6261 645f 6469 6d73 3a0a 2020   if bad_dims:.  
-00013a60: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00013a70: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00013a80: 2020 2020 2020 2020 2020 2020 6622 736f              f"so
-00013a90: 6d65 2063 6875 6e6b 7320 6b65 7973 2061  me chunks keys a
-00013aa0: 7265 206e 6f74 2064 696d 656e 7369 6f6e  re not dimension
-00013ab0: 7320 6f6e 2074 6869 7320 6f62 6a65 6374  s on this object
-00013ac0: 3a20 7b62 6164 5f64 696d 737d 220a 2020  : {bad_dims}".  
-00013ad0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00013ae0: 2020 2020 2076 6172 6961 626c 6573 203d       variables =
-00013af0: 207b 0a20 2020 2020 2020 2020 2020 206b   {.            k
-00013b00: 3a20 5f6d 6179 6265 5f63 6875 6e6b 286b  : _maybe_chunk(k
-00013b10: 2c20 762c 2063 6875 6e6b 732c 2074 6f6b  , v, chunks, tok
-00013b20: 656e 2c20 6c6f 636b 2c20 6e61 6d65 5f70  en, lock, name_p
-00013b30: 7265 6669 7829 0a20 2020 2020 2020 2020  refix).         
-00013b40: 2020 2066 6f72 206b 2c20 7620 696e 2073     for k, v in s
-00013b50: 656c 662e 7661 7269 6162 6c65 732e 6974  elf.variables.it
-00013b60: 656d 7328 290a 2020 2020 2020 2020 7d0a  ems().        }.
-00013b70: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00013b80: 656c 662e 5f72 6570 6c61 6365 2876 6172  elf._replace(var
-00013b90: 6961 626c 6573 290a 0a20 2020 2064 6566  iables)..    def
-00013ba0: 205f 7661 6c69 6461 7465 5f69 6e64 6578   _validate_index
-00013bb0: 6572 7328 0a20 2020 2020 2020 2073 656c  ers(.        sel
-00013bc0: 662c 2069 6e64 6578 6572 733a 204d 6170  f, indexers: Map
-00013bd0: 7069 6e67 5b41 6e79 2c20 416e 795d 2c20  ping[Any, Any], 
-00013be0: 6d69 7373 696e 675f 6469 6d73 3a20 4572  missing_dims: Er
-00013bf0: 726f 724f 7074 696f 6e73 5769 7468 5761  rorOptionsWithWa
-00013c00: 726e 203d 2022 7261 6973 6522 0a20 2020  rn = "raise".   
-00013c10: 2029 202d 3e20 4974 6572 6174 6f72 5b74   ) -> Iterator[t
-00013c20: 7570 6c65 5b48 6173 6861 626c 652c 2069  uple[Hashable, i
-00013c30: 6e74 207c 2073 6c69 6365 207c 206e 702e  nt | slice | np.
-00013c40: 6e64 6172 7261 7920 7c20 5661 7269 6162  ndarray | Variab
-00013c50: 6c65 5d5d 3a0a 2020 2020 2020 2020 2222  le]]:.        ""
-00013c60: 2248 6572 6520 7765 206d 616b 6520 7375  "Here we make su
-00013c70: 7265 0a20 2020 2020 2020 202b 2069 6e64  re.        + ind
-00013c80: 6578 6572 2068 6173 2061 2076 616c 6964  exer has a valid
-00013c90: 206b 6579 730a 2020 2020 2020 2020 2b20   keys.        + 
-00013ca0: 696e 6465 7865 7220 6973 2069 6e20 6120  indexer is in a 
-00013cb0: 7661 6c69 6420 6461 7461 2074 7970 650a  valid data type.
-00013cc0: 2020 2020 2020 2020 2b20 7374 7269 6e67          + string
-00013cd0: 2069 6e64 6578 6572 7320 6172 6520 6361   indexers are ca
-00013ce0: 7374 2074 6f20 7468 6520 6170 7072 6f70  st to the approp
-00013cf0: 7269 6174 6520 6461 7465 2074 7970 6520  riate date type 
-00013d00: 6966 2074 6865 0a20 2020 2020 2020 2020  if the.         
-00013d10: 2061 7373 6f63 6961 7465 6420 696e 6465   associated inde
-00013d20: 7820 6973 2061 2044 6174 6574 696d 6549  x is a DatetimeI
-00013d30: 6e64 6578 206f 7220 4346 5469 6d65 496e  ndex or CFTimeIn
-00013d40: 6465 780a 2020 2020 2020 2020 2222 220a  dex.        """.
-00013d50: 2020 2020 2020 2020 6672 6f6d 2078 6172          from xar
-00013d60: 7261 792e 636f 6469 6e67 2e63 6674 696d  ray.coding.cftim
-00013d70: 6569 6e64 6578 2069 6d70 6f72 7420 4346  eindex import CF
-00013d80: 5469 6d65 496e 6465 780a 2020 2020 2020  TimeIndex.      
-00013d90: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
-00013da0: 7265 2e64 6174 6161 7272 6179 2069 6d70  re.dataarray imp
-00013db0: 6f72 7420 4461 7461 4172 7261 790a 0a20  ort DataArray.. 
-00013dc0: 2020 2020 2020 2069 6e64 6578 6572 7320         indexers 
-00013dd0: 3d20 6472 6f70 5f64 696d 735f 6672 6f6d  = drop_dims_from
-00013de0: 5f69 6e64 6578 6572 7328 696e 6465 7865  _indexers(indexe
-00013df0: 7273 2c20 7365 6c66 2e64 696d 732c 206d  rs, self.dims, m
-00013e00: 6973 7369 6e67 5f64 696d 7329 0a0a 2020  issing_dims)..  
-00013e10: 2020 2020 2020 2320 616c 6c20 696e 6465        # all inde
-00013e20: 7865 7273 2073 686f 756c 6420 6265 2069  xers should be i
-00013e30: 6e74 2c20 736c 6963 652c 206e 702e 6e64  nt, slice, np.nd
-00013e40: 6172 7261 7973 2c20 6f72 2056 6172 6961  arrays, or Varia
-00013e50: 626c 650a 2020 2020 2020 2020 666f 7220  ble.        for 
-00013e60: 6b2c 2076 2069 6e20 696e 6465 7865 7273  k, v in indexers
-00013e70: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00013e80: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00013e90: 6e63 6528 762c 2028 696e 742c 2073 6c69  nce(v, (int, sli
-00013ea0: 6365 2c20 5661 7269 6162 6c65 2929 3a0a  ce, Variable)):.
-00013eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ec0: 7969 656c 6420 6b2c 2076 0a20 2020 2020  yield k, v.     
-00013ed0: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-00013ee0: 7374 616e 6365 2876 2c20 4461 7461 4172  stance(v, DataAr
-00013ef0: 7261 7929 3a0a 2020 2020 2020 2020 2020  ray):.          
-00013f00: 2020 2020 2020 7969 656c 6420 6b2c 2076        yield k, v
-00013f10: 2e76 6172 6961 626c 650a 2020 2020 2020  .variable.      
-00013f20: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-00013f30: 7461 6e63 6528 762c 2074 7570 6c65 293a  tance(v, tuple):
-00013f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013f50: 2079 6965 6c64 206b 2c20 6173 5f76 6172   yield k, as_var
-00013f60: 6961 626c 6528 7629 0a20 2020 2020 2020  iable(v).       
-00013f70: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-00013f80: 616e 6365 2876 2c20 4461 7461 7365 7429  ance(v, Dataset)
-00013f90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013fa0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-00013fb0: 7228 2263 616e 6e6f 7420 7573 6520 6120  r("cannot use a 
-00013fc0: 4461 7461 7365 7420 6173 2061 6e20 696e  Dataset as an in
-00013fd0: 6465 7865 7222 290a 2020 2020 2020 2020  dexer").        
-00013fe0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00013ff0: 6e63 6528 762c 2053 6571 7565 6e63 6529  nce(v, Sequence)
-00014000: 2061 6e64 206c 656e 2876 2920 3d3d 2030   and len(v) == 0
-00014010: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014020: 2020 7969 656c 6420 6b2c 206e 702e 656d    yield k, np.em
-00014030: 7074 7928 2830 2c29 2c20 6474 7970 653d  pty((0,), dtype=
-00014040: 2269 6e74 3634 2229 0a20 2020 2020 2020  "int64").       
-00014050: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00014060: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00014070: 7420 6973 5f64 7563 6b5f 6172 7261 7928  t is_duck_array(
-00014080: 7629 3a0a 2020 2020 2020 2020 2020 2020  v):.            
-00014090: 2020 2020 2020 2020 7620 3d20 6e70 2e61          v = np.a
-000140a0: 7361 7272 6179 2876 290a 0a20 2020 2020  sarray(v)..     
-000140b0: 2020 2020 2020 2020 2020 2069 6620 762e             if v.
-000140c0: 6474 7970 652e 6b69 6e64 2069 6e20 2255  dtype.kind in "U
-000140d0: 5322 3a0a 2020 2020 2020 2020 2020 2020  S":.            
-000140e0: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
-000140f0: 7365 6c66 2e5f 696e 6465 7865 735b 6b5d  self._indexes[k]
-00014100: 2e74 6f5f 7061 6e64 6173 5f69 6e64 6578  .to_pandas_index
-00014110: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00014120: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00014130: 616e 6365 2869 6e64 6578 2c20 7064 2e44  ance(index, pd.D
-00014140: 6174 6574 696d 6549 6e64 6578 293a 0a20  atetimeIndex):. 
-00014150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014160: 2020 2020 2020 2076 203d 2076 2e61 7374         v = v.ast
-00014170: 7970 6528 2264 6174 6574 696d 6536 345b  ype("datetime64[
-00014180: 6e73 5d22 290a 2020 2020 2020 2020 2020  ns]").          
-00014190: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-000141a0: 7369 6e73 7461 6e63 6528 696e 6465 782c  sinstance(index,
-000141b0: 2043 4654 696d 6549 6e64 6578 293a 0a20   CFTimeIndex):. 
-000141c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141d0: 2020 2020 2020 2076 203d 205f 7061 7273         v = _pars
-000141e0: 655f 6172 7261 795f 6f66 5f63 6674 696d  e_array_of_cftim
-000141f0: 655f 7374 7269 6e67 7328 762c 2069 6e64  e_strings(v, ind
-00014200: 6578 2e64 6174 655f 7479 7065 290a 0a20  ex.date_type).. 
-00014210: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00014220: 6620 762e 6e64 696d 203e 2031 3a0a 2020  f v.ndim > 1:.  
-00014230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014240: 2020 7261 6973 6520 496e 6465 7845 7272    raise IndexErr
-00014250: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00014260: 2020 2020 2020 2020 2020 2020 2255 6e6c              "Unl
-00014270: 6162 656c 6564 206d 756c 7469 2d64 696d  abeled multi-dim
-00014280: 656e 7369 6f6e 616c 2061 7272 6179 2063  ensional array c
-00014290: 616e 6e6f 7420 6265 2022 0a20 2020 2020  annot be ".     
-000142a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142b0: 2020 2022 7573 6564 2066 6f72 2069 6e64     "used for ind
-000142c0: 6578 696e 673a 207b 7d22 2e66 6f72 6d61  exing: {}".forma
-000142d0: 7428 6b29 0a20 2020 2020 2020 2020 2020  t(k).           
-000142e0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000142f0: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-00014300: 206b 2c20 760a 0a20 2020 2064 6566 205f   k, v..    def _
-00014310: 7661 6c69 6461 7465 5f69 6e74 6572 705f  validate_interp_
-00014320: 696e 6465 7865 7273 280a 2020 2020 2020  indexers(.      
-00014330: 2020 7365 6c66 2c20 696e 6465 7865 7273    self, indexers
-00014340: 3a20 4d61 7070 696e 675b 416e 792c 2041  : Mapping[Any, A
-00014350: 6e79 5d0a 2020 2020 2920 2d3e 2049 7465  ny].    ) -> Ite
-00014360: 7261 746f 725b 7475 706c 655b 4861 7368  rator[tuple[Hash
-00014370: 6162 6c65 2c20 5661 7269 6162 6c65 5d5d  able, Variable]]
-00014380: 3a0a 2020 2020 2020 2020 2222 2256 6172  :.        """Var
-00014390: 6961 6e74 206f 6620 5f76 616c 6964 6174  iant of _validat
-000143a0: 655f 696e 6465 7865 7273 2074 6f20 6265  e_indexers to be
-000143b0: 2075 7365 6420 666f 7220 696e 7465 7270   used for interp
-000143c0: 6f6c 6174 696f 6e22 2222 0a20 2020 2020  olation""".     
-000143d0: 2020 2066 6f72 206b 2c20 7620 696e 2073     for k, v in s
-000143e0: 656c 662e 5f76 616c 6964 6174 655f 696e  elf._validate_in
-000143f0: 6465 7865 7273 2869 6e64 6578 6572 7329  dexers(indexers)
-00014400: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00014410: 2069 7369 6e73 7461 6e63 6528 762c 2056   isinstance(v, V
-00014420: 6172 6961 626c 6529 3a0a 2020 2020 2020  ariable):.      
-00014430: 2020 2020 2020 2020 2020 6966 2076 2e6e            if v.n
-00014440: 6469 6d20 3d3d 2031 3a0a 2020 2020 2020  dim == 1:.      
-00014450: 2020 2020 2020 2020 2020 2020 2020 7969                yi
-00014460: 656c 6420 6b2c 2076 2e74 6f5f 696e 6465  eld k, v.to_inde
-00014470: 785f 7661 7269 6162 6c65 2829 0a20 2020  x_variable().   
-00014480: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00014490: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000144a0: 2020 2020 2020 2079 6965 6c64 206b 2c20         yield k, 
-000144b0: 760a 2020 2020 2020 2020 2020 2020 656c  v.            el
-000144c0: 6966 2069 7369 6e73 7461 6e63 6528 762c  if isinstance(v,
-000144d0: 2069 6e74 293a 0a20 2020 2020 2020 2020   int):.         
-000144e0: 2020 2020 2020 2079 6965 6c64 206b 2c20         yield k, 
-000144f0: 5661 7269 6162 6c65 2828 292c 2076 2c20  Variable((), v, 
-00014500: 6174 7472 733d 7365 6c66 2e63 6f6f 7264  attrs=self.coord
-00014510: 735b 6b5d 2e61 7474 7273 290a 2020 2020  s[k].attrs).    
-00014520: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-00014530: 6e73 7461 6e63 6528 762c 206e 702e 6e64  nstance(v, np.nd
-00014540: 6172 7261 7929 3a0a 2020 2020 2020 2020  array):.        
-00014550: 2020 2020 2020 2020 6966 2076 2e6e 6469          if v.ndi
-00014560: 6d20 3d3d 2030 3a0a 2020 2020 2020 2020  m == 0:.        
-00014570: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
-00014580: 6420 6b2c 2056 6172 6961 626c 6528 2829  d k, Variable(()
-00014590: 2c20 762c 2061 7474 7273 3d73 656c 662e  , v, attrs=self.
-000145a0: 636f 6f72 6473 5b6b 5d2e 6174 7472 7329  coords[k].attrs)
-000145b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000145c0: 2065 6c69 6620 762e 6e64 696d 203d 3d20   elif v.ndim == 
-000145d0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-000145e0: 2020 2020 2020 2079 6965 6c64 206b 2c20         yield k, 
-000145f0: 496e 6465 7856 6172 6961 626c 6528 286b  IndexVariable((k
-00014600: 2c29 2c20 762c 2061 7474 7273 3d73 656c  ,), v, attrs=sel
-00014610: 662e 636f 6f72 6473 5b6b 5d2e 6174 7472  f.coords[k].attr
-00014620: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00014630: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00014640: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00014650: 7365 2041 7373 6572 7469 6f6e 4572 726f  se AssertionErro
-00014660: 7228 2920 2023 2041 6c72 6561 6479 2074  r()  # Already t
-00014670: 6573 7465 6420 6279 205f 7661 6c69 6461  ested by _valida
-00014680: 7465 5f69 6e64 6578 6572 730a 2020 2020  te_indexers.    
-00014690: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000146a0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000146b0: 6973 6520 5479 7065 4572 726f 7228 7479  ise TypeError(ty
-000146c0: 7065 2876 2929 0a0a 2020 2020 6465 6620  pe(v))..    def 
-000146d0: 5f67 6574 5f69 6e64 6578 6572 735f 636f  _get_indexers_co
-000146e0: 6f72 6473 5f61 6e64 5f69 6e64 6578 6573  ords_and_indexes
-000146f0: 2873 656c 662c 2069 6e64 6578 6572 7329  (self, indexers)
-00014700: 3a0a 2020 2020 2020 2020 2222 2245 7874  :.        """Ext
-00014710: 7261 6374 2063 6f6f 7264 696e 6174 6573  ract coordinates
-00014720: 2061 6e64 2069 6e64 6578 6573 2066 726f   and indexes fro
-00014730: 6d20 696e 6465 7865 7273 2e0a 0a20 2020  m indexers...   
-00014740: 2020 2020 204f 6e6c 7920 636f 6f72 6469       Only coordi
-00014750: 6e61 7465 2077 6974 6820 6120 6e61 6d65  nate with a name
-00014760: 2064 6966 6665 7265 6e74 2066 726f 6d20   different from 
-00014770: 616e 7920 6f66 2073 656c 662e 7661 7269  any of self.vari
-00014780: 6162 6c65 7320 7769 6c6c 0a20 2020 2020  ables will.     
-00014790: 2020 2062 6520 6174 7461 6368 6564 2e0a     be attached..
-000147a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000147b0: 2020 2020 6672 6f6d 2078 6172 7261 792e      from xarray.
-000147c0: 636f 7265 2e64 6174 6161 7272 6179 2069  core.dataarray i
-000147d0: 6d70 6f72 7420 4461 7461 4172 7261 790a  mport DataArray.
-000147e0: 0a20 2020 2020 2020 2063 6f6f 7264 735f  .        coords_
-000147f0: 6c69 7374 203d 205b 5d0a 2020 2020 2020  list = [].      
-00014800: 2020 666f 7220 6b2c 2076 2069 6e20 696e    for k, v in in
-00014810: 6465 7865 7273 2e69 7465 6d73 2829 3a0a  dexers.items():.
-00014820: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00014830: 7369 6e73 7461 6e63 6528 762c 2044 6174  sinstance(v, Dat
-00014840: 6141 7272 6179 293a 0a20 2020 2020 2020  aArray):.       
-00014850: 2020 2020 2020 2020 2069 6620 762e 6474           if v.dt
-00014860: 7970 652e 6b69 6e64 203d 3d20 2262 223a  ype.kind == "b":
-00014870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014880: 2020 2020 2069 6620 762e 6e64 696d 2021       if v.ndim !
-00014890: 3d20 313a 2020 2320 7765 206f 6e6c 7920  = 1:  # we only 
-000148a0: 7375 7070 6f72 7420 312d 6420 626f 6f6c  support 1-d bool
-000148b0: 6561 6e20 6172 7261 790a 2020 2020 2020  ean array.      
-000148c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148d0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000148e0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014900: 227b 3a64 7d64 2d62 6f6f 6c65 616e 2061  "{:d}d-boolean a
-00014910: 7272 6179 2069 7320 7573 6564 2066 6f72  rray is used for
-00014920: 2069 6e64 6578 696e 6720 616c 6f6e 6720   indexing along 
-00014930: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00014940: 2020 2020 2020 2020 2020 2020 2020 2264                "d
-00014950: 696d 656e 7369 6f6e 207b 2172 7d2c 2062  imension {!r}, b
-00014960: 7574 206f 6e6c 7920 3164 2062 6f6f 6c65  ut only 1d boole
-00014970: 616e 2061 7272 6179 7320 6172 6520 220a  an arrays are ".
-00014980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014990: 2020 2020 2020 2020 2020 2020 2273 7570              "sup
-000149a0: 706f 7274 6564 2e22 2e66 6f72 6d61 7428  ported.".format(
-000149b0: 762e 6e64 696d 2c20 6b29 0a20 2020 2020  v.ndim, k).     
+0000c890: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c8a0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0000c8b0: 7661 6c75 652c 2044 6174 6173 6574 293a  value, Dataset):
+0000c8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c8d0: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
+0000c8e0: 2864 6963 7428 7a69 7028 6b65 796c 6973  (dict(zip(keylis
+0000c8f0: 742c 2076 616c 7565 2e64 6174 615f 7661  t, value.data_va
+0000c900: 7273 2e76 616c 7565 7328 2929 2929 0a20  rs.values()))). 
+0000c910: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000c920: 6c69 6620 6973 696e 7374 616e 6365 2876  lif isinstance(v
+0000c930: 616c 7565 2c20 4461 7461 4172 7261 7929  alue, DataArray)
+0000c940: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c950: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0000c960: 6545 7272 6f72 2822 4361 6e6e 6f74 2061  eError("Cannot a
+0000c970: 7373 6967 6e20 7369 6e67 6c65 2044 6174  ssign single Dat
+0000c980: 6141 7272 6179 2074 6f20 6d75 6c74 6970  aArray to multip
+0000c990: 6c65 206b 6579 7322 290a 2020 2020 2020  le keys").      
+0000c9a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c9c0: 2020 2020 7365 6c66 2e75 7064 6174 6528      self.update(
+0000c9d0: 6469 6374 287a 6970 286b 6579 6c69 7374  dict(zip(keylist
+0000c9e0: 2c20 7661 6c75 6529 2929 0a0a 2020 2020  , value)))..    
+0000c9f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000ca00: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0000ca10: 6545 7272 6f72 2866 2255 6e73 7570 706f  eError(f"Unsuppo
+0000ca20: 7274 6564 206b 6579 2d74 7970 6520 7b74  rted key-type {t
+0000ca30: 7970 6528 6b65 7929 7d22 290a 0a20 2020  ype(key)}")..   
+0000ca40: 2064 6566 205f 7365 7469 7465 6d5f 6368   def _setitem_ch
+0000ca50: 6563 6b28 7365 6c66 2c20 6b65 792c 2076  eck(self, key, v
+0000ca60: 616c 7565 293a 0a20 2020 2020 2020 2022  alue):.        "
+0000ca70: 2222 436f 6e73 6973 7465 6e63 7920 6368  ""Consistency ch
+0000ca80: 6563 6b20 666f 7220 5f5f 7365 7469 7465  eck for __setite
+0000ca90: 6d5f 5f0a 0a20 2020 2020 2020 2057 6865  m__..        Whe
+0000caa0: 6e20 6173 7369 676e 696e 6720 7661 6c75  n assigning valu
+0000cab0: 6573 2074 6f20 6120 7375 6273 6574 206f  es to a subset o
+0000cac0: 6620 6120 4461 7461 7365 742c 2064 6f20  f a Dataset, do 
+0000cad0: 636f 6e73 6973 7465 6e63 7920 6368 6563  consistency chec
+0000cae0: 6b20 6265 666f 7265 6861 6e64 0a20 2020  k beforehand.   
+0000caf0: 2020 2020 2074 6f20 6176 6f69 6420 6c65       to avoid le
+0000cb00: 6176 696e 6720 7468 6520 6461 7461 7365  aving the datase
+0000cb10: 7420 696e 2061 2070 6172 7469 616c 6c79  t in a partially
+0000cb20: 2075 7064 6174 6564 2073 7461 7465 2077   updated state w
+0000cb30: 6865 6e20 616e 2065 7272 6f72 206f 6363  hen an error occ
+0000cb40: 7572 732e 0a20 2020 2020 2020 2022 2222  urs..        """
+0000cb50: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
+0000cb60: 7272 6179 2e63 6f72 652e 616c 6967 6e6d  rray.core.alignm
+0000cb70: 656e 7420 696d 706f 7274 2061 6c69 676e  ent import align
+0000cb80: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
+0000cb90: 7272 6179 2e63 6f72 652e 6461 7461 6172  rray.core.dataar
+0000cba0: 7261 7920 696d 706f 7274 2044 6174 6141  ray import DataA
+0000cbb0: 7272 6179 0a0a 2020 2020 2020 2020 6966  rray..        if
+0000cbc0: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
+0000cbd0: 652c 2044 6174 6173 6574 293a 0a20 2020  e, Dataset):.   
+0000cbe0: 2020 2020 2020 2020 206d 6973 7369 6e67           missing
+0000cbf0: 5f76 6172 7320 3d20 5b0a 2020 2020 2020  _vars = [.      
+0000cc00: 2020 2020 2020 2020 2020 6e61 6d65 2066            name f
+0000cc10: 6f72 206e 616d 6520 696e 2076 616c 7565  or name in value
+0000cc20: 2e64 6174 615f 7661 7273 2069 6620 6e61  .data_vars if na
+0000cc30: 6d65 206e 6f74 2069 6e20 7365 6c66 2e64  me not in self.d
+0000cc40: 6174 615f 7661 7273 0a20 2020 2020 2020  ata_vars.       
+0000cc50: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
+0000cc60: 2020 2069 6620 6d69 7373 696e 675f 7661     if missing_va
+0000cc70: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+0000cc80: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000cc90: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0000cca0: 2020 2020 2020 2020 2020 6622 5661 7269            f"Vari
+0000ccb0: 6162 6c65 7320 7b6d 6973 7369 6e67 5f76  ables {missing_v
+0000ccc0: 6172 737d 2069 6e20 6e65 7720 7661 6c75  ars} in new valu
+0000ccd0: 6573 220a 2020 2020 2020 2020 2020 2020  es".            
+0000cce0: 2020 2020 2020 2020 6622 206e 6f74 2061          f" not a
+0000ccf0: 7661 696c 6162 6c65 2069 6e20 6f72 6967  vailable in orig
+0000cd00: 696e 616c 2064 6174 6173 6574 3a5c 6e7b  inal dataset:\n{
+0000cd10: 7365 6c66 7d22 0a20 2020 2020 2020 2020  self}".         
+0000cd20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000cd30: 2065 6c69 6620 6e6f 7420 616e 7928 5b69   elif not any([i
+0000cd40: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
+0000cd50: 2074 2920 666f 7220 7420 696e 205b 4461   t) for t in [Da
+0000cd60: 7461 4172 7261 792c 204e 756d 6265 722c  taArray, Number,
+0000cd70: 2073 7472 5d5d 293a 0a20 2020 2020 2020   str]]):.       
+0000cd80: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
+0000cd90: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0000cda0: 2020 2020 2020 2244 6174 6173 6574 2061        "Dataset a
+0000cdb0: 7373 6967 6e6d 656e 7420 6f6e 6c79 2061  ssignment only a
+0000cdc0: 6363 6570 7473 2044 6174 6141 7272 6179  ccepts DataArray
+0000cdd0: 732c 2044 6174 6173 6574 732c 2061 6e64  s, Datasets, and
+0000cde0: 2073 6361 6c61 7273 2e22 0a20 2020 2020   scalars.".     
+0000cdf0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0000ce00: 2020 6e65 775f 7661 6c75 6520 3d20 4461    new_value = Da
+0000ce10: 7461 7365 7428 290a 2020 2020 2020 2020  taset().        
+0000ce20: 666f 7220 6e61 6d65 2c20 7661 7220 696e  for name, var in
+0000ce30: 2073 656c 662e 6974 656d 7328 293a 0a20   self.items():. 
+0000ce40: 2020 2020 2020 2020 2020 2023 2074 6573             # tes
+0000ce50: 7420 696e 6465 7869 6e67 0a20 2020 2020  t indexing.     
+0000ce60: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000ce70: 2020 2020 2020 2020 2020 2020 7661 725f              var_
+0000ce80: 6b20 3d20 7661 725b 6b65 795d 0a20 2020  k = var[key].   
+0000ce90: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0000cea0: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
+0000ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cec0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0000ced0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000cee0: 2020 2020 2020 6622 5661 7269 6162 6c65        f"Variable
+0000cef0: 2027 7b6e 616d 657d 273a 2069 6e64 6578   '{name}': index
+0000cf00: 6572 207b 6b65 797d 206e 6f74 2061 7661  er {key} not ava
+0000cf10: 696c 6162 6c65 220a 2020 2020 2020 2020  ilable".        
+0000cf20: 2020 2020 2020 2020 2920 6672 6f6d 2065          ) from e
+0000cf30: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000cf40: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
+0000cf50: 652c 2044 6174 6173 6574 293a 0a20 2020  e, Dataset):.   
+0000cf60: 2020 2020 2020 2020 2020 2020 2076 616c               val
+0000cf70: 203d 2076 616c 7565 5b6e 616d 655d 0a20   = value[name]. 
+0000cf80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000cf90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cfa0: 2076 616c 203d 2076 616c 7565 0a0a 2020   val = value..  
+0000cfb0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0000cfc0: 6e73 7461 6e63 6528 7661 6c2c 2044 6174  nstance(val, Dat
+0000cfd0: 6141 7272 6179 293a 0a20 2020 2020 2020  aArray):.       
+0000cfe0: 2020 2020 2020 2020 2023 2063 6865 636b           # check
+0000cff0: 2063 6f6e 7369 7374 656e 6379 206f 6620   consistency of 
+0000d000: 6469 6d65 6e73 696f 6e73 0a20 2020 2020  dimensions.     
+0000d010: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
+0000d020: 696d 2069 6e20 7661 6c2e 6469 6d73 3a0a  im in val.dims:.
+0000d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d040: 2020 2020 6966 2064 696d 206e 6f74 2069      if dim not i
+0000d050: 6e20 7661 725f 6b2e 6469 6d73 3a0a 2020  n var_k.dims:.  
+0000d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d070: 2020 2020 2020 7261 6973 6520 4b65 7945        raise KeyE
+0000d080: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0000d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0a0: 2020 6622 5661 7269 6162 6c65 2027 7b6e    f"Variable '{n
+0000d0b0: 616d 657d 273a 2064 696d 656e 7369 6f6e  ame}': dimension
+0000d0c0: 2027 7b64 696d 7d27 2061 7070 6561 7273   '{dim}' appears
+0000d0d0: 2069 6e20 6e65 7720 7661 6c75 6573 2022   in new values "
+0000d0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d0f0: 2020 2020 2020 2020 2020 2020 2066 2262               f"b
+0000d100: 7574 206e 6f74 2069 6e20 7468 6520 696e  ut not in the in
+0000d110: 6465 7865 6420 6f72 6967 696e 616c 2064  dexed original d
+0000d120: 6174 6122 0a20 2020 2020 2020 2020 2020  ata".           
+0000d130: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000d140: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000d150: 696d 7320 3d20 7475 706c 6528 6469 6d20  ims = tuple(dim 
+0000d160: 666f 7220 6469 6d20 696e 2076 6172 5f6b  for dim in var_k
+0000d170: 2e64 696d 7320 6966 2064 696d 2069 6e20  .dims if dim in 
+0000d180: 7661 6c2e 6469 6d73 290a 2020 2020 2020  val.dims).      
+0000d190: 2020 2020 2020 2020 2020 6966 2064 696d            if dim
+0000d1a0: 7320 213d 2076 616c 2e64 696d 733a 0a20  s != val.dims:. 
+0000d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1c0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000d1d0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000d1e0: 2020 2020 2020 2020 2020 2020 2066 2256               f"V
+0000d1f0: 6172 6961 626c 6520 277b 6e61 6d65 7d27  ariable '{name}'
+0000d200: 3a20 6469 6d65 6e73 696f 6e20 6f72 6465  : dimension orde
+0000d210: 7220 6469 6666 6572 7320 6265 7477 6565  r differs betwee
+0000d220: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
+0000d230: 2020 2020 2020 2020 2020 2066 2220 6f72             f" or
+0000d240: 6967 696e 616c 2061 6e64 206e 6577 2064  iginal and new d
+0000d250: 6174 613a 5c6e 7b64 696d 737d 5c6e 7673  ata:\n{dims}\nvs
+0000d260: 2e5c 6e7b 7661 6c2e 6469 6d73 7d22 0a20  .\n{val.dims}". 
+0000d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d280: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000d290: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000d2a0: 2020 2020 2020 2076 616c 203d 206e 702e         val = np.
+0000d2b0: 6172 7261 7928 7661 6c29 0a0a 2020 2020  array(val)..    
+0000d2c0: 2020 2020 2020 2020 2320 7479 7065 2063          # type c
+0000d2d0: 6f6e 7665 7273 696f 6e0a 2020 2020 2020  onversion.      
+0000d2e0: 2020 2020 2020 6e65 775f 7661 6c75 655b        new_value[
+0000d2f0: 6e61 6d65 5d20 3d20 7661 6c2e 6173 7479  name] = val.asty
+0000d300: 7065 2876 6172 5f6b 2e64 7479 7065 2c20  pe(var_k.dtype, 
+0000d310: 636f 7079 3d46 616c 7365 290a 0a20 2020  copy=False)..   
+0000d320: 2020 2020 2023 2063 6865 636b 2063 6f6e       # check con
+0000d330: 7369 7374 656e 6379 206f 6620 6469 6d65  sistency of dime
+0000d340: 6e73 696f 6e20 7369 7a65 7320 616e 6420  nsion sizes and 
+0000d350: 6469 6d65 6e73 696f 6e20 636f 6f72 6469  dimension coordi
+0000d360: 6e61 7465 730a 2020 2020 2020 2020 6966  nates.        if
+0000d370: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
+0000d380: 652c 2044 6174 6141 7272 6179 2920 6f72  e, DataArray) or
+0000d390: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
+0000d3a0: 652c 2044 6174 6173 6574 293a 0a20 2020  e, Dataset):.   
+0000d3b0: 2020 2020 2020 2020 2061 6c69 676e 2873           align(s
+0000d3c0: 656c 665b 6b65 795d 2c20 7661 6c75 652c  elf[key], value,
+0000d3d0: 206a 6f69 6e3d 2265 7861 6374 222c 2063   join="exact", c
+0000d3e0: 6f70 793d 4661 6c73 6529 0a0a 2020 2020  opy=False)..    
+0000d3f0: 2020 2020 7265 7475 726e 206e 6577 5f76      return new_v
+0000d400: 616c 7565 0a0a 2020 2020 6465 6620 5f5f  alue..    def __
+0000d410: 6465 6c69 7465 6d5f 5f28 7365 6c66 2c20  delitem__(self, 
+0000d420: 6b65 793a 2048 6173 6861 626c 6529 202d  key: Hashable) -
+0000d430: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000d440: 2222 2252 656d 6f76 6520 6120 7661 7269  """Remove a vari
+0000d450: 6162 6c65 2066 726f 6d20 7468 6973 2064  able from this d
+0000d460: 6174 6173 6574 2e22 2222 0a20 2020 2020  ataset.""".     
+0000d470: 2020 2061 7373 6572 745f 6e6f 5f69 6e64     assert_no_ind
+0000d480: 6578 5f63 6f72 7275 7074 6564 2873 656c  ex_corrupted(sel
+0000d490: 662e 7869 6e64 6578 6573 2c20 7b6b 6579  f.xindexes, {key
+0000d4a0: 7d29 0a0a 2020 2020 2020 2020 6966 206b  })..        if k
+0000d4b0: 6579 2069 6e20 7365 6c66 2e5f 696e 6465  ey in self._inde
+0000d4c0: 7865 733a 0a20 2020 2020 2020 2020 2020  xes:.           
+0000d4d0: 2064 656c 2073 656c 662e 5f69 6e64 6578   del self._index
+0000d4e0: 6573 5b6b 6579 5d0a 2020 2020 2020 2020  es[key].        
+0000d4f0: 6465 6c20 7365 6c66 2e5f 7661 7269 6162  del self._variab
+0000d500: 6c65 735b 6b65 795d 0a20 2020 2020 2020  les[key].       
+0000d510: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
+0000d520: 6573 2e64 6973 6361 7264 286b 6579 290a  es.discard(key).
+0000d530: 2020 2020 2020 2020 7365 6c66 2e5f 6469          self._di
+0000d540: 6d73 203d 2063 616c 6375 6c61 7465 5f64  ms = calculate_d
+0000d550: 696d 656e 7369 6f6e 7328 7365 6c66 2e5f  imensions(self._
+0000d560: 7661 7269 6162 6c65 7329 0a0a 2020 2020  variables)..    
+0000d570: 2320 6d75 7461 626c 6520 6f62 6a65 6374  # mutable object
+0000d580: 7320 7368 6f75 6c64 206e 6f74 2062 6520  s should not be 
+0000d590: 6861 7368 6162 6c65 0a20 2020 2023 2068  hashable.    # h
+0000d5a0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+0000d5b0: 6d2f 7079 7468 6f6e 2f6d 7970 792f 6973  m/python/mypy/is
+0000d5c0: 7375 6573 2f34 3236 360a 2020 2020 5f5f  sues/4266.    __
+0000d5d0: 6861 7368 5f5f 203d 204e 6f6e 6520 2023  hash__ = None  #
+0000d5e0: 2074 7970 653a 2069 676e 6f72 655b 6173   type: ignore[as
+0000d5f0: 7369 676e 6d65 6e74 5d0a 0a20 2020 2064  signment]..    d
+0000d600: 6566 205f 616c 6c5f 636f 6d70 6174 2873  ef _all_compat(s
+0000d610: 656c 662c 206f 7468 6572 3a20 4461 7461  elf, other: Data
+0000d620: 7365 742c 2063 6f6d 7061 745f 7374 723a  set, compat_str:
+0000d630: 2073 7472 2920 2d3e 2062 6f6f 6c3a 0a20   str) -> bool:. 
+0000d640: 2020 2020 2020 2022 2222 4865 6c70 6572         """Helper
+0000d650: 2066 756e 6374 696f 6e20 666f 7220 6571   function for eq
+0000d660: 7561 6c73 2061 6e64 2069 6465 6e74 6963  uals and identic
+0000d670: 616c 2222 220a 0a20 2020 2020 2020 2023  al"""..        #
+0000d680: 2073 6f6d 6520 7374 6f72 6573 2028 652e   some stores (e.
+0000d690: 672e 2c20 7363 6970 7929 2064 6f20 6e6f  g., scipy) do no
+0000d6a0: 7420 7365 656d 2074 6f20 7072 6573 6572  t seem to preser
+0000d6b0: 7665 206f 7264 6572 2c20 736f 2064 6f6e  ve order, so don
+0000d6c0: 2774 0a20 2020 2020 2020 2023 2072 6571  't.        # req
+0000d6d0: 7569 7265 206d 6174 6368 696e 6720 6f72  uire matching or
+0000d6e0: 6465 7220 666f 7220 6571 7561 6c69 7479  der for equality
+0000d6f0: 0a20 2020 2020 2020 2064 6566 2063 6f6d  .        def com
+0000d700: 7061 7428 783a 2056 6172 6961 626c 652c  pat(x: Variable,
+0000d710: 2079 3a20 5661 7269 6162 6c65 2920 2d3e   y: Variable) ->
+0000d720: 2062 6f6f 6c3a 0a20 2020 2020 2020 2020   bool:.         
+0000d730: 2020 2072 6574 7572 6e20 6765 7461 7474     return getatt
+0000d740: 7228 782c 2063 6f6d 7061 745f 7374 7229  r(x, compat_str)
+0000d750: 2879 290a 0a20 2020 2020 2020 2072 6574  (y)..        ret
+0000d760: 7572 6e20 7365 6c66 2e5f 636f 6f72 645f  urn self._coord_
+0000d770: 6e61 6d65 7320 3d3d 206f 7468 6572 2e5f  names == other._
+0000d780: 636f 6f72 645f 6e61 6d65 7320 616e 6420  coord_names and 
+0000d790: 7574 696c 732e 6469 6374 5f65 7175 6976  utils.dict_equiv
+0000d7a0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0000d7b0: 6c66 2e5f 7661 7269 6162 6c65 732c 206f  lf._variables, o
+0000d7c0: 7468 6572 2e5f 7661 7269 6162 6c65 732c  ther._variables,
+0000d7d0: 2063 6f6d 7061 743d 636f 6d70 6174 0a20   compat=compat. 
+0000d7e0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0000d7f0: 6620 6272 6f61 6463 6173 745f 6571 7561  f broadcast_equa
+0000d800: 6c73 2873 656c 662c 206f 7468 6572 3a20  ls(self, other: 
+0000d810: 4461 7461 7365 7429 202d 3e20 626f 6f6c  Dataset) -> bool
+0000d820: 3a0a 2020 2020 2020 2020 2222 2254 776f  :.        """Two
+0000d830: 2044 6174 6173 6574 7320 6172 6520 6272   Datasets are br
+0000d840: 6f61 6463 6173 7420 6571 7561 6c20 6966  oadcast equal if
+0000d850: 2074 6865 7920 6172 6520 6571 7561 6c20   they are equal 
+0000d860: 6166 7465 720a 2020 2020 2020 2020 6272  after.        br
+0000d870: 6f61 6463 6173 7469 6e67 2061 6c6c 2076  oadcasting all v
+0000d880: 6172 6961 626c 6573 2061 6761 696e 7374  ariables against
+0000d890: 2065 6163 6820 6f74 6865 722e 0a0a 2020   each other...  
+0000d8a0: 2020 2020 2020 466f 7220 6578 616d 706c        For exampl
+0000d8b0: 652c 2076 6172 6961 626c 6573 2074 6861  e, variables tha
+0000d8c0: 7420 6172 6520 7363 616c 6172 2069 6e20  t are scalar in 
+0000d8d0: 6f6e 6520 6461 7461 7365 7420 6275 7420  one dataset but 
+0000d8e0: 6e6f 6e2d 7363 616c 6172 2069 6e0a 2020  non-scalar in.  
+0000d8f0: 2020 2020 2020 7468 6520 6f74 6865 7220        the other 
+0000d900: 6461 7461 7365 7420 6361 6e20 7374 696c  dataset can stil
+0000d910: 6c20 6265 2062 726f 6164 6361 7374 2065  l be broadcast e
+0000d920: 7175 616c 2069 6620 7468 6520 7468 6520  qual if the the 
+0000d930: 6e6f 6e2d 7363 616c 6172 0a20 2020 2020  non-scalar.     
+0000d940: 2020 2076 6172 6961 626c 6520 6973 2061     variable is a
+0000d950: 2063 6f6e 7374 616e 742e 0a0a 2020 2020   constant...    
+0000d960: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
+0000d970: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+0000d980: 2020 2020 2020 4461 7461 7365 742e 6571        Dataset.eq
+0000d990: 7561 6c73 0a20 2020 2020 2020 2044 6174  uals.        Dat
+0000d9a0: 6173 6574 2e69 6465 6e74 6963 616c 0a20  aset.identical. 
+0000d9b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000d9c0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000d9d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000d9e0: 5f61 6c6c 5f63 6f6d 7061 7428 6f74 6865  _all_compat(othe
+0000d9f0: 722c 2022 6272 6f61 6463 6173 745f 6571  r, "broadcast_eq
+0000da00: 7561 6c73 2229 0a20 2020 2020 2020 2065  uals").        e
+0000da10: 7863 6570 7420 2854 7970 6545 7272 6f72  xcept (TypeError
+0000da20: 2c20 4174 7472 6962 7574 6545 7272 6f72  , AttributeError
+0000da30: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0000da40: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+0000da50: 2064 6566 2065 7175 616c 7328 7365 6c66   def equals(self
+0000da60: 2c20 6f74 6865 723a 2044 6174 6173 6574  , other: Dataset
+0000da70: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
+0000da80: 2020 2022 2222 5477 6f20 4461 7461 7365     """Two Datase
+0000da90: 7473 2061 7265 2065 7175 616c 2069 6620  ts are equal if 
+0000daa0: 7468 6579 2068 6176 6520 6d61 7463 6869  they have matchi
+0000dab0: 6e67 2076 6172 6961 626c 6573 2061 6e64  ng variables and
+0000dac0: 0a20 2020 2020 2020 2063 6f6f 7264 696e  .        coordin
+0000dad0: 6174 6573 2c20 616c 6c20 6f66 2077 6869  ates, all of whi
+0000dae0: 6368 2061 7265 2065 7175 616c 2e0a 0a20  ch are equal... 
+0000daf0: 2020 2020 2020 2044 6174 6173 6574 7320         Datasets 
+0000db00: 6361 6e20 7374 696c 6c20 6265 2065 7175  can still be equ
+0000db10: 616c 2028 6c69 6b65 2070 616e 6461 7320  al (like pandas 
+0000db20: 6f62 6a65 6374 7329 2069 6620 7468 6579  objects) if they
+0000db30: 2068 6176 6520 4e61 4e0a 2020 2020 2020   have NaN.      
+0000db40: 2020 7661 6c75 6573 2069 6e20 7468 6520    values in the 
+0000db50: 7361 6d65 206c 6f63 6174 696f 6e73 2e0a  same locations..
+0000db60: 0a20 2020 2020 2020 2054 6869 7320 6d65  .        This me
+0000db70: 7468 6f64 2069 7320 6e65 6365 7373 6172  thod is necessar
+0000db80: 7920 6265 6361 7573 6520 6076 3120 3d3d  y because `v1 ==
+0000db90: 2076 3260 2066 6f72 2060 6044 6174 6173   v2` for ``Datas
+0000dba0: 6574 6060 0a20 2020 2020 2020 2064 6f65  et``.        doe
+0000dbb0: 7320 656c 656d 656e 742d 7769 7365 2063  s element-wise c
+0000dbc0: 6f6d 7061 7269 736f 6e73 2028 6c69 6b65  omparisons (like
+0000dbd0: 206e 756d 7079 2e6e 6461 7272 6179 7329   numpy.ndarrays)
+0000dbe0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
+0000dbf0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+0000dc00: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
+0000dc10: 6173 6574 2e62 726f 6164 6361 7374 5f65  aset.broadcast_e
+0000dc20: 7175 616c 730a 2020 2020 2020 2020 4461  quals.        Da
+0000dc30: 7461 7365 742e 6964 656e 7469 6361 6c0a  taset.identical.
+0000dc40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000dc50: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000dc60: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000dc70: 2e5f 616c 6c5f 636f 6d70 6174 286f 7468  ._all_compat(oth
+0000dc80: 6572 2c20 2265 7175 616c 7322 290a 2020  er, "equals").  
+0000dc90: 2020 2020 2020 6578 6365 7074 2028 5479        except (Ty
+0000dca0: 7065 4572 726f 722c 2041 7474 7269 6275  peError, Attribu
+0000dcb0: 7465 4572 726f 7229 3a0a 2020 2020 2020  teError):.      
+0000dcc0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0000dcd0: 7365 0a0a 2020 2020 6465 6620 6964 656e  se..    def iden
+0000dce0: 7469 6361 6c28 7365 6c66 2c20 6f74 6865  tical(self, othe
+0000dcf0: 723a 2044 6174 6173 6574 2920 2d3e 2062  r: Dataset) -> b
+0000dd00: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+0000dd10: 4c69 6b65 2065 7175 616c 732c 2062 7574  Like equals, but
+0000dd20: 2061 6c73 6f20 6368 6563 6b73 2061 6c6c   also checks all
+0000dd30: 2064 6174 6173 6574 2061 7474 7269 6275   dataset attribu
+0000dd40: 7465 7320 616e 6420 7468 650a 2020 2020  tes and the.    
+0000dd50: 2020 2020 6174 7472 6962 7574 6573 206f      attributes o
+0000dd60: 6e20 616c 6c20 7661 7269 6162 6c65 7320  n all variables 
+0000dd70: 616e 6420 636f 6f72 6469 6e61 7465 732e  and coordinates.
+0000dd80: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
+0000dd90: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
+0000dda0: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
+0000ddb0: 7365 742e 6272 6f61 6463 6173 745f 6571  set.broadcast_eq
+0000ddc0: 7561 6c73 0a20 2020 2020 2020 2044 6174  uals.        Dat
+0000ddd0: 6173 6574 2e65 7175 616c 730a 2020 2020  aset.equals.    
+0000dde0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000ddf0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000de00: 2072 6574 7572 6e20 7574 696c 732e 6469   return utils.di
+0000de10: 6374 5f65 7175 6976 2873 656c 662e 6174  ct_equiv(self.at
+0000de20: 7472 732c 206f 7468 6572 2e61 7474 7273  trs, other.attrs
+0000de30: 2920 616e 6420 7365 6c66 2e5f 616c 6c5f  ) and self._all_
+0000de40: 636f 6d70 6174 280a 2020 2020 2020 2020  compat(.        
+0000de50: 2020 2020 2020 2020 6f74 6865 722c 2022          other, "
+0000de60: 6964 656e 7469 6361 6c22 0a20 2020 2020  identical".     
+0000de70: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000de80: 2065 7863 6570 7420 2854 7970 6545 7272   except (TypeErr
+0000de90: 6f72 2c20 4174 7472 6962 7574 6545 7272  or, AttributeErr
+0000dea0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+0000deb0: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
+0000dec0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+0000ded0: 2064 6566 2069 6e64 6578 6573 2873 656c   def indexes(sel
+0000dee0: 6629 202d 3e20 496e 6465 7865 735b 7064  f) -> Indexes[pd
+0000def0: 2e49 6e64 6578 5d3a 0a20 2020 2020 2020  .Index]:.       
+0000df00: 2022 2222 4d61 7070 696e 6720 6f66 2070   """Mapping of p
+0000df10: 616e 6461 732e 496e 6465 7820 6f62 6a65  andas.Index obje
+0000df20: 6374 7320 7573 6564 2066 6f72 206c 6162  cts used for lab
+0000df30: 656c 2062 6173 6564 2069 6e64 6578 696e  el based indexin
+0000df40: 672e 0a0a 2020 2020 2020 2020 5261 6973  g...        Rais
+0000df50: 6573 2061 6e20 6572 726f 7220 6966 2074  es an error if t
+0000df60: 6869 7320 4461 7461 7365 7420 6861 7320  his Dataset has 
+0000df70: 696e 6465 7865 7320 7468 6174 2063 616e  indexes that can
+0000df80: 6e6f 7420 6265 2063 6f65 7263 6564 0a20  not be coerced. 
+0000df90: 2020 2020 2020 2074 6f20 7061 6e64 6173         to pandas
+0000dfa0: 2e49 6e64 6578 206f 626a 6563 7473 2e0a  .Index objects..
+0000dfb0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+0000dfc0: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+0000dfd0: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
+0000dfe0: 6574 2e78 696e 6465 7865 730a 0a20 2020  et.xindexes..   
+0000dff0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000e000: 2072 6574 7572 6e20 7365 6c66 2e78 696e   return self.xin
+0000e010: 6465 7865 732e 746f 5f70 616e 6461 735f  dexes.to_pandas_
+0000e020: 696e 6465 7865 7328 290a 0a20 2020 2040  indexes()..    @
+0000e030: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+0000e040: 2078 696e 6465 7865 7328 7365 6c66 2920   xindexes(self) 
+0000e050: 2d3e 2049 6e64 6578 6573 5b49 6e64 6578  -> Indexes[Index
+0000e060: 5d3a 0a20 2020 2020 2020 2022 2222 4d61  ]:.        """Ma
+0000e070: 7070 696e 6720 6f66 2078 6172 7261 7920  pping of xarray 
+0000e080: 496e 6465 7820 6f62 6a65 6374 7320 7573  Index objects us
+0000e090: 6564 2066 6f72 206c 6162 656c 2062 6173  ed for label bas
+0000e0a0: 6564 2069 6e64 6578 696e 672e 2222 220a  ed indexing.""".
+0000e0b0: 2020 2020 2020 2020 7265 7475 726e 2049          return I
+0000e0c0: 6e64 6578 6573 2873 656c 662e 5f69 6e64  ndexes(self._ind
+0000e0d0: 6578 6573 2c20 7b6b 3a20 7365 6c66 2e5f  exes, {k: self._
+0000e0e0: 7661 7269 6162 6c65 735b 6b5d 2066 6f72  variables[k] for
+0000e0f0: 206b 2069 6e20 7365 6c66 2e5f 696e 6465   k in self._inde
+0000e100: 7865 737d 290a 0a20 2020 2040 7072 6f70  xes})..    @prop
+0000e110: 6572 7479 0a20 2020 2064 6566 2063 6f6f  erty.    def coo
+0000e120: 7264 7328 7365 6c66 2920 2d3e 2044 6174  rds(self) -> Dat
+0000e130: 6173 6574 436f 6f72 6469 6e61 7465 733a  asetCoordinates:
+0000e140: 0a20 2020 2020 2020 2022 2222 4469 6374  .        """Dict
+0000e150: 696f 6e61 7279 206f 6620 7861 7272 6179  ionary of xarray
+0000e160: 2e44 6174 6141 7272 6179 206f 626a 6563  .DataArray objec
+0000e170: 7473 2063 6f72 7265 7370 6f6e 6469 6e67  ts corresponding
+0000e180: 2074 6f20 636f 6f72 6469 6e61 7465 0a20   to coordinate. 
+0000e190: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+0000e1a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000e1b0: 2020 2020 2072 6574 7572 6e20 4461 7461       return Data
+0000e1c0: 7365 7443 6f6f 7264 696e 6174 6573 2873  setCoordinates(s
+0000e1d0: 656c 6629 0a0a 2020 2020 4070 726f 7065  elf)..    @prope
+0000e1e0: 7274 790a 2020 2020 6465 6620 6461 7461  rty.    def data
+0000e1f0: 5f76 6172 7328 7365 6c66 2920 2d3e 2044  _vars(self) -> D
+0000e200: 6174 6156 6172 6961 626c 6573 3a0a 2020  ataVariables:.  
+0000e210: 2020 2020 2020 2222 2244 6963 7469 6f6e        """Diction
+0000e220: 6172 7920 6f66 2044 6174 6141 7272 6179  ary of DataArray
+0000e230: 206f 626a 6563 7473 2063 6f72 7265 7370   objects corresp
+0000e240: 6f6e 6469 6e67 2074 6f20 6461 7461 2076  onding to data v
+0000e250: 6172 6961 626c 6573 2222 220a 2020 2020  ariables""".    
+0000e260: 2020 2020 7265 7475 726e 2044 6174 6156      return DataV
+0000e270: 6172 6961 626c 6573 2873 656c 6629 0a0a  ariables(self)..
+0000e280: 2020 2020 6465 6620 7365 745f 636f 6f72      def set_coor
+0000e290: 6473 2873 656c 663a 2054 5f44 6174 6173  ds(self: T_Datas
+0000e2a0: 6574 2c20 6e61 6d65 733a 2048 6173 6861  et, names: Hasha
+0000e2b0: 626c 6520 7c20 4974 6572 6162 6c65 5b48  ble | Iterable[H
+0000e2c0: 6173 6861 626c 655d 2920 2d3e 2054 5f44  ashable]) -> T_D
+0000e2d0: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
+0000e2e0: 2222 2247 6976 656e 206e 616d 6573 206f  """Given names o
+0000e2f0: 6620 6f6e 6520 6f72 206d 6f72 6520 7661  f one or more va
+0000e300: 7269 6162 6c65 732c 2073 6574 2074 6865  riables, set the
+0000e310: 6d20 6173 2063 6f6f 7264 696e 6174 6573  m as coordinates
+0000e320: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+0000e330: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+0000e340: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0000e350: 6e61 6d65 7320 3a20 6861 7368 6162 6c65  names : hashable
+0000e360: 206f 7220 6974 6572 6162 6c65 206f 6620   or iterable of 
+0000e370: 6861 7368 6162 6c65 0a20 2020 2020 2020  hashable.       
+0000e380: 2020 2020 204e 616d 6528 7329 206f 6620       Name(s) of 
+0000e390: 7661 7269 6162 6c65 7320 696e 2074 6869  variables in thi
+0000e3a0: 7320 6461 7461 7365 7420 746f 2063 6f6e  s dataset to con
+0000e3b0: 7665 7274 2069 6e74 6f20 636f 6f72 6469  vert into coordi
+0000e3c0: 6e61 7465 732e 0a0a 2020 2020 2020 2020  nates...        
+0000e3d0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+0000e3e0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0000e3f0: 4461 7461 7365 740a 0a20 2020 2020 2020  Dataset..       
+0000e400: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
+0000e410: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+0000e420: 2020 2044 6174 6173 6574 2e73 7761 705f     Dataset.swap_
+0000e430: 6469 6d73 0a20 2020 2020 2020 2044 6174  dims.        Dat
+0000e440: 6173 6574 2e61 7373 6967 6e5f 636f 6f72  aset.assign_coor
+0000e450: 6473 0a20 2020 2020 2020 2022 2222 0a20  ds.        """. 
+0000e460: 2020 2020 2020 2023 2054 4f44 4f3a 2061         # TODO: a
+0000e470: 6c6c 6f77 2069 6e73 6572 7469 6e67 206e  llow inserting n
+0000e480: 6577 2063 6f6f 7264 696e 6174 6573 2077  ew coordinates w
+0000e490: 6974 6820 7468 6973 206d 6574 686f 642c  ith this method,
+0000e4a0: 206c 696b 650a 2020 2020 2020 2020 2320   like.        # 
+0000e4b0: 4461 7461 4672 616d 652e 7365 745f 696e  DataFrame.set_in
+0000e4c0: 6465 783f 0a20 2020 2020 2020 2023 206e  dex?.        # n
+0000e4d0: 622e 2063 6865 636b 2069 6e20 7365 6c66  b. check in self
+0000e4e0: 2e5f 7661 7269 6162 6c65 732c 206e 6f74  ._variables, not
+0000e4f0: 2073 656c 662e 6461 7461 5f76 6172 7320   self.data_vars 
+0000e500: 746f 2069 6e73 7572 6520 7468 6174 2074  to insure that t
+0000e510: 6865 0a20 2020 2020 2020 2023 206f 7065  he.        # ope
+0000e520: 7261 7469 6f6e 2069 7320 6964 656d 706f  ration is idempo
+0000e530: 7465 6e74 0a20 2020 2020 2020 2069 6620  tent.        if 
+0000e540: 6973 696e 7374 616e 6365 286e 616d 6573  isinstance(names
+0000e550: 2c20 7374 7229 206f 7220 6e6f 7420 6973  , str) or not is
+0000e560: 696e 7374 616e 6365 286e 616d 6573 2c20  instance(names, 
+0000e570: 4974 6572 6162 6c65 293a 0a20 2020 2020  Iterable):.     
+0000e580: 2020 2020 2020 206e 616d 6573 203d 205b         names = [
+0000e590: 6e61 6d65 735d 0a20 2020 2020 2020 2065  names].        e
+0000e5a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000e5b0: 206e 616d 6573 203d 206c 6973 7428 6e61   names = list(na
+0000e5c0: 6d65 7329 0a20 2020 2020 2020 2073 656c  mes).        sel
+0000e5d0: 662e 5f61 7373 6572 745f 616c 6c5f 696e  f._assert_all_in
+0000e5e0: 5f64 6174 6173 6574 286e 616d 6573 290a  _dataset(names).
+0000e5f0: 2020 2020 2020 2020 6f62 6a20 3d20 7365          obj = se
+0000e600: 6c66 2e63 6f70 7928 290a 2020 2020 2020  lf.copy().      
+0000e610: 2020 6f62 6a2e 5f63 6f6f 7264 5f6e 616d    obj._coord_nam
+0000e620: 6573 2e75 7064 6174 6528 6e61 6d65 7329  es.update(names)
+0000e630: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000e640: 6f62 6a0a 0a20 2020 2064 6566 2072 6573  obj..    def res
+0000e650: 6574 5f63 6f6f 7264 7328 0a20 2020 2020  et_coords(.     
+0000e660: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+0000e670: 6574 2c0a 2020 2020 2020 2020 6e61 6d65  et,.        name
+0000e680: 733a 2044 696d 7320 3d20 4e6f 6e65 2c0a  s: Dims = None,.
+0000e690: 2020 2020 2020 2020 6472 6f70 3a20 626f          drop: bo
+0000e6a0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+0000e6b0: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+0000e6c0: 2020 2020 2020 2020 2222 2247 6976 656e          """Given
+0000e6d0: 206e 616d 6573 206f 6620 636f 6f72 6469   names of coordi
+0000e6e0: 6e61 7465 732c 2072 6573 6574 2074 6865  nates, reset the
+0000e6f0: 6d20 746f 2062 6563 6f6d 6520 7661 7269  m to become vari
+0000e700: 6162 6c65 730a 0a20 2020 2020 2020 2050  ables..        P
+0000e710: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0000e720: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0000e730: 2020 2020 206e 616d 6573 203a 2073 7472       names : str
+0000e740: 2c20 4974 6572 6162 6c65 206f 6620 4861  , Iterable of Ha
+0000e750: 7368 6162 6c65 206f 7220 4e6f 6e65 2c20  shable or None, 
+0000e760: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+0000e770: 2020 2020 204e 616d 6528 7329 206f 6620       Name(s) of 
+0000e780: 6e6f 6e2d 696e 6465 7820 636f 6f72 6469  non-index coordi
+0000e790: 6e61 7465 7320 696e 2074 6869 7320 6461  nates in this da
+0000e7a0: 7461 7365 7420 746f 2072 6573 6574 2069  taset to reset i
+0000e7b0: 6e74 6f0a 2020 2020 2020 2020 2020 2020  nto.            
+0000e7c0: 7661 7269 6162 6c65 732e 2042 7920 6465  variables. By de
+0000e7d0: 6661 756c 742c 2061 6c6c 206e 6f6e 2d69  fault, all non-i
+0000e7e0: 6e64 6578 2063 6f6f 7264 696e 6174 6573  ndex coordinates
+0000e7f0: 2061 7265 2072 6573 6574 2e0a 2020 2020   are reset..    
+0000e800: 2020 2020 6472 6f70 203a 2062 6f6f 6c2c      drop : bool,
+0000e810: 2064 6566 6175 6c74 3a20 4661 6c73 650a   default: False.
+0000e820: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+0000e830: 7275 652c 2072 656d 6f76 6520 636f 6f72  rue, remove coor
+0000e840: 6469 6e61 7465 7320 696e 7374 6561 6420  dinates instead 
+0000e850: 6f66 2063 6f6e 7665 7274 696e 6720 7468  of converting th
+0000e860: 656d 2069 6e74 6f0a 2020 2020 2020 2020  em into.        
+0000e870: 2020 2020 7661 7269 6162 6c65 732e 0a0a      variables...
+0000e880: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+0000e890: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+0000e8a0: 2020 2020 2020 2020 4461 7461 7365 740a          Dataset.
+0000e8b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000e8c0: 2020 2020 6966 206e 616d 6573 2069 7320      if names is 
+0000e8d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000e8e0: 2020 6e61 6d65 7320 3d20 7365 6c66 2e5f    names = self._
+0000e8f0: 636f 6f72 645f 6e61 6d65 7320 2d20 7365  coord_names - se
+0000e900: 7428 7365 6c66 2e5f 696e 6465 7865 7329  t(self._indexes)
+0000e910: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000e920: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0000e930: 696e 7374 616e 6365 286e 616d 6573 2c20  instance(names, 
+0000e940: 7374 7229 206f 7220 6e6f 7420 6973 696e  str) or not isin
+0000e950: 7374 616e 6365 286e 616d 6573 2c20 4974  stance(names, It
+0000e960: 6572 6162 6c65 293a 0a20 2020 2020 2020  erable):.       
+0000e970: 2020 2020 2020 2020 206e 616d 6573 203d           names =
+0000e980: 205b 6e61 6d65 735d 0a20 2020 2020 2020   [names].       
+0000e990: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000e9a0: 2020 2020 2020 2020 2020 206e 616d 6573             names
+0000e9b0: 203d 206c 6973 7428 6e61 6d65 7329 0a20   = list(names). 
+0000e9c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000e9d0: 5f61 7373 6572 745f 616c 6c5f 696e 5f64  _assert_all_in_d
+0000e9e0: 6174 6173 6574 286e 616d 6573 290a 2020  ataset(names).  
+0000e9f0: 2020 2020 2020 2020 2020 6261 645f 636f            bad_co
+0000ea00: 6f72 6473 203d 2073 6574 286e 616d 6573  ords = set(names
+0000ea10: 2920 2620 7365 7428 7365 6c66 2e5f 696e  ) & set(self._in
+0000ea20: 6465 7865 7329 0a20 2020 2020 2020 2020  dexes).         
+0000ea30: 2020 2069 6620 6261 645f 636f 6f72 6473     if bad_coords
+0000ea40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ea50: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000ea60: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000ea70: 2020 2020 2020 2020 6622 6361 6e6e 6f74          f"cannot
+0000ea80: 2072 656d 6f76 6520 696e 6465 7820 636f   remove index co
+0000ea90: 6f72 6469 6e61 7465 7320 7769 7468 2072  ordinates with r
+0000eaa0: 6573 6574 5f63 6f6f 7264 733a 207b 6261  eset_coords: {ba
+0000eab0: 645f 636f 6f72 6473 7d22 0a20 2020 2020  d_coords}".     
+0000eac0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000ead0: 2020 2020 206f 626a 203d 2073 656c 662e       obj = self.
+0000eae0: 636f 7079 2829 0a20 2020 2020 2020 206f  copy().        o
+0000eaf0: 626a 2e5f 636f 6f72 645f 6e61 6d65 732e  bj._coord_names.
+0000eb00: 6469 6666 6572 656e 6365 5f75 7064 6174  difference_updat
+0000eb10: 6528 6e61 6d65 7329 0a20 2020 2020 2020  e(names).       
+0000eb20: 2069 6620 6472 6f70 3a0a 2020 2020 2020   if drop:.      
+0000eb30: 2020 2020 2020 666f 7220 6e61 6d65 2069        for name i
+0000eb40: 6e20 6e61 6d65 733a 0a20 2020 2020 2020  n names:.       
+0000eb50: 2020 2020 2020 2020 2064 656c 206f 626a           del obj
+0000eb60: 2e5f 7661 7269 6162 6c65 735b 6e61 6d65  ._variables[name
+0000eb70: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
+0000eb80: 206f 626a 0a0a 2020 2020 6465 6620 6475   obj..    def du
+0000eb90: 6d70 5f74 6f5f 7374 6f72 6528 7365 6c66  mp_to_store(self
+0000eba0: 2c20 7374 6f72 653a 2041 6273 7472 6163  , store: Abstrac
+0000ebb0: 7444 6174 6153 746f 7265 2c20 2a2a 6b77  tDataStore, **kw
+0000ebc0: 6172 6773 2920 2d3e 204e 6f6e 653a 0a20  args) -> None:. 
+0000ebd0: 2020 2020 2020 2022 2222 5374 6f72 6520         """Store 
+0000ebe0: 6461 7461 7365 7420 636f 6e74 656e 7473  dataset contents
+0000ebf0: 2074 6f20 6120 6261 636b 656e 6473 2e2a   to a backends.*
+0000ec00: 4461 7461 5374 6f72 6520 6f62 6a65 6374  DataStore object
+0000ec10: 2e22 2222 0a20 2020 2020 2020 2066 726f  .""".        fro
+0000ec20: 6d20 7861 7272 6179 2e62 6163 6b65 6e64  m xarray.backend
+0000ec30: 732e 6170 6920 696d 706f 7274 2064 756d  s.api import dum
+0000ec40: 705f 746f 5f73 746f 7265 0a0a 2020 2020  p_to_store..    
+0000ec50: 2020 2020 2320 544f 444f 3a20 7265 6e61      # TODO: rena
+0000ec60: 6d65 2061 6e64 2f6f 7220 636c 6561 6e75  me and/or cleanu
+0000ec70: 7020 7468 6973 206d 6574 686f 6420 746f  p this method to
+0000ec80: 206d 616b 6520 6974 206d 6f72 6520 636f   make it more co
+0000ec90: 6e73 6973 7465 6e74 0a20 2020 2020 2020  nsistent.       
+0000eca0: 2023 2077 6974 6820 746f 5f6e 6574 6364   # with to_netcd
+0000ecb0: 6628 290a 2020 2020 2020 2020 6475 6d70  f().        dump
+0000ecc0: 5f74 6f5f 7374 6f72 6528 7365 6c66 2c20  _to_store(self, 
+0000ecd0: 7374 6f72 652c 202a 2a6b 7761 7267 7329  store, **kwargs)
+0000ece0: 0a0a 2020 2020 2320 7061 7468 3d4e 6f6e  ..    # path=Non
+0000ecf0: 6520 7772 6974 6573 2074 6f20 6279 7465  e writes to byte
+0000ed00: 730a 2020 2020 406f 7665 726c 6f61 640a  s.    @overload.
+0000ed10: 2020 2020 6465 6620 746f 5f6e 6574 6364      def to_netcd
+0000ed20: 6628 0a20 2020 2020 2020 2073 656c 662c  f(.        self,
+0000ed30: 0a20 2020 2020 2020 2070 6174 683a 204e  .        path: N
+0000ed40: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+0000ed50: 2020 2020 6d6f 6465 3a20 4c69 7465 7261      mode: Litera
+0000ed60: 6c5b 2277 222c 2022 6122 5d20 3d20 2277  l["w", "a"] = "w
+0000ed70: 222c 0a20 2020 2020 2020 2066 6f72 6d61  ",.        forma
+0000ed80: 743a 2054 5f4e 6574 6364 6654 7970 6573  t: T_NetcdfTypes
+0000ed90: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+0000eda0: 2020 2020 2020 2020 6772 6f75 703a 2073          group: s
+0000edb0: 7472 207c 204e 6f6e 6520 3d20 4e6f 6e65  tr | None = None
+0000edc0: 2c0a 2020 2020 2020 2020 656e 6769 6e65  ,.        engine
+0000edd0: 3a20 545f 4e65 7463 6466 456e 6769 6e65  : T_NetcdfEngine
+0000ede0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+0000edf0: 2020 2020 2020 2020 656e 636f 6469 6e67          encoding
+0000ee00: 3a20 4d61 7070 696e 675b 416e 792c 204d  : Mapping[Any, M
+0000ee10: 6170 7069 6e67 5b73 7472 2c20 416e 795d  apping[str, Any]
+0000ee20: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+0000ee30: 0a20 2020 2020 2020 2075 6e6c 696d 6974  .        unlimit
+0000ee40: 6564 5f64 696d 733a 2049 7465 7261 626c  ed_dims: Iterabl
+0000ee50: 655b 4861 7368 6162 6c65 5d20 7c20 4e6f  e[Hashable] | No
+0000ee60: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+0000ee70: 2020 2063 6f6d 7075 7465 3a20 626f 6f6c     compute: bool
+0000ee80: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
+0000ee90: 2069 6e76 616c 6964 5f6e 6574 6364 663a   invalid_netcdf:
+0000eea0: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+0000eeb0: 2020 2029 202d 3e20 6279 7465 733a 0a20     ) -> bytes:. 
+0000eec0: 2020 2020 2020 202e 2e2e 0a0a 2020 2020         .....    
+0000eed0: 2320 6465 6661 756c 7420 7265 7475 726e  # default return
+0000eee0: 204e 6f6e 650a 2020 2020 406f 7665 726c   None.    @overl
+0000eef0: 6f61 640a 2020 2020 6465 6620 746f 5f6e  oad.    def to_n
+0000ef00: 6574 6364 6628 0a20 2020 2020 2020 2073  etcdf(.        s
+0000ef10: 656c 662c 0a20 2020 2020 2020 2070 6174  elf,.        pat
+0000ef20: 683a 2073 7472 207c 2050 6174 684c 696b  h: str | PathLik
+0000ef30: 652c 0a20 2020 2020 2020 206d 6f64 653a  e,.        mode:
+0000ef40: 204c 6974 6572 616c 5b22 7722 2c20 2261   Literal["w", "a
+0000ef50: 225d 203d 2022 7722 2c0a 2020 2020 2020  "] = "w",.      
+0000ef60: 2020 666f 726d 6174 3a20 545f 4e65 7463    format: T_Netc
+0000ef70: 6466 5479 7065 7320 7c20 4e6f 6e65 203d  dfTypes | None =
+0000ef80: 204e 6f6e 652c 0a20 2020 2020 2020 2067   None,.        g
+0000ef90: 726f 7570 3a20 7374 7220 7c20 4e6f 6e65  roup: str | None
+0000efa0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0000efb0: 2065 6e67 696e 653a 2054 5f4e 6574 6364   engine: T_Netcd
+0000efc0: 6645 6e67 696e 6520 7c20 4e6f 6e65 203d  fEngine | None =
+0000efd0: 204e 6f6e 652c 0a20 2020 2020 2020 2065   None,.        e
+0000efe0: 6e63 6f64 696e 673a 204d 6170 7069 6e67  ncoding: Mapping
+0000eff0: 5b41 6e79 2c20 4d61 7070 696e 675b 7374  [Any, Mapping[st
+0000f000: 722c 2041 6e79 5d5d 207c 204e 6f6e 6520  r, Any]] | None 
+0000f010: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000f020: 756e 6c69 6d69 7465 645f 6469 6d73 3a20  unlimited_dims: 
+0000f030: 4974 6572 6162 6c65 5b48 6173 6861 626c  Iterable[Hashabl
+0000f040: 655d 207c 204e 6f6e 6520 3d20 4e6f 6e65  e] | None = None
+0000f050: 2c0a 2020 2020 2020 2020 636f 6d70 7574  ,.        comput
+0000f060: 653a 204c 6974 6572 616c 5b54 7275 655d  e: Literal[True]
+0000f070: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
+0000f080: 2069 6e76 616c 6964 5f6e 6574 6364 663a   invalid_netcdf:
+0000f090: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+0000f0a0: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
+0000f0b0: 2020 2020 2020 2e2e 2e0a 0a20 2020 2023        .....    #
+0000f0c0: 2063 6f6d 7075 7465 3d46 616c 7365 2072   compute=False r
+0000f0d0: 6574 7572 6e73 2064 6173 6b2e 4465 6c61  eturns dask.Dela
+0000f0e0: 7965 640a 2020 2020 406f 7665 726c 6f61  yed.    @overloa
+0000f0f0: 640a 2020 2020 6465 6620 746f 5f6e 6574  d.    def to_net
+0000f100: 6364 6628 0a20 2020 2020 2020 2073 656c  cdf(.        sel
+0000f110: 662c 0a20 2020 2020 2020 2070 6174 683a  f,.        path:
+0000f120: 2073 7472 207c 2050 6174 684c 696b 652c   str | PathLike,
+0000f130: 0a20 2020 2020 2020 206d 6f64 653a 204c  .        mode: L
+0000f140: 6974 6572 616c 5b22 7722 2c20 2261 225d  iteral["w", "a"]
+0000f150: 203d 2022 7722 2c0a 2020 2020 2020 2020   = "w",.        
+0000f160: 666f 726d 6174 3a20 545f 4e65 7463 6466  format: T_Netcdf
+0000f170: 5479 7065 7320 7c20 4e6f 6e65 203d 204e  Types | None = N
+0000f180: 6f6e 652c 0a20 2020 2020 2020 2067 726f  one,.        gro
+0000f190: 7570 3a20 7374 7220 7c20 4e6f 6e65 203d  up: str | None =
+0000f1a0: 204e 6f6e 652c 0a20 2020 2020 2020 2065   None,.        e
+0000f1b0: 6e67 696e 653a 2054 5f4e 6574 6364 6645  ngine: T_NetcdfE
+0000f1c0: 6e67 696e 6520 7c20 4e6f 6e65 203d 204e  ngine | None = N
+0000f1d0: 6f6e 652c 0a20 2020 2020 2020 2065 6e63  one,.        enc
+0000f1e0: 6f64 696e 673a 204d 6170 7069 6e67 5b41  oding: Mapping[A
+0000f1f0: 6e79 2c20 4d61 7070 696e 675b 7374 722c  ny, Mapping[str,
+0000f200: 2041 6e79 5d5d 207c 204e 6f6e 6520 3d20   Any]] | None = 
+0000f210: 4e6f 6e65 2c0a 2020 2020 2020 2020 756e  None,.        un
+0000f220: 6c69 6d69 7465 645f 6469 6d73 3a20 4974  limited_dims: It
+0000f230: 6572 6162 6c65 5b48 6173 6861 626c 655d  erable[Hashable]
+0000f240: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+0000f250: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
+0000f260: 2020 2063 6f6d 7075 7465 3a20 4c69 7465     compute: Lite
+0000f270: 7261 6c5b 4661 6c73 655d 2c0a 2020 2020  ral[False],.    
+0000f280: 2020 2020 696e 7661 6c69 645f 6e65 7463      invalid_netc
+0000f290: 6466 3a20 626f 6f6c 203d 2046 616c 7365  df: bool = False
+0000f2a0: 2c0a 2020 2020 2920 2d3e 2044 656c 6179  ,.    ) -> Delay
+0000f2b0: 6564 3a0a 2020 2020 2020 2020 2e2e 2e0a  ed:.        ....
+0000f2c0: 0a20 2020 2064 6566 2074 6f5f 6e65 7463  .    def to_netc
+0000f2d0: 6466 280a 2020 2020 2020 2020 7365 6c66  df(.        self
+0000f2e0: 2c0a 2020 2020 2020 2020 7061 7468 3a20  ,.        path: 
+0000f2f0: 7374 7220 7c20 5061 7468 4c69 6b65 207c  str | PathLike |
+0000f300: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+0000f310: 2020 2020 2020 6d6f 6465 3a20 4c69 7465        mode: Lite
+0000f320: 7261 6c5b 2277 222c 2022 6122 5d20 3d20  ral["w", "a"] = 
+0000f330: 2277 222c 0a20 2020 2020 2020 2066 6f72  "w",.        for
+0000f340: 6d61 743a 2054 5f4e 6574 6364 6654 7970  mat: T_NetcdfTyp
+0000f350: 6573 207c 204e 6f6e 6520 3d20 4e6f 6e65  es | None = None
+0000f360: 2c0a 2020 2020 2020 2020 6772 6f75 703a  ,.        group:
+0000f370: 2073 7472 207c 204e 6f6e 6520 3d20 4e6f   str | None = No
+0000f380: 6e65 2c0a 2020 2020 2020 2020 656e 6769  ne,.        engi
+0000f390: 6e65 3a20 545f 4e65 7463 6466 456e 6769  ne: T_NetcdfEngi
+0000f3a0: 6e65 207c 204e 6f6e 6520 3d20 4e6f 6e65  ne | None = None
+0000f3b0: 2c0a 2020 2020 2020 2020 656e 636f 6469  ,.        encodi
+0000f3c0: 6e67 3a20 4d61 7070 696e 675b 416e 792c  ng: Mapping[Any,
+0000f3d0: 204d 6170 7069 6e67 5b73 7472 2c20 416e   Mapping[str, An
+0000f3e0: 795d 5d20 7c20 4e6f 6e65 203d 204e 6f6e  y]] | None = Non
+0000f3f0: 652c 0a20 2020 2020 2020 2075 6e6c 696d  e,.        unlim
+0000f400: 6974 6564 5f64 696d 733a 2049 7465 7261  ited_dims: Itera
+0000f410: 626c 655b 4861 7368 6162 6c65 5d20 7c20  ble[Hashable] | 
+0000f420: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+0000f430: 2020 2020 2063 6f6d 7075 7465 3a20 626f       compute: bo
+0000f440: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
+0000f450: 2020 2069 6e76 616c 6964 5f6e 6574 6364     invalid_netcd
+0000f460: 663a 2062 6f6f 6c20 3d20 4661 6c73 652c  f: bool = False,
+0000f470: 0a20 2020 2029 202d 3e20 6279 7465 7320  .    ) -> bytes 
+0000f480: 7c20 4465 6c61 7965 6420 7c20 4e6f 6e65  | Delayed | None
+0000f490: 3a0a 2020 2020 2020 2020 2222 2257 7269  :.        """Wri
+0000f4a0: 7465 2064 6174 6173 6574 2063 6f6e 7465  te dataset conte
+0000f4b0: 6e74 7320 746f 2061 206e 6574 4344 4620  nts to a netCDF 
+0000f4c0: 6669 6c65 2e0a 0a20 2020 2020 2020 2050  file...        P
+0000f4d0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0000f4e0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0000f4f0: 2020 2020 2070 6174 6820 3a20 7374 722c       path : str,
+0000f500: 2070 6174 682d 6c69 6b65 206f 7220 6669   path-like or fi
+0000f510: 6c65 2d6c 696b 652c 206f 7074 696f 6e61  le-like, optiona
+0000f520: 6c0a 2020 2020 2020 2020 2020 2020 5061  l.            Pa
+0000f530: 7468 2074 6f20 7768 6963 6820 746f 2073  th to which to s
+0000f540: 6176 6520 7468 6973 2064 6174 6173 6574  ave this dataset
+0000f550: 2e20 4669 6c65 2d6c 696b 6520 6f62 6a65  . File-like obje
+0000f560: 6374 7320 6172 6520 6f6e 6c79 0a20 2020  cts are only.   
+0000f570: 2020 2020 2020 2020 2073 7570 706f 7274           support
+0000f580: 6564 2062 7920 7468 6520 7363 6970 7920  ed by the scipy 
+0000f590: 656e 6769 6e65 2e20 4966 206e 6f20 7061  engine. If no pa
+0000f5a0: 7468 2069 7320 7072 6f76 6964 6564 2c20  th is provided, 
+0000f5b0: 7468 6973 0a20 2020 2020 2020 2020 2020  this.           
+0000f5c0: 2066 756e 6374 696f 6e20 7265 7475 726e   function return
+0000f5d0: 7320 7468 6520 7265 7375 6c74 696e 6720  s the resulting 
+0000f5e0: 6e65 7443 4446 2066 696c 6520 6173 2062  netCDF file as b
+0000f5f0: 7974 6573 3b20 696e 2074 6869 7320 6361  ytes; in this ca
+0000f600: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+0000f610: 7765 206e 6565 6420 746f 2075 7365 2073  we need to use s
+0000f620: 6369 7079 2c20 7768 6963 6820 646f 6573  cipy, which does
+0000f630: 206e 6f74 2073 7570 706f 7274 206e 6574   not support net
+0000f640: 4344 4620 7665 7273 696f 6e20 3420 2874  CDF version 4 (t
+0000f650: 6865 0a20 2020 2020 2020 2020 2020 2064  he.            d
+0000f660: 6566 6175 6c74 2066 6f72 6d61 7420 6265  efault format be
+0000f670: 636f 6d65 7320 4e45 5443 4446 335f 3634  comes NETCDF3_64
+0000f680: 4249 5429 2e0a 2020 2020 2020 2020 6d6f  BIT)..        mo
+0000f690: 6465 203a 207b 2277 222c 2022 6122 7d2c  de : {"w", "a"},
+0000f6a0: 2064 6566 6175 6c74 3a20 2277 220a 2020   default: "w".  
+0000f6b0: 2020 2020 2020 2020 2020 5772 6974 6520            Write 
+0000f6c0: 2827 7727 2920 6f72 2061 7070 656e 6420  ('w') or append 
+0000f6d0: 2827 6127 2920 6d6f 6465 2e20 4966 206d  ('a') mode. If m
+0000f6e0: 6f64 653d 2777 272c 2061 6e79 2065 7869  ode='w', any exi
+0000f6f0: 7374 696e 6720 6669 6c65 2061 740a 2020  sting file at.  
+0000f700: 2020 2020 2020 2020 2020 7468 6973 206c            this l
+0000f710: 6f63 6174 696f 6e20 7769 6c6c 2062 6520  ocation will be 
+0000f720: 6f76 6572 7772 6974 7465 6e2e 2049 6620  overwritten. If 
+0000f730: 6d6f 6465 3d27 6127 2c20 6578 6973 7469  mode='a', existi
+0000f740: 6e67 2076 6172 6961 626c 6573 0a20 2020  ng variables.   
+0000f750: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
+0000f760: 206f 7665 7277 7269 7474 656e 2e0a 2020   overwritten..  
+0000f770: 2020 2020 2020 666f 726d 6174 203a 207b        format : {
+0000f780: 224e 4554 4344 4634 222c 2022 4e45 5443  "NETCDF4", "NETC
+0000f790: 4446 345f 434c 4153 5349 4322 2c20 224e  DF4_CLASSIC", "N
+0000f7a0: 4554 4344 4633 5f36 3442 4954 222c 205c  ETCDF3_64BIT", \
+0000f7b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f7c0: 2020 2022 4e45 5443 4446 335f 434c 4153     "NETCDF3_CLAS
+0000f7d0: 5349 4322 7d2c 206f 7074 696f 6e61 6c0a  SIC"}, optional.
+0000f7e0: 2020 2020 2020 2020 2020 2020 4669 6c65              File
+0000f7f0: 2066 6f72 6d61 7420 666f 7220 7468 6520   format for the 
+0000f800: 7265 7375 6c74 696e 6720 6e65 7443 4446  resulting netCDF
+0000f810: 2066 696c 653a 0a0a 2020 2020 2020 2020   file:..        
+0000f820: 2020 2020 2a20 4e45 5443 4446 343a 2044      * NETCDF4: D
+0000f830: 6174 6120 6973 2073 746f 7265 6420 696e  ata is stored in
+0000f840: 2061 6e20 4844 4635 2066 696c 652c 2075   an HDF5 file, u
+0000f850: 7369 6e67 206e 6574 4344 4634 2041 5049  sing netCDF4 API
+0000f860: 0a20 2020 2020 2020 2020 2020 2020 2066  .              f
+0000f870: 6561 7475 7265 732e 0a20 2020 2020 2020  eatures..       
+0000f880: 2020 2020 202a 204e 4554 4344 4634 5f43       * NETCDF4_C
+0000f890: 4c41 5353 4943 3a20 4461 7461 2069 7320  LASSIC: Data is 
+0000f8a0: 7374 6f72 6564 2069 6e20 616e 2048 4446  stored in an HDF
+0000f8b0: 3520 6669 6c65 2c20 7573 696e 6720 6f6e  5 file, using on
+0000f8c0: 6c79 0a20 2020 2020 2020 2020 2020 2020  ly.             
+0000f8d0: 206e 6574 4344 4620 3320 636f 6d70 6174   netCDF 3 compat
+0000f8e0: 6962 6c65 2041 5049 2066 6561 7475 7265  ible API feature
+0000f8f0: 732e 0a20 2020 2020 2020 2020 2020 202a  s..            *
+0000f900: 204e 4554 4344 4633 5f36 3442 4954 3a20   NETCDF3_64BIT: 
+0000f910: 3634 2d62 6974 206f 6666 7365 7420 7665  64-bit offset ve
+0000f920: 7273 696f 6e20 6f66 2074 6865 206e 6574  rsion of the net
+0000f930: 4344 4620 3320 6669 6c65 2066 6f72 6d61  CDF 3 file forma
+0000f940: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0000f950: 2077 6869 6368 2066 756c 6c79 2073 7570   which fully sup
+0000f960: 706f 7274 7320 322b 2047 4220 6669 6c65  ports 2+ GB file
+0000f970: 732c 2062 7574 2069 7320 6f6e 6c79 2063  s, but is only c
+0000f980: 6f6d 7061 7469 626c 6520 7769 7468 0a20  ompatible with. 
+0000f990: 2020 2020 2020 2020 2020 2020 2063 6c69               cli
+0000f9a0: 656e 7473 206c 696e 6b65 6420 6167 6169  ents linked agai
+0000f9b0: 6e73 7420 6e65 7443 4446 2076 6572 7369  nst netCDF versi
+0000f9c0: 6f6e 2033 2e36 2e30 206f 7220 6c61 7465  on 3.6.0 or late
+0000f9d0: 722e 0a20 2020 2020 2020 2020 2020 202a  r..            *
+0000f9e0: 204e 4554 4344 4633 5f43 4c41 5353 4943   NETCDF3_CLASSIC
+0000f9f0: 3a20 5468 6520 636c 6173 7369 6320 6e65  : The classic ne
+0000fa00: 7443 4446 2033 2066 696c 6520 666f 726d  tCDF 3 file form
+0000fa10: 6174 2e20 4974 2064 6f65 7320 6e6f 740a  at. It does not.
+0000fa20: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+0000fa30: 6e64 6c65 2032 2b20 4742 2066 696c 6573  ndle 2+ GB files
+0000fa40: 2076 6572 7920 7765 6c6c 2e0a 0a20 2020   very well...   
+0000fa50: 2020 2020 2020 2020 2041 6c6c 2066 6f72           All for
+0000fa60: 6d61 7473 2061 7265 2073 7570 706f 7274  mats are support
+0000fa70: 6564 2062 7920 7468 6520 6e65 7443 4446  ed by the netCDF
+0000fa80: 342d 7079 7468 6f6e 206c 6962 7261 7279  4-python library
+0000fa90: 2e0a 2020 2020 2020 2020 2020 2020 7363  ..            sc
+0000faa0: 6970 792e 696f 2e6e 6574 6364 6620 6f6e  ipy.io.netcdf on
+0000fab0: 6c79 2073 7570 706f 7274 7320 7468 6520  ly supports the 
+0000fac0: 6c61 7374 2074 776f 2066 6f72 6d61 7473  last two formats
+0000fad0: 2e0a 0a20 2020 2020 2020 2020 2020 2054  ...            T
+0000fae0: 6865 2064 6566 6175 6c74 2066 6f72 6d61  he default forma
+0000faf0: 7420 6973 204e 4554 4344 4634 2069 6620  t is NETCDF4 if 
+0000fb00: 796f 7520 6172 6520 7361 7669 6e67 2061  you are saving a
+0000fb10: 2066 696c 6520 746f 2064 6973 6b20 616e   file to disk an
+0000fb20: 640a 2020 2020 2020 2020 2020 2020 6861  d.            ha
+0000fb30: 7665 2074 6865 206e 6574 4344 4634 2d70  ve the netCDF4-p
+0000fb40: 7974 686f 6e20 6c69 6272 6172 7920 6176  ython library av
+0000fb50: 6169 6c61 626c 652e 204f 7468 6572 7769  ailable. Otherwi
+0000fb60: 7365 2c20 7861 7272 6179 2066 616c 6c73  se, xarray falls
+0000fb70: 0a20 2020 2020 2020 2020 2020 2062 6163  .            bac
+0000fb80: 6b20 746f 2075 7369 6e67 2073 6369 7079  k to using scipy
+0000fb90: 2074 6f20 7772 6974 6520 6e65 7443 4446   to write netCDF
+0000fba0: 2066 696c 6573 2061 6e64 2064 6566 6175   files and defau
+0000fbb0: 6c74 7320 746f 2074 6865 0a20 2020 2020  lts to the.     
+0000fbc0: 2020 2020 2020 204e 4554 4344 4633 5f36         NETCDF3_6
+0000fbd0: 3442 4954 2066 6f72 6d61 7420 2873 6369  4BIT format (sci
+0000fbe0: 7079 2064 6f65 7320 6e6f 7420 7375 7070  py does not supp
+0000fbf0: 6f72 7420 6e65 7443 4446 3429 2e0a 2020  ort netCDF4)..  
+0000fc00: 2020 2020 2020 6772 6f75 7020 3a20 7374        group : st
+0000fc10: 722c 206f 7074 696f 6e61 6c0a 2020 2020  r, optional.    
+0000fc20: 2020 2020 2020 2020 5061 7468 2074 6f20          Path to 
+0000fc30: 7468 6520 6e65 7443 4446 3420 6772 6f75  the netCDF4 grou
+0000fc40: 7020 696e 2074 6865 2067 6976 656e 2066  p in the given f
+0000fc50: 696c 6520 746f 206f 7065 6e20 286f 6e6c  ile to open (onl
+0000fc60: 7920 776f 726b 7320 666f 720a 2020 2020  y works for.    
+0000fc70: 2020 2020 2020 2020 666f 726d 6174 3d27          format='
+0000fc80: 4e45 5443 4446 3427 292e 2054 6865 2067  NETCDF4'). The g
+0000fc90: 726f 7570 2873 2920 7769 6c6c 2062 6520  roup(s) will be 
+0000fca0: 6372 6561 7465 6420 6966 206e 6563 6573  created if neces
+0000fcb0: 7361 7279 2e0a 2020 2020 2020 2020 656e  sary..        en
+0000fcc0: 6769 6e65 203a 207b 226e 6574 6364 6634  gine : {"netcdf4
+0000fcd0: 222c 2022 7363 6970 7922 2c20 2268 356e  ", "scipy", "h5n
+0000fce0: 6574 6364 6622 7d2c 206f 7074 696f 6e61  etcdf"}, optiona
+0000fcf0: 6c0a 2020 2020 2020 2020 2020 2020 456e  l.            En
+0000fd00: 6769 6e65 2074 6f20 7573 6520 7768 656e  gine to use when
+0000fd10: 2077 7269 7469 6e67 206e 6574 4344 4620   writing netCDF 
+0000fd20: 6669 6c65 732e 2049 6620 6e6f 7420 7072  files. If not pr
+0000fd30: 6f76 6964 6564 2c20 7468 650a 2020 2020  ovided, the.    
+0000fd40: 2020 2020 2020 2020 6465 6661 756c 7420          default 
+0000fd50: 656e 6769 6e65 2069 7320 6368 6f73 656e  engine is chosen
+0000fd60: 2062 6173 6564 206f 6e20 6176 6169 6c61   based on availa
+0000fd70: 626c 6520 6465 7065 6e64 656e 6369 6573  ble dependencies
+0000fd80: 2c20 7769 7468 2061 0a20 2020 2020 2020  , with a.       
+0000fd90: 2020 2020 2070 7265 6665 7265 6e63 6520       preference 
+0000fda0: 666f 7220 276e 6574 6364 6634 2720 6966  for 'netcdf4' if
+0000fdb0: 2077 7269 7469 6e67 2074 6f20 6120 6669   writing to a fi
+0000fdc0: 6c65 206f 6e20 6469 736b 2e0a 2020 2020  le on disk..    
+0000fdd0: 2020 2020 656e 636f 6469 6e67 203a 2064      encoding : d
+0000fde0: 6963 742c 206f 7074 696f 6e61 6c0a 2020  ict, optional.  
+0000fdf0: 2020 2020 2020 2020 2020 4e65 7374 6564            Nested
+0000fe00: 2064 6963 7469 6f6e 6172 7920 7769 7468   dictionary with
+0000fe10: 2076 6172 6961 626c 6520 6e61 6d65 7320   variable names 
+0000fe20: 6173 206b 6579 7320 616e 6420 6469 6374  as keys and dict
+0000fe30: 696f 6e61 7269 6573 206f 660a 2020 2020  ionaries of.    
+0000fe40: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+0000fe50: 2073 7065 6369 6669 6320 656e 636f 6469   specific encodi
+0000fe60: 6e67 7320 6173 2076 616c 7565 732c 2065  ngs as values, e
+0000fe70: 2e67 2e2c 0a20 2020 2020 2020 2020 2020  .g.,.           
+0000fe80: 2060 607b 226d 795f 7661 7269 6162 6c65   ``{"my_variable
+0000fe90: 223a 207b 2264 7479 7065 223a 2022 696e  ": {"dtype": "in
+0000fea0: 7431 3622 2c20 2273 6361 6c65 5f66 6163  t16", "scale_fac
+0000feb0: 746f 7222 3a20 302e 312c 0a20 2020 2020  tor": 0.1,.     
+0000fec0: 2020 2020 2020 2022 7a6c 6962 223a 2054         "zlib": T
+0000fed0: 7275 657d 2c20 2e2e 2e7d 6060 0a0a 2020  rue}, ...}``..  
+0000fee0: 2020 2020 2020 2020 2020 5468 6520 6068            The `h
+0000fef0: 356e 6574 6364 6660 2065 6e67 696e 6520  5netcdf` engine 
+0000ff00: 7375 7070 6f72 7473 2062 6f74 6820 7468  supports both th
+0000ff10: 6520 4e65 7443 4446 342d 7374 796c 6520  e NetCDF4-style 
+0000ff20: 636f 6d70 7265 7373 696f 6e0a 2020 2020  compression.    
+0000ff30: 2020 2020 2020 2020 656e 636f 6469 6e67          encoding
+0000ff40: 2070 6172 616d 6574 6572 7320 6060 7b22   parameters ``{"
+0000ff50: 7a6c 6962 223a 2054 7275 652c 2022 636f  zlib": True, "co
+0000ff60: 6d70 6c65 7665 6c22 3a20 397d 6060 2061  mplevel": 9}`` a
+0000ff70: 6e64 2074 6865 2068 3570 790a 2020 2020  nd the h5py.    
+0000ff80: 2020 2020 2020 2020 6f6e 6573 2060 607b          ones ``{
+0000ff90: 2263 6f6d 7072 6573 7369 6f6e 223a 2022  "compression": "
+0000ffa0: 677a 6970 222c 2022 636f 6d70 7265 7373  gzip", "compress
+0000ffb0: 696f 6e5f 6f70 7473 223a 2039 7d60 602e  ion_opts": 9}``.
+0000ffc0: 0a20 2020 2020 2020 2020 2020 2054 6869  .            Thi
+0000ffd0: 7320 616c 6c6f 7773 2075 7369 6e67 2061  s allows using a
+0000ffe0: 6e79 2063 6f6d 7072 6573 7369 6f6e 2070  ny compression p
+0000fff0: 6c75 6769 6e20 696e 7374 616c 6c65 6420  lugin installed 
+00010000: 696e 2074 6865 2048 4446 350a 2020 2020  in the HDF5.    
+00010010: 2020 2020 2020 2020 6c69 6272 6172 792c          library,
+00010020: 2065 2e67 2e20 4c5a 462e 0a0a 2020 2020   e.g. LZF...    
+00010030: 2020 2020 756e 6c69 6d69 7465 645f 6469      unlimited_di
+00010040: 6d73 203a 2069 7465 7261 626c 6520 6f66  ms : iterable of
+00010050: 2068 6173 6861 626c 652c 206f 7074 696f   hashable, optio
+00010060: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+00010070: 4469 6d65 6e73 696f 6e28 7329 2074 6861  Dimension(s) tha
+00010080: 7420 7368 6f75 6c64 2062 6520 7365 7269  t should be seri
+00010090: 616c 697a 6564 2061 7320 756e 6c69 6d69  alized as unlimi
+000100a0: 7465 6420 6469 6d65 6e73 696f 6e73 2e0a  ted dimensions..
+000100b0: 2020 2020 2020 2020 2020 2020 4279 2064              By d
+000100c0: 6566 6175 6c74 2c20 6e6f 2064 696d 656e  efault, no dimen
+000100d0: 7369 6f6e 7320 6172 6520 7472 6561 7465  sions are treate
+000100e0: 6420 6173 2075 6e6c 696d 6974 6564 2064  d as unlimited d
+000100f0: 696d 656e 7369 6f6e 732e 0a20 2020 2020  imensions..     
+00010100: 2020 2020 2020 204e 6f74 6520 7468 6174         Note that
+00010110: 2075 6e6c 696d 6974 6564 5f64 696d 7320   unlimited_dims 
+00010120: 6d61 7920 616c 736f 2062 6520 7365 7420  may also be set 
+00010130: 7669 610a 2020 2020 2020 2020 2020 2020  via.            
+00010140: 6060 6461 7461 7365 742e 656e 636f 6469  ``dataset.encodi
+00010150: 6e67 5b22 756e 6c69 6d69 7465 645f 6469  ng["unlimited_di
+00010160: 6d73 225d 6060 2e0a 2020 2020 2020 2020  ms"]``..        
+00010170: 636f 6d70 7574 653a 2062 6f6f 6c2c 2064  compute: bool, d
+00010180: 6566 6175 6c74 3a20 5472 7565 0a20 2020  efault: True.   
+00010190: 2020 2020 2020 2020 2049 6620 7472 7565           If true
+000101a0: 2063 6f6d 7075 7465 2069 6d6d 6564 6961   compute immedia
+000101b0: 7465 6c79 2c20 6f74 6865 7277 6973 6520  tely, otherwise 
+000101c0: 7265 7475 726e 2061 0a20 2020 2020 2020  return a.       
+000101d0: 2020 2020 2060 6064 6173 6b2e 6465 6c61       ``dask.dela
+000101e0: 7965 642e 4465 6c61 7965 6460 6020 6f62  yed.Delayed`` ob
+000101f0: 6a65 6374 2074 6861 7420 6361 6e20 6265  ject that can be
+00010200: 2063 6f6d 7075 7465 6420 6c61 7465 722e   computed later.
+00010210: 0a20 2020 2020 2020 2069 6e76 616c 6964  .        invalid
+00010220: 5f6e 6574 6364 663a 2062 6f6f 6c2c 2064  _netcdf: bool, d
+00010230: 6566 6175 6c74 3a20 4661 6c73 650a 2020  efault: False.  
+00010240: 2020 2020 2020 2020 2020 4f6e 6c79 2076            Only v
+00010250: 616c 6964 2061 6c6f 6e67 2077 6974 6820  alid along with 
+00010260: 6060 656e 6769 6e65 3d22 6835 6e65 7463  ``engine="h5netc
+00010270: 6466 2260 602e 2049 6620 5472 7565 2c20  df"``. If True, 
+00010280: 616c 6c6f 7720 7772 6974 696e 670a 2020  allow writing.  
+00010290: 2020 2020 2020 2020 2020 6864 6635 2066            hdf5 f
+000102a0: 696c 6573 2077 6869 6368 2061 7265 2069  iles which are i
+000102b0: 6e76 616c 6964 206e 6574 6364 6620 6173  nvalid netcdf as
+000102c0: 2064 6573 6372 6962 6564 2069 6e0a 2020   described in.  
+000102d0: 2020 2020 2020 2020 2020 6874 7470 733a            https:
+000102e0: 2f2f 6769 7468 7562 2e63 6f6d 2f68 356e  //github.com/h5n
+000102f0: 6574 6364 662f 6835 6e65 7463 6466 2e0a  etcdf/h5netcdf..
+00010300: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00010310: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00010320: 0a20 2020 2020 2020 2020 2020 202a 2060  .            * `
+00010330: 6062 7974 6573 6060 2069 6620 7061 7468  `bytes`` if path
+00010340: 2069 7320 4e6f 6e65 0a20 2020 2020 2020   is None.       
+00010350: 2020 2020 202a 2060 6064 6173 6b2e 6465       * ``dask.de
+00010360: 6c61 7965 642e 4465 6c61 7965 6460 6020  layed.Delayed`` 
+00010370: 6966 2063 6f6d 7075 7465 2069 7320 4661  if compute is Fa
+00010380: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00010390: 2a20 4e6f 6e65 206f 7468 6572 7769 7365  * None otherwise
+000103a0: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
+000103b0: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
+000103c0: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
+000103d0: 4172 7261 792e 746f 5f6e 6574 6364 660a  Array.to_netcdf.
+000103e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000103f0: 2020 2020 6966 2065 6e63 6f64 696e 6720      if encoding 
+00010400: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00010410: 2020 2020 2065 6e63 6f64 696e 6720 3d20       encoding = 
+00010420: 7b7d 0a20 2020 2020 2020 2066 726f 6d20  {}.        from 
+00010430: 7861 7272 6179 2e62 6163 6b65 6e64 732e  xarray.backends.
+00010440: 6170 6920 696d 706f 7274 2074 6f5f 6e65  api import to_ne
+00010450: 7463 6466 0a0a 2020 2020 2020 2020 7265  tcdf..        re
+00010460: 7475 726e 2074 6f5f 6e65 7463 6466 2820  turn to_netcdf( 
+00010470: 2023 2074 7970 653a 2069 676e 6f72 6520   # type: ignore 
+00010480: 2023 206d 7970 7920 6361 6e6e 6f74 2072   # mypy cannot r
+00010490: 6573 6f6c 7665 2074 6865 206f 7665 726c  esolve the overl
+000104a0: 6f61 6473 3a28 0a20 2020 2020 2020 2020  oads:(.         
+000104b0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+000104c0: 2020 2020 2070 6174 682c 0a20 2020 2020       path,.     
+000104d0: 2020 2020 2020 206d 6f64 653d 6d6f 6465         mode=mode
+000104e0: 2c0a 2020 2020 2020 2020 2020 2020 666f  ,.            fo
+000104f0: 726d 6174 3d66 6f72 6d61 742c 0a20 2020  rmat=format,.   
+00010500: 2020 2020 2020 2020 2067 726f 7570 3d67           group=g
+00010510: 726f 7570 2c0a 2020 2020 2020 2020 2020  roup,.          
+00010520: 2020 656e 6769 6e65 3d65 6e67 696e 652c    engine=engine,
+00010530: 0a20 2020 2020 2020 2020 2020 2065 6e63  .            enc
+00010540: 6f64 696e 673d 656e 636f 6469 6e67 2c0a  oding=encoding,.
+00010550: 2020 2020 2020 2020 2020 2020 756e 6c69              unli
+00010560: 6d69 7465 645f 6469 6d73 3d75 6e6c 696d  mited_dims=unlim
+00010570: 6974 6564 5f64 696d 732c 0a20 2020 2020  ited_dims,.     
+00010580: 2020 2020 2020 2063 6f6d 7075 7465 3d63         compute=c
+00010590: 6f6d 7075 7465 2c0a 2020 2020 2020 2020  ompute,.        
+000105a0: 2020 2020 6d75 6c74 6966 696c 653d 4661      multifile=Fa
+000105b0: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+000105c0: 2069 6e76 616c 6964 5f6e 6574 6364 663d   invalid_netcdf=
+000105d0: 696e 7661 6c69 645f 6e65 7463 6466 2c0a  invalid_netcdf,.
+000105e0: 2020 2020 2020 2020 290a 0a20 2020 2023          )..    #
+000105f0: 2063 6f6d 7075 7465 3d54 7275 6520 2864   compute=True (d
+00010600: 6566 6175 6c74 2920 7265 7475 726e 7320  efault) returns 
+00010610: 5a61 7272 5374 6f72 650a 2020 2020 406f  ZarrStore.    @o
+00010620: 7665 726c 6f61 640a 2020 2020 6465 6620  verload.    def 
+00010630: 746f 5f7a 6172 7228 0a20 2020 2020 2020  to_zarr(.       
+00010640: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
+00010650: 746f 7265 3a20 4d75 7461 626c 654d 6170  tore: MutableMap
+00010660: 7069 6e67 207c 2073 7472 207c 2050 6174  ping | str | Pat
+00010670: 684c 696b 655b 7374 725d 207c 204e 6f6e  hLike[str] | Non
+00010680: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00010690: 2020 6368 756e 6b5f 7374 6f72 653a 204d    chunk_store: M
+000106a0: 7574 6162 6c65 4d61 7070 696e 6720 7c20  utableMapping | 
+000106b0: 7374 7220 7c20 5061 7468 4c69 6b65 207c  str | PathLike |
+000106c0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+000106d0: 2020 2020 2020 6d6f 6465 3a20 4c69 7465        mode: Lite
+000106e0: 7261 6c5b 2277 222c 2022 772d 222c 2022  ral["w", "w-", "
+000106f0: 6122 2c20 2272 2b22 2c20 4e6f 6e65 5d20  a", "r+", None] 
+00010700: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00010710: 7379 6e63 6872 6f6e 697a 6572 3d4e 6f6e  synchronizer=Non
+00010720: 652c 0a20 2020 2020 2020 2067 726f 7570  e,.        group
+00010730: 3a20 7374 7220 7c20 4e6f 6e65 203d 204e  : str | None = N
+00010740: 6f6e 652c 0a20 2020 2020 2020 2065 6e63  one,.        enc
+00010750: 6f64 696e 673a 204d 6170 7069 6e67 207c  oding: Mapping |
+00010760: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+00010770: 2020 2020 2020 636f 6d70 7574 653a 204c        compute: L
+00010780: 6974 6572 616c 5b54 7275 655d 203d 2054  iteral[True] = T
+00010790: 7275 652c 0a20 2020 2020 2020 2063 6f6e  rue,.        con
+000107a0: 736f 6c69 6461 7465 643a 2062 6f6f 6c20  solidated: bool 
+000107b0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+000107c0: 2020 2020 2020 2061 7070 656e 645f 6469         append_di
+000107d0: 6d3a 2048 6173 6861 626c 6520 7c20 4e6f  m: Hashable | No
+000107e0: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+000107f0: 2020 2072 6567 696f 6e3a 204d 6170 7069     region: Mappi
+00010800: 6e67 5b73 7472 2c20 736c 6963 655d 207c  ng[str, slice] |
+00010810: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+00010820: 2020 2020 2020 7361 6665 5f63 6875 6e6b        safe_chunk
+00010830: 733a 2062 6f6f 6c20 3d20 5472 7565 2c0a  s: bool = True,.
+00010840: 2020 2020 2020 2020 7374 6f72 6167 655f          storage_
+00010850: 6f70 7469 6f6e 733a 2064 6963 745b 7374  options: dict[st
+00010860: 722c 2073 7472 5d20 7c20 4e6f 6e65 203d  r, str] | None =
+00010870: 204e 6f6e 652c 0a20 2020 2020 2020 207a   None,.        z
+00010880: 6172 725f 7665 7273 696f 6e3a 2069 6e74  arr_version: int
+00010890: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+000108a0: 2020 2020 2920 2d3e 205a 6172 7253 746f      ) -> ZarrSto
+000108b0: 7265 3a0a 2020 2020 2020 2020 2e2e 2e0a  re:.        ....
+000108c0: 0a20 2020 2023 2063 6f6d 7075 7465 3d46  .    # compute=F
+000108d0: 616c 7365 2072 6574 7572 6e73 2064 6173  alse returns das
+000108e0: 6b2e 4465 6c61 7965 640a 2020 2020 406f  k.Delayed.    @o
+000108f0: 7665 726c 6f61 640a 2020 2020 6465 6620  verload.    def 
+00010900: 746f 5f7a 6172 7228 0a20 2020 2020 2020  to_zarr(.       
+00010910: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
+00010920: 746f 7265 3a20 4d75 7461 626c 654d 6170  tore: MutableMap
+00010930: 7069 6e67 207c 2073 7472 207c 2050 6174  ping | str | Pat
+00010940: 684c 696b 655b 7374 725d 207c 204e 6f6e  hLike[str] | Non
+00010950: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00010960: 2020 6368 756e 6b5f 7374 6f72 653a 204d    chunk_store: M
+00010970: 7574 6162 6c65 4d61 7070 696e 6720 7c20  utableMapping | 
+00010980: 7374 7220 7c20 5061 7468 4c69 6b65 207c  str | PathLike |
+00010990: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+000109a0: 2020 2020 2020 6d6f 6465 3a20 4c69 7465        mode: Lite
+000109b0: 7261 6c5b 2277 222c 2022 772d 222c 2022  ral["w", "w-", "
+000109c0: 6122 2c20 2272 2b22 2c20 4e6f 6e65 5d20  a", "r+", None] 
+000109d0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000109e0: 7379 6e63 6872 6f6e 697a 6572 3d4e 6f6e  synchronizer=Non
+000109f0: 652c 0a20 2020 2020 2020 2067 726f 7570  e,.        group
+00010a00: 3a20 7374 7220 7c20 4e6f 6e65 203d 204e  : str | None = N
+00010a10: 6f6e 652c 0a20 2020 2020 2020 2065 6e63  one,.        enc
+00010a20: 6f64 696e 673a 204d 6170 7069 6e67 207c  oding: Mapping |
+00010a30: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+00010a40: 2020 2020 2020 2a2c 0a20 2020 2020 2020        *,.       
+00010a50: 2063 6f6d 7075 7465 3a20 4c69 7465 7261   compute: Litera
+00010a60: 6c5b 4661 6c73 655d 2c0a 2020 2020 2020  l[False],.      
+00010a70: 2020 636f 6e73 6f6c 6964 6174 6564 3a20    consolidated: 
+00010a80: 626f 6f6c 207c 204e 6f6e 6520 3d20 4e6f  bool | None = No
+00010a90: 6e65 2c0a 2020 2020 2020 2020 6170 7065  ne,.        appe
+00010aa0: 6e64 5f64 696d 3a20 4861 7368 6162 6c65  nd_dim: Hashable
+00010ab0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00010ac0: 2020 2020 2020 2020 7265 6769 6f6e 3a20          region: 
+00010ad0: 4d61 7070 696e 675b 7374 722c 2073 6c69  Mapping[str, sli
+00010ae0: 6365 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ce] | None = Non
+00010af0: 652c 0a20 2020 2020 2020 2073 6166 655f  e,.        safe_
+00010b00: 6368 756e 6b73 3a20 626f 6f6c 203d 2054  chunks: bool = T
+00010b10: 7275 652c 0a20 2020 2020 2020 2073 746f  rue,.        sto
+00010b20: 7261 6765 5f6f 7074 696f 6e73 3a20 6469  rage_options: di
+00010b30: 6374 5b73 7472 2c20 7374 725d 207c 204e  ct[str, str] | N
+00010b40: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+00010b50: 2020 2020 7a61 7272 5f76 6572 7369 6f6e      zarr_version
+00010b60: 3a20 696e 7420 7c20 4e6f 6e65 203d 204e  : int | None = N
+00010b70: 6f6e 652c 0a20 2020 2029 202d 3e20 4465  one,.    ) -> De
+00010b80: 6c61 7965 643a 0a20 2020 2020 2020 202e  layed:.        .
+00010b90: 2e2e 0a0a 2020 2020 6465 6620 746f 5f7a  ....    def to_z
+00010ba0: 6172 7228 0a20 2020 2020 2020 2073 656c  arr(.        sel
+00010bb0: 662c 0a20 2020 2020 2020 2073 746f 7265  f,.        store
+00010bc0: 3a20 4d75 7461 626c 654d 6170 7069 6e67  : MutableMapping
+00010bd0: 207c 2073 7472 207c 2050 6174 684c 696b   | str | PathLik
+00010be0: 655b 7374 725d 207c 204e 6f6e 6520 3d20  e[str] | None = 
+00010bf0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6368  None,.        ch
+00010c00: 756e 6b5f 7374 6f72 653a 204d 7574 6162  unk_store: Mutab
+00010c10: 6c65 4d61 7070 696e 6720 7c20 7374 7220  leMapping | str 
+00010c20: 7c20 5061 7468 4c69 6b65 207c 204e 6f6e  | PathLike | Non
+00010c30: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00010c40: 2020 6d6f 6465 3a20 4c69 7465 7261 6c5b    mode: Literal[
+00010c50: 2277 222c 2022 772d 222c 2022 6122 2c20  "w", "w-", "a", 
+00010c60: 2272 2b22 2c20 4e6f 6e65 5d20 3d20 4e6f  "r+", None] = No
+00010c70: 6e65 2c0a 2020 2020 2020 2020 7379 6e63  ne,.        sync
+00010c80: 6872 6f6e 697a 6572 3d4e 6f6e 652c 0a20  hronizer=None,. 
+00010c90: 2020 2020 2020 2067 726f 7570 3a20 7374         group: st
+00010ca0: 7220 7c20 4e6f 6e65 203d 204e 6f6e 652c  r | None = None,
+00010cb0: 0a20 2020 2020 2020 2065 6e63 6f64 696e  .        encodin
+00010cc0: 673a 204d 6170 7069 6e67 207c 204e 6f6e  g: Mapping | Non
+00010cd0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00010ce0: 2020 636f 6d70 7574 653a 2062 6f6f 6c20    compute: bool 
+00010cf0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+00010d00: 636f 6e73 6f6c 6964 6174 6564 3a20 626f  consolidated: bo
+00010d10: 6f6c 207c 204e 6f6e 6520 3d20 4e6f 6e65  ol | None = None
+00010d20: 2c0a 2020 2020 2020 2020 6170 7065 6e64  ,.        append
+00010d30: 5f64 696d 3a20 4861 7368 6162 6c65 207c  _dim: Hashable |
+00010d40: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+00010d50: 2020 2020 2020 7265 6769 6f6e 3a20 4d61        region: Ma
+00010d60: 7070 696e 675b 7374 722c 2073 6c69 6365  pping[str, slice
+00010d70: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+00010d80: 0a20 2020 2020 2020 2073 6166 655f 6368  .        safe_ch
+00010d90: 756e 6b73 3a20 626f 6f6c 203d 2054 7275  unks: bool = Tru
+00010da0: 652c 0a20 2020 2020 2020 2073 746f 7261  e,.        stora
+00010db0: 6765 5f6f 7074 696f 6e73 3a20 6469 6374  ge_options: dict
+00010dc0: 5b73 7472 2c20 7374 725d 207c 204e 6f6e  [str, str] | Non
+00010dd0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00010de0: 2020 7a61 7272 5f76 6572 7369 6f6e 3a20    zarr_version: 
+00010df0: 696e 7420 7c20 4e6f 6e65 203d 204e 6f6e  int | None = Non
+00010e00: 652c 0a20 2020 2029 202d 3e20 5a61 7272  e,.    ) -> Zarr
+00010e10: 5374 6f72 6520 7c20 4465 6c61 7965 643a  Store | Delayed:
+00010e20: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
+00010e30: 6520 6461 7461 7365 7420 636f 6e74 656e  e dataset conten
+00010e40: 7473 2074 6f20 6120 7a61 7272 2067 726f  ts to a zarr gro
+00010e50: 7570 2e0a 0a20 2020 2020 2020 205a 6172  up...        Zar
+00010e60: 7220 6368 756e 6b73 2061 7265 2064 6574  r chunks are det
+00010e70: 6572 6d69 6e65 6420 696e 2074 6865 2066  ermined in the f
+00010e80: 6f6c 6c6f 7769 6e67 2077 6179 3a0a 0a20  ollowing way:.. 
+00010e90: 2020 2020 2020 202d 2046 726f 6d20 7468         - From th
+00010ea0: 6520 6060 6368 756e 6b73 6060 2061 7474  e ``chunks`` att
+00010eb0: 7269 6275 7465 2069 6e20 6561 6368 2076  ribute in each v
+00010ec0: 6172 6961 626c 6527 7320 6060 656e 636f  ariable's ``enco
+00010ed0: 6469 6e67 6060 0a20 2020 2020 2020 2020  ding``.         
+00010ee0: 2028 6361 6e20 6265 2073 6574 2076 6961   (can be set via
+00010ef0: 2060 4461 7461 7365 742e 6368 756e 6b60   `Dataset.chunk`
+00010f00: 292e 0a20 2020 2020 2020 202d 2049 6620  )..        - If 
+00010f10: 7468 6520 7661 7269 6162 6c65 2069 7320  the variable is 
+00010f20: 6120 4461 736b 2061 7272 6179 2c20 6672  a Dask array, fr
+00010f30: 6f6d 2074 6865 2064 6173 6b20 6368 756e  om the dask chun
+00010f40: 6b73 0a20 2020 2020 2020 202d 2049 6620  ks.        - If 
+00010f50: 6e65 6974 6865 7220 4461 736b 2063 6875  neither Dask chu
+00010f60: 6e6b 7320 6e6f 7220 656e 636f 6469 6e67  nks nor encoding
+00010f70: 2063 6875 6e6b 7320 6172 6520 7072 6573   chunks are pres
+00010f80: 656e 742c 2063 6875 6e6b 7320 7769 6c6c  ent, chunks will
+00010f90: 0a20 2020 2020 2020 2020 2062 6520 6465  .          be de
+00010fa0: 7465 726d 696e 6564 2061 7574 6f6d 6174  termined automat
+00010fb0: 6963 616c 6c79 2062 7920 5a61 7272 0a20  ically by Zarr. 
+00010fc0: 2020 2020 2020 202d 2049 6620 626f 7468         - If both
+00010fd0: 2044 6173 6b20 6368 756e 6b73 2061 6e64   Dask chunks and
+00010fe0: 2065 6e63 6f64 696e 6720 6368 756e 6b73   encoding chunks
+00010ff0: 2061 7265 2070 7265 7365 6e74 2c20 656e   are present, en
+00011000: 636f 6469 6e67 2063 6875 6e6b 730a 2020  coding chunks.  
+00011010: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
+00011020: 7573 6564 2c20 7072 6f76 6964 6564 2074  used, provided t
+00011030: 6861 7420 7468 6572 6520 6973 2061 206d  hat there is a m
+00011040: 616e 792d 746f 2d6f 6e65 2072 656c 6174  any-to-one relat
+00011050: 696f 6e73 6869 7020 6265 7477 6565 6e0a  ionship between.
+00011060: 2020 2020 2020 2020 2020 656e 636f 6469            encodi
+00011070: 6e67 2063 6875 6e6b 7320 616e 6420 6461  ng chunks and da
+00011080: 736b 2063 6875 6e6b 7320 2869 2e65 2e20  sk chunks (i.e. 
+00011090: 4461 736b 2063 6875 6e6b 7320 6172 6520  Dask chunks are 
+000110a0: 6269 6767 6572 2074 6861 6e20 616e 640a  bigger than and.
+000110b0: 2020 2020 2020 2020 2020 6576 656e 6c79            evenly
+000110c0: 2064 6976 6964 6520 656e 636f 6469 6e67   divide encoding
+000110d0: 2063 6875 6e6b 7329 3b20 6f74 6865 7277   chunks); otherw
+000110e0: 6973 6520 7261 6973 6520 6120 6060 5661  ise raise a ``Va
+000110f0: 6c75 6545 7272 6f72 6060 2e0a 2020 2020  lueError``..    
+00011100: 2020 2020 2020 5468 6973 2072 6573 7472        This restr
+00011110: 6963 7469 6f6e 2065 6e73 7572 6573 2074  iction ensures t
+00011120: 6861 7420 6e6f 2073 796e 6368 726f 6e69  hat no synchroni
+00011130: 7a61 7469 6f6e 202f 206c 6f63 6b73 2061  zation / locks a
+00011140: 7265 2072 6571 7569 7265 640a 2020 2020  re required.    
+00011150: 2020 2020 2020 7768 656e 2077 7269 7469        when writi
+00011160: 6e67 2e20 546f 2064 6973 6162 6c65 2074  ng. To disable t
+00011170: 6869 7320 7265 7374 7269 6374 696f 6e2c  his restriction,
+00011180: 2075 7365 2060 6073 6166 655f 6368 756e   use ``safe_chun
+00011190: 6b73 3d46 616c 7365 6060 2e0a 0a20 2020  ks=False``...   
+000111a0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+000111b0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000111c0: 2d2d 0a20 2020 2020 2020 2073 746f 7265  --.        store
+000111d0: 203a 204d 7574 6162 6c65 4d61 7070 696e   : MutableMappin
+000111e0: 672c 2073 7472 206f 7220 7061 7468 2d6c  g, str or path-l
+000111f0: 696b 652c 206f 7074 696f 6e61 6c0a 2020  ike, optional.  
+00011200: 2020 2020 2020 2020 2020 5374 6f72 6520            Store 
+00011210: 6f72 2070 6174 6820 746f 2064 6972 6563  or path to direc
+00011220: 746f 7279 2069 6e20 6c6f 6361 6c20 6f72  tory in local or
+00011230: 2072 656d 6f74 6520 6669 6c65 2073 7973   remote file sys
+00011240: 7465 6d2e 0a20 2020 2020 2020 2063 6875  tem..        chu
+00011250: 6e6b 5f73 746f 7265 203a 204d 7574 6162  nk_store : Mutab
+00011260: 6c65 4d61 7070 696e 672c 2073 7472 206f  leMapping, str o
+00011270: 7220 7061 7468 2d6c 696b 652c 206f 7074  r path-like, opt
+00011280: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+00011290: 2020 5374 6f72 6520 6f72 2070 6174 6820    Store or path 
+000112a0: 746f 2064 6972 6563 746f 7279 2069 6e20  to directory in 
+000112b0: 6c6f 6361 6c20 6f72 2072 656d 6f74 6520  local or remote 
+000112c0: 6669 6c65 2073 7973 7465 6d20 6f6e 6c79  file system only
+000112d0: 2066 6f72 205a 6172 720a 2020 2020 2020   for Zarr.      
+000112e0: 2020 2020 2020 6172 7261 7920 6368 756e        array chun
+000112f0: 6b73 2e20 5265 7175 6972 6573 207a 6172  ks. Requires zar
+00011300: 722d 7079 7468 6f6e 2076 322e 342e 3020  r-python v2.4.0 
+00011310: 6f72 206c 6174 6572 2e0a 2020 2020 2020  or later..      
+00011320: 2020 6d6f 6465 203a 207b 2277 222c 2022    mode : {"w", "
+00011330: 772d 222c 2022 6122 2c20 2272 2b22 2c20  w-", "a", "r+", 
+00011340: 4e6f 6e65 7d2c 206f 7074 696f 6e61 6c0a  None}, optional.
+00011350: 2020 2020 2020 2020 2020 2020 5065 7273              Pers
+00011360: 6973 7465 6e63 6520 6d6f 6465 3a20 2277  istence mode: "w
+00011370: 2220 6d65 616e 7320 6372 6561 7465 2028  " means create (
+00011380: 6f76 6572 7772 6974 6520 6966 2065 7869  overwrite if exi
+00011390: 7374 7329 3b0a 2020 2020 2020 2020 2020  sts);.          
+000113a0: 2020 2277 2d22 206d 6561 6e73 2063 7265    "w-" means cre
+000113b0: 6174 6520 2866 6169 6c20 6966 2065 7869  ate (fail if exi
+000113c0: 7374 7329 3b0a 2020 2020 2020 2020 2020  sts);.          
+000113d0: 2020 2261 2220 6d65 616e 7320 6f76 6572    "a" means over
+000113e0: 7269 6465 2065 7869 7374 696e 6720 7661  ride existing va
+000113f0: 7269 6162 6c65 7320 2863 7265 6174 6520  riables (create 
+00011400: 6966 2064 6f65 7320 6e6f 7420 6578 6973  if does not exis
+00011410: 7429 3b0a 2020 2020 2020 2020 2020 2020  t);.            
+00011420: 2272 2b22 206d 6561 6e73 206d 6f64 6966  "r+" means modif
+00011430: 7920 6578 6973 7469 6e67 2061 7272 6179  y existing array
+00011440: 202a 7661 6c75 6573 2a20 6f6e 6c79 2028   *values* only (
+00011450: 7261 6973 6520 616e 2065 7272 6f72 2069  raise an error i
+00011460: 660a 2020 2020 2020 2020 2020 2020 616e  f.            an
+00011470: 7920 6d65 7461 6461 7461 206f 7220 7368  y metadata or sh
+00011480: 6170 6573 2077 6f75 6c64 2063 6861 6e67  apes would chang
+00011490: 6529 2e0a 2020 2020 2020 2020 2020 2020  e)..            
+000114a0: 5468 6520 6465 6661 756c 7420 6d6f 6465  The default mode
+000114b0: 2069 7320 2261 2220 6966 2060 6061 7070   is "a" if ``app
+000114c0: 656e 645f 6469 6d60 6020 6973 2073 6574  end_dim`` is set
+000114d0: 2e20 4f74 6865 7277 6973 652c 2069 7420  . Otherwise, it 
+000114e0: 6973 0a20 2020 2020 2020 2020 2020 2022  is.            "
+000114f0: 722b 2220 6966 2060 6072 6567 696f 6e60  r+" if ``region`
+00011500: 6020 6973 2073 6574 2061 6e64 2060 6077  ` is set and ``w
+00011510: 2d60 6020 6f74 6865 7277 6973 652e 0a20  -`` otherwise.. 
+00011520: 2020 2020 2020 2073 796e 6368 726f 6e69         synchroni
+00011530: 7a65 7220 3a20 6f62 6a65 6374 2c20 6f70  zer : object, op
+00011540: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00011550: 2020 205a 6172 7220 6172 7261 7920 7379     Zarr array sy
+00011560: 6e63 6872 6f6e 697a 6572 2e0a 2020 2020  nchronizer..    
+00011570: 2020 2020 6772 6f75 7020 3a20 7374 722c      group : str,
+00011580: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00011590: 2020 2020 2020 4772 6f75 7020 7061 7468        Group path
+000115a0: 2e20 2861 2e6b 2e61 2e20 6070 6174 6860  . (a.k.a. `path`
+000115b0: 2069 6e20 7a61 7272 2074 6572 6d69 6e6f   in zarr termino
+000115c0: 6c6f 6779 2e29 0a20 2020 2020 2020 2065  logy.).        e
+000115d0: 6e63 6f64 696e 6720 3a20 6469 6374 2c20  ncoding : dict, 
+000115e0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+000115f0: 2020 2020 204e 6573 7465 6420 6469 6374       Nested dict
+00011600: 696f 6e61 7279 2077 6974 6820 7661 7269  ionary with vari
+00011610: 6162 6c65 206e 616d 6573 2061 7320 6b65  able names as ke
+00011620: 7973 2061 6e64 2064 6963 7469 6f6e 6172  ys and dictionar
+00011630: 6965 7320 6f66 0a20 2020 2020 2020 2020  ies of.         
+00011640: 2020 2076 6172 6961 626c 6520 7370 6563     variable spec
+00011650: 6966 6963 2065 6e63 6f64 696e 6773 2061  ific encodings a
+00011660: 7320 7661 6c75 6573 2c20 652e 672e 2c0a  s values, e.g.,.
+00011670: 2020 2020 2020 2020 2020 2020 6060 7b22              ``{"
+00011680: 6d79 5f76 6172 6961 626c 6522 3a20 7b22  my_variable": {"
+00011690: 6474 7970 6522 3a20 2269 6e74 3136 222c  dtype": "int16",
+000116a0: 2022 7363 616c 655f 6661 6374 6f72 223a   "scale_factor":
+000116b0: 2030 2e31 2c7d 2c20 2e2e 2e7d 6060 0a20   0.1,}, ...}``. 
+000116c0: 2020 2020 2020 2063 6f6d 7075 7465 203a         compute :
+000116d0: 2062 6f6f 6c2c 2064 6566 6175 6c74 3a20   bool, default: 
+000116e0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+000116f0: 2049 6620 5472 7565 2077 7269 7465 2061   If True write a
+00011700: 7272 6179 2064 6174 6120 696d 6d65 6469  rray data immedi
+00011710: 6174 656c 792c 206f 7468 6572 7769 7365  ately, otherwise
+00011720: 2072 6574 7572 6e20 610a 2020 2020 2020   return a.      
+00011730: 2020 2020 2020 6060 6461 736b 2e64 656c        ``dask.del
+00011740: 6179 6564 2e44 656c 6179 6564 6060 206f  ayed.Delayed`` o
+00011750: 626a 6563 7420 7468 6174 2063 616e 2062  bject that can b
+00011760: 6520 636f 6d70 7574 6564 2074 6f20 7772  e computed to wr
+00011770: 6974 650a 2020 2020 2020 2020 2020 2020  ite.            
+00011780: 6172 7261 7920 6461 7461 206c 6174 6572  array data later
+00011790: 2e20 4d65 7461 6461 7461 2069 7320 616c  . Metadata is al
+000117a0: 7761 7973 2075 7064 6174 6564 2065 6167  ways updated eag
+000117b0: 6572 6c79 2e0a 2020 2020 2020 2020 636f  erly..        co
+000117c0: 6e73 6f6c 6964 6174 6564 203a 2062 6f6f  nsolidated : boo
+000117d0: 6c2c 206f 7074 696f 6e61 6c0a 2020 2020  l, optional.    
+000117e0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+000117f0: 2061 7070 6c79 207a 6172 7227 7320 6063   apply zarr's `c
+00011800: 6f6e 736f 6c69 6461 7465 5f6d 6574 6164  onsolidate_metad
+00011810: 6174 6160 2066 756e 6374 696f 6e20 746f  ata` function to
+00011820: 2074 6865 2073 746f 7265 0a20 2020 2020   the store.     
+00011830: 2020 2020 2020 2061 6674 6572 2077 7269         after wri
+00011840: 7469 6e67 206d 6574 6164 6174 6120 616e  ting metadata an
+00011850: 6420 7265 6164 2065 7869 7374 696e 6720  d read existing 
+00011860: 7374 6f72 6573 2077 6974 6820 636f 6e73  stores with cons
+00011870: 6f6c 6964 6174 6564 0a20 2020 2020 2020  olidated.       
+00011880: 2020 2020 206d 6574 6164 6174 613b 2069       metadata; i
+00011890: 6620 4661 6c73 652c 2064 6f20 6e6f 742e  f False, do not.
+000118a0: 2054 6865 2064 6566 6175 6c74 2028 6063   The default (`c
+000118b0: 6f6e 736f 6c69 6461 7465 643d 4e6f 6e65  onsolidated=None
+000118c0: 6029 206d 6561 6e73 0a20 2020 2020 2020  `) means.       
+000118d0: 2020 2020 2077 7269 7465 2063 6f6e 736f       write conso
+000118e0: 6c69 6461 7465 6420 6d65 7461 6461 7461  lidated metadata
+000118f0: 2061 6e64 2061 7474 656d 7074 2074 6f20   and attempt to 
+00011900: 7265 6164 2063 6f6e 736f 6c69 6461 7465  read consolidate
+00011910: 640a 2020 2020 2020 2020 2020 2020 6d65  d.            me
+00011920: 7461 6461 7461 2066 6f72 2065 7869 7374  tadata for exist
+00011930: 696e 6720 7374 6f72 6573 2028 6661 6c6c  ing stores (fall
+00011940: 696e 6720 6261 636b 2074 6f20 6e6f 6e2d  ing back to non-
+00011950: 636f 6e73 6f6c 6964 6174 6564 292e 0a0a  consolidated)...
+00011960: 2020 2020 2020 2020 2020 2020 5768 656e              When
+00011970: 2074 6865 2065 7870 6572 696d 656e 7461   the experimenta
+00011980: 6c20 6060 7a61 7272 5f76 6572 7369 6f6e  l ``zarr_version
+00011990: 3d33 6060 2c20 6060 636f 6e73 6f6c 6964  =3``, ``consolid
+000119a0: 6174 6564 6060 206d 7573 7420 6265 0a20  ated`` must be. 
+000119b0: 2020 2020 2020 2020 2020 2065 6974 6865             eithe
+000119c0: 7220 6265 2060 604e 6f6e 6560 6020 6f72  r be ``None`` or
+000119d0: 2060 6046 616c 7365 6060 2e0a 2020 2020   ``False``..    
+000119e0: 2020 2020 6170 7065 6e64 5f64 696d 203a      append_dim :
+000119f0: 2068 6173 6861 626c 652c 206f 7074 696f   hashable, optio
+00011a00: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+00011a10: 4966 2073 6574 2c20 7468 6520 6469 6d65  If set, the dime
+00011a20: 6e73 696f 6e20 616c 6f6e 6720 7768 6963  nsion along whic
+00011a30: 6820 7468 6520 6461 7461 2077 696c 6c20  h the data will 
+00011a40: 6265 2061 7070 656e 6465 642e 2041 6c6c  be appended. All
+00011a50: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+00011a60: 6572 2064 696d 656e 7369 6f6e 7320 6f6e  er dimensions on
+00011a70: 206f 7665 7272 6964 6465 6e20 7661 7269   overridden vari
+00011a80: 6162 6c65 7320 6d75 7374 2072 656d 6169  ables must remai
+00011a90: 6e20 7468 6520 7361 6d65 2073 697a 652e  n the same size.
+00011aa0: 0a20 2020 2020 2020 2072 6567 696f 6e20  .        region 
+00011ab0: 3a20 6469 6374 2c20 6f70 7469 6f6e 616c  : dict, optional
+00011ac0: 0a20 2020 2020 2020 2020 2020 204f 7074  .            Opt
+00011ad0: 696f 6e61 6c20 6d61 7070 696e 6720 6672  ional mapping fr
+00011ae0: 6f6d 2064 696d 656e 7369 6f6e 206e 616d  om dimension nam
+00011af0: 6573 2074 6f20 696e 7465 6765 7220 736c  es to integer sl
+00011b00: 6963 6573 2061 6c6f 6e67 0a20 2020 2020  ices along.     
+00011b10: 2020 2020 2020 2064 6174 6173 6574 2064         dataset d
+00011b20: 696d 656e 7369 6f6e 7320 746f 2069 6e64  imensions to ind
+00011b30: 6963 6174 6520 7468 6520 7265 6769 6f6e  icate the region
+00011b40: 206f 6620 6578 6973 7469 6e67 207a 6172   of existing zar
+00011b50: 7220 6172 7261 7928 7329 0a20 2020 2020  r array(s).     
+00011b60: 2020 2020 2020 2069 6e20 7768 6963 6820         in which 
+00011b70: 746f 2077 7269 7465 2074 6869 7320 6461  to write this da
+00011b80: 7461 7365 7427 7320 6461 7461 2e20 466f  taset's data. Fo
+00011b90: 7220 6578 616d 706c 652c 0a20 2020 2020  r example,.     
+00011ba0: 2020 2020 2020 2060 607b 2778 273a 2073         ``{'x': s
+00011bb0: 6c69 6365 2830 2c20 3130 3030 292c 2027  lice(0, 1000), '
+00011bc0: 7927 3a20 736c 6963 6528 3130 3030 302c  y': slice(10000,
+00011bd0: 2031 3130 3030 297d 6060 2077 6f75 6c64   11000)}`` would
+00011be0: 2069 6e64 6963 6174 650a 2020 2020 2020   indicate.      
+00011bf0: 2020 2020 2020 7468 6174 2076 616c 7565        that value
+00011c00: 7320 7368 6f75 6c64 2062 6520 7772 6974  s should be writ
+00011c10: 7465 6e20 746f 2074 6865 2072 6567 696f  ten to the regio
+00011c20: 6e20 6060 303a 3130 3030 6060 2061 6c6f  n ``0:1000`` alo
+00011c30: 6e67 2060 6078 6060 0a20 2020 2020 2020  ng ``x``.       
+00011c40: 2020 2020 2061 6e64 2060 6031 3030 3030       and ``10000
+00011c50: 3a31 3130 3030 6060 2061 6c6f 6e67 2060  :11000`` along `
+00011c60: 6079 6060 2e0a 0a20 2020 2020 2020 2020  `y``...         
+00011c70: 2020 2054 776f 2072 6573 7472 6963 7469     Two restricti
+00011c80: 6f6e 7320 6170 706c 7920 746f 2074 6865  ons apply to the
+00011c90: 2075 7365 206f 6620 6060 7265 6769 6f6e   use of ``region
+00011ca0: 6060 3a0a 0a20 2020 2020 2020 2020 2020  ``:..           
+00011cb0: 202d 2049 6620 6060 7265 6769 6f6e 6060   - If ``region``
+00011cc0: 2069 7320 7365 742c 205f 616c 6c5f 2076   is set, _all_ v
+00011cd0: 6172 6961 626c 6573 2069 6e20 6120 6461  ariables in a da
+00011ce0: 7461 7365 7420 6d75 7374 2068 6176 6520  taset must have 
+00011cf0: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
+00011d00: 206c 6561 7374 206f 6e65 2064 696d 656e   least one dimen
+00011d10: 7369 6f6e 2069 6e20 636f 6d6d 6f6e 2077  sion in common w
+00011d20: 6974 6820 7468 6520 7265 6769 6f6e 2e20  ith the region. 
+00011d30: 4f74 6865 7220 7661 7269 6162 6c65 730a  Other variables.
+00011d40: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00011d50: 6f75 6c64 2062 6520 7772 6974 7465 6e20  ould be written 
+00011d60: 696e 2061 2073 6570 6172 6174 6520 6361  in a separate ca
+00011d70: 6c6c 2074 6f20 6060 746f 5f7a 6172 7228  ll to ``to_zarr(
+00011d80: 2960 602e 0a20 2020 2020 2020 2020 2020  )``..           
+00011d90: 202d 2044 696d 656e 7369 6f6e 7320 6361   - Dimensions ca
+00011da0: 6e6e 6f74 2062 6520 696e 636c 7564 6564  nnot be included
+00011db0: 2069 6e20 626f 7468 2060 6072 6567 696f   in both ``regio
+00011dc0: 6e60 6020 616e 640a 2020 2020 2020 2020  n`` and.        
+00011dd0: 2020 2020 2020 6060 6170 7065 6e64 5f64        ``append_d
+00011de0: 696d 6060 2061 7420 7468 6520 7361 6d65  im`` at the same
+00011df0: 2074 696d 652e 2054 6f20 6372 6561 7465   time. To create
+00011e00: 2065 6d70 7479 2061 7272 6179 7320 746f   empty arrays to
+00011e10: 2066 696c 6c0a 2020 2020 2020 2020 2020   fill.          
+00011e20: 2020 2020 696e 2077 6974 6820 6060 7265      in with ``re
+00011e30: 6769 6f6e 6060 2c20 7573 6520 6120 7365  gion``, use a se
+00011e40: 7061 7261 7465 2063 616c 6c20 746f 2060  parate call to `
+00011e50: 6074 6f5f 7a61 7272 2829 6060 2077 6974  `to_zarr()`` wit
+00011e60: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
+00011e70: 6060 636f 6d70 7574 653d 4661 6c73 6560  ``compute=False`
+00011e80: 602e 2053 6565 2022 4170 7065 6e64 696e  `. See "Appendin
+00011e90: 6720 746f 2065 7869 7374 696e 6720 5a61  g to existing Za
+00011ea0: 7272 2073 746f 7265 7322 2069 6e0a 2020  rr stores" in.  
+00011eb0: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+00011ec0: 7265 6665 7265 6e63 6520 646f 6375 6d65  reference docume
+00011ed0: 6e74 6174 696f 6e20 666f 7220 6675 6c6c  ntation for full
+00011ee0: 2064 6574 6169 6c73 2e0a 2020 2020 2020   details..      
+00011ef0: 2020 7361 6665 5f63 6875 6e6b 7320 3a20    safe_chunks : 
+00011f00: 626f 6f6c 2c20 6465 6661 756c 743a 2054  bool, default: T
+00011f10: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00011f20: 4966 2054 7275 652c 206f 6e6c 7920 616c  If True, only al
+00011f30: 6c6f 7720 7772 6974 6573 2074 6f20 7768  low writes to wh
+00011f40: 656e 2074 6865 7265 2069 7320 6120 6d61  en there is a ma
+00011f50: 6e79 2d74 6f2d 6f6e 6520 7265 6c61 7469  ny-to-one relati
+00011f60: 6f6e 7368 6970 0a20 2020 2020 2020 2020  onship.         
+00011f70: 2020 2062 6574 7765 656e 205a 6172 7220     between Zarr 
+00011f80: 6368 756e 6b73 2028 7370 6563 6966 6965  chunks (specifie
+00011f90: 6420 696e 2065 6e63 6f64 696e 6729 2061  d in encoding) a
+00011fa0: 6e64 2044 6173 6b20 6368 756e 6b73 2e0a  nd Dask chunks..
+00011fb0: 2020 2020 2020 2020 2020 2020 5365 7420              Set 
+00011fc0: 4661 6c73 6520 746f 206f 7665 7272 6964  False to overrid
+00011fd0: 6520 7468 6973 2072 6573 7472 6963 7469  e this restricti
+00011fe0: 6f6e 3b20 686f 7765 7665 722c 2064 6174  on; however, dat
+00011ff0: 6120 6d61 7920 6265 636f 6d65 2063 6f72  a may become cor
+00012000: 7275 7074 6564 0a20 2020 2020 2020 2020  rupted.         
+00012010: 2020 2069 6620 5a61 7272 2061 7272 6179     if Zarr array
+00012020: 7320 6172 6520 7772 6974 7465 6e20 696e  s are written in
+00012030: 2070 6172 616c 6c65 6c2e 2054 6869 7320   parallel. This 
+00012040: 6f70 7469 6f6e 206d 6179 2062 6520 7573  option may be us
+00012050: 6566 756c 2069 6e20 636f 6d62 696e 6174  eful in combinat
+00012060: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00012070: 7769 7468 2060 6063 6f6d 7075 7465 3d46  with ``compute=F
+00012080: 616c 7365 6060 2074 6f20 696e 6974 6961  alse`` to initia
+00012090: 6c69 7a65 2061 205a 6172 7220 6672 6f6d  lize a Zarr from
+000120a0: 2061 6e20 6578 6973 7469 6e67 0a20 2020   an existing.   
+000120b0: 2020 2020 2020 2020 2044 6174 6173 6574           Dataset
+000120c0: 2077 6974 6820 6172 6269 7472 6172 7920   with arbitrary 
+000120d0: 6368 756e 6b20 7374 7275 6374 7572 652e  chunk structure.
+000120e0: 0a20 2020 2020 2020 2073 746f 7261 6765  .        storage
+000120f0: 5f6f 7074 696f 6e73 203a 2064 6963 742c  _options : dict,
+00012100: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00012110: 2020 2020 2020 416e 7920 6164 6469 7469        Any additi
+00012120: 6f6e 616c 2070 6172 616d 6574 6572 7320  onal parameters 
+00012130: 666f 7220 7468 6520 7374 6f72 6167 6520  for the storage 
+00012140: 6261 636b 656e 6420 2869 676e 6f72 6564  backend (ignored
+00012150: 2066 6f72 206c 6f63 616c 0a20 2020 2020   for local.     
+00012160: 2020 2020 2020 2070 6174 6873 292e 0a20         paths).. 
+00012170: 2020 2020 2020 207a 6172 725f 7665 7273         zarr_vers
+00012180: 696f 6e20 3a20 696e 7420 6f72 204e 6f6e  ion : int or Non
+00012190: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
+000121a0: 2020 2020 2020 2020 5468 6520 6465 7369          The desi
+000121b0: 7265 6420 7a61 7272 2073 7065 6320 7665  red zarr spec ve
+000121c0: 7273 696f 6e20 746f 2074 6172 6765 7420  rsion to target 
+000121d0: 2863 7572 7265 6e74 6c79 2032 206f 7220  (currently 2 or 
+000121e0: 3329 2e20 5468 650a 2020 2020 2020 2020  3). The.        
+000121f0: 2020 2020 6465 6661 756c 7420 6f66 204e      default of N
+00012200: 6f6e 6520 7769 6c6c 2061 7474 656d 7074  one will attempt
+00012210: 2074 6f20 6465 7465 726d 696e 6520 7468   to determine th
+00012220: 6520 7a61 7272 2076 6572 7369 6f6e 2066  e zarr version f
+00012230: 726f 6d0a 2020 2020 2020 2020 2020 2020  rom.            
+00012240: 6060 7374 6f72 6560 6020 7768 656e 2070  ``store`` when p
+00012250: 6f73 7369 626c 652c 206f 7468 6572 7769  ossible, otherwi
+00012260: 7365 2064 6566 6175 6c74 696e 6720 746f  se defaulting to
+00012270: 2032 2e0a 0a20 2020 2020 2020 2052 6574   2...        Ret
+00012280: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+00012290: 2d2d 2d2d 0a20 2020 2020 2020 2020 2020  ----.           
+000122a0: 202a 2060 6064 6173 6b2e 6465 6c61 7965   * ``dask.delaye
+000122b0: 642e 4465 6c61 7965 6460 6020 6966 2063  d.Delayed`` if c
+000122c0: 6f6d 7075 7465 2069 7320 4661 6c73 650a  ompute is False.
+000122d0: 2020 2020 2020 2020 2020 2020 2a20 5a61              * Za
+000122e0: 7272 5374 6f72 6520 6f74 6865 7277 6973  rrStore otherwis
+000122f0: 650a 0a20 2020 2020 2020 2052 6566 6572  e..        Refer
+00012300: 656e 6365 730a 2020 2020 2020 2020 2d2d  ences.        --
+00012310: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00012320: 2068 7474 7073 3a2f 2f7a 6172 722e 7265   https://zarr.re
+00012330: 6164 7468 6564 6f63 732e 696f 2f0a 0a20  adthedocs.io/.. 
+00012340: 2020 2020 2020 204e 6f74 6573 0a20 2020         Notes.   
+00012350: 2020 2020 202d 2d2d 2d2d 0a20 2020 2020       -----.     
+00012360: 2020 205a 6172 7220 6368 756e 6b69 6e67     Zarr chunking
+00012370: 2062 6568 6176 696f 723a 0a20 2020 2020   behavior:.     
+00012380: 2020 2020 2020 2049 6620 6368 756e 6b73         If chunks
+00012390: 2061 7265 2066 6f75 6e64 2069 6e20 7468   are found in th
+000123a0: 6520 656e 636f 6469 6e67 2061 7267 756d  e encoding argum
+000123b0: 656e 7420 6f72 2061 7474 7269 6275 7465  ent or attribute
+000123c0: 0a20 2020 2020 2020 2020 2020 2063 6f72  .            cor
+000123d0: 7265 7370 6f6e 6469 6e67 2074 6f20 616e  responding to an
+000123e0: 7920 4461 7461 4172 7261 792c 2074 686f  y DataArray, tho
+000123f0: 7365 2063 6875 6e6b 7320 6172 6520 7573  se chunks are us
+00012400: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
+00012410: 4966 2061 2044 6174 6141 7272 6179 2069  If a DataArray i
+00012420: 7320 6120 6461 736b 2061 7272 6179 2c20  s a dask array, 
+00012430: 6974 2069 7320 7772 6974 7465 6e20 7769  it is written wi
+00012440: 7468 2074 686f 7365 2063 6875 6e6b 732e  th those chunks.
+00012450: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00012460: 6e6f 7420 6f74 6865 7220 6368 756e 6b73  not other chunks
+00012470: 2061 7265 2066 6f75 6e64 2c20 5a61 7272   are found, Zarr
+00012480: 2075 7365 7320 6974 7320 6f77 6e20 6865   uses its own he
+00012490: 7572 6973 7469 6373 2074 6f0a 2020 2020  uristics to.    
+000124a0: 2020 2020 2020 2020 6368 6f6f 7365 2061          choose a
+000124b0: 7574 6f6d 6174 6963 2063 6875 6e6b 2073  utomatic chunk s
+000124c0: 697a 6573 2e0a 0a20 2020 2020 2020 2065  izes...        e
+000124d0: 6e63 6f64 696e 673a 0a20 2020 2020 2020  ncoding:.       
+000124e0: 2020 2020 2054 6865 2065 6e63 6f64 696e       The encodin
+000124f0: 6720 6174 7472 6962 7574 6520 2869 6620  g attribute (if 
+00012500: 6578 6973 7473 2920 6f66 2074 6865 2044  exists) of the D
+00012510: 6174 6141 7272 6179 2873 2920 7769 6c6c  ataArray(s) will
+00012520: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
+00012530: 7573 6564 2e20 4f76 6572 7269 6465 2061  used. Override a
+00012540: 6e79 2065 7869 7374 696e 6720 656e 636f  ny existing enco
+00012550: 6469 6e67 7320 6279 2070 726f 7669 6469  dings by providi
+00012560: 6e67 2074 6865 2060 6065 6e63 6f64 696e  ng the ``encodin
+00012570: 6760 6020 6b77 6172 672e 0a0a 2020 2020  g`` kwarg...    
+00012580: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
+00012590: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+000125a0: 2020 2020 2020 3a72 6566 3a60 696f 2e7a        :ref:`io.z
+000125b0: 6172 7260 0a20 2020 2020 2020 2020 2020  arr`.           
+000125c0: 2054 6865 2049 2f4f 2075 7365 7220 6775   The I/O user gu
+000125d0: 6964 652c 2077 6974 6820 6d6f 7265 2064  ide, with more d
+000125e0: 6574 6169 6c73 2061 6e64 2065 7861 6d70  etails and examp
+000125f0: 6c65 732e 0a20 2020 2020 2020 2022 2222  les..        """
+00012600: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
+00012610: 7272 6179 2e62 6163 6b65 6e64 732e 6170  rray.backends.ap
+00012620: 6920 696d 706f 7274 2074 6f5f 7a61 7272  i import to_zarr
+00012630: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00012640: 2074 6f5f 7a61 7272 2820 2023 2074 7970   to_zarr(  # typ
+00012650: 653a 2069 676e 6f72 655b 6361 6c6c 2d6f  e: ignore[call-o
+00012660: 7665 726c 6f61 642c 6d69 7363 5d0a 2020  verload,misc].  
+00012670: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
+00012680: 2020 2020 2020 2020 2020 2020 7374 6f72              stor
+00012690: 653d 7374 6f72 652c 0a20 2020 2020 2020  e=store,.       
+000126a0: 2020 2020 2063 6875 6e6b 5f73 746f 7265       chunk_store
+000126b0: 3d63 6875 6e6b 5f73 746f 7265 2c0a 2020  =chunk_store,.  
+000126c0: 2020 2020 2020 2020 2020 7374 6f72 6167            storag
+000126d0: 655f 6f70 7469 6f6e 733d 7374 6f72 6167  e_options=storag
+000126e0: 655f 6f70 7469 6f6e 732c 0a20 2020 2020  e_options,.     
+000126f0: 2020 2020 2020 206d 6f64 653d 6d6f 6465         mode=mode
+00012700: 2c0a 2020 2020 2020 2020 2020 2020 7379  ,.            sy
+00012710: 6e63 6872 6f6e 697a 6572 3d73 796e 6368  nchronizer=synch
+00012720: 726f 6e69 7a65 722c 0a20 2020 2020 2020  ronizer,.       
+00012730: 2020 2020 2067 726f 7570 3d67 726f 7570       group=group
+00012740: 2c0a 2020 2020 2020 2020 2020 2020 656e  ,.            en
+00012750: 636f 6469 6e67 3d65 6e63 6f64 696e 672c  coding=encoding,
+00012760: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
+00012770: 7075 7465 3d63 6f6d 7075 7465 2c0a 2020  pute=compute,.  
+00012780: 2020 2020 2020 2020 2020 636f 6e73 6f6c            consol
+00012790: 6964 6174 6564 3d63 6f6e 736f 6c69 6461  idated=consolida
+000127a0: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
+000127b0: 2061 7070 656e 645f 6469 6d3d 6170 7065   append_dim=appe
+000127c0: 6e64 5f64 696d 2c0a 2020 2020 2020 2020  nd_dim,.        
+000127d0: 2020 2020 7265 6769 6f6e 3d72 6567 696f      region=regio
+000127e0: 6e2c 0a20 2020 2020 2020 2020 2020 2073  n,.            s
+000127f0: 6166 655f 6368 756e 6b73 3d73 6166 655f  afe_chunks=safe_
+00012800: 6368 756e 6b73 2c0a 2020 2020 2020 2020  chunks,.        
+00012810: 2020 2020 7a61 7272 5f76 6572 7369 6f6e      zarr_version
+00012820: 3d7a 6172 725f 7665 7273 696f 6e2c 0a20  =zarr_version,. 
+00012830: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00012840: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
+00012850: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
+00012860: 2072 6574 7572 6e20 666f 726d 6174 7469   return formatti
+00012870: 6e67 2e64 6174 6173 6574 5f72 6570 7228  ng.dataset_repr(
+00012880: 7365 6c66 290a 0a20 2020 2064 6566 205f  self)..    def _
+00012890: 7265 7072 5f68 746d 6c5f 2873 656c 6629  repr_html_(self)
+000128a0: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
+000128b0: 2069 6620 4f50 5449 4f4e 535b 2264 6973   if OPTIONS["dis
+000128c0: 706c 6179 5f73 7479 6c65 225d 203d 3d20  play_style"] == 
+000128d0: 2274 6578 7422 3a0a 2020 2020 2020 2020  "text":.        
+000128e0: 2020 2020 7265 7475 726e 2066 223c 7072      return f"<pr
+000128f0: 653e 7b65 7363 6170 6528 7265 7072 2873  e>{escape(repr(s
+00012900: 656c 6629 297d 3c2f 7072 653e 220a 2020  elf))}</pre>".  
+00012910: 2020 2020 2020 7265 7475 726e 2066 6f72        return for
+00012920: 6d61 7474 696e 675f 6874 6d6c 2e64 6174  matting_html.dat
+00012930: 6173 6574 5f72 6570 7228 7365 6c66 290a  aset_repr(self).
+00012940: 0a20 2020 2064 6566 2069 6e66 6f28 7365  .    def info(se
+00012950: 6c66 2c20 6275 663a 2049 4f20 7c20 4e6f  lf, buf: IO | No
+00012960: 6e65 203d 204e 6f6e 6529 202d 3e20 4e6f  ne = None) -> No
+00012970: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+00012980: 2020 2020 2020 2020 436f 6e63 6973 6520          Concise 
+00012990: 7375 6d6d 6172 7920 6f66 2061 2044 6174  summary of a Dat
+000129a0: 6173 6574 2076 6172 6961 626c 6573 2061  aset variables a
+000129b0: 6e64 2061 7474 7269 6275 7465 732e 0a0a  nd attributes...
+000129c0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+000129d0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+000129e0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6275  -----.        bu
+000129f0: 6620 3a20 6669 6c65 2d6c 696b 652c 2064  f : file-like, d
+00012a00: 6566 6175 6c74 3a20 7379 732e 7374 646f  efault: sys.stdo
+00012a10: 7574 0a20 2020 2020 2020 2020 2020 2077  ut.            w
+00012a20: 7269 7461 626c 6520 6275 6666 6572 0a0a  ritable buffer..
+00012a30: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+00012a40: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00012a50: 2d0a 2020 2020 2020 2020 7061 6e64 6173  -.        pandas
+00012a60: 2e44 6174 6146 7261 6d65 2e61 7373 6967  .DataFrame.assig
+00012a70: 6e0a 2020 2020 2020 2020 6e63 6475 6d70  n.        ncdump
+00012a80: 203a 206e 6574 4344 4627 7320 6e63 6475   : netCDF's ncdu
+00012a90: 6d70 0a20 2020 2020 2020 2022 2222 0a20  mp.        """. 
+00012aa0: 2020 2020 2020 2069 6620 6275 6620 6973         if buf is
+00012ab0: 204e 6f6e 653a 2020 2320 7072 6167 6d61   None:  # pragma
+00012ac0: 3a20 6e6f 2063 6f76 6572 0a20 2020 2020  : no cover.     
+00012ad0: 2020 2020 2020 2062 7566 203d 2073 7973         buf = sys
+00012ae0: 2e73 7464 6f75 740a 0a20 2020 2020 2020  .stdout..       
+00012af0: 206c 696e 6573 203d 205b 5d0a 2020 2020   lines = [].    
+00012b00: 2020 2020 6c69 6e65 732e 6170 7065 6e64      lines.append
+00012b10: 2822 7861 7272 6179 2e44 6174 6173 6574  ("xarray.Dataset
+00012b20: 207b 2229 0a20 2020 2020 2020 206c 696e   {").        lin
+00012b30: 6573 2e61 7070 656e 6428 2264 696d 656e  es.append("dimen
+00012b40: 7369 6f6e 733a 2229 0a20 2020 2020 2020  sions:").       
+00012b50: 2066 6f72 206e 616d 652c 2073 697a 6520   for name, size 
+00012b60: 696e 2073 656c 662e 6469 6d73 2e69 7465  in self.dims.ite
+00012b70: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00012b80: 2020 6c69 6e65 732e 6170 7065 6e64 2866    lines.append(f
+00012b90: 225c 747b 6e61 6d65 7d20 3d20 7b73 697a  "\t{name} = {siz
+00012ba0: 657d 203b 2229 0a20 2020 2020 2020 206c  e} ;").        l
+00012bb0: 696e 6573 2e61 7070 656e 6428 225c 6e76  ines.append("\nv
+00012bc0: 6172 6961 626c 6573 3a22 290a 2020 2020  ariables:").    
+00012bd0: 2020 2020 666f 7220 6e61 6d65 2c20 6461      for name, da
+00012be0: 2069 6e20 7365 6c66 2e76 6172 6961 626c   in self.variabl
+00012bf0: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
+00012c00: 2020 2020 2020 2020 6469 6d73 203d 2022          dims = "
+00012c10: 2c20 222e 6a6f 696e 286d 6170 2873 7472  , ".join(map(str
+00012c20: 2c20 6461 2e64 696d 7329 290a 2020 2020  , da.dims)).    
+00012c30: 2020 2020 2020 2020 6c69 6e65 732e 6170          lines.ap
+00012c40: 7065 6e64 2866 225c 747b 6461 2e64 7479  pend(f"\t{da.dty
+00012c50: 7065 7d20 7b6e 616d 657d 287b 6469 6d73  pe} {name}({dims
+00012c60: 7d29 203b 2229 0a20 2020 2020 2020 2020  }) ;").         
+00012c70: 2020 2066 6f72 206b 2c20 7620 696e 2064     for k, v in d
+00012c80: 612e 6174 7472 732e 6974 656d 7328 293a  a.attrs.items():
+00012c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012ca0: 206c 696e 6573 2e61 7070 656e 6428 6622   lines.append(f"
+00012cb0: 5c74 5c74 7b6e 616d 657d 3a7b 6b7d 203d  \t\t{name}:{k} =
+00012cc0: 207b 767d 203b 2229 0a20 2020 2020 2020   {v} ;").       
+00012cd0: 206c 696e 6573 2e61 7070 656e 6428 225c   lines.append("\
+00012ce0: 6e2f 2f20 676c 6f62 616c 2061 7474 7269  n// global attri
+00012cf0: 6275 7465 733a 2229 0a20 2020 2020 2020  butes:").       
+00012d00: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
+00012d10: 662e 6174 7472 732e 6974 656d 7328 293a  f.attrs.items():
+00012d20: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
+00012d30: 6573 2e61 7070 656e 6428 6622 5c74 3a7b  es.append(f"\t:{
+00012d40: 6b7d 203d 207b 767d 203b 2229 0a20 2020  k} = {v} ;").   
+00012d50: 2020 2020 206c 696e 6573 2e61 7070 656e       lines.appen
+00012d60: 6428 227d 2229 0a0a 2020 2020 2020 2020  d("}")..        
+00012d70: 6275 662e 7772 6974 6528 225c 6e22 2e6a  buf.write("\n".j
+00012d80: 6f69 6e28 6c69 6e65 7329 290a 0a20 2020  oin(lines))..   
+00012d90: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+00012da0: 6566 2063 6875 6e6b 7328 7365 6c66 2920  ef chunks(self) 
+00012db0: 2d3e 204d 6170 7069 6e67 5b48 6173 6861  -> Mapping[Hasha
+00012dc0: 626c 652c 2074 7570 6c65 5b69 6e74 2c20  ble, tuple[int, 
+00012dd0: 2e2e 2e5d 5d3a 0a20 2020 2020 2020 2022  ...]]:.        "
+00012de0: 2222 0a20 2020 2020 2020 204d 6170 7069  "".        Mappi
+00012df0: 6e67 2066 726f 6d20 6469 6d65 6e73 696f  ng from dimensio
+00012e00: 6e20 6e61 6d65 7320 746f 2062 6c6f 636b  n names to block
+00012e10: 206c 656e 6774 6873 2066 6f72 2074 6869   lengths for thi
+00012e20: 7320 6461 7461 7365 7427 7320 6461 7461  s dataset's data
+00012e30: 2c20 6f72 204e 6f6e 6520 6966 0a20 2020  , or None if.   
+00012e40: 2020 2020 2074 6865 2075 6e64 6572 6c79       the underly
+00012e50: 696e 6720 6461 7461 2069 7320 6e6f 7420  ing data is not 
+00012e60: 6120 6461 736b 2061 7272 6179 2e0a 2020  a dask array..  
+00012e70: 2020 2020 2020 4361 6e6e 6f74 2062 6520        Cannot be 
+00012e80: 6d6f 6469 6669 6564 2064 6972 6563 746c  modified directl
+00012e90: 792c 2062 7574 2063 616e 2062 6520 6d6f  y, but can be mo
+00012ea0: 6469 6669 6564 2062 7920 6361 6c6c 696e  dified by callin
+00012eb0: 6720 2e63 6875 6e6b 2829 2e0a 0a20 2020  g .chunk()...   
+00012ec0: 2020 2020 2053 616d 6520 6173 2044 6174       Same as Dat
+00012ed0: 6173 6574 2e63 6875 6e6b 7369 7a65 732c  aset.chunksizes,
+00012ee0: 2062 7574 206d 6169 6e74 6169 6e65 6420   but maintained 
+00012ef0: 666f 7220 6261 636b 7761 7264 7320 636f  for backwards co
+00012f00: 6d70 6174 6962 696c 6974 792e 0a0a 2020  mpatibility...  
+00012f10: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
+00012f20: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+00012f30: 2020 2020 2020 2020 4461 7461 7365 742e          Dataset.
+00012f40: 6368 756e 6b0a 2020 2020 2020 2020 4461  chunk.        Da
+00012f50: 7461 7365 742e 6368 756e 6b73 697a 6573  taset.chunksizes
+00012f60: 0a20 2020 2020 2020 2078 6172 7261 792e  .        xarray.
+00012f70: 756e 6966 795f 6368 756e 6b73 0a20 2020  unify_chunks.   
+00012f80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00012f90: 2072 6574 7572 6e20 6765 745f 6368 756e   return get_chun
+00012fa0: 6b73 697a 6573 2873 656c 662e 7661 7269  ksizes(self.vari
+00012fb0: 6162 6c65 732e 7661 6c75 6573 2829 290a  ables.values()).
+00012fc0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00012fd0: 2020 2064 6566 2063 6875 6e6b 7369 7a65     def chunksize
+00012fe0: 7328 7365 6c66 2920 2d3e 204d 6170 7069  s(self) -> Mappi
+00012ff0: 6e67 5b48 6173 6861 626c 652c 2074 7570  ng[Hashable, tup
+00013000: 6c65 5b69 6e74 2c20 2e2e 2e5d 5d3a 0a20  le[int, ...]]:. 
+00013010: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013020: 2020 204d 6170 7069 6e67 2066 726f 6d20     Mapping from 
+00013030: 6469 6d65 6e73 696f 6e20 6e61 6d65 7320  dimension names 
+00013040: 746f 2062 6c6f 636b 206c 656e 6774 6873  to block lengths
+00013050: 2066 6f72 2074 6869 7320 6461 7461 7365   for this datase
+00013060: 7427 7320 6461 7461 2c20 6f72 204e 6f6e  t's data, or Non
+00013070: 6520 6966 0a20 2020 2020 2020 2074 6865  e if.        the
+00013080: 2075 6e64 6572 6c79 696e 6720 6461 7461   underlying data
+00013090: 2069 7320 6e6f 7420 6120 6461 736b 2061   is not a dask a
+000130a0: 7272 6179 2e0a 2020 2020 2020 2020 4361  rray..        Ca
+000130b0: 6e6e 6f74 2062 6520 6d6f 6469 6669 6564  nnot be modified
+000130c0: 2064 6972 6563 746c 792c 2062 7574 2063   directly, but c
+000130d0: 616e 2062 6520 6d6f 6469 6669 6564 2062  an be modified b
+000130e0: 7920 6361 6c6c 696e 6720 2e63 6875 6e6b  y calling .chunk
+000130f0: 2829 2e0a 0a20 2020 2020 2020 2053 616d  ()...        Sam
+00013100: 6520 6173 2044 6174 6173 6574 2e63 6875  e as Dataset.chu
+00013110: 6e6b 732e 0a0a 2020 2020 2020 2020 5365  nks...        Se
+00013120: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
+00013130: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00013140: 4461 7461 7365 742e 6368 756e 6b0a 2020  Dataset.chunk.  
+00013150: 2020 2020 2020 4461 7461 7365 742e 6368        Dataset.ch
+00013160: 756e 6b73 0a20 2020 2020 2020 2078 6172  unks.        xar
+00013170: 7261 792e 756e 6966 795f 6368 756e 6b73  ray.unify_chunks
+00013180: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013190: 2020 2020 2072 6574 7572 6e20 6765 745f       return get_
+000131a0: 6368 756e 6b73 697a 6573 2873 656c 662e  chunksizes(self.
+000131b0: 7661 7269 6162 6c65 732e 7661 6c75 6573  variables.values
+000131c0: 2829 290a 0a20 2020 2064 6566 2063 6875  ())..    def chu
+000131d0: 6e6b 280a 2020 2020 2020 2020 7365 6c66  nk(.        self
+000131e0: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
+000131f0: 2020 2020 2063 6875 6e6b 733a 2028 0a20       chunks: (. 
+00013200: 2020 2020 2020 2020 2020 2069 6e74 207c             int |
+00013210: 204c 6974 6572 616c 5b22 6175 746f 225d   Literal["auto"]
+00013220: 207c 204d 6170 7069 6e67 5b41 6e79 2c20   | Mapping[Any, 
+00013230: 4e6f 6e65 207c 2069 6e74 207c 2073 7472  None | int | str
+00013240: 207c 2074 7570 6c65 5b69 6e74 2c20 2e2e   | tuple[int, ..
+00013250: 2e5d 5d0a 2020 2020 2020 2020 2920 3d20  .]].        ) = 
+00013260: 7b7d 2c20 2023 207b 7d20 6576 656e 2074  {},  # {} even t
+00013270: 686f 7567 6820 6974 2773 2074 6563 686e  hough it's techn
+00013280: 6963 616c 6c79 2075 6e73 6166 652c 2069  ically unsafe, i
+00013290: 7320 6265 696e 6720 7573 6564 2069 6e74  s being used int
+000132a0: 656e 7469 6f6e 616c 6c79 2068 6572 6520  entionally here 
+000132b0: 2823 3436 3637 290a 2020 2020 2020 2020  (#4667).        
+000132c0: 6e61 6d65 5f70 7265 6669 783a 2073 7472  name_prefix: str
+000132d0: 203d 2022 7861 7272 6179 2d22 2c0a 2020   = "xarray-",.  
+000132e0: 2020 2020 2020 746f 6b65 6e3a 2073 7472        token: str
+000132f0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00013300: 2020 2020 2020 2020 6c6f 636b 3a20 626f          lock: bo
+00013310: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+00013320: 2020 2020 696e 6c69 6e65 5f61 7272 6179      inline_array
+00013330: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+00013340: 2020 2020 2020 2020 2a2a 6368 756e 6b73          **chunks
+00013350: 5f6b 7761 7267 733a 204e 6f6e 6520 7c20  _kwargs: None | 
+00013360: 696e 7420 7c20 7374 7220 7c20 7475 706c  int | str | tupl
+00013370: 655b 696e 742c 202e 2e2e 5d2c 0a20 2020  e[int, ...],.   
+00013380: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
+00013390: 0a20 2020 2020 2020 2022 2222 436f 6572  .        """Coer
+000133a0: 6365 2061 6c6c 2061 7272 6179 7320 696e  ce all arrays in
+000133b0: 2074 6869 7320 6461 7461 7365 7420 696e   this dataset in
+000133c0: 746f 2064 6173 6b20 6172 7261 7973 2077  to dask arrays w
+000133d0: 6974 6820 7468 6520 6769 7665 6e0a 2020  ith the given.  
+000133e0: 2020 2020 2020 6368 756e 6b73 2e0a 0a20        chunks... 
+000133f0: 2020 2020 2020 204e 6f6e 2d64 6173 6b20         Non-dask 
+00013400: 6172 7261 7973 2069 6e20 7468 6973 2064  arrays in this d
+00013410: 6174 6173 6574 2077 696c 6c20 6265 2063  ataset will be c
+00013420: 6f6e 7665 7274 6564 2074 6f20 6461 736b  onverted to dask
+00013430: 2061 7272 6179 732e 2044 6173 6b0a 2020   arrays. Dask.  
+00013440: 2020 2020 2020 6172 7261 7973 2077 696c        arrays wil
+00013450: 6c20 6265 2072 6563 6875 6e6b 6564 2074  l be rechunked t
+00013460: 6f20 7468 6520 6769 7665 6e20 6368 756e  o the given chun
+00013470: 6b20 7369 7a65 732e 0a0a 2020 2020 2020  k sizes...      
+00013480: 2020 4966 206e 6569 7468 6572 2063 6875    If neither chu
+00013490: 6e6b 7320 6973 206e 6f74 2070 726f 7669  nks is not provi
+000134a0: 6465 6420 666f 7220 6f6e 6520 6f72 206d  ded for one or m
+000134b0: 6f72 6520 6469 6d65 6e73 696f 6e73 2c20  ore dimensions, 
+000134c0: 6368 756e 6b0a 2020 2020 2020 2020 7369  chunk.        si
+000134d0: 7a65 7320 616c 6f6e 6720 7468 6174 2064  zes along that d
+000134e0: 696d 656e 7369 6f6e 2077 696c 6c20 6e6f  imension will no
+000134f0: 7420 6265 2075 7064 6174 6564 3b20 6e6f  t be updated; no
+00013500: 6e2d 6461 736b 2061 7272 6179 7320 7769  n-dask arrays wi
+00013510: 6c6c 2062 650a 2020 2020 2020 2020 636f  ll be.        co
+00013520: 6e76 6572 7465 6420 696e 746f 2064 6173  nverted into das
+00013530: 6b20 6172 7261 7973 2077 6974 6820 6120  k arrays with a 
+00013540: 7369 6e67 6c65 2062 6c6f 636b 2e0a 0a20  single block... 
+00013550: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00013560: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00013570: 2d2d 2d2d 0a20 2020 2020 2020 2063 6875  ----.        chu
+00013580: 6e6b 7320 3a20 696e 742c 2074 7570 6c65  nks : int, tuple
+00013590: 206f 6620 696e 742c 2022 6175 746f 2220   of int, "auto" 
+000135a0: 6f72 206d 6170 7069 6e67 206f 6620 6861  or mapping of ha
+000135b0: 7368 6162 6c65 2074 6f20 696e 742c 206f  shable to int, o
+000135c0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+000135d0: 2020 2020 4368 756e 6b20 7369 7a65 7320      Chunk sizes 
+000135e0: 616c 6f6e 6720 6561 6368 2064 696d 656e  along each dimen
+000135f0: 7369 6f6e 2c20 652e 672e 2c20 6060 3560  sion, e.g., ``5`
+00013600: 602c 2060 6022 6175 746f 2260 602c 206f  `, ``"auto"``, o
+00013610: 720a 2020 2020 2020 2020 2020 2020 6060  r.            ``
+00013620: 7b22 7822 3a20 352c 2022 7922 3a20 357d  {"x": 5, "y": 5}
+00013630: 6060 2e0a 2020 2020 2020 2020 6e61 6d65  ``..        name
+00013640: 5f70 7265 6669 7820 3a20 7374 722c 2064  _prefix : str, d
+00013650: 6566 6175 6c74 3a20 2278 6172 7261 792d  efault: "xarray-
+00013660: 220a 2020 2020 2020 2020 2020 2020 5072  ".            Pr
+00013670: 6566 6978 2066 6f72 2074 6865 206e 616d  efix for the nam
+00013680: 6520 6f66 2061 6e79 206e 6577 2064 6173  e of any new das
+00013690: 6b20 6172 7261 7973 2e0a 2020 2020 2020  k arrays..      
+000136a0: 2020 746f 6b65 6e20 3a20 7374 722c 206f    token : str, o
+000136b0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+000136c0: 2020 2020 546f 6b65 6e20 756e 6971 7565      Token unique
+000136d0: 6c79 2069 6465 6e74 6966 7969 6e67 2074  ly identifying t
+000136e0: 6869 7320 6461 7461 7365 742e 0a20 2020  his dataset..   
+000136f0: 2020 2020 206c 6f63 6b20 3a20 626f 6f6c       lock : bool
+00013700: 2c20 6465 6661 756c 743a 2046 616c 7365  , default: False
+00013710: 0a20 2020 2020 2020 2020 2020 2050 6173  .            Pas
+00013720: 7365 6420 6f6e 2074 6f20 3a70 793a 6675  sed on to :py:fu
+00013730: 6e63 3a60 6461 736b 2e61 7272 6179 2e66  nc:`dask.array.f
+00013740: 726f 6d5f 6172 7261 7960 2c20 6966 2074  rom_array`, if t
+00013750: 6865 2061 7272 6179 2069 7320 6e6f 740a  he array is not.
+00013760: 2020 2020 2020 2020 2020 2020 616c 7265              alre
+00013770: 6164 7920 6173 2064 6173 6b20 6172 7261  ady as dask arra
+00013780: 792e 0a20 2020 2020 2020 2069 6e6c 696e  y..        inlin
+00013790: 655f 6172 7261 793a 2062 6f6f 6c2c 2064  e_array: bool, d
+000137a0: 6566 6175 6c74 3a20 4661 6c73 650a 2020  efault: False.  
+000137b0: 2020 2020 2020 2020 2020 5061 7373 6564            Passed
+000137c0: 206f 6e20 746f 203a 7079 3a66 756e 633a   on to :py:func:
+000137d0: 6064 6173 6b2e 6172 7261 792e 6672 6f6d  `dask.array.from
+000137e0: 5f61 7272 6179 602c 2069 6620 7468 6520  _array`, if the 
+000137f0: 6172 7261 7920 6973 206e 6f74 0a20 2020  array is not.   
+00013800: 2020 2020 2020 2020 2061 6c72 6561 6479           already
+00013810: 2061 7320 6461 736b 2061 7272 6179 2e0a   as dask array..
+00013820: 2020 2020 2020 2020 2a2a 6368 756e 6b73          **chunks
+00013830: 5f6b 7761 7267 7320 3a20 7b64 696d 3a20  _kwargs : {dim: 
+00013840: 6368 756e 6b73 2c20 2e2e 2e7d 2c20 6f70  chunks, ...}, op
+00013850: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00013860: 2020 2054 6865 206b 6579 776f 7264 2061     The keyword a
+00013870: 7267 756d 656e 7473 2066 6f72 6d20 6f66  rguments form of
+00013880: 2060 6063 6875 6e6b 7360 602e 0a20 2020   ``chunks``..   
+00013890: 2020 2020 2020 2020 204f 6e65 206f 6620           One of 
+000138a0: 6368 756e 6b73 206f 7220 6368 756e 6b73  chunks or chunks
+000138b0: 5f6b 7761 7267 7320 6d75 7374 2062 6520  _kwargs must be 
+000138c0: 7072 6f76 6964 6564 0a0a 2020 2020 2020  provided..      
+000138d0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+000138e0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+000138f0: 2020 6368 756e 6b65 6420 3a20 7861 7272    chunked : xarr
+00013900: 6179 2e44 6174 6173 6574 0a0a 2020 2020  ay.Dataset..    
+00013910: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
+00013920: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+00013930: 2020 2020 2020 4461 7461 7365 742e 6368        Dataset.ch
+00013940: 756e 6b73 0a20 2020 2020 2020 2044 6174  unks.        Dat
+00013950: 6173 6574 2e63 6875 6e6b 7369 7a65 730a  aset.chunksizes.
+00013960: 2020 2020 2020 2020 7861 7272 6179 2e75          xarray.u
+00013970: 6e69 6679 5f63 6875 6e6b 730a 2020 2020  nify_chunks.    
+00013980: 2020 2020 6461 736b 2e61 7272 6179 2e66      dask.array.f
+00013990: 726f 6d5f 6172 7261 790a 2020 2020 2020  rom_array.      
+000139a0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+000139b0: 2063 6875 6e6b 7320 6973 204e 6f6e 6520   chunks is None 
+000139c0: 616e 6420 6368 756e 6b73 5f6b 7761 7267  and chunks_kwarg
+000139d0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+000139e0: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
+000139f0: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
+00013a00: 2020 2020 2020 224e 6f6e 6520 7661 6c75        "None valu
+00013a10: 6520 666f 7220 2763 6875 6e6b 7327 2069  e for 'chunks' i
+00013a20: 7320 6465 7072 6563 6174 6564 2e20 220a  s deprecated. ".
+00013a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a40: 2249 7420 7769 6c6c 2072 6169 7365 2061  "It will raise a
+00013a50: 6e20 6572 726f 7220 696e 2074 6865 2066  n error in the f
+00013a60: 7574 7572 652e 2055 7365 2069 6e73 7465  uture. Use inste
+00013a70: 6164 2027 7b7d 2722 2c0a 2020 2020 2020  ad '{}'",.      
+00013a80: 2020 2020 2020 2020 2020 6361 7465 676f            catego
+00013a90: 7279 3d46 7574 7572 6557 6172 6e69 6e67  ry=FutureWarning
+00013aa0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00013ab0: 2020 2020 2020 2020 2020 2020 6368 756e              chun
+00013ac0: 6b73 203d 207b 7d0a 0a20 2020 2020 2020  ks = {}..       
+00013ad0: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
+00013ae0: 6875 6e6b 732c 2028 4e75 6d62 6572 2c20  hunks, (Number, 
+00013af0: 7374 722c 2069 6e74 2929 3a0a 2020 2020  str, int)):.    
+00013b00: 2020 2020 2020 2020 6368 756e 6b73 203d          chunks =
+00013b10: 2064 6963 742e 6672 6f6d 6b65 7973 2873   dict.fromkeys(s
+00013b20: 656c 662e 6469 6d73 2c20 6368 756e 6b73  elf.dims, chunks
+00013b30: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00013b40: 2020 2020 2020 2020 2020 2020 6368 756e              chun
+00013b50: 6b73 203d 2065 6974 6865 725f 6469 6374  ks = either_dict
+00013b60: 5f6f 725f 6b77 6172 6773 2863 6875 6e6b  _or_kwargs(chunk
+00013b70: 732c 2063 6875 6e6b 735f 6b77 6172 6773  s, chunks_kwargs
+00013b80: 2c20 2263 6875 6e6b 2229 0a0a 2020 2020  , "chunk")..    
+00013b90: 2020 2020 6261 645f 6469 6d73 203d 2063      bad_dims = c
+00013ba0: 6875 6e6b 732e 6b65 7973 2829 202d 2073  hunks.keys() - s
+00013bb0: 656c 662e 6469 6d73 2e6b 6579 7328 290a  elf.dims.keys().
+00013bc0: 2020 2020 2020 2020 6966 2062 6164 5f64          if bad_d
+00013bd0: 696d 733a 0a20 2020 2020 2020 2020 2020  ims:.           
+00013be0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00013bf0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00013c00: 2020 2066 2273 6f6d 6520 6368 756e 6b73     f"some chunks
+00013c10: 206b 6579 7320 6172 6520 6e6f 7420 6469   keys are not di
+00013c20: 6d65 6e73 696f 6e73 206f 6e20 7468 6973  mensions on this
+00013c30: 206f 626a 6563 743a 207b 6261 645f 6469   object: {bad_di
+00013c40: 6d73 7d22 0a20 2020 2020 2020 2020 2020  ms}".           
+00013c50: 2029 0a0a 2020 2020 2020 2020 7661 7269   )..        vari
+00013c60: 6162 6c65 7320 3d20 7b0a 2020 2020 2020  ables = {.      
+00013c70: 2020 2020 2020 6b3a 205f 6d61 7962 655f        k: _maybe_
+00013c80: 6368 756e 6b28 6b2c 2076 2c20 6368 756e  chunk(k, v, chun
+00013c90: 6b73 2c20 746f 6b65 6e2c 206c 6f63 6b2c  ks, token, lock,
+00013ca0: 206e 616d 655f 7072 6566 6978 290a 2020   name_prefix).  
+00013cb0: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
+00013cc0: 2076 2069 6e20 7365 6c66 2e76 6172 6961   v in self.varia
+00013cd0: 626c 6573 2e69 7465 6d73 2829 0a20 2020  bles.items().   
+00013ce0: 2020 2020 207d 0a20 2020 2020 2020 2072       }.        r
+00013cf0: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
+00013d00: 6163 6528 7661 7269 6162 6c65 7329 0a0a  ace(variables)..
+00013d10: 2020 2020 6465 6620 5f76 616c 6964 6174      def _validat
+00013d20: 655f 696e 6465 7865 7273 280a 2020 2020  e_indexers(.    
+00013d30: 2020 2020 7365 6c66 2c20 696e 6465 7865      self, indexe
+00013d40: 7273 3a20 4d61 7070 696e 675b 416e 792c  rs: Mapping[Any,
+00013d50: 2041 6e79 5d2c 206d 6973 7369 6e67 5f64   Any], missing_d
+00013d60: 696d 733a 2045 7272 6f72 4f70 7469 6f6e  ims: ErrorOption
+00013d70: 7357 6974 6857 6172 6e20 3d20 2272 6169  sWithWarn = "rai
+00013d80: 7365 220a 2020 2020 2920 2d3e 2049 7465  se".    ) -> Ite
+00013d90: 7261 746f 725b 7475 706c 655b 4861 7368  rator[tuple[Hash
+00013da0: 6162 6c65 2c20 696e 7420 7c20 736c 6963  able, int | slic
+00013db0: 6520 7c20 6e70 2e6e 6461 7272 6179 207c  e | np.ndarray |
+00013dc0: 2056 6172 6961 626c 655d 5d3a 0a20 2020   Variable]]:.   
+00013dd0: 2020 2020 2022 2222 4865 7265 2077 6520       """Here we 
+00013de0: 6d61 6b65 2073 7572 650a 2020 2020 2020  make sure.      
+00013df0: 2020 2b20 696e 6465 7865 7220 6861 7320    + indexer has 
+00013e00: 6120 7661 6c69 6420 6b65 7973 0a20 2020  a valid keys.   
+00013e10: 2020 2020 202b 2069 6e64 6578 6572 2069       + indexer i
+00013e20: 7320 696e 2061 2076 616c 6964 2064 6174  s in a valid dat
+00013e30: 6120 7479 7065 0a20 2020 2020 2020 202b  a type.        +
+00013e40: 2073 7472 696e 6720 696e 6465 7865 7273   string indexers
+00013e50: 2061 7265 2063 6173 7420 746f 2074 6865   are cast to the
+00013e60: 2061 7070 726f 7072 6961 7465 2064 6174   appropriate dat
+00013e70: 6520 7479 7065 2069 6620 7468 650a 2020  e type if the.  
+00013e80: 2020 2020 2020 2020 6173 736f 6369 6174          associat
+00013e90: 6564 2069 6e64 6578 2069 7320 6120 4461  ed index is a Da
+00013ea0: 7465 7469 6d65 496e 6465 7820 6f72 2043  tetimeIndex or C
+00013eb0: 4654 696d 6549 6e64 6578 0a20 2020 2020  FTimeIndex.     
+00013ec0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00013ed0: 726f 6d20 7861 7272 6179 2e63 6f64 696e  rom xarray.codin
+00013ee0: 672e 6366 7469 6d65 696e 6465 7820 696d  g.cftimeindex im
+00013ef0: 706f 7274 2043 4654 696d 6549 6e64 6578  port CFTimeIndex
+00013f00: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
+00013f10: 7272 6179 2e63 6f72 652e 6461 7461 6172  rray.core.dataar
+00013f20: 7261 7920 696d 706f 7274 2044 6174 6141  ray import DataA
+00013f30: 7272 6179 0a0a 2020 2020 2020 2020 696e  rray..        in
+00013f40: 6465 7865 7273 203d 2064 726f 705f 6469  dexers = drop_di
+00013f50: 6d73 5f66 726f 6d5f 696e 6465 7865 7273  ms_from_indexers
+00013f60: 2869 6e64 6578 6572 732c 2073 656c 662e  (indexers, self.
+00013f70: 6469 6d73 2c20 6d69 7373 696e 675f 6469  dims, missing_di
+00013f80: 6d73 290a 0a20 2020 2020 2020 2023 2061  ms)..        # a
+00013f90: 6c6c 2069 6e64 6578 6572 7320 7368 6f75  ll indexers shou
+00013fa0: 6c64 2062 6520 696e 742c 2073 6c69 6365  ld be int, slice
+00013fb0: 2c20 6e70 2e6e 6461 7272 6179 732c 206f  , np.ndarrays, o
+00013fc0: 7220 5661 7269 6162 6c65 0a20 2020 2020  r Variable.     
+00013fd0: 2020 2066 6f72 206b 2c20 7620 696e 2069     for k, v in i
+00013fe0: 6e64 6578 6572 732e 6974 656d 7328 293a  ndexers.items():
+00013ff0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00014000: 6973 696e 7374 616e 6365 2876 2c20 2869  isinstance(v, (i
+00014010: 6e74 2c20 736c 6963 652c 2056 6172 6961  nt, slice, Varia
+00014020: 626c 6529 293a 0a20 2020 2020 2020 2020  ble)):.         
+00014030: 2020 2020 2020 2079 6965 6c64 206b 2c20         yield k, 
+00014040: 760a 2020 2020 2020 2020 2020 2020 656c  v.            el
+00014050: 6966 2069 7369 6e73 7461 6e63 6528 762c  if isinstance(v,
+00014060: 2044 6174 6141 7272 6179 293a 0a20 2020   DataArray):.   
+00014070: 2020 2020 2020 2020 2020 2020 2079 6965               yie
+00014080: 6c64 206b 2c20 762e 7661 7269 6162 6c65  ld k, v.variable
+00014090: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+000140a0: 6620 6973 696e 7374 616e 6365 2876 2c20  f isinstance(v, 
+000140b0: 7475 706c 6529 3a0a 2020 2020 2020 2020  tuple):.        
+000140c0: 2020 2020 2020 2020 7969 656c 6420 6b2c          yield k,
+000140d0: 2061 735f 7661 7269 6162 6c65 2876 290a   as_variable(v).
+000140e0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000140f0: 2069 7369 6e73 7461 6e63 6528 762c 2044   isinstance(v, D
+00014100: 6174 6173 6574 293a 0a20 2020 2020 2020  ataset):.       
+00014110: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+00014120: 7970 6545 7272 6f72 2822 6361 6e6e 6f74  ypeError("cannot
+00014130: 2075 7365 2061 2044 6174 6173 6574 2061   use a Dataset a
+00014140: 7320 616e 2069 6e64 6578 6572 2229 0a20  s an indexer"). 
+00014150: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00014160: 6973 696e 7374 616e 6365 2876 2c20 5365  isinstance(v, Se
+00014170: 7175 656e 6365 2920 616e 6420 6c65 6e28  quence) and len(
+00014180: 7629 203d 3d20 303a 0a20 2020 2020 2020  v) == 0:.       
+00014190: 2020 2020 2020 2020 2079 6965 6c64 206b           yield k
+000141a0: 2c20 6e70 2e65 6d70 7479 2828 302c 292c  , np.empty((0,),
+000141b0: 2064 7479 7065 3d22 696e 7436 3422 290a   dtype="int64").
+000141c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000141d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000141e0: 2020 6966 206e 6f74 2069 735f 6475 636b    if not is_duck
+000141f0: 5f61 7272 6179 2876 293a 0a20 2020 2020  _array(v):.     
+00014200: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00014210: 203d 206e 702e 6173 6172 7261 7928 7629   = np.asarray(v)
+00014220: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014230: 2020 6966 2076 2e64 7479 7065 2e6b 696e    if v.dtype.kin
+00014240: 6420 696e 2022 5553 223a 0a20 2020 2020  d in "US":.     
+00014250: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00014260: 6e64 6578 203d 2073 656c 662e 5f69 6e64  ndex = self._ind
+00014270: 6578 6573 5b6b 5d2e 746f 5f70 616e 6461  exes[k].to_panda
+00014280: 735f 696e 6465 7828 290a 2020 2020 2020  s_index().      
+00014290: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000142a0: 2069 7369 6e73 7461 6e63 6528 696e 6465   isinstance(inde
+000142b0: 782c 2070 642e 4461 7465 7469 6d65 496e  x, pd.DatetimeIn
+000142c0: 6465 7829 3a0a 2020 2020 2020 2020 2020  dex):.          
+000142d0: 2020 2020 2020 2020 2020 2020 2020 7620                v 
+000142e0: 3d20 762e 6173 7479 7065 2822 6461 7465  = v.astype("date
+000142f0: 7469 6d65 3634 5b6e 735d 2229 0a20 2020  time64[ns]").   
+00014300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014310: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+00014320: 2869 6e64 6578 2c20 4346 5469 6d65 496e  (index, CFTimeIn
+00014330: 6465 7829 3a0a 2020 2020 2020 2020 2020  dex):.          
+00014340: 2020 2020 2020 2020 2020 2020 2020 7620                v 
+00014350: 3d20 5f70 6172 7365 5f61 7272 6179 5f6f  = _parse_array_o
+00014360: 665f 6366 7469 6d65 5f73 7472 696e 6773  f_cftime_strings
+00014370: 2876 2c20 696e 6465 782e 6461 7465 5f74  (v, index.date_t
+00014380: 7970 6529 0a0a 2020 2020 2020 2020 2020  ype)..          
+00014390: 2020 2020 2020 6966 2076 2e6e 6469 6d20        if v.ndim 
+000143a0: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
+000143b0: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
+000143c0: 6e64 6578 4572 726f 7228 0a20 2020 2020  ndexError(.     
+000143d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000143e0: 2020 2022 556e 6c61 6265 6c65 6420 6d75     "Unlabeled mu
+000143f0: 6c74 692d 6469 6d65 6e73 696f 6e61 6c20  lti-dimensional 
+00014400: 6172 7261 7920 6361 6e6e 6f74 2062 6520  array cannot be 
+00014410: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00014420: 2020 2020 2020 2020 2020 2275 7365 6420            "used 
+00014430: 666f 7220 696e 6465 7869 6e67 3a20 7b7d  for indexing: {}
+00014440: 222e 666f 726d 6174 286b 290a 2020 2020  ".format(k).    
+00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014460: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014470: 2020 7969 656c 6420 6b2c 2076 0a0a 2020    yield k, v..  
+00014480: 2020 6465 6620 5f76 616c 6964 6174 655f    def _validate_
+00014490: 696e 7465 7270 5f69 6e64 6578 6572 7328  interp_indexers(
+000144a0: 0a20 2020 2020 2020 2073 656c 662c 2069  .        self, i
+000144b0: 6e64 6578 6572 733a 204d 6170 7069 6e67  ndexers: Mapping
+000144c0: 5b41 6e79 2c20 416e 795d 0a20 2020 2029  [Any, Any].    )
+000144d0: 202d 3e20 4974 6572 6174 6f72 5b74 7570   -> Iterator[tup
+000144e0: 6c65 5b48 6173 6861 626c 652c 2056 6172  le[Hashable, Var
+000144f0: 6961 626c 655d 5d3a 0a20 2020 2020 2020  iable]]:.       
+00014500: 2022 2222 5661 7269 616e 7420 6f66 205f   """Variant of _
+00014510: 7661 6c69 6461 7465 5f69 6e64 6578 6572  validate_indexer
+00014520: 7320 746f 2062 6520 7573 6564 2066 6f72  s to be used for
+00014530: 2069 6e74 6572 706f 6c61 7469 6f6e 2222   interpolation""
+00014540: 220a 2020 2020 2020 2020 666f 7220 6b2c  ".        for k,
+00014550: 2076 2069 6e20 7365 6c66 2e5f 7661 6c69   v in self._vali
+00014560: 6461 7465 5f69 6e64 6578 6572 7328 696e  date_indexers(in
+00014570: 6465 7865 7273 293a 0a20 2020 2020 2020  dexers):.       
+00014580: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00014590: 6365 2876 2c20 5661 7269 6162 6c65 293a  ce(v, Variable):
+000145a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000145b0: 2069 6620 762e 6e64 696d 203d 3d20 313a   if v.ndim == 1:
+000145c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000145d0: 2020 2020 2079 6965 6c64 206b 2c20 762e       yield k, v.
+000145e0: 746f 5f69 6e64 6578 5f76 6172 6961 626c  to_index_variabl
+000145f0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00014600: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00014610: 2020 2020 2020 2020 2020 2020 2020 7969                yi
+00014620: 656c 6420 6b2c 2076 0a20 2020 2020 2020  eld k, v.       
+00014630: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+00014640: 616e 6365 2876 2c20 696e 7429 3a0a 2020  ance(v, int):.  
+00014650: 2020 2020 2020 2020 2020 2020 2020 7969                yi
+00014660: 656c 6420 6b2c 2056 6172 6961 626c 6528  eld k, Variable(
+00014670: 2829 2c20 762c 2061 7474 7273 3d73 656c  (), v, attrs=sel
+00014680: 662e 636f 6f72 6473 5b6b 5d2e 6174 7472  f.coords[k].attr
+00014690: 7329 0a20 2020 2020 2020 2020 2020 2065  s).            e
+000146a0: 6c69 6620 6973 696e 7374 616e 6365 2876  lif isinstance(v
+000146b0: 2c20 6e70 2e6e 6461 7272 6179 293a 0a20  , np.ndarray):. 
+000146c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000146d0: 6620 762e 6e64 696d 203d 3d20 303a 0a20  f v.ndim == 0:. 
+000146e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146f0: 2020 2079 6965 6c64 206b 2c20 5661 7269     yield k, Vari
+00014700: 6162 6c65 2828 292c 2076 2c20 6174 7472  able((), v, attr
+00014710: 733d 7365 6c66 2e63 6f6f 7264 735b 6b5d  s=self.coords[k]
+00014720: 2e61 7474 7273 290a 2020 2020 2020 2020  .attrs).        
+00014730: 2020 2020 2020 2020 656c 6966 2076 2e6e          elif v.n
+00014740: 6469 6d20 3d3d 2031 3a0a 2020 2020 2020  dim == 1:.      
+00014750: 2020 2020 2020 2020 2020 2020 2020 7969                yi
+00014760: 656c 6420 6b2c 2049 6e64 6578 5661 7269  eld k, IndexVari
+00014770: 6162 6c65 2828 6b2c 292c 2076 2c20 6174  able((k,), v, at
+00014780: 7472 733d 7365 6c66 2e63 6f6f 7264 735b  trs=self.coords[
+00014790: 6b5d 2e61 7474 7273 290a 2020 2020 2020  k].attrs).      
+000147a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000147b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147c0: 2020 2020 7261 6973 6520 4173 7365 7274      raise Assert
+000147d0: 696f 6e45 7272 6f72 2829 2020 2320 416c  ionError()  # Al
+000147e0: 7265 6164 7920 7465 7374 6564 2062 7920  ready tested by 
+000147f0: 5f76 616c 6964 6174 655f 696e 6465 7865  _validate_indexe
+00014800: 7273 0a20 2020 2020 2020 2020 2020 2065  rs.            e
+00014810: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00014820: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
+00014830: 7272 6f72 2874 7970 6528 7629 290a 0a20  rror(type(v)).. 
+00014840: 2020 2064 6566 205f 6765 745f 696e 6465     def _get_inde
+00014850: 7865 7273 5f63 6f6f 7264 735f 616e 645f  xers_coords_and_
+00014860: 696e 6465 7865 7328 7365 6c66 2c20 696e  indexes(self, in
+00014870: 6465 7865 7273 293a 0a20 2020 2020 2020  dexers):.       
+00014880: 2022 2222 4578 7472 6163 7420 636f 6f72   """Extract coor
+00014890: 6469 6e61 7465 7320 616e 6420 696e 6465  dinates and inde
+000148a0: 7865 7320 6672 6f6d 2069 6e64 6578 6572  xes from indexer
+000148b0: 732e 0a0a 2020 2020 2020 2020 4f6e 6c79  s...        Only
+000148c0: 2063 6f6f 7264 696e 6174 6520 7769 7468   coordinate with
+000148d0: 2061 206e 616d 6520 6469 6666 6572 656e   a name differen
+000148e0: 7420 6672 6f6d 2061 6e79 206f 6620 7365  t from any of se
+000148f0: 6c66 2e76 6172 6961 626c 6573 2077 696c  lf.variables wil
+00014900: 6c0a 2020 2020 2020 2020 6265 2061 7474  l.        be att
+00014910: 6163 6865 642e 0a20 2020 2020 2020 2022  ached..        "
+00014920: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00014930: 7861 7272 6179 2e63 6f72 652e 6461 7461  xarray.core.data
+00014940: 6172 7261 7920 696d 706f 7274 2044 6174  array import Dat
+00014950: 6141 7272 6179 0a0a 2020 2020 2020 2020  aArray..        
+00014960: 636f 6f72 6473 5f6c 6973 7420 3d20 5b5d  coords_list = []
+00014970: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
+00014980: 7620 696e 2069 6e64 6578 6572 732e 6974  v in indexers.it
+00014990: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+000149a0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+000149b0: 2876 2c20 4461 7461 4172 7261 7929 3a0a  (v, DataArray):.
 000149c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149d0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-000149e0: 2020 2020 2020 2020 2023 204d 616b 6520           # Make 
-000149f0: 7375 7265 2069 6e20 6361 7365 206f 6620  sure in case of 
-00014a00: 626f 6f6c 6561 6e20 4461 7461 4172 7261  boolean DataArra
-00014a10: 792c 2069 7473 0a20 2020 2020 2020 2020  y, its.         
-00014a20: 2020 2020 2020 2020 2020 2023 2063 6f6f             # coo
-00014a30: 7264 696e 6174 6520 616c 736f 2073 686f  rdinate also sho
-00014a40: 756c 6420 6265 2069 6e64 6578 6564 2e0a  uld be indexed..
-00014a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a60: 2020 2020 765f 636f 6f72 6473 203d 2076      v_coords = v
-00014a70: 5b76 2e76 616c 7565 732e 6e6f 6e7a 6572  [v.values.nonzer
-00014a80: 6f28 295b 305d 5d2e 636f 6f72 6473 0a20  o()[0]].coords. 
-00014a90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00014aa0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00014ab0: 2020 2020 2020 2020 2076 5f63 6f6f 7264           v_coord
-00014ac0: 7320 3d20 762e 636f 6f72 6473 0a20 2020  s = v.coords.   
-00014ad0: 2020 2020 2020 2020 2020 2020 2063 6f6f               coo
-00014ae0: 7264 735f 6c69 7374 2e61 7070 656e 6428  rds_list.append(
-00014af0: 765f 636f 6f72 6473 290a 0a20 2020 2020  v_coords)..     
-00014b00: 2020 2023 2077 6520 646f 6e27 7420 6e65     # we don't ne
-00014b10: 6564 2074 6f20 6361 6c6c 2061 6c69 676e  ed to call align
-00014b20: 2829 2065 7870 6c69 6369 746c 7920 6f72  () explicitly or
-00014b30: 2063 6865 636b 2069 6e64 6578 6573 2066   check indexes f
-00014b40: 6f72 0a20 2020 2020 2020 2023 2061 6c69  or.        # ali
-00014b50: 676e 6d65 6e74 2c20 6265 6361 7573 6520  gnment, because 
-00014b60: 6d65 7267 655f 7661 7269 6162 6c65 7320  merge_variables 
-00014b70: 616c 7265 6164 7920 6368 6563 6b73 2066  already checks f
-00014b80: 6f72 2065 7861 6374 2061 6c69 676e 6d65  or exact alignme
-00014b90: 6e74 0a20 2020 2020 2020 2023 2062 6574  nt.        # bet
-00014ba0: 7765 656e 2064 696d 656e 7369 6f6e 2063  ween dimension c
-00014bb0: 6f6f 7264 696e 6174 6573 0a20 2020 2020  oordinates.     
-00014bc0: 2020 2063 6f6f 7264 732c 2069 6e64 6578     coords, index
-00014bd0: 6573 203d 206d 6572 6765 5f63 6f6f 7264  es = merge_coord
-00014be0: 696e 6174 6573 5f77 6974 686f 7574 5f61  inates_without_a
-00014bf0: 6c69 676e 2863 6f6f 7264 735f 6c69 7374  lign(coords_list
-00014c00: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-00014c10: 5f63 6f6f 7264 696e 6174 655f 636f 6e73  _coordinate_cons
-00014c20: 6973 7465 6e74 2873 656c 662c 2063 6f6f  istent(self, coo
-00014c30: 7264 7329 0a0a 2020 2020 2020 2020 2320  rds)..        # 
-00014c40: 7369 6c65 6e74 6c79 2064 726f 7020 7468  silently drop th
-00014c50: 6520 636f 6e66 6c69 6374 6564 2076 6172  e conflicted var
-00014c60: 6961 626c 6573 2e0a 2020 2020 2020 2020  iables..        
-00014c70: 6174 7461 6368 6564 5f63 6f6f 7264 7320  attached_coords 
-00014c80: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
-00014c90: 2069 6e20 636f 6f72 6473 2e69 7465 6d73   in coords.items
-00014ca0: 2829 2069 6620 6b20 6e6f 7420 696e 2073  () if k not in s
-00014cb0: 656c 662e 5f76 6172 6961 626c 6573 7d0a  elf._variables}.
-00014cc0: 2020 2020 2020 2020 6174 7461 6368 6564          attached
-00014cd0: 5f69 6e64 6578 6573 203d 207b 0a20 2020  _indexes = {.   
-00014ce0: 2020 2020 2020 2020 206b 3a20 7620 666f           k: v fo
-00014cf0: 7220 6b2c 2076 2069 6e20 696e 6465 7865  r k, v in indexe
-00014d00: 732e 6974 656d 7328 2920 6966 206b 206e  s.items() if k n
-00014d10: 6f74 2069 6e20 7365 6c66 2e5f 7661 7269  ot in self._vari
-00014d20: 6162 6c65 730a 2020 2020 2020 2020 7d0a  ables.        }.
-00014d30: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00014d40: 7474 6163 6865 645f 636f 6f72 6473 2c20  ttached_coords, 
-00014d50: 6174 7461 6368 6564 5f69 6e64 6578 6573  attached_indexes
-00014d60: 0a0a 2020 2020 6465 6620 6973 656c 280a  ..    def isel(.
-00014d70: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
-00014d80: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
-00014d90: 2069 6e64 6578 6572 733a 204d 6170 7069   indexers: Mappi
-00014da0: 6e67 5b41 6e79 2c20 416e 795d 207c 204e  ng[Any, Any] | N
-00014db0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00014dc0: 2020 2020 6472 6f70 3a20 626f 6f6c 203d      drop: bool =
-00014dd0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-00014de0: 6d69 7373 696e 675f 6469 6d73 3a20 4572  missing_dims: Er
-00014df0: 726f 724f 7074 696f 6e73 5769 7468 5761  rorOptionsWithWa
-00014e00: 726e 203d 2022 7261 6973 6522 2c0a 2020  rn = "raise",.  
-00014e10: 2020 2020 2020 2a2a 696e 6465 7865 7273        **indexers
-00014e20: 5f6b 7761 7267 733a 2041 6e79 2c0a 2020  _kwargs: Any,.  
-00014e30: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
-00014e40: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00014e50: 7572 6e73 2061 206e 6577 2064 6174 6173  urns a new datas
-00014e60: 6574 2077 6974 6820 6561 6368 2061 7272  et with each arr
-00014e70: 6179 2069 6e64 6578 6564 2061 6c6f 6e67  ay indexed along
-00014e80: 2074 6865 2073 7065 6369 6669 6564 0a20   the specified. 
-00014e90: 2020 2020 2020 2064 696d 656e 7369 6f6e         dimension
-00014ea0: 2873 292e 0a0a 2020 2020 2020 2020 5468  (s)...        Th
-00014eb0: 6973 206d 6574 686f 6420 7365 6c65 6374  is method select
-00014ec0: 7320 7661 6c75 6573 2066 726f 6d20 6561  s values from ea
-00014ed0: 6368 2061 7272 6179 2075 7369 6e67 2069  ch array using i
-00014ee0: 7473 2060 5f5f 6765 7469 7465 6d5f 5f60  ts `__getitem__`
-00014ef0: 0a20 2020 2020 2020 206d 6574 686f 642c  .        method,
-00014f00: 2065 7863 6570 7420 7468 6973 206d 6574   except this met
-00014f10: 686f 6420 646f 6573 206e 6f74 2072 6571  hod does not req
-00014f20: 7569 7265 206b 6e6f 7769 6e67 2074 6865  uire knowing the
-00014f30: 206f 7264 6572 206f 660a 2020 2020 2020   order of.      
-00014f40: 2020 6561 6368 2061 7272 6179 2773 2064    each array's d
-00014f50: 696d 656e 7369 6f6e 732e 0a0a 2020 2020  imensions...    
-00014f60: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00014f70: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00014f80: 2d0a 2020 2020 2020 2020 696e 6465 7865  -.        indexe
-00014f90: 7273 203a 2064 6963 742c 206f 7074 696f  rs : dict, optio
-00014fa0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00014fb0: 4120 6469 6374 2077 6974 6820 6b65 7973  A dict with keys
-00014fc0: 206d 6174 6368 696e 6720 6469 6d65 6e73   matching dimens
-00014fd0: 696f 6e73 2061 6e64 2076 616c 7565 7320  ions and values 
-00014fe0: 6769 7665 6e0a 2020 2020 2020 2020 2020  given.          
-00014ff0: 2020 6279 2069 6e74 6567 6572 732c 2073    by integers, s
-00015000: 6c69 6365 206f 626a 6563 7473 206f 7220  lice objects or 
-00015010: 6172 7261 7973 2e0a 2020 2020 2020 2020  arrays..        
-00015020: 2020 2020 696e 6465 7865 7220 6361 6e20      indexer can 
-00015030: 6265 2061 2069 6e74 6567 6572 2c20 736c  be a integer, sl
-00015040: 6963 652c 2061 7272 6179 2d6c 696b 6520  ice, array-like 
-00015050: 6f72 2044 6174 6141 7272 6179 2e0a 2020  or DataArray..  
-00015060: 2020 2020 2020 2020 2020 4966 2044 6174            If Dat
-00015070: 6141 7272 6179 7320 6172 6520 7061 7373  aArrays are pass
-00015080: 6564 2061 7320 696e 6465 7865 7273 2c20  ed as indexers, 
-00015090: 7861 7272 6179 2d73 7479 6c65 2069 6e64  xarray-style ind
-000150a0: 6578 696e 6720 7769 6c6c 2062 650a 2020  exing will be.  
-000150b0: 2020 2020 2020 2020 2020 6361 7272 6965            carrie
-000150c0: 6420 6f75 742e 2053 6565 203a 7265 663a  d out. See :ref:
-000150d0: 6069 6e64 6578 696e 6760 2066 6f72 2074  `indexing` for t
-000150e0: 6865 2064 6574 6169 6c73 2e0a 2020 2020  he details..    
-000150f0: 2020 2020 2020 2020 4f6e 6520 6f66 2069          One of i
-00015100: 6e64 6578 6572 7320 6f72 2069 6e64 6578  ndexers or index
-00015110: 6572 735f 6b77 6172 6773 206d 7573 7420  ers_kwargs must 
-00015120: 6265 2070 726f 7669 6465 642e 0a20 2020  be provided..   
-00015130: 2020 2020 2064 726f 7020 3a20 626f 6f6c       drop : bool
-00015140: 2c20 6465 6661 756c 743a 2046 616c 7365  , default: False
-00015150: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00015160: 6060 6472 6f70 3d54 7275 6560 602c 2064  ``drop=True``, d
-00015170: 726f 7020 636f 6f72 6469 6e61 7465 7320  rop coordinates 
-00015180: 7661 7269 6162 6c65 7320 696e 6465 7865  variables indexe
-00015190: 6420 6279 2069 6e74 6567 6572 730a 2020  d by integers.  
-000151a0: 2020 2020 2020 2020 2020 696e 7374 6561            instea
-000151b0: 6420 6f66 206d 616b 696e 6720 7468 656d  d of making them
-000151c0: 2073 6361 6c61 722e 0a20 2020 2020 2020   scalar..       
-000151d0: 206d 6973 7369 6e67 5f64 696d 7320 3a20   missing_dims : 
-000151e0: 7b22 7261 6973 6522 2c20 2277 6172 6e22  {"raise", "warn"
-000151f0: 2c20 2269 676e 6f72 6522 7d2c 2064 6566  , "ignore"}, def
-00015200: 6175 6c74 3a20 2272 6169 7365 220a 2020  ault: "raise".  
-00015210: 2020 2020 2020 2020 2020 5768 6174 2074            What t
-00015220: 6f20 646f 2069 6620 6469 6d65 6e73 696f  o do if dimensio
-00015230: 6e73 2074 6861 7420 7368 6f75 6c64 2062  ns that should b
-00015240: 6520 7365 6c65 6374 6564 2066 726f 6d20  e selected from 
-00015250: 6172 6520 6e6f 7420 7072 6573 656e 7420  are not present 
-00015260: 696e 2074 6865 0a20 2020 2020 2020 2020  in the.         
-00015270: 2020 2044 6174 6173 6574 3a0a 2020 2020     Dataset:.    
-00015280: 2020 2020 2020 2020 2d20 2272 6169 7365          - "raise
-00015290: 223a 2072 6169 7365 2061 6e20 6578 6365  ": raise an exce
-000152a0: 7074 696f 6e0a 2020 2020 2020 2020 2020  ption.          
-000152b0: 2020 2d20 2277 6172 6e22 3a20 7261 6973    - "warn": rais
-000152c0: 6520 6120 7761 726e 696e 672c 2061 6e64  e a warning, and
-000152d0: 2069 676e 6f72 6520 7468 6520 6d69 7373   ignore the miss
-000152e0: 696e 6720 6469 6d65 6e73 696f 6e73 0a20  ing dimensions. 
-000152f0: 2020 2020 2020 2020 2020 202d 2022 6967             - "ig
-00015300: 6e6f 7265 223a 2069 676e 6f72 6520 7468  nore": ignore th
-00015310: 6520 6d69 7373 696e 6720 6469 6d65 6e73  e missing dimens
-00015320: 696f 6e73 0a0a 2020 2020 2020 2020 2a2a  ions..        **
-00015330: 696e 6465 7865 7273 5f6b 7761 7267 7320  indexers_kwargs 
-00015340: 3a20 7b64 696d 3a20 696e 6465 7865 722c  : {dim: indexer,
-00015350: 202e 2e2e 7d2c 206f 7074 696f 6e61 6c0a   ...}, optional.
-00015360: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-00015370: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-00015380: 7320 666f 726d 206f 6620 6060 696e 6465  s form of ``inde
-00015390: 7865 7273 6060 2e0a 2020 2020 2020 2020  xers``..        
-000153a0: 2020 2020 4f6e 6520 6f66 2069 6e64 6578      One of index
-000153b0: 6572 7320 6f72 2069 6e64 6578 6572 735f  ers or indexers_
-000153c0: 6b77 6172 6773 206d 7573 7420 6265 2070  kwargs must be p
-000153d0: 726f 7669 6465 642e 0a0a 2020 2020 2020  rovided...      
-000153e0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-000153f0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00015400: 2020 6f62 6a20 3a20 4461 7461 7365 740a    obj : Dataset.
-00015410: 2020 2020 2020 2020 2020 2020 4120 6e65              A ne
-00015420: 7720 4461 7461 7365 7420 7769 7468 2074  w Dataset with t
-00015430: 6865 2073 616d 6520 636f 6e74 656e 7473  he same contents
-00015440: 2061 7320 7468 6973 2064 6174 6173 6574   as this dataset
-00015450: 2c20 6578 6365 7074 2065 6163 680a 2020  , except each.  
-00015460: 2020 2020 2020 2020 2020 6172 7261 7920            array 
-00015470: 616e 6420 6469 6d65 6e73 696f 6e20 6973  and dimension is
-00015480: 2069 6e64 6578 6564 2062 7920 7468 6520   indexed by the 
-00015490: 6170 7072 6f70 7269 6174 6520 696e 6465  appropriate inde
-000154a0: 7865 7273 2e0a 2020 2020 2020 2020 2020  xers..          
-000154b0: 2020 4966 2069 6e64 6578 6572 2044 6174    If indexer Dat
-000154c0: 6141 7272 6179 7320 6861 7665 2063 6f6f  aArrays have coo
-000154d0: 7264 696e 6174 6573 2074 6861 7420 646f  rdinates that do
-000154e0: 206e 6f74 2063 6f6e 666c 6963 7420 7769   not conflict wi
-000154f0: 7468 0a20 2020 2020 2020 2020 2020 2074  th.            t
-00015500: 6869 7320 6f62 6a65 6374 2c20 7468 656e  his object, then
-00015510: 2074 6865 7365 2063 6f6f 7264 696e 6174   these coordinat
-00015520: 6573 2077 696c 6c20 6265 2061 7474 6163  es will be attac
-00015530: 6865 642e 0a20 2020 2020 2020 2020 2020  hed..           
-00015540: 2049 6e20 6765 6e65 7261 6c2c 2065 6163   In general, eac
-00015550: 6820 6172 7261 7927 7320 6461 7461 2077  h array's data w
-00015560: 696c 6c20 6265 2061 2076 6965 7720 6f66  ill be a view of
-00015570: 2074 6865 2061 7272 6179 2773 2064 6174   the array's dat
-00015580: 610a 2020 2020 2020 2020 2020 2020 696e  a.            in
-00015590: 2074 6869 7320 6461 7461 7365 742c 2075   this dataset, u
-000155a0: 6e6c 6573 7320 7665 6374 6f72 697a 6564  nless vectorized
-000155b0: 2069 6e64 6578 696e 6720 7761 7320 7472   indexing was tr
-000155c0: 6967 6765 7265 6420 6279 2075 7369 6e67  iggered by using
-000155d0: 0a20 2020 2020 2020 2020 2020 2061 6e20  .            an 
-000155e0: 6172 7261 7920 696e 6465 7865 722c 2069  array indexer, i
-000155f0: 6e20 7768 6963 6820 6361 7365 2074 6865  n which case the
-00015600: 2064 6174 6120 7769 6c6c 2062 6520 6120   data will be a 
-00015610: 636f 7079 2e0a 0a20 2020 2020 2020 2053  copy...        S
-00015620: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
-00015630: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00015640: 2044 6174 6173 6574 2e73 656c 0a20 2020   Dataset.sel.   
-00015650: 2020 2020 2044 6174 6141 7272 6179 2e69       DataArray.i
-00015660: 7365 6c0a 2020 2020 2020 2020 2222 220a  sel.        """.
-00015670: 2020 2020 2020 2020 696e 6465 7865 7273          indexers
-00015680: 203d 2065 6974 6865 725f 6469 6374 5f6f   = either_dict_o
-00015690: 725f 6b77 6172 6773 2869 6e64 6578 6572  r_kwargs(indexer
-000156a0: 732c 2069 6e64 6578 6572 735f 6b77 6172  s, indexers_kwar
-000156b0: 6773 2c20 2269 7365 6c22 290a 2020 2020  gs, "isel").    
-000156c0: 2020 2020 6966 2061 6e79 2869 735f 6661      if any(is_fa
-000156d0: 6e63 795f 696e 6465 7865 7228 6964 7829  ncy_indexer(idx)
-000156e0: 2066 6f72 2069 6478 2069 6e20 696e 6465   for idx in inde
-000156f0: 7865 7273 2e76 616c 7565 7328 2929 3a0a  xers.values()):.
-00015700: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00015710: 726e 2073 656c 662e 5f69 7365 6c5f 6661  rn self._isel_fa
-00015720: 6e63 7928 696e 6465 7865 7273 2c20 6472  ncy(indexers, dr
-00015730: 6f70 3d64 726f 702c 206d 6973 7369 6e67  op=drop, missing
-00015740: 5f64 696d 733d 6d69 7373 696e 675f 6469  _dims=missing_di
-00015750: 6d73 290a 0a20 2020 2020 2020 2023 204d  ms)..        # M
-00015760: 7563 6820 6661 7374 6572 2061 6c67 6f72  uch faster algor
-00015770: 6974 686d 2066 6f72 2077 6865 6e20 616c  ithm for when al
-00015780: 6c20 696e 6465 7865 7273 2061 7265 2069  l indexers are i
-00015790: 6e74 732c 2073 6c69 6365 732c 206f 6e65  nts, slices, one
-000157a0: 2d64 696d 656e 7369 6f6e 616c 0a20 2020  -dimensional.   
-000157b0: 2020 2020 2023 206c 6973 7473 2c20 6f72       # lists, or
-000157c0: 207a 6572 6f20 6f72 206f 6e65 2d64 696d   zero or one-dim
-000157d0: 656e 7369 6f6e 616c 206e 702e 6e64 6172  ensional np.ndar
-000157e0: 7261 7927 730a 2020 2020 2020 2020 696e  ray's.        in
-000157f0: 6465 7865 7273 203d 2064 726f 705f 6469  dexers = drop_di
-00015800: 6d73 5f66 726f 6d5f 696e 6465 7865 7273  ms_from_indexers
-00015810: 2869 6e64 6578 6572 732c 2073 656c 662e  (indexers, self.
-00015820: 6469 6d73 2c20 6d69 7373 696e 675f 6469  dims, missing_di
-00015830: 6d73 290a 0a20 2020 2020 2020 2076 6172  ms)..        var
-00015840: 6961 626c 6573 203d 207b 7d0a 2020 2020  iables = {}.    
-00015850: 2020 2020 6469 6d73 3a20 6469 6374 5b48      dims: dict[H
-00015860: 6173 6861 626c 652c 2069 6e74 5d20 3d20  ashable, int] = 
-00015870: 7b7d 0a20 2020 2020 2020 2063 6f6f 7264  {}.        coord
-00015880: 5f6e 616d 6573 203d 2073 656c 662e 5f63  _names = self._c
-00015890: 6f6f 7264 5f6e 616d 6573 2e63 6f70 7928  oord_names.copy(
-000158a0: 290a 0a20 2020 2020 2020 2069 6e64 6578  )..        index
-000158b0: 6573 2c20 696e 6465 785f 7661 7269 6162  es, index_variab
-000158c0: 6c65 7320 3d20 6973 656c 5f69 6e64 6578  les = isel_index
-000158d0: 6573 2873 656c 662e 7869 6e64 6578 6573  es(self.xindexes
-000158e0: 2c20 696e 6465 7865 7273 290a 0a20 2020  , indexers)..   
-000158f0: 2020 2020 2066 6f72 206e 616d 652c 2076       for name, v
-00015900: 6172 2069 6e20 7365 6c66 2e5f 7661 7269  ar in self._vari
-00015910: 6162 6c65 732e 6974 656d 7328 293a 0a20  ables.items():. 
-00015920: 2020 2020 2020 2020 2020 2023 2070 7265             # pre
-00015930: 7365 7276 6520 7661 7269 6162 6c65 206f  serve variable o
-00015940: 7264 6572 0a20 2020 2020 2020 2020 2020  rder.           
-00015950: 2069 6620 6e61 6d65 2069 6e20 696e 6465   if name in inde
-00015960: 785f 7661 7269 6162 6c65 733a 0a20 2020  x_variables:.   
-00015970: 2020 2020 2020 2020 2020 2020 2076 6172               var
-00015980: 203d 2069 6e64 6578 5f76 6172 6961 626c   = index_variabl
-00015990: 6573 5b6e 616d 655d 0a20 2020 2020 2020  es[name].       
-000159a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000159b0: 2020 2020 2020 2020 2020 2076 6172 5f69             var_i
-000159c0: 6e64 6578 6572 7320 3d20 7b6b 3a20 7620  ndexers = {k: v 
-000159d0: 666f 7220 6b2c 2076 2069 6e20 696e 6465  for k, v in inde
-000159e0: 7865 7273 2e69 7465 6d73 2829 2069 6620  xers.items() if 
-000159f0: 6b20 696e 2076 6172 2e64 696d 737d 0a20  k in var.dims}. 
-00015a00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00015a10: 6620 7661 725f 696e 6465 7865 7273 3a0a  f var_indexers:.
-00015a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a30: 2020 2020 7661 7220 3d20 7661 722e 6973      var = var.is
-00015a40: 656c 2876 6172 5f69 6e64 6578 6572 7329  el(var_indexers)
-00015a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015a60: 2020 2020 2069 6620 6472 6f70 2061 6e64       if drop and
-00015a70: 2076 6172 2e6e 6469 6d20 3d3d 2030 2061   var.ndim == 0 a
-00015a80: 6e64 206e 616d 6520 696e 2063 6f6f 7264  nd name in coord
-00015a90: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
-00015aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ab0: 636f 6f72 645f 6e61 6d65 732e 7265 6d6f  coord_names.remo
-00015ac0: 7665 286e 616d 6529 0a20 2020 2020 2020  ve(name).       
-00015ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ae0: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00015af0: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
-00015b00: 6e61 6d65 5d20 3d20 7661 720a 2020 2020  name] = var.    
-00015b10: 2020 2020 2020 2020 6469 6d73 2e75 7064          dims.upd
-00015b20: 6174 6528 7a69 7028 7661 722e 6469 6d73  ate(zip(var.dims
-00015b30: 2c20 7661 722e 7368 6170 6529 290a 0a20  , var.shape)).. 
-00015b40: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00015b50: 6c66 2e5f 636f 6e73 7472 7563 745f 6469  lf._construct_di
-00015b60: 7265 6374 280a 2020 2020 2020 2020 2020  rect(.          
-00015b70: 2020 7661 7269 6162 6c65 733d 7661 7269    variables=vari
-00015b80: 6162 6c65 732c 0a20 2020 2020 2020 2020  ables,.         
-00015b90: 2020 2063 6f6f 7264 5f6e 616d 6573 3d63     coord_names=c
-00015ba0: 6f6f 7264 5f6e 616d 6573 2c0a 2020 2020  oord_names,.    
-00015bb0: 2020 2020 2020 2020 6469 6d73 3d64 696d          dims=dim
-00015bc0: 732c 0a20 2020 2020 2020 2020 2020 2061  s,.            a
-00015bd0: 7474 7273 3d73 656c 662e 5f61 7474 7273  ttrs=self._attrs
-00015be0: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
-00015bf0: 6465 7865 733d 696e 6465 7865 732c 0a20  dexes=indexes,. 
-00015c00: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
-00015c10: 696e 673d 7365 6c66 2e5f 656e 636f 6469  ing=self._encodi
-00015c20: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-00015c30: 636c 6f73 653d 7365 6c66 2e5f 636c 6f73  close=self._clos
-00015c40: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
-00015c50: 2020 6465 6620 5f69 7365 6c5f 6661 6e63    def _isel_fanc
-00015c60: 7928 0a20 2020 2020 2020 2073 656c 663a  y(.        self:
-00015c70: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
-00015c80: 2020 2020 696e 6465 7865 7273 3a20 4d61      indexers: Ma
-00015c90: 7070 696e 675b 416e 792c 2041 6e79 5d2c  pping[Any, Any],
-00015ca0: 0a20 2020 2020 2020 202a 2c0a 2020 2020  .        *,.    
-00015cb0: 2020 2020 6472 6f70 3a20 626f 6f6c 2c0a      drop: bool,.
-00015cc0: 2020 2020 2020 2020 6d69 7373 696e 675f          missing_
-00015cd0: 6469 6d73 3a20 4572 726f 724f 7074 696f  dims: ErrorOptio
-00015ce0: 6e73 5769 7468 5761 726e 203d 2022 7261  nsWithWarn = "ra
-00015cf0: 6973 6522 2c0a 2020 2020 2920 2d3e 2054  ise",.    ) -> T
-00015d00: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-00015d10: 2020 7661 6c69 645f 696e 6465 7865 7273    valid_indexers
-00015d20: 203d 2064 6963 7428 7365 6c66 2e5f 7661   = dict(self._va
-00015d30: 6c69 6461 7465 5f69 6e64 6578 6572 7328  lidate_indexers(
-00015d40: 696e 6465 7865 7273 2c20 6d69 7373 696e  indexers, missin
-00015d50: 675f 6469 6d73 2929 0a0a 2020 2020 2020  g_dims))..      
-00015d60: 2020 7661 7269 6162 6c65 733a 2064 6963    variables: dic
-00015d70: 745b 4861 7368 6162 6c65 2c20 5661 7269  t[Hashable, Vari
-00015d80: 6162 6c65 5d20 3d20 7b7d 0a20 2020 2020  able] = {}.     
-00015d90: 2020 2069 6e64 6578 6573 2c20 696e 6465     indexes, inde
-00015da0: 785f 7661 7269 6162 6c65 7320 3d20 6973  x_variables = is
-00015db0: 656c 5f69 6e64 6578 6573 2873 656c 662e  el_indexes(self.
-00015dc0: 7869 6e64 6578 6573 2c20 7661 6c69 645f  xindexes, valid_
-00015dd0: 696e 6465 7865 7273 290a 0a20 2020 2020  indexers)..     
-00015de0: 2020 2066 6f72 206e 616d 652c 2076 6172     for name, var
-00015df0: 2069 6e20 7365 6c66 2e76 6172 6961 626c   in self.variabl
-00015e00: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
-00015e10: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
-00015e20: 696e 2069 6e64 6578 5f76 6172 6961 626c  in index_variabl
-00015e30: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00015e40: 2020 2020 6e65 775f 7661 7220 3d20 696e      new_var = in
-00015e50: 6465 785f 7661 7269 6162 6c65 735b 6e61  dex_variables[na
-00015e60: 6d65 5d0a 2020 2020 2020 2020 2020 2020  me].            
-00015e70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00015e80: 2020 2020 2020 7661 725f 696e 6465 7865        var_indexe
-00015e90: 7273 203d 207b 0a20 2020 2020 2020 2020  rs = {.         
-00015ea0: 2020 2020 2020 2020 2020 206b 3a20 7620             k: v 
-00015eb0: 666f 7220 6b2c 2076 2069 6e20 7661 6c69  for k, v in vali
-00015ec0: 645f 696e 6465 7865 7273 2e69 7465 6d73  d_indexers.items
-00015ed0: 2829 2069 6620 6b20 696e 2076 6172 2e64  () if k in var.d
-00015ee0: 696d 730a 2020 2020 2020 2020 2020 2020  ims.            
-00015ef0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-00015f00: 2020 2020 2020 6966 2076 6172 5f69 6e64        if var_ind
-00015f10: 6578 6572 733a 0a20 2020 2020 2020 2020  exers:.         
-00015f20: 2020 2020 2020 2020 2020 206e 6577 5f76             new_v
-00015f30: 6172 203d 2076 6172 2e69 7365 6c28 696e  ar = var.isel(in
-00015f40: 6465 7865 7273 3d76 6172 5f69 6e64 6578  dexers=var_index
-00015f50: 6572 7329 0a20 2020 2020 2020 2020 2020  ers).           
-00015f60: 2020 2020 2020 2020 2023 2064 726f 7020           # drop 
-00015f70: 7363 616c 6172 2063 6f6f 7264 696e 6174  scalar coordinat
-00015f80: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-00015f90: 2020 2020 2020 2023 2068 7474 7073 3a2f         # https:/
-00015fa0: 2f67 6974 6875 622e 636f 6d2f 7079 6461  /github.com/pyda
-00015fb0: 7461 2f78 6172 7261 792f 6973 7375 6573  ta/xarray/issues
-00015fc0: 2f36 3535 340a 2020 2020 2020 2020 2020  /6554.          
-00015fd0: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-00015fe0: 6520 696e 2073 656c 662e 636f 6f72 6473  e in self.coords
-00015ff0: 2061 6e64 2064 726f 7020 616e 6420 6e65   and drop and ne
-00016000: 775f 7661 722e 6e64 696d 203d 3d20 303a  w_var.ndim == 0:
-00016010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016020: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00016030: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00016040: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00016050: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00016060: 7661 7220 3d20 7661 722e 636f 7079 2864  var = var.copy(d
-00016070: 6565 703d 4661 6c73 6529 0a20 2020 2020  eep=False).     
-00016080: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
-00016090: 6d65 206e 6f74 2069 6e20 696e 6465 7865  me not in indexe
-000160a0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000160b0: 2020 2020 2020 206e 6577 5f76 6172 203d         new_var =
-000160c0: 206e 6577 5f76 6172 2e74 6f5f 6261 7365   new_var.to_base
-000160d0: 5f76 6172 6961 626c 6528 290a 2020 2020  _variable().    
-000160e0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-000160f0: 735b 6e61 6d65 5d20 3d20 6e65 775f 7661  s[name] = new_va
-00016100: 720a 0a20 2020 2020 2020 2063 6f6f 7264  r..        coord
-00016110: 5f6e 616d 6573 203d 2073 656c 662e 5f63  _names = self._c
-00016120: 6f6f 7264 5f6e 616d 6573 2026 2076 6172  oord_names & var
-00016130: 6961 626c 6573 2e6b 6579 7328 290a 2020  iables.keys().  
-00016140: 2020 2020 2020 7365 6c65 6374 6564 203d        selected =
-00016150: 2073 656c 662e 5f72 6570 6c61 6365 5f77   self._replace_w
-00016160: 6974 685f 6e65 775f 6469 6d73 2876 6172  ith_new_dims(var
-00016170: 6961 626c 6573 2c20 636f 6f72 645f 6e61  iables, coord_na
-00016180: 6d65 732c 2069 6e64 6578 6573 290a 0a20  mes, indexes).. 
-00016190: 2020 2020 2020 2023 2045 7874 7261 6374         # Extract
-000161a0: 2063 6f6f 7264 696e 6174 6573 2066 726f   coordinates fro
-000161b0: 6d20 696e 6465 7865 7273 0a20 2020 2020  m indexers.     
-000161c0: 2020 2063 6f6f 7264 5f76 6172 732c 206e     coord_vars, n
-000161d0: 6577 5f69 6e64 6578 6573 203d 2073 656c  ew_indexes = sel
-000161e0: 6563 7465 642e 5f67 6574 5f69 6e64 6578  ected._get_index
-000161f0: 6572 735f 636f 6f72 6473 5f61 6e64 5f69  ers_coords_and_i
-00016200: 6e64 6578 6573 2869 6e64 6578 6572 7329  ndexes(indexers)
-00016210: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-00016220: 6573 2e75 7064 6174 6528 636f 6f72 645f  es.update(coord_
-00016230: 7661 7273 290a 2020 2020 2020 2020 696e  vars).        in
-00016240: 6465 7865 732e 7570 6461 7465 286e 6577  dexes.update(new
-00016250: 5f69 6e64 6578 6573 290a 2020 2020 2020  _indexes).      
-00016260: 2020 636f 6f72 645f 6e61 6d65 7320 3d20    coord_names = 
-00016270: 7365 6c66 2e5f 636f 6f72 645f 6e61 6d65  self._coord_name
-00016280: 7320 2620 7661 7269 6162 6c65 732e 6b65  s & variables.ke
-00016290: 7973 2829 207c 2063 6f6f 7264 5f76 6172  ys() | coord_var
-000162a0: 732e 6b65 7973 2829 0a20 2020 2020 2020  s.keys().       
-000162b0: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-000162c0: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
-000162d0: 696d 7328 7661 7269 6162 6c65 732c 2063  ims(variables, c
-000162e0: 6f6f 7264 5f6e 616d 6573 2c20 696e 6465  oord_names, inde
-000162f0: 7865 733d 696e 6465 7865 7329 0a0a 2020  xes=indexes)..  
-00016300: 2020 6465 6620 7365 6c28 0a20 2020 2020    def sel(.     
-00016310: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-00016320: 6574 2c0a 2020 2020 2020 2020 696e 6465  et,.        inde
-00016330: 7865 7273 3a20 4d61 7070 696e 675b 416e  xers: Mapping[An
-00016340: 792c 2041 6e79 5d20 7c20 4e6f 6e65 203d  y, Any] | None =
-00016350: 204e 6f6e 652c 0a20 2020 2020 2020 206d   None,.        m
-00016360: 6574 686f 643a 2073 7472 207c 204e 6f6e  ethod: str | Non
-00016370: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00016380: 2020 746f 6c65 7261 6e63 653a 2069 6e74    tolerance: int
-00016390: 207c 2066 6c6f 6174 207c 2049 7465 7261   | float | Itera
-000163a0: 626c 655b 696e 7420 7c20 666c 6f61 745d  ble[int | float]
-000163b0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-000163c0: 2020 2020 2020 2020 6472 6f70 3a20 626f          drop: bo
-000163d0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-000163e0: 2020 2020 2a2a 696e 6465 7865 7273 5f6b      **indexers_k
-000163f0: 7761 7267 733a 2041 6e79 2c0a 2020 2020  wargs: Any,.    
-00016400: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-00016410: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00016420: 6e73 2061 206e 6577 2064 6174 6173 6574  ns a new dataset
-00016430: 2077 6974 6820 6561 6368 2061 7272 6179   with each array
-00016440: 2069 6e64 6578 6564 2062 7920 7469 636b   indexed by tick
-00016450: 206c 6162 656c 730a 2020 2020 2020 2020   labels.        
-00016460: 616c 6f6e 6720 7468 6520 7370 6563 6966  along the specif
-00016470: 6965 6420 6469 6d65 6e73 696f 6e28 7329  ied dimension(s)
-00016480: 2e0a 0a20 2020 2020 2020 2049 6e20 636f  ...        In co
-00016490: 6e74 7261 7374 2074 6f20 6044 6174 6173  ntrast to `Datas
-000164a0: 6574 2e69 7365 6c60 2c20 696e 6465 7865  et.isel`, indexe
-000164b0: 7273 2066 6f72 2074 6869 7320 6d65 7468  rs for this meth
-000164c0: 6f64 2073 686f 756c 6420 7573 650a 2020  od should use.  
-000164d0: 2020 2020 2020 6c61 6265 6c73 2069 6e73        labels ins
-000164e0: 7465 6164 206f 6620 696e 7465 6765 7273  tead of integers
-000164f0: 2e0a 0a20 2020 2020 2020 2055 6e64 6572  ...        Under
-00016500: 2074 6865 2068 6f6f 642c 2074 6869 7320   the hood, this 
-00016510: 6d65 7468 6f64 2069 7320 706f 7765 7265  method is powere
-00016520: 6420 6279 2075 7369 6e67 2070 616e 6461  d by using panda
-00016530: 7327 7320 706f 7765 7266 756c 2049 6e64  s's powerful Ind
-00016540: 6578 0a20 2020 2020 2020 206f 626a 6563  ex.        objec
-00016550: 7473 2e20 5468 6973 206d 616b 6573 206c  ts. This makes l
-00016560: 6162 656c 2062 6173 6564 2069 6e64 6578  abel based index
-00016570: 696e 6720 6573 7365 6e74 6961 6c6c 7920  ing essentially 
-00016580: 6a75 7374 2061 7320 6661 7374 2061 730a  just as fast as.
-00016590: 2020 2020 2020 2020 7573 696e 6720 696e          using in
-000165a0: 7465 6765 7220 696e 6465 7869 6e67 2e0a  teger indexing..
-000165b0: 0a20 2020 2020 2020 2049 7420 616c 736f  .        It also
-000165c0: 206d 6561 6e73 2074 6869 7320 6d65 7468   means this meth
-000165d0: 6f64 2075 7365 7320 7061 6e64 6173 2773  od uses pandas's
-000165e0: 2028 7765 6c6c 2064 6f63 756d 656e 7465   (well documente
-000165f0: 6429 206c 6f67 6963 2066 6f72 0a20 2020  d) logic for.   
-00016600: 2020 2020 2069 6e64 6578 696e 672e 2054       indexing. T
-00016610: 6869 7320 6d65 616e 7320 796f 7520 6361  his means you ca
-00016620: 6e20 7573 6520 7374 7269 6e67 2073 686f  n use string sho
-00016630: 7274 6375 7473 2066 6f72 2064 6174 6574  rtcuts for datet
-00016640: 696d 6520 696e 6465 7865 730a 2020 2020  ime indexes.    
-00016650: 2020 2020 2865 2e67 2e2c 2027 3230 3030      (e.g., '2000
-00016660: 2d30 3127 2074 6f20 7365 6c65 6374 2061  -01' to select a
-00016670: 6c6c 2076 616c 7565 7320 696e 204a 616e  ll values in Jan
-00016680: 7561 7279 2032 3030 3029 2e20 4974 2061  uary 2000). It a
-00016690: 6c73 6f20 6d65 616e 730a 2020 2020 2020  lso means.      
-000166a0: 2020 7468 6174 2073 6c69 6365 7320 6172    that slices ar
-000166b0: 6520 7472 6561 7465 6420 6173 2069 6e63  e treated as inc
-000166c0: 6c75 7369 7665 206f 6620 626f 7468 2074  lusive of both t
-000166d0: 6865 2073 7461 7274 2061 6e64 2073 746f  he start and sto
-000166e0: 7020 7661 6c75 6573 2c0a 2020 2020 2020  p values,.      
-000166f0: 2020 756e 6c69 6b65 206e 6f72 6d61 6c20    unlike normal 
-00016700: 5079 7468 6f6e 2069 6e64 6578 696e 672e  Python indexing.
-00016710: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00016720: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-00016730: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00016740: 696e 6465 7865 7273 203a 2064 6963 742c  indexers : dict,
-00016750: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00016760: 2020 2020 2020 4120 6469 6374 2077 6974        A dict wit
-00016770: 6820 6b65 7973 206d 6174 6368 696e 6720  h keys matching 
-00016780: 6469 6d65 6e73 696f 6e73 2061 6e64 2076  dimensions and v
-00016790: 616c 7565 7320 6769 7665 6e0a 2020 2020  alues given.    
-000167a0: 2020 2020 2020 2020 6279 2073 6361 6c61          by scala
-000167b0: 7273 2c20 736c 6963 6573 206f 7220 6172  rs, slices or ar
-000167c0: 7261 7973 206f 6620 7469 636b 206c 6162  rays of tick lab
-000167d0: 656c 732e 2046 6f72 2064 696d 656e 7369  els. For dimensi
-000167e0: 6f6e 7320 7769 7468 0a20 2020 2020 2020  ons with.       
-000167f0: 2020 2020 206d 756c 7469 2d69 6e64 6578       multi-index
-00016800: 2c20 7468 6520 696e 6465 7865 7220 6d61  , the indexer ma
-00016810: 7920 616c 736f 2062 6520 6120 6469 6374  y also be a dict
-00016820: 2d6c 696b 6520 6f62 6a65 6374 2077 6974  -like object wit
-00016830: 6820 6b65 7973 0a20 2020 2020 2020 2020  h keys.         
-00016840: 2020 206d 6174 6368 696e 6720 696e 6465     matching inde
-00016850: 7820 6c65 7665 6c20 6e61 6d65 732e 0a20  x level names.. 
-00016860: 2020 2020 2020 2020 2020 2049 6620 4461             If Da
-00016870: 7461 4172 7261 7973 2061 7265 2070 6173  taArrays are pas
-00016880: 7365 6420 6173 2069 6e64 6578 6572 732c  sed as indexers,
-00016890: 2078 6172 7261 792d 7374 796c 6520 696e   xarray-style in
-000168a0: 6465 7869 6e67 2077 696c 6c20 6265 0a20  dexing will be. 
-000168b0: 2020 2020 2020 2020 2020 2063 6172 7269             carri
-000168c0: 6564 206f 7574 2e20 5365 6520 3a72 6566  ed out. See :ref
-000168d0: 3a60 696e 6465 7869 6e67 6020 666f 7220  :`indexing` for 
-000168e0: 7468 6520 6465 7461 696c 732e 0a20 2020  the details..   
-000168f0: 2020 2020 2020 2020 204f 6e65 206f 6620           One of 
-00016900: 696e 6465 7865 7273 206f 7220 696e 6465  indexers or inde
-00016910: 7865 7273 5f6b 7761 7267 7320 6d75 7374  xers_kwargs must
-00016920: 2062 6520 7072 6f76 6964 6564 2e0a 2020   be provided..  
-00016930: 2020 2020 2020 6d65 7468 6f64 203a 207b        method : {
-00016940: 4e6f 6e65 2c20 226e 6561 7265 7374 222c  None, "nearest",
-00016950: 2022 7061 6422 2c20 2266 6669 6c6c 222c   "pad", "ffill",
-00016960: 2022 6261 636b 6669 6c6c 222c 2022 6266   "backfill", "bf
-00016970: 696c 6c22 7d2c 206f 7074 696f 6e61 6c0a  ill"}, optional.
-00016980: 2020 2020 2020 2020 2020 2020 4d65 7468              Meth
-00016990: 6f64 2074 6f20 7573 6520 666f 7220 696e  od to use for in
-000169a0: 6578 6163 7420 6d61 7463 6865 733a 0a0a  exact matches:..
-000169b0: 2020 2020 2020 2020 2020 2020 2a20 4e6f              * No
-000169c0: 6e65 2028 6465 6661 756c 7429 3a20 6f6e  ne (default): on
-000169d0: 6c79 2065 7861 6374 206d 6174 6368 6573  ly exact matches
-000169e0: 0a20 2020 2020 2020 2020 2020 202a 2070  .            * p
-000169f0: 6164 202f 2066 6669 6c6c 3a20 7072 6f70  ad / ffill: prop
-00016a00: 6167 6174 6520 6c61 7374 2076 616c 6964  agate last valid
-00016a10: 2069 6e64 6578 2076 616c 7565 2066 6f72   index value for
-00016a20: 7761 7264 0a20 2020 2020 2020 2020 2020  ward.           
-00016a30: 202a 2062 6163 6b66 696c 6c20 2f20 6266   * backfill / bf
-00016a40: 696c 6c3a 2070 726f 7061 6761 7465 206e  ill: propagate n
-00016a50: 6578 7420 7661 6c69 6420 696e 6465 7820  ext valid index 
-00016a60: 7661 6c75 6520 6261 636b 7761 7264 0a20  value backward. 
-00016a70: 2020 2020 2020 2020 2020 202a 206e 6561             * nea
-00016a80: 7265 7374 3a20 7573 6520 6e65 6172 6573  rest: use neares
-00016a90: 7420 7661 6c69 6420 696e 6465 7820 7661  t valid index va
-00016aa0: 6c75 650a 2020 2020 2020 2020 746f 6c65  lue.        tole
-00016ab0: 7261 6e63 6520 3a20 6f70 7469 6f6e 616c  rance : optional
-00016ac0: 0a20 2020 2020 2020 2020 2020 204d 6178  .            Max
-00016ad0: 696d 756d 2064 6973 7461 6e63 6520 6265  imum distance be
-00016ae0: 7477 6565 6e20 6f72 6967 696e 616c 2061  tween original a
-00016af0: 6e64 206e 6577 206c 6162 656c 7320 666f  nd new labels fo
-00016b00: 7220 696e 6578 6163 740a 2020 2020 2020  r inexact.      
-00016b10: 2020 2020 2020 6d61 7463 6865 732e 2054        matches. T
-00016b20: 6865 2076 616c 7565 7320 6f66 2074 6865  he values of the
-00016b30: 2069 6e64 6578 2061 7420 7468 6520 6d61   index at the ma
-00016b40: 7463 6869 6e67 206c 6f63 6174 696f 6e73  tching locations
-00016b50: 206d 7573 740a 2020 2020 2020 2020 2020   must.          
-00016b60: 2020 7361 7469 7366 7920 7468 6520 6571    satisfy the eq
-00016b70: 7561 7469 6f6e 2060 6061 6273 2869 6e64  uation ``abs(ind
-00016b80: 6578 5b69 6e64 6578 6572 5d20 2d20 7461  ex[indexer] - ta
-00016b90: 7267 6574 2920 3c3d 2074 6f6c 6572 616e  rget) <= toleran
-00016ba0: 6365 6060 2e0a 2020 2020 2020 2020 6472  ce``..        dr
-00016bb0: 6f70 203a 2062 6f6f 6c2c 206f 7074 696f  op : bool, optio
-00016bc0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00016bd0: 4966 2060 6064 726f 703d 5472 7565 6060  If ``drop=True``
-00016be0: 2c20 6472 6f70 2063 6f6f 7264 696e 6174  , drop coordinat
-00016bf0: 6573 2076 6172 6961 626c 6573 2069 6e20  es variables in 
-00016c00: 6069 6e64 6578 6572 7360 2069 6e73 7465  `indexers` inste
-00016c10: 6164 0a20 2020 2020 2020 2020 2020 206f  ad.            o
-00016c20: 6620 6d61 6b69 6e67 2074 6865 6d20 7363  f making them sc
-00016c30: 616c 6172 2e0a 2020 2020 2020 2020 2a2a  alar..        **
-00016c40: 696e 6465 7865 7273 5f6b 7761 7267 7320  indexers_kwargs 
-00016c50: 3a20 7b64 696d 3a20 696e 6465 7865 722c  : {dim: indexer,
-00016c60: 202e 2e2e 7d2c 206f 7074 696f 6e61 6c0a   ...}, optional.
-00016c70: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-00016c80: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-00016c90: 7320 666f 726d 206f 6620 6060 696e 6465  s form of ``inde
-00016ca0: 7865 7273 6060 2e0a 2020 2020 2020 2020  xers``..        
-00016cb0: 2020 2020 4f6e 6520 6f66 2069 6e64 6578      One of index
-00016cc0: 6572 7320 6f72 2069 6e64 6578 6572 735f  ers or indexers_
-00016cd0: 6b77 6172 6773 206d 7573 7420 6265 2070  kwargs must be p
-00016ce0: 726f 7669 6465 642e 0a0a 2020 2020 2020  rovided...      
-00016cf0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00016d00: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00016d10: 2020 6f62 6a20 3a20 4461 7461 7365 740a    obj : Dataset.
-00016d20: 2020 2020 2020 2020 2020 2020 4120 6e65              A ne
-00016d30: 7720 4461 7461 7365 7420 7769 7468 2074  w Dataset with t
-00016d40: 6865 2073 616d 6520 636f 6e74 656e 7473  he same contents
-00016d50: 2061 7320 7468 6973 2064 6174 6173 6574   as this dataset
-00016d60: 2c20 6578 6365 7074 2065 6163 680a 2020  , except each.  
-00016d70: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-00016d80: 6c65 2061 6e64 2064 696d 656e 7369 6f6e  le and dimension
-00016d90: 2069 7320 696e 6465 7865 6420 6279 2074   is indexed by t
-00016da0: 6865 2061 7070 726f 7072 6961 7465 2069  he appropriate i
-00016db0: 6e64 6578 6572 732e 0a20 2020 2020 2020  ndexers..       
-00016dc0: 2020 2020 2049 6620 696e 6465 7865 7220       If indexer 
-00016dd0: 4461 7461 4172 7261 7973 2068 6176 6520  DataArrays have 
-00016de0: 636f 6f72 6469 6e61 7465 7320 7468 6174  coordinates that
-00016df0: 2064 6f20 6e6f 7420 636f 6e66 6c69 6374   do not conflict
-00016e00: 2077 6974 680a 2020 2020 2020 2020 2020   with.          
-00016e10: 2020 7468 6973 206f 626a 6563 742c 2074    this object, t
-00016e20: 6865 6e20 7468 6573 6520 636f 6f72 6469  hen these coordi
-00016e30: 6e61 7465 7320 7769 6c6c 2062 6520 6174  nates will be at
-00016e40: 7461 6368 6564 2e0a 2020 2020 2020 2020  tached..        
-00016e50: 2020 2020 496e 2067 656e 6572 616c 2c20      In general, 
-00016e60: 6561 6368 2061 7272 6179 2773 2064 6174  each array's dat
-00016e70: 6120 7769 6c6c 2062 6520 6120 7669 6577  a will be a view
-00016e80: 206f 6620 7468 6520 6172 7261 7927 7320   of the array's 
-00016e90: 6461 7461 0a20 2020 2020 2020 2020 2020  data.           
-00016ea0: 2069 6e20 7468 6973 2064 6174 6173 6574   in this dataset
-00016eb0: 2c20 756e 6c65 7373 2076 6563 746f 7269  , unless vectori
-00016ec0: 7a65 6420 696e 6465 7869 6e67 2077 6173  zed indexing was
-00016ed0: 2074 7269 6767 6572 6564 2062 7920 7573   triggered by us
-00016ee0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-00016ef0: 616e 2061 7272 6179 2069 6e64 6578 6572  an array indexer
-00016f00: 2c20 696e 2077 6869 6368 2063 6173 6520  , in which case 
-00016f10: 7468 6520 6461 7461 2077 696c 6c20 6265  the data will be
-00016f20: 2061 2063 6f70 792e 0a0a 2020 2020 2020   a copy...      
-00016f30: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
-00016f40: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-00016f50: 2020 2020 4461 7461 7365 742e 6973 656c      Dataset.isel
-00016f60: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
-00016f70: 6179 2e73 656c 0a20 2020 2020 2020 2022  ay.sel.        "
-00016f80: 2222 0a20 2020 2020 2020 2069 6e64 6578  "".        index
-00016f90: 6572 7320 3d20 6569 7468 6572 5f64 6963  ers = either_dic
-00016fa0: 745f 6f72 5f6b 7761 7267 7328 696e 6465  t_or_kwargs(inde
-00016fb0: 7865 7273 2c20 696e 6465 7865 7273 5f6b  xers, indexers_k
-00016fc0: 7761 7267 732c 2022 7365 6c22 290a 2020  wargs, "sel").  
-00016fd0: 2020 2020 2020 7175 6572 795f 7265 7375        query_resu
-00016fe0: 6c74 7320 3d20 6d61 705f 696e 6465 785f  lts = map_index_
-00016ff0: 7175 6572 6965 7328 0a20 2020 2020 2020  queries(.       
-00017000: 2020 2020 2073 656c 662c 2069 6e64 6578       self, index
-00017010: 6572 733d 696e 6465 7865 7273 2c20 6d65  ers=indexers, me
-00017020: 7468 6f64 3d6d 6574 686f 642c 2074 6f6c  thod=method, tol
-00017030: 6572 616e 6365 3d74 6f6c 6572 616e 6365  erance=tolerance
-00017040: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00017050: 2020 2020 6966 2064 726f 703a 0a20 2020      if drop:.   
-00017060: 2020 2020 2020 2020 206e 6f5f 7363 616c           no_scal
-00017070: 6172 5f76 6172 6961 626c 6573 203d 207b  ar_variables = {
-00017080: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
-00017090: 7220 6b2c 2076 2069 6e20 7175 6572 795f  r k, v in query_
-000170a0: 7265 7375 6c74 732e 7661 7269 6162 6c65  results.variable
-000170b0: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
-000170c0: 2020 2020 2020 2020 2020 2069 6620 762e             if v.
-000170d0: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
-000170e0: 2020 2020 2020 2020 2020 6e6f 5f73 6361            no_sca
-000170f0: 6c61 725f 7661 7269 6162 6c65 735b 6b5d  lar_variables[k]
-00017100: 203d 2076 0a20 2020 2020 2020 2020 2020   = v.           
-00017110: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00017120: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017130: 6620 6b20 696e 2073 656c 662e 5f63 6f6f  f k in self._coo
-00017140: 7264 5f6e 616d 6573 3a0a 2020 2020 2020  rd_names:.      
-00017150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017160: 2020 7175 6572 795f 7265 7375 6c74 732e    query_results.
-00017170: 6472 6f70 5f63 6f6f 7264 732e 6170 7065  drop_coords.appe
-00017180: 6e64 286b 290a 2020 2020 2020 2020 2020  nd(k).          
-00017190: 2020 7175 6572 795f 7265 7375 6c74 732e    query_results.
-000171a0: 7661 7269 6162 6c65 7320 3d20 6e6f 5f73  variables = no_s
-000171b0: 6361 6c61 725f 7661 7269 6162 6c65 730a  calar_variables.
-000171c0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-000171d0: 3d20 7365 6c66 2e69 7365 6c28 696e 6465  = self.isel(inde
-000171e0: 7865 7273 3d71 7565 7279 5f72 6573 756c  xers=query_resul
-000171f0: 7473 2e64 696d 5f69 6e64 6578 6572 732c  ts.dim_indexers,
-00017200: 2064 726f 703d 6472 6f70 290a 2020 2020   drop=drop).    
-00017210: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-00017220: 742e 5f6f 7665 7277 7269 7465 5f69 6e64  t._overwrite_ind
-00017230: 6578 6573 282a 7175 6572 795f 7265 7375  exes(*query_resu
-00017240: 6c74 732e 6173 5f74 7570 6c65 2829 5b31  lts.as_tuple()[1
-00017250: 3a5d 290a 0a20 2020 2064 6566 2068 6561  :])..    def hea
-00017260: 6428 0a20 2020 2020 2020 2073 656c 663a  d(.        self:
-00017270: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
-00017280: 2020 2020 696e 6465 7865 7273 3a20 4d61      indexers: Ma
-00017290: 7070 696e 675b 416e 792c 2069 6e74 5d20  pping[Any, int] 
-000172a0: 7c20 696e 7420 7c20 4e6f 6e65 203d 204e  | int | None = N
-000172b0: 6f6e 652c 0a20 2020 2020 2020 202a 2a69  one,.        **i
-000172c0: 6e64 6578 6572 735f 6b77 6172 6773 3a20  ndexers_kwargs: 
-000172d0: 416e 792c 0a20 2020 2029 202d 3e20 545f  Any,.    ) -> T_
-000172e0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-000172f0: 2022 2222 5265 7475 726e 7320 6120 6e65   """Returns a ne
-00017300: 7720 6461 7461 7365 7420 7769 7468 2074  w dataset with t
-00017310: 6865 2066 6972 7374 2060 6e60 2076 616c  he first `n` val
-00017320: 7565 7320 6f66 2065 6163 6820 6172 7261  ues of each arra
-00017330: 790a 2020 2020 2020 2020 666f 7220 7468  y.        for th
-00017340: 6520 7370 6563 6966 6965 6420 6469 6d65  e specified dime
-00017350: 6e73 696f 6e28 7329 2e0a 0a20 2020 2020  nsion(s)...     
-00017360: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00017370: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00017380: 0a20 2020 2020 2020 2069 6e64 6578 6572  .        indexer
-00017390: 7320 3a20 6469 6374 206f 7220 696e 742c  s : dict or int,
-000173a0: 2064 6566 6175 6c74 3a20 350a 2020 2020   default: 5.    
-000173b0: 2020 2020 2020 2020 4120 6469 6374 2077          A dict w
-000173c0: 6974 6820 6b65 7973 206d 6174 6368 696e  ith keys matchin
-000173d0: 6720 6469 6d65 6e73 696f 6e73 2061 6e64  g dimensions and
-000173e0: 2069 6e74 6567 6572 2076 616c 7565 7320   integer values 
-000173f0: 606e 600a 2020 2020 2020 2020 2020 2020  `n`.            
-00017400: 6f72 2061 2073 696e 676c 6520 696e 7465  or a single inte
-00017410: 6765 7220 606e 6020 6170 706c 6965 6420  ger `n` applied 
-00017420: 6f76 6572 2061 6c6c 2064 696d 656e 7369  over all dimensi
-00017430: 6f6e 732e 0a20 2020 2020 2020 2020 2020  ons..           
-00017440: 204f 6e65 206f 6620 696e 6465 7865 7273   One of indexers
-00017450: 206f 7220 696e 6465 7865 7273 5f6b 7761   or indexers_kwa
-00017460: 7267 7320 6d75 7374 2062 6520 7072 6f76  rgs must be prov
-00017470: 6964 6564 2e0a 2020 2020 2020 2020 2a2a  ided..        **
-00017480: 696e 6465 7865 7273 5f6b 7761 7267 7320  indexers_kwargs 
-00017490: 3a20 7b64 696d 3a20 6e2c 202e 2e2e 7d2c  : {dim: n, ...},
-000174a0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-000174b0: 2020 2020 2020 5468 6520 6b65 7977 6f72        The keywor
-000174c0: 6420 6172 6775 6d65 6e74 7320 666f 726d  d arguments form
-000174d0: 206f 6620 6060 696e 6465 7865 7273 6060   of ``indexers``
-000174e0: 2e0a 2020 2020 2020 2020 2020 2020 4f6e  ..            On
-000174f0: 6520 6f66 2069 6e64 6578 6572 7320 6f72  e of indexers or
-00017500: 2069 6e64 6578 6572 735f 6b77 6172 6773   indexers_kwargs
-00017510: 206d 7573 7420 6265 2070 726f 7669 6465   must be provide
-00017520: 642e 0a0a 2020 2020 2020 2020 5365 6520  d...        See 
-00017530: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
-00017540: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
-00017550: 7461 7365 742e 7461 696c 0a20 2020 2020  taset.tail.     
-00017560: 2020 2044 6174 6173 6574 2e74 6869 6e0a     Dataset.thin.
-00017570: 2020 2020 2020 2020 4461 7461 4172 7261          DataArra
-00017580: 792e 6865 6164 0a20 2020 2020 2020 2022  y.head.        "
-00017590: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-000175a0: 7420 696e 6465 7865 7273 5f6b 7761 7267  t indexers_kwarg
-000175b0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-000175c0: 6620 696e 6465 7865 7273 2069 7320 4e6f  f indexers is No
-000175d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000175e0: 2020 2020 696e 6465 7865 7273 203d 2035      indexers = 5
-000175f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00017600: 6e6f 7420 6973 696e 7374 616e 6365 2869  not isinstance(i
-00017610: 6e64 6578 6572 732c 2069 6e74 2920 616e  ndexers, int) an
-00017620: 6420 6e6f 7420 6973 5f64 6963 745f 6c69  d not is_dict_li
-00017630: 6b65 2869 6e64 6578 6572 7329 3a0a 2020  ke(indexers):.  
-00017640: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00017650: 6973 6520 5479 7065 4572 726f 7228 2269  ise TypeError("i
-00017660: 6e64 6578 6572 7320 6d75 7374 2062 6520  ndexers must be 
-00017670: 6569 7468 6572 2064 6963 742d 6c69 6b65  either dict-like
-00017680: 206f 7220 6120 7369 6e67 6c65 2069 6e74   or a single int
-00017690: 6567 6572 2229 0a20 2020 2020 2020 2069  eger").        i
-000176a0: 6620 6973 696e 7374 616e 6365 2869 6e64  f isinstance(ind
-000176b0: 6578 6572 732c 2069 6e74 293a 0a20 2020  exers, int):.   
-000176c0: 2020 2020 2020 2020 2069 6e64 6578 6572           indexer
-000176d0: 7320 3d20 7b64 696d 3a20 696e 6465 7865  s = {dim: indexe
-000176e0: 7273 2066 6f72 2064 696d 2069 6e20 7365  rs for dim in se
-000176f0: 6c66 2e64 696d 737d 0a20 2020 2020 2020  lf.dims}.       
-00017700: 2069 6e64 6578 6572 7320 3d20 6569 7468   indexers = eith
-00017710: 6572 5f64 6963 745f 6f72 5f6b 7761 7267  er_dict_or_kwarg
-00017720: 7328 696e 6465 7865 7273 2c20 696e 6465  s(indexers, inde
-00017730: 7865 7273 5f6b 7761 7267 732c 2022 6865  xers_kwargs, "he
-00017740: 6164 2229 0a20 2020 2020 2020 2066 6f72  ad").        for
-00017750: 206b 2c20 7620 696e 2069 6e64 6578 6572   k, v in indexer
-00017760: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
-00017770: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00017780: 696e 7374 616e 6365 2876 2c20 696e 7429  instance(v, int)
-00017790: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000177a0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-000177b0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-000177c0: 2020 2020 2020 2022 6578 7065 6374 6564         "expected
-000177d0: 2069 6e74 6567 6572 2074 7970 6520 696e   integer type in
-000177e0: 6465 7865 7220 666f 7220 220a 2020 2020  dexer for ".    
-000177f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017800: 6622 6469 6d65 6e73 696f 6e20 7b6b 2172  f"dimension {k!r
-00017810: 7d2c 2066 6f75 6e64 207b 7479 7065 2876  }, found {type(v
-00017820: 2921 727d 220a 2020 2020 2020 2020 2020  )!r}".          
-00017830: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00017840: 2020 2020 656c 6966 2076 203c 2030 3a0a      elif v < 0:.
-00017850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017860: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00017870: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00017880: 2020 2020 2020 2265 7870 6563 7465 6420        "expected 
-00017890: 706f 7369 7469 7665 2069 6e74 6567 6572  positive integer
-000178a0: 2061 7320 696e 6465 7865 7220 220a 2020   as indexer ".  
-000178b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178c0: 2020 6622 666f 7220 6469 6d65 6e73 696f    f"for dimensio
-000178d0: 6e20 7b6b 2172 7d2c 2066 6f75 6e64 207b  n {k!r}, found {
-000178e0: 767d 220a 2020 2020 2020 2020 2020 2020  v}".            
-000178f0: 2020 2020 290a 2020 2020 2020 2020 696e      ).        in
-00017900: 6465 7865 7273 5f73 6c69 6365 7320 3d20  dexers_slices = 
-00017910: 7b6b 3a20 736c 6963 6528 7661 6c29 2066  {k: slice(val) f
-00017920: 6f72 206b 2c20 7661 6c20 696e 2069 6e64  or k, val in ind
-00017930: 6578 6572 732e 6974 656d 7328 297d 0a20  exers.items()}. 
-00017940: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00017950: 6c66 2e69 7365 6c28 696e 6465 7865 7273  lf.isel(indexers
-00017960: 5f73 6c69 6365 7329 0a0a 2020 2020 6465  _slices)..    de
-00017970: 6620 7461 696c 280a 2020 2020 2020 2020  f tail(.        
-00017980: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-00017990: 0a20 2020 2020 2020 2069 6e64 6578 6572  .        indexer
-000179a0: 733a 204d 6170 7069 6e67 5b41 6e79 2c20  s: Mapping[Any, 
-000179b0: 696e 745d 207c 2069 6e74 207c 204e 6f6e  int] | int | Non
-000179c0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-000179d0: 2020 2a2a 696e 6465 7865 7273 5f6b 7761    **indexers_kwa
-000179e0: 7267 733a 2041 6e79 2c0a 2020 2020 2920  rgs: Any,.    ) 
-000179f0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
-00017a00: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-00017a10: 2061 206e 6577 2064 6174 6173 6574 2077   a new dataset w
-00017a20: 6974 6820 7468 6520 6c61 7374 2060 6e60  ith the last `n`
-00017a30: 2076 616c 7565 7320 6f66 2065 6163 6820   values of each 
-00017a40: 6172 7261 790a 2020 2020 2020 2020 666f  array.        fo
-00017a50: 7220 7468 6520 7370 6563 6966 6965 6420  r the specified 
-00017a60: 6469 6d65 6e73 696f 6e28 7329 2e0a 0a20  dimension(s)... 
-00017a70: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00017a80: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00017a90: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e64  ----.        ind
-00017aa0: 6578 6572 7320 3a20 6469 6374 206f 7220  exers : dict or 
-00017ab0: 696e 742c 2064 6566 6175 6c74 3a20 350a  int, default: 5.
-00017ac0: 2020 2020 2020 2020 2020 2020 4120 6469              A di
-00017ad0: 6374 2077 6974 6820 6b65 7973 206d 6174  ct with keys mat
-00017ae0: 6368 696e 6720 6469 6d65 6e73 696f 6e73  ching dimensions
-00017af0: 2061 6e64 2069 6e74 6567 6572 2076 616c   and integer val
-00017b00: 7565 7320 606e 600a 2020 2020 2020 2020  ues `n`.        
-00017b10: 2020 2020 6f72 2061 2073 696e 676c 6520      or a single 
-00017b20: 696e 7465 6765 7220 606e 6020 6170 706c  integer `n` appl
-00017b30: 6965 6420 6f76 6572 2061 6c6c 2064 696d  ied over all dim
-00017b40: 656e 7369 6f6e 732e 0a20 2020 2020 2020  ensions..       
-00017b50: 2020 2020 204f 6e65 206f 6620 696e 6465       One of inde
-00017b60: 7865 7273 206f 7220 696e 6465 7865 7273  xers or indexers
-00017b70: 5f6b 7761 7267 7320 6d75 7374 2062 6520  _kwargs must be 
-00017b80: 7072 6f76 6964 6564 2e0a 2020 2020 2020  provided..      
-00017b90: 2020 2a2a 696e 6465 7865 7273 5f6b 7761    **indexers_kwa
-00017ba0: 7267 7320 3a20 7b64 696d 3a20 6e2c 202e  rgs : {dim: n, .
-00017bb0: 2e2e 7d2c 206f 7074 696f 6e61 6c0a 2020  ..}, optional.  
-00017bc0: 2020 2020 2020 2020 2020 5468 6520 6b65            The ke
-00017bd0: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
-00017be0: 666f 726d 206f 6620 6060 696e 6465 7865  form of ``indexe
-00017bf0: 7273 6060 2e0a 2020 2020 2020 2020 2020  rs``..          
-00017c00: 2020 4f6e 6520 6f66 2069 6e64 6578 6572    One of indexer
-00017c10: 7320 6f72 2069 6e64 6578 6572 735f 6b77  s or indexers_kw
-00017c20: 6172 6773 206d 7573 7420 6265 2070 726f  args must be pro
-00017c30: 7669 6465 642e 0a0a 2020 2020 2020 2020  vided...        
-00017c40: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-00017c50: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00017c60: 2020 4461 7461 7365 742e 6865 6164 0a20    Dataset.head. 
-00017c70: 2020 2020 2020 2044 6174 6173 6574 2e74         Dataset.t
-00017c80: 6869 6e0a 2020 2020 2020 2020 4461 7461  hin.        Data
-00017c90: 4172 7261 792e 7461 696c 0a20 2020 2020  Array.tail.     
-00017ca0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00017cb0: 6620 6e6f 7420 696e 6465 7865 7273 5f6b  f not indexers_k
-00017cc0: 7761 7267 733a 0a20 2020 2020 2020 2020  wargs:.         
-00017cd0: 2020 2069 6620 696e 6465 7865 7273 2069     if indexers i
-00017ce0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00017cf0: 2020 2020 2020 2020 696e 6465 7865 7273          indexers
-00017d00: 203d 2035 0a20 2020 2020 2020 2020 2020   = 5.           
-00017d10: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-00017d20: 6365 2869 6e64 6578 6572 732c 2069 6e74  ce(indexers, int
-00017d30: 2920 616e 6420 6e6f 7420 6973 5f64 6963  ) and not is_dic
-00017d40: 745f 6c69 6b65 2869 6e64 6578 6572 7329  t_like(indexers)
-00017d50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017d60: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-00017d70: 7228 2269 6e64 6578 6572 7320 6d75 7374  r("indexers must
-00017d80: 2062 6520 6569 7468 6572 2064 6963 742d   be either dict-
-00017d90: 6c69 6b65 206f 7220 6120 7369 6e67 6c65  like or a single
-00017da0: 2069 6e74 6567 6572 2229 0a20 2020 2020   integer").     
-00017db0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00017dc0: 2869 6e64 6578 6572 732c 2069 6e74 293a  (indexers, int):
-00017dd0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-00017de0: 6578 6572 7320 3d20 7b64 696d 3a20 696e  exers = {dim: in
-00017df0: 6465 7865 7273 2066 6f72 2064 696d 2069  dexers for dim i
-00017e00: 6e20 7365 6c66 2e64 696d 737d 0a20 2020  n self.dims}.   
-00017e10: 2020 2020 2069 6e64 6578 6572 7320 3d20       indexers = 
-00017e20: 6569 7468 6572 5f64 6963 745f 6f72 5f6b  either_dict_or_k
-00017e30: 7761 7267 7328 696e 6465 7865 7273 2c20  wargs(indexers, 
-00017e40: 696e 6465 7865 7273 5f6b 7761 7267 732c  indexers_kwargs,
-00017e50: 2022 7461 696c 2229 0a20 2020 2020 2020   "tail").       
-00017e60: 2066 6f72 206b 2c20 7620 696e 2069 6e64   for k, v in ind
-00017e70: 6578 6572 732e 6974 656d 7328 293a 0a20  exers.items():. 
-00017e80: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00017e90: 7420 6973 696e 7374 616e 6365 2876 2c20  t isinstance(v, 
-00017ea0: 696e 7429 3a0a 2020 2020 2020 2020 2020  int):.          
-00017eb0: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-00017ec0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00017ed0: 2020 2020 2020 2020 2020 2022 6578 7065             "expe
-00017ee0: 6374 6564 2069 6e74 6567 6572 2074 7970  cted integer typ
-00017ef0: 6520 696e 6465 7865 7220 666f 7220 220a  e indexer for ".
-00017f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f10: 2020 2020 6622 6469 6d65 6e73 696f 6e20      f"dimension 
-00017f20: 7b6b 2172 7d2c 2066 6f75 6e64 207b 7479  {k!r}, found {ty
-00017f30: 7065 2876 2921 727d 220a 2020 2020 2020  pe(v)!r}".      
-00017f40: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00017f50: 2020 2020 2020 2020 656c 6966 2076 203c          elif v <
-00017f60: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00017f70: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00017f80: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00017f90: 2020 2020 2020 2020 2020 2265 7870 6563            "expec
-00017fa0: 7465 6420 706f 7369 7469 7665 2069 6e74  ted positive int
-00017fb0: 6567 6572 2061 7320 696e 6465 7865 7220  eger as indexer 
-00017fc0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00017fd0: 2020 2020 2020 6622 666f 7220 6469 6d65        f"for dime
-00017fe0: 6e73 696f 6e20 7b6b 2172 7d2c 2066 6f75  nsion {k!r}, fou
-00017ff0: 6e64 207b 767d 220a 2020 2020 2020 2020  nd {v}".        
-00018000: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00018010: 2020 696e 6465 7865 7273 5f73 6c69 6365    indexers_slice
-00018020: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-00018030: 2020 6b3a 2073 6c69 6365 282d 7661 6c2c    k: slice(-val,
-00018040: 204e 6f6e 6529 2069 6620 7661 6c20 213d   None) if val !=
-00018050: 2030 2065 6c73 6520 736c 6963 6528 7661   0 else slice(va
-00018060: 6c29 0a20 2020 2020 2020 2020 2020 2066  l).            f
-00018070: 6f72 206b 2c20 7661 6c20 696e 2069 6e64  or k, val in ind
-00018080: 6578 6572 732e 6974 656d 7328 290a 2020  exers.items().  
-00018090: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-000180a0: 7265 7475 726e 2073 656c 662e 6973 656c  return self.isel
-000180b0: 2869 6e64 6578 6572 735f 736c 6963 6573  (indexers_slices
-000180c0: 290a 0a20 2020 2064 6566 2074 6869 6e28  )..    def thin(
-000180d0: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
-000180e0: 5f44 6174 6173 6574 2c0a 2020 2020 2020  _Dataset,.      
-000180f0: 2020 696e 6465 7865 7273 3a20 4d61 7070    indexers: Mapp
-00018100: 696e 675b 416e 792c 2069 6e74 5d20 7c20  ing[Any, int] | 
-00018110: 696e 7420 7c20 4e6f 6e65 203d 204e 6f6e  int | None = Non
-00018120: 652c 0a20 2020 2020 2020 202a 2a69 6e64  e,.        **ind
-00018130: 6578 6572 735f 6b77 6172 6773 3a20 416e  exers_kwargs: An
-00018140: 792c 0a20 2020 2029 202d 3e20 545f 4461  y,.    ) -> T_Da
-00018150: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
-00018160: 2222 5265 7475 726e 7320 6120 6e65 7720  ""Returns a new 
-00018170: 6461 7461 7365 7420 7769 7468 2065 6163  dataset with eac
-00018180: 6820 6172 7261 7920 696e 6465 7865 6420  h array indexed 
-00018190: 616c 6f6e 6720 6576 6572 7920 606e 602d  along every `n`-
-000181a0: 7468 0a20 2020 2020 2020 2076 616c 7565  th.        value
-000181b0: 2066 6f72 2074 6865 2073 7065 6369 6669   for the specifi
-000181c0: 6564 2064 696d 656e 7369 6f6e 2873 290a  ed dimension(s).
-000181d0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-000181e0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-000181f0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2069  ------.        i
-00018200: 6e64 6578 6572 7320 3a20 6469 6374 206f  ndexers : dict o
-00018210: 7220 696e 740a 2020 2020 2020 2020 2020  r int.          
-00018220: 2020 4120 6469 6374 2077 6974 6820 6b65    A dict with ke
-00018230: 7973 206d 6174 6368 696e 6720 6469 6d65  ys matching dime
-00018240: 6e73 696f 6e73 2061 6e64 2069 6e74 6567  nsions and integ
-00018250: 6572 2076 616c 7565 7320 606e 600a 2020  er values `n`.  
-00018260: 2020 2020 2020 2020 2020 6f72 2061 2073            or a s
-00018270: 696e 676c 6520 696e 7465 6765 7220 606e  ingle integer `n
-00018280: 6020 6170 706c 6965 6420 6f76 6572 2061  ` applied over a
-00018290: 6c6c 2064 696d 656e 7369 6f6e 732e 0a20  ll dimensions.. 
-000182a0: 2020 2020 2020 2020 2020 204f 6e65 206f             One o
-000182b0: 6620 696e 6465 7865 7273 206f 7220 696e  f indexers or in
-000182c0: 6465 7865 7273 5f6b 7761 7267 7320 6d75  dexers_kwargs mu
-000182d0: 7374 2062 6520 7072 6f76 6964 6564 2e0a  st be provided..
-000182e0: 2020 2020 2020 2020 2a2a 696e 6465 7865          **indexe
-000182f0: 7273 5f6b 7761 7267 7320 3a20 7b64 696d  rs_kwargs : {dim
-00018300: 3a20 6e2c 202e 2e2e 7d2c 206f 7074 696f  : n, ...}, optio
-00018310: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00018320: 5468 6520 6b65 7977 6f72 6420 6172 6775  The keyword argu
-00018330: 6d65 6e74 7320 666f 726d 206f 6620 6060  ments form of ``
-00018340: 696e 6465 7865 7273 6060 2e0a 2020 2020  indexers``..    
-00018350: 2020 2020 2020 2020 4f6e 6520 6f66 2069          One of i
-00018360: 6e64 6578 6572 7320 6f72 2069 6e64 6578  ndexers or index
-00018370: 6572 735f 6b77 6172 6773 206d 7573 7420  ers_kwargs must 
-00018380: 6265 2070 726f 7669 6465 642e 0a0a 2020  be provided...  
-00018390: 2020 2020 2020 4578 616d 706c 6573 0a20        Examples. 
-000183a0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
-000183b0: 2020 2020 2020 2020 3e3e 3e20 785f 6172          >>> x_ar
-000183c0: 7220 3d20 6e70 2e61 7261 6e67 6528 302c  r = np.arange(0,
-000183d0: 2032 3629 0a20 2020 2020 2020 203e 3e3e   26).        >>>
-000183e0: 2078 5f61 7272 0a20 2020 2020 2020 2061   x_arr.        a
-000183f0: 7272 6179 285b 2030 2c20 2031 2c20 2032  rray([ 0,  1,  2
-00018400: 2c20 2033 2c20 2034 2c20 2035 2c20 2036  ,  3,  4,  5,  6
-00018410: 2c20 2037 2c20 2038 2c20 2039 2c20 3130  ,  7,  8,  9, 10
-00018420: 2c20 3131 2c20 3132 2c20 3133 2c20 3134  , 11, 12, 13, 14
-00018430: 2c20 3135 2c20 3136 2c0a 2020 2020 2020  , 15, 16,.      
-00018440: 2020 2020 2020 2020 2031 372c 2031 382c           17, 18,
-00018450: 2031 392c 2032 302c 2032 312c 2032 322c   19, 20, 21, 22,
-00018460: 2032 332c 2032 342c 2032 355d 290a 2020   23, 24, 25]).  
-00018470: 2020 2020 2020 3e3e 3e20 7820 3d20 7872        >>> x = xr
-00018480: 2e44 6174 6141 7272 6179 280a 2020 2020  .DataArray(.    
-00018490: 2020 2020 2e2e 2e20 2020 2020 6e70 2e72      ...     np.r
-000184a0: 6573 6861 7065 2878 5f61 7272 2c20 2832  eshape(x_arr, (2
-000184b0: 2c20 3133 2929 2c0a 2020 2020 2020 2020  , 13)),.        
-000184c0: 2e2e 2e20 2020 2020 6469 6d73 3d28 2278  ...     dims=("x
-000184d0: 222c 2022 7922 292c 0a20 2020 2020 2020  ", "y"),.       
-000184e0: 202e 2e2e 2020 2020 2063 6f6f 7264 733d   ...     coords=
-000184f0: 7b22 7822 3a20 5b30 2c20 315d 2c20 2279  {"x": [0, 1], "y
-00018500: 223a 206e 702e 6172 616e 6765 2830 2c20  ": np.arange(0, 
-00018510: 3133 297d 2c0a 2020 2020 2020 2020 2e2e  13)},.        ..
-00018520: 2e20 290a 2020 2020 2020 2020 3e3e 3e20  . ).        >>> 
-00018530: 785f 6473 203d 2078 722e 4461 7461 7365  x_ds = xr.Datase
-00018540: 7428 7b22 666f 6f22 3a20 787d 290a 2020  t({"foo": x}).  
-00018550: 2020 2020 2020 3e3e 3e20 785f 6473 0a20        >>> x_ds. 
-00018560: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
-00018570: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
-00018580: 4469 6d65 6e73 696f 6e73 3a20 2028 783a  Dimensions:  (x:
-00018590: 2032 2c20 793a 2031 3329 0a20 2020 2020   2, y: 13).     
-000185a0: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-000185b0: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
-000185c0: 2020 2020 2028 7829 2069 6e74 3634 2030       (x) int64 0
-000185d0: 2031 0a20 2020 2020 2020 2020 202a 2079   1.          * y
-000185e0: 2020 2020 2020 2020 2879 2920 696e 7436          (y) int6
-000185f0: 3420 3020 3120 3220 3320 3420 3520 3620  4 0 1 2 3 4 5 6 
-00018600: 3720 3820 3920 3130 2031 3120 3132 0a20  7 8 9 10 11 12. 
-00018610: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
-00018620: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
-00018630: 2020 2066 6f6f 2020 2020 2020 2878 2c20     foo      (x, 
-00018640: 7929 2069 6e74 3634 2030 2031 2032 2033  y) int64 0 1 2 3
-00018650: 2034 2035 2036 2037 2038 2039 202e 2e2e   4 5 6 7 8 9 ...
-00018660: 2031 3620 3137 2031 3820 3139 2032 3020   16 17 18 19 20 
-00018670: 3231 2032 3220 3233 2032 3420 3235 0a0a  21 22 23 24 25..
-00018680: 2020 2020 2020 2020 3e3e 3e20 785f 6473          >>> x_ds
-00018690: 2e74 6869 6e28 3329 0a20 2020 2020 2020  .thin(3).       
-000186a0: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-000186b0: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-000186c0: 696f 6e73 3a20 2028 783a 2031 2c20 793a  ions:  (x: 1, y:
-000186d0: 2035 290a 2020 2020 2020 2020 436f 6f72   5).        Coor
-000186e0: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-000186f0: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
-00018700: 2920 696e 7436 3420 300a 2020 2020 2020  ) int64 0.      
-00018710: 2020 2020 2a20 7920 2020 2020 2020 2028      * y        (
-00018720: 7929 2069 6e74 3634 2030 2033 2036 2039  y) int64 0 3 6 9
-00018730: 2031 320a 2020 2020 2020 2020 4461 7461   12.        Data
-00018740: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-00018750: 2020 2020 2020 2020 666f 6f20 2020 2020          foo     
-00018760: 2028 782c 2079 2920 696e 7436 3420 3020   (x, y) int64 0 
-00018770: 3320 3620 3920 3132 0a20 2020 2020 2020  3 6 9 12.       
-00018780: 203e 3e3e 2078 2e74 6869 6e28 7b22 7822   >>> x.thin({"x"
-00018790: 3a20 322c 2022 7922 3a20 357d 290a 2020  : 2, "y": 5}).  
-000187a0: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-000187b0: 7461 4172 7261 7920 2878 3a20 312c 2079  taArray (x: 1, y
-000187c0: 3a20 3329 3e0a 2020 2020 2020 2020 6172  : 3)>.        ar
-000187d0: 7261 7928 5b5b 2030 2c20 2035 2c20 3130  ray([[ 0,  5, 10
-000187e0: 5d5d 290a 2020 2020 2020 2020 436f 6f72  ]]).        Coor
-000187f0: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-00018800: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
-00018810: 2920 696e 7436 3420 300a 2020 2020 2020  ) int64 0.      
-00018820: 2020 2020 2a20 7920 2020 2020 2020 2028      * y        (
-00018830: 7929 2069 6e74 3634 2030 2035 2031 300a  y) int64 0 5 10.
-00018840: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-00018850: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-00018860: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
-00018870: 6574 2e68 6561 640a 2020 2020 2020 2020  et.head.        
-00018880: 4461 7461 7365 742e 7461 696c 0a20 2020  Dataset.tail.   
-00018890: 2020 2020 2044 6174 6141 7272 6179 2e74       DataArray.t
-000188a0: 6869 6e0a 2020 2020 2020 2020 2222 220a  hin.        """.
-000188b0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-000188c0: 2020 2020 2020 2020 206e 6f74 2069 6e64           not ind
-000188d0: 6578 6572 735f 6b77 6172 6773 0a20 2020  exers_kwargs.   
-000188e0: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
-000188f0: 2069 7369 6e73 7461 6e63 6528 696e 6465   isinstance(inde
-00018900: 7865 7273 2c20 696e 7429 0a20 2020 2020  xers, int).     
-00018910: 2020 2020 2020 2061 6e64 206e 6f74 2069         and not i
-00018920: 735f 6469 6374 5f6c 696b 6528 696e 6465  s_dict_like(inde
-00018930: 7865 7273 290a 2020 2020 2020 2020 293a  xers).        ):
-00018940: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00018950: 7365 2054 7970 6545 7272 6f72 2822 696e  se TypeError("in
-00018960: 6465 7865 7273 206d 7573 7420 6265 2065  dexers must be e
-00018970: 6974 6865 7220 6469 6374 2d6c 696b 6520  ither dict-like 
-00018980: 6f72 2061 2073 696e 676c 6520 696e 7465  or a single inte
-00018990: 6765 7222 290a 2020 2020 2020 2020 6966  ger").        if
-000189a0: 2069 7369 6e73 7461 6e63 6528 696e 6465   isinstance(inde
-000189b0: 7865 7273 2c20 696e 7429 3a0a 2020 2020  xers, int):.    
-000189c0: 2020 2020 2020 2020 696e 6465 7865 7273          indexers
-000189d0: 203d 207b 6469 6d3a 2069 6e64 6578 6572   = {dim: indexer
-000189e0: 7320 666f 7220 6469 6d20 696e 2073 656c  s for dim in sel
-000189f0: 662e 6469 6d73 7d0a 2020 2020 2020 2020  f.dims}.        
-00018a00: 696e 6465 7865 7273 203d 2065 6974 6865  indexers = eithe
-00018a10: 725f 6469 6374 5f6f 725f 6b77 6172 6773  r_dict_or_kwargs
-00018a20: 2869 6e64 6578 6572 732c 2069 6e64 6578  (indexers, index
-00018a30: 6572 735f 6b77 6172 6773 2c20 2274 6869  ers_kwargs, "thi
-00018a40: 6e22 290a 2020 2020 2020 2020 666f 7220  n").        for 
-00018a50: 6b2c 2076 2069 6e20 696e 6465 7865 7273  k, v in indexers
-00018a60: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00018a70: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-00018a80: 6e73 7461 6e63 6528 762c 2069 6e74 293a  nstance(v, int):
-00018a90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018aa0: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
-00018ab0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00018ac0: 2020 2020 2020 2265 7870 6563 7465 6420        "expected 
-00018ad0: 696e 7465 6765 7220 7479 7065 2069 6e64  integer type ind
-00018ae0: 6578 6572 2066 6f72 2022 0a20 2020 2020  exer for ".     
-00018af0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00018b00: 2264 696d 656e 7369 6f6e 207b 6b21 727d  "dimension {k!r}
-00018b10: 2c20 666f 756e 6420 7b74 7970 6528 7629  , found {type(v)
-00018b20: 2172 7d22 0a20 2020 2020 2020 2020 2020  !r}".           
-00018b30: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00018b40: 2020 2065 6c69 6620 7620 3c20 303a 0a20     elif v < 0:. 
-00018b50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00018b60: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00018b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018b80: 2020 2020 2022 6578 7065 6374 6564 2070       "expected p
-00018b90: 6f73 6974 6976 6520 696e 7465 6765 7220  ositive integer 
-00018ba0: 6173 2069 6e64 6578 6572 2022 0a20 2020  as indexer ".   
-00018bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018bc0: 2066 2266 6f72 2064 696d 656e 7369 6f6e   f"for dimension
-00018bd0: 207b 6b21 727d 2c20 666f 756e 6420 7b76   {k!r}, found {v
-00018be0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-00018bf0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00018c00: 2065 6c69 6620 7620 3d3d 2030 3a0a 2020   elif v == 0:.  
-00018c10: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00018c20: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-00018c30: 7374 6570 2063 616e 6e6f 7420 6265 207a  step cannot be z
-00018c40: 6572 6f22 290a 2020 2020 2020 2020 696e  ero").        in
-00018c50: 6465 7865 7273 5f73 6c69 6365 7320 3d20  dexers_slices = 
-00018c60: 7b6b 3a20 736c 6963 6528 4e6f 6e65 2c20  {k: slice(None, 
-00018c70: 4e6f 6e65 2c20 7661 6c29 2066 6f72 206b  None, val) for k
-00018c80: 2c20 7661 6c20 696e 2069 6e64 6578 6572  , val in indexer
-00018c90: 732e 6974 656d 7328 297d 0a20 2020 2020  s.items()}.     
-00018ca0: 2020 2072 6574 7572 6e20 7365 6c66 2e69     return self.i
-00018cb0: 7365 6c28 696e 6465 7865 7273 5f73 6c69  sel(indexers_sli
-00018cc0: 6365 7329 0a0a 2020 2020 6465 6620 6272  ces)..    def br
-00018cd0: 6f61 6463 6173 745f 6c69 6b65 280a 2020  oadcast_like(.  
-00018ce0: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
-00018cf0: 7461 7365 742c 0a20 2020 2020 2020 206f  taset,.        o
-00018d00: 7468 6572 3a20 4461 7461 7365 7420 7c20  ther: Dataset | 
-00018d10: 4461 7461 4172 7261 792c 0a20 2020 2020  DataArray,.     
-00018d20: 2020 2065 7863 6c75 6465 3a20 4974 6572     exclude: Iter
-00018d30: 6162 6c65 5b48 6173 6861 626c 655d 207c  able[Hashable] |
-00018d40: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00018d50: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
-00018d60: 3a0a 2020 2020 2020 2020 2222 2242 726f  :.        """Bro
-00018d70: 6164 6361 7374 2074 6869 7320 4461 7461  adcast this Data
-00018d80: 4172 7261 7920 6167 6169 6e73 7420 616e  Array against an
-00018d90: 6f74 6865 7220 4461 7461 7365 7420 6f72  other Dataset or
-00018da0: 2044 6174 6141 7272 6179 2e0a 2020 2020   DataArray..    
-00018db0: 2020 2020 5468 6973 2069 7320 6571 7569      This is equi
-00018dc0: 7661 6c65 6e74 2074 6f20 7872 2e62 726f  valent to xr.bro
-00018dd0: 6164 6361 7374 286f 7468 6572 2c20 7365  adcast(other, se
-00018de0: 6c66 295b 315d 0a0a 2020 2020 2020 2020  lf)[1]..        
-00018df0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00018e00: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00018e10: 2020 2020 2020 6f74 6865 7220 3a20 4461        other : Da
-00018e20: 7461 7365 7420 6f72 2044 6174 6141 7272  taset or DataArr
-00018e30: 6179 0a20 2020 2020 2020 2020 2020 204f  ay.            O
-00018e40: 626a 6563 7420 6167 6169 6e73 7420 7768  bject against wh
-00018e50: 6963 6820 746f 2062 726f 6164 6361 7374  ich to broadcast
-00018e60: 2074 6869 7320 6172 7261 792e 0a20 2020   this array..   
-00018e70: 2020 2020 2065 7863 6c75 6465 203a 2069       exclude : i
-00018e80: 7465 7261 626c 6520 6f66 2068 6173 6861  terable of hasha
-00018e90: 626c 652c 206f 7074 696f 6e61 6c0a 2020  ble, optional.  
-00018ea0: 2020 2020 2020 2020 2020 4469 6d65 6e73            Dimens
-00018eb0: 696f 6e73 2074 6861 7420 6d75 7374 206e  ions that must n
-00018ec0: 6f74 2062 6520 6272 6f61 6463 6173 7465  ot be broadcaste
-00018ed0: 640a 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
-00018ee0: 2020 2020 2020 2069 6620 6578 636c 7564         if exclud
-00018ef0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-00018f00: 2020 2020 2020 2065 7863 6c75 6465 203d         exclude =
-00018f10: 2073 6574 2829 0a20 2020 2020 2020 2065   set().        e
-00018f20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00018f30: 2065 7863 6c75 6465 203d 2073 6574 2865   exclude = set(e
-00018f40: 7863 6c75 6465 290a 2020 2020 2020 2020  xclude).        
-00018f50: 6172 6773 203d 2061 6c69 676e 286f 7468  args = align(oth
-00018f60: 6572 2c20 7365 6c66 2c20 6a6f 696e 3d22  er, self, join="
-00018f70: 6f75 7465 7222 2c20 636f 7079 3d46 616c  outer", copy=Fal
-00018f80: 7365 2c20 6578 636c 7564 653d 6578 636c  se, exclude=excl
-00018f90: 7564 6529 0a0a 2020 2020 2020 2020 6469  ude)..        di
-00018fa0: 6d73 5f6d 6170 2c20 636f 6d6d 6f6e 5f63  ms_map, common_c
-00018fb0: 6f6f 7264 7320 3d20 5f67 6574 5f62 726f  oords = _get_bro
-00018fc0: 6164 6361 7374 5f64 696d 735f 6d61 705f  adcast_dims_map_
-00018fd0: 636f 6d6d 6f6e 5f63 6f6f 7264 7328 6172  common_coords(ar
-00018fe0: 6773 2c20 6578 636c 7564 6529 0a0a 2020  gs, exclude)..  
-00018ff0: 2020 2020 2020 7265 7475 726e 205f 6272        return _br
-00019000: 6f61 6463 6173 745f 6865 6c70 6572 280a  oadcast_helper(.
-00019010: 2020 2020 2020 2020 2020 2020 6361 7374              cast
-00019020: 2822 545f 4461 7461 7365 7422 2c20 6172  ("T_Dataset", ar
-00019030: 6773 5b31 5d29 2c20 6578 636c 7564 652c  gs[1]), exclude,
-00019040: 2064 696d 735f 6d61 702c 2063 6f6d 6d6f   dims_map, commo
-00019050: 6e5f 636f 6f72 6473 0a20 2020 2020 2020  n_coords.       
-00019060: 2029 0a0a 2020 2020 6465 6620 5f72 6569   )..    def _rei
-00019070: 6e64 6578 5f63 616c 6c62 6163 6b28 0a20  ndex_callback(. 
-00019080: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00019090: 2020 2020 2061 6c69 676e 6572 3a20 616c       aligner: al
-000190a0: 6967 6e6d 656e 742e 416c 6967 6e65 722c  ignment.Aligner,
-000190b0: 0a20 2020 2020 2020 2064 696d 5f70 6f73  .        dim_pos
-000190c0: 5f69 6e64 6578 6572 733a 2064 6963 745b  _indexers: dict[
-000190d0: 4861 7368 6162 6c65 2c20 416e 795d 2c0a  Hashable, Any],.
-000190e0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-000190f0: 733a 2064 6963 745b 4861 7368 6162 6c65  s: dict[Hashable
-00019100: 2c20 5661 7269 6162 6c65 5d2c 0a20 2020  , Variable],.   
-00019110: 2020 2020 2069 6e64 6578 6573 3a20 6469       indexes: di
-00019120: 6374 5b48 6173 6861 626c 652c 2049 6e64  ct[Hashable, Ind
-00019130: 6578 5d2c 0a20 2020 2020 2020 2066 696c  ex],.        fil
-00019140: 6c5f 7661 6c75 653a 2041 6e79 2c0a 2020  l_value: Any,.  
-00019150: 2020 2020 2020 6578 636c 7564 655f 6469        exclude_di
-00019160: 6d73 3a20 6672 6f7a 656e 7365 745b 4861  ms: frozenset[Ha
-00019170: 7368 6162 6c65 5d2c 0a20 2020 2020 2020  shable],.       
-00019180: 2065 7863 6c75 6465 5f76 6172 733a 2066   exclude_vars: f
-00019190: 726f 7a65 6e73 6574 5b48 6173 6861 626c  rozenset[Hashabl
-000191a0: 655d 2c0a 2020 2020 2920 2d3e 2044 6174  e],.    ) -> Dat
-000191b0: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
-000191c0: 2243 616c 6c62 6163 6b20 6361 6c6c 6564  "Callback called
-000191d0: 2066 726f 6d20 6060 416c 6967 6e65 7260   from ``Aligner`
-000191e0: 6020 746f 2063 7265 6174 6520 6120 6e65  ` to create a ne
-000191f0: 7720 7265 696e 6465 7865 6420 4461 7461  w reindexed Data
-00019200: 7365 742e 2222 220a 0a20 2020 2020 2020  set."""..       
-00019210: 206e 6577 5f76 6172 6961 626c 6573 203d   new_variables =
-00019220: 2076 6172 6961 626c 6573 2e63 6f70 7928   variables.copy(
-00019230: 290a 2020 2020 2020 2020 6e65 775f 696e  ).        new_in
-00019240: 6465 7865 7320 3d20 696e 6465 7865 732e  dexes = indexes.
-00019250: 636f 7079 2829 0a0a 2020 2020 2020 2020  copy()..        
-00019260: 2320 7265 2d61 7373 6967 6e20 7661 7269  # re-assign vari
-00019270: 6162 6c65 206d 6574 6164 6174 610a 2020  able metadata.  
-00019280: 2020 2020 2020 666f 7220 6e61 6d65 2c20        for name, 
-00019290: 6e65 775f 7661 7220 696e 206e 6577 5f76  new_var in new_v
-000192a0: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
-000192b0: 3a0a 2020 2020 2020 2020 2020 2020 7661  :.            va
-000192c0: 7220 3d20 7365 6c66 2e5f 7661 7269 6162  r = self._variab
-000192d0: 6c65 732e 6765 7428 6e61 6d65 290a 2020  les.get(name).  
-000192e0: 2020 2020 2020 2020 2020 6966 2076 6172            if var
-000192f0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00019300: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00019310: 775f 7661 722e 6174 7472 7320 3d20 7661  w_var.attrs = va
-00019320: 722e 6174 7472 730a 2020 2020 2020 2020  r.attrs.        
-00019330: 2020 2020 2020 2020 6e65 775f 7661 722e          new_var.
-00019340: 656e 636f 6469 6e67 203d 2076 6172 2e65  encoding = var.e
-00019350: 6e63 6f64 696e 670a 0a20 2020 2020 2020  ncoding..       
-00019360: 2023 2070 6173 7320 7468 726f 7567 6820   # pass through 
-00019370: 696e 6465 7865 7320 6672 6f6d 2065 7863  indexes from exc
-00019380: 6c75 6465 6420 6469 6d65 6e73 696f 6e73  luded dimensions
-00019390: 0a20 2020 2020 2020 2023 206e 6f20 6578  .        # no ex
-000193a0: 7472 6120 6368 6563 6b20 6e65 6564 6564  tra check needed
-000193b0: 2066 6f72 206d 756c 7469 2d63 6f6f 7264   for multi-coord
-000193c0: 696e 6174 6520 696e 6465 7865 732c 2070  inate indexes, p
-000193d0: 6f74 656e 7469 616c 2063 6f6e 666c 6963  otential conflic
-000193e0: 7473 0a20 2020 2020 2020 2023 2073 686f  ts.        # sho
-000193f0: 756c 6420 616c 7265 6164 7920 6861 7665  uld already have
-00019400: 2062 6565 6e20 6465 7465 6374 6564 2077   been detected w
-00019410: 6865 6e20 616c 6967 6e69 6e67 2074 6865  hen aligning the
-00019420: 2069 6e64 6578 6573 0a20 2020 2020 2020   indexes.       
-00019430: 2066 6f72 206e 616d 652c 2069 6478 2069   for name, idx i
-00019440: 6e20 7365 6c66 2e5f 696e 6465 7865 732e  n self._indexes.
-00019450: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-00019460: 2020 2020 2076 6172 203d 2073 656c 662e       var = self.
-00019470: 5f76 6172 6961 626c 6573 5b6e 616d 655d  _variables[name]
-00019480: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00019490: 7365 7428 7661 722e 6469 6d73 2920 3c3d  set(var.dims) <=
-000194a0: 2065 7863 6c75 6465 5f64 696d 733a 0a20   exclude_dims:. 
-000194b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000194c0: 6577 5f69 6e64 6578 6573 5b6e 616d 655d  ew_indexes[name]
-000194d0: 203d 2069 6478 0a20 2020 2020 2020 2020   = idx.         
-000194e0: 2020 2020 2020 206e 6577 5f76 6172 6961         new_varia
-000194f0: 626c 6573 5b6e 616d 655d 203d 2076 6172  bles[name] = var
-00019500: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00019510: 2064 696d 5f70 6f73 5f69 6e64 6578 6572   dim_pos_indexer
-00019520: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-00019530: 2066 6173 7420 7061 7468 2066 6f72 206e   fast path for n
-00019540: 6f20 7265 696e 6465 7869 6e67 206e 6563  o reindexing nec
-00019550: 6573 7361 7279 0a20 2020 2020 2020 2020  essary.         
-00019560: 2020 2069 6620 7365 7428 6e65 775f 696e     if set(new_in
-00019570: 6465 7865 7329 202d 2073 6574 2873 656c  dexes) - set(sel
-00019580: 662e 5f69 6e64 6578 6573 293a 0a20 2020  f._indexes):.   
-00019590: 2020 2020 2020 2020 2020 2020 2023 2074               # t
-000195a0: 6869 7320 6f6e 6c79 2061 6464 7320 6e65  his only adds ne
-000195b0: 7720 696e 6465 7865 7320 616e 6420 7468  w indexes and th
-000195c0: 6569 7220 636f 6f72 6469 6e61 7465 2076  eir coordinate v
-000195d0: 6172 6961 626c 6573 0a20 2020 2020 2020  ariables.       
-000195e0: 2020 2020 2020 2020 2072 6569 6e64 6578           reindex
-000195f0: 6564 203d 2073 656c 662e 5f6f 7665 7277  ed = self._overw
-00019600: 7269 7465 5f69 6e64 6578 6573 286e 6577  rite_indexes(new
-00019610: 5f69 6e64 6578 6573 2c20 6e65 775f 7661  _indexes, new_va
-00019620: 7269 6162 6c65 7329 0a20 2020 2020 2020  riables).       
-00019630: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00019640: 2020 2020 2020 2020 2020 2072 6569 6e64             reind
-00019650: 6578 6564 203d 2073 656c 662e 636f 7079  exed = self.copy
-00019660: 2864 6565 703d 616c 6967 6e65 722e 636f  (deep=aligner.co
-00019670: 7079 290a 2020 2020 2020 2020 656c 7365  py).        else
-00019680: 3a0a 2020 2020 2020 2020 2020 2020 746f  :.            to
-00019690: 5f72 6569 6e64 6578 203d 207b 0a20 2020  _reindex = {.   
-000196a0: 2020 2020 2020 2020 2020 2020 206b 3a20               k: 
-000196b0: 760a 2020 2020 2020 2020 2020 2020 2020  v.              
-000196c0: 2020 666f 7220 6b2c 2076 2069 6e20 7365    for k, v in se
-000196d0: 6c66 2e76 6172 6961 626c 6573 2e69 7465  lf.variables.ite
-000196e0: 6d73 2829 0a20 2020 2020 2020 2020 2020  ms().           
-000196f0: 2020 2020 2069 6620 6b20 6e6f 7420 696e       if k not in
-00019700: 2076 6172 6961 626c 6573 2061 6e64 206b   variables and k
-00019710: 206e 6f74 2069 6e20 6578 636c 7564 655f   not in exclude_
-00019720: 7661 7273 0a20 2020 2020 2020 2020 2020  vars.           
-00019730: 207d 0a20 2020 2020 2020 2020 2020 2072   }.            r
-00019740: 6569 6e64 6578 6564 5f76 6172 7320 3d20  eindexed_vars = 
-00019750: 616c 6967 6e6d 656e 742e 7265 696e 6465  alignment.reinde
-00019760: 785f 7661 7269 6162 6c65 7328 0a20 2020  x_variables(.   
-00019770: 2020 2020 2020 2020 2020 2020 2074 6f5f               to_
-00019780: 7265 696e 6465 782c 0a20 2020 2020 2020  reindex,.       
-00019790: 2020 2020 2020 2020 2064 696d 5f70 6f73           dim_pos
-000197a0: 5f69 6e64 6578 6572 732c 0a20 2020 2020  _indexers,.     
-000197b0: 2020 2020 2020 2020 2020 2063 6f70 793d             copy=
-000197c0: 616c 6967 6e65 722e 636f 7079 2c0a 2020  aligner.copy,.  
-000197d0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-000197e0: 6c6c 5f76 616c 7565 3d66 696c 6c5f 7661  ll_value=fill_va
-000197f0: 6c75 652c 0a20 2020 2020 2020 2020 2020  lue,.           
-00019800: 2020 2020 2073 7061 7273 653d 616c 6967       sparse=alig
-00019810: 6e65 722e 7370 6172 7365 2c0a 2020 2020  ner.sparse,.    
-00019820: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00019830: 2020 2020 2020 6e65 775f 7661 7269 6162        new_variab
-00019840: 6c65 732e 7570 6461 7465 2872 6569 6e64  les.update(reind
-00019850: 6578 6564 5f76 6172 7329 0a20 2020 2020  exed_vars).     
-00019860: 2020 2020 2020 206e 6577 5f63 6f6f 7264         new_coord
-00019870: 5f6e 616d 6573 203d 2073 656c 662e 5f63  _names = self._c
-00019880: 6f6f 7264 5f6e 616d 6573 207c 2073 6574  oord_names | set
-00019890: 286e 6577 5f69 6e64 6578 6573 290a 2020  (new_indexes).  
-000198a0: 2020 2020 2020 2020 2020 7265 696e 6465            reinde
-000198b0: 7865 6420 3d20 7365 6c66 2e5f 7265 706c  xed = self._repl
-000198c0: 6163 655f 7769 7468 5f6e 6577 5f64 696d  ace_with_new_dim
-000198d0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-000198e0: 2020 206e 6577 5f76 6172 6961 626c 6573     new_variables
-000198f0: 2c20 6e65 775f 636f 6f72 645f 6e61 6d65  , new_coord_name
-00019900: 732c 2069 6e64 6578 6573 3d6e 6577 5f69  s, indexes=new_i
-00019910: 6e64 6578 6573 0a20 2020 2020 2020 2020  ndexes.         
-00019920: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
-00019930: 7475 726e 2072 6569 6e64 6578 6564 0a0a  turn reindexed..
-00019940: 2020 2020 6465 6620 7265 696e 6465 785f      def reindex_
-00019950: 6c69 6b65 280a 2020 2020 2020 2020 7365  like(.        se
-00019960: 6c66 3a20 545f 4461 7461 7365 742c 0a20  lf: T_Dataset,. 
-00019970: 2020 2020 2020 206f 7468 6572 3a20 4461         other: Da
-00019980: 7461 7365 7420 7c20 4461 7461 4172 7261  taset | DataArra
-00019990: 792c 0a20 2020 2020 2020 206d 6574 686f  y,.        metho
-000199a0: 643a 2052 6569 6e64 6578 4d65 7468 6f64  d: ReindexMethod
-000199b0: 4f70 7469 6f6e 7320 3d20 4e6f 6e65 2c0a  Options = None,.
-000199c0: 2020 2020 2020 2020 746f 6c65 7261 6e63          toleranc
-000199d0: 653a 2069 6e74 207c 2066 6c6f 6174 207c  e: int | float |
-000199e0: 2049 7465 7261 626c 655b 696e 7420 7c20   Iterable[int | 
-000199f0: 666c 6f61 745d 207c 204e 6f6e 6520 3d20  float] | None = 
-00019a00: 4e6f 6e65 2c0a 2020 2020 2020 2020 636f  None,.        co
-00019a10: 7079 3a20 626f 6f6c 203d 2054 7275 652c  py: bool = True,
-00019a20: 0a20 2020 2020 2020 2066 696c 6c5f 7661  .        fill_va
-00019a30: 6c75 653a 2041 6e79 203d 2078 7264 7479  lue: Any = xrdty
-00019a40: 7065 732e 4e41 2c0a 2020 2020 2920 2d3e  pes.NA,.    ) ->
-00019a50: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-00019a60: 2020 2020 2222 2243 6f6e 666f 726d 2074      """Conform t
-00019a70: 6869 7320 6f62 6a65 6374 206f 6e74 6f20  his object onto 
-00019a80: 7468 6520 696e 6465 7865 7320 6f66 2061  the indexes of a
-00019a90: 6e6f 7468 6572 206f 626a 6563 742c 2066  nother object, f
-00019aa0: 696c 6c69 6e67 2069 6e0a 2020 2020 2020  illing in.      
-00019ab0: 2020 6d69 7373 696e 6720 7661 6c75 6573    missing values
-00019ac0: 2077 6974 6820 6060 6669 6c6c 5f76 616c   with ``fill_val
-00019ad0: 7565 6060 2e20 5468 6520 6465 6661 756c  ue``. The defaul
-00019ae0: 7420 6669 6c6c 2076 616c 7565 2069 7320  t fill value is 
-00019af0: 4e61 4e2e 0a0a 2020 2020 2020 2020 5061  NaN...        Pa
-00019b00: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00019b10: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00019b20: 2020 2020 6f74 6865 7220 3a20 4461 7461      other : Data
-00019b30: 7365 7420 6f72 2044 6174 6141 7272 6179  set or DataArray
-00019b40: 0a20 2020 2020 2020 2020 2020 204f 626a  .            Obj
-00019b50: 6563 7420 7769 7468 2061 6e20 2769 6e64  ect with an 'ind
-00019b60: 6578 6573 2720 6174 7472 6962 7574 6520  exes' attribute 
-00019b70: 6769 7669 6e67 2061 206d 6170 7069 6e67  giving a mapping
-00019b80: 2066 726f 6d20 6469 6d65 6e73 696f 6e0a   from dimension.
-00019b90: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00019ba0: 7320 746f 2070 616e 6461 732e 496e 6465  s to pandas.Inde
-00019bb0: 7820 6f62 6a65 6374 732c 2077 6869 6368  x objects, which
-00019bc0: 2070 726f 7669 6465 7320 636f 6f72 6469   provides coordi
-00019bd0: 6e61 7465 7320 7570 6f6e 0a20 2020 2020  nates upon.     
-00019be0: 2020 2020 2020 2077 6869 6368 2074 6f20         which to 
-00019bf0: 696e 6465 7820 7468 6520 7661 7269 6162  index the variab
-00019c00: 6c65 7320 696e 2074 6869 7320 6461 7461  les in this data
-00019c10: 7365 742e 2054 6865 2069 6e64 6578 6573  set. The indexes
-00019c20: 206f 6e20 7468 6973 0a20 2020 2020 2020   on this.       
-00019c30: 2020 2020 206f 7468 6572 206f 626a 6563       other objec
-00019c40: 7420 6e65 6564 206e 6f74 2062 6520 7468  t need not be th
-00019c50: 6520 7361 6d65 2061 7320 7468 6520 696e  e same as the in
-00019c60: 6465 7865 7320 6f6e 2074 6869 730a 2020  dexes on this.  
-00019c70: 2020 2020 2020 2020 2020 6461 7461 7365            datase
-00019c80: 742e 2041 6e79 206d 6973 2d6d 6174 6368  t. Any mis-match
-00019c90: 6564 2069 6e64 6578 2076 616c 7565 7320  ed index values 
-00019ca0: 7769 6c6c 2062 6520 6669 6c6c 6564 2069  will be filled i
-00019cb0: 6e20 7769 7468 0a20 2020 2020 2020 2020  n with.         
-00019cc0: 2020 204e 614e 2c20 616e 6420 616e 7920     NaN, and any 
-00019cd0: 6d69 732d 6d61 7463 6865 6420 6469 6d65  mis-matched dime
-00019ce0: 6e73 696f 6e20 6e61 6d65 7320 7769 6c6c  nsion names will
-00019cf0: 2073 696d 706c 7920 6265 2069 676e 6f72   simply be ignor
-00019d00: 6564 2e0a 2020 2020 2020 2020 6d65 7468  ed..        meth
-00019d10: 6f64 203a 207b 4e6f 6e65 2c20 226e 6561  od : {None, "nea
-00019d20: 7265 7374 222c 2022 7061 6422 2c20 2266  rest", "pad", "f
-00019d30: 6669 6c6c 222c 2022 6261 636b 6669 6c6c  fill", "backfill
-00019d40: 222c 2022 6266 696c 6c22 2c20 4e6f 6e65  ", "bfill", None
-00019d50: 7d2c 206f 7074 696f 6e61 6c0a 2020 2020  }, optional.    
-00019d60: 2020 2020 2020 2020 4d65 7468 6f64 2074          Method t
-00019d70: 6f20 7573 6520 666f 7220 6669 6c6c 696e  o use for fillin
-00019d80: 6720 696e 6465 7820 7661 6c75 6573 2066  g index values f
-00019d90: 726f 6d20 6f74 6865 7220 6e6f 7420 666f  rom other not fo
-00019da0: 756e 6420 696e 2074 6869 730a 2020 2020  und in this.    
-00019db0: 2020 2020 2020 2020 6461 7461 7365 743a          dataset:
-00019dc0: 0a0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
-00019dd0: 4e6f 6e65 2028 6465 6661 756c 7429 3a20  None (default): 
-00019de0: 646f 6e27 7420 6669 6c6c 2067 6170 730a  don't fill gaps.
-00019df0: 2020 2020 2020 2020 2020 2020 2d20 2270              - "p
-00019e00: 6164 2220 2f20 2266 6669 6c6c 223a 2070  ad" / "ffill": p
-00019e10: 726f 7061 6761 7465 206c 6173 7420 7661  ropagate last va
-00019e20: 6c69 6420 696e 6465 7820 7661 6c75 6520  lid index value 
-00019e30: 666f 7277 6172 640a 2020 2020 2020 2020  forward.        
-00019e40: 2020 2020 2d20 2262 6163 6b66 696c 6c22      - "backfill"
-00019e50: 202f 2022 6266 696c 6c22 3a20 7072 6f70   / "bfill": prop
-00019e60: 6167 6174 6520 6e65 7874 2076 616c 6964  agate next valid
-00019e70: 2069 6e64 6578 2076 616c 7565 2062 6163   index value bac
-00019e80: 6b77 6172 640a 2020 2020 2020 2020 2020  kward.          
-00019e90: 2020 2d20 226e 6561 7265 7374 223a 2075    - "nearest": u
-00019ea0: 7365 206e 6561 7265 7374 2076 616c 6964  se nearest valid
-00019eb0: 2069 6e64 6578 2076 616c 7565 0a0a 2020   index value..  
-00019ec0: 2020 2020 2020 746f 6c65 7261 6e63 6520        tolerance 
-00019ed0: 3a20 6f70 7469 6f6e 616c 0a20 2020 2020  : optional.     
-00019ee0: 2020 2020 2020 204d 6178 696d 756d 2064         Maximum d
-00019ef0: 6973 7461 6e63 6520 6265 7477 6565 6e20  istance between 
-00019f00: 6f72 6967 696e 616c 2061 6e64 206e 6577  original and new
-00019f10: 206c 6162 656c 7320 666f 7220 696e 6578   labels for inex
-00019f20: 6163 740a 2020 2020 2020 2020 2020 2020  act.            
-00019f30: 6d61 7463 6865 732e 2054 6865 2076 616c  matches. The val
-00019f40: 7565 7320 6f66 2074 6865 2069 6e64 6578  ues of the index
-00019f50: 2061 7420 7468 6520 6d61 7463 6869 6e67   at the matching
-00019f60: 206c 6f63 6174 696f 6e73 206d 7573 740a   locations must.
-00019f70: 2020 2020 2020 2020 2020 2020 7361 7469              sati
-00019f80: 7366 7920 7468 6520 6571 7561 7469 6f6e  sfy the equation
-00019f90: 2060 6061 6273 2869 6e64 6578 5b69 6e64   ``abs(index[ind
-00019fa0: 6578 6572 5d20 2d20 7461 7267 6574 2920  exer] - target) 
-00019fb0: 3c3d 2074 6f6c 6572 616e 6365 6060 2e0a  <= tolerance``..
-00019fc0: 2020 2020 2020 2020 2020 2020 546f 6c65              Tole
-00019fd0: 7261 6e63 6520 6d61 7920 6265 2061 2073  rance may be a s
-00019fe0: 6361 6c61 7220 7661 6c75 652c 2077 6869  calar value, whi
-00019ff0: 6368 2061 7070 6c69 6573 2074 6865 2073  ch applies the s
-0001a000: 616d 6520 746f 6c65 7261 6e63 650a 2020  ame tolerance.  
-0001a010: 2020 2020 2020 2020 2020 746f 2061 6c6c            to all
-0001a020: 2076 616c 7565 732c 206f 7220 6c69 7374   values, or list
-0001a030: 2d6c 696b 652c 2077 6869 6368 2061 7070  -like, which app
-0001a040: 6c69 6573 2076 6172 6961 626c 6520 746f  lies variable to
-0001a050: 6c65 7261 6e63 6520 7065 720a 2020 2020  lerance per.    
-0001a060: 2020 2020 2020 2020 656c 656d 656e 742e          element.
-0001a070: 204c 6973 742d 6c69 6b65 206d 7573 7420   List-like must 
-0001a080: 6265 2074 6865 2073 616d 6520 7369 7a65  be the same size
-0001a090: 2061 7320 7468 6520 696e 6465 7820 616e   as the index an
-0001a0a0: 6420 6974 7320 6474 7970 650a 2020 2020  d its dtype.    
-0001a0b0: 2020 2020 2020 2020 6d75 7374 2065 7861          must exa
-0001a0c0: 6374 6c79 206d 6174 6368 2074 6865 2069  ctly match the i
-0001a0d0: 6e64 6578 e280 9973 2074 7970 652e 0a20  ndex...s type.. 
-0001a0e0: 2020 2020 2020 2063 6f70 7920 3a20 626f         copy : bo
-0001a0f0: 6f6c 2c20 6465 6661 756c 743a 2054 7275  ol, default: Tru
-0001a100: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-0001a110: 2060 6063 6f70 793d 5472 7565 6060 2c20   ``copy=True``, 
-0001a120: 6461 7461 2069 6e20 7468 6520 7265 7475  data in the retu
-0001a130: 726e 2076 616c 7565 2069 7320 616c 7761  rn value is alwa
-0001a140: 7973 2063 6f70 6965 642e 2049 660a 2020  ys copied. If.  
-0001a150: 2020 2020 2020 2020 2020 6060 636f 7079            ``copy
-0001a160: 3d46 616c 7365 6060 2061 6e64 2072 6569  =False`` and rei
-0001a170: 6e64 6578 696e 6720 6973 2075 6e6e 6563  ndexing is unnec
-0001a180: 6573 7361 7279 2c20 6f72 2063 616e 2062  essary, or can b
-0001a190: 6520 7065 7266 6f72 6d65 640a 2020 2020  e performed.    
-0001a1a0: 2020 2020 2020 2020 7769 7468 206f 6e6c          with onl
-0001a1b0: 7920 736c 6963 6520 6f70 6572 6174 696f  y slice operatio
-0001a1c0: 6e73 2c20 7468 656e 2074 6865 206f 7574  ns, then the out
-0001a1d0: 7075 7420 6d61 7920 7368 6172 6520 6d65  put may share me
-0001a1e0: 6d6f 7279 2077 6974 680a 2020 2020 2020  mory with.      
-0001a1f0: 2020 2020 2020 7468 6520 696e 7075 742e        the input.
-0001a200: 2049 6e20 6569 7468 6572 2063 6173 652c   In either case,
-0001a210: 2061 206e 6577 2078 6172 7261 7920 6f62   a new xarray ob
-0001a220: 6a65 6374 2069 7320 616c 7761 7973 2072  ject is always r
-0001a230: 6574 7572 6e65 642e 0a20 2020 2020 2020  eturned..       
-0001a240: 2066 696c 6c5f 7661 6c75 6520 3a20 7363   fill_value : sc
-0001a250: 616c 6172 206f 7220 6469 6374 2d6c 696b  alar or dict-lik
-0001a260: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
-0001a270: 2020 2020 2020 2020 5661 6c75 6520 746f          Value to
-0001a280: 2075 7365 2066 6f72 206e 6577 6c79 206d   use for newly m
-0001a290: 6973 7369 6e67 2076 616c 7565 732e 2049  issing values. I
-0001a2a0: 6620 6120 6469 6374 2d6c 696b 6520 6d61  f a dict-like ma
-0001a2b0: 7073 0a20 2020 2020 2020 2020 2020 2076  ps.            v
-0001a2c0: 6172 6961 626c 6520 6e61 6d65 7320 746f  ariable names to
-0001a2d0: 2066 696c 6c20 7661 6c75 6573 2e0a 0a20   fill values... 
-0001a2e0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-0001a2f0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-0001a300: 2020 2020 2020 2072 6569 6e64 6578 6564         reindexed
-0001a310: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
-0001a320: 2020 2020 2020 2041 6e6f 7468 6572 2064         Another d
-0001a330: 6174 6173 6574 2c20 7769 7468 2074 6869  ataset, with thi
-0001a340: 7320 6461 7461 7365 7427 7320 6461 7461  s dataset's data
-0001a350: 2062 7574 2063 6f6f 7264 696e 6174 6573   but coordinates
-0001a360: 2066 726f 6d20 7468 650a 2020 2020 2020   from the.      
-0001a370: 2020 2020 2020 6f74 6865 7220 6f62 6a65        other obje
-0001a380: 6374 2e0a 0a20 2020 2020 2020 2053 6565  ct...        See
-0001a390: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-0001a3a0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
-0001a3b0: 6174 6173 6574 2e72 6569 6e64 6578 0a20  ataset.reindex. 
-0001a3c0: 2020 2020 2020 2061 6c69 676e 0a20 2020         align.   
-0001a3d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001a3e0: 2072 6574 7572 6e20 616c 6967 6e6d 656e   return alignmen
-0001a3f0: 742e 7265 696e 6465 785f 6c69 6b65 280a  t.reindex_like(.
-0001a400: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001a410: 2c0a 2020 2020 2020 2020 2020 2020 6f74  ,.            ot
-0001a420: 6865 723d 6f74 6865 722c 0a20 2020 2020  her=other,.     
-0001a430: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
-0001a440: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
-0001a450: 2020 746f 6c65 7261 6e63 653d 746f 6c65    tolerance=tole
-0001a460: 7261 6e63 652c 0a20 2020 2020 2020 2020  rance,.         
-0001a470: 2020 2063 6f70 793d 636f 7079 2c0a 2020     copy=copy,.  
-0001a480: 2020 2020 2020 2020 2020 6669 6c6c 5f76            fill_v
-0001a490: 616c 7565 3d66 696c 6c5f 7661 6c75 652c  alue=fill_value,
-0001a4a0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001a4b0: 6465 6620 7265 696e 6465 7828 0a20 2020  def reindex(.   
-0001a4c0: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-0001a4d0: 6173 6574 2c0a 2020 2020 2020 2020 696e  aset,.        in
-0001a4e0: 6465 7865 7273 3a20 4d61 7070 696e 675b  dexers: Mapping[
-0001a4f0: 416e 792c 2041 6e79 5d20 7c20 4e6f 6e65  Any, Any] | None
-0001a500: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0001a510: 206d 6574 686f 643a 2052 6569 6e64 6578   method: Reindex
-0001a520: 4d65 7468 6f64 4f70 7469 6f6e 7320 3d20  MethodOptions = 
-0001a530: 4e6f 6e65 2c0a 2020 2020 2020 2020 746f  None,.        to
-0001a540: 6c65 7261 6e63 653a 2069 6e74 207c 2066  lerance: int | f
-0001a550: 6c6f 6174 207c 2049 7465 7261 626c 655b  loat | Iterable[
-0001a560: 696e 7420 7c20 666c 6f61 745d 207c 204e  int | float] | N
-0001a570: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-0001a580: 2020 2020 636f 7079 3a20 626f 6f6c 203d      copy: bool =
-0001a590: 2054 7275 652c 0a20 2020 2020 2020 2066   True,.        f
-0001a5a0: 696c 6c5f 7661 6c75 653a 2041 6e79 203d  ill_value: Any =
-0001a5b0: 2078 7264 7479 7065 732e 4e41 2c0a 2020   xrdtypes.NA,.  
-0001a5c0: 2020 2020 2020 2a2a 696e 6465 7865 7273        **indexers
-0001a5d0: 5f6b 7761 7267 733a 2041 6e79 2c0a 2020  _kwargs: Any,.  
-0001a5e0: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
-0001a5f0: 3a0a 2020 2020 2020 2020 2222 2243 6f6e  :.        """Con
-0001a600: 666f 726d 2074 6869 7320 6f62 6a65 6374  form this object
-0001a610: 206f 6e74 6f20 6120 6e65 7720 7365 7420   onto a new set 
-0001a620: 6f66 2069 6e64 6578 6573 2c20 6669 6c6c  of indexes, fill
-0001a630: 696e 6720 696e 0a20 2020 2020 2020 206d  ing in.        m
-0001a640: 6973 7369 6e67 2076 616c 7565 7320 7769  issing values wi
-0001a650: 7468 2060 6066 696c 6c5f 7661 6c75 6560  th ``fill_value`
-0001a660: 602e 2054 6865 2064 6566 6175 6c74 2066  `. The default f
-0001a670: 696c 6c20 7661 6c75 6520 6973 204e 614e  ill value is NaN
-0001a680: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-0001a690: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-0001a6a0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-0001a6b0: 2069 6e64 6578 6572 7320 3a20 6469 6374   indexers : dict
-0001a6c0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0001a6d0: 2020 2020 2020 2044 6963 7469 6f6e 6172         Dictionar
-0001a6e0: 7920 7769 7468 206b 6579 7320 6769 7665  y with keys give
-0001a6f0: 6e20 6279 2064 696d 656e 7369 6f6e 206e  n by dimension n
-0001a700: 616d 6573 2061 6e64 2076 616c 7565 7320  ames and values 
-0001a710: 6769 7665 6e20 6279 0a20 2020 2020 2020  given by.       
-0001a720: 2020 2020 2061 7272 6179 7320 6f66 2063       arrays of c
-0001a730: 6f6f 7264 696e 6174 6573 2074 6963 6b20  oordinates tick 
-0001a740: 6c61 6265 6c73 2e20 416e 7920 6d69 732d  labels. Any mis-
-0001a750: 6d61 7463 6865 6420 636f 6f72 6469 6e61  matched coordina
-0001a760: 7465 0a20 2020 2020 2020 2020 2020 2076  te.            v
-0001a770: 616c 7565 7320 7769 6c6c 2062 6520 6669  alues will be fi
-0001a780: 6c6c 6564 2069 6e20 7769 7468 204e 614e  lled in with NaN
-0001a790: 2c20 616e 6420 616e 7920 6d69 732d 6d61  , and any mis-ma
-0001a7a0: 7463 6865 6420 6469 6d65 6e73 696f 6e0a  tched dimension.
-0001a7b0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0001a7c0: 7320 7769 6c6c 2073 696d 706c 7920 6265  s will simply be
-0001a7d0: 2069 676e 6f72 6564 2e0a 2020 2020 2020   ignored..      
-0001a7e0: 2020 2020 2020 4f6e 6520 6f66 2069 6e64        One of ind
-0001a7f0: 6578 6572 7320 6f72 2069 6e64 6578 6572  exers or indexer
-0001a800: 735f 6b77 6172 6773 206d 7573 7420 6265  s_kwargs must be
-0001a810: 2070 726f 7669 6465 642e 0a20 2020 2020   provided..     
-0001a820: 2020 206d 6574 686f 6420 3a20 7b4e 6f6e     method : {Non
-0001a830: 652c 2022 6e65 6172 6573 7422 2c20 2270  e, "nearest", "p
-0001a840: 6164 222c 2022 6666 696c 6c22 2c20 2262  ad", "ffill", "b
-0001a850: 6163 6b66 696c 6c22 2c20 2262 6669 6c6c  ackfill", "bfill
-0001a860: 222c 204e 6f6e 657d 2c20 6f70 7469 6f6e  ", None}, option
-0001a870: 616c 0a20 2020 2020 2020 2020 2020 204d  al.            M
-0001a880: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
-0001a890: 2066 696c 6c69 6e67 2069 6e64 6578 2076   filling index v
-0001a8a0: 616c 7565 7320 696e 2060 6069 6e64 6578  alues in ``index
-0001a8b0: 6572 7360 6020 6e6f 7420 666f 756e 6420  ers`` not found 
-0001a8c0: 696e 0a20 2020 2020 2020 2020 2020 2074  in.            t
-0001a8d0: 6869 7320 6461 7461 7365 743a 0a0a 2020  his dataset:..  
-0001a8e0: 2020 2020 2020 2020 2020 2d20 4e6f 6e65            - None
-0001a8f0: 2028 6465 6661 756c 7429 3a20 646f 6e27   (default): don'
-0001a900: 7420 6669 6c6c 2067 6170 730a 2020 2020  t fill gaps.    
-0001a910: 2020 2020 2020 2020 2d20 2270 6164 2220          - "pad" 
-0001a920: 2f20 2266 6669 6c6c 223a 2070 726f 7061  / "ffill": propa
-0001a930: 6761 7465 206c 6173 7420 7661 6c69 6420  gate last valid 
-0001a940: 696e 6465 7820 7661 6c75 6520 666f 7277  index value forw
-0001a950: 6172 640a 2020 2020 2020 2020 2020 2020  ard.            
-0001a960: 2d20 2262 6163 6b66 696c 6c22 202f 2022  - "backfill" / "
-0001a970: 6266 696c 6c22 3a20 7072 6f70 6167 6174  bfill": propagat
-0001a980: 6520 6e65 7874 2076 616c 6964 2069 6e64  e next valid ind
-0001a990: 6578 2076 616c 7565 2062 6163 6b77 6172  ex value backwar
-0001a9a0: 640a 2020 2020 2020 2020 2020 2020 2d20  d.            - 
-0001a9b0: 226e 6561 7265 7374 223a 2075 7365 206e  "nearest": use n
-0001a9c0: 6561 7265 7374 2076 616c 6964 2069 6e64  earest valid ind
-0001a9d0: 6578 2076 616c 7565 0a0a 2020 2020 2020  ex value..      
-0001a9e0: 2020 746f 6c65 7261 6e63 6520 3a20 6f70    tolerance : op
-0001a9f0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-0001aa00: 2020 204d 6178 696d 756d 2064 6973 7461     Maximum dista
-0001aa10: 6e63 6520 6265 7477 6565 6e20 6f72 6967  nce between orig
-0001aa20: 696e 616c 2061 6e64 206e 6577 206c 6162  inal and new lab
-0001aa30: 656c 7320 666f 7220 696e 6578 6163 740a  els for inexact.
-0001aa40: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
-0001aa50: 6865 732e 2054 6865 2076 616c 7565 7320  hes. The values 
-0001aa60: 6f66 2074 6865 2069 6e64 6578 2061 7420  of the index at 
-0001aa70: 7468 6520 6d61 7463 6869 6e67 206c 6f63  the matching loc
-0001aa80: 6174 696f 6e73 206d 7573 740a 2020 2020  ations must.    
-0001aa90: 2020 2020 2020 2020 7361 7469 7366 7920          satisfy 
-0001aaa0: 7468 6520 6571 7561 7469 6f6e 2060 6061  the equation ``a
-0001aab0: 6273 2869 6e64 6578 5b69 6e64 6578 6572  bs(index[indexer
-0001aac0: 5d20 2d20 7461 7267 6574 2920 3c3d 2074  ] - target) <= t
-0001aad0: 6f6c 6572 616e 6365 6060 2e0a 2020 2020  olerance``..    
-0001aae0: 2020 2020 2020 2020 546f 6c65 7261 6e63          Toleranc
-0001aaf0: 6520 6d61 7920 6265 2061 2073 6361 6c61  e may be a scala
-0001ab00: 7220 7661 6c75 652c 2077 6869 6368 2061  r value, which a
-0001ab10: 7070 6c69 6573 2074 6865 2073 616d 6520  pplies the same 
-0001ab20: 746f 6c65 7261 6e63 650a 2020 2020 2020  tolerance.      
-0001ab30: 2020 2020 2020 746f 2061 6c6c 2076 616c        to all val
-0001ab40: 7565 732c 206f 7220 6c69 7374 2d6c 696b  ues, or list-lik
-0001ab50: 652c 2077 6869 6368 2061 7070 6c69 6573  e, which applies
-0001ab60: 2076 6172 6961 626c 6520 746f 6c65 7261   variable tolera
-0001ab70: 6e63 6520 7065 720a 2020 2020 2020 2020  nce per.        
-0001ab80: 2020 2020 656c 656d 656e 742e 204c 6973      element. Lis
-0001ab90: 742d 6c69 6b65 206d 7573 7420 6265 2074  t-like must be t
-0001aba0: 6865 2073 616d 6520 7369 7a65 2061 7320  he same size as 
-0001abb0: 7468 6520 696e 6465 7820 616e 6420 6974  the index and it
-0001abc0: 7320 6474 7970 650a 2020 2020 2020 2020  s dtype.        
-0001abd0: 2020 2020 6d75 7374 2065 7861 6374 6c79      must exactly
-0001abe0: 206d 6174 6368 2074 6865 2069 6e64 6578   match the index
-0001abf0: e280 9973 2074 7970 652e 0a20 2020 2020  ...s type..     
-0001ac00: 2020 2063 6f70 7920 3a20 626f 6f6c 2c20     copy : bool, 
-0001ac10: 6465 6661 756c 743a 2054 7275 650a 2020  default: True.  
-0001ac20: 2020 2020 2020 2020 2020 4966 2060 6063            If ``c
-0001ac30: 6f70 793d 5472 7565 6060 2c20 6461 7461  opy=True``, data
-0001ac40: 2069 6e20 7468 6520 7265 7475 726e 2076   in the return v
-0001ac50: 616c 7565 2069 7320 616c 7761 7973 2063  alue is always c
-0001ac60: 6f70 6965 642e 2049 660a 2020 2020 2020  opied. If.      
-0001ac70: 2020 2020 2020 6060 636f 7079 3d46 616c        ``copy=Fal
-0001ac80: 7365 6060 2061 6e64 2072 6569 6e64 6578  se`` and reindex
-0001ac90: 696e 6720 6973 2075 6e6e 6563 6573 7361  ing is unnecessa
-0001aca0: 7279 2c20 6f72 2063 616e 2062 6520 7065  ry, or can be pe
-0001acb0: 7266 6f72 6d65 640a 2020 2020 2020 2020  rformed.        
-0001acc0: 2020 2020 7769 7468 206f 6e6c 7920 736c      with only sl
-0001acd0: 6963 6520 6f70 6572 6174 696f 6e73 2c20  ice operations, 
-0001ace0: 7468 656e 2074 6865 206f 7574 7075 7420  then the output 
-0001acf0: 6d61 7920 7368 6172 6520 6d65 6d6f 7279  may share memory
-0001ad00: 2077 6974 680a 2020 2020 2020 2020 2020   with.          
-0001ad10: 2020 7468 6520 696e 7075 742e 2049 6e20    the input. In 
-0001ad20: 6569 7468 6572 2063 6173 652c 2061 206e  either case, a n
-0001ad30: 6577 2078 6172 7261 7920 6f62 6a65 6374  ew xarray object
-0001ad40: 2069 7320 616c 7761 7973 2072 6574 7572   is always retur
-0001ad50: 6e65 642e 0a20 2020 2020 2020 2066 696c  ned..        fil
-0001ad60: 6c5f 7661 6c75 6520 3a20 7363 616c 6172  l_value : scalar
-0001ad70: 206f 7220 6469 6374 2d6c 696b 652c 206f   or dict-like, o
-0001ad80: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-0001ad90: 2020 2020 5661 6c75 6520 746f 2075 7365      Value to use
-0001ada0: 2066 6f72 206e 6577 6c79 206d 6973 7369   for newly missi
-0001adb0: 6e67 2076 616c 7565 732e 2049 6620 6120  ng values. If a 
-0001adc0: 6469 6374 2d6c 696b 652c 0a20 2020 2020  dict-like,.     
-0001add0: 2020 2020 2020 206d 6170 7320 7661 7269         maps vari
-0001ade0: 6162 6c65 206e 616d 6573 2028 696e 636c  able names (incl
-0001adf0: 7564 696e 6720 636f 6f72 6469 6e61 7465  uding coordinate
-0001ae00: 7329 2074 6f20 6669 6c6c 2076 616c 7565  s) to fill value
-0001ae10: 732e 0a20 2020 2020 2020 2073 7061 7273  s..        spars
-0001ae20: 6520 3a20 626f 6f6c 2c20 6465 6661 756c  e : bool, defaul
-0001ae30: 743a 2046 616c 7365 0a20 2020 2020 2020  t: False.       
-0001ae40: 2020 2020 2075 7365 2073 7061 7273 652d       use sparse-
-0001ae50: 6172 7261 792e 0a20 2020 2020 2020 202a  array..        *
-0001ae60: 2a69 6e64 6578 6572 735f 6b77 6172 6773  *indexers_kwargs
-0001ae70: 203a 207b 6469 6d3a 2069 6e64 6578 6572   : {dim: indexer
-0001ae80: 2c20 2e2e 2e7d 2c20 6f70 7469 6f6e 616c  , ...}, optional
-0001ae90: 0a20 2020 2020 2020 2020 2020 204b 6579  .            Key
-0001aea0: 776f 7264 2061 7267 756d 656e 7473 2069  word arguments i
-0001aeb0: 6e20 7468 6520 7361 6d65 2066 6f72 6d20  n the same form 
-0001aec0: 6173 2060 6069 6e64 6578 6572 7360 602e  as ``indexers``.
-0001aed0: 0a20 2020 2020 2020 2020 2020 204f 6e65  .            One
-0001aee0: 206f 6620 696e 6465 7865 7273 206f 7220   of indexers or 
-0001aef0: 696e 6465 7865 7273 5f6b 7761 7267 7320  indexers_kwargs 
-0001af00: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
-0001af10: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0001af20: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-0001af30: 2d2d 0a20 2020 2020 2020 2072 6569 6e64  --.        reind
-0001af40: 6578 6564 203a 2044 6174 6173 6574 0a20  exed : Dataset. 
-0001af50: 2020 2020 2020 2020 2020 2041 6e6f 7468             Anoth
-0001af60: 6572 2064 6174 6173 6574 2c20 7769 7468  er dataset, with
-0001af70: 2074 6869 7320 6461 7461 7365 7427 7320   this dataset's 
-0001af80: 6461 7461 2062 7574 2072 6570 6c61 6365  data but replace
-0001af90: 6420 636f 6f72 6469 6e61 7465 732e 0a0a  d coordinates...
-0001afa0: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-0001afb0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0001afc0: 2d0a 2020 2020 2020 2020 4461 7461 7365  -.        Datase
-0001afd0: 742e 7265 696e 6465 785f 6c69 6b65 0a20  t.reindex_like. 
-0001afe0: 2020 2020 2020 2061 6c69 676e 0a20 2020         align.   
-0001aff0: 2020 2020 2070 616e 6461 732e 496e 6465       pandas.Inde
-0001b000: 782e 6765 745f 696e 6465 7865 720a 0a20  x.get_indexer.. 
-0001b010: 2020 2020 2020 2045 7861 6d70 6c65 730a         Examples.
-0001b020: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0001b030: 0a20 2020 2020 2020 2043 7265 6174 6520  .        Create 
-0001b040: 6120 6461 7461 7365 7420 7769 7468 2073  a dataset with s
-0001b050: 6f6d 6520 6669 6374 696f 6e61 6c20 6461  ome fictional da
-0001b060: 7461 2e0a 0a20 2020 2020 2020 203e 3e3e  ta...        >>>
-0001b070: 2078 203d 2078 722e 4461 7461 7365 7428   x = xr.Dataset(
-0001b080: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-0001b090: 207b 0a20 2020 2020 2020 202e 2e2e 2020   {.        ...  
-0001b0a0: 2020 2020 2020 2022 7465 6d70 6572 6174         "temperat
-0001b0b0: 7572 6522 3a20 2822 7374 6174 696f 6e22  ure": ("station"
-0001b0c0: 2c20 3230 202a 206e 702e 7261 6e64 6f6d  , 20 * np.random
-0001b0d0: 2e72 616e 6428 3429 292c 0a20 2020 2020  .rand(4)),.     
-0001b0e0: 2020 202e 2e2e 2020 2020 2020 2020 2022     ...         "
-0001b0f0: 7072 6573 7375 7265 223a 2028 2273 7461  pressure": ("sta
-0001b100: 7469 6f6e 222c 2035 3030 202a 206e 702e  tion", 500 * np.
-0001b110: 7261 6e64 6f6d 2e72 616e 6428 3429 292c  random.rand(4)),
-0001b120: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-0001b130: 207d 2c0a 2020 2020 2020 2020 2e2e 2e20   },.        ... 
-0001b140: 2020 2020 636f 6f72 6473 3d7b 2273 7461      coords={"sta
-0001b150: 7469 6f6e 223a 205b 2262 6f73 746f 6e22  tion": ["boston"
-0001b160: 2c20 226e 7963 222c 2022 7365 6174 746c  , "nyc", "seattl
-0001b170: 6522 2c20 2264 656e 7665 7222 5d7d 2c0a  e", "denver"]},.
-0001b180: 2020 2020 2020 2020 2e2e 2e20 290a 2020          ... ).  
-0001b190: 2020 2020 2020 3e3e 3e20 780a 2020 2020        >>> x.    
-0001b1a0: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
-0001b1b0: 7365 743e 0a20 2020 2020 2020 2044 696d  set>.        Dim
-0001b1c0: 656e 7369 6f6e 733a 2020 2020 2020 2873  ensions:      (s
-0001b1d0: 7461 7469 6f6e 3a20 3429 0a20 2020 2020  tation: 4).     
-0001b1e0: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-0001b1f0: 2020 2020 2020 2020 2020 2a20 7374 6174            * stat
-0001b200: 696f 6e20 2020 2020 2028 7374 6174 696f  ion      (statio
-0001b210: 6e29 203c 5537 2027 626f 7374 6f6e 2720  n) <U7 'boston' 
-0001b220: 276e 7963 2720 2773 6561 7474 6c65 2720  'nyc' 'seattle' 
-0001b230: 2764 656e 7665 7227 0a20 2020 2020 2020  'denver'.       
-0001b240: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
-0001b250: 0a20 2020 2020 2020 2020 2020 2074 656d  .            tem
-0001b260: 7065 7261 7475 7265 2020 2873 7461 7469  perature  (stati
-0001b270: 6f6e 2920 666c 6f61 7436 3420 3130 2e39  on) float64 10.9
-0001b280: 3820 3134 2e33 2031 322e 3036 2031 302e  8 14.3 12.06 10.
-0001b290: 390a 2020 2020 2020 2020 2020 2020 7072  9.            pr
-0001b2a0: 6573 7375 7265 2020 2020 2028 7374 6174  essure     (stat
-0001b2b0: 696f 6e29 2066 6c6f 6174 3634 2032 3131  ion) float64 211
-0001b2c0: 2e38 2033 3232 2e39 2032 3138 2e38 2034  .8 322.9 218.8 4
-0001b2d0: 3435 2e39 0a20 2020 2020 2020 203e 3e3e  45.9.        >>>
-0001b2e0: 2078 2e69 6e64 6578 6573 0a20 2020 2020   x.indexes.     
-0001b2f0: 2020 2049 6e64 6578 6573 3a0a 2020 2020     Indexes:.    
-0001b300: 2020 2020 2020 2020 7374 6174 696f 6e20          station 
-0001b310: 2049 6e64 6578 285b 2762 6f73 746f 6e27   Index(['boston'
-0001b320: 2c20 276e 7963 272c 2027 7365 6174 746c  , 'nyc', 'seattl
-0001b330: 6527 2c20 2764 656e 7665 7227 5d2c 2064  e', 'denver'], d
-0001b340: 7479 7065 3d27 6f62 6a65 6374 272c 206e  type='object', n
-0001b350: 616d 653d 2773 7461 7469 6f6e 2729 0a0a  ame='station')..
-0001b360: 2020 2020 2020 2020 4372 6561 7465 2061          Create a
-0001b370: 206e 6577 2069 6e64 6578 2061 6e64 2072   new index and r
-0001b380: 6569 6e64 6578 2074 6865 2064 6174 6173  eindex the datas
-0001b390: 6574 2e20 4279 2064 6566 6175 6c74 2076  et. By default v
-0001b3a0: 616c 7565 7320 696e 2074 6865 206e 6577  alues in the new
-0001b3b0: 2069 6e64 6578 2074 6861 740a 2020 2020   index that.    
-0001b3c0: 2020 2020 646f 206e 6f74 2068 6176 6520      do not have 
-0001b3d0: 636f 7272 6573 706f 6e64 696e 6720 7265  corresponding re
-0001b3e0: 636f 7264 7320 696e 2074 6865 2064 6174  cords in the dat
-0001b3f0: 6173 6574 2061 7265 2061 7373 6967 6e65  aset are assigne
-0001b400: 6420 604e 614e 602e 0a0a 2020 2020 2020  d `NaN`...      
-0001b410: 2020 3e3e 3e20 6e65 775f 696e 6465 7820    >>> new_index 
-0001b420: 3d20 5b22 626f 7374 6f6e 222c 2022 6175  = ["boston", "au
-0001b430: 7374 696e 222c 2022 7365 6174 746c 6522  stin", "seattle"
-0001b440: 2c20 226c 696e 636f 6c6e 225d 0a20 2020  , "lincoln"].   
-0001b450: 2020 2020 203e 3e3e 2078 2e72 6569 6e64       >>> x.reind
-0001b460: 6578 287b 2273 7461 7469 6f6e 223a 206e  ex({"station": n
-0001b470: 6577 5f69 6e64 6578 7d29 0a20 2020 2020  ew_index}).     
-0001b480: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
-0001b490: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
-0001b4a0: 6e73 696f 6e73 3a20 2020 2020 2028 7374  nsions:      (st
-0001b4b0: 6174 696f 6e3a 2034 290a 2020 2020 2020  ation: 4).      
-0001b4c0: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
-0001b4d0: 2020 2020 2020 2020 202a 2073 7461 7469           * stati
-0001b4e0: 6f6e 2020 2020 2020 2873 7461 7469 6f6e  on      (station
-0001b4f0: 2920 3c55 3720 2762 6f73 746f 6e27 2027  ) <U7 'boston' '
-0001b500: 6175 7374 696e 2720 2773 6561 7474 6c65  austin' 'seattle
-0001b510: 2720 276c 696e 636f 6c6e 270a 2020 2020  ' 'lincoln'.    
-0001b520: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
-0001b530: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001b540: 7465 6d70 6572 6174 7572 6520 2028 7374  temperature  (st
-0001b550: 6174 696f 6e29 2066 6c6f 6174 3634 2031  ation) float64 1
-0001b560: 302e 3938 206e 616e 2031 322e 3036 206e  0.98 nan 12.06 n
-0001b570: 616e 0a20 2020 2020 2020 2020 2020 2070  an.            p
-0001b580: 7265 7373 7572 6520 2020 2020 2873 7461  ressure     (sta
-0001b590: 7469 6f6e 2920 666c 6f61 7436 3420 3231  tion) float64 21
-0001b5a0: 312e 3820 6e61 6e20 3231 382e 3820 6e61  1.8 nan 218.8 na
-0001b5b0: 6e0a 0a20 2020 2020 2020 2057 6520 6361  n..        We ca
-0001b5c0: 6e20 6669 6c6c 2069 6e20 7468 6520 6d69  n fill in the mi
-0001b5d0: 7373 696e 6720 7661 6c75 6573 2062 7920  ssing values by 
-0001b5e0: 7061 7373 696e 6720 6120 7661 6c75 6520  passing a value 
-0001b5f0: 746f 2074 6865 206b 6579 776f 7264 2060  to the keyword `
-0001b600: 6669 6c6c 5f76 616c 7565 602e 0a0a 2020  fill_value`...  
-0001b610: 2020 2020 2020 3e3e 3e20 782e 7265 696e        >>> x.rein
-0001b620: 6465 7828 7b22 7374 6174 696f 6e22 3a20  dex({"station": 
-0001b630: 6e65 775f 696e 6465 787d 2c20 6669 6c6c  new_index}, fill
-0001b640: 5f76 616c 7565 3d30 290a 2020 2020 2020  _value=0).      
-0001b650: 2020 3c78 6172 7261 792e 4461 7461 7365    <xarray.Datase
-0001b660: 743e 0a20 2020 2020 2020 2044 696d 656e  t>.        Dimen
-0001b670: 7369 6f6e 733a 2020 2020 2020 2873 7461  sions:      (sta
-0001b680: 7469 6f6e 3a20 3429 0a20 2020 2020 2020  tion: 4).       
-0001b690: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
-0001b6a0: 2020 2020 2020 2020 2a20 7374 6174 696f          * statio
-0001b6b0: 6e20 2020 2020 2028 7374 6174 696f 6e29  n      (station)
-0001b6c0: 203c 5537 2027 626f 7374 6f6e 2720 2761   <U7 'boston' 'a
-0001b6d0: 7573 7469 6e27 2027 7365 6174 746c 6527  ustin' 'seattle'
-0001b6e0: 2027 6c69 6e63 6f6c 6e27 0a20 2020 2020   'lincoln'.     
-0001b6f0: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
-0001b700: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
-0001b710: 656d 7065 7261 7475 7265 2020 2873 7461  emperature  (sta
-0001b720: 7469 6f6e 2920 666c 6f61 7436 3420 3130  tion) float64 10
-0001b730: 2e39 3820 302e 3020 3132 2e30 3620 302e  .98 0.0 12.06 0.
-0001b740: 300a 2020 2020 2020 2020 2020 2020 7072  0.            pr
-0001b750: 6573 7375 7265 2020 2020 2028 7374 6174  essure     (stat
-0001b760: 696f 6e29 2066 6c6f 6174 3634 2032 3131  ion) float64 211
-0001b770: 2e38 2030 2e30 2032 3138 2e38 2030 2e30  .8 0.0 218.8 0.0
-0001b780: 0a0a 2020 2020 2020 2020 5765 2063 616e  ..        We can
-0001b790: 2061 6c73 6f20 7573 6520 6469 6666 6572   also use differ
-0001b7a0: 656e 7420 6669 6c6c 2076 616c 7565 7320  ent fill values 
-0001b7b0: 666f 7220 6561 6368 2076 6172 6961 626c  for each variabl
-0001b7c0: 652e 0a0a 2020 2020 2020 2020 3e3e 3e20  e...        >>> 
-0001b7d0: 782e 7265 696e 6465 7828 0a20 2020 2020  x.reindex(.     
-0001b7e0: 2020 202e 2e2e 2020 2020 207b 2273 7461     ...     {"sta
-0001b7f0: 7469 6f6e 223a 206e 6577 5f69 6e64 6578  tion": new_index
-0001b800: 7d2c 2066 696c 6c5f 7661 6c75 653d 7b22  }, fill_value={"
-0001b810: 7465 6d70 6572 6174 7572 6522 3a20 302c  temperature": 0,
-0001b820: 2022 7072 6573 7375 7265 223a 2031 3030   "pressure": 100
-0001b830: 7d0a 2020 2020 2020 2020 2e2e 2e20 290a  }.        ... ).
-0001b840: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-0001b850: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-0001b860: 2044 696d 656e 7369 6f6e 733a 2020 2020   Dimensions:    
-0001b870: 2020 2873 7461 7469 6f6e 3a20 3429 0a20    (station: 4). 
-0001b880: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
-0001b890: 6573 3a0a 2020 2020 2020 2020 2020 2a20  es:.          * 
-0001b8a0: 7374 6174 696f 6e20 2020 2020 2028 7374  station      (st
-0001b8b0: 6174 696f 6e29 203c 5537 2027 626f 7374  ation) <U7 'bost
-0001b8c0: 6f6e 2720 2761 7573 7469 6e27 2027 7365  on' 'austin' 'se
-0001b8d0: 6174 746c 6527 2027 6c69 6e63 6f6c 6e27  attle' 'lincoln'
-0001b8e0: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-0001b8f0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-0001b900: 2020 2020 2074 656d 7065 7261 7475 7265       temperature
-0001b910: 2020 2873 7461 7469 6f6e 2920 666c 6f61    (station) floa
-0001b920: 7436 3420 3130 2e39 3820 302e 3020 3132  t64 10.98 0.0 12
-0001b930: 2e30 3620 302e 300a 2020 2020 2020 2020  .06 0.0.        
-0001b940: 2020 2020 7072 6573 7375 7265 2020 2020      pressure    
-0001b950: 2028 7374 6174 696f 6e29 2066 6c6f 6174   (station) float
-0001b960: 3634 2032 3131 2e38 2031 3030 2e30 2032  64 211.8 100.0 2
-0001b970: 3138 2e38 2031 3030 2e30 0a0a 2020 2020  18.8 100.0..    
-0001b980: 2020 2020 4265 6361 7573 6520 7468 6520      Because the 
-0001b990: 696e 6465 7820 6973 206e 6f74 206d 6f6e  index is not mon
-0001b9a0: 6f74 6f6e 6963 616c 6c79 2069 6e63 7265  otonically incre
-0001b9b0: 6173 696e 6720 6f72 2064 6563 7265 6173  asing or decreas
-0001b9c0: 696e 672c 2077 6520 6361 6e6e 6f74 2075  ing, we cannot u
-0001b9d0: 7365 2061 7267 756d 656e 7473 0a20 2020  se arguments.   
-0001b9e0: 2020 2020 2074 6f20 7468 6520 6b65 7977       to the keyw
-0001b9f0: 6f72 6420 6d65 7468 6f64 2074 6f20 6669  ord method to fi
-0001ba00: 6c6c 2074 6865 2060 4e61 4e60 2076 616c  ll the `NaN` val
-0001ba10: 7565 732e 0a0a 2020 2020 2020 2020 3e3e  ues...        >>
-0001ba20: 3e20 782e 7265 696e 6465 7828 7b22 7374  > x.reindex({"st
-0001ba30: 6174 696f 6e22 3a20 6e65 775f 696e 6465  ation": new_inde
-0001ba40: 787d 2c20 6d65 7468 6f64 3d22 6e65 6172  x}, method="near
-0001ba50: 6573 7422 290a 2020 2020 2020 2020 5472  est").        Tr
-0001ba60: 6163 6562 6163 6b20 286d 6f73 7420 7265  aceback (most re
-0001ba70: 6365 6e74 2063 616c 6c20 6c61 7374 293a  cent call last):
-0001ba80: 0a20 2020 2020 2020 202e 2e2e 0a20 2020  .        ....   
-0001ba90: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0001baa0: 616c 7565 4572 726f 7228 2769 6e64 6578  alueError('index
-0001bab0: 206d 7573 7420 6265 206d 6f6e 6f74 6f6e   must be monoton
-0001bac0: 6963 2069 6e63 7265 6173 696e 6720 6f72  ic increasing or
-0001bad0: 2064 6563 7265 6173 696e 6727 290a 2020   decreasing').  
-0001bae0: 2020 2020 2020 5661 6c75 6545 7272 6f72        ValueError
-0001baf0: 3a20 696e 6465 7820 6d75 7374 2062 6520  : index must be 
-0001bb00: 6d6f 6e6f 746f 6e69 6320 696e 6372 6561  monotonic increa
-0001bb10: 7369 6e67 206f 7220 6465 6372 6561 7369  sing or decreasi
-0001bb20: 6e67 0a0a 2020 2020 2020 2020 546f 2066  ng..        To f
-0001bb30: 7572 7468 6572 2069 6c6c 7573 7472 6174  urther illustrat
-0001bb40: 6520 7468 6520 6669 6c6c 696e 6720 6675  e the filling fu
-0001bb50: 6e63 7469 6f6e 616c 6974 7920 696e 2072  nctionality in r
-0001bb60: 6569 6e64 6578 2c20 7765 2077 696c 6c20  eindex, we will 
-0001bb70: 6372 6561 7465 2061 0a20 2020 2020 2020  create a.       
-0001bb80: 2064 6174 6173 6574 2077 6974 6820 6120   dataset with a 
-0001bb90: 6d6f 6e6f 746f 6e69 6361 6c6c 7920 696e  monotonically in
-0001bba0: 6372 6561 7369 6e67 2069 6e64 6578 2028  creasing index (
-0001bbb0: 666f 7220 6578 616d 706c 652c 2061 2073  for example, a s
-0001bbc0: 6571 7565 6e63 6520 6f66 2064 6174 6573  equence of dates
-0001bbd0: 292e 0a0a 2020 2020 2020 2020 3e3e 3e20  )...        >>> 
-0001bbe0: 7832 203d 2078 722e 4461 7461 7365 7428  x2 = xr.Dataset(
-0001bbf0: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-0001bc00: 207b 0a20 2020 2020 2020 202e 2e2e 2020   {.        ...  
-0001bc10: 2020 2020 2020 2022 7465 6d70 6572 6174         "temperat
-0001bc20: 7572 6522 3a20 280a 2020 2020 2020 2020  ure": (.        
-0001bc30: 2e2e 2e20 2020 2020 2020 2020 2020 2020  ...             
-0001bc40: 2274 696d 6522 2c0a 2020 2020 2020 2020  "time",.        
-0001bc50: 2e2e 2e20 2020 2020 2020 2020 2020 2020  ...             
-0001bc60: 5b31 352e 3537 2c20 3132 2e37 372c 206e  [15.57, 12.77, n
-0001bc70: 702e 6e61 6e2c 2030 2e33 3038 312c 2031  p.nan, 0.3081, 1
-0001bc80: 362e 3539 2c20 3135 2e31 325d 2c0a 2020  6.59, 15.12],.  
-0001bc90: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
-0001bca0: 2020 292c 0a20 2020 2020 2020 202e 2e2e    ),.        ...
-0001bcb0: 2020 2020 2020 2020 2022 7072 6573 7375           "pressu
-0001bcc0: 7265 223a 2028 2274 696d 6522 2c20 3530  re": ("time", 50
-0001bcd0: 3020 2a20 6e70 2e72 616e 646f 6d2e 7261  0 * np.random.ra
-0001bce0: 6e64 2836 2929 2c0a 2020 2020 2020 2020  nd(6)),.        
-0001bcf0: 2e2e 2e20 2020 2020 7d2c 0a20 2020 2020  ...     },.     
-0001bd00: 2020 202e 2e2e 2020 2020 2063 6f6f 7264     ...     coord
-0001bd10: 733d 7b22 7469 6d65 223a 2070 642e 6461  s={"time": pd.da
-0001bd20: 7465 5f72 616e 6765 2822 3031 2f30 312f  te_range("01/01/
-0001bd30: 3230 3139 222c 2070 6572 696f 6473 3d36  2019", periods=6
-0001bd40: 2c20 6672 6571 3d22 4422 297d 2c0a 2020  , freq="D")},.  
-0001bd50: 2020 2020 2020 2e2e 2e20 290a 2020 2020        ... ).    
-0001bd60: 2020 2020 3e3e 3e20 7832 0a20 2020 2020      >>> x2.     
-0001bd70: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
-0001bd80: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
-0001bd90: 6e73 696f 6e73 3a20 2020 2020 2028 7469  nsions:      (ti
-0001bda0: 6d65 3a20 3629 0a20 2020 2020 2020 2043  me: 6).        C
-0001bdb0: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-0001bdc0: 2020 2020 2020 2a20 7469 6d65 2020 2020        * time    
-0001bdd0: 2020 2020 2028 7469 6d65 2920 6461 7465       (time) date
-0001bde0: 7469 6d65 3634 5b6e 735d 2032 3031 392d  time64[ns] 2019-
-0001bdf0: 3031 2d30 3120 3230 3139 2d30 312d 3032  01-01 2019-01-02
-0001be00: 202e 2e2e 2032 3031 392d 3031 2d30 360a   ... 2019-01-06.
-0001be10: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-0001be20: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-0001be30: 2020 2020 7465 6d70 6572 6174 7572 6520      temperature 
-0001be40: 2028 7469 6d65 2920 666c 6f61 7436 3420   (time) float64 
-0001be50: 3135 2e35 3720 3132 2e37 3720 6e61 6e20  15.57 12.77 nan 
-0001be60: 302e 3330 3831 2031 362e 3539 2031 352e  0.3081 16.59 15.
-0001be70: 3132 0a20 2020 2020 2020 2020 2020 2070  12.            p
-0001be80: 7265 7373 7572 6520 2020 2020 2874 696d  ressure     (tim
-0001be90: 6529 2066 6c6f 6174 3634 2034 3831 2e38  e) float64 481.8
-0001bea0: 2031 3931 2e37 2033 3935 2e39 2032 3634   191.7 395.9 264
-0001beb0: 2e34 2032 3834 2e30 2034 3632 2e38 0a0a  .4 284.0 462.8..
-0001bec0: 2020 2020 2020 2020 5375 7070 6f73 6520          Suppose 
-0001bed0: 7765 2064 6563 6964 6520 746f 2065 7870  we decide to exp
-0001bee0: 616e 6420 7468 6520 6461 7461 7365 7420  and the dataset 
-0001bef0: 746f 2063 6f76 6572 2061 2077 6964 6572  to cover a wider
-0001bf00: 2064 6174 6520 7261 6e67 652e 0a0a 2020   date range...  
-0001bf10: 2020 2020 2020 3e3e 3e20 7469 6d65 5f69        >>> time_i
-0001bf20: 6e64 6578 3220 3d20 7064 2e64 6174 655f  ndex2 = pd.date_
-0001bf30: 7261 6e67 6528 2231 322f 3239 2f32 3031  range("12/29/201
-0001bf40: 3822 2c20 7065 7269 6f64 733d 3130 2c20  8", periods=10, 
-0001bf50: 6672 6571 3d22 4422 290a 2020 2020 2020  freq="D").      
-0001bf60: 2020 3e3e 3e20 7832 2e72 6569 6e64 6578    >>> x2.reindex
-0001bf70: 287b 2274 696d 6522 3a20 7469 6d65 5f69  ({"time": time_i
-0001bf80: 6e64 6578 327d 290a 2020 2020 2020 2020  ndex2}).        
-0001bf90: 3c78 6172 7261 792e 4461 7461 7365 743e  <xarray.Dataset>
-0001bfa0: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
-0001bfb0: 6f6e 733a 2020 2020 2020 2874 696d 653a  ons:      (time:
-0001bfc0: 2031 3029 0a20 2020 2020 2020 2043 6f6f   10).        Coo
-0001bfd0: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
-0001bfe0: 2020 2020 2a20 7469 6d65 2020 2020 2020      * time      
-0001bff0: 2020 2028 7469 6d65 2920 6461 7465 7469     (time) dateti
-0001c000: 6d65 3634 5b6e 735d 2032 3031 382d 3132  me64[ns] 2018-12
-0001c010: 2d32 3920 3230 3138 2d31 322d 3330 202e  -29 2018-12-30 .
-0001c020: 2e2e 2032 3031 392d 3031 2d30 370a 2020  .. 2019-01-07.  
-0001c030: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
-0001c040: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
-0001c050: 2020 7465 6d70 6572 6174 7572 6520 2028    temperature  (
-0001c060: 7469 6d65 2920 666c 6f61 7436 3420 6e61  time) float64 na
-0001c070: 6e20 6e61 6e20 6e61 6e20 3135 2e35 3720  n nan nan 15.57 
-0001c080: 2e2e 2e20 302e 3330 3831 2031 362e 3539  ... 0.3081 16.59
-0001c090: 2031 352e 3132 206e 616e 0a20 2020 2020   15.12 nan.     
-0001c0a0: 2020 2020 2020 2070 7265 7373 7572 6520         pressure 
-0001c0b0: 2020 2020 2874 696d 6529 2066 6c6f 6174      (time) float
-0001c0c0: 3634 206e 616e 206e 616e 206e 616e 2034  64 nan nan nan 4
-0001c0d0: 3831 2e38 202e 2e2e 2032 3634 2e34 2032  81.8 ... 264.4 2
-0001c0e0: 3834 2e30 2034 3632 2e38 206e 616e 0a0a  84.0 462.8 nan..
-0001c0f0: 2020 2020 2020 2020 5468 6520 696e 6465          The inde
-0001c100: 7820 656e 7472 6965 7320 7468 6174 2064  x entries that d
-0001c110: 6964 206e 6f74 2068 6176 6520 6120 7661  id not have a va
-0001c120: 6c75 6520 696e 2074 6865 206f 7269 6769  lue in the origi
-0001c130: 6e61 6c20 6461 7461 2066 7261 6d65 2028  nal data frame (
-0001c140: 666f 7220 6578 616d 706c 652c 2060 3230  for example, `20
-0001c150: 3138 2d31 322d 3239 6029 0a20 2020 2020  18-12-29`).     
-0001c160: 2020 2061 7265 2062 7920 6465 6661 756c     are by defaul
-0001c170: 7420 6669 6c6c 6564 2077 6974 6820 4e61  t filled with Na
-0001c180: 4e2e 2049 6620 6465 7369 7265 642c 2077  N. If desired, w
-0001c190: 6520 6361 6e20 6669 6c6c 2069 6e20 7468  e can fill in th
-0001c1a0: 6520 6d69 7373 696e 6720 7661 6c75 6573  e missing values
-0001c1b0: 2075 7369 6e67 206f 6e65 206f 6620 7365   using one of se
-0001c1c0: 7665 7261 6c20 6f70 7469 6f6e 732e 0a0a  veral options...
-0001c1d0: 2020 2020 2020 2020 466f 7220 6578 616d          For exam
-0001c1e0: 706c 652c 2074 6f20 6261 636b 2d70 726f  ple, to back-pro
-0001c1f0: 7061 6761 7465 2074 6865 206c 6173 7420  pagate the last 
-0001c200: 7661 6c69 6420 7661 6c75 6520 746f 2066  valid value to f
-0001c210: 696c 6c20 7468 6520 604e 614e 6020 7661  ill the `NaN` va
-0001c220: 6c75 6573 2c0a 2020 2020 2020 2020 7061  lues,.        pa
-0001c230: 7373 2060 6266 696c 6c60 2061 7320 616e  ss `bfill` as an
-0001c240: 2061 7267 756d 656e 7420 746f 2074 6865   argument to the
-0001c250: 2060 6d65 7468 6f64 6020 6b65 7977 6f72   `method` keywor
-0001c260: 642e 0a0a 2020 2020 2020 2020 3e3e 3e20  d...        >>> 
-0001c270: 7833 203d 2078 322e 7265 696e 6465 7828  x3 = x2.reindex(
-0001c280: 7b22 7469 6d65 223a 2074 696d 655f 696e  {"time": time_in
-0001c290: 6465 7832 7d2c 206d 6574 686f 643d 2262  dex2}, method="b
-0001c2a0: 6669 6c6c 2229 0a20 2020 2020 2020 203e  fill").        >
-0001c2b0: 3e3e 2078 330a 2020 2020 2020 2020 3c78  >> x3.        <x
-0001c2c0: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
-0001c2d0: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
-0001c2e0: 733a 2020 2020 2020 2874 696d 653a 2031  s:      (time: 1
-0001c2f0: 3029 0a20 2020 2020 2020 2043 6f6f 7264  0).        Coord
-0001c300: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
-0001c310: 2020 2a20 7469 6d65 2020 2020 2020 2020    * time        
-0001c320: 2028 7469 6d65 2920 6461 7465 7469 6d65   (time) datetime
-0001c330: 3634 5b6e 735d 2032 3031 382d 3132 2d32  64[ns] 2018-12-2
-0001c340: 3920 3230 3138 2d31 322d 3330 202e 2e2e  9 2018-12-30 ...
-0001c350: 2032 3031 392d 3031 2d30 370a 2020 2020   2019-01-07.    
-0001c360: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
-0001c370: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001c380: 7465 6d70 6572 6174 7572 6520 2028 7469  temperature  (ti
-0001c390: 6d65 2920 666c 6f61 7436 3420 3135 2e35  me) float64 15.5
-0001c3a0: 3720 3135 2e35 3720 3135 2e35 3720 3135  7 15.57 15.57 15
-0001c3b0: 2e35 3720 2e2e 2e20 3136 2e35 3920 3135  .57 ... 16.59 15
-0001c3c0: 2e31 3220 6e61 6e0a 2020 2020 2020 2020  .12 nan.        
-0001c3d0: 2020 2020 7072 6573 7375 7265 2020 2020      pressure    
-0001c3e0: 2028 7469 6d65 2920 666c 6f61 7436 3420   (time) float64 
-0001c3f0: 3438 312e 3820 3438 312e 3820 3438 312e  481.8 481.8 481.
-0001c400: 3820 3438 312e 3820 2e2e 2e20 3238 342e  8 481.8 ... 284.
-0001c410: 3020 3436 322e 3820 6e61 6e0a 0a20 2020  0 462.8 nan..   
-0001c420: 2020 2020 2050 6c65 6173 6520 6e6f 7465       Please note
-0001c430: 2074 6861 7420 7468 6520 604e 614e 6020   that the `NaN` 
-0001c440: 7661 6c75 6520 7072 6573 656e 7420 696e  value present in
-0001c450: 2074 6865 206f 7269 6769 6e61 6c20 6461   the original da
-0001c460: 7461 7365 7420 2861 7420 696e 6465 7820  taset (at index 
-0001c470: 7661 6c75 6520 6032 3031 392d 3031 2d30  value `2019-01-0
-0001c480: 3360 290a 2020 2020 2020 2020 7769 6c6c  3`).        will
-0001c490: 206e 6f74 2062 6520 6669 6c6c 6564 2062   not be filled b
-0001c4a0: 7920 616e 7920 6f66 2074 6865 2076 616c  y any of the val
-0001c4b0: 7565 2070 726f 7061 6761 7469 6f6e 2073  ue propagation s
-0001c4c0: 6368 656d 6573 2e0a 0a20 2020 2020 2020  chemes...       
-0001c4d0: 203e 3e3e 2078 322e 7768 6572 6528 7832   >>> x2.where(x2
-0001c4e0: 2e74 656d 7065 7261 7475 7265 2e69 736e  .temperature.isn
-0001c4f0: 756c 6c28 292c 2064 726f 703d 5472 7565  ull(), drop=True
-0001c500: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
-0001c510: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-0001c520: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-0001c530: 2020 2020 2874 696d 653a 2031 290a 2020      (time: 1).  
-0001c540: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
-0001c550: 733a 0a20 2020 2020 2020 2020 202a 2074  s:.          * t
-0001c560: 696d 6520 2020 2020 2020 2020 2874 696d  ime         (tim
-0001c570: 6529 2064 6174 6574 696d 6536 345b 6e73  e) datetime64[ns
-0001c580: 5d20 3230 3139 2d30 312d 3033 0a20 2020  ] 2019-01-03.   
-0001c590: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
-0001c5a0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-0001c5b0: 2074 656d 7065 7261 7475 7265 2020 2874   temperature  (t
-0001c5c0: 696d 6529 2066 6c6f 6174 3634 206e 616e  ime) float64 nan
-0001c5d0: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-0001c5e0: 7373 7572 6520 2020 2020 2874 696d 6529  ssure     (time)
-0001c5f0: 2066 6c6f 6174 3634 2033 3935 2e39 0a20   float64 395.9. 
-0001c600: 2020 2020 2020 203e 3e3e 2078 332e 7768         >>> x3.wh
-0001c610: 6572 6528 7833 2e74 656d 7065 7261 7475  ere(x3.temperatu
-0001c620: 7265 2e69 736e 756c 6c28 292c 2064 726f  re.isnull(), dro
-0001c630: 703d 5472 7565 290a 2020 2020 2020 2020  p=True).        
-0001c640: 3c78 6172 7261 792e 4461 7461 7365 743e  <xarray.Dataset>
-0001c650: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
-0001c660: 6f6e 733a 2020 2020 2020 2874 696d 653a  ons:      (time:
-0001c670: 2032 290a 2020 2020 2020 2020 436f 6f72   2).        Coor
-0001c680: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-0001c690: 2020 202a 2074 696d 6520 2020 2020 2020     * time       
-0001c6a0: 2020 2874 696d 6529 2064 6174 6574 696d    (time) datetim
-0001c6b0: 6536 345b 6e73 5d20 3230 3139 2d30 312d  e64[ns] 2019-01-
-0001c6c0: 3033 2032 3031 392d 3031 2d30 370a 2020  03 2019-01-07.  
-0001c6d0: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
-0001c6e0: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
-0001c6f0: 2020 7465 6d70 6572 6174 7572 6520 2028    temperature  (
-0001c700: 7469 6d65 2920 666c 6f61 7436 3420 6e61  time) float64 na
-0001c710: 6e20 6e61 6e0a 2020 2020 2020 2020 2020  n nan.          
-0001c720: 2020 7072 6573 7375 7265 2020 2020 2028    pressure     (
-0001c730: 7469 6d65 2920 666c 6f61 7436 3420 3339  time) float64 39
-0001c740: 352e 3920 6e61 6e0a 0a20 2020 2020 2020  5.9 nan..       
-0001c750: 2054 6869 7320 6973 2062 6563 6175 7365   This is because
-0001c760: 2066 696c 6c69 6e67 2077 6869 6c65 2072   filling while r
-0001c770: 6569 6e64 6578 696e 6720 646f 6573 206e  eindexing does n
-0001c780: 6f74 206c 6f6f 6b20 6174 2064 6174 6173  ot look at datas
-0001c790: 6574 2076 616c 7565 732c 2062 7574 206f  et values, but o
-0001c7a0: 6e6c 7920 636f 6d70 6172 6573 0a20 2020  nly compares.   
-0001c7b0: 2020 2020 2074 6865 206f 7269 6769 6e61       the origina
-0001c7c0: 6c20 616e 6420 6465 7369 7265 6420 696e  l and desired in
-0001c7d0: 6465 7865 732e 2049 6620 796f 7520 646f  dexes. If you do
-0001c7e0: 2077 616e 7420 746f 2066 696c 6c20 696e   want to fill in
-0001c7f0: 2074 6865 2060 4e61 4e60 2076 616c 7565   the `NaN` value
-0001c800: 7320 7072 6573 656e 7420 696e 2074 6865  s present in the
-0001c810: 0a20 2020 2020 2020 206f 7269 6769 6e61  .        origina
-0001c820: 6c20 6461 7461 7365 742c 2075 7365 2074  l dataset, use t
-0001c830: 6865 203a 7079 3a6d 6574 683a 607e 4461  he :py:meth:`~Da
-0001c840: 7461 7365 742e 6669 6c6c 6e61 2829 6020  taset.fillna()` 
-0001c850: 6d65 7468 6f64 2e0a 0a20 2020 2020 2020  method...       
-0001c860: 2022 2222 0a20 2020 2020 2020 2069 6e64   """.        ind
-0001c870: 6578 6572 7320 3d20 7574 696c 732e 6569  exers = utils.ei
-0001c880: 7468 6572 5f64 6963 745f 6f72 5f6b 7761  ther_dict_or_kwa
-0001c890: 7267 7328 696e 6465 7865 7273 2c20 696e  rgs(indexers, in
-0001c8a0: 6465 7865 7273 5f6b 7761 7267 732c 2022  dexers_kwargs, "
-0001c8b0: 7265 696e 6465 7822 290a 2020 2020 2020  reindex").      
-0001c8c0: 2020 7265 7475 726e 2061 6c69 676e 6d65    return alignme
-0001c8d0: 6e74 2e72 6569 6e64 6578 280a 2020 2020  nt.reindex(.    
-0001c8e0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0001c8f0: 2020 2020 2020 2020 2020 696e 6465 7865            indexe
-0001c900: 7273 3d69 6e64 6578 6572 732c 0a20 2020  rs=indexers,.   
-0001c910: 2020 2020 2020 2020 206d 6574 686f 643d           method=
-0001c920: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
-0001c930: 2020 2020 746f 6c65 7261 6e63 653d 746f      tolerance=to
-0001c940: 6c65 7261 6e63 652c 0a20 2020 2020 2020  lerance,.       
-0001c950: 2020 2020 2063 6f70 793d 636f 7079 2c0a       copy=copy,.
-0001c960: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-0001c970: 5f76 616c 7565 3d66 696c 6c5f 7661 6c75  _value=fill_valu
-0001c980: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
-0001c990: 2020 6465 6620 5f72 6569 6e64 6578 280a    def _reindex(.
-0001c9a0: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
-0001c9b0: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
-0001c9c0: 2069 6e64 6578 6572 733a 204d 6170 7069   indexers: Mappi
-0001c9d0: 6e67 5b41 6e79 2c20 416e 795d 207c 204e  ng[Any, Any] | N
-0001c9e0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-0001c9f0: 2020 2020 6d65 7468 6f64 3a20 7374 7220      method: str 
-0001ca00: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
-0001ca10: 2020 2020 2020 2074 6f6c 6572 616e 6365         tolerance
-0001ca20: 3a20 696e 7420 7c20 666c 6f61 7420 7c20  : int | float | 
-0001ca30: 4974 6572 6162 6c65 5b69 6e74 207c 2066  Iterable[int | f
-0001ca40: 6c6f 6174 5d20 7c20 4e6f 6e65 203d 204e  loat] | None = N
-0001ca50: 6f6e 652c 0a20 2020 2020 2020 2063 6f70  one,.        cop
-0001ca60: 793a 2062 6f6f 6c20 3d20 5472 7565 2c0a  y: bool = True,.
-0001ca70: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
-0001ca80: 7565 3a20 416e 7920 3d20 7872 6474 7970  ue: Any = xrdtyp
-0001ca90: 6573 2e4e 412c 0a20 2020 2020 2020 2073  es.NA,.        s
-0001caa0: 7061 7273 653a 2062 6f6f 6c20 3d20 4661  parse: bool = Fa
-0001cab0: 6c73 652c 0a20 2020 2020 2020 202a 2a69  lse,.        **i
-0001cac0: 6e64 6578 6572 735f 6b77 6172 6773 3a20  ndexers_kwargs: 
-0001cad0: 416e 792c 0a20 2020 2029 202d 3e20 545f  Any,.    ) -> T_
-0001cae0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-0001caf0: 2022 2222 0a20 2020 2020 2020 2053 616d   """.        Sam
-0001cb00: 6520 6173 2072 6569 6e64 6578 2062 7574  e as reindex but
-0001cb10: 2073 7570 706f 7274 7320 7370 6172 7365   supports sparse
-0001cb20: 206f 7074 696f 6e2e 0a20 2020 2020 2020   option..       
-0001cb30: 2022 2222 0a20 2020 2020 2020 2069 6e64   """.        ind
-0001cb40: 6578 6572 7320 3d20 7574 696c 732e 6569  exers = utils.ei
-0001cb50: 7468 6572 5f64 6963 745f 6f72 5f6b 7761  ther_dict_or_kwa
-0001cb60: 7267 7328 696e 6465 7865 7273 2c20 696e  rgs(indexers, in
-0001cb70: 6465 7865 7273 5f6b 7761 7267 732c 2022  dexers_kwargs, "
-0001cb80: 7265 696e 6465 7822 290a 2020 2020 2020  reindex").      
-0001cb90: 2020 7265 7475 726e 2061 6c69 676e 6d65    return alignme
-0001cba0: 6e74 2e72 6569 6e64 6578 280a 2020 2020  nt.reindex(.    
-0001cbb0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0001cbc0: 2020 2020 2020 2020 2020 696e 6465 7865            indexe
-0001cbd0: 7273 3d69 6e64 6578 6572 732c 0a20 2020  rs=indexers,.   
-0001cbe0: 2020 2020 2020 2020 206d 6574 686f 643d           method=
-0001cbf0: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
-0001cc00: 2020 2020 746f 6c65 7261 6e63 653d 746f      tolerance=to
-0001cc10: 6c65 7261 6e63 652c 0a20 2020 2020 2020  lerance,.       
-0001cc20: 2020 2020 2063 6f70 793d 636f 7079 2c0a       copy=copy,.
-0001cc30: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-0001cc40: 5f76 616c 7565 3d66 696c 6c5f 7661 6c75  _value=fill_valu
-0001cc50: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-0001cc60: 7061 7273 653d 7370 6172 7365 2c0a 2020  parse=sparse,.  
-0001cc70: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-0001cc80: 2069 6e74 6572 7028 0a20 2020 2020 2020   interp(.       
-0001cc90: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
-0001cca0: 2c0a 2020 2020 2020 2020 636f 6f72 6473  ,.        coords
-0001ccb0: 3a20 4d61 7070 696e 675b 416e 792c 2041  : Mapping[Any, A
-0001ccc0: 6e79 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ny] | None = Non
-0001ccd0: 652c 0a20 2020 2020 2020 206d 6574 686f  e,.        metho
-0001cce0: 643a 2049 6e74 6572 704f 7074 696f 6e73  d: InterpOptions
-0001ccf0: 203d 2022 6c69 6e65 6172 222c 0a20 2020   = "linear",.   
-0001cd00: 2020 2020 2061 7373 756d 655f 736f 7274       assume_sort
-0001cd10: 6564 3a20 626f 6f6c 203d 2046 616c 7365  ed: bool = False
-0001cd20: 2c0a 2020 2020 2020 2020 6b77 6172 6773  ,.        kwargs
-0001cd30: 3a20 4d61 7070 696e 675b 7374 722c 2041  : Mapping[str, A
-0001cd40: 6e79 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ny] | None = Non
-0001cd50: 652c 0a20 2020 2020 2020 206d 6574 686f  e,.        metho
-0001cd60: 645f 6e6f 6e5f 6e75 6d65 7269 633a 2073  d_non_numeric: s
-0001cd70: 7472 203d 2022 6e65 6172 6573 7422 2c0a  tr = "nearest",.
-0001cd80: 2020 2020 2020 2020 2a2a 636f 6f72 6473          **coords
-0001cd90: 5f6b 7761 7267 733a 2041 6e79 2c0a 2020  _kwargs: Any,.  
-0001cda0: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
-0001cdb0: 3a0a 2020 2020 2020 2020 2222 2249 6e74  :.        """Int
-0001cdc0: 6572 706f 6c61 7465 2061 2044 6174 6173  erpolate a Datas
-0001cdd0: 6574 206f 6e74 6f20 6e65 7720 636f 6f72  et onto new coor
-0001cde0: 6469 6e61 7465 730a 0a20 2020 2020 2020  dinates..       
-0001cdf0: 2050 6572 666f 726d 7320 756e 6976 6172   Performs univar
-0001ce00: 6961 7465 206f 7220 6d75 6c74 6976 6172  iate or multivar
-0001ce10: 6961 7465 2069 6e74 6572 706f 6c61 7469  iate interpolati
-0001ce20: 6f6e 206f 6620 6120 4461 7461 7365 7420  on of a Dataset 
-0001ce30: 6f6e 746f 0a20 2020 2020 2020 206e 6577  onto.        new
-0001ce40: 2063 6f6f 7264 696e 6174 6573 2075 7369   coordinates usi
-0001ce50: 6e67 2073 6369 7079 2773 2069 6e74 6572  ng scipy's inter
-0001ce60: 706f 6c61 7469 6f6e 2072 6f75 7469 6e65  polation routine
-0001ce70: 732e 2049 6620 696e 7465 7270 6f6c 6174  s. If interpolat
-0001ce80: 696e 670a 2020 2020 2020 2020 616c 6f6e  ing.        alon
-0001ce90: 6720 616e 2065 7869 7374 696e 6720 6469  g an existing di
-0001cea0: 6d65 6e73 696f 6e2c 203a 7079 3a63 6c61  mension, :py:cla
-0001ceb0: 7373 3a60 7363 6970 792e 696e 7465 7270  ss:`scipy.interp
-0001cec0: 6f6c 6174 652e 696e 7465 7270 3164 6020  olate.interp1d` 
-0001ced0: 6973 0a20 2020 2020 2020 2063 616c 6c65  is.        calle
-0001cee0: 642e 2020 5768 656e 2069 6e74 6572 706f  d.  When interpo
-0001cef0: 6c61 7469 6e67 2061 6c6f 6e67 206d 756c  lating along mul
-0001cf00: 7469 706c 6520 6578 6973 7469 6e67 2064  tiple existing d
-0001cf10: 696d 656e 7369 6f6e 732c 2061 6e0a 2020  imensions, an.  
-0001cf20: 2020 2020 2020 6174 7465 6d70 7420 6973        attempt is
-0001cf30: 206d 6164 6520 746f 2064 6563 6f6d 706f   made to decompo
-0001cf40: 7365 2074 6865 2069 6e74 6572 706f 6c61  se the interpola
-0001cf50: 7469 6f6e 2069 6e74 6f20 6d75 6c74 6970  tion into multip
-0001cf60: 6c65 0a20 2020 2020 2020 2031 2d64 696d  le.        1-dim
-0001cf70: 656e 7369 6f6e 616c 2069 6e74 6572 706f  ensional interpo
-0001cf80: 6c61 7469 6f6e 732e 2049 6620 7468 6973  lations. If this
-0001cf90: 2069 7320 706f 7373 6962 6c65 2c0a 2020   is possible,.  
-0001cfa0: 2020 2020 2020 3a70 793a 636c 6173 733a        :py:class:
-0001cfb0: 6073 6369 7079 2e69 6e74 6572 706f 6c61  `scipy.interpola
-0001cfc0: 7465 2e69 6e74 6572 7031 6460 2069 7320  te.interp1d` is 
-0001cfd0: 6361 6c6c 6564 2e20 4f74 6865 7277 6973  called. Otherwis
-0001cfe0: 652c 0a20 2020 2020 2020 203a 7079 3a66  e,.        :py:f
-0001cff0: 756e 633a 6073 6369 7079 2e69 6e74 6572  unc:`scipy.inter
-0001d000: 706f 6c61 7465 2e69 6e74 6572 706e 6020  polate.interpn` 
-0001d010: 6973 2063 616c 6c65 642e 0a0a 2020 2020  is called...    
-0001d020: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-0001d030: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0001d040: 2d0a 2020 2020 2020 2020 636f 6f72 6473  -.        coords
-0001d050: 203a 2064 6963 742c 206f 7074 696f 6e61   : dict, optiona
-0001d060: 6c0a 2020 2020 2020 2020 2020 2020 4d61  l.            Ma
-0001d070: 7070 696e 6720 6672 6f6d 2064 696d 656e  pping from dimen
-0001d080: 7369 6f6e 206e 616d 6573 2074 6f20 7468  sion names to th
-0001d090: 6520 6e65 7720 636f 6f72 6469 6e61 7465  e new coordinate
-0001d0a0: 732e 0a20 2020 2020 2020 2020 2020 204e  s..            N
-0001d0b0: 6577 2063 6f6f 7264 696e 6174 6520 6361  ew coordinate ca
-0001d0c0: 6e20 6265 2061 2073 6361 6c61 722c 2061  n be a scalar, a
-0001d0d0: 7272 6179 2d6c 696b 6520 6f72 2044 6174  rray-like or Dat
-0001d0e0: 6141 7272 6179 2e0a 2020 2020 2020 2020  aArray..        
-0001d0f0: 2020 2020 4966 2044 6174 6141 7272 6179      If DataArray
-0001d100: 7320 6172 6520 7061 7373 6564 2061 7320  s are passed as 
-0001d110: 6e65 7720 636f 6f72 6469 6e61 7465 732c  new coordinates,
-0001d120: 2074 6865 6972 2064 696d 656e 7369 6f6e   their dimension
-0001d130: 7320 6172 650a 2020 2020 2020 2020 2020  s are.          
-0001d140: 2020 7573 6564 2066 6f72 2074 6865 2062    used for the b
-0001d150: 726f 6164 6361 7374 696e 672e 204d 6973  roadcasting. Mis
-0001d160: 7369 6e67 2076 616c 7565 7320 6172 6520  sing values are 
-0001d170: 736b 6970 7065 642e 0a20 2020 2020 2020  skipped..       
-0001d180: 206d 6574 686f 6420 3a20 7b22 6c69 6e65   method : {"line
-0001d190: 6172 222c 2022 6e65 6172 6573 7422 2c20  ar", "nearest", 
-0001d1a0: 227a 6572 6f22 2c20 2273 6c69 6e65 6172  "zero", "slinear
-0001d1b0: 222c 2022 7175 6164 7261 7469 6322 2c20  ", "quadratic", 
-0001d1c0: 2263 7562 6963 222c 2022 706f 6c79 6e6f  "cubic", "polyno
-0001d1d0: 6d69 616c 222c 205c 0a20 2020 2020 2020  mial", \.       
-0001d1e0: 2020 2020 2022 6261 7279 6365 6e74 7269       "barycentri
-0001d1f0: 6322 2c20 226b 726f 6722 2c20 2270 6368  c", "krog", "pch
-0001d200: 6970 222c 2022 7370 6c69 6e65 222c 2022  ip", "spline", "
-0001d210: 616b 696d 6122 7d2c 2064 6566 6175 6c74  akima"}, default
-0001d220: 3a20 226c 696e 6561 7222 0a20 2020 2020  : "linear".     
-0001d230: 2020 2020 2020 2053 7472 696e 6720 696e         String in
-0001d240: 6469 6361 7469 6e67 2077 6869 6368 206d  dicating which m
-0001d250: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
-0001d260: 2069 6e74 6572 706f 6c61 7469 6f6e 3a0a   interpolation:.
-0001d270: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
-0001d280: 6c69 6e65 6172 273a 206c 696e 6561 7220  linear': linear 
-0001d290: 696e 7465 7270 6f6c 6174 696f 6e2e 2041  interpolation. A
-0001d2a0: 6464 6974 696f 6e61 6c20 6b65 7977 6f72  dditional keywor
-0001d2b0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-0001d2c0: 6172 6775 6d65 6e74 7320 6172 6520 7061  arguments are pa
-0001d2d0: 7373 6564 2074 6f20 3a70 793a 6675 6e63  ssed to :py:func
-0001d2e0: 3a60 6e75 6d70 792e 696e 7465 7270 600a  :`numpy.interp`.
-0001d2f0: 2020 2020 2020 2020 2020 2020 2d20 276e              - 'n
-0001d300: 6561 7265 7374 272c 2027 7a65 726f 272c  earest', 'zero',
-0001d310: 2027 736c 696e 6561 7227 2c20 2771 7561   'slinear', 'qua
-0001d320: 6472 6174 6963 272c 2027 6375 6269 6327  dratic', 'cubic'
-0001d330: 2c20 2770 6f6c 796e 6f6d 6961 6c27 3a0a  , 'polynomial':.
-0001d340: 2020 2020 2020 2020 2020 2020 2020 6172                ar
-0001d350: 6520 7061 7373 6564 2074 6f20 3a70 793a  e passed to :py:
-0001d360: 6675 6e63 3a60 7363 6970 792e 696e 7465  func:`scipy.inte
-0001d370: 7270 6f6c 6174 652e 696e 7465 7270 3164  rpolate.interp1d
-0001d380: 602e 2049 660a 2020 2020 2020 2020 2020  `. If.          
-0001d390: 2020 2020 6060 6d65 7468 6f64 3d27 706f      ``method='po
-0001d3a0: 6c79 6e6f 6d69 616c 2760 602c 2074 6865  lynomial'``, the
-0001d3b0: 2060 606f 7264 6572 6060 206b 6579 776f   ``order`` keywo
-0001d3c0: 7264 2061 7267 756d 656e 7420 6d75 7374  rd argument must
-0001d3d0: 2061 6c73 6f20 6265 0a20 2020 2020 2020   also be.       
-0001d3e0: 2020 2020 2020 2070 726f 7669 6465 642e         provided.
-0001d3f0: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
-0001d400: 6261 7279 6365 6e74 7269 6327 2c20 276b  barycentric', 'k
-0001d410: 726f 6727 2c20 2770 6368 6970 272c 2027  rog', 'pchip', '
-0001d420: 7370 6c69 6e65 272c 2027 616b 696d 6127  spline', 'akima'
-0001d430: 3a20 7573 6520 7468 6569 720a 2020 2020  : use their.    
-0001d440: 2020 2020 2020 2020 2020 7265 7370 6563            respec
-0001d450: 7469 7665 203a 7079 3a63 6c61 7373 3a60  tive :py:class:`
-0001d460: 7363 6970 792e 696e 7465 7270 6f6c 6174  scipy.interpolat
-0001d470: 6560 2063 6c61 7373 6573 2e0a 0a20 2020  e` classes...   
-0001d480: 2020 2020 2061 7373 756d 655f 736f 7274       assume_sort
-0001d490: 6564 203a 2062 6f6f 6c2c 2064 6566 6175  ed : bool, defau
-0001d4a0: 6c74 3a20 4661 6c73 650a 2020 2020 2020  lt: False.      
-0001d4b0: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
-0001d4c0: 7661 6c75 6573 206f 6620 636f 6f72 6469  values of coordi
-0001d4d0: 6e61 7465 7320 7468 6174 2061 7265 2069  nates that are i
-0001d4e0: 6e74 6572 706f 6c61 7465 6420 6f76 6572  nterpolated over
-0001d4f0: 2063 616e 2062 650a 2020 2020 2020 2020   can be.        
-0001d500: 2020 2020 696e 2061 6e79 206f 7264 6572      in any order
-0001d510: 2061 6e64 2074 6865 7920 6172 6520 736f   and they are so
-0001d520: 7274 6564 2066 6972 7374 2e20 4966 2054  rted first. If T
-0001d530: 7275 652c 2069 6e74 6572 706f 6c61 7465  rue, interpolate
-0001d540: 640a 2020 2020 2020 2020 2020 2020 636f  d.            co
-0001d550: 6f72 6469 6e61 7465 7320 6172 6520 6173  ordinates are as
-0001d560: 7375 6d65 6420 746f 2062 6520 616e 2061  sumed to be an a
-0001d570: 7272 6179 206f 6620 6d6f 6e6f 746f 6e69  rray of monotoni
-0001d580: 6361 6c6c 7920 696e 6372 6561 7369 6e67  cally increasing
-0001d590: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-0001d5a0: 7565 732e 0a20 2020 2020 2020 206b 7761  ues..        kwa
-0001d5b0: 7267 7320 3a20 6469 6374 2c20 6f70 7469  rgs : dict, opti
-0001d5c0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-0001d5d0: 2041 6464 6974 696f 6e61 6c20 6b65 7977   Additional keyw
-0001d5e0: 6f72 6420 6172 6775 6d65 6e74 7320 7061  ord arguments pa
-0001d5f0: 7373 6564 2074 6f20 7363 6970 7927 7320  ssed to scipy's 
-0001d600: 696e 7465 7270 6f6c 6174 6f72 2e20 5661  interpolator. Va
-0001d610: 6c69 640a 2020 2020 2020 2020 2020 2020  lid.            
-0001d620: 6f70 7469 6f6e 7320 616e 6420 7468 6569  options and thei
-0001d630: 7220 6265 6861 7669 6f72 2064 6570 656e  r behavior depen
-0001d640: 6420 7768 6574 6865 7220 6060 696e 7465  d whether ``inte
-0001d650: 7270 3164 6060 206f 720a 2020 2020 2020  rp1d`` or.      
-0001d660: 2020 2020 2020 6060 696e 7465 7270 6e60        ``interpn`
-0001d670: 6020 6973 2075 7365 642e 0a20 2020 2020  ` is used..     
-0001d680: 2020 206d 6574 686f 645f 6e6f 6e5f 6e75     method_non_nu
-0001d690: 6d65 7269 6320 3a20 7b22 6e65 6172 6573  meric : {"neares
-0001d6a0: 7422 2c20 2270 6164 222c 2022 6666 696c  t", "pad", "ffil
-0001d6b0: 6c22 2c20 2262 6163 6b66 696c 6c22 2c20  l", "backfill", 
-0001d6c0: 2262 6669 6c6c 227d 2c20 6f70 7469 6f6e  "bfill"}, option
-0001d6d0: 616c 0a20 2020 2020 2020 2020 2020 204d  al.            M
-0001d6e0: 6574 686f 6420 666f 7220 6e6f 6e2d 6e75  ethod for non-nu
-0001d6f0: 6d65 7269 6320 7479 7065 732e 2050 6173  meric types. Pas
-0001d700: 7365 6420 6f6e 2074 6f20 3a70 793a 6d65  sed on to :py:me
-0001d710: 7468 3a60 4461 7461 7365 742e 7265 696e  th:`Dataset.rein
-0001d720: 6465 7860 2e0a 2020 2020 2020 2020 2020  dex`..          
-0001d730: 2020 6060 226e 6561 7265 7374 2260 6020    ``"nearest"`` 
-0001d740: 6973 2075 7365 6420 6279 2064 6566 6175  is used by defau
-0001d750: 6c74 2e0a 2020 2020 2020 2020 2a2a 636f  lt..        **co
-0001d760: 6f72 6473 5f6b 7761 7267 7320 3a20 7b64  ords_kwargs : {d
-0001d770: 696d 3a20 636f 6f72 6469 6e61 7465 2c20  im: coordinate, 
-0001d780: 2e2e 2e7d 2c20 6f70 7469 6f6e 616c 0a20  ...}, optional. 
-0001d790: 2020 2020 2020 2020 2020 2054 6865 206b             The k
-0001d7a0: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-0001d7b0: 2066 6f72 6d20 6f66 2060 6063 6f6f 7264   form of ``coord
-0001d7c0: 7360 602e 0a20 2020 2020 2020 2020 2020  s``..           
-0001d7d0: 204f 6e65 206f 6620 636f 6f72 6473 206f   One of coords o
-0001d7e0: 7220 636f 6f72 6473 5f6b 7761 7267 7320  r coords_kwargs 
-0001d7f0: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
-0001d800: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0001d810: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-0001d820: 2d2d 0a20 2020 2020 2020 2069 6e74 6572  --.        inter
-0001d830: 706f 6c61 7465 6420 3a20 4461 7461 7365  polated : Datase
-0001d840: 740a 2020 2020 2020 2020 2020 2020 4e65  t.            Ne
-0001d850: 7720 6461 7461 7365 7420 6f6e 2074 6865  w dataset on the
-0001d860: 206e 6577 2063 6f6f 7264 696e 6174 6573   new coordinates
-0001d870: 2e0a 0a20 2020 2020 2020 204e 6f74 6573  ...        Notes
-0001d880: 0a20 2020 2020 2020 202d 2d2d 2d2d 0a20  .        -----. 
-0001d890: 2020 2020 2020 2073 6369 7079 2069 7320         scipy is 
-0001d8a0: 7265 7175 6972 6564 2e0a 0a20 2020 2020  required...     
-0001d8b0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-0001d8c0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-0001d8d0: 2020 2020 2073 6369 7079 2e69 6e74 6572       scipy.inter
-0001d8e0: 706f 6c61 7465 2e69 6e74 6572 7031 640a  polate.interp1d.
-0001d8f0: 2020 2020 2020 2020 7363 6970 792e 696e          scipy.in
-0001d900: 7465 7270 6f6c 6174 652e 696e 7465 7270  terpolate.interp
-0001d910: 6e0a 0a20 2020 2020 2020 2045 7861 6d70  n..        Examp
-0001d920: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
-0001d930: 2d2d 2d2d 0a20 2020 2020 2020 203e 3e3e  ----.        >>>
-0001d940: 2064 7320 3d20 7872 2e44 6174 6173 6574   ds = xr.Dataset
-0001d950: 280a 2020 2020 2020 2020 2e2e 2e20 2020  (.        ...   
-0001d960: 2020 6461 7461 5f76 6172 733d 7b0a 2020    data_vars={.  
-0001d970: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
-0001d980: 2020 2261 223a 2028 2278 222c 205b 352c    "a": ("x", [5,
-0001d990: 2037 2c20 345d 292c 0a20 2020 2020 2020   7, 4]),.       
-0001d9a0: 202e 2e2e 2020 2020 2020 2020 2022 6222   ...         "b"
-0001d9b0: 3a20 280a 2020 2020 2020 2020 2e2e 2e20  : (.        ... 
-0001d9c0: 2020 2020 2020 2020 2020 2020 2822 7822              ("x"
-0001d9d0: 2c20 2279 2229 2c0a 2020 2020 2020 2020  , "y"),.        
-0001d9e0: 2e2e 2e20 2020 2020 2020 2020 2020 2020  ...             
-0001d9f0: 5b5b 312c 2034 2c20 322c 2039 5d2c 205b  [[1, 4, 2, 9], [
-0001da00: 322c 2037 2c20 362c 206e 702e 6e61 6e5d  2, 7, 6, np.nan]
-0001da10: 2c20 5b36 2c20 6e70 2e6e 616e 2c20 352c  , [6, np.nan, 5,
-0001da20: 2038 5d5d 2c0a 2020 2020 2020 2020 2e2e   8]],.        ..
-0001da30: 2e20 2020 2020 2020 2020 292c 0a20 2020  .         ),.   
-0001da40: 2020 2020 202e 2e2e 2020 2020 207d 2c0a       ...     },.
-0001da50: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-0001da60: 636f 6f72 6473 3d7b 2278 223a 205b 302c  coords={"x": [0,
-0001da70: 2031 2c20 325d 2c20 2279 223a 205b 3130   1, 2], "y": [10
-0001da80: 2c20 3132 2c20 3134 2c20 3136 5d7d 2c0a  , 12, 14, 16]},.
-0001da90: 2020 2020 2020 2020 2e2e 2e20 290a 2020          ... ).  
-0001daa0: 2020 2020 2020 3e3e 3e20 6473 0a20 2020        >>> ds.   
-0001dab0: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
-0001dac0: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
-0001dad0: 6d65 6e73 696f 6e73 3a20 2028 783a 2033  mensions:  (x: 3
-0001dae0: 2c20 793a 2034 290a 2020 2020 2020 2020  , y: 4).        
-0001daf0: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
-0001db00: 2020 2020 2020 202a 2078 2020 2020 2020         * x      
-0001db10: 2020 2878 2920 696e 7436 3420 3020 3120    (x) int64 0 1 
-0001db20: 320a 2020 2020 2020 2020 2020 2a20 7920  2.          * y 
-0001db30: 2020 2020 2020 2028 7929 2069 6e74 3634         (y) int64
-0001db40: 2031 3020 3132 2031 3420 3136 0a20 2020   10 12 14 16.   
-0001db50: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
-0001db60: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-0001db70: 2061 2020 2020 2020 2020 2878 2920 696e   a        (x) in
-0001db80: 7436 3420 3520 3720 340a 2020 2020 2020  t64 5 7 4.      
-0001db90: 2020 2020 2020 6220 2020 2020 2020 2028        b        (
-0001dba0: 782c 2079 2920 666c 6f61 7436 3420 312e  x, y) float64 1.
-0001dbb0: 3020 342e 3020 322e 3020 392e 3020 322e  0 4.0 2.0 9.0 2.
-0001dbc0: 3020 372e 3020 362e 3020 6e61 6e20 362e  0 7.0 6.0 nan 6.
-0001dbd0: 3020 6e61 6e20 352e 3020 382e 300a 0a20  0 nan 5.0 8.0.. 
-0001dbe0: 2020 2020 2020 2031 4420 696e 7465 7270         1D interp
-0001dbf0: 6f6c 6174 696f 6e20 7769 7468 2074 6865  olation with the
-0001dc00: 2064 6566 6175 6c74 206d 6574 686f 6420   default method 
-0001dc10: 286c 696e 6561 7229 3a0a 0a20 2020 2020  (linear):..     
-0001dc20: 2020 203e 3e3e 2064 732e 696e 7465 7270     >>> ds.interp
-0001dc30: 2878 3d5b 302c 2030 2e37 352c 2031 2e32  (x=[0, 0.75, 1.2
-0001dc40: 352c 2031 2e37 355d 290a 2020 2020 2020  5, 1.75]).      
-0001dc50: 2020 3c78 6172 7261 792e 4461 7461 7365    <xarray.Datase
-0001dc60: 743e 0a20 2020 2020 2020 2044 696d 656e  t>.        Dimen
-0001dc70: 7369 6f6e 733a 2020 2878 3a20 342c 2079  sions:  (x: 4, y
-0001dc80: 3a20 3429 0a20 2020 2020 2020 2043 6f6f  : 4).        Coo
-0001dc90: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
-0001dca0: 2020 2020 2a20 7920 2020 2020 2020 2028      * y        (
-0001dcb0: 7929 2069 6e74 3634 2031 3020 3132 2031  y) int64 10 12 1
-0001dcc0: 3420 3136 0a20 2020 2020 2020 2020 202a  4 16.          *
-0001dcd0: 2078 2020 2020 2020 2020 2878 2920 666c   x        (x) fl
-0001dce0: 6f61 7436 3420 302e 3020 302e 3735 2031  oat64 0.0 0.75 1
-0001dcf0: 2e32 3520 312e 3735 0a20 2020 2020 2020  .25 1.75.       
-0001dd00: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
-0001dd10: 0a20 2020 2020 2020 2020 2020 2061 2020  .            a  
-0001dd20: 2020 2020 2020 2878 2920 666c 6f61 7436        (x) float6
-0001dd30: 3420 352e 3020 362e 3520 362e 3235 2034  4 5.0 6.5 6.25 4
-0001dd40: 2e37 350a 2020 2020 2020 2020 2020 2020  .75.            
-0001dd50: 6220 2020 2020 2020 2028 782c 2079 2920  b        (x, y) 
-0001dd60: 666c 6f61 7436 3420 312e 3020 342e 3020  float64 1.0 4.0 
-0001dd70: 322e 3020 6e61 6e20 312e 3735 2036 2e32  2.0 nan 1.75 6.2
-0001dd80: 3520 2e2e 2e20 6e61 6e20 352e 3020 6e61  5 ... nan 5.0 na
-0001dd90: 6e20 352e 3235 206e 616e 0a0a 2020 2020  n 5.25 nan..    
-0001dda0: 2020 2020 3144 2069 6e74 6572 706f 6c61      1D interpola
-0001ddb0: 7469 6f6e 2077 6974 6820 6120 6469 6666  tion with a diff
-0001ddc0: 6572 656e 7420 6d65 7468 6f64 3a0a 0a20  erent method:.. 
-0001ddd0: 2020 2020 2020 203e 3e3e 2064 732e 696e         >>> ds.in
-0001dde0: 7465 7270 2878 3d5b 302c 2030 2e37 352c  terp(x=[0, 0.75,
-0001ddf0: 2031 2e32 352c 2031 2e37 355d 2c20 6d65   1.25, 1.75], me
-0001de00: 7468 6f64 3d22 6e65 6172 6573 7422 290a  thod="nearest").
-0001de10: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-0001de20: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-0001de30: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
-0001de40: 3a20 342c 2079 3a20 3429 0a20 2020 2020  : 4, y: 4).     
-0001de50: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-0001de60: 2020 2020 2020 2020 2020 2a20 7920 2020            * y   
-0001de70: 2020 2020 2028 7929 2069 6e74 3634 2031       (y) int64 1
-0001de80: 3020 3132 2031 3420 3136 0a20 2020 2020  0 12 14 16.     
-0001de90: 2020 2020 202a 2078 2020 2020 2020 2020       * x        
-0001dea0: 2878 2920 666c 6f61 7436 3420 302e 3020  (x) float64 0.0 
-0001deb0: 302e 3735 2031 2e32 3520 312e 3735 0a20  0.75 1.25 1.75. 
-0001dec0: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
-0001ded0: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
-0001dee0: 2020 2061 2020 2020 2020 2020 2878 2920     a        (x) 
-0001def0: 666c 6f61 7436 3420 352e 3020 372e 3020  float64 5.0 7.0 
-0001df00: 372e 3020 342e 300a 2020 2020 2020 2020  7.0 4.0.        
-0001df10: 2020 2020 6220 2020 2020 2020 2028 782c      b        (x,
-0001df20: 2079 2920 666c 6f61 7436 3420 312e 3020   y) float64 1.0 
-0001df30: 342e 3020 322e 3020 392e 3020 322e 3020  4.0 2.0 9.0 2.0 
-0001df40: 372e 3020 2e2e 2e20 362e 3020 6e61 6e20  7.0 ... 6.0 nan 
-0001df50: 362e 3020 6e61 6e20 352e 3020 382e 300a  6.0 nan 5.0 8.0.
-0001df60: 0a20 2020 2020 2020 2031 4420 6578 7472  .        1D extr
-0001df70: 6170 6f6c 6174 696f 6e3a 0a0a 2020 2020  apolation:..    
-0001df80: 2020 2020 3e3e 3e20 6473 2e69 6e74 6572      >>> ds.inter
-0001df90: 7028 0a20 2020 2020 2020 202e 2e2e 2020  p(.        ...  
-0001dfa0: 2020 2078 3d5b 312c 2031 2e35 2c20 322e     x=[1, 1.5, 2.
-0001dfb0: 352c 2033 2e35 5d2c 0a20 2020 2020 2020  5, 3.5],.       
-0001dfc0: 202e 2e2e 2020 2020 206d 6574 686f 643d   ...     method=
-0001dfd0: 226c 696e 6561 7222 2c0a 2020 2020 2020  "linear",.      
-0001dfe0: 2020 2e2e 2e20 2020 2020 6b77 6172 6773    ...     kwargs
-0001dff0: 3d7b 2266 696c 6c5f 7661 6c75 6522 3a20  ={"fill_value": 
-0001e000: 2265 7874 7261 706f 6c61 7465 227d 2c0a  "extrapolate"},.
-0001e010: 2020 2020 2020 2020 2e2e 2e20 290a 2020          ... ).  
-0001e020: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-0001e030: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-0001e040: 696d 656e 7369 6f6e 733a 2020 2878 3a20  imensions:  (x: 
-0001e050: 342c 2079 3a20 3429 0a20 2020 2020 2020  4, y: 4).       
-0001e060: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
-0001e070: 2020 2020 2020 2020 2a20 7920 2020 2020          * y     
-0001e080: 2020 2028 7929 2069 6e74 3634 2031 3020     (y) int64 10 
-0001e090: 3132 2031 3420 3136 0a20 2020 2020 2020  12 14 16.       
-0001e0a0: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
-0001e0b0: 2920 666c 6f61 7436 3420 312e 3020 312e  ) float64 1.0 1.
-0001e0c0: 3520 322e 3520 332e 350a 2020 2020 2020  5 2.5 3.5.      
-0001e0d0: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
-0001e0e0: 3a0a 2020 2020 2020 2020 2020 2020 6120  :.            a 
-0001e0f0: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
-0001e100: 3634 2037 2e30 2035 2e35 2032 2e35 202d  64 7.0 5.5 2.5 -
-0001e110: 302e 350a 2020 2020 2020 2020 2020 2020  0.5.            
-0001e120: 6220 2020 2020 2020 2028 782c 2079 2920  b        (x, y) 
-0001e130: 666c 6f61 7436 3420 322e 3020 372e 3020  float64 2.0 7.0 
-0001e140: 362e 3020 6e61 6e20 342e 3020 6e61 6e20  6.0 nan 4.0 nan 
-0001e150: 2e2e 2e20 342e 3520 6e61 6e20 3132 2e30  ... 4.5 nan 12.0
-0001e160: 206e 616e 2033 2e35 206e 616e 0a0a 2020   nan 3.5 nan..  
-0001e170: 2020 2020 2020 3244 2069 6e74 6572 706f        2D interpo
-0001e180: 6c61 7469 6f6e 3a0a 0a20 2020 2020 2020  lation:..       
-0001e190: 203e 3e3e 2064 732e 696e 7465 7270 2878   >>> ds.interp(x
-0001e1a0: 3d5b 302c 2030 2e37 352c 2031 2e32 352c  =[0, 0.75, 1.25,
-0001e1b0: 2031 2e37 355d 2c20 793d 5b31 312c 2031   1.75], y=[11, 1
-0001e1c0: 332c 2031 355d 2c20 6d65 7468 6f64 3d22  3, 15], method="
-0001e1d0: 6c69 6e65 6172 2229 0a20 2020 2020 2020  linear").       
-0001e1e0: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-0001e1f0: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-0001e200: 696f 6e73 3a20 2028 783a 2034 2c20 793a  ions:  (x: 4, y:
-0001e210: 2033 290a 2020 2020 2020 2020 436f 6f72   3).        Coor
-0001e220: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-0001e230: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
-0001e240: 2920 666c 6f61 7436 3420 302e 3020 302e  ) float64 0.0 0.
-0001e250: 3735 2031 2e32 3520 312e 3735 0a20 2020  75 1.25 1.75.   
-0001e260: 2020 2020 2020 202a 2079 2020 2020 2020         * y      
-0001e270: 2020 2879 2920 696e 7436 3420 3131 2031    (y) int64 11 1
-0001e280: 3320 3135 0a20 2020 2020 2020 2044 6174  3 15.        Dat
-0001e290: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
-0001e2a0: 2020 2020 2020 2020 2061 2020 2020 2020           a      
-0001e2b0: 2020 2878 2920 666c 6f61 7436 3420 352e    (x) float64 5.
-0001e2c0: 3020 362e 3520 362e 3235 2034 2e37 350a  0 6.5 6.25 4.75.
-0001e2d0: 2020 2020 2020 2020 2020 2020 6220 2020              b   
-0001e2e0: 2020 2020 2028 782c 2079 2920 666c 6f61       (x, y) floa
-0001e2f0: 7436 3420 322e 3520 332e 3020 6e61 6e20  t64 2.5 3.0 nan 
-0001e300: 342e 3020 352e 3632 3520 6e61 6e20 6e61  4.0 5.625 nan na
-0001e310: 6e20 6e61 6e20 6e61 6e20 6e61 6e20 6e61  n nan nan nan na
-0001e320: 6e20 6e61 6e0a 2020 2020 2020 2020 2222  n nan.        ""
-0001e330: 220a 2020 2020 2020 2020 6672 6f6d 2078  ".        from x
-0001e340: 6172 7261 792e 636f 7265 2069 6d70 6f72  array.core impor
-0001e350: 7420 6d69 7373 696e 670a 0a20 2020 2020  t missing..     
-0001e360: 2020 2069 6620 6b77 6172 6773 2069 7320     if kwargs is 
-0001e370: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001e380: 2020 6b77 6172 6773 203d 207b 7d0a 0a20    kwargs = {}.. 
-0001e390: 2020 2020 2020 2063 6f6f 7264 7320 3d20         coords = 
-0001e3a0: 6569 7468 6572 5f64 6963 745f 6f72 5f6b  either_dict_or_k
-0001e3b0: 7761 7267 7328 636f 6f72 6473 2c20 636f  wargs(coords, co
-0001e3c0: 6f72 6473 5f6b 7761 7267 732c 2022 696e  ords_kwargs, "in
-0001e3d0: 7465 7270 2229 0a20 2020 2020 2020 2069  terp").        i
-0001e3e0: 6e64 6578 6572 7320 3d20 6469 6374 2873  ndexers = dict(s
-0001e3f0: 656c 662e 5f76 616c 6964 6174 655f 696e  elf._validate_in
-0001e400: 7465 7270 5f69 6e64 6578 6572 7328 636f  terp_indexers(co
-0001e410: 6f72 6473 2929 0a0a 2020 2020 2020 2020  ords))..        
-0001e420: 6966 2063 6f6f 7264 733a 0a20 2020 2020  if coords:.     
-0001e430: 2020 2020 2020 2023 2054 6869 7320 6176         # This av
-0001e440: 6f69 6473 2062 726f 6164 6361 7374 696e  oids broadcastin
-0001e450: 6720 6f76 6572 2063 6f6f 7264 696e 6174  g over coordinat
-0001e460: 6573 2074 6861 7420 6172 6520 626f 7468  es that are both
-0001e470: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
-0001e480: 2320 7468 6520 6f72 6967 696e 616c 2061  # the original a
-0001e490: 7272 6179 2041 4e44 2069 6e20 7468 6520  rray AND in the 
-0001e4a0: 696e 6465 7869 6e67 2061 7272 6179 2e20  indexing array. 
-0001e4b0: 4974 2065 7373 656e 7469 616c 6c79 0a20  It essentially. 
-0001e4c0: 2020 2020 2020 2020 2020 2023 2066 6f72             # for
-0001e4d0: 6365 7320 696e 7465 7270 6f6c 6174 696f  ces interpolatio
-0001e4e0: 6e20 616c 6f6e 6720 7468 6520 7368 6172  n along the shar
-0001e4f0: 6564 2063 6f6f 7264 696e 6174 6573 2e0a  ed coordinates..
-0001e500: 2020 2020 2020 2020 2020 2020 7364 696d              sdim
-0001e510: 7320 3d20 280a 2020 2020 2020 2020 2020  s = (.          
-0001e520: 2020 2020 2020 7365 7428 7365 6c66 2e64        set(self.d
-0001e530: 696d 7329 0a20 2020 2020 2020 2020 2020  ims).           
-0001e540: 2020 2020 202e 696e 7465 7273 6563 7469       .intersecti
-0001e550: 6f6e 282a 5b73 6574 286e 782e 6469 6d73  on(*[set(nx.dims
-0001e560: 2920 666f 7220 6e78 2069 6e20 696e 6465  ) for nx in inde
-0001e570: 7865 7273 2e76 616c 7565 7328 295d 290a  xers.values()]).
-0001e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e590: 2e64 6966 6665 7265 6e63 6528 636f 6f72  .difference(coor
-0001e5a0: 6473 2e6b 6579 7328 2929 0a20 2020 2020  ds.keys()).     
-0001e5b0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001e5c0: 2020 2020 2069 6e64 6578 6572 732e 7570       indexers.up
-0001e5d0: 6461 7465 287b 643a 2073 656c 662e 7661  date({d: self.va
-0001e5e0: 7269 6162 6c65 735b 645d 2066 6f72 2064  riables[d] for d
-0001e5f0: 2069 6e20 7364 696d 737d 290a 0a20 2020   in sdims})..   
-0001e600: 2020 2020 206f 626a 203d 2073 656c 6620       obj = self 
-0001e610: 6966 2061 7373 756d 655f 736f 7274 6564  if assume_sorted
-0001e620: 2065 6c73 6520 7365 6c66 2e73 6f72 7462   else self.sortb
-0001e630: 7928 5b6b 2066 6f72 206b 2069 6e20 636f  y([k for k in co
-0001e640: 6f72 6473 5d29 0a0a 2020 2020 2020 2020  ords])..        
-0001e650: 6465 6620 6d61 7962 655f 7661 7269 6162  def maybe_variab
-0001e660: 6c65 286f 626a 2c20 6b29 3a0a 2020 2020  le(obj, k):.    
-0001e670: 2020 2020 2020 2020 2320 776f 726b 6172          # workar
-0001e680: 6f75 6e64 2074 6f20 6765 7420 7661 7269  ound to get vari
-0001e690: 6162 6c65 2066 6f72 2064 696d 656e 7369  able for dimensi
-0001e6a0: 6f6e 2077 6974 686f 7574 2063 6f6f 7264  on without coord
-0001e6b0: 696e 6174 652e 0a20 2020 2020 2020 2020  inate..         
-0001e6c0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0001e6d0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0001e6e0: 626a 2e5f 7661 7269 6162 6c65 735b 6b5d  bj._variables[k]
-0001e6f0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-0001e700: 6570 7420 4b65 7945 7272 6f72 3a0a 2020  ept KeyError:.  
-0001e710: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001e720: 7475 726e 2061 735f 7661 7269 6162 6c65  turn as_variable
-0001e730: 2828 6b2c 2072 616e 6765 286f 626a 2e64  ((k, range(obj.d
-0001e740: 696d 735b 6b5d 2929 290a 0a20 2020 2020  ims[k])))..     
-0001e750: 2020 2064 6566 205f 7661 6c69 6461 7465     def _validate
-0001e760: 5f69 6e74 6572 705f 696e 6465 7865 7228  _interp_indexer(
-0001e770: 782c 206e 6577 5f78 293a 0a20 2020 2020  x, new_x):.     
-0001e780: 2020 2020 2020 2023 2049 6e20 7468 6520         # In the 
-0001e790: 6361 7365 206f 6620 6461 7465 7469 6d65  case of datetime
-0001e7a0: 732c 2074 6865 2072 6573 7472 6963 7469  s, the restricti
-0001e7b0: 6f6e 7320 706c 6163 6564 206f 6e20 696e  ons placed on in
-0001e7c0: 6465 7865 7273 0a20 2020 2020 2020 2020  dexers.         
-0001e7d0: 2020 2023 2075 7365 6420 7769 7468 2069     # used with i
-0001e7e0: 6e74 6572 7020 6172 6520 7374 726f 6e67  nterp are strong
-0001e7f0: 6572 2074 6861 6e20 7468 6f73 6520 7768  er than those wh
-0001e800: 6963 6820 6172 6520 706c 6163 6564 206f  ich are placed o
-0001e810: 6e0a 2020 2020 2020 2020 2020 2020 2320  n.            # 
-0001e820: 6973 656c 2c20 736f 2077 6520 6e65 6564  isel, so we need
-0001e830: 2061 6e20 6164 6469 7469 6f6e 616c 2063   an additional c
-0001e840: 6865 636b 2061 6674 6572 205f 7661 6c69  heck after _vali
-0001e850: 6461 7465 5f69 6e64 6578 6572 732e 0a20  date_indexers.. 
-0001e860: 2020 2020 2020 2020 2020 2069 6620 5f63             if _c
-0001e870: 6f6e 7461 696e 735f 6461 7465 7469 6d65  ontains_datetime
-0001e880: 5f6c 696b 655f 6f62 6a65 6374 7328 0a20  _like_objects(. 
-0001e890: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0001e8a0: 0a20 2020 2020 2020 2020 2020 2029 2061  .            ) a
-0001e8b0: 6e64 206e 6f74 205f 636f 6e74 6169 6e73  nd not _contains
-0001e8c0: 5f64 6174 6574 696d 655f 6c69 6b65 5f6f  _datetime_like_o
-0001e8d0: 626a 6563 7473 286e 6577 5f78 293a 0a20  bjects(new_x):. 
-0001e8e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001e8f0: 6169 7365 2054 7970 6545 7272 6f72 280a  aise TypeError(.
-0001e900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e910: 2020 2020 2257 6865 6e20 696e 7465 7270      "When interp
-0001e920: 6f6c 6174 696e 6720 6f76 6572 2061 2064  olating over a d
-0001e930: 6174 6574 696d 652d 6c69 6b65 2022 0a20  atetime-like ". 
-0001e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e950: 2020 2022 636f 6f72 6469 6e61 7465 2c20     "coordinate, 
-0001e960: 7468 6520 636f 6f72 6469 6e61 7465 7320  the coordinates 
-0001e970: 746f 2022 0a20 2020 2020 2020 2020 2020  to ".           
-0001e980: 2020 2020 2020 2020 2022 696e 7465 7270           "interp
-0001e990: 6f6c 6174 6520 746f 206d 7573 7420 6265  olate to must be
-0001e9a0: 2065 6974 6865 7220 6461 7465 7469 6d65   either datetime
-0001e9b0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0001e9c0: 2020 2020 2020 2022 7374 7269 6e67 7320         "strings 
-0001e9d0: 6f72 2064 6174 6574 696d 6573 2e20 220a  or datetimes. ".
-0001e9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e9f0: 2020 2020 2249 6e73 7465 6164 2067 6f74      "Instead got
-0001ea00: 5c6e 7b7d 222e 666f 726d 6174 286e 6577  \n{}".format(new
-0001ea10: 5f78 290a 2020 2020 2020 2020 2020 2020  _x).            
-0001ea20: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0001ea30: 2020 7265 7475 726e 2078 2c20 6e65 775f    return x, new_
-0001ea40: 780a 0a20 2020 2020 2020 2076 616c 6964  x..        valid
-0001ea50: 6174 6564 5f69 6e64 6578 6572 7320 3d20  ated_indexers = 
-0001ea60: 7b0a 2020 2020 2020 2020 2020 2020 6b3a  {.            k:
-0001ea70: 205f 7661 6c69 6461 7465 5f69 6e74 6572   _validate_inter
-0001ea80: 705f 696e 6465 7865 7228 6d61 7962 655f  p_indexer(maybe_
-0001ea90: 7661 7269 6162 6c65 286f 626a 2c20 6b29  variable(obj, k)
-0001eaa0: 2c20 7629 0a20 2020 2020 2020 2020 2020  , v).           
-0001eab0: 2066 6f72 206b 2c20 7620 696e 2069 6e64   for k, v in ind
-0001eac0: 6578 6572 732e 6974 656d 7328 290a 2020  exers.items().  
-0001ead0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-0001eae0: 2023 206f 7074 696d 697a 6174 696f 6e3a   # optimization:
-0001eaf0: 2073 7562 7365 7420 746f 2063 6f6f 7264   subset to coord
-0001eb00: 696e 6174 6520 7261 6e67 6520 6f66 2074  inate range of t
-0001eb10: 6865 2074 6172 6765 7420 696e 6465 780a  he target index.
-0001eb20: 2020 2020 2020 2020 6966 206d 6574 686f          if metho
-0001eb30: 6420 696e 205b 226c 696e 6561 7222 2c20  d in ["linear", 
-0001eb40: 226e 6561 7265 7374 225d 3a0a 2020 2020  "nearest"]:.    
-0001eb50: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-0001eb60: 2069 6e20 7661 6c69 6461 7465 645f 696e   in validated_in
-0001eb70: 6465 7865 7273 2e69 7465 6d73 2829 3a0a  dexers.items():.
-0001eb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb90: 6f62 6a2c 206e 6577 6964 7820 3d20 6d69  obj, newidx = mi
-0001eba0: 7373 696e 672e 5f6c 6f63 616c 697a 6528  ssing._localize(
-0001ebb0: 6f62 6a2c 207b 6b3a 2076 7d29 0a20 2020  obj, {k: v}).   
-0001ebc0: 2020 2020 2020 2020 2020 2020 2076 616c               val
-0001ebd0: 6964 6174 6564 5f69 6e64 6578 6572 735b  idated_indexers[
-0001ebe0: 6b5d 203d 206e 6577 6964 785b 6b5d 0a0a  k] = newidx[k]..
-0001ebf0: 2020 2020 2020 2020 2320 6f70 7469 6d69          # optimi
-0001ec00: 7a61 7469 6f6e 3a20 6372 6561 7465 2064  zation: create d
-0001ec10: 6173 6b20 636f 6f72 6469 6e61 7465 2061  ask coordinate a
-0001ec20: 7272 6179 7320 6f6e 6365 2070 6572 2044  rrays once per D
-0001ec30: 6174 6173 6574 0a20 2020 2020 2020 2023  ataset.        #
-0001ec40: 2072 6174 6865 7220 7468 616e 206f 6e63   rather than onc
-0001ec50: 6520 7065 7220 5661 7269 6162 6c65 2077  e per Variable w
-0001ec60: 6865 6e20 6461 736b 2e61 7272 6179 2e75  hen dask.array.u
-0001ec70: 6e69 6679 5f63 6875 6e6b 7320 6973 2063  nify_chunks is c
-0001ec80: 616c 6c65 6420 6c61 7465 720a 2020 2020  alled later.    
-0001ec90: 2020 2020 2320 4748 3437 3339 0a20 2020      # GH4739.   
-0001eca0: 2020 2020 2069 6620 6f62 6a2e 5f5f 6461       if obj.__da
-0001ecb0: 736b 5f67 7261 7068 5f5f 2829 3a0a 2020  sk_graph__():.  
-0001ecc0: 2020 2020 2020 2020 2020 6461 736b 5f69            dask_i
-0001ecd0: 6e64 6578 6572 7320 3d20 7b0a 2020 2020  ndexers = {.    
-0001ece0: 2020 2020 2020 2020 2020 2020 6b3a 2028              k: (
-0001ecf0: 696e 6465 782e 746f 5f62 6173 655f 7661  index.to_base_va
-0001ed00: 7269 6162 6c65 2829 2e63 6875 6e6b 2829  riable().chunk()
-0001ed10: 2c20 6465 7374 2e74 6f5f 6261 7365 5f76  , dest.to_base_v
-0001ed20: 6172 6961 626c 6528 292e 6368 756e 6b28  ariable().chunk(
-0001ed30: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0001ed40: 2020 2066 6f72 206b 2c20 2869 6e64 6578     for k, (index
-0001ed50: 2c20 6465 7374 2920 696e 2076 616c 6964  , dest) in valid
-0001ed60: 6174 6564 5f69 6e64 6578 6572 732e 6974  ated_indexers.it
-0001ed70: 656d 7328 290a 2020 2020 2020 2020 2020  ems().          
-0001ed80: 2020 7d0a 0a20 2020 2020 2020 2076 6172    }..        var
-0001ed90: 6961 626c 6573 3a20 6469 6374 5b48 6173  iables: dict[Has
-0001eda0: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
-0001edb0: 203d 207b 7d0a 2020 2020 2020 2020 7265   = {}.        re
-0001edc0: 696e 6465 783a 2062 6f6f 6c20 3d20 4661  index: bool = Fa
-0001edd0: 6c73 650a 2020 2020 2020 2020 666f 7220  lse.        for 
-0001ede0: 6e61 6d65 2c20 7661 7220 696e 206f 626a  name, var in obj
-0001edf0: 2e5f 7661 7269 6162 6c65 732e 6974 656d  ._variables.item
-0001ee00: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0001ee10: 2069 6620 6e61 6d65 2069 6e20 696e 6465   if name in inde
-0001ee20: 7865 7273 3a0a 2020 2020 2020 2020 2020  xers:.          
-0001ee30: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
-0001ee40: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0001ee50: 735f 6475 636b 5f64 6173 6b5f 6172 7261  s_duck_dask_arra
-0001ee60: 7928 7661 722e 6461 7461 293a 0a20 2020  y(var.data):.   
-0001ee70: 2020 2020 2020 2020 2020 2020 2075 7365               use
-0001ee80: 5f69 6e64 6578 6572 7320 3d20 6461 736b  _indexers = dask
-0001ee90: 5f69 6e64 6578 6572 730a 2020 2020 2020  _indexers.      
-0001eea0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001eeb0: 2020 2020 2020 2020 2020 2020 7573 655f              use_
-0001eec0: 696e 6465 7865 7273 203d 2076 616c 6964  indexers = valid
-0001eed0: 6174 6564 5f69 6e64 6578 6572 730a 0a20  ated_indexers.. 
-0001eee0: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
-0001eef0: 5f6b 696e 6420 3d20 7661 722e 6474 7970  _kind = var.dtyp
-0001ef00: 652e 6b69 6e64 0a20 2020 2020 2020 2020  e.kind.         
-0001ef10: 2020 2069 6620 6474 7970 655f 6b69 6e64     if dtype_kind
-0001ef20: 2069 6e20 2275 6966 6322 3a0a 2020 2020   in "uifc":.    
-0001ef30: 2020 2020 2020 2020 2020 2020 2320 466f              # Fo
-0001ef40: 7220 6e6f 726d 616c 206e 756d 6265 7220  r normal number 
-0001ef50: 7479 7065 7320 646f 2074 6865 2069 6e74  types do the int
-0001ef60: 6572 706f 6c61 7469 6f6e 3a0a 2020 2020  erpolation:.    
-0001ef70: 2020 2020 2020 2020 2020 2020 7661 725f              var_
-0001ef80: 696e 6465 7865 7273 203d 207b 6b3a 2076  indexers = {k: v
-0001ef90: 2066 6f72 206b 2c20 7620 696e 2075 7365   for k, v in use
-0001efa0: 5f69 6e64 6578 6572 732e 6974 656d 7328  _indexers.items(
-0001efb0: 2920 6966 206b 2069 6e20 7661 722e 6469  ) if k in var.di
-0001efc0: 6d73 7d0a 2020 2020 2020 2020 2020 2020  ms}.            
-0001efd0: 2020 2020 7661 7269 6162 6c65 735b 6e61      variables[na
-0001efe0: 6d65 5d20 3d20 6d69 7373 696e 672e 696e  me] = missing.in
-0001eff0: 7465 7270 2876 6172 2c20 7661 725f 696e  terp(var, var_in
-0001f000: 6465 7865 7273 2c20 6d65 7468 6f64 2c20  dexers, method, 
-0001f010: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-0001f020: 2020 2020 2020 656c 6966 2064 7479 7065        elif dtype
-0001f030: 5f6b 696e 6420 696e 2022 4f62 5522 2061  _kind in "ObU" a
-0001f040: 6e64 2028 7573 655f 696e 6465 7865 7273  nd (use_indexers
-0001f050: 2e6b 6579 7328 2920 2620 7661 722e 6469  .keys() & var.di
-0001f060: 6d73 293a 0a20 2020 2020 2020 2020 2020  ms):.           
-0001f070: 2020 2020 2023 2046 6f72 2074 7970 6573       # For types
-0001f080: 2074 6861 7420 7765 2064 6f20 6e6f 7420   that we do not 
-0001f090: 756e 6465 7273 7461 6e64 2064 6f20 7374  understand do st
-0001f0a0: 6570 7769 7365 0a20 2020 2020 2020 2020  epwise.         
-0001f0b0: 2020 2020 2020 2023 2069 6e74 6572 706f         # interpo
-0001f0c0: 6c61 7469 6f6e 2074 6f20 6176 6f69 6420  lation to avoid 
-0001f0d0: 6d6f 6469 6679 696e 6720 7468 6520 656c  modifying the el
-0001f0e0: 656d 656e 7473 2e0a 2020 2020 2020 2020  ements..        
-0001f0f0: 2020 2020 2020 2020 2320 7265 696e 6465          # reinde
-0001f100: 7820 7468 6520 7661 7269 6162 6c65 2069  x the variable i
-0001f110: 6e73 7465 6164 2062 6563 6175 7365 2069  nstead because i
-0001f120: 7420 7375 7070 6f72 7473 0a20 2020 2020  t supports.     
-0001f130: 2020 2020 2020 2020 2020 2023 2062 6f6f             # boo
-0001f140: 6c65 616e 7320 616e 6420 6f62 6a65 6374  leans and object
-0001f150: 7320 616e 6420 7265 7461 696e 7320 7468  s and retains th
-0001f160: 6520 6474 7970 6520 6275 7420 696e 7369  e dtype but insi
-0001f170: 6465 0a20 2020 2020 2020 2020 2020 2020  de.             
-0001f180: 2020 2023 2074 6869 7320 6c6f 6f70 2074     # this loop t
-0001f190: 6865 7265 206d 6967 6874 2062 6520 736f  here might be so
-0001f1a0: 6d65 2064 7570 6c69 6361 7465 2063 6f64  me duplicate cod
-0001f1b0: 6520 7468 6174 2073 6c6f 7773 2069 740a  e that slows it.
-0001f1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f1d0: 2320 646f 776e 2c20 7468 6572 6566 6f72  # down, therefor
-0001f1e0: 6520 636f 6c6c 6563 7420 7468 6573 6520  e collect these 
-0001f1f0: 7369 676e 616c 7320 616e 6420 7275 6e20  signals and run 
-0001f200: 6974 206c 6174 6572 3a0a 2020 2020 2020  it later:.      
-0001f210: 2020 2020 2020 2020 2020 7265 696e 6465            reinde
-0001f220: 7820 3d20 5472 7565 0a20 2020 2020 2020  x = True.       
-0001f230: 2020 2020 2065 6c69 6620 616c 6c28 6420       elif all(d 
-0001f240: 6e6f 7420 696e 2069 6e64 6578 6572 7320  not in indexers 
-0001f250: 666f 7220 6420 696e 2076 6172 2e64 696d  for d in var.dim
-0001f260: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0001f270: 2020 2020 2320 466f 7220 616e 7974 6869      # For anythi
-0001f280: 6e67 2065 6c73 6520 7765 2063 616e 206f  ng else we can o
-0001f290: 6e6c 7920 6b65 6570 2076 6172 6961 626c  nly keep variabl
-0001f2a0: 6573 2069 6620 7468 6579 0a20 2020 2020  es if they.     
-0001f2b0: 2020 2020 2020 2020 2020 2023 2061 7265             # are
-0001f2c0: 206e 6f74 2064 6570 656e 6465 6e74 206f   not dependent o
-0001f2d0: 6e20 616e 7920 636f 6f72 6473 2074 6861  n any coords tha
-0001f2e0: 7420 6172 6520 6265 696e 670a 2020 2020  t are being.    
-0001f2f0: 2020 2020 2020 2020 2020 2020 2320 696e              # in
-0001f300: 7465 7270 6f6c 6174 6564 2061 6c6f 6e67  terpolated along
-0001f310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001f320: 2020 7661 7269 6162 6c65 735b 6e61 6d65    variables[name
-0001f330: 5d20 3d20 7661 720a 0a20 2020 2020 2020  ] = var..       
-0001f340: 2069 6620 7265 696e 6465 783a 0a20 2020   if reindex:.   
-0001f350: 2020 2020 2020 2020 2072 6569 6e64 6578           reindex
-0001f360: 5f69 6e64 6578 6572 7320 3d20 7b0a 2020  _indexers = {.  
-0001f370: 2020 2020 2020 2020 2020 2020 2020 6b3a                k:
-0001f380: 2076 2066 6f72 206b 2c20 285f 2c20 7629   v for k, (_, v)
-0001f390: 2069 6e20 7661 6c69 6461 7465 645f 696e   in validated_in
-0001f3a0: 6465 7865 7273 2e69 7465 6d73 2829 2069  dexers.items() i
-0001f3b0: 6620 762e 6469 6d73 203d 3d20 286b 2c29  f v.dims == (k,)
-0001f3c0: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-0001f3d0: 2020 2020 2020 2020 2020 2072 6569 6e64             reind
-0001f3e0: 6578 6564 203d 2061 6c69 676e 6d65 6e74  exed = alignment
-0001f3f0: 2e72 6569 6e64 6578 280a 2020 2020 2020  .reindex(.      
-0001f400: 2020 2020 2020 2020 2020 6f62 6a2c 0a20            obj,. 
-0001f410: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001f420: 6e64 6578 6572 733d 7265 696e 6465 785f  ndexers=reindex_
-0001f430: 696e 6465 7865 7273 2c0a 2020 2020 2020  indexers,.      
-0001f440: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-0001f450: 3d6d 6574 686f 645f 6e6f 6e5f 6e75 6d65  =method_non_nume
-0001f460: 7269 632c 0a20 2020 2020 2020 2020 2020  ric,.           
-0001f470: 2020 2020 2065 7863 6c75 6465 5f76 6172       exclude_var
-0001f480: 733d 7661 7269 6162 6c65 732e 6b65 7973  s=variables.keys
-0001f490: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-0001f4a0: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
-0001f4b0: 6465 7865 7320 3d20 6469 6374 2872 6569  dexes = dict(rei
-0001f4c0: 6e64 6578 6564 2e5f 696e 6465 7865 7329  ndexed._indexes)
-0001f4d0: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-0001f4e0: 6961 626c 6573 2e75 7064 6174 6528 7265  iables.update(re
-0001f4f0: 696e 6465 7865 642e 7661 7269 6162 6c65  indexed.variable
-0001f500: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
-0001f510: 0a20 2020 2020 2020 2020 2020 2023 2047  .            # G
-0001f520: 6574 2074 6865 2069 6e64 6578 6573 2074  et the indexes t
-0001f530: 6861 7420 6172 6520 6e6f 7420 6265 696e  hat are not bein
-0001f540: 6720 696e 7465 7270 6f6c 6174 6564 2061  g interpolated a
-0001f550: 6c6f 6e67 0a20 2020 2020 2020 2020 2020  long.           
-0001f560: 2069 6e64 6578 6573 203d 207b 6b3a 2076   indexes = {k: v
-0001f570: 2066 6f72 206b 2c20 7620 696e 206f 626a   for k, v in obj
-0001f580: 2e5f 696e 6465 7865 732e 6974 656d 7328  ._indexes.items(
-0001f590: 2920 6966 206b 206e 6f74 2069 6e20 696e  ) if k not in in
-0001f5a0: 6465 7865 7273 7d0a 0a20 2020 2020 2020  dexers}..       
-0001f5b0: 2023 2047 6574 2074 6865 2063 6f6f 7264   # Get the coord
-0001f5c0: 7320 7468 6174 2061 6c73 6f20 6578 6973  s that also exis
-0001f5d0: 7420 696e 2074 6865 2076 6172 6961 626c  t in the variabl
-0001f5e0: 6573 3a0a 2020 2020 2020 2020 636f 6f72  es:.        coor
-0001f5f0: 645f 6e61 6d65 7320 3d20 6f62 6a2e 5f63  d_names = obj._c
-0001f600: 6f6f 7264 5f6e 616d 6573 2026 2076 6172  oord_names & var
-0001f610: 6961 626c 6573 2e6b 6579 7328 290a 2020  iables.keys().  
-0001f620: 2020 2020 2020 7365 6c65 6374 6564 203d        selected =
-0001f630: 2073 656c 662e 5f72 6570 6c61 6365 5f77   self._replace_w
-0001f640: 6974 685f 6e65 775f 6469 6d73 280a 2020  ith_new_dims(.  
-0001f650: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-0001f660: 6c65 732e 636f 7079 2829 2c20 636f 6f72  les.copy(), coor
-0001f670: 645f 6e61 6d65 732c 2069 6e64 6578 6573  d_names, indexes
-0001f680: 3d69 6e64 6578 6573 0a20 2020 2020 2020  =indexes.       
-0001f690: 2029 0a0a 2020 2020 2020 2020 2320 4174   )..        # At
-0001f6a0: 7461 6368 2069 6e64 6578 6572 2061 7320  tach indexer as 
-0001f6b0: 636f 6f72 6469 6e61 7465 0a20 2020 2020  coordinate.     
-0001f6c0: 2020 2066 6f72 206b 2c20 7620 696e 2069     for k, v in i
-0001f6d0: 6e64 6578 6572 732e 6974 656d 7328 293a  ndexers.items():
-0001f6e0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-0001f6f0: 6572 7420 6973 696e 7374 616e 6365 2876  ert isinstance(v
-0001f700: 2c20 5661 7269 6162 6c65 290a 2020 2020  , Variable).    
-0001f710: 2020 2020 2020 2020 6966 2076 2e64 696d          if v.dim
-0001f720: 7320 3d3d 2028 6b2c 293a 0a20 2020 2020  s == (k,):.     
-0001f730: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-0001f740: 203d 2050 616e 6461 7349 6e64 6578 2876   = PandasIndex(v
-0001f750: 2c20 6b2c 2063 6f6f 7264 5f64 7479 7065  , k, coord_dtype
-0001f760: 3d76 2e64 7479 7065 290a 2020 2020 2020  =v.dtype).      
-0001f770: 2020 2020 2020 2020 2020 696e 6465 785f            index_
-0001f780: 7661 7273 203d 2069 6e64 6578 2e63 7265  vars = index.cre
-0001f790: 6174 655f 7661 7269 6162 6c65 7328 7b6b  ate_variables({k
-0001f7a0: 3a20 767d 290a 2020 2020 2020 2020 2020  : v}).          
-0001f7b0: 2020 2020 2020 696e 6465 7865 735b 6b5d        indexes[k]
-0001f7c0: 203d 2069 6e64 6578 0a20 2020 2020 2020   = index.       
-0001f7d0: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-0001f7e0: 6573 2e75 7064 6174 6528 696e 6465 785f  es.update(index_
-0001f7f0: 7661 7273 290a 2020 2020 2020 2020 2020  vars).          
-0001f800: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001f810: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0001f820: 735b 6b5d 203d 2076 0a0a 2020 2020 2020  s[k] = v..      
-0001f830: 2020 2320 4578 7472 6163 7420 636f 6f72    # Extract coor
-0001f840: 6469 6e61 7465 7320 6672 6f6d 2069 6e64  dinates from ind
-0001f850: 6578 6572 730a 2020 2020 2020 2020 636f  exers.        co
-0001f860: 6f72 645f 7661 7273 2c20 6e65 775f 696e  ord_vars, new_in
-0001f870: 6465 7865 7320 3d20 7365 6c65 6374 6564  dexes = selected
-0001f880: 2e5f 6765 745f 696e 6465 7865 7273 5f63  ._get_indexers_c
-0001f890: 6f6f 7264 735f 616e 645f 696e 6465 7865  oords_and_indexe
-0001f8a0: 7328 636f 6f72 6473 290a 2020 2020 2020  s(coords).      
-0001f8b0: 2020 7661 7269 6162 6c65 732e 7570 6461    variables.upda
-0001f8c0: 7465 2863 6f6f 7264 5f76 6172 7329 0a20  te(coord_vars). 
-0001f8d0: 2020 2020 2020 2069 6e64 6578 6573 2e75         indexes.u
-0001f8e0: 7064 6174 6528 6e65 775f 696e 6465 7865  pdate(new_indexe
-0001f8f0: 7329 0a0a 2020 2020 2020 2020 636f 6f72  s)..        coor
-0001f900: 645f 6e61 6d65 7320 3d20 6f62 6a2e 5f63  d_names = obj._c
-0001f910: 6f6f 7264 5f6e 616d 6573 2026 2076 6172  oord_names & var
-0001f920: 6961 626c 6573 2e6b 6579 7328 2920 7c20  iables.keys() | 
-0001f930: 636f 6f72 645f 7661 7273 2e6b 6579 7328  coord_vars.keys(
-0001f940: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001f950: 2073 656c 662e 5f72 6570 6c61 6365 5f77   self._replace_w
-0001f960: 6974 685f 6e65 775f 6469 6d73 2876 6172  ith_new_dims(var
-0001f970: 6961 626c 6573 2c20 636f 6f72 645f 6e61  iables, coord_na
-0001f980: 6d65 732c 2069 6e64 6578 6573 3d69 6e64  mes, indexes=ind
-0001f990: 6578 6573 290a 0a20 2020 2064 6566 2069  exes)..    def i
-0001f9a0: 6e74 6572 705f 6c69 6b65 280a 2020 2020  nterp_like(.    
-0001f9b0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0001f9c0: 2020 6f74 6865 723a 2044 6174 6173 6574    other: Dataset
-0001f9d0: 207c 2044 6174 6141 7272 6179 2c0a 2020   | DataArray,.  
-0001f9e0: 2020 2020 2020 6d65 7468 6f64 3a20 496e        method: In
-0001f9f0: 7465 7270 4f70 7469 6f6e 7320 3d20 226c  terpOptions = "l
-0001fa00: 696e 6561 7222 2c0a 2020 2020 2020 2020  inear",.        
-0001fa10: 6173 7375 6d65 5f73 6f72 7465 643a 2062  assume_sorted: b
-0001fa20: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0001fa30: 2020 2020 206b 7761 7267 733a 204d 6170       kwargs: Map
-0001fa40: 7069 6e67 5b73 7472 2c20 416e 795d 207c  ping[str, Any] |
-0001fa50: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-0001fa60: 2020 2020 2020 6d65 7468 6f64 5f6e 6f6e        method_non
-0001fa70: 5f6e 756d 6572 6963 3a20 7374 7220 3d20  _numeric: str = 
-0001fa80: 226e 6561 7265 7374 222c 0a20 2020 2029  "nearest",.    )
-0001fa90: 202d 3e20 4461 7461 7365 743a 0a20 2020   -> Dataset:.   
-0001faa0: 2020 2020 2022 2222 496e 7465 7270 6f6c       """Interpol
-0001fab0: 6174 6520 7468 6973 206f 626a 6563 7420  ate this object 
-0001fac0: 6f6e 746f 2074 6865 2063 6f6f 7264 696e  onto the coordin
-0001fad0: 6174 6573 206f 6620 616e 6f74 6865 7220  ates of another 
-0001fae0: 6f62 6a65 6374 2c0a 2020 2020 2020 2020  object,.        
-0001faf0: 6669 6c6c 696e 6720 7468 6520 6f75 7420  filling the out 
-0001fb00: 6f66 2072 616e 6765 2076 616c 7565 7320  of range values 
-0001fb10: 7769 7468 204e 614e 2e0a 0a20 2020 2020  with NaN...     
-0001fb20: 2020 2049 6620 696e 7465 7270 6f6c 6174     If interpolat
-0001fb30: 696e 6720 616c 6f6e 6720 6120 7369 6e67  ing along a sing
-0001fb40: 6c65 2065 7869 7374 696e 6720 6469 6d65  le existing dime
-0001fb50: 6e73 696f 6e2c 0a20 2020 2020 2020 203a  nsion,.        :
-0001fb60: 7079 3a63 6c61 7373 3a60 7363 6970 792e  py:class:`scipy.
-0001fb70: 696e 7465 7270 6f6c 6174 652e 696e 7465  interpolate.inte
-0001fb80: 7270 3164 6020 6973 2063 616c 6c65 642e  rp1d` is called.
-0001fb90: 2057 6865 6e20 696e 7465 7270 6f6c 6174   When interpolat
-0001fba0: 696e 670a 2020 2020 2020 2020 616c 6f6e  ing.        alon
-0001fbb0: 6720 6d75 6c74 6970 6c65 2065 7869 7374  g multiple exist
-0001fbc0: 696e 6720 6469 6d65 6e73 696f 6e73 2c20  ing dimensions, 
-0001fbd0: 616e 2061 7474 656d 7074 2069 7320 6d61  an attempt is ma
-0001fbe0: 6465 2074 6f20 6465 636f 6d70 6f73 6520  de to decompose 
-0001fbf0: 7468 650a 2020 2020 2020 2020 696e 7465  the.        inte
-0001fc00: 7270 6f6c 6174 696f 6e20 696e 746f 206d  rpolation into m
-0001fc10: 756c 7469 706c 6520 312d 6469 6d65 6e73  ultiple 1-dimens
-0001fc20: 696f 6e61 6c20 696e 7465 7270 6f6c 6174  ional interpolat
-0001fc30: 696f 6e73 2e20 4966 2074 6869 7320 6973  ions. If this is
-0001fc40: 0a20 2020 2020 2020 2070 6f73 7369 626c  .        possibl
-0001fc50: 652c 203a 7079 3a63 6c61 7373 3a60 7363  e, :py:class:`sc
-0001fc60: 6970 792e 696e 7465 7270 6f6c 6174 652e  ipy.interpolate.
-0001fc70: 696e 7465 7270 3164 6020 6973 2063 616c  interp1d` is cal
-0001fc80: 6c65 642e 204f 7468 6572 7769 7365 2c0a  led. Otherwise,.
-0001fc90: 2020 2020 2020 2020 3a70 793a 6675 6e63          :py:func
-0001fca0: 3a60 7363 6970 792e 696e 7465 7270 6f6c  :`scipy.interpol
-0001fcb0: 6174 652e 696e 7465 7270 6e60 2069 7320  ate.interpn` is 
-0001fcc0: 6361 6c6c 6564 2e0a 0a20 2020 2020 2020  called...       
-0001fcd0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-0001fce0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-0001fcf0: 2020 2020 2020 206f 7468 6572 203a 2044         other : D
-0001fd00: 6174 6173 6574 206f 7220 4461 7461 4172  ataset or DataAr
-0001fd10: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
-0001fd20: 4f62 6a65 6374 2077 6974 6820 616e 2027  Object with an '
-0001fd30: 696e 6465 7865 7327 2061 7474 7269 6275  indexes' attribu
-0001fd40: 7465 2067 6976 696e 6720 6120 6d61 7070  te giving a mapp
-0001fd50: 696e 6720 6672 6f6d 2064 696d 656e 7369  ing from dimensi
-0001fd60: 6f6e 0a20 2020 2020 2020 2020 2020 206e  on.            n
-0001fd70: 616d 6573 2074 6f20 616e 2031 6420 6172  ames to an 1d ar
-0001fd80: 7261 792d 6c69 6b65 2c20 7768 6963 6820  ray-like, which 
-0001fd90: 7072 6f76 6964 6573 2063 6f6f 7264 696e  provides coordin
-0001fda0: 6174 6573 2075 706f 6e0a 2020 2020 2020  ates upon.      
-0001fdb0: 2020 2020 2020 7768 6963 6820 746f 2069        which to i
-0001fdc0: 6e64 6578 2074 6865 2076 6172 6961 626c  ndex the variabl
-0001fdd0: 6573 2069 6e20 7468 6973 2064 6174 6173  es in this datas
-0001fde0: 6574 2e20 4d69 7373 696e 6720 7661 6c75  et. Missing valu
-0001fdf0: 6573 2061 7265 2073 6b69 7070 6564 2e0a  es are skipped..
-0001fe00: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
-0001fe10: 207b 226c 696e 6561 7222 2c20 226e 6561   {"linear", "nea
-0001fe20: 7265 7374 222c 2022 7a65 726f 222c 2022  rest", "zero", "
-0001fe30: 736c 696e 6561 7222 2c20 2271 7561 6472  slinear", "quadr
-0001fe40: 6174 6963 222c 2022 6375 6269 6322 2c20  atic", "cubic", 
-0001fe50: 2270 6f6c 796e 6f6d 6961 6c22 2c20 5c0a  "polynomial", \.
-0001fe60: 2020 2020 2020 2020 2020 2020 2262 6172              "bar
-0001fe70: 7963 656e 7472 6963 222c 2022 6b72 6f67  ycentric", "krog
-0001fe80: 222c 2022 7063 6869 7022 2c20 2273 706c  ", "pchip", "spl
-0001fe90: 696e 6522 2c20 2261 6b69 6d61 227d 2c20  ine", "akima"}, 
-0001fea0: 6465 6661 756c 743a 2022 6c69 6e65 6172  default: "linear
-0001feb0: 220a 2020 2020 2020 2020 2020 2020 5374  ".            St
-0001fec0: 7269 6e67 2069 6e64 6963 6174 696e 6720  ring indicating 
-0001fed0: 7768 6963 6820 6d65 7468 6f64 2074 6f20  which method to 
-0001fee0: 7573 6520 666f 7220 696e 7465 7270 6f6c  use for interpol
-0001fef0: 6174 696f 6e3a 0a0a 2020 2020 2020 2020  ation:..        
-0001ff00: 2020 2020 2d20 276c 696e 6561 7227 3a20      - 'linear': 
-0001ff10: 6c69 6e65 6172 2069 6e74 6572 706f 6c61  linear interpola
-0001ff20: 7469 6f6e 2e20 4164 6469 7469 6f6e 616c  tion. Additional
-0001ff30: 206b 6579 776f 7264 0a20 2020 2020 2020   keyword.       
-0001ff40: 2020 2020 2020 2061 7267 756d 656e 7473         arguments
-0001ff50: 2061 7265 2070 6173 7365 6420 746f 203a   are passed to :
-0001ff60: 7079 3a66 756e 633a 606e 756d 7079 2e69  py:func:`numpy.i
-0001ff70: 6e74 6572 7060 0a20 2020 2020 2020 2020  nterp`.         
-0001ff80: 2020 202d 2027 6e65 6172 6573 7427 2c20     - 'nearest', 
-0001ff90: 277a 6572 6f27 2c20 2773 6c69 6e65 6172  'zero', 'slinear
-0001ffa0: 272c 2027 7175 6164 7261 7469 6327 2c20  ', 'quadratic', 
-0001ffb0: 2763 7562 6963 272c 2027 706f 6c79 6e6f  'cubic', 'polyno
-0001ffc0: 6d69 616c 273a 0a20 2020 2020 2020 2020  mial':.         
-0001ffd0: 2020 2020 2061 7265 2070 6173 7365 6420       are passed 
-0001ffe0: 746f 203a 7079 3a66 756e 633a 6073 6369  to :py:func:`sci
-0001fff0: 7079 2e69 6e74 6572 706f 6c61 7465 2e69  py.interpolate.i
-00020000: 6e74 6572 7031 6460 2e20 4966 0a20 2020  nterp1d`. If.   
-00020010: 2020 2020 2020 2020 2020 2060 606d 6574             ``met
-00020020: 686f 643d 2770 6f6c 796e 6f6d 6961 6c27  hod='polynomial'
-00020030: 6060 2c20 7468 6520 6060 6f72 6465 7260  ``, the ``order`
-00020040: 6020 6b65 7977 6f72 6420 6172 6775 6d65  ` keyword argume
-00020050: 6e74 206d 7573 7420 616c 736f 2062 650a  nt must also be.
-00020060: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00020070: 6f76 6964 6564 2e0a 2020 2020 2020 2020  ovided..        
-00020080: 2020 2020 2d20 2762 6172 7963 656e 7472      - 'barycentr
-00020090: 6963 272c 2027 6b72 6f67 272c 2027 7063  ic', 'krog', 'pc
-000200a0: 6869 7027 2c20 2773 706c 696e 6527 2c20  hip', 'spline', 
-000200b0: 2761 6b69 6d61 273a 2075 7365 2074 6865  'akima': use the
-000200c0: 6972 0a20 2020 2020 2020 2020 2020 2020  ir.             
-000200d0: 2072 6573 7065 6374 6976 6520 3a70 793a   respective :py:
-000200e0: 636c 6173 733a 6073 6369 7079 2e69 6e74  class:`scipy.int
-000200f0: 6572 706f 6c61 7465 6020 636c 6173 7365  erpolate` classe
-00020100: 732e 0a0a 2020 2020 2020 2020 6173 7375  s...        assu
-00020110: 6d65 5f73 6f72 7465 6420 3a20 626f 6f6c  me_sorted : bool
-00020120: 2c20 6465 6661 756c 743a 2046 616c 7365  , default: False
-00020130: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00020140: 4661 6c73 652c 2076 616c 7565 7320 6f66  False, values of
-00020150: 2063 6f6f 7264 696e 6174 6573 2074 6861   coordinates tha
-00020160: 7420 6172 6520 696e 7465 7270 6f6c 6174  t are interpolat
-00020170: 6564 206f 7665 7220 6361 6e20 6265 0a20  ed over can be. 
-00020180: 2020 2020 2020 2020 2020 2069 6e20 616e             in an
-00020190: 7920 6f72 6465 7220 616e 6420 7468 6579  y order and they
-000201a0: 2061 7265 2073 6f72 7465 6420 6669 7273   are sorted firs
-000201b0: 742e 2049 6620 5472 7565 2c20 696e 7465  t. If True, inte
-000201c0: 7270 6f6c 6174 6564 0a20 2020 2020 2020  rpolated.       
-000201d0: 2020 2020 2063 6f6f 7264 696e 6174 6573       coordinates
-000201e0: 2061 7265 2061 7373 756d 6564 2074 6f20   are assumed to 
-000201f0: 6265 2061 6e20 6172 7261 7920 6f66 206d  be an array of m
-00020200: 6f6e 6f74 6f6e 6963 616c 6c79 2069 6e63  onotonically inc
-00020210: 7265 6173 696e 670a 2020 2020 2020 2020  reasing.        
-00020220: 2020 2020 7661 6c75 6573 2e0a 2020 2020      values..    
-00020230: 2020 2020 6b77 6172 6773 203a 2064 6963      kwargs : dic
-00020240: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
-00020250: 2020 2020 2020 2020 4164 6469 7469 6f6e          Addition
-00020260: 616c 206b 6579 776f 7264 2070 6173 7365  al keyword passe
-00020270: 6420 746f 2073 6369 7079 2773 2069 6e74  d to scipy's int
-00020280: 6572 706f 6c61 746f 722e 0a20 2020 2020  erpolator..     
-00020290: 2020 206d 6574 686f 645f 6e6f 6e5f 6e75     method_non_nu
-000202a0: 6d65 7269 6320 3a20 7b22 6e65 6172 6573  meric : {"neares
-000202b0: 7422 2c20 2270 6164 222c 2022 6666 696c  t", "pad", "ffil
-000202c0: 6c22 2c20 2262 6163 6b66 696c 6c22 2c20  l", "backfill", 
-000202d0: 2262 6669 6c6c 227d 2c20 6f70 7469 6f6e  "bfill"}, option
-000202e0: 616c 0a20 2020 2020 2020 2020 2020 204d  al.            M
-000202f0: 6574 686f 6420 666f 7220 6e6f 6e2d 6e75  ethod for non-nu
-00020300: 6d65 7269 6320 7479 7065 732e 2050 6173  meric types. Pas
-00020310: 7365 6420 6f6e 2074 6f20 3a70 793a 6d65  sed on to :py:me
-00020320: 7468 3a60 4461 7461 7365 742e 7265 696e  th:`Dataset.rein
-00020330: 6465 7860 2e0a 2020 2020 2020 2020 2020  dex`..          
-00020340: 2020 6060 226e 6561 7265 7374 2260 6020    ``"nearest"`` 
-00020350: 6973 2075 7365 6420 6279 2064 6566 6175  is used by defau
-00020360: 6c74 2e0a 0a20 2020 2020 2020 2052 6574  lt...        Ret
-00020370: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-00020380: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e74  ----.        int
-00020390: 6572 706f 6c61 7465 6420 3a20 4461 7461  erpolated : Data
-000203a0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
-000203b0: 416e 6f74 6865 7220 6461 7461 7365 7420  Another dataset 
-000203c0: 6279 2069 6e74 6572 706f 6c61 7469 6e67  by interpolating
-000203d0: 2074 6869 7320 6461 7461 7365 7427 7320   this dataset's 
-000203e0: 6461 7461 2061 6c6f 6e67 2074 6865 0a20  data along the. 
-000203f0: 2020 2020 2020 2020 2020 2063 6f6f 7264             coord
-00020400: 696e 6174 6573 206f 6620 7468 6520 6f74  inates of the ot
-00020410: 6865 7220 6f62 6a65 6374 2e0a 0a20 2020  her object...   
-00020420: 2020 2020 204e 6f74 6573 0a20 2020 2020       Notes.     
-00020430: 2020 202d 2d2d 2d2d 0a20 2020 2020 2020     -----.       
-00020440: 2073 6369 7079 2069 7320 7265 7175 6972   scipy is requir
-00020450: 6564 2e0a 2020 2020 2020 2020 4966 2074  ed..        If t
-00020460: 6865 2064 6174 6173 6574 2068 6173 206f  he dataset has o
-00020470: 626a 6563 742d 7479 7065 2063 6f6f 7264  bject-type coord
-00020480: 696e 6174 6573 2c20 7265 696e 6465 7820  inates, reindex 
-00020490: 6973 2075 7365 6420 666f 7220 7468 6573  is used for thes
-000204a0: 650a 2020 2020 2020 2020 636f 6f72 6469  e.        coordi
-000204b0: 6e61 7465 7320 696e 7374 6561 6420 6f66  nates instead of
-000204c0: 2074 6865 2069 6e74 6572 706f 6c61 7469   the interpolati
-000204d0: 6f6e 2e0a 0a20 2020 2020 2020 2053 6565  on...        See
-000204e0: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-000204f0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
-00020500: 6174 6173 6574 2e69 6e74 6572 700a 2020  ataset.interp.  
-00020510: 2020 2020 2020 4461 7461 7365 742e 7265        Dataset.re
-00020520: 696e 6465 785f 6c69 6b65 0a20 2020 2020  index_like.     
-00020530: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00020540: 6620 6b77 6172 6773 2069 7320 4e6f 6e65  f kwargs is None
-00020550: 3a0a 2020 2020 2020 2020 2020 2020 6b77  :.            kw
-00020560: 6172 6773 203d 207b 7d0a 0a20 2020 2020  args = {}..     
-00020570: 2020 2023 2070 6963 6b20 6f6e 6c79 2064     # pick only d
-00020580: 696d 656e 7369 6f6e 2063 6f6f 7264 696e  imension coordin
-00020590: 6174 6573 2077 6974 6820 6120 7369 6e67  ates with a sing
-000205a0: 6c65 2069 6e64 6578 0a20 2020 2020 2020  le index.       
-000205b0: 2063 6f6f 7264 7320 3d20 7b7d 0a20 2020   coords = {}.   
-000205c0: 2020 2020 206f 7468 6572 5f69 6e64 6578       other_index
-000205d0: 6573 203d 206f 7468 6572 2e78 696e 6465  es = other.xinde
-000205e0: 7865 730a 2020 2020 2020 2020 666f 7220  xes.        for 
-000205f0: 6469 6d20 696e 2073 656c 662e 6469 6d73  dim in self.dims
-00020600: 3a0a 2020 2020 2020 2020 2020 2020 6f74  :.            ot
-00020610: 6865 725f 6469 6d5f 636f 6f72 6473 203d  her_dim_coords =
-00020620: 206f 7468 6572 5f69 6e64 6578 6573 2e67   other_indexes.g
-00020630: 6574 5f61 6c6c 5f63 6f6f 7264 7328 6469  et_all_coords(di
-00020640: 6d2c 2065 7272 6f72 733d 2269 676e 6f72  m, errors="ignor
-00020650: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
-00020660: 6966 206c 656e 286f 7468 6572 5f64 696d  if len(other_dim
-00020670: 5f63 6f6f 7264 7329 203d 3d20 313a 0a20  _coords) == 1:. 
-00020680: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00020690: 6f6f 7264 735b 6469 6d5d 203d 206f 7468  oords[dim] = oth
-000206a0: 6572 5f64 696d 5f63 6f6f 7264 735b 6469  er_dim_coords[di
-000206b0: 6d5d 0a0a 2020 2020 2020 2020 6e75 6d65  m]..        nume
-000206c0: 7269 635f 636f 6f72 6473 3a20 6469 6374  ric_coords: dict
-000206d0: 5b48 6173 6861 626c 652c 2070 642e 496e  [Hashable, pd.In
-000206e0: 6465 785d 203d 207b 7d0a 2020 2020 2020  dex] = {}.      
-000206f0: 2020 6f62 6a65 6374 5f63 6f6f 7264 733a    object_coords:
-00020700: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
-00020710: 7064 2e49 6e64 6578 5d20 3d20 7b7d 0a20  pd.Index] = {}. 
-00020720: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-00020730: 696e 2063 6f6f 7264 732e 6974 656d 7328  in coords.items(
-00020740: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00020750: 6620 762e 6474 7970 652e 6b69 6e64 2069  f v.dtype.kind i
-00020760: 6e20 2275 6966 634d 6d22 3a0a 2020 2020  n "uifcMm":.    
-00020770: 2020 2020 2020 2020 2020 2020 6e75 6d65              nume
-00020780: 7269 635f 636f 6f72 6473 5b6b 5d20 3d20  ric_coords[k] = 
-00020790: 760a 2020 2020 2020 2020 2020 2020 656c  v.            el
-000207a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000207b0: 2020 2020 6f62 6a65 6374 5f63 6f6f 7264      object_coord
-000207c0: 735b 6b5d 203d 2076 0a0a 2020 2020 2020  s[k] = v..      
-000207d0: 2020 6473 203d 2073 656c 660a 2020 2020    ds = self.    
-000207e0: 2020 2020 6966 206f 626a 6563 745f 636f      if object_co
-000207f0: 6f72 6473 3a0a 2020 2020 2020 2020 2020  ords:.          
-00020800: 2020 2320 5765 2064 6f20 6e6f 7420 7375    # We do not su
-00020810: 7070 6f72 7420 696e 7465 7270 6f6c 6174  pport interpolat
-00020820: 696f 6e20 616c 6f6e 6720 6f62 6a65 6374  ion along object
-00020830: 2063 6f6f 7264 696e 6174 652e 0a20 2020   coordinate..   
-00020840: 2020 2020 2020 2020 2023 2072 6569 6e64           # reind
-00020850: 6578 2069 6e73 7465 6164 2e0a 2020 2020  ex instead..    
-00020860: 2020 2020 2020 2020 6473 203d 2073 656c          ds = sel
-00020870: 662e 7265 696e 6465 7828 6f62 6a65 6374  f.reindex(object
-00020880: 5f63 6f6f 7264 7329 0a20 2020 2020 2020  _coords).       
-00020890: 2072 6574 7572 6e20 6473 2e69 6e74 6572   return ds.inter
-000208a0: 7028 0a20 2020 2020 2020 2020 2020 2063  p(.            c
-000208b0: 6f6f 7264 733d 6e75 6d65 7269 635f 636f  oords=numeric_co
-000208c0: 6f72 6473 2c0a 2020 2020 2020 2020 2020  ords,.          
-000208d0: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
-000208e0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-000208f0: 756d 655f 736f 7274 6564 3d61 7373 756d  ume_sorted=assum
-00020900: 655f 736f 7274 6564 2c0a 2020 2020 2020  e_sorted,.      
-00020910: 2020 2020 2020 6b77 6172 6773 3d6b 7761        kwargs=kwa
-00020920: 7267 732c 0a20 2020 2020 2020 2020 2020  rgs,.           
-00020930: 206d 6574 686f 645f 6e6f 6e5f 6e75 6d65   method_non_nume
-00020940: 7269 633d 6d65 7468 6f64 5f6e 6f6e 5f6e  ric=method_non_n
-00020950: 756d 6572 6963 2c0a 2020 2020 2020 2020  umeric,.        
-00020960: 290a 0a20 2020 2023 2048 656c 7065 7220  )..    # Helper 
-00020970: 6d65 7468 6f64 7320 666f 7220 7265 6e61  methods for rena
-00020980: 6d65 2829 0a20 2020 2064 6566 205f 7265  me().    def _re
-00020990: 6e61 6d65 5f76 6172 7328 0a20 2020 2020  name_vars(.     
-000209a0: 2020 2073 656c 662c 206e 616d 655f 6469     self, name_di
-000209b0: 6374 2c20 6469 6d73 5f64 6963 740a 2020  ct, dims_dict.  
-000209c0: 2020 2920 2d3e 2074 7570 6c65 5b64 6963    ) -> tuple[dic
-000209d0: 745b 4861 7368 6162 6c65 2c20 5661 7269  t[Hashable, Vari
-000209e0: 6162 6c65 5d2c 2073 6574 5b48 6173 6861  able], set[Hasha
-000209f0: 626c 655d 5d3a 0a20 2020 2020 2020 2076  ble]]:.        v
-00020a00: 6172 6961 626c 6573 203d 207b 7d0a 2020  ariables = {}.  
-00020a10: 2020 2020 2020 636f 6f72 645f 6e61 6d65        coord_name
-00020a20: 7320 3d20 7365 7428 290a 2020 2020 2020  s = set().      
-00020a30: 2020 666f 7220 6b2c 2076 2069 6e20 7365    for k, v in se
-00020a40: 6c66 2e76 6172 6961 626c 6573 2e69 7465  lf.variables.ite
-00020a50: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00020a60: 2020 7661 7220 3d20 762e 636f 7079 2864    var = v.copy(d
-00020a70: 6565 703d 4661 6c73 6529 0a20 2020 2020  eep=False).     
-00020a80: 2020 2020 2020 2076 6172 2e64 696d 7320         var.dims 
-00020a90: 3d20 7475 706c 6528 6469 6d73 5f64 6963  = tuple(dims_dic
-00020aa0: 742e 6765 7428 6469 6d2c 2064 696d 2920  t.get(dim, dim) 
-00020ab0: 666f 7220 6469 6d20 696e 2076 2e64 696d  for dim in v.dim
-00020ac0: 7329 0a20 2020 2020 2020 2020 2020 206e  s).            n
-00020ad0: 616d 6520 3d20 6e61 6d65 5f64 6963 742e  ame = name_dict.
-00020ae0: 6765 7428 6b2c 206b 290a 2020 2020 2020  get(k, k).      
-00020af0: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
-00020b00: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-00020b10: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00020b20: 6520 5661 6c75 6545 7272 6f72 2866 2274  e ValueError(f"t
-00020b30: 6865 206e 6577 206e 616d 6520 7b6e 616d  he new name {nam
-00020b40: 6521 727d 2063 6f6e 666c 6963 7473 2229  e!r} conflicts")
-00020b50: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-00020b60: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
-00020b70: 6172 0a20 2020 2020 2020 2020 2020 2069  ar.            i
-00020b80: 6620 6b20 696e 2073 656c 662e 5f63 6f6f  f k in self._coo
-00020b90: 7264 5f6e 616d 6573 3a0a 2020 2020 2020  rd_names:.      
-00020ba0: 2020 2020 2020 2020 2020 636f 6f72 645f            coord_
-00020bb0: 6e61 6d65 732e 6164 6428 6e61 6d65 290a  names.add(name).
-00020bc0: 2020 2020 2020 2020 7265 7475 726e 2076          return v
-00020bd0: 6172 6961 626c 6573 2c20 636f 6f72 645f  ariables, coord_
-00020be0: 6e61 6d65 730a 0a20 2020 2064 6566 205f  names..    def _
-00020bf0: 7265 6e61 6d65 5f64 696d 7328 7365 6c66  rename_dims(self
-00020c00: 2c20 6e61 6d65 5f64 6963 743a 204d 6170  , name_dict: Map
-00020c10: 7069 6e67 5b41 6e79 2c20 4861 7368 6162  ping[Any, Hashab
-00020c20: 6c65 5d29 202d 3e20 6469 6374 5b48 6173  le]) -> dict[Has
-00020c30: 6861 626c 652c 2069 6e74 5d3a 0a20 2020  hable, int]:.   
-00020c40: 2020 2020 2072 6574 7572 6e20 7b6e 616d       return {nam
+000149d0: 6966 2076 2e64 7479 7065 2e6b 696e 6420  if v.dtype.kind 
+000149e0: 3d3d 2022 6222 3a0a 2020 2020 2020 2020  == "b":.        
+000149f0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+00014a00: 2e6e 6469 6d20 213d 2031 3a20 2023 2077  .ndim != 1:  # w
+00014a10: 6520 6f6e 6c79 2073 7570 706f 7274 2031  e only support 1
+00014a20: 2d64 2062 6f6f 6c65 616e 2061 7272 6179  -d boolean array
+00014a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014a40: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00014a50: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00014a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a70: 2020 2020 2020 2022 7b3a 647d 642d 626f         "{:d}d-bo
+00014a80: 6f6c 6561 6e20 6172 7261 7920 6973 2075  olean array is u
+00014a90: 7365 6420 666f 7220 696e 6465 7869 6e67  sed for indexing
+00014aa0: 2061 6c6f 6e67 2022 0a20 2020 2020 2020   along ".       
+00014ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ac0: 2020 2020 2022 6469 6d65 6e73 696f 6e20       "dimension 
+00014ad0: 7b21 727d 2c20 6275 7420 6f6e 6c79 2031  {!r}, but only 1
+00014ae0: 6420 626f 6f6c 6561 6e20 6172 7261 7973  d boolean arrays
+00014af0: 2061 7265 2022 0a20 2020 2020 2020 2020   are ".         
+00014b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b10: 2020 2022 7375 7070 6f72 7465 642e 222e     "supported.".
+00014b20: 666f 726d 6174 2876 2e6e 6469 6d2c 206b  format(v.ndim, k
+00014b30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014b40: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00014b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b60: 2320 4d61 6b65 2073 7572 6520 696e 2063  # Make sure in c
+00014b70: 6173 6520 6f66 2062 6f6f 6c65 616e 2044  ase of boolean D
+00014b80: 6174 6141 7272 6179 2c20 6974 730a 2020  ataArray, its.  
+00014b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ba0: 2020 2320 636f 6f72 6469 6e61 7465 2061    # coordinate a
+00014bb0: 6c73 6f20 7368 6f75 6c64 2062 6520 696e  lso should be in
+00014bc0: 6465 7865 642e 0a20 2020 2020 2020 2020  dexed..         
+00014bd0: 2020 2020 2020 2020 2020 2076 5f63 6f6f             v_coo
+00014be0: 7264 7320 3d20 765b 762e 7661 6c75 6573  rds = v[v.values
+00014bf0: 2e6e 6f6e 7a65 726f 2829 5b30 5d5d 2e63  .nonzero()[0]].c
+00014c00: 6f6f 7264 730a 2020 2020 2020 2020 2020  oords.          
+00014c10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00014c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c30: 765f 636f 6f72 6473 203d 2076 2e63 6f6f  v_coords = v.coo
+00014c40: 7264 730a 2020 2020 2020 2020 2020 2020  rds.            
+00014c50: 2020 2020 636f 6f72 6473 5f6c 6973 742e      coords_list.
+00014c60: 6170 7065 6e64 2876 5f63 6f6f 7264 7329  append(v_coords)
+00014c70: 0a0a 2020 2020 2020 2020 2320 7765 2064  ..        # we d
+00014c80: 6f6e 2774 206e 6565 6420 746f 2063 616c  on't need to cal
+00014c90: 6c20 616c 6967 6e28 2920 6578 706c 6963  l align() explic
+00014ca0: 6974 6c79 206f 7220 6368 6563 6b20 696e  itly or check in
+00014cb0: 6465 7865 7320 666f 720a 2020 2020 2020  dexes for.      
+00014cc0: 2020 2320 616c 6967 6e6d 656e 742c 2062    # alignment, b
+00014cd0: 6563 6175 7365 206d 6572 6765 5f76 6172  ecause merge_var
+00014ce0: 6961 626c 6573 2061 6c72 6561 6479 2063  iables already c
+00014cf0: 6865 636b 7320 666f 7220 6578 6163 7420  hecks for exact 
+00014d00: 616c 6967 6e6d 656e 740a 2020 2020 2020  alignment.      
+00014d10: 2020 2320 6265 7477 6565 6e20 6469 6d65    # between dime
+00014d20: 6e73 696f 6e20 636f 6f72 6469 6e61 7465  nsion coordinate
+00014d30: 730a 2020 2020 2020 2020 636f 6f72 6473  s.        coords
+00014d40: 2c20 696e 6465 7865 7320 3d20 6d65 7267  , indexes = merg
+00014d50: 655f 636f 6f72 6469 6e61 7465 735f 7769  e_coordinates_wi
+00014d60: 7468 6f75 745f 616c 6967 6e28 636f 6f72  thout_align(coor
+00014d70: 6473 5f6c 6973 7429 0a20 2020 2020 2020  ds_list).       
+00014d80: 2061 7373 6572 745f 636f 6f72 6469 6e61   assert_coordina
+00014d90: 7465 5f63 6f6e 7369 7374 656e 7428 7365  te_consistent(se
+00014da0: 6c66 2c20 636f 6f72 6473 290a 0a20 2020  lf, coords)..   
+00014db0: 2020 2020 2023 2073 696c 656e 746c 7920       # silently 
+00014dc0: 6472 6f70 2074 6865 2063 6f6e 666c 6963  drop the conflic
+00014dd0: 7465 6420 7661 7269 6162 6c65 732e 0a20  ted variables.. 
+00014de0: 2020 2020 2020 2061 7474 6163 6865 645f         attached_
+00014df0: 636f 6f72 6473 203d 207b 6b3a 2076 2066  coords = {k: v f
+00014e00: 6f72 206b 2c20 7620 696e 2063 6f6f 7264  or k, v in coord
+00014e10: 732e 6974 656d 7328 2920 6966 206b 206e  s.items() if k n
+00014e20: 6f74 2069 6e20 7365 6c66 2e5f 7661 7269  ot in self._vari
+00014e30: 6162 6c65 737d 0a20 2020 2020 2020 2061  ables}.        a
+00014e40: 7474 6163 6865 645f 696e 6465 7865 7320  ttached_indexes 
+00014e50: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00014e60: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
+00014e70: 2069 6e64 6578 6573 2e69 7465 6d73 2829   indexes.items()
+00014e80: 2069 6620 6b20 6e6f 7420 696e 2073 656c   if k not in sel
+00014e90: 662e 5f76 6172 6961 626c 6573 0a20 2020  f._variables.   
+00014ea0: 2020 2020 207d 0a20 2020 2020 2020 2072       }.        r
+00014eb0: 6574 7572 6e20 6174 7461 6368 6564 5f63  eturn attached_c
+00014ec0: 6f6f 7264 732c 2061 7474 6163 6865 645f  oords, attached_
+00014ed0: 696e 6465 7865 730a 0a20 2020 2064 6566  indexes..    def
+00014ee0: 2069 7365 6c28 0a20 2020 2020 2020 2073   isel(.        s
+00014ef0: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
+00014f00: 2020 2020 2020 2020 696e 6465 7865 7273          indexers
+00014f10: 3a20 4d61 7070 696e 675b 416e 792c 2041  : Mapping[Any, A
+00014f20: 6e79 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ny] | None = Non
+00014f30: 652c 0a20 2020 2020 2020 2064 726f 703a  e,.        drop:
+00014f40: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+00014f50: 2020 2020 2020 206d 6973 7369 6e67 5f64         missing_d
+00014f60: 696d 733a 2045 7272 6f72 4f70 7469 6f6e  ims: ErrorOption
+00014f70: 7357 6974 6857 6172 6e20 3d20 2272 6169  sWithWarn = "rai
+00014f80: 7365 222c 0a20 2020 2020 2020 202a 2a69  se",.        **i
+00014f90: 6e64 6578 6572 735f 6b77 6172 6773 3a20  ndexers_kwargs: 
+00014fa0: 416e 792c 0a20 2020 2029 202d 3e20 545f  Any,.    ) -> T_
+00014fb0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+00014fc0: 2022 2222 5265 7475 726e 7320 6120 6e65   """Returns a ne
+00014fd0: 7720 6461 7461 7365 7420 7769 7468 2065  w dataset with e
+00014fe0: 6163 6820 6172 7261 7920 696e 6465 7865  ach array indexe
+00014ff0: 6420 616c 6f6e 6720 7468 6520 7370 6563  d along the spec
+00015000: 6966 6965 640a 2020 2020 2020 2020 6469  ified.        di
+00015010: 6d65 6e73 696f 6e28 7329 2e0a 0a20 2020  mension(s)...   
+00015020: 2020 2020 2054 6869 7320 6d65 7468 6f64       This method
+00015030: 2073 656c 6563 7473 2076 616c 7565 7320   selects values 
+00015040: 6672 6f6d 2065 6163 6820 6172 7261 7920  from each array 
+00015050: 7573 696e 6720 6974 7320 605f 5f67 6574  using its `__get
+00015060: 6974 656d 5f5f 600a 2020 2020 2020 2020  item__`.        
+00015070: 6d65 7468 6f64 2c20 6578 6365 7074 2074  method, except t
+00015080: 6869 7320 6d65 7468 6f64 2064 6f65 7320  his method does 
+00015090: 6e6f 7420 7265 7175 6972 6520 6b6e 6f77  not require know
+000150a0: 696e 6720 7468 6520 6f72 6465 7220 6f66  ing the order of
+000150b0: 0a20 2020 2020 2020 2065 6163 6820 6172  .        each ar
+000150c0: 7261 7927 7320 6469 6d65 6e73 696f 6e73  ray's dimensions
+000150d0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+000150e0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+000150f0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00015100: 2069 6e64 6578 6572 7320 3a20 6469 6374   indexers : dict
+00015110: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+00015120: 2020 2020 2020 2041 2064 6963 7420 7769         A dict wi
+00015130: 7468 206b 6579 7320 6d61 7463 6869 6e67  th keys matching
+00015140: 2064 696d 656e 7369 6f6e 7320 616e 6420   dimensions and 
+00015150: 7661 6c75 6573 2067 6976 656e 0a20 2020  values given.   
+00015160: 2020 2020 2020 2020 2062 7920 696e 7465           by inte
+00015170: 6765 7273 2c20 736c 6963 6520 6f62 6a65  gers, slice obje
+00015180: 6374 7320 6f72 2061 7272 6179 732e 0a20  cts or arrays.. 
+00015190: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+000151a0: 6572 2063 616e 2062 6520 6120 696e 7465  er can be a inte
+000151b0: 6765 722c 2073 6c69 6365 2c20 6172 7261  ger, slice, arra
+000151c0: 792d 6c69 6b65 206f 7220 4461 7461 4172  y-like or DataAr
+000151d0: 7261 792e 0a20 2020 2020 2020 2020 2020  ray..           
+000151e0: 2049 6620 4461 7461 4172 7261 7973 2061   If DataArrays a
+000151f0: 7265 2070 6173 7365 6420 6173 2069 6e64  re passed as ind
+00015200: 6578 6572 732c 2078 6172 7261 792d 7374  exers, xarray-st
+00015210: 796c 6520 696e 6465 7869 6e67 2077 696c  yle indexing wil
+00015220: 6c20 6265 0a20 2020 2020 2020 2020 2020  l be.           
+00015230: 2063 6172 7269 6564 206f 7574 2e20 5365   carried out. Se
+00015240: 6520 3a72 6566 3a60 696e 6465 7869 6e67  e :ref:`indexing
+00015250: 6020 666f 7220 7468 6520 6465 7461 696c  ` for the detail
+00015260: 732e 0a20 2020 2020 2020 2020 2020 204f  s..            O
+00015270: 6e65 206f 6620 696e 6465 7865 7273 206f  ne of indexers o
+00015280: 7220 696e 6465 7865 7273 5f6b 7761 7267  r indexers_kwarg
+00015290: 7320 6d75 7374 2062 6520 7072 6f76 6964  s must be provid
+000152a0: 6564 2e0a 2020 2020 2020 2020 6472 6f70  ed..        drop
+000152b0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+000152c0: 3a20 4661 6c73 650a 2020 2020 2020 2020  : False.        
+000152d0: 2020 2020 4966 2060 6064 726f 703d 5472      If ``drop=Tr
+000152e0: 7565 6060 2c20 6472 6f70 2063 6f6f 7264  ue``, drop coord
+000152f0: 696e 6174 6573 2076 6172 6961 626c 6573  inates variables
+00015300: 2069 6e64 6578 6564 2062 7920 696e 7465   indexed by inte
+00015310: 6765 7273 0a20 2020 2020 2020 2020 2020  gers.           
+00015320: 2069 6e73 7465 6164 206f 6620 6d61 6b69   instead of maki
+00015330: 6e67 2074 6865 6d20 7363 616c 6172 2e0a  ng them scalar..
+00015340: 2020 2020 2020 2020 6d69 7373 696e 675f          missing_
+00015350: 6469 6d73 203a 207b 2272 6169 7365 222c  dims : {"raise",
+00015360: 2022 7761 726e 222c 2022 6967 6e6f 7265   "warn", "ignore
+00015370: 227d 2c20 6465 6661 756c 743a 2022 7261  "}, default: "ra
+00015380: 6973 6522 0a20 2020 2020 2020 2020 2020  ise".           
+00015390: 2057 6861 7420 746f 2064 6f20 6966 2064   What to do if d
+000153a0: 696d 656e 7369 6f6e 7320 7468 6174 2073  imensions that s
+000153b0: 686f 756c 6420 6265 2073 656c 6563 7465  hould be selecte
+000153c0: 6420 6672 6f6d 2061 7265 206e 6f74 2070  d from are not p
+000153d0: 7265 7365 6e74 2069 6e20 7468 650a 2020  resent in the.  
+000153e0: 2020 2020 2020 2020 2020 4461 7461 7365            Datase
+000153f0: 743a 0a20 2020 2020 2020 2020 2020 202d  t:.            -
+00015400: 2022 7261 6973 6522 3a20 7261 6973 6520   "raise": raise 
+00015410: 616e 2065 7863 6570 7469 6f6e 0a20 2020  an exception.   
+00015420: 2020 2020 2020 2020 202d 2022 7761 726e           - "warn
+00015430: 223a 2072 6169 7365 2061 2077 6172 6e69  ": raise a warni
+00015440: 6e67 2c20 616e 6420 6967 6e6f 7265 2074  ng, and ignore t
+00015450: 6865 206d 6973 7369 6e67 2064 696d 656e  he missing dimen
+00015460: 7369 6f6e 730a 2020 2020 2020 2020 2020  sions.          
+00015470: 2020 2d20 2269 676e 6f72 6522 3a20 6967    - "ignore": ig
+00015480: 6e6f 7265 2074 6865 206d 6973 7369 6e67  nore the missing
+00015490: 2064 696d 656e 7369 6f6e 730a 0a20 2020   dimensions..   
+000154a0: 2020 2020 202a 2a69 6e64 6578 6572 735f       **indexers_
+000154b0: 6b77 6172 6773 203a 207b 6469 6d3a 2069  kwargs : {dim: i
+000154c0: 6e64 6578 6572 2c20 2e2e 2e7d 2c20 6f70  ndexer, ...}, op
+000154d0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+000154e0: 2020 2054 6865 206b 6579 776f 7264 2061     The keyword a
+000154f0: 7267 756d 656e 7473 2066 6f72 6d20 6f66  rguments form of
+00015500: 2060 6069 6e64 6578 6572 7360 602e 0a20   ``indexers``.. 
+00015510: 2020 2020 2020 2020 2020 204f 6e65 206f             One o
+00015520: 6620 696e 6465 7865 7273 206f 7220 696e  f indexers or in
+00015530: 6465 7865 7273 5f6b 7761 7267 7320 6d75  dexers_kwargs mu
+00015540: 7374 2062 6520 7072 6f76 6964 6564 2e0a  st be provided..
+00015550: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00015560: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00015570: 0a20 2020 2020 2020 206f 626a 203a 2044  .        obj : D
+00015580: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
+00015590: 2020 2041 206e 6577 2044 6174 6173 6574     A new Dataset
+000155a0: 2077 6974 6820 7468 6520 7361 6d65 2063   with the same c
+000155b0: 6f6e 7465 6e74 7320 6173 2074 6869 7320  ontents as this 
+000155c0: 6461 7461 7365 742c 2065 7863 6570 7420  dataset, except 
+000155d0: 6561 6368 0a20 2020 2020 2020 2020 2020  each.           
+000155e0: 2061 7272 6179 2061 6e64 2064 696d 656e   array and dimen
+000155f0: 7369 6f6e 2069 7320 696e 6465 7865 6420  sion is indexed 
+00015600: 6279 2074 6865 2061 7070 726f 7072 6961  by the appropria
+00015610: 7465 2069 6e64 6578 6572 732e 0a20 2020  te indexers..   
+00015620: 2020 2020 2020 2020 2049 6620 696e 6465           If inde
+00015630: 7865 7220 4461 7461 4172 7261 7973 2068  xer DataArrays h
+00015640: 6176 6520 636f 6f72 6469 6e61 7465 7320  ave coordinates 
+00015650: 7468 6174 2064 6f20 6e6f 7420 636f 6e66  that do not conf
+00015660: 6c69 6374 2077 6974 680a 2020 2020 2020  lict with.      
+00015670: 2020 2020 2020 7468 6973 206f 626a 6563        this objec
+00015680: 742c 2074 6865 6e20 7468 6573 6520 636f  t, then these co
+00015690: 6f72 6469 6e61 7465 7320 7769 6c6c 2062  ordinates will b
+000156a0: 6520 6174 7461 6368 6564 2e0a 2020 2020  e attached..    
+000156b0: 2020 2020 2020 2020 496e 2067 656e 6572          In gener
+000156c0: 616c 2c20 6561 6368 2061 7272 6179 2773  al, each array's
+000156d0: 2064 6174 6120 7769 6c6c 2062 6520 6120   data will be a 
+000156e0: 7669 6577 206f 6620 7468 6520 6172 7261  view of the arra
+000156f0: 7927 7320 6461 7461 0a20 2020 2020 2020  y's data.       
+00015700: 2020 2020 2069 6e20 7468 6973 2064 6174       in this dat
+00015710: 6173 6574 2c20 756e 6c65 7373 2076 6563  aset, unless vec
+00015720: 746f 7269 7a65 6420 696e 6465 7869 6e67  torized indexing
+00015730: 2077 6173 2074 7269 6767 6572 6564 2062   was triggered b
+00015740: 7920 7573 696e 670a 2020 2020 2020 2020  y using.        
+00015750: 2020 2020 616e 2061 7272 6179 2069 6e64      an array ind
+00015760: 6578 6572 2c20 696e 2077 6869 6368 2063  exer, in which c
+00015770: 6173 6520 7468 6520 6461 7461 2077 696c  ase the data wil
+00015780: 6c20 6265 2061 2063 6f70 792e 0a0a 2020  l be a copy...  
+00015790: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
+000157a0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+000157b0: 2020 2020 2020 2020 4461 7461 7365 742e          Dataset.
+000157c0: 7365 6c0a 2020 2020 2020 2020 4461 7461  sel.        Data
+000157d0: 4172 7261 792e 6973 656c 0a20 2020 2020  Array.isel.     
+000157e0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+000157f0: 6e64 6578 6572 7320 3d20 6569 7468 6572  ndexers = either
+00015800: 5f64 6963 745f 6f72 5f6b 7761 7267 7328  _dict_or_kwargs(
+00015810: 696e 6465 7865 7273 2c20 696e 6465 7865  indexers, indexe
+00015820: 7273 5f6b 7761 7267 732c 2022 6973 656c  rs_kwargs, "isel
+00015830: 2229 0a20 2020 2020 2020 2069 6620 616e  ").        if an
+00015840: 7928 6973 5f66 616e 6379 5f69 6e64 6578  y(is_fancy_index
+00015850: 6572 2869 6478 2920 666f 7220 6964 7820  er(idx) for idx 
+00015860: 696e 2069 6e64 6578 6572 732e 7661 6c75  in indexers.valu
+00015870: 6573 2829 293a 0a20 2020 2020 2020 2020  es()):.         
+00015880: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00015890: 6973 656c 5f66 616e 6379 2869 6e64 6578  isel_fancy(index
+000158a0: 6572 732c 2064 726f 703d 6472 6f70 2c20  ers, drop=drop, 
+000158b0: 6d69 7373 696e 675f 6469 6d73 3d6d 6973  missing_dims=mis
+000158c0: 7369 6e67 5f64 696d 7329 0a0a 2020 2020  sing_dims)..    
+000158d0: 2020 2020 2320 4d75 6368 2066 6173 7465      # Much faste
+000158e0: 7220 616c 676f 7269 7468 6d20 666f 7220  r algorithm for 
+000158f0: 7768 656e 2061 6c6c 2069 6e64 6578 6572  when all indexer
+00015900: 7320 6172 6520 696e 7473 2c20 736c 6963  s are ints, slic
+00015910: 6573 2c20 6f6e 652d 6469 6d65 6e73 696f  es, one-dimensio
+00015920: 6e61 6c0a 2020 2020 2020 2020 2320 6c69  nal.        # li
+00015930: 7374 732c 206f 7220 7a65 726f 206f 7220  sts, or zero or 
+00015940: 6f6e 652d 6469 6d65 6e73 696f 6e61 6c20  one-dimensional 
+00015950: 6e70 2e6e 6461 7272 6179 2773 0a20 2020  np.ndarray's.   
+00015960: 2020 2020 2069 6e64 6578 6572 7320 3d20       indexers = 
+00015970: 6472 6f70 5f64 696d 735f 6672 6f6d 5f69  drop_dims_from_i
+00015980: 6e64 6578 6572 7328 696e 6465 7865 7273  ndexers(indexers
+00015990: 2c20 7365 6c66 2e64 696d 732c 206d 6973  , self.dims, mis
+000159a0: 7369 6e67 5f64 696d 7329 0a0a 2020 2020  sing_dims)..    
+000159b0: 2020 2020 7661 7269 6162 6c65 7320 3d20      variables = 
+000159c0: 7b7d 0a20 2020 2020 2020 2064 696d 733a  {}.        dims:
+000159d0: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
+000159e0: 696e 745d 203d 207b 7d0a 2020 2020 2020  int] = {}.      
+000159f0: 2020 636f 6f72 645f 6e61 6d65 7320 3d20    coord_names = 
+00015a00: 7365 6c66 2e5f 636f 6f72 645f 6e61 6d65  self._coord_name
+00015a10: 732e 636f 7079 2829 0a0a 2020 2020 2020  s.copy()..      
+00015a20: 2020 696e 6465 7865 732c 2069 6e64 6578    indexes, index
+00015a30: 5f76 6172 6961 626c 6573 203d 2069 7365  _variables = ise
+00015a40: 6c5f 696e 6465 7865 7328 7365 6c66 2e78  l_indexes(self.x
+00015a50: 696e 6465 7865 732c 2069 6e64 6578 6572  indexes, indexer
+00015a60: 7329 0a0a 2020 2020 2020 2020 666f 7220  s)..        for 
+00015a70: 6e61 6d65 2c20 7661 7220 696e 2073 656c  name, var in sel
+00015a80: 662e 5f76 6172 6961 626c 6573 2e69 7465  f._variables.ite
+00015a90: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00015aa0: 2020 2320 7072 6573 6572 7665 2076 6172    # preserve var
+00015ab0: 6961 626c 6520 6f72 6465 720a 2020 2020  iable order.    
+00015ac0: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
+00015ad0: 696e 2069 6e64 6578 5f76 6172 6961 626c  in index_variabl
+00015ae0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00015af0: 2020 2020 7661 7220 3d20 696e 6465 785f      var = index_
+00015b00: 7661 7269 6162 6c65 735b 6e61 6d65 5d0a  variables[name].
+00015b10: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00015b20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015b30: 2020 7661 725f 696e 6465 7865 7273 203d    var_indexers =
+00015b40: 207b 6b3a 2076 2066 6f72 206b 2c20 7620   {k: v for k, v 
+00015b50: 696e 2069 6e64 6578 6572 732e 6974 656d  in indexers.item
+00015b60: 7328 2920 6966 206b 2069 6e20 7661 722e  s() if k in var.
+00015b70: 6469 6d73 7d0a 2020 2020 2020 2020 2020  dims}.          
+00015b80: 2020 2020 2020 6966 2076 6172 5f69 6e64        if var_ind
+00015b90: 6578 6572 733a 0a20 2020 2020 2020 2020  exers:.         
+00015ba0: 2020 2020 2020 2020 2020 2076 6172 203d             var =
+00015bb0: 2076 6172 2e69 7365 6c28 7661 725f 696e   var.isel(var_in
+00015bc0: 6465 7865 7273 290a 2020 2020 2020 2020  dexers).        
+00015bd0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00015be0: 726f 7020 616e 6420 7661 722e 6e64 696d  rop and var.ndim
+00015bf0: 203d 3d20 3020 616e 6420 6e61 6d65 2069   == 0 and name i
+00015c00: 6e20 636f 6f72 645f 6e61 6d65 733a 0a20  n coord_names:. 
+00015c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c20: 2020 2020 2020 2063 6f6f 7264 5f6e 616d         coord_nam
+00015c30: 6573 2e72 656d 6f76 6528 6e61 6d65 290a  es.remove(name).
+00015c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c50: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00015c60: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
+00015c70: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
+00015c80: 6172 0a20 2020 2020 2020 2020 2020 2064  ar.            d
+00015c90: 696d 732e 7570 6461 7465 287a 6970 2876  ims.update(zip(v
+00015ca0: 6172 2e64 696d 732c 2076 6172 2e73 6861  ar.dims, var.sha
+00015cb0: 7065 2929 0a0a 2020 2020 2020 2020 7265  pe))..        re
+00015cc0: 7475 726e 2073 656c 662e 5f63 6f6e 7374  turn self._const
+00015cd0: 7275 6374 5f64 6972 6563 7428 0a20 2020  ruct_direct(.   
+00015ce0: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+00015cf0: 6573 3d76 6172 6961 626c 6573 2c0a 2020  es=variables,.  
+00015d00: 2020 2020 2020 2020 2020 636f 6f72 645f            coord_
+00015d10: 6e61 6d65 733d 636f 6f72 645f 6e61 6d65  names=coord_name
+00015d20: 732c 0a20 2020 2020 2020 2020 2020 2064  s,.            d
+00015d30: 696d 733d 6469 6d73 2c0a 2020 2020 2020  ims=dims,.      
+00015d40: 2020 2020 2020 6174 7472 733d 7365 6c66        attrs=self
+00015d50: 2e5f 6174 7472 732c 0a20 2020 2020 2020  ._attrs,.       
+00015d60: 2020 2020 2069 6e64 6578 6573 3d69 6e64       indexes=ind
+00015d70: 6578 6573 2c0a 2020 2020 2020 2020 2020  exes,.          
+00015d80: 2020 656e 636f 6469 6e67 3d73 656c 662e    encoding=self.
+00015d90: 5f65 6e63 6f64 696e 672c 0a20 2020 2020  _encoding,.     
+00015da0: 2020 2020 2020 2063 6c6f 7365 3d73 656c         close=sel
+00015db0: 662e 5f63 6c6f 7365 2c0a 2020 2020 2020  f._close,.      
+00015dc0: 2020 290a 0a20 2020 2064 6566 205f 6973    )..    def _is
+00015dd0: 656c 5f66 616e 6379 280a 2020 2020 2020  el_fancy(.      
+00015de0: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
+00015df0: 742c 0a20 2020 2020 2020 2069 6e64 6578  t,.        index
+00015e00: 6572 733a 204d 6170 7069 6e67 5b41 6e79  ers: Mapping[Any
+00015e10: 2c20 416e 795d 2c0a 2020 2020 2020 2020  , Any],.        
+00015e20: 2a2c 0a20 2020 2020 2020 2064 726f 703a  *,.        drop:
+00015e30: 2062 6f6f 6c2c 0a20 2020 2020 2020 206d   bool,.        m
+00015e40: 6973 7369 6e67 5f64 696d 733a 2045 7272  issing_dims: Err
+00015e50: 6f72 4f70 7469 6f6e 7357 6974 6857 6172  orOptionsWithWar
+00015e60: 6e20 3d20 2272 6169 7365 222c 0a20 2020  n = "raise",.   
+00015e70: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
+00015e80: 0a20 2020 2020 2020 2076 616c 6964 5f69  .        valid_i
+00015e90: 6e64 6578 6572 7320 3d20 6469 6374 2873  ndexers = dict(s
+00015ea0: 656c 662e 5f76 616c 6964 6174 655f 696e  elf._validate_in
+00015eb0: 6465 7865 7273 2869 6e64 6578 6572 732c  dexers(indexers,
+00015ec0: 206d 6973 7369 6e67 5f64 696d 7329 290a   missing_dims)).
+00015ed0: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
+00015ee0: 6573 3a20 6469 6374 5b48 6173 6861 626c  es: dict[Hashabl
+00015ef0: 652c 2056 6172 6961 626c 655d 203d 207b  e, Variable] = {
+00015f00: 7d0a 2020 2020 2020 2020 696e 6465 7865  }.        indexe
+00015f10: 732c 2069 6e64 6578 5f76 6172 6961 626c  s, index_variabl
+00015f20: 6573 203d 2069 7365 6c5f 696e 6465 7865  es = isel_indexe
+00015f30: 7328 7365 6c66 2e78 696e 6465 7865 732c  s(self.xindexes,
+00015f40: 2076 616c 6964 5f69 6e64 6578 6572 7329   valid_indexers)
+00015f50: 0a0a 2020 2020 2020 2020 666f 7220 6e61  ..        for na
+00015f60: 6d65 2c20 7661 7220 696e 2073 656c 662e  me, var in self.
+00015f70: 7661 7269 6162 6c65 732e 6974 656d 7328  variables.items(
+00015f80: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+00015f90: 6620 6e61 6d65 2069 6e20 696e 6465 785f  f name in index_
+00015fa0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+00015fb0: 2020 2020 2020 2020 2020 206e 6577 5f76             new_v
+00015fc0: 6172 203d 2069 6e64 6578 5f76 6172 6961  ar = index_varia
+00015fd0: 626c 6573 5b6e 616d 655d 0a20 2020 2020  bles[name].     
+00015fe0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00015ff0: 2020 2020 2020 2020 2020 2020 2076 6172               var
+00016000: 5f69 6e64 6578 6572 7320 3d20 7b0a 2020  _indexers = {.  
+00016010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016020: 2020 6b3a 2076 2066 6f72 206b 2c20 7620    k: v for k, v 
+00016030: 696e 2076 616c 6964 5f69 6e64 6578 6572  in valid_indexer
+00016040: 732e 6974 656d 7328 2920 6966 206b 2069  s.items() if k i
+00016050: 6e20 7661 722e 6469 6d73 0a20 2020 2020  n var.dims.     
+00016060: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+00016070: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00016080: 7661 725f 696e 6465 7865 7273 3a0a 2020  var_indexers:.  
+00016090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000160a0: 2020 6e65 775f 7661 7220 3d20 7661 722e    new_var = var.
+000160b0: 6973 656c 2869 6e64 6578 6572 733d 7661  isel(indexers=va
+000160c0: 725f 696e 6465 7865 7273 290a 2020 2020  r_indexers).    
+000160d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000160e0: 2320 6472 6f70 2073 6361 6c61 7220 636f  # drop scalar co
+000160f0: 6f72 6469 6e61 7465 730a 2020 2020 2020  ordinates.      
+00016100: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00016110: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
+00016120: 6f6d 2f70 7964 6174 612f 7861 7272 6179  om/pydata/xarray
+00016130: 2f69 7373 7565 732f 3635 3534 0a20 2020  /issues/6554.   
+00016140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016150: 2069 6620 6e61 6d65 2069 6e20 7365 6c66   if name in self
+00016160: 2e63 6f6f 7264 7320 616e 6420 6472 6f70  .coords and drop
+00016170: 2061 6e64 206e 6577 5f76 6172 2e6e 6469   and new_var.ndi
+00016180: 6d20 3d3d 2030 3a0a 2020 2020 2020 2020  m == 0:.        
+00016190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161a0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+000161b0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161d0: 2020 206e 6577 5f76 6172 203d 2076 6172     new_var = var
+000161e0: 2e63 6f70 7928 6465 6570 3d46 616c 7365  .copy(deep=False
+000161f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016200: 2020 6966 206e 616d 6520 6e6f 7420 696e    if name not in
+00016210: 2069 6e64 6578 6573 3a0a 2020 2020 2020   indexes:.      
+00016220: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00016230: 775f 7661 7220 3d20 6e65 775f 7661 722e  w_var = new_var.
+00016240: 746f 5f62 6173 655f 7661 7269 6162 6c65  to_base_variable
+00016250: 2829 0a20 2020 2020 2020 2020 2020 2076  ().            v
+00016260: 6172 6961 626c 6573 5b6e 616d 655d 203d  ariables[name] =
+00016270: 206e 6577 5f76 6172 0a0a 2020 2020 2020   new_var..      
+00016280: 2020 636f 6f72 645f 6e61 6d65 7320 3d20    coord_names = 
+00016290: 7365 6c66 2e5f 636f 6f72 645f 6e61 6d65  self._coord_name
+000162a0: 7320 2620 7661 7269 6162 6c65 732e 6b65  s & variables.ke
+000162b0: 7973 2829 0a20 2020 2020 2020 2073 656c  ys().        sel
+000162c0: 6563 7465 6420 3d20 7365 6c66 2e5f 7265  ected = self._re
+000162d0: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
+000162e0: 696d 7328 7661 7269 6162 6c65 732c 2063  ims(variables, c
+000162f0: 6f6f 7264 5f6e 616d 6573 2c20 696e 6465  oord_names, inde
+00016300: 7865 7329 0a0a 2020 2020 2020 2020 2320  xes)..        # 
+00016310: 4578 7472 6163 7420 636f 6f72 6469 6e61  Extract coordina
+00016320: 7465 7320 6672 6f6d 2069 6e64 6578 6572  tes from indexer
+00016330: 730a 2020 2020 2020 2020 636f 6f72 645f  s.        coord_
+00016340: 7661 7273 2c20 6e65 775f 696e 6465 7865  vars, new_indexe
+00016350: 7320 3d20 7365 6c65 6374 6564 2e5f 6765  s = selected._ge
+00016360: 745f 696e 6465 7865 7273 5f63 6f6f 7264  t_indexers_coord
+00016370: 735f 616e 645f 696e 6465 7865 7328 696e  s_and_indexes(in
+00016380: 6465 7865 7273 290a 2020 2020 2020 2020  dexers).        
+00016390: 7661 7269 6162 6c65 732e 7570 6461 7465  variables.update
+000163a0: 2863 6f6f 7264 5f76 6172 7329 0a20 2020  (coord_vars).   
+000163b0: 2020 2020 2069 6e64 6578 6573 2e75 7064       indexes.upd
+000163c0: 6174 6528 6e65 775f 696e 6465 7865 7329  ate(new_indexes)
+000163d0: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
+000163e0: 616d 6573 203d 2073 656c 662e 5f63 6f6f  ames = self._coo
+000163f0: 7264 5f6e 616d 6573 2026 2076 6172 6961  rd_names & varia
+00016400: 626c 6573 2e6b 6579 7328 2920 7c20 636f  bles.keys() | co
+00016410: 6f72 645f 7661 7273 2e6b 6579 7328 290a  ord_vars.keys().
+00016420: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00016430: 656c 662e 5f72 6570 6c61 6365 5f77 6974  elf._replace_wit
+00016440: 685f 6e65 775f 6469 6d73 2876 6172 6961  h_new_dims(varia
+00016450: 626c 6573 2c20 636f 6f72 645f 6e61 6d65  bles, coord_name
+00016460: 732c 2069 6e64 6578 6573 3d69 6e64 6578  s, indexes=index
+00016470: 6573 290a 0a20 2020 2064 6566 2073 656c  es)..    def sel
+00016480: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
+00016490: 545f 4461 7461 7365 742c 0a20 2020 2020  T_Dataset,.     
+000164a0: 2020 2069 6e64 6578 6572 733a 204d 6170     indexers: Map
+000164b0: 7069 6e67 5b41 6e79 2c20 416e 795d 207c  ping[Any, Any] |
+000164c0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+000164d0: 2020 2020 2020 6d65 7468 6f64 3a20 7374        method: st
+000164e0: 7220 7c20 4e6f 6e65 203d 204e 6f6e 652c  r | None = None,
+000164f0: 0a20 2020 2020 2020 2074 6f6c 6572 616e  .        toleran
+00016500: 6365 3a20 696e 7420 7c20 666c 6f61 7420  ce: int | float 
+00016510: 7c20 4974 6572 6162 6c65 5b69 6e74 207c  | Iterable[int |
+00016520: 2066 6c6f 6174 5d20 7c20 4e6f 6e65 203d   float] | None =
+00016530: 204e 6f6e 652c 0a20 2020 2020 2020 2064   None,.        d
+00016540: 726f 703a 2062 6f6f 6c20 3d20 4661 6c73  rop: bool = Fals
+00016550: 652c 0a20 2020 2020 2020 202a 2a69 6e64  e,.        **ind
+00016560: 6578 6572 735f 6b77 6172 6773 3a20 416e  exers_kwargs: An
+00016570: 792c 0a20 2020 2029 202d 3e20 545f 4461  y,.    ) -> T_Da
+00016580: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+00016590: 2222 5265 7475 726e 7320 6120 6e65 7720  ""Returns a new 
+000165a0: 6461 7461 7365 7420 7769 7468 2065 6163  dataset with eac
+000165b0: 6820 6172 7261 7920 696e 6465 7865 6420  h array indexed 
+000165c0: 6279 2074 6963 6b20 6c61 6265 6c73 0a20  by tick labels. 
+000165d0: 2020 2020 2020 2061 6c6f 6e67 2074 6865         along the
+000165e0: 2073 7065 6369 6669 6564 2064 696d 656e   specified dimen
+000165f0: 7369 6f6e 2873 292e 0a0a 2020 2020 2020  sion(s)...      
+00016600: 2020 496e 2063 6f6e 7472 6173 7420 746f    In contrast to
+00016610: 2060 4461 7461 7365 742e 6973 656c 602c   `Dataset.isel`,
+00016620: 2069 6e64 6578 6572 7320 666f 7220 7468   indexers for th
+00016630: 6973 206d 6574 686f 6420 7368 6f75 6c64  is method should
+00016640: 2075 7365 0a20 2020 2020 2020 206c 6162   use.        lab
+00016650: 656c 7320 696e 7374 6561 6420 6f66 2069  els instead of i
+00016660: 6e74 6567 6572 732e 0a0a 2020 2020 2020  ntegers...      
+00016670: 2020 556e 6465 7220 7468 6520 686f 6f64    Under the hood
+00016680: 2c20 7468 6973 206d 6574 686f 6420 6973  , this method is
+00016690: 2070 6f77 6572 6564 2062 7920 7573 696e   powered by usin
+000166a0: 6720 7061 6e64 6173 2773 2070 6f77 6572  g pandas's power
+000166b0: 6675 6c20 496e 6465 780a 2020 2020 2020  ful Index.      
+000166c0: 2020 6f62 6a65 6374 732e 2054 6869 7320    objects. This 
+000166d0: 6d61 6b65 7320 6c61 6265 6c20 6261 7365  makes label base
+000166e0: 6420 696e 6465 7869 6e67 2065 7373 656e  d indexing essen
+000166f0: 7469 616c 6c79 206a 7573 7420 6173 2066  tially just as f
+00016700: 6173 7420 6173 0a20 2020 2020 2020 2075  ast as.        u
+00016710: 7369 6e67 2069 6e74 6567 6572 2069 6e64  sing integer ind
+00016720: 6578 696e 672e 0a0a 2020 2020 2020 2020  exing...        
+00016730: 4974 2061 6c73 6f20 6d65 616e 7320 7468  It also means th
+00016740: 6973 206d 6574 686f 6420 7573 6573 2070  is method uses p
+00016750: 616e 6461 7327 7320 2877 656c 6c20 646f  andas's (well do
+00016760: 6375 6d65 6e74 6564 2920 6c6f 6769 6320  cumented) logic 
+00016770: 666f 720a 2020 2020 2020 2020 696e 6465  for.        inde
+00016780: 7869 6e67 2e20 5468 6973 206d 6561 6e73  xing. This means
+00016790: 2079 6f75 2063 616e 2075 7365 2073 7472   you can use str
+000167a0: 696e 6720 7368 6f72 7463 7574 7320 666f  ing shortcuts fo
+000167b0: 7220 6461 7465 7469 6d65 2069 6e64 6578  r datetime index
+000167c0: 6573 0a20 2020 2020 2020 2028 652e 672e  es.        (e.g.
+000167d0: 2c20 2732 3030 302d 3031 2720 746f 2073  , '2000-01' to s
+000167e0: 656c 6563 7420 616c 6c20 7661 6c75 6573  elect all values
+000167f0: 2069 6e20 4a61 6e75 6172 7920 3230 3030   in January 2000
+00016800: 292e 2049 7420 616c 736f 206d 6561 6e73  ). It also means
+00016810: 0a20 2020 2020 2020 2074 6861 7420 736c  .        that sl
+00016820: 6963 6573 2061 7265 2074 7265 6174 6564  ices are treated
+00016830: 2061 7320 696e 636c 7573 6976 6520 6f66   as inclusive of
+00016840: 2062 6f74 6820 7468 6520 7374 6172 7420   both the start 
+00016850: 616e 6420 7374 6f70 2076 616c 7565 732c  and stop values,
+00016860: 0a20 2020 2020 2020 2075 6e6c 696b 6520  .        unlike 
+00016870: 6e6f 726d 616c 2050 7974 686f 6e20 696e  normal Python in
+00016880: 6465 7869 6e67 2e0a 0a20 2020 2020 2020  dexing...       
+00016890: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+000168a0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+000168b0: 2020 2020 2020 2069 6e64 6578 6572 7320         indexers 
+000168c0: 3a20 6469 6374 2c20 6f70 7469 6f6e 616c  : dict, optional
+000168d0: 0a20 2020 2020 2020 2020 2020 2041 2064  .            A d
+000168e0: 6963 7420 7769 7468 206b 6579 7320 6d61  ict with keys ma
+000168f0: 7463 6869 6e67 2064 696d 656e 7369 6f6e  tching dimension
+00016900: 7320 616e 6420 7661 6c75 6573 2067 6976  s and values giv
+00016910: 656e 0a20 2020 2020 2020 2020 2020 2062  en.            b
+00016920: 7920 7363 616c 6172 732c 2073 6c69 6365  y scalars, slice
+00016930: 7320 6f72 2061 7272 6179 7320 6f66 2074  s or arrays of t
+00016940: 6963 6b20 6c61 6265 6c73 2e20 466f 7220  ick labels. For 
+00016950: 6469 6d65 6e73 696f 6e73 2077 6974 680a  dimensions with.
+00016960: 2020 2020 2020 2020 2020 2020 6d75 6c74              mult
+00016970: 692d 696e 6465 782c 2074 6865 2069 6e64  i-index, the ind
+00016980: 6578 6572 206d 6179 2061 6c73 6f20 6265  exer may also be
+00016990: 2061 2064 6963 742d 6c69 6b65 206f 626a   a dict-like obj
+000169a0: 6563 7420 7769 7468 206b 6579 730a 2020  ect with keys.  
+000169b0: 2020 2020 2020 2020 2020 6d61 7463 6869            matchi
+000169c0: 6e67 2069 6e64 6578 206c 6576 656c 206e  ng index level n
+000169d0: 616d 6573 2e0a 2020 2020 2020 2020 2020  ames..          
+000169e0: 2020 4966 2044 6174 6141 7272 6179 7320    If DataArrays 
+000169f0: 6172 6520 7061 7373 6564 2061 7320 696e  are passed as in
+00016a00: 6465 7865 7273 2c20 7861 7272 6179 2d73  dexers, xarray-s
+00016a10: 7479 6c65 2069 6e64 6578 696e 6720 7769  tyle indexing wi
+00016a20: 6c6c 2062 650a 2020 2020 2020 2020 2020  ll be.          
+00016a30: 2020 6361 7272 6965 6420 6f75 742e 2053    carried out. S
+00016a40: 6565 203a 7265 663a 6069 6e64 6578 696e  ee :ref:`indexin
+00016a50: 6760 2066 6f72 2074 6865 2064 6574 6169  g` for the detai
+00016a60: 6c73 2e0a 2020 2020 2020 2020 2020 2020  ls..            
+00016a70: 4f6e 6520 6f66 2069 6e64 6578 6572 7320  One of indexers 
+00016a80: 6f72 2069 6e64 6578 6572 735f 6b77 6172  or indexers_kwar
+00016a90: 6773 206d 7573 7420 6265 2070 726f 7669  gs must be provi
+00016aa0: 6465 642e 0a20 2020 2020 2020 206d 6574  ded..        met
+00016ab0: 686f 6420 3a20 7b4e 6f6e 652c 2022 6e65  hod : {None, "ne
+00016ac0: 6172 6573 7422 2c20 2270 6164 222c 2022  arest", "pad", "
+00016ad0: 6666 696c 6c22 2c20 2262 6163 6b66 696c  ffill", "backfil
+00016ae0: 6c22 2c20 2262 6669 6c6c 227d 2c20 6f70  l", "bfill"}, op
+00016af0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00016b00: 2020 204d 6574 686f 6420 746f 2075 7365     Method to use
+00016b10: 2066 6f72 2069 6e65 7861 6374 206d 6174   for inexact mat
+00016b20: 6368 6573 3a0a 0a20 2020 2020 2020 2020  ches:..         
+00016b30: 2020 202a 204e 6f6e 6520 2864 6566 6175     * None (defau
+00016b40: 6c74 293a 206f 6e6c 7920 6578 6163 7420  lt): only exact 
+00016b50: 6d61 7463 6865 730a 2020 2020 2020 2020  matches.        
+00016b60: 2020 2020 2a20 7061 6420 2f20 6666 696c      * pad / ffil
+00016b70: 6c3a 2070 726f 7061 6761 7465 206c 6173  l: propagate las
+00016b80: 7420 7661 6c69 6420 696e 6465 7820 7661  t valid index va
+00016b90: 6c75 6520 666f 7277 6172 640a 2020 2020  lue forward.    
+00016ba0: 2020 2020 2020 2020 2a20 6261 636b 6669          * backfi
+00016bb0: 6c6c 202f 2062 6669 6c6c 3a20 7072 6f70  ll / bfill: prop
+00016bc0: 6167 6174 6520 6e65 7874 2076 616c 6964  agate next valid
+00016bd0: 2069 6e64 6578 2076 616c 7565 2062 6163   index value bac
+00016be0: 6b77 6172 640a 2020 2020 2020 2020 2020  kward.          
+00016bf0: 2020 2a20 6e65 6172 6573 743a 2075 7365    * nearest: use
+00016c00: 206e 6561 7265 7374 2076 616c 6964 2069   nearest valid i
+00016c10: 6e64 6578 2076 616c 7565 0a20 2020 2020  ndex value.     
+00016c20: 2020 2074 6f6c 6572 616e 6365 203a 206f     tolerance : o
+00016c30: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00016c40: 2020 2020 4d61 7869 6d75 6d20 6469 7374      Maximum dist
+00016c50: 616e 6365 2062 6574 7765 656e 206f 7269  ance between ori
+00016c60: 6769 6e61 6c20 616e 6420 6e65 7720 6c61  ginal and new la
+00016c70: 6265 6c73 2066 6f72 2069 6e65 7861 6374  bels for inexact
+00016c80: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
+00016c90: 6368 6573 2e20 5468 6520 7661 6c75 6573  ches. The values
+00016ca0: 206f 6620 7468 6520 696e 6465 7820 6174   of the index at
+00016cb0: 2074 6865 206d 6174 6368 696e 6720 6c6f   the matching lo
+00016cc0: 6361 7469 6f6e 7320 6d75 7374 0a20 2020  cations must.   
+00016cd0: 2020 2020 2020 2020 2073 6174 6973 6679           satisfy
+00016ce0: 2074 6865 2065 7175 6174 696f 6e20 6060   the equation ``
+00016cf0: 6162 7328 696e 6465 785b 696e 6465 7865  abs(index[indexe
+00016d00: 725d 202d 2074 6172 6765 7429 203c 3d20  r] - target) <= 
+00016d10: 746f 6c65 7261 6e63 6560 602e 0a20 2020  tolerance``..   
+00016d20: 2020 2020 2064 726f 7020 3a20 626f 6f6c       drop : bool
+00016d30: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+00016d40: 2020 2020 2020 2049 6620 6060 6472 6f70         If ``drop
+00016d50: 3d54 7275 6560 602c 2064 726f 7020 636f  =True``, drop co
+00016d60: 6f72 6469 6e61 7465 7320 7661 7269 6162  ordinates variab
+00016d70: 6c65 7320 696e 2060 696e 6465 7865 7273  les in `indexers
+00016d80: 6020 696e 7374 6561 640a 2020 2020 2020  ` instead.      
+00016d90: 2020 2020 2020 6f66 206d 616b 696e 6720        of making 
+00016da0: 7468 656d 2073 6361 6c61 722e 0a20 2020  them scalar..   
+00016db0: 2020 2020 202a 2a69 6e64 6578 6572 735f       **indexers_
+00016dc0: 6b77 6172 6773 203a 207b 6469 6d3a 2069  kwargs : {dim: i
+00016dd0: 6e64 6578 6572 2c20 2e2e 2e7d 2c20 6f70  ndexer, ...}, op
+00016de0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00016df0: 2020 2054 6865 206b 6579 776f 7264 2061     The keyword a
+00016e00: 7267 756d 656e 7473 2066 6f72 6d20 6f66  rguments form of
+00016e10: 2060 6069 6e64 6578 6572 7360 602e 0a20   ``indexers``.. 
+00016e20: 2020 2020 2020 2020 2020 204f 6e65 206f             One o
+00016e30: 6620 696e 6465 7865 7273 206f 7220 696e  f indexers or in
+00016e40: 6465 7865 7273 5f6b 7761 7267 7320 6d75  dexers_kwargs mu
+00016e50: 7374 2062 6520 7072 6f76 6964 6564 2e0a  st be provided..
+00016e60: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00016e70: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00016e80: 0a20 2020 2020 2020 206f 626a 203a 2044  .        obj : D
+00016e90: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
+00016ea0: 2020 2041 206e 6577 2044 6174 6173 6574     A new Dataset
+00016eb0: 2077 6974 6820 7468 6520 7361 6d65 2063   with the same c
+00016ec0: 6f6e 7465 6e74 7320 6173 2074 6869 7320  ontents as this 
+00016ed0: 6461 7461 7365 742c 2065 7863 6570 7420  dataset, except 
+00016ee0: 6561 6368 0a20 2020 2020 2020 2020 2020  each.           
+00016ef0: 2076 6172 6961 626c 6520 616e 6420 6469   variable and di
+00016f00: 6d65 6e73 696f 6e20 6973 2069 6e64 6578  mension is index
+00016f10: 6564 2062 7920 7468 6520 6170 7072 6f70  ed by the approp
+00016f20: 7269 6174 6520 696e 6465 7865 7273 2e0a  riate indexers..
+00016f30: 2020 2020 2020 2020 2020 2020 4966 2069              If i
+00016f40: 6e64 6578 6572 2044 6174 6141 7272 6179  ndexer DataArray
+00016f50: 7320 6861 7665 2063 6f6f 7264 696e 6174  s have coordinat
+00016f60: 6573 2074 6861 7420 646f 206e 6f74 2063  es that do not c
+00016f70: 6f6e 666c 6963 7420 7769 7468 0a20 2020  onflict with.   
+00016f80: 2020 2020 2020 2020 2074 6869 7320 6f62           this ob
+00016f90: 6a65 6374 2c20 7468 656e 2074 6865 7365  ject, then these
+00016fa0: 2063 6f6f 7264 696e 6174 6573 2077 696c   coordinates wil
+00016fb0: 6c20 6265 2061 7474 6163 6865 642e 0a20  l be attached.. 
+00016fc0: 2020 2020 2020 2020 2020 2049 6e20 6765             In ge
+00016fd0: 6e65 7261 6c2c 2065 6163 6820 6172 7261  neral, each arra
+00016fe0: 7927 7320 6461 7461 2077 696c 6c20 6265  y's data will be
+00016ff0: 2061 2076 6965 7720 6f66 2074 6865 2061   a view of the a
+00017000: 7272 6179 2773 2064 6174 610a 2020 2020  rray's data.    
+00017010: 2020 2020 2020 2020 696e 2074 6869 7320          in this 
+00017020: 6461 7461 7365 742c 2075 6e6c 6573 7320  dataset, unless 
+00017030: 7665 6374 6f72 697a 6564 2069 6e64 6578  vectorized index
+00017040: 696e 6720 7761 7320 7472 6967 6765 7265  ing was triggere
+00017050: 6420 6279 2075 7369 6e67 0a20 2020 2020  d by using.     
+00017060: 2020 2020 2020 2061 6e20 6172 7261 7920         an array 
+00017070: 696e 6465 7865 722c 2069 6e20 7768 6963  indexer, in whic
+00017080: 6820 6361 7365 2074 6865 2064 6174 6120  h case the data 
+00017090: 7769 6c6c 2062 6520 6120 636f 7079 2e0a  will be a copy..
+000170a0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+000170b0: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+000170c0: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
+000170d0: 6574 2e69 7365 6c0a 2020 2020 2020 2020  et.isel.        
+000170e0: 4461 7461 4172 7261 792e 7365 6c0a 2020  DataArray.sel.  
+000170f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00017100: 2020 696e 6465 7865 7273 203d 2065 6974    indexers = eit
+00017110: 6865 725f 6469 6374 5f6f 725f 6b77 6172  her_dict_or_kwar
+00017120: 6773 2869 6e64 6578 6572 732c 2069 6e64  gs(indexers, ind
+00017130: 6578 6572 735f 6b77 6172 6773 2c20 2273  exers_kwargs, "s
+00017140: 656c 2229 0a20 2020 2020 2020 2071 7565  el").        que
+00017150: 7279 5f72 6573 756c 7473 203d 206d 6170  ry_results = map
+00017160: 5f69 6e64 6578 5f71 7565 7269 6573 280a  _index_queries(.
+00017170: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00017180: 2c20 696e 6465 7865 7273 3d69 6e64 6578  , indexers=index
+00017190: 6572 732c 206d 6574 686f 643d 6d65 7468  ers, method=meth
+000171a0: 6f64 2c20 746f 6c65 7261 6e63 653d 746f  od, tolerance=to
+000171b0: 6c65 7261 6e63 650a 2020 2020 2020 2020  lerance.        
+000171c0: 290a 0a20 2020 2020 2020 2069 6620 6472  )..        if dr
+000171d0: 6f70 3a0a 2020 2020 2020 2020 2020 2020  op:.            
+000171e0: 6e6f 5f73 6361 6c61 725f 7661 7269 6162  no_scalar_variab
+000171f0: 6c65 7320 3d20 7b7d 0a20 2020 2020 2020  les = {}.       
+00017200: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
+00017210: 2071 7565 7279 5f72 6573 756c 7473 2e76   query_results.v
+00017220: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
+00017230: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017240: 2020 6966 2076 2e64 696d 733a 0a20 2020    if v.dims:.   
+00017250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017260: 206e 6f5f 7363 616c 6172 5f76 6172 6961   no_scalar_varia
+00017270: 626c 6573 5b6b 5d20 3d20 760a 2020 2020  bles[k] = v.    
+00017280: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00017290: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000172a0: 2020 2020 2020 6966 206b 2069 6e20 7365        if k in se
+000172b0: 6c66 2e5f 636f 6f72 645f 6e61 6d65 733a  lf._coord_names:
+000172c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000172d0: 2020 2020 2020 2020 2071 7565 7279 5f72           query_r
+000172e0: 6573 756c 7473 2e64 726f 705f 636f 6f72  esults.drop_coor
+000172f0: 6473 2e61 7070 656e 6428 6b29 0a20 2020  ds.append(k).   
+00017300: 2020 2020 2020 2020 2071 7565 7279 5f72           query_r
+00017310: 6573 756c 7473 2e76 6172 6961 626c 6573  esults.variables
+00017320: 203d 206e 6f5f 7363 616c 6172 5f76 6172   = no_scalar_var
+00017330: 6961 626c 6573 0a0a 2020 2020 2020 2020  iables..        
+00017340: 7265 7375 6c74 203d 2073 656c 662e 6973  result = self.is
+00017350: 656c 2869 6e64 6578 6572 733d 7175 6572  el(indexers=quer
+00017360: 795f 7265 7375 6c74 732e 6469 6d5f 696e  y_results.dim_in
+00017370: 6465 7865 7273 2c20 6472 6f70 3d64 726f  dexers, drop=dro
+00017380: 7029 0a20 2020 2020 2020 2072 6574 7572  p).        retur
+00017390: 6e20 7265 7375 6c74 2e5f 6f76 6572 7772  n result._overwr
+000173a0: 6974 655f 696e 6465 7865 7328 2a71 7565  ite_indexes(*que
+000173b0: 7279 5f72 6573 756c 7473 2e61 735f 7475  ry_results.as_tu
+000173c0: 706c 6528 295b 313a 5d29 0a0a 2020 2020  ple()[1:])..    
+000173d0: 6465 6620 6865 6164 280a 2020 2020 2020  def head(.      
+000173e0: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
+000173f0: 742c 0a20 2020 2020 2020 2069 6e64 6578  t,.        index
+00017400: 6572 733a 204d 6170 7069 6e67 5b41 6e79  ers: Mapping[Any
+00017410: 2c20 696e 745d 207c 2069 6e74 207c 204e  , int] | int | N
+00017420: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+00017430: 2020 2020 2a2a 696e 6465 7865 7273 5f6b      **indexers_k
+00017440: 7761 7267 733a 2041 6e79 2c0a 2020 2020  wargs: Any,.    
+00017450: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+00017460: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00017470: 6e73 2061 206e 6577 2064 6174 6173 6574  ns a new dataset
+00017480: 2077 6974 6820 7468 6520 6669 7273 7420   with the first 
+00017490: 606e 6020 7661 6c75 6573 206f 6620 6561  `n` values of ea
+000174a0: 6368 2061 7272 6179 0a20 2020 2020 2020  ch array.       
+000174b0: 2066 6f72 2074 6865 2073 7065 6369 6669   for the specifi
+000174c0: 6564 2064 696d 656e 7369 6f6e 2873 292e  ed dimension(s).
+000174d0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+000174e0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+000174f0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00017500: 696e 6465 7865 7273 203a 2064 6963 7420  indexers : dict 
+00017510: 6f72 2069 6e74 2c20 6465 6661 756c 743a  or int, default:
+00017520: 2035 0a20 2020 2020 2020 2020 2020 2041   5.            A
+00017530: 2064 6963 7420 7769 7468 206b 6579 7320   dict with keys 
+00017540: 6d61 7463 6869 6e67 2064 696d 656e 7369  matching dimensi
+00017550: 6f6e 7320 616e 6420 696e 7465 6765 7220  ons and integer 
+00017560: 7661 6c75 6573 2060 6e60 0a20 2020 2020  values `n`.     
+00017570: 2020 2020 2020 206f 7220 6120 7369 6e67         or a sing
+00017580: 6c65 2069 6e74 6567 6572 2060 6e60 2061  le integer `n` a
+00017590: 7070 6c69 6564 206f 7665 7220 616c 6c20  pplied over all 
+000175a0: 6469 6d65 6e73 696f 6e73 2e0a 2020 2020  dimensions..    
+000175b0: 2020 2020 2020 2020 4f6e 6520 6f66 2069          One of i
+000175c0: 6e64 6578 6572 7320 6f72 2069 6e64 6578  ndexers or index
+000175d0: 6572 735f 6b77 6172 6773 206d 7573 7420  ers_kwargs must 
+000175e0: 6265 2070 726f 7669 6465 642e 0a20 2020  be provided..   
+000175f0: 2020 2020 202a 2a69 6e64 6578 6572 735f       **indexers_
+00017600: 6b77 6172 6773 203a 207b 6469 6d3a 206e  kwargs : {dim: n
+00017610: 2c20 2e2e 2e7d 2c20 6f70 7469 6f6e 616c  , ...}, optional
+00017620: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+00017630: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+00017640: 7473 2066 6f72 6d20 6f66 2060 6069 6e64  ts form of ``ind
+00017650: 6578 6572 7360 602e 0a20 2020 2020 2020  exers``..       
+00017660: 2020 2020 204f 6e65 206f 6620 696e 6465       One of inde
+00017670: 7865 7273 206f 7220 696e 6465 7865 7273  xers or indexers
+00017680: 5f6b 7761 7267 7320 6d75 7374 2062 6520  _kwargs must be 
+00017690: 7072 6f76 6964 6564 2e0a 0a20 2020 2020  provided...     
+000176a0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+000176b0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+000176c0: 2020 2020 2044 6174 6173 6574 2e74 6169       Dataset.tai
+000176d0: 6c0a 2020 2020 2020 2020 4461 7461 7365  l.        Datase
+000176e0: 742e 7468 696e 0a20 2020 2020 2020 2044  t.thin.        D
+000176f0: 6174 6141 7272 6179 2e68 6561 640a 2020  ataArray.head.  
+00017700: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00017710: 2020 6966 206e 6f74 2069 6e64 6578 6572    if not indexer
+00017720: 735f 6b77 6172 6773 3a0a 2020 2020 2020  s_kwargs:.      
+00017730: 2020 2020 2020 6966 2069 6e64 6578 6572        if indexer
+00017740: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00017750: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+00017760: 6572 7320 3d20 350a 2020 2020 2020 2020  ers = 5.        
+00017770: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+00017780: 7461 6e63 6528 696e 6465 7865 7273 2c20  tance(indexers, 
+00017790: 696e 7429 2061 6e64 206e 6f74 2069 735f  int) and not is_
+000177a0: 6469 6374 5f6c 696b 6528 696e 6465 7865  dict_like(indexe
+000177b0: 7273 293a 0a20 2020 2020 2020 2020 2020  rs):.           
+000177c0: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
+000177d0: 7272 6f72 2822 696e 6465 7865 7273 206d  rror("indexers m
+000177e0: 7573 7420 6265 2065 6974 6865 7220 6469  ust be either di
+000177f0: 6374 2d6c 696b 6520 6f72 2061 2073 696e  ct-like or a sin
+00017800: 676c 6520 696e 7465 6765 7222 290a 2020  gle integer").  
+00017810: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00017820: 6e63 6528 696e 6465 7865 7273 2c20 696e  nce(indexers, in
+00017830: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+00017840: 696e 6465 7865 7273 203d 207b 6469 6d3a  indexers = {dim:
+00017850: 2069 6e64 6578 6572 7320 666f 7220 6469   indexers for di
+00017860: 6d20 696e 2073 656c 662e 6469 6d73 7d0a  m in self.dims}.
+00017870: 2020 2020 2020 2020 696e 6465 7865 7273          indexers
+00017880: 203d 2065 6974 6865 725f 6469 6374 5f6f   = either_dict_o
+00017890: 725f 6b77 6172 6773 2869 6e64 6578 6572  r_kwargs(indexer
+000178a0: 732c 2069 6e64 6578 6572 735f 6b77 6172  s, indexers_kwar
+000178b0: 6773 2c20 2268 6561 6422 290a 2020 2020  gs, "head").    
+000178c0: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
+000178d0: 696e 6465 7865 7273 2e69 7465 6d73 2829  indexers.items()
+000178e0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+000178f0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00017900: 762c 2069 6e74 293a 0a20 2020 2020 2020  v, int):.       
+00017910: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+00017920: 7970 6545 7272 6f72 280a 2020 2020 2020  ypeError(.      
+00017930: 2020 2020 2020 2020 2020 2020 2020 2265                "e
+00017940: 7870 6563 7465 6420 696e 7465 6765 7220  xpected integer 
+00017950: 7479 7065 2069 6e64 6578 6572 2066 6f72  type indexer for
+00017960: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00017970: 2020 2020 2020 2066 2264 696d 656e 7369         f"dimensi
+00017980: 6f6e 207b 6b21 727d 2c20 666f 756e 6420  on {k!r}, found 
+00017990: 7b74 7970 6528 7629 2172 7d22 0a20 2020  {type(v)!r}".   
+000179a0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+000179b0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+000179c0: 7620 3c20 303a 0a20 2020 2020 2020 2020  v < 0:.         
+000179d0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+000179e0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+000179f0: 2020 2020 2020 2020 2020 2020 2022 6578               "ex
+00017a00: 7065 6374 6564 2070 6f73 6974 6976 6520  pected positive 
+00017a10: 696e 7465 6765 7220 6173 2069 6e64 6578  integer as index
+00017a20: 6572 2022 0a20 2020 2020 2020 2020 2020  er ".           
+00017a30: 2020 2020 2020 2020 2066 2266 6f72 2064           f"for d
+00017a40: 696d 656e 7369 6f6e 207b 6b21 727d 2c20  imension {k!r}, 
+00017a50: 666f 756e 6420 7b76 7d22 0a20 2020 2020  found {v}".     
+00017a60: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00017a70: 2020 2020 2069 6e64 6578 6572 735f 736c       indexers_sl
+00017a80: 6963 6573 203d 207b 6b3a 2073 6c69 6365  ices = {k: slice
+00017a90: 2876 616c 2920 666f 7220 6b2c 2076 616c  (val) for k, val
+00017aa0: 2069 6e20 696e 6465 7865 7273 2e69 7465   in indexers.ite
+00017ab0: 6d73 2829 7d0a 2020 2020 2020 2020 7265  ms()}.        re
+00017ac0: 7475 726e 2073 656c 662e 6973 656c 2869  turn self.isel(i
+00017ad0: 6e64 6578 6572 735f 736c 6963 6573 290a  ndexers_slices).
+00017ae0: 0a20 2020 2064 6566 2074 6169 6c28 0a20  .    def tail(. 
+00017af0: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
+00017b00: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
+00017b10: 696e 6465 7865 7273 3a20 4d61 7070 696e  indexers: Mappin
+00017b20: 675b 416e 792c 2069 6e74 5d20 7c20 696e  g[Any, int] | in
+00017b30: 7420 7c20 4e6f 6e65 203d 204e 6f6e 652c  t | None = None,
+00017b40: 0a20 2020 2020 2020 202a 2a69 6e64 6578  .        **index
+00017b50: 6572 735f 6b77 6172 6773 3a20 416e 792c  ers_kwargs: Any,
+00017b60: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
+00017b70: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
+00017b80: 5265 7475 726e 7320 6120 6e65 7720 6461  Returns a new da
+00017b90: 7461 7365 7420 7769 7468 2074 6865 206c  taset with the l
+00017ba0: 6173 7420 606e 6020 7661 6c75 6573 206f  ast `n` values o
+00017bb0: 6620 6561 6368 2061 7272 6179 0a20 2020  f each array.   
+00017bc0: 2020 2020 2066 6f72 2074 6865 2073 7065       for the spe
+00017bd0: 6369 6669 6564 2064 696d 656e 7369 6f6e  cified dimension
+00017be0: 2873 292e 0a0a 2020 2020 2020 2020 5061  (s)...        Pa
+00017bf0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00017c00: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00017c10: 2020 2020 696e 6465 7865 7273 203a 2064      indexers : d
+00017c20: 6963 7420 6f72 2069 6e74 2c20 6465 6661  ict or int, defa
+00017c30: 756c 743a 2035 0a20 2020 2020 2020 2020  ult: 5.         
+00017c40: 2020 2041 2064 6963 7420 7769 7468 206b     A dict with k
+00017c50: 6579 7320 6d61 7463 6869 6e67 2064 696d  eys matching dim
+00017c60: 656e 7369 6f6e 7320 616e 6420 696e 7465  ensions and inte
+00017c70: 6765 7220 7661 6c75 6573 2060 6e60 0a20  ger values `n`. 
+00017c80: 2020 2020 2020 2020 2020 206f 7220 6120             or a 
+00017c90: 7369 6e67 6c65 2069 6e74 6567 6572 2060  single integer `
+00017ca0: 6e60 2061 7070 6c69 6564 206f 7665 7220  n` applied over 
+00017cb0: 616c 6c20 6469 6d65 6e73 696f 6e73 2e0a  all dimensions..
+00017cc0: 2020 2020 2020 2020 2020 2020 4f6e 6520              One 
+00017cd0: 6f66 2069 6e64 6578 6572 7320 6f72 2069  of indexers or i
+00017ce0: 6e64 6578 6572 735f 6b77 6172 6773 206d  ndexers_kwargs m
+00017cf0: 7573 7420 6265 2070 726f 7669 6465 642e  ust be provided.
+00017d00: 0a20 2020 2020 2020 202a 2a69 6e64 6578  .        **index
+00017d10: 6572 735f 6b77 6172 6773 203a 207b 6469  ers_kwargs : {di
+00017d20: 6d3a 206e 2c20 2e2e 2e7d 2c20 6f70 7469  m: n, ...}, opti
+00017d30: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00017d40: 2054 6865 206b 6579 776f 7264 2061 7267   The keyword arg
+00017d50: 756d 656e 7473 2066 6f72 6d20 6f66 2060  uments form of `
+00017d60: 6069 6e64 6578 6572 7360 602e 0a20 2020  `indexers``..   
+00017d70: 2020 2020 2020 2020 204f 6e65 206f 6620           One of 
+00017d80: 696e 6465 7865 7273 206f 7220 696e 6465  indexers or inde
+00017d90: 7865 7273 5f6b 7761 7267 7320 6d75 7374  xers_kwargs must
+00017da0: 2062 6520 7072 6f76 6964 6564 2e0a 0a20   be provided... 
+00017db0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+00017dc0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00017dd0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+00017de0: 2e68 6561 640a 2020 2020 2020 2020 4461  .head.        Da
+00017df0: 7461 7365 742e 7468 696e 0a20 2020 2020  taset.thin.     
+00017e00: 2020 2044 6174 6141 7272 6179 2e74 6169     DataArray.tai
+00017e10: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
+00017e20: 2020 2020 2020 6966 206e 6f74 2069 6e64        if not ind
+00017e30: 6578 6572 735f 6b77 6172 6773 3a0a 2020  exers_kwargs:.  
+00017e40: 2020 2020 2020 2020 2020 6966 2069 6e64            if ind
+00017e50: 6578 6572 7320 6973 204e 6f6e 653a 0a20  exers is None:. 
+00017e60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00017e70: 6e64 6578 6572 7320 3d20 350a 2020 2020  ndexers = 5.    
+00017e80: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00017e90: 7369 6e73 7461 6e63 6528 696e 6465 7865  sinstance(indexe
+00017ea0: 7273 2c20 696e 7429 2061 6e64 206e 6f74  rs, int) and not
+00017eb0: 2069 735f 6469 6374 5f6c 696b 6528 696e   is_dict_like(in
+00017ec0: 6465 7865 7273 293a 0a20 2020 2020 2020  dexers):.       
+00017ed0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+00017ee0: 7970 6545 7272 6f72 2822 696e 6465 7865  ypeError("indexe
+00017ef0: 7273 206d 7573 7420 6265 2065 6974 6865  rs must be eithe
+00017f00: 7220 6469 6374 2d6c 696b 6520 6f72 2061  r dict-like or a
+00017f10: 2073 696e 676c 6520 696e 7465 6765 7222   single integer"
+00017f20: 290a 2020 2020 2020 2020 6966 2069 7369  ).        if isi
+00017f30: 6e73 7461 6e63 6528 696e 6465 7865 7273  nstance(indexers
+00017f40: 2c20 696e 7429 3a0a 2020 2020 2020 2020  , int):.        
+00017f50: 2020 2020 696e 6465 7865 7273 203d 207b      indexers = {
+00017f60: 6469 6d3a 2069 6e64 6578 6572 7320 666f  dim: indexers fo
+00017f70: 7220 6469 6d20 696e 2073 656c 662e 6469  r dim in self.di
+00017f80: 6d73 7d0a 2020 2020 2020 2020 696e 6465  ms}.        inde
+00017f90: 7865 7273 203d 2065 6974 6865 725f 6469  xers = either_di
+00017fa0: 6374 5f6f 725f 6b77 6172 6773 2869 6e64  ct_or_kwargs(ind
+00017fb0: 6578 6572 732c 2069 6e64 6578 6572 735f  exers, indexers_
+00017fc0: 6b77 6172 6773 2c20 2274 6169 6c22 290a  kwargs, "tail").
+00017fd0: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
+00017fe0: 2069 6e20 696e 6465 7865 7273 2e69 7465   in indexers.ite
+00017ff0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00018000: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00018010: 6e63 6528 762c 2069 6e74 293a 0a20 2020  nce(v, int):.   
+00018020: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00018030: 7365 2054 7970 6545 7272 6f72 280a 2020  se TypeError(.  
+00018040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018050: 2020 2265 7870 6563 7465 6420 696e 7465    "expected inte
+00018060: 6765 7220 7479 7065 2069 6e64 6578 6572  ger type indexer
+00018070: 2066 6f72 2022 0a20 2020 2020 2020 2020   for ".         
+00018080: 2020 2020 2020 2020 2020 2066 2264 696d             f"dim
+00018090: 656e 7369 6f6e 207b 6b21 727d 2c20 666f  ension {k!r}, fo
+000180a0: 756e 6420 7b74 7970 6528 7629 2172 7d22  und {type(v)!r}"
+000180b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000180c0: 2029 0a20 2020 2020 2020 2020 2020 2065   ).            e
+000180d0: 6c69 6620 7620 3c20 303a 0a20 2020 2020  lif v < 0:.     
+000180e0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000180f0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00018100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018110: 2022 6578 7065 6374 6564 2070 6f73 6974   "expected posit
+00018120: 6976 6520 696e 7465 6765 7220 6173 2069  ive integer as i
+00018130: 6e64 6578 6572 2022 0a20 2020 2020 2020  ndexer ".       
+00018140: 2020 2020 2020 2020 2020 2020 2066 2266               f"f
+00018150: 6f72 2064 696d 656e 7369 6f6e 207b 6b21  or dimension {k!
+00018160: 727d 2c20 666f 756e 6420 7b76 7d22 0a20  r}, found {v}". 
+00018170: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00018180: 0a20 2020 2020 2020 2069 6e64 6578 6572  .        indexer
+00018190: 735f 736c 6963 6573 203d 207b 0a20 2020  s_slices = {.   
+000181a0: 2020 2020 2020 2020 206b 3a20 736c 6963           k: slic
+000181b0: 6528 2d76 616c 2c20 4e6f 6e65 2920 6966  e(-val, None) if
+000181c0: 2076 616c 2021 3d20 3020 656c 7365 2073   val != 0 else s
+000181d0: 6c69 6365 2876 616c 290a 2020 2020 2020  lice(val).      
+000181e0: 2020 2020 2020 666f 7220 6b2c 2076 616c        for k, val
+000181f0: 2069 6e20 696e 6465 7865 7273 2e69 7465   in indexers.ite
+00018200: 6d73 2829 0a20 2020 2020 2020 207d 0a20  ms().        }. 
+00018210: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00018220: 6c66 2e69 7365 6c28 696e 6465 7865 7273  lf.isel(indexers
+00018230: 5f73 6c69 6365 7329 0a0a 2020 2020 6465  _slices)..    de
+00018240: 6620 7468 696e 280a 2020 2020 2020 2020  f thin(.        
+00018250: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
+00018260: 0a20 2020 2020 2020 2069 6e64 6578 6572  .        indexer
+00018270: 733a 204d 6170 7069 6e67 5b41 6e79 2c20  s: Mapping[Any, 
+00018280: 696e 745d 207c 2069 6e74 207c 204e 6f6e  int] | int | Non
+00018290: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+000182a0: 2020 2a2a 696e 6465 7865 7273 5f6b 7761    **indexers_kwa
+000182b0: 7267 733a 2041 6e79 2c0a 2020 2020 2920  rgs: Any,.    ) 
+000182c0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+000182d0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+000182e0: 2061 206e 6577 2064 6174 6173 6574 2077   a new dataset w
+000182f0: 6974 6820 6561 6368 2061 7272 6179 2069  ith each array i
+00018300: 6e64 6578 6564 2061 6c6f 6e67 2065 7665  ndexed along eve
+00018310: 7279 2060 6e60 2d74 680a 2020 2020 2020  ry `n`-th.      
+00018320: 2020 7661 6c75 6520 666f 7220 7468 6520    value for the 
+00018330: 7370 6563 6966 6965 6420 6469 6d65 6e73  specified dimens
+00018340: 696f 6e28 7329 0a0a 2020 2020 2020 2020  ion(s)..        
+00018350: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00018360: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00018370: 2020 2020 2020 696e 6465 7865 7273 203a        indexers :
+00018380: 2064 6963 7420 6f72 2069 6e74 0a20 2020   dict or int.   
+00018390: 2020 2020 2020 2020 2041 2064 6963 7420           A dict 
+000183a0: 7769 7468 206b 6579 7320 6d61 7463 6869  with keys matchi
+000183b0: 6e67 2064 696d 656e 7369 6f6e 7320 616e  ng dimensions an
+000183c0: 6420 696e 7465 6765 7220 7661 6c75 6573  d integer values
+000183d0: 2060 6e60 0a20 2020 2020 2020 2020 2020   `n`.           
+000183e0: 206f 7220 6120 7369 6e67 6c65 2069 6e74   or a single int
+000183f0: 6567 6572 2060 6e60 2061 7070 6c69 6564  eger `n` applied
+00018400: 206f 7665 7220 616c 6c20 6469 6d65 6e73   over all dimens
+00018410: 696f 6e73 2e0a 2020 2020 2020 2020 2020  ions..          
+00018420: 2020 4f6e 6520 6f66 2069 6e64 6578 6572    One of indexer
+00018430: 7320 6f72 2069 6e64 6578 6572 735f 6b77  s or indexers_kw
+00018440: 6172 6773 206d 7573 7420 6265 2070 726f  args must be pro
+00018450: 7669 6465 642e 0a20 2020 2020 2020 202a  vided..        *
+00018460: 2a69 6e64 6578 6572 735f 6b77 6172 6773  *indexers_kwargs
+00018470: 203a 207b 6469 6d3a 206e 2c20 2e2e 2e7d   : {dim: n, ...}
+00018480: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+00018490: 2020 2020 2020 2054 6865 206b 6579 776f         The keywo
+000184a0: 7264 2061 7267 756d 656e 7473 2066 6f72  rd arguments for
+000184b0: 6d20 6f66 2060 6069 6e64 6578 6572 7360  m of ``indexers`
+000184c0: 602e 0a20 2020 2020 2020 2020 2020 204f  `..            O
+000184d0: 6e65 206f 6620 696e 6465 7865 7273 206f  ne of indexers o
+000184e0: 7220 696e 6465 7865 7273 5f6b 7761 7267  r indexers_kwarg
+000184f0: 7320 6d75 7374 2062 6520 7072 6f76 6964  s must be provid
+00018500: 6564 2e0a 0a20 2020 2020 2020 2045 7861  ed...        Exa
+00018510: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
+00018520: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
+00018530: 3e3e 2078 5f61 7272 203d 206e 702e 6172  >> x_arr = np.ar
+00018540: 616e 6765 2830 2c20 3236 290a 2020 2020  ange(0, 26).    
+00018550: 2020 2020 3e3e 3e20 785f 6172 720a 2020      >>> x_arr.  
+00018560: 2020 2020 2020 6172 7261 7928 5b20 302c        array([ 0,
+00018570: 2020 312c 2020 322c 2020 332c 2020 342c    1,  2,  3,  4,
+00018580: 2020 352c 2020 362c 2020 372c 2020 382c    5,  6,  7,  8,
+00018590: 2020 392c 2031 302c 2031 312c 2031 322c    9, 10, 11, 12,
+000185a0: 2031 332c 2031 342c 2031 352c 2031 362c   13, 14, 15, 16,
+000185b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000185c0: 3137 2c20 3138 2c20 3139 2c20 3230 2c20  17, 18, 19, 20, 
+000185d0: 3231 2c20 3232 2c20 3233 2c20 3234 2c20  21, 22, 23, 24, 
+000185e0: 3235 5d29 0a20 2020 2020 2020 203e 3e3e  25]).        >>>
+000185f0: 2078 203d 2078 722e 4461 7461 4172 7261   x = xr.DataArra
+00018600: 7928 0a20 2020 2020 2020 202e 2e2e 2020  y(.        ...  
+00018610: 2020 206e 702e 7265 7368 6170 6528 785f     np.reshape(x_
+00018620: 6172 722c 2028 322c 2031 3329 292c 0a20  arr, (2, 13)),. 
+00018630: 2020 2020 2020 202e 2e2e 2020 2020 2064         ...     d
+00018640: 696d 733d 2822 7822 2c20 2279 2229 2c0a  ims=("x", "y"),.
+00018650: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+00018660: 636f 6f72 6473 3d7b 2278 223a 205b 302c  coords={"x": [0,
+00018670: 2031 5d2c 2022 7922 3a20 6e70 2e61 7261   1], "y": np.ara
+00018680: 6e67 6528 302c 2031 3329 7d2c 0a20 2020  nge(0, 13)},.   
+00018690: 2020 2020 202e 2e2e 2029 0a20 2020 2020       ... ).     
+000186a0: 2020 203e 3e3e 2078 5f64 7320 3d20 7872     >>> x_ds = xr
+000186b0: 2e44 6174 6173 6574 287b 2266 6f6f 223a  .Dataset({"foo":
+000186c0: 2078 7d29 0a20 2020 2020 2020 203e 3e3e   x}).        >>>
+000186d0: 2078 5f64 730a 2020 2020 2020 2020 3c78   x_ds.        <x
+000186e0: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
+000186f0: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+00018700: 733a 2020 2878 3a20 322c 2079 3a20 3133  s:  (x: 2, y: 13
+00018710: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
+00018720: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
+00018730: 202a 2078 2020 2020 2020 2020 2878 2920   * x        (x) 
+00018740: 696e 7436 3420 3020 310a 2020 2020 2020  int64 0 1.      
+00018750: 2020 2020 2a20 7920 2020 2020 2020 2028      * y        (
+00018760: 7929 2069 6e74 3634 2030 2031 2032 2033  y) int64 0 1 2 3
+00018770: 2034 2035 2036 2037 2038 2039 2031 3020   4 5 6 7 8 9 10 
+00018780: 3131 2031 320a 2020 2020 2020 2020 4461  11 12.        Da
+00018790: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
+000187a0: 2020 2020 2020 2020 2020 666f 6f20 2020            foo   
+000187b0: 2020 2028 782c 2079 2920 696e 7436 3420     (x, y) int64 
+000187c0: 3020 3120 3220 3320 3420 3520 3620 3720  0 1 2 3 4 5 6 7 
+000187d0: 3820 3920 2e2e 2e20 3136 2031 3720 3138  8 9 ... 16 17 18
+000187e0: 2031 3920 3230 2032 3120 3232 2032 3320   19 20 21 22 23 
+000187f0: 3234 2032 350a 0a20 2020 2020 2020 203e  24 25..        >
+00018800: 3e3e 2078 5f64 732e 7468 696e 2833 290a  >> x_ds.thin(3).
+00018810: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+00018820: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+00018830: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
+00018840: 3a20 312c 2079 3a20 3529 0a20 2020 2020  : 1, y: 5).     
+00018850: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+00018860: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
+00018870: 2020 2020 2028 7829 2069 6e74 3634 2030       (x) int64 0
+00018880: 0a20 2020 2020 2020 2020 202a 2079 2020  .          * y  
+00018890: 2020 2020 2020 2879 2920 696e 7436 3420        (y) int64 
+000188a0: 3020 3320 3620 3920 3132 0a20 2020 2020  0 3 6 9 12.     
+000188b0: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
+000188c0: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
+000188d0: 6f6f 2020 2020 2020 2878 2c20 7929 2069  oo      (x, y) i
+000188e0: 6e74 3634 2030 2033 2036 2039 2031 320a  nt64 0 3 6 9 12.
+000188f0: 2020 2020 2020 2020 3e3e 3e20 782e 7468          >>> x.th
+00018900: 696e 287b 2278 223a 2032 2c20 2279 223a  in({"x": 2, "y":
+00018910: 2035 7d29 0a20 2020 2020 2020 203c 7861   5}).        <xa
+00018920: 7272 6179 2e44 6174 6141 7272 6179 2028  rray.DataArray (
+00018930: 783a 2031 2c20 793a 2033 293e 0a20 2020  x: 1, y: 3)>.   
+00018940: 2020 2020 2061 7272 6179 285b 5b20 302c       array([[ 0,
+00018950: 2020 352c 2031 305d 5d29 0a20 2020 2020    5, 10]]).     
+00018960: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+00018970: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
+00018980: 2020 2020 2028 7829 2069 6e74 3634 2030       (x) int64 0
+00018990: 0a20 2020 2020 2020 2020 202a 2079 2020  .          * y  
+000189a0: 2020 2020 2020 2879 2920 696e 7436 3420        (y) int64 
+000189b0: 3020 3520 3130 0a0a 2020 2020 2020 2020  0 5 10..        
+000189c0: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+000189d0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+000189e0: 2020 4461 7461 7365 742e 6865 6164 0a20    Dataset.head. 
+000189f0: 2020 2020 2020 2044 6174 6173 6574 2e74         Dataset.t
+00018a00: 6169 6c0a 2020 2020 2020 2020 4461 7461  ail.        Data
+00018a10: 4172 7261 792e 7468 696e 0a20 2020 2020  Array.thin.     
+00018a20: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00018a30: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+00018a40: 6e6f 7420 696e 6465 7865 7273 5f6b 7761  not indexers_kwa
+00018a50: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
+00018a60: 616e 6420 6e6f 7420 6973 696e 7374 616e  and not isinstan
+00018a70: 6365 2869 6e64 6578 6572 732c 2069 6e74  ce(indexers, int
+00018a80: 290a 2020 2020 2020 2020 2020 2020 616e  ).            an
+00018a90: 6420 6e6f 7420 6973 5f64 6963 745f 6c69  d not is_dict_li
+00018aa0: 6b65 2869 6e64 6578 6572 7329 0a20 2020  ke(indexers).   
+00018ab0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00018ac0: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+00018ad0: 726f 7228 2269 6e64 6578 6572 7320 6d75  ror("indexers mu
+00018ae0: 7374 2062 6520 6569 7468 6572 2064 6963  st be either dic
+00018af0: 742d 6c69 6b65 206f 7220 6120 7369 6e67  t-like or a sing
+00018b00: 6c65 2069 6e74 6567 6572 2229 0a20 2020  le integer").   
+00018b10: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00018b20: 6365 2869 6e64 6578 6572 732c 2069 6e74  ce(indexers, int
+00018b30: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+00018b40: 6e64 6578 6572 7320 3d20 7b64 696d 3a20  ndexers = {dim: 
+00018b50: 696e 6465 7865 7273 2066 6f72 2064 696d  indexers for dim
+00018b60: 2069 6e20 7365 6c66 2e64 696d 737d 0a20   in self.dims}. 
+00018b70: 2020 2020 2020 2069 6e64 6578 6572 7320         indexers 
+00018b80: 3d20 6569 7468 6572 5f64 6963 745f 6f72  = either_dict_or
+00018b90: 5f6b 7761 7267 7328 696e 6465 7865 7273  _kwargs(indexers
+00018ba0: 2c20 696e 6465 7865 7273 5f6b 7761 7267  , indexers_kwarg
+00018bb0: 732c 2022 7468 696e 2229 0a20 2020 2020  s, "thin").     
+00018bc0: 2020 2066 6f72 206b 2c20 7620 696e 2069     for k, v in i
+00018bd0: 6e64 6578 6572 732e 6974 656d 7328 293a  ndexers.items():
+00018be0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00018bf0: 6e6f 7420 6973 696e 7374 616e 6365 2876  not isinstance(v
+00018c00: 2c20 696e 7429 3a0a 2020 2020 2020 2020  , int):.        
+00018c10: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+00018c20: 7065 4572 726f 7228 0a20 2020 2020 2020  peError(.       
+00018c30: 2020 2020 2020 2020 2020 2020 2022 6578               "ex
+00018c40: 7065 6374 6564 2069 6e74 6567 6572 2074  pected integer t
+00018c50: 7970 6520 696e 6465 7865 7220 666f 7220  ype indexer for 
+00018c60: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00018c70: 2020 2020 2020 6622 6469 6d65 6e73 696f        f"dimensio
+00018c80: 6e20 7b6b 2172 7d2c 2066 6f75 6e64 207b  n {k!r}, found {
+00018c90: 7479 7065 2876 2921 727d 220a 2020 2020  type(v)!r}".    
+00018ca0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00018cb0: 2020 2020 2020 2020 2020 656c 6966 2076            elif v
+00018cc0: 203c 2030 3a0a 2020 2020 2020 2020 2020   < 0:.          
+00018cd0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00018ce0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00018cf0: 2020 2020 2020 2020 2020 2020 2265 7870              "exp
+00018d00: 6563 7465 6420 706f 7369 7469 7665 2069  ected positive i
+00018d10: 6e74 6567 6572 2061 7320 696e 6465 7865  nteger as indexe
+00018d20: 7220 220a 2020 2020 2020 2020 2020 2020  r ".            
+00018d30: 2020 2020 2020 2020 6622 666f 7220 6469          f"for di
+00018d40: 6d65 6e73 696f 6e20 7b6b 2172 7d2c 2066  mension {k!r}, f
+00018d50: 6f75 6e64 207b 767d 220a 2020 2020 2020  ound {v}".      
+00018d60: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00018d70: 2020 2020 2020 2020 656c 6966 2076 203d          elif v =
+00018d80: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00018d90: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00018da0: 4572 726f 7228 2273 7465 7020 6361 6e6e  Error("step cann
+00018db0: 6f74 2062 6520 7a65 726f 2229 0a20 2020  ot be zero").   
+00018dc0: 2020 2020 2069 6e64 6578 6572 735f 736c       indexers_sl
+00018dd0: 6963 6573 203d 207b 6b3a 2073 6c69 6365  ices = {k: slice
+00018de0: 284e 6f6e 652c 204e 6f6e 652c 2076 616c  (None, None, val
+00018df0: 2920 666f 7220 6b2c 2076 616c 2069 6e20  ) for k, val in 
+00018e00: 696e 6465 7865 7273 2e69 7465 6d73 2829  indexers.items()
+00018e10: 7d0a 2020 2020 2020 2020 7265 7475 726e  }.        return
+00018e20: 2073 656c 662e 6973 656c 2869 6e64 6578   self.isel(index
+00018e30: 6572 735f 736c 6963 6573 290a 0a20 2020  ers_slices)..   
+00018e40: 2064 6566 2062 726f 6164 6361 7374 5f6c   def broadcast_l
+00018e50: 696b 6528 0a20 2020 2020 2020 2073 656c  ike(.        sel
+00018e60: 663a 2054 5f44 6174 6173 6574 2c0a 2020  f: T_Dataset,.  
+00018e70: 2020 2020 2020 6f74 6865 723a 2044 6174        other: Dat
+00018e80: 6173 6574 207c 2044 6174 6141 7272 6179  aset | DataArray
+00018e90: 2c0a 2020 2020 2020 2020 6578 636c 7564  ,.        exclud
+00018ea0: 653a 2049 7465 7261 626c 655b 4861 7368  e: Iterable[Hash
+00018eb0: 6162 6c65 5d20 7c20 4e6f 6e65 203d 204e  able] | None = N
+00018ec0: 6f6e 652c 0a20 2020 2029 202d 3e20 545f  one,.    ) -> T_
+00018ed0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+00018ee0: 2022 2222 4272 6f61 6463 6173 7420 7468   """Broadcast th
+00018ef0: 6973 2044 6174 6141 7272 6179 2061 6761  is DataArray aga
+00018f00: 696e 7374 2061 6e6f 7468 6572 2044 6174  inst another Dat
+00018f10: 6173 6574 206f 7220 4461 7461 4172 7261  aset or DataArra
+00018f20: 792e 0a20 2020 2020 2020 2054 6869 7320  y..        This 
+00018f30: 6973 2065 7175 6976 616c 656e 7420 746f  is equivalent to
+00018f40: 2078 722e 6272 6f61 6463 6173 7428 6f74   xr.broadcast(ot
+00018f50: 6865 722c 2073 656c 6629 5b31 5d0a 0a20  her, self)[1].. 
+00018f60: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00018f70: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00018f80: 2d2d 2d2d 0a20 2020 2020 2020 206f 7468  ----.        oth
+00018f90: 6572 203a 2044 6174 6173 6574 206f 7220  er : Dataset or 
+00018fa0: 4461 7461 4172 7261 790a 2020 2020 2020  DataArray.      
+00018fb0: 2020 2020 2020 4f62 6a65 6374 2061 6761        Object aga
+00018fc0: 696e 7374 2077 6869 6368 2074 6f20 6272  inst which to br
+00018fd0: 6f61 6463 6173 7420 7468 6973 2061 7272  oadcast this arr
+00018fe0: 6179 2e0a 2020 2020 2020 2020 6578 636c  ay..        excl
+00018ff0: 7564 6520 3a20 6974 6572 6162 6c65 206f  ude : iterable o
+00019000: 6620 6861 7368 6162 6c65 2c20 6f70 7469  f hashable, opti
+00019010: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00019020: 2044 696d 656e 7369 6f6e 7320 7468 6174   Dimensions that
+00019030: 206d 7573 7420 6e6f 7420 6265 2062 726f   must not be bro
+00019040: 6164 6361 7374 6564 0a0a 2020 2020 2020  adcasted..      
+00019050: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00019060: 2065 7863 6c75 6465 2069 7320 4e6f 6e65   exclude is None
+00019070: 3a0a 2020 2020 2020 2020 2020 2020 6578  :.            ex
+00019080: 636c 7564 6520 3d20 7365 7428 290a 2020  clude = set().  
+00019090: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000190a0: 2020 2020 2020 2020 6578 636c 7564 6520          exclude 
+000190b0: 3d20 7365 7428 6578 636c 7564 6529 0a20  = set(exclude). 
+000190c0: 2020 2020 2020 2061 7267 7320 3d20 616c         args = al
+000190d0: 6967 6e28 6f74 6865 722c 2073 656c 662c  ign(other, self,
+000190e0: 206a 6f69 6e3d 226f 7574 6572 222c 2063   join="outer", c
+000190f0: 6f70 793d 4661 6c73 652c 2065 7863 6c75  opy=False, exclu
+00019100: 6465 3d65 7863 6c75 6465 290a 0a20 2020  de=exclude)..   
+00019110: 2020 2020 2064 696d 735f 6d61 702c 2063       dims_map, c
+00019120: 6f6d 6d6f 6e5f 636f 6f72 6473 203d 205f  ommon_coords = _
+00019130: 6765 745f 6272 6f61 6463 6173 745f 6469  get_broadcast_di
+00019140: 6d73 5f6d 6170 5f63 6f6d 6d6f 6e5f 636f  ms_map_common_co
+00019150: 6f72 6473 2861 7267 732c 2065 7863 6c75  ords(args, exclu
+00019160: 6465 290a 0a20 2020 2020 2020 2072 6574  de)..        ret
+00019170: 7572 6e20 5f62 726f 6164 6361 7374 5f68  urn _broadcast_h
+00019180: 656c 7065 7228 0a20 2020 2020 2020 2020  elper(.         
+00019190: 2020 2063 6173 7428 2254 5f44 6174 6173     cast("T_Datas
+000191a0: 6574 222c 2061 7267 735b 315d 292c 2065  et", args[1]), e
+000191b0: 7863 6c75 6465 2c20 6469 6d73 5f6d 6170  xclude, dims_map
+000191c0: 2c20 636f 6d6d 6f6e 5f63 6f6f 7264 730a  , common_coords.
+000191d0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+000191e0: 6566 205f 7265 696e 6465 785f 6361 6c6c  ef _reindex_call
+000191f0: 6261 636b 280a 2020 2020 2020 2020 7365  back(.        se
+00019200: 6c66 2c0a 2020 2020 2020 2020 616c 6967  lf,.        alig
+00019210: 6e65 723a 2061 6c69 676e 6d65 6e74 2e41  ner: alignment.A
+00019220: 6c69 676e 6572 2c0a 2020 2020 2020 2020  ligner,.        
+00019230: 6469 6d5f 706f 735f 696e 6465 7865 7273  dim_pos_indexers
+00019240: 3a20 6469 6374 5b48 6173 6861 626c 652c  : dict[Hashable,
+00019250: 2041 6e79 5d2c 0a20 2020 2020 2020 2076   Any],.        v
+00019260: 6172 6961 626c 6573 3a20 6469 6374 5b48  ariables: dict[H
+00019270: 6173 6861 626c 652c 2056 6172 6961 626c  ashable, Variabl
+00019280: 655d 2c0a 2020 2020 2020 2020 696e 6465  e],.        inde
+00019290: 7865 733a 2064 6963 745b 4861 7368 6162  xes: dict[Hashab
+000192a0: 6c65 2c20 496e 6465 785d 2c0a 2020 2020  le, Index],.    
+000192b0: 2020 2020 6669 6c6c 5f76 616c 7565 3a20      fill_value: 
+000192c0: 416e 792c 0a20 2020 2020 2020 2065 7863  Any,.        exc
+000192d0: 6c75 6465 5f64 696d 733a 2066 726f 7a65  lude_dims: froze
+000192e0: 6e73 6574 5b48 6173 6861 626c 655d 2c0a  nset[Hashable],.
+000192f0: 2020 2020 2020 2020 6578 636c 7564 655f          exclude_
+00019300: 7661 7273 3a20 6672 6f7a 656e 7365 745b  vars: frozenset[
+00019310: 4861 7368 6162 6c65 5d2c 0a20 2020 2029  Hashable],.    )
+00019320: 202d 3e20 4461 7461 7365 743a 0a20 2020   -> Dataset:.   
+00019330: 2020 2020 2022 2222 4361 6c6c 6261 636b       """Callback
+00019340: 2063 616c 6c65 6420 6672 6f6d 2060 6041   called from ``A
+00019350: 6c69 676e 6572 6060 2074 6f20 6372 6561  ligner`` to crea
+00019360: 7465 2061 206e 6577 2072 6569 6e64 6578  te a new reindex
+00019370: 6564 2044 6174 6173 6574 2e22 2222 0a0a  ed Dataset."""..
+00019380: 2020 2020 2020 2020 6e65 775f 7661 7269          new_vari
+00019390: 6162 6c65 7320 3d20 7661 7269 6162 6c65  ables = variable
+000193a0: 732e 636f 7079 2829 0a20 2020 2020 2020  s.copy().       
+000193b0: 206e 6577 5f69 6e64 6578 6573 203d 2069   new_indexes = i
+000193c0: 6e64 6578 6573 2e63 6f70 7928 290a 0a20  ndexes.copy().. 
+000193d0: 2020 2020 2020 2023 2072 652d 6173 7369         # re-assi
+000193e0: 676e 2076 6172 6961 626c 6520 6d65 7461  gn variable meta
+000193f0: 6461 7461 0a20 2020 2020 2020 2066 6f72  data.        for
+00019400: 206e 616d 652c 206e 6577 5f76 6172 2069   name, new_var i
+00019410: 6e20 6e65 775f 7661 7269 6162 6c65 732e  n new_variables.
+00019420: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+00019430: 2020 2020 2076 6172 203d 2073 656c 662e       var = self.
+00019440: 5f76 6172 6961 626c 6573 2e67 6574 286e  _variables.get(n
+00019450: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00019460: 2069 6620 7661 7220 6973 206e 6f74 204e   if var is not N
+00019470: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00019480: 2020 2020 206e 6577 5f76 6172 2e61 7474       new_var.att
+00019490: 7273 203d 2076 6172 2e61 7474 7273 0a20  rs = var.attrs. 
+000194a0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000194b0: 6577 5f76 6172 2e65 6e63 6f64 696e 6720  ew_var.encoding 
+000194c0: 3d20 7661 722e 656e 636f 6469 6e67 0a0a  = var.encoding..
+000194d0: 2020 2020 2020 2020 2320 7061 7373 2074          # pass t
+000194e0: 6872 6f75 6768 2069 6e64 6578 6573 2066  hrough indexes f
+000194f0: 726f 6d20 6578 636c 7564 6564 2064 696d  rom excluded dim
+00019500: 656e 7369 6f6e 730a 2020 2020 2020 2020  ensions.        
+00019510: 2320 6e6f 2065 7874 7261 2063 6865 636b  # no extra check
+00019520: 206e 6565 6465 6420 666f 7220 6d75 6c74   needed for mult
+00019530: 692d 636f 6f72 6469 6e61 7465 2069 6e64  i-coordinate ind
+00019540: 6578 6573 2c20 706f 7465 6e74 6961 6c20  exes, potential 
+00019550: 636f 6e66 6c69 6374 730a 2020 2020 2020  conflicts.      
+00019560: 2020 2320 7368 6f75 6c64 2061 6c72 6561    # should alrea
+00019570: 6479 2068 6176 6520 6265 656e 2064 6574  dy have been det
+00019580: 6563 7465 6420 7768 656e 2061 6c69 676e  ected when align
+00019590: 696e 6720 7468 6520 696e 6465 7865 730a  ing the indexes.
+000195a0: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
+000195b0: 2c20 6964 7820 696e 2073 656c 662e 5f69  , idx in self._i
+000195c0: 6e64 6578 6573 2e69 7465 6d73 2829 3a0a  ndexes.items():.
+000195d0: 2020 2020 2020 2020 2020 2020 7661 7220              var 
+000195e0: 3d20 7365 6c66 2e5f 7661 7269 6162 6c65  = self._variable
+000195f0: 735b 6e61 6d65 5d0a 2020 2020 2020 2020  s[name].        
+00019600: 2020 2020 6966 2073 6574 2876 6172 2e64      if set(var.d
+00019610: 696d 7329 203c 3d20 6578 636c 7564 655f  ims) <= exclude_
+00019620: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
+00019630: 2020 2020 2020 6e65 775f 696e 6465 7865        new_indexe
+00019640: 735b 6e61 6d65 5d20 3d20 6964 780a 2020  s[name] = idx.  
+00019650: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00019660: 775f 7661 7269 6162 6c65 735b 6e61 6d65  w_variables[name
+00019670: 5d20 3d20 7661 720a 0a20 2020 2020 2020  ] = var..       
+00019680: 2069 6620 6e6f 7420 6469 6d5f 706f 735f   if not dim_pos_
+00019690: 696e 6465 7865 7273 3a0a 2020 2020 2020  indexers:.      
+000196a0: 2020 2020 2020 2320 6661 7374 2070 6174        # fast pat
+000196b0: 6820 666f 7220 6e6f 2072 6569 6e64 6578  h for no reindex
+000196c0: 696e 6720 6e65 6365 7373 6172 790a 2020  ing necessary.  
+000196d0: 2020 2020 2020 2020 2020 6966 2073 6574            if set
+000196e0: 286e 6577 5f69 6e64 6578 6573 2920 2d20  (new_indexes) - 
+000196f0: 7365 7428 7365 6c66 2e5f 696e 6465 7865  set(self._indexe
+00019700: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00019710: 2020 2020 2320 7468 6973 206f 6e6c 7920      # this only 
+00019720: 6164 6473 206e 6577 2069 6e64 6578 6573  adds new indexes
+00019730: 2061 6e64 2074 6865 6972 2063 6f6f 7264   and their coord
+00019740: 696e 6174 6520 7661 7269 6162 6c65 730a  inate variables.
+00019750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019760: 7265 696e 6465 7865 6420 3d20 7365 6c66  reindexed = self
+00019770: 2e5f 6f76 6572 7772 6974 655f 696e 6465  ._overwrite_inde
+00019780: 7865 7328 6e65 775f 696e 6465 7865 732c  xes(new_indexes,
+00019790: 206e 6577 5f76 6172 6961 626c 6573 290a   new_variables).
+000197a0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000197b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000197c0: 2020 7265 696e 6465 7865 6420 3d20 7365    reindexed = se
+000197d0: 6c66 2e63 6f70 7928 6465 6570 3d61 6c69  lf.copy(deep=ali
+000197e0: 676e 6572 2e63 6f70 7929 0a20 2020 2020  gner.copy).     
+000197f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00019800: 2020 2020 2074 6f5f 7265 696e 6465 7820       to_reindex 
+00019810: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00019820: 2020 2020 6b3a 2076 0a20 2020 2020 2020      k: v.       
+00019830: 2020 2020 2020 2020 2066 6f72 206b 2c20           for k, 
+00019840: 7620 696e 2073 656c 662e 7661 7269 6162  v in self.variab
+00019850: 6c65 732e 6974 656d 7328 290a 2020 2020  les.items().    
+00019860: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00019870: 206e 6f74 2069 6e20 7661 7269 6162 6c65   not in variable
+00019880: 7320 616e 6420 6b20 6e6f 7420 696e 2065  s and k not in e
+00019890: 7863 6c75 6465 5f76 6172 730a 2020 2020  xclude_vars.    
+000198a0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+000198b0: 2020 2020 2020 7265 696e 6465 7865 645f        reindexed_
+000198c0: 7661 7273 203d 2061 6c69 676e 6d65 6e74  vars = alignment
+000198d0: 2e72 6569 6e64 6578 5f76 6172 6961 626c  .reindex_variabl
+000198e0: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+000198f0: 2020 2020 746f 5f72 6569 6e64 6578 2c0a      to_reindex,.
+00019900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019910: 6469 6d5f 706f 735f 696e 6465 7865 7273  dim_pos_indexers
+00019920: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019930: 2020 636f 7079 3d61 6c69 676e 6572 2e63    copy=aligner.c
+00019940: 6f70 792c 0a20 2020 2020 2020 2020 2020  opy,.           
+00019950: 2020 2020 2066 696c 6c5f 7661 6c75 653d       fill_value=
+00019960: 6669 6c6c 5f76 616c 7565 2c0a 2020 2020  fill_value,.    
+00019970: 2020 2020 2020 2020 2020 2020 7370 6172              spar
+00019980: 7365 3d61 6c69 676e 6572 2e73 7061 7273  se=aligner.spars
+00019990: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
+000199a0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+000199b0: 5f76 6172 6961 626c 6573 2e75 7064 6174  _variables.updat
+000199c0: 6528 7265 696e 6465 7865 645f 7661 7273  e(reindexed_vars
+000199d0: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
+000199e0: 775f 636f 6f72 645f 6e61 6d65 7320 3d20  w_coord_names = 
+000199f0: 7365 6c66 2e5f 636f 6f72 645f 6e61 6d65  self._coord_name
+00019a00: 7320 7c20 7365 7428 6e65 775f 696e 6465  s | set(new_inde
+00019a10: 7865 7329 0a20 2020 2020 2020 2020 2020  xes).           
+00019a20: 2072 6569 6e64 6578 6564 203d 2073 656c   reindexed = sel
+00019a30: 662e 5f72 6570 6c61 6365 5f77 6974 685f  f._replace_with_
+00019a40: 6e65 775f 6469 6d73 280a 2020 2020 2020  new_dims(.      
+00019a50: 2020 2020 2020 2020 2020 6e65 775f 7661            new_va
+00019a60: 7269 6162 6c65 732c 206e 6577 5f63 6f6f  riables, new_coo
+00019a70: 7264 5f6e 616d 6573 2c20 696e 6465 7865  rd_names, indexe
+00019a80: 733d 6e65 775f 696e 6465 7865 730a 2020  s=new_indexes.  
+00019a90: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00019aa0: 2020 2020 2072 6574 7572 6e20 7265 696e       return rein
+00019ab0: 6465 7865 640a 0a20 2020 2064 6566 2072  dexed..    def r
+00019ac0: 6569 6e64 6578 5f6c 696b 6528 0a20 2020  eindex_like(.   
+00019ad0: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
+00019ae0: 6173 6574 2c0a 2020 2020 2020 2020 6f74  aset,.        ot
+00019af0: 6865 723a 2044 6174 6173 6574 207c 2044  her: Dataset | D
+00019b00: 6174 6141 7272 6179 2c0a 2020 2020 2020  ataArray,.      
+00019b10: 2020 6d65 7468 6f64 3a20 5265 696e 6465    method: Reinde
+00019b20: 784d 6574 686f 644f 7074 696f 6e73 203d  xMethodOptions =
+00019b30: 204e 6f6e 652c 0a20 2020 2020 2020 2074   None,.        t
+00019b40: 6f6c 6572 616e 6365 3a20 696e 7420 7c20  olerance: int | 
+00019b50: 666c 6f61 7420 7c20 4974 6572 6162 6c65  float | Iterable
+00019b60: 5b69 6e74 207c 2066 6c6f 6174 5d20 7c20  [int | float] | 
+00019b70: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+00019b80: 2020 2020 2063 6f70 793a 2062 6f6f 6c20       copy: bool 
+00019b90: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+00019ba0: 6669 6c6c 5f76 616c 7565 3a20 416e 7920  fill_value: Any 
+00019bb0: 3d20 7872 6474 7970 6573 2e4e 412c 0a20  = xrdtypes.NA,. 
+00019bc0: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
+00019bd0: 743a 0a20 2020 2020 2020 2022 2222 436f  t:.        """Co
+00019be0: 6e66 6f72 6d20 7468 6973 206f 626a 6563  nform this objec
+00019bf0: 7420 6f6e 746f 2074 6865 2069 6e64 6578  t onto the index
+00019c00: 6573 206f 6620 616e 6f74 6865 7220 6f62  es of another ob
+00019c10: 6a65 6374 2c20 6669 6c6c 696e 6720 696e  ject, filling in
+00019c20: 0a20 2020 2020 2020 206d 6973 7369 6e67  .        missing
+00019c30: 2076 616c 7565 7320 7769 7468 2060 6066   values with ``f
+00019c40: 696c 6c5f 7661 6c75 6560 602e 2054 6865  ill_value``. The
+00019c50: 2064 6566 6175 6c74 2066 696c 6c20 7661   default fill va
+00019c60: 6c75 6520 6973 204e 614e 2e0a 0a20 2020  lue is NaN...   
+00019c70: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00019c80: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00019c90: 2d2d 0a20 2020 2020 2020 206f 7468 6572  --.        other
+00019ca0: 203a 2044 6174 6173 6574 206f 7220 4461   : Dataset or Da
+00019cb0: 7461 4172 7261 790a 2020 2020 2020 2020  taArray.        
+00019cc0: 2020 2020 4f62 6a65 6374 2077 6974 6820      Object with 
+00019cd0: 616e 2027 696e 6465 7865 7327 2061 7474  an 'indexes' att
+00019ce0: 7269 6275 7465 2067 6976 696e 6720 6120  ribute giving a 
+00019cf0: 6d61 7070 696e 6720 6672 6f6d 2064 696d  mapping from dim
+00019d00: 656e 7369 6f6e 0a20 2020 2020 2020 2020  ension.         
+00019d10: 2020 206e 616d 6573 2074 6f20 7061 6e64     names to pand
+00019d20: 6173 2e49 6e64 6578 206f 626a 6563 7473  as.Index objects
+00019d30: 2c20 7768 6963 6820 7072 6f76 6964 6573  , which provides
+00019d40: 2063 6f6f 7264 696e 6174 6573 2075 706f   coordinates upo
+00019d50: 6e0a 2020 2020 2020 2020 2020 2020 7768  n.            wh
+00019d60: 6963 6820 746f 2069 6e64 6578 2074 6865  ich to index the
+00019d70: 2076 6172 6961 626c 6573 2069 6e20 7468   variables in th
+00019d80: 6973 2064 6174 6173 6574 2e20 5468 6520  is dataset. The 
+00019d90: 696e 6465 7865 7320 6f6e 2074 6869 730a  indexes on this.
+00019da0: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
+00019db0: 7220 6f62 6a65 6374 206e 6565 6420 6e6f  r object need no
+00019dc0: 7420 6265 2074 6865 2073 616d 6520 6173  t be the same as
+00019dd0: 2074 6865 2069 6e64 6578 6573 206f 6e20   the indexes on 
+00019de0: 7468 6973 0a20 2020 2020 2020 2020 2020  this.           
+00019df0: 2064 6174 6173 6574 2e20 416e 7920 6d69   dataset. Any mi
+00019e00: 732d 6d61 7463 6865 6420 696e 6465 7820  s-matched index 
+00019e10: 7661 6c75 6573 2077 696c 6c20 6265 2066  values will be f
+00019e20: 696c 6c65 6420 696e 2077 6974 680a 2020  illed in with.  
+00019e30: 2020 2020 2020 2020 2020 4e61 4e2c 2061            NaN, a
+00019e40: 6e64 2061 6e79 206d 6973 2d6d 6174 6368  nd any mis-match
+00019e50: 6564 2064 696d 656e 7369 6f6e 206e 616d  ed dimension nam
+00019e60: 6573 2077 696c 6c20 7369 6d70 6c79 2062  es will simply b
+00019e70: 6520 6967 6e6f 7265 642e 0a20 2020 2020  e ignored..     
+00019e80: 2020 206d 6574 686f 6420 3a20 7b4e 6f6e     method : {Non
+00019e90: 652c 2022 6e65 6172 6573 7422 2c20 2270  e, "nearest", "p
+00019ea0: 6164 222c 2022 6666 696c 6c22 2c20 2262  ad", "ffill", "b
+00019eb0: 6163 6b66 696c 6c22 2c20 2262 6669 6c6c  ackfill", "bfill
+00019ec0: 222c 204e 6f6e 657d 2c20 6f70 7469 6f6e  ", None}, option
+00019ed0: 616c 0a20 2020 2020 2020 2020 2020 204d  al.            M
+00019ee0: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
+00019ef0: 2066 696c 6c69 6e67 2069 6e64 6578 2076   filling index v
+00019f00: 616c 7565 7320 6672 6f6d 206f 7468 6572  alues from other
+00019f10: 206e 6f74 2066 6f75 6e64 2069 6e20 7468   not found in th
+00019f20: 6973 0a20 2020 2020 2020 2020 2020 2064  is.            d
+00019f30: 6174 6173 6574 3a0a 0a20 2020 2020 2020  ataset:..       
+00019f40: 2020 2020 202d 204e 6f6e 6520 2864 6566       - None (def
+00019f50: 6175 6c74 293a 2064 6f6e 2774 2066 696c  ault): don't fil
+00019f60: 6c20 6761 7073 0a20 2020 2020 2020 2020  l gaps.         
+00019f70: 2020 202d 2022 7061 6422 202f 2022 6666     - "pad" / "ff
+00019f80: 696c 6c22 3a20 7072 6f70 6167 6174 6520  ill": propagate 
+00019f90: 6c61 7374 2076 616c 6964 2069 6e64 6578  last valid index
+00019fa0: 2076 616c 7565 2066 6f72 7761 7264 0a20   value forward. 
+00019fb0: 2020 2020 2020 2020 2020 202d 2022 6261             - "ba
+00019fc0: 636b 6669 6c6c 2220 2f20 2262 6669 6c6c  ckfill" / "bfill
+00019fd0: 223a 2070 726f 7061 6761 7465 206e 6578  ": propagate nex
+00019fe0: 7420 7661 6c69 6420 696e 6465 7820 7661  t valid index va
+00019ff0: 6c75 6520 6261 636b 7761 7264 0a20 2020  lue backward.   
+0001a000: 2020 2020 2020 2020 202d 2022 6e65 6172           - "near
+0001a010: 6573 7422 3a20 7573 6520 6e65 6172 6573  est": use neares
+0001a020: 7420 7661 6c69 6420 696e 6465 7820 7661  t valid index va
+0001a030: 6c75 650a 0a20 2020 2020 2020 2074 6f6c  lue..        tol
+0001a040: 6572 616e 6365 203a 206f 7074 696f 6e61  erance : optiona
+0001a050: 6c0a 2020 2020 2020 2020 2020 2020 4d61  l.            Ma
+0001a060: 7869 6d75 6d20 6469 7374 616e 6365 2062  ximum distance b
+0001a070: 6574 7765 656e 206f 7269 6769 6e61 6c20  etween original 
+0001a080: 616e 6420 6e65 7720 6c61 6265 6c73 2066  and new labels f
+0001a090: 6f72 2069 6e65 7861 6374 0a20 2020 2020  or inexact.     
+0001a0a0: 2020 2020 2020 206d 6174 6368 6573 2e20         matches. 
+0001a0b0: 5468 6520 7661 6c75 6573 206f 6620 7468  The values of th
+0001a0c0: 6520 696e 6465 7820 6174 2074 6865 206d  e index at the m
+0001a0d0: 6174 6368 696e 6720 6c6f 6361 7469 6f6e  atching location
+0001a0e0: 7320 6d75 7374 0a20 2020 2020 2020 2020  s must.         
+0001a0f0: 2020 2073 6174 6973 6679 2074 6865 2065     satisfy the e
+0001a100: 7175 6174 696f 6e20 6060 6162 7328 696e  quation ``abs(in
+0001a110: 6465 785b 696e 6465 7865 725d 202d 2074  dex[indexer] - t
+0001a120: 6172 6765 7429 203c 3d20 746f 6c65 7261  arget) <= tolera
+0001a130: 6e63 6560 602e 0a20 2020 2020 2020 2020  nce``..         
+0001a140: 2020 2054 6f6c 6572 616e 6365 206d 6179     Tolerance may
+0001a150: 2062 6520 6120 7363 616c 6172 2076 616c   be a scalar val
+0001a160: 7565 2c20 7768 6963 6820 6170 706c 6965  ue, which applie
+0001a170: 7320 7468 6520 7361 6d65 2074 6f6c 6572  s the same toler
+0001a180: 616e 6365 0a20 2020 2020 2020 2020 2020  ance.           
+0001a190: 2074 6f20 616c 6c20 7661 6c75 6573 2c20   to all values, 
+0001a1a0: 6f72 206c 6973 742d 6c69 6b65 2c20 7768  or list-like, wh
+0001a1b0: 6963 6820 6170 706c 6965 7320 7661 7269  ich applies vari
+0001a1c0: 6162 6c65 2074 6f6c 6572 616e 6365 2070  able tolerance p
+0001a1d0: 6572 0a20 2020 2020 2020 2020 2020 2065  er.            e
+0001a1e0: 6c65 6d65 6e74 2e20 4c69 7374 2d6c 696b  lement. List-lik
+0001a1f0: 6520 6d75 7374 2062 6520 7468 6520 7361  e must be the sa
+0001a200: 6d65 2073 697a 6520 6173 2074 6865 2069  me size as the i
+0001a210: 6e64 6578 2061 6e64 2069 7473 2064 7479  ndex and its dty
+0001a220: 7065 0a20 2020 2020 2020 2020 2020 206d  pe.            m
+0001a230: 7573 7420 6578 6163 746c 7920 6d61 7463  ust exactly matc
+0001a240: 6820 7468 6520 696e 6465 78e2 8099 7320  h the index...s 
+0001a250: 7479 7065 2e0a 2020 2020 2020 2020 636f  type..        co
+0001a260: 7079 203a 2062 6f6f 6c2c 2064 6566 6175  py : bool, defau
+0001a270: 6c74 3a20 5472 7565 0a20 2020 2020 2020  lt: True.       
+0001a280: 2020 2020 2049 6620 6060 636f 7079 3d54       If ``copy=T
+0001a290: 7275 6560 602c 2064 6174 6120 696e 2074  rue``, data in t
+0001a2a0: 6865 2072 6574 7572 6e20 7661 6c75 6520  he return value 
+0001a2b0: 6973 2061 6c77 6179 7320 636f 7069 6564  is always copied
+0001a2c0: 2e20 4966 0a20 2020 2020 2020 2020 2020  . If.           
+0001a2d0: 2060 6063 6f70 793d 4661 6c73 6560 6020   ``copy=False`` 
+0001a2e0: 616e 6420 7265 696e 6465 7869 6e67 2069  and reindexing i
+0001a2f0: 7320 756e 6e65 6365 7373 6172 792c 206f  s unnecessary, o
+0001a300: 7220 6361 6e20 6265 2070 6572 666f 726d  r can be perform
+0001a310: 6564 0a20 2020 2020 2020 2020 2020 2077  ed.            w
+0001a320: 6974 6820 6f6e 6c79 2073 6c69 6365 206f  ith only slice o
+0001a330: 7065 7261 7469 6f6e 732c 2074 6865 6e20  perations, then 
+0001a340: 7468 6520 6f75 7470 7574 206d 6179 2073  the output may s
+0001a350: 6861 7265 206d 656d 6f72 7920 7769 7468  hare memory with
+0001a360: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+0001a370: 2069 6e70 7574 2e20 496e 2065 6974 6865   input. In eithe
+0001a380: 7220 6361 7365 2c20 6120 6e65 7720 7861  r case, a new xa
+0001a390: 7272 6179 206f 626a 6563 7420 6973 2061  rray object is a
+0001a3a0: 6c77 6179 7320 7265 7475 726e 6564 2e0a  lways returned..
+0001a3b0: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
+0001a3c0: 7565 203a 2073 6361 6c61 7220 6f72 2064  ue : scalar or d
+0001a3d0: 6963 742d 6c69 6b65 2c20 6f70 7469 6f6e  ict-like, option
+0001a3e0: 616c 0a20 2020 2020 2020 2020 2020 2056  al.            V
+0001a3f0: 616c 7565 2074 6f20 7573 6520 666f 7220  alue to use for 
+0001a400: 6e65 776c 7920 6d69 7373 696e 6720 7661  newly missing va
+0001a410: 6c75 6573 2e20 4966 2061 2064 6963 742d  lues. If a dict-
+0001a420: 6c69 6b65 206d 6170 730a 2020 2020 2020  like maps.      
+0001a430: 2020 2020 2020 7661 7269 6162 6c65 206e        variable n
+0001a440: 616d 6573 2074 6f20 6669 6c6c 2076 616c  ames to fill val
+0001a450: 7565 732e 0a0a 2020 2020 2020 2020 5265  ues...        Re
+0001a460: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+0001a470: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7265  -----.        re
+0001a480: 696e 6465 7865 6420 3a20 4461 7461 7365  indexed : Datase
+0001a490: 740a 2020 2020 2020 2020 2020 2020 416e  t.            An
+0001a4a0: 6f74 6865 7220 6461 7461 7365 742c 2077  other dataset, w
+0001a4b0: 6974 6820 7468 6973 2064 6174 6173 6574  ith this dataset
+0001a4c0: 2773 2064 6174 6120 6275 7420 636f 6f72  's data but coor
+0001a4d0: 6469 6e61 7465 7320 6672 6f6d 2074 6865  dinates from the
+0001a4e0: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+0001a4f0: 6572 206f 626a 6563 742e 0a0a 2020 2020  er object...    
+0001a500: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
+0001a510: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+0001a520: 2020 2020 2020 4461 7461 7365 742e 7265        Dataset.re
+0001a530: 696e 6465 780a 2020 2020 2020 2020 616c  index.        al
+0001a540: 6967 6e0a 2020 2020 2020 2020 2222 220a  ign.        """.
+0001a550: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+0001a560: 6c69 676e 6d65 6e74 2e72 6569 6e64 6578  lignment.reindex
+0001a570: 5f6c 696b 6528 0a20 2020 2020 2020 2020  _like(.         
+0001a580: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0001a590: 2020 2020 206f 7468 6572 3d6f 7468 6572       other=other
+0001a5a0: 2c0a 2020 2020 2020 2020 2020 2020 6d65  ,.            me
+0001a5b0: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
+0001a5c0: 2020 2020 2020 2020 2074 6f6c 6572 616e           toleran
+0001a5d0: 6365 3d74 6f6c 6572 616e 6365 2c0a 2020  ce=tolerance,.  
+0001a5e0: 2020 2020 2020 2020 2020 636f 7079 3d63            copy=c
+0001a5f0: 6f70 792c 0a20 2020 2020 2020 2020 2020  opy,.           
+0001a600: 2066 696c 6c5f 7661 6c75 653d 6669 6c6c   fill_value=fill
+0001a610: 5f76 616c 7565 2c0a 2020 2020 2020 2020  _value,.        
+0001a620: 290a 0a20 2020 2064 6566 2072 6569 6e64  )..    def reind
+0001a630: 6578 280a 2020 2020 2020 2020 7365 6c66  ex(.        self
+0001a640: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
+0001a650: 2020 2020 2069 6e64 6578 6572 733a 204d       indexers: M
+0001a660: 6170 7069 6e67 5b41 6e79 2c20 416e 795d  apping[Any, Any]
+0001a670: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+0001a680: 2020 2020 2020 2020 6d65 7468 6f64 3a20          method: 
+0001a690: 5265 696e 6465 784d 6574 686f 644f 7074  ReindexMethodOpt
+0001a6a0: 696f 6e73 203d 204e 6f6e 652c 0a20 2020  ions = None,.   
+0001a6b0: 2020 2020 2074 6f6c 6572 616e 6365 3a20       tolerance: 
+0001a6c0: 696e 7420 7c20 666c 6f61 7420 7c20 4974  int | float | It
+0001a6d0: 6572 6162 6c65 5b69 6e74 207c 2066 6c6f  erable[int | flo
+0001a6e0: 6174 5d20 7c20 4e6f 6e65 203d 204e 6f6e  at] | None = Non
+0001a6f0: 652c 0a20 2020 2020 2020 2063 6f70 793a  e,.        copy:
+0001a700: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
+0001a710: 2020 2020 2020 6669 6c6c 5f76 616c 7565        fill_value
+0001a720: 3a20 416e 7920 3d20 7872 6474 7970 6573  : Any = xrdtypes
+0001a730: 2e4e 412c 0a20 2020 2020 2020 202a 2a69  .NA,.        **i
+0001a740: 6e64 6578 6572 735f 6b77 6172 6773 3a20  ndexers_kwargs: 
+0001a750: 416e 792c 0a20 2020 2029 202d 3e20 545f  Any,.    ) -> T_
+0001a760: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+0001a770: 2022 2222 436f 6e66 6f72 6d20 7468 6973   """Conform this
+0001a780: 206f 626a 6563 7420 6f6e 746f 2061 206e   object onto a n
+0001a790: 6577 2073 6574 206f 6620 696e 6465 7865  ew set of indexe
+0001a7a0: 732c 2066 696c 6c69 6e67 2069 6e0a 2020  s, filling in.  
+0001a7b0: 2020 2020 2020 6d69 7373 696e 6720 7661        missing va
+0001a7c0: 6c75 6573 2077 6974 6820 6060 6669 6c6c  lues with ``fill
+0001a7d0: 5f76 616c 7565 6060 2e20 5468 6520 6465  _value``. The de
+0001a7e0: 6661 756c 7420 6669 6c6c 2076 616c 7565  fault fill value
+0001a7f0: 2069 7320 4e61 4e2e 0a0a 2020 2020 2020   is NaN...      
+0001a800: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0001a810: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0001a820: 2020 2020 2020 2020 696e 6465 7865 7273          indexers
+0001a830: 203a 2064 6963 742c 206f 7074 696f 6e61   : dict, optiona
+0001a840: 6c0a 2020 2020 2020 2020 2020 2020 4469  l.            Di
+0001a850: 6374 696f 6e61 7279 2077 6974 6820 6b65  ctionary with ke
+0001a860: 7973 2067 6976 656e 2062 7920 6469 6d65  ys given by dime
+0001a870: 6e73 696f 6e20 6e61 6d65 7320 616e 6420  nsion names and 
+0001a880: 7661 6c75 6573 2067 6976 656e 2062 790a  values given by.
+0001a890: 2020 2020 2020 2020 2020 2020 6172 7261              arra
+0001a8a0: 7973 206f 6620 636f 6f72 6469 6e61 7465  ys of coordinate
+0001a8b0: 7320 7469 636b 206c 6162 656c 732e 2041  s tick labels. A
+0001a8c0: 6e79 206d 6973 2d6d 6174 6368 6564 2063  ny mis-matched c
+0001a8d0: 6f6f 7264 696e 6174 650a 2020 2020 2020  oordinate.      
+0001a8e0: 2020 2020 2020 7661 6c75 6573 2077 696c        values wil
+0001a8f0: 6c20 6265 2066 696c 6c65 6420 696e 2077  l be filled in w
+0001a900: 6974 6820 4e61 4e2c 2061 6e64 2061 6e79  ith NaN, and any
+0001a910: 206d 6973 2d6d 6174 6368 6564 2064 696d   mis-matched dim
+0001a920: 656e 7369 6f6e 0a20 2020 2020 2020 2020  ension.         
+0001a930: 2020 206e 616d 6573 2077 696c 6c20 7369     names will si
+0001a940: 6d70 6c79 2062 6520 6967 6e6f 7265 642e  mply be ignored.
+0001a950: 0a20 2020 2020 2020 2020 2020 204f 6e65  .            One
+0001a960: 206f 6620 696e 6465 7865 7273 206f 7220   of indexers or 
+0001a970: 696e 6465 7865 7273 5f6b 7761 7267 7320  indexers_kwargs 
+0001a980: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
+0001a990: 2e0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
+0001a9a0: 203a 207b 4e6f 6e65 2c20 226e 6561 7265   : {None, "neare
+0001a9b0: 7374 222c 2022 7061 6422 2c20 2266 6669  st", "pad", "ffi
+0001a9c0: 6c6c 222c 2022 6261 636b 6669 6c6c 222c  ll", "backfill",
+0001a9d0: 2022 6266 696c 6c22 2c20 4e6f 6e65 7d2c   "bfill", None},
+0001a9e0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0001a9f0: 2020 2020 2020 4d65 7468 6f64 2074 6f20        Method to 
+0001aa00: 7573 6520 666f 7220 6669 6c6c 696e 6720  use for filling 
+0001aa10: 696e 6465 7820 7661 6c75 6573 2069 6e20  index values in 
+0001aa20: 6060 696e 6465 7865 7273 6060 206e 6f74  ``indexers`` not
+0001aa30: 2066 6f75 6e64 2069 6e0a 2020 2020 2020   found in.      
+0001aa40: 2020 2020 2020 7468 6973 2064 6174 6173        this datas
+0001aa50: 6574 3a0a 0a20 2020 2020 2020 2020 2020  et:..           
+0001aa60: 202d 204e 6f6e 6520 2864 6566 6175 6c74   - None (default
+0001aa70: 293a 2064 6f6e 2774 2066 696c 6c20 6761  ): don't fill ga
+0001aa80: 7073 0a20 2020 2020 2020 2020 2020 202d  ps.            -
+0001aa90: 2022 7061 6422 202f 2022 6666 696c 6c22   "pad" / "ffill"
+0001aaa0: 3a20 7072 6f70 6167 6174 6520 6c61 7374  : propagate last
+0001aab0: 2076 616c 6964 2069 6e64 6578 2076 616c   valid index val
+0001aac0: 7565 2066 6f72 7761 7264 0a20 2020 2020  ue forward.     
+0001aad0: 2020 2020 2020 202d 2022 6261 636b 6669         - "backfi
+0001aae0: 6c6c 2220 2f20 2262 6669 6c6c 223a 2070  ll" / "bfill": p
+0001aaf0: 726f 7061 6761 7465 206e 6578 7420 7661  ropagate next va
+0001ab00: 6c69 6420 696e 6465 7820 7661 6c75 6520  lid index value 
+0001ab10: 6261 636b 7761 7264 0a20 2020 2020 2020  backward.       
+0001ab20: 2020 2020 202d 2022 6e65 6172 6573 7422       - "nearest"
+0001ab30: 3a20 7573 6520 6e65 6172 6573 7420 7661  : use nearest va
+0001ab40: 6c69 6420 696e 6465 7820 7661 6c75 650a  lid index value.
+0001ab50: 0a20 2020 2020 2020 2074 6f6c 6572 616e  .        toleran
+0001ab60: 6365 203a 206f 7074 696f 6e61 6c0a 2020  ce : optional.  
+0001ab70: 2020 2020 2020 2020 2020 4d61 7869 6d75            Maximu
+0001ab80: 6d20 6469 7374 616e 6365 2062 6574 7765  m distance betwe
+0001ab90: 656e 206f 7269 6769 6e61 6c20 616e 6420  en original and 
+0001aba0: 6e65 7720 6c61 6265 6c73 2066 6f72 2069  new labels for i
+0001abb0: 6e65 7861 6374 0a20 2020 2020 2020 2020  nexact.         
+0001abc0: 2020 206d 6174 6368 6573 2e20 5468 6520     matches. The 
+0001abd0: 7661 6c75 6573 206f 6620 7468 6520 696e  values of the in
+0001abe0: 6465 7820 6174 2074 6865 206d 6174 6368  dex at the match
+0001abf0: 696e 6720 6c6f 6361 7469 6f6e 7320 6d75  ing locations mu
+0001ac00: 7374 0a20 2020 2020 2020 2020 2020 2073  st.            s
+0001ac10: 6174 6973 6679 2074 6865 2065 7175 6174  atisfy the equat
+0001ac20: 696f 6e20 6060 6162 7328 696e 6465 785b  ion ``abs(index[
+0001ac30: 696e 6465 7865 725d 202d 2074 6172 6765  indexer] - targe
+0001ac40: 7429 203c 3d20 746f 6c65 7261 6e63 6560  t) <= tolerance`
+0001ac50: 602e 0a20 2020 2020 2020 2020 2020 2054  `..            T
+0001ac60: 6f6c 6572 616e 6365 206d 6179 2062 6520  olerance may be 
+0001ac70: 6120 7363 616c 6172 2076 616c 7565 2c20  a scalar value, 
+0001ac80: 7768 6963 6820 6170 706c 6965 7320 7468  which applies th
+0001ac90: 6520 7361 6d65 2074 6f6c 6572 616e 6365  e same tolerance
+0001aca0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
+0001acb0: 616c 6c20 7661 6c75 6573 2c20 6f72 206c  all values, or l
+0001acc0: 6973 742d 6c69 6b65 2c20 7768 6963 6820  ist-like, which 
+0001acd0: 6170 706c 6965 7320 7661 7269 6162 6c65  applies variable
+0001ace0: 2074 6f6c 6572 616e 6365 2070 6572 0a20   tolerance per. 
+0001acf0: 2020 2020 2020 2020 2020 2065 6c65 6d65             eleme
+0001ad00: 6e74 2e20 4c69 7374 2d6c 696b 6520 6d75  nt. List-like mu
+0001ad10: 7374 2062 6520 7468 6520 7361 6d65 2073  st be the same s
+0001ad20: 697a 6520 6173 2074 6865 2069 6e64 6578  ize as the index
+0001ad30: 2061 6e64 2069 7473 2064 7479 7065 0a20   and its dtype. 
+0001ad40: 2020 2020 2020 2020 2020 206d 7573 7420             must 
+0001ad50: 6578 6163 746c 7920 6d61 7463 6820 7468  exactly match th
+0001ad60: 6520 696e 6465 78e2 8099 7320 7479 7065  e index...s type
+0001ad70: 2e0a 2020 2020 2020 2020 636f 7079 203a  ..        copy :
+0001ad80: 2062 6f6f 6c2c 2064 6566 6175 6c74 3a20   bool, default: 
+0001ad90: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0001ada0: 2049 6620 6060 636f 7079 3d54 7275 6560   If ``copy=True`
+0001adb0: 602c 2064 6174 6120 696e 2074 6865 2072  `, data in the r
+0001adc0: 6574 7572 6e20 7661 6c75 6520 6973 2061  eturn value is a
+0001add0: 6c77 6179 7320 636f 7069 6564 2e20 4966  lways copied. If
+0001ade0: 0a20 2020 2020 2020 2020 2020 2060 6063  .            ``c
+0001adf0: 6f70 793d 4661 6c73 6560 6020 616e 6420  opy=False`` and 
+0001ae00: 7265 696e 6465 7869 6e67 2069 7320 756e  reindexing is un
+0001ae10: 6e65 6365 7373 6172 792c 206f 7220 6361  necessary, or ca
+0001ae20: 6e20 6265 2070 6572 666f 726d 6564 0a20  n be performed. 
+0001ae30: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0001ae40: 6f6e 6c79 2073 6c69 6365 206f 7065 7261  only slice opera
+0001ae50: 7469 6f6e 732c 2074 6865 6e20 7468 6520  tions, then the 
+0001ae60: 6f75 7470 7574 206d 6179 2073 6861 7265  output may share
+0001ae70: 206d 656d 6f72 7920 7769 7468 0a20 2020   memory with.   
+0001ae80: 2020 2020 2020 2020 2074 6865 2069 6e70           the inp
+0001ae90: 7574 2e20 496e 2065 6974 6865 7220 6361  ut. In either ca
+0001aea0: 7365 2c20 6120 6e65 7720 7861 7272 6179  se, a new xarray
+0001aeb0: 206f 626a 6563 7420 6973 2061 6c77 6179   object is alway
+0001aec0: 7320 7265 7475 726e 6564 2e0a 2020 2020  s returned..    
+0001aed0: 2020 2020 6669 6c6c 5f76 616c 7565 203a      fill_value :
+0001aee0: 2073 6361 6c61 7220 6f72 2064 6963 742d   scalar or dict-
+0001aef0: 6c69 6b65 2c20 6f70 7469 6f6e 616c 0a20  like, optional. 
+0001af00: 2020 2020 2020 2020 2020 2056 616c 7565             Value
+0001af10: 2074 6f20 7573 6520 666f 7220 6e65 776c   to use for newl
+0001af20: 7920 6d69 7373 696e 6720 7661 6c75 6573  y missing values
+0001af30: 2e20 4966 2061 2064 6963 742d 6c69 6b65  . If a dict-like
+0001af40: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
+0001af50: 7073 2076 6172 6961 626c 6520 6e61 6d65  ps variable name
+0001af60: 7320 2869 6e63 6c75 6469 6e67 2063 6f6f  s (including coo
+0001af70: 7264 696e 6174 6573 2920 746f 2066 696c  rdinates) to fil
+0001af80: 6c20 7661 6c75 6573 2e0a 2020 2020 2020  l values..      
+0001af90: 2020 7370 6172 7365 203a 2062 6f6f 6c2c    sparse : bool,
+0001afa0: 2064 6566 6175 6c74 3a20 4661 6c73 650a   default: False.
+0001afb0: 2020 2020 2020 2020 2020 2020 7573 6520              use 
+0001afc0: 7370 6172 7365 2d61 7272 6179 2e0a 2020  sparse-array..  
+0001afd0: 2020 2020 2020 2a2a 696e 6465 7865 7273        **indexers
+0001afe0: 5f6b 7761 7267 7320 3a20 7b64 696d 3a20  _kwargs : {dim: 
+0001aff0: 696e 6465 7865 722c 202e 2e2e 7d2c 206f  indexer, ...}, o
+0001b000: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0001b010: 2020 2020 4b65 7977 6f72 6420 6172 6775      Keyword argu
+0001b020: 6d65 6e74 7320 696e 2074 6865 2073 616d  ments in the sam
+0001b030: 6520 666f 726d 2061 7320 6060 696e 6465  e form as ``inde
+0001b040: 7865 7273 6060 2e0a 2020 2020 2020 2020  xers``..        
+0001b050: 2020 2020 4f6e 6520 6f66 2069 6e64 6578      One of index
+0001b060: 6572 7320 6f72 2069 6e64 6578 6572 735f  ers or indexers_
+0001b070: 6b77 6172 6773 206d 7573 7420 6265 2070  kwargs must be p
+0001b080: 726f 7669 6465 642e 0a0a 2020 2020 2020  rovided...      
+0001b090: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+0001b0a0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+0001b0b0: 2020 7265 696e 6465 7865 6420 3a20 4461    reindexed : Da
+0001b0c0: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
+0001b0d0: 2020 416e 6f74 6865 7220 6461 7461 7365    Another datase
+0001b0e0: 742c 2077 6974 6820 7468 6973 2064 6174  t, with this dat
+0001b0f0: 6173 6574 2773 2064 6174 6120 6275 7420  aset's data but 
+0001b100: 7265 706c 6163 6564 2063 6f6f 7264 696e  replaced coordin
+0001b110: 6174 6573 2e0a 0a20 2020 2020 2020 2053  ates...        S
+0001b120: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+0001b130: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0001b140: 2044 6174 6173 6574 2e72 6569 6e64 6578   Dataset.reindex
+0001b150: 5f6c 696b 650a 2020 2020 2020 2020 616c  _like.        al
+0001b160: 6967 6e0a 2020 2020 2020 2020 7061 6e64  ign.        pand
+0001b170: 6173 2e49 6e64 6578 2e67 6574 5f69 6e64  as.Index.get_ind
+0001b180: 6578 6572 0a0a 2020 2020 2020 2020 4578  exer..        Ex
+0001b190: 616d 706c 6573 0a20 2020 2020 2020 202d  amples.        -
+0001b1a0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0001b1b0: 4372 6561 7465 2061 2064 6174 6173 6574  Create a dataset
+0001b1c0: 2077 6974 6820 736f 6d65 2066 6963 7469   with some ficti
+0001b1d0: 6f6e 616c 2064 6174 612e 0a0a 2020 2020  onal data...    
+0001b1e0: 2020 2020 3e3e 3e20 7820 3d20 7872 2e44      >>> x = xr.D
+0001b1f0: 6174 6173 6574 280a 2020 2020 2020 2020  ataset(.        
+0001b200: 2e2e 2e20 2020 2020 7b0a 2020 2020 2020  ...     {.      
+0001b210: 2020 2e2e 2e20 2020 2020 2020 2020 2274    ...         "t
+0001b220: 656d 7065 7261 7475 7265 223a 2028 2273  emperature": ("s
+0001b230: 7461 7469 6f6e 222c 2032 3020 2a20 6e70  tation", 20 * np
+0001b240: 2e72 616e 646f 6d2e 7261 6e64 2834 2929  .random.rand(4))
+0001b250: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
+0001b260: 2020 2020 2020 2270 7265 7373 7572 6522        "pressure"
+0001b270: 3a20 2822 7374 6174 696f 6e22 2c20 3530  : ("station", 50
+0001b280: 3020 2a20 6e70 2e72 616e 646f 6d2e 7261  0 * np.random.ra
+0001b290: 6e64 2834 2929 2c0a 2020 2020 2020 2020  nd(4)),.        
+0001b2a0: 2e2e 2e20 2020 2020 7d2c 0a20 2020 2020  ...     },.     
+0001b2b0: 2020 202e 2e2e 2020 2020 2063 6f6f 7264     ...     coord
+0001b2c0: 733d 7b22 7374 6174 696f 6e22 3a20 5b22  s={"station": ["
+0001b2d0: 626f 7374 6f6e 222c 2022 6e79 6322 2c20  boston", "nyc", 
+0001b2e0: 2273 6561 7474 6c65 222c 2022 6465 6e76  "seattle", "denv
+0001b2f0: 6572 225d 7d2c 0a20 2020 2020 2020 202e  er"]},.        .
+0001b300: 2e2e 2029 0a20 2020 2020 2020 203e 3e3e  .. ).        >>>
+0001b310: 2078 0a20 2020 2020 2020 203c 7861 7272   x.        <xarr
+0001b320: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
+0001b330: 2020 2020 4469 6d65 6e73 696f 6e73 3a20      Dimensions: 
+0001b340: 2020 2020 2028 7374 6174 696f 6e3a 2034       (station: 4
+0001b350: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
+0001b360: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
+0001b370: 202a 2073 7461 7469 6f6e 2020 2020 2020   * station      
+0001b380: 2873 7461 7469 6f6e 2920 3c55 3720 2762  (station) <U7 'b
+0001b390: 6f73 746f 6e27 2027 6e79 6327 2027 7365  oston' 'nyc' 'se
+0001b3a0: 6174 746c 6527 2027 6465 6e76 6572 270a  attle' 'denver'.
+0001b3b0: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
+0001b3c0: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
+0001b3d0: 2020 2020 7465 6d70 6572 6174 7572 6520      temperature 
+0001b3e0: 2028 7374 6174 696f 6e29 2066 6c6f 6174   (station) float
+0001b3f0: 3634 2031 302e 3938 2031 342e 3320 3132  64 10.98 14.3 12
+0001b400: 2e30 3620 3130 2e39 0a20 2020 2020 2020  .06 10.9.       
+0001b410: 2020 2020 2070 7265 7373 7572 6520 2020       pressure   
+0001b420: 2020 2873 7461 7469 6f6e 2920 666c 6f61    (station) floa
+0001b430: 7436 3420 3231 312e 3820 3332 322e 3920  t64 211.8 322.9 
+0001b440: 3231 382e 3820 3434 352e 390a 2020 2020  218.8 445.9.    
+0001b450: 2020 2020 3e3e 3e20 782e 696e 6465 7865      >>> x.indexe
+0001b460: 730a 2020 2020 2020 2020 496e 6465 7865  s.        Indexe
+0001b470: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
+0001b480: 7461 7469 6f6e 2020 496e 6465 7828 5b27  tation  Index(['
+0001b490: 626f 7374 6f6e 272c 2027 6e79 6327 2c20  boston', 'nyc', 
+0001b4a0: 2773 6561 7474 6c65 272c 2027 6465 6e76  'seattle', 'denv
+0001b4b0: 6572 275d 2c20 6474 7970 653d 276f 626a  er'], dtype='obj
+0001b4c0: 6563 7427 2c20 6e61 6d65 3d27 7374 6174  ect', name='stat
+0001b4d0: 696f 6e27 290a 0a20 2020 2020 2020 2043  ion')..        C
+0001b4e0: 7265 6174 6520 6120 6e65 7720 696e 6465  reate a new inde
+0001b4f0: 7820 616e 6420 7265 696e 6465 7820 7468  x and reindex th
+0001b500: 6520 6461 7461 7365 742e 2042 7920 6465  e dataset. By de
+0001b510: 6661 756c 7420 7661 6c75 6573 2069 6e20  fault values in 
+0001b520: 7468 6520 6e65 7720 696e 6465 7820 7468  the new index th
+0001b530: 6174 0a20 2020 2020 2020 2064 6f20 6e6f  at.        do no
+0001b540: 7420 6861 7665 2063 6f72 7265 7370 6f6e  t have correspon
+0001b550: 6469 6e67 2072 6563 6f72 6473 2069 6e20  ding records in 
+0001b560: 7468 6520 6461 7461 7365 7420 6172 6520  the dataset are 
+0001b570: 6173 7369 676e 6564 2060 4e61 4e60 2e0a  assigned `NaN`..
+0001b580: 0a20 2020 2020 2020 203e 3e3e 206e 6577  .        >>> new
+0001b590: 5f69 6e64 6578 203d 205b 2262 6f73 746f  _index = ["bosto
+0001b5a0: 6e22 2c20 2261 7573 7469 6e22 2c20 2273  n", "austin", "s
+0001b5b0: 6561 7474 6c65 222c 2022 6c69 6e63 6f6c  eattle", "lincol
+0001b5c0: 6e22 5d0a 2020 2020 2020 2020 3e3e 3e20  n"].        >>> 
+0001b5d0: 782e 7265 696e 6465 7828 7b22 7374 6174  x.reindex({"stat
+0001b5e0: 696f 6e22 3a20 6e65 775f 696e 6465 787d  ion": new_index}
+0001b5f0: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
+0001b600: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
+0001b610: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
+0001b620: 2020 2020 2873 7461 7469 6f6e 3a20 3429      (station: 4)
+0001b630: 0a20 2020 2020 2020 2043 6f6f 7264 696e  .        Coordin
+0001b640: 6174 6573 3a0a 2020 2020 2020 2020 2020  ates:.          
+0001b650: 2a20 7374 6174 696f 6e20 2020 2020 2028  * station      (
+0001b660: 7374 6174 696f 6e29 203c 5537 2027 626f  station) <U7 'bo
+0001b670: 7374 6f6e 2720 2761 7573 7469 6e27 2027  ston' 'austin' '
+0001b680: 7365 6174 746c 6527 2027 6c69 6e63 6f6c  seattle' 'lincol
+0001b690: 6e27 0a20 2020 2020 2020 2044 6174 6120  n'.        Data 
+0001b6a0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+0001b6b0: 2020 2020 2020 2074 656d 7065 7261 7475         temperatu
+0001b6c0: 7265 2020 2873 7461 7469 6f6e 2920 666c  re  (station) fl
+0001b6d0: 6f61 7436 3420 3130 2e39 3820 6e61 6e20  oat64 10.98 nan 
+0001b6e0: 3132 2e30 3620 6e61 6e0a 2020 2020 2020  12.06 nan.      
+0001b6f0: 2020 2020 2020 7072 6573 7375 7265 2020        pressure  
+0001b700: 2020 2028 7374 6174 696f 6e29 2066 6c6f     (station) flo
+0001b710: 6174 3634 2032 3131 2e38 206e 616e 2032  at64 211.8 nan 2
+0001b720: 3138 2e38 206e 616e 0a0a 2020 2020 2020  18.8 nan..      
+0001b730: 2020 5765 2063 616e 2066 696c 6c20 696e    We can fill in
+0001b740: 2074 6865 206d 6973 7369 6e67 2076 616c   the missing val
+0001b750: 7565 7320 6279 2070 6173 7369 6e67 2061  ues by passing a
+0001b760: 2076 616c 7565 2074 6f20 7468 6520 6b65   value to the ke
+0001b770: 7977 6f72 6420 6066 696c 6c5f 7661 6c75  yword `fill_valu
+0001b780: 6560 2e0a 0a20 2020 2020 2020 203e 3e3e  e`...        >>>
+0001b790: 2078 2e72 6569 6e64 6578 287b 2273 7461   x.reindex({"sta
+0001b7a0: 7469 6f6e 223a 206e 6577 5f69 6e64 6578  tion": new_index
+0001b7b0: 7d2c 2066 696c 6c5f 7661 6c75 653d 3029  }, fill_value=0)
+0001b7c0: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
+0001b7d0: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
+0001b7e0: 2020 4469 6d65 6e73 696f 6e73 3a20 2020    Dimensions:   
+0001b7f0: 2020 2028 7374 6174 696f 6e3a 2034 290a     (station: 4).
+0001b800: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
+0001b810: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
+0001b820: 2073 7461 7469 6f6e 2020 2020 2020 2873   station      (s
+0001b830: 7461 7469 6f6e 2920 3c55 3720 2762 6f73  tation) <U7 'bos
+0001b840: 746f 6e27 2027 6175 7374 696e 2720 2773  ton' 'austin' 's
+0001b850: 6561 7474 6c65 2720 276c 696e 636f 6c6e  eattle' 'lincoln
+0001b860: 270a 2020 2020 2020 2020 4461 7461 2076  '.        Data v
+0001b870: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+0001b880: 2020 2020 2020 7465 6d70 6572 6174 7572        temperatur
+0001b890: 6520 2028 7374 6174 696f 6e29 2066 6c6f  e  (station) flo
+0001b8a0: 6174 3634 2031 302e 3938 2030 2e30 2031  at64 10.98 0.0 1
+0001b8b0: 322e 3036 2030 2e30 0a20 2020 2020 2020  2.06 0.0.       
+0001b8c0: 2020 2020 2070 7265 7373 7572 6520 2020       pressure   
+0001b8d0: 2020 2873 7461 7469 6f6e 2920 666c 6f61    (station) floa
+0001b8e0: 7436 3420 3231 312e 3820 302e 3020 3231  t64 211.8 0.0 21
+0001b8f0: 382e 3820 302e 300a 0a20 2020 2020 2020  8.8 0.0..       
+0001b900: 2057 6520 6361 6e20 616c 736f 2075 7365   We can also use
+0001b910: 2064 6966 6665 7265 6e74 2066 696c 6c20   different fill 
+0001b920: 7661 6c75 6573 2066 6f72 2065 6163 6820  values for each 
+0001b930: 7661 7269 6162 6c65 2e0a 0a20 2020 2020  variable...     
+0001b940: 2020 203e 3e3e 2078 2e72 6569 6e64 6578     >>> x.reindex
+0001b950: 280a 2020 2020 2020 2020 2e2e 2e20 2020  (.        ...   
+0001b960: 2020 7b22 7374 6174 696f 6e22 3a20 6e65    {"station": ne
+0001b970: 775f 696e 6465 787d 2c20 6669 6c6c 5f76  w_index}, fill_v
+0001b980: 616c 7565 3d7b 2274 656d 7065 7261 7475  alue={"temperatu
+0001b990: 7265 223a 2030 2c20 2270 7265 7373 7572  re": 0, "pressur
+0001b9a0: 6522 3a20 3130 307d 0a20 2020 2020 2020  e": 100}.       
+0001b9b0: 202e 2e2e 2029 0a20 2020 2020 2020 203c   ... ).        <
+0001b9c0: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
+0001b9d0: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+0001b9e0: 6e73 3a20 2020 2020 2028 7374 6174 696f  ns:      (statio
+0001b9f0: 6e3a 2034 290a 2020 2020 2020 2020 436f  n: 4).        Co
+0001ba00: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
+0001ba10: 2020 2020 202a 2073 7461 7469 6f6e 2020       * station  
+0001ba20: 2020 2020 2873 7461 7469 6f6e 2920 3c55      (station) <U
+0001ba30: 3720 2762 6f73 746f 6e27 2027 6175 7374  7 'boston' 'aust
+0001ba40: 696e 2720 2773 6561 7474 6c65 2720 276c  in' 'seattle' 'l
+0001ba50: 696e 636f 6c6e 270a 2020 2020 2020 2020  incoln'.        
+0001ba60: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
+0001ba70: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+0001ba80: 6572 6174 7572 6520 2028 7374 6174 696f  erature  (statio
+0001ba90: 6e29 2066 6c6f 6174 3634 2031 302e 3938  n) float64 10.98
+0001baa0: 2030 2e30 2031 322e 3036 2030 2e30 0a20   0.0 12.06 0.0. 
+0001bab0: 2020 2020 2020 2020 2020 2070 7265 7373             press
+0001bac0: 7572 6520 2020 2020 2873 7461 7469 6f6e  ure     (station
+0001bad0: 2920 666c 6f61 7436 3420 3231 312e 3820  ) float64 211.8 
+0001bae0: 3130 302e 3020 3231 382e 3820 3130 302e  100.0 218.8 100.
+0001baf0: 300a 0a20 2020 2020 2020 2042 6563 6175  0..        Becau
+0001bb00: 7365 2074 6865 2069 6e64 6578 2069 7320  se the index is 
+0001bb10: 6e6f 7420 6d6f 6e6f 746f 6e69 6361 6c6c  not monotonicall
+0001bb20: 7920 696e 6372 6561 7369 6e67 206f 7220  y increasing or 
+0001bb30: 6465 6372 6561 7369 6e67 2c20 7765 2063  decreasing, we c
+0001bb40: 616e 6e6f 7420 7573 6520 6172 6775 6d65  annot use argume
+0001bb50: 6e74 730a 2020 2020 2020 2020 746f 2074  nts.        to t
+0001bb60: 6865 206b 6579 776f 7264 206d 6574 686f  he keyword metho
+0001bb70: 6420 746f 2066 696c 6c20 7468 6520 604e  d to fill the `N
+0001bb80: 614e 6020 7661 6c75 6573 2e0a 0a20 2020  aN` values...   
+0001bb90: 2020 2020 203e 3e3e 2078 2e72 6569 6e64       >>> x.reind
+0001bba0: 6578 287b 2273 7461 7469 6f6e 223a 206e  ex({"station": n
+0001bbb0: 6577 5f69 6e64 6578 7d2c 206d 6574 686f  ew_index}, metho
+0001bbc0: 643d 226e 6561 7265 7374 2229 0a20 2020  d="nearest").   
+0001bbd0: 2020 2020 2054 7261 6365 6261 636b 2028       Traceback (
+0001bbe0: 6d6f 7374 2072 6563 656e 7420 6361 6c6c  most recent call
+0001bbf0: 206c 6173 7429 3a0a 2020 2020 2020 2020   last):.        
+0001bc00: 2e2e 2e0a 2020 2020 2020 2020 2020 2020  ....            
+0001bc10: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0001bc20: 2827 696e 6465 7820 6d75 7374 2062 6520  ('index must be 
+0001bc30: 6d6f 6e6f 746f 6e69 6320 696e 6372 6561  monotonic increa
+0001bc40: 7369 6e67 206f 7220 6465 6372 6561 7369  sing or decreasi
+0001bc50: 6e67 2729 0a20 2020 2020 2020 2056 616c  ng').        Val
+0001bc60: 7565 4572 726f 723a 2069 6e64 6578 206d  ueError: index m
+0001bc70: 7573 7420 6265 206d 6f6e 6f74 6f6e 6963  ust be monotonic
+0001bc80: 2069 6e63 7265 6173 696e 6720 6f72 2064   increasing or d
+0001bc90: 6563 7265 6173 696e 670a 0a20 2020 2020  ecreasing..     
+0001bca0: 2020 2054 6f20 6675 7274 6865 7220 696c     To further il
+0001bcb0: 6c75 7374 7261 7465 2074 6865 2066 696c  lustrate the fil
+0001bcc0: 6c69 6e67 2066 756e 6374 696f 6e61 6c69  ling functionali
+0001bcd0: 7479 2069 6e20 7265 696e 6465 782c 2077  ty in reindex, w
+0001bce0: 6520 7769 6c6c 2063 7265 6174 6520 610a  e will create a.
+0001bcf0: 2020 2020 2020 2020 6461 7461 7365 7420          dataset 
+0001bd00: 7769 7468 2061 206d 6f6e 6f74 6f6e 6963  with a monotonic
+0001bd10: 616c 6c79 2069 6e63 7265 6173 696e 6720  ally increasing 
+0001bd20: 696e 6465 7820 2866 6f72 2065 7861 6d70  index (for examp
+0001bd30: 6c65 2c20 6120 7365 7175 656e 6365 206f  le, a sequence o
+0001bd40: 6620 6461 7465 7329 2e0a 0a20 2020 2020  f dates)...     
+0001bd50: 2020 203e 3e3e 2078 3220 3d20 7872 2e44     >>> x2 = xr.D
+0001bd60: 6174 6173 6574 280a 2020 2020 2020 2020  ataset(.        
+0001bd70: 2e2e 2e20 2020 2020 7b0a 2020 2020 2020  ...     {.      
+0001bd80: 2020 2e2e 2e20 2020 2020 2020 2020 2274    ...         "t
+0001bd90: 656d 7065 7261 7475 7265 223a 2028 0a20  emperature": (. 
+0001bda0: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
+0001bdb0: 2020 2020 2020 2022 7469 6d65 222c 0a20         "time",. 
+0001bdc0: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
+0001bdd0: 2020 2020 2020 205b 3135 2e35 372c 2031         [15.57, 1
+0001bde0: 322e 3737 2c20 6e70 2e6e 616e 2c20 302e  2.77, np.nan, 0.
+0001bdf0: 3330 3831 2c20 3136 2e35 392c 2031 352e  3081, 16.59, 15.
+0001be00: 3132 5d2c 0a20 2020 2020 2020 202e 2e2e  12],.        ...
+0001be10: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
+0001be20: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
+0001be30: 2270 7265 7373 7572 6522 3a20 2822 7469  "pressure": ("ti
+0001be40: 6d65 222c 2035 3030 202a 206e 702e 7261  me", 500 * np.ra
+0001be50: 6e64 6f6d 2e72 616e 6428 3629 292c 0a20  ndom.rand(6)),. 
+0001be60: 2020 2020 2020 202e 2e2e 2020 2020 207d         ...     }
+0001be70: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
+0001be80: 2020 636f 6f72 6473 3d7b 2274 696d 6522    coords={"time"
+0001be90: 3a20 7064 2e64 6174 655f 7261 6e67 6528  : pd.date_range(
+0001bea0: 2230 312f 3031 2f32 3031 3922 2c20 7065  "01/01/2019", pe
+0001beb0: 7269 6f64 733d 362c 2066 7265 713d 2244  riods=6, freq="D
+0001bec0: 2229 7d2c 0a20 2020 2020 2020 202e 2e2e  ")},.        ...
+0001bed0: 2029 0a20 2020 2020 2020 203e 3e3e 2078   ).        >>> x
+0001bee0: 320a 2020 2020 2020 2020 3c78 6172 7261  2.        <xarra
+0001bef0: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
+0001bf00: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
+0001bf10: 2020 2020 2874 696d 653a 2036 290a 2020      (time: 6).  
+0001bf20: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
+0001bf30: 733a 0a20 2020 2020 2020 2020 202a 2074  s:.          * t
+0001bf40: 696d 6520 2020 2020 2020 2020 2874 696d  ime         (tim
+0001bf50: 6529 2064 6174 6574 696d 6536 345b 6e73  e) datetime64[ns
+0001bf60: 5d20 3230 3139 2d30 312d 3031 2032 3031  ] 2019-01-01 201
+0001bf70: 392d 3031 2d30 3220 2e2e 2e20 3230 3139  9-01-02 ... 2019
+0001bf80: 2d30 312d 3036 0a20 2020 2020 2020 2044  -01-06.        D
+0001bf90: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+0001bfa0: 2020 2020 2020 2020 2020 2074 656d 7065             tempe
+0001bfb0: 7261 7475 7265 2020 2874 696d 6529 2066  rature  (time) f
+0001bfc0: 6c6f 6174 3634 2031 352e 3537 2031 322e  loat64 15.57 12.
+0001bfd0: 3737 206e 616e 2030 2e33 3038 3120 3136  77 nan 0.3081 16
+0001bfe0: 2e35 3920 3135 2e31 320a 2020 2020 2020  .59 15.12.      
+0001bff0: 2020 2020 2020 7072 6573 7375 7265 2020        pressure  
+0001c000: 2020 2028 7469 6d65 2920 666c 6f61 7436     (time) float6
+0001c010: 3420 3438 312e 3820 3139 312e 3720 3339  4 481.8 191.7 39
+0001c020: 352e 3920 3236 342e 3420 3238 342e 3020  5.9 264.4 284.0 
+0001c030: 3436 322e 380a 0a20 2020 2020 2020 2053  462.8..        S
+0001c040: 7570 706f 7365 2077 6520 6465 6369 6465  uppose we decide
+0001c050: 2074 6f20 6578 7061 6e64 2074 6865 2064   to expand the d
+0001c060: 6174 6173 6574 2074 6f20 636f 7665 7220  ataset to cover 
+0001c070: 6120 7769 6465 7220 6461 7465 2072 616e  a wider date ran
+0001c080: 6765 2e0a 0a20 2020 2020 2020 203e 3e3e  ge...        >>>
+0001c090: 2074 696d 655f 696e 6465 7832 203d 2070   time_index2 = p
+0001c0a0: 642e 6461 7465 5f72 616e 6765 2822 3132  d.date_range("12
+0001c0b0: 2f32 392f 3230 3138 222c 2070 6572 696f  /29/2018", perio
+0001c0c0: 6473 3d31 302c 2066 7265 713d 2244 2229  ds=10, freq="D")
+0001c0d0: 0a20 2020 2020 2020 203e 3e3e 2078 322e  .        >>> x2.
+0001c0e0: 7265 696e 6465 7828 7b22 7469 6d65 223a  reindex({"time":
+0001c0f0: 2074 696d 655f 696e 6465 7832 7d29 0a20   time_index2}). 
+0001c100: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
+0001c110: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
+0001c120: 4469 6d65 6e73 696f 6e73 3a20 2020 2020  Dimensions:     
+0001c130: 2028 7469 6d65 3a20 3130 290a 2020 2020   (time: 10).    
+0001c140: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
+0001c150: 0a20 2020 2020 2020 2020 202a 2074 696d  .          * tim
+0001c160: 6520 2020 2020 2020 2020 2874 696d 6529  e         (time)
+0001c170: 2064 6174 6574 696d 6536 345b 6e73 5d20   datetime64[ns] 
+0001c180: 3230 3138 2d31 322d 3239 2032 3031 382d  2018-12-29 2018-
+0001c190: 3132 2d33 3020 2e2e 2e20 3230 3139 2d30  12-30 ... 2019-0
+0001c1a0: 312d 3037 0a20 2020 2020 2020 2044 6174  1-07.        Dat
+0001c1b0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
+0001c1c0: 2020 2020 2020 2020 2074 656d 7065 7261           tempera
+0001c1d0: 7475 7265 2020 2874 696d 6529 2066 6c6f  ture  (time) flo
+0001c1e0: 6174 3634 206e 616e 206e 616e 206e 616e  at64 nan nan nan
+0001c1f0: 2031 352e 3537 202e 2e2e 2030 2e33 3038   15.57 ... 0.308
+0001c200: 3120 3136 2e35 3920 3135 2e31 3220 6e61  1 16.59 15.12 na
+0001c210: 6e0a 2020 2020 2020 2020 2020 2020 7072  n.            pr
+0001c220: 6573 7375 7265 2020 2020 2028 7469 6d65  essure     (time
+0001c230: 2920 666c 6f61 7436 3420 6e61 6e20 6e61  ) float64 nan na
+0001c240: 6e20 6e61 6e20 3438 312e 3820 2e2e 2e20  n nan 481.8 ... 
+0001c250: 3236 342e 3420 3238 342e 3020 3436 322e  264.4 284.0 462.
+0001c260: 3820 6e61 6e0a 0a20 2020 2020 2020 2054  8 nan..        T
+0001c270: 6865 2069 6e64 6578 2065 6e74 7269 6573  he index entries
+0001c280: 2074 6861 7420 6469 6420 6e6f 7420 6861   that did not ha
+0001c290: 7665 2061 2076 616c 7565 2069 6e20 7468  ve a value in th
+0001c2a0: 6520 6f72 6967 696e 616c 2064 6174 6120  e original data 
+0001c2b0: 6672 616d 6520 2866 6f72 2065 7861 6d70  frame (for examp
+0001c2c0: 6c65 2c20 6032 3031 382d 3132 2d32 3960  le, `2018-12-29`
+0001c2d0: 290a 2020 2020 2020 2020 6172 6520 6279  ).        are by
+0001c2e0: 2064 6566 6175 6c74 2066 696c 6c65 6420   default filled 
+0001c2f0: 7769 7468 204e 614e 2e20 4966 2064 6573  with NaN. If des
+0001c300: 6972 6564 2c20 7765 2063 616e 2066 696c  ired, we can fil
+0001c310: 6c20 696e 2074 6865 206d 6973 7369 6e67  l in the missing
+0001c320: 2076 616c 7565 7320 7573 696e 6720 6f6e   values using on
+0001c330: 6520 6f66 2073 6576 6572 616c 206f 7074  e of several opt
+0001c340: 696f 6e73 2e0a 0a20 2020 2020 2020 2046  ions...        F
+0001c350: 6f72 2065 7861 6d70 6c65 2c20 746f 2062  or example, to b
+0001c360: 6163 6b2d 7072 6f70 6167 6174 6520 7468  ack-propagate th
+0001c370: 6520 6c61 7374 2076 616c 6964 2076 616c  e last valid val
+0001c380: 7565 2074 6f20 6669 6c6c 2074 6865 2060  ue to fill the `
+0001c390: 4e61 4e60 2076 616c 7565 732c 0a20 2020  NaN` values,.   
+0001c3a0: 2020 2020 2070 6173 7320 6062 6669 6c6c       pass `bfill
+0001c3b0: 6020 6173 2061 6e20 6172 6775 6d65 6e74  ` as an argument
+0001c3c0: 2074 6f20 7468 6520 606d 6574 686f 6460   to the `method`
+0001c3d0: 206b 6579 776f 7264 2e0a 0a20 2020 2020   keyword...     
+0001c3e0: 2020 203e 3e3e 2078 3320 3d20 7832 2e72     >>> x3 = x2.r
+0001c3f0: 6569 6e64 6578 287b 2274 696d 6522 3a20  eindex({"time": 
+0001c400: 7469 6d65 5f69 6e64 6578 327d 2c20 6d65  time_index2}, me
+0001c410: 7468 6f64 3d22 6266 696c 6c22 290a 2020  thod="bfill").  
+0001c420: 2020 2020 2020 3e3e 3e20 7833 0a20 2020        >>> x3.   
+0001c430: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
+0001c440: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
+0001c450: 6d65 6e73 696f 6e73 3a20 2020 2020 2028  mensions:      (
+0001c460: 7469 6d65 3a20 3130 290a 2020 2020 2020  time: 10).      
+0001c470: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+0001c480: 2020 2020 2020 2020 202a 2074 696d 6520           * time 
+0001c490: 2020 2020 2020 2020 2874 696d 6529 2064          (time) d
+0001c4a0: 6174 6574 696d 6536 345b 6e73 5d20 3230  atetime64[ns] 20
+0001c4b0: 3138 2d31 322d 3239 2032 3031 382d 3132  18-12-29 2018-12
+0001c4c0: 2d33 3020 2e2e 2e20 3230 3139 2d30 312d  -30 ... 2019-01-
+0001c4d0: 3037 0a20 2020 2020 2020 2044 6174 6120  07.        Data 
+0001c4e0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+0001c4f0: 2020 2020 2020 2074 656d 7065 7261 7475         temperatu
+0001c500: 7265 2020 2874 696d 6529 2066 6c6f 6174  re  (time) float
+0001c510: 3634 2031 352e 3537 2031 352e 3537 2031  64 15.57 15.57 1
+0001c520: 352e 3537 2031 352e 3537 202e 2e2e 2031  5.57 15.57 ... 1
+0001c530: 362e 3539 2031 352e 3132 206e 616e 0a20  6.59 15.12 nan. 
+0001c540: 2020 2020 2020 2020 2020 2070 7265 7373             press
+0001c550: 7572 6520 2020 2020 2874 696d 6529 2066  ure     (time) f
+0001c560: 6c6f 6174 3634 2034 3831 2e38 2034 3831  loat64 481.8 481
+0001c570: 2e38 2034 3831 2e38 2034 3831 2e38 202e  .8 481.8 481.8 .
+0001c580: 2e2e 2032 3834 2e30 2034 3632 2e38 206e  .. 284.0 462.8 n
+0001c590: 616e 0a0a 2020 2020 2020 2020 506c 6561  an..        Plea
+0001c5a0: 7365 206e 6f74 6520 7468 6174 2074 6865  se note that the
+0001c5b0: 2060 4e61 4e60 2076 616c 7565 2070 7265   `NaN` value pre
+0001c5c0: 7365 6e74 2069 6e20 7468 6520 6f72 6967  sent in the orig
+0001c5d0: 696e 616c 2064 6174 6173 6574 2028 6174  inal dataset (at
+0001c5e0: 2069 6e64 6578 2076 616c 7565 2060 3230   index value `20
+0001c5f0: 3139 2d30 312d 3033 6029 0a20 2020 2020  19-01-03`).     
+0001c600: 2020 2077 696c 6c20 6e6f 7420 6265 2066     will not be f
+0001c610: 696c 6c65 6420 6279 2061 6e79 206f 6620  illed by any of 
+0001c620: 7468 6520 7661 6c75 6520 7072 6f70 6167  the value propag
+0001c630: 6174 696f 6e20 7363 6865 6d65 732e 0a0a  ation schemes...
+0001c640: 2020 2020 2020 2020 3e3e 3e20 7832 2e77          >>> x2.w
+0001c650: 6865 7265 2878 322e 7465 6d70 6572 6174  here(x2.temperat
+0001c660: 7572 652e 6973 6e75 6c6c 2829 2c20 6472  ure.isnull(), dr
+0001c670: 6f70 3d54 7275 6529 0a20 2020 2020 2020  op=True).       
+0001c680: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
+0001c690: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
+0001c6a0: 696f 6e73 3a20 2020 2020 2028 7469 6d65  ions:      (time
+0001c6b0: 3a20 3129 0a20 2020 2020 2020 2043 6f6f  : 1).        Coo
+0001c6c0: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
+0001c6d0: 2020 2020 2a20 7469 6d65 2020 2020 2020      * time      
+0001c6e0: 2020 2028 7469 6d65 2920 6461 7465 7469     (time) dateti
+0001c6f0: 6d65 3634 5b6e 735d 2032 3031 392d 3031  me64[ns] 2019-01
+0001c700: 2d30 330a 2020 2020 2020 2020 4461 7461  -03.        Data
+0001c710: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+0001c720: 2020 2020 2020 2020 7465 6d70 6572 6174          temperat
+0001c730: 7572 6520 2028 7469 6d65 2920 666c 6f61  ure  (time) floa
+0001c740: 7436 3420 6e61 6e0a 2020 2020 2020 2020  t64 nan.        
+0001c750: 2020 2020 7072 6573 7375 7265 2020 2020      pressure    
+0001c760: 2028 7469 6d65 2920 666c 6f61 7436 3420   (time) float64 
+0001c770: 3339 352e 390a 2020 2020 2020 2020 3e3e  395.9.        >>
+0001c780: 3e20 7833 2e77 6865 7265 2878 332e 7465  > x3.where(x3.te
+0001c790: 6d70 6572 6174 7572 652e 6973 6e75 6c6c  mperature.isnull
+0001c7a0: 2829 2c20 6472 6f70 3d54 7275 6529 0a20  (), drop=True). 
+0001c7b0: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
+0001c7c0: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
+0001c7d0: 4469 6d65 6e73 696f 6e73 3a20 2020 2020  Dimensions:     
+0001c7e0: 2028 7469 6d65 3a20 3229 0a20 2020 2020   (time: 2).     
+0001c7f0: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+0001c800: 2020 2020 2020 2020 2020 2a20 7469 6d65            * time
+0001c810: 2020 2020 2020 2020 2028 7469 6d65 2920           (time) 
+0001c820: 6461 7465 7469 6d65 3634 5b6e 735d 2032  datetime64[ns] 2
+0001c830: 3031 392d 3031 2d30 3320 3230 3139 2d30  019-01-03 2019-0
+0001c840: 312d 3037 0a20 2020 2020 2020 2044 6174  1-07.        Dat
+0001c850: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
+0001c860: 2020 2020 2020 2020 2074 656d 7065 7261           tempera
+0001c870: 7475 7265 2020 2874 696d 6529 2066 6c6f  ture  (time) flo
+0001c880: 6174 3634 206e 616e 206e 616e 0a20 2020  at64 nan nan.   
+0001c890: 2020 2020 2020 2020 2070 7265 7373 7572           pressur
+0001c8a0: 6520 2020 2020 2874 696d 6529 2066 6c6f  e     (time) flo
+0001c8b0: 6174 3634 2033 3935 2e39 206e 616e 0a0a  at64 395.9 nan..
+0001c8c0: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
+0001c8d0: 6265 6361 7573 6520 6669 6c6c 696e 6720  because filling 
+0001c8e0: 7768 696c 6520 7265 696e 6465 7869 6e67  while reindexing
+0001c8f0: 2064 6f65 7320 6e6f 7420 6c6f 6f6b 2061   does not look a
+0001c900: 7420 6461 7461 7365 7420 7661 6c75 6573  t dataset values
+0001c910: 2c20 6275 7420 6f6e 6c79 2063 6f6d 7061  , but only compa
+0001c920: 7265 730a 2020 2020 2020 2020 7468 6520  res.        the 
+0001c930: 6f72 6967 696e 616c 2061 6e64 2064 6573  original and des
+0001c940: 6972 6564 2069 6e64 6578 6573 2e20 4966  ired indexes. If
+0001c950: 2079 6f75 2064 6f20 7761 6e74 2074 6f20   you do want to 
+0001c960: 6669 6c6c 2069 6e20 7468 6520 604e 614e  fill in the `NaN
+0001c970: 6020 7661 6c75 6573 2070 7265 7365 6e74  ` values present
+0001c980: 2069 6e20 7468 650a 2020 2020 2020 2020   in the.        
+0001c990: 6f72 6967 696e 616c 2064 6174 6173 6574  original dataset
+0001c9a0: 2c20 7573 6520 7468 6520 3a70 793a 6d65  , use the :py:me
+0001c9b0: 7468 3a60 7e44 6174 6173 6574 2e66 696c  th:`~Dataset.fil
+0001c9c0: 6c6e 6128 2960 206d 6574 686f 642e 0a0a  lna()` method...
+0001c9d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001c9e0: 2020 2020 696e 6465 7865 7273 203d 2075      indexers = u
+0001c9f0: 7469 6c73 2e65 6974 6865 725f 6469 6374  tils.either_dict
+0001ca00: 5f6f 725f 6b77 6172 6773 2869 6e64 6578  _or_kwargs(index
+0001ca10: 6572 732c 2069 6e64 6578 6572 735f 6b77  ers, indexers_kw
+0001ca20: 6172 6773 2c20 2272 6569 6e64 6578 2229  args, "reindex")
+0001ca30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001ca40: 616c 6967 6e6d 656e 742e 7265 696e 6465  alignment.reinde
+0001ca50: 7828 0a20 2020 2020 2020 2020 2020 2073  x(.            s
+0001ca60: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+0001ca70: 2069 6e64 6578 6572 733d 696e 6465 7865   indexers=indexe
+0001ca80: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
+0001ca90: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+0001caa0: 2020 2020 2020 2020 2020 2074 6f6c 6572             toler
+0001cab0: 616e 6365 3d74 6f6c 6572 616e 6365 2c0a  ance=tolerance,.
+0001cac0: 2020 2020 2020 2020 2020 2020 636f 7079              copy
+0001cad0: 3d63 6f70 792c 0a20 2020 2020 2020 2020  =copy,.         
+0001cae0: 2020 2066 696c 6c5f 7661 6c75 653d 6669     fill_value=fi
+0001caf0: 6c6c 5f76 616c 7565 2c0a 2020 2020 2020  ll_value,.      
+0001cb00: 2020 290a 0a20 2020 2064 6566 205f 7265    )..    def _re
+0001cb10: 696e 6465 7828 0a20 2020 2020 2020 2073  index(.        s
+0001cb20: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
+0001cb30: 2020 2020 2020 2020 696e 6465 7865 7273          indexers
+0001cb40: 3a20 4d61 7070 696e 675b 416e 792c 2041  : Mapping[Any, A
+0001cb50: 6e79 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ny] | None = Non
+0001cb60: 652c 0a20 2020 2020 2020 206d 6574 686f  e,.        metho
+0001cb70: 643a 2073 7472 207c 204e 6f6e 6520 3d20  d: str | None = 
+0001cb80: 4e6f 6e65 2c0a 2020 2020 2020 2020 746f  None,.        to
+0001cb90: 6c65 7261 6e63 653a 2069 6e74 207c 2066  lerance: int | f
+0001cba0: 6c6f 6174 207c 2049 7465 7261 626c 655b  loat | Iterable[
+0001cbb0: 696e 7420 7c20 666c 6f61 745d 207c 204e  int | float] | N
+0001cbc0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+0001cbd0: 2020 2020 636f 7079 3a20 626f 6f6c 203d      copy: bool =
+0001cbe0: 2054 7275 652c 0a20 2020 2020 2020 2066   True,.        f
+0001cbf0: 696c 6c5f 7661 6c75 653a 2041 6e79 203d  ill_value: Any =
+0001cc00: 2078 7264 7479 7065 732e 4e41 2c0a 2020   xrdtypes.NA,.  
+0001cc10: 2020 2020 2020 7370 6172 7365 3a20 626f        sparse: bo
+0001cc20: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+0001cc30: 2020 2020 2a2a 696e 6465 7865 7273 5f6b      **indexers_k
+0001cc40: 7761 7267 733a 2041 6e79 2c0a 2020 2020  wargs: Any,.    
+0001cc50: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+0001cc60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001cc70: 2020 2020 5361 6d65 2061 7320 7265 696e      Same as rein
+0001cc80: 6465 7820 6275 7420 7375 7070 6f72 7473  dex but supports
+0001cc90: 2073 7061 7273 6520 6f70 7469 6f6e 2e0a   sparse option..
+0001cca0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001ccb0: 2020 2020 696e 6465 7865 7273 203d 2075      indexers = u
+0001ccc0: 7469 6c73 2e65 6974 6865 725f 6469 6374  tils.either_dict
+0001ccd0: 5f6f 725f 6b77 6172 6773 2869 6e64 6578  _or_kwargs(index
+0001cce0: 6572 732c 2069 6e64 6578 6572 735f 6b77  ers, indexers_kw
+0001ccf0: 6172 6773 2c20 2272 6569 6e64 6578 2229  args, "reindex")
+0001cd00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001cd10: 616c 6967 6e6d 656e 742e 7265 696e 6465  alignment.reinde
+0001cd20: 7828 0a20 2020 2020 2020 2020 2020 2073  x(.            s
+0001cd30: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+0001cd40: 2069 6e64 6578 6572 733d 696e 6465 7865   indexers=indexe
+0001cd50: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
+0001cd60: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
+0001cd70: 2020 2020 2020 2020 2020 2074 6f6c 6572             toler
+0001cd80: 616e 6365 3d74 6f6c 6572 616e 6365 2c0a  ance=tolerance,.
+0001cd90: 2020 2020 2020 2020 2020 2020 636f 7079              copy
+0001cda0: 3d63 6f70 792c 0a20 2020 2020 2020 2020  =copy,.         
+0001cdb0: 2020 2066 696c 6c5f 7661 6c75 653d 6669     fill_value=fi
+0001cdc0: 6c6c 5f76 616c 7565 2c0a 2020 2020 2020  ll_value,.      
+0001cdd0: 2020 2020 2020 7370 6172 7365 3d73 7061        sparse=spa
+0001cde0: 7273 652c 0a20 2020 2020 2020 2029 0a0a  rse,.        )..
+0001cdf0: 2020 2020 6465 6620 696e 7465 7270 280a      def interp(.
+0001ce00: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
+0001ce10: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
+0001ce20: 2063 6f6f 7264 733a 204d 6170 7069 6e67   coords: Mapping
+0001ce30: 5b41 6e79 2c20 416e 795d 207c 204e 6f6e  [Any, Any] | Non
+0001ce40: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+0001ce50: 2020 6d65 7468 6f64 3a20 496e 7465 7270    method: Interp
+0001ce60: 4f70 7469 6f6e 7320 3d20 226c 696e 6561  Options = "linea
+0001ce70: 7222 2c0a 2020 2020 2020 2020 6173 7375  r",.        assu
+0001ce80: 6d65 5f73 6f72 7465 643a 2062 6f6f 6c20  me_sorted: bool 
+0001ce90: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+0001cea0: 206b 7761 7267 733a 204d 6170 7069 6e67   kwargs: Mapping
+0001ceb0: 5b73 7472 2c20 416e 795d 207c 204e 6f6e  [str, Any] | Non
+0001cec0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+0001ced0: 2020 6d65 7468 6f64 5f6e 6f6e 5f6e 756d    method_non_num
+0001cee0: 6572 6963 3a20 7374 7220 3d20 226e 6561  eric: str = "nea
+0001cef0: 7265 7374 222c 0a20 2020 2020 2020 202a  rest",.        *
+0001cf00: 2a63 6f6f 7264 735f 6b77 6172 6773 3a20  *coords_kwargs: 
+0001cf10: 416e 792c 0a20 2020 2029 202d 3e20 545f  Any,.    ) -> T_
+0001cf20: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+0001cf30: 2022 2222 496e 7465 7270 6f6c 6174 6520   """Interpolate 
+0001cf40: 6120 4461 7461 7365 7420 6f6e 746f 206e  a Dataset onto n
+0001cf50: 6577 2063 6f6f 7264 696e 6174 6573 0a0a  ew coordinates..
+0001cf60: 2020 2020 2020 2020 5065 7266 6f72 6d73          Performs
+0001cf70: 2075 6e69 7661 7269 6174 6520 6f72 206d   univariate or m
+0001cf80: 756c 7469 7661 7269 6174 6520 696e 7465  ultivariate inte
+0001cf90: 7270 6f6c 6174 696f 6e20 6f66 2061 2044  rpolation of a D
+0001cfa0: 6174 6173 6574 206f 6e74 6f0a 2020 2020  ataset onto.    
+0001cfb0: 2020 2020 6e65 7720 636f 6f72 6469 6e61      new coordina
+0001cfc0: 7465 7320 7573 696e 6720 7363 6970 7927  tes using scipy'
+0001cfd0: 7320 696e 7465 7270 6f6c 6174 696f 6e20  s interpolation 
+0001cfe0: 726f 7574 696e 6573 2e20 4966 2069 6e74  routines. If int
+0001cff0: 6572 706f 6c61 7469 6e67 0a20 2020 2020  erpolating.     
+0001d000: 2020 2061 6c6f 6e67 2061 6e20 6578 6973     along an exis
+0001d010: 7469 6e67 2064 696d 656e 7369 6f6e 2c20  ting dimension, 
+0001d020: 3a70 793a 636c 6173 733a 6073 6369 7079  :py:class:`scipy
+0001d030: 2e69 6e74 6572 706f 6c61 7465 2e69 6e74  .interpolate.int
+0001d040: 6572 7031 6460 2069 730a 2020 2020 2020  erp1d` is.      
+0001d050: 2020 6361 6c6c 6564 2e20 2057 6865 6e20    called.  When 
+0001d060: 696e 7465 7270 6f6c 6174 696e 6720 616c  interpolating al
+0001d070: 6f6e 6720 6d75 6c74 6970 6c65 2065 7869  ong multiple exi
+0001d080: 7374 696e 6720 6469 6d65 6e73 696f 6e73  sting dimensions
+0001d090: 2c20 616e 0a20 2020 2020 2020 2061 7474  , an.        att
+0001d0a0: 656d 7074 2069 7320 6d61 6465 2074 6f20  empt is made to 
+0001d0b0: 6465 636f 6d70 6f73 6520 7468 6520 696e  decompose the in
+0001d0c0: 7465 7270 6f6c 6174 696f 6e20 696e 746f  terpolation into
+0001d0d0: 206d 756c 7469 706c 650a 2020 2020 2020   multiple.      
+0001d0e0: 2020 312d 6469 6d65 6e73 696f 6e61 6c20    1-dimensional 
+0001d0f0: 696e 7465 7270 6f6c 6174 696f 6e73 2e20  interpolations. 
+0001d100: 4966 2074 6869 7320 6973 2070 6f73 7369  If this is possi
+0001d110: 626c 652c 0a20 2020 2020 2020 203a 7079  ble,.        :py
+0001d120: 3a63 6c61 7373 3a60 7363 6970 792e 696e  :class:`scipy.in
+0001d130: 7465 7270 6f6c 6174 652e 696e 7465 7270  terpolate.interp
+0001d140: 3164 6020 6973 2063 616c 6c65 642e 204f  1d` is called. O
+0001d150: 7468 6572 7769 7365 2c0a 2020 2020 2020  therwise,.      
+0001d160: 2020 3a70 793a 6675 6e63 3a60 7363 6970    :py:func:`scip
+0001d170: 792e 696e 7465 7270 6f6c 6174 652e 696e  y.interpolate.in
+0001d180: 7465 7270 6e60 2069 7320 6361 6c6c 6564  terpn` is called
+0001d190: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+0001d1a0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+0001d1b0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0001d1c0: 2063 6f6f 7264 7320 3a20 6469 6374 2c20   coords : dict, 
+0001d1d0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+0001d1e0: 2020 2020 204d 6170 7069 6e67 2066 726f       Mapping fro
+0001d1f0: 6d20 6469 6d65 6e73 696f 6e20 6e61 6d65  m dimension name
+0001d200: 7320 746f 2074 6865 206e 6577 2063 6f6f  s to the new coo
+0001d210: 7264 696e 6174 6573 2e0a 2020 2020 2020  rdinates..      
+0001d220: 2020 2020 2020 4e65 7720 636f 6f72 6469        New coordi
+0001d230: 6e61 7465 2063 616e 2062 6520 6120 7363  nate can be a sc
+0001d240: 616c 6172 2c20 6172 7261 792d 6c69 6b65  alar, array-like
+0001d250: 206f 7220 4461 7461 4172 7261 792e 0a20   or DataArray.. 
+0001d260: 2020 2020 2020 2020 2020 2049 6620 4461             If Da
+0001d270: 7461 4172 7261 7973 2061 7265 2070 6173  taArrays are pas
+0001d280: 7365 6420 6173 206e 6577 2063 6f6f 7264  sed as new coord
+0001d290: 696e 6174 6573 2c20 7468 6569 7220 6469  inates, their di
+0001d2a0: 6d65 6e73 696f 6e73 2061 7265 0a20 2020  mensions are.   
+0001d2b0: 2020 2020 2020 2020 2075 7365 6420 666f           used fo
+0001d2c0: 7220 7468 6520 6272 6f61 6463 6173 7469  r the broadcasti
+0001d2d0: 6e67 2e20 4d69 7373 696e 6720 7661 6c75  ng. Missing valu
+0001d2e0: 6573 2061 7265 2073 6b69 7070 6564 2e0a  es are skipped..
+0001d2f0: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
+0001d300: 207b 226c 696e 6561 7222 2c20 226e 6561   {"linear", "nea
+0001d310: 7265 7374 222c 2022 7a65 726f 222c 2022  rest", "zero", "
+0001d320: 736c 696e 6561 7222 2c20 2271 7561 6472  slinear", "quadr
+0001d330: 6174 6963 222c 2022 6375 6269 6322 2c20  atic", "cubic", 
+0001d340: 2270 6f6c 796e 6f6d 6961 6c22 2c20 5c0a  "polynomial", \.
+0001d350: 2020 2020 2020 2020 2020 2020 2262 6172              "bar
+0001d360: 7963 656e 7472 6963 222c 2022 6b72 6f67  ycentric", "krog
+0001d370: 222c 2022 7063 6869 7022 2c20 2273 706c  ", "pchip", "spl
+0001d380: 696e 6522 2c20 2261 6b69 6d61 227d 2c20  ine", "akima"}, 
+0001d390: 6465 6661 756c 743a 2022 6c69 6e65 6172  default: "linear
+0001d3a0: 220a 2020 2020 2020 2020 2020 2020 5374  ".            St
+0001d3b0: 7269 6e67 2069 6e64 6963 6174 696e 6720  ring indicating 
+0001d3c0: 7768 6963 6820 6d65 7468 6f64 2074 6f20  which method to 
+0001d3d0: 7573 6520 666f 7220 696e 7465 7270 6f6c  use for interpol
+0001d3e0: 6174 696f 6e3a 0a0a 2020 2020 2020 2020  ation:..        
+0001d3f0: 2020 2020 2d20 276c 696e 6561 7227 3a20      - 'linear': 
+0001d400: 6c69 6e65 6172 2069 6e74 6572 706f 6c61  linear interpola
+0001d410: 7469 6f6e 2e20 4164 6469 7469 6f6e 616c  tion. Additional
+0001d420: 206b 6579 776f 7264 0a20 2020 2020 2020   keyword.       
+0001d430: 2020 2020 2020 2061 7267 756d 656e 7473         arguments
+0001d440: 2061 7265 2070 6173 7365 6420 746f 203a   are passed to :
+0001d450: 7079 3a66 756e 633a 606e 756d 7079 2e69  py:func:`numpy.i
+0001d460: 6e74 6572 7060 0a20 2020 2020 2020 2020  nterp`.         
+0001d470: 2020 202d 2027 6e65 6172 6573 7427 2c20     - 'nearest', 
+0001d480: 277a 6572 6f27 2c20 2773 6c69 6e65 6172  'zero', 'slinear
+0001d490: 272c 2027 7175 6164 7261 7469 6327 2c20  ', 'quadratic', 
+0001d4a0: 2763 7562 6963 272c 2027 706f 6c79 6e6f  'cubic', 'polyno
+0001d4b0: 6d69 616c 273a 0a20 2020 2020 2020 2020  mial':.         
+0001d4c0: 2020 2020 2061 7265 2070 6173 7365 6420       are passed 
+0001d4d0: 746f 203a 7079 3a66 756e 633a 6073 6369  to :py:func:`sci
+0001d4e0: 7079 2e69 6e74 6572 706f 6c61 7465 2e69  py.interpolate.i
+0001d4f0: 6e74 6572 7031 6460 2e20 4966 0a20 2020  nterp1d`. If.   
+0001d500: 2020 2020 2020 2020 2020 2060 606d 6574             ``met
+0001d510: 686f 643d 2770 6f6c 796e 6f6d 6961 6c27  hod='polynomial'
+0001d520: 6060 2c20 7468 6520 6060 6f72 6465 7260  ``, the ``order`
+0001d530: 6020 6b65 7977 6f72 6420 6172 6775 6d65  ` keyword argume
+0001d540: 6e74 206d 7573 7420 616c 736f 2062 650a  nt must also be.
+0001d550: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001d560: 6f76 6964 6564 2e0a 2020 2020 2020 2020  ovided..        
+0001d570: 2020 2020 2d20 2762 6172 7963 656e 7472      - 'barycentr
+0001d580: 6963 272c 2027 6b72 6f67 272c 2027 7063  ic', 'krog', 'pc
+0001d590: 6869 7027 2c20 2773 706c 696e 6527 2c20  hip', 'spline', 
+0001d5a0: 2761 6b69 6d61 273a 2075 7365 2074 6865  'akima': use the
+0001d5b0: 6972 0a20 2020 2020 2020 2020 2020 2020  ir.             
+0001d5c0: 2072 6573 7065 6374 6976 6520 3a70 793a   respective :py:
+0001d5d0: 636c 6173 733a 6073 6369 7079 2e69 6e74  class:`scipy.int
+0001d5e0: 6572 706f 6c61 7465 6020 636c 6173 7365  erpolate` classe
+0001d5f0: 732e 0a0a 2020 2020 2020 2020 6173 7375  s...        assu
+0001d600: 6d65 5f73 6f72 7465 6420 3a20 626f 6f6c  me_sorted : bool
+0001d610: 2c20 6465 6661 756c 743a 2046 616c 7365  , default: False
+0001d620: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0001d630: 4661 6c73 652c 2076 616c 7565 7320 6f66  False, values of
+0001d640: 2063 6f6f 7264 696e 6174 6573 2074 6861   coordinates tha
+0001d650: 7420 6172 6520 696e 7465 7270 6f6c 6174  t are interpolat
+0001d660: 6564 206f 7665 7220 6361 6e20 6265 0a20  ed over can be. 
+0001d670: 2020 2020 2020 2020 2020 2069 6e20 616e             in an
+0001d680: 7920 6f72 6465 7220 616e 6420 7468 6579  y order and they
+0001d690: 2061 7265 2073 6f72 7465 6420 6669 7273   are sorted firs
+0001d6a0: 742e 2049 6620 5472 7565 2c20 696e 7465  t. If True, inte
+0001d6b0: 7270 6f6c 6174 6564 0a20 2020 2020 2020  rpolated.       
+0001d6c0: 2020 2020 2063 6f6f 7264 696e 6174 6573       coordinates
+0001d6d0: 2061 7265 2061 7373 756d 6564 2074 6f20   are assumed to 
+0001d6e0: 6265 2061 6e20 6172 7261 7920 6f66 206d  be an array of m
+0001d6f0: 6f6e 6f74 6f6e 6963 616c 6c79 2069 6e63  onotonically inc
+0001d700: 7265 6173 696e 670a 2020 2020 2020 2020  reasing.        
+0001d710: 2020 2020 7661 6c75 6573 2e0a 2020 2020      values..    
+0001d720: 2020 2020 6b77 6172 6773 203a 2064 6963      kwargs : dic
+0001d730: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
+0001d740: 2020 2020 2020 2020 4164 6469 7469 6f6e          Addition
+0001d750: 616c 206b 6579 776f 7264 2061 7267 756d  al keyword argum
+0001d760: 656e 7473 2070 6173 7365 6420 746f 2073  ents passed to s
+0001d770: 6369 7079 2773 2069 6e74 6572 706f 6c61  cipy's interpola
+0001d780: 746f 722e 2056 616c 6964 0a20 2020 2020  tor. Valid.     
+0001d790: 2020 2020 2020 206f 7074 696f 6e73 2061         options a
+0001d7a0: 6e64 2074 6865 6972 2062 6568 6176 696f  nd their behavio
+0001d7b0: 7220 6465 7065 6e64 2077 6865 7468 6572  r depend whether
+0001d7c0: 2060 6069 6e74 6572 7031 6460 6020 6f72   ``interp1d`` or
+0001d7d0: 0a20 2020 2020 2020 2020 2020 2060 6069  .            ``i
+0001d7e0: 6e74 6572 706e 6060 2069 7320 7573 6564  nterpn`` is used
+0001d7f0: 2e0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
+0001d800: 5f6e 6f6e 5f6e 756d 6572 6963 203a 207b  _non_numeric : {
+0001d810: 226e 6561 7265 7374 222c 2022 7061 6422  "nearest", "pad"
+0001d820: 2c20 2266 6669 6c6c 222c 2022 6261 636b  , "ffill", "back
+0001d830: 6669 6c6c 222c 2022 6266 696c 6c22 7d2c  fill", "bfill"},
+0001d840: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0001d850: 2020 2020 2020 4d65 7468 6f64 2066 6f72        Method for
+0001d860: 206e 6f6e 2d6e 756d 6572 6963 2074 7970   non-numeric typ
+0001d870: 6573 2e20 5061 7373 6564 206f 6e20 746f  es. Passed on to
+0001d880: 203a 7079 3a6d 6574 683a 6044 6174 6173   :py:meth:`Datas
+0001d890: 6574 2e72 6569 6e64 6578 602e 0a20 2020  et.reindex`..   
+0001d8a0: 2020 2020 2020 2020 2060 6022 6e65 6172           ``"near
+0001d8b0: 6573 7422 6060 2069 7320 7573 6564 2062  est"`` is used b
+0001d8c0: 7920 6465 6661 756c 742e 0a20 2020 2020  y default..     
+0001d8d0: 2020 202a 2a63 6f6f 7264 735f 6b77 6172     **coords_kwar
+0001d8e0: 6773 203a 207b 6469 6d3a 2063 6f6f 7264  gs : {dim: coord
+0001d8f0: 696e 6174 652c 202e 2e2e 7d2c 206f 7074  inate, ...}, opt
+0001d900: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+0001d910: 2020 5468 6520 6b65 7977 6f72 6420 6172    The keyword ar
+0001d920: 6775 6d65 6e74 7320 666f 726d 206f 6620  guments form of 
+0001d930: 6060 636f 6f72 6473 6060 2e0a 2020 2020  ``coords``..    
+0001d940: 2020 2020 2020 2020 4f6e 6520 6f66 2063          One of c
+0001d950: 6f6f 7264 7320 6f72 2063 6f6f 7264 735f  oords or coords_
+0001d960: 6b77 6172 6773 206d 7573 7420 6265 2070  kwargs must be p
+0001d970: 726f 7669 6465 642e 0a0a 2020 2020 2020  rovided...      
+0001d980: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+0001d990: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+0001d9a0: 2020 696e 7465 7270 6f6c 6174 6564 203a    interpolated :
+0001d9b0: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
+0001d9c0: 2020 2020 204e 6577 2064 6174 6173 6574       New dataset
+0001d9d0: 206f 6e20 7468 6520 6e65 7720 636f 6f72   on the new coor
+0001d9e0: 6469 6e61 7465 732e 0a0a 2020 2020 2020  dinates...      
+0001d9f0: 2020 4e6f 7465 730a 2020 2020 2020 2020    Notes.        
+0001da00: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7363  -----.        sc
+0001da10: 6970 7920 6973 2072 6571 7569 7265 642e  ipy is required.
+0001da20: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
+0001da30: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
+0001da40: 2d2d 2d0a 2020 2020 2020 2020 7363 6970  ---.        scip
+0001da50: 792e 696e 7465 7270 6f6c 6174 652e 696e  y.interpolate.in
+0001da60: 7465 7270 3164 0a20 2020 2020 2020 2073  terp1d.        s
+0001da70: 6369 7079 2e69 6e74 6572 706f 6c61 7465  cipy.interpolate
+0001da80: 2e69 6e74 6572 706e 0a0a 2020 2020 2020  .interpn..      
+0001da90: 2020 4578 616d 706c 6573 0a20 2020 2020    Examples.     
+0001daa0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+0001dab0: 2020 2020 3e3e 3e20 6473 203d 2078 722e      >>> ds = xr.
+0001dac0: 4461 7461 7365 7428 0a20 2020 2020 2020  Dataset(.       
+0001dad0: 202e 2e2e 2020 2020 2064 6174 615f 7661   ...     data_va
+0001dae0: 7273 3d7b 0a20 2020 2020 2020 202e 2e2e  rs={.        ...
+0001daf0: 2020 2020 2020 2020 2022 6122 3a20 2822           "a": ("
+0001db00: 7822 2c20 5b35 2c20 372c 2034 5d29 2c0a  x", [5, 7, 4]),.
+0001db10: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+0001db20: 2020 2020 2262 223a 2028 0a20 2020 2020      "b": (.     
+0001db30: 2020 202e 2e2e 2020 2020 2020 2020 2020     ...          
+0001db40: 2020 2028 2278 222c 2022 7922 292c 0a20     ("x", "y"),. 
+0001db50: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
+0001db60: 2020 2020 2020 205b 5b31 2c20 342c 2032         [[1, 4, 2
+0001db70: 2c20 395d 2c20 5b32 2c20 372c 2036 2c20  , 9], [2, 7, 6, 
+0001db80: 6e70 2e6e 616e 5d2c 205b 362c 206e 702e  np.nan], [6, np.
+0001db90: 6e61 6e2c 2035 2c20 385d 5d2c 0a20 2020  nan, 5, 8]],.   
+0001dba0: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
+0001dbb0: 2029 2c0a 2020 2020 2020 2020 2e2e 2e20   ),.        ... 
+0001dbc0: 2020 2020 7d2c 0a20 2020 2020 2020 202e      },.        .
+0001dbd0: 2e2e 2020 2020 2063 6f6f 7264 733d 7b22  ..     coords={"
+0001dbe0: 7822 3a20 5b30 2c20 312c 2032 5d2c 2022  x": [0, 1, 2], "
+0001dbf0: 7922 3a20 5b31 302c 2031 322c 2031 342c  y": [10, 12, 14,
+0001dc00: 2031 365d 7d2c 0a20 2020 2020 2020 202e   16]},.        .
+0001dc10: 2e2e 2029 0a20 2020 2020 2020 203e 3e3e  .. ).        >>>
+0001dc20: 2064 730a 2020 2020 2020 2020 3c78 6172   ds.        <xar
+0001dc30: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+0001dc40: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+0001dc50: 2020 2878 3a20 332c 2079 3a20 3429 0a20    (x: 3, y: 4). 
+0001dc60: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
+0001dc70: 6573 3a0a 2020 2020 2020 2020 2020 2a20  es:.          * 
+0001dc80: 7820 2020 2020 2020 2028 7829 2069 6e74  x        (x) int
+0001dc90: 3634 2030 2031 2032 0a20 2020 2020 2020  64 0 1 2.       
+0001dca0: 2020 202a 2079 2020 2020 2020 2020 2879     * y        (y
+0001dcb0: 2920 696e 7436 3420 3130 2031 3220 3134  ) int64 10 12 14
+0001dcc0: 2031 360a 2020 2020 2020 2020 4461 7461   16.        Data
+0001dcd0: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+0001dce0: 2020 2020 2020 2020 6120 2020 2020 2020          a       
+0001dcf0: 2028 7829 2069 6e74 3634 2035 2037 2034   (x) int64 5 7 4
+0001dd00: 0a20 2020 2020 2020 2020 2020 2062 2020  .            b  
+0001dd10: 2020 2020 2020 2878 2c20 7929 2066 6c6f        (x, y) flo
+0001dd20: 6174 3634 2031 2e30 2034 2e30 2032 2e30  at64 1.0 4.0 2.0
+0001dd30: 2039 2e30 2032 2e30 2037 2e30 2036 2e30   9.0 2.0 7.0 6.0
+0001dd40: 206e 616e 2036 2e30 206e 616e 2035 2e30   nan 6.0 nan 5.0
+0001dd50: 2038 2e30 0a0a 2020 2020 2020 2020 3144   8.0..        1D
+0001dd60: 2069 6e74 6572 706f 6c61 7469 6f6e 2077   interpolation w
+0001dd70: 6974 6820 7468 6520 6465 6661 756c 7420  ith the default 
+0001dd80: 6d65 7468 6f64 2028 6c69 6e65 6172 293a  method (linear):
+0001dd90: 0a0a 2020 2020 2020 2020 3e3e 3e20 6473  ..        >>> ds
+0001dda0: 2e69 6e74 6572 7028 783d 5b30 2c20 302e  .interp(x=[0, 0.
+0001ddb0: 3735 2c20 312e 3235 2c20 312e 3735 5d29  75, 1.25, 1.75])
+0001ddc0: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
+0001ddd0: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
+0001dde0: 2020 4469 6d65 6e73 696f 6e73 3a20 2028    Dimensions:  (
+0001ddf0: 783a 2034 2c20 793a 2034 290a 2020 2020  x: 4, y: 4).    
+0001de00: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
+0001de10: 0a20 2020 2020 2020 2020 202a 2079 2020  .          * y  
+0001de20: 2020 2020 2020 2879 2920 696e 7436 3420        (y) int64 
+0001de30: 3130 2031 3220 3134 2031 360a 2020 2020  10 12 14 16.    
+0001de40: 2020 2020 2020 2a20 7820 2020 2020 2020        * x       
+0001de50: 2028 7829 2066 6c6f 6174 3634 2030 2e30   (x) float64 0.0
+0001de60: 2030 2e37 3520 312e 3235 2031 2e37 350a   0.75 1.25 1.75.
+0001de70: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
+0001de80: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
+0001de90: 2020 2020 6120 2020 2020 2020 2028 7829      a        (x)
+0001dea0: 2066 6c6f 6174 3634 2035 2e30 2036 2e35   float64 5.0 6.5
+0001deb0: 2036 2e32 3520 342e 3735 0a20 2020 2020   6.25 4.75.     
+0001dec0: 2020 2020 2020 2062 2020 2020 2020 2020         b        
+0001ded0: 2878 2c20 7929 2066 6c6f 6174 3634 2031  (x, y) float64 1
+0001dee0: 2e30 2034 2e30 2032 2e30 206e 616e 2031  .0 4.0 2.0 nan 1
+0001def0: 2e37 3520 362e 3235 202e 2e2e 206e 616e  .75 6.25 ... nan
+0001df00: 2035 2e30 206e 616e 2035 2e32 3520 6e61   5.0 nan 5.25 na
+0001df10: 6e0a 0a20 2020 2020 2020 2031 4420 696e  n..        1D in
+0001df20: 7465 7270 6f6c 6174 696f 6e20 7769 7468  terpolation with
+0001df30: 2061 2064 6966 6665 7265 6e74 206d 6574   a different met
+0001df40: 686f 643a 0a0a 2020 2020 2020 2020 3e3e  hod:..        >>
+0001df50: 3e20 6473 2e69 6e74 6572 7028 783d 5b30  > ds.interp(x=[0
+0001df60: 2c20 302e 3735 2c20 312e 3235 2c20 312e  , 0.75, 1.25, 1.
+0001df70: 3735 5d2c 206d 6574 686f 643d 226e 6561  75], method="nea
+0001df80: 7265 7374 2229 0a20 2020 2020 2020 203c  rest").        <
+0001df90: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
+0001dfa0: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+0001dfb0: 6e73 3a20 2028 783a 2034 2c20 793a 2034  ns:  (x: 4, y: 4
+0001dfc0: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
+0001dfd0: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
+0001dfe0: 202a 2079 2020 2020 2020 2020 2879 2920   * y        (y) 
+0001dff0: 696e 7436 3420 3130 2031 3220 3134 2031  int64 10 12 14 1
+0001e000: 360a 2020 2020 2020 2020 2020 2a20 7820  6.          * x 
+0001e010: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
+0001e020: 3634 2030 2e30 2030 2e37 3520 312e 3235  64 0.0 0.75 1.25
+0001e030: 2031 2e37 350a 2020 2020 2020 2020 4461   1.75.        Da
+0001e040: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
+0001e050: 2020 2020 2020 2020 2020 6120 2020 2020            a     
+0001e060: 2020 2028 7829 2066 6c6f 6174 3634 2035     (x) float64 5
+0001e070: 2e30 2037 2e30 2037 2e30 2034 2e30 0a20  .0 7.0 7.0 4.0. 
+0001e080: 2020 2020 2020 2020 2020 2062 2020 2020             b    
+0001e090: 2020 2020 2878 2c20 7929 2066 6c6f 6174      (x, y) float
+0001e0a0: 3634 2031 2e30 2034 2e30 2032 2e30 2039  64 1.0 4.0 2.0 9
+0001e0b0: 2e30 2032 2e30 2037 2e30 202e 2e2e 2036  .0 2.0 7.0 ... 6
+0001e0c0: 2e30 206e 616e 2036 2e30 206e 616e 2035  .0 nan 6.0 nan 5
+0001e0d0: 2e30 2038 2e30 0a0a 2020 2020 2020 2020  .0 8.0..        
+0001e0e0: 3144 2065 7874 7261 706f 6c61 7469 6f6e  1D extrapolation
+0001e0f0: 3a0a 0a20 2020 2020 2020 203e 3e3e 2064  :..        >>> d
+0001e100: 732e 696e 7465 7270 280a 2020 2020 2020  s.interp(.      
+0001e110: 2020 2e2e 2e20 2020 2020 783d 5b31 2c20    ...     x=[1, 
+0001e120: 312e 352c 2032 2e35 2c20 332e 355d 2c0a  1.5, 2.5, 3.5],.
+0001e130: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+0001e140: 6d65 7468 6f64 3d22 6c69 6e65 6172 222c  method="linear",
+0001e150: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+0001e160: 206b 7761 7267 733d 7b22 6669 6c6c 5f76   kwargs={"fill_v
+0001e170: 616c 7565 223a 2022 6578 7472 6170 6f6c  alue": "extrapol
+0001e180: 6174 6522 7d2c 0a20 2020 2020 2020 202e  ate"},.        .
+0001e190: 2e2e 2029 0a20 2020 2020 2020 203c 7861  .. ).        <xa
+0001e1a0: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
+0001e1b0: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
+0001e1c0: 3a20 2028 783a 2034 2c20 793a 2034 290a  :  (x: 4, y: 4).
+0001e1d0: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
+0001e1e0: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
+0001e1f0: 2079 2020 2020 2020 2020 2879 2920 696e   y        (y) in
+0001e200: 7436 3420 3130 2031 3220 3134 2031 360a  t64 10 12 14 16.
+0001e210: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
+0001e220: 2020 2020 2028 7829 2066 6c6f 6174 3634       (x) float64
+0001e230: 2031 2e30 2031 2e35 2032 2e35 2033 2e35   1.0 1.5 2.5 3.5
+0001e240: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
+0001e250: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+0001e260: 2020 2020 2061 2020 2020 2020 2020 2878       a        (x
+0001e270: 2920 666c 6f61 7436 3420 372e 3020 352e  ) float64 7.0 5.
+0001e280: 3520 322e 3520 2d30 2e35 0a20 2020 2020  5 2.5 -0.5.     
+0001e290: 2020 2020 2020 2062 2020 2020 2020 2020         b        
+0001e2a0: 2878 2c20 7929 2066 6c6f 6174 3634 2032  (x, y) float64 2
+0001e2b0: 2e30 2037 2e30 2036 2e30 206e 616e 2034  .0 7.0 6.0 nan 4
+0001e2c0: 2e30 206e 616e 202e 2e2e 2034 2e35 206e  .0 nan ... 4.5 n
+0001e2d0: 616e 2031 322e 3020 6e61 6e20 332e 3520  an 12.0 nan 3.5 
+0001e2e0: 6e61 6e0a 0a20 2020 2020 2020 2032 4420  nan..        2D 
+0001e2f0: 696e 7465 7270 6f6c 6174 696f 6e3a 0a0a  interpolation:..
+0001e300: 2020 2020 2020 2020 3e3e 3e20 6473 2e69          >>> ds.i
+0001e310: 6e74 6572 7028 783d 5b30 2c20 302e 3735  nterp(x=[0, 0.75
+0001e320: 2c20 312e 3235 2c20 312e 3735 5d2c 2079  , 1.25, 1.75], y
+0001e330: 3d5b 3131 2c20 3133 2c20 3135 5d2c 206d  =[11, 13, 15], m
+0001e340: 6574 686f 643d 226c 696e 6561 7222 290a  ethod="linear").
+0001e350: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+0001e360: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+0001e370: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
+0001e380: 3a20 342c 2079 3a20 3329 0a20 2020 2020  : 4, y: 3).     
+0001e390: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+0001e3a0: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
+0001e3b0: 2020 2020 2028 7829 2066 6c6f 6174 3634       (x) float64
+0001e3c0: 2030 2e30 2030 2e37 3520 312e 3235 2031   0.0 0.75 1.25 1
+0001e3d0: 2e37 350a 2020 2020 2020 2020 2020 2a20  .75.          * 
+0001e3e0: 7920 2020 2020 2020 2028 7929 2069 6e74  y        (y) int
+0001e3f0: 3634 2031 3120 3133 2031 350a 2020 2020  64 11 13 15.    
+0001e400: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
+0001e410: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0001e420: 6120 2020 2020 2020 2028 7829 2066 6c6f  a        (x) flo
+0001e430: 6174 3634 2035 2e30 2036 2e35 2036 2e32  at64 5.0 6.5 6.2
+0001e440: 3520 342e 3735 0a20 2020 2020 2020 2020  5 4.75.         
+0001e450: 2020 2062 2020 2020 2020 2020 2878 2c20     b        (x, 
+0001e460: 7929 2066 6c6f 6174 3634 2032 2e35 2033  y) float64 2.5 3
+0001e470: 2e30 206e 616e 2034 2e30 2035 2e36 3235  .0 nan 4.0 5.625
+0001e480: 206e 616e 206e 616e 206e 616e 206e 616e   nan nan nan nan
+0001e490: 206e 616e 206e 616e 206e 616e 0a20 2020   nan nan nan.   
+0001e4a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001e4b0: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
+0001e4c0: 6520 696d 706f 7274 206d 6973 7369 6e67  e import missing
+0001e4d0: 0a0a 2020 2020 2020 2020 6966 206b 7761  ..        if kwa
+0001e4e0: 7267 7320 6973 204e 6f6e 653a 0a20 2020  rgs is None:.   
+0001e4f0: 2020 2020 2020 2020 206b 7761 7267 7320           kwargs 
+0001e500: 3d20 7b7d 0a0a 2020 2020 2020 2020 636f  = {}..        co
+0001e510: 6f72 6473 203d 2065 6974 6865 725f 6469  ords = either_di
+0001e520: 6374 5f6f 725f 6b77 6172 6773 2863 6f6f  ct_or_kwargs(coo
+0001e530: 7264 732c 2063 6f6f 7264 735f 6b77 6172  rds, coords_kwar
+0001e540: 6773 2c20 2269 6e74 6572 7022 290a 2020  gs, "interp").  
+0001e550: 2020 2020 2020 696e 6465 7865 7273 203d        indexers =
+0001e560: 2064 6963 7428 7365 6c66 2e5f 7661 6c69   dict(self._vali
+0001e570: 6461 7465 5f69 6e74 6572 705f 696e 6465  date_interp_inde
+0001e580: 7865 7273 2863 6f6f 7264 7329 290a 0a20  xers(coords)).. 
+0001e590: 2020 2020 2020 2069 6620 636f 6f72 6473         if coords
+0001e5a0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0001e5b0: 5468 6973 2061 766f 6964 7320 6272 6f61  This avoids broa
+0001e5c0: 6463 6173 7469 6e67 206f 7665 7220 636f  dcasting over co
+0001e5d0: 6f72 6469 6e61 7465 7320 7468 6174 2061  ordinates that a
+0001e5e0: 7265 2062 6f74 6820 696e 0a20 2020 2020  re both in.     
+0001e5f0: 2020 2020 2020 2023 2074 6865 206f 7269         # the ori
+0001e600: 6769 6e61 6c20 6172 7261 7920 414e 4420  ginal array AND 
+0001e610: 696e 2074 6865 2069 6e64 6578 696e 6720  in the indexing 
+0001e620: 6172 7261 792e 2049 7420 6573 7365 6e74  array. It essent
+0001e630: 6961 6c6c 790a 2020 2020 2020 2020 2020  ially.          
+0001e640: 2020 2320 666f 7263 6573 2069 6e74 6572    # forces inter
+0001e650: 706f 6c61 7469 6f6e 2061 6c6f 6e67 2074  polation along t
+0001e660: 6865 2073 6861 7265 6420 636f 6f72 6469  he shared coordi
+0001e670: 6e61 7465 732e 0a20 2020 2020 2020 2020  nates..         
+0001e680: 2020 2073 6469 6d73 203d 2028 0a20 2020     sdims = (.   
+0001e690: 2020 2020 2020 2020 2020 2020 2073 6574               set
+0001e6a0: 2873 656c 662e 6469 6d73 290a 2020 2020  (self.dims).    
+0001e6b0: 2020 2020 2020 2020 2020 2020 2e69 6e74              .int
+0001e6c0: 6572 7365 6374 696f 6e28 2a5b 7365 7428  ersection(*[set(
+0001e6d0: 6e78 2e64 696d 7329 2066 6f72 206e 7820  nx.dims) for nx 
+0001e6e0: 696e 2069 6e64 6578 6572 732e 7661 6c75  in indexers.valu
+0001e6f0: 6573 2829 5d29 0a20 2020 2020 2020 2020  es()]).         
+0001e700: 2020 2020 2020 202e 6469 6666 6572 656e         .differen
+0001e710: 6365 2863 6f6f 7264 732e 6b65 7973 2829  ce(coords.keys()
+0001e720: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+0001e730: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+0001e740: 7865 7273 2e75 7064 6174 6528 7b64 3a20  xers.update({d: 
+0001e750: 7365 6c66 2e76 6172 6961 626c 6573 5b64  self.variables[d
+0001e760: 5d20 666f 7220 6420 696e 2073 6469 6d73  ] for d in sdims
+0001e770: 7d29 0a0a 2020 2020 2020 2020 6f62 6a20  })..        obj 
+0001e780: 3d20 7365 6c66 2069 6620 6173 7375 6d65  = self if assume
+0001e790: 5f73 6f72 7465 6420 656c 7365 2073 656c  _sorted else sel
+0001e7a0: 662e 736f 7274 6279 285b 6b20 666f 7220  f.sortby([k for 
+0001e7b0: 6b20 696e 2063 6f6f 7264 735d 290a 0a20  k in coords]).. 
+0001e7c0: 2020 2020 2020 2064 6566 206d 6179 6265         def maybe
+0001e7d0: 5f76 6172 6961 626c 6528 6f62 6a2c 206b  _variable(obj, k
+0001e7e0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+0001e7f0: 2077 6f72 6b61 726f 756e 6420 746f 2067   workaround to g
+0001e800: 6574 2076 6172 6961 626c 6520 666f 7220  et variable for 
+0001e810: 6469 6d65 6e73 696f 6e20 7769 7468 6f75  dimension withou
+0001e820: 7420 636f 6f72 6469 6e61 7465 2e0a 2020  t coordinate..  
+0001e830: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0001e840: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001e850: 6574 7572 6e20 6f62 6a2e 5f76 6172 6961  eturn obj._varia
+0001e860: 626c 6573 5b6b 5d0a 2020 2020 2020 2020  bles[k].        
+0001e870: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+0001e880: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+0001e890: 2020 2020 2072 6574 7572 6e20 6173 5f76       return as_v
+0001e8a0: 6172 6961 626c 6528 286b 2c20 7261 6e67  ariable((k, rang
+0001e8b0: 6528 6f62 6a2e 6469 6d73 5b6b 5d29 2929  e(obj.dims[k])))
+0001e8c0: 0a0a 2020 2020 2020 2020 6465 6620 5f76  ..        def _v
+0001e8d0: 616c 6964 6174 655f 696e 7465 7270 5f69  alidate_interp_i
+0001e8e0: 6e64 6578 6572 2878 2c20 6e65 775f 7829  ndexer(x, new_x)
+0001e8f0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0001e900: 496e 2074 6865 2063 6173 6520 6f66 2064  In the case of d
+0001e910: 6174 6574 696d 6573 2c20 7468 6520 7265  atetimes, the re
+0001e920: 7374 7269 6374 696f 6e73 2070 6c61 6365  strictions place
+0001e930: 6420 6f6e 2069 6e64 6578 6572 730a 2020  d on indexers.  
+0001e940: 2020 2020 2020 2020 2020 2320 7573 6564            # used
+0001e950: 2077 6974 6820 696e 7465 7270 2061 7265   with interp are
+0001e960: 2073 7472 6f6e 6765 7220 7468 616e 2074   stronger than t
+0001e970: 686f 7365 2077 6869 6368 2061 7265 2070  hose which are p
+0001e980: 6c61 6365 6420 6f6e 0a20 2020 2020 2020  laced on.       
+0001e990: 2020 2020 2023 2069 7365 6c2c 2073 6f20       # isel, so 
+0001e9a0: 7765 206e 6565 6420 616e 2061 6464 6974  we need an addit
+0001e9b0: 696f 6e61 6c20 6368 6563 6b20 6166 7465  ional check afte
+0001e9c0: 7220 5f76 616c 6964 6174 655f 696e 6465  r _validate_inde
+0001e9d0: 7865 7273 2e0a 2020 2020 2020 2020 2020  xers..          
+0001e9e0: 2020 6966 205f 636f 6e74 6169 6e73 5f64    if _contains_d
+0001e9f0: 6174 6574 696d 655f 6c69 6b65 5f6f 626a  atetime_like_obj
+0001ea00: 6563 7473 280a 2020 2020 2020 2020 2020  ects(.          
+0001ea10: 2020 2020 2020 780a 2020 2020 2020 2020        x.        
+0001ea20: 2020 2020 2920 616e 6420 6e6f 7420 5f63      ) and not _c
+0001ea30: 6f6e 7461 696e 735f 6461 7465 7469 6d65  ontains_datetime
+0001ea40: 5f6c 696b 655f 6f62 6a65 6374 7328 6e65  _like_objects(ne
+0001ea50: 775f 7829 3a0a 2020 2020 2020 2020 2020  w_x):.          
+0001ea60: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+0001ea70: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+0001ea80: 2020 2020 2020 2020 2020 2022 5768 656e             "When
+0001ea90: 2069 6e74 6572 706f 6c61 7469 6e67 206f   interpolating o
+0001eaa0: 7665 7220 6120 6461 7465 7469 6d65 2d6c  ver a datetime-l
+0001eab0: 696b 6520 220a 2020 2020 2020 2020 2020  ike ".          
+0001eac0: 2020 2020 2020 2020 2020 2263 6f6f 7264            "coord
+0001ead0: 696e 6174 652c 2074 6865 2063 6f6f 7264  inate, the coord
+0001eae0: 696e 6174 6573 2074 6f20 220a 2020 2020  inates to ".    
+0001eaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb00: 2269 6e74 6572 706f 6c61 7465 2074 6f20  "interpolate to 
+0001eb10: 6d75 7374 2062 6520 6569 7468 6572 2064  must be either d
+0001eb20: 6174 6574 696d 6520 220a 2020 2020 2020  atetime ".      
+0001eb30: 2020 2020 2020 2020 2020 2020 2020 2273                "s
+0001eb40: 7472 696e 6773 206f 7220 6461 7465 7469  trings or dateti
+0001eb50: 6d65 732e 2022 0a20 2020 2020 2020 2020  mes. ".         
+0001eb60: 2020 2020 2020 2020 2020 2022 496e 7374             "Inst
+0001eb70: 6561 6420 676f 745c 6e7b 7d22 2e66 6f72  ead got\n{}".for
+0001eb80: 6d61 7428 6e65 775f 7829 0a20 2020 2020  mat(new_x).     
+0001eb90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001eba0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001ebb0: 782c 206e 6577 5f78 0a0a 2020 2020 2020  x, new_x..      
+0001ebc0: 2020 7661 6c69 6461 7465 645f 696e 6465    validated_inde
+0001ebd0: 7865 7273 203d 207b 0a20 2020 2020 2020  xers = {.       
+0001ebe0: 2020 2020 206b 3a20 5f76 616c 6964 6174       k: _validat
+0001ebf0: 655f 696e 7465 7270 5f69 6e64 6578 6572  e_interp_indexer
+0001ec00: 286d 6179 6265 5f76 6172 6961 626c 6528  (maybe_variable(
+0001ec10: 6f62 6a2c 206b 292c 2076 290a 2020 2020  obj, k), v).    
+0001ec20: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
+0001ec30: 2069 6e20 696e 6465 7865 7273 2e69 7465   in indexers.ite
+0001ec40: 6d73 2829 0a20 2020 2020 2020 207d 0a0a  ms().        }..
+0001ec50: 2020 2020 2020 2020 2320 6f70 7469 6d69          # optimi
+0001ec60: 7a61 7469 6f6e 3a20 7375 6273 6574 2074  zation: subset t
+0001ec70: 6f20 636f 6f72 6469 6e61 7465 2072 616e  o coordinate ran
+0001ec80: 6765 206f 6620 7468 6520 7461 7267 6574  ge of the target
+0001ec90: 2069 6e64 6578 0a20 2020 2020 2020 2069   index.        i
+0001eca0: 6620 6d65 7468 6f64 2069 6e20 5b22 6c69  f method in ["li
+0001ecb0: 6e65 6172 222c 2022 6e65 6172 6573 7422  near", "nearest"
+0001ecc0: 5d3a 0a20 2020 2020 2020 2020 2020 2066  ]:.            f
+0001ecd0: 6f72 206b 2c20 7620 696e 2076 616c 6964  or k, v in valid
+0001ece0: 6174 6564 5f69 6e64 6578 6572 732e 6974  ated_indexers.it
+0001ecf0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+0001ed00: 2020 2020 2020 206f 626a 2c20 6e65 7769         obj, newi
+0001ed10: 6478 203d 206d 6973 7369 6e67 2e5f 6c6f  dx = missing._lo
+0001ed20: 6361 6c69 7a65 286f 626a 2c20 7b6b 3a20  calize(obj, {k: 
+0001ed30: 767d 290a 2020 2020 2020 2020 2020 2020  v}).            
+0001ed40: 2020 2020 7661 6c69 6461 7465 645f 696e      validated_in
+0001ed50: 6465 7865 7273 5b6b 5d20 3d20 6e65 7769  dexers[k] = newi
+0001ed60: 6478 5b6b 5d0a 0a20 2020 2020 2020 2023  dx[k]..        #
+0001ed70: 206f 7074 696d 697a 6174 696f 6e3a 2063   optimization: c
+0001ed80: 7265 6174 6520 6461 736b 2063 6f6f 7264  reate dask coord
+0001ed90: 696e 6174 6520 6172 7261 7973 206f 6e63  inate arrays onc
+0001eda0: 6520 7065 7220 4461 7461 7365 740a 2020  e per Dataset.  
+0001edb0: 2020 2020 2020 2320 7261 7468 6572 2074        # rather t
+0001edc0: 6861 6e20 6f6e 6365 2070 6572 2056 6172  han once per Var
+0001edd0: 6961 626c 6520 7768 656e 2064 6173 6b2e  iable when dask.
+0001ede0: 6172 7261 792e 756e 6966 795f 6368 756e  array.unify_chun
+0001edf0: 6b73 2069 7320 6361 6c6c 6564 206c 6174  ks is called lat
+0001ee00: 6572 0a20 2020 2020 2020 2023 2047 4834  er.        # GH4
+0001ee10: 3733 390a 2020 2020 2020 2020 6966 206f  739.        if o
+0001ee20: 626a 2e5f 5f64 6173 6b5f 6772 6170 685f  bj.__dask_graph_
+0001ee30: 5f28 293a 0a20 2020 2020 2020 2020 2020  _():.           
+0001ee40: 2064 6173 6b5f 696e 6465 7865 7273 203d   dask_indexers =
+0001ee50: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0001ee60: 2020 206b 3a20 2869 6e64 6578 2e74 6f5f     k: (index.to_
+0001ee70: 6261 7365 5f76 6172 6961 626c 6528 292e  base_variable().
+0001ee80: 6368 756e 6b28 292c 2064 6573 742e 746f  chunk(), dest.to
+0001ee90: 5f62 6173 655f 7661 7269 6162 6c65 2829  _base_variable()
+0001eea0: 2e63 6875 6e6b 2829 290a 2020 2020 2020  .chunk()).      
+0001eeb0: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
+0001eec0: 2028 696e 6465 782c 2064 6573 7429 2069   (index, dest) i
+0001eed0: 6e20 7661 6c69 6461 7465 645f 696e 6465  n validated_inde
+0001eee0: 7865 7273 2e69 7465 6d73 2829 0a20 2020  xers.items().   
+0001eef0: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
+0001ef00: 2020 2020 7661 7269 6162 6c65 733a 2064      variables: d
+0001ef10: 6963 745b 4861 7368 6162 6c65 2c20 5661  ict[Hashable, Va
+0001ef20: 7269 6162 6c65 5d20 3d20 7b7d 0a20 2020  riable] = {}.   
+0001ef30: 2020 2020 2072 6569 6e64 6578 3a20 626f       reindex: bo
+0001ef40: 6f6c 203d 2046 616c 7365 0a20 2020 2020  ol = False.     
+0001ef50: 2020 2066 6f72 206e 616d 652c 2076 6172     for name, var
+0001ef60: 2069 6e20 6f62 6a2e 5f76 6172 6961 626c   in obj._variabl
+0001ef70: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
+0001ef80: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
+0001ef90: 696e 2069 6e64 6578 6572 733a 0a20 2020  in indexers:.   
+0001efa0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001efb0: 7469 6e75 650a 0a20 2020 2020 2020 2020  tinue..         
+0001efc0: 2020 2069 6620 6973 5f64 7563 6b5f 6461     if is_duck_da
+0001efd0: 736b 5f61 7272 6179 2876 6172 2e64 6174  sk_array(var.dat
+0001efe0: 6129 3a0a 2020 2020 2020 2020 2020 2020  a):.            
+0001eff0: 2020 2020 7573 655f 696e 6465 7865 7273      use_indexers
+0001f000: 203d 2064 6173 6b5f 696e 6465 7865 7273   = dask_indexers
+0001f010: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0001f020: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001f030: 2020 2075 7365 5f69 6e64 6578 6572 7320     use_indexers 
+0001f040: 3d20 7661 6c69 6461 7465 645f 696e 6465  = validated_inde
+0001f050: 7865 7273 0a0a 2020 2020 2020 2020 2020  xers..          
+0001f060: 2020 6474 7970 655f 6b69 6e64 203d 2076    dtype_kind = v
+0001f070: 6172 2e64 7479 7065 2e6b 696e 640a 2020  ar.dtype.kind.  
+0001f080: 2020 2020 2020 2020 2020 6966 2064 7479            if dty
+0001f090: 7065 5f6b 696e 6420 696e 2022 7569 6663  pe_kind in "uifc
+0001f0a0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0001f0b0: 2020 2023 2046 6f72 206e 6f72 6d61 6c20     # For normal 
+0001f0c0: 6e75 6d62 6572 2074 7970 6573 2064 6f20  number types do 
+0001f0d0: 7468 6520 696e 7465 7270 6f6c 6174 696f  the interpolatio
+0001f0e0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+0001f0f0: 2020 2076 6172 5f69 6e64 6578 6572 7320     var_indexers 
+0001f100: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
+0001f110: 2069 6e20 7573 655f 696e 6465 7865 7273   in use_indexers
+0001f120: 2e69 7465 6d73 2829 2069 6620 6b20 696e  .items() if k in
+0001f130: 2076 6172 2e64 696d 737d 0a20 2020 2020   var.dims}.     
+0001f140: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+0001f150: 626c 6573 5b6e 616d 655d 203d 206d 6973  bles[name] = mis
+0001f160: 7369 6e67 2e69 6e74 6572 7028 7661 722c  sing.interp(var,
+0001f170: 2076 6172 5f69 6e64 6578 6572 732c 206d   var_indexers, m
+0001f180: 6574 686f 642c 202a 2a6b 7761 7267 7329  ethod, **kwargs)
+0001f190: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0001f1a0: 6620 6474 7970 655f 6b69 6e64 2069 6e20  f dtype_kind in 
+0001f1b0: 224f 6255 2220 616e 6420 2875 7365 5f69  "ObU" and (use_i
+0001f1c0: 6e64 6578 6572 732e 6b65 7973 2829 2026  ndexers.keys() &
+0001f1d0: 2076 6172 2e64 696d 7329 3a0a 2020 2020   var.dims):.    
+0001f1e0: 2020 2020 2020 2020 2020 2020 2320 466f              # Fo
+0001f1f0: 7220 7479 7065 7320 7468 6174 2077 6520  r types that we 
+0001f200: 646f 206e 6f74 2075 6e64 6572 7374 616e  do not understan
+0001f210: 6420 646f 2073 7465 7077 6973 650a 2020  d do stepwise.  
+0001f220: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001f230: 696e 7465 7270 6f6c 6174 696f 6e20 746f  interpolation to
+0001f240: 2061 766f 6964 206d 6f64 6966 7969 6e67   avoid modifying
+0001f250: 2074 6865 2065 6c65 6d65 6e74 732e 0a20   the elements.. 
+0001f260: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001f270: 2072 6569 6e64 6578 2074 6865 2076 6172   reindex the var
+0001f280: 6961 626c 6520 696e 7374 6561 6420 6265  iable instead be
+0001f290: 6361 7573 6520 6974 2073 7570 706f 7274  cause it support
+0001f2a0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0001f2b0: 2020 2320 626f 6f6c 6561 6e73 2061 6e64    # booleans and
+0001f2c0: 206f 626a 6563 7473 2061 6e64 2072 6574   objects and ret
+0001f2d0: 6169 6e73 2074 6865 2064 7479 7065 2062  ains the dtype b
+0001f2e0: 7574 2069 6e73 6964 650a 2020 2020 2020  ut inside.      
+0001f2f0: 2020 2020 2020 2020 2020 2320 7468 6973            # this
+0001f300: 206c 6f6f 7020 7468 6572 6520 6d69 6768   loop there migh
+0001f310: 7420 6265 2073 6f6d 6520 6475 706c 6963  t be some duplic
+0001f320: 6174 6520 636f 6465 2074 6861 7420 736c  ate code that sl
+0001f330: 6f77 7320 6974 0a20 2020 2020 2020 2020  ows it.         
+0001f340: 2020 2020 2020 2023 2064 6f77 6e2c 2074         # down, t
+0001f350: 6865 7265 666f 7265 2063 6f6c 6c65 6374  herefore collect
+0001f360: 2074 6865 7365 2073 6967 6e61 6c73 2061   these signals a
+0001f370: 6e64 2072 756e 2069 7420 6c61 7465 723a  nd run it later:
+0001f380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f390: 2072 6569 6e64 6578 203d 2054 7275 650a   reindex = True.
+0001f3a0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0001f3b0: 2061 6c6c 2864 206e 6f74 2069 6e20 696e   all(d not in in
+0001f3c0: 6465 7865 7273 2066 6f72 2064 2069 6e20  dexers for d in 
+0001f3d0: 7661 722e 6469 6d73 293a 0a20 2020 2020  var.dims):.     
+0001f3e0: 2020 2020 2020 2020 2020 2023 2046 6f72             # For
+0001f3f0: 2061 6e79 7468 696e 6720 656c 7365 2077   anything else w
+0001f400: 6520 6361 6e20 6f6e 6c79 206b 6565 7020  e can only keep 
+0001f410: 7661 7269 6162 6c65 7320 6966 2074 6865  variables if the
+0001f420: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+0001f430: 2020 2320 6172 6520 6e6f 7420 6465 7065    # are not depe
+0001f440: 6e64 656e 7420 6f6e 2061 6e79 2063 6f6f  ndent on any coo
+0001f450: 7264 7320 7468 6174 2061 7265 2062 6569  rds that are bei
+0001f460: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
+0001f470: 2020 2023 2069 6e74 6572 706f 6c61 7465     # interpolate
+0001f480: 6420 616c 6f6e 673a 0a20 2020 2020 2020  d along:.       
+0001f490: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+0001f4a0: 6573 5b6e 616d 655d 203d 2076 6172 0a0a  es[name] = var..
+0001f4b0: 2020 2020 2020 2020 6966 2072 6569 6e64          if reind
+0001f4c0: 6578 3a0a 2020 2020 2020 2020 2020 2020  ex:.            
+0001f4d0: 7265 696e 6465 785f 696e 6465 7865 7273  reindex_indexers
+0001f4e0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+0001f4f0: 2020 2020 206b 3a20 7620 666f 7220 6b2c       k: v for k,
+0001f500: 2028 5f2c 2076 2920 696e 2076 616c 6964   (_, v) in valid
+0001f510: 6174 6564 5f69 6e64 6578 6572 732e 6974  ated_indexers.it
+0001f520: 656d 7328 2920 6966 2076 2e64 696d 7320  ems() if v.dims 
+0001f530: 3d3d 2028 6b2c 290a 2020 2020 2020 2020  == (k,).        
+0001f540: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+0001f550: 2020 7265 696e 6465 7865 6420 3d20 616c    reindexed = al
+0001f560: 6967 6e6d 656e 742e 7265 696e 6465 7828  ignment.reindex(
+0001f570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f580: 206f 626a 2c0a 2020 2020 2020 2020 2020   obj,.          
+0001f590: 2020 2020 2020 696e 6465 7865 7273 3d72        indexers=r
+0001f5a0: 6569 6e64 6578 5f69 6e64 6578 6572 732c  eindex_indexers,
+0001f5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f5c0: 206d 6574 686f 643d 6d65 7468 6f64 5f6e   method=method_n
+0001f5d0: 6f6e 5f6e 756d 6572 6963 2c0a 2020 2020  on_numeric,.    
+0001f5e0: 2020 2020 2020 2020 2020 2020 6578 636c              excl
+0001f5f0: 7564 655f 7661 7273 3d76 6172 6961 626c  ude_vars=variabl
+0001f600: 6573 2e6b 6579 7328 292c 0a20 2020 2020  es.keys(),.     
+0001f610: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001f620: 2020 2020 2069 6e64 6578 6573 203d 2064       indexes = d
+0001f630: 6963 7428 7265 696e 6465 7865 642e 5f69  ict(reindexed._i
+0001f640: 6e64 6578 6573 290a 2020 2020 2020 2020  ndexes).        
+0001f650: 2020 2020 7661 7269 6162 6c65 732e 7570      variables.up
+0001f660: 6461 7465 2872 6569 6e64 6578 6564 2e76  date(reindexed.v
+0001f670: 6172 6961 626c 6573 290a 2020 2020 2020  ariables).      
+0001f680: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001f690: 2020 2020 2320 4765 7420 7468 6520 696e      # Get the in
+0001f6a0: 6465 7865 7320 7468 6174 2061 7265 206e  dexes that are n
+0001f6b0: 6f74 2062 6569 6e67 2069 6e74 6572 706f  ot being interpo
+0001f6c0: 6c61 7465 6420 616c 6f6e 670a 2020 2020  lated along.    
+0001f6d0: 2020 2020 2020 2020 696e 6465 7865 7320          indexes 
+0001f6e0: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
+0001f6f0: 2069 6e20 6f62 6a2e 5f69 6e64 6578 6573   in obj._indexes
+0001f700: 2e69 7465 6d73 2829 2069 6620 6b20 6e6f  .items() if k no
+0001f710: 7420 696e 2069 6e64 6578 6572 737d 0a0a  t in indexers}..
+0001f720: 2020 2020 2020 2020 2320 4765 7420 7468          # Get th
+0001f730: 6520 636f 6f72 6473 2074 6861 7420 616c  e coords that al
+0001f740: 736f 2065 7869 7374 2069 6e20 7468 6520  so exist in the 
+0001f750: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+0001f760: 2020 2063 6f6f 7264 5f6e 616d 6573 203d     coord_names =
+0001f770: 206f 626a 2e5f 636f 6f72 645f 6e61 6d65   obj._coord_name
+0001f780: 7320 2620 7661 7269 6162 6c65 732e 6b65  s & variables.ke
+0001f790: 7973 2829 0a20 2020 2020 2020 2073 656c  ys().        sel
+0001f7a0: 6563 7465 6420 3d20 7365 6c66 2e5f 7265  ected = self._re
+0001f7b0: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
+0001f7c0: 696d 7328 0a20 2020 2020 2020 2020 2020  ims(.           
+0001f7d0: 2076 6172 6961 626c 6573 2e63 6f70 7928   variables.copy(
+0001f7e0: 292c 2063 6f6f 7264 5f6e 616d 6573 2c20  ), coord_names, 
+0001f7f0: 696e 6465 7865 733d 696e 6465 7865 730a  indexes=indexes.
+0001f800: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0001f810: 2020 2023 2041 7474 6163 6820 696e 6465     # Attach inde
+0001f820: 7865 7220 6173 2063 6f6f 7264 696e 6174  xer as coordinat
+0001f830: 650a 2020 2020 2020 2020 666f 7220 6b2c  e.        for k,
+0001f840: 2076 2069 6e20 696e 6465 7865 7273 2e69   v in indexers.i
+0001f850: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+0001f860: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+0001f870: 7461 6e63 6528 762c 2056 6172 6961 626c  tance(v, Variabl
+0001f880: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+0001f890: 6620 762e 6469 6d73 203d 3d20 286b 2c29  f v.dims == (k,)
+0001f8a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001f8b0: 2020 696e 6465 7820 3d20 5061 6e64 6173    index = Pandas
+0001f8c0: 496e 6465 7828 762c 206b 2c20 636f 6f72  Index(v, k, coor
+0001f8d0: 645f 6474 7970 653d 762e 6474 7970 6529  d_dtype=v.dtype)
+0001f8e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f8f0: 2069 6e64 6578 5f76 6172 7320 3d20 696e   index_vars = in
+0001f900: 6465 782e 6372 6561 7465 5f76 6172 6961  dex.create_varia
+0001f910: 626c 6573 287b 6b3a 2076 7d29 0a20 2020  bles({k: v}).   
+0001f920: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+0001f930: 6578 6573 5b6b 5d20 3d20 696e 6465 780a  exes[k] = index.
+0001f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f950: 7661 7269 6162 6c65 732e 7570 6461 7465  variables.update
+0001f960: 2869 6e64 6578 5f76 6172 7329 0a20 2020  (index_vars).   
+0001f970: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001f980: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0001f990: 6172 6961 626c 6573 5b6b 5d20 3d20 760a  ariables[k] = v.
+0001f9a0: 0a20 2020 2020 2020 2023 2045 7874 7261  .        # Extra
+0001f9b0: 6374 2063 6f6f 7264 696e 6174 6573 2066  ct coordinates f
+0001f9c0: 726f 6d20 696e 6465 7865 7273 0a20 2020  rom indexers.   
+0001f9d0: 2020 2020 2063 6f6f 7264 5f76 6172 732c       coord_vars,
+0001f9e0: 206e 6577 5f69 6e64 6578 6573 203d 2073   new_indexes = s
+0001f9f0: 656c 6563 7465 642e 5f67 6574 5f69 6e64  elected._get_ind
+0001fa00: 6578 6572 735f 636f 6f72 6473 5f61 6e64  exers_coords_and
+0001fa10: 5f69 6e64 6578 6573 2863 6f6f 7264 7329  _indexes(coords)
+0001fa20: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
+0001fa30: 6573 2e75 7064 6174 6528 636f 6f72 645f  es.update(coord_
+0001fa40: 7661 7273 290a 2020 2020 2020 2020 696e  vars).        in
+0001fa50: 6465 7865 732e 7570 6461 7465 286e 6577  dexes.update(new
+0001fa60: 5f69 6e64 6578 6573 290a 0a20 2020 2020  _indexes)..     
+0001fa70: 2020 2063 6f6f 7264 5f6e 616d 6573 203d     coord_names =
+0001fa80: 206f 626a 2e5f 636f 6f72 645f 6e61 6d65   obj._coord_name
+0001fa90: 7320 2620 7661 7269 6162 6c65 732e 6b65  s & variables.ke
+0001faa0: 7973 2829 207c 2063 6f6f 7264 5f76 6172  ys() | coord_var
+0001fab0: 732e 6b65 7973 2829 0a20 2020 2020 2020  s.keys().       
+0001fac0: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
+0001fad0: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
+0001fae0: 696d 7328 7661 7269 6162 6c65 732c 2063  ims(variables, c
+0001faf0: 6f6f 7264 5f6e 616d 6573 2c20 696e 6465  oord_names, inde
+0001fb00: 7865 733d 696e 6465 7865 7329 0a0a 2020  xes=indexes)..  
+0001fb10: 2020 6465 6620 696e 7465 7270 5f6c 696b    def interp_lik
+0001fb20: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
+0001fb30: 0a20 2020 2020 2020 206f 7468 6572 3a20  .        other: 
+0001fb40: 4461 7461 7365 7420 7c20 4461 7461 4172  Dataset | DataAr
+0001fb50: 7261 792c 0a20 2020 2020 2020 206d 6574  ray,.        met
+0001fb60: 686f 643a 2049 6e74 6572 704f 7074 696f  hod: InterpOptio
+0001fb70: 6e73 203d 2022 6c69 6e65 6172 222c 0a20  ns = "linear",. 
+0001fb80: 2020 2020 2020 2061 7373 756d 655f 736f         assume_so
+0001fb90: 7274 6564 3a20 626f 6f6c 203d 2046 616c  rted: bool = Fal
+0001fba0: 7365 2c0a 2020 2020 2020 2020 6b77 6172  se,.        kwar
+0001fbb0: 6773 3a20 4d61 7070 696e 675b 7374 722c  gs: Mapping[str,
+0001fbc0: 2041 6e79 5d20 7c20 4e6f 6e65 203d 204e   Any] | None = N
+0001fbd0: 6f6e 652c 0a20 2020 2020 2020 206d 6574  one,.        met
+0001fbe0: 686f 645f 6e6f 6e5f 6e75 6d65 7269 633a  hod_non_numeric:
+0001fbf0: 2073 7472 203d 2022 6e65 6172 6573 7422   str = "nearest"
+0001fc00: 2c0a 2020 2020 2920 2d3e 2044 6174 6173  ,.    ) -> Datas
+0001fc10: 6574 3a0a 2020 2020 2020 2020 2222 2249  et:.        """I
+0001fc20: 6e74 6572 706f 6c61 7465 2074 6869 7320  nterpolate this 
+0001fc30: 6f62 6a65 6374 206f 6e74 6f20 7468 6520  object onto the 
+0001fc40: 636f 6f72 6469 6e61 7465 7320 6f66 2061  coordinates of a
+0001fc50: 6e6f 7468 6572 206f 626a 6563 742c 0a20  nother object,. 
+0001fc60: 2020 2020 2020 2066 696c 6c69 6e67 2074         filling t
+0001fc70: 6865 206f 7574 206f 6620 7261 6e67 6520  he out of range 
+0001fc80: 7661 6c75 6573 2077 6974 6820 4e61 4e2e  values with NaN.
+0001fc90: 0a0a 2020 2020 2020 2020 4966 2069 6e74  ..        If int
+0001fca0: 6572 706f 6c61 7469 6e67 2061 6c6f 6e67  erpolating along
+0001fcb0: 2061 2073 696e 676c 6520 6578 6973 7469   a single existi
+0001fcc0: 6e67 2064 696d 656e 7369 6f6e 2c0a 2020  ng dimension,.  
+0001fcd0: 2020 2020 2020 3a70 793a 636c 6173 733a        :py:class:
+0001fce0: 6073 6369 7079 2e69 6e74 6572 706f 6c61  `scipy.interpola
+0001fcf0: 7465 2e69 6e74 6572 7031 6460 2069 7320  te.interp1d` is 
+0001fd00: 6361 6c6c 6564 2e20 5768 656e 2069 6e74  called. When int
+0001fd10: 6572 706f 6c61 7469 6e67 0a20 2020 2020  erpolating.     
+0001fd20: 2020 2061 6c6f 6e67 206d 756c 7469 706c     along multipl
+0001fd30: 6520 6578 6973 7469 6e67 2064 696d 656e  e existing dimen
+0001fd40: 7369 6f6e 732c 2061 6e20 6174 7465 6d70  sions, an attemp
+0001fd50: 7420 6973 206d 6164 6520 746f 2064 6563  t is made to dec
+0001fd60: 6f6d 706f 7365 2074 6865 0a20 2020 2020  ompose the.     
+0001fd70: 2020 2069 6e74 6572 706f 6c61 7469 6f6e     interpolation
+0001fd80: 2069 6e74 6f20 6d75 6c74 6970 6c65 2031   into multiple 1
+0001fd90: 2d64 696d 656e 7369 6f6e 616c 2069 6e74  -dimensional int
+0001fda0: 6572 706f 6c61 7469 6f6e 732e 2049 6620  erpolations. If 
+0001fdb0: 7468 6973 2069 730a 2020 2020 2020 2020  this is.        
+0001fdc0: 706f 7373 6962 6c65 2c20 3a70 793a 636c  possible, :py:cl
+0001fdd0: 6173 733a 6073 6369 7079 2e69 6e74 6572  ass:`scipy.inter
+0001fde0: 706f 6c61 7465 2e69 6e74 6572 7031 6460  polate.interp1d`
+0001fdf0: 2069 7320 6361 6c6c 6564 2e20 4f74 6865   is called. Othe
+0001fe00: 7277 6973 652c 0a20 2020 2020 2020 203a  rwise,.        :
+0001fe10: 7079 3a66 756e 633a 6073 6369 7079 2e69  py:func:`scipy.i
+0001fe20: 6e74 6572 706f 6c61 7465 2e69 6e74 6572  nterpolate.inter
+0001fe30: 706e 6020 6973 2063 616c 6c65 642e 0a0a  pn` is called...
+0001fe40: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+0001fe50: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+0001fe60: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6f74  -----.        ot
+0001fe70: 6865 7220 3a20 4461 7461 7365 7420 6f72  her : Dataset or
+0001fe80: 2044 6174 6141 7272 6179 0a20 2020 2020   DataArray.     
+0001fe90: 2020 2020 2020 204f 626a 6563 7420 7769         Object wi
+0001fea0: 7468 2061 6e20 2769 6e64 6578 6573 2720  th an 'indexes' 
+0001feb0: 6174 7472 6962 7574 6520 6769 7669 6e67  attribute giving
+0001fec0: 2061 206d 6170 7069 6e67 2066 726f 6d20   a mapping from 
+0001fed0: 6469 6d65 6e73 696f 6e0a 2020 2020 2020  dimension.      
+0001fee0: 2020 2020 2020 6e61 6d65 7320 746f 2061        names to a
+0001fef0: 6e20 3164 2061 7272 6179 2d6c 696b 652c  n 1d array-like,
+0001ff00: 2077 6869 6368 2070 726f 7669 6465 7320   which provides 
+0001ff10: 636f 6f72 6469 6e61 7465 7320 7570 6f6e  coordinates upon
+0001ff20: 0a20 2020 2020 2020 2020 2020 2077 6869  .            whi
+0001ff30: 6368 2074 6f20 696e 6465 7820 7468 6520  ch to index the 
+0001ff40: 7661 7269 6162 6c65 7320 696e 2074 6869  variables in thi
+0001ff50: 7320 6461 7461 7365 742e 204d 6973 7369  s dataset. Missi
+0001ff60: 6e67 2076 616c 7565 7320 6172 6520 736b  ng values are sk
+0001ff70: 6970 7065 642e 0a20 2020 2020 2020 206d  ipped..        m
+0001ff80: 6574 686f 6420 3a20 7b22 6c69 6e65 6172  ethod : {"linear
+0001ff90: 222c 2022 6e65 6172 6573 7422 2c20 227a  ", "nearest", "z
+0001ffa0: 6572 6f22 2c20 2273 6c69 6e65 6172 222c  ero", "slinear",
+0001ffb0: 2022 7175 6164 7261 7469 6322 2c20 2263   "quadratic", "c
+0001ffc0: 7562 6963 222c 2022 706f 6c79 6e6f 6d69  ubic", "polynomi
+0001ffd0: 616c 222c 205c 0a20 2020 2020 2020 2020  al", \.         
+0001ffe0: 2020 2022 6261 7279 6365 6e74 7269 6322     "barycentric"
+0001fff0: 2c20 226b 726f 6722 2c20 2270 6368 6970  , "krog", "pchip
+00020000: 222c 2022 7370 6c69 6e65 222c 2022 616b  ", "spline", "ak
+00020010: 696d 6122 7d2c 2064 6566 6175 6c74 3a20  ima"}, default: 
+00020020: 226c 696e 6561 7222 0a20 2020 2020 2020  "linear".       
+00020030: 2020 2020 2053 7472 696e 6720 696e 6469       String indi
+00020040: 6361 7469 6e67 2077 6869 6368 206d 6574  cating which met
+00020050: 686f 6420 746f 2075 7365 2066 6f72 2069  hod to use for i
+00020060: 6e74 6572 706f 6c61 7469 6f6e 3a0a 0a20  nterpolation:.. 
+00020070: 2020 2020 2020 2020 2020 202d 2027 6c69             - 'li
+00020080: 6e65 6172 273a 206c 696e 6561 7220 696e  near': linear in
+00020090: 7465 7270 6f6c 6174 696f 6e2e 2041 6464  terpolation. Add
+000200a0: 6974 696f 6e61 6c20 6b65 7977 6f72 640a  itional keyword.
+000200b0: 2020 2020 2020 2020 2020 2020 2020 6172                ar
+000200c0: 6775 6d65 6e74 7320 6172 6520 7061 7373  guments are pass
+000200d0: 6564 2074 6f20 3a70 793a 6675 6e63 3a60  ed to :py:func:`
+000200e0: 6e75 6d70 792e 696e 7465 7270 600a 2020  numpy.interp`.  
+000200f0: 2020 2020 2020 2020 2020 2d20 276e 6561            - 'nea
+00020100: 7265 7374 272c 2027 7a65 726f 272c 2027  rest', 'zero', '
+00020110: 736c 696e 6561 7227 2c20 2771 7561 6472  slinear', 'quadr
+00020120: 6174 6963 272c 2027 6375 6269 6327 2c20  atic', 'cubic', 
+00020130: 2770 6f6c 796e 6f6d 6961 6c27 3a0a 2020  'polynomial':.  
+00020140: 2020 2020 2020 2020 2020 2020 6172 6520              are 
+00020150: 7061 7373 6564 2074 6f20 3a70 793a 6675  passed to :py:fu
+00020160: 6e63 3a60 7363 6970 792e 696e 7465 7270  nc:`scipy.interp
+00020170: 6f6c 6174 652e 696e 7465 7270 3164 602e  olate.interp1d`.
+00020180: 2049 660a 2020 2020 2020 2020 2020 2020   If.            
+00020190: 2020 6060 6d65 7468 6f64 3d27 706f 6c79    ``method='poly
+000201a0: 6e6f 6d69 616c 2760 602c 2074 6865 2060  nomial'``, the `
+000201b0: 606f 7264 6572 6060 206b 6579 776f 7264  `order`` keyword
+000201c0: 2061 7267 756d 656e 7420 6d75 7374 2061   argument must a
+000201d0: 6c73 6f20 6265 0a20 2020 2020 2020 2020  lso be.         
+000201e0: 2020 2020 2070 726f 7669 6465 642e 0a20       provided.. 
+000201f0: 2020 2020 2020 2020 2020 202d 2027 6261             - 'ba
+00020200: 7279 6365 6e74 7269 6327 2c20 276b 726f  rycentric', 'kro
+00020210: 6727 2c20 2770 6368 6970 272c 2027 7370  g', 'pchip', 'sp
+00020220: 6c69 6e65 272c 2027 616b 696d 6127 3a20  line', 'akima': 
+00020230: 7573 6520 7468 6569 720a 2020 2020 2020  use their.      
+00020240: 2020 2020 2020 2020 7265 7370 6563 7469          respecti
+00020250: 7665 203a 7079 3a63 6c61 7373 3a60 7363  ve :py:class:`sc
+00020260: 6970 792e 696e 7465 7270 6f6c 6174 6560  ipy.interpolate`
+00020270: 2063 6c61 7373 6573 2e0a 0a20 2020 2020   classes...     
+00020280: 2020 2061 7373 756d 655f 736f 7274 6564     assume_sorted
+00020290: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+000202a0: 3a20 4661 6c73 650a 2020 2020 2020 2020  : False.        
+000202b0: 2020 2020 4966 2046 616c 7365 2c20 7661      If False, va
+000202c0: 6c75 6573 206f 6620 636f 6f72 6469 6e61  lues of coordina
+000202d0: 7465 7320 7468 6174 2061 7265 2069 6e74  tes that are int
+000202e0: 6572 706f 6c61 7465 6420 6f76 6572 2063  erpolated over c
+000202f0: 616e 2062 650a 2020 2020 2020 2020 2020  an be.          
+00020300: 2020 696e 2061 6e79 206f 7264 6572 2061    in any order a
+00020310: 6e64 2074 6865 7920 6172 6520 736f 7274  nd they are sort
+00020320: 6564 2066 6972 7374 2e20 4966 2054 7275  ed first. If Tru
+00020330: 652c 2069 6e74 6572 706f 6c61 7465 640a  e, interpolated.
+00020340: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
+00020350: 6469 6e61 7465 7320 6172 6520 6173 7375  dinates are assu
+00020360: 6d65 6420 746f 2062 6520 616e 2061 7272  med to be an arr
+00020370: 6179 206f 6620 6d6f 6e6f 746f 6e69 6361  ay of monotonica
+00020380: 6c6c 7920 696e 6372 6561 7369 6e67 0a20  lly increasing. 
+00020390: 2020 2020 2020 2020 2020 2076 616c 7565             value
+000203a0: 732e 0a20 2020 2020 2020 206b 7761 7267  s..        kwarg
+000203b0: 7320 3a20 6469 6374 2c20 6f70 7469 6f6e  s : dict, option
+000203c0: 616c 0a20 2020 2020 2020 2020 2020 2041  al.            A
+000203d0: 6464 6974 696f 6e61 6c20 6b65 7977 6f72  dditional keywor
+000203e0: 6420 7061 7373 6564 2074 6f20 7363 6970  d passed to scip
+000203f0: 7927 7320 696e 7465 7270 6f6c 6174 6f72  y's interpolator
+00020400: 2e0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
+00020410: 5f6e 6f6e 5f6e 756d 6572 6963 203a 207b  _non_numeric : {
+00020420: 226e 6561 7265 7374 222c 2022 7061 6422  "nearest", "pad"
+00020430: 2c20 2266 6669 6c6c 222c 2022 6261 636b  , "ffill", "back
+00020440: 6669 6c6c 222c 2022 6266 696c 6c22 7d2c  fill", "bfill"},
+00020450: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00020460: 2020 2020 2020 4d65 7468 6f64 2066 6f72        Method for
+00020470: 206e 6f6e 2d6e 756d 6572 6963 2074 7970   non-numeric typ
+00020480: 6573 2e20 5061 7373 6564 206f 6e20 746f  es. Passed on to
+00020490: 203a 7079 3a6d 6574 683a 6044 6174 6173   :py:meth:`Datas
+000204a0: 6574 2e72 6569 6e64 6578 602e 0a20 2020  et.reindex`..   
+000204b0: 2020 2020 2020 2020 2060 6022 6e65 6172           ``"near
+000204c0: 6573 7422 6060 2069 7320 7573 6564 2062  est"`` is used b
+000204d0: 7920 6465 6661 756c 742e 0a0a 2020 2020  y default...    
+000204e0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+000204f0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00020500: 2020 2020 696e 7465 7270 6f6c 6174 6564      interpolated
+00020510: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
+00020520: 2020 2020 2020 2041 6e6f 7468 6572 2064         Another d
+00020530: 6174 6173 6574 2062 7920 696e 7465 7270  ataset by interp
+00020540: 6f6c 6174 696e 6720 7468 6973 2064 6174  olating this dat
+00020550: 6173 6574 2773 2064 6174 6120 616c 6f6e  aset's data alon
+00020560: 6720 7468 650a 2020 2020 2020 2020 2020  g the.          
+00020570: 2020 636f 6f72 6469 6e61 7465 7320 6f66    coordinates of
+00020580: 2074 6865 206f 7468 6572 206f 626a 6563   the other objec
+00020590: 742e 0a0a 2020 2020 2020 2020 4e6f 7465  t...        Note
+000205a0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d0a  s.        -----.
+000205b0: 2020 2020 2020 2020 7363 6970 7920 6973          scipy is
+000205c0: 2072 6571 7569 7265 642e 0a20 2020 2020   required..     
+000205d0: 2020 2049 6620 7468 6520 6461 7461 7365     If the datase
+000205e0: 7420 6861 7320 6f62 6a65 6374 2d74 7970  t has object-typ
+000205f0: 6520 636f 6f72 6469 6e61 7465 732c 2072  e coordinates, r
+00020600: 6569 6e64 6578 2069 7320 7573 6564 2066  eindex is used f
+00020610: 6f72 2074 6865 7365 0a20 2020 2020 2020  or these.       
+00020620: 2063 6f6f 7264 696e 6174 6573 2069 6e73   coordinates ins
+00020630: 7465 6164 206f 6620 7468 6520 696e 7465  tead of the inte
+00020640: 7270 6f6c 6174 696f 6e2e 0a0a 2020 2020  rpolation...    
+00020650: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
+00020660: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+00020670: 2020 2020 2020 4461 7461 7365 742e 696e        Dataset.in
+00020680: 7465 7270 0a20 2020 2020 2020 2044 6174  terp.        Dat
+00020690: 6173 6574 2e72 6569 6e64 6578 5f6c 696b  aset.reindex_lik
+000206a0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+000206b0: 2020 2020 2020 6966 206b 7761 7267 7320        if kwargs 
+000206c0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000206d0: 2020 2020 206b 7761 7267 7320 3d20 7b7d       kwargs = {}
+000206e0: 0a0a 2020 2020 2020 2020 2320 7069 636b  ..        # pick
+000206f0: 206f 6e6c 7920 6469 6d65 6e73 696f 6e20   only dimension 
+00020700: 636f 6f72 6469 6e61 7465 7320 7769 7468  coordinates with
+00020710: 2061 2073 696e 676c 6520 696e 6465 780a   a single index.
+00020720: 2020 2020 2020 2020 636f 6f72 6473 203d          coords =
+00020730: 207b 7d0a 2020 2020 2020 2020 6f74 6865   {}.        othe
+00020740: 725f 696e 6465 7865 7320 3d20 6f74 6865  r_indexes = othe
+00020750: 722e 7869 6e64 6578 6573 0a20 2020 2020  r.xindexes.     
+00020760: 2020 2066 6f72 2064 696d 2069 6e20 7365     for dim in se
+00020770: 6c66 2e64 696d 733a 0a20 2020 2020 2020  lf.dims:.       
+00020780: 2020 2020 206f 7468 6572 5f64 696d 5f63       other_dim_c
+00020790: 6f6f 7264 7320 3d20 6f74 6865 725f 696e  oords = other_in
+000207a0: 6465 7865 732e 6765 745f 616c 6c5f 636f  dexes.get_all_co
+000207b0: 6f72 6473 2864 696d 2c20 6572 726f 7273  ords(dim, errors
+000207c0: 3d22 6967 6e6f 7265 2229 0a20 2020 2020  ="ignore").     
+000207d0: 2020 2020 2020 2069 6620 6c65 6e28 6f74         if len(ot
+000207e0: 6865 725f 6469 6d5f 636f 6f72 6473 2920  her_dim_coords) 
+000207f0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+00020800: 2020 2020 2020 636f 6f72 6473 5b64 696d        coords[dim
+00020810: 5d20 3d20 6f74 6865 725f 6469 6d5f 636f  ] = other_dim_co
+00020820: 6f72 6473 5b64 696d 5d0a 0a20 2020 2020  ords[dim]..     
+00020830: 2020 206e 756d 6572 6963 5f63 6f6f 7264     numeric_coord
+00020840: 733a 2064 6963 745b 4861 7368 6162 6c65  s: dict[Hashable
+00020850: 2c20 7064 2e49 6e64 6578 5d20 3d20 7b7d  , pd.Index] = {}
+00020860: 0a20 2020 2020 2020 206f 626a 6563 745f  .        object_
+00020870: 636f 6f72 6473 3a20 6469 6374 5b48 6173  coords: dict[Has
+00020880: 6861 626c 652c 2070 642e 496e 6465 785d  hable, pd.Index]
+00020890: 203d 207b 7d0a 2020 2020 2020 2020 666f   = {}.        fo
+000208a0: 7220 6b2c 2076 2069 6e20 636f 6f72 6473  r k, v in coords
+000208b0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+000208c0: 2020 2020 2020 6966 2076 2e64 7479 7065        if v.dtype
+000208d0: 2e6b 696e 6420 696e 2022 7569 6663 4d6d  .kind in "uifcMm
+000208e0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+000208f0: 2020 206e 756d 6572 6963 5f63 6f6f 7264     numeric_coord
+00020900: 735b 6b5d 203d 2076 0a20 2020 2020 2020  s[k] = v.       
+00020910: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00020920: 2020 2020 2020 2020 2020 206f 626a 6563             objec
+00020930: 745f 636f 6f72 6473 5b6b 5d20 3d20 760a  t_coords[k] = v.
+00020940: 0a20 2020 2020 2020 2064 7320 3d20 7365  .        ds = se
+00020950: 6c66 0a20 2020 2020 2020 2069 6620 6f62  lf.        if ob
+00020960: 6a65 6374 5f63 6f6f 7264 733a 0a20 2020  ject_coords:.   
+00020970: 2020 2020 2020 2020 2023 2057 6520 646f           # We do
+00020980: 206e 6f74 2073 7570 706f 7274 2069 6e74   not support int
+00020990: 6572 706f 6c61 7469 6f6e 2061 6c6f 6e67  erpolation along
+000209a0: 206f 626a 6563 7420 636f 6f72 6469 6e61   object coordina
+000209b0: 7465 2e0a 2020 2020 2020 2020 2020 2020  te..            
+000209c0: 2320 7265 696e 6465 7820 696e 7374 6561  # reindex instea
+000209d0: 642e 0a20 2020 2020 2020 2020 2020 2064  d..            d
+000209e0: 7320 3d20 7365 6c66 2e72 6569 6e64 6578  s = self.reindex
+000209f0: 286f 626a 6563 745f 636f 6f72 6473 290a  (object_coords).
+00020a00: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00020a10: 732e 696e 7465 7270 280a 2020 2020 2020  s.interp(.      
+00020a20: 2020 2020 2020 636f 6f72 6473 3d6e 756d        coords=num
+00020a30: 6572 6963 5f63 6f6f 7264 732c 0a20 2020  eric_coords,.   
+00020a40: 2020 2020 2020 2020 206d 6574 686f 643d           method=
+00020a50: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
+00020a60: 2020 2020 6173 7375 6d65 5f73 6f72 7465      assume_sorte
+00020a70: 643d 6173 7375 6d65 5f73 6f72 7465 642c  d=assume_sorted,
+00020a80: 0a20 2020 2020 2020 2020 2020 206b 7761  .            kwa
+00020a90: 7267 733d 6b77 6172 6773 2c0a 2020 2020  rgs=kwargs,.    
+00020aa0: 2020 2020 2020 2020 6d65 7468 6f64 5f6e          method_n
+00020ab0: 6f6e 5f6e 756d 6572 6963 3d6d 6574 686f  on_numeric=metho
+00020ac0: 645f 6e6f 6e5f 6e75 6d65 7269 632c 0a20  d_non_numeric,. 
+00020ad0: 2020 2020 2020 2029 0a0a 2020 2020 2320         )..    # 
+00020ae0: 4865 6c70 6572 206d 6574 686f 6473 2066  Helper methods f
+00020af0: 6f72 2072 656e 616d 6528 290a 2020 2020  or rename().    
+00020b00: 6465 6620 5f72 656e 616d 655f 7661 7273  def _rename_vars
+00020b10: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+00020b20: 6e61 6d65 5f64 6963 742c 2064 696d 735f  name_dict, dims_
+00020b30: 6469 6374 0a20 2020 2029 202d 3e20 7475  dict.    ) -> tu
+00020b40: 706c 655b 6469 6374 5b48 6173 6861 626c  ple[dict[Hashabl
+00020b50: 652c 2056 6172 6961 626c 655d 2c20 7365  e, Variable], se
+00020b60: 745b 4861 7368 6162 6c65 5d5d 3a0a 2020  t[Hashable]]:.  
+00020b70: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
+00020b80: 3d20 7b7d 0a20 2020 2020 2020 2063 6f6f  = {}.        coo
+00020b90: 7264 5f6e 616d 6573 203d 2073 6574 2829  rd_names = set()
+00020ba0: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
+00020bb0: 7620 696e 2073 656c 662e 7661 7269 6162  v in self.variab
+00020bc0: 6c65 732e 6974 656d 7328 293a 0a20 2020  les.items():.   
+00020bd0: 2020 2020 2020 2020 2076 6172 203d 2076           var = v
+00020be0: 2e63 6f70 7928 6465 6570 3d46 616c 7365  .copy(deep=False
+00020bf0: 290a 2020 2020 2020 2020 2020 2020 7661  ).            va
+00020c00: 722e 6469 6d73 203d 2074 7570 6c65 2864  r.dims = tuple(d
+00020c10: 696d 735f 6469 6374 2e67 6574 2864 696d  ims_dict.get(dim
+00020c20: 2c20 6469 6d29 2066 6f72 2064 696d 2069  , dim) for dim i
+00020c30: 6e20 762e 6469 6d73 290a 2020 2020 2020  n v.dims).      
+00020c40: 2020 2020 2020 6e61 6d65 203d 206e 616d        name = nam
 00020c50: 655f 6469 6374 2e67 6574 286b 2c20 6b29  e_dict.get(k, k)
-00020c60: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
-00020c70: 7365 6c66 2e64 696d 732e 6974 656d 7328  self.dims.items(
-00020c80: 297d 0a0a 2020 2020 6465 6620 5f72 656e  )}..    def _ren
-00020c90: 616d 655f 696e 6465 7865 7328 0a20 2020  ame_indexes(.   
-00020ca0: 2020 2020 2073 656c 662c 206e 616d 655f       self, name_
-00020cb0: 6469 6374 3a20 4d61 7070 696e 675b 416e  dict: Mapping[An
-00020cc0: 792c 2048 6173 6861 626c 655d 2c20 6469  y, Hashable], di
-00020cd0: 6d73 5f64 6963 743a 204d 6170 7069 6e67  ms_dict: Mapping
-00020ce0: 5b41 6e79 2c20 4861 7368 6162 6c65 5d0a  [Any, Hashable].
-00020cf0: 2020 2020 2920 2d3e 2074 7570 6c65 5b64      ) -> tuple[d
-00020d00: 6963 745b 4861 7368 6162 6c65 2c20 496e  ict[Hashable, In
-00020d10: 6465 785d 2c20 6469 6374 5b48 6173 6861  dex], dict[Hasha
-00020d20: 626c 652c 2056 6172 6961 626c 655d 5d3a  ble, Variable]]:
-00020d30: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00020d40: 7365 6c66 2e5f 696e 6465 7865 733a 0a20  self._indexes:. 
-00020d50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00020d60: 6e20 7b7d 2c20 7b7d 0a0a 2020 2020 2020  n {}, {}..      
-00020d70: 2020 696e 6465 7865 7320 3d20 7b7d 0a20    indexes = {}. 
-00020d80: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-00020d90: 203d 207b 7d0a 0a20 2020 2020 2020 2066   = {}..        f
-00020da0: 6f72 2069 6e64 6578 2c20 636f 6f72 645f  or index, coord_
-00020db0: 6e61 6d65 7320 696e 2073 656c 662e 7869  names in self.xi
-00020dc0: 6e64 6578 6573 2e67 726f 7570 5f62 795f  ndexes.group_by_
-00020dd0: 696e 6465 7828 293a 0a20 2020 2020 2020  index():.       
-00020de0: 2020 2020 206e 6577 5f69 6e64 6578 203d       new_index =
-00020df0: 2069 6e64 6578 2e72 656e 616d 6528 6e61   index.rename(na
-00020e00: 6d65 5f64 6963 742c 2064 696d 735f 6469  me_dict, dims_di
-00020e10: 6374 290a 2020 2020 2020 2020 2020 2020  ct).            
-00020e20: 6e65 775f 636f 6f72 645f 6e61 6d65 7320  new_coord_names 
-00020e30: 3d20 5b6e 616d 655f 6469 6374 2e67 6574  = [name_dict.get
-00020e40: 286b 2c20 6b29 2066 6f72 206b 2069 6e20  (k, k) for k in 
-00020e50: 636f 6f72 645f 6e61 6d65 735d 0a20 2020  coord_names].   
-00020e60: 2020 2020 2020 2020 2069 6e64 6578 6573           indexes
-00020e70: 2e75 7064 6174 6528 7b6b 3a20 6e65 775f  .update({k: new_
-00020e80: 696e 6465 7820 666f 7220 6b20 696e 206e  index for k in n
-00020e90: 6577 5f63 6f6f 7264 5f6e 616d 6573 7d29  ew_coord_names})
-00020ea0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00020eb0: 5f69 6e64 6578 5f76 6172 7320 3d20 6e65  _index_vars = ne
-00020ec0: 775f 696e 6465 782e 6372 6561 7465 5f76  w_index.create_v
-00020ed0: 6172 6961 626c 6573 280a 2020 2020 2020  ariables(.      
-00020ee0: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
-00020ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f00: 6e65 773a 2073 656c 662e 5f76 6172 6961  new: self._varia
-00020f10: 626c 6573 5b6f 6c64 5d0a 2020 2020 2020  bles[old].      
-00020f20: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00020f30: 7220 6f6c 642c 206e 6577 2069 6e20 7a69  r old, new in zi
-00020f40: 7028 636f 6f72 645f 6e61 6d65 732c 206e  p(coord_names, n
-00020f50: 6577 5f63 6f6f 7264 5f6e 616d 6573 290a  ew_coord_names).
-00020f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f70: 7d0a 2020 2020 2020 2020 2020 2020 290a  }.            ).
-00020f80: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-00020f90: 6162 6c65 732e 7570 6461 7465 286e 6577  ables.update(new
-00020fa0: 5f69 6e64 6578 5f76 6172 7329 0a0a 2020  _index_vars)..  
-00020fb0: 2020 2020 2020 7265 7475 726e 2069 6e64        return ind
-00020fc0: 6578 6573 2c20 7661 7269 6162 6c65 730a  exes, variables.
-00020fd0: 0a20 2020 2064 6566 205f 7265 6e61 6d65  .    def _rename
-00020fe0: 5f61 6c6c 280a 2020 2020 2020 2020 7365  _all(.        se
-00020ff0: 6c66 2c20 6e61 6d65 5f64 6963 743a 204d  lf, name_dict: M
-00021000: 6170 7069 6e67 5b41 6e79 2c20 4861 7368  apping[Any, Hash
-00021010: 6162 6c65 5d2c 2064 696d 735f 6469 6374  able], dims_dict
-00021020: 3a20 4d61 7070 696e 675b 416e 792c 2048  : Mapping[Any, H
-00021030: 6173 6861 626c 655d 0a20 2020 2029 202d  ashable].    ) -
-00021040: 3e20 7475 706c 655b 0a20 2020 2020 2020  > tuple[.       
-00021050: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
-00021060: 5661 7269 6162 6c65 5d2c 0a20 2020 2020  Variable],.     
-00021070: 2020 2073 6574 5b48 6173 6861 626c 655d     set[Hashable]
-00021080: 2c0a 2020 2020 2020 2020 6469 6374 5b48  ,.        dict[H
-00021090: 6173 6861 626c 652c 2069 6e74 5d2c 0a20  ashable, int],. 
-000210a0: 2020 2020 2020 2064 6963 745b 4861 7368         dict[Hash
-000210b0: 6162 6c65 2c20 496e 6465 785d 2c0a 2020  able, Index],.  
-000210c0: 2020 5d3a 0a20 2020 2020 2020 2076 6172    ]:.        var
-000210d0: 6961 626c 6573 2c20 636f 6f72 645f 6e61  iables, coord_na
-000210e0: 6d65 7320 3d20 7365 6c66 2e5f 7265 6e61  mes = self._rena
-000210f0: 6d65 5f76 6172 7328 6e61 6d65 5f64 6963  me_vars(name_dic
-00021100: 742c 2064 696d 735f 6469 6374 290a 2020  t, dims_dict).  
-00021110: 2020 2020 2020 6469 6d73 203d 2073 656c        dims = sel
-00021120: 662e 5f72 656e 616d 655f 6469 6d73 2864  f._rename_dims(d
-00021130: 696d 735f 6469 6374 290a 0a20 2020 2020  ims_dict)..     
-00021140: 2020 2069 6e64 6578 6573 2c20 696e 6465     indexes, inde
-00021150: 785f 7661 7273 203d 2073 656c 662e 5f72  x_vars = self._r
-00021160: 656e 616d 655f 696e 6465 7865 7328 6e61  ename_indexes(na
-00021170: 6d65 5f64 6963 742c 2064 696d 735f 6469  me_dict, dims_di
-00021180: 6374 290a 2020 2020 2020 2020 7661 7269  ct).        vari
-00021190: 6162 6c65 7320 3d20 7b6b 3a20 696e 6465  ables = {k: inde
-000211a0: 785f 7661 7273 2e67 6574 286b 2c20 7629  x_vars.get(k, v)
-000211b0: 2066 6f72 206b 2c20 7620 696e 2076 6172   for k, v in var
-000211c0: 6961 626c 6573 2e69 7465 6d73 2829 7d0a  iables.items()}.
-000211d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000211e0: 7661 7269 6162 6c65 732c 2063 6f6f 7264  variables, coord
-000211f0: 5f6e 616d 6573 2c20 6469 6d73 2c20 696e  _names, dims, in
-00021200: 6465 7865 730a 0a20 2020 2064 6566 205f  dexes..    def _
-00021210: 7265 6e61 6d65 280a 2020 2020 2020 2020  rename(.        
-00021220: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-00021230: 0a20 2020 2020 2020 206e 616d 655f 6469  .        name_di
-00021240: 6374 3a20 4d61 7070 696e 675b 416e 792c  ct: Mapping[Any,
-00021250: 2048 6173 6861 626c 655d 207c 204e 6f6e   Hashable] | Non
-00021260: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00021270: 2020 2a2a 6e61 6d65 733a 2048 6173 6861    **names: Hasha
-00021280: 626c 652c 0a20 2020 2029 202d 3e20 545f  ble,.    ) -> T_
-00021290: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-000212a0: 2022 2222 416c 736f 2075 7365 6420 696e   """Also used in
-000212b0: 7465 726e 616c 6c79 2062 7920 4461 7461  ternally by Data
-000212c0: 4172 7261 7920 736f 2074 6861 7420 7468  Array so that th
-000212d0: 6520 7761 726e 696e 6720 2869 6620 616e  e warning (if an
-000212e0: 7929 0a20 2020 2020 2020 2069 7320 7261  y).        is ra
-000212f0: 6973 6564 2061 7420 7468 6520 7269 6768  ised at the righ
-00021300: 7420 7374 6163 6b20 6c65 7665 6c2e 0a20  t stack level.. 
-00021310: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00021320: 2020 206e 616d 655f 6469 6374 203d 2065     name_dict = e
-00021330: 6974 6865 725f 6469 6374 5f6f 725f 6b77  ither_dict_or_kw
-00021340: 6172 6773 286e 616d 655f 6469 6374 2c20  args(name_dict, 
-00021350: 6e61 6d65 732c 2022 7265 6e61 6d65 2229  names, "rename")
-00021360: 0a20 2020 2020 2020 2066 6f72 206b 2069  .        for k i
-00021370: 6e20 6e61 6d65 5f64 6963 742e 6b65 7973  n name_dict.keys
-00021380: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00021390: 6966 206b 206e 6f74 2069 6e20 7365 6c66  if k not in self
-000213a0: 2061 6e64 206b 206e 6f74 2069 6e20 7365   and k not in se
-000213b0: 6c66 2e64 696d 733a 0a20 2020 2020 2020  lf.dims:.       
-000213c0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000213d0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-000213e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000213f0: 2263 616e 6e6f 7420 7265 6e61 6d65 207b  "cannot rename {
-00021400: 6b21 727d 2062 6563 6175 7365 2069 7420  k!r} because it 
-00021410: 6973 206e 6f74 2061 2022 0a20 2020 2020  is not a ".     
-00021420: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00021430: 7661 7269 6162 6c65 206f 7220 6469 6d65  variable or dime
-00021440: 6e73 696f 6e20 696e 2074 6869 7320 6461  nsion in this da
-00021450: 7461 7365 7422 0a20 2020 2020 2020 2020  taset".         
-00021460: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00021470: 2020 2020 2020 6372 6561 7465 5f64 696d        create_dim
-00021480: 5f63 6f6f 7264 203d 2046 616c 7365 0a20  _coord = False. 
-00021490: 2020 2020 2020 2020 2020 206e 6577 5f6b             new_k
-000214a0: 203d 206e 616d 655f 6469 6374 5b6b 5d0a   = name_dict[k].
-000214b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000214c0: 6b20 696e 2073 656c 662e 6469 6d73 2061  k in self.dims a
-000214d0: 6e64 206e 6577 5f6b 2069 6e20 7365 6c66  nd new_k in self
-000214e0: 2e5f 636f 6f72 645f 6e61 6d65 733a 0a20  ._coord_names:. 
-000214f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00021500: 6f6f 7264 5f64 696d 7320 3d20 7365 6c66  oord_dims = self
-00021510: 2e5f 7661 7269 6162 6c65 735b 6e61 6d65  ._variables[name
-00021520: 5f64 6963 745b 6b5d 5d2e 6469 6d73 0a20  _dict[k]].dims. 
-00021530: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00021540: 6620 636f 6f72 645f 6469 6d73 203d 3d20  f coord_dims == 
-00021550: 286b 2c29 3a0a 2020 2020 2020 2020 2020  (k,):.          
-00021560: 2020 2020 2020 2020 2020 6372 6561 7465            create
-00021570: 5f64 696d 5f63 6f6f 7264 203d 2054 7275  _dim_coord = Tru
-00021580: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-00021590: 6966 206b 2069 6e20 7365 6c66 2e5f 636f  if k in self._co
-000215a0: 6f72 645f 6e61 6d65 7320 616e 6420 6e65  ord_names and ne
-000215b0: 775f 6b20 696e 2073 656c 662e 6469 6d73  w_k in self.dims
-000215c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000215d0: 2020 636f 6f72 645f 6469 6d73 203d 2073    coord_dims = s
-000215e0: 656c 662e 5f76 6172 6961 626c 6573 5b6b  elf._variables[k
-000215f0: 5d2e 6469 6d73 0a20 2020 2020 2020 2020  ].dims.         
-00021600: 2020 2020 2020 2069 6620 636f 6f72 645f         if coord_
-00021610: 6469 6d73 203d 3d20 286e 6577 5f6b 2c29  dims == (new_k,)
-00021620: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00021630: 2020 2020 2020 6372 6561 7465 5f64 696d        create_dim
-00021640: 5f63 6f6f 7264 203d 2054 7275 650a 0a20  _coord = True.. 
-00021650: 2020 2020 2020 2020 2020 2069 6620 6372             if cr
-00021660: 6561 7465 5f64 696d 5f63 6f6f 7264 3a0a  eate_dim_coord:.
-00021670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021680: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
-00021690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216a0: 2020 2066 2272 656e 616d 6520 7b6b 2172     f"rename {k!r
-000216b0: 7d20 746f 207b 6e61 6d65 5f64 6963 745b  } to {name_dict[
-000216c0: 6b5d 2172 7d20 646f 6573 206e 6f74 2063  k]!r} does not c
-000216d0: 7265 6174 6520 616e 2069 6e64 6578 2022  reate an index "
-000216e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000216f0: 2020 2020 2022 616e 796d 6f72 652e 2054       "anymore. T
-00021700: 7279 2075 7369 6e67 2073 7761 705f 6469  ry using swap_di
-00021710: 6d73 2069 6e73 7465 6164 206f 7220 7573  ms instead or us
-00021720: 6520 7365 745f 696e 6465 7820 220a 2020  e set_index ".  
-00021730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021740: 2020 2261 6674 6572 2072 656e 616d 6520    "after rename 
-00021750: 746f 2063 7265 6174 6520 616e 2069 6e64  to create an ind
-00021760: 6578 6564 2063 6f6f 7264 696e 6174 652e  exed coordinate.
-00021770: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00021780: 2020 2020 2020 2055 7365 7257 6172 6e69         UserWarni
-00021790: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-000217a0: 2020 2020 2020 2020 7374 6163 6b6c 6576          stacklev
-000217b0: 656c 3d33 2c0a 2020 2020 2020 2020 2020  el=3,.          
-000217c0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-000217d0: 2076 6172 6961 626c 6573 2c20 636f 6f72   variables, coor
-000217e0: 645f 6e61 6d65 732c 2064 696d 732c 2069  d_names, dims, i
-000217f0: 6e64 6578 6573 203d 2073 656c 662e 5f72  ndexes = self._r
-00021800: 656e 616d 655f 616c 6c28 0a20 2020 2020  ename_all(.     
-00021810: 2020 2020 2020 206e 616d 655f 6469 6374         name_dict
-00021820: 3d6e 616d 655f 6469 6374 2c20 6469 6d73  =name_dict, dims
-00021830: 5f64 6963 743d 6e61 6d65 5f64 6963 740a  _dict=name_dict.
-00021840: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00021850: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
-00021860: 6570 6c61 6365 2876 6172 6961 626c 6573  eplace(variables
-00021870: 2c20 636f 6f72 645f 6e61 6d65 732c 2064  , coord_names, d
-00021880: 696d 733d 6469 6d73 2c20 696e 6465 7865  ims=dims, indexe
-00021890: 733d 696e 6465 7865 7329 0a0a 2020 2020  s=indexes)..    
-000218a0: 6465 6620 7265 6e61 6d65 280a 2020 2020  def rename(.    
-000218b0: 2020 2020 7365 6c66 3a20 545f 4461 7461      self: T_Data
-000218c0: 7365 742c 0a20 2020 2020 2020 206e 616d  set,.        nam
-000218d0: 655f 6469 6374 3a20 4d61 7070 696e 675b  e_dict: Mapping[
-000218e0: 416e 792c 2048 6173 6861 626c 655d 207c  Any, Hashable] |
-000218f0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00021900: 2020 2020 2020 2a2a 6e61 6d65 733a 2048        **names: H
-00021910: 6173 6861 626c 652c 0a20 2020 2029 202d  ashable,.    ) -
-00021920: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-00021930: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00021940: 6120 6e65 7720 6f62 6a65 6374 2077 6974  a new object wit
-00021950: 6820 7265 6e61 6d65 6420 7661 7269 6162  h renamed variab
-00021960: 6c65 732c 2063 6f6f 7264 696e 6174 6573  les, coordinates
-00021970: 2061 6e64 2064 696d 656e 7369 6f6e 732e   and dimensions.
-00021980: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00021990: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-000219a0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-000219b0: 6e61 6d65 5f64 6963 7420 3a20 6469 6374  name_dict : dict
-000219c0: 2d6c 696b 652c 206f 7074 696f 6e61 6c0a  -like, optional.
-000219d0: 2020 2020 2020 2020 2020 2020 4469 6374              Dict
-000219e0: 696f 6e61 7279 2077 686f 7365 206b 6579  ionary whose key
-000219f0: 7320 6172 6520 6375 7272 656e 7420 7661  s are current va
-00021a00: 7269 6162 6c65 2c20 636f 6f72 6469 6e61  riable, coordina
-00021a10: 7465 206f 7220 6469 6d65 6e73 696f 6e20  te or dimension 
-00021a20: 6e61 6d65 7320 616e 640a 2020 2020 2020  names and.      
-00021a30: 2020 2020 2020 7768 6f73 6520 7661 6c75        whose valu
-00021a40: 6573 2061 7265 2074 6865 2064 6573 6972  es are the desir
-00021a50: 6564 206e 616d 6573 2e0a 2020 2020 2020  ed names..      
-00021a60: 2020 2a2a 6e61 6d65 7320 3a20 6f70 7469    **names : opti
-00021a70: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00021a80: 204b 6579 776f 7264 2066 6f72 6d20 6f66   Keyword form of
-00021a90: 2060 606e 616d 655f 6469 6374 6060 2e0a   ``name_dict``..
-00021aa0: 2020 2020 2020 2020 2020 2020 4f6e 6520              One 
-00021ab0: 6f66 206e 616d 655f 6469 6374 206f 7220  of name_dict or 
-00021ac0: 6e61 6d65 7320 6d75 7374 2062 6520 7072  names must be pr
-00021ad0: 6f76 6964 6564 2e0a 0a20 2020 2020 2020  ovided...       
-00021ae0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-00021af0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-00021b00: 2072 656e 616d 6564 203a 2044 6174 6173   renamed : Datas
-00021b10: 6574 0a20 2020 2020 2020 2020 2020 2044  et.            D
-00021b20: 6174 6173 6574 2077 6974 6820 7265 6e61  ataset with rena
-00021b30: 6d65 6420 7661 7269 6162 6c65 732c 2063  med variables, c
-00021b40: 6f6f 7264 696e 6174 6573 2061 6e64 2064  oordinates and d
-00021b50: 696d 656e 7369 6f6e 732e 0a0a 2020 2020  imensions...    
-00021b60: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-00021b70: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-00021b80: 2020 2020 2020 4461 7461 7365 742e 7377        Dataset.sw
-00021b90: 6170 5f64 696d 730a 2020 2020 2020 2020  ap_dims.        
-00021ba0: 4461 7461 7365 742e 7265 6e61 6d65 5f76  Dataset.rename_v
-00021bb0: 6172 730a 2020 2020 2020 2020 4461 7461  ars.        Data
-00021bc0: 7365 742e 7265 6e61 6d65 5f64 696d 730a  set.rename_dims.
-00021bd0: 2020 2020 2020 2020 4461 7461 4172 7261          DataArra
-00021be0: 792e 7265 6e61 6d65 0a20 2020 2020 2020  y.rename.       
-00021bf0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-00021c00: 7572 6e20 7365 6c66 2e5f 7265 6e61 6d65  urn self._rename
-00021c10: 286e 616d 655f 6469 6374 3d6e 616d 655f  (name_dict=name_
-00021c20: 6469 6374 2c20 2a2a 6e61 6d65 7329 0a0a  dict, **names)..
-00021c30: 2020 2020 6465 6620 7265 6e61 6d65 5f64      def rename_d
-00021c40: 696d 7328 0a20 2020 2020 2020 2073 656c  ims(.        sel
-00021c50: 663a 2054 5f44 6174 6173 6574 2c0a 2020  f: T_Dataset,.  
-00021c60: 2020 2020 2020 6469 6d73 5f64 6963 743a        dims_dict:
-00021c70: 204d 6170 7069 6e67 5b41 6e79 2c20 4861   Mapping[Any, Ha
-00021c80: 7368 6162 6c65 5d20 7c20 4e6f 6e65 203d  shable] | None =
-00021c90: 204e 6f6e 652c 0a20 2020 2020 2020 202a   None,.        *
-00021ca0: 2a64 696d 733a 2048 6173 6861 626c 652c  *dims: Hashable,
-00021cb0: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
-00021cc0: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
-00021cd0: 5265 7475 726e 7320 6120 6e65 7720 6f62  Returns a new ob
-00021ce0: 6a65 6374 2077 6974 6820 7265 6e61 6d65  ject with rename
-00021cf0: 6420 6469 6d65 6e73 696f 6e73 206f 6e6c  d dimensions onl
-00021d00: 792e 0a0a 2020 2020 2020 2020 5061 7261  y...        Para
-00021d10: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-00021d20: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00021d30: 2020 6469 6d73 5f64 6963 7420 3a20 6469    dims_dict : di
-00021d40: 6374 2d6c 696b 652c 206f 7074 696f 6e61  ct-like, optiona
-00021d50: 6c0a 2020 2020 2020 2020 2020 2020 4469  l.            Di
-00021d60: 6374 696f 6e61 7279 2077 686f 7365 206b  ctionary whose k
-00021d70: 6579 7320 6172 6520 6375 7272 656e 7420  eys are current 
-00021d80: 6469 6d65 6e73 696f 6e20 6e61 6d65 7320  dimension names 
-00021d90: 616e 640a 2020 2020 2020 2020 2020 2020  and.            
-00021da0: 7768 6f73 6520 7661 6c75 6573 2061 7265  whose values are
-00021db0: 2074 6865 2064 6573 6972 6564 206e 616d   the desired nam
-00021dc0: 6573 2e20 5468 6520 6465 7369 7265 6420  es. The desired 
-00021dd0: 6e61 6d65 7320 6d75 7374 0a20 2020 2020  names must.     
-00021de0: 2020 2020 2020 206e 6f74 2062 6520 7468         not be th
-00021df0: 6520 6e61 6d65 206f 6620 616e 2065 7869  e name of an exi
-00021e00: 7374 696e 6720 6469 6d65 6e73 696f 6e20  sting dimension 
-00021e10: 6f72 2056 6172 6961 626c 6520 696e 2074  or Variable in t
-00021e20: 6865 2044 6174 6173 6574 2e0a 2020 2020  he Dataset..    
-00021e30: 2020 2020 2a2a 6469 6d73 203a 206f 7074      **dims : opt
-00021e40: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-00021e50: 2020 4b65 7977 6f72 6420 666f 726d 206f    Keyword form o
-00021e60: 6620 6060 6469 6d73 5f64 6963 7460 602e  f ``dims_dict``.
-00021e70: 0a20 2020 2020 2020 2020 2020 204f 6e65  .            One
-00021e80: 206f 6620 6469 6d73 5f64 6963 7420 6f72   of dims_dict or
-00021e90: 2064 696d 7320 6d75 7374 2062 6520 7072   dims must be pr
-00021ea0: 6f76 6964 6564 2e0a 0a20 2020 2020 2020  ovided...       
-00021eb0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-00021ec0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-00021ed0: 2072 656e 616d 6564 203a 2044 6174 6173   renamed : Datas
-00021ee0: 6574 0a20 2020 2020 2020 2020 2020 2044  et.            D
-00021ef0: 6174 6173 6574 2077 6974 6820 7265 6e61  ataset with rena
-00021f00: 6d65 6420 6469 6d65 6e73 696f 6e73 2e0a  med dimensions..
-00021f10: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-00021f20: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-00021f30: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
-00021f40: 6574 2e73 7761 705f 6469 6d73 0a20 2020  et.swap_dims.   
-00021f50: 2020 2020 2044 6174 6173 6574 2e72 656e       Dataset.ren
-00021f60: 616d 650a 2020 2020 2020 2020 4461 7461  ame.        Data
-00021f70: 7365 742e 7265 6e61 6d65 5f76 6172 730a  set.rename_vars.
-00021f80: 2020 2020 2020 2020 4461 7461 4172 7261          DataArra
-00021f90: 792e 7265 6e61 6d65 0a20 2020 2020 2020  y.rename.       
-00021fa0: 2022 2222 0a20 2020 2020 2020 2064 696d   """.        dim
-00021fb0: 735f 6469 6374 203d 2065 6974 6865 725f  s_dict = either_
-00021fc0: 6469 6374 5f6f 725f 6b77 6172 6773 2864  dict_or_kwargs(d
-00021fd0: 696d 735f 6469 6374 2c20 6469 6d73 2c20  ims_dict, dims, 
-00021fe0: 2272 656e 616d 655f 6469 6d73 2229 0a20  "rename_dims"). 
-00021ff0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-00022000: 696e 2064 696d 735f 6469 6374 2e69 7465  in dims_dict.ite
-00022010: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00022020: 2020 6966 206b 206e 6f74 2069 6e20 7365    if k not in se
-00022030: 6c66 2e64 696d 733a 0a20 2020 2020 2020  lf.dims:.       
-00022040: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00022050: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00022060: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00022070: 2263 616e 6e6f 7420 7265 6e61 6d65 207b  "cannot rename {
-00022080: 6b21 727d 2062 6563 6175 7365 2069 7420  k!r} because it 
-00022090: 6973 206e 6f74 2061 2022 0a20 2020 2020  is not a ".     
-000220a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000220b0: 6469 6d65 6e73 696f 6e20 696e 2074 6869  dimension in thi
-000220c0: 7320 6461 7461 7365 7422 0a20 2020 2020  s dataset".     
-000220d0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000220e0: 2020 2020 2020 2020 2069 6620 7620 696e           if v in
-000220f0: 2073 656c 662e 6469 6d73 206f 7220 7620   self.dims or v 
-00022100: 696e 2073 656c 663a 0a20 2020 2020 2020  in self:.       
-00022110: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00022120: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00022130: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00022140: 2243 616e 6e6f 7420 7265 6e61 6d65 207b  "Cannot rename {
-00022150: 6b7d 2074 6f20 7b76 7d20 6265 6361 7573  k} to {v} becaus
-00022160: 6520 7b76 7d20 616c 7265 6164 7920 6578  e {v} already ex
-00022170: 6973 7473 2e20 220a 2020 2020 2020 2020  ists. ".        
-00022180: 2020 2020 2020 2020 2020 2020 2254 7279              "Try
-00022190: 2075 7369 6e67 2073 7761 705f 6469 6d73   using swap_dims
-000221a0: 2069 6e73 7465 6164 2e22 0a20 2020 2020   instead.".     
-000221b0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000221c0: 2020 2020 2020 7661 7269 6162 6c65 732c        variables,
-000221d0: 2063 6f6f 7264 5f6e 616d 6573 2c20 7369   coord_names, si
-000221e0: 7a65 732c 2069 6e64 6578 6573 203d 2073  zes, indexes = s
-000221f0: 656c 662e 5f72 656e 616d 655f 616c 6c28  elf._rename_all(
-00022200: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
-00022210: 655f 6469 6374 3d7b 7d2c 2064 696d 735f  e_dict={}, dims_
-00022220: 6469 6374 3d64 696d 735f 6469 6374 0a20  dict=dims_dict. 
-00022230: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00022240: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-00022250: 706c 6163 6528 7661 7269 6162 6c65 732c  place(variables,
-00022260: 2063 6f6f 7264 5f6e 616d 6573 2c20 6469   coord_names, di
-00022270: 6d73 3d73 697a 6573 2c20 696e 6465 7865  ms=sizes, indexe
-00022280: 733d 696e 6465 7865 7329 0a0a 2020 2020  s=indexes)..    
-00022290: 6465 6620 7265 6e61 6d65 5f76 6172 7328  def rename_vars(
-000222a0: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
-000222b0: 5f44 6174 6173 6574 2c0a 2020 2020 2020  _Dataset,.      
-000222c0: 2020 6e61 6d65 5f64 6963 743a 204d 6170    name_dict: Map
-000222d0: 7069 6e67 5b41 6e79 2c20 4861 7368 6162  ping[Any, Hashab
-000222e0: 6c65 5d20 7c20 4e6f 6e65 203d 204e 6f6e  le] | None = Non
-000222f0: 652c 0a20 2020 2020 2020 202a 2a6e 616d  e,.        **nam
-00022300: 6573 3a20 4861 7368 6162 6c65 2c0a 2020  es: Hashable,.  
-00022310: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
-00022320: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00022330: 7572 6e73 2061 206e 6577 206f 626a 6563  urns a new objec
-00022340: 7420 7769 7468 2072 656e 616d 6564 2076  t with renamed v
-00022350: 6172 6961 626c 6573 2069 6e63 6c75 6469  ariables includi
-00022360: 6e67 2063 6f6f 7264 696e 6174 6573 0a0a  ng coordinates..
-00022370: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00022380: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00022390: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6e61  -----.        na
-000223a0: 6d65 5f64 6963 7420 3a20 6469 6374 2d6c  me_dict : dict-l
-000223b0: 696b 652c 206f 7074 696f 6e61 6c0a 2020  ike, optional.  
-000223c0: 2020 2020 2020 2020 2020 4469 6374 696f            Dictio
-000223d0: 6e61 7279 2077 686f 7365 206b 6579 7320  nary whose keys 
-000223e0: 6172 6520 6375 7272 656e 7420 7661 7269  are current vari
-000223f0: 6162 6c65 206f 7220 636f 6f72 6469 6e61  able or coordina
-00022400: 7465 206e 616d 6573 2061 6e64 0a20 2020  te names and.   
-00022410: 2020 2020 2020 2020 2077 686f 7365 2076           whose v
-00022420: 616c 7565 7320 6172 6520 7468 6520 6465  alues are the de
-00022430: 7369 7265 6420 6e61 6d65 732e 0a20 2020  sired names..   
-00022440: 2020 2020 202a 2a6e 616d 6573 203a 206f       **names : o
-00022450: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00022460: 2020 2020 4b65 7977 6f72 6420 666f 726d      Keyword form
-00022470: 206f 6620 6060 6e61 6d65 5f64 6963 7460   of ``name_dict`
-00022480: 602e 0a20 2020 2020 2020 2020 2020 204f  `..            O
-00022490: 6e65 206f 6620 6e61 6d65 5f64 6963 7420  ne of name_dict 
-000224a0: 6f72 206e 616d 6573 206d 7573 7420 6265  or names must be
-000224b0: 2070 726f 7669 6465 642e 0a0a 2020 2020   provided...    
-000224c0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-000224d0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-000224e0: 2020 2020 7265 6e61 6d65 6420 3a20 4461      renamed : Da
-000224f0: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
-00022500: 2020 4461 7461 7365 7420 7769 7468 2072    Dataset with r
-00022510: 656e 616d 6564 2076 6172 6961 626c 6573  enamed variables
-00022520: 2069 6e63 6c75 6469 6e67 2063 6f6f 7264   including coord
-00022530: 696e 6174 6573 0a0a 2020 2020 2020 2020  inates..        
-00022540: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-00022550: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00022560: 2020 4461 7461 7365 742e 7377 6170 5f64    Dataset.swap_d
-00022570: 696d 730a 2020 2020 2020 2020 4461 7461  ims.        Data
-00022580: 7365 742e 7265 6e61 6d65 0a20 2020 2020  set.rename.     
-00022590: 2020 2044 6174 6173 6574 2e72 656e 616d     Dataset.renam
-000225a0: 655f 6469 6d73 0a20 2020 2020 2020 2044  e_dims.        D
-000225b0: 6174 6141 7272 6179 2e72 656e 616d 650a  ataArray.rename.
-000225c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000225d0: 2020 2020 6e61 6d65 5f64 6963 7420 3d20      name_dict = 
-000225e0: 6569 7468 6572 5f64 6963 745f 6f72 5f6b  either_dict_or_k
-000225f0: 7761 7267 7328 6e61 6d65 5f64 6963 742c  wargs(name_dict,
-00022600: 206e 616d 6573 2c20 2272 656e 616d 655f   names, "rename_
-00022610: 7661 7273 2229 0a20 2020 2020 2020 2066  vars").        f
-00022620: 6f72 206b 2069 6e20 6e61 6d65 5f64 6963  or k in name_dic
-00022630: 743a 0a20 2020 2020 2020 2020 2020 2069  t:.            i
-00022640: 6620 6b20 6e6f 7420 696e 2073 656c 663a  f k not in self:
-00022650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022660: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00022670: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00022680: 2020 2020 2020 2066 2263 616e 6e6f 7420         f"cannot 
-00022690: 7265 6e61 6d65 207b 6b21 727d 2062 6563  rename {k!r} bec
-000226a0: 6175 7365 2069 7420 6973 206e 6f74 2061  ause it is not a
-000226b0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-000226c0: 2020 2020 2020 2022 7661 7269 6162 6c65         "variable
-000226d0: 206f 7220 636f 6f72 6469 6e61 7465 2069   or coordinate i
-000226e0: 6e20 7468 6973 2064 6174 6173 6574 220a  n this dataset".
-000226f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022700: 290a 2020 2020 2020 2020 7661 7269 6162  ).        variab
-00022710: 6c65 732c 2063 6f6f 7264 5f6e 616d 6573  les, coord_names
-00022720: 2c20 6469 6d73 2c20 696e 6465 7865 7320  , dims, indexes 
-00022730: 3d20 7365 6c66 2e5f 7265 6e61 6d65 5f61  = self._rename_a
-00022740: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
-00022750: 6e61 6d65 5f64 6963 743d 6e61 6d65 5f64  name_dict=name_d
-00022760: 6963 742c 2064 696d 735f 6469 6374 3d7b  ict, dims_dict={
-00022770: 7d0a 2020 2020 2020 2020 290a 2020 2020  }.        ).    
-00022780: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00022790: 5f72 6570 6c61 6365 2876 6172 6961 626c  _replace(variabl
-000227a0: 6573 2c20 636f 6f72 645f 6e61 6d65 732c  es, coord_names,
-000227b0: 2064 696d 733d 6469 6d73 2c20 696e 6465   dims=dims, inde
-000227c0: 7865 733d 696e 6465 7865 7329 0a0a 2020  xes=indexes)..  
-000227d0: 2020 6465 6620 7377 6170 5f64 696d 7328    def swap_dims(
-000227e0: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
-000227f0: 5f44 6174 6173 6574 2c20 6469 6d73 5f64  _Dataset, dims_d
-00022800: 6963 743a 204d 6170 7069 6e67 5b41 6e79  ict: Mapping[Any
-00022810: 2c20 4861 7368 6162 6c65 5d20 7c20 4e6f  , Hashable] | No
-00022820: 6e65 203d 204e 6f6e 652c 202a 2a64 696d  ne = None, **dim
-00022830: 735f 6b77 6172 6773 0a20 2020 2029 202d  s_kwargs.    ) -
-00022840: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-00022850: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00022860: 6120 6e65 7720 6f62 6a65 6374 2077 6974  a new object wit
-00022870: 6820 7377 6170 7065 6420 6469 6d65 6e73  h swapped dimens
-00022880: 696f 6e73 2e0a 0a20 2020 2020 2020 2050  ions...        P
-00022890: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-000228a0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-000228b0: 2020 2020 2064 696d 735f 6469 6374 203a       dims_dict :
-000228c0: 2064 6963 742d 6c69 6b65 0a20 2020 2020   dict-like.     
-000228d0: 2020 2020 2020 2044 6963 7469 6f6e 6172         Dictionar
-000228e0: 7920 7768 6f73 6520 6b65 7973 2061 7265  y whose keys are
-000228f0: 2063 7572 7265 6e74 2064 696d 656e 7369   current dimensi
-00022900: 6f6e 206e 616d 6573 2061 6e64 2077 686f  on names and who
-00022910: 7365 2076 616c 7565 730a 2020 2020 2020  se values.      
-00022920: 2020 2020 2020 6172 6520 6e65 7720 6e61        are new na
-00022930: 6d65 732e 0a20 2020 2020 2020 202a 2a64  mes..        **d
-00022940: 696d 735f 6b77 6172 6773 203a 207b 6578  ims_kwargs : {ex
-00022950: 6973 7469 6e67 5f64 696d 3a20 6e65 775f  isting_dim: new_
-00022960: 6469 6d2c 202e 2e2e 7d2c 206f 7074 696f  dim, ...}, optio
-00022970: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00022980: 5468 6520 6b65 7977 6f72 6420 6172 6775  The keyword argu
-00022990: 6d65 6e74 7320 666f 726d 206f 6620 6060  ments form of ``
-000229a0: 6469 6d73 5f64 6963 7460 602e 0a20 2020  dims_dict``..   
-000229b0: 2020 2020 2020 2020 204f 6e65 206f 6620           One of 
-000229c0: 6469 6d73 5f64 6963 7420 6f72 2064 696d  dims_dict or dim
-000229d0: 735f 6b77 6172 6773 206d 7573 7420 6265  s_kwargs must be
-000229e0: 2070 726f 7669 6465 642e 0a0a 2020 2020   provided...    
-000229f0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-00022a00: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-00022a10: 2020 2020 7377 6170 7065 6420 3a20 4461      swapped : Da
-00022a20: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
-00022a30: 2020 4461 7461 7365 7420 7769 7468 2073    Dataset with s
-00022a40: 7761 7070 6564 2064 696d 656e 7369 6f6e  wapped dimension
-00022a50: 732e 0a0a 2020 2020 2020 2020 4578 616d  s...        Exam
-00022a60: 706c 6573 0a20 2020 2020 2020 202d 2d2d  ples.        ---
-00022a70: 2d2d 2d2d 2d0a 2020 2020 2020 2020 3e3e  -----.        >>
-00022a80: 3e20 6473 203d 2078 722e 4461 7461 7365  > ds = xr.Datase
-00022a90: 7428 0a20 2020 2020 2020 202e 2e2e 2020  t(.        ...  
-00022aa0: 2020 2064 6174 615f 7661 7273 3d7b 2261     data_vars={"a
-00022ab0: 223a 2028 2278 222c 205b 352c 2037 5d29  ": ("x", [5, 7])
-00022ac0: 2c20 2262 223a 2028 2278 222c 205b 302e  , "b": ("x", [0.
-00022ad0: 312c 2032 2e34 5d29 7d2c 0a20 2020 2020  1, 2.4])},.     
-00022ae0: 2020 202e 2e2e 2020 2020 2063 6f6f 7264     ...     coord
-00022af0: 733d 7b22 7822 3a20 5b22 6122 2c20 2262  s={"x": ["a", "b
-00022b00: 225d 2c20 2279 223a 2028 2278 222c 205b  "], "y": ("x", [
-00022b10: 302c 2031 5d29 7d2c 0a20 2020 2020 2020  0, 1])},.       
-00022b20: 202e 2e2e 2029 0a20 2020 2020 2020 203e   ... ).        >
-00022b30: 3e3e 2064 730a 2020 2020 2020 2020 3c78  >> ds.        <x
-00022b40: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
-00022b50: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
-00022b60: 733a 2020 2878 3a20 3229 0a20 2020 2020  s:  (x: 2).     
-00022b70: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-00022b80: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
-00022b90: 2020 2020 2028 7829 203c 5531 2027 6127       (x) <U1 'a'
-00022ba0: 2027 6227 0a20 2020 2020 2020 2020 2020   'b'.           
-00022bb0: 2079 2020 2020 2020 2020 2878 2920 696e   y        (x) in
-00022bc0: 7436 3420 3020 310a 2020 2020 2020 2020  t64 0 1.        
-00022bd0: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
-00022be0: 2020 2020 2020 2020 2020 2020 6120 2020              a   
-00022bf0: 2020 2020 2028 7829 2069 6e74 3634 2035       (x) int64 5
-00022c00: 2037 0a20 2020 2020 2020 2020 2020 2062   7.            b
-00022c10: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
-00022c20: 7436 3420 302e 3120 322e 340a 0a20 2020  t64 0.1 2.4..   
-00022c30: 2020 2020 203e 3e3e 2064 732e 7377 6170       >>> ds.swap
-00022c40: 5f64 696d 7328 7b22 7822 3a20 2279 227d  _dims({"x": "y"}
-00022c50: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
-00022c60: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-00022c70: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-00022c80: 2879 3a20 3229 0a20 2020 2020 2020 2043  (y: 2).        C
-00022c90: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-00022ca0: 2020 2020 2020 2020 7820 2020 2020 2020          x       
-00022cb0: 2028 7929 203c 5531 2027 6127 2027 6227   (y) <U1 'a' 'b'
-00022cc0: 0a20 2020 2020 2020 2020 202a 2079 2020  .          * y  
-00022cd0: 2020 2020 2020 2879 2920 696e 7436 3420        (y) int64 
-00022ce0: 3020 310a 2020 2020 2020 2020 4461 7461  0 1.        Data
-00022cf0: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-00022d00: 2020 2020 2020 2020 6120 2020 2020 2020          a       
-00022d10: 2028 7929 2069 6e74 3634 2035 2037 0a20   (y) int64 5 7. 
-00022d20: 2020 2020 2020 2020 2020 2062 2020 2020             b    
-00022d30: 2020 2020 2879 2920 666c 6f61 7436 3420      (y) float64 
-00022d40: 302e 3120 322e 340a 0a20 2020 2020 2020  0.1 2.4..       
-00022d50: 203e 3e3e 2064 732e 7377 6170 5f64 696d   >>> ds.swap_dim
-00022d60: 7328 7b22 7822 3a20 227a 227d 290a 2020  s({"x": "z"}).  
-00022d70: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-00022d80: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-00022d90: 696d 656e 7369 6f6e 733a 2020 287a 3a20  imensions:  (z: 
-00022da0: 3229 0a20 2020 2020 2020 2043 6f6f 7264  2).        Coord
-00022db0: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
-00022dc0: 2020 2020 7820 2020 2020 2020 2028 7a29      x        (z)
-00022dd0: 203c 5531 2027 6127 2027 6227 0a20 2020   <U1 'a' 'b'.   
-00022de0: 2020 2020 2020 2020 2079 2020 2020 2020           y      
-00022df0: 2020 287a 2920 696e 7436 3420 3020 310a    (z) int64 0 1.
-00022e00: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-00022e10: 6e73 2077 6974 686f 7574 2063 6f6f 7264  ns without coord
-00022e20: 696e 6174 6573 3a20 7a0a 2020 2020 2020  inates: z.      
-00022e30: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
-00022e40: 3a0a 2020 2020 2020 2020 2020 2020 6120  :.            a 
-00022e50: 2020 2020 2020 2028 7a29 2069 6e74 3634         (z) int64
-00022e60: 2035 2037 0a20 2020 2020 2020 2020 2020   5 7.           
-00022e70: 2062 2020 2020 2020 2020 287a 2920 666c   b        (z) fl
-00022e80: 6f61 7436 3420 302e 3120 322e 340a 0a20  oat64 0.1 2.4.. 
-00022e90: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00022ea0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00022eb0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
-00022ec0: 2e72 656e 616d 650a 2020 2020 2020 2020  .rename.        
-00022ed0: 4461 7461 4172 7261 792e 7377 6170 5f64  DataArray.swap_d
-00022ee0: 696d 730a 2020 2020 2020 2020 2222 220a  ims.        """.
-00022ef0: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
-00022f00: 6465 7072 6563 6174 6520 7468 6973 206d  deprecate this m
-00022f10: 6574 686f 6420 696e 2066 6176 6f72 206f  ethod in favor o
-00022f20: 6620 6120 286c 6573 7320 636f 6e66 7573  f a (less confus
-00022f30: 696e 6729 0a20 2020 2020 2020 2023 2072  ing).        # r
-00022f40: 656e 616d 655f 6469 6d73 2829 206d 6574  ename_dims() met
-00022f50: 686f 6420 7468 6174 206f 6e6c 7920 7265  hod that only re
-00022f60: 6e61 6d65 7320 6469 6d65 6e73 696f 6e73  names dimensions
-00022f70: 2e0a 0a20 2020 2020 2020 2064 696d 735f  ...        dims_
-00022f80: 6469 6374 203d 2065 6974 6865 725f 6469  dict = either_di
-00022f90: 6374 5f6f 725f 6b77 6172 6773 2864 696d  ct_or_kwargs(dim
-00022fa0: 735f 6469 6374 2c20 6469 6d73 5f6b 7761  s_dict, dims_kwa
-00022fb0: 7267 732c 2022 7377 6170 5f64 696d 7322  rgs, "swap_dims"
-00022fc0: 290a 2020 2020 2020 2020 666f 7220 6b2c  ).        for k,
-00022fd0: 2076 2069 6e20 6469 6d73 5f64 6963 742e   v in dims_dict.
-00022fe0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-00022ff0: 2020 2020 2069 6620 6b20 6e6f 7420 696e       if k not in
-00023000: 2073 656c 662e 6469 6d73 3a0a 2020 2020   self.dims:.    
-00023010: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00023020: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-00023030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023040: 2020 6622 6361 6e6e 6f74 2073 7761 7020    f"cannot swap 
-00023050: 6672 6f6d 2064 696d 656e 7369 6f6e 207b  from dimension {
-00023060: 6b21 727d 2062 6563 6175 7365 2069 7420  k!r} because it 
-00023070: 6973 2022 0a20 2020 2020 2020 2020 2020  is ".           
-00023080: 2020 2020 2020 2020 2022 6e6f 7420 616e           "not an
-00023090: 2065 7869 7374 696e 6720 6469 6d65 6e73   existing dimens
-000230a0: 696f 6e22 0a20 2020 2020 2020 2020 2020  ion".           
-000230b0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000230c0: 2020 2069 6620 7620 696e 2073 656c 662e     if v in self.
-000230d0: 7661 7269 6162 6c65 7320 616e 6420 7365  variables and se
-000230e0: 6c66 2e76 6172 6961 626c 6573 5b76 5d2e  lf.variables[v].
-000230f0: 6469 6d73 2021 3d20 286b 2c29 3a0a 2020  dims != (k,):.  
-00023100: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00023110: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-00023120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023130: 2020 2020 6622 7265 706c 6163 656d 656e      f"replacemen
-00023140: 7420 6469 6d65 6e73 696f 6e20 7b76 2172  t dimension {v!r
-00023150: 7d20 6973 206e 6f74 2061 2031 4420 220a  } is not a 1D ".
-00023160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023170: 2020 2020 6622 7661 7269 6162 6c65 2061      f"variable a
-00023180: 6c6f 6e67 2074 6865 206f 6c64 2064 696d  long the old dim
-00023190: 656e 7369 6f6e 207b 6b21 727d 220a 2020  ension {k!r}".  
-000231a0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-000231b0: 0a20 2020 2020 2020 2072 6573 756c 745f  .        result_
-000231c0: 6469 6d73 203d 207b 6469 6d73 5f64 6963  dims = {dims_dic
-000231d0: 742e 6765 7428 6469 6d2c 2064 696d 2920  t.get(dim, dim) 
-000231e0: 666f 7220 6469 6d20 696e 2073 656c 662e  for dim in self.
-000231f0: 6469 6d73 7d0a 0a20 2020 2020 2020 2063  dims}..        c
-00023200: 6f6f 7264 5f6e 616d 6573 203d 2073 656c  oord_names = sel
-00023210: 662e 5f63 6f6f 7264 5f6e 616d 6573 2e63  f._coord_names.c
-00023220: 6f70 7928 290a 2020 2020 2020 2020 636f  opy().        co
-00023230: 6f72 645f 6e61 6d65 732e 7570 6461 7465  ord_names.update
-00023240: 287b 6469 6d20 666f 7220 6469 6d20 696e  ({dim for dim in
-00023250: 2064 696d 735f 6469 6374 2e76 616c 7565   dims_dict.value
-00023260: 7328 2920 6966 2064 696d 2069 6e20 7365  s() if dim in se
-00023270: 6c66 2e76 6172 6961 626c 6573 7d29 0a0a  lf.variables})..
-00023280: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-00023290: 733a 2064 6963 745b 4861 7368 6162 6c65  s: dict[Hashable
-000232a0: 2c20 5661 7269 6162 6c65 5d20 3d20 7b7d  , Variable] = {}
-000232b0: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
-000232c0: 3a20 6469 6374 5b48 6173 6861 626c 652c  : dict[Hashable,
-000232d0: 2049 6e64 6578 5d20 3d20 7b7d 0a20 2020   Index] = {}.   
-000232e0: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
-000232f0: 2073 656c 662e 7661 7269 6162 6c65 732e   self.variables.
-00023300: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-00023310: 2020 2020 2064 696d 7320 3d20 7475 706c       dims = tupl
-00023320: 6528 6469 6d73 5f64 6963 742e 6765 7428  e(dims_dict.get(
-00023330: 6469 6d2c 2064 696d 2920 666f 7220 6469  dim, dim) for di
-00023340: 6d20 696e 2076 2e64 696d 7329 0a20 2020  m in v.dims).   
-00023350: 2020 2020 2020 2020 2076 6172 3a20 5661           var: Va
-00023360: 7269 6162 6c65 0a20 2020 2020 2020 2020  riable.         
-00023370: 2020 2069 6620 6b20 696e 2072 6573 756c     if k in resul
-00023380: 745f 6469 6d73 3a0a 2020 2020 2020 2020  t_dims:.        
-00023390: 2020 2020 2020 2020 7661 7220 3d20 762e          var = v.
-000233a0: 746f 5f69 6e64 6578 5f76 6172 6961 626c  to_index_variabl
-000233b0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-000233c0: 2020 2020 7661 722e 6469 6d73 203d 2064      var.dims = d
-000233d0: 696d 730a 2020 2020 2020 2020 2020 2020  ims.            
-000233e0: 2020 2020 6966 206b 2069 6e20 7365 6c66      if k in self
-000233f0: 2e5f 696e 6465 7865 733a 0a20 2020 2020  ._indexes:.     
-00023400: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023410: 6e64 6578 6573 5b6b 5d20 3d20 7365 6c66  ndexes[k] = self
-00023420: 2e5f 696e 6465 7865 735b 6b5d 0a20 2020  ._indexes[k].   
-00023430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023440: 2076 6172 6961 626c 6573 5b6b 5d20 3d20   variables[k] = 
-00023450: 7661 720a 2020 2020 2020 2020 2020 2020  var.            
-00023460: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00023470: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00023480: 6465 782c 2069 6e64 6578 5f76 6172 7320  dex, index_vars 
-00023490: 3d20 6372 6561 7465 5f64 6566 6175 6c74  = create_default
-000234a0: 5f69 6e64 6578 5f69 6d70 6c69 6369 7428  _index_implicit(
-000234b0: 7661 7229 0a20 2020 2020 2020 2020 2020  var).           
-000234c0: 2020 2020 2020 2020 2069 6e64 6578 6573           indexes
-000234d0: 2e75 7064 6174 6528 7b6e 616d 653a 2069  .update({name: i
-000234e0: 6e64 6578 2066 6f72 206e 616d 6520 696e  ndex for name in
-000234f0: 2069 6e64 6578 5f76 6172 737d 290a 2020   index_vars}).  
-00023500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023510: 2020 7661 7269 6162 6c65 732e 7570 6461    variables.upda
-00023520: 7465 2869 6e64 6578 5f76 6172 7329 0a20  te(index_vars). 
-00023530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023540: 2020 2063 6f6f 7264 5f6e 616d 6573 2e75     coord_names.u
-00023550: 7064 6174 6528 696e 6465 785f 7661 7273  pdate(index_vars
-00023560: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00023570: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00023580: 2020 2020 7661 7220 3d20 762e 746f 5f62      var = v.to_b
-00023590: 6173 655f 7661 7269 6162 6c65 2829 0a20  ase_variable(). 
-000235a0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000235b0: 6172 2e64 696d 7320 3d20 6469 6d73 0a20  ar.dims = dims. 
-000235c0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000235d0: 6172 6961 626c 6573 5b6b 5d20 3d20 7661  ariables[k] = va
-000235e0: 720a 0a20 2020 2020 2020 2072 6574 7572  r..        retur
-000235f0: 6e20 7365 6c66 2e5f 7265 706c 6163 655f  n self._replace_
-00023600: 7769 7468 5f6e 6577 5f64 696d 7328 7661  with_new_dims(va
-00023610: 7269 6162 6c65 732c 2063 6f6f 7264 5f6e  riables, coord_n
-00023620: 616d 6573 2c20 696e 6465 7865 733d 696e  ames, indexes=in
-00023630: 6465 7865 7329 0a0a 2020 2020 2320 6368  dexes)..    # ch
-00023640: 616e 6765 2074 7970 6520 6f66 2073 656c  ange type of sel
-00023650: 6620 616e 6420 7265 7475 726e 2074 6f20  f and return to 
-00023660: 545f 4461 7461 7365 7420 6f6e 6365 0a20  T_Dataset once. 
-00023670: 2020 2023 2068 7474 7073 3a2f 2f67 6974     # https://git
-00023680: 6875 622e 636f 6d2f 7079 7468 6f6e 2f6d  hub.com/python/m
-00023690: 7970 792f 6973 7375 6573 2f31 3238 3436  ypy/issues/12846
-000236a0: 2069 7320 7265 736f 6c76 6564 0a20 2020   is resolved.   
-000236b0: 2064 6566 2065 7870 616e 645f 6469 6d73   def expand_dims
-000236c0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-000236d0: 2020 2020 2020 2020 6469 6d3a 204e 6f6e          dim: Non
-000236e0: 6520 7c20 4861 7368 6162 6c65 207c 2053  e | Hashable | S
-000236f0: 6571 7565 6e63 655b 4861 7368 6162 6c65  equence[Hashable
-00023700: 5d20 7c20 4d61 7070 696e 675b 416e 792c  ] | Mapping[Any,
-00023710: 2041 6e79 5d20 3d20 4e6f 6e65 2c0a 2020   Any] = None,.  
-00023720: 2020 2020 2020 6178 6973 3a20 4e6f 6e65        axis: None
-00023730: 207c 2069 6e74 207c 2053 6571 7565 6e63   | int | Sequenc
-00023740: 655b 696e 745d 203d 204e 6f6e 652c 0a20  e[int] = None,. 
-00023750: 2020 2020 2020 202a 2a64 696d 5f6b 7761         **dim_kwa
-00023760: 7267 733a 2041 6e79 2c0a 2020 2020 2920  rgs: Any,.    ) 
-00023770: 2d3e 2044 6174 6173 6574 3a0a 2020 2020  -> Dataset:.    
-00023780: 2020 2020 2222 2252 6574 7572 6e20 6120      """Return a 
-00023790: 6e65 7720 6f62 6a65 6374 2077 6974 6820  new object with 
-000237a0: 616e 2061 6464 6974 696f 6e61 6c20 6178  an additional ax
-000237b0: 6973 2028 6f72 2061 7865 7329 2069 6e73  is (or axes) ins
-000237c0: 6572 7465 6420 6174 0a20 2020 2020 2020  erted at.       
-000237d0: 2074 6865 2063 6f72 7265 7370 6f6e 6469   the correspondi
-000237e0: 6e67 2070 6f73 6974 696f 6e20 696e 2074  ng position in t
-000237f0: 6865 2061 7272 6179 2073 6861 7065 2e20  he array shape. 
-00023800: 2054 6865 206e 6577 206f 626a 6563 7420   The new object 
-00023810: 6973 2061 0a20 2020 2020 2020 2076 6965  is a.        vie
-00023820: 7720 696e 746f 2074 6865 2075 6e64 6572  w into the under
-00023830: 6c79 696e 6720 6172 7261 792c 206e 6f74  lying array, not
-00023840: 2061 2063 6f70 792e 0a0a 2020 2020 2020   a copy...      
-00023850: 2020 4966 2064 696d 2069 7320 616c 7265    If dim is alre
-00023860: 6164 7920 6120 7363 616c 6172 2063 6f6f  ady a scalar coo
-00023870: 7264 696e 6174 652c 2069 7420 7769 6c6c  rdinate, it will
-00023880: 2062 6520 7072 6f6d 6f74 6564 2074 6f20   be promoted to 
-00023890: 6120 3144 0a20 2020 2020 2020 2063 6f6f  a 1D.        coo
-000238a0: 7264 696e 6174 6520 636f 6e73 6973 7469  rdinate consisti
-000238b0: 6e67 206f 6620 6120 7369 6e67 6c65 2076  ng of a single v
-000238c0: 616c 7565 2e0a 0a20 2020 2020 2020 2050  alue...        P
-000238d0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-000238e0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-000238f0: 2020 2020 2064 696d 203a 2068 6173 6861       dim : hasha
-00023900: 626c 652c 2073 6571 7565 6e63 6520 6f66  ble, sequence of
-00023910: 2068 6173 6861 626c 652c 206d 6170 7069   hashable, mappi
-00023920: 6e67 2c20 6f72 204e 6f6e 650a 2020 2020  ng, or None.    
-00023930: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-00023940: 6e73 2074 6f20 696e 636c 7564 6520 6f6e  ns to include on
-00023950: 2074 6865 206e 6577 2076 6172 6961 626c   the new variabl
-00023960: 652e 2049 6620 7072 6f76 6964 6564 2061  e. If provided a
-00023970: 7320 6861 7368 6162 6c65 0a20 2020 2020  s hashable.     
-00023980: 2020 2020 2020 206f 7220 7365 7175 656e         or sequen
-00023990: 6365 206f 6620 6861 7368 6162 6c65 2c20  ce of hashable, 
-000239a0: 7468 656e 2064 696d 656e 7369 6f6e 7320  then dimensions 
-000239b0: 6172 6520 696e 7365 7274 6564 2077 6974  are inserted wit
-000239c0: 6820 6c65 6e67 7468 0a20 2020 2020 2020  h length.       
-000239d0: 2020 2020 2031 2e20 4966 2070 726f 7669       1. If provi
-000239e0: 6465 6420 6173 2061 206d 6170 7069 6e67  ded as a mapping
-000239f0: 2c20 7468 656e 2074 6865 206b 6579 7320  , then the keys 
-00023a00: 6172 6520 7468 6520 6e65 7720 6469 6d65  are the new dime
-00023a10: 6e73 696f 6e73 0a20 2020 2020 2020 2020  nsions.         
-00023a20: 2020 2061 6e64 2074 6865 2076 616c 7565     and the value
-00023a30: 7320 6172 6520 6569 7468 6572 2069 6e74  s are either int
-00023a40: 6567 6572 7320 2867 6976 696e 6720 7468  egers (giving th
-00023a50: 6520 6c65 6e67 7468 206f 6620 7468 6520  e length of the 
-00023a60: 6e65 770a 2020 2020 2020 2020 2020 2020  new.            
-00023a70: 6469 6d65 6e73 696f 6e73 2920 6f72 2061  dimensions) or a
-00023a80: 7272 6179 2d6c 696b 6520 2867 6976 696e  rray-like (givin
-00023a90: 6720 7468 6520 636f 6f72 6469 6e61 7465  g the coordinate
-00023aa0: 7320 6f66 2074 6865 206e 6577 0a20 2020  s of the new.   
-00023ab0: 2020 2020 2020 2020 2064 696d 656e 7369           dimensi
-00023ac0: 6f6e 7329 2e0a 2020 2020 2020 2020 6178  ons)..        ax
-00023ad0: 6973 203a 2069 6e74 2c20 7365 7175 656e  is : int, sequen
-00023ae0: 6365 206f 6620 696e 742c 206f 7220 4e6f  ce of int, or No
-00023af0: 6e65 2c20 6465 6661 756c 743a 204e 6f6e  ne, default: Non
-00023b00: 650a 2020 2020 2020 2020 2020 2020 4178  e.            Ax
-00023b10: 6973 2070 6f73 6974 696f 6e28 7329 2077  is position(s) w
-00023b20: 6865 7265 206e 6577 2061 7869 7320 6973  here new axis is
-00023b30: 2074 6f20 6265 2069 6e73 6572 7465 6420   to be inserted 
-00023b40: 2870 6f73 6974 696f 6e28 7329 206f 6e0a  (position(s) on.
-00023b50: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00023b60: 7265 7375 6c74 2061 7272 6179 292e 2049  result array). I
-00023b70: 6620 6120 7365 7175 656e 6365 206f 6620  f a sequence of 
-00023b80: 696e 7465 6765 7273 2069 7320 7061 7373  integers is pass
-00023b90: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-00023ba0: 6d75 6c74 6970 6c65 2061 7865 7320 6172  multiple axes ar
-00023bb0: 6520 696e 7365 7274 6564 2e20 496e 2074  e inserted. In t
-00023bc0: 6869 7320 6361 7365 2c20 6469 6d20 6172  his case, dim ar
-00023bd0: 6775 6d65 6e74 7320 7368 6f75 6c64 2062  guments should b
-00023be0: 650a 2020 2020 2020 2020 2020 2020 7361  e.            sa
-00023bf0: 6d65 206c 656e 6774 6820 6c69 7374 2e20  me length list. 
-00023c00: 4966 2061 7869 733d 4e6f 6e65 2069 7320  If axis=None is 
-00023c10: 7061 7373 6564 2c20 616c 6c20 7468 6520  passed, all the 
-00023c20: 6178 6573 2077 696c 6c20 6265 0a20 2020  axes will be.   
-00023c30: 2020 2020 2020 2020 2069 6e73 6572 7465           inserte
-00023c40: 6420 746f 2074 6865 2073 7461 7274 206f  d to the start o
-00023c50: 6620 7468 6520 7265 7375 6c74 2061 7272  f the result arr
-00023c60: 6179 2e0a 2020 2020 2020 2020 2a2a 6469  ay..        **di
-00023c70: 6d5f 6b77 6172 6773 203a 2069 6e74 206f  m_kwargs : int o
-00023c80: 7220 7365 7175 656e 6365 206f 7220 6e64  r sequence or nd
-00023c90: 6172 7261 790a 2020 2020 2020 2020 2020  array.          
-00023ca0: 2020 5468 6520 6b65 7977 6f72 6473 2061    The keywords a
-00023cb0: 7265 2061 7262 6974 7261 7279 2064 696d  re arbitrary dim
-00023cc0: 656e 7369 6f6e 7320 6265 696e 6720 696e  ensions being in
-00023cd0: 7365 7274 6564 2061 6e64 2074 6865 2076  serted and the v
-00023ce0: 616c 7565 730a 2020 2020 2020 2020 2020  alues.          
-00023cf0: 2020 6172 6520 6569 7468 6572 2074 6865    are either the
-00023d00: 206c 656e 6774 6873 206f 6620 7468 6520   lengths of the 
-00023d10: 6e65 7720 6469 6d73 2028 6966 2069 6e74  new dims (if int
-00023d20: 2069 7320 6769 7665 6e29 2c20 6f72 2074   is given), or t
-00023d30: 6865 6972 0a20 2020 2020 2020 2020 2020  heir.           
-00023d40: 2063 6f6f 7264 696e 6174 6573 2e20 4e6f   coordinates. No
-00023d50: 7465 2c20 7468 6973 2069 7320 616e 2061  te, this is an a
-00023d60: 6c74 6572 6e61 7469 7665 2074 6f20 7061  lternative to pa
-00023d70: 7373 696e 6720 6120 6469 6374 2074 6f20  ssing a dict to 
-00023d80: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-00023d90: 6469 6d20 6b77 6172 6720 616e 6420 7769  dim kwarg and wi
-00023da0: 6c6c 206f 6e6c 7920 6265 2075 7365 6420  ll only be used 
-00023db0: 6966 2064 696d 2069 7320 4e6f 6e65 2e0a  if dim is None..
-00023dc0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00023dd0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00023de0: 0a20 2020 2020 2020 2065 7870 616e 6465  .        expande
-00023df0: 6420 3a20 4461 7461 7365 740a 2020 2020  d : Dataset.    
-00023e00: 2020 2020 2020 2020 5468 6973 206f 626a          This obj
-00023e10: 6563 742c 2062 7574 2077 6974 6820 6164  ect, but with ad
-00023e20: 6469 7469 6f6e 616c 2064 696d 656e 7369  ditional dimensi
-00023e30: 6f6e 2873 292e 0a0a 2020 2020 2020 2020  on(s)...        
-00023e40: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-00023e50: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00023e60: 2020 4461 7461 4172 7261 792e 6578 7061    DataArray.expa
-00023e70: 6e64 5f64 696d 730a 2020 2020 2020 2020  nd_dims.        
-00023e80: 2222 220a 2020 2020 2020 2020 6966 2064  """.        if d
-00023e90: 696d 2069 7320 4e6f 6e65 3a0a 2020 2020  im is None:.    
-00023ea0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-00023eb0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-00023ec0: 616e 6365 2864 696d 2c20 4d61 7070 696e  ance(dim, Mappin
-00023ed0: 6729 3a0a 2020 2020 2020 2020 2020 2020  g):.            
-00023ee0: 2320 5765 2772 6520 6c61 7465 7220 676f  # We're later go
-00023ef0: 696e 6720 746f 206d 6f64 6966 7920 6469  ing to modify di
-00023f00: 6d20 696e 2070 6c61 6365 3b20 646f 6e27  m in place; don'
-00023f10: 7420 7461 6d70 6572 2077 6974 680a 2020  t tamper with.  
-00023f20: 2020 2020 2020 2020 2020 2320 7468 6520            # the 
-00023f30: 696e 7075 740a 2020 2020 2020 2020 2020  input.          
-00023f40: 2020 6469 6d20 3d20 6469 6374 2864 696d    dim = dict(dim
-00023f50: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
-00023f60: 7369 6e73 7461 6e63 6528 6469 6d2c 2069  sinstance(dim, i
-00023f70: 6e74 293a 0a20 2020 2020 2020 2020 2020  nt):.           
-00023f80: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
-00023f90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00023fa0: 2020 2264 696d 2073 686f 756c 6420 6265    "dim should be
-00023fb0: 2068 6173 6861 626c 6520 6f72 2073 6571   hashable or seq
-00023fc0: 7565 6e63 6520 6f66 2068 6173 6861 626c  uence of hashabl
-00023fd0: 6573 206f 7220 6d61 7070 696e 6722 0a20  es or mapping". 
-00023fe0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00023ff0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-00024000: 616e 6365 2864 696d 2c20 7374 7229 206f  ance(dim, str) o
-00024010: 7220 6e6f 7420 6973 696e 7374 616e 6365  r not isinstance
-00024020: 2864 696d 2c20 5365 7175 656e 6365 293a  (dim, Sequence):
-00024030: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
-00024040: 203d 207b 6469 6d3a 2031 7d0a 2020 2020   = {dim: 1}.    
-00024050: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00024060: 6e63 6528 6469 6d2c 2053 6571 7565 6e63  nce(dim, Sequenc
-00024070: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00024080: 6966 206c 656e 2864 696d 2920 213d 206c  if len(dim) != l
-00024090: 656e 2873 6574 2864 696d 2929 3a0a 2020  en(set(dim)):.  
-000240a0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000240b0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-000240c0: 6469 6d73 2073 686f 756c 6420 6e6f 7420  dims should not 
-000240d0: 636f 6e74 6169 6e20 6475 706c 6963 6174  contain duplicat
-000240e0: 6520 7661 6c75 6573 2e22 290a 2020 2020  e values.").    
-000240f0: 2020 2020 2020 2020 6469 6d20 3d20 7b64          dim = {d
-00024100: 3a20 3120 666f 7220 6420 696e 2064 696d  : 1 for d in dim
-00024110: 7d0a 0a20 2020 2020 2020 2064 696d 203d  }..        dim =
-00024120: 2065 6974 6865 725f 6469 6374 5f6f 725f   either_dict_or_
-00024130: 6b77 6172 6773 2864 696d 2c20 6469 6d5f  kwargs(dim, dim_
-00024140: 6b77 6172 6773 2c20 2265 7870 616e 645f  kwargs, "expand_
-00024150: 6469 6d73 2229 0a20 2020 2020 2020 2061  dims").        a
-00024160: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
-00024170: 2864 696d 2c20 4d75 7461 626c 654d 6170  (dim, MutableMap
-00024180: 7069 6e67 290a 0a20 2020 2020 2020 2069  ping)..        i
-00024190: 6620 6178 6973 2069 7320 4e6f 6e65 3a0a  f axis is None:.
-000241a0: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-000241b0: 203d 206c 6973 7428 7261 6e67 6528 6c65   = list(range(le
-000241c0: 6e28 6469 6d29 2929 0a20 2020 2020 2020  n(dim))).       
-000241d0: 2065 6c69 6620 6e6f 7420 6973 696e 7374   elif not isinst
-000241e0: 616e 6365 2861 7869 732c 2053 6571 7565  ance(axis, Seque
-000241f0: 6e63 6529 3a0a 2020 2020 2020 2020 2020  nce):.          
-00024200: 2020 6178 6973 203d 205b 6178 6973 5d0a    axis = [axis].
-00024210: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00024220: 6469 6d29 2021 3d20 6c65 6e28 6178 6973  dim) != len(axis
-00024230: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00024240: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00024250: 226c 656e 6774 6873 206f 6620 6469 6d20  "lengths of dim 
-00024260: 616e 6420 6178 6973 2073 686f 756c 6420  and axis should 
-00024270: 6265 2069 6465 6e74 6963 616c 2e22 290a  be identical.").
-00024280: 2020 2020 2020 2020 666f 7220 6420 696e          for d in
-00024290: 2064 696d 3a0a 2020 2020 2020 2020 2020   dim:.          
-000242a0: 2020 6966 2064 2069 6e20 7365 6c66 2e64    if d in self.d
-000242b0: 696d 733a 0a20 2020 2020 2020 2020 2020  ims:.           
-000242c0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-000242d0: 4572 726f 7228 6622 4469 6d65 6e73 696f  Error(f"Dimensio
-000242e0: 6e20 7b64 7d20 616c 7265 6164 7920 6578  n {d} already ex
-000242f0: 6973 7473 2e22 290a 2020 2020 2020 2020  ists.").        
-00024300: 2020 2020 6966 2064 2069 6e20 7365 6c66      if d in self
-00024310: 2e5f 7661 7269 6162 6c65 7320 616e 6420  ._variables and 
-00024320: 6e6f 7420 7574 696c 732e 6973 5f73 6361  not utils.is_sca
-00024330: 6c61 7228 7365 6c66 2e5f 7661 7269 6162  lar(self._variab
-00024340: 6c65 735b 645d 293a 0a20 2020 2020 2020  les[d]):.       
-00024350: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00024360: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00024370: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00024380: 7b64 696d 7d20 616c 7265 6164 7920 6578  {dim} already ex
-00024390: 6973 7473 2061 7320 636f 6f72 6469 6e61  ists as coordina
-000243a0: 7465 206f 7222 0a20 2020 2020 2020 2020  te or".         
-000243b0: 2020 2020 2020 2020 2020 2022 2076 6172             " var
-000243c0: 6961 626c 6520 6e61 6d65 2e22 2e66 6f72  iable name.".for
-000243d0: 6d61 7428 6469 6d3d 6429 0a20 2020 2020  mat(dim=d).     
-000243e0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000243f0: 2020 2020 2020 7661 7269 6162 6c65 733a        variables:
-00024400: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
-00024410: 5661 7269 6162 6c65 5d20 3d20 7b7d 0a20  Variable] = {}. 
-00024420: 2020 2020 2020 2069 6e64 6578 6573 3a20         indexes: 
-00024430: 6469 6374 5b48 6173 6861 626c 652c 2049  dict[Hashable, I
-00024440: 6e64 6578 5d20 3d20 6469 6374 2873 656c  ndex] = dict(sel
-00024450: 662e 5f69 6e64 6578 6573 290a 2020 2020  f._indexes).    
-00024460: 2020 2020 636f 6f72 645f 6e61 6d65 7320      coord_names 
-00024470: 3d20 7365 6c66 2e5f 636f 6f72 645f 6e61  = self._coord_na
-00024480: 6d65 732e 636f 7079 2829 0a20 2020 2020  mes.copy().     
-00024490: 2020 2023 2049 6620 6469 6d20 6973 2061     # If dim is a
-000244a0: 2064 6963 742c 2074 6865 6e20 656e 7375   dict, then ensu
-000244b0: 7265 2074 6861 7420 7468 6520 7661 6c75  re that the valu
-000244c0: 6573 2061 7265 2065 6974 6865 7220 696e  es are either in
-000244d0: 7465 6765 7273 0a20 2020 2020 2020 2023  tegers.        #
-000244e0: 206f 7220 6974 6572 6162 6c65 732e 0a20   or iterables.. 
-000244f0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-00024500: 696e 2064 696d 2e69 7465 6d73 2829 3a0a  in dim.items():.
-00024510: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-00024520: 6173 6174 7472 2876 2c20 225f 5f69 7465  asattr(v, "__ite
-00024530: 725f 5f22 293a 0a20 2020 2020 2020 2020  r__"):.         
-00024540: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
-00024550: 7661 6c75 6520 666f 7220 7468 6520 6e65  value for the ne
-00024560: 7720 6469 6d65 6e73 696f 6e20 6973 2061  w dimension is a
-00024570: 6e20 6974 6572 6162 6c65 2c20 7468 656e  n iterable, then
-00024580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024590: 2023 2073 6176 6520 7468 6520 636f 6f72   # save the coor
-000245a0: 6469 6e61 7465 7320 746f 2074 6865 2076  dinates to the v
-000245b0: 6172 6961 626c 6573 2064 6963 742c 2061  ariables dict, a
-000245c0: 6e64 2073 6574 2074 6865 0a20 2020 2020  nd set the.     
-000245d0: 2020 2020 2020 2020 2020 2023 2076 616c             # val
-000245e0: 7565 2077 6974 6869 6e20 7468 6520 6469  ue within the di
-000245f0: 6d20 6469 6374 2074 6f20 7468 6520 6c65  m dict to the le
-00024600: 6e67 7468 206f 6620 7468 6520 6974 6572  ngth of the iter
-00024610: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
-00024620: 2020 2020 2023 2066 6f72 206c 6174 6572       # for later
-00024630: 2075 7365 2e0a 2020 2020 2020 2020 2020   use..          
-00024640: 2020 2020 2020 696e 6465 7820 3d20 5061        index = Pa
-00024650: 6e64 6173 496e 6465 7828 762c 206b 290a  ndasIndex(v, k).
-00024660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024670: 696e 6465 7865 735b 6b5d 203d 2069 6e64  indexes[k] = ind
-00024680: 6578 0a20 2020 2020 2020 2020 2020 2020  ex.             
-00024690: 2020 2076 6172 6961 626c 6573 2e75 7064     variables.upd
-000246a0: 6174 6528 696e 6465 782e 6372 6561 7465  ate(index.create
-000246b0: 5f76 6172 6961 626c 6573 2829 290a 2020  _variables()).  
-000246c0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000246d0: 6f72 645f 6e61 6d65 732e 6164 6428 6b29  ord_names.add(k)
-000246e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000246f0: 2064 696d 5b6b 5d20 3d20 7661 7269 6162   dim[k] = variab
-00024700: 6c65 735b 6b5d 2e73 697a 650a 2020 2020  les[k].size.    
-00024710: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-00024720: 6e73 7461 6e63 6528 762c 2069 6e74 293a  nstance(v, int):
-00024730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024740: 2070 6173 7320 2023 2044 6f20 6e6f 7468   pass  # Do noth
-00024750: 696e 6720 6966 2074 6865 2064 696d 656e  ing if the dimen
-00024760: 7369 6f6e 7320 7661 6c75 6520 6973 206a  sions value is j
-00024770: 7573 7420 616e 2069 6e74 0a20 2020 2020  ust an int.     
-00024780: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00024790: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-000247a0: 7365 2054 7970 6545 7272 6f72 280a 2020  se TypeError(.  
-000247b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000247c0: 2020 2254 6865 2076 616c 7565 206f 6620    "The value of 
-000247d0: 6e65 7720 6469 6d65 6e73 696f 6e20 7b6b  new dimension {k
-000247e0: 7d20 6d75 7374 2062 6520 220a 2020 2020  } must be ".    
-000247f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024800: 2261 6e20 6974 6572 6162 6c65 206f 7220  "an iterable or 
-00024810: 616e 2069 6e74 222e 666f 726d 6174 286b  an int".format(k
-00024820: 3d6b 290a 2020 2020 2020 2020 2020 2020  =k).            
-00024830: 2020 2020 290a 0a20 2020 2020 2020 2066      )..        f
-00024840: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
-00024850: 5f76 6172 6961 626c 6573 2e69 7465 6d73  _variables.items
-00024860: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00024870: 6966 206b 206e 6f74 2069 6e20 6469 6d3a  if k not in dim:
-00024880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024890: 2069 6620 6b20 696e 2063 6f6f 7264 5f6e   if k in coord_n
-000248a0: 616d 6573 3a20 2023 2044 6f20 6e6f 7420  ames:  # Do not 
-000248b0: 6368 616e 6765 2063 6f6f 7264 696e 6174  change coordinat
-000248c0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-000248d0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-000248e0: 5b6b 5d20 3d20 760a 2020 2020 2020 2020  [k] = v.        
-000248f0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00024900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024910: 2020 7265 7375 6c74 5f6e 6469 6d20 3d20    result_ndim = 
-00024920: 6c65 6e28 762e 6469 6d73 2920 2b20 6c65  len(v.dims) + le
-00024930: 6e28 6178 6973 290a 2020 2020 2020 2020  n(axis).        
-00024940: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00024950: 6120 696e 2061 7869 733a 0a20 2020 2020  a in axis:.     
-00024960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024970: 2020 2069 6620 6120 3c20 2d72 6573 756c     if a < -resul
-00024980: 745f 6e64 696d 206f 7220 7265 7375 6c74  t_ndim or result
-00024990: 5f6e 6469 6d20 2d20 3120 3c20 613a 0a20  _ndim - 1 < a:. 
-000249a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000249b0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000249c0: 2049 6e64 6578 4572 726f 7228 0a20 2020   IndexError(.   
-000249d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000249e0: 2020 2020 2020 2020 2020 2020 2066 2241               f"A
-000249f0: 7869 7320 7b61 7d20 6f66 2076 6172 6961  xis {a} of varia
-00024a00: 626c 6520 7b6b 7d20 6973 206f 7574 206f  ble {k} is out o
-00024a10: 6620 626f 756e 6473 206f 6620 7468 6520  f bounds of the 
-00024a20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00024a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024a40: 2020 6622 6578 7061 6e64 6564 2064 696d    f"expanded dim
-00024a50: 656e 7369 6f6e 2073 697a 6520 7b72 6573  ension size {res
-00024a60: 756c 745f 6e64 696d 7d22 0a20 2020 2020  ult_ndim}".     
-00024a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024a80: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00024a90: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00024aa0: 6973 5f70 6f73 203d 205b 6120 6966 2061  is_pos = [a if a
-00024ab0: 203e 3d20 3020 656c 7365 2072 6573 756c   >= 0 else resul
-00024ac0: 745f 6e64 696d 202b 2061 2066 6f72 2061  t_ndim + a for a
-00024ad0: 2069 6e20 6178 6973 5d0a 2020 2020 2020   in axis].      
-00024ae0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00024af0: 206c 656e 2861 7869 735f 706f 7329 2021   len(axis_pos) !
-00024b00: 3d20 6c65 6e28 7365 7428 6178 6973 5f70  = len(set(axis_p
-00024b10: 6f73 2929 3a0a 2020 2020 2020 2020 2020  os)):.          
-00024b20: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00024b30: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-00024b40: 6178 6973 2073 686f 756c 6420 6e6f 7420  axis should not 
-00024b50: 636f 6e74 6169 6e20 6475 706c 6963 6174  contain duplicat
-00024b60: 6520 7661 6c75 6573 2229 0a20 2020 2020  e values").     
-00024b70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00024b80: 2057 6520 6e65 6564 2074 6f20 736f 7274   We need to sort
-00024b90: 2074 6865 6d20 746f 206d 616b 6520 7375   them to make su
-00024ba0: 7265 2060 6178 6973 6020 6571 7561 6c73  re `axis` equals
-00024bb0: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
-00024bc0: 2020 2020 2020 2020 2020 2020 2320 6178              # ax
-00024bd0: 6973 2070 6f73 6974 696f 6e73 206f 6620  is positions of 
-00024be0: 7468 6520 7265 7375 6c74 2061 7272 6179  the result array
-00024bf0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024c00: 2020 2020 2020 7a69 705f 6178 6973 5f64        zip_axis_d
-00024c10: 696d 203d 2073 6f72 7465 6428 7a69 7028  im = sorted(zip(
-00024c20: 6178 6973 5f70 6f73 2c20 6469 6d2e 6974  axis_pos, dim.it
-00024c30: 656d 7328 2929 290a 0a20 2020 2020 2020  ems()))..       
-00024c40: 2020 2020 2020 2020 2020 2020 2061 6c6c               all
-00024c50: 5f64 696d 7320 3d20 6c69 7374 287a 6970  _dims = list(zip
-00024c60: 2876 2e64 696d 732c 2076 2e73 6861 7065  (v.dims, v.shape
-00024c70: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00024c80: 2020 2020 2020 2066 6f72 2064 2c20 6320         for d, c 
-00024c90: 696e 207a 6970 5f61 7869 735f 6469 6d3a  in zip_axis_dim:
-00024ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024cb0: 2020 2020 2020 2020 2061 6c6c 5f64 696d           all_dim
-00024cc0: 732e 696e 7365 7274 2864 2c20 6329 0a20  s.insert(d, c). 
-00024cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ce0: 2020 2076 6172 6961 626c 6573 5b6b 5d20     variables[k] 
-00024cf0: 3d20 762e 7365 745f 6469 6d73 2864 6963  = v.set_dims(dic
-00024d00: 7428 616c 6c5f 6469 6d73 2929 0a20 2020  t(all_dims)).   
-00024d10: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00024d20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00024d30: 6620 6b20 6e6f 7420 696e 2076 6172 6961  f k not in varia
-00024d40: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
-00024d50: 2020 2020 2020 2020 2020 2320 4966 2064            # If d
-00024d60: 696d 7320 696e 636c 7564 6573 2061 206c  ims includes a l
-00024d70: 6162 656c 206f 6620 6120 6e6f 6e2d 6469  abel of a non-di
-00024d80: 6d65 6e73 696f 6e20 636f 6f72 6469 6e61  mension coordina
-00024d90: 7465 2c0a 2020 2020 2020 2020 2020 2020  te,.            
-00024da0: 2020 2020 2020 2020 2320 6974 2077 696c          # it wil
-00024db0: 6c20 6265 2070 726f 6d6f 7465 6420 746f  l be promoted to
-00024dc0: 2061 2031 4420 636f 6f72 6469 6e61 7465   a 1D coordinate
-00024dd0: 2077 6974 6820 6120 7369 6e67 6c65 2076   with a single v
-00024de0: 616c 7565 2e0a 2020 2020 2020 2020 2020  alue..          
-00024df0: 2020 2020 2020 2020 2020 696e 6465 782c            index,
-00024e00: 2069 6e64 6578 5f76 6172 7320 3d20 6372   index_vars = cr
-00024e10: 6561 7465 5f64 6566 6175 6c74 5f69 6e64  eate_default_ind
-00024e20: 6578 5f69 6d70 6c69 6369 7428 762e 7365  ex_implicit(v.se
-00024e30: 745f 6469 6d73 286b 2929 0a20 2020 2020  t_dims(k)).     
-00024e40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00024e50: 6e64 6578 6573 5b6b 5d20 3d20 696e 6465  ndexes[k] = inde
-00024e60: 780a 2020 2020 2020 2020 2020 2020 2020  x.              
-00024e70: 2020 2020 2020 7661 7269 6162 6c65 732e        variables.
-00024e80: 7570 6461 7465 2869 6e64 6578 5f76 6172  update(index_var
-00024e90: 7329 0a0a 2020 2020 2020 2020 7265 7475  s)..        retu
-00024ea0: 726e 2073 656c 662e 5f72 6570 6c61 6365  rn self._replace
-00024eb0: 5f77 6974 685f 6e65 775f 6469 6d73 280a  _with_new_dims(.
-00024ec0: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-00024ed0: 6162 6c65 732c 2063 6f6f 7264 5f6e 616d  ables, coord_nam
-00024ee0: 6573 3d63 6f6f 7264 5f6e 616d 6573 2c20  es=coord_names, 
-00024ef0: 696e 6465 7865 733d 696e 6465 7865 730a  indexes=indexes.
-00024f00: 2020 2020 2020 2020 290a 0a20 2020 2023          )..    #
-00024f10: 2063 6861 6e67 6520 7479 7065 206f 6620   change type of 
-00024f20: 7365 6c66 2061 6e64 2072 6574 7572 6e20  self and return 
-00024f30: 746f 2054 5f44 6174 6173 6574 206f 6e63  to T_Dataset onc
-00024f40: 650a 2020 2020 2320 6874 7470 733a 2f2f  e.    # https://
-00024f50: 6769 7468 7562 2e63 6f6d 2f70 7974 686f  github.com/pytho
-00024f60: 6e2f 6d79 7079 2f69 7373 7565 732f 3132  n/mypy/issues/12
-00024f70: 3834 3620 6973 2072 6573 6f6c 7665 640a  846 is resolved.
-00024f80: 2020 2020 6465 6620 7365 745f 696e 6465      def set_inde
-00024f90: 7828 0a20 2020 2020 2020 2073 656c 662c  x(.        self,
-00024fa0: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
-00024fb0: 3a20 4d61 7070 696e 675b 416e 792c 2048  : Mapping[Any, H
-00024fc0: 6173 6861 626c 6520 7c20 5365 7175 656e  ashable | Sequen
-00024fd0: 6365 5b48 6173 6861 626c 655d 5d20 7c20  ce[Hashable]] | 
-00024fe0: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00024ff0: 2020 2020 2061 7070 656e 643a 2062 6f6f       append: boo
-00025000: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-00025010: 2020 202a 2a69 6e64 6578 6573 5f6b 7761     **indexes_kwa
-00025020: 7267 733a 2048 6173 6861 626c 6520 7c20  rgs: Hashable | 
-00025030: 5365 7175 656e 6365 5b48 6173 6861 626c  Sequence[Hashabl
-00025040: 655d 2c0a 2020 2020 2920 2d3e 2044 6174  e],.    ) -> Dat
-00025050: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
-00025060: 2253 6574 2044 6174 6173 6574 2028 6d75  "Set Dataset (mu
-00025070: 6c74 692d 2969 6e64 6578 6573 2075 7369  lti-)indexes usi
-00025080: 6e67 206f 6e65 206f 7220 6d6f 7265 2065  ng one or more e
-00025090: 7869 7374 696e 6720 636f 6f72 6469 6e61  xisting coordina
-000250a0: 7465 730a 2020 2020 2020 2020 6f72 2076  tes.        or v
-000250b0: 6172 6961 626c 6573 2e0a 0a20 2020 2020  ariables...     
-000250c0: 2020 2054 6869 7320 6c65 6761 6379 206d     This legacy m
-000250d0: 6574 686f 6420 6973 206c 696d 6974 6564  ethod is limited
-000250e0: 2074 6f20 7061 6e64 6173 2028 6d75 6c74   to pandas (mult
-000250f0: 692d 2969 6e64 6578 6573 2061 6e64 0a20  i-)indexes and. 
-00025100: 2020 2020 2020 2031 2d64 696d 656e 7369         1-dimensi
-00025110: 6f6e 616c 2022 6469 6d65 6e73 696f 6e22  onal "dimension"
-00025120: 2063 6f6f 7264 696e 6174 6573 2e20 5365   coordinates. Se
-00025130: 650a 2020 2020 2020 2020 3a70 793a 6d65  e.        :py:me
-00025140: 7468 3a60 7e44 6174 6173 6574 2e73 6574  th:`~Dataset.set
-00025150: 5f78 696e 6465 7860 2066 6f72 2073 6574  _xindex` for set
-00025160: 7469 6e67 2061 2070 616e 6461 7320 6f72  ting a pandas or
-00025170: 2061 2063 7573 746f 6d0a 2020 2020 2020   a custom.      
-00025180: 2020 5861 7272 6179 2d63 6f6d 7061 7469    Xarray-compati
-00025190: 626c 6520 696e 6465 7820 6672 6f6d 206f  ble index from o
-000251a0: 6e65 206f 7220 6d6f 7265 2061 7262 6974  ne or more arbit
-000251b0: 7261 7279 2063 6f6f 7264 696e 6174 6573  rary coordinates
-000251c0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-000251d0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-000251e0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-000251f0: 2069 6e64 6578 6573 203a 207b 6469 6d3a   indexes : {dim:
-00025200: 2069 6e64 6578 2c20 2e2e 2e7d 0a20 2020   index, ...}.   
-00025210: 2020 2020 2020 2020 204d 6170 7069 6e67           Mapping
-00025220: 2066 726f 6d20 6e61 6d65 7320 6d61 7463   from names matc
-00025230: 6869 6e67 2064 696d 656e 7369 6f6e 7320  hing dimensions 
-00025240: 616e 6420 7661 6c75 6573 2067 6976 656e  and values given
-00025250: 0a20 2020 2020 2020 2020 2020 2062 7920  .            by 
-00025260: 286c 6973 7473 206f 6629 2074 6865 206e  (lists of) the n
-00025270: 616d 6573 206f 6620 6578 6973 7469 6e67  ames of existing
-00025280: 2063 6f6f 7264 696e 6174 6573 206f 7220   coordinates or 
-00025290: 7661 7269 6162 6c65 7320 746f 2073 6574  variables to set
-000252a0: 0a20 2020 2020 2020 2020 2020 2061 7320  .            as 
-000252b0: 6e65 7720 286d 756c 7469 2d29 696e 6465  new (multi-)inde
-000252c0: 782e 0a20 2020 2020 2020 2061 7070 656e  x..        appen
-000252d0: 6420 3a20 626f 6f6c 2c20 6465 6661 756c  d : bool, defaul
-000252e0: 743a 2046 616c 7365 0a20 2020 2020 2020  t: False.       
-000252f0: 2020 2020 2049 6620 5472 7565 2c20 6170       If True, ap
-00025300: 7065 6e64 2074 6865 2073 7570 706c 6965  pend the supplie
-00025310: 6420 696e 6465 7828 6573 2920 746f 2074  d index(es) to t
-00025320: 6865 2065 7869 7374 696e 6720 696e 6465  he existing inde
-00025330: 7828 6573 292e 0a20 2020 2020 2020 2020  x(es)..         
-00025340: 2020 204f 7468 6572 7769 7365 2072 6570     Otherwise rep
-00025350: 6c61 6365 2074 6865 2065 7869 7374 696e  lace the existin
-00025360: 6720 696e 6465 7828 6573 2920 2864 6566  g index(es) (def
-00025370: 6175 6c74 292e 0a20 2020 2020 2020 202a  ault)..        *
-00025380: 2a69 6e64 6578 6573 5f6b 7761 7267 7320  *indexes_kwargs 
-00025390: 3a20 6f70 7469 6f6e 616c 0a20 2020 2020  : optional.     
-000253a0: 2020 2020 2020 2054 6865 206b 6579 776f         The keywo
-000253b0: 7264 2061 7267 756d 656e 7473 2066 6f72  rd arguments for
-000253c0: 6d20 6f66 2060 6069 6e64 6578 6573 6060  m of ``indexes``
-000253d0: 2e0a 2020 2020 2020 2020 2020 2020 4f6e  ..            On
-000253e0: 6520 6f66 2069 6e64 6578 6573 206f 7220  e of indexes or 
-000253f0: 696e 6465 7865 735f 6b77 6172 6773 206d  indexes_kwargs m
-00025400: 7573 7420 6265 2070 726f 7669 6465 642e  ust be provided.
-00025410: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00025420: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00025430: 2d0a 2020 2020 2020 2020 6f62 6a20 3a20  -.        obj : 
-00025440: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
-00025450: 2020 2020 416e 6f74 6865 7220 6461 7461      Another data
-00025460: 7365 742c 2077 6974 6820 7468 6973 2064  set, with this d
-00025470: 6174 6173 6574 2773 2064 6174 6120 6275  ataset's data bu
-00025480: 7420 7265 706c 6163 6564 2063 6f6f 7264  t replaced coord
-00025490: 696e 6174 6573 2e0a 0a20 2020 2020 2020  inates...       
-000254a0: 2045 7861 6d70 6c65 730a 2020 2020 2020   Examples.      
-000254b0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-000254c0: 2020 203e 3e3e 2061 7272 203d 2078 722e     >>> arr = xr.
-000254d0: 4461 7461 4172 7261 7928 0a20 2020 2020  DataArray(.     
-000254e0: 2020 202e 2e2e 2020 2020 2064 6174 613d     ...     data=
-000254f0: 6e70 2e6f 6e65 7328 2832 2c20 3329 292c  np.ones((2, 3)),
-00025500: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-00025510: 2064 696d 733d 5b22 7822 2c20 2279 225d   dims=["x", "y"]
-00025520: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-00025530: 2020 636f 6f72 6473 3d7b 2278 223a 2072    coords={"x": r
-00025540: 616e 6765 2832 292c 2022 7922 3a20 7261  ange(2), "y": ra
-00025550: 6e67 6528 3329 2c20 2261 223a 2028 2278  nge(3), "a": ("x
-00025560: 222c 205b 332c 2034 5d29 7d2c 0a20 2020  ", [3, 4])},.   
-00025570: 2020 2020 202e 2e2e 2029 0a20 2020 2020       ... ).     
-00025580: 2020 203e 3e3e 2064 7320 3d20 7872 2e44     >>> ds = xr.D
-00025590: 6174 6173 6574 287b 2276 223a 2061 7272  ataset({"v": arr
-000255a0: 7d29 0a20 2020 2020 2020 203e 3e3e 2064  }).        >>> d
-000255b0: 730a 2020 2020 2020 2020 3c78 6172 7261  s.        <xarra
-000255c0: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-000255d0: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-000255e0: 2878 3a20 322c 2079 3a20 3329 0a20 2020  (x: 2, y: 3).   
-000255f0: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
-00025600: 3a0a 2020 2020 2020 2020 2020 2a20 7820  :.          * x 
-00025610: 2020 2020 2020 2028 7829 2069 6e74 3634         (x) int64
-00025620: 2030 2031 0a20 2020 2020 2020 2020 202a   0 1.          *
-00025630: 2079 2020 2020 2020 2020 2879 2920 696e   y        (y) in
-00025640: 7436 3420 3020 3120 320a 2020 2020 2020  t64 0 1 2.      
-00025650: 2020 2020 2020 6120 2020 2020 2020 2028        a        (
-00025660: 7829 2069 6e74 3634 2033 2034 0a20 2020  x) int64 3 4.   
-00025670: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
-00025680: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-00025690: 2076 2020 2020 2020 2020 2878 2c20 7929   v        (x, y)
-000256a0: 2066 6c6f 6174 3634 2031 2e30 2031 2e30   float64 1.0 1.0
-000256b0: 2031 2e30 2031 2e30 2031 2e30 2031 2e30   1.0 1.0 1.0 1.0
-000256c0: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
-000256d0: 7365 745f 696e 6465 7828 783d 2261 2229  set_index(x="a")
-000256e0: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
-000256f0: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
-00025700: 2020 4469 6d65 6e73 696f 6e73 3a20 2028    Dimensions:  (
-00025710: 783a 2032 2c20 793a 2033 290a 2020 2020  x: 2, y: 3).    
-00025720: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
-00025730: 0a20 2020 2020 2020 2020 202a 2078 2020  .          * x  
-00025740: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
-00025750: 3320 340a 2020 2020 2020 2020 2020 2a20  3 4.          * 
-00025760: 7920 2020 2020 2020 2028 7929 2069 6e74  y        (y) int
-00025770: 3634 2030 2031 2032 0a20 2020 2020 2020  64 0 1 2.       
-00025780: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
-00025790: 0a20 2020 2020 2020 2020 2020 2076 2020  .            v  
-000257a0: 2020 2020 2020 2878 2c20 7929 2066 6c6f        (x, y) flo
-000257b0: 6174 3634 2031 2e30 2031 2e30 2031 2e30  at64 1.0 1.0 1.0
-000257c0: 2031 2e30 2031 2e30 2031 2e30 0a0a 2020   1.0 1.0 1.0..  
-000257d0: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
-000257e0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
-000257f0: 2020 2020 2020 2020 4461 7461 7365 742e          Dataset.
-00025800: 7265 7365 745f 696e 6465 780a 2020 2020  reset_index.    
-00025810: 2020 2020 4461 7461 7365 742e 7365 745f      Dataset.set_
-00025820: 7869 6e64 6578 0a20 2020 2020 2020 2044  xindex.        D
-00025830: 6174 6173 6574 2e73 7761 705f 6469 6d73  ataset.swap_dims
-00025840: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00025850: 2020 2020 2064 696d 5f63 6f6f 7264 7320       dim_coords 
-00025860: 3d20 6569 7468 6572 5f64 6963 745f 6f72  = either_dict_or
-00025870: 5f6b 7761 7267 7328 696e 6465 7865 732c  _kwargs(indexes,
-00025880: 2069 6e64 6578 6573 5f6b 7761 7267 732c   indexes_kwargs,
-00025890: 2022 7365 745f 696e 6465 7822 290a 0a20   "set_index").. 
-000258a0: 2020 2020 2020 206e 6577 5f69 6e64 6578         new_index
-000258b0: 6573 3a20 6469 6374 5b48 6173 6861 626c  es: dict[Hashabl
-000258c0: 652c 2049 6e64 6578 5d20 3d20 7b7d 0a20  e, Index] = {}. 
-000258d0: 2020 2020 2020 206e 6577 5f76 6172 6961         new_varia
-000258e0: 626c 6573 3a20 6469 6374 5b48 6173 6861  bles: dict[Hasha
-000258f0: 626c 652c 2056 6172 6961 626c 655d 203d  ble, Variable] =
-00025900: 207b 7d0a 2020 2020 2020 2020 6472 6f70   {}.        drop
-00025910: 5f69 6e64 6578 6573 3a20 7365 745b 4861  _indexes: set[Ha
-00025920: 7368 6162 6c65 5d20 3d20 7365 7428 290a  shable] = set().
-00025930: 2020 2020 2020 2020 6472 6f70 5f76 6172          drop_var
-00025940: 6961 626c 6573 3a20 7365 745b 4861 7368  iables: set[Hash
-00025950: 6162 6c65 5d20 3d20 7365 7428 290a 2020  able] = set().  
-00025960: 2020 2020 2020 7265 706c 6163 655f 6469        replace_di
-00025970: 6d73 3a20 6469 6374 5b48 6173 6861 626c  ms: dict[Hashabl
-00025980: 652c 2048 6173 6861 626c 655d 203d 207b  e, Hashable] = {
-00025990: 7d0a 2020 2020 2020 2020 616c 6c5f 7661  }.        all_va
-000259a0: 725f 6e61 6d65 733a 2073 6574 5b48 6173  r_names: set[Has
-000259b0: 6861 626c 655d 203d 2073 6574 2829 0a0a  hable] = set()..
-000259c0: 2020 2020 2020 2020 666f 7220 6469 6d2c          for dim,
-000259d0: 205f 7661 725f 6e61 6d65 7320 696e 2064   _var_names in d
-000259e0: 696d 5f63 6f6f 7264 732e 6974 656d 7328  im_coords.items(
-000259f0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00025a00: 6620 6973 696e 7374 616e 6365 285f 7661  f isinstance(_va
-00025a10: 725f 6e61 6d65 732c 2073 7472 2920 6f72  r_names, str) or
-00025a20: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00025a30: 5f76 6172 5f6e 616d 6573 2c20 5365 7175  _var_names, Sequ
-00025a40: 656e 6365 293a 0a20 2020 2020 2020 2020  ence):.         
-00025a50: 2020 2020 2020 2076 6172 5f6e 616d 6573         var_names
-00025a60: 203d 205b 5f76 6172 5f6e 616d 6573 5d0a   = [_var_names].
-00025a70: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00025a80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00025a90: 2020 7661 725f 6e61 6d65 7320 3d20 6c69    var_names = li
-00025aa0: 7374 285f 7661 725f 6e61 6d65 7329 0a0a  st(_var_names)..
-00025ab0: 2020 2020 2020 2020 2020 2020 696e 7661              inva
-00025ac0: 6c69 645f 7661 7273 203d 2073 6574 2876  lid_vars = set(v
-00025ad0: 6172 5f6e 616d 6573 2920 2d20 7365 7428  ar_names) - set(
-00025ae0: 7365 6c66 2e5f 7661 7269 6162 6c65 7329  self._variables)
-00025af0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00025b00: 696e 7661 6c69 645f 7661 7273 3a0a 2020  invalid_vars:.  
-00025b10: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00025b20: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-00025b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b40: 2020 2020 222c 2022 2e6a 6f69 6e28 5b73      ", ".join([s
-00025b50: 7472 2876 2920 666f 7220 7620 696e 2069  tr(v) for v in i
-00025b60: 6e76 616c 6964 5f76 6172 735d 290a 2020  nvalid_vars]).  
-00025b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b80: 2020 2b20 2220 7661 7269 6162 6c65 2873    + " variable(s
-00025b90: 2920 646f 206e 6f74 2065 7869 7374 220a  ) do not exist".
-00025ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025bb0: 290a 0a20 2020 2020 2020 2020 2020 2061  )..            a
-00025bc0: 6c6c 5f76 6172 5f6e 616d 6573 2e75 7064  ll_var_names.upd
-00025bd0: 6174 6528 7661 725f 6e61 6d65 7329 0a20  ate(var_names). 
-00025be0: 2020 2020 2020 2020 2020 2064 726f 705f             drop_
-00025bf0: 7661 7269 6162 6c65 732e 7570 6461 7465  variables.update
-00025c00: 2876 6172 5f6e 616d 6573 290a 0a20 2020  (var_names)..   
-00025c10: 2020 2020 2020 2020 2023 2064 726f 7020           # drop 
-00025c20: 616e 7920 7072 652d 6578 6973 7469 6e67  any pre-existing
-00025c30: 2069 6e64 6578 2069 6e76 6f6c 7665 6420   index involved 
-00025c40: 616e 6420 6974 7320 636f 7272 6573 706f  and its correspo
-00025c50: 6e64 696e 6720 636f 6f72 6469 6e61 7465  nding coordinate
-00025c60: 730a 2020 2020 2020 2020 2020 2020 696e  s.            in
-00025c70: 6465 785f 636f 6f72 645f 6e61 6d65 7320  dex_coord_names 
-00025c80: 3d20 7365 6c66 2e78 696e 6465 7865 732e  = self.xindexes.
-00025c90: 6765 745f 616c 6c5f 636f 6f72 6473 2864  get_all_coords(d
-00025ca0: 696d 2c20 6572 726f 7273 3d22 6967 6e6f  im, errors="igno
-00025cb0: 7265 2229 0a20 2020 2020 2020 2020 2020  re").           
-00025cc0: 2061 6c6c 5f69 6e64 6578 5f63 6f6f 7264   all_index_coord
-00025cd0: 5f6e 616d 6573 203d 2073 6574 2869 6e64  _names = set(ind
-00025ce0: 6578 5f63 6f6f 7264 5f6e 616d 6573 290a  ex_coord_names).
-00025cf0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00025d00: 6b20 696e 2076 6172 5f6e 616d 6573 3a0a  k in var_names:.
-00025d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025d20: 616c 6c5f 696e 6465 785f 636f 6f72 645f  all_index_coord_
-00025d30: 6e61 6d65 732e 7570 6461 7465 280a 2020  names.update(.  
-00025d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025d50: 2020 7365 6c66 2e78 696e 6465 7865 732e    self.xindexes.
-00025d60: 6765 745f 616c 6c5f 636f 6f72 6473 286b  get_all_coords(k
-00025d70: 2c20 6572 726f 7273 3d22 6967 6e6f 7265  , errors="ignore
-00025d80: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00025d90: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-00025da0: 2020 6472 6f70 5f69 6e64 6578 6573 2e75    drop_indexes.u
-00025db0: 7064 6174 6528 616c 6c5f 696e 6465 785f  pdate(all_index_
-00025dc0: 636f 6f72 645f 6e61 6d65 7329 0a20 2020  coord_names).   
-00025dd0: 2020 2020 2020 2020 2064 726f 705f 7661           drop_va
-00025de0: 7269 6162 6c65 732e 7570 6461 7465 2861  riables.update(a
-00025df0: 6c6c 5f69 6e64 6578 5f63 6f6f 7264 5f6e  ll_index_coord_n
-00025e00: 616d 6573 290a 0a20 2020 2020 2020 2020  ames)..         
-00025e10: 2020 2069 6620 6c65 6e28 7661 725f 6e61     if len(var_na
-00025e20: 6d65 7329 203d 3d20 3120 616e 6420 286e  mes) == 1 and (n
-00025e30: 6f74 2061 7070 656e 6420 6f72 2064 696d  ot append or dim
-00025e40: 206e 6f74 2069 6e20 7365 6c66 2e5f 696e   not in self._in
-00025e50: 6465 7865 7329 3a0a 2020 2020 2020 2020  dexes):.        
-00025e60: 2020 2020 2020 2020 7661 725f 6e61 6d65          var_name
-00025e70: 203d 2076 6172 5f6e 616d 6573 5b30 5d0a   = var_names[0].
-00025e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e90: 7661 7220 3d20 7365 6c66 2e5f 7661 7269  var = self._vari
-00025ea0: 6162 6c65 735b 7661 725f 6e61 6d65 5d0a  ables[var_name].
-00025eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025ec0: 6966 2076 6172 2e64 696d 7320 213d 2028  if var.dims != (
-00025ed0: 6469 6d2c 293a 0a20 2020 2020 2020 2020  dim,):.         
-00025ee0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00025ef0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00025f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025f10: 2020 2020 2066 2264 696d 656e 7369 6f6e       f"dimension
-00025f20: 206d 6973 6d61 7463 683a 2074 7279 2073   mismatch: try s
-00025f30: 6574 7469 6e67 2061 6e20 696e 6465 7820  etting an index 
-00025f40: 666f 7220 6469 6d65 6e73 696f 6e20 7b64  for dimension {d
-00025f50: 696d 2172 7d20 7769 7468 2022 0a20 2020  im!r} with ".   
-00025f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025f70: 2020 2020 2066 2276 6172 6961 626c 6520       f"variable 
-00025f80: 7b76 6172 5f6e 616d 6521 727d 2074 6861  {var_name!r} tha
-00025f90: 7420 6861 7320 6469 6d65 6e73 696f 6e73  t has dimensions
-00025fa0: 207b 7661 722e 6469 6d73 7d22 0a20 2020   {var.dims}".   
-00025fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025fc0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00025fd0: 2020 2069 6478 203d 2050 616e 6461 7349     idx = PandasI
-00025fe0: 6e64 6578 2e66 726f 6d5f 7661 7269 6162  ndex.from_variab
-00025ff0: 6c65 7328 7b64 696d 3a20 7661 727d 2c20  les({dim: var}, 
-00026000: 6f70 7469 6f6e 733d 7b7d 290a 2020 2020  options={}).    
-00026010: 2020 2020 2020 2020 2020 2020 6964 785f              idx_
-00026020: 7661 7273 203d 2069 6478 2e63 7265 6174  vars = idx.creat
-00026030: 655f 7661 7269 6162 6c65 7328 7b76 6172  e_variables({var
-00026040: 5f6e 616d 653a 2076 6172 7d29 0a0a 2020  _name: var})..  
-00026050: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00026060: 7472 6963 6b20 746f 2070 7265 7365 7276  trick to preserv
-00026070: 6520 636f 6f72 6469 6e61 7465 206f 7264  e coordinate ord
-00026080: 6572 2069 6e20 7468 6973 2063 6173 650a  er in this case.
-00026090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000260a0: 6966 2064 696d 2069 6e20 7365 6c66 2e5f  if dim in self._
-000260b0: 636f 6f72 645f 6e61 6d65 733a 0a20 2020  coord_names:.   
-000260c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000260d0: 2064 726f 705f 7661 7269 6162 6c65 732e   drop_variables.
-000260e0: 7265 6d6f 7665 2864 696d 290a 2020 2020  remove(dim).    
-000260f0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00026100: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00026110: 2061 7070 656e 643a 0a20 2020 2020 2020   append:.       
-00026120: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00026130: 7265 6e74 5f76 6172 6961 626c 6573 203d  rent_variables =
-00026140: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00026150: 2020 2020 2020 2020 2020 206b 3a20 7365             k: se
-00026160: 6c66 2e5f 7661 7269 6162 6c65 735b 6b5d  lf._variables[k]
-00026170: 2066 6f72 206b 2069 6e20 696e 6465 785f   for k in index_
-00026180: 636f 6f72 645f 6e61 6d65 730a 2020 2020  coord_names.    
-00026190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261a0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-000261b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000261c0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-000261d0: 656e 745f 7661 7269 6162 6c65 7320 3d20  ent_variables = 
-000261e0: 7b7d 0a20 2020 2020 2020 2020 2020 2020  {}.             
-000261f0: 2020 2069 6478 2c20 6964 785f 7661 7273     idx, idx_vars
-00026200: 203d 2050 616e 6461 734d 756c 7469 496e   = PandasMultiIn
-00026210: 6465 782e 6672 6f6d 5f76 6172 6961 626c  dex.from_variabl
-00026220: 6573 5f6d 6179 6265 5f65 7870 616e 6428  es_maybe_expand(
-00026230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026240: 2020 2020 2064 696d 2c0a 2020 2020 2020       dim,.      
-00026250: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-00026260: 7272 656e 745f 7661 7269 6162 6c65 732c  rrent_variables,
-00026270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026280: 2020 2020 207b 6b3a 2073 656c 662e 5f76       {k: self._v
-00026290: 6172 6961 626c 6573 5b6b 5d20 666f 7220  ariables[k] for 
-000262a0: 6b20 696e 2076 6172 5f6e 616d 6573 7d2c  k in var_names},
-000262b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000262c0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-000262d0: 2020 2066 6f72 206e 2069 6e20 6964 782e     for n in idx.
-000262e0: 696e 6465 782e 6e61 6d65 733a 0a20 2020  index.names:.   
-000262f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026300: 2072 6570 6c61 6365 5f64 696d 735b 6e5d   replace_dims[n]
-00026310: 203d 2064 696d 0a0a 2020 2020 2020 2020   = dim..        
-00026320: 2020 2020 6e65 775f 696e 6465 7865 732e      new_indexes.
-00026330: 7570 6461 7465 287b 6b3a 2069 6478 2066  update({k: idx f
-00026340: 6f72 206b 2069 6e20 6964 785f 7661 7273  or k in idx_vars
-00026350: 7d29 0a20 2020 2020 2020 2020 2020 206e  }).            n
-00026360: 6577 5f76 6172 6961 626c 6573 2e75 7064  ew_variables.upd
-00026370: 6174 6528 6964 785f 7661 7273 290a 0a20  ate(idx_vars).. 
-00026380: 2020 2020 2020 2023 2072 652d 6164 6420         # re-add 
-00026390: 6465 696e 6465 7865 6420 636f 6f72 6469  deindexed coordi
-000263a0: 6e61 7465 7320 2863 6f6e 7665 7274 2074  nates (convert t
-000263b0: 6f20 6261 7365 2076 6172 6961 626c 6573  o base variables
-000263c0: 290a 2020 2020 2020 2020 666f 7220 6b20  ).        for k 
-000263d0: 696e 2064 726f 705f 7661 7269 6162 6c65  in drop_variable
-000263e0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-000263f0: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00026400: 2020 2020 6b20 6e6f 7420 696e 206e 6577      k not in new
-00026410: 5f76 6172 6961 626c 6573 0a20 2020 2020  _variables.     
-00026420: 2020 2020 2020 2020 2020 2061 6e64 206b             and k
-00026430: 206e 6f74 2069 6e20 616c 6c5f 7661 725f   not in all_var_
-00026440: 6e61 6d65 730a 2020 2020 2020 2020 2020  names.          
-00026450: 2020 2020 2020 616e 6420 6b20 696e 2073        and k in s
-00026460: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
-00026470: 0a20 2020 2020 2020 2020 2020 2029 3a0a  .            ):.
-00026480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026490: 6e65 775f 7661 7269 6162 6c65 735b 6b5d  new_variables[k]
-000264a0: 203d 2073 656c 662e 5f76 6172 6961 626c   = self._variabl
-000264b0: 6573 5b6b 5d2e 746f 5f62 6173 655f 7661  es[k].to_base_va
-000264c0: 7269 6162 6c65 2829 0a0a 2020 2020 2020  riable()..      
-000264d0: 2020 696e 6465 7865 735f 3a20 6469 6374    indexes_: dict
-000264e0: 5b41 6e79 2c20 496e 6465 785d 203d 207b  [Any, Index] = {
-000264f0: 0a20 2020 2020 2020 2020 2020 206b 3a20  .            k: 
-00026500: 7620 666f 7220 6b2c 2076 2069 6e20 7365  v for k, v in se
-00026510: 6c66 2e5f 696e 6465 7865 732e 6974 656d  lf._indexes.item
-00026520: 7328 2920 6966 206b 206e 6f74 2069 6e20  s() if k not in 
-00026530: 6472 6f70 5f69 6e64 6578 6573 0a20 2020  drop_indexes.   
-00026540: 2020 2020 207d 0a20 2020 2020 2020 2069       }.        i
-00026550: 6e64 6578 6573 5f2e 7570 6461 7465 286e  ndexes_.update(n
-00026560: 6577 5f69 6e64 6578 6573 290a 0a20 2020  ew_indexes)..   
-00026570: 2020 2020 2076 6172 6961 626c 6573 203d       variables =
-00026580: 207b 0a20 2020 2020 2020 2020 2020 206b   {.            k
-00026590: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
-000265a0: 7365 6c66 2e5f 7661 7269 6162 6c65 732e  self._variables.
-000265b0: 6974 656d 7328 2920 6966 206b 206e 6f74  items() if k not
-000265c0: 2069 6e20 6472 6f70 5f76 6172 6961 626c   in drop_variabl
-000265d0: 6573 0a20 2020 2020 2020 207d 0a20 2020  es.        }.   
-000265e0: 2020 2020 2076 6172 6961 626c 6573 2e75       variables.u
-000265f0: 7064 6174 6528 6e65 775f 7661 7269 6162  pdate(new_variab
-00026600: 6c65 7329 0a0a 2020 2020 2020 2020 2320  les)..        # 
-00026610: 7570 6461 7465 2064 696d 656e 7369 6f6e  update dimension
-00026620: 7320 6966 206e 6563 6573 7361 7279 2c20  s if necessary, 
-00026630: 4748 3a20 3335 3132 0a20 2020 2020 2020  GH: 3512.       
-00026640: 2066 6f72 206b 2c20 7620 696e 2076 6172   for k, v in var
-00026650: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
-00026660: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00026670: 6e79 2864 2069 6e20 7265 706c 6163 655f  ny(d in replace_
-00026680: 6469 6d73 2066 6f72 2064 2069 6e20 762e  dims for d in v.
-00026690: 6469 6d73 293a 0a20 2020 2020 2020 2020  dims):.         
-000266a0: 2020 2020 2020 206e 6577 5f64 696d 7320         new_dims 
-000266b0: 3d20 5b72 6570 6c61 6365 5f64 696d 732e  = [replace_dims.
-000266c0: 6765 7428 642c 2064 2920 666f 7220 6420  get(d, d) for d 
-000266d0: 696e 2076 2e64 696d 735d 0a20 2020 2020  in v.dims].     
-000266e0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-000266f0: 626c 6573 5b6b 5d20 3d20 762e 5f72 6570  bles[k] = v._rep
-00026700: 6c61 6365 2864 696d 733d 6e65 775f 6469  lace(dims=new_di
-00026710: 6d73 290a 0a20 2020 2020 2020 2063 6f6f  ms)..        coo
-00026720: 7264 5f6e 616d 6573 203d 2073 656c 662e  rd_names = self.
-00026730: 5f63 6f6f 7264 5f6e 616d 6573 202d 2064  _coord_names - d
-00026740: 726f 705f 7661 7269 6162 6c65 7320 7c20  rop_variables | 
-00026750: 7365 7428 6e65 775f 7661 7269 6162 6c65  set(new_variable
-00026760: 7329 0a0a 2020 2020 2020 2020 7265 7475  s)..        retu
-00026770: 726e 2073 656c 662e 5f72 6570 6c61 6365  rn self._replace
-00026780: 5f77 6974 685f 6e65 775f 6469 6d73 280a  _with_new_dims(.
-00026790: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-000267a0: 6162 6c65 732c 2063 6f6f 7264 5f6e 616d  ables, coord_nam
-000267b0: 6573 3d63 6f6f 7264 5f6e 616d 6573 2c20  es=coord_names, 
-000267c0: 696e 6465 7865 733d 696e 6465 7865 735f  indexes=indexes_
-000267d0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-000267e0: 6465 6620 7265 7365 745f 696e 6465 7828  def reset_index(
-000267f0: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
-00026800: 5f44 6174 6173 6574 2c0a 2020 2020 2020  _Dataset,.      
-00026810: 2020 6469 6d73 5f6f 725f 6c65 7665 6c73    dims_or_levels
-00026820: 3a20 4861 7368 6162 6c65 207c 2053 6571  : Hashable | Seq
-00026830: 7565 6e63 655b 4861 7368 6162 6c65 5d2c  uence[Hashable],
-00026840: 0a20 2020 2020 2020 2064 726f 703a 2062  .        drop: b
-00026850: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-00026860: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
-00026870: 0a20 2020 2020 2020 2022 2222 5265 7365  .        """Rese
-00026880: 7420 7468 6520 7370 6563 6966 6965 6420  t the specified 
-00026890: 696e 6465 7828 6573 2920 6f72 206d 756c  index(es) or mul
-000268a0: 7469 2d69 6e64 6578 206c 6576 656c 2873  ti-index level(s
-000268b0: 292e 0a0a 2020 2020 2020 2020 5468 6973  )...        This
-000268c0: 206c 6567 6163 7920 6d65 7468 6f64 2069   legacy method i
-000268d0: 7320 7370 6563 6966 6963 2074 6f20 7061  s specific to pa
-000268e0: 6e64 6173 2028 6d75 6c74 692d 2969 6e64  ndas (multi-)ind
-000268f0: 6578 6573 2061 6e64 0a20 2020 2020 2020  exes and.       
-00026900: 2031 2d64 696d 656e 7369 6f6e 616c 2022   1-dimensional "
-00026910: 6469 6d65 6e73 696f 6e22 2063 6f6f 7264  dimension" coord
-00026920: 696e 6174 6573 2e20 5365 6520 7468 6520  inates. See the 
-00026930: 6d6f 7265 2067 656e 6572 6963 0a20 2020  more generic.   
-00026940: 2020 2020 203a 7079 3a6d 6574 683a 607e       :py:meth:`~
-00026950: 4461 7461 7365 742e 6472 6f70 5f69 6e64  Dataset.drop_ind
-00026960: 6578 6573 6020 616e 6420 3a70 793a 6d65  exes` and :py:me
-00026970: 7468 3a60 7e44 6174 6173 6574 2e73 6574  th:`~Dataset.set
-00026980: 5f78 696e 6465 7860 0a20 2020 2020 2020  _xindex`.       
-00026990: 206d 6574 686f 6420 746f 2072 6573 7065   method to respe
-000269a0: 6374 6976 656c 7920 6472 6f70 2061 6e64  ctively drop and
-000269b0: 2073 6574 2070 616e 6461 7320 6f72 2063   set pandas or c
-000269c0: 7573 746f 6d20 696e 6465 7865 7320 666f  ustom indexes fo
-000269d0: 720a 2020 2020 2020 2020 6172 6269 7472  r.        arbitr
-000269e0: 6172 7920 636f 6f72 6469 6e61 7465 732e  ary coordinates.
-000269f0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00026a00: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-00026a10: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00026a20: 6469 6d73 5f6f 725f 6c65 7665 6c73 203a  dims_or_levels :
-00026a30: 2048 6173 6861 626c 6520 6f72 2053 6571   Hashable or Seq
-00026a40: 7565 6e63 6520 6f66 2048 6173 6861 626c  uence of Hashabl
-00026a50: 650a 2020 2020 2020 2020 2020 2020 4e61  e.            Na
-00026a60: 6d65 2873 2920 6f66 2074 6865 2064 696d  me(s) of the dim
-00026a70: 656e 7369 6f6e 2873 2920 616e 642f 6f72  ension(s) and/or
-00026a80: 206d 756c 7469 2d69 6e64 6578 206c 6576   multi-index lev
-00026a90: 656c 2873 2920 7468 6174 2077 696c 6c0a  el(s) that will.
-00026aa0: 2020 2020 2020 2020 2020 2020 6265 2072              be r
-00026ab0: 6573 6574 2e0a 2020 2020 2020 2020 6472  eset..        dr
-00026ac0: 6f70 203a 2062 6f6f 6c2c 2064 6566 6175  op : bool, defau
-00026ad0: 6c74 3a20 4661 6c73 650a 2020 2020 2020  lt: False.      
-00026ae0: 2020 2020 2020 4966 2054 7275 652c 2072        If True, r
-00026af0: 656d 6f76 6520 7468 6520 7370 6563 6966  emove the specif
-00026b00: 6965 6420 696e 6465 7865 7320 616e 642f  ied indexes and/
-00026b10: 6f72 206d 756c 7469 2d69 6e64 6578 206c  or multi-index l
-00026b20: 6576 656c 730a 2020 2020 2020 2020 2020  evels.          
-00026b30: 2020 696e 7374 6561 6420 6f66 2065 7874    instead of ext
-00026b40: 7261 6374 696e 6720 7468 656d 2061 7320  racting them as 
-00026b50: 6e65 7720 636f 6f72 6469 6e61 7465 7320  new coordinates 
-00026b60: 2864 6566 6175 6c74 3a20 4661 6c73 6529  (default: False)
-00026b70: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00026b80: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-00026b90: 2d2d 0a20 2020 2020 2020 206f 626a 203a  --.        obj :
-00026ba0: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
-00026bb0: 2020 2020 2041 6e6f 7468 6572 2064 6174       Another dat
-00026bc0: 6173 6574 2c20 7769 7468 2074 6869 7320  aset, with this 
-00026bd0: 6461 7461 7365 7427 7320 6461 7461 2062  dataset's data b
-00026be0: 7574 2072 6570 6c61 6365 6420 636f 6f72  ut replaced coor
-00026bf0: 6469 6e61 7465 732e 0a0a 2020 2020 2020  dinates...      
-00026c00: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
-00026c10: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-00026c20: 2020 2020 4461 7461 7365 742e 7365 745f      Dataset.set_
-00026c30: 696e 6465 780a 2020 2020 2020 2020 4461  index.        Da
-00026c40: 7461 7365 742e 7365 745f 7869 6e64 6578  taset.set_xindex
-00026c50: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
-00026c60: 2e64 726f 705f 696e 6465 7865 730a 2020  .drop_indexes.  
-00026c70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00026c80: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00026c90: 6469 6d73 5f6f 725f 6c65 7665 6c73 2c20  dims_or_levels, 
-00026ca0: 7374 7229 206f 7220 6e6f 7420 6973 696e  str) or not isin
-00026cb0: 7374 616e 6365 2864 696d 735f 6f72 5f6c  stance(dims_or_l
-00026cc0: 6576 656c 732c 2053 6571 7565 6e63 6529  evels, Sequence)
-00026cd0: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
-00026ce0: 6d73 5f6f 725f 6c65 7665 6c73 203d 205b  ms_or_levels = [
-00026cf0: 6469 6d73 5f6f 725f 6c65 7665 6c73 5d0a  dims_or_levels].
-00026d00: 0a20 2020 2020 2020 2069 6e76 616c 6964  .        invalid
-00026d10: 5f63 6f6f 7264 7320 3d20 7365 7428 6469  _coords = set(di
-00026d20: 6d73 5f6f 725f 6c65 7665 6c73 2920 2d20  ms_or_levels) - 
-00026d30: 7365 7428 7365 6c66 2e5f 696e 6465 7865  set(self._indexe
-00026d40: 7329 0a20 2020 2020 2020 2069 6620 696e  s).        if in
-00026d50: 7661 6c69 645f 636f 6f72 6473 3a0a 2020  valid_coords:.  
-00026d60: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00026d70: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00026d80: 2020 2020 2020 2020 2020 2020 6622 7b74              f"{t
-00026d90: 7570 6c65 2869 6e76 616c 6964 5f63 6f6f  uple(invalid_coo
-00026da0: 7264 7329 7d20 6172 6520 6e6f 7420 636f  rds)} are not co
-00026db0: 6f72 6469 6e61 7465 7320 7769 7468 2061  ordinates with a
-00026dc0: 6e20 696e 6465 7822 0a20 2020 2020 2020  n index".       
-00026dd0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00026de0: 6472 6f70 5f69 6e64 6578 6573 3a20 7365  drop_indexes: se
-00026df0: 745b 4861 7368 6162 6c65 5d20 3d20 7365  t[Hashable] = se
-00026e00: 7428 290a 2020 2020 2020 2020 6472 6f70  t().        drop
-00026e10: 5f76 6172 6961 626c 6573 3a20 7365 745b  _variables: set[
-00026e20: 4861 7368 6162 6c65 5d20 3d20 7365 7428  Hashable] = set(
-00026e30: 290a 2020 2020 2020 2020 7365 656e 3a20  ).        seen: 
-00026e40: 7365 745b 496e 6465 785d 203d 2073 6574  set[Index] = set
-00026e50: 2829 0a20 2020 2020 2020 206e 6577 5f69  ().        new_i
-00026e60: 6e64 6578 6573 3a20 6469 6374 5b48 6173  ndexes: dict[Has
-00026e70: 6861 626c 652c 2049 6e64 6578 5d20 3d20  hable, Index] = 
-00026e80: 7b7d 0a20 2020 2020 2020 206e 6577 5f76  {}.        new_v
-00026e90: 6172 6961 626c 6573 3a20 6469 6374 5b48  ariables: dict[H
-00026ea0: 6173 6861 626c 652c 2056 6172 6961 626c  ashable, Variabl
-00026eb0: 655d 203d 207b 7d0a 0a20 2020 2020 2020  e] = {}..       
-00026ec0: 2064 6566 2064 726f 705f 6f72 5f63 6f6e   def drop_or_con
-00026ed0: 7665 7274 2876 6172 5f6e 616d 6573 293a  vert(var_names):
-00026ee0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00026ef0: 6472 6f70 3a0a 2020 2020 2020 2020 2020  drop:.          
-00026f00: 2020 2020 2020 6472 6f70 5f76 6172 6961        drop_varia
-00026f10: 626c 6573 2e75 7064 6174 6528 7661 725f  bles.update(var_
-00026f20: 6e61 6d65 7329 0a20 2020 2020 2020 2020  names).         
-00026f30: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00026f40: 2020 2020 2020 2020 2062 6173 655f 7661           base_va
-00026f50: 7273 203d 207b 0a20 2020 2020 2020 2020  rs = {.         
-00026f60: 2020 2020 2020 2020 2020 206b 3a20 7365             k: se
-00026f70: 6c66 2e5f 7661 7269 6162 6c65 735b 6b5d  lf._variables[k]
-00026f80: 2e74 6f5f 6261 7365 5f76 6172 6961 626c  .to_base_variabl
-00026f90: 6528 2920 666f 7220 6b20 696e 2076 6172  e() for k in var
-00026fa0: 5f6e 616d 6573 0a20 2020 2020 2020 2020  _names.         
-00026fb0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00026fc0: 2020 2020 2020 2020 206e 6577 5f76 6172           new_var
-00026fd0: 6961 626c 6573 2e75 7064 6174 6528 6261  iables.update(ba
-00026fe0: 7365 5f76 6172 7329 0a0a 2020 2020 2020  se_vars)..      
-00026ff0: 2020 666f 7220 6e61 6d65 2069 6e20 6469    for name in di
-00027000: 6d73 5f6f 725f 6c65 7665 6c73 3a0a 2020  ms_or_levels:.  
-00027010: 2020 2020 2020 2020 2020 696e 6465 7820            index 
-00027020: 3d20 7365 6c66 2e5f 696e 6465 7865 735b  = self._indexes[
-00027030: 6e61 6d65 5d0a 0a20 2020 2020 2020 2020  name]..         
-00027040: 2020 2069 6620 696e 6465 7820 696e 2073     if index in s
-00027050: 6565 6e3a 0a20 2020 2020 2020 2020 2020  een:.           
-00027060: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-00027070: 2020 2020 2020 2020 2020 7365 656e 2e61            seen.a
-00027080: 6464 2869 6e64 6578 290a 0a20 2020 2020  dd(index)..     
-00027090: 2020 2020 2020 2069 6478 5f76 6172 5f6e         idx_var_n
-000270a0: 616d 6573 203d 2073 6574 2873 656c 662e  ames = set(self.
-000270b0: 7869 6e64 6578 6573 2e67 6574 5f61 6c6c  xindexes.get_all
-000270c0: 5f63 6f6f 7264 7328 6e61 6d65 2929 0a20  _coords(name)). 
-000270d0: 2020 2020 2020 2020 2020 2064 726f 705f             drop_
-000270e0: 696e 6465 7865 732e 7570 6461 7465 2869  indexes.update(i
-000270f0: 6478 5f76 6172 5f6e 616d 6573 290a 0a20  dx_var_names).. 
-00027100: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00027110: 696e 7374 616e 6365 2869 6e64 6578 2c20  instance(index, 
-00027120: 5061 6e64 6173 4d75 6c74 6949 6e64 6578  PandasMultiIndex
-00027130: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00027140: 2020 2023 2073 7065 6369 616c 2063 6173     # special cas
-00027150: 6520 666f 7220 7064 2e4d 756c 7469 496e  e for pd.MultiIn
-00027160: 6465 780a 2020 2020 2020 2020 2020 2020  dex.            
-00027170: 2020 2020 6c65 7665 6c5f 6e61 6d65 7320      level_names 
-00027180: 3d20 696e 6465 782e 696e 6465 782e 6e61  = index.index.na
-00027190: 6d65 730a 2020 2020 2020 2020 2020 2020  mes.            
-000271a0: 2020 2020 6b65 6570 5f6c 6576 656c 5f76      keep_level_v
-000271b0: 6172 7320 3d20 7b0a 2020 2020 2020 2020  ars = {.        
-000271c0: 2020 2020 2020 2020 2020 2020 6b3a 2073              k: s
-000271d0: 656c 662e 5f76 6172 6961 626c 6573 5b6b  elf._variables[k
-000271e0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000271f0: 2020 2020 2020 666f 7220 6b20 696e 206c        for k in l
-00027200: 6576 656c 5f6e 616d 6573 0a20 2020 2020  evel_names.     
-00027210: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00027220: 6620 6b20 6e6f 7420 696e 2064 696d 735f  f k not in dims_
-00027230: 6f72 5f6c 6576 656c 730a 2020 2020 2020  or_levels.      
-00027240: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
-00027250: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00027260: 696e 6465 782e 6469 6d20 6e6f 7420 696e  index.dim not in
-00027270: 2064 696d 735f 6f72 5f6c 6576 656c 7320   dims_or_levels 
-00027280: 616e 6420 6b65 6570 5f6c 6576 656c 5f76  and keep_level_v
-00027290: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
-000272a0: 2020 2020 2020 2020 2023 2064 6f20 6e6f           # do no
-000272b0: 7420 6472 6f70 2074 6865 206d 756c 7469  t drop the multi
-000272c0: 2d69 6e64 6578 2063 6f6d 706c 6574 656c  -index completel
-000272d0: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
-000272e0: 2020 2020 2020 2320 696e 7374 6561 6420        # instead 
-000272f0: 7265 706c 6163 6520 6974 2062 7920 6120  replace it by a 
-00027300: 6e65 7720 286d 756c 7469 2d29 696e 6465  new (multi-)inde
-00027310: 7820 7769 7468 2064 726f 7070 6564 206c  x with dropped l
-00027320: 6576 656c 2873 290a 2020 2020 2020 2020  evel(s).        
-00027330: 2020 2020 2020 2020 2020 2020 6964 7820              idx 
-00027340: 3d20 696e 6465 782e 6b65 6570 5f6c 6576  = index.keep_lev
-00027350: 656c 7328 6b65 6570 5f6c 6576 656c 5f76  els(keep_level_v
-00027360: 6172 7329 0a20 2020 2020 2020 2020 2020  ars).           
-00027370: 2020 2020 2020 2020 2069 6478 5f76 6172           idx_var
-00027380: 7320 3d20 6964 782e 6372 6561 7465 5f76  s = idx.create_v
-00027390: 6172 6961 626c 6573 286b 6565 705f 6c65  ariables(keep_le
-000273a0: 7665 6c5f 7661 7273 290a 2020 2020 2020  vel_vars).      
-000273b0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-000273c0: 775f 696e 6465 7865 732e 7570 6461 7465  w_indexes.update
-000273d0: 287b 6b3a 2069 6478 2066 6f72 206b 2069  ({k: idx for k i
-000273e0: 6e20 6964 785f 7661 7273 7d29 0a20 2020  n idx_vars}).   
-000273f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027400: 206e 6577 5f76 6172 6961 626c 6573 2e75   new_variables.u
-00027410: 7064 6174 6528 6964 785f 7661 7273 290a  pdate(idx_vars).
-00027420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027430: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-00027440: 7461 6e63 6528 6964 782c 2050 616e 6461  tance(idx, Panda
-00027450: 734d 756c 7469 496e 6465 7829 3a0a 2020  sMultiIndex):.  
-00027460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027470: 2020 2020 2020 2320 6d75 6c74 692d 696e        # multi-in
-00027480: 6465 7820 7265 6475 6365 6420 746f 2073  dex reduced to s
-00027490: 696e 676c 6520 696e 6465 780a 2020 2020  ingle index.    
+00020c60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00020c70: 6e61 6d65 2069 6e20 7661 7269 6162 6c65  name in variable
+00020c80: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00020c90: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00020ca0: 726f 7228 6622 7468 6520 6e65 7720 6e61  ror(f"the new na
+00020cb0: 6d65 207b 6e61 6d65 2172 7d20 636f 6e66  me {name!r} conf
+00020cc0: 6c69 6374 7322 290a 2020 2020 2020 2020  licts").        
+00020cd0: 2020 2020 7661 7269 6162 6c65 735b 6e61      variables[na
+00020ce0: 6d65 5d20 3d20 7661 720a 2020 2020 2020  me] = var.      
+00020cf0: 2020 2020 2020 6966 206b 2069 6e20 7365        if k in se
+00020d00: 6c66 2e5f 636f 6f72 645f 6e61 6d65 733a  lf._coord_names:
+00020d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020d20: 2063 6f6f 7264 5f6e 616d 6573 2e61 6464   coord_names.add
+00020d30: 286e 616d 6529 0a20 2020 2020 2020 2072  (name).        r
+00020d40: 6574 7572 6e20 7661 7269 6162 6c65 732c  eturn variables,
+00020d50: 2063 6f6f 7264 5f6e 616d 6573 0a0a 2020   coord_names..  
+00020d60: 2020 6465 6620 5f72 656e 616d 655f 6469    def _rename_di
+00020d70: 6d73 2873 656c 662c 206e 616d 655f 6469  ms(self, name_di
+00020d80: 6374 3a20 4d61 7070 696e 675b 416e 792c  ct: Mapping[Any,
+00020d90: 2048 6173 6861 626c 655d 2920 2d3e 2064   Hashable]) -> d
+00020da0: 6963 745b 4861 7368 6162 6c65 2c20 696e  ict[Hashable, in
+00020db0: 745d 3a0a 2020 2020 2020 2020 7265 7475  t]:.        retu
+00020dc0: 726e 207b 6e61 6d65 5f64 6963 742e 6765  rn {name_dict.ge
+00020dd0: 7428 6b2c 206b 293a 2076 2066 6f72 206b  t(k, k): v for k
+00020de0: 2c20 7620 696e 2073 656c 662e 6469 6d73  , v in self.dims
+00020df0: 2e69 7465 6d73 2829 7d0a 0a20 2020 2064  .items()}..    d
+00020e00: 6566 205f 7265 6e61 6d65 5f69 6e64 6578  ef _rename_index
+00020e10: 6573 280a 2020 2020 2020 2020 7365 6c66  es(.        self
+00020e20: 2c20 6e61 6d65 5f64 6963 743a 204d 6170  , name_dict: Map
+00020e30: 7069 6e67 5b41 6e79 2c20 4861 7368 6162  ping[Any, Hashab
+00020e40: 6c65 5d2c 2064 696d 735f 6469 6374 3a20  le], dims_dict: 
+00020e50: 4d61 7070 696e 675b 416e 792c 2048 6173  Mapping[Any, Has
+00020e60: 6861 626c 655d 0a20 2020 2029 202d 3e20  hable].    ) -> 
+00020e70: 7475 706c 655b 6469 6374 5b48 6173 6861  tuple[dict[Hasha
+00020e80: 626c 652c 2049 6e64 6578 5d2c 2064 6963  ble, Index], dic
+00020e90: 745b 4861 7368 6162 6c65 2c20 5661 7269  t[Hashable, Vari
+00020ea0: 6162 6c65 5d5d 3a0a 2020 2020 2020 2020  able]]:.        
+00020eb0: 6966 206e 6f74 2073 656c 662e 5f69 6e64  if not self._ind
+00020ec0: 6578 6573 3a0a 2020 2020 2020 2020 2020  exes:.          
+00020ed0: 2020 7265 7475 726e 207b 7d2c 207b 7d0a    return {}, {}.
+00020ee0: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
+00020ef0: 203d 207b 7d0a 2020 2020 2020 2020 7661   = {}.        va
+00020f00: 7269 6162 6c65 7320 3d20 7b7d 0a0a 2020  riables = {}..  
+00020f10: 2020 2020 2020 666f 7220 696e 6465 782c        for index,
+00020f20: 2063 6f6f 7264 5f6e 616d 6573 2069 6e20   coord_names in 
+00020f30: 7365 6c66 2e78 696e 6465 7865 732e 6772  self.xindexes.gr
+00020f40: 6f75 705f 6279 5f69 6e64 6578 2829 3a0a  oup_by_index():.
+00020f50: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00020f60: 696e 6465 7820 3d20 696e 6465 782e 7265  index = index.re
+00020f70: 6e61 6d65 286e 616d 655f 6469 6374 2c20  name(name_dict, 
+00020f80: 6469 6d73 5f64 6963 7429 0a20 2020 2020  dims_dict).     
+00020f90: 2020 2020 2020 206e 6577 5f63 6f6f 7264         new_coord
+00020fa0: 5f6e 616d 6573 203d 205b 6e61 6d65 5f64  _names = [name_d
+00020fb0: 6963 742e 6765 7428 6b2c 206b 2920 666f  ict.get(k, k) fo
+00020fc0: 7220 6b20 696e 2063 6f6f 7264 5f6e 616d  r k in coord_nam
+00020fd0: 6573 5d0a 2020 2020 2020 2020 2020 2020  es].            
+00020fe0: 696e 6465 7865 732e 7570 6461 7465 287b  indexes.update({
+00020ff0: 6b3a 206e 6577 5f69 6e64 6578 2066 6f72  k: new_index for
+00021000: 206b 2069 6e20 6e65 775f 636f 6f72 645f   k in new_coord_
+00021010: 6e61 6d65 737d 290a 2020 2020 2020 2020  names}).        
+00021020: 2020 2020 6e65 775f 696e 6465 785f 7661      new_index_va
+00021030: 7273 203d 206e 6577 5f69 6e64 6578 2e63  rs = new_index.c
+00021040: 7265 6174 655f 7661 7269 6162 6c65 7328  reate_variables(
+00021050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021060: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00021070: 2020 2020 2020 206e 6577 3a20 7365 6c66         new: self
+00021080: 2e5f 7661 7269 6162 6c65 735b 6f6c 645d  ._variables[old]
+00021090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000210a0: 2020 2020 2066 6f72 206f 6c64 2c20 6e65       for old, ne
+000210b0: 7720 696e 207a 6970 2863 6f6f 7264 5f6e  w in zip(coord_n
+000210c0: 616d 6573 2c20 6e65 775f 636f 6f72 645f  ames, new_coord_
+000210d0: 6e61 6d65 7329 0a20 2020 2020 2020 2020  names).         
+000210e0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000210f0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00021100: 2020 2076 6172 6961 626c 6573 2e75 7064     variables.upd
+00021110: 6174 6528 6e65 775f 696e 6465 785f 7661  ate(new_index_va
+00021120: 7273 290a 0a20 2020 2020 2020 2072 6574  rs)..        ret
+00021130: 7572 6e20 696e 6465 7865 732c 2076 6172  urn indexes, var
+00021140: 6961 626c 6573 0a0a 2020 2020 6465 6620  iables..    def 
+00021150: 5f72 656e 616d 655f 616c 6c28 0a20 2020  _rename_all(.   
+00021160: 2020 2020 2073 656c 662c 206e 616d 655f       self, name_
+00021170: 6469 6374 3a20 4d61 7070 696e 675b 416e  dict: Mapping[An
+00021180: 792c 2048 6173 6861 626c 655d 2c20 6469  y, Hashable], di
+00021190: 6d73 5f64 6963 743a 204d 6170 7069 6e67  ms_dict: Mapping
+000211a0: 5b41 6e79 2c20 4861 7368 6162 6c65 5d0a  [Any, Hashable].
+000211b0: 2020 2020 2920 2d3e 2074 7570 6c65 5b0a      ) -> tuple[.
+000211c0: 2020 2020 2020 2020 6469 6374 5b48 6173          dict[Has
+000211d0: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
+000211e0: 2c0a 2020 2020 2020 2020 7365 745b 4861  ,.        set[Ha
+000211f0: 7368 6162 6c65 5d2c 0a20 2020 2020 2020  shable],.       
+00021200: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
+00021210: 696e 745d 2c0a 2020 2020 2020 2020 6469  int],.        di
+00021220: 6374 5b48 6173 6861 626c 652c 2049 6e64  ct[Hashable, Ind
+00021230: 6578 5d2c 0a20 2020 205d 3a0a 2020 2020  ex],.    ]:.    
+00021240: 2020 2020 7661 7269 6162 6c65 732c 2063      variables, c
+00021250: 6f6f 7264 5f6e 616d 6573 203d 2073 656c  oord_names = sel
+00021260: 662e 5f72 656e 616d 655f 7661 7273 286e  f._rename_vars(n
+00021270: 616d 655f 6469 6374 2c20 6469 6d73 5f64  ame_dict, dims_d
+00021280: 6963 7429 0a20 2020 2020 2020 2064 696d  ict).        dim
+00021290: 7320 3d20 7365 6c66 2e5f 7265 6e61 6d65  s = self._rename
+000212a0: 5f64 696d 7328 6469 6d73 5f64 6963 7429  _dims(dims_dict)
+000212b0: 0a0a 2020 2020 2020 2020 696e 6465 7865  ..        indexe
+000212c0: 732c 2069 6e64 6578 5f76 6172 7320 3d20  s, index_vars = 
+000212d0: 7365 6c66 2e5f 7265 6e61 6d65 5f69 6e64  self._rename_ind
+000212e0: 6578 6573 286e 616d 655f 6469 6374 2c20  exes(name_dict, 
+000212f0: 6469 6d73 5f64 6963 7429 0a20 2020 2020  dims_dict).     
+00021300: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
+00021310: 6b3a 2069 6e64 6578 5f76 6172 732e 6765  k: index_vars.ge
+00021320: 7428 6b2c 2076 2920 666f 7220 6b2c 2076  t(k, v) for k, v
+00021330: 2069 6e20 7661 7269 6162 6c65 732e 6974   in variables.it
+00021340: 656d 7328 297d 0a0a 2020 2020 2020 2020  ems()}..        
+00021350: 7265 7475 726e 2076 6172 6961 626c 6573  return variables
+00021360: 2c20 636f 6f72 645f 6e61 6d65 732c 2064  , coord_names, d
+00021370: 696d 732c 2069 6e64 6578 6573 0a0a 2020  ims, indexes..  
+00021380: 2020 6465 6620 5f72 656e 616d 6528 0a20    def _rename(. 
+00021390: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
+000213a0: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
+000213b0: 6e61 6d65 5f64 6963 743a 204d 6170 7069  name_dict: Mappi
+000213c0: 6e67 5b41 6e79 2c20 4861 7368 6162 6c65  ng[Any, Hashable
+000213d0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+000213e0: 0a20 2020 2020 2020 202a 2a6e 616d 6573  .        **names
+000213f0: 3a20 4861 7368 6162 6c65 2c0a 2020 2020  : Hashable,.    
+00021400: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+00021410: 2020 2020 2020 2020 2222 2241 6c73 6f20          """Also 
+00021420: 7573 6564 2069 6e74 6572 6e61 6c6c 7920  used internally 
+00021430: 6279 2044 6174 6141 7272 6179 2073 6f20  by DataArray so 
+00021440: 7468 6174 2074 6865 2077 6172 6e69 6e67  that the warning
+00021450: 2028 6966 2061 6e79 290a 2020 2020 2020   (if any).      
+00021460: 2020 6973 2072 6169 7365 6420 6174 2074    is raised at t
+00021470: 6865 2072 6967 6874 2073 7461 636b 206c  he right stack l
+00021480: 6576 656c 2e0a 2020 2020 2020 2020 2222  evel..        ""
+00021490: 220a 2020 2020 2020 2020 6e61 6d65 5f64  ".        name_d
+000214a0: 6963 7420 3d20 6569 7468 6572 5f64 6963  ict = either_dic
+000214b0: 745f 6f72 5f6b 7761 7267 7328 6e61 6d65  t_or_kwargs(name
+000214c0: 5f64 6963 742c 206e 616d 6573 2c20 2272  _dict, names, "r
+000214d0: 656e 616d 6522 290a 2020 2020 2020 2020  ename").        
+000214e0: 666f 7220 6b20 696e 206e 616d 655f 6469  for k in name_di
+000214f0: 6374 2e6b 6579 7328 293a 0a20 2020 2020  ct.keys():.     
+00021500: 2020 2020 2020 2069 6620 6b20 6e6f 7420         if k not 
+00021510: 696e 2073 656c 6620 616e 6420 6b20 6e6f  in self and k no
+00021520: 7420 696e 2073 656c 662e 6469 6d73 3a0a  t in self.dims:.
+00021530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021540: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00021550: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00021560: 2020 2020 2020 6622 6361 6e6e 6f74 2072        f"cannot r
+00021570: 656e 616d 6520 7b6b 2172 7d20 6265 6361  ename {k!r} beca
+00021580: 7573 6520 6974 2069 7320 6e6f 7420 6120  use it is not a 
+00021590: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000215a0: 2020 2020 2020 2276 6172 6961 626c 6520        "variable 
+000215b0: 6f72 2064 696d 656e 7369 6f6e 2069 6e20  or dimension in 
+000215c0: 7468 6973 2064 6174 6173 6574 220a 2020  this dataset".  
+000215d0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000215e0: 0a20 2020 2020 2020 2020 2020 2063 7265  .            cre
+000215f0: 6174 655f 6469 6d5f 636f 6f72 6420 3d20  ate_dim_coord = 
+00021600: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00021610: 2020 6e65 775f 6b20 3d20 6e61 6d65 5f64    new_k = name_d
+00021620: 6963 745b 6b5d 0a0a 2020 2020 2020 2020  ict[k]..        
+00021630: 2020 2020 6966 206b 2069 6e20 7365 6c66      if k in self
+00021640: 2e64 696d 7320 616e 6420 6e65 775f 6b20  .dims and new_k 
+00021650: 696e 2073 656c 662e 5f63 6f6f 7264 5f6e  in self._coord_n
+00021660: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+00021670: 2020 2020 2020 636f 6f72 645f 6469 6d73        coord_dims
+00021680: 203d 2073 656c 662e 5f76 6172 6961 626c   = self._variabl
+00021690: 6573 5b6e 616d 655f 6469 6374 5b6b 5d5d  es[name_dict[k]]
+000216a0: 2e64 696d 730a 2020 2020 2020 2020 2020  .dims.          
+000216b0: 2020 2020 2020 6966 2063 6f6f 7264 5f64        if coord_d
+000216c0: 696d 7320 3d3d 2028 6b2c 293a 0a20 2020  ims == (k,):.   
+000216d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000216e0: 2063 7265 6174 655f 6469 6d5f 636f 6f72   create_dim_coor
+000216f0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+00021700: 2020 2020 2065 6c69 6620 6b20 696e 2073       elif k in s
+00021710: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
+00021720: 2061 6e64 206e 6577 5f6b 2069 6e20 7365   and new_k in se
+00021730: 6c66 2e64 696d 733a 0a20 2020 2020 2020  lf.dims:.       
+00021740: 2020 2020 2020 2020 2063 6f6f 7264 5f64           coord_d
+00021750: 696d 7320 3d20 7365 6c66 2e5f 7661 7269  ims = self._vari
+00021760: 6162 6c65 735b 6b5d 2e64 696d 730a 2020  ables[k].dims.  
+00021770: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00021780: 2063 6f6f 7264 5f64 696d 7320 3d3d 2028   coord_dims == (
+00021790: 6e65 775f 6b2c 293a 0a20 2020 2020 2020  new_k,):.       
+000217a0: 2020 2020 2020 2020 2020 2020 2063 7265               cre
+000217b0: 6174 655f 6469 6d5f 636f 6f72 6420 3d20  ate_dim_coord = 
+000217c0: 5472 7565 0a0a 2020 2020 2020 2020 2020  True..          
+000217d0: 2020 6966 2063 7265 6174 655f 6469 6d5f    if create_dim_
+000217e0: 636f 6f72 643a 0a20 2020 2020 2020 2020  coord:.         
+000217f0: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
+00021800: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
+00021810: 2020 2020 2020 2020 2020 6622 7265 6e61            f"rena
+00021820: 6d65 207b 6b21 727d 2074 6f20 7b6e 616d  me {k!r} to {nam
+00021830: 655f 6469 6374 5b6b 5d21 727d 2064 6f65  e_dict[k]!r} doe
+00021840: 7320 6e6f 7420 6372 6561 7465 2061 6e20  s not create an 
+00021850: 696e 6465 7820 220a 2020 2020 2020 2020  index ".        
+00021860: 2020 2020 2020 2020 2020 2020 2261 6e79              "any
+00021870: 6d6f 7265 2e20 5472 7920 7573 696e 6720  more. Try using 
+00021880: 7377 6170 5f64 696d 7320 696e 7374 6561  swap_dims instea
+00021890: 6420 6f72 2075 7365 2073 6574 5f69 6e64  d or use set_ind
+000218a0: 6578 2022 0a20 2020 2020 2020 2020 2020  ex ".           
+000218b0: 2020 2020 2020 2020 2022 6166 7465 7220           "after 
+000218c0: 7265 6e61 6d65 2074 6f20 6372 6561 7465  rename to create
+000218d0: 2061 6e20 696e 6465 7865 6420 636f 6f72   an indexed coor
+000218e0: 6469 6e61 7465 2e22 2c0a 2020 2020 2020  dinate.",.      
+000218f0: 2020 2020 2020 2020 2020 2020 2020 5573                Us
+00021900: 6572 5761 726e 696e 672c 0a20 2020 2020  erWarning,.     
+00021910: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00021920: 7461 636b 6c65 7665 6c3d 332c 0a20 2020  tacklevel=3,.   
+00021930: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+00021940: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+00021950: 732c 2063 6f6f 7264 5f6e 616d 6573 2c20  s, coord_names, 
+00021960: 6469 6d73 2c20 696e 6465 7865 7320 3d20  dims, indexes = 
+00021970: 7365 6c66 2e5f 7265 6e61 6d65 5f61 6c6c  self._rename_all
+00021980: 280a 2020 2020 2020 2020 2020 2020 6e61  (.            na
+00021990: 6d65 5f64 6963 743d 6e61 6d65 5f64 6963  me_dict=name_dic
+000219a0: 742c 2064 696d 735f 6469 6374 3d6e 616d  t, dims_dict=nam
+000219b0: 655f 6469 6374 0a20 2020 2020 2020 2029  e_dict.        )
+000219c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000219d0: 7365 6c66 2e5f 7265 706c 6163 6528 7661  self._replace(va
+000219e0: 7269 6162 6c65 732c 2063 6f6f 7264 5f6e  riables, coord_n
+000219f0: 616d 6573 2c20 6469 6d73 3d64 696d 732c  ames, dims=dims,
+00021a00: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
+00021a10: 290a 0a20 2020 2064 6566 2072 656e 616d  )..    def renam
+00021a20: 6528 0a20 2020 2020 2020 2073 656c 663a  e(.        self:
+00021a30: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
+00021a40: 2020 2020 6e61 6d65 5f64 6963 743a 204d      name_dict: M
+00021a50: 6170 7069 6e67 5b41 6e79 2c20 4861 7368  apping[Any, Hash
+00021a60: 6162 6c65 5d20 7c20 4e6f 6e65 203d 204e  able] | None = N
+00021a70: 6f6e 652c 0a20 2020 2020 2020 202a 2a6e  one,.        **n
+00021a80: 616d 6573 3a20 4861 7368 6162 6c65 2c0a  ames: Hashable,.
+00021a90: 2020 2020 2920 2d3e 2054 5f44 6174 6173      ) -> T_Datas
+00021aa0: 6574 3a0a 2020 2020 2020 2020 2222 2252  et:.        """R
+00021ab0: 6574 7572 6e73 2061 206e 6577 206f 626a  eturns a new obj
+00021ac0: 6563 7420 7769 7468 2072 656e 616d 6564  ect with renamed
+00021ad0: 2076 6172 6961 626c 6573 2c20 636f 6f72   variables, coor
+00021ae0: 6469 6e61 7465 7320 616e 6420 6469 6d65  dinates and dime
+00021af0: 6e73 696f 6e73 2e0a 0a20 2020 2020 2020  nsions...       
+00021b00: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00021b10: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00021b20: 2020 2020 2020 206e 616d 655f 6469 6374         name_dict
+00021b30: 203a 2064 6963 742d 6c69 6b65 2c20 6f70   : dict-like, op
+00021b40: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00021b50: 2020 2044 6963 7469 6f6e 6172 7920 7768     Dictionary wh
+00021b60: 6f73 6520 6b65 7973 2061 7265 2063 7572  ose keys are cur
+00021b70: 7265 6e74 2076 6172 6961 626c 652c 2063  rent variable, c
+00021b80: 6f6f 7264 696e 6174 6520 6f72 2064 696d  oordinate or dim
+00021b90: 656e 7369 6f6e 206e 616d 6573 2061 6e64  ension names and
+00021ba0: 0a20 2020 2020 2020 2020 2020 2077 686f  .            who
+00021bb0: 7365 2076 616c 7565 7320 6172 6520 7468  se values are th
+00021bc0: 6520 6465 7369 7265 6420 6e61 6d65 732e  e desired names.
+00021bd0: 0a20 2020 2020 2020 202a 2a6e 616d 6573  .        **names
+00021be0: 203a 206f 7074 696f 6e61 6c0a 2020 2020   : optional.    
+00021bf0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+00021c00: 666f 726d 206f 6620 6060 6e61 6d65 5f64  form of ``name_d
+00021c10: 6963 7460 602e 0a20 2020 2020 2020 2020  ict``..         
+00021c20: 2020 204f 6e65 206f 6620 6e61 6d65 5f64     One of name_d
+00021c30: 6963 7420 6f72 206e 616d 6573 206d 7573  ict or names mus
+00021c40: 7420 6265 2070 726f 7669 6465 642e 0a0a  t be provided...
+00021c50: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+00021c60: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+00021c70: 2020 2020 2020 2020 7265 6e61 6d65 6420          renamed 
+00021c80: 3a20 4461 7461 7365 740a 2020 2020 2020  : Dataset.      
+00021c90: 2020 2020 2020 4461 7461 7365 7420 7769        Dataset wi
+00021ca0: 7468 2072 656e 616d 6564 2076 6172 6961  th renamed varia
+00021cb0: 626c 6573 2c20 636f 6f72 6469 6e61 7465  bles, coordinate
+00021cc0: 7320 616e 6420 6469 6d65 6e73 696f 6e73  s and dimensions
+00021cd0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
+00021ce0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+00021cf0: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
+00021d00: 6173 6574 2e73 7761 705f 6469 6d73 0a20  aset.swap_dims. 
+00021d10: 2020 2020 2020 2044 6174 6173 6574 2e72         Dataset.r
+00021d20: 656e 616d 655f 7661 7273 0a20 2020 2020  ename_vars.     
+00021d30: 2020 2044 6174 6173 6574 2e72 656e 616d     Dataset.renam
+00021d40: 655f 6469 6d73 0a20 2020 2020 2020 2044  e_dims.        D
+00021d50: 6174 6141 7272 6179 2e72 656e 616d 650a  ataArray.rename.
+00021d60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00021d70: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00021d80: 5f72 656e 616d 6528 6e61 6d65 5f64 6963  _rename(name_dic
+00021d90: 743d 6e61 6d65 5f64 6963 742c 202a 2a6e  t=name_dict, **n
+00021da0: 616d 6573 290a 0a20 2020 2064 6566 2072  ames)..    def r
+00021db0: 656e 616d 655f 6469 6d73 280a 2020 2020  ename_dims(.    
+00021dc0: 2020 2020 7365 6c66 3a20 545f 4461 7461      self: T_Data
+00021dd0: 7365 742c 0a20 2020 2020 2020 2064 696d  set,.        dim
+00021de0: 735f 6469 6374 3a20 4d61 7070 696e 675b  s_dict: Mapping[
+00021df0: 416e 792c 2048 6173 6861 626c 655d 207c  Any, Hashable] |
+00021e00: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+00021e10: 2020 2020 2020 2a2a 6469 6d73 3a20 4861        **dims: Ha
+00021e20: 7368 6162 6c65 2c0a 2020 2020 2920 2d3e  shable,.    ) ->
+00021e30: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
+00021e40: 2020 2020 2222 2252 6574 7572 6e73 2061      """Returns a
+00021e50: 206e 6577 206f 626a 6563 7420 7769 7468   new object with
+00021e60: 2072 656e 616d 6564 2064 696d 656e 7369   renamed dimensi
+00021e70: 6f6e 7320 6f6e 6c79 2e0a 0a20 2020 2020  ons only...     
+00021e80: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00021e90: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00021ea0: 0a20 2020 2020 2020 2064 696d 735f 6469  .        dims_di
+00021eb0: 6374 203a 2064 6963 742d 6c69 6b65 2c20  ct : dict-like, 
+00021ec0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00021ed0: 2020 2020 2044 6963 7469 6f6e 6172 7920       Dictionary 
+00021ee0: 7768 6f73 6520 6b65 7973 2061 7265 2063  whose keys are c
+00021ef0: 7572 7265 6e74 2064 696d 656e 7369 6f6e  urrent dimension
+00021f00: 206e 616d 6573 2061 6e64 0a20 2020 2020   names and.     
+00021f10: 2020 2020 2020 2077 686f 7365 2076 616c         whose val
+00021f20: 7565 7320 6172 6520 7468 6520 6465 7369  ues are the desi
+00021f30: 7265 6420 6e61 6d65 732e 2054 6865 2064  red names. The d
+00021f40: 6573 6972 6564 206e 616d 6573 206d 7573  esired names mus
+00021f50: 740a 2020 2020 2020 2020 2020 2020 6e6f  t.            no
+00021f60: 7420 6265 2074 6865 206e 616d 6520 6f66  t be the name of
+00021f70: 2061 6e20 6578 6973 7469 6e67 2064 696d   an existing dim
+00021f80: 656e 7369 6f6e 206f 7220 5661 7269 6162  ension or Variab
+00021f90: 6c65 2069 6e20 7468 6520 4461 7461 7365  le in the Datase
+00021fa0: 742e 0a20 2020 2020 2020 202a 2a64 696d  t..        **dim
+00021fb0: 7320 3a20 6f70 7469 6f6e 616c 0a20 2020  s : optional.   
+00021fc0: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
+00021fd0: 2066 6f72 6d20 6f66 2060 6064 696d 735f   form of ``dims_
+00021fe0: 6469 6374 6060 2e0a 2020 2020 2020 2020  dict``..        
+00021ff0: 2020 2020 4f6e 6520 6f66 2064 696d 735f      One of dims_
+00022000: 6469 6374 206f 7220 6469 6d73 206d 7573  dict or dims mus
+00022010: 7420 6265 2070 726f 7669 6465 642e 0a0a  t be provided...
+00022020: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+00022030: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+00022040: 2020 2020 2020 2020 7265 6e61 6d65 6420          renamed 
+00022050: 3a20 4461 7461 7365 740a 2020 2020 2020  : Dataset.      
+00022060: 2020 2020 2020 4461 7461 7365 7420 7769        Dataset wi
+00022070: 7468 2072 656e 616d 6564 2064 696d 656e  th renamed dimen
+00022080: 7369 6f6e 732e 0a0a 2020 2020 2020 2020  sions...        
+00022090: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+000220a0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+000220b0: 2020 4461 7461 7365 742e 7377 6170 5f64    Dataset.swap_d
+000220c0: 696d 730a 2020 2020 2020 2020 4461 7461  ims.        Data
+000220d0: 7365 742e 7265 6e61 6d65 0a20 2020 2020  set.rename.     
+000220e0: 2020 2044 6174 6173 6574 2e72 656e 616d     Dataset.renam
+000220f0: 655f 7661 7273 0a20 2020 2020 2020 2044  e_vars.        D
+00022100: 6174 6141 7272 6179 2e72 656e 616d 650a  ataArray.rename.
+00022110: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00022120: 2020 2020 6469 6d73 5f64 6963 7420 3d20      dims_dict = 
+00022130: 6569 7468 6572 5f64 6963 745f 6f72 5f6b  either_dict_or_k
+00022140: 7761 7267 7328 6469 6d73 5f64 6963 742c  wargs(dims_dict,
+00022150: 2064 696d 732c 2022 7265 6e61 6d65 5f64   dims, "rename_d
+00022160: 696d 7322 290a 2020 2020 2020 2020 666f  ims").        fo
+00022170: 7220 6b2c 2076 2069 6e20 6469 6d73 5f64  r k, v in dims_d
+00022180: 6963 742e 6974 656d 7328 293a 0a20 2020  ict.items():.   
+00022190: 2020 2020 2020 2020 2069 6620 6b20 6e6f           if k no
+000221a0: 7420 696e 2073 656c 662e 6469 6d73 3a0a  t in self.dims:.
+000221b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000221c0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000221d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000221e0: 2020 2020 2020 6622 6361 6e6e 6f74 2072        f"cannot r
+000221f0: 656e 616d 6520 7b6b 2172 7d20 6265 6361  ename {k!r} beca
+00022200: 7573 6520 6974 2069 7320 6e6f 7420 6120  use it is not a 
+00022210: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00022220: 2020 2020 2020 2264 696d 656e 7369 6f6e        "dimension
+00022230: 2069 6e20 7468 6973 2064 6174 6173 6574   in this dataset
+00022240: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00022250: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00022260: 6966 2076 2069 6e20 7365 6c66 2e64 696d  if v in self.dim
+00022270: 7320 6f72 2076 2069 6e20 7365 6c66 3a0a  s or v in self:.
+00022280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022290: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000222a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000222b0: 2020 2020 2020 6622 4361 6e6e 6f74 2072        f"Cannot r
+000222c0: 656e 616d 6520 7b6b 7d20 746f 207b 767d  ename {k} to {v}
+000222d0: 2062 6563 6175 7365 207b 767d 2061 6c72   because {v} alr
+000222e0: 6561 6479 2065 7869 7374 732e 2022 0a20  eady exists. ". 
+000222f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022300: 2020 2022 5472 7920 7573 696e 6720 7377     "Try using sw
+00022310: 6170 5f64 696d 7320 696e 7374 6561 642e  ap_dims instead.
+00022320: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00022330: 2020 290a 0a20 2020 2020 2020 2076 6172    )..        var
+00022340: 6961 626c 6573 2c20 636f 6f72 645f 6e61  iables, coord_na
+00022350: 6d65 732c 2073 697a 6573 2c20 696e 6465  mes, sizes, inde
+00022360: 7865 7320 3d20 7365 6c66 2e5f 7265 6e61  xes = self._rena
+00022370: 6d65 5f61 6c6c 280a 2020 2020 2020 2020  me_all(.        
+00022380: 2020 2020 6e61 6d65 5f64 6963 743d 7b7d      name_dict={}
+00022390: 2c20 6469 6d73 5f64 6963 743d 6469 6d73  , dims_dict=dims
+000223a0: 5f64 6963 740a 2020 2020 2020 2020 290a  _dict.        ).
+000223b0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000223c0: 656c 662e 5f72 6570 6c61 6365 2876 6172  elf._replace(var
+000223d0: 6961 626c 6573 2c20 636f 6f72 645f 6e61  iables, coord_na
+000223e0: 6d65 732c 2064 696d 733d 7369 7a65 732c  mes, dims=sizes,
+000223f0: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
+00022400: 290a 0a20 2020 2064 6566 2072 656e 616d  )..    def renam
+00022410: 655f 7661 7273 280a 2020 2020 2020 2020  e_vars(.        
+00022420: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
+00022430: 0a20 2020 2020 2020 206e 616d 655f 6469  .        name_di
+00022440: 6374 3a20 4d61 7070 696e 675b 416e 792c  ct: Mapping[Any,
+00022450: 2048 6173 6861 626c 655d 207c 204e 6f6e   Hashable] | Non
+00022460: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00022470: 2020 2a2a 6e61 6d65 733a 2048 6173 6861    **names: Hasha
+00022480: 626c 652c 0a20 2020 2029 202d 3e20 545f  ble,.    ) -> T_
+00022490: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+000224a0: 2022 2222 5265 7475 726e 7320 6120 6e65   """Returns a ne
+000224b0: 7720 6f62 6a65 6374 2077 6974 6820 7265  w object with re
+000224c0: 6e61 6d65 6420 7661 7269 6162 6c65 7320  named variables 
+000224d0: 696e 636c 7564 696e 6720 636f 6f72 6469  including coordi
+000224e0: 6e61 7465 730a 0a20 2020 2020 2020 2050  nates..        P
+000224f0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+00022500: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00022510: 2020 2020 206e 616d 655f 6469 6374 203a       name_dict :
+00022520: 2064 6963 742d 6c69 6b65 2c20 6f70 7469   dict-like, opti
+00022530: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00022540: 2044 6963 7469 6f6e 6172 7920 7768 6f73   Dictionary whos
+00022550: 6520 6b65 7973 2061 7265 2063 7572 7265  e keys are curre
+00022560: 6e74 2076 6172 6961 626c 6520 6f72 2063  nt variable or c
+00022570: 6f6f 7264 696e 6174 6520 6e61 6d65 7320  oordinate names 
+00022580: 616e 640a 2020 2020 2020 2020 2020 2020  and.            
+00022590: 7768 6f73 6520 7661 6c75 6573 2061 7265  whose values are
+000225a0: 2074 6865 2064 6573 6972 6564 206e 616d   the desired nam
+000225b0: 6573 2e0a 2020 2020 2020 2020 2a2a 6e61  es..        **na
+000225c0: 6d65 7320 3a20 6f70 7469 6f6e 616c 0a20  mes : optional. 
+000225d0: 2020 2020 2020 2020 2020 204b 6579 776f             Keywo
+000225e0: 7264 2066 6f72 6d20 6f66 2060 606e 616d  rd form of ``nam
+000225f0: 655f 6469 6374 6060 2e0a 2020 2020 2020  e_dict``..      
+00022600: 2020 2020 2020 4f6e 6520 6f66 206e 616d        One of nam
+00022610: 655f 6469 6374 206f 7220 6e61 6d65 7320  e_dict or names 
+00022620: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
+00022630: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00022640: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00022650: 2d2d 0a20 2020 2020 2020 2072 656e 616d  --.        renam
+00022660: 6564 203a 2044 6174 6173 6574 0a20 2020  ed : Dataset.   
+00022670: 2020 2020 2020 2020 2044 6174 6173 6574           Dataset
+00022680: 2077 6974 6820 7265 6e61 6d65 6420 7661   with renamed va
+00022690: 7269 6162 6c65 7320 696e 636c 7564 696e  riables includin
+000226a0: 6720 636f 6f72 6469 6e61 7465 730a 0a20  g coordinates.. 
+000226b0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+000226c0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000226d0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+000226e0: 2e73 7761 705f 6469 6d73 0a20 2020 2020  .swap_dims.     
+000226f0: 2020 2044 6174 6173 6574 2e72 656e 616d     Dataset.renam
+00022700: 650a 2020 2020 2020 2020 4461 7461 7365  e.        Datase
+00022710: 742e 7265 6e61 6d65 5f64 696d 730a 2020  t.rename_dims.  
+00022720: 2020 2020 2020 4461 7461 4172 7261 792e        DataArray.
+00022730: 7265 6e61 6d65 0a20 2020 2020 2020 2022  rename.        "
+00022740: 2222 0a20 2020 2020 2020 206e 616d 655f  "".        name_
+00022750: 6469 6374 203d 2065 6974 6865 725f 6469  dict = either_di
+00022760: 6374 5f6f 725f 6b77 6172 6773 286e 616d  ct_or_kwargs(nam
+00022770: 655f 6469 6374 2c20 6e61 6d65 732c 2022  e_dict, names, "
+00022780: 7265 6e61 6d65 5f76 6172 7322 290a 2020  rename_vars").  
+00022790: 2020 2020 2020 666f 7220 6b20 696e 206e        for k in n
+000227a0: 616d 655f 6469 6374 3a0a 2020 2020 2020  ame_dict:.      
+000227b0: 2020 2020 2020 6966 206b 206e 6f74 2069        if k not i
+000227c0: 6e20 7365 6c66 3a0a 2020 2020 2020 2020  n self:.        
+000227d0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+000227e0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+000227f0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00022800: 6361 6e6e 6f74 2072 656e 616d 6520 7b6b  cannot rename {k
+00022810: 2172 7d20 6265 6361 7573 6520 6974 2069  !r} because it i
+00022820: 7320 6e6f 7420 6120 220a 2020 2020 2020  s not a ".      
+00022830: 2020 2020 2020 2020 2020 2020 2020 2276                "v
+00022840: 6172 6961 626c 6520 6f72 2063 6f6f 7264  ariable or coord
+00022850: 696e 6174 6520 696e 2074 6869 7320 6461  inate in this da
+00022860: 7461 7365 7422 0a20 2020 2020 2020 2020  taset".         
+00022870: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00022880: 2076 6172 6961 626c 6573 2c20 636f 6f72   variables, coor
+00022890: 645f 6e61 6d65 732c 2064 696d 732c 2069  d_names, dims, i
+000228a0: 6e64 6578 6573 203d 2073 656c 662e 5f72  ndexes = self._r
+000228b0: 656e 616d 655f 616c 6c28 0a20 2020 2020  ename_all(.     
+000228c0: 2020 2020 2020 206e 616d 655f 6469 6374         name_dict
+000228d0: 3d6e 616d 655f 6469 6374 2c20 6469 6d73  =name_dict, dims
+000228e0: 5f64 6963 743d 7b7d 0a20 2020 2020 2020  _dict={}.       
+000228f0: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+00022900: 6e20 7365 6c66 2e5f 7265 706c 6163 6528  n self._replace(
+00022910: 7661 7269 6162 6c65 732c 2063 6f6f 7264  variables, coord
+00022920: 5f6e 616d 6573 2c20 6469 6d73 3d64 696d  _names, dims=dim
+00022930: 732c 2069 6e64 6578 6573 3d69 6e64 6578  s, indexes=index
+00022940: 6573 290a 0a20 2020 2064 6566 2073 7761  es)..    def swa
+00022950: 705f 6469 6d73 280a 2020 2020 2020 2020  p_dims(.        
+00022960: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
+00022970: 2064 696d 735f 6469 6374 3a20 4d61 7070   dims_dict: Mapp
+00022980: 696e 675b 416e 792c 2048 6173 6861 626c  ing[Any, Hashabl
+00022990: 655d 207c 204e 6f6e 6520 3d20 4e6f 6e65  e] | None = None
+000229a0: 2c20 2a2a 6469 6d73 5f6b 7761 7267 730a  , **dims_kwargs.
+000229b0: 2020 2020 2920 2d3e 2054 5f44 6174 6173      ) -> T_Datas
+000229c0: 6574 3a0a 2020 2020 2020 2020 2222 2252  et:.        """R
+000229d0: 6574 7572 6e73 2061 206e 6577 206f 626a  eturns a new obj
+000229e0: 6563 7420 7769 7468 2073 7761 7070 6564  ect with swapped
+000229f0: 2064 696d 656e 7369 6f6e 732e 0a0a 2020   dimensions...  
+00022a00: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00022a10: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00022a20: 2d2d 2d0a 2020 2020 2020 2020 6469 6d73  ---.        dims
+00022a30: 5f64 6963 7420 3a20 6469 6374 2d6c 696b  _dict : dict-lik
+00022a40: 650a 2020 2020 2020 2020 2020 2020 4469  e.            Di
+00022a50: 6374 696f 6e61 7279 2077 686f 7365 206b  ctionary whose k
+00022a60: 6579 7320 6172 6520 6375 7272 656e 7420  eys are current 
+00022a70: 6469 6d65 6e73 696f 6e20 6e61 6d65 7320  dimension names 
+00022a80: 616e 6420 7768 6f73 6520 7661 6c75 6573  and whose values
+00022a90: 0a20 2020 2020 2020 2020 2020 2061 7265  .            are
+00022aa0: 206e 6577 206e 616d 6573 2e0a 2020 2020   new names..    
+00022ab0: 2020 2020 2a2a 6469 6d73 5f6b 7761 7267      **dims_kwarg
+00022ac0: 7320 3a20 7b65 7869 7374 696e 675f 6469  s : {existing_di
+00022ad0: 6d3a 206e 6577 5f64 696d 2c20 2e2e 2e7d  m: new_dim, ...}
+00022ae0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+00022af0: 2020 2020 2020 2054 6865 206b 6579 776f         The keywo
+00022b00: 7264 2061 7267 756d 656e 7473 2066 6f72  rd arguments for
+00022b10: 6d20 6f66 2060 6064 696d 735f 6469 6374  m of ``dims_dict
+00022b20: 6060 2e0a 2020 2020 2020 2020 2020 2020  ``..            
+00022b30: 4f6e 6520 6f66 2064 696d 735f 6469 6374  One of dims_dict
+00022b40: 206f 7220 6469 6d73 5f6b 7761 7267 7320   or dims_kwargs 
+00022b50: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
+00022b60: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00022b70: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00022b80: 2d2d 0a20 2020 2020 2020 2073 7761 7070  --.        swapp
+00022b90: 6564 203a 2044 6174 6173 6574 0a20 2020  ed : Dataset.   
+00022ba0: 2020 2020 2020 2020 2044 6174 6173 6574           Dataset
+00022bb0: 2077 6974 6820 7377 6170 7065 6420 6469   with swapped di
+00022bc0: 6d65 6e73 696f 6e73 2e0a 0a20 2020 2020  mensions...     
+00022bd0: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+00022be0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00022bf0: 2020 2020 203e 3e3e 2064 7320 3d20 7872       >>> ds = xr
+00022c00: 2e44 6174 6173 6574 280a 2020 2020 2020  .Dataset(.      
+00022c10: 2020 2e2e 2e20 2020 2020 6461 7461 5f76    ...     data_v
+00022c20: 6172 733d 7b22 6122 3a20 2822 7822 2c20  ars={"a": ("x", 
+00022c30: 5b35 2c20 375d 292c 2022 6222 3a20 2822  [5, 7]), "b": ("
+00022c40: 7822 2c20 5b30 2e31 2c20 322e 345d 297d  x", [0.1, 2.4])}
+00022c50: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
+00022c60: 2020 636f 6f72 6473 3d7b 2278 223a 205b    coords={"x": [
+00022c70: 2261 222c 2022 6222 5d2c 2022 7922 3a20  "a", "b"], "y": 
+00022c80: 2822 7822 2c20 5b30 2c20 315d 297d 2c0a  ("x", [0, 1])},.
+00022c90: 2020 2020 2020 2020 2e2e 2e20 290a 2020          ... ).  
+00022ca0: 2020 2020 2020 3e3e 3e20 6473 0a20 2020        >>> ds.   
+00022cb0: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
+00022cc0: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
+00022cd0: 6d65 6e73 696f 6e73 3a20 2028 783a 2032  mensions:  (x: 2
+00022ce0: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
+00022cf0: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
+00022d00: 202a 2078 2020 2020 2020 2020 2878 2920   * x        (x) 
+00022d10: 3c55 3120 2761 2720 2762 270a 2020 2020  <U1 'a' 'b'.    
+00022d20: 2020 2020 2020 2020 7920 2020 2020 2020          y       
+00022d30: 2028 7829 2069 6e74 3634 2030 2031 0a20   (x) int64 0 1. 
+00022d40: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
+00022d50: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
+00022d60: 2020 2061 2020 2020 2020 2020 2878 2920     a        (x) 
+00022d70: 696e 7436 3420 3520 370a 2020 2020 2020  int64 5 7.      
+00022d80: 2020 2020 2020 6220 2020 2020 2020 2028        b        (
+00022d90: 7829 2066 6c6f 6174 3634 2030 2e31 2032  x) float64 0.1 2
+00022da0: 2e34 0a0a 2020 2020 2020 2020 3e3e 3e20  .4..        >>> 
+00022db0: 6473 2e73 7761 705f 6469 6d73 287b 2278  ds.swap_dims({"x
+00022dc0: 223a 2022 7922 7d29 0a20 2020 2020 2020  ": "y"}).       
+00022dd0: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
+00022de0: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
+00022df0: 696f 6e73 3a20 2028 793a 2032 290a 2020  ions:  (y: 2).  
+00022e00: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
+00022e10: 733a 0a20 2020 2020 2020 2020 2020 2078  s:.            x
+00022e20: 2020 2020 2020 2020 2879 2920 3c55 3120          (y) <U1 
+00022e30: 2761 2720 2762 270a 2020 2020 2020 2020  'a' 'b'.        
+00022e40: 2020 2a20 7920 2020 2020 2020 2028 7929    * y        (y)
+00022e50: 2069 6e74 3634 2030 2031 0a20 2020 2020   int64 0 1.     
+00022e60: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
+00022e70: 733a 0a20 2020 2020 2020 2020 2020 2061  s:.            a
+00022e80: 2020 2020 2020 2020 2879 2920 696e 7436          (y) int6
+00022e90: 3420 3520 370a 2020 2020 2020 2020 2020  4 5 7.          
+00022ea0: 2020 6220 2020 2020 2020 2028 7929 2066    b        (y) f
+00022eb0: 6c6f 6174 3634 2030 2e31 2032 2e34 0a0a  loat64 0.1 2.4..
+00022ec0: 2020 2020 2020 2020 3e3e 3e20 6473 2e73          >>> ds.s
+00022ed0: 7761 705f 6469 6d73 287b 2278 223a 2022  wap_dims({"x": "
+00022ee0: 7a22 7d29 0a20 2020 2020 2020 203c 7861  z"}).        <xa
+00022ef0: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
+00022f00: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
+00022f10: 3a20 2028 7a3a 2032 290a 2020 2020 2020  :  (z: 2).      
+00022f20: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+00022f30: 2020 2020 2020 2020 2020 2078 2020 2020             x    
+00022f40: 2020 2020 287a 2920 3c55 3120 2761 2720      (z) <U1 'a' 
+00022f50: 2762 270a 2020 2020 2020 2020 2020 2020  'b'.            
+00022f60: 7920 2020 2020 2020 2028 7a29 2069 6e74  y        (z) int
+00022f70: 3634 2030 2031 0a20 2020 2020 2020 2044  64 0 1.        D
+00022f80: 696d 656e 7369 6f6e 7320 7769 7468 6f75  imensions withou
+00022f90: 7420 636f 6f72 6469 6e61 7465 733a 207a  t coordinates: z
+00022fa0: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
+00022fb0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+00022fc0: 2020 2020 2061 2020 2020 2020 2020 287a       a        (z
+00022fd0: 2920 696e 7436 3420 3520 370a 2020 2020  ) int64 5 7.    
+00022fe0: 2020 2020 2020 2020 6220 2020 2020 2020          b       
+00022ff0: 2028 7a29 2066 6c6f 6174 3634 2030 2e31   (z) float64 0.1
+00023000: 2032 2e34 0a0a 2020 2020 2020 2020 5365   2.4..        Se
+00023010: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
+00023020: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00023030: 4461 7461 7365 742e 7265 6e61 6d65 0a20  Dataset.rename. 
+00023040: 2020 2020 2020 2044 6174 6141 7272 6179         DataArray
+00023050: 2e73 7761 705f 6469 6d73 0a20 2020 2020  .swap_dims.     
+00023060: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
+00023070: 2054 4f44 4f3a 2064 6570 7265 6361 7465   TODO: deprecate
+00023080: 2074 6869 7320 6d65 7468 6f64 2069 6e20   this method in 
+00023090: 6661 766f 7220 6f66 2061 2028 6c65 7373  favor of a (less
+000230a0: 2063 6f6e 6675 7369 6e67 290a 2020 2020   confusing).    
+000230b0: 2020 2020 2320 7265 6e61 6d65 5f64 696d      # rename_dim
+000230c0: 7328 2920 6d65 7468 6f64 2074 6861 7420  s() method that 
+000230d0: 6f6e 6c79 2072 656e 616d 6573 2064 696d  only renames dim
+000230e0: 656e 7369 6f6e 732e 0a0a 2020 2020 2020  ensions...      
+000230f0: 2020 6469 6d73 5f64 6963 7420 3d20 6569    dims_dict = ei
+00023100: 7468 6572 5f64 6963 745f 6f72 5f6b 7761  ther_dict_or_kwa
+00023110: 7267 7328 6469 6d73 5f64 6963 742c 2064  rgs(dims_dict, d
+00023120: 696d 735f 6b77 6172 6773 2c20 2273 7761  ims_kwargs, "swa
+00023130: 705f 6469 6d73 2229 0a20 2020 2020 2020  p_dims").       
+00023140: 2066 6f72 206b 2c20 7620 696e 2064 696d   for k, v in dim
+00023150: 735f 6469 6374 2e69 7465 6d73 2829 3a0a  s_dict.items():.
+00023160: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00023170: 206e 6f74 2069 6e20 7365 6c66 2e64 696d   not in self.dim
+00023180: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00023190: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+000231a0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+000231b0: 2020 2020 2020 2020 2066 2263 616e 6e6f           f"canno
+000231c0: 7420 7377 6170 2066 726f 6d20 6469 6d65  t swap from dime
+000231d0: 6e73 696f 6e20 7b6b 2172 7d20 6265 6361  nsion {k!r} beca
+000231e0: 7573 6520 6974 2069 7320 220a 2020 2020  use it is ".    
+000231f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023200: 226e 6f74 2061 6e20 6578 6973 7469 6e67  "not an existing
+00023210: 2064 696d 656e 7369 6f6e 220a 2020 2020   dimension".    
+00023220: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00023230: 2020 2020 2020 2020 2020 6966 2076 2069            if v i
+00023240: 6e20 7365 6c66 2e76 6172 6961 626c 6573  n self.variables
+00023250: 2061 6e64 2073 656c 662e 7661 7269 6162   and self.variab
+00023260: 6c65 735b 765d 2e64 696d 7320 213d 2028  les[v].dims != (
+00023270: 6b2c 293a 0a20 2020 2020 2020 2020 2020  k,):.           
+00023280: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00023290: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+000232a0: 2020 2020 2020 2020 2020 2066 2272 6570             f"rep
+000232b0: 6c61 6365 6d65 6e74 2064 696d 656e 7369  lacement dimensi
+000232c0: 6f6e 207b 7621 727d 2069 7320 6e6f 7420  on {v!r} is not 
+000232d0: 6120 3144 2022 0a20 2020 2020 2020 2020  a 1D ".         
+000232e0: 2020 2020 2020 2020 2020 2066 2276 6172             f"var
+000232f0: 6961 626c 6520 616c 6f6e 6720 7468 6520  iable along the 
+00023300: 6f6c 6420 6469 6d65 6e73 696f 6e20 7b6b  old dimension {k
+00023310: 2172 7d22 0a20 2020 2020 2020 2020 2020  !r}".           
+00023320: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00023330: 7265 7375 6c74 5f64 696d 7320 3d20 7b64  result_dims = {d
+00023340: 696d 735f 6469 6374 2e67 6574 2864 696d  ims_dict.get(dim
+00023350: 2c20 6469 6d29 2066 6f72 2064 696d 2069  , dim) for dim i
+00023360: 6e20 7365 6c66 2e64 696d 737d 0a0a 2020  n self.dims}..  
+00023370: 2020 2020 2020 636f 6f72 645f 6e61 6d65        coord_name
+00023380: 7320 3d20 7365 6c66 2e5f 636f 6f72 645f  s = self._coord_
+00023390: 6e61 6d65 732e 636f 7079 2829 0a20 2020  names.copy().   
+000233a0: 2020 2020 2063 6f6f 7264 5f6e 616d 6573       coord_names
+000233b0: 2e75 7064 6174 6528 7b64 696d 2066 6f72  .update({dim for
+000233c0: 2064 696d 2069 6e20 6469 6d73 5f64 6963   dim in dims_dic
+000233d0: 742e 7661 6c75 6573 2829 2069 6620 6469  t.values() if di
+000233e0: 6d20 696e 2073 656c 662e 7661 7269 6162  m in self.variab
+000233f0: 6c65 737d 290a 0a20 2020 2020 2020 2076  les})..        v
+00023400: 6172 6961 626c 6573 3a20 6469 6374 5b48  ariables: dict[H
+00023410: 6173 6861 626c 652c 2056 6172 6961 626c  ashable, Variabl
+00023420: 655d 203d 207b 7d0a 2020 2020 2020 2020  e] = {}.        
+00023430: 696e 6465 7865 733a 2064 6963 745b 4861  indexes: dict[Ha
+00023440: 7368 6162 6c65 2c20 496e 6465 785d 203d  shable, Index] =
+00023450: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
+00023460: 6b2c 2076 2069 6e20 7365 6c66 2e76 6172  k, v in self.var
+00023470: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
+00023480: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
+00023490: 203d 2074 7570 6c65 2864 696d 735f 6469   = tuple(dims_di
+000234a0: 6374 2e67 6574 2864 696d 2c20 6469 6d29  ct.get(dim, dim)
+000234b0: 2066 6f72 2064 696d 2069 6e20 762e 6469   for dim in v.di
+000234c0: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
+000234d0: 7661 723a 2056 6172 6961 626c 650a 2020  var: Variable.  
+000234e0: 2020 2020 2020 2020 2020 6966 206b 2069            if k i
+000234f0: 6e20 7265 7375 6c74 5f64 696d 733a 0a20  n result_dims:. 
+00023500: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00023510: 6172 203d 2076 2e74 6f5f 696e 6465 785f  ar = v.to_index_
+00023520: 7661 7269 6162 6c65 2829 0a20 2020 2020  variable().     
+00023530: 2020 2020 2020 2020 2020 2076 6172 2e64             var.d
+00023540: 696d 7320 3d20 6469 6d73 0a20 2020 2020  ims = dims.     
+00023550: 2020 2020 2020 2020 2020 2069 6620 6b20             if k 
+00023560: 696e 2073 656c 662e 5f69 6e64 6578 6573  in self._indexes
+00023570: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00023580: 2020 2020 2020 696e 6465 7865 735b 6b5d        indexes[k]
+00023590: 203d 2073 656c 662e 5f69 6e64 6578 6573   = self._indexes
+000235a0: 5b6b 5d0a 2020 2020 2020 2020 2020 2020  [k].            
+000235b0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+000235c0: 735b 6b5d 203d 2076 6172 0a20 2020 2020  s[k] = var.     
+000235d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000235e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000235f0: 2020 2020 2069 6e64 6578 2c20 696e 6465       index, inde
+00023600: 785f 7661 7273 203d 2063 7265 6174 655f  x_vars = create_
+00023610: 6465 6661 756c 745f 696e 6465 785f 696d  default_index_im
+00023620: 706c 6963 6974 2876 6172 290a 2020 2020  plicit(var).    
+00023630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023640: 696e 6465 7865 732e 7570 6461 7465 287b  indexes.update({
+00023650: 6e61 6d65 3a20 696e 6465 7820 666f 7220  name: index for 
+00023660: 6e61 6d65 2069 6e20 696e 6465 785f 7661  name in index_va
+00023670: 7273 7d29 0a20 2020 2020 2020 2020 2020  rs}).           
+00023680: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+00023690: 6573 2e75 7064 6174 6528 696e 6465 785f  es.update(index_
+000236a0: 7661 7273 290a 2020 2020 2020 2020 2020  vars).          
+000236b0: 2020 2020 2020 2020 2020 636f 6f72 645f            coord_
+000236c0: 6e61 6d65 732e 7570 6461 7465 2869 6e64  names.update(ind
+000236d0: 6578 5f76 6172 7329 0a20 2020 2020 2020  ex_vars).       
+000236e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000236f0: 2020 2020 2020 2020 2020 2076 6172 203d             var =
+00023700: 2076 2e74 6f5f 6261 7365 5f76 6172 6961   v.to_base_varia
+00023710: 626c 6528 290a 2020 2020 2020 2020 2020  ble().          
+00023720: 2020 2020 2020 7661 722e 6469 6d73 203d        var.dims =
+00023730: 2064 696d 730a 2020 2020 2020 2020 2020   dims.          
+00023740: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
+00023750: 6b5d 203d 2076 6172 0a0a 2020 2020 2020  k] = var..      
+00023760: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+00023770: 6570 6c61 6365 5f77 6974 685f 6e65 775f  eplace_with_new_
+00023780: 6469 6d73 2876 6172 6961 626c 6573 2c20  dims(variables, 
+00023790: 636f 6f72 645f 6e61 6d65 732c 2069 6e64  coord_names, ind
+000237a0: 6578 6573 3d69 6e64 6578 6573 290a 0a20  exes=indexes).. 
+000237b0: 2020 2023 2063 6861 6e67 6520 7479 7065     # change type
+000237c0: 206f 6620 7365 6c66 2061 6e64 2072 6574   of self and ret
+000237d0: 7572 6e20 746f 2054 5f44 6174 6173 6574  urn to T_Dataset
+000237e0: 206f 6e63 650a 2020 2020 2320 6874 7470   once.    # http
+000237f0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f70  s://github.com/p
+00023800: 7974 686f 6e2f 6d79 7079 2f69 7373 7565  ython/mypy/issue
+00023810: 732f 3132 3834 3620 6973 2072 6573 6f6c  s/12846 is resol
+00023820: 7665 640a 2020 2020 6465 6620 6578 7061  ved.    def expa
+00023830: 6e64 5f64 696d 7328 0a20 2020 2020 2020  nd_dims(.       
+00023840: 2073 656c 662c 0a20 2020 2020 2020 2064   self,.        d
+00023850: 696d 3a20 4e6f 6e65 207c 2048 6173 6861  im: None | Hasha
+00023860: 626c 6520 7c20 5365 7175 656e 6365 5b48  ble | Sequence[H
+00023870: 6173 6861 626c 655d 207c 204d 6170 7069  ashable] | Mappi
+00023880: 6e67 5b41 6e79 2c20 416e 795d 203d 204e  ng[Any, Any] = N
+00023890: 6f6e 652c 0a20 2020 2020 2020 2061 7869  one,.        axi
+000238a0: 733a 204e 6f6e 6520 7c20 696e 7420 7c20  s: None | int | 
+000238b0: 5365 7175 656e 6365 5b69 6e74 5d20 3d20  Sequence[int] = 
+000238c0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2a2a  None,.        **
+000238d0: 6469 6d5f 6b77 6172 6773 3a20 416e 792c  dim_kwargs: Any,
+000238e0: 0a20 2020 2029 202d 3e20 4461 7461 7365  .    ) -> Datase
+000238f0: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
+00023900: 7475 726e 2061 206e 6577 206f 626a 6563  turn a new objec
+00023910: 7420 7769 7468 2061 6e20 6164 6469 7469  t with an additi
+00023920: 6f6e 616c 2061 7869 7320 286f 7220 6178  onal axis (or ax
+00023930: 6573 2920 696e 7365 7274 6564 2061 740a  es) inserted at.
+00023940: 2020 2020 2020 2020 7468 6520 636f 7272          the corr
+00023950: 6573 706f 6e64 696e 6720 706f 7369 7469  esponding positi
+00023960: 6f6e 2069 6e20 7468 6520 6172 7261 7920  on in the array 
+00023970: 7368 6170 652e 2020 5468 6520 6e65 7720  shape.  The new 
+00023980: 6f62 6a65 6374 2069 7320 610a 2020 2020  object is a.    
+00023990: 2020 2020 7669 6577 2069 6e74 6f20 7468      view into th
+000239a0: 6520 756e 6465 726c 7969 6e67 2061 7272  e underlying arr
+000239b0: 6179 2c20 6e6f 7420 6120 636f 7079 2e0a  ay, not a copy..
+000239c0: 0a20 2020 2020 2020 2049 6620 6469 6d20  .        If dim 
+000239d0: 6973 2061 6c72 6561 6479 2061 2073 6361  is already a sca
+000239e0: 6c61 7220 636f 6f72 6469 6e61 7465 2c20  lar coordinate, 
+000239f0: 6974 2077 696c 6c20 6265 2070 726f 6d6f  it will be promo
+00023a00: 7465 6420 746f 2061 2031 440a 2020 2020  ted to a 1D.    
+00023a10: 2020 2020 636f 6f72 6469 6e61 7465 2063      coordinate c
+00023a20: 6f6e 7369 7374 696e 6720 6f66 2061 2073  onsisting of a s
+00023a30: 696e 676c 6520 7661 6c75 652e 0a0a 2020  ingle value...  
+00023a40: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00023a50: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00023a60: 2d2d 2d0a 2020 2020 2020 2020 6469 6d20  ---.        dim 
+00023a70: 3a20 6861 7368 6162 6c65 2c20 7365 7175  : hashable, sequ
+00023a80: 656e 6365 206f 6620 6861 7368 6162 6c65  ence of hashable
+00023a90: 2c20 6d61 7070 696e 672c 206f 7220 4e6f  , mapping, or No
+00023aa0: 6e65 0a20 2020 2020 2020 2020 2020 2044  ne.            D
+00023ab0: 696d 656e 7369 6f6e 7320 746f 2069 6e63  imensions to inc
+00023ac0: 6c75 6465 206f 6e20 7468 6520 6e65 7720  lude on the new 
+00023ad0: 7661 7269 6162 6c65 2e20 4966 2070 726f  variable. If pro
+00023ae0: 7669 6465 6420 6173 2068 6173 6861 626c  vided as hashabl
+00023af0: 650a 2020 2020 2020 2020 2020 2020 6f72  e.            or
+00023b00: 2073 6571 7565 6e63 6520 6f66 2068 6173   sequence of has
+00023b10: 6861 626c 652c 2074 6865 6e20 6469 6d65  hable, then dime
+00023b20: 6e73 696f 6e73 2061 7265 2069 6e73 6572  nsions are inser
+00023b30: 7465 6420 7769 7468 206c 656e 6774 680a  ted with length.
+00023b40: 2020 2020 2020 2020 2020 2020 312e 2049              1. I
+00023b50: 6620 7072 6f76 6964 6564 2061 7320 6120  f provided as a 
+00023b60: 6d61 7070 696e 672c 2074 6865 6e20 7468  mapping, then th
+00023b70: 6520 6b65 7973 2061 7265 2074 6865 206e  e keys are the n
+00023b80: 6577 2064 696d 656e 7369 6f6e 730a 2020  ew dimensions.  
+00023b90: 2020 2020 2020 2020 2020 616e 6420 7468            and th
+00023ba0: 6520 7661 6c75 6573 2061 7265 2065 6974  e values are eit
+00023bb0: 6865 7220 696e 7465 6765 7273 2028 6769  her integers (gi
+00023bc0: 7669 6e67 2074 6865 206c 656e 6774 6820  ving the length 
+00023bd0: 6f66 2074 6865 206e 6577 0a20 2020 2020  of the new.     
+00023be0: 2020 2020 2020 2064 696d 656e 7369 6f6e         dimension
+00023bf0: 7329 206f 7220 6172 7261 792d 6c69 6b65  s) or array-like
+00023c00: 2028 6769 7669 6e67 2074 6865 2063 6f6f   (giving the coo
+00023c10: 7264 696e 6174 6573 206f 6620 7468 6520  rdinates of the 
+00023c20: 6e65 770a 2020 2020 2020 2020 2020 2020  new.            
+00023c30: 6469 6d65 6e73 696f 6e73 292e 0a20 2020  dimensions)..   
+00023c40: 2020 2020 2061 7869 7320 3a20 696e 742c       axis : int,
+00023c50: 2073 6571 7565 6e63 6520 6f66 2069 6e74   sequence of int
+00023c60: 2c20 6f72 204e 6f6e 652c 2064 6566 6175  , or None, defau
+00023c70: 6c74 3a20 4e6f 6e65 0a20 2020 2020 2020  lt: None.       
+00023c80: 2020 2020 2041 7869 7320 706f 7369 7469       Axis positi
+00023c90: 6f6e 2873 2920 7768 6572 6520 6e65 7720  on(s) where new 
+00023ca0: 6178 6973 2069 7320 746f 2062 6520 696e  axis is to be in
+00023cb0: 7365 7274 6564 2028 706f 7369 7469 6f6e  serted (position
+00023cc0: 2873 2920 6f6e 0a20 2020 2020 2020 2020  (s) on.         
+00023cd0: 2020 2074 6865 2072 6573 756c 7420 6172     the result ar
+00023ce0: 7261 7929 2e20 4966 2061 2073 6571 7565  ray). If a seque
+00023cf0: 6e63 6520 6f66 2069 6e74 6567 6572 7320  nce of integers 
+00023d00: 6973 2070 6173 7365 642c 0a20 2020 2020  is passed,.     
+00023d10: 2020 2020 2020 206d 756c 7469 706c 6520         multiple 
+00023d20: 6178 6573 2061 7265 2069 6e73 6572 7465  axes are inserte
+00023d30: 642e 2049 6e20 7468 6973 2063 6173 652c  d. In this case,
+00023d40: 2064 696d 2061 7267 756d 656e 7473 2073   dim arguments s
+00023d50: 686f 756c 6420 6265 0a20 2020 2020 2020  hould be.       
+00023d60: 2020 2020 2073 616d 6520 6c65 6e67 7468       same length
+00023d70: 206c 6973 742e 2049 6620 6178 6973 3d4e   list. If axis=N
+00023d80: 6f6e 6520 6973 2070 6173 7365 642c 2061  one is passed, a
+00023d90: 6c6c 2074 6865 2061 7865 7320 7769 6c6c  ll the axes will
+00023da0: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
+00023db0: 696e 7365 7274 6564 2074 6f20 7468 6520  inserted to the 
+00023dc0: 7374 6172 7420 6f66 2074 6865 2072 6573  start of the res
+00023dd0: 756c 7420 6172 7261 792e 0a20 2020 2020  ult array..     
+00023de0: 2020 202a 2a64 696d 5f6b 7761 7267 7320     **dim_kwargs 
+00023df0: 3a20 696e 7420 6f72 2073 6571 7565 6e63  : int or sequenc
+00023e00: 6520 6f72 206e 6461 7272 6179 0a20 2020  e or ndarray.   
+00023e10: 2020 2020 2020 2020 2054 6865 206b 6579           The key
+00023e20: 776f 7264 7320 6172 6520 6172 6269 7472  words are arbitr
+00023e30: 6172 7920 6469 6d65 6e73 696f 6e73 2062  ary dimensions b
+00023e40: 6569 6e67 2069 6e73 6572 7465 6420 616e  eing inserted an
+00023e50: 6420 7468 6520 7661 6c75 6573 0a20 2020  d the values.   
+00023e60: 2020 2020 2020 2020 2061 7265 2065 6974           are eit
+00023e70: 6865 7220 7468 6520 6c65 6e67 7468 7320  her the lengths 
+00023e80: 6f66 2074 6865 206e 6577 2064 696d 7320  of the new dims 
+00023e90: 2869 6620 696e 7420 6973 2067 6976 656e  (if int is given
+00023ea0: 292c 206f 7220 7468 6569 720a 2020 2020  ), or their.    
+00023eb0: 2020 2020 2020 2020 636f 6f72 6469 6e61          coordina
+00023ec0: 7465 732e 204e 6f74 652c 2074 6869 7320  tes. Note, this 
+00023ed0: 6973 2061 6e20 616c 7465 726e 6174 6976  is an alternativ
+00023ee0: 6520 746f 2070 6173 7369 6e67 2061 2064  e to passing a d
+00023ef0: 6963 7420 746f 2074 6865 0a20 2020 2020  ict to the.     
+00023f00: 2020 2020 2020 2064 696d 206b 7761 7267         dim kwarg
+00023f10: 2061 6e64 2077 696c 6c20 6f6e 6c79 2062   and will only b
+00023f20: 6520 7573 6564 2069 6620 6469 6d20 6973  e used if dim is
+00023f30: 204e 6f6e 652e 0a0a 2020 2020 2020 2020   None...        
+00023f40: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+00023f50: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00023f60: 6578 7061 6e64 6564 203a 2044 6174 6173  expanded : Datas
+00023f70: 6574 0a20 2020 2020 2020 2020 2020 2054  et.            T
+00023f80: 6869 7320 6f62 6a65 6374 2c20 6275 7420  his object, but 
+00023f90: 7769 7468 2061 6464 6974 696f 6e61 6c20  with additional 
+00023fa0: 6469 6d65 6e73 696f 6e28 7329 2e0a 0a20  dimension(s)... 
+00023fb0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+00023fc0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00023fd0: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
+00023fe0: 6179 2e65 7870 616e 645f 6469 6d73 0a20  ay.expand_dims. 
+00023ff0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00024000: 2020 2069 6620 6469 6d20 6973 204e 6f6e     if dim is Non
+00024010: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+00024020: 6173 730a 2020 2020 2020 2020 656c 6966  ass.        elif
+00024030: 2069 7369 6e73 7461 6e63 6528 6469 6d2c   isinstance(dim,
+00024040: 204d 6170 7069 6e67 293a 0a20 2020 2020   Mapping):.     
+00024050: 2020 2020 2020 2023 2057 6527 7265 206c         # We're l
+00024060: 6174 6572 2067 6f69 6e67 2074 6f20 6d6f  ater going to mo
+00024070: 6469 6679 2064 696d 2069 6e20 706c 6163  dify dim in plac
+00024080: 653b 2064 6f6e 2774 2074 616d 7065 7220  e; don't tamper 
+00024090: 7769 7468 0a20 2020 2020 2020 2020 2020  with.           
+000240a0: 2023 2074 6865 2069 6e70 7574 0a20 2020   # the input.   
+000240b0: 2020 2020 2020 2020 2064 696d 203d 2064           dim = d
+000240c0: 6963 7428 6469 6d29 0a20 2020 2020 2020  ict(dim).       
+000240d0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+000240e0: 2864 696d 2c20 696e 7429 3a0a 2020 2020  (dim, int):.    
+000240f0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+00024100: 7065 4572 726f 7228 0a20 2020 2020 2020  peError(.       
+00024110: 2020 2020 2020 2020 2022 6469 6d20 7368           "dim sh
+00024120: 6f75 6c64 2062 6520 6861 7368 6162 6c65  ould be hashable
+00024130: 206f 7220 7365 7175 656e 6365 206f 6620   or sequence of 
+00024140: 6861 7368 6162 6c65 7320 6f72 206d 6170  hashables or map
+00024150: 7069 6e67 220a 2020 2020 2020 2020 2020  ping".          
+00024160: 2020 290a 2020 2020 2020 2020 656c 6966    ).        elif
+00024170: 2069 7369 6e73 7461 6e63 6528 6469 6d2c   isinstance(dim,
+00024180: 2073 7472 2920 6f72 206e 6f74 2069 7369   str) or not isi
+00024190: 6e73 7461 6e63 6528 6469 6d2c 2053 6571  nstance(dim, Seq
+000241a0: 7565 6e63 6529 3a0a 2020 2020 2020 2020  uence):.        
+000241b0: 2020 2020 6469 6d20 3d20 7b64 696d 3a20      dim = {dim: 
+000241c0: 317d 0a20 2020 2020 2020 2065 6c69 6620  1}.        elif 
+000241d0: 6973 696e 7374 616e 6365 2864 696d 2c20  isinstance(dim, 
+000241e0: 5365 7175 656e 6365 293a 0a20 2020 2020  Sequence):.     
+000241f0: 2020 2020 2020 2069 6620 6c65 6e28 6469         if len(di
+00024200: 6d29 2021 3d20 6c65 6e28 7365 7428 6469  m) != len(set(di
+00024210: 6d29 293a 0a20 2020 2020 2020 2020 2020  m)):.           
+00024220: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00024230: 4572 726f 7228 2264 696d 7320 7368 6f75  Error("dims shou
+00024240: 6c64 206e 6f74 2063 6f6e 7461 696e 2064  ld not contain d
+00024250: 7570 6c69 6361 7465 2076 616c 7565 732e  uplicate values.
+00024260: 2229 0a20 2020 2020 2020 2020 2020 2064  ").            d
+00024270: 696d 203d 207b 643a 2031 2066 6f72 2064  im = {d: 1 for d
+00024280: 2069 6e20 6469 6d7d 0a0a 2020 2020 2020   in dim}..      
+00024290: 2020 6469 6d20 3d20 6569 7468 6572 5f64    dim = either_d
+000242a0: 6963 745f 6f72 5f6b 7761 7267 7328 6469  ict_or_kwargs(di
+000242b0: 6d2c 2064 696d 5f6b 7761 7267 732c 2022  m, dim_kwargs, "
+000242c0: 6578 7061 6e64 5f64 696d 7322 290a 2020  expand_dims").  
+000242d0: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
+000242e0: 6e73 7461 6e63 6528 6469 6d2c 204d 7574  nstance(dim, Mut
+000242f0: 6162 6c65 4d61 7070 696e 6729 0a0a 2020  ableMapping)..  
+00024300: 2020 2020 2020 6966 2061 7869 7320 6973        if axis is
+00024310: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00024320: 2020 2061 7869 7320 3d20 6c69 7374 2872     axis = list(r
+00024330: 616e 6765 286c 656e 2864 696d 2929 290a  ange(len(dim))).
+00024340: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
+00024350: 2069 7369 6e73 7461 6e63 6528 6178 6973   isinstance(axis
+00024360: 2c20 5365 7175 656e 6365 293a 0a20 2020  , Sequence):.   
+00024370: 2020 2020 2020 2020 2061 7869 7320 3d20           axis = 
+00024380: 5b61 7869 735d 0a0a 2020 2020 2020 2020  [axis]..        
+00024390: 6966 206c 656e 2864 696d 2920 213d 206c  if len(dim) != l
+000243a0: 656e 2861 7869 7329 3a0a 2020 2020 2020  en(axis):.      
+000243b0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+000243c0: 6545 7272 6f72 2822 6c65 6e67 7468 7320  eError("lengths 
+000243d0: 6f66 2064 696d 2061 6e64 2061 7869 7320  of dim and axis 
+000243e0: 7368 6f75 6c64 2062 6520 6964 656e 7469  should be identi
+000243f0: 6361 6c2e 2229 0a20 2020 2020 2020 2066  cal.").        f
+00024400: 6f72 2064 2069 6e20 6469 6d3a 0a20 2020  or d in dim:.   
+00024410: 2020 2020 2020 2020 2069 6620 6420 696e           if d in
+00024420: 2073 656c 662e 6469 6d73 3a0a 2020 2020   self.dims:.    
+00024430: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00024440: 6520 5661 6c75 6545 7272 6f72 2866 2244  e ValueError(f"D
+00024450: 696d 656e 7369 6f6e 207b 647d 2061 6c72  imension {d} alr
+00024460: 6561 6479 2065 7869 7374 732e 2229 0a20  eady exists."). 
+00024470: 2020 2020 2020 2020 2020 2069 6620 6420             if d 
+00024480: 696e 2073 656c 662e 5f76 6172 6961 626c  in self._variabl
+00024490: 6573 2061 6e64 206e 6f74 2075 7469 6c73  es and not utils
+000244a0: 2e69 735f 7363 616c 6172 2873 656c 662e  .is_scalar(self.
+000244b0: 5f76 6172 6961 626c 6573 5b64 5d29 3a0a  _variables[d]):.
+000244c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000244d0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000244e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000244f0: 2020 2020 2020 227b 6469 6d7d 2061 6c72        "{dim} alr
+00024500: 6561 6479 2065 7869 7374 7320 6173 2063  eady exists as c
+00024510: 6f6f 7264 696e 6174 6520 6f72 220a 2020  oordinate or".  
+00024520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024530: 2020 2220 7661 7269 6162 6c65 206e 616d    " variable nam
+00024540: 652e 222e 666f 726d 6174 2864 696d 3d64  e.".format(dim=d
+00024550: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00024560: 2020 290a 0a20 2020 2020 2020 2076 6172    )..        var
+00024570: 6961 626c 6573 3a20 6469 6374 5b48 6173  iables: dict[Has
+00024580: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
+00024590: 203d 207b 7d0a 2020 2020 2020 2020 696e   = {}.        in
+000245a0: 6465 7865 733a 2064 6963 745b 4861 7368  dexes: dict[Hash
+000245b0: 6162 6c65 2c20 496e 6465 785d 203d 2064  able, Index] = d
+000245c0: 6963 7428 7365 6c66 2e5f 696e 6465 7865  ict(self._indexe
+000245d0: 7329 0a20 2020 2020 2020 2063 6f6f 7264  s).        coord
+000245e0: 5f6e 616d 6573 203d 2073 656c 662e 5f63  _names = self._c
+000245f0: 6f6f 7264 5f6e 616d 6573 2e63 6f70 7928  oord_names.copy(
+00024600: 290a 2020 2020 2020 2020 2320 4966 2064  ).        # If d
+00024610: 696d 2069 7320 6120 6469 6374 2c20 7468  im is a dict, th
+00024620: 656e 2065 6e73 7572 6520 7468 6174 2074  en ensure that t
+00024630: 6865 2076 616c 7565 7320 6172 6520 6569  he values are ei
+00024640: 7468 6572 2069 6e74 6567 6572 730a 2020  ther integers.  
+00024650: 2020 2020 2020 2320 6f72 2069 7465 7261        # or itera
+00024660: 626c 6573 2e0a 2020 2020 2020 2020 666f  bles..        fo
+00024670: 7220 6b2c 2076 2069 6e20 6469 6d2e 6974  r k, v in dim.it
+00024680: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+00024690: 2020 2069 6620 6861 7361 7474 7228 762c     if hasattr(v,
+000246a0: 2022 5f5f 6974 6572 5f5f 2229 3a0a 2020   "__iter__"):.  
+000246b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000246c0: 4966 2074 6865 2076 616c 7565 2066 6f72  If the value for
+000246d0: 2074 6865 206e 6577 2064 696d 656e 7369   the new dimensi
+000246e0: 6f6e 2069 7320 616e 2069 7465 7261 626c  on is an iterabl
+000246f0: 652c 2074 6865 6e0a 2020 2020 2020 2020  e, then.        
+00024700: 2020 2020 2020 2020 2320 7361 7665 2074          # save t
+00024710: 6865 2063 6f6f 7264 696e 6174 6573 2074  he coordinates t
+00024720: 6f20 7468 6520 7661 7269 6162 6c65 7320  o the variables 
+00024730: 6469 6374 2c20 616e 6420 7365 7420 7468  dict, and set th
+00024740: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00024750: 2020 2320 7661 6c75 6520 7769 7468 696e    # value within
+00024760: 2074 6865 2064 696d 2064 6963 7420 746f   the dim dict to
+00024770: 2074 6865 206c 656e 6774 6820 6f66 2074   the length of t
+00024780: 6865 2069 7465 7261 626c 650a 2020 2020  he iterable.    
+00024790: 2020 2020 2020 2020 2020 2020 2320 666f              # fo
+000247a0: 7220 6c61 7465 7220 7573 652e 0a20 2020  r later use..   
+000247b0: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+000247c0: 6578 203d 2050 616e 6461 7349 6e64 6578  ex = PandasIndex
+000247d0: 2876 2c20 6b29 0a20 2020 2020 2020 2020  (v, k).         
+000247e0: 2020 2020 2020 2069 6e64 6578 6573 5b6b         indexes[k
+000247f0: 5d20 3d20 696e 6465 780a 2020 2020 2020  ] = index.      
+00024800: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+00024810: 6c65 732e 7570 6461 7465 2869 6e64 6578  les.update(index
+00024820: 2e63 7265 6174 655f 7661 7269 6162 6c65  .create_variable
+00024830: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
+00024840: 2020 2020 2063 6f6f 7264 5f6e 616d 6573       coord_names
+00024850: 2e61 6464 286b 290a 2020 2020 2020 2020  .add(k).        
+00024860: 2020 2020 2020 2020 6469 6d5b 6b5d 203d          dim[k] =
+00024870: 2076 6172 6961 626c 6573 5b6b 5d2e 7369   variables[k].si
+00024880: 7a65 0a20 2020 2020 2020 2020 2020 2065  ze.            e
+00024890: 6c69 6620 6973 696e 7374 616e 6365 2876  lif isinstance(v
+000248a0: 2c20 696e 7429 3a0a 2020 2020 2020 2020  , int):.        
+000248b0: 2020 2020 2020 2020 7061 7373 2020 2320          pass  # 
+000248c0: 446f 206e 6f74 6869 6e67 2069 6620 7468  Do nothing if th
+000248d0: 6520 6469 6d65 6e73 696f 6e73 2076 616c  e dimensions val
+000248e0: 7565 2069 7320 6a75 7374 2061 6e20 696e  ue is just an in
+000248f0: 740a 2020 2020 2020 2020 2020 2020 656c  t.            el
+00024900: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00024910: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+00024920: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00024930: 2020 2020 2020 2020 2022 5468 6520 7661           "The va
+00024940: 6c75 6520 6f66 206e 6577 2064 696d 656e  lue of new dimen
+00024950: 7369 6f6e 207b 6b7d 206d 7573 7420 6265  sion {k} must be
+00024960: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00024970: 2020 2020 2020 2022 616e 2069 7465 7261         "an itera
+00024980: 626c 6520 6f72 2061 6e20 696e 7422 2e66  ble or an int".f
+00024990: 6f72 6d61 7428 6b3d 6b29 0a20 2020 2020  ormat(k=k).     
+000249a0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+000249b0: 2020 2020 2020 666f 7220 6b2c 2076 2069        for k, v i
+000249c0: 6e20 7365 6c66 2e5f 7661 7269 6162 6c65  n self._variable
+000249d0: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+000249e0: 2020 2020 2020 2069 6620 6b20 6e6f 7420         if k not 
+000249f0: 696e 2064 696d 3a0a 2020 2020 2020 2020  in dim:.        
+00024a00: 2020 2020 2020 2020 6966 206b 2069 6e20          if k in 
+00024a10: 636f 6f72 645f 6e61 6d65 733a 2020 2320  coord_names:  # 
+00024a20: 446f 206e 6f74 2063 6861 6e67 6520 636f  Do not change co
+00024a30: 6f72 6469 6e61 7465 730a 2020 2020 2020  ordinates.      
+00024a40: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00024a50: 7269 6162 6c65 735b 6b5d 203d 2076 0a20  riables[k] = v. 
+00024a60: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00024a70: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00024a80: 2020 2020 2020 2020 2072 6573 756c 745f           result_
+00024a90: 6e64 696d 203d 206c 656e 2876 2e64 696d  ndim = len(v.dim
+00024aa0: 7329 202b 206c 656e 2861 7869 7329 0a20  s) + len(axis). 
+00024ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ac0: 2020 2066 6f72 2061 2069 6e20 6178 6973     for a in axis
+00024ad0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00024ae0: 2020 2020 2020 2020 2020 6966 2061 203c            if a <
+00024af0: 202d 7265 7375 6c74 5f6e 6469 6d20 6f72   -result_ndim or
+00024b00: 2072 6573 756c 745f 6e64 696d 202d 2031   result_ndim - 1
+00024b10: 203c 2061 3a0a 2020 2020 2020 2020 2020   < a:.          
+00024b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b30: 2020 7261 6973 6520 496e 6465 7845 7272    raise IndexErr
+00024b40: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00024b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b60: 2020 2020 6622 4178 6973 207b 617d 206f      f"Axis {a} o
+00024b70: 6620 7661 7269 6162 6c65 207b 6b7d 2069  f variable {k} i
+00024b80: 7320 6f75 7420 6f66 2062 6f75 6e64 7320  s out of bounds 
+00024b90: 6f66 2074 6865 2022 0a20 2020 2020 2020  of the ".       
+00024ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024bb0: 2020 2020 2020 2020 2066 2265 7870 616e           f"expan
+00024bc0: 6465 6420 6469 6d65 6e73 696f 6e20 7369  ded dimension si
+00024bd0: 7a65 207b 7265 7375 6c74 5f6e 6469 6d7d  ze {result_ndim}
+00024be0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00024bf0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00024c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024c10: 2020 2020 2061 7869 735f 706f 7320 3d20       axis_pos = 
+00024c20: 5b61 2069 6620 6120 3e3d 2030 2065 6c73  [a if a >= 0 els
+00024c30: 6520 7265 7375 6c74 5f6e 6469 6d20 2b20  e result_ndim + 
+00024c40: 6120 666f 7220 6120 696e 2061 7869 735d  a for a in axis]
+00024c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024c60: 2020 2020 2069 6620 6c65 6e28 6178 6973       if len(axis
+00024c70: 5f70 6f73 2920 213d 206c 656e 2873 6574  _pos) != len(set
+00024c80: 2861 7869 735f 706f 7329 293a 0a20 2020  (axis_pos)):.   
+00024c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ca0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00024cb0: 4572 726f 7228 2261 7869 7320 7368 6f75  Error("axis shou
+00024cc0: 6c64 206e 6f74 2063 6f6e 7461 696e 2064  ld not contain d
+00024cd0: 7570 6c69 6361 7465 2076 616c 7565 7322  uplicate values"
+00024ce0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00024cf0: 2020 2020 2020 2320 5765 206e 6565 6420        # We need 
+00024d00: 746f 2073 6f72 7420 7468 656d 2074 6f20  to sort them to 
+00024d10: 6d61 6b65 2073 7572 6520 6061 7869 7360  make sure `axis`
+00024d20: 2065 7175 616c 7320 746f 2074 6865 0a20   equals to the. 
+00024d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024d40: 2020 2023 2061 7869 7320 706f 7369 7469     # axis positi
+00024d50: 6f6e 7320 6f66 2074 6865 2072 6573 756c  ons of the resul
+00024d60: 7420 6172 7261 792e 0a20 2020 2020 2020  t array..       
+00024d70: 2020 2020 2020 2020 2020 2020 207a 6970               zip
+00024d80: 5f61 7869 735f 6469 6d20 3d20 736f 7274  _axis_dim = sort
+00024d90: 6564 287a 6970 2861 7869 735f 706f 732c  ed(zip(axis_pos,
+00024da0: 2064 696d 2e69 7465 6d73 2829 2929 0a0a   dim.items()))..
+00024db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024dc0: 2020 2020 616c 6c5f 6469 6d73 203d 206c      all_dims = l
+00024dd0: 6973 7428 7a69 7028 762e 6469 6d73 2c20  ist(zip(v.dims, 
+00024de0: 762e 7368 6170 6529 290a 2020 2020 2020  v.shape)).      
+00024df0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00024e00: 7220 642c 2063 2069 6e20 7a69 705f 6178  r d, c in zip_ax
+00024e10: 6973 5f64 696d 3a0a 2020 2020 2020 2020  is_dim:.        
+00024e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e30: 616c 6c5f 6469 6d73 2e69 6e73 6572 7428  all_dims.insert(
+00024e40: 642c 2063 290a 2020 2020 2020 2020 2020  d, c).          
+00024e50: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+00024e60: 6c65 735b 6b5d 203d 2076 2e73 6574 5f64  les[k] = v.set_d
+00024e70: 696d 7328 6469 6374 2861 6c6c 5f64 696d  ims(dict(all_dim
+00024e80: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
+00024e90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00024ea0: 2020 2020 2020 6966 206b 206e 6f74 2069        if k not i
+00024eb0: 6e20 7661 7269 6162 6c65 733a 0a20 2020  n variables:.   
+00024ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ed0: 2023 2049 6620 6469 6d73 2069 6e63 6c75   # If dims inclu
+00024ee0: 6465 7320 6120 6c61 6265 6c20 6f66 2061  des a label of a
+00024ef0: 206e 6f6e 2d64 696d 656e 7369 6f6e 2063   non-dimension c
+00024f00: 6f6f 7264 696e 6174 652c 0a20 2020 2020  oordinate,.     
+00024f10: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00024f20: 2069 7420 7769 6c6c 2062 6520 7072 6f6d   it will be prom
+00024f30: 6f74 6564 2074 6f20 6120 3144 2063 6f6f  oted to a 1D coo
+00024f40: 7264 696e 6174 6520 7769 7468 2061 2073  rdinate with a s
+00024f50: 696e 676c 6520 7661 6c75 652e 0a20 2020  ingle value..   
+00024f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024f70: 2069 6e64 6578 2c20 696e 6465 785f 7661   index, index_va
+00024f80: 7273 203d 2063 7265 6174 655f 6465 6661  rs = create_defa
+00024f90: 756c 745f 696e 6465 785f 696d 706c 6963  ult_index_implic
+00024fa0: 6974 2876 2e73 6574 5f64 696d 7328 6b29  it(v.set_dims(k)
+00024fb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00024fc0: 2020 2020 2020 696e 6465 7865 735b 6b5d        indexes[k]
+00024fd0: 203d 2069 6e64 6578 0a20 2020 2020 2020   = index.       
+00024fe0: 2020 2020 2020 2020 2020 2020 2076 6172               var
+00024ff0: 6961 626c 6573 2e75 7064 6174 6528 696e  iables.update(in
+00025000: 6465 785f 7661 7273 290a 0a20 2020 2020  dex_vars)..     
+00025010: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00025020: 7265 706c 6163 655f 7769 7468 5f6e 6577  replace_with_new
+00025030: 5f64 696d 7328 0a20 2020 2020 2020 2020  _dims(.         
+00025040: 2020 2076 6172 6961 626c 6573 2c20 636f     variables, co
+00025050: 6f72 645f 6e61 6d65 733d 636f 6f72 645f  ord_names=coord_
+00025060: 6e61 6d65 732c 2069 6e64 6578 6573 3d69  names, indexes=i
+00025070: 6e64 6578 6573 0a20 2020 2020 2020 2029  ndexes.        )
+00025080: 0a0a 2020 2020 2320 6368 616e 6765 2074  ..    # change t
+00025090: 7970 6520 6f66 2073 656c 6620 616e 6420  ype of self and 
+000250a0: 7265 7475 726e 2074 6f20 545f 4461 7461  return to T_Data
+000250b0: 7365 7420 6f6e 6365 0a20 2020 2023 2068  set once.    # h
+000250c0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+000250d0: 6d2f 7079 7468 6f6e 2f6d 7970 792f 6973  m/python/mypy/is
+000250e0: 7375 6573 2f31 3238 3436 2069 7320 7265  sues/12846 is re
+000250f0: 736f 6c76 6564 0a20 2020 2064 6566 2073  solved.    def s
+00025100: 6574 5f69 6e64 6578 280a 2020 2020 2020  et_index(.      
+00025110: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00025120: 696e 6465 7865 733a 204d 6170 7069 6e67  indexes: Mapping
+00025130: 5b41 6e79 2c20 4861 7368 6162 6c65 207c  [Any, Hashable |
+00025140: 2053 6571 7565 6e63 655b 4861 7368 6162   Sequence[Hashab
+00025150: 6c65 5d5d 207c 204e 6f6e 6520 3d20 4e6f  le]] | None = No
+00025160: 6e65 2c0a 2020 2020 2020 2020 6170 7065  ne,.        appe
+00025170: 6e64 3a20 626f 6f6c 203d 2046 616c 7365  nd: bool = False
+00025180: 2c0a 2020 2020 2020 2020 2a2a 696e 6465  ,.        **inde
+00025190: 7865 735f 6b77 6172 6773 3a20 4861 7368  xes_kwargs: Hash
+000251a0: 6162 6c65 207c 2053 6571 7565 6e63 655b  able | Sequence[
+000251b0: 4861 7368 6162 6c65 5d2c 0a20 2020 2029  Hashable],.    )
+000251c0: 202d 3e20 4461 7461 7365 743a 0a20 2020   -> Dataset:.   
+000251d0: 2020 2020 2022 2222 5365 7420 4461 7461       """Set Data
+000251e0: 7365 7420 286d 756c 7469 2d29 696e 6465  set (multi-)inde
+000251f0: 7865 7320 7573 696e 6720 6f6e 6520 6f72  xes using one or
+00025200: 206d 6f72 6520 6578 6973 7469 6e67 2063   more existing c
+00025210: 6f6f 7264 696e 6174 6573 0a20 2020 2020  oordinates.     
+00025220: 2020 206f 7220 7661 7269 6162 6c65 732e     or variables.
+00025230: 0a0a 2020 2020 2020 2020 5468 6973 206c  ..        This l
+00025240: 6567 6163 7920 6d65 7468 6f64 2069 7320  egacy method is 
+00025250: 6c69 6d69 7465 6420 746f 2070 616e 6461  limited to panda
+00025260: 7320 286d 756c 7469 2d29 696e 6465 7865  s (multi-)indexe
+00025270: 7320 616e 640a 2020 2020 2020 2020 312d  s and.        1-
+00025280: 6469 6d65 6e73 696f 6e61 6c20 2264 696d  dimensional "dim
+00025290: 656e 7369 6f6e 2220 636f 6f72 6469 6e61  ension" coordina
+000252a0: 7465 732e 2053 6565 0a20 2020 2020 2020  tes. See.       
+000252b0: 203a 7079 3a6d 6574 683a 607e 4461 7461   :py:meth:`~Data
+000252c0: 7365 742e 7365 745f 7869 6e64 6578 6020  set.set_xindex` 
+000252d0: 666f 7220 7365 7474 696e 6720 6120 7061  for setting a pa
+000252e0: 6e64 6173 206f 7220 6120 6375 7374 6f6d  ndas or a custom
+000252f0: 0a20 2020 2020 2020 2058 6172 7261 792d  .        Xarray-
+00025300: 636f 6d70 6174 6962 6c65 2069 6e64 6578  compatible index
+00025310: 2066 726f 6d20 6f6e 6520 6f72 206d 6f72   from one or mor
+00025320: 6520 6172 6269 7472 6172 7920 636f 6f72  e arbitrary coor
+00025330: 6469 6e61 7465 732e 0a0a 2020 2020 2020  dinates...      
+00025340: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00025350: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00025360: 2020 2020 2020 2020 696e 6465 7865 7320          indexes 
+00025370: 3a20 7b64 696d 3a20 696e 6465 782c 202e  : {dim: index, .
+00025380: 2e2e 7d0a 2020 2020 2020 2020 2020 2020  ..}.            
+00025390: 4d61 7070 696e 6720 6672 6f6d 206e 616d  Mapping from nam
+000253a0: 6573 206d 6174 6368 696e 6720 6469 6d65  es matching dime
+000253b0: 6e73 696f 6e73 2061 6e64 2076 616c 7565  nsions and value
+000253c0: 7320 6769 7665 6e0a 2020 2020 2020 2020  s given.        
+000253d0: 2020 2020 6279 2028 6c69 7374 7320 6f66      by (lists of
+000253e0: 2920 7468 6520 6e61 6d65 7320 6f66 2065  ) the names of e
+000253f0: 7869 7374 696e 6720 636f 6f72 6469 6e61  xisting coordina
+00025400: 7465 7320 6f72 2076 6172 6961 626c 6573  tes or variables
+00025410: 2074 6f20 7365 740a 2020 2020 2020 2020   to set.        
+00025420: 2020 2020 6173 206e 6577 2028 6d75 6c74      as new (mult
+00025430: 692d 2969 6e64 6578 2e0a 2020 2020 2020  i-)index..      
+00025440: 2020 6170 7065 6e64 203a 2062 6f6f 6c2c    append : bool,
+00025450: 2064 6566 6175 6c74 3a20 4661 6c73 650a   default: False.
+00025460: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+00025470: 7275 652c 2061 7070 656e 6420 7468 6520  rue, append the 
+00025480: 7375 7070 6c69 6564 2069 6e64 6578 2865  supplied index(e
+00025490: 7329 2074 6f20 7468 6520 6578 6973 7469  s) to the existi
+000254a0: 6e67 2069 6e64 6578 2865 7329 2e0a 2020  ng index(es)..  
+000254b0: 2020 2020 2020 2020 2020 4f74 6865 7277            Otherw
+000254c0: 6973 6520 7265 706c 6163 6520 7468 6520  ise replace the 
+000254d0: 6578 6973 7469 6e67 2069 6e64 6578 2865  existing index(e
+000254e0: 7329 2028 6465 6661 756c 7429 2e0a 2020  s) (default)..  
+000254f0: 2020 2020 2020 2a2a 696e 6465 7865 735f        **indexes_
+00025500: 6b77 6172 6773 203a 206f 7074 696f 6e61  kwargs : optiona
+00025510: 6c0a 2020 2020 2020 2020 2020 2020 5468  l.            Th
+00025520: 6520 6b65 7977 6f72 6420 6172 6775 6d65  e keyword argume
+00025530: 6e74 7320 666f 726d 206f 6620 6060 696e  nts form of ``in
+00025540: 6465 7865 7360 602e 0a20 2020 2020 2020  dexes``..       
+00025550: 2020 2020 204f 6e65 206f 6620 696e 6465       One of inde
+00025560: 7865 7320 6f72 2069 6e64 6578 6573 5f6b  xes or indexes_k
+00025570: 7761 7267 7320 6d75 7374 2062 6520 7072  wargs must be pr
+00025580: 6f76 6964 6564 2e0a 0a20 2020 2020 2020  ovided...       
+00025590: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+000255a0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+000255b0: 206f 626a 203a 2044 6174 6173 6574 0a20   obj : Dataset. 
+000255c0: 2020 2020 2020 2020 2020 2041 6e6f 7468             Anoth
+000255d0: 6572 2064 6174 6173 6574 2c20 7769 7468  er dataset, with
+000255e0: 2074 6869 7320 6461 7461 7365 7427 7320   this dataset's 
+000255f0: 6461 7461 2062 7574 2072 6570 6c61 6365  data but replace
+00025600: 6420 636f 6f72 6469 6e61 7465 732e 0a0a  d coordinates...
+00025610: 2020 2020 2020 2020 4578 616d 706c 6573          Examples
+00025620: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00025630: 2d0a 2020 2020 2020 2020 3e3e 3e20 6172  -.        >>> ar
+00025640: 7220 3d20 7872 2e44 6174 6141 7272 6179  r = xr.DataArray
+00025650: 280a 2020 2020 2020 2020 2e2e 2e20 2020  (.        ...   
+00025660: 2020 6461 7461 3d6e 702e 6f6e 6573 2828    data=np.ones((
+00025670: 322c 2033 2929 2c0a 2020 2020 2020 2020  2, 3)),.        
+00025680: 2e2e 2e20 2020 2020 6469 6d73 3d5b 2278  ...     dims=["x
+00025690: 222c 2022 7922 5d2c 0a20 2020 2020 2020  ", "y"],.       
+000256a0: 202e 2e2e 2020 2020 2063 6f6f 7264 733d   ...     coords=
+000256b0: 7b22 7822 3a20 7261 6e67 6528 3229 2c20  {"x": range(2), 
+000256c0: 2279 223a 2072 616e 6765 2833 292c 2022  "y": range(3), "
+000256d0: 6122 3a20 2822 7822 2c20 5b33 2c20 345d  a": ("x", [3, 4]
+000256e0: 297d 2c0a 2020 2020 2020 2020 2e2e 2e20  )},.        ... 
+000256f0: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
+00025700: 203d 2078 722e 4461 7461 7365 7428 7b22   = xr.Dataset({"
+00025710: 7622 3a20 6172 727d 290a 2020 2020 2020  v": arr}).      
+00025720: 2020 3e3e 3e20 6473 0a20 2020 2020 2020    >>> ds.       
+00025730: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
+00025740: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
+00025750: 696f 6e73 3a20 2028 783a 2032 2c20 793a  ions:  (x: 2, y:
+00025760: 2033 290a 2020 2020 2020 2020 436f 6f72   3).        Coor
+00025770: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
+00025780: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
+00025790: 2920 696e 7436 3420 3020 310a 2020 2020  ) int64 0 1.    
+000257a0: 2020 2020 2020 2a20 7920 2020 2020 2020        * y       
+000257b0: 2028 7929 2069 6e74 3634 2030 2031 2032   (y) int64 0 1 2
+000257c0: 0a20 2020 2020 2020 2020 2020 2061 2020  .            a  
+000257d0: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
+000257e0: 3320 340a 2020 2020 2020 2020 4461 7461  3 4.        Data
+000257f0: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+00025800: 2020 2020 2020 2020 7620 2020 2020 2020          v       
+00025810: 2028 782c 2079 2920 666c 6f61 7436 3420   (x, y) float64 
+00025820: 312e 3020 312e 3020 312e 3020 312e 3020  1.0 1.0 1.0 1.0 
+00025830: 312e 3020 312e 300a 2020 2020 2020 2020  1.0 1.0.        
+00025840: 3e3e 3e20 6473 2e73 6574 5f69 6e64 6578  >>> ds.set_index
+00025850: 2878 3d22 6122 290a 2020 2020 2020 2020  (x="a").        
+00025860: 3c78 6172 7261 792e 4461 7461 7365 743e  <xarray.Dataset>
+00025870: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+00025880: 6f6e 733a 2020 2878 3a20 322c 2079 3a20  ons:  (x: 2, y: 
+00025890: 3329 0a20 2020 2020 2020 2043 6f6f 7264  3).        Coord
+000258a0: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
+000258b0: 2020 2a20 7820 2020 2020 2020 2028 7829    * x        (x)
+000258c0: 2069 6e74 3634 2033 2034 0a20 2020 2020   int64 3 4.     
+000258d0: 2020 2020 202a 2079 2020 2020 2020 2020       * y        
+000258e0: 2879 2920 696e 7436 3420 3020 3120 320a  (y) int64 0 1 2.
+000258f0: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
+00025900: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
+00025910: 2020 2020 7620 2020 2020 2020 2028 782c      v        (x,
+00025920: 2079 2920 666c 6f61 7436 3420 312e 3020   y) float64 1.0 
+00025930: 312e 3020 312e 3020 312e 3020 312e 3020  1.0 1.0 1.0 1.0 
+00025940: 312e 300a 0a20 2020 2020 2020 2053 6565  1.0..        See
+00025950: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+00025960: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
+00025970: 6174 6173 6574 2e72 6573 6574 5f69 6e64  ataset.reset_ind
+00025980: 6578 0a20 2020 2020 2020 2044 6174 6173  ex.        Datas
+00025990: 6574 2e73 6574 5f78 696e 6465 780a 2020  et.set_xindex.  
+000259a0: 2020 2020 2020 4461 7461 7365 742e 7377        Dataset.sw
+000259b0: 6170 5f64 696d 730a 2020 2020 2020 2020  ap_dims.        
+000259c0: 2222 220a 2020 2020 2020 2020 6469 6d5f  """.        dim_
+000259d0: 636f 6f72 6473 203d 2065 6974 6865 725f  coords = either_
+000259e0: 6469 6374 5f6f 725f 6b77 6172 6773 2869  dict_or_kwargs(i
+000259f0: 6e64 6578 6573 2c20 696e 6465 7865 735f  ndexes, indexes_
+00025a00: 6b77 6172 6773 2c20 2273 6574 5f69 6e64  kwargs, "set_ind
+00025a10: 6578 2229 0a0a 2020 2020 2020 2020 6e65  ex")..        ne
+00025a20: 775f 696e 6465 7865 733a 2064 6963 745b  w_indexes: dict[
+00025a30: 4861 7368 6162 6c65 2c20 496e 6465 785d  Hashable, Index]
+00025a40: 203d 207b 7d0a 2020 2020 2020 2020 6e65   = {}.        ne
+00025a50: 775f 7661 7269 6162 6c65 733a 2064 6963  w_variables: dic
+00025a60: 745b 4861 7368 6162 6c65 2c20 5661 7269  t[Hashable, Vari
+00025a70: 6162 6c65 5d20 3d20 7b7d 0a20 2020 2020  able] = {}.     
+00025a80: 2020 2064 726f 705f 696e 6465 7865 733a     drop_indexes:
+00025a90: 2073 6574 5b48 6173 6861 626c 655d 203d   set[Hashable] =
+00025aa0: 2073 6574 2829 0a20 2020 2020 2020 2064   set().        d
+00025ab0: 726f 705f 7661 7269 6162 6c65 733a 2073  rop_variables: s
+00025ac0: 6574 5b48 6173 6861 626c 655d 203d 2073  et[Hashable] = s
+00025ad0: 6574 2829 0a20 2020 2020 2020 2072 6570  et().        rep
+00025ae0: 6c61 6365 5f64 696d 733a 2064 6963 745b  lace_dims: dict[
+00025af0: 4861 7368 6162 6c65 2c20 4861 7368 6162  Hashable, Hashab
+00025b00: 6c65 5d20 3d20 7b7d 0a20 2020 2020 2020  le] = {}.       
+00025b10: 2061 6c6c 5f76 6172 5f6e 616d 6573 3a20   all_var_names: 
+00025b20: 7365 745b 4861 7368 6162 6c65 5d20 3d20  set[Hashable] = 
+00025b30: 7365 7428 290a 0a20 2020 2020 2020 2066  set()..        f
+00025b40: 6f72 2064 696d 2c20 5f76 6172 5f6e 616d  or dim, _var_nam
+00025b50: 6573 2069 6e20 6469 6d5f 636f 6f72 6473  es in dim_coords
+00025b60: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+00025b70: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00025b80: 6e63 6528 5f76 6172 5f6e 616d 6573 2c20  nce(_var_names, 
+00025b90: 7374 7229 206f 7220 6e6f 7420 6973 696e  str) or not isin
+00025ba0: 7374 616e 6365 285f 7661 725f 6e61 6d65  stance(_var_name
+00025bb0: 732c 2053 6571 7565 6e63 6529 3a0a 2020  s, Sequence):.  
+00025bc0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00025bd0: 725f 6e61 6d65 7320 3d20 5b5f 7661 725f  r_names = [_var_
+00025be0: 6e61 6d65 735d 0a20 2020 2020 2020 2020  names].         
+00025bf0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00025c00: 2020 2020 2020 2020 2076 6172 5f6e 616d           var_nam
+00025c10: 6573 203d 206c 6973 7428 5f76 6172 5f6e  es = list(_var_n
+00025c20: 616d 6573 290a 0a20 2020 2020 2020 2020  ames)..         
+00025c30: 2020 2069 6e76 616c 6964 5f76 6172 7320     invalid_vars 
+00025c40: 3d20 7365 7428 7661 725f 6e61 6d65 7329  = set(var_names)
+00025c50: 202d 2073 6574 2873 656c 662e 5f76 6172   - set(self._var
+00025c60: 6961 626c 6573 290a 2020 2020 2020 2020  iables).        
+00025c70: 2020 2020 6966 2069 6e76 616c 6964 5f76      if invalid_v
+00025c80: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
+00025c90: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00025ca0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00025cb0: 2020 2020 2020 2020 2020 2022 2c20 222e             ", ".
+00025cc0: 6a6f 696e 285b 7374 7228 7629 2066 6f72  join([str(v) for
+00025cd0: 2076 2069 6e20 696e 7661 6c69 645f 7661   v in invalid_va
+00025ce0: 7273 5d29 0a20 2020 2020 2020 2020 2020  rs]).           
+00025cf0: 2020 2020 2020 2020 202b 2022 2076 6172           + " var
+00025d00: 6961 626c 6528 7329 2064 6f20 6e6f 7420  iable(s) do not 
+00025d10: 6578 6973 7422 0a20 2020 2020 2020 2020  exist".         
+00025d20: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00025d30: 2020 2020 2020 616c 6c5f 7661 725f 6e61        all_var_na
+00025d40: 6d65 732e 7570 6461 7465 2876 6172 5f6e  mes.update(var_n
+00025d50: 616d 6573 290a 2020 2020 2020 2020 2020  ames).          
+00025d60: 2020 6472 6f70 5f76 6172 6961 626c 6573    drop_variables
+00025d70: 2e75 7064 6174 6528 7661 725f 6e61 6d65  .update(var_name
+00025d80: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+00025d90: 2320 6472 6f70 2061 6e79 2070 7265 2d65  # drop any pre-e
+00025da0: 7869 7374 696e 6720 696e 6465 7820 696e  xisting index in
+00025db0: 766f 6c76 6564 2061 6e64 2069 7473 2063  volved and its c
+00025dc0: 6f72 7265 7370 6f6e 6469 6e67 2063 6f6f  orresponding coo
+00025dd0: 7264 696e 6174 6573 0a20 2020 2020 2020  rdinates.       
+00025de0: 2020 2020 2069 6e64 6578 5f63 6f6f 7264       index_coord
+00025df0: 5f6e 616d 6573 203d 2073 656c 662e 7869  _names = self.xi
+00025e00: 6e64 6578 6573 2e67 6574 5f61 6c6c 5f63  ndexes.get_all_c
+00025e10: 6f6f 7264 7328 6469 6d2c 2065 7272 6f72  oords(dim, error
+00025e20: 733d 2269 676e 6f72 6522 290a 2020 2020  s="ignore").    
+00025e30: 2020 2020 2020 2020 616c 6c5f 696e 6465          all_inde
+00025e40: 785f 636f 6f72 645f 6e61 6d65 7320 3d20  x_coord_names = 
+00025e50: 7365 7428 696e 6465 785f 636f 6f72 645f  set(index_coord_
+00025e60: 6e61 6d65 7329 0a20 2020 2020 2020 2020  names).         
+00025e70: 2020 2066 6f72 206b 2069 6e20 7661 725f     for k in var_
+00025e80: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
+00025e90: 2020 2020 2020 2061 6c6c 5f69 6e64 6578         all_index
+00025ea0: 5f63 6f6f 7264 5f6e 616d 6573 2e75 7064  _coord_names.upd
+00025eb0: 6174 6528 0a20 2020 2020 2020 2020 2020  ate(.           
+00025ec0: 2020 2020 2020 2020 2073 656c 662e 7869           self.xi
+00025ed0: 6e64 6578 6573 2e67 6574 5f61 6c6c 5f63  ndexes.get_all_c
+00025ee0: 6f6f 7264 7328 6b2c 2065 7272 6f72 733d  oords(k, errors=
+00025ef0: 2269 676e 6f72 6522 290a 2020 2020 2020  "ignore").      
+00025f00: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00025f10: 2020 2020 2020 2020 2064 726f 705f 696e           drop_in
+00025f20: 6465 7865 732e 7570 6461 7465 2861 6c6c  dexes.update(all
+00025f30: 5f69 6e64 6578 5f63 6f6f 7264 5f6e 616d  _index_coord_nam
+00025f40: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+00025f50: 6472 6f70 5f76 6172 6961 626c 6573 2e75  drop_variables.u
+00025f60: 7064 6174 6528 616c 6c5f 696e 6465 785f  pdate(all_index_
+00025f70: 636f 6f72 645f 6e61 6d65 7329 0a0a 2020  coord_names)..  
+00025f80: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00025f90: 2876 6172 5f6e 616d 6573 2920 3d3d 2031  (var_names) == 1
+00025fa0: 2061 6e64 2028 6e6f 7420 6170 7065 6e64   and (not append
+00025fb0: 206f 7220 6469 6d20 6e6f 7420 696e 2073   or dim not in s
+00025fc0: 656c 662e 5f69 6e64 6578 6573 293a 0a20  elf._indexes):. 
+00025fd0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00025fe0: 6172 5f6e 616d 6520 3d20 7661 725f 6e61  ar_name = var_na
+00025ff0: 6d65 735b 305d 0a20 2020 2020 2020 2020  mes[0].         
+00026000: 2020 2020 2020 2076 6172 203d 2073 656c         var = sel
+00026010: 662e 5f76 6172 6961 626c 6573 5b76 6172  f._variables[var
+00026020: 5f6e 616d 655d 0a20 2020 2020 2020 2020  _name].         
+00026030: 2020 2020 2020 2069 6620 7661 722e 6469         if var.di
+00026040: 6d73 2021 3d20 2864 696d 2c29 3a0a 2020  ms != (dim,):.  
+00026050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026060: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00026070: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00026080: 2020 2020 2020 2020 2020 2020 6622 6469              f"di
+00026090: 6d65 6e73 696f 6e20 6d69 736d 6174 6368  mension mismatch
+000260a0: 3a20 7472 7920 7365 7474 696e 6720 616e  : try setting an
+000260b0: 2069 6e64 6578 2066 6f72 2064 696d 656e   index for dimen
+000260c0: 7369 6f6e 207b 6469 6d21 727d 2077 6974  sion {dim!r} wit
+000260d0: 6820 220a 2020 2020 2020 2020 2020 2020  h ".            
+000260e0: 2020 2020 2020 2020 2020 2020 6622 7661              f"va
+000260f0: 7269 6162 6c65 207b 7661 725f 6e61 6d65  riable {var_name
+00026100: 2172 7d20 7468 6174 2068 6173 2064 696d  !r} that has dim
+00026110: 656e 7369 6f6e 7320 7b76 6172 2e64 696d  ensions {var.dim
+00026120: 737d 220a 2020 2020 2020 2020 2020 2020  s}".            
+00026130: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00026140: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
+00026150: 5061 6e64 6173 496e 6465 782e 6672 6f6d  PandasIndex.from
+00026160: 5f76 6172 6961 626c 6573 287b 6469 6d3a  _variables({dim:
+00026170: 2076 6172 7d2c 206f 7074 696f 6e73 3d7b   var}, options={
+00026180: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
+00026190: 2020 2069 6478 5f76 6172 7320 3d20 6964     idx_vars = id
+000261a0: 782e 6372 6561 7465 5f76 6172 6961 626c  x.create_variabl
+000261b0: 6573 287b 7661 725f 6e61 6d65 3a20 7661  es({var_name: va
+000261c0: 727d 290a 0a20 2020 2020 2020 2020 2020  r})..           
+000261d0: 2020 2020 2023 2074 7269 636b 2074 6f20       # trick to 
+000261e0: 7072 6573 6572 7665 2063 6f6f 7264 696e  preserve coordin
+000261f0: 6174 6520 6f72 6465 7220 696e 2074 6869  ate order in thi
+00026200: 7320 6361 7365 0a20 2020 2020 2020 2020  s case.         
+00026210: 2020 2020 2020 2069 6620 6469 6d20 696e         if dim in
+00026220: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
+00026230: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00026240: 2020 2020 2020 2020 6472 6f70 5f76 6172          drop_var
+00026250: 6961 626c 6573 2e72 656d 6f76 6528 6469  iables.remove(di
+00026260: 6d29 0a20 2020 2020 2020 2020 2020 2065  m).            e
+00026270: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00026280: 2020 2020 2069 6620 6170 7065 6e64 3a0a       if append:.
+00026290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000262a0: 2020 2020 6375 7272 656e 745f 7661 7269      current_vari
+000262b0: 6162 6c65 7320 3d20 7b0a 2020 2020 2020  ables = {.      
+000262c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000262d0: 2020 6b3a 2073 656c 662e 5f76 6172 6961    k: self._varia
+000262e0: 626c 6573 5b6b 5d20 666f 7220 6b20 696e  bles[k] for k in
+000262f0: 2069 6e64 6578 5f63 6f6f 7264 5f6e 616d   index_coord_nam
+00026300: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00026310: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00026320: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00026330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026340: 2020 2063 7572 7265 6e74 5f76 6172 6961     current_varia
+00026350: 626c 6573 203d 207b 7d0a 2020 2020 2020  bles = {}.      
+00026360: 2020 2020 2020 2020 2020 6964 782c 2069            idx, i
+00026370: 6478 5f76 6172 7320 3d20 5061 6e64 6173  dx_vars = Pandas
+00026380: 4d75 6c74 6949 6e64 6578 2e66 726f 6d5f  MultiIndex.from_
+00026390: 7661 7269 6162 6c65 735f 6d61 7962 655f  variables_maybe_
+000263a0: 6578 7061 6e64 280a 2020 2020 2020 2020  expand(.        
+000263b0: 2020 2020 2020 2020 2020 2020 6469 6d2c              dim,
+000263c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000263d0: 2020 2020 2063 7572 7265 6e74 5f76 6172       current_var
+000263e0: 6961 626c 6573 2c0a 2020 2020 2020 2020  iables,.        
+000263f0: 2020 2020 2020 2020 2020 2020 7b6b 3a20              {k: 
+00026400: 7365 6c66 2e5f 7661 7269 6162 6c65 735b  self._variables[
+00026410: 6b5d 2066 6f72 206b 2069 6e20 7661 725f  k] for k in var_
+00026420: 6e61 6d65 737d 2c0a 2020 2020 2020 2020  names},.        
+00026430: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00026440: 2020 2020 2020 2020 2020 666f 7220 6e20            for n 
+00026450: 696e 2069 6478 2e69 6e64 6578 2e6e 616d  in idx.index.nam
+00026460: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00026470: 2020 2020 2020 2020 7265 706c 6163 655f          replace_
+00026480: 6469 6d73 5b6e 5d20 3d20 6469 6d0a 0a20  dims[n] = dim.. 
+00026490: 2020 2020 2020 2020 2020 206e 6577 5f69             new_i
+000264a0: 6e64 6578 6573 2e75 7064 6174 6528 7b6b  ndexes.update({k
+000264b0: 3a20 6964 7820 666f 7220 6b20 696e 2069  : idx for k in i
+000264c0: 6478 5f76 6172 737d 290a 2020 2020 2020  dx_vars}).      
+000264d0: 2020 2020 2020 6e65 775f 7661 7269 6162        new_variab
+000264e0: 6c65 732e 7570 6461 7465 2869 6478 5f76  les.update(idx_v
+000264f0: 6172 7329 0a0a 2020 2020 2020 2020 2320  ars)..        # 
+00026500: 7265 2d61 6464 2064 6569 6e64 6578 6564  re-add deindexed
+00026510: 2063 6f6f 7264 696e 6174 6573 2028 636f   coordinates (co
+00026520: 6e76 6572 7420 746f 2062 6173 6520 7661  nvert to base va
+00026530: 7269 6162 6c65 7329 0a20 2020 2020 2020  riables).       
+00026540: 2066 6f72 206b 2069 6e20 6472 6f70 5f76   for k in drop_v
+00026550: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+00026560: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+00026570: 2020 2020 2020 2020 2020 206b 206e 6f74             k not
+00026580: 2069 6e20 6e65 775f 7661 7269 6162 6c65   in new_variable
+00026590: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+000265a0: 2020 616e 6420 6b20 6e6f 7420 696e 2061    and k not in a
+000265b0: 6c6c 5f76 6172 5f6e 616d 6573 0a20 2020  ll_var_names.   
+000265c0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+000265d0: 206b 2069 6e20 7365 6c66 2e5f 636f 6f72   k in self._coor
+000265e0: 645f 6e61 6d65 730a 2020 2020 2020 2020  d_names.        
+000265f0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00026600: 2020 2020 2020 206e 6577 5f76 6172 6961         new_varia
+00026610: 626c 6573 5b6b 5d20 3d20 7365 6c66 2e5f  bles[k] = self._
+00026620: 7661 7269 6162 6c65 735b 6b5d 2e74 6f5f  variables[k].to_
+00026630: 6261 7365 5f76 6172 6961 626c 6528 290a  base_variable().
+00026640: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
+00026650: 5f3a 2064 6963 745b 416e 792c 2049 6e64  _: dict[Any, Ind
+00026660: 6578 5d20 3d20 7b0a 2020 2020 2020 2020  ex] = {.        
+00026670: 2020 2020 6b3a 2076 2066 6f72 206b 2c20      k: v for k, 
+00026680: 7620 696e 2073 656c 662e 5f69 6e64 6578  v in self._index
+00026690: 6573 2e69 7465 6d73 2829 2069 6620 6b20  es.items() if k 
+000266a0: 6e6f 7420 696e 2064 726f 705f 696e 6465  not in drop_inde
+000266b0: 7865 730a 2020 2020 2020 2020 7d0a 2020  xes.        }.  
+000266c0: 2020 2020 2020 696e 6465 7865 735f 2e75        indexes_.u
+000266d0: 7064 6174 6528 6e65 775f 696e 6465 7865  pdate(new_indexe
+000266e0: 7329 0a0a 2020 2020 2020 2020 7661 7269  s)..        vari
+000266f0: 6162 6c65 7320 3d20 7b0a 2020 2020 2020  ables = {.      
+00026700: 2020 2020 2020 6b3a 2076 2066 6f72 206b        k: v for k
+00026710: 2c20 7620 696e 2073 656c 662e 5f76 6172  , v in self._var
+00026720: 6961 626c 6573 2e69 7465 6d73 2829 2069  iables.items() i
+00026730: 6620 6b20 6e6f 7420 696e 2064 726f 705f  f k not in drop_
+00026740: 7661 7269 6162 6c65 730a 2020 2020 2020  variables.      
+00026750: 2020 7d0a 2020 2020 2020 2020 7661 7269    }.        vari
+00026760: 6162 6c65 732e 7570 6461 7465 286e 6577  ables.update(new
+00026770: 5f76 6172 6961 626c 6573 290a 0a20 2020  _variables)..   
+00026780: 2020 2020 2023 2075 7064 6174 6520 6469       # update di
+00026790: 6d65 6e73 696f 6e73 2069 6620 6e65 6365  mensions if nece
+000267a0: 7373 6172 792c 2047 483a 2033 3531 320a  ssary, GH: 3512.
+000267b0: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
+000267c0: 2069 6e20 7661 7269 6162 6c65 732e 6974   in variables.it
+000267d0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+000267e0: 2020 2069 6620 616e 7928 6420 696e 2072     if any(d in r
+000267f0: 6570 6c61 6365 5f64 696d 7320 666f 7220  eplace_dims for 
+00026800: 6420 696e 2076 2e64 696d 7329 3a0a 2020  d in v.dims):.  
+00026810: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00026820: 775f 6469 6d73 203d 205b 7265 706c 6163  w_dims = [replac
+00026830: 655f 6469 6d73 2e67 6574 2864 2c20 6429  e_dims.get(d, d)
+00026840: 2066 6f72 2064 2069 6e20 762e 6469 6d73   for d in v.dims
+00026850: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00026860: 2020 7661 7269 6162 6c65 735b 6b5d 203d    variables[k] =
+00026870: 2076 2e5f 7265 706c 6163 6528 6469 6d73   v._replace(dims
+00026880: 3d6e 6577 5f64 696d 7329 0a0a 2020 2020  =new_dims)..    
+00026890: 2020 2020 636f 6f72 645f 6e61 6d65 7320      coord_names 
+000268a0: 3d20 7365 6c66 2e5f 636f 6f72 645f 6e61  = self._coord_na
+000268b0: 6d65 7320 2d20 6472 6f70 5f76 6172 6961  mes - drop_varia
+000268c0: 626c 6573 207c 2073 6574 286e 6577 5f76  bles | set(new_v
+000268d0: 6172 6961 626c 6573 290a 0a20 2020 2020  ariables)..     
+000268e0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+000268f0: 7265 706c 6163 655f 7769 7468 5f6e 6577  replace_with_new
+00026900: 5f64 696d 7328 0a20 2020 2020 2020 2020  _dims(.         
+00026910: 2020 2076 6172 6961 626c 6573 2c20 636f     variables, co
+00026920: 6f72 645f 6e61 6d65 733d 636f 6f72 645f  ord_names=coord_
+00026930: 6e61 6d65 732c 2069 6e64 6578 6573 3d69  names, indexes=i
+00026940: 6e64 6578 6573 5f0a 2020 2020 2020 2020  ndexes_.        
+00026950: 290a 0a20 2020 2064 6566 2072 6573 6574  )..    def reset
+00026960: 5f69 6e64 6578 280a 2020 2020 2020 2020  _index(.        
+00026970: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
+00026980: 0a20 2020 2020 2020 2064 696d 735f 6f72  .        dims_or
+00026990: 5f6c 6576 656c 733a 2048 6173 6861 626c  _levels: Hashabl
+000269a0: 6520 7c20 5365 7175 656e 6365 5b48 6173  e | Sequence[Has
+000269b0: 6861 626c 655d 2c0a 2020 2020 2020 2020  hable],.        
+000269c0: 6472 6f70 3a20 626f 6f6c 203d 2046 616c  drop: bool = Fal
+000269d0: 7365 2c0a 2020 2020 2920 2d3e 2054 5f44  se,.    ) -> T_D
+000269e0: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
+000269f0: 2222 2252 6573 6574 2074 6865 2073 7065  """Reset the spe
+00026a00: 6369 6669 6564 2069 6e64 6578 2865 7329  cified index(es)
+00026a10: 206f 7220 6d75 6c74 692d 696e 6465 7820   or multi-index 
+00026a20: 6c65 7665 6c28 7329 2e0a 0a20 2020 2020  level(s)...     
+00026a30: 2020 2054 6869 7320 6c65 6761 6379 206d     This legacy m
+00026a40: 6574 686f 6420 6973 2073 7065 6369 6669  ethod is specifi
+00026a50: 6320 746f 2070 616e 6461 7320 286d 756c  c to pandas (mul
+00026a60: 7469 2d29 696e 6465 7865 7320 616e 640a  ti-)indexes and.
+00026a70: 2020 2020 2020 2020 312d 6469 6d65 6e73          1-dimens
+00026a80: 696f 6e61 6c20 2264 696d 656e 7369 6f6e  ional "dimension
+00026a90: 2220 636f 6f72 6469 6e61 7465 732e 2053  " coordinates. S
+00026aa0: 6565 2074 6865 206d 6f72 6520 6765 6e65  ee the more gene
+00026ab0: 7269 630a 2020 2020 2020 2020 3a70 793a  ric.        :py:
+00026ac0: 6d65 7468 3a60 7e44 6174 6173 6574 2e64  meth:`~Dataset.d
+00026ad0: 726f 705f 696e 6465 7865 7360 2061 6e64  rop_indexes` and
+00026ae0: 203a 7079 3a6d 6574 683a 607e 4461 7461   :py:meth:`~Data
+00026af0: 7365 742e 7365 745f 7869 6e64 6578 600a  set.set_xindex`.
+00026b00: 2020 2020 2020 2020 6d65 7468 6f64 2074          method t
+00026b10: 6f20 7265 7370 6563 7469 7665 6c79 2064  o respectively d
+00026b20: 726f 7020 616e 6420 7365 7420 7061 6e64  rop and set pand
+00026b30: 6173 206f 7220 6375 7374 6f6d 2069 6e64  as or custom ind
+00026b40: 6578 6573 2066 6f72 0a20 2020 2020 2020  exes for.       
+00026b50: 2061 7262 6974 7261 7279 2063 6f6f 7264   arbitrary coord
+00026b60: 696e 6174 6573 2e0a 0a20 2020 2020 2020  inates...       
+00026b70: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00026b80: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00026b90: 2020 2020 2020 2064 696d 735f 6f72 5f6c         dims_or_l
+00026ba0: 6576 656c 7320 3a20 4861 7368 6162 6c65  evels : Hashable
+00026bb0: 206f 7220 5365 7175 656e 6365 206f 6620   or Sequence of 
+00026bc0: 4861 7368 6162 6c65 0a20 2020 2020 2020  Hashable.       
+00026bd0: 2020 2020 204e 616d 6528 7329 206f 6620       Name(s) of 
+00026be0: 7468 6520 6469 6d65 6e73 696f 6e28 7329  the dimension(s)
+00026bf0: 2061 6e64 2f6f 7220 6d75 6c74 692d 696e   and/or multi-in
+00026c00: 6465 7820 6c65 7665 6c28 7329 2074 6861  dex level(s) tha
+00026c10: 7420 7769 6c6c 0a20 2020 2020 2020 2020  t will.         
+00026c20: 2020 2062 6520 7265 7365 742e 0a20 2020     be reset..   
+00026c30: 2020 2020 2064 726f 7020 3a20 626f 6f6c       drop : bool
+00026c40: 2c20 6465 6661 756c 743a 2046 616c 7365  , default: False
+00026c50: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00026c60: 5472 7565 2c20 7265 6d6f 7665 2074 6865  True, remove the
+00026c70: 2073 7065 6369 6669 6564 2069 6e64 6578   specified index
+00026c80: 6573 2061 6e64 2f6f 7220 6d75 6c74 692d  es and/or multi-
+00026c90: 696e 6465 7820 6c65 7665 6c73 0a20 2020  index levels.   
+00026ca0: 2020 2020 2020 2020 2069 6e73 7465 6164           instead
+00026cb0: 206f 6620 6578 7472 6163 7469 6e67 2074   of extracting t
+00026cc0: 6865 6d20 6173 206e 6577 2063 6f6f 7264  hem as new coord
+00026cd0: 696e 6174 6573 2028 6465 6661 756c 743a  inates (default:
+00026ce0: 2046 616c 7365 292e 0a0a 2020 2020 2020   False)...      
+00026cf0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+00026d00: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+00026d10: 2020 6f62 6a20 3a20 4461 7461 7365 740a    obj : Dataset.
+00026d20: 2020 2020 2020 2020 2020 2020 416e 6f74              Anot
+00026d30: 6865 7220 6461 7461 7365 742c 2077 6974  her dataset, wit
+00026d40: 6820 7468 6973 2064 6174 6173 6574 2773  h this dataset's
+00026d50: 2064 6174 6120 6275 7420 7265 706c 6163   data but replac
+00026d60: 6564 2063 6f6f 7264 696e 6174 6573 2e0a  ed coordinates..
+00026d70: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+00026d80: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+00026d90: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
+00026da0: 6574 2e73 6574 5f69 6e64 6578 0a20 2020  et.set_index.   
+00026db0: 2020 2020 2044 6174 6173 6574 2e73 6574       Dataset.set
+00026dc0: 5f78 696e 6465 780a 2020 2020 2020 2020  _xindex.        
+00026dd0: 4461 7461 7365 742e 6472 6f70 5f69 6e64  Dataset.drop_ind
+00026de0: 6578 6573 0a20 2020 2020 2020 2022 2222  exes.        """
+00026df0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00026e00: 7374 616e 6365 2864 696d 735f 6f72 5f6c  stance(dims_or_l
+00026e10: 6576 656c 732c 2073 7472 2920 6f72 206e  evels, str) or n
+00026e20: 6f74 2069 7369 6e73 7461 6e63 6528 6469  ot isinstance(di
+00026e30: 6d73 5f6f 725f 6c65 7665 6c73 2c20 5365  ms_or_levels, Se
+00026e40: 7175 656e 6365 293a 0a20 2020 2020 2020  quence):.       
+00026e50: 2020 2020 2064 696d 735f 6f72 5f6c 6576       dims_or_lev
+00026e60: 656c 7320 3d20 5b64 696d 735f 6f72 5f6c  els = [dims_or_l
+00026e70: 6576 656c 735d 0a0a 2020 2020 2020 2020  evels]..        
+00026e80: 696e 7661 6c69 645f 636f 6f72 6473 203d  invalid_coords =
+00026e90: 2073 6574 2864 696d 735f 6f72 5f6c 6576   set(dims_or_lev
+00026ea0: 656c 7329 202d 2073 6574 2873 656c 662e  els) - set(self.
+00026eb0: 5f69 6e64 6578 6573 290a 2020 2020 2020  _indexes).      
+00026ec0: 2020 6966 2069 6e76 616c 6964 5f63 6f6f    if invalid_coo
+00026ed0: 7264 733a 0a20 2020 2020 2020 2020 2020  rds:.           
+00026ee0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00026ef0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00026f00: 2020 2066 227b 7475 706c 6528 696e 7661     f"{tuple(inva
+00026f10: 6c69 645f 636f 6f72 6473 297d 2061 7265  lid_coords)} are
+00026f20: 206e 6f74 2063 6f6f 7264 696e 6174 6573   not coordinates
+00026f30: 2077 6974 6820 616e 2069 6e64 6578 220a   with an index".
+00026f40: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00026f50: 2020 2020 2020 2064 726f 705f 696e 6465         drop_inde
+00026f60: 7865 733a 2073 6574 5b48 6173 6861 626c  xes: set[Hashabl
+00026f70: 655d 203d 2073 6574 2829 0a20 2020 2020  e] = set().     
+00026f80: 2020 2064 726f 705f 7661 7269 6162 6c65     drop_variable
+00026f90: 733a 2073 6574 5b48 6173 6861 626c 655d  s: set[Hashable]
+00026fa0: 203d 2073 6574 2829 0a20 2020 2020 2020   = set().       
+00026fb0: 2073 6565 6e3a 2073 6574 5b49 6e64 6578   seen: set[Index
+00026fc0: 5d20 3d20 7365 7428 290a 2020 2020 2020  ] = set().      
+00026fd0: 2020 6e65 775f 696e 6465 7865 733a 2064    new_indexes: d
+00026fe0: 6963 745b 4861 7368 6162 6c65 2c20 496e  ict[Hashable, In
+00026ff0: 6465 785d 203d 207b 7d0a 2020 2020 2020  dex] = {}.      
+00027000: 2020 6e65 775f 7661 7269 6162 6c65 733a    new_variables:
+00027010: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
+00027020: 5661 7269 6162 6c65 5d20 3d20 7b7d 0a0a  Variable] = {}..
+00027030: 2020 2020 2020 2020 6465 6620 6472 6f70          def drop
+00027040: 5f6f 725f 636f 6e76 6572 7428 7661 725f  _or_convert(var_
+00027050: 6e61 6d65 7329 3a0a 2020 2020 2020 2020  names):.        
+00027060: 2020 2020 6966 2064 726f 703a 0a20 2020      if drop:.   
+00027070: 2020 2020 2020 2020 2020 2020 2064 726f               dro
+00027080: 705f 7661 7269 6162 6c65 732e 7570 6461  p_variables.upda
+00027090: 7465 2876 6172 5f6e 616d 6573 290a 2020  te(var_names).  
+000270a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000270b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000270c0: 6261 7365 5f76 6172 7320 3d20 7b0a 2020  base_vars = {.  
+000270d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000270e0: 2020 6b3a 2073 656c 662e 5f76 6172 6961    k: self._varia
+000270f0: 626c 6573 5b6b 5d2e 746f 5f62 6173 655f  bles[k].to_base_
+00027100: 7661 7269 6162 6c65 2829 2066 6f72 206b  variable() for k
+00027110: 2069 6e20 7661 725f 6e61 6d65 730a 2020   in var_names.  
+00027120: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
+00027130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027140: 6e65 775f 7661 7269 6162 6c65 732e 7570  new_variables.up
+00027150: 6461 7465 2862 6173 655f 7661 7273 290a  date(base_vars).
+00027160: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
+00027170: 6520 696e 2064 696d 735f 6f72 5f6c 6576  e in dims_or_lev
+00027180: 656c 733a 0a20 2020 2020 2020 2020 2020  els:.           
+00027190: 2069 6e64 6578 203d 2073 656c 662e 5f69   index = self._i
+000271a0: 6e64 6578 6573 5b6e 616d 655d 0a0a 2020  ndexes[name]..  
+000271b0: 2020 2020 2020 2020 2020 6966 2069 6e64            if ind
+000271c0: 6578 2069 6e20 7365 656e 3a0a 2020 2020  ex in seen:.    
+000271d0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+000271e0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+000271f0: 2073 6565 6e2e 6164 6428 696e 6465 7829   seen.add(index)
+00027200: 0a0a 2020 2020 2020 2020 2020 2020 6964  ..            id
+00027210: 785f 7661 725f 6e61 6d65 7320 3d20 7365  x_var_names = se
+00027220: 7428 7365 6c66 2e78 696e 6465 7865 732e  t(self.xindexes.
+00027230: 6765 745f 616c 6c5f 636f 6f72 6473 286e  get_all_coords(n
+00027240: 616d 6529 290a 2020 2020 2020 2020 2020  ame)).          
+00027250: 2020 6472 6f70 5f69 6e64 6578 6573 2e75    drop_indexes.u
+00027260: 7064 6174 6528 6964 785f 7661 725f 6e61  pdate(idx_var_na
+00027270: 6d65 7329 0a0a 2020 2020 2020 2020 2020  mes)..          
+00027280: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00027290: 696e 6465 782c 2050 616e 6461 734d 756c  index, PandasMul
+000272a0: 7469 496e 6465 7829 3a0a 2020 2020 2020  tiIndex):.      
+000272b0: 2020 2020 2020 2020 2020 2320 7370 6563            # spec
+000272c0: 6961 6c20 6361 7365 2066 6f72 2070 642e  ial case for pd.
+000272d0: 4d75 6c74 6949 6e64 6578 0a20 2020 2020  MultiIndex.     
+000272e0: 2020 2020 2020 2020 2020 206c 6576 656c             level
+000272f0: 5f6e 616d 6573 203d 2069 6e64 6578 2e69  _names = index.i
+00027300: 6e64 6578 2e6e 616d 6573 0a20 2020 2020  ndex.names.     
+00027310: 2020 2020 2020 2020 2020 206b 6565 705f             keep_
+00027320: 6c65 7665 6c5f 7661 7273 203d 207b 0a20  level_vars = {. 
+00027330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027340: 2020 206b 3a20 7365 6c66 2e5f 7661 7269     k: self._vari
+00027350: 6162 6c65 735b 6b5d 0a20 2020 2020 2020  ables[k].       
+00027360: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00027370: 206b 2069 6e20 6c65 7665 6c5f 6e61 6d65   k in level_name
+00027380: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00027390: 2020 2020 2020 6966 206b 206e 6f74 2069        if k not i
+000273a0: 6e20 6469 6d73 5f6f 725f 6c65 7665 6c73  n dims_or_levels
+000273b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000273c0: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
+000273d0: 2020 2020 6966 2069 6e64 6578 2e64 696d      if index.dim
+000273e0: 206e 6f74 2069 6e20 6469 6d73 5f6f 725f   not in dims_or_
+000273f0: 6c65 7665 6c73 2061 6e64 206b 6565 705f  levels and keep_
+00027400: 6c65 7665 6c5f 7661 7273 3a0a 2020 2020  level_vars:.    
+00027410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027420: 2320 646f 206e 6f74 2064 726f 7020 7468  # do not drop th
+00027430: 6520 6d75 6c74 692d 696e 6465 7820 636f  e multi-index co
+00027440: 6d70 6c65 7465 6c79 0a20 2020 2020 2020  mpletely.       
+00027450: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00027460: 6e73 7465 6164 2072 6570 6c61 6365 2069  nstead replace i
+00027470: 7420 6279 2061 206e 6577 2028 6d75 6c74  t by a new (mult
+00027480: 692d 2969 6e64 6578 2077 6974 6820 6472  i-)index with dr
+00027490: 6f70 7065 6420 6c65 7665 6c28 7329 0a20  opped level(s). 
 000274a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000274b0: 2020 2020 2320 6261 636b 7761 7264 2063      # backward c
-000274c0: 6f6d 7061 7469 6269 6c69 7479 3a20 756e  ompatibility: un
-000274d0: 6971 7565 206c 6576 656c 2063 6f6f 7264  ique level coord
-000274e0: 696e 6174 6520 7265 6e61 6d65 6420 746f  inate renamed to
-000274f0: 2064 696d 656e 7369 6f6e 0a20 2020 2020   dimension.     
-00027500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027510: 2020 2064 726f 705f 7661 7269 6162 6c65     drop_variable
-00027520: 732e 7570 6461 7465 286b 6565 705f 6c65  s.update(keep_le
-00027530: 7665 6c5f 7661 7273 290a 2020 2020 2020  vel_vars).      
-00027540: 2020 2020 2020 2020 2020 2020 2020 6472                dr
-00027550: 6f70 5f6f 725f 636f 6e76 6572 7428 0a20  op_or_convert(. 
-00027560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027570: 2020 2020 2020 205b 6b20 666f 7220 6b20         [k for k 
-00027580: 696e 206c 6576 656c 5f6e 616d 6573 2069  in level_names i
-00027590: 6620 6b20 6e6f 7420 696e 206b 6565 705f  f k not in keep_
-000275a0: 6c65 7665 6c5f 7661 7273 5d0a 2020 2020  level_vars].    
-000275b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000275c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000275d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000275e0: 2020 2020 2020 2020 2020 2020 2320 616c              # al
-000275f0: 7761 7973 2064 726f 7020 7468 6520 6d75  ways drop the mu
-00027600: 6c74 692d 696e 6465 7820 6469 6d65 6e73  lti-index dimens
-00027610: 696f 6e20 7661 7269 6162 6c65 0a20 2020  ion variable.   
-00027620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027630: 2064 726f 705f 7661 7269 6162 6c65 732e   drop_variables.
-00027640: 6164 6428 696e 6465 782e 6469 6d29 0a20  add(index.dim). 
-00027650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027660: 2020 2064 726f 705f 6f72 5f63 6f6e 7665     drop_or_conve
-00027670: 7274 286c 6576 656c 5f6e 616d 6573 290a  rt(level_names).
-00027680: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00027690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000276a0: 2020 6472 6f70 5f6f 725f 636f 6e76 6572    drop_or_conver
-000276b0: 7428 6964 785f 7661 725f 6e61 6d65 7329  t(idx_var_names)
-000276c0: 0a0a 2020 2020 2020 2020 696e 6465 7865  ..        indexe
-000276d0: 7320 3d20 7b6b 3a20 7620 666f 7220 6b2c  s = {k: v for k,
-000276e0: 2076 2069 6e20 7365 6c66 2e5f 696e 6465   v in self._inde
-000276f0: 7865 732e 6974 656d 7328 2920 6966 206b  xes.items() if k
-00027700: 206e 6f74 2069 6e20 6472 6f70 5f69 6e64   not in drop_ind
-00027710: 6578 6573 7d0a 2020 2020 2020 2020 696e  exes}.        in
-00027720: 6465 7865 732e 7570 6461 7465 286e 6577  dexes.update(new
-00027730: 5f69 6e64 6578 6573 290a 0a20 2020 2020  _indexes)..     
-00027740: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
-00027750: 0a20 2020 2020 2020 2020 2020 206b 3a20  .            k: 
-00027760: 7620 666f 7220 6b2c 2076 2069 6e20 7365  v for k, v in se
-00027770: 6c66 2e5f 7661 7269 6162 6c65 732e 6974  lf._variables.it
-00027780: 656d 7328 2920 6966 206b 206e 6f74 2069  ems() if k not i
-00027790: 6e20 6472 6f70 5f76 6172 6961 626c 6573  n drop_variables
-000277a0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-000277b0: 2020 2076 6172 6961 626c 6573 2e75 7064     variables.upd
-000277c0: 6174 6528 6e65 775f 7661 7269 6162 6c65  ate(new_variable
-000277d0: 7329 0a0a 2020 2020 2020 2020 636f 6f72  s)..        coor
-000277e0: 645f 6e61 6d65 7320 3d20 7365 6c66 2e5f  d_names = self._
-000277f0: 636f 6f72 645f 6e61 6d65 7320 2d20 6472  coord_names - dr
-00027800: 6f70 5f76 6172 6961 626c 6573 0a0a 2020  op_variables..  
-00027810: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00027820: 662e 5f72 6570 6c61 6365 5f77 6974 685f  f._replace_with_
-00027830: 6e65 775f 6469 6d73 280a 2020 2020 2020  new_dims(.      
-00027840: 2020 2020 2020 7661 7269 6162 6c65 732c        variables,
-00027850: 2063 6f6f 7264 5f6e 616d 6573 3d63 6f6f   coord_names=coo
-00027860: 7264 5f6e 616d 6573 2c20 696e 6465 7865  rd_names, indexe
-00027870: 733d 696e 6465 7865 730a 2020 2020 2020  s=indexes.      
-00027880: 2020 290a 0a20 2020 2064 6566 2073 6574    )..    def set
-00027890: 5f78 696e 6465 7828 0a20 2020 2020 2020  _xindex(.       
-000278a0: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
-000278b0: 2c0a 2020 2020 2020 2020 636f 6f72 645f  ,.        coord_
-000278c0: 6e61 6d65 733a 2073 7472 207c 2053 6571  names: str | Seq
-000278d0: 7565 6e63 655b 4861 7368 6162 6c65 5d2c  uence[Hashable],
-000278e0: 0a20 2020 2020 2020 2069 6e64 6578 5f63  .        index_c
-000278f0: 6c73 3a20 7479 7065 5b49 6e64 6578 5d20  ls: type[Index] 
-00027900: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
-00027910: 2020 2020 2020 202a 2a6f 7074 696f 6e73         **options
-00027920: 2c0a 2020 2020 2920 2d3e 2054 5f44 6174  ,.    ) -> T_Dat
-00027930: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
-00027940: 2253 6574 2061 206e 6577 2c20 5861 7272  "Set a new, Xarr
-00027950: 6179 2d63 6f6d 7061 7469 626c 6520 696e  ay-compatible in
-00027960: 6465 7820 6672 6f6d 206f 6e65 206f 7220  dex from one or 
-00027970: 6d6f 7265 2065 7869 7374 696e 670a 2020  more existing.  
-00027980: 2020 2020 2020 636f 6f72 6469 6e61 7465        coordinate
-00027990: 2873 292e 0a0a 2020 2020 2020 2020 5061  (s)...        Pa
-000279a0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-000279b0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-000279c0: 2020 2020 636f 6f72 645f 6e61 6d65 7320      coord_names 
-000279d0: 3a20 7374 7220 6f72 206c 6973 740a 2020  : str or list.  
-000279e0: 2020 2020 2020 2020 2020 4e61 6d65 2873            Name(s
-000279f0: 2920 6f66 2074 6865 2063 6f6f 7264 696e  ) of the coordin
-00027a00: 6174 6528 7329 2075 7365 6420 746f 2062  ate(s) used to b
-00027a10: 7569 6c64 2074 6865 2069 6e64 6578 2e0a  uild the index..
-00027a20: 2020 2020 2020 2020 2020 2020 4966 2073              If s
-00027a30: 6576 6572 616c 206e 616d 6573 2061 7265  everal names are
-00027a40: 2067 6976 656e 2c20 7468 6569 7220 6f72   given, their or
-00027a50: 6465 7220 6d61 7474 6572 732e 0a20 2020  der matters..   
-00027a60: 2020 2020 2069 6e64 6578 5f63 6c73 203a       index_cls :
-00027a70: 2073 7562 636c 6173 7320 6f66 203a 636c   subclass of :cl
-00027a80: 6173 733a 607e 7861 7272 6179 2e69 6e64  ass:`~xarray.ind
-00027a90: 6578 6573 2e49 6e64 6578 602c 206f 7074  exes.Index`, opt
-00027aa0: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-00027ab0: 2020 5468 6520 7479 7065 206f 6620 696e    The type of in
-00027ac0: 6465 7820 746f 2063 7265 6174 652e 2042  dex to create. B
-00027ad0: 7920 6465 6661 756c 742c 2074 7279 2073  y default, try s
-00027ae0: 6574 7469 6e67 0a20 2020 2020 2020 2020  etting.         
-00027af0: 2020 2061 2060 6050 616e 6461 7349 6e64     a ``PandasInd
-00027b00: 6578 6060 2069 6620 6060 6c65 6e28 636f  ex`` if ``len(co
-00027b10: 6f72 645f 6e61 6d65 7329 203d 3d20 3160  ord_names) == 1`
-00027b20: 602c 0a20 2020 2020 2020 2020 2020 206f  `,.            o
-00027b30: 7468 6572 7769 7365 2061 2060 6050 616e  therwise a ``Pan
-00027b40: 6461 734d 756c 7469 496e 6465 7860 602e  dasMultiIndex``.
-00027b50: 0a20 2020 2020 2020 202a 2a6f 7074 696f  .        **optio
-00027b60: 6e73 0a20 2020 2020 2020 2020 2020 204f  ns.            O
-00027b70: 7074 696f 6e73 2070 6173 7365 6420 746f  ptions passed to
-00027b80: 2074 6865 2069 6e64 6578 2063 6f6e 7374   the index const
-00027b90: 7275 6374 6f72 2e0a 0a20 2020 2020 2020  ructor...       
-00027ba0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-00027bb0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-00027bc0: 206f 626a 203a 2044 6174 6173 6574 0a20   obj : Dataset. 
-00027bd0: 2020 2020 2020 2020 2020 2041 6e6f 7468             Anoth
-00027be0: 6572 2064 6174 6173 6574 2c20 7769 7468  er dataset, with
-00027bf0: 2074 6869 7320 6461 7461 7365 7427 7320   this dataset's 
-00027c00: 6461 7461 2061 6e64 2077 6974 6820 6120  data and with a 
-00027c10: 6e65 7720 696e 6465 782e 0a0a 2020 2020  new index...    
-00027c20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00027c30: 2320 7468 6520 5365 7175 656e 6365 2063  # the Sequence c
-00027c40: 6865 636b 2069 7320 7265 7175 6972 6564  heck is required
-00027c50: 2066 6f72 206d 7970 790a 2020 2020 2020   for mypy.      
-00027c60: 2020 6966 2069 735f 7363 616c 6172 2863    if is_scalar(c
-00027c70: 6f6f 7264 5f6e 616d 6573 2920 6f72 206e  oord_names) or n
-00027c80: 6f74 2069 7369 6e73 7461 6e63 6528 636f  ot isinstance(co
-00027c90: 6f72 645f 6e61 6d65 732c 2053 6571 7565  ord_names, Seque
-00027ca0: 6e63 6529 3a0a 2020 2020 2020 2020 2020  nce):.          
-00027cb0: 2020 636f 6f72 645f 6e61 6d65 7320 3d20    coord_names = 
-00027cc0: 5b63 6f6f 7264 5f6e 616d 6573 5d0a 0a20  [coord_names].. 
-00027cd0: 2020 2020 2020 2069 6620 696e 6465 785f         if index_
-00027ce0: 636c 7320 6973 204e 6f6e 653a 0a20 2020  cls is None:.   
-00027cf0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00027d00: 636f 6f72 645f 6e61 6d65 7329 203d 3d20  coord_names) == 
-00027d10: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-00027d20: 2020 2069 6e64 6578 5f63 6c73 203d 2050     index_cls = P
-00027d30: 616e 6461 7349 6e64 6578 0a20 2020 2020  andasIndex.     
-00027d40: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00027d50: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-00027d60: 6578 5f63 6c73 203d 2050 616e 6461 734d  ex_cls = PandasM
-00027d70: 756c 7469 496e 6465 780a 2020 2020 2020  ultiIndex.      
-00027d80: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00027d90: 2020 2020 6966 206e 6f74 2069 7373 7562      if not issub
-00027da0: 636c 6173 7328 696e 6465 785f 636c 732c  class(index_cls,
-00027db0: 2049 6e64 6578 293a 0a20 2020 2020 2020   Index):.       
-00027dc0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
-00027dd0: 7970 6545 7272 6f72 2866 227b 696e 6465  ypeError(f"{inde
-00027de0: 785f 636c 737d 2069 7320 6e6f 7420 6120  x_cls} is not a 
-00027df0: 7375 6263 6c61 7373 206f 6620 7861 7272  subclass of xarr
-00027e00: 6179 2e49 6e64 6578 2229 0a0a 2020 2020  ay.Index")..    
-00027e10: 2020 2020 696e 7661 6c69 645f 636f 6f72      invalid_coor
-00027e20: 6473 203d 2073 6574 2863 6f6f 7264 5f6e  ds = set(coord_n
-00027e30: 616d 6573 2920 2d20 7365 6c66 2e5f 636f  ames) - self._co
-00027e40: 6f72 645f 6e61 6d65 730a 0a20 2020 2020  ord_names..     
-00027e50: 2020 2069 6620 696e 7661 6c69 645f 636f     if invalid_co
-00027e60: 6f72 6473 3a0a 2020 2020 2020 2020 2020  ords:.          
-00027e70: 2020 6d73 6720 3d20 5b22 696e 7661 6c69    msg = ["invali
-00027e80: 6420 636f 6f72 6469 6e61 7465 2873 2922  d coordinate(s)"
-00027e90: 5d0a 2020 2020 2020 2020 2020 2020 6e6f  ].            no
-00027ea0: 5f76 6172 7320 3d20 696e 7661 6c69 645f  _vars = invalid_
-00027eb0: 636f 6f72 6473 202d 2073 6574 2873 656c  coords - set(sel
-00027ec0: 662e 5f76 6172 6961 626c 6573 290a 2020  f._variables).  
-00027ed0: 2020 2020 2020 2020 2020 6461 7461 5f76            data_v
-00027ee0: 6172 7320 3d20 696e 7661 6c69 645f 636f  ars = invalid_co
-00027ef0: 6f72 6473 202d 206e 6f5f 7661 7273 0a20  ords - no_vars. 
+000274b0: 2020 2069 6478 203d 2069 6e64 6578 2e6b     idx = index.k
+000274c0: 6565 705f 6c65 7665 6c73 286b 6565 705f  eep_levels(keep_
+000274d0: 6c65 7665 6c5f 7661 7273 290a 2020 2020  level_vars).    
+000274e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000274f0: 6964 785f 7661 7273 203d 2069 6478 2e63  idx_vars = idx.c
+00027500: 7265 6174 655f 7661 7269 6162 6c65 7328  reate_variables(
+00027510: 6b65 6570 5f6c 6576 656c 5f76 6172 7329  keep_level_vars)
+00027520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027530: 2020 2020 206e 6577 5f69 6e64 6578 6573       new_indexes
+00027540: 2e75 7064 6174 6528 7b6b 3a20 6964 7820  .update({k: idx 
+00027550: 666f 7220 6b20 696e 2069 6478 5f76 6172  for k in idx_var
+00027560: 737d 290a 2020 2020 2020 2020 2020 2020  s}).            
+00027570: 2020 2020 2020 2020 6e65 775f 7661 7269          new_vari
+00027580: 6162 6c65 732e 7570 6461 7465 2869 6478  ables.update(idx
+00027590: 5f76 6172 7329 0a20 2020 2020 2020 2020  _vars).         
+000275a0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000275b0: 7420 6973 696e 7374 616e 6365 2869 6478  t isinstance(idx
+000275c0: 2c20 5061 6e64 6173 4d75 6c74 6949 6e64  , PandasMultiInd
+000275d0: 6578 293a 0a20 2020 2020 2020 2020 2020  ex):.           
+000275e0: 2020 2020 2020 2020 2020 2020 2023 206d               # m
+000275f0: 756c 7469 2d69 6e64 6578 2072 6564 7563  ulti-index reduc
+00027600: 6564 2074 6f20 7369 6e67 6c65 2069 6e64  ed to single ind
+00027610: 6578 0a20 2020 2020 2020 2020 2020 2020  ex.             
+00027620: 2020 2020 2020 2020 2020 2023 2062 6163             # bac
+00027630: 6b77 6172 6420 636f 6d70 6174 6962 696c  kward compatibil
+00027640: 6974 793a 2075 6e69 7175 6520 6c65 7665  ity: unique leve
+00027650: 6c20 636f 6f72 6469 6e61 7465 2072 656e  l coordinate ren
+00027660: 616d 6564 2074 6f20 6469 6d65 6e73 696f  amed to dimensio
+00027670: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00027680: 2020 2020 2020 2020 2020 6472 6f70 5f76            drop_v
+00027690: 6172 6961 626c 6573 2e75 7064 6174 6528  ariables.update(
+000276a0: 6b65 6570 5f6c 6576 656c 5f76 6172 7329  keep_level_vars)
+000276b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000276c0: 2020 2020 2064 726f 705f 6f72 5f63 6f6e       drop_or_con
+000276d0: 7665 7274 280a 2020 2020 2020 2020 2020  vert(.          
+000276e0: 2020 2020 2020 2020 2020 2020 2020 5b6b                [k
+000276f0: 2066 6f72 206b 2069 6e20 6c65 7665 6c5f   for k in level_
+00027700: 6e61 6d65 7320 6966 206b 206e 6f74 2069  names if k not i
+00027710: 6e20 6b65 6570 5f6c 6576 656c 5f76 6172  n keep_level_var
+00027720: 735d 0a20 2020 2020 2020 2020 2020 2020  s].             
+00027730: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00027740: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00027750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027760: 2020 2023 2061 6c77 6179 7320 6472 6f70     # always drop
+00027770: 2074 6865 206d 756c 7469 2d69 6e64 6578   the multi-index
+00027780: 2064 696d 656e 7369 6f6e 2076 6172 6961   dimension varia
+00027790: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
+000277a0: 2020 2020 2020 2020 6472 6f70 5f76 6172          drop_var
+000277b0: 6961 626c 6573 2e61 6464 2869 6e64 6578  iables.add(index
+000277c0: 2e64 696d 290a 2020 2020 2020 2020 2020  .dim).          
+000277d0: 2020 2020 2020 2020 2020 6472 6f70 5f6f            drop_o
+000277e0: 725f 636f 6e76 6572 7428 6c65 7665 6c5f  r_convert(level_
+000277f0: 6e61 6d65 7329 0a20 2020 2020 2020 2020  names).         
+00027800: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00027810: 2020 2020 2020 2020 2064 726f 705f 6f72           drop_or
+00027820: 5f63 6f6e 7665 7274 2869 6478 5f76 6172  _convert(idx_var
+00027830: 5f6e 616d 6573 290a 0a20 2020 2020 2020  _names)..       
+00027840: 2069 6e64 6578 6573 203d 207b 6b3a 2076   indexes = {k: v
+00027850: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
+00027860: 662e 5f69 6e64 6578 6573 2e69 7465 6d73  f._indexes.items
+00027870: 2829 2069 6620 6b20 6e6f 7420 696e 2064  () if k not in d
+00027880: 726f 705f 696e 6465 7865 737d 0a20 2020  rop_indexes}.   
+00027890: 2020 2020 2069 6e64 6578 6573 2e75 7064       indexes.upd
+000278a0: 6174 6528 6e65 775f 696e 6465 7865 7329  ate(new_indexes)
+000278b0: 0a0a 2020 2020 2020 2020 7661 7269 6162  ..        variab
+000278c0: 6c65 7320 3d20 7b0a 2020 2020 2020 2020  les = {.        
+000278d0: 2020 2020 6b3a 2076 2066 6f72 206b 2c20      k: v for k, 
+000278e0: 7620 696e 2073 656c 662e 5f76 6172 6961  v in self._varia
+000278f0: 626c 6573 2e69 7465 6d73 2829 2069 6620  bles.items() if 
+00027900: 6b20 6e6f 7420 696e 2064 726f 705f 7661  k not in drop_va
+00027910: 7269 6162 6c65 730a 2020 2020 2020 2020  riables.        
+00027920: 7d0a 2020 2020 2020 2020 7661 7269 6162  }.        variab
+00027930: 6c65 732e 7570 6461 7465 286e 6577 5f76  les.update(new_v
+00027940: 6172 6961 626c 6573 290a 0a20 2020 2020  ariables)..     
+00027950: 2020 2063 6f6f 7264 5f6e 616d 6573 203d     coord_names =
+00027960: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
+00027970: 6573 202d 2064 726f 705f 7661 7269 6162  es - drop_variab
+00027980: 6c65 730a 0a20 2020 2020 2020 2072 6574  les..        ret
+00027990: 7572 6e20 7365 6c66 2e5f 7265 706c 6163  urn self._replac
+000279a0: 655f 7769 7468 5f6e 6577 5f64 696d 7328  e_with_new_dims(
+000279b0: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
+000279c0: 6961 626c 6573 2c20 636f 6f72 645f 6e61  iables, coord_na
+000279d0: 6d65 733d 636f 6f72 645f 6e61 6d65 732c  mes=coord_names,
+000279e0: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
+000279f0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00027a00: 6465 6620 7365 745f 7869 6e64 6578 280a  def set_xindex(.
+00027a10: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
+00027a20: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
+00027a30: 2063 6f6f 7264 5f6e 616d 6573 3a20 7374   coord_names: st
+00027a40: 7220 7c20 5365 7175 656e 6365 5b48 6173  r | Sequence[Has
+00027a50: 6861 626c 655d 2c0a 2020 2020 2020 2020  hable],.        
+00027a60: 696e 6465 785f 636c 733a 2074 7970 655b  index_cls: type[
+00027a70: 496e 6465 785d 207c 204e 6f6e 6520 3d20  Index] | None = 
+00027a80: 4e6f 6e65 2c0a 2020 2020 2020 2020 2a2a  None,.        **
+00027a90: 6f70 7469 6f6e 732c 0a20 2020 2029 202d  options,.    ) -
+00027aa0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+00027ab0: 2020 2020 2022 2222 5365 7420 6120 6e65       """Set a ne
+00027ac0: 772c 2058 6172 7261 792d 636f 6d70 6174  w, Xarray-compat
+00027ad0: 6962 6c65 2069 6e64 6578 2066 726f 6d20  ible index from 
+00027ae0: 6f6e 6520 6f72 206d 6f72 6520 6578 6973  one or more exis
+00027af0: 7469 6e67 0a20 2020 2020 2020 2063 6f6f  ting.        coo
+00027b00: 7264 696e 6174 6528 7329 2e0a 0a20 2020  rdinate(s)...   
+00027b10: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00027b20: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00027b30: 2d2d 0a20 2020 2020 2020 2063 6f6f 7264  --.        coord
+00027b40: 5f6e 616d 6573 203a 2073 7472 206f 7220  _names : str or 
+00027b50: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
+00027b60: 204e 616d 6528 7329 206f 6620 7468 6520   Name(s) of the 
+00027b70: 636f 6f72 6469 6e61 7465 2873 2920 7573  coordinate(s) us
+00027b80: 6564 2074 6f20 6275 696c 6420 7468 6520  ed to build the 
+00027b90: 696e 6465 782e 0a20 2020 2020 2020 2020  index..         
+00027ba0: 2020 2049 6620 7365 7665 7261 6c20 6e61     If several na
+00027bb0: 6d65 7320 6172 6520 6769 7665 6e2c 2074  mes are given, t
+00027bc0: 6865 6972 206f 7264 6572 206d 6174 7465  heir order matte
+00027bd0: 7273 2e0a 2020 2020 2020 2020 696e 6465  rs..        inde
+00027be0: 785f 636c 7320 3a20 7375 6263 6c61 7373  x_cls : subclass
+00027bf0: 206f 6620 3a63 6c61 7373 3a60 7e78 6172   of :class:`~xar
+00027c00: 7261 792e 696e 6465 7865 732e 496e 6465  ray.indexes.Inde
+00027c10: 7860 2c20 6f70 7469 6f6e 616c 0a20 2020  x`, optional.   
+00027c20: 2020 2020 2020 2020 2054 6865 2074 7970           The typ
+00027c30: 6520 6f66 2069 6e64 6578 2074 6f20 6372  e of index to cr
+00027c40: 6561 7465 2e20 4279 2064 6566 6175 6c74  eate. By default
+00027c50: 2c20 7472 7920 7365 7474 696e 670a 2020  , try setting.  
+00027c60: 2020 2020 2020 2020 2020 6120 6060 5061            a ``Pa
+00027c70: 6e64 6173 496e 6465 7860 6020 6966 2060  ndasIndex`` if `
+00027c80: 606c 656e 2863 6f6f 7264 5f6e 616d 6573  `len(coord_names
+00027c90: 2920 3d3d 2031 6060 2c0a 2020 2020 2020  ) == 1``,.      
+00027ca0: 2020 2020 2020 6f74 6865 7277 6973 6520        otherwise 
+00027cb0: 6120 6060 5061 6e64 6173 4d75 6c74 6949  a ``PandasMultiI
+00027cc0: 6e64 6578 6060 2e0a 2020 2020 2020 2020  ndex``..        
+00027cd0: 2a2a 6f70 7469 6f6e 730a 2020 2020 2020  **options.      
+00027ce0: 2020 2020 2020 4f70 7469 6f6e 7320 7061        Options pa
+00027cf0: 7373 6564 2074 6f20 7468 6520 696e 6465  ssed to the inde
+00027d00: 7820 636f 6e73 7472 7563 746f 722e 0a0a  x constructor...
+00027d10: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+00027d20: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+00027d30: 2020 2020 2020 2020 6f62 6a20 3a20 4461          obj : Da
+00027d40: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
+00027d50: 2020 416e 6f74 6865 7220 6461 7461 7365    Another datase
+00027d60: 742c 2077 6974 6820 7468 6973 2064 6174  t, with this dat
+00027d70: 6173 6574 2773 2064 6174 6120 616e 6420  aset's data and 
+00027d80: 7769 7468 2061 206e 6577 2069 6e64 6578  with a new index
+00027d90: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
+00027da0: 2020 2020 2020 2023 2074 6865 2053 6571         # the Seq
+00027db0: 7565 6e63 6520 6368 6563 6b20 6973 2072  uence check is r
+00027dc0: 6571 7569 7265 6420 666f 7220 6d79 7079  equired for mypy
+00027dd0: 0a20 2020 2020 2020 2069 6620 6973 5f73  .        if is_s
+00027de0: 6361 6c61 7228 636f 6f72 645f 6e61 6d65  calar(coord_name
+00027df0: 7329 206f 7220 6e6f 7420 6973 696e 7374  s) or not isinst
+00027e00: 616e 6365 2863 6f6f 7264 5f6e 616d 6573  ance(coord_names
+00027e10: 2c20 5365 7175 656e 6365 293a 0a20 2020  , Sequence):.   
+00027e20: 2020 2020 2020 2020 2063 6f6f 7264 5f6e           coord_n
+00027e30: 616d 6573 203d 205b 636f 6f72 645f 6e61  ames = [coord_na
+00027e40: 6d65 735d 0a0a 2020 2020 2020 2020 6966  mes]..        if
+00027e50: 2069 6e64 6578 5f63 6c73 2069 7320 4e6f   index_cls is No
+00027e60: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00027e70: 6966 206c 656e 2863 6f6f 7264 5f6e 616d  if len(coord_nam
+00027e80: 6573 2920 3d3d 2031 3a0a 2020 2020 2020  es) == 1:.      
+00027e90: 2020 2020 2020 2020 2020 696e 6465 785f            index_
+00027ea0: 636c 7320 3d20 5061 6e64 6173 496e 6465  cls = PandasInde
+00027eb0: 780a 2020 2020 2020 2020 2020 2020 656c  x.            el
+00027ec0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00027ed0: 2020 2020 696e 6465 785f 636c 7320 3d20      index_cls = 
+00027ee0: 5061 6e64 6173 4d75 6c74 6949 6e64 6578  PandasMultiIndex
+00027ef0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
 00027f00: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00027f10: 5f76 6172 733a 0a20 2020 2020 2020 2020  _vars:.         
-00027f20: 2020 2020 2020 206d 7367 2e61 7070 656e         msg.appen
-00027f30: 6428 6622 7468 6f73 6520 7661 7269 6162  d(f"those variab
-00027f40: 6c65 7320 646f 6e27 7420 6578 6973 743a  les don't exist:
-00027f50: 207b 6e6f 5f76 6172 737d 2229 0a20 2020   {no_vars}").   
-00027f60: 2020 2020 2020 2020 2069 6620 6461 7461           if data
-00027f70: 5f76 6172 733a 0a20 2020 2020 2020 2020  _vars:.         
-00027f80: 2020 2020 2020 206d 7367 2e61 7070 656e         msg.appen
-00027f90: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
-00027fa0: 2020 2020 2020 2066 2274 686f 7365 2076         f"those v
-00027fb0: 6172 6961 626c 6573 2061 7265 2064 6174  ariables are dat
-00027fc0: 6120 7661 7269 6162 6c65 733a 207b 6461  a variables: {da
-00027fd0: 7461 5f76 6172 737d 2c20 7573 6520 6073  ta_vars}, use `s
-00027fe0: 6574 5f63 6f6f 7264 7360 2066 6972 7374  et_coords` first
-00027ff0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00028000: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00028010: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00028020: 2822 5c6e 222e 6a6f 696e 286d 7367 2929  ("\n".join(msg))
-00028030: 0a0a 2020 2020 2020 2020 2320 7765 2063  ..        # we c
-00028040: 6f75 6c64 2062 6520 6d6f 7265 2063 6c65  ould be more cle
-00028050: 7665 7220 6865 7265 2028 652e 672e 2c20  ver here (e.g., 
-00028060: 6472 6f70 2d69 6e20 696e 6465 7820 7265  drop-in index re
-00028070: 706c 6163 656d 656e 7420 6966 2069 6e64  placement if ind
-00028080: 6578 0a20 2020 2020 2020 2023 2063 6f6f  ex.        # coo
-00028090: 7264 696e 6174 6573 2064 6f20 6e6f 7420  rdinates do not 
-000280a0: 636f 6e66 6c69 6374 292c 2062 7574 206c  conflict), but l
-000280b0: 6574 2773 206e 6f74 2061 6c6c 6f77 2074  et's not allow t
-000280c0: 6869 7320 666f 7220 6e6f 770a 2020 2020  his for now.    
-000280d0: 2020 2020 696e 6465 7865 645f 636f 6f72      indexed_coor
-000280e0: 6473 203d 2073 6574 2863 6f6f 7264 5f6e  ds = set(coord_n
-000280f0: 616d 6573 2920 2620 7365 7428 7365 6c66  ames) & set(self
-00028100: 2e5f 696e 6465 7865 7329 0a0a 2020 2020  ._indexes)..    
-00028110: 2020 2020 6966 2069 6e64 6578 6564 5f63      if indexed_c
-00028120: 6f6f 7264 733a 0a20 2020 2020 2020 2020  oords:.         
-00028130: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00028140: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00028150: 2020 2020 2066 2274 686f 7365 2063 6f6f       f"those coo
-00028160: 7264 696e 6174 6573 2061 6c72 6561 6479  rdinates already
-00028170: 2068 6176 6520 616e 2069 6e64 6578 3a20   have an index: 
-00028180: 7b69 6e64 6578 6564 5f63 6f6f 7264 737d  {indexed_coords}
-00028190: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-000281a0: 0a20 2020 2020 2020 2063 6f6f 7264 5f76  .        coord_v
-000281b0: 6172 7320 3d20 7b6e 616d 653a 2073 656c  ars = {name: sel
-000281c0: 662e 5f76 6172 6961 626c 6573 5b6e 616d  f._variables[nam
-000281d0: 655d 2066 6f72 206e 616d 6520 696e 2063  e] for name in c
-000281e0: 6f6f 7264 5f6e 616d 6573 7d0a 0a20 2020  oord_names}..   
-000281f0: 2020 2020 2069 6e64 6578 203d 2069 6e64       index = ind
-00028200: 6578 5f63 6c73 2e66 726f 6d5f 7661 7269  ex_cls.from_vari
-00028210: 6162 6c65 7328 636f 6f72 645f 7661 7273  ables(coord_vars
-00028220: 2c20 6f70 7469 6f6e 733d 6f70 7469 6f6e  , options=option
-00028230: 7329 0a0a 2020 2020 2020 2020 6e65 775f  s)..        new_
-00028240: 636f 6f72 645f 7661 7273 203d 2069 6e64  coord_vars = ind
-00028250: 6578 2e63 7265 6174 655f 7661 7269 6162  ex.create_variab
-00028260: 6c65 7328 636f 6f72 645f 7661 7273 290a  les(coord_vars).
-00028270: 0a20 2020 2020 2020 2023 2073 7065 6369  .        # speci
-00028280: 616c 2063 6173 6520 666f 7220 7365 7474  al case for sett
-00028290: 696e 6720 6120 7061 6e64 6173 206d 756c  ing a pandas mul
-000282a0: 7469 2d69 6e64 6578 2066 726f 6d20 6c65  ti-index from le
-000282b0: 7665 6c20 636f 6f72 6469 6e61 7465 730a  vel coordinates.
-000282c0: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
-000282d0: 7265 6d6f 7665 2069 7420 6f6e 6365 2077  remove it once w
-000282e0: 6520 6465 7072 6563 6961 7465 2070 616e  e depreciate pan
-000282f0: 6461 7320 6d75 6c74 692d 696e 6465 7820  das multi-index 
-00028300: 6469 6d65 6e73 696f 6e20 2874 7570 6c65  dimension (tuple
-00028310: 0a20 2020 2020 2020 2023 2065 6c65 6d65  .        # eleme
-00028320: 6e74 7329 2063 6f6f 7264 696e 6174 650a  nts) coordinate.
-00028330: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00028340: 7461 6e63 6528 696e 6465 782c 2050 616e  tance(index, Pan
-00028350: 6461 734d 756c 7469 496e 6465 7829 3a0a  dasMultiIndex):.
-00028360: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
-00028370: 645f 6e61 6d65 7320 3d20 5b69 6e64 6578  d_names = [index
-00028380: 2e64 696d 5d20 2b20 6c69 7374 2863 6f6f  .dim] + list(coo
-00028390: 7264 5f6e 616d 6573 290a 0a20 2020 2020  rd_names)..     
-000283a0: 2020 2076 6172 6961 626c 6573 3a20 6469     variables: di
-000283b0: 6374 5b48 6173 6861 626c 652c 2056 6172  ct[Hashable, Var
-000283c0: 6961 626c 655d 0a20 2020 2020 2020 2069  iable].        i
-000283d0: 6e64 6578 6573 3a20 6469 6374 5b48 6173  ndexes: dict[Has
-000283e0: 6861 626c 652c 2049 6e64 6578 5d0a 0a20  hable, Index].. 
-000283f0: 2020 2020 2020 2069 6620 6c65 6e28 636f         if len(co
-00028400: 6f72 645f 6e61 6d65 7329 203d 3d20 313a  ord_names) == 1:
-00028410: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-00028420: 6961 626c 6573 203d 2073 656c 662e 5f76  iables = self._v
-00028430: 6172 6961 626c 6573 2e63 6f70 7928 290a  ariables.copy().
-00028440: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00028450: 7865 7320 3d20 7365 6c66 2e5f 696e 6465  xes = self._inde
-00028460: 7865 732e 636f 7079 2829 0a0a 2020 2020  xes.copy()..    
-00028470: 2020 2020 2020 2020 6e61 6d65 203d 206c          name = l
-00028480: 6973 7428 636f 6f72 645f 6e61 6d65 7329  ist(coord_names)
-00028490: 2e70 6f70 2829 0a20 2020 2020 2020 2020  .pop().         
-000284a0: 2020 2069 6620 6e61 6d65 2069 6e20 6e65     if name in ne
-000284b0: 775f 636f 6f72 645f 7661 7273 3a0a 2020  w_coord_vars:.  
-000284c0: 2020 2020 2020 2020 2020 2020 2020 7661                va
-000284d0: 7269 6162 6c65 735b 6e61 6d65 5d20 3d20  riables[name] = 
-000284e0: 6e65 775f 636f 6f72 645f 7661 7273 5b6e  new_coord_vars[n
-000284f0: 616d 655d 0a20 2020 2020 2020 2020 2020  ame].           
-00028500: 2069 6e64 6578 6573 5b6e 616d 655d 203d   indexes[name] =
-00028510: 2069 6e64 6578 0a20 2020 2020 2020 2065   index.        e
-00028520: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00028530: 2023 2072 656f 7264 6572 2076 6172 6961   # reorder varia
-00028540: 626c 6573 2061 6e64 2069 6e64 6578 6573  bles and indexes
-00028550: 2073 6f20 7468 6174 2063 6f6f 7264 696e   so that coordin
-00028560: 6174 6573 2068 6176 696e 6720 7468 6520  ates having the 
-00028570: 7361 6d65 0a20 2020 2020 2020 2020 2020  same.           
-00028580: 2023 2069 6e64 6578 2061 7265 206e 6578   # index are nex
-00028590: 7420 746f 2065 6163 6820 6f74 6865 720a  t to each other.
-000285a0: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-000285b0: 6162 6c65 7320 3d20 7b7d 0a20 2020 2020  ables = {}.     
-000285c0: 2020 2020 2020 2066 6f72 206e 616d 652c         for name,
-000285d0: 2076 6172 2069 6e20 7365 6c66 2e5f 7661   var in self._va
-000285e0: 7269 6162 6c65 732e 6974 656d 7328 293a  riables.items():
-000285f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028600: 2069 6620 6e61 6d65 206e 6f74 2069 6e20   if name not in 
-00028610: 636f 6f72 645f 6e61 6d65 733a 0a20 2020  coord_names:.   
-00028620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028630: 2076 6172 6961 626c 6573 5b6e 616d 655d   variables[name]
-00028640: 203d 2076 6172 0a0a 2020 2020 2020 2020   = var..        
-00028650: 2020 2020 696e 6465 7865 7320 3d20 7b7d      indexes = {}
-00028660: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00028670: 206e 616d 652c 2069 6478 2069 6e20 7365   name, idx in se
-00028680: 6c66 2e5f 696e 6465 7865 732e 6974 656d  lf._indexes.item
-00028690: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-000286a0: 2020 2020 2069 6620 6e61 6d65 206e 6f74       if name not
-000286b0: 2069 6e20 636f 6f72 645f 6e61 6d65 733a   in coord_names:
-000286c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000286d0: 2020 2020 2069 6e64 6578 6573 5b6e 616d       indexes[nam
-000286e0: 655d 203d 2069 6478 0a0a 2020 2020 2020  e] = idx..      
-000286f0: 2020 2020 2020 666f 7220 6e61 6d65 2069        for name i
-00028700: 6e20 636f 6f72 645f 6e61 6d65 733a 0a20  n coord_names:. 
-00028710: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00028720: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00028730: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-00028740: 735b 6e61 6d65 5d20 3d20 6e65 775f 636f  s[name] = new_co
-00028750: 6f72 645f 7661 7273 5b6e 616d 655d 0a20  ord_vars[name]. 
-00028760: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00028770: 7863 6570 7420 4b65 7945 7272 6f72 3a0a  xcept KeyError:.
-00028780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028790: 2020 2020 7661 7269 6162 6c65 735b 6e61      variables[na
-000287a0: 6d65 5d20 3d20 7365 6c66 2e5f 7661 7269  me] = self._vari
-000287b0: 6162 6c65 735b 6e61 6d65 5d0a 2020 2020  ables[name].    
-000287c0: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-000287d0: 7865 735b 6e61 6d65 5d20 3d20 696e 6465  xes[name] = inde
-000287e0: 780a 0a20 2020 2020 2020 2072 6574 7572  x..        retur
-000287f0: 6e20 7365 6c66 2e5f 7265 706c 6163 6528  n self._replace(
-00028800: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-00028810: 6961 626c 6573 3d76 6172 6961 626c 6573  iables=variables
-00028820: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00028830: 6f72 645f 6e61 6d65 733d 7365 6c66 2e5f  ord_names=self._
-00028840: 636f 6f72 645f 6e61 6d65 7320 7c20 7365  coord_names | se
-00028850: 7428 636f 6f72 645f 6e61 6d65 7329 2c0a  t(coord_names),.
-00028860: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00028870: 7865 733d 696e 6465 7865 732c 0a20 2020  xes=indexes,.   
-00028880: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00028890: 7265 6f72 6465 725f 6c65 7665 6c73 280a  reorder_levels(.
-000288a0: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
-000288b0: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
-000288c0: 2064 696d 5f6f 7264 6572 3a20 4d61 7070   dim_order: Mapp
-000288d0: 696e 675b 416e 792c 2053 6571 7565 6e63  ing[Any, Sequenc
-000288e0: 655b 696e 7420 7c20 4861 7368 6162 6c65  e[int | Hashable
-000288f0: 5d5d 207c 204e 6f6e 6520 3d20 4e6f 6e65  ]] | None = None
-00028900: 2c0a 2020 2020 2020 2020 2a2a 6469 6d5f  ,.        **dim_
-00028910: 6f72 6465 725f 6b77 6172 6773 3a20 5365  order_kwargs: Se
-00028920: 7175 656e 6365 5b69 6e74 207c 2048 6173  quence[int | Has
-00028930: 6861 626c 655d 2c0a 2020 2020 2920 2d3e  hable],.    ) ->
-00028940: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-00028950: 2020 2020 2222 2252 6561 7272 616e 6765      """Rearrange
-00028960: 2069 6e64 6578 206c 6576 656c 7320 7573   index levels us
-00028970: 696e 6720 696e 7075 7420 6f72 6465 722e  ing input order.
-00028980: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00028990: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-000289a0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-000289b0: 6469 6d5f 6f72 6465 7220 3a20 6469 6374  dim_order : dict
-000289c0: 2d6c 696b 6520 6f66 2048 6173 6861 626c  -like of Hashabl
-000289d0: 6520 746f 2053 6571 7565 6e63 6520 6f66  e to Sequence of
-000289e0: 2069 6e74 206f 7220 4861 7368 6162 6c65   int or Hashable
-000289f0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00028a00: 2020 2020 2020 204d 6170 7069 6e67 2066         Mapping f
-00028a10: 726f 6d20 6e61 6d65 7320 6d61 7463 6869  rom names matchi
-00028a20: 6e67 2064 696d 656e 7369 6f6e 7320 616e  ng dimensions an
-00028a30: 6420 7661 6c75 6573 2067 6976 656e 0a20  d values given. 
-00028a40: 2020 2020 2020 2020 2020 2062 7920 6c69             by li
-00028a50: 7374 7320 7265 7072 6573 656e 7469 6e67  sts representing
-00028a60: 206e 6577 206c 6576 656c 206f 7264 6572   new level order
-00028a70: 732e 2045 7665 7279 2067 6976 656e 2064  s. Every given d
-00028a80: 696d 656e 7369 6f6e 0a20 2020 2020 2020  imension.       
-00028a90: 2020 2020 206d 7573 7420 6861 7665 2061       must have a
-00028aa0: 206d 756c 7469 2d69 6e64 6578 2e0a 2020   multi-index..  
-00028ab0: 2020 2020 2020 2a2a 6469 6d5f 6f72 6465        **dim_orde
-00028ac0: 725f 6b77 6172 6773 203a 2053 6571 7565  r_kwargs : Seque
-00028ad0: 6e63 6520 6f66 2069 6e74 206f 7220 4861  nce of int or Ha
-00028ae0: 7368 6162 6c65 2c20 6f70 7469 6f6e 616c  shable, optional
-00028af0: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-00028b00: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-00028b10: 7473 2066 6f72 6d20 6f66 2060 6064 696d  ts form of ``dim
-00028b20: 5f6f 7264 6572 6060 2e0a 2020 2020 2020  _order``..      
-00028b30: 2020 2020 2020 4f6e 6520 6f66 2064 696d        One of dim
-00028b40: 5f6f 7264 6572 206f 7220 6469 6d5f 6f72  _order or dim_or
-00028b50: 6465 725f 6b77 6172 6773 206d 7573 7420  der_kwargs must 
-00028b60: 6265 2070 726f 7669 6465 642e 0a0a 2020  be provided...  
-00028b70: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00028b80: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-00028b90: 2020 2020 2020 6f62 6a20 3a20 4461 7461        obj : Data
-00028ba0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
-00028bb0: 416e 6f74 6865 7220 6461 7461 7365 742c  Another dataset,
-00028bc0: 2077 6974 6820 7468 6973 2064 6174 6173   with this datas
-00028bd0: 6574 2773 2064 6174 6120 6275 7420 7265  et's data but re
-00028be0: 706c 6163 6564 0a20 2020 2020 2020 2020  placed.         
-00028bf0: 2020 2063 6f6f 7264 696e 6174 6573 2e0a     coordinates..
-00028c00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00028c10: 2020 2020 6469 6d5f 6f72 6465 7220 3d20      dim_order = 
-00028c20: 6569 7468 6572 5f64 6963 745f 6f72 5f6b  either_dict_or_k
-00028c30: 7761 7267 7328 6469 6d5f 6f72 6465 722c  wargs(dim_order,
-00028c40: 2064 696d 5f6f 7264 6572 5f6b 7761 7267   dim_order_kwarg
-00028c50: 732c 2022 7265 6f72 6465 725f 6c65 7665  s, "reorder_leve
-00028c60: 6c73 2229 0a20 2020 2020 2020 2076 6172  ls").        var
-00028c70: 6961 626c 6573 203d 2073 656c 662e 5f76  iables = self._v
-00028c80: 6172 6961 626c 6573 2e63 6f70 7928 290a  ariables.copy().
-00028c90: 2020 2020 2020 2020 696e 6465 7865 7320          indexes 
-00028ca0: 3d20 6469 6374 2873 656c 662e 5f69 6e64  = dict(self._ind
-00028cb0: 6578 6573 290a 2020 2020 2020 2020 6e65  exes).        ne
-00028cc0: 775f 696e 6465 7865 733a 2064 6963 745b  w_indexes: dict[
-00028cd0: 4861 7368 6162 6c65 2c20 496e 6465 785d  Hashable, Index]
-00028ce0: 203d 207b 7d0a 2020 2020 2020 2020 6e65   = {}.        ne
-00028cf0: 775f 7661 7269 6162 6c65 733a 2064 6963  w_variables: dic
-00028d00: 745b 4861 7368 6162 6c65 2c20 496e 6465  t[Hashable, Inde
-00028d10: 7856 6172 6961 626c 655d 203d 207b 7d0a  xVariable] = {}.
-00028d20: 0a20 2020 2020 2020 2066 6f72 2064 696d  .        for dim
-00028d30: 2c20 6f72 6465 7220 696e 2064 696d 5f6f  , order in dim_o
-00028d40: 7264 6572 2e69 7465 6d73 2829 3a0a 2020  rder.items():.  
-00028d50: 2020 2020 2020 2020 2020 696e 6465 7820            index 
-00028d60: 3d20 7365 6c66 2e5f 696e 6465 7865 735b  = self._indexes[
-00028d70: 6469 6d5d 0a0a 2020 2020 2020 2020 2020  dim]..          
-00028d80: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-00028d90: 6e63 6528 696e 6465 782c 2050 616e 6461  nce(index, Panda
-00028da0: 734d 756c 7469 496e 6465 7829 3a0a 2020  sMultiIndex):.  
-00028db0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00028dc0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-00028dd0: 2263 6f6f 7264 696e 6174 6520 7b64 696d  "coordinate {dim
-00028de0: 7d20 6861 7320 6e6f 204d 756c 7469 496e  } has no MultiIn
-00028df0: 6465 7822 290a 0a20 2020 2020 2020 2020  dex")..         
-00028e00: 2020 206c 6576 656c 5f76 6172 7320 3d20     level_vars = 
-00028e10: 7b6b 3a20 7365 6c66 2e5f 7661 7269 6162  {k: self._variab
-00028e20: 6c65 735b 6b5d 2066 6f72 206b 2069 6e20  les[k] for k in 
-00028e30: 6f72 6465 727d 0a20 2020 2020 2020 2020  order}.         
-00028e40: 2020 2069 6478 203d 2069 6e64 6578 2e72     idx = index.r
-00028e50: 656f 7264 6572 5f6c 6576 656c 7328 6c65  eorder_levels(le
-00028e60: 7665 6c5f 7661 7273 290a 2020 2020 2020  vel_vars).      
-00028e70: 2020 2020 2020 6964 785f 7661 7273 203d        idx_vars =
-00028e80: 2069 6478 2e63 7265 6174 655f 7661 7269   idx.create_vari
-00028e90: 6162 6c65 7328 6c65 7665 6c5f 7661 7273  ables(level_vars
-00028ea0: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
-00028eb0: 775f 696e 6465 7865 732e 7570 6461 7465  w_indexes.update
-00028ec0: 287b 6b3a 2069 6478 2066 6f72 206b 2069  ({k: idx for k i
-00028ed0: 6e20 6964 785f 7661 7273 7d29 0a20 2020  n idx_vars}).   
-00028ee0: 2020 2020 2020 2020 206e 6577 5f76 6172           new_var
-00028ef0: 6961 626c 6573 2e75 7064 6174 6528 6964  iables.update(id
-00028f00: 785f 7661 7273 290a 0a20 2020 2020 2020  x_vars)..       
-00028f10: 2069 6e64 6578 6573 203d 207b 6b3a 2076   indexes = {k: v
-00028f20: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
-00028f30: 662e 5f69 6e64 6578 6573 2e69 7465 6d73  f._indexes.items
-00028f40: 2829 2069 6620 6b20 6e6f 7420 696e 206e  () if k not in n
-00028f50: 6577 5f69 6e64 6578 6573 7d0a 2020 2020  ew_indexes}.    
-00028f60: 2020 2020 696e 6465 7865 732e 7570 6461      indexes.upda
-00028f70: 7465 286e 6577 5f69 6e64 6578 6573 290a  te(new_indexes).
-00028f80: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-00028f90: 6573 203d 207b 6b3a 2076 2066 6f72 206b  es = {k: v for k
-00028fa0: 2c20 7620 696e 2073 656c 662e 5f76 6172  , v in self._var
-00028fb0: 6961 626c 6573 2e69 7465 6d73 2829 2069  iables.items() i
-00028fc0: 6620 6b20 6e6f 7420 696e 206e 6577 5f76  f k not in new_v
-00028fd0: 6172 6961 626c 6573 7d0a 2020 2020 2020  ariables}.      
-00028fe0: 2020 7661 7269 6162 6c65 732e 7570 6461    variables.upda
-00028ff0: 7465 286e 6577 5f76 6172 6961 626c 6573  te(new_variables
-00029000: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00029010: 6e20 7365 6c66 2e5f 7265 706c 6163 6528  n self._replace(
-00029020: 7661 7269 6162 6c65 732c 2069 6e64 6578  variables, index
-00029030: 6573 3d69 6e64 6578 6573 290a 0a20 2020  es=indexes)..   
-00029040: 2064 6566 205f 6765 745f 7374 6163 6b5f   def _get_stack_
-00029050: 696e 6465 7828 0a20 2020 2020 2020 2073  index(.        s
-00029060: 656c 662c 0a20 2020 2020 2020 2064 696d  elf,.        dim
-00029070: 2c0a 2020 2020 2020 2020 6d75 6c74 693d  ,.        multi=
-00029080: 4661 6c73 652c 0a20 2020 2020 2020 2063  False,.        c
-00029090: 7265 6174 655f 696e 6465 783d 4661 6c73  reate_index=Fals
-000290a0: 652c 0a20 2020 2029 202d 3e20 7475 706c  e,.    ) -> tupl
-000290b0: 655b 496e 6465 7820 7c20 4e6f 6e65 2c20  e[Index | None, 
-000290c0: 6469 6374 5b48 6173 6861 626c 652c 2056  dict[Hashable, V
-000290d0: 6172 6961 626c 655d 5d3a 0a20 2020 2020  ariable]]:.     
-000290e0: 2020 2022 2222 5573 6564 2062 7920 7374     """Used by st
-000290f0: 6163 6b20 616e 6420 756e 7374 6163 6b20  ack and unstack 
-00029100: 746f 2067 6574 206f 6e65 2070 616e 6461  to get one panda
-00029110: 7320 286d 756c 7469 2d29 696e 6465 7820  s (multi-)index 
-00029120: 616d 6f6e 670a 2020 2020 2020 2020 7468  among.        th
-00029130: 6520 696e 6465 7865 6420 636f 6f72 6469  e indexed coordi
-00029140: 6e61 7465 7320 616c 6f6e 6720 6469 6d65  nates along dime
-00029150: 6e73 696f 6e20 6064 696d 602e 0a0a 2020  nsion `dim`...  
-00029160: 2020 2020 2020 4966 2065 7861 6374 6c79        If exactly
-00029170: 206f 6e65 2069 6e64 6578 2069 7320 666f   one index is fo
-00029180: 756e 642c 2072 6574 7572 6e20 6974 2077  und, return it w
-00029190: 6974 6820 6974 7320 636f 7272 6573 706f  ith its correspo
-000291a0: 6e64 696e 670a 2020 2020 2020 2020 636f  nding.        co
-000291b0: 6f72 6469 6e61 7465 2076 6172 6961 626c  ordinate variabl
-000291c0: 6573 2873 292c 206f 7468 6572 7769 7365  es(s), otherwise
-000291d0: 2072 6574 7572 6e20 4e6f 6e65 2061 6e64   return None and
-000291e0: 2061 6e20 656d 7074 7920 6469 6374 2e0a   an empty dict..
-000291f0: 0a20 2020 2020 2020 2049 6620 6063 7265  .        If `cre
-00029200: 6174 655f 696e 6465 783d 5472 7565 602c  ate_index=True`,
-00029210: 2063 7265 6174 6520 6120 6e65 7720 696e   create a new in
-00029220: 6465 7820 6966 206e 6f6e 6520 6973 2066  dex if none is f
-00029230: 6f75 6e64 206f 7220 7261 6973 650a 2020  ound or raise.  
-00029240: 2020 2020 2020 616e 2065 7272 6f72 2069        an error i
-00029250: 6620 6d75 6c74 6970 6c65 2069 6e64 6578  f multiple index
-00029260: 6573 2061 7265 2066 6f75 6e64 2e0a 0a20  es are found... 
-00029270: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00029280: 2020 2073 7461 636b 5f69 6e64 6578 3a20     stack_index: 
-00029290: 496e 6465 7820 7c20 4e6f 6e65 203d 204e  Index | None = N
-000292a0: 6f6e 650a 2020 2020 2020 2020 7374 6163  one.        stac
-000292b0: 6b5f 636f 6f72 6473 3a20 6469 6374 5b48  k_coords: dict[H
-000292c0: 6173 6861 626c 652c 2056 6172 6961 626c  ashable, Variabl
-000292d0: 655d 203d 207b 7d0a 0a20 2020 2020 2020  e] = {}..       
-000292e0: 2066 6f72 206e 616d 652c 2069 6e64 6578   for name, index
-000292f0: 2069 6e20 7365 6c66 2e5f 696e 6465 7865   in self._indexe
-00029300: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
-00029310: 2020 2020 2020 2076 6172 203d 2073 656c         var = sel
-00029320: 662e 5f76 6172 6961 626c 6573 5b6e 616d  f._variables[nam
-00029330: 655d 0a20 2020 2020 2020 2020 2020 2069  e].            i
-00029340: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00029350: 2020 2020 7661 722e 6e64 696d 203d 3d20      var.ndim == 
-00029360: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00029370: 2020 616e 6420 7661 722e 6469 6d73 5b30    and var.dims[0
-00029380: 5d20 3d3d 2064 696d 0a20 2020 2020 2020  ] == dim.       
-00029390: 2020 2020 2020 2020 2061 6e64 2028 0a20           and (. 
-000293a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000293b0: 2020 2023 2073 7461 636b 3a20 6d75 7374     # stack: must
-000293c0: 2062 6520 6120 7369 6e67 6c65 2063 6f6f   be a single coo
-000293d0: 7264 696e 6174 6520 696e 6465 780a 2020  rdinate index.  
-000293e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000293f0: 2020 6e6f 7420 6d75 6c74 690a 2020 2020    not multi.    
-00029400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029410: 616e 6420 6e6f 7420 7365 6c66 2e78 696e  and not self.xin
-00029420: 6465 7865 732e 6973 5f6d 756c 7469 286e  dexes.is_multi(n
-00029430: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00029440: 2020 2020 2020 2020 2023 2075 6e73 7461           # unsta
-00029450: 636b 3a20 6d75 7374 2062 6520 616e 2069  ck: must be an i
-00029460: 6e64 6578 2074 6861 7420 696d 706c 656d  ndex that implem
-00029470: 656e 7473 202e 756e 7374 6163 6b0a 2020  ents .unstack.  
-00029480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029490: 2020 6f72 206d 756c 7469 0a20 2020 2020    or multi.     
-000294a0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000294b0: 6e64 2074 7970 6528 696e 6465 7829 2e75  nd type(index).u
-000294c0: 6e73 7461 636b 2069 7320 6e6f 7420 496e  nstack is not In
-000294d0: 6465 782e 756e 7374 6163 6b0a 2020 2020  dex.unstack.    
-000294e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000294f0: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-00029500: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00029510: 7374 6163 6b5f 696e 6465 7820 6973 206e  stack_index is n
-00029520: 6f74 204e 6f6e 6520 616e 6420 696e 6465  ot None and inde
-00029530: 7820 6973 206e 6f74 2073 7461 636b 5f69  x is not stack_i
-00029540: 6e64 6578 3a0a 2020 2020 2020 2020 2020  ndex:.          
-00029550: 2020 2020 2020 2020 2020 2320 6d6f 7265            # more
-00029560: 2074 6861 6e20 6f6e 6520 696e 6465 7820   than one index 
-00029570: 666f 756e 642c 2073 746f 700a 2020 2020  found, stop.    
-00029580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029590: 6966 2063 7265 6174 655f 696e 6465 783a  if create_index:
-000295a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000295b0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000295c0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-000295d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000295e0: 2020 2020 2020 2066 2263 616e 6e6f 7420         f"cannot 
-000295f0: 7374 6163 6b20 6469 6d65 6e73 696f 6e20  stack dimension 
-00029600: 7b64 696d 2172 7d20 7769 7468 2060 6372  {dim!r} with `cr
-00029610: 6561 7465 5f69 6e64 6578 3d54 7275 6560  eate_index=True`
-00029620: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00029630: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00029640: 616e 6420 7769 7468 206d 6f72 6520 7468  and with more th
-00029650: 616e 206f 6e65 2069 6e64 6578 2066 6f75  an one index fou
-00029660: 6e64 2061 6c6f 6e67 2074 6861 7420 6469  nd along that di
-00029670: 6d65 6e73 696f 6e22 0a20 2020 2020 2020  mension".       
-00029680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029690: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-000296a0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-000296b0: 6e65 2c20 7b7d 0a20 2020 2020 2020 2020  ne, {}.         
-000296c0: 2020 2020 2020 2073 7461 636b 5f69 6e64         stack_ind
-000296d0: 6578 203d 2069 6e64 6578 0a20 2020 2020  ex = index.     
-000296e0: 2020 2020 2020 2020 2020 2073 7461 636b             stack
-000296f0: 5f63 6f6f 7264 735b 6e61 6d65 5d20 3d20  _coords[name] = 
-00029700: 7661 720a 0a20 2020 2020 2020 2069 6620  var..        if 
-00029710: 6372 6561 7465 5f69 6e64 6578 2061 6e64  create_index and
-00029720: 2073 7461 636b 5f69 6e64 6578 2069 7320   stack_index is 
-00029730: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00029740: 2020 6966 2064 696d 2069 6e20 7365 6c66    if dim in self
-00029750: 2e5f 7661 7269 6162 6c65 733a 0a20 2020  ._variables:.   
-00029760: 2020 2020 2020 2020 2020 2020 2076 6172               var
-00029770: 203d 2073 656c 662e 5f76 6172 6961 626c   = self._variabl
-00029780: 6573 5b64 696d 5d0a 2020 2020 2020 2020  es[dim].        
-00029790: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000297a0: 2020 2020 2020 2020 2020 5f2c 205f 2c20            _, _, 
-000297b0: 7661 7220 3d20 5f67 6574 5f76 6972 7475  var = _get_virtu
-000297c0: 616c 5f76 6172 6961 626c 6528 7365 6c66  al_variable(self
-000297d0: 2e5f 7661 7269 6162 6c65 732c 2064 696d  ._variables, dim
-000297e0: 2c20 7365 6c66 2e64 696d 7329 0a20 2020  , self.dims).   
-000297f0: 2020 2020 2020 2020 2023 2064 756d 6d79           # dummy
-00029800: 2069 6e64 6578 2028 6f6e 6c79 2060 7374   index (only `st
-00029810: 6163 6b5f 636f 6f72 6473 6020 7769 6c6c  ack_coords` will
-00029820: 2062 6520 7573 6564 2074 6f20 636f 6e73   be used to cons
-00029830: 7472 7563 7420 7468 6520 6d75 6c74 692d  truct the multi-
-00029840: 696e 6465 7829 0a20 2020 2020 2020 2020  index).         
-00029850: 2020 2073 7461 636b 5f69 6e64 6578 203d     stack_index =
-00029860: 2050 616e 6461 7349 6e64 6578 285b 305d   PandasIndex([0]
-00029870: 2c20 6469 6d29 0a20 2020 2020 2020 2020  , dim).         
-00029880: 2020 2073 7461 636b 5f63 6f6f 7264 7320     stack_coords 
-00029890: 3d20 7b64 696d 3a20 7661 727d 0a0a 2020  = {dim: var}..  
-000298a0: 2020 2020 2020 7265 7475 726e 2073 7461        return sta
-000298b0: 636b 5f69 6e64 6578 2c20 7374 6163 6b5f  ck_index, stack_
-000298c0: 636f 6f72 6473 0a0a 2020 2020 6465 6620  coords..    def 
-000298d0: 5f73 7461 636b 5f6f 6e63 6528 0a20 2020  _stack_once(.   
-000298e0: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-000298f0: 6173 6574 2c0a 2020 2020 2020 2020 6469  aset,.        di
-00029900: 6d73 3a20 5365 7175 656e 6365 5b48 6173  ms: Sequence[Has
-00029910: 6861 626c 6520 7c20 656c 6c69 7073 6973  hable | ellipsis
-00029920: 5d2c 0a20 2020 2020 2020 206e 6577 5f64  ],.        new_d
-00029930: 696d 3a20 4861 7368 6162 6c65 2c0a 2020  im: Hashable,.  
-00029940: 2020 2020 2020 696e 6465 785f 636c 733a        index_cls:
-00029950: 2074 7970 655b 496e 6465 785d 2c0a 2020   type[Index],.  
-00029960: 2020 2020 2020 6372 6561 7465 5f69 6e64        create_ind
-00029970: 6578 3a20 626f 6f6c 207c 204e 6f6e 6520  ex: bool | None 
-00029980: 3d20 5472 7565 2c0a 2020 2020 2920 2d3e  = True,.    ) ->
-00029990: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-000299a0: 2020 2020 6966 2064 696d 7320 3d3d 202e      if dims == .
-000299b0: 2e2e 3a0a 2020 2020 2020 2020 2020 2020  ..:.            
-000299c0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000299d0: 2822 506c 6561 7365 2075 7365 205b 2e2e  ("Please use [..
-000299e0: 2e5d 2066 6f72 2064 696d 732c 2072 6174  .] for dims, rat
-000299f0: 6865 7220 7468 616e 206a 7573 7420 2e2e  her than just ..
-00029a00: 2e22 290a 2020 2020 2020 2020 6966 202e  .").        if .
-00029a10: 2e2e 2069 6e20 6469 6d73 3a0a 2020 2020  .. in dims:.    
-00029a20: 2020 2020 2020 2020 6469 6d73 203d 206c          dims = l
-00029a30: 6973 7428 696e 6669 785f 6469 6d73 2864  ist(infix_dims(d
-00029a40: 696d 732c 2073 656c 662e 6469 6d73 2929  ims, self.dims))
-00029a50: 0a0a 2020 2020 2020 2020 6e65 775f 7661  ..        new_va
-00029a60: 7269 6162 6c65 733a 2064 6963 745b 4861  riables: dict[Ha
-00029a70: 7368 6162 6c65 2c20 5661 7269 6162 6c65  shable, Variable
-00029a80: 5d20 3d20 7b7d 0a20 2020 2020 2020 2073  ] = {}.        s
-00029a90: 7461 636b 6564 5f76 6172 5f6e 616d 6573  tacked_var_names
-00029aa0: 3a20 6c69 7374 5b48 6173 6861 626c 655d  : list[Hashable]
-00029ab0: 203d 205b 5d0a 2020 2020 2020 2020 6472   = [].        dr
-00029ac0: 6f70 5f69 6e64 6578 6573 3a20 6c69 7374  op_indexes: list
-00029ad0: 5b48 6173 6861 626c 655d 203d 205b 5d0a  [Hashable] = [].
-00029ae0: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
-00029af0: 652c 2076 6172 2069 6e20 7365 6c66 2e76  e, var in self.v
-00029b00: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
-00029b10: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00029b20: 2061 6e79 2864 2069 6e20 7661 722e 6469   any(d in var.di
-00029b30: 6d73 2066 6f72 2064 2069 6e20 6469 6d73  ms for d in dims
-00029b40: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00029b50: 2020 2061 6464 5f64 696d 7320 3d20 5b64     add_dims = [d
-00029b60: 2066 6f72 2064 2069 6e20 6469 6d73 2069   for d in dims i
-00029b70: 6620 6420 6e6f 7420 696e 2076 6172 2e64  f d not in var.d
-00029b80: 696d 735d 0a20 2020 2020 2020 2020 2020  ims].           
-00029b90: 2020 2020 2076 6469 6d73 203d 206c 6973       vdims = lis
-00029ba0: 7428 7661 722e 6469 6d73 2920 2b20 6164  t(var.dims) + ad
-00029bb0: 645f 6469 6d73 0a20 2020 2020 2020 2020  d_dims.         
-00029bc0: 2020 2020 2020 2073 6861 7065 203d 205b         shape = [
-00029bd0: 7365 6c66 2e64 696d 735b 645d 2066 6f72  self.dims[d] for
-00029be0: 2064 2069 6e20 7664 696d 735d 0a20 2020   d in vdims].   
-00029bf0: 2020 2020 2020 2020 2020 2020 2065 7870               exp
-00029c00: 5f76 6172 203d 2076 6172 2e73 6574 5f64  _var = var.set_d
-00029c10: 696d 7328 7664 696d 732c 2073 6861 7065  ims(vdims, shape
-00029c20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00029c30: 2020 7374 6163 6b65 645f 7661 7220 3d20    stacked_var = 
-00029c40: 6578 705f 7661 722e 7374 6163 6b28 2a2a  exp_var.stack(**
-00029c50: 7b6e 6577 5f64 696d 3a20 6469 6d73 7d29  {new_dim: dims})
-00029c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029c70: 206e 6577 5f76 6172 6961 626c 6573 5b6e   new_variables[n
-00029c80: 616d 655d 203d 2073 7461 636b 6564 5f76  ame] = stacked_v
-00029c90: 6172 0a20 2020 2020 2020 2020 2020 2020  ar.             
-00029ca0: 2020 2073 7461 636b 6564 5f76 6172 5f6e     stacked_var_n
-00029cb0: 616d 6573 2e61 7070 656e 6428 6e61 6d65  ames.append(name
-00029cc0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00029cd0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00029ce0: 2020 2020 6e65 775f 7661 7269 6162 6c65      new_variable
-00029cf0: 735b 6e61 6d65 5d20 3d20 7661 722e 636f  s[name] = var.co
-00029d00: 7079 2864 6565 703d 4661 6c73 6529 0a0a  py(deep=False)..
-00029d10: 2020 2020 2020 2020 2320 6472 6f70 2069          # drop i
-00029d20: 6e64 6578 6573 206f 6620 7374 6163 6b65  ndexes of stacke
-00029d30: 6420 636f 6f72 6469 6e61 7465 7320 2869  d coordinates (i
-00029d40: 6620 616e 7929 0a20 2020 2020 2020 2066  f any).        f
-00029d50: 6f72 206e 616d 6520 696e 2073 7461 636b  or name in stack
-00029d60: 6564 5f76 6172 5f6e 616d 6573 3a0a 2020  ed_var_names:.  
-00029d70: 2020 2020 2020 2020 2020 6472 6f70 5f69            drop_i
-00029d80: 6e64 6578 6573 202b 3d20 6c69 7374 2873  ndexes += list(s
-00029d90: 656c 662e 7869 6e64 6578 6573 2e67 6574  elf.xindexes.get
-00029da0: 5f61 6c6c 5f63 6f6f 7264 7328 6e61 6d65  _all_coords(name
-00029db0: 2c20 6572 726f 7273 3d22 6967 6e6f 7265  , errors="ignore
-00029dc0: 2229 290a 0a20 2020 2020 2020 206e 6577  "))..        new
-00029dd0: 5f69 6e64 6578 6573 203d 207b 7d0a 2020  _indexes = {}.  
-00029de0: 2020 2020 2020 6e65 775f 636f 6f72 645f        new_coord_
-00029df0: 6e61 6d65 7320 3d20 7365 7428 7365 6c66  names = set(self
-00029e00: 2e5f 636f 6f72 645f 6e61 6d65 7329 0a20  ._coord_names). 
-00029e10: 2020 2020 2020 2069 6620 6372 6561 7465         if create
-00029e20: 5f69 6e64 6578 206f 7220 6372 6561 7465  _index or create
-00029e30: 5f69 6e64 6578 2069 7320 4e6f 6e65 3a0a  _index is None:.
-00029e40: 2020 2020 2020 2020 2020 2020 7072 6f64              prod
-00029e50: 7563 745f 7661 7273 3a20 6469 6374 5b41  uct_vars: dict[A
-00029e60: 6e79 2c20 5661 7269 6162 6c65 5d20 3d20  ny, Variable] = 
-00029e70: 7b7d 0a20 2020 2020 2020 2020 2020 2066  {}.            f
-00029e80: 6f72 2064 696d 2069 6e20 6469 6d73 3a0a  or dim in dims:.
-00029e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029ea0: 6964 782c 2069 6478 5f76 6172 7320 3d20  idx, idx_vars = 
-00029eb0: 7365 6c66 2e5f 6765 745f 7374 6163 6b5f  self._get_stack_
-00029ec0: 696e 6465 7828 6469 6d2c 2063 7265 6174  index(dim, creat
-00029ed0: 655f 696e 6465 783d 6372 6561 7465 5f69  e_index=create_i
-00029ee0: 6e64 6578 290a 2020 2020 2020 2020 2020  ndex).          
-00029ef0: 2020 2020 2020 6966 2069 6478 2069 7320        if idx is 
-00029f00: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00029f10: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00029f20: 6f64 7563 745f 7661 7273 2e75 7064 6174  oduct_vars.updat
-00029f30: 6528 6964 785f 7661 7273 290a 0a20 2020  e(idx_vars)..   
-00029f40: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00029f50: 7072 6f64 7563 745f 7661 7273 2920 3d3d  product_vars) ==
-00029f60: 206c 656e 2864 696d 7329 3a0a 2020 2020   len(dims):.    
-00029f70: 2020 2020 2020 2020 2020 2020 6964 7820              idx 
-00029f80: 3d20 696e 6465 785f 636c 732e 7374 6163  = index_cls.stac
-00029f90: 6b28 7072 6f64 7563 745f 7661 7273 2c20  k(product_vars, 
-00029fa0: 6e65 775f 6469 6d29 0a20 2020 2020 2020  new_dim).       
-00029fb0: 2020 2020 2020 2020 206e 6577 5f69 6e64           new_ind
-00029fc0: 6578 6573 5b6e 6577 5f64 696d 5d20 3d20  exes[new_dim] = 
-00029fd0: 6964 780a 2020 2020 2020 2020 2020 2020  idx.            
-00029fe0: 2020 2020 6e65 775f 696e 6465 7865 732e      new_indexes.
-00029ff0: 7570 6461 7465 287b 6b3a 2069 6478 2066  update({k: idx f
-0002a000: 6f72 206b 2069 6e20 7072 6f64 7563 745f  or k in product_
-0002a010: 7661 7273 7d29 0a20 2020 2020 2020 2020  vars}).         
-0002a020: 2020 2020 2020 2069 6478 5f76 6172 7320         idx_vars 
-0002a030: 3d20 6964 782e 6372 6561 7465 5f76 6172  = idx.create_var
-0002a040: 6961 626c 6573 2870 726f 6475 6374 5f76  iables(product_v
-0002a050: 6172 7329 0a20 2020 2020 2020 2020 2020  ars).           
-0002a060: 2020 2020 2023 206b 6565 7020 636f 6e73       # keep cons
-0002a070: 6973 7465 6e74 206d 756c 7469 2d69 6e64  istent multi-ind
-0002a080: 6578 2063 6f6f 7264 696e 6174 6520 6f72  ex coordinate or
-0002a090: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
-0002a0a0: 2020 2020 666f 7220 6b20 696e 2069 6478      for k in idx
-0002a0b0: 5f76 6172 733a 0a20 2020 2020 2020 2020  _vars:.         
-0002a0c0: 2020 2020 2020 2020 2020 206e 6577 5f76             new_v
-0002a0d0: 6172 6961 626c 6573 2e70 6f70 286b 2c20  ariables.pop(k, 
-0002a0e0: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
-0002a0f0: 2020 2020 2020 6e65 775f 7661 7269 6162        new_variab
-0002a100: 6c65 732e 7570 6461 7465 2869 6478 5f76  les.update(idx_v
-0002a110: 6172 7329 0a20 2020 2020 2020 2020 2020  ars).           
-0002a120: 2020 2020 206e 6577 5f63 6f6f 7264 5f6e       new_coord_n
-0002a130: 616d 6573 2e75 7064 6174 6528 6964 785f  ames.update(idx_
-0002a140: 7661 7273 290a 0a20 2020 2020 2020 2069  vars)..        i
-0002a150: 6e64 6578 6573 203d 207b 6b3a 2076 2066  ndexes = {k: v f
-0002a160: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
-0002a170: 5f69 6e64 6578 6573 2e69 7465 6d73 2829  _indexes.items()
-0002a180: 2069 6620 6b20 6e6f 7420 696e 2064 726f   if k not in dro
-0002a190: 705f 696e 6465 7865 737d 0a20 2020 2020  p_indexes}.     
-0002a1a0: 2020 2069 6e64 6578 6573 2e75 7064 6174     indexes.updat
-0002a1b0: 6528 6e65 775f 696e 6465 7865 7329 0a0a  e(new_indexes)..
-0002a1c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0002a1d0: 656c 662e 5f72 6570 6c61 6365 5f77 6974  elf._replace_wit
-0002a1e0: 685f 6e65 775f 6469 6d73 280a 2020 2020  h_new_dims(.    
-0002a1f0: 2020 2020 2020 2020 6e65 775f 7661 7269          new_vari
-0002a200: 6162 6c65 732c 2063 6f6f 7264 5f6e 616d  ables, coord_nam
-0002a210: 6573 3d6e 6577 5f63 6f6f 7264 5f6e 616d  es=new_coord_nam
-0002a220: 6573 2c20 696e 6465 7865 733d 696e 6465  es, indexes=inde
-0002a230: 7865 730a 2020 2020 2020 2020 290a 0a20  xes.        ).. 
-0002a240: 2020 2064 6566 2073 7461 636b 280a 2020     def stack(.  
-0002a250: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
-0002a260: 7461 7365 742c 0a20 2020 2020 2020 2064  taset,.        d
-0002a270: 696d 656e 7369 6f6e 733a 204d 6170 7069  imensions: Mappi
-0002a280: 6e67 5b41 6e79 2c20 5365 7175 656e 6365  ng[Any, Sequence
-0002a290: 5b48 6173 6861 626c 6520 7c20 656c 6c69  [Hashable | elli
-0002a2a0: 7073 6973 5d5d 207c 204e 6f6e 6520 3d20  psis]] | None = 
-0002a2b0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6372  None,.        cr
-0002a2c0: 6561 7465 5f69 6e64 6578 3a20 626f 6f6c  eate_index: bool
-0002a2d0: 207c 204e 6f6e 6520 3d20 5472 7565 2c0a   | None = True,.
-0002a2e0: 2020 2020 2020 2020 696e 6465 785f 636c          index_cl
-0002a2f0: 733a 2074 7970 655b 496e 6465 785d 203d  s: type[Index] =
-0002a300: 2050 616e 6461 734d 756c 7469 496e 6465   PandasMultiInde
-0002a310: 782c 0a20 2020 2020 2020 202a 2a64 696d  x,.        **dim
-0002a320: 656e 7369 6f6e 735f 6b77 6172 6773 3a20  ensions_kwargs: 
-0002a330: 5365 7175 656e 6365 5b48 6173 6861 626c  Sequence[Hashabl
-0002a340: 6520 7c20 656c 6c69 7073 6973 5d2c 0a20  e | ellipsis],. 
-0002a350: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
-0002a360: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
-0002a370: 2020 2020 2020 2053 7461 636b 2061 6e79         Stack any
-0002a380: 206e 756d 6265 7220 6f66 2065 7869 7374   number of exist
-0002a390: 696e 6720 6469 6d65 6e73 696f 6e73 2069  ing dimensions i
-0002a3a0: 6e74 6f20 6120 7369 6e67 6c65 206e 6577  nto a single new
-0002a3b0: 2064 696d 656e 7369 6f6e 2e0a 0a20 2020   dimension...   
-0002a3c0: 2020 2020 204e 6577 2064 696d 656e 7369       New dimensi
-0002a3d0: 6f6e 7320 7769 6c6c 2062 6520 6164 6465  ons will be adde
-0002a3e0: 6420 6174 2074 6865 2065 6e64 2c20 616e  d at the end, an
-0002a3f0: 6420 6279 2064 6566 6175 6c74 2074 6865  d by default the
-0002a400: 2063 6f72 7265 7370 6f6e 6469 6e67 0a20   corresponding. 
-0002a410: 2020 2020 2020 2063 6f6f 7264 696e 6174         coordinat
-0002a420: 6520 7661 7269 6162 6c65 7320 7769 6c6c  e variables will
-0002a430: 2062 6520 636f 6d62 696e 6564 2069 6e74   be combined int
-0002a440: 6f20 6120 4d75 6c74 6949 6e64 6578 2e0a  o a MultiIndex..
-0002a450: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0002a460: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-0002a470: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-0002a480: 696d 656e 7369 6f6e 7320 3a20 6d61 7070  imensions : mapp
-0002a490: 696e 6720 6f66 2068 6173 6861 626c 6520  ing of hashable 
-0002a4a0: 746f 2073 6571 7565 6e63 6520 6f66 2068  to sequence of h
-0002a4b0: 6173 6861 626c 650a 2020 2020 2020 2020  ashable.        
-0002a4c0: 2020 2020 4d61 7070 696e 6720 6f66 2074      Mapping of t
-0002a4d0: 6865 2066 6f72 6d20 606e 6577 5f6e 616d  he form `new_nam
-0002a4e0: 653d 2864 696d 312c 2064 696d 322c 202e  e=(dim1, dim2, .
-0002a4f0: 2e2e 2960 2e20 4e61 6d65 7320 6f66 206e  ..)`. Names of n
-0002a500: 6577 0a20 2020 2020 2020 2020 2020 2064  ew.            d
-0002a510: 696d 656e 7369 6f6e 732c 2061 6e64 2074  imensions, and t
-0002a520: 6865 2065 7869 7374 696e 6720 6469 6d65  he existing dime
-0002a530: 6e73 696f 6e73 2074 6861 7420 7468 6579  nsions that they
-0002a540: 2072 6570 6c61 6365 2e20 416e 0a20 2020   replace. An.   
-0002a550: 2020 2020 2020 2020 2065 6c6c 6970 7369           ellipsi
-0002a560: 7320 2860 2e2e 2e60 2920 7769 6c6c 2062  s (`...`) will b
-0002a570: 6520 7265 706c 6163 6564 2062 7920 616c  e replaced by al
-0002a580: 6c20 756e 6c69 7374 6564 2064 696d 656e  l unlisted dimen
-0002a590: 7369 6f6e 732e 0a20 2020 2020 2020 2020  sions..         
-0002a5a0: 2020 2050 6173 7369 6e67 2061 206c 6973     Passing a lis
-0002a5b0: 7420 636f 6e74 6169 6e69 6e67 2061 6e20  t containing an 
-0002a5c0: 656c 6c69 7073 6973 2028 6073 7461 636b  ellipsis (`stack
-0002a5d0: 6564 5f64 696d 3d5b 2e2e 2e5d 6029 2077  ed_dim=[...]`) w
-0002a5e0: 696c 6c20 7374 6163 6b20 6f76 6572 0a20  ill stack over. 
-0002a5f0: 2020 2020 2020 2020 2020 2061 6c6c 2064             all d
-0002a600: 696d 656e 7369 6f6e 732e 0a20 2020 2020  imensions..     
-0002a610: 2020 2063 7265 6174 655f 696e 6465 7820     create_index 
-0002a620: 3a20 626f 6f6c 206f 7220 4e6f 6e65 2c20  : bool or None, 
-0002a630: 6465 6661 756c 743a 2054 7275 650a 0a20  default: True.. 
-0002a640: 2020 2020 2020 2020 2020 202d 2054 7275             - Tru
-0002a650: 653a 2063 7265 6174 6520 6120 6d75 6c74  e: create a mult
-0002a660: 692d 696e 6465 7820 666f 7220 6561 6368  i-index for each
-0002a670: 206f 6620 7468 6520 7374 6163 6b65 6420   of the stacked 
-0002a680: 6469 6d65 6e73 696f 6e73 2e0a 2020 2020  dimensions..    
-0002a690: 2020 2020 2020 2020 2d20 4661 6c73 653a          - False:
-0002a6a0: 2064 6f6e 2774 2063 7265 6174 6520 616e   don't create an
-0002a6b0: 7920 696e 6465 782e 0a20 2020 2020 2020  y index..       
-0002a6c0: 2020 2020 202d 204e 6f6e 652e 2063 7265       - None. cre
-0002a6d0: 6174 6520 6120 6d75 6c74 692d 696e 6465  ate a multi-inde
-0002a6e0: 7820 6f6e 6c79 2069 6620 6578 6163 746c  x only if exactl
-0002a6f0: 7920 6f6e 6520 7369 6e67 6c65 2028 312d  y one single (1-
-0002a700: 6429 2063 6f6f 7264 696e 6174 650a 2020  d) coordinate.  
-0002a710: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-0002a720: 7820 6973 2066 6f75 6e64 2066 6f72 2065  x is found for e
-0002a730: 7665 7279 2064 696d 656e 7369 6f6e 2074  very dimension t
-0002a740: 6f20 7374 6163 6b2e 0a0a 2020 2020 2020  o stack...      
-0002a750: 2020 696e 6465 785f 636c 733a 2049 6e64    index_cls: Ind
-0002a760: 6578 2d63 6c61 7373 2c20 6465 6661 756c  ex-class, defaul
-0002a770: 743a 2050 616e 6461 734d 756c 7469 496e  t: PandasMultiIn
-0002a780: 6465 780a 2020 2020 2020 2020 2020 2020  dex.            
-0002a790: 4361 6e20 6265 2075 7365 6420 746f 2070  Can be used to p
-0002a7a0: 6173 7320 6120 6375 7374 6f6d 206d 756c  ass a custom mul
-0002a7b0: 7469 2d69 6e64 6578 2074 7970 6520 286d  ti-index type (m
-0002a7c0: 7573 7420 6265 2061 6e20 5861 7272 6179  ust be an Xarray
-0002a7d0: 2069 6e64 6578 2074 6861 740a 2020 2020   index that.    
-0002a7e0: 2020 2020 2020 2020 696d 706c 656d 656e          implemen
-0002a7f0: 7473 2060 2e73 7461 636b 2829 6029 2e20  ts `.stack()`). 
-0002a800: 4279 2064 6566 6175 6c74 2c20 6120 7061  By default, a pa
-0002a810: 6e64 6173 206d 756c 7469 2d69 6e64 6578  ndas multi-index
-0002a820: 2077 7261 7070 6572 2069 7320 7573 6564   wrapper is used
-0002a830: 2e0a 2020 2020 2020 2020 2a2a 6469 6d65  ..        **dime
-0002a840: 6e73 696f 6e73 5f6b 7761 7267 730a 2020  nsions_kwargs.  
-0002a850: 2020 2020 2020 2020 2020 5468 6520 6b65            The ke
-0002a860: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
-0002a870: 666f 726d 206f 6620 6060 6469 6d65 6e73  form of ``dimens
-0002a880: 696f 6e73 6060 2e0a 2020 2020 2020 2020  ions``..        
-0002a890: 2020 2020 4f6e 6520 6f66 2064 696d 656e      One of dimen
-0002a8a0: 7369 6f6e 7320 6f72 2064 696d 656e 7369  sions or dimensi
-0002a8b0: 6f6e 735f 6b77 6172 6773 206d 7573 7420  ons_kwargs must 
-0002a8c0: 6265 2070 726f 7669 6465 642e 0a0a 2020  be provided...  
-0002a8d0: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-0002a8e0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-0002a8f0: 2020 2020 2020 7374 6163 6b65 6420 3a20        stacked : 
-0002a900: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
-0002a910: 2020 2020 4461 7461 7365 7420 7769 7468      Dataset with
-0002a920: 2073 7461 636b 6564 2064 6174 612e 0a0a   stacked data...
-0002a930: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-0002a940: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0002a950: 2d0a 2020 2020 2020 2020 4461 7461 7365  -.        Datase
-0002a960: 742e 756e 7374 6163 6b0a 2020 2020 2020  t.unstack.      
-0002a970: 2020 2222 220a 2020 2020 2020 2020 6469    """.        di
-0002a980: 6d65 6e73 696f 6e73 203d 2065 6974 6865  mensions = eithe
-0002a990: 725f 6469 6374 5f6f 725f 6b77 6172 6773  r_dict_or_kwargs
-0002a9a0: 2864 696d 656e 7369 6f6e 732c 2064 696d  (dimensions, dim
-0002a9b0: 656e 7369 6f6e 735f 6b77 6172 6773 2c20  ensions_kwargs, 
-0002a9c0: 2273 7461 636b 2229 0a20 2020 2020 2020  "stack").       
-0002a9d0: 2072 6573 756c 7420 3d20 7365 6c66 0a20   result = self. 
-0002a9e0: 2020 2020 2020 2066 6f72 206e 6577 5f64         for new_d
-0002a9f0: 696d 2c20 6469 6d73 2069 6e20 6469 6d65  im, dims in dime
-0002aa00: 6e73 696f 6e73 2e69 7465 6d73 2829 3a0a  nsions.items():.
-0002aa10: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0002aa20: 6c74 203d 2072 6573 756c 742e 5f73 7461  lt = result._sta
-0002aa30: 636b 5f6f 6e63 6528 6469 6d73 2c20 6e65  ck_once(dims, ne
-0002aa40: 775f 6469 6d2c 2069 6e64 6578 5f63 6c73  w_dim, index_cls
-0002aa50: 2c20 6372 6561 7465 5f69 6e64 6578 290a  , create_index).
-0002aa60: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-0002aa70: 6573 756c 740a 0a20 2020 2064 6566 2074  esult..    def t
-0002aa80: 6f5f 7374 6163 6b65 645f 6172 7261 7928  o_stacked_array(
-0002aa90: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0002aaa0: 2020 2020 2020 206e 6577 5f64 696d 3a20         new_dim: 
-0002aab0: 4861 7368 6162 6c65 2c0a 2020 2020 2020  Hashable,.      
-0002aac0: 2020 7361 6d70 6c65 5f64 696d 733a 2043    sample_dims: C
-0002aad0: 6f6c 6c65 6374 696f 6e5b 4861 7368 6162  ollection[Hashab
-0002aae0: 6c65 5d2c 0a20 2020 2020 2020 2076 6172  le],.        var
-0002aaf0: 6961 626c 655f 6469 6d3a 2048 6173 6861  iable_dim: Hasha
-0002ab00: 626c 6520 3d20 2276 6172 6961 626c 6522  ble = "variable"
-0002ab10: 2c0a 2020 2020 2020 2020 6e61 6d65 3a20  ,.        name: 
-0002ab20: 4861 7368 6162 6c65 207c 204e 6f6e 6520  Hashable | None 
-0002ab30: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
-0002ab40: 2044 6174 6141 7272 6179 3a0a 2020 2020   DataArray:.    
-0002ab50: 2020 2020 2222 2243 6f6d 6269 6e65 2076      """Combine v
-0002ab60: 6172 6961 626c 6573 206f 6620 6469 6666  ariables of diff
-0002ab70: 6572 696e 6720 6469 6d65 6e73 696f 6e61  ering dimensiona
-0002ab80: 6c69 7479 2069 6e74 6f20 6120 4461 7461  lity into a Data
-0002ab90: 4172 7261 790a 2020 2020 2020 2020 7769  Array.        wi
-0002aba0: 7468 6f75 7420 6272 6f61 6463 6173 7469  thout broadcasti
-0002abb0: 6e67 2e0a 0a20 2020 2020 2020 2054 6869  ng...        Thi
-0002abc0: 7320 6d65 7468 6f64 2069 7320 7369 6d69  s method is simi
-0002abd0: 6c61 7220 746f 2044 6174 6173 6574 2e74  lar to Dataset.t
-0002abe0: 6f5f 6172 7261 7920 6275 7420 646f 6573  o_array but does
-0002abf0: 206e 6f74 2062 726f 6164 6361 7374 2074   not broadcast t
-0002ac00: 6865 0a20 2020 2020 2020 2076 6172 6961  he.        varia
-0002ac10: 626c 6573 2e0a 0a20 2020 2020 2020 2050  bles...        P
-0002ac20: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-0002ac30: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0002ac40: 2020 2020 206e 6577 5f64 696d 203a 2068       new_dim : h
-0002ac50: 6173 6861 626c 650a 2020 2020 2020 2020  ashable.        
-0002ac60: 2020 2020 4e61 6d65 206f 6620 7468 6520      Name of the 
-0002ac70: 6e65 7720 7374 6163 6b65 6420 636f 6f72  new stacked coor
-0002ac80: 6469 6e61 7465 0a20 2020 2020 2020 2073  dinate.        s
-0002ac90: 616d 706c 655f 6469 6d73 203a 2043 6f6c  ample_dims : Col
-0002aca0: 6c65 6374 696f 6e20 6f66 2068 6173 6861  lection of hasha
-0002acb0: 626c 6573 0a20 2020 2020 2020 2020 2020  bles.           
-0002acc0: 204c 6973 7420 6f66 2064 696d 656e 7369   List of dimensi
-0002acd0: 6f6e 7320 7468 6174 202a 2a77 696c 6c20  ons that **will 
-0002ace0: 6e6f 742a 2a20 6265 2073 7461 636b 6564  not** be stacked
-0002acf0: 2e20 4561 6368 2061 7272 6179 2069 6e20  . Each array in 
-0002ad00: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-0002ad10: 6461 7461 7365 7420 6d75 7374 2073 6861  dataset must sha
-0002ad20: 7265 2074 6865 7365 2064 696d 656e 7369  re these dimensi
-0002ad30: 6f6e 732e 2046 6f72 206d 6163 6869 6e65  ons. For machine
-0002ad40: 206c 6561 726e 696e 670a 2020 2020 2020   learning.      
-0002ad50: 2020 2020 2020 6170 706c 6963 6174 696f        applicatio
-0002ad60: 6e73 2c20 7468 6573 6520 6465 6669 6e65  ns, these define
-0002ad70: 2074 6865 2064 696d 656e 7369 6f6e 7320   the dimensions 
-0002ad80: 6f76 6572 2077 6869 6368 2073 616d 706c  over which sampl
-0002ad90: 6573 2061 7265 0a20 2020 2020 2020 2020  es are.         
-0002ada0: 2020 2064 7261 776e 2e0a 2020 2020 2020     drawn..      
-0002adb0: 2020 7661 7269 6162 6c65 5f64 696d 203a    variable_dim :
-0002adc0: 2068 6173 6861 626c 652c 2064 6566 6175   hashable, defau
-0002add0: 6c74 3a20 2276 6172 6961 626c 6522 0a20  lt: "variable". 
-0002ade0: 2020 2020 2020 2020 2020 204e 616d 6520             Name 
-0002adf0: 6f66 2074 6865 206c 6576 656c 2069 6e20  of the level in 
-0002ae00: 7468 6520 7374 6163 6b65 6420 636f 6f72  the stacked coor
-0002ae10: 6469 6e61 7465 2077 6869 6368 2063 6f72  dinate which cor
-0002ae20: 7265 7370 6f6e 6473 2074 6f0a 2020 2020  responds to.    
-0002ae30: 2020 2020 2020 2020 7468 6520 7661 7269          the vari
-0002ae40: 6162 6c65 732e 0a20 2020 2020 2020 206e  ables..        n
-0002ae50: 616d 6520 3a20 6861 7368 6162 6c65 2c20  ame : hashable, 
-0002ae60: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0002ae70: 2020 2020 204e 616d 6520 6f66 2074 6865       Name of the
-0002ae80: 206e 6577 2064 6174 6120 6172 7261 792e   new data array.
-0002ae90: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0002aea0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0002aeb0: 2d0a 2020 2020 2020 2020 7374 6163 6b65  -.        stacke
-0002aec0: 6420 3a20 4461 7461 4172 7261 790a 2020  d : DataArray.  
-0002aed0: 2020 2020 2020 2020 2020 4461 7461 4172            DataAr
-0002aee0: 7261 7920 7769 7468 2074 6865 2073 7065  ray with the spe
-0002aef0: 6369 6669 6564 2064 696d 656e 7369 6f6e  cified dimension
-0002af00: 7320 616e 6420 6461 7461 2076 6172 6961  s and data varia
-0002af10: 626c 6573 0a20 2020 2020 2020 2020 2020  bles.           
-0002af20: 2073 7461 636b 6564 2074 6f67 6574 6865   stacked togethe
-0002af30: 722e 2054 6865 2073 7461 636b 6564 2063  r. The stacked c
-0002af40: 6f6f 7264 696e 6174 6520 6973 206e 616d  oordinate is nam
-0002af50: 6564 2060 606e 6577 5f64 696d 6060 0a20  ed ``new_dim``. 
-0002af60: 2020 2020 2020 2020 2020 2061 6e64 2072             and r
-0002af70: 6570 7265 7365 6e74 6564 2062 7920 6120  epresented by a 
-0002af80: 4d75 6c74 6949 6e64 6578 206f 626a 6563  MultiIndex objec
-0002af90: 7420 7769 7468 2061 206c 6576 656c 2063  t with a level c
-0002afa0: 6f6e 7461 696e 696e 6720 7468 650a 2020  ontaining the.  
-0002afb0: 2020 2020 2020 2020 2020 6461 7461 2076            data v
-0002afc0: 6172 6961 626c 6520 6e61 6d65 732e 2054  ariable names. T
-0002afd0: 6865 206e 616d 6520 6f66 2074 6869 7320  he name of this 
-0002afe0: 6c65 7665 6c20 6973 2063 6f6e 7472 6f6c  level is control
-0002aff0: 6c65 6420 7573 696e 670a 2020 2020 2020  led using.      
-0002b000: 2020 2020 2020 7468 6520 6060 7661 7269        the ``vari
-0002b010: 6162 6c65 5f64 696d 6060 2061 7267 756d  able_dim`` argum
-0002b020: 656e 742e 0a0a 2020 2020 2020 2020 5365  ent...        Se
-0002b030: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
-0002b040: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0002b050: 4461 7461 7365 742e 746f 5f61 7272 6179  Dataset.to_array
-0002b060: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
-0002b070: 2e73 7461 636b 0a20 2020 2020 2020 2044  .stack.        D
-0002b080: 6174 6141 7272 6179 2e74 6f5f 756e 7374  ataArray.to_unst
-0002b090: 6163 6b65 645f 6461 7461 7365 740a 0a20  acked_dataset.. 
-0002b0a0: 2020 2020 2020 2045 7861 6d70 6c65 730a         Examples.
-0002b0b0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0002b0c0: 0a20 2020 2020 2020 203e 3e3e 2064 6174  .        >>> dat
-0002b0d0: 6120 3d20 7872 2e44 6174 6173 6574 280a  a = xr.Dataset(.
-0002b0e0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-0002b0f0: 6461 7461 5f76 6172 733d 7b0a 2020 2020  data_vars={.    
-0002b100: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-0002b110: 2261 223a 2028 2822 7822 2c20 2279 2229  "a": (("x", "y")
-0002b120: 2c20 5b5b 302c 2031 2c20 325d 2c20 5b33  , [[0, 1, 2], [3
-0002b130: 2c20 342c 2035 5d5d 292c 0a20 2020 2020  , 4, 5]]),.     
-0002b140: 2020 202e 2e2e 2020 2020 2020 2020 2022     ...         "
-0002b150: 6222 3a20 2822 7822 2c20 5b36 2c20 375d  b": ("x", [6, 7]
-0002b160: 292c 0a20 2020 2020 2020 202e 2e2e 2020  ),.        ...  
-0002b170: 2020 207d 2c0a 2020 2020 2020 2020 2e2e     },.        ..
-0002b180: 2e20 2020 2020 636f 6f72 6473 3d7b 2279  .     coords={"y
-0002b190: 223a 205b 2275 222c 2022 7622 2c20 2277  ": ["u", "v", "w
-0002b1a0: 225d 7d2c 0a20 2020 2020 2020 202e 2e2e  "]},.        ...
-0002b1b0: 2029 0a0a 2020 2020 2020 2020 3e3e 3e20   )..        >>> 
-0002b1c0: 6461 7461 0a20 2020 2020 2020 203c 7861  data.        <xa
-0002b1d0: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
-0002b1e0: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
-0002b1f0: 3a20 2028 783a 2032 2c20 793a 2033 290a  :  (x: 2, y: 3).
-0002b200: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
-0002b210: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
-0002b220: 2079 2020 2020 2020 2020 2879 2920 3c55   y        (y) <U
-0002b230: 3120 2775 2720 2776 2720 2777 270a 2020  1 'u' 'v' 'w'.  
-0002b240: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
-0002b250: 2077 6974 686f 7574 2063 6f6f 7264 696e   without coordin
-0002b260: 6174 6573 3a20 780a 2020 2020 2020 2020  ates: x.        
-0002b270: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
-0002b280: 2020 2020 2020 2020 2020 2020 6120 2020              a   
-0002b290: 2020 2020 2028 782c 2079 2920 696e 7436       (x, y) int6
-0002b2a0: 3420 3020 3120 3220 3320 3420 350a 2020  4 0 1 2 3 4 5.  
-0002b2b0: 2020 2020 2020 2020 2020 6220 2020 2020            b     
-0002b2c0: 2020 2028 7829 2069 6e74 3634 2036 2037     (x) int64 6 7
-0002b2d0: 0a0a 2020 2020 2020 2020 3e3e 3e20 6461  ..        >>> da
-0002b2e0: 7461 2e74 6f5f 7374 6163 6b65 645f 6172  ta.to_stacked_ar
-0002b2f0: 7261 7928 227a 222c 2073 616d 706c 655f  ray("z", sample_
-0002b300: 6469 6d73 3d5b 2278 225d 290a 2020 2020  dims=["x"]).    
-0002b310: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
-0002b320: 4172 7261 7920 2761 2720 2878 3a20 322c  Array 'a' (x: 2,
-0002b330: 207a 3a20 3429 3e0a 2020 2020 2020 2020   z: 4)>.        
-0002b340: 6172 7261 7928 5b5b 302c 2031 2c20 322c  array([[0, 1, 2,
-0002b350: 2036 5d2c 0a20 2020 2020 2020 2020 2020   6],.           
-0002b360: 2020 2020 5b33 2c20 342c 2035 2c20 375d      [3, 4, 5, 7]
-0002b370: 5d29 0a20 2020 2020 2020 2043 6f6f 7264  ]).        Coord
-0002b380: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
-0002b390: 2020 2a20 7a20 2020 2020 2020 2020 287a    * z         (z
-0002b3a0: 2920 6f62 6a65 6374 204d 756c 7469 496e  ) object MultiIn
-0002b3b0: 6465 780a 2020 2020 2020 2020 2020 2a20  dex.          * 
-0002b3c0: 7661 7269 6162 6c65 2020 287a 2920 6f62  variable  (z) ob
-0002b3d0: 6a65 6374 2027 6127 2027 6127 2027 6127  ject 'a' 'a' 'a'
-0002b3e0: 2027 6227 0a20 2020 2020 2020 2020 202a   'b'.          *
-0002b3f0: 2079 2020 2020 2020 2020 2028 7a29 206f   y         (z) o
-0002b400: 626a 6563 7420 2775 2720 2776 2720 2777  bject 'u' 'v' 'w
-0002b410: 2720 6e61 6e0a 2020 2020 2020 2020 4469  ' nan.        Di
-0002b420: 6d65 6e73 696f 6e73 2077 6974 686f 7574  mensions without
-0002b430: 2063 6f6f 7264 696e 6174 6573 3a20 780a   coordinates: x.
-0002b440: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0002b450: 2020 2020 2066 726f 6d20 7861 7272 6179       from xarray
-0002b460: 2e63 6f72 652e 636f 6e63 6174 2069 6d70  .core.concat imp
-0002b470: 6f72 7420 636f 6e63 6174 0a0a 2020 2020  ort concat..    
-0002b480: 2020 2020 7374 6163 6b69 6e67 5f64 696d      stacking_dim
-0002b490: 7320 3d20 7475 706c 6528 6469 6d20 666f  s = tuple(dim fo
-0002b4a0: 7220 6469 6d20 696e 2073 656c 662e 6469  r dim in self.di
-0002b4b0: 6d73 2069 6620 6469 6d20 6e6f 7420 696e  ms if dim not in
-0002b4c0: 2073 616d 706c 655f 6469 6d73 290a 0a20   sample_dims).. 
-0002b4d0: 2020 2020 2020 2066 6f72 2076 6172 6961         for varia
-0002b4e0: 626c 6520 696e 2073 656c 663a 0a20 2020  ble in self:.   
-0002b4f0: 2020 2020 2020 2020 2064 696d 7320 3d20           dims = 
-0002b500: 7365 6c66 5b76 6172 6961 626c 655d 2e64  self[variable].d
-0002b510: 696d 730a 2020 2020 2020 2020 2020 2020  ims.            
-0002b520: 6469 6d73 5f69 6e63 6c75 6465 5f73 616d  dims_include_sam
-0002b530: 706c 655f 6469 6d73 203d 2073 6574 2873  ple_dims = set(s
-0002b540: 616d 706c 655f 6469 6d73 2920 3c3d 2073  ample_dims) <= s
-0002b550: 6574 2864 696d 7329 0a20 2020 2020 2020  et(dims).       
-0002b560: 2020 2020 2069 6620 6e6f 7420 6469 6d73       if not dims
-0002b570: 5f69 6e63 6c75 6465 5f73 616d 706c 655f  _include_sample_
-0002b580: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
-0002b590: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0002b5a0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0002b5b0: 2020 2020 2020 2020 2020 2020 2241 6c6c              "All
-0002b5c0: 2076 6172 6961 626c 6573 2069 6e20 7468   variables in th
-0002b5d0: 6520 6461 7461 7365 7420 6d75 7374 2063  e dataset must c
-0002b5e0: 6f6e 7461 696e 2074 6865 2022 0a20 2020  ontain the ".   
-0002b5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b600: 2022 6469 6d65 6e73 696f 6e73 207b 7d2e   "dimensions {}.
-0002b610: 222e 666f 726d 6174 2864 696d 7329 0a20  ".format(dims). 
-0002b620: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0002b630: 0a0a 2020 2020 2020 2020 6465 6620 656e  ..        def en
-0002b640: 7375 7265 5f73 7461 636b 6162 6c65 2876  sure_stackable(v
-0002b650: 616c 293a 0a20 2020 2020 2020 2020 2020  al):.           
-0002b660: 2061 7373 6967 6e5f 636f 6f72 6473 203d   assign_coords =
-0002b670: 207b 7661 7269 6162 6c65 5f64 696d 3a20   {variable_dim: 
-0002b680: 7661 6c2e 6e61 6d65 7d0a 2020 2020 2020  val.name}.      
-0002b690: 2020 2020 2020 666f 7220 6469 6d20 696e        for dim in
-0002b6a0: 2073 7461 636b 696e 675f 6469 6d73 3a0a   stacking_dims:.
-0002b6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b6c0: 6966 2064 696d 206e 6f74 2069 6e20 7661  if dim not in va
-0002b6d0: 6c2e 6469 6d73 3a0a 2020 2020 2020 2020  l.dims:.        
-0002b6e0: 2020 2020 2020 2020 2020 2020 6173 7369              assi
-0002b6f0: 676e 5f63 6f6f 7264 735b 6469 6d5d 203d  gn_coords[dim] =
-0002b700: 204e 6f6e 650a 0a20 2020 2020 2020 2020   None..         
-0002b710: 2020 2065 7870 616e 645f 6469 6d73 203d     expand_dims =
-0002b720: 2073 6574 2873 7461 636b 696e 675f 6469   set(stacking_di
-0002b730: 6d73 292e 6469 6666 6572 656e 6365 2873  ms).difference(s
-0002b740: 6574 2876 616c 2e64 696d 7329 290a 2020  et(val.dims)).  
-0002b750: 2020 2020 2020 2020 2020 6578 7061 6e64            expand
-0002b760: 5f64 696d 732e 6164 6428 7661 7269 6162  _dims.add(variab
-0002b770: 6c65 5f64 696d 290a 2020 2020 2020 2020  le_dim).        
-0002b780: 2020 2020 2320 6d75 7374 2062 6520 6c69      # must be li
-0002b790: 7374 2066 6f72 202e 6578 7061 6e64 5f64  st for .expand_d
-0002b7a0: 696d 730a 2020 2020 2020 2020 2020 2020  ims.            
-0002b7b0: 6578 7061 6e64 5f64 696d 7320 3d20 6c69  expand_dims = li
-0002b7c0: 7374 2865 7870 616e 645f 6469 6d73 290a  st(expand_dims).
-0002b7d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0002b7e0: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
-0002b7f0: 2020 2020 2020 7661 6c2e 6173 7369 676e        val.assign
-0002b800: 5f63 6f6f 7264 7328 2a2a 6173 7369 676e  _coords(**assign
-0002b810: 5f63 6f6f 7264 7329 0a20 2020 2020 2020  _coords).       
-0002b820: 2020 2020 2020 2020 202e 6578 7061 6e64           .expand
-0002b830: 5f64 696d 7328 6578 7061 6e64 5f64 696d  _dims(expand_dim
-0002b840: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-0002b850: 2020 202e 7374 6163 6b28 7b6e 6577 5f64     .stack({new_d
-0002b860: 696d 3a20 2876 6172 6961 626c 655f 6469  im: (variable_di
-0002b870: 6d2c 2920 2b20 7374 6163 6b69 6e67 5f64  m,) + stacking_d
-0002b880: 696d 737d 290a 2020 2020 2020 2020 2020  ims}).          
-0002b890: 2020 290a 0a20 2020 2020 2020 2023 2063    )..        # c
-0002b8a0: 6f6e 6361 7465 6e61 7465 2074 6865 2061  oncatenate the a
-0002b8b0: 7272 6179 730a 2020 2020 2020 2020 7374  rrays.        st
-0002b8c0: 6163 6b61 626c 655f 7661 7273 203d 205b  ackable_vars = [
-0002b8d0: 656e 7375 7265 5f73 7461 636b 6162 6c65  ensure_stackable
-0002b8e0: 2873 656c 665b 6b65 795d 2920 666f 7220  (self[key]) for 
-0002b8f0: 6b65 7920 696e 2073 656c 662e 6461 7461  key in self.data
-0002b900: 5f76 6172 735d 0a20 2020 2020 2020 2064  _vars].        d
-0002b910: 6174 615f 6172 7261 7920 3d20 636f 6e63  ata_array = conc
-0002b920: 6174 2873 7461 636b 6162 6c65 5f76 6172  at(stackable_var
-0002b930: 732c 2064 696d 3d6e 6577 5f64 696d 290a  s, dim=new_dim).
-0002b940: 0a20 2020 2020 2020 2069 6620 6e61 6d65  .        if name
-0002b950: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0002b960: 2020 2020 2020 2020 2020 6461 7461 5f61            data_a
-0002b970: 7272 6179 2e6e 616d 6520 3d20 6e61 6d65  rray.name = name
-0002b980: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0002b990: 2064 6174 615f 6172 7261 790a 0a20 2020   data_array..   
-0002b9a0: 2064 6566 205f 756e 7374 6163 6b5f 6f6e   def _unstack_on
-0002b9b0: 6365 280a 2020 2020 2020 2020 7365 6c66  ce(.        self
-0002b9c0: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
-0002b9d0: 2020 2020 2064 696d 3a20 4861 7368 6162       dim: Hashab
-0002b9e0: 6c65 2c0a 2020 2020 2020 2020 696e 6465  le,.        inde
-0002b9f0: 785f 616e 645f 7661 7273 3a20 7475 706c  x_and_vars: tupl
-0002ba00: 655b 496e 6465 782c 2064 6963 745b 4861  e[Index, dict[Ha
-0002ba10: 7368 6162 6c65 2c20 5661 7269 6162 6c65  shable, Variable
-0002ba20: 5d5d 2c0a 2020 2020 2020 2020 6669 6c6c  ]],.        fill
-0002ba30: 5f76 616c 7565 2c0a 2020 2020 2020 2020  _value,.        
-0002ba40: 7370 6172 7365 3a20 626f 6f6c 203d 2046  sparse: bool = F
-0002ba50: 616c 7365 2c0a 2020 2020 2920 2d3e 2054  alse,.    ) -> T
-0002ba60: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-0002ba70: 2020 696e 6465 782c 2069 6e64 6578 5f76    index, index_v
-0002ba80: 6172 7320 3d20 696e 6465 785f 616e 645f  ars = index_and_
-0002ba90: 7661 7273 0a20 2020 2020 2020 2076 6172  vars.        var
-0002baa0: 6961 626c 6573 3a20 6469 6374 5b48 6173  iables: dict[Has
-0002bab0: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
-0002bac0: 203d 207b 7d0a 2020 2020 2020 2020 696e   = {}.        in
-0002bad0: 6465 7865 7320 3d20 7b6b 3a20 7620 666f  dexes = {k: v fo
-0002bae0: 7220 6b2c 2076 2069 6e20 7365 6c66 2e5f  r k, v in self._
-0002baf0: 696e 6465 7865 732e 6974 656d 7328 2920  indexes.items() 
-0002bb00: 6966 206b 2021 3d20 6469 6d7d 0a0a 2020  if k != dim}..  
-0002bb10: 2020 2020 2020 6e65 775f 696e 6465 7865        new_indexe
-0002bb20: 732c 2063 6c65 616e 5f69 6e64 6578 203d  s, clean_index =
-0002bb30: 2069 6e64 6578 2e75 6e73 7461 636b 2829   index.unstack()
-0002bb40: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
-0002bb50: 2e75 7064 6174 6528 6e65 775f 696e 6465  .update(new_inde
-0002bb60: 7865 7329 0a0a 2020 2020 2020 2020 666f  xes)..        fo
-0002bb70: 7220 6e61 6d65 2c20 6964 7820 696e 206e  r name, idx in n
-0002bb80: 6577 5f69 6e64 6578 6573 2e69 7465 6d73  ew_indexes.items
-0002bb90: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0002bba0: 7661 7269 6162 6c65 732e 7570 6461 7465  variables.update
-0002bbb0: 2869 6478 2e63 7265 6174 655f 7661 7269  (idx.create_vari
-0002bbc0: 6162 6c65 7328 696e 6465 785f 7661 7273  ables(index_vars
-0002bbd0: 2929 0a0a 2020 2020 2020 2020 666f 7220  ))..        for 
-0002bbe0: 6e61 6d65 2c20 7661 7220 696e 2073 656c  name, var in sel
-0002bbf0: 662e 7661 7269 6162 6c65 732e 6974 656d  f.variables.item
-0002bc00: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0002bc10: 2069 6620 6e61 6d65 206e 6f74 2069 6e20   if name not in 
-0002bc20: 696e 6465 785f 7661 7273 3a0a 2020 2020  index_vars:.    
-0002bc30: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-0002bc40: 696d 2069 6e20 7661 722e 6469 6d73 3a0a  im in var.dims:.
-0002bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bc60: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0002bc70: 6528 6669 6c6c 5f76 616c 7565 2c20 4d61  e(fill_value, Ma
-0002bc80: 7070 696e 6729 3a0a 2020 2020 2020 2020  pping):.        
-0002bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bca0: 6669 6c6c 5f76 616c 7565 5f20 3d20 6669  fill_value_ = fi
-0002bcb0: 6c6c 5f76 616c 7565 5b6e 616d 655d 0a20  ll_value[name]. 
-0002bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bcd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bcf0: 2066 696c 6c5f 7661 6c75 655f 203d 2066   fill_value_ = f
-0002bd00: 696c 6c5f 7661 6c75 650a 0a20 2020 2020  ill_value..     
-0002bd10: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0002bd20: 6172 6961 626c 6573 5b6e 616d 655d 203d  ariables[name] =
-0002bd30: 2076 6172 2e5f 756e 7374 6163 6b5f 6f6e   var._unstack_on
-0002bd40: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
-0002bd50: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-0002bd60: 783d 636c 6561 6e5f 696e 6465 782c 0a20  x=clean_index,. 
-0002bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd80: 2020 2020 2020 2064 696d 3d64 696d 2c0a         dim=dim,.
-0002bd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bda0: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
-0002bdb0: 7565 3d66 696c 6c5f 7661 6c75 655f 2c0a  ue=fill_value_,.
-0002bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bdd0: 2020 2020 2020 2020 7370 6172 7365 3d73          sparse=s
-0002bde0: 7061 7273 652c 0a20 2020 2020 2020 2020  parse,.         
-0002bdf0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0002be00: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0002be10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002be20: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-0002be30: 5b6e 616d 655d 203d 2076 6172 0a0a 2020  [name] = var..  
-0002be40: 2020 2020 2020 636f 6f72 645f 6e61 6d65        coord_name
-0002be50: 7320 3d20 7365 7428 7365 6c66 2e5f 636f  s = set(self._co
-0002be60: 6f72 645f 6e61 6d65 7329 202d 207b 6469  ord_names) - {di
-0002be70: 6d7d 207c 2073 6574 286e 6577 5f69 6e64  m} | set(new_ind
-0002be80: 6578 6573 290a 0a20 2020 2020 2020 2072  exes)..        r
-0002be90: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
-0002bea0: 6163 655f 7769 7468 5f6e 6577 5f64 696d  ace_with_new_dim
-0002beb0: 7328 0a20 2020 2020 2020 2020 2020 2076  s(.            v
-0002bec0: 6172 6961 626c 6573 2c20 636f 6f72 645f  ariables, coord_
-0002bed0: 6e61 6d65 733d 636f 6f72 645f 6e61 6d65  names=coord_name
-0002bee0: 732c 2069 6e64 6578 6573 3d69 6e64 6578  s, indexes=index
-0002bef0: 6573 0a20 2020 2020 2020 2029 0a0a 2020  es.        )..  
-0002bf00: 2020 6465 6620 5f75 6e73 7461 636b 5f66    def _unstack_f
-0002bf10: 756c 6c5f 7265 696e 6465 7828 0a20 2020  ull_reindex(.   
-0002bf20: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-0002bf30: 6173 6574 2c0a 2020 2020 2020 2020 6469  aset,.        di
-0002bf40: 6d3a 2048 6173 6861 626c 652c 0a20 2020  m: Hashable,.   
-0002bf50: 2020 2020 2069 6e64 6578 5f61 6e64 5f76       index_and_v
-0002bf60: 6172 733a 2074 7570 6c65 5b49 6e64 6578  ars: tuple[Index
-0002bf70: 2c20 6469 6374 5b48 6173 6861 626c 652c  , dict[Hashable,
-0002bf80: 2056 6172 6961 626c 655d 5d2c 0a20 2020   Variable]],.   
-0002bf90: 2020 2020 2066 696c 6c5f 7661 6c75 652c       fill_value,
-0002bfa0: 0a20 2020 2020 2020 2073 7061 7273 653a  .        sparse:
-0002bfb0: 2062 6f6f 6c2c 0a20 2020 2029 202d 3e20   bool,.    ) -> 
-0002bfc0: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
-0002bfd0: 2020 2069 6e64 6578 2c20 696e 6465 785f     index, index_
-0002bfe0: 7661 7273 203d 2069 6e64 6578 5f61 6e64  vars = index_and
-0002bff0: 5f76 6172 730a 2020 2020 2020 2020 7661  _vars.        va
-0002c000: 7269 6162 6c65 733a 2064 6963 745b 4861  riables: dict[Ha
-0002c010: 7368 6162 6c65 2c20 5661 7269 6162 6c65  shable, Variable
-0002c020: 5d20 3d20 7b7d 0a20 2020 2020 2020 2069  ] = {}.        i
-0002c030: 6e64 6578 6573 203d 207b 6b3a 2076 2066  ndexes = {k: v f
-0002c040: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
-0002c050: 5f69 6e64 6578 6573 2e69 7465 6d73 2829  _indexes.items()
-0002c060: 2069 6620 6b20 213d 2064 696d 7d0a 0a20   if k != dim}.. 
-0002c070: 2020 2020 2020 206e 6577 5f69 6e64 6578         new_index
-0002c080: 6573 2c20 636c 6561 6e5f 696e 6465 7820  es, clean_index 
-0002c090: 3d20 696e 6465 782e 756e 7374 6163 6b28  = index.unstack(
-0002c0a0: 290a 2020 2020 2020 2020 696e 6465 7865  ).        indexe
-0002c0b0: 732e 7570 6461 7465 286e 6577 5f69 6e64  s.update(new_ind
-0002c0c0: 6578 6573 290a 0a20 2020 2020 2020 206e  exes)..        n
-0002c0d0: 6577 5f69 6e64 6578 5f76 6172 6961 626c  ew_index_variabl
-0002c0e0: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
-0002c0f0: 666f 7220 6e61 6d65 2c20 6964 7820 696e  for name, idx in
-0002c100: 206e 6577 5f69 6e64 6578 6573 2e69 7465   new_indexes.ite
-0002c110: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0002c120: 2020 6e65 775f 696e 6465 785f 7661 7269    new_index_vari
-0002c130: 6162 6c65 732e 7570 6461 7465 2869 6478  ables.update(idx
-0002c140: 2e63 7265 6174 655f 7661 7269 6162 6c65  .create_variable
-0002c150: 7328 696e 6465 785f 7661 7273 2929 0a0a  s(index_vars))..
-0002c160: 2020 2020 2020 2020 6e65 775f 6469 6d5f          new_dim_
-0002c170: 7369 7a65 7320 3d20 7b6b 3a20 762e 7369  sizes = {k: v.si
-0002c180: 7a65 2066 6f72 206b 2c20 7620 696e 206e  ze for k, v in n
-0002c190: 6577 5f69 6e64 6578 5f76 6172 6961 626c  ew_index_variabl
-0002c1a0: 6573 2e69 7465 6d73 2829 7d0a 2020 2020  es.items()}.    
-0002c1b0: 2020 2020 7661 7269 6162 6c65 732e 7570      variables.up
-0002c1c0: 6461 7465 286e 6577 5f69 6e64 6578 5f76  date(new_index_v
-0002c1d0: 6172 6961 626c 6573 290a 0a20 2020 2020  ariables)..     
-0002c1e0: 2020 2023 2074 616b 6520 6120 7368 6f72     # take a shor
-0002c1f0: 7463 7574 2069 6e20 6361 7365 2074 6865  tcut in case the
-0002c200: 204d 756c 7469 496e 6465 7820 7761 7320   MultiIndex was 
-0002c210: 6e6f 7420 6d6f 6469 6669 6564 2e0a 2020  not modified..  
-0002c220: 2020 2020 2020 6675 6c6c 5f69 6478 203d        full_idx =
-0002c230: 2070 642e 4d75 6c74 6949 6e64 6578 2e66   pd.MultiIndex.f
-0002c240: 726f 6d5f 7072 6f64 7563 7428 0a20 2020  rom_product(.   
-0002c250: 2020 2020 2020 2020 2063 6c65 616e 5f69           clean_i
-0002c260: 6e64 6578 2e6c 6576 656c 732c 206e 616d  ndex.levels, nam
-0002c270: 6573 3d63 6c65 616e 5f69 6e64 6578 2e6e  es=clean_index.n
-0002c280: 616d 6573 0a20 2020 2020 2020 2029 0a20  ames.        ). 
-0002c290: 2020 2020 2020 2069 6620 636c 6561 6e5f         if clean_
-0002c2a0: 696e 6465 782e 6571 7561 6c73 2866 756c  index.equals(ful
-0002c2b0: 6c5f 6964 7829 3a0a 2020 2020 2020 2020  l_idx):.        
-0002c2c0: 2020 2020 6f62 6a20 3d20 7365 6c66 0a20      obj = self. 
-0002c2d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0002c2e0: 2020 2020 2020 2020 2023 2054 4f44 4f3a           # TODO:
-0002c2f0: 2077 6520 6d61 7920 6465 7072 6563 6961   we may deprecia
-0002c300: 7465 2069 6d70 6c69 6369 7420 7265 2d69  te implicit re-i
-0002c310: 6e64 6578 696e 6720 7769 7468 2061 2070  ndexing with a p
-0002c320: 616e 6461 732e 4d75 6c74 6949 6e64 6578  andas.MultiIndex
-0002c330: 0a20 2020 2020 2020 2020 2020 2078 725f  .            xr_
-0002c340: 6675 6c6c 5f69 6478 203d 2050 616e 6461  full_idx = Panda
-0002c350: 734d 756c 7469 496e 6465 7828 6675 6c6c  sMultiIndex(full
-0002c360: 5f69 6478 2c20 6469 6d29 0a20 2020 2020  _idx, dim).     
-0002c370: 2020 2020 2020 2069 6e64 6578 6572 7320         indexers 
-0002c380: 3d20 496e 6465 7865 7328 0a20 2020 2020  = Indexes(.     
-0002c390: 2020 2020 2020 2020 2020 207b 6b3a 2078             {k: x
-0002c3a0: 725f 6675 6c6c 5f69 6478 2066 6f72 206b  r_full_idx for k
-0002c3b0: 2069 6e20 696e 6465 785f 7661 7273 7d2c   in index_vars},
-0002c3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c3d0: 2078 725f 6675 6c6c 5f69 6478 2e63 7265   xr_full_idx.cre
-0002c3e0: 6174 655f 7661 7269 6162 6c65 7328 696e  ate_variables(in
-0002c3f0: 6465 785f 7661 7273 292c 0a20 2020 2020  dex_vars),.     
-0002c400: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0002c410: 2020 2020 206f 626a 203d 2073 656c 662e       obj = self.
-0002c420: 5f72 6569 6e64 6578 280a 2020 2020 2020  _reindex(.      
-0002c430: 2020 2020 2020 2020 2020 696e 6465 7865            indexe
-0002c440: 7273 2c20 636f 7079 3d46 616c 7365 2c20  rs, copy=False, 
-0002c450: 6669 6c6c 5f76 616c 7565 3d66 696c 6c5f  fill_value=fill_
-0002c460: 7661 6c75 652c 2073 7061 7273 653d 7370  value, sparse=sp
-0002c470: 6172 7365 0a20 2020 2020 2020 2020 2020  arse.           
-0002c480: 2029 0a0a 2020 2020 2020 2020 666f 7220   )..        for 
-0002c490: 6e61 6d65 2c20 7661 7220 696e 206f 626a  name, var in obj
-0002c4a0: 2e76 6172 6961 626c 6573 2e69 7465 6d73  .variables.items
-0002c4b0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0002c4c0: 6966 206e 616d 6520 6e6f 7420 696e 2069  if name not in i
-0002c4d0: 6e64 6578 5f76 6172 733a 0a20 2020 2020  ndex_vars:.     
-0002c4e0: 2020 2020 2020 2020 2020 2069 6620 6469             if di
-0002c4f0: 6d20 696e 2076 6172 2e64 696d 733a 0a20  m in var.dims:. 
-0002c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c510: 2020 2076 6172 6961 626c 6573 5b6e 616d     variables[nam
-0002c520: 655d 203d 2076 6172 2e75 6e73 7461 636b  e] = var.unstack
-0002c530: 287b 6469 6d3a 206e 6577 5f64 696d 5f73  ({dim: new_dim_s
-0002c540: 697a 6573 7d29 0a20 2020 2020 2020 2020  izes}).         
-0002c550: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0002c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c570: 2076 6172 6961 626c 6573 5b6e 616d 655d   variables[name]
-0002c580: 203d 2076 6172 0a0a 2020 2020 2020 2020   = var..        
-0002c590: 636f 6f72 645f 6e61 6d65 7320 3d20 7365  coord_names = se
-0002c5a0: 7428 7365 6c66 2e5f 636f 6f72 645f 6e61  t(self._coord_na
-0002c5b0: 6d65 7329 202d 207b 6469 6d7d 207c 2073  mes) - {dim} | s
-0002c5c0: 6574 286e 6577 5f64 696d 5f73 697a 6573  et(new_dim_sizes
-0002c5d0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0002c5e0: 6e20 7365 6c66 2e5f 7265 706c 6163 655f  n self._replace_
-0002c5f0: 7769 7468 5f6e 6577 5f64 696d 7328 0a20  with_new_dims(. 
-0002c600: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-0002c610: 626c 6573 2c20 636f 6f72 645f 6e61 6d65  bles, coord_name
-0002c620: 733d 636f 6f72 645f 6e61 6d65 732c 2069  s=coord_names, i
-0002c630: 6e64 6578 6573 3d69 6e64 6578 6573 0a20  ndexes=indexes. 
-0002c640: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0002c650: 6620 756e 7374 6163 6b28 0a20 2020 2020  f unstack(.     
-0002c660: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-0002c670: 6574 2c0a 2020 2020 2020 2020 6469 6d3a  et,.        dim:
-0002c680: 2044 696d 7320 3d20 4e6f 6e65 2c0a 2020   Dims = None,.  
-0002c690: 2020 2020 2020 6669 6c6c 5f76 616c 7565        fill_value
-0002c6a0: 3a20 416e 7920 3d20 7872 6474 7970 6573  : Any = xrdtypes
-0002c6b0: 2e4e 412c 0a20 2020 2020 2020 2073 7061  .NA,.        spa
-0002c6c0: 7273 653a 2062 6f6f 6c20 3d20 4661 6c73  rse: bool = Fals
-0002c6d0: 652c 0a20 2020 2029 202d 3e20 545f 4461  e,.    ) -> T_Da
-0002c6e0: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
-0002c6f0: 2222 0a20 2020 2020 2020 2055 6e73 7461  "".        Unsta
-0002c700: 636b 2065 7869 7374 696e 6720 6469 6d65  ck existing dime
-0002c710: 6e73 696f 6e73 2063 6f72 7265 7370 6f6e  nsions correspon
-0002c720: 6469 6e67 2074 6f20 4d75 6c74 6949 6e64  ding to MultiInd
-0002c730: 6578 6573 2069 6e74 6f0a 2020 2020 2020  exes into.      
-0002c740: 2020 6d75 6c74 6970 6c65 206e 6577 2064    multiple new d
-0002c750: 696d 656e 7369 6f6e 732e 0a0a 2020 2020  imensions...    
-0002c760: 2020 2020 4e65 7720 6469 6d65 6e73 696f      New dimensio
-0002c770: 6e73 2077 696c 6c20 6265 2061 6464 6564  ns will be added
-0002c780: 2061 7420 7468 6520 656e 642e 0a0a 2020   at the end...  
-0002c790: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0002c7a0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0002c7b0: 2d2d 2d0a 2020 2020 2020 2020 6469 6d20  ---.        dim 
-0002c7c0: 3a20 7374 722c 2049 7465 7261 626c 6520  : str, Iterable 
-0002c7d0: 6f66 2048 6173 6861 626c 6520 6f72 204e  of Hashable or N
-0002c7e0: 6f6e 652c 206f 7074 696f 6e61 6c0a 2020  one, optional.  
-0002c7f0: 2020 2020 2020 2020 2020 4469 6d65 6e73            Dimens
-0002c800: 696f 6e28 7329 206f 7665 7220 7768 6963  ion(s) over whic
-0002c810: 6820 746f 2075 6e73 7461 636b 2e20 4279  h to unstack. By
-0002c820: 2064 6566 6175 6c74 2075 6e73 7461 636b   default unstack
-0002c830: 7320 616c 6c0a 2020 2020 2020 2020 2020  s all.          
-0002c840: 2020 4d75 6c74 6949 6e64 6578 6573 2e0a    MultiIndexes..
-0002c850: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
-0002c860: 7565 203a 2073 6361 6c61 7220 6f72 2064  ue : scalar or d
-0002c870: 6963 742d 6c69 6b65 2c20 6465 6661 756c  ict-like, defaul
-0002c880: 743a 206e 616e 0a20 2020 2020 2020 2020  t: nan.         
-0002c890: 2020 2076 616c 7565 2074 6f20 6265 2066     value to be f
-0002c8a0: 696c 6c65 642e 2049 6620 6120 6469 6374  illed. If a dict
-0002c8b0: 2d6c 696b 652c 206d 6170 7320 7661 7269  -like, maps vari
-0002c8c0: 6162 6c65 206e 616d 6573 2074 6f0a 2020  able names to.  
-0002c8d0: 2020 2020 2020 2020 2020 6669 6c6c 2076            fill v
-0002c8e0: 616c 7565 732e 2049 6620 6e6f 7420 7072  alues. If not pr
-0002c8f0: 6f76 6964 6564 206f 7220 6966 2074 6865  ovided or if the
-0002c900: 2064 6963 742d 6c69 6b65 2064 6f65 7320   dict-like does 
-0002c910: 6e6f 740a 2020 2020 2020 2020 2020 2020  not.            
-0002c920: 636f 6e74 6169 6e20 616c 6c20 7661 7269  contain all vari
-0002c930: 6162 6c65 732c 2074 6865 2064 7479 7065  ables, the dtype
-0002c940: 2773 204e 4120 7661 6c75 6520 7769 6c6c  's NA value will
-0002c950: 2062 6520 7573 6564 2e0a 2020 2020 2020   be used..      
-0002c960: 2020 7370 6172 7365 203a 2062 6f6f 6c2c    sparse : bool,
-0002c970: 2064 6566 6175 6c74 3a20 4661 6c73 650a   default: False.
-0002c980: 2020 2020 2020 2020 2020 2020 7573 6520              use 
-0002c990: 7370 6172 7365 2d61 7272 6179 2069 6620  sparse-array if 
-0002c9a0: 5472 7565 0a0a 2020 2020 2020 2020 5265  True..        Re
-0002c9b0: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-0002c9c0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 756e  -----.        un
-0002c9d0: 7374 6163 6b65 6420 3a20 4461 7461 7365  stacked : Datase
-0002c9e0: 740a 2020 2020 2020 2020 2020 2020 4461  t.            Da
-0002c9f0: 7461 7365 7420 7769 7468 2075 6e73 7461  taset with unsta
-0002ca00: 636b 6564 2064 6174 612e 0a0a 2020 2020  cked data...    
-0002ca10: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-0002ca20: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-0002ca30: 2020 2020 2020 4461 7461 7365 742e 7374        Dataset.st
-0002ca40: 6163 6b0a 2020 2020 2020 2020 2222 220a  ack.        """.
-0002ca50: 0a20 2020 2020 2020 2069 6620 6469 6d20  .        if dim 
-0002ca60: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0002ca70: 2020 2020 2064 696d 7320 3d20 6c69 7374       dims = list
-0002ca80: 2873 656c 662e 6469 6d73 290a 2020 2020  (self.dims).    
-0002ca90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002caa0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0002cab0: 6e63 6528 6469 6d2c 2073 7472 2920 6f72  nce(dim, str) or
-0002cac0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-0002cad0: 6469 6d2c 2049 7465 7261 626c 6529 3a0a  dim, Iterable):.
-0002cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002caf0: 6469 6d73 203d 205b 6469 6d5d 0a20 2020  dims = [dim].   
-0002cb00: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0002cb10: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0002cb20: 696d 7320 3d20 6c69 7374 2864 696d 290a  ims = list(dim).
-0002cb30: 0a20 2020 2020 2020 2020 2020 206d 6973  .            mis
-0002cb40: 7369 6e67 5f64 696d 7320 3d20 5b64 2066  sing_dims = [d f
-0002cb50: 6f72 2064 2069 6e20 6469 6d73 2069 6620  or d in dims if 
-0002cb60: 6420 6e6f 7420 696e 2073 656c 662e 6469  d not in self.di
-0002cb70: 6d73 5d0a 2020 2020 2020 2020 2020 2020  ms].            
-0002cb80: 6966 206d 6973 7369 6e67 5f64 696d 733a  if missing_dims:
-0002cb90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002cba0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0002cbb0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0002cbc0: 2020 2020 2020 2066 2244 6174 6173 6574         f"Dataset
-0002cbd0: 2064 6f65 7320 6e6f 7420 636f 6e74 6169   does not contai
-0002cbe0: 6e20 7468 6520 6469 6d65 6e73 696f 6e73  n the dimensions
-0002cbf0: 3a20 7b6d 6973 7369 6e67 5f64 696d 737d  : {missing_dims}
-0002cc00: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002cc10: 2020 290a 0a20 2020 2020 2020 2023 2065    )..        # e
-0002cc20: 6163 6820 7370 6563 6966 6965 6420 6469  ach specified di
-0002cc30: 6d65 6e73 696f 6e20 6d75 7374 2068 6176  mension must hav
-0002cc40: 6520 6578 6163 746c 7920 6f6e 6520 6d75  e exactly one mu
-0002cc50: 6c74 692d 696e 6465 780a 2020 2020 2020  lti-index.      
-0002cc60: 2020 7374 6163 6b65 645f 696e 6465 7865    stacked_indexe
-0002cc70: 733a 2064 6963 745b 416e 792c 2074 7570  s: dict[Any, tup
-0002cc80: 6c65 5b49 6e64 6578 2c20 6469 6374 5b48  le[Index, dict[H
-0002cc90: 6173 6861 626c 652c 2056 6172 6961 626c  ashable, Variabl
-0002cca0: 655d 5d5d 203d 207b 7d0a 2020 2020 2020  e]]] = {}.      
-0002ccb0: 2020 666f 7220 6420 696e 2064 696d 733a    for d in dims:
-0002ccc0: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
-0002ccd0: 2c20 6964 785f 7661 7273 203d 2073 656c  , idx_vars = sel
-0002cce0: 662e 5f67 6574 5f73 7461 636b 5f69 6e64  f._get_stack_ind
-0002ccf0: 6578 2864 2c20 6d75 6c74 693d 5472 7565  ex(d, multi=True
-0002cd00: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0002cd10: 2069 6478 2069 7320 6e6f 7420 4e6f 6e65   idx is not None
-0002cd20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002cd30: 2020 7374 6163 6b65 645f 696e 6465 7865    stacked_indexe
-0002cd40: 735b 645d 203d 2069 6478 2c20 6964 785f  s[d] = idx, idx_
-0002cd50: 7661 7273 0a0a 2020 2020 2020 2020 6966  vars..        if
-0002cd60: 2064 696d 2069 7320 4e6f 6e65 3a0a 2020   dim is None:.  
-0002cd70: 2020 2020 2020 2020 2020 6469 6d73 203d            dims =
-0002cd80: 206c 6973 7428 7374 6163 6b65 645f 696e   list(stacked_in
-0002cd90: 6465 7865 7329 0a20 2020 2020 2020 2065  dexes).        e
-0002cda0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0002cdb0: 206e 6f6e 5f6d 756c 7469 5f64 696d 7320   non_multi_dims 
-0002cdc0: 3d20 7365 7428 6469 6d73 2920 2d20 7365  = set(dims) - se
-0002cdd0: 7428 7374 6163 6b65 645f 696e 6465 7865  t(stacked_indexe
-0002cde0: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
-0002cdf0: 6620 6e6f 6e5f 6d75 6c74 695f 6469 6d73  f non_multi_dims
-0002ce00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002ce10: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0002ce20: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0002ce30: 2020 2020 2020 2020 2263 616e 6e6f 7420          "cannot 
-0002ce40: 756e 7374 6163 6b20 6469 6d65 6e73 696f  unstack dimensio
-0002ce50: 6e73 2074 6861 7420 646f 206e 6f74 2022  ns that do not "
-0002ce60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ce70: 2020 2020 2066 2268 6176 6520 6578 6163       f"have exac
-0002ce80: 746c 7920 6f6e 6520 6d75 6c74 692d 696e  tly one multi-in
-0002ce90: 6465 783a 207b 7475 706c 6528 6e6f 6e5f  dex: {tuple(non_
-0002cea0: 6d75 6c74 695f 6469 6d73 297d 220a 2020  multi_dims)}".  
-0002ceb0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0002cec0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-0002ced0: 3d20 7365 6c66 2e63 6f70 7928 6465 6570  = self.copy(deep
-0002cee0: 3d46 616c 7365 290a 0a20 2020 2020 2020  =False)..       
-0002cef0: 2023 2077 6520 7761 6e74 2074 6f20 6176   # we want to av
-0002cf00: 6f69 6420 616c 6c6f 6361 7469 6e67 2061  oid allocating a
-0002cf10: 6e20 6f62 6a65 6374 2d64 7479 7065 206e  n object-dtype n
-0002cf20: 6461 7272 6179 2066 6f72 2061 204d 756c  darray for a Mul
-0002cf30: 7469 496e 6465 782c 0a20 2020 2020 2020  tiIndex,.       
-0002cf40: 2023 2073 6f20 7765 2063 616e 2774 206a   # so we can't j
-0002cf50: 7573 7420 6163 6365 7373 2073 656c 662e  ust access self.
-0002cf60: 7661 7269 6162 6c65 735b 765d 2e64 6174  variables[v].dat
-0002cf70: 6120 666f 7220 6576 6572 7920 7661 7269  a for every vari
-0002cf80: 6162 6c65 2e0a 2020 2020 2020 2020 2320  able..        # 
-0002cf90: 5765 206f 6e6c 7920 6368 6563 6b20 7468  We only check th
-0002cfa0: 6520 6e6f 6e2d 696e 6465 7820 7661 7269  e non-index vari
-0002cfb0: 6162 6c65 732e 0a20 2020 2020 2020 2023  ables..        #
-0002cfc0: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-0002cfd0: 636f 6d2f 7079 6461 7461 2f78 6172 7261  com/pydata/xarra
-0002cfe0: 792f 6973 7375 6573 2f35 3930 320a 2020  y/issues/5902.  
-0002cff0: 2020 2020 2020 6e6f 6e69 6e64 6578 6573        nonindexes
-0002d000: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-0002d010: 2073 656c 662e 7661 7269 6162 6c65 735b   self.variables[
-0002d020: 6b5d 2066 6f72 206b 2069 6e20 7365 7428  k] for k in set(
-0002d030: 7365 6c66 2e76 6172 6961 626c 6573 2920  self.variables) 
-0002d040: 2d20 7365 7428 7365 6c66 2e5f 696e 6465  - set(self._inde
-0002d050: 7865 7329 0a20 2020 2020 2020 205d 0a20  xes).        ]. 
-0002d060: 2020 2020 2020 2023 204e 6f74 6573 2066         # Notes f
-0002d070: 6f72 2065 6163 6820 6f66 2074 6865 7365  or each of these
-0002d080: 2063 6173 6573 3a0a 2020 2020 2020 2020   cases:.        
-0002d090: 2320 312e 2044 6173 6b20 6172 7261 7973  # 1. Dask arrays
-0002d0a0: 2064 6f6e 2774 2073 7570 706f 7274 2061   don't support a
-0002d0b0: 7373 6967 6e6d 656e 7420 6279 2069 6e64  ssignment by ind
-0002d0c0: 6578 2c20 7768 6963 6820 7468 6520 6661  ex, which the fa
-0002d0d0: 7374 2075 6e73 7461 636b 0a20 2020 2020  st unstack.     
-0002d0e0: 2020 2023 2020 2020 6675 6e63 7469 6f6e     #    function
-0002d0f0: 2072 6571 7569 7265 732e 0a20 2020 2020   requires..     
-0002d100: 2020 2023 2020 2020 6874 7470 733a 2f2f     #    https://
-0002d110: 6769 7468 7562 2e63 6f6d 2f70 7964 6174  github.com/pydat
-0002d120: 612f 7861 7272 6179 2f70 756c 6c2f 3437  a/xarray/pull/47
-0002d130: 3436 2369 7373 7565 636f 6d6d 656e 742d  46#issuecomment-
-0002d140: 3735 3332 3832 3132 350a 2020 2020 2020  753282125.      
-0002d150: 2020 2320 322e 2053 7061 7273 6520 646f    # 2. Sparse do
-0002d160: 6573 6e27 7420 6375 7272 656e 746c 7920  esn't currently 
-0002d170: 7375 7070 6f72 7420 2874 686f 7567 6820  support (though 
-0002d180: 7765 2063 6f75 6c64 2073 7065 6369 616c  we could special
-0002d190: 2d63 6173 6520 6974 290a 2020 2020 2020  -case it).      
-0002d1a0: 2020 2320 2020 2068 7474 7073 3a2f 2f67    #    https://g
-0002d1b0: 6974 6875 622e 636f 6d2f 7079 6461 7461  ithub.com/pydata
-0002d1c0: 2f73 7061 7273 652f 6973 7375 6573 2f34  /sparse/issues/4
-0002d1d0: 3232 0a20 2020 2020 2020 2023 2033 2e20  22.        # 3. 
-0002d1e0: 7069 6e74 2072 6571 7569 7265 7320 6368  pint requires ch
-0002d1f0: 6563 6b69 6e67 2069 6620 6974 2773 2061  ecking if it's a
-0002d200: 204e 756d 5079 2061 7272 6179 2075 6e74   NumPy array unt
-0002d210: 696c 0a20 2020 2020 2020 2023 2020 2020  il.        #    
-0002d220: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-0002d230: 6f6d 2f70 7964 6174 612f 7861 7272 6179  om/pydata/xarray
-0002d240: 2f70 756c 6c2f 3437 3531 2069 7320 7265  /pull/4751 is re
-0002d250: 736f 6c76 6564 2c0a 2020 2020 2020 2020  solved,.        
-0002d260: 2320 2020 204f 6e63 6520 7468 6174 2069  #    Once that i
-0002d270: 7320 7265 736f 6c76 6564 2c20 6578 706c  s resolved, expl
-0002d280: 6963 6974 6c79 2065 7863 6c75 6465 2070  icitly exclude p
-0002d290: 696e 7420 6172 7261 7973 2e0a 2020 2020  int arrays..    
-0002d2a0: 2020 2020 2320 2020 2070 696e 7420 646f      #    pint do
-0002d2b0: 6573 6e27 7420 696d 706c 656d 656e 7420  esn't implement 
-0002d2c0: 606e 702e 6675 6c6c 5f6c 696b 6560 2069  `np.full_like` i
-0002d2d0: 6e20 6120 7761 7920 7468 6174 2773 0a20  n a way that's. 
-0002d2e0: 2020 2020 2020 2023 2020 2020 6375 7272         #    curr
-0002d2f0: 656e 746c 7920 636f 6d70 6174 6962 6c65  ently compatible
-0002d300: 2e0a 2020 2020 2020 2020 7370 6172 7365  ..        sparse
-0002d310: 5f61 7272 6179 5f74 7970 6520 3d20 6172  _array_type = ar
-0002d320: 7261 795f 7479 7065 2822 7370 6172 7365  ray_type("sparse
-0002d330: 2229 0a20 2020 2020 2020 206e 6565 6473  ").        needs
-0002d340: 5f66 756c 6c5f 7265 696e 6465 7820 3d20  _full_reindex = 
-0002d350: 616e 7928 0a20 2020 2020 2020 2020 2020  any(.           
-0002d360: 2069 735f 6475 636b 5f64 6173 6b5f 6172   is_duck_dask_ar
-0002d370: 7261 7928 762e 6461 7461 290a 2020 2020  ray(v.data).    
-0002d380: 2020 2020 2020 2020 6f72 2069 7369 6e73          or isins
-0002d390: 7461 6e63 6528 762e 6461 7461 2c20 7370  tance(v.data, sp
-0002d3a0: 6172 7365 5f61 7272 6179 5f74 7970 6529  arse_array_type)
-0002d3b0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
-0002d3c0: 6e6f 7420 6973 696e 7374 616e 6365 2876  not isinstance(v
-0002d3d0: 2e64 6174 612c 206e 702e 6e64 6172 7261  .data, np.ndarra
-0002d3e0: 7929 0a20 2020 2020 2020 2020 2020 2066  y).            f
-0002d3f0: 6f72 2076 2069 6e20 6e6f 6e69 6e64 6578  or v in nonindex
-0002d400: 6573 0a20 2020 2020 2020 2029 0a0a 2020  es.        )..  
-0002d410: 2020 2020 2020 666f 7220 6420 696e 2064        for d in d
-0002d420: 696d 733a 0a20 2020 2020 2020 2020 2020  ims:.           
-0002d430: 2069 6620 6e65 6564 735f 6675 6c6c 5f72   if needs_full_r
-0002d440: 6569 6e64 6578 3a0a 2020 2020 2020 2020  eindex:.        
-0002d450: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0002d460: 2072 6573 756c 742e 5f75 6e73 7461 636b   result._unstack
-0002d470: 5f66 756c 6c5f 7265 696e 6465 7828 0a20  _full_reindex(. 
-0002d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d490: 2020 2064 2c20 7374 6163 6b65 645f 696e     d, stacked_in
-0002d4a0: 6465 7865 735b 645d 2c20 6669 6c6c 5f76  dexes[d], fill_v
-0002d4b0: 616c 7565 2c20 7370 6172 7365 0a20 2020  alue, sparse.   
-0002d4c0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0002d4d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0002d4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d4f0: 2072 6573 756c 7420 3d20 7265 7375 6c74   result = result
-0002d500: 2e5f 756e 7374 6163 6b5f 6f6e 6365 2864  ._unstack_once(d
-0002d510: 2c20 7374 6163 6b65 645f 696e 6465 7865  , stacked_indexe
-0002d520: 735b 645d 2c20 6669 6c6c 5f76 616c 7565  s[d], fill_value
-0002d530: 2c20 7370 6172 7365 290a 2020 2020 2020  , sparse).      
-0002d540: 2020 7265 7475 726e 2072 6573 756c 740a    return result.
-0002d550: 0a20 2020 2064 6566 2075 7064 6174 6528  .    def update(
-0002d560: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-0002d570: 206f 7468 6572 3a20 436f 6572 6369 626c   other: Coercibl
-0002d580: 654d 6170 7069 6e67 2920 2d3e 2054 5f44  eMapping) -> T_D
-0002d590: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-0002d5a0: 2222 2255 7064 6174 6520 7468 6973 2064  """Update this d
-0002d5b0: 6174 6173 6574 2773 2076 6172 6961 626c  ataset's variabl
-0002d5c0: 6573 2077 6974 6820 7468 6f73 6520 6672  es with those fr
-0002d5d0: 6f6d 2061 6e6f 7468 6572 2064 6174 6173  om another datas
-0002d5e0: 6574 2e0a 0a20 2020 2020 2020 204a 7573  et...        Jus
-0002d5f0: 7420 6c69 6b65 203a 7079 3a6d 6574 683a  t like :py:meth:
-0002d600: 6064 6963 742e 7570 6461 7465 6020 7468  `dict.update` th
-0002d610: 6973 2069 7320 6120 696e 2d70 6c61 6365  is is a in-place
-0002d620: 206f 7065 7261 7469 6f6e 2e0a 2020 2020   operation..    
-0002d630: 2020 2020 466f 7220 6120 6e6f 6e2d 696e      For a non-in
-0002d640: 706c 6163 6520 7665 7273 696f 6e2c 2073  place version, s
-0002d650: 6565 203a 7079 3a6d 6574 683a 6044 6174  ee :py:meth:`Dat
-0002d660: 6173 6574 2e6d 6572 6765 602e 0a0a 2020  aset.merge`...  
-0002d670: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0002d680: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0002d690: 2d2d 2d0a 2020 2020 2020 2020 6f74 6865  ---.        othe
-0002d6a0: 7220 3a20 4461 7461 7365 7420 6f72 206d  r : Dataset or m
-0002d6b0: 6170 7069 6e67 0a20 2020 2020 2020 2020  apping.         
-0002d6c0: 2020 2056 6172 6961 626c 6573 2077 6974     Variables wit
-0002d6d0: 6820 7768 6963 6820 746f 2075 7064 6174  h which to updat
-0002d6e0: 6520 7468 6973 2064 6174 6173 6574 2e20  e this dataset. 
-0002d6f0: 4f6e 6520 6f66 3a0a 0a20 2020 2020 2020  One of:..       
-0002d700: 2020 2020 202d 2044 6174 6173 6574 0a20       - Dataset. 
-0002d710: 2020 2020 2020 2020 2020 202d 206d 6170             - map
-0002d720: 7069 6e67 207b 7661 7220 6e61 6d65 3a20  ping {var name: 
-0002d730: 4461 7461 4172 7261 797d 0a20 2020 2020  DataArray}.     
-0002d740: 2020 2020 2020 202d 206d 6170 7069 6e67         - mapping
-0002d750: 207b 7661 7220 6e61 6d65 3a20 5661 7269   {var name: Vari
-0002d760: 6162 6c65 7d0a 2020 2020 2020 2020 2020  able}.          
-0002d770: 2020 2d20 6d61 7070 696e 6720 7b76 6172    - mapping {var
-0002d780: 206e 616d 653a 2028 6469 6d65 6e73 696f   name: (dimensio
-0002d790: 6e20 6e61 6d65 2c20 6172 7261 792d 6c69  n name, array-li
-0002d7a0: 6b65 297d 0a20 2020 2020 2020 2020 2020  ke)}.           
-0002d7b0: 202d 206d 6170 7069 6e67 207b 7661 7220   - mapping {var 
-0002d7c0: 6e61 6d65 3a20 2874 7570 6c65 206f 6620  name: (tuple of 
-0002d7d0: 6469 6d65 6e73 696f 6e20 6e61 6d65 732c  dimension names,
-0002d7e0: 2061 7272 6179 2d6c 696b 6529 7d0a 0a20   array-like)}.. 
-0002d7f0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-0002d800: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-0002d810: 2020 2020 2020 2075 7064 6174 6564 203a         updated :
-0002d820: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
-0002d830: 2020 2020 2055 7064 6174 6564 2064 6174       Updated dat
-0002d840: 6173 6574 2e20 4e6f 7465 2074 6861 7420  aset. Note that 
-0002d850: 7369 6e63 6520 7468 6520 7570 6461 7465  since the update
-0002d860: 2069 7320 696e 2d70 6c61 6365 2074 6869   is in-place thi
-0002d870: 7320 6973 2074 6865 2069 6e70 7574 0a20  s is the input. 
-0002d880: 2020 2020 2020 2020 2020 2064 6174 6173             datas
-0002d890: 6574 2e0a 0a20 2020 2020 2020 2020 2020  et...           
-0002d8a0: 2049 7420 6973 2064 6570 7265 6361 7465   It is deprecate
-0002d8b0: 6420 7369 6e63 6520 7665 7273 696f 6e20  d since version 
-0002d8c0: 302e 3137 2061 6e64 2073 6368 6564 756c  0.17 and schedul
-0002d8d0: 6564 2074 6f20 6265 2072 656d 6f76 6564  ed to be removed
-0002d8e0: 2069 6e20 302e 3231 2e0a 0a20 2020 2020   in 0.21...     
-0002d8f0: 2020 2052 6169 7365 730a 2020 2020 2020     Raises.      
-0002d900: 2020 2d2d 2d2d 2d2d 0a20 2020 2020 2020    ------.       
-0002d910: 2056 616c 7565 4572 726f 720a 2020 2020   ValueError.    
-0002d920: 2020 2020 2020 2020 4966 2061 6e79 2064          If any d
-0002d930: 696d 656e 7369 6f6e 7320 776f 756c 6420  imensions would 
-0002d940: 6861 7665 2069 6e63 6f6e 7369 7374 656e  have inconsisten
-0002d950: 7420 7369 7a65 7320 696e 2074 6865 2075  t sizes in the u
-0002d960: 7064 6174 6564 0a20 2020 2020 2020 2020  pdated.         
-0002d970: 2020 2064 6174 6173 6574 2e0a 0a20 2020     dataset...   
-0002d980: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
-0002d990: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-0002d9a0: 2020 2020 2020 2044 6174 6173 6574 2e61         Dataset.a
-0002d9b0: 7373 6967 6e0a 2020 2020 2020 2020 4461  ssign.        Da
-0002d9c0: 7461 7365 742e 6d65 7267 650a 2020 2020  taset.merge.    
-0002d9d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0002d9e0: 6d65 7267 655f 7265 7375 6c74 203d 2064  merge_result = d
-0002d9f0: 6174 6173 6574 5f75 7064 6174 655f 6d65  ataset_update_me
-0002da00: 7468 6f64 2873 656c 662c 206f 7468 6572  thod(self, other
-0002da10: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0002da20: 2073 656c 662e 5f72 6570 6c61 6365 2869   self._replace(i
-0002da30: 6e70 6c61 6365 3d54 7275 652c 202a 2a6d  nplace=True, **m
-0002da40: 6572 6765 5f72 6573 756c 742e 5f61 7364  erge_result._asd
-0002da50: 6963 7428 2929 0a0a 2020 2020 6465 6620  ict())..    def 
-0002da60: 6d65 7267 6528 0a20 2020 2020 2020 2073  merge(.        s
-0002da70: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
-0002da80: 2020 2020 2020 2020 6f74 6865 723a 2043          other: C
-0002da90: 6f65 7263 6962 6c65 4d61 7070 696e 6720  oercibleMapping 
-0002daa0: 7c20 4461 7461 4172 7261 792c 0a20 2020  | DataArray,.   
-0002dab0: 2020 2020 206f 7665 7277 7269 7465 5f76       overwrite_v
-0002dac0: 6172 733a 2048 6173 6861 626c 6520 7c20  ars: Hashable | 
-0002dad0: 4974 6572 6162 6c65 5b48 6173 6861 626c  Iterable[Hashabl
-0002dae0: 655d 203d 2066 726f 7a65 6e73 6574 2829  e] = frozenset()
-0002daf0: 2c0a 2020 2020 2020 2020 636f 6d70 6174  ,.        compat
-0002db00: 3a20 436f 6d70 6174 4f70 7469 6f6e 7320  : CompatOptions 
-0002db10: 3d20 226e 6f5f 636f 6e66 6c69 6374 7322  = "no_conflicts"
-0002db20: 2c0a 2020 2020 2020 2020 6a6f 696e 3a20  ,.        join: 
-0002db30: 4a6f 696e 4f70 7469 6f6e 7320 3d20 226f  JoinOptions = "o
-0002db40: 7574 6572 222c 0a20 2020 2020 2020 2066  uter",.        f
-0002db50: 696c 6c5f 7661 6c75 653a 2041 6e79 203d  ill_value: Any =
-0002db60: 2078 7264 7479 7065 732e 4e41 2c0a 2020   xrdtypes.NA,.  
-0002db70: 2020 2020 2020 636f 6d62 696e 655f 6174        combine_at
-0002db80: 7472 733a 2043 6f6d 6269 6e65 4174 7472  trs: CombineAttr
-0002db90: 734f 7074 696f 6e73 203d 2022 6f76 6572  sOptions = "over
-0002dba0: 7269 6465 222c 0a20 2020 2029 202d 3e20  ride",.    ) -> 
-0002dbb0: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
-0002dbc0: 2020 2022 2222 4d65 7267 6520 7468 6520     """Merge the 
-0002dbd0: 6172 7261 7973 206f 6620 7477 6f20 6461  arrays of two da
-0002dbe0: 7461 7365 7473 2069 6e74 6f20 6120 7369  tasets into a si
-0002dbf0: 6e67 6c65 2064 6174 6173 6574 2e0a 0a20  ngle dataset... 
-0002dc00: 2020 2020 2020 2054 6869 7320 6d65 7468         This meth
-0002dc10: 6f64 2067 656e 6572 616c 6c79 2064 6f65  od generally doe
-0002dc20: 7320 6e6f 7420 616c 6c6f 7720 666f 7220  s not allow for 
-0002dc30: 6f76 6572 7269 6469 6e67 2064 6174 612c  overriding data,
-0002dc40: 2077 6974 6820 7468 650a 2020 2020 2020   with the.      
-0002dc50: 2020 6578 6365 7074 696f 6e20 6f66 2061    exception of a
-0002dc60: 7474 7269 6275 7465 732c 2077 6869 6368  ttributes, which
-0002dc70: 2061 7265 2069 676e 6f72 6564 206f 6e20   are ignored on 
-0002dc80: 7468 6520 7365 636f 6e64 2064 6174 6173  the second datas
-0002dc90: 6574 2e0a 2020 2020 2020 2020 5661 7269  et..        Vari
-0002dca0: 6162 6c65 7320 7769 7468 2074 6865 2073  ables with the s
-0002dcb0: 616d 6520 6e61 6d65 2061 7265 2063 6865  ame name are che
-0002dcc0: 636b 6564 2066 6f72 2063 6f6e 666c 6963  cked for conflic
-0002dcd0: 7473 2076 6961 2074 6865 2065 7175 616c  ts via the equal
-0002dce0: 730a 2020 2020 2020 2020 6f72 2069 6465  s.        or ide
-0002dcf0: 6e74 6963 616c 206d 6574 686f 6473 2e0a  ntical methods..
-0002dd00: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0002dd10: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-0002dd20: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 206f  ------.        o
-0002dd30: 7468 6572 203a 2044 6174 6173 6574 206f  ther : Dataset o
-0002dd40: 7220 6d61 7070 696e 670a 2020 2020 2020  r mapping.      
-0002dd50: 2020 2020 2020 4461 7461 7365 7420 6f72        Dataset or
-0002dd60: 2076 6172 6961 626c 6573 2074 6f20 6d65   variables to me
-0002dd70: 7267 6520 7769 7468 2074 6869 7320 6461  rge with this da
-0002dd80: 7461 7365 742e 0a20 2020 2020 2020 206f  taset..        o
-0002dd90: 7665 7277 7269 7465 5f76 6172 7320 3a20  verwrite_vars : 
-0002dda0: 6861 7368 6162 6c65 206f 7220 6974 6572  hashable or iter
-0002ddb0: 6162 6c65 206f 6620 6861 7368 6162 6c65  able of hashable
-0002ddc0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0002ddd0: 2020 2020 2020 2049 6620 7072 6f76 6964         If provid
-0002dde0: 6564 2c20 7570 6461 7465 2076 6172 6961  ed, update varia
-0002ddf0: 626c 6573 206f 6620 7468 6573 6520 6e61  bles of these na
-0002de00: 6d65 2873 2920 7769 7468 6f75 7420 6368  me(s) without ch
-0002de10: 6563 6b69 6e67 2066 6f72 0a20 2020 2020  ecking for.     
-0002de20: 2020 2020 2020 2063 6f6e 666c 6963 7473         conflicts
-0002de30: 2069 6e20 7468 6973 2064 6174 6173 6574   in this dataset
-0002de40: 2e0a 2020 2020 2020 2020 636f 6d70 6174  ..        compat
-0002de50: 203a 207b 2269 6465 6e74 6963 616c 222c   : {"identical",
-0002de60: 2022 6571 7561 6c73 222c 2022 6272 6f61   "equals", "broa
-0002de70: 6463 6173 745f 6571 7561 6c73 222c 205c  dcast_equals", \
-0002de80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002de90: 2020 2022 6e6f 5f63 6f6e 666c 6963 7473     "no_conflicts
-0002dea0: 222c 2022 6f76 6572 7269 6465 222c 2022  ", "override", "
-0002deb0: 6d69 6e69 6d61 6c22 7d2c 2064 6566 6175  minimal"}, defau
-0002dec0: 6c74 3a20 226e 6f5f 636f 6e66 6c69 6374  lt: "no_conflict
-0002ded0: 7322 0a20 2020 2020 2020 2020 2020 2053  s".            S
-0002dee0: 7472 696e 6720 696e 6469 6361 7469 6e67  tring indicating
-0002def0: 2068 6f77 2074 6f20 636f 6d70 6172 6520   how to compare 
-0002df00: 7661 7269 6162 6c65 7320 6f66 2074 6865  variables of the
-0002df10: 2073 616d 6520 6e61 6d65 2066 6f72 0a20   same name for. 
-0002df20: 2020 2020 2020 2020 2020 2070 6f74 656e             poten
-0002df30: 7469 616c 2063 6f6e 666c 6963 7473 3a0a  tial conflicts:.
-0002df40: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
-0002df50: 6964 656e 7469 6361 6c27 3a20 616c 6c20  identical': all 
-0002df60: 7661 6c75 6573 2c20 6469 6d65 6e73 696f  values, dimensio
-0002df70: 6e73 2061 6e64 2061 7474 7269 6275 7465  ns and attribute
-0002df80: 7320 6d75 7374 2062 6520 7468 650a 2020  s must be the.  
-0002df90: 2020 2020 2020 2020 2020 2020 7361 6d65              same
-0002dfa0: 2e0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
-0002dfb0: 2765 7175 616c 7327 3a20 616c 6c20 7661  'equals': all va
-0002dfc0: 6c75 6573 2061 6e64 2064 696d 656e 7369  lues and dimensi
-0002dfd0: 6f6e 7320 6d75 7374 2062 6520 7468 6520  ons must be the 
-0002dfe0: 7361 6d65 2e0a 2020 2020 2020 2020 2020  same..          
-0002dff0: 2020 2d20 2762 726f 6164 6361 7374 5f65    - 'broadcast_e
-0002e000: 7175 616c 7327 3a20 616c 6c20 7661 6c75  quals': all valu
-0002e010: 6573 206d 7573 7420 6265 2065 7175 616c  es must be equal
-0002e020: 2077 6865 6e20 7661 7269 6162 6c65 7320   when variables 
-0002e030: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
-0002e040: 2020 6272 6f61 6463 6173 7420 6167 6169    broadcast agai
-0002e050: 6e73 7420 6561 6368 206f 7468 6572 2074  nst each other t
-0002e060: 6f20 656e 7375 7265 2063 6f6d 6d6f 6e20  o ensure common 
-0002e070: 6469 6d65 6e73 696f 6e73 2e0a 2020 2020  dimensions..    
-0002e080: 2020 2020 2020 2020 2d20 276e 6f5f 636f          - 'no_co
-0002e090: 6e66 6c69 6374 7327 3a20 6f6e 6c79 2076  nflicts': only v
-0002e0a0: 616c 7565 7320 7768 6963 6820 6172 6520  alues which are 
-0002e0b0: 6e6f 7420 6e75 6c6c 2069 6e20 626f 7468  not null in both
-0002e0c0: 2064 6174 6173 6574 730a 2020 2020 2020   datasets.      
-0002e0d0: 2020 2020 2020 2020 6d75 7374 2062 6520          must be 
-0002e0e0: 6571 7561 6c2e 2054 6865 2072 6574 7572  equal. The retur
-0002e0f0: 6e65 6420 6461 7461 7365 7420 7468 656e  ned dataset then
-0002e100: 2063 6f6e 7461 696e 7320 7468 6520 636f   contains the co
-0002e110: 6d62 696e 6174 696f 6e0a 2020 2020 2020  mbination.      
-0002e120: 2020 2020 2020 2020 6f66 2061 6c6c 206e          of all n
-0002e130: 6f6e 2d6e 756c 6c20 7661 6c75 6573 2e0a  on-null values..
-0002e140: 2020 2020 2020 2020 2020 2020 2d20 276f              - 'o
-0002e150: 7665 7272 6964 6527 3a20 736b 6970 2063  verride': skip c
-0002e160: 6f6d 7061 7269 6e67 2061 6e64 2070 6963  omparing and pic
-0002e170: 6b20 7661 7269 6162 6c65 2066 726f 6d20  k variable from 
-0002e180: 6669 7273 7420 6461 7461 7365 740a 2020  first dataset.  
-0002e190: 2020 2020 2020 2020 2020 2d20 276d 696e            - 'min
-0002e1a0: 696d 616c 273a 2064 726f 7020 636f 6e66  imal': drop conf
-0002e1b0: 6c69 6374 696e 6720 636f 6f72 6469 6e61  licting coordina
-0002e1c0: 7465 730a 0a20 2020 2020 2020 206a 6f69  tes..        joi
-0002e1d0: 6e20 3a20 7b22 6f75 7465 7222 2c20 2269  n : {"outer", "i
-0002e1e0: 6e6e 6572 222c 2022 6c65 6674 222c 2022  nner", "left", "
-0002e1f0: 7269 6768 7422 2c20 2265 7861 6374 222c  right", "exact",
-0002e200: 2022 6f76 6572 7269 6465 227d 2c20 5c0a   "override"}, \.
-0002e210: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0002e220: 6566 6175 6c74 3a20 226f 7574 6572 220a  efault: "outer".
-0002e230: 2020 2020 2020 2020 2020 2020 4d65 7468              Meth
-0002e240: 6f64 2066 6f72 206a 6f69 6e69 6e67 2060  od for joining `
-0002e250: 6073 656c 6660 6020 616e 6420 6060 6f74  `self`` and ``ot
-0002e260: 6865 7260 6020 616c 6f6e 6720 7368 6172  her`` along shar
-0002e270: 6564 2064 696d 656e 7369 6f6e 733a 0a0a  ed dimensions:..
-0002e280: 2020 2020 2020 2020 2020 2020 2d20 276f              - 'o
-0002e290: 7574 6572 273a 2075 7365 2074 6865 2075  uter': use the u
-0002e2a0: 6e69 6f6e 206f 6620 7468 6520 696e 6465  nion of the inde
-0002e2b0: 7865 730a 2020 2020 2020 2020 2020 2020  xes.            
-0002e2c0: 2d20 2769 6e6e 6572 273a 2075 7365 2074  - 'inner': use t
-0002e2d0: 6865 2069 6e74 6572 7365 6374 696f 6e20  he intersection 
-0002e2e0: 6f66 2074 6865 2069 6e64 6578 6573 0a20  of the indexes. 
-0002e2f0: 2020 2020 2020 2020 2020 202d 2027 6c65             - 'le
-0002e300: 6674 273a 2075 7365 2069 6e64 6578 6573  ft': use indexes
-0002e310: 2066 726f 6d20 6060 7365 6c66 6060 0a20   from ``self``. 
-0002e320: 2020 2020 2020 2020 2020 202d 2027 7269             - 'ri
-0002e330: 6768 7427 3a20 7573 6520 696e 6465 7865  ght': use indexe
-0002e340: 7320 6672 6f6d 2060 606f 7468 6572 6060  s from ``other``
-0002e350: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
-0002e360: 6578 6163 7427 3a20 6572 726f 7220 696e  exact': error in
-0002e370: 7374 6561 6420 6f66 2061 6c69 676e 696e  stead of alignin
-0002e380: 6720 6e6f 6e2d 6571 7561 6c20 696e 6465  g non-equal inde
-0002e390: 7865 730a 2020 2020 2020 2020 2020 2020  xes.            
-0002e3a0: 2d20 276f 7665 7272 6964 6527 3a20 7573  - 'override': us
-0002e3b0: 6520 696e 6465 7865 7320 6672 6f6d 2060  e indexes from `
-0002e3c0: 6073 656c 6660 6020 7468 6174 2061 7265  `self`` that are
-0002e3d0: 2074 6865 2073 616d 6520 7369 7a65 0a20   the same size. 
-0002e3e0: 2020 2020 2020 2020 2020 2020 2061 7320               as 
-0002e3f0: 7468 6f73 6520 6f66 2060 606f 7468 6572  those of ``other
-0002e400: 6060 2069 6e20 7468 6174 2064 696d 656e  `` in that dimen
-0002e410: 7369 6f6e 0a0a 2020 2020 2020 2020 6669  sion..        fi
-0002e420: 6c6c 5f76 616c 7565 203a 2073 6361 6c61  ll_value : scala
-0002e430: 7220 6f72 2064 6963 742d 6c69 6b65 2c20  r or dict-like, 
-0002e440: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0002e450: 2020 2020 2056 616c 7565 2074 6f20 7573       Value to us
-0002e460: 6520 666f 7220 6e65 776c 7920 6d69 7373  e for newly miss
-0002e470: 696e 6720 7661 6c75 6573 2e20 4966 2061  ing values. If a
-0002e480: 2064 6963 742d 6c69 6b65 2c20 6d61 7073   dict-like, maps
-0002e490: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-0002e4a0: 6961 626c 6520 6e61 6d65 7320 2869 6e63  iable names (inc
-0002e4b0: 6c75 6469 6e67 2063 6f6f 7264 696e 6174  luding coordinat
-0002e4c0: 6573 2920 746f 2066 696c 6c20 7661 6c75  es) to fill valu
-0002e4d0: 6573 2e0a 2020 2020 2020 2020 636f 6d62  es..        comb
-0002e4e0: 696e 655f 6174 7472 7320 3a20 7b22 6472  ine_attrs : {"dr
-0002e4f0: 6f70 222c 2022 6964 656e 7469 6361 6c22  op", "identical"
-0002e500: 2c20 226e 6f5f 636f 6e66 6c69 6374 7322  , "no_conflicts"
-0002e510: 2c20 2264 726f 705f 636f 6e66 6c69 6374  , "drop_conflict
-0002e520: 7322 2c20 5c0a 2020 2020 2020 2020 2020  s", \.          
-0002e530: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0002e540: 6f76 6572 7269 6465 227d 206f 7220 6361  override"} or ca
-0002e550: 6c6c 6162 6c65 2c20 6465 6661 756c 743a  llable, default:
-0002e560: 2022 6f76 6572 7269 6465 220a 2020 2020   "override".    
-0002e570: 2020 2020 2020 2020 4120 6361 6c6c 6162          A callab
-0002e580: 6c65 206f 7220 6120 7374 7269 6e67 2069  le or a string i
-0002e590: 6e64 6963 6174 696e 6720 686f 7720 746f  ndicating how to
-0002e5a0: 2063 6f6d 6269 6e65 2061 7474 7273 206f   combine attrs o
-0002e5b0: 6620 7468 6520 6f62 6a65 6374 7320 6265  f the objects be
-0002e5c0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-0002e5d0: 6d65 7267 6564 3a0a 0a20 2020 2020 2020  merged:..       
-0002e5e0: 2020 2020 202d 2022 6472 6f70 223a 2065       - "drop": e
-0002e5f0: 6d70 7479 2061 7474 7273 206f 6e20 7265  mpty attrs on re
-0002e600: 7475 726e 6564 2044 6174 6173 6574 2e0a  turned Dataset..
-0002e610: 2020 2020 2020 2020 2020 2020 2d20 2269              - "i
-0002e620: 6465 6e74 6963 616c 223a 2061 6c6c 2061  dentical": all a
-0002e630: 7474 7273 206d 7573 7420 6265 2074 6865  ttrs must be the
-0002e640: 2073 616d 6520 6f6e 2065 7665 7279 206f   same on every o
-0002e650: 626a 6563 742e 0a20 2020 2020 2020 2020  bject..         
-0002e660: 2020 202d 2022 6e6f 5f63 6f6e 666c 6963     - "no_conflic
-0002e670: 7473 223a 2061 7474 7273 2066 726f 6d20  ts": attrs from 
-0002e680: 616c 6c20 6f62 6a65 6374 7320 6172 6520  all objects are 
-0002e690: 636f 6d62 696e 6564 2c20 616e 7920 7468  combined, any th
-0002e6a0: 6174 2068 6176 650a 2020 2020 2020 2020  at have.        
-0002e6b0: 2020 2020 2020 7468 6520 7361 6d65 206e        the same n
-0002e6c0: 616d 6520 6d75 7374 2061 6c73 6f20 6861  ame must also ha
-0002e6d0: 7665 2074 6865 2073 616d 6520 7661 6c75  ve the same valu
-0002e6e0: 652e 0a20 2020 2020 2020 2020 2020 202d  e..            -
-0002e6f0: 2022 6472 6f70 5f63 6f6e 666c 6963 7473   "drop_conflicts
-0002e700: 223a 2061 7474 7273 2066 726f 6d20 616c  ": attrs from al
-0002e710: 6c20 6f62 6a65 6374 7320 6172 6520 636f  l objects are co
-0002e720: 6d62 696e 6564 2c20 616e 7920 7468 6174  mbined, any that
-0002e730: 2068 6176 650a 2020 2020 2020 2020 2020   have.          
-0002e740: 2020 2020 7468 6520 7361 6d65 206e 616d      the same nam
-0002e750: 6520 6275 7420 6469 6666 6572 656e 7420  e but different 
-0002e760: 7661 6c75 6573 2061 7265 2064 726f 7070  values are dropp
-0002e770: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-0002e780: 2d20 226f 7665 7272 6964 6522 3a20 736b  - "override": sk
-0002e790: 6970 2063 6f6d 7061 7269 6e67 2061 6e64  ip comparing and
-0002e7a0: 2063 6f70 7920 6174 7472 7320 6672 6f6d   copy attrs from
-0002e7b0: 2074 6865 2066 6972 7374 2064 6174 6173   the first datas
-0002e7c0: 6574 2074 6f0a 2020 2020 2020 2020 2020  et to.          
-0002e7d0: 2020 2020 7468 6520 7265 7375 6c74 2e0a      the result..
-0002e7e0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0002e7f0: 6120 6361 6c6c 6162 6c65 2c20 6974 206d  a callable, it m
-0002e800: 7573 7420 6578 7065 6374 2061 2073 6571  ust expect a seq
-0002e810: 7565 6e63 6520 6f66 2060 6061 7474 7273  uence of ``attrs
-0002e820: 6060 2064 6963 7473 2061 6e64 2061 2063  `` dicts and a c
-0002e830: 6f6e 7465 7874 206f 626a 6563 740a 2020  ontext object.  
-0002e840: 2020 2020 2020 2020 2020 6173 2069 7473            as its
-0002e850: 206f 6e6c 7920 7061 7261 6d65 7465 7273   only parameters
-0002e860: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0002e870: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-0002e880: 2d2d 0a20 2020 2020 2020 206d 6572 6765  --.        merge
-0002e890: 6420 3a20 4461 7461 7365 740a 2020 2020  d : Dataset.    
-0002e8a0: 2020 2020 2020 2020 4d65 7267 6564 2064          Merged d
-0002e8b0: 6174 6173 6574 2e0a 0a20 2020 2020 2020  ataset...       
-0002e8c0: 2052 6169 7365 730a 2020 2020 2020 2020   Raises.        
-0002e8d0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 204d  ------.        M
-0002e8e0: 6572 6765 4572 726f 720a 2020 2020 2020  ergeError.      
-0002e8f0: 2020 2020 2020 4966 2061 6e79 2076 6172        If any var
-0002e900: 6961 626c 6573 2063 6f6e 666c 6963 7420  iables conflict 
-0002e910: 2873 6565 2060 6063 6f6d 7061 7460 6029  (see ``compat``)
-0002e920: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-0002e930: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-0002e940: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
-0002e950: 6173 6574 2e75 7064 6174 650a 2020 2020  aset.update.    
-0002e960: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0002e970: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-0002e980: 2e64 6174 6161 7272 6179 2069 6d70 6f72  .dataarray impor
-0002e990: 7420 4461 7461 4172 7261 790a 0a20 2020  t DataArray..   
-0002e9a0: 2020 2020 206f 7468 6572 203d 206f 7468       other = oth
-0002e9b0: 6572 2e74 6f5f 6461 7461 7365 7428 2920  er.to_dataset() 
-0002e9c0: 6966 2069 7369 6e73 7461 6e63 6528 6f74  if isinstance(ot
-0002e9d0: 6865 722c 2044 6174 6141 7272 6179 2920  her, DataArray) 
-0002e9e0: 656c 7365 206f 7468 6572 0a20 2020 2020  else other.     
-0002e9f0: 2020 206d 6572 6765 5f72 6573 756c 7420     merge_result 
-0002ea00: 3d20 6461 7461 7365 745f 6d65 7267 655f  = dataset_merge_
-0002ea10: 6d65 7468 6f64 280a 2020 2020 2020 2020  method(.        
-0002ea20: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0002ea30: 2020 2020 2020 6f74 6865 722c 0a20 2020        other,.   
-0002ea40: 2020 2020 2020 2020 206f 7665 7277 7269           overwri
-0002ea50: 7465 5f76 6172 733d 6f76 6572 7772 6974  te_vars=overwrit
-0002ea60: 655f 7661 7273 2c0a 2020 2020 2020 2020  e_vars,.        
-0002ea70: 2020 2020 636f 6d70 6174 3d63 6f6d 7061      compat=compa
-0002ea80: 742c 0a20 2020 2020 2020 2020 2020 206a  t,.            j
-0002ea90: 6f69 6e3d 6a6f 696e 2c0a 2020 2020 2020  oin=join,.      
-0002eaa0: 2020 2020 2020 6669 6c6c 5f76 616c 7565        fill_value
-0002eab0: 3d66 696c 6c5f 7661 6c75 652c 0a20 2020  =fill_value,.   
-0002eac0: 2020 2020 2020 2020 2063 6f6d 6269 6e65           combine
-0002ead0: 5f61 7474 7273 3d63 6f6d 6269 6e65 5f61  _attrs=combine_a
-0002eae0: 7474 7273 2c0a 2020 2020 2020 2020 290a  ttrs,.        ).
-0002eaf0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0002eb00: 656c 662e 5f72 6570 6c61 6365 282a 2a6d  elf._replace(**m
-0002eb10: 6572 6765 5f72 6573 756c 742e 5f61 7364  erge_result._asd
-0002eb20: 6963 7428 2929 0a0a 2020 2020 6465 6620  ict())..    def 
-0002eb30: 5f61 7373 6572 745f 616c 6c5f 696e 5f64  _assert_all_in_d
-0002eb40: 6174 6173 6574 280a 2020 2020 2020 2020  ataset(.        
-0002eb50: 7365 6c66 2c20 6e61 6d65 733a 2049 7465  self, names: Ite
-0002eb60: 7261 626c 655b 4861 7368 6162 6c65 5d2c  rable[Hashable],
-0002eb70: 2076 6972 7475 616c 5f6f 6b61 793a 2062   virtual_okay: b
-0002eb80: 6f6f 6c20 3d20 4661 6c73 650a 2020 2020  ool = False.    
-0002eb90: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0002eba0: 2020 2062 6164 5f6e 616d 6573 203d 2073     bad_names = s
-0002ebb0: 6574 286e 616d 6573 2920 2d20 7365 7428  et(names) - set(
-0002ebc0: 7365 6c66 2e5f 7661 7269 6162 6c65 7329  self._variables)
-0002ebd0: 0a20 2020 2020 2020 2069 6620 7669 7274  .        if virt
-0002ebe0: 7561 6c5f 6f6b 6179 3a0a 2020 2020 2020  ual_okay:.      
-0002ebf0: 2020 2020 2020 6261 645f 6e61 6d65 7320        bad_names 
-0002ec00: 2d3d 2073 656c 662e 7669 7274 7561 6c5f  -= self.virtual_
-0002ec10: 7661 7269 6162 6c65 730a 2020 2020 2020  variables.      
-0002ec20: 2020 6966 2062 6164 5f6e 616d 6573 3a0a    if bad_names:.
-0002ec30: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0002ec40: 7265 645f 6261 645f 6e61 6d65 7320 3d20  red_bad_names = 
-0002ec50: 5b6e 616d 6520 666f 7220 6e61 6d65 2069  [name for name i
-0002ec60: 6e20 6e61 6d65 7320 6966 206e 616d 6520  n names if name 
-0002ec70: 696e 2062 6164 5f6e 616d 6573 5d0a 2020  in bad_names].  
-0002ec80: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0002ec90: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-0002eca0: 2020 2020 2020 2020 2020 2020 6622 5468              f"Th
-0002ecb0: 6573 6520 7661 7269 6162 6c65 7320 6361  ese variables ca
-0002ecc0: 6e6e 6f74 2062 6520 666f 756e 6420 696e  nnot be found in
-0002ecd0: 2074 6869 7320 6461 7461 7365 743a 207b   this dataset: {
-0002ece0: 6f72 6465 7265 645f 6261 645f 6e61 6d65  ordered_bad_name
-0002ecf0: 737d 220a 2020 2020 2020 2020 2020 2020  s}".            
-0002ed00: 290a 0a20 2020 2064 6566 2064 726f 705f  )..    def drop_
-0002ed10: 7661 7273 280a 2020 2020 2020 2020 7365  vars(.        se
-0002ed20: 6c66 3a20 545f 4461 7461 7365 742c 0a20  lf: T_Dataset,. 
-0002ed30: 2020 2020 2020 206e 616d 6573 3a20 4861         names: Ha
-0002ed40: 7368 6162 6c65 207c 2049 7465 7261 626c  shable | Iterabl
-0002ed50: 655b 4861 7368 6162 6c65 5d2c 0a20 2020  e[Hashable],.   
-0002ed60: 2020 2020 202a 2c0a 2020 2020 2020 2020       *,.        
-0002ed70: 6572 726f 7273 3a20 4572 726f 724f 7074  errors: ErrorOpt
-0002ed80: 696f 6e73 203d 2022 7261 6973 6522 2c0a  ions = "raise",.
-0002ed90: 2020 2020 2920 2d3e 2054 5f44 6174 6173      ) -> T_Datas
-0002eda0: 6574 3a0a 2020 2020 2020 2020 2222 2244  et:.        """D
-0002edb0: 726f 7020 7661 7269 6162 6c65 7320 6672  rop variables fr
-0002edc0: 6f6d 2074 6869 7320 6461 7461 7365 742e  om this dataset.
-0002edd0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-0002ede0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-0002edf0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0002ee00: 6e61 6d65 7320 3a20 6861 7368 6162 6c65  names : hashable
-0002ee10: 206f 7220 6974 6572 6162 6c65 206f 6620   or iterable of 
-0002ee20: 6861 7368 6162 6c65 0a20 2020 2020 2020  hashable.       
-0002ee30: 2020 2020 204e 616d 6528 7329 206f 6620       Name(s) of 
-0002ee40: 7661 7269 6162 6c65 7320 746f 2064 726f  variables to dro
-0002ee50: 702e 0a20 2020 2020 2020 2065 7272 6f72  p..        error
-0002ee60: 7320 3a20 7b22 7261 6973 6522 2c20 2269  s : {"raise", "i
-0002ee70: 676e 6f72 6522 7d2c 2064 6566 6175 6c74  gnore"}, default
-0002ee80: 3a20 2272 6169 7365 220a 2020 2020 2020  : "raise".      
-0002ee90: 2020 2020 2020 4966 2027 7261 6973 6527        If 'raise'
-0002eea0: 2c20 7261 6973 6573 2061 2056 616c 7565  , raises a Value
-0002eeb0: 4572 726f 7220 6572 726f 7220 6966 2061  Error error if a
-0002eec0: 6e79 206f 6620 7468 6520 7661 7269 6162  ny of the variab
-0002eed0: 6c65 0a20 2020 2020 2020 2020 2020 2070  le.            p
-0002eee0: 6173 7365 6420 6172 6520 6e6f 7420 696e  assed are not in
-0002eef0: 2074 6865 2064 6174 6173 6574 2e20 4966   the dataset. If
-0002ef00: 2027 6967 6e6f 7265 272c 2061 6e79 2067   'ignore', any g
-0002ef10: 6976 656e 206e 616d 6573 2074 6861 7420  iven names that 
-0002ef20: 6172 6520 696e 2074 6865 0a20 2020 2020  are in the.     
-0002ef30: 2020 2020 2020 2064 6174 6173 6574 2061         dataset a
-0002ef40: 7265 2064 726f 7070 6564 2061 6e64 206e  re dropped and n
-0002ef50: 6f20 6572 726f 7220 6973 2072 6169 7365  o error is raise
-0002ef60: 642e 0a0a 2020 2020 2020 2020 5265 7475  d...        Retu
-0002ef70: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-0002ef80: 2d2d 2d0a 2020 2020 2020 2020 6472 6f70  ---.        drop
-0002ef90: 7065 6420 3a20 4461 7461 7365 740a 0a20  ped : Dataset.. 
-0002efa0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0002efb0: 2020 2023 2074 6865 2049 7465 7261 626c     # the Iterabl
-0002efc0: 6520 6368 6563 6b20 6973 2072 6571 7569  e check is requi
-0002efd0: 7265 6420 666f 7220 6d79 7079 0a20 2020  red for mypy.   
-0002efe0: 2020 2020 2069 6620 6973 5f73 6361 6c61       if is_scala
-0002eff0: 7228 6e61 6d65 7329 206f 7220 6e6f 7420  r(names) or not 
-0002f000: 6973 696e 7374 616e 6365 286e 616d 6573  isinstance(names
-0002f010: 2c20 4974 6572 6162 6c65 293a 0a20 2020  , Iterable):.   
-0002f020: 2020 2020 2020 2020 206e 616d 6573 203d           names =
-0002f030: 207b 6e61 6d65 737d 0a20 2020 2020 2020   {names}.       
-0002f040: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002f050: 2020 206e 616d 6573 203d 2073 6574 286e     names = set(n
-0002f060: 616d 6573 290a 2020 2020 2020 2020 6966  ames).        if
-0002f070: 2065 7272 6f72 7320 3d3d 2022 7261 6973   errors == "rais
-0002f080: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
-0002f090: 7365 6c66 2e5f 6173 7365 7274 5f61 6c6c  self._assert_all
-0002f0a0: 5f69 6e5f 6461 7461 7365 7428 6e61 6d65  _in_dataset(name
-0002f0b0: 7329 0a0a 2020 2020 2020 2020 2320 4748  s)..        # GH
-0002f0c0: 3635 3035 0a20 2020 2020 2020 206f 7468  6505.        oth
-0002f0d0: 6572 5f6e 616d 6573 203d 2073 6574 2829  er_names = set()
-0002f0e0: 0a20 2020 2020 2020 2066 6f72 2076 6172  .        for var
-0002f0f0: 2069 6e20 6e61 6d65 733a 0a20 2020 2020   in names:.     
-0002f100: 2020 2020 2020 206d 6179 6265 5f6d 6964         maybe_mid
-0002f110: 7820 3d20 7365 6c66 2e5f 696e 6465 7865  x = self._indexe
-0002f120: 732e 6765 7428 7661 722c 204e 6f6e 6529  s.get(var, None)
-0002f130: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002f140: 6973 696e 7374 616e 6365 286d 6179 6265  isinstance(maybe
-0002f150: 5f6d 6964 782c 2050 616e 6461 734d 756c  _midx, PandasMul
-0002f160: 7469 496e 6465 7829 3a0a 2020 2020 2020  tiIndex):.      
-0002f170: 2020 2020 2020 2020 2020 6964 785f 636f            idx_co
-0002f180: 6f72 645f 6e61 6d65 7320 3d20 7365 7428  ord_names = set(
-0002f190: 6d61 7962 655f 6d69 6478 2e69 6e64 6578  maybe_midx.index
-0002f1a0: 2e6e 616d 6573 202b 205b 6d61 7962 655f  .names + [maybe_
-0002f1b0: 6d69 6478 2e64 696d 5d29 0a20 2020 2020  midx.dim]).     
-0002f1c0: 2020 2020 2020 2020 2020 2069 6478 5f6f             idx_o
-0002f1d0: 7468 6572 5f6e 616d 6573 203d 2069 6478  ther_names = idx
-0002f1e0: 5f63 6f6f 7264 5f6e 616d 6573 202d 2073  _coord_names - s
-0002f1f0: 6574 286e 616d 6573 290a 2020 2020 2020  et(names).      
-0002f200: 2020 2020 2020 2020 2020 6f74 6865 725f            other_
-0002f210: 6e61 6d65 732e 7570 6461 7465 2869 6478  names.update(idx
-0002f220: 5f6f 7468 6572 5f6e 616d 6573 290a 2020  _other_names).  
-0002f230: 2020 2020 2020 6966 206f 7468 6572 5f6e        if other_n
-0002f240: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
-0002f250: 2020 6e61 6d65 7320 7c3d 2073 6574 286f    names |= set(o
-0002f260: 7468 6572 5f6e 616d 6573 290a 2020 2020  ther_names).    
-0002f270: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
-0002f280: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
-0002f290: 2020 2020 2020 2066 2244 656c 6574 696e         f"Deletin
-0002f2a0: 6720 6120 7369 6e67 6c65 206c 6576 656c  g a single level
-0002f2b0: 206f 6620 6120 4d75 6c74 6949 6e64 6578   of a MultiIndex
-0002f2c0: 2069 7320 6465 7072 6563 6174 6564 2e20   is deprecated. 
-0002f2d0: 5072 6576 696f 7573 6c79 2c20 7468 6973  Previously, this
-0002f2e0: 2064 656c 6574 6564 2061 6c6c 206c 6576   deleted all lev
-0002f2f0: 656c 7320 6f66 2061 204d 756c 7469 496e  els of a MultiIn
-0002f300: 6465 782e 2022 0a20 2020 2020 2020 2020  dex. ".         
-0002f310: 2020 2020 2020 2066 2250 6c65 6173 6520         f"Please 
-0002f320: 616c 736f 2064 726f 7020 7468 6520 666f  also drop the fo
-0002f330: 6c6c 6f77 696e 6720 7661 7269 6162 6c65  llowing variable
-0002f340: 733a 207b 6f74 6865 725f 6e61 6d65 7321  s: {other_names!
-0002f350: 727d 2074 6f20 6176 6f69 6420 616e 2065  r} to avoid an e
-0002f360: 7272 6f72 2069 6e20 7468 6520 6675 7475  rror in the futu
-0002f370: 7265 2e22 2c0a 2020 2020 2020 2020 2020  re.",.          
-0002f380: 2020 2020 2020 4465 7072 6563 6174 696f        Deprecatio
-0002f390: 6e57 6172 6e69 6e67 2c0a 2020 2020 2020  nWarning,.      
-0002f3a0: 2020 2020 2020 2020 2020 7374 6163 6b6c            stackl
-0002f3b0: 6576 656c 3d32 2c0a 2020 2020 2020 2020  evel=2,.        
-0002f3c0: 2020 2020 290a 0a20 2020 2020 2020 2061      )..        a
-0002f3d0: 7373 6572 745f 6e6f 5f69 6e64 6578 5f63  ssert_no_index_c
-0002f3e0: 6f72 7275 7074 6564 2873 656c 662e 7869  orrupted(self.xi
-0002f3f0: 6e64 6578 6573 2c20 6e61 6d65 7329 0a0a  ndexes, names)..
-0002f400: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0002f410: 7320 3d20 7b6b 3a20 7620 666f 7220 6b2c  s = {k: v for k,
-0002f420: 2076 2069 6e20 7365 6c66 2e5f 7661 7269   v in self._vari
-0002f430: 6162 6c65 732e 6974 656d 7328 2920 6966  ables.items() if
-0002f440: 206b 206e 6f74 2069 6e20 6e61 6d65 737d   k not in names}
-0002f450: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
-0002f460: 616d 6573 203d 207b 6b20 666f 7220 6b20  ames = {k for k 
-0002f470: 696e 2073 656c 662e 5f63 6f6f 7264 5f6e  in self._coord_n
-0002f480: 616d 6573 2069 6620 6b20 696e 2076 6172  ames if k in var
-0002f490: 6961 626c 6573 7d0a 2020 2020 2020 2020  iables}.        
-0002f4a0: 696e 6465 7865 7320 3d20 7b6b 3a20 7620  indexes = {k: v 
-0002f4b0: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
-0002f4c0: 2e5f 696e 6465 7865 732e 6974 656d 7328  ._indexes.items(
-0002f4d0: 2920 6966 206b 206e 6f74 2069 6e20 6e61  ) if k not in na
-0002f4e0: 6d65 737d 0a20 2020 2020 2020 2072 6574  mes}.        ret
-0002f4f0: 7572 6e20 7365 6c66 2e5f 7265 706c 6163  urn self._replac
-0002f500: 655f 7769 7468 5f6e 6577 5f64 696d 7328  e_with_new_dims(
-0002f510: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-0002f520: 6961 626c 6573 2c20 636f 6f72 645f 6e61  iables, coord_na
-0002f530: 6d65 733d 636f 6f72 645f 6e61 6d65 732c  mes=coord_names,
-0002f540: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
-0002f550: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0002f560: 6465 6620 6472 6f70 5f69 6e64 6578 6573  def drop_indexes
-0002f570: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
-0002f580: 545f 4461 7461 7365 742c 0a20 2020 2020  T_Dataset,.     
-0002f590: 2020 2063 6f6f 7264 5f6e 616d 6573 3a20     coord_names: 
-0002f5a0: 4861 7368 6162 6c65 207c 2049 7465 7261  Hashable | Itera
-0002f5b0: 626c 655b 4861 7368 6162 6c65 5d2c 0a20  ble[Hashable],. 
-0002f5c0: 2020 2020 2020 202a 2c0a 2020 2020 2020         *,.      
-0002f5d0: 2020 6572 726f 7273 3a20 4572 726f 724f    errors: ErrorO
-0002f5e0: 7074 696f 6e73 203d 2022 7261 6973 6522  ptions = "raise"
-0002f5f0: 2c0a 2020 2020 2920 2d3e 2054 5f44 6174  ,.    ) -> T_Dat
-0002f600: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
-0002f610: 2244 726f 7020 7468 6520 696e 6465 7865  "Drop the indexe
-0002f620: 7320 6173 7369 676e 6564 2074 6f20 7468  s assigned to th
-0002f630: 6520 6769 7665 6e20 636f 6f72 6469 6e61  e given coordina
-0002f640: 7465 732e 0a0a 2020 2020 2020 2020 5061  tes...        Pa
-0002f650: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-0002f660: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-0002f670: 2020 2020 636f 6f72 645f 6e61 6d65 7320      coord_names 
-0002f680: 3a20 6861 7368 6162 6c65 206f 7220 6974  : hashable or it
-0002f690: 6572 6162 6c65 206f 6620 6861 7368 6162  erable of hashab
-0002f6a0: 6c65 0a20 2020 2020 2020 2020 2020 204e  le.            N
-0002f6b0: 616d 6528 7329 206f 6620 7468 6520 636f  ame(s) of the co
-0002f6c0: 6f72 6469 6e61 7465 2873 2920 666f 7220  ordinate(s) for 
-0002f6d0: 7768 6963 6820 746f 2064 726f 7020 7468  which to drop th
-0002f6e0: 6520 696e 6465 782e 0a20 2020 2020 2020  e index..       
-0002f6f0: 2065 7272 6f72 7320 3a20 7b22 7261 6973   errors : {"rais
-0002f700: 6522 2c20 2269 676e 6f72 6522 7d2c 2064  e", "ignore"}, d
-0002f710: 6566 6175 6c74 3a20 2272 6169 7365 220a  efault: "raise".
-0002f720: 2020 2020 2020 2020 2020 2020 4966 2027              If '
-0002f730: 7261 6973 6527 2c20 7261 6973 6573 2061  raise', raises a
-0002f740: 2056 616c 7565 4572 726f 7220 6572 726f   ValueError erro
-0002f750: 7220 6966 2061 6e79 206f 6620 7468 6520  r if any of the 
-0002f760: 636f 6f72 6469 6e61 7465 730a 2020 2020  coordinates.    
-0002f770: 2020 2020 2020 2020 7061 7373 6564 2068          passed h
-0002f780: 6176 6520 6e6f 2069 6e64 6578 206f 7220  ave no index or 
-0002f790: 6172 6520 6e6f 7420 696e 2074 6865 2064  are not in the d
-0002f7a0: 6174 6173 6574 2e0a 2020 2020 2020 2020  ataset..        
-0002f7b0: 2020 2020 4966 2027 6967 6e6f 7265 272c      If 'ignore',
-0002f7c0: 206e 6f20 6572 726f 7220 6973 2072 6169   no error is rai
-0002f7d0: 7365 642e 0a0a 2020 2020 2020 2020 5265  sed...        Re
-0002f7e0: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-0002f7f0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6472  -----.        dr
-0002f800: 6f70 7065 6420 3a20 4461 7461 7365 740a  opped : Dataset.
-0002f810: 2020 2020 2020 2020 2020 2020 4120 6e65              A ne
-0002f820: 7720 6461 7461 7365 7420 7769 7468 2064  w dataset with d
-0002f830: 726f 7070 6564 2069 6e64 6578 6573 2e0a  ropped indexes..
-0002f840: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0002f850: 2020 2020 2023 2074 6865 2049 7465 7261       # the Itera
-0002f860: 626c 6520 6368 6563 6b20 6973 2072 6571  ble check is req
-0002f870: 7569 7265 6420 666f 7220 6d79 7079 0a20  uired for mypy. 
-0002f880: 2020 2020 2020 2069 6620 6973 5f73 6361         if is_sca
-0002f890: 6c61 7228 636f 6f72 645f 6e61 6d65 7329  lar(coord_names)
-0002f8a0: 206f 7220 6e6f 7420 6973 696e 7374 616e   or not isinstan
-0002f8b0: 6365 2863 6f6f 7264 5f6e 616d 6573 2c20  ce(coord_names, 
-0002f8c0: 4974 6572 6162 6c65 293a 0a20 2020 2020  Iterable):.     
-0002f8d0: 2020 2020 2020 2063 6f6f 7264 5f6e 616d         coord_nam
-0002f8e0: 6573 203d 207b 636f 6f72 645f 6e61 6d65  es = {coord_name
-0002f8f0: 737d 0a20 2020 2020 2020 2065 6c73 653a  s}.        else:
-0002f900: 0a20 2020 2020 2020 2020 2020 2063 6f6f  .            coo
-0002f910: 7264 5f6e 616d 6573 203d 2073 6574 2863  rd_names = set(c
-0002f920: 6f6f 7264 5f6e 616d 6573 290a 0a20 2020  oord_names)..   
-0002f930: 2020 2020 2069 6620 6572 726f 7273 203d       if errors =
-0002f940: 3d20 2272 6169 7365 223a 0a20 2020 2020  = "raise":.     
-0002f950: 2020 2020 2020 2069 6e76 616c 6964 5f63         invalid_c
-0002f960: 6f6f 7264 7320 3d20 636f 6f72 645f 6e61  oords = coord_na
-0002f970: 6d65 7320 2d20 7365 6c66 2e5f 636f 6f72  mes - self._coor
-0002f980: 645f 6e61 6d65 730a 2020 2020 2020 2020  d_names.        
-0002f990: 2020 2020 6966 2069 6e76 616c 6964 5f63      if invalid_c
-0002f9a0: 6f6f 7264 733a 0a20 2020 2020 2020 2020  oords:.         
-0002f9b0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0002f9c0: 7565 4572 726f 7228 6622 7468 6f73 6520  ueError(f"those 
-0002f9d0: 636f 6f72 6469 6e61 7465 7320 646f 6e27  coordinates don'
-0002f9e0: 7420 6578 6973 743a 207b 696e 7661 6c69  t exist: {invali
-0002f9f0: 645f 636f 6f72 6473 7d22 290a 0a20 2020  d_coords}")..   
-0002fa00: 2020 2020 2020 2020 2075 6e69 6e64 6578           unindex
-0002fa10: 6564 5f63 6f6f 7264 7320 3d20 7365 7428  ed_coords = set(
-0002fa20: 636f 6f72 645f 6e61 6d65 7329 202d 2073  coord_names) - s
-0002fa30: 6574 2873 656c 662e 5f69 6e64 6578 6573  et(self._indexes
-0002fa40: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0002fa50: 2075 6e69 6e64 6578 6564 5f63 6f6f 7264   unindexed_coord
-0002fa60: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0002fa70: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0002fa80: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0002fa90: 2020 2020 2020 2020 2066 2274 686f 7365           f"those
-0002faa0: 2063 6f6f 7264 696e 6174 6573 2064 6f20   coordinates do 
-0002fab0: 6e6f 7420 6861 7665 2061 6e20 696e 6465  not have an inde
-0002fac0: 783a 207b 756e 696e 6465 7865 645f 636f  x: {unindexed_co
-0002fad0: 6f72 6473 7d22 0a20 2020 2020 2020 2020  ords}".         
-0002fae0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0002faf0: 2020 6173 7365 7274 5f6e 6f5f 696e 6465    assert_no_inde
-0002fb00: 785f 636f 7272 7570 7465 6428 7365 6c66  x_corrupted(self
-0002fb10: 2e78 696e 6465 7865 732c 2063 6f6f 7264  .xindexes, coord
-0002fb20: 5f6e 616d 6573 2c20 6163 7469 6f6e 3d22  _names, action="
-0002fb30: 7265 6d6f 7665 2069 6e64 6578 2865 7329  remove index(es)
-0002fb40: 2229 0a0a 2020 2020 2020 2020 7661 7269  ")..        vari
-0002fb50: 6162 6c65 7320 3d20 7b7d 0a20 2020 2020  ables = {}.     
-0002fb60: 2020 2066 6f72 206e 616d 652c 2076 6172     for name, var
-0002fb70: 2069 6e20 7365 6c66 2e5f 7661 7269 6162   in self._variab
-0002fb80: 6c65 732e 6974 656d 7328 293a 0a20 2020  les.items():.   
-0002fb90: 2020 2020 2020 2020 2069 6620 6e61 6d65           if name
-0002fba0: 2069 6e20 636f 6f72 645f 6e61 6d65 733a   in coord_names:
-0002fbb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002fbc0: 2076 6172 6961 626c 6573 5b6e 616d 655d   variables[name]
-0002fbd0: 203d 2076 6172 2e74 6f5f 6261 7365 5f76   = var.to_base_v
-0002fbe0: 6172 6961 626c 6528 290a 2020 2020 2020  ariable().      
-0002fbf0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0002fc00: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-0002fc10: 6162 6c65 735b 6e61 6d65 5d20 3d20 7661  ables[name] = va
-0002fc20: 720a 0a20 2020 2020 2020 2069 6e64 6578  r..        index
-0002fc30: 6573 203d 207b 6b3a 2076 2066 6f72 206b  es = {k: v for k
-0002fc40: 2c20 7620 696e 2073 656c 662e 5f69 6e64  , v in self._ind
-0002fc50: 6578 6573 2e69 7465 6d73 2829 2069 6620  exes.items() if 
-0002fc60: 6b20 6e6f 7420 696e 2063 6f6f 7264 5f6e  k not in coord_n
-0002fc70: 616d 6573 7d0a 0a20 2020 2020 2020 2072  ames}..        r
-0002fc80: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
-0002fc90: 6163 6528 7661 7269 6162 6c65 733d 7661  ace(variables=va
-0002fca0: 7269 6162 6c65 732c 2069 6e64 6578 6573  riables, indexes
-0002fcb0: 3d69 6e64 6578 6573 290a 0a20 2020 2064  =indexes)..    d
-0002fcc0: 6566 2064 726f 7028 0a20 2020 2020 2020  ef drop(.       
-0002fcd0: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
-0002fce0: 2c0a 2020 2020 2020 2020 6c61 6265 6c73  ,.        labels
-0002fcf0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2064  =None,.        d
-0002fd00: 696d 3d4e 6f6e 652c 0a20 2020 2020 2020  im=None,.       
-0002fd10: 202a 2c0a 2020 2020 2020 2020 6572 726f   *,.        erro
-0002fd20: 7273 3a20 4572 726f 724f 7074 696f 6e73  rs: ErrorOptions
-0002fd30: 203d 2022 7261 6973 6522 2c0a 2020 2020   = "raise",.    
-0002fd40: 2020 2020 2a2a 6c61 6265 6c73 5f6b 7761      **labels_kwa
-0002fd50: 7267 732c 0a20 2020 2029 202d 3e20 545f  rgs,.    ) -> T_
-0002fd60: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-0002fd70: 2022 2222 4261 636b 7761 7264 2063 6f6d   """Backward com
-0002fd80: 7061 7469 626c 6520 6d65 7468 6f64 2062  patible method b
-0002fd90: 6173 6564 206f 6e20 6064 726f 705f 7661  ased on `drop_va
-0002fda0: 7273 6020 616e 6420 6064 726f 705f 7365  rs` and `drop_se
-0002fdb0: 6c60 0a0a 2020 2020 2020 2020 5573 696e  l`..        Usin
-0002fdc0: 6720 6569 7468 6572 2060 6472 6f70 5f76  g either `drop_v
-0002fdd0: 6172 7360 206f 7220 6064 726f 705f 7365  ars` or `drop_se
-0002fde0: 6c60 2069 7320 656e 636f 7572 6167 6564  l` is encouraged
-0002fdf0: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-0002fe00: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-0002fe10: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
-0002fe20: 7365 742e 6472 6f70 5f76 6172 730a 2020  set.drop_vars.  
-0002fe30: 2020 2020 2020 4461 7461 7365 742e 6472        Dataset.dr
-0002fe40: 6f70 5f73 656c 0a20 2020 2020 2020 2022  op_sel.        "
-0002fe50: 2222 0a20 2020 2020 2020 2069 6620 6572  "".        if er
-0002fe60: 726f 7273 206e 6f74 2069 6e20 5b22 7261  rors not in ["ra
-0002fe70: 6973 6522 2c20 2269 676e 6f72 6522 5d3a  ise", "ignore"]:
-0002fe80: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0002fe90: 7365 2056 616c 7565 4572 726f 7228 2765  se ValueError('e
-0002fea0: 7272 6f72 7320 6d75 7374 2062 6520 6569  rrors must be ei
-0002feb0: 7468 6572 2022 7261 6973 6522 206f 7220  ther "raise" or 
-0002fec0: 2269 676e 6f72 6522 2729 0a0a 2020 2020  "ignore"')..    
-0002fed0: 2020 2020 6966 2069 735f 6469 6374 5f6c      if is_dict_l
-0002fee0: 696b 6528 6c61 6265 6c73 2920 616e 6420  ike(labels) and 
-0002fef0: 6e6f 7420 6973 696e 7374 616e 6365 286c  not isinstance(l
-0002ff00: 6162 656c 732c 2064 6963 7429 3a0a 2020  abels, dict):.  
-0002ff10: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0002ff20: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
-0002ff30: 2020 2020 2020 2020 2022 6472 6f70 7069           "droppi
-0002ff40: 6e67 2063 6f6f 7264 696e 6174 6573 2075  ng coordinates u
-0002ff50: 7369 6e67 2060 6472 6f70 6020 6973 2062  sing `drop` is b
-0002ff60: 6520 6465 7072 6563 6174 6564 3b20 7573  e deprecated; us
-0002ff70: 6520 6472 6f70 5f76 6172 732e 222c 0a20  e drop_vars.",. 
-0002ff80: 2020 2020 2020 2020 2020 2020 2020 2046                 F
-0002ff90: 7574 7572 6557 6172 6e69 6e67 2c0a 2020  utureWarning,.  
-0002ffa0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0002ffb0: 6163 6b6c 6576 656c 3d32 2c0a 2020 2020  acklevel=2,.    
-0002ffc0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0002ffd0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0002ffe0: 662e 6472 6f70 5f76 6172 7328 6c61 6265  f.drop_vars(labe
-0002fff0: 6c73 2c20 6572 726f 7273 3d65 7272 6f72  ls, errors=error
-00030000: 7329 0a0a 2020 2020 2020 2020 6966 206c  s)..        if l
-00030010: 6162 656c 735f 6b77 6172 6773 206f 7220  abels_kwargs or 
-00030020: 6973 696e 7374 616e 6365 286c 6162 656c  isinstance(label
-00030030: 732c 2064 6963 7429 3a0a 2020 2020 2020  s, dict):.      
-00030040: 2020 2020 2020 6966 2064 696d 2069 7320        if dim is 
-00030050: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00030060: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00030070: 5661 6c75 6545 7272 6f72 2822 6361 6e6e  ValueError("cann
-00030080: 6f74 2073 7065 6369 6679 2064 696d 2061  ot specify dim a
-00030090: 6e64 2064 6963 742d 6c69 6b65 2061 7267  nd dict-like arg
-000300a0: 756d 656e 7473 2e22 290a 2020 2020 2020  uments.").      
-000300b0: 2020 2020 2020 6c61 6265 6c73 203d 2065        labels = e
-000300c0: 6974 6865 725f 6469 6374 5f6f 725f 6b77  ither_dict_or_kw
-000300d0: 6172 6773 286c 6162 656c 732c 206c 6162  args(labels, lab
-000300e0: 656c 735f 6b77 6172 6773 2c20 2264 726f  els_kwargs, "dro
-000300f0: 7022 290a 0a20 2020 2020 2020 2069 6620  p")..        if 
-00030100: 6469 6d20 6973 204e 6f6e 6520 616e 6420  dim is None and 
-00030110: 2869 735f 7363 616c 6172 286c 6162 656c  (is_scalar(label
-00030120: 7329 206f 7220 6973 696e 7374 616e 6365  s) or isinstance
-00030130: 286c 6162 656c 732c 2049 7465 7261 626c  (labels, Iterabl
-00030140: 6529 293a 0a20 2020 2020 2020 2020 2020  e)):.           
-00030150: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
-00030160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030170: 2264 726f 7070 696e 6720 7661 7269 6162  "dropping variab
-00030180: 6c65 7320 7573 696e 6720 6064 726f 7060  les using `drop`
-00030190: 2077 696c 6c20 6265 2064 6570 7265 6361   will be depreca
-000301a0: 7465 643b 2075 7369 6e67 2064 726f 705f  ted; using drop_
-000301b0: 7661 7273 2069 7320 656e 636f 7572 6167  vars is encourag
-000301c0: 6564 2e22 2c0a 2020 2020 2020 2020 2020  ed.",.          
-000301d0: 2020 2020 2020 5065 6e64 696e 6744 6570        PendingDep
-000301e0: 7265 6361 7469 6f6e 5761 726e 696e 672c  recationWarning,
-000301f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00030200: 2073 7461 636b 6c65 7665 6c3d 322c 0a20   stacklevel=2,. 
-00030210: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00030220: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00030230: 7365 6c66 2e64 726f 705f 7661 7273 286c  self.drop_vars(l
-00030240: 6162 656c 732c 2065 7272 6f72 733d 6572  abels, errors=er
-00030250: 726f 7273 290a 2020 2020 2020 2020 6966  rors).        if
-00030260: 2064 696d 2069 7320 6e6f 7420 4e6f 6e65   dim is not None
-00030270: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
-00030280: 726e 696e 6773 2e77 6172 6e28 0a20 2020  rnings.warn(.   
-00030290: 2020 2020 2020 2020 2020 2020 2022 6472               "dr
-000302a0: 6f70 7069 6e67 206c 6162 656c 7320 7573  opping labels us
-000302b0: 696e 6720 6c69 7374 2d6c 696b 6520 6c61  ing list-like la
-000302c0: 6265 6c73 2069 7320 6465 7072 6563 6174  bels is deprecat
-000302d0: 6564 3b20 7573 696e 6720 220a 2020 2020  ed; using ".    
-000302e0: 2020 2020 2020 2020 2020 2020 2264 6963              "dic
-000302f0: 742d 6c69 6b65 2061 7267 756d 656e 7473  t-like arguments
-00030300: 2077 6974 6820 6064 726f 705f 7365 6c60   with `drop_sel`
-00030310: 2c20 652e 672e 2060 6473 2e64 726f 705f  , e.g. `ds.drop_
-00030320: 7365 6c28 6469 6d3d 5b6c 6162 656c 735d  sel(dim=[labels]
-00030330: 292e 222c 0a20 2020 2020 2020 2020 2020  ).",.           
-00030340: 2020 2020 2044 6570 7265 6361 7469 6f6e       Deprecation
-00030350: 5761 726e 696e 672c 0a20 2020 2020 2020  Warning,.       
-00030360: 2020 2020 2020 2020 2073 7461 636b 6c65           stackle
-00030370: 7665 6c3d 322c 0a20 2020 2020 2020 2020  vel=2,.         
-00030380: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00030390: 2072 6574 7572 6e20 7365 6c66 2e64 726f   return self.dro
-000303a0: 705f 7365 6c28 7b64 696d 3a20 6c61 6265  p_sel({dim: labe
-000303b0: 6c73 7d2c 2065 7272 6f72 733d 6572 726f  ls}, errors=erro
-000303c0: 7273 2c20 2a2a 6c61 6265 6c73 5f6b 7761  rs, **labels_kwa
-000303d0: 7267 7329 0a0a 2020 2020 2020 2020 7761  rgs)..        wa
-000303e0: 726e 696e 6773 2e77 6172 6e28 0a20 2020  rnings.warn(.   
-000303f0: 2020 2020 2020 2020 2022 6472 6f70 7069           "droppi
-00030400: 6e67 206c 6162 656c 7320 7573 696e 6720  ng labels using 
-00030410: 6064 726f 7060 2077 696c 6c20 6265 2064  `drop` will be d
-00030420: 6570 7265 6361 7465 643b 2075 7369 6e67  eprecated; using
-00030430: 2064 726f 705f 7365 6c20 6973 2065 6e63   drop_sel is enc
-00030440: 6f75 7261 6765 642e 222c 0a20 2020 2020  ouraged.",.     
-00030450: 2020 2020 2020 2050 656e 6469 6e67 4465         PendingDe
-00030460: 7072 6563 6174 696f 6e57 6172 6e69 6e67  precationWarning
-00030470: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
-00030480: 6163 6b6c 6576 656c 3d32 2c0a 2020 2020  acklevel=2,.    
-00030490: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
-000304a0: 7475 726e 2073 656c 662e 6472 6f70 5f73  turn self.drop_s
-000304b0: 656c 286c 6162 656c 732c 2065 7272 6f72  el(labels, error
-000304c0: 733d 6572 726f 7273 290a 0a20 2020 2064  s=errors)..    d
-000304d0: 6566 2064 726f 705f 7365 6c28 0a20 2020  ef drop_sel(.   
-000304e0: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-000304f0: 6173 6574 2c20 6c61 6265 6c73 3d4e 6f6e  aset, labels=Non
-00030500: 652c 202a 2c20 6572 726f 7273 3a20 4572  e, *, errors: Er
-00030510: 726f 724f 7074 696f 6e73 203d 2022 7261  rorOptions = "ra
-00030520: 6973 6522 2c20 2a2a 6c61 6265 6c73 5f6b  ise", **labels_k
-00030530: 7761 7267 730a 2020 2020 2920 2d3e 2054  wargs.    ) -> T
-00030540: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-00030550: 2020 2222 2244 726f 7020 696e 6465 7820    """Drop index 
-00030560: 6c61 6265 6c73 2066 726f 6d20 7468 6973  labels from this
-00030570: 2064 6174 6173 6574 2e0a 0a20 2020 2020   dataset...     
-00030580: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00030590: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-000305a0: 0a20 2020 2020 2020 206c 6162 656c 7320  .        labels 
-000305b0: 3a20 6d61 7070 696e 6720 6f66 2068 6173  : mapping of has
-000305c0: 6861 626c 6520 746f 2041 6e79 0a20 2020  hable to Any.   
-000305d0: 2020 2020 2020 2020 2049 6e64 6578 206c           Index l
-000305e0: 6162 656c 7320 746f 2064 726f 700a 2020  abels to drop.  
-000305f0: 2020 2020 2020 6572 726f 7273 203a 207b        errors : {
-00030600: 2272 6169 7365 222c 2022 6967 6e6f 7265  "raise", "ignore
-00030610: 227d 2c20 6465 6661 756c 743a 2022 7261  "}, default: "ra
-00030620: 6973 6522 0a20 2020 2020 2020 2020 2020  ise".           
-00030630: 2049 6620 2772 6169 7365 272c 2072 6169   If 'raise', rai
-00030640: 7365 7320 6120 5661 6c75 6545 7272 6f72  ses a ValueError
-00030650: 2065 7272 6f72 2069 660a 2020 2020 2020   error if.      
-00030660: 2020 2020 2020 616e 7920 6f66 2074 6865        any of the
-00030670: 2069 6e64 6578 206c 6162 656c 7320 7061   index labels pa
-00030680: 7373 6564 2061 7265 206e 6f74 0a20 2020  ssed are not.   
-00030690: 2020 2020 2020 2020 2069 6e20 7468 6520           in the 
-000306a0: 6461 7461 7365 742e 2049 6620 2769 676e  dataset. If 'ign
-000306b0: 6f72 6527 2c20 616e 7920 6769 7665 6e20  ore', any given 
-000306c0: 6c61 6265 6c73 2074 6861 7420 6172 6520  labels that are 
-000306d0: 696e 2074 6865 0a20 2020 2020 2020 2020  in the.         
-000306e0: 2020 2064 6174 6173 6574 2061 7265 2064     dataset are d
-000306f0: 726f 7070 6564 2061 6e64 206e 6f20 6572  ropped and no er
-00030700: 726f 7220 6973 2072 6169 7365 642e 0a20  ror is raised.. 
-00030710: 2020 2020 2020 202a 2a6c 6162 656c 735f         **labels_
-00030720: 6b77 6172 6773 203a 207b 6469 6d3a 206c  kwargs : {dim: l
-00030730: 6162 656c 2c20 2e2e 2e7d 2c20 6f70 7469  abel, ...}, opti
-00030740: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00030750: 2054 6865 206b 6579 776f 7264 2061 7267   The keyword arg
-00030760: 756d 656e 7473 2066 6f72 6d20 6f66 2060  uments form of `
-00030770: 6064 696d 6060 2061 6e64 2060 606c 6162  `dim`` and ``lab
-00030780: 656c 7360 600a 0a20 2020 2020 2020 2052  els``..        R
-00030790: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
-000307a0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-000307b0: 726f 7070 6564 203a 2044 6174 6173 6574  ropped : Dataset
-000307c0: 0a0a 2020 2020 2020 2020 4578 616d 706c  ..        Exampl
-000307d0: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
-000307e0: 2d2d 2d0a 2020 2020 2020 2020 3e3e 3e20  ---.        >>> 
-000307f0: 6461 7461 203d 206e 702e 6172 616e 6765  data = np.arange
-00030800: 2836 292e 7265 7368 6170 6528 322c 2033  (6).reshape(2, 3
-00030810: 290a 2020 2020 2020 2020 3e3e 3e20 6c61  ).        >>> la
-00030820: 6265 6c73 203d 205b 2261 222c 2022 6222  bels = ["a", "b"
-00030830: 2c20 2263 225d 0a20 2020 2020 2020 203e  , "c"].        >
-00030840: 3e3e 2064 7320 3d20 7872 2e44 6174 6173  >> ds = xr.Datas
-00030850: 6574 287b 2241 223a 2028 5b22 7822 2c20  et({"A": (["x", 
-00030860: 2279 225d 2c20 6461 7461 292c 2022 7922  "y"], data), "y"
-00030870: 3a20 6c61 6265 6c73 7d29 0a20 2020 2020  : labels}).     
-00030880: 2020 203e 3e3e 2064 730a 2020 2020 2020     >>> ds.      
-00030890: 2020 3c78 6172 7261 792e 4461 7461 7365    <xarray.Datase
-000308a0: 743e 0a20 2020 2020 2020 2044 696d 656e  t>.        Dimen
-000308b0: 7369 6f6e 733a 2020 2878 3a20 322c 2079  sions:  (x: 2, y
-000308c0: 3a20 3329 0a20 2020 2020 2020 2043 6f6f  : 3).        Coo
-000308d0: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
-000308e0: 2020 2020 2a20 7920 2020 2020 2020 2028      * y        (
-000308f0: 7929 203c 5531 2027 6127 2027 6227 2027  y) <U1 'a' 'b' '
-00030900: 6327 0a20 2020 2020 2020 2044 696d 656e  c'.        Dimen
-00030910: 7369 6f6e 7320 7769 7468 6f75 7420 636f  sions without co
-00030920: 6f72 6469 6e61 7465 733a 2078 0a20 2020  ordinates: x.   
-00030930: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
-00030940: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-00030950: 2041 2020 2020 2020 2020 2878 2c20 7929   A        (x, y)
-00030960: 2069 6e74 3634 2030 2031 2032 2033 2034   int64 0 1 2 3 4
-00030970: 2035 0a20 2020 2020 2020 203e 3e3e 2064   5.        >>> d
-00030980: 732e 6472 6f70 5f73 656c 2879 3d5b 2261  s.drop_sel(y=["a
-00030990: 222c 2022 6322 5d29 0a20 2020 2020 2020  ", "c"]).       
-000309a0: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-000309b0: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-000309c0: 696f 6e73 3a20 2028 783a 2032 2c20 793a  ions:  (x: 2, y:
-000309d0: 2031 290a 2020 2020 2020 2020 436f 6f72   1).        Coor
-000309e0: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-000309f0: 2020 202a 2079 2020 2020 2020 2020 2879     * y        (y
-00030a00: 2920 3c55 3120 2762 270a 2020 2020 2020  ) <U1 'b'.      
-00030a10: 2020 4469 6d65 6e73 696f 6e73 2077 6974    Dimensions wit
-00030a20: 686f 7574 2063 6f6f 7264 696e 6174 6573  hout coordinates
-00030a30: 3a20 780a 2020 2020 2020 2020 4461 7461  : x.        Data
-00030a40: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-00030a50: 2020 2020 2020 2020 4120 2020 2020 2020          A       
-00030a60: 2028 782c 2079 2920 696e 7436 3420 3120   (x, y) int64 1 
-00030a70: 340a 2020 2020 2020 2020 3e3e 3e20 6473  4.        >>> ds
-00030a80: 2e64 726f 705f 7365 6c28 793d 2262 2229  .drop_sel(y="b")
-00030a90: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
-00030aa0: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
-00030ab0: 2020 4469 6d65 6e73 696f 6e73 3a20 2028    Dimensions:  (
-00030ac0: 783a 2032 2c20 793a 2032 290a 2020 2020  x: 2, y: 2).    
-00030ad0: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
-00030ae0: 0a20 2020 2020 2020 2020 202a 2079 2020  .          * y  
-00030af0: 2020 2020 2020 2879 2920 3c55 3120 2761        (y) <U1 'a
-00030b00: 2720 2763 270a 2020 2020 2020 2020 4469  ' 'c'.        Di
-00030b10: 6d65 6e73 696f 6e73 2077 6974 686f 7574  mensions without
-00030b20: 2063 6f6f 7264 696e 6174 6573 3a20 780a   coordinates: x.
-00030b30: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-00030b40: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-00030b50: 2020 2020 4120 2020 2020 2020 2028 782c      A        (x,
-00030b60: 2079 2920 696e 7436 3420 3020 3220 3320   y) int64 0 2 3 
-00030b70: 350a 2020 2020 2020 2020 2222 220a 2020  5.        """.  
-00030b80: 2020 2020 2020 6966 2065 7272 6f72 7320        if errors 
-00030b90: 6e6f 7420 696e 205b 2272 6169 7365 222c  not in ["raise",
-00030ba0: 2022 6967 6e6f 7265 225d 3a0a 2020 2020   "ignore"]:.    
-00030bb0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00030bc0: 6c75 6545 7272 6f72 2827 6572 726f 7273  lueError('errors
-00030bd0: 206d 7573 7420 6265 2065 6974 6865 7220   must be either 
-00030be0: 2272 6169 7365 2220 6f72 2022 6967 6e6f  "raise" or "igno
-00030bf0: 7265 2227 290a 0a20 2020 2020 2020 206c  re"')..        l
-00030c00: 6162 656c 7320 3d20 6569 7468 6572 5f64  abels = either_d
-00030c10: 6963 745f 6f72 5f6b 7761 7267 7328 6c61  ict_or_kwargs(la
-00030c20: 6265 6c73 2c20 6c61 6265 6c73 5f6b 7761  bels, labels_kwa
-00030c30: 7267 732c 2022 6472 6f70 5f73 656c 2229  rgs, "drop_sel")
-00030c40: 0a0a 2020 2020 2020 2020 6473 203d 2073  ..        ds = s
-00030c50: 656c 660a 2020 2020 2020 2020 666f 7220  elf.        for 
-00030c60: 6469 6d2c 206c 6162 656c 735f 666f 725f  dim, labels_for_
-00030c70: 6469 6d20 696e 206c 6162 656c 732e 6974  dim in labels.it
-00030c80: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-00030c90: 2020 2023 2044 6f6e 2774 2063 6173 7420     # Don't cast 
-00030ca0: 746f 2073 6574 2c20 6173 2069 7420 776f  to set, as it wo
-00030cb0: 756c 6420 6861 726d 2070 6572 666f 726d  uld harm perform
-00030cc0: 616e 6365 2077 6865 6e20 6c61 6265 6c73  ance when labels
-00030cd0: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
-00030ce0: 7320 6120 6c61 7267 6520 6e75 6d70 7920  s a large numpy 
-00030cf0: 6172 7261 790a 2020 2020 2020 2020 2020  array.          
-00030d00: 2020 6966 2075 7469 6c73 2e69 735f 7363    if utils.is_sc
-00030d10: 616c 6172 286c 6162 656c 735f 666f 725f  alar(labels_for_
-00030d20: 6469 6d29 3a0a 2020 2020 2020 2020 2020  dim):.          
-00030d30: 2020 2020 2020 6c61 6265 6c73 5f66 6f72        labels_for
-00030d40: 5f64 696d 203d 205b 6c61 6265 6c73 5f66  _dim = [labels_f
-00030d50: 6f72 5f64 696d 5d0a 2020 2020 2020 2020  or_dim].        
-00030d60: 2020 2020 6c61 6265 6c73 5f66 6f72 5f64      labels_for_d
-00030d70: 696d 203d 206e 702e 6173 6172 7261 7928  im = np.asarray(
-00030d80: 6c61 6265 6c73 5f66 6f72 5f64 696d 290a  labels_for_dim).
-00030d90: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00030da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00030db0: 2069 6e64 6578 203d 2073 656c 662e 6765   index = self.ge
-00030dc0: 745f 696e 6465 7828 6469 6d29 0a20 2020  t_index(dim).   
-00030dd0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00030de0: 4b65 7945 7272 6f72 3a0a 2020 2020 2020  KeyError:.      
-00030df0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00030e00: 5661 6c75 6545 7272 6f72 2866 2264 696d  ValueError(f"dim
-00030e10: 656e 7369 6f6e 207b 6469 6d21 727d 2064  ension {dim!r} d
-00030e20: 6f65 7320 6e6f 7420 6861 7665 2063 6f6f  oes not have coo
-00030e30: 7264 696e 6174 6520 6c61 6265 6c73 2229  rdinate labels")
-00030e40: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00030e50: 5f69 6e64 6578 203d 2069 6e64 6578 2e64  _index = index.d
-00030e60: 726f 7028 6c61 6265 6c73 5f66 6f72 5f64  rop(labels_for_d
-00030e70: 696d 2c20 6572 726f 7273 3d65 7272 6f72  im, errors=error
-00030e80: 7329 0a20 2020 2020 2020 2020 2020 2064  s).            d
-00030e90: 7320 3d20 6473 2e6c 6f63 5b7b 6469 6d3a  s = ds.loc[{dim:
-00030ea0: 206e 6577 5f69 6e64 6578 7d5d 0a20 2020   new_index}].   
-00030eb0: 2020 2020 2072 6574 7572 6e20 6473 0a0a       return ds..
-00030ec0: 2020 2020 6465 6620 6472 6f70 5f69 7365      def drop_ise
-00030ed0: 6c28 7365 6c66 3a20 545f 4461 7461 7365  l(self: T_Datase
-00030ee0: 742c 2069 6e64 6578 6572 733d 4e6f 6e65  t, indexers=None
-00030ef0: 2c20 2a2a 696e 6465 7865 7273 5f6b 7761  , **indexers_kwa
-00030f00: 7267 7329 202d 3e20 545f 4461 7461 7365  rgs) -> T_Datase
-00030f10: 743a 0a20 2020 2020 2020 2022 2222 4472  t:.        """Dr
-00030f20: 6f70 2069 6e64 6578 2070 6f73 6974 696f  op index positio
-00030f30: 6e73 2066 726f 6d20 7468 6973 2044 6174  ns from this Dat
-00030f40: 6173 6574 2e0a 0a20 2020 2020 2020 2050  aset...        P
-00030f50: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-00030f60: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00030f70: 2020 2020 2069 6e64 6578 6572 7320 3a20       indexers : 
-00030f80: 6d61 7070 696e 6720 6f66 2068 6173 6861  mapping of hasha
-00030f90: 626c 6520 746f 2041 6e79 0a20 2020 2020  ble to Any.     
-00030fa0: 2020 2020 2020 2049 6e64 6578 206c 6f63         Index loc
-00030fb0: 6174 696f 6e73 2074 6f20 6472 6f70 0a20  ations to drop. 
-00030fc0: 2020 2020 2020 202a 2a69 6e64 6578 6572         **indexer
-00030fd0: 735f 6b77 6172 6773 203a 207b 6469 6d3a  s_kwargs : {dim:
-00030fe0: 2070 6f73 6974 696f 6e2c 202e 2e2e 7d2c   position, ...},
-00030ff0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00031000: 2020 2020 2020 5468 6520 6b65 7977 6f72        The keywor
-00031010: 6420 6172 6775 6d65 6e74 7320 666f 726d  d arguments form
-00031020: 206f 6620 6060 6469 6d60 6020 616e 6420   of ``dim`` and 
-00031030: 6060 706f 7369 7469 6f6e 7360 600a 0a20  ``positions``.. 
-00031040: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-00031050: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-00031060: 2020 2020 2020 2064 726f 7070 6564 203a         dropped :
-00031070: 2044 6174 6173 6574 0a0a 2020 2020 2020   Dataset..      
-00031080: 2020 5261 6973 6573 0a20 2020 2020 2020    Raises.       
-00031090: 202d 2d2d 2d2d 2d0a 2020 2020 2020 2020   ------.        
-000310a0: 496e 6465 7845 7272 6f72 0a0a 2020 2020  IndexError..    
-000310b0: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
-000310c0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-000310d0: 2020 2020 2020 3e3e 3e20 6461 7461 203d        >>> data =
-000310e0: 206e 702e 6172 616e 6765 2836 292e 7265   np.arange(6).re
-000310f0: 7368 6170 6528 322c 2033 290a 2020 2020  shape(2, 3).    
-00031100: 2020 2020 3e3e 3e20 6c61 6265 6c73 203d      >>> labels =
-00031110: 205b 2261 222c 2022 6222 2c20 2263 225d   ["a", "b", "c"]
-00031120: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
-00031130: 3d20 7872 2e44 6174 6173 6574 287b 2241  = xr.Dataset({"A
-00031140: 223a 2028 5b22 7822 2c20 2279 225d 2c20  ": (["x", "y"], 
-00031150: 6461 7461 292c 2022 7922 3a20 6c61 6265  data), "y": labe
-00031160: 6c73 7d29 0a20 2020 2020 2020 203e 3e3e  ls}).        >>>
-00031170: 2064 730a 2020 2020 2020 2020 3c78 6172   ds.        <xar
-00031180: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
-00031190: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
-000311a0: 2020 2878 3a20 322c 2079 3a20 3329 0a20    (x: 2, y: 3). 
-000311b0: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
-000311c0: 6573 3a0a 2020 2020 2020 2020 2020 2a20  es:.          * 
-000311d0: 7920 2020 2020 2020 2028 7929 203c 5531  y        (y) <U1
-000311e0: 2027 6127 2027 6227 2027 6327 0a20 2020   'a' 'b' 'c'.   
-000311f0: 2020 2020 2044 696d 656e 7369 6f6e 7320       Dimensions 
-00031200: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
-00031210: 7465 733a 2078 0a20 2020 2020 2020 2044  tes: x.        D
-00031220: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
-00031230: 2020 2020 2020 2020 2020 2041 2020 2020             A    
-00031240: 2020 2020 2878 2c20 7929 2069 6e74 3634      (x, y) int64
-00031250: 2030 2031 2032 2033 2034 2035 0a20 2020   0 1 2 3 4 5.   
-00031260: 2020 2020 203e 3e3e 2064 732e 6472 6f70       >>> ds.drop
-00031270: 5f69 7365 6c28 793d 5b30 2c20 325d 290a  _isel(y=[0, 2]).
-00031280: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-00031290: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-000312a0: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
-000312b0: 3a20 322c 2079 3a20 3129 0a20 2020 2020  : 2, y: 1).     
-000312c0: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-000312d0: 2020 2020 2020 2020 2020 2a20 7920 2020            * y   
-000312e0: 2020 2020 2028 7929 203c 5531 2027 6227       (y) <U1 'b'
-000312f0: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
-00031300: 6f6e 7320 7769 7468 6f75 7420 636f 6f72  ons without coor
-00031310: 6469 6e61 7465 733a 2078 0a20 2020 2020  dinates: x.     
-00031320: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
-00031330: 733a 0a20 2020 2020 2020 2020 2020 2041  s:.            A
-00031340: 2020 2020 2020 2020 2878 2c20 7929 2069          (x, y) i
-00031350: 6e74 3634 2031 2034 0a20 2020 2020 2020  nt64 1 4.       
-00031360: 203e 3e3e 2064 732e 6472 6f70 5f69 7365   >>> ds.drop_ise
-00031370: 6c28 793d 3129 0a20 2020 2020 2020 203c  l(y=1).        <
-00031380: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
-00031390: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-000313a0: 6e73 3a20 2028 783a 2032 2c20 793a 2032  ns:  (x: 2, y: 2
-000313b0: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
-000313c0: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
-000313d0: 202a 2079 2020 2020 2020 2020 2879 2920   * y        (y) 
-000313e0: 3c55 3120 2761 2720 2763 270a 2020 2020  <U1 'a' 'c'.    
-000313f0: 2020 2020 4469 6d65 6e73 696f 6e73 2077      Dimensions w
-00031400: 6974 686f 7574 2063 6f6f 7264 696e 6174  ithout coordinat
-00031410: 6573 3a20 780a 2020 2020 2020 2020 4461  es: x.        Da
-00031420: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
-00031430: 2020 2020 2020 2020 2020 4120 2020 2020            A     
-00031440: 2020 2028 782c 2079 2920 696e 7436 3420     (x, y) int64 
-00031450: 3020 3220 3320 350a 2020 2020 2020 2020  0 2 3 5.        
-00031460: 2222 220a 0a20 2020 2020 2020 2069 6e64  """..        ind
-00031470: 6578 6572 7320 3d20 6569 7468 6572 5f64  exers = either_d
-00031480: 6963 745f 6f72 5f6b 7761 7267 7328 696e  ict_or_kwargs(in
-00031490: 6465 7865 7273 2c20 696e 6465 7865 7273  dexers, indexers
-000314a0: 5f6b 7761 7267 732c 2022 6472 6f70 5f69  _kwargs, "drop_i
-000314b0: 7365 6c22 290a 0a20 2020 2020 2020 2064  sel")..        d
-000314c0: 7320 3d20 7365 6c66 0a20 2020 2020 2020  s = self.       
-000314d0: 2064 696d 656e 7369 6f6e 5f69 6e64 6578   dimension_index
-000314e0: 203d 207b 7d0a 2020 2020 2020 2020 666f   = {}.        fo
-000314f0: 7220 6469 6d2c 2070 6f73 5f66 6f72 5f64  r dim, pos_for_d
-00031500: 696d 2069 6e20 696e 6465 7865 7273 2e69  im in indexers.i
-00031510: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-00031520: 2020 2020 2320 446f 6e27 7420 6361 7374      # Don't cast
-00031530: 2074 6f20 7365 742c 2061 7320 6974 2077   to set, as it w
-00031540: 6f75 6c64 2068 6172 6d20 7065 7266 6f72  ould harm perfor
-00031550: 6d61 6e63 6520 7768 656e 206c 6162 656c  mance when label
-00031560: 730a 2020 2020 2020 2020 2020 2020 2320  s.            # 
-00031570: 6973 2061 206c 6172 6765 206e 756d 7079  is a large numpy
-00031580: 2061 7272 6179 0a20 2020 2020 2020 2020   array.         
-00031590: 2020 2069 6620 7574 696c 732e 6973 5f73     if utils.is_s
-000315a0: 6361 6c61 7228 706f 735f 666f 725f 6469  calar(pos_for_di
-000315b0: 6d29 3a0a 2020 2020 2020 2020 2020 2020  m):.            
-000315c0: 2020 2020 706f 735f 666f 725f 6469 6d20      pos_for_dim 
-000315d0: 3d20 5b70 6f73 5f66 6f72 5f64 696d 5d0a  = [pos_for_dim].
-000315e0: 2020 2020 2020 2020 2020 2020 706f 735f              pos_
-000315f0: 666f 725f 6469 6d20 3d20 6e70 2e61 7361  for_dim = np.asa
-00031600: 7272 6179 2870 6f73 5f66 6f72 5f64 696d  rray(pos_for_dim
-00031610: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
-00031620: 6465 7820 3d20 7365 6c66 2e67 6574 5f69  dex = self.get_i
-00031630: 6e64 6578 2864 696d 290a 2020 2020 2020  ndex(dim).      
-00031640: 2020 2020 2020 6e65 775f 696e 6465 7820        new_index 
-00031650: 3d20 696e 6465 782e 6465 6c65 7465 2870  = index.delete(p
-00031660: 6f73 5f66 6f72 5f64 696d 290a 2020 2020  os_for_dim).    
-00031670: 2020 2020 2020 2020 6469 6d65 6e73 696f          dimensio
-00031680: 6e5f 696e 6465 785b 6469 6d5d 203d 206e  n_index[dim] = n
-00031690: 6577 5f69 6e64 6578 0a20 2020 2020 2020  ew_index.       
-000316a0: 2064 7320 3d20 6473 2e6c 6f63 5b64 696d   ds = ds.loc[dim
-000316b0: 656e 7369 6f6e 5f69 6e64 6578 5d0a 2020  ension_index].  
-000316c0: 2020 2020 2020 7265 7475 726e 2064 730a        return ds.
-000316d0: 0a20 2020 2064 6566 2064 726f 705f 6469  .    def drop_di
-000316e0: 6d73 280a 2020 2020 2020 2020 7365 6c66  ms(.        self
-000316f0: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
-00031700: 2020 2020 2064 726f 705f 6469 6d73 3a20       drop_dims: 
-00031710: 7374 7220 7c20 4974 6572 6162 6c65 5b48  str | Iterable[H
-00031720: 6173 6861 626c 655d 2c0a 2020 2020 2020  ashable],.      
-00031730: 2020 2a2c 0a20 2020 2020 2020 2065 7272    *,.        err
-00031740: 6f72 733a 2045 7272 6f72 4f70 7469 6f6e  ors: ErrorOption
-00031750: 7320 3d20 2272 6169 7365 222c 0a20 2020  s = "raise",.   
-00031760: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
-00031770: 0a20 2020 2020 2020 2022 2222 4472 6f70  .        """Drop
-00031780: 2064 696d 656e 7369 6f6e 7320 616e 6420   dimensions and 
-00031790: 6173 736f 6369 6174 6564 2076 6172 6961  associated varia
-000317a0: 626c 6573 2066 726f 6d20 7468 6973 2064  bles from this d
-000317b0: 6174 6173 6574 2e0a 0a20 2020 2020 2020  ataset...       
-000317c0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-000317d0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-000317e0: 2020 2020 2020 2064 726f 705f 6469 6d73         drop_dims
-000317f0: 203a 2073 7472 206f 7220 4974 6572 6162   : str or Iterab
-00031800: 6c65 206f 6620 4861 7368 6162 6c65 0a20  le of Hashable. 
-00031810: 2020 2020 2020 2020 2020 2044 696d 656e             Dimen
-00031820: 7369 6f6e 206f 7220 6469 6d65 6e73 696f  sion or dimensio
-00031830: 6e73 2074 6f20 6472 6f70 2e0a 2020 2020  ns to drop..    
-00031840: 2020 2020 6572 726f 7273 203a 207b 2272      errors : {"r
-00031850: 6169 7365 222c 2022 6967 6e6f 7265 227d  aise", "ignore"}
-00031860: 2c20 6465 6661 756c 743a 2022 7261 6973  , default: "rais
-00031870: 6522 0a20 2020 2020 2020 2020 2020 2049  e".            I
-00031880: 6620 2772 6169 7365 272c 2072 6169 7365  f 'raise', raise
-00031890: 7320 6120 5661 6c75 6545 7272 6f72 2065  s a ValueError e
-000318a0: 7272 6f72 2069 6620 616e 7920 6f66 2074  rror if any of t
-000318b0: 6865 0a20 2020 2020 2020 2020 2020 2064  he.            d
-000318c0: 696d 656e 7369 6f6e 7320 7061 7373 6564  imensions passed
-000318d0: 2061 7265 206e 6f74 2069 6e20 7468 6520   are not in the 
-000318e0: 6461 7461 7365 742e 2049 6620 2769 676e  dataset. If 'ign
-000318f0: 6f72 6527 2c20 616e 7920 6769 7665 6e0a  ore', any given.
-00031900: 2020 2020 2020 2020 2020 2020 6469 6d65              dime
-00031910: 6e73 696f 6e73 2074 6861 7420 6172 6520  nsions that are 
-00031920: 696e 2074 6865 2064 6174 6173 6574 2061  in the dataset a
-00031930: 7265 2064 726f 7070 6564 2061 6e64 206e  re dropped and n
-00031940: 6f20 6572 726f 7220 6973 2072 6169 7365  o error is raise
-00031950: 642e 0a0a 2020 2020 2020 2020 5265 7475  d...        Retu
-00031960: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-00031970: 2d2d 2d0a 2020 2020 2020 2020 6f62 6a20  ---.        obj 
-00031980: 3a20 4461 7461 7365 740a 2020 2020 2020  : Dataset.      
-00031990: 2020 2020 2020 5468 6520 6461 7461 7365        The datase
-000319a0: 7420 7769 7468 6f75 7420 7468 6520 6769  t without the gi
-000319b0: 7665 6e20 6469 6d65 6e73 696f 6e73 2028  ven dimensions (
-000319c0: 6f72 2061 6e79 2076 6172 6961 626c 6573  or any variables
-000319d0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-000319e0: 7461 696e 696e 6720 7468 6f73 6520 6469  taining those di
-000319f0: 6d65 6e73 696f 6e73 292e 0a20 2020 2020  mensions)..     
-00031a00: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00031a10: 6620 6572 726f 7273 206e 6f74 2069 6e20  f errors not in 
-00031a20: 5b22 7261 6973 6522 2c20 2269 676e 6f72  ["raise", "ignor
-00031a30: 6522 5d3a 0a20 2020 2020 2020 2020 2020  e"]:.           
-00031a40: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00031a50: 7228 2765 7272 6f72 7320 6d75 7374 2062  r('errors must b
-00031a60: 6520 6569 7468 6572 2022 7261 6973 6522  e either "raise"
-00031a70: 206f 7220 2269 676e 6f72 6522 2729 0a0a   or "ignore"')..
-00031a80: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00031a90: 7461 6e63 6528 6472 6f70 5f64 696d 732c  tance(drop_dims,
-00031aa0: 2073 7472 2920 6f72 206e 6f74 2069 7369   str) or not isi
-00031ab0: 6e73 7461 6e63 6528 6472 6f70 5f64 696d  nstance(drop_dim
-00031ac0: 732c 2049 7465 7261 626c 6529 3a0a 2020  s, Iterable):.  
-00031ad0: 2020 2020 2020 2020 2020 6472 6f70 5f64            drop_d
-00031ae0: 696d 7320 3d20 7b64 726f 705f 6469 6d73  ims = {drop_dims
-00031af0: 7d0a 2020 2020 2020 2020 656c 7365 3a0a  }.        else:.
-00031b00: 2020 2020 2020 2020 2020 2020 6472 6f70              drop
-00031b10: 5f64 696d 7320 3d20 7365 7428 6472 6f70  _dims = set(drop
-00031b20: 5f64 696d 7329 0a0a 2020 2020 2020 2020  _dims)..        
-00031b30: 6966 2065 7272 6f72 7320 3d3d 2022 7261  if errors == "ra
-00031b40: 6973 6522 3a0a 2020 2020 2020 2020 2020  ise":.          
-00031b50: 2020 6d69 7373 696e 675f 6469 6d73 203d    missing_dims =
-00031b60: 2064 726f 705f 6469 6d73 202d 2073 6574   drop_dims - set
-00031b70: 2873 656c 662e 6469 6d73 290a 2020 2020  (self.dims).    
-00031b80: 2020 2020 2020 2020 6966 206d 6973 7369          if missi
-00031b90: 6e67 5f64 696d 733a 0a20 2020 2020 2020  ng_dims:.       
-00031ba0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00031bb0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00031bc0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00031bd0: 2244 6174 6173 6574 2064 6f65 7320 6e6f  "Dataset does no
-00031be0: 7420 636f 6e74 6169 6e20 7468 6520 6469  t contain the di
-00031bf0: 6d65 6e73 696f 6e73 3a20 7b6d 6973 7369  mensions: {missi
-00031c00: 6e67 5f64 696d 737d 220a 2020 2020 2020  ng_dims}".      
-00031c10: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00031c20: 2020 2020 2064 726f 705f 7661 7273 203d       drop_vars =
-00031c30: 207b 6b20 666f 7220 6b2c 2076 2069 6e20   {k for k, v in 
-00031c40: 7365 6c66 2e5f 7661 7269 6162 6c65 732e  self._variables.
-00031c50: 6974 656d 7328 2920 6966 2073 6574 2876  items() if set(v
-00031c60: 2e64 696d 7329 2026 2064 726f 705f 6469  .dims) & drop_di
-00031c70: 6d73 7d0a 2020 2020 2020 2020 7265 7475  ms}.        retu
-00031c80: 726e 2073 656c 662e 6472 6f70 5f76 6172  rn self.drop_var
-00031c90: 7328 6472 6f70 5f76 6172 7329 0a0a 2020  s(drop_vars)..  
-00031ca0: 2020 6465 6620 7472 616e 7370 6f73 6528    def transpose(
-00031cb0: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
-00031cc0: 5f44 6174 6173 6574 2c0a 2020 2020 2020  _Dataset,.      
-00031cd0: 2020 2a64 696d 733a 2048 6173 6861 626c    *dims: Hashabl
-00031ce0: 652c 0a20 2020 2020 2020 206d 6973 7369  e,.        missi
-00031cf0: 6e67 5f64 696d 733a 2045 7272 6f72 4f70  ng_dims: ErrorOp
-00031d00: 7469 6f6e 7357 6974 6857 6172 6e20 3d20  tionsWithWarn = 
-00031d10: 2272 6169 7365 222c 0a20 2020 2029 202d  "raise",.    ) -
-00031d20: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-00031d30: 2020 2020 2022 2222 5265 7475 726e 2061       """Return a
-00031d40: 206e 6577 2044 6174 6173 6574 206f 626a   new Dataset obj
-00031d50: 6563 7420 7769 7468 2061 6c6c 2061 7272  ect with all arr
-00031d60: 6179 2064 696d 656e 7369 6f6e 7320 7472  ay dimensions tr
-00031d70: 616e 7370 6f73 6564 2e0a 0a20 2020 2020  ansposed...     
-00031d80: 2020 2041 6c74 686f 7567 6820 7468 6520     Although the 
-00031d90: 6f72 6465 7220 6f66 2064 696d 656e 7369  order of dimensi
-00031da0: 6f6e 7320 6f6e 2065 6163 6820 6172 7261  ons on each arra
-00031db0: 7920 7769 6c6c 2063 6861 6e67 652c 2074  y will change, t
-00031dc0: 6865 2064 6174 6173 6574 0a20 2020 2020  he dataset.     
-00031dd0: 2020 2064 696d 656e 7369 6f6e 7320 7468     dimensions th
-00031de0: 656d 7365 6c76 6573 2077 696c 6c20 7265  emselves will re
-00031df0: 6d61 696e 2069 6e20 6669 7865 6420 2873  main in fixed (s
-00031e00: 6f72 7465 6429 206f 7264 6572 2e0a 0a20  orted) order... 
-00031e10: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00031e20: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00031e30: 2d2d 2d2d 0a20 2020 2020 2020 202a 6469  ----.        *di
-00031e40: 6d73 203a 2068 6173 6861 626c 652c 206f  ms : hashable, o
-00031e50: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00031e60: 2020 2020 4279 2064 6566 6175 6c74 2c20      By default, 
-00031e70: 7265 7665 7273 6520 7468 6520 6469 6d65  reverse the dime
-00031e80: 6e73 696f 6e73 206f 6e20 6561 6368 2061  nsions on each a
-00031e90: 7272 6179 2e20 4f74 6865 7277 6973 652c  rray. Otherwise,
-00031ea0: 0a20 2020 2020 2020 2020 2020 2072 656f  .            reo
-00031eb0: 7264 6572 2074 6865 2064 696d 656e 7369  rder the dimensi
-00031ec0: 6f6e 7320 746f 2074 6869 7320 6f72 6465  ons to this orde
-00031ed0: 722e 0a20 2020 2020 2020 206d 6973 7369  r..        missi
-00031ee0: 6e67 5f64 696d 7320 3a20 7b22 7261 6973  ng_dims : {"rais
-00031ef0: 6522 2c20 2277 6172 6e22 2c20 2269 676e  e", "warn", "ign
-00031f00: 6f72 6522 7d2c 2064 6566 6175 6c74 3a20  ore"}, default: 
-00031f10: 2272 6169 7365 220a 2020 2020 2020 2020  "raise".        
-00031f20: 2020 2020 5768 6174 2074 6f20 646f 2069      What to do i
-00031f30: 6620 6469 6d65 6e73 696f 6e73 2074 6861  f dimensions tha
-00031f40: 7420 7368 6f75 6c64 2062 6520 7365 6c65  t should be sele
-00031f50: 6374 6564 2066 726f 6d20 6172 6520 6e6f  cted from are no
-00031f60: 7420 7072 6573 656e 7420 696e 2074 6865  t present in the
-00031f70: 0a20 2020 2020 2020 2020 2020 2044 6174  .            Dat
-00031f80: 6173 6574 3a0a 2020 2020 2020 2020 2020  aset:.          
-00031f90: 2020 2d20 2272 6169 7365 223a 2072 6169    - "raise": rai
-00031fa0: 7365 2061 6e20 6578 6365 7074 696f 6e0a  se an exception.
-00031fb0: 2020 2020 2020 2020 2020 2020 2d20 2277              - "w
-00031fc0: 6172 6e22 3a20 7261 6973 6520 6120 7761  arn": raise a wa
-00031fd0: 726e 696e 672c 2061 6e64 2069 676e 6f72  rning, and ignor
-00031fe0: 6520 7468 6520 6d69 7373 696e 6720 6469  e the missing di
-00031ff0: 6d65 6e73 696f 6e73 0a20 2020 2020 2020  mensions.       
-00032000: 2020 2020 202d 2022 6967 6e6f 7265 223a       - "ignore":
-00032010: 2069 676e 6f72 6520 7468 6520 6d69 7373   ignore the miss
-00032020: 696e 6720 6469 6d65 6e73 696f 6e73 0a0a  ing dimensions..
-00032030: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-00032040: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-00032050: 2020 2020 2020 2020 7472 616e 7370 6f73          transpos
-00032060: 6564 203a 2044 6174 6173 6574 0a20 2020  ed : Dataset.   
-00032070: 2020 2020 2020 2020 2045 6163 6820 6172           Each ar
-00032080: 7261 7920 696e 2074 6865 2064 6174 6173  ray in the datas
-00032090: 6574 2028 696e 636c 7564 696e 6729 2063  et (including) c
-000320a0: 6f6f 7264 696e 6174 6573 2077 696c 6c20  oordinates will 
-000320b0: 6265 0a20 2020 2020 2020 2020 2020 2074  be.            t
-000320c0: 7261 6e73 706f 7365 6420 746f 2074 6865  ransposed to the
-000320d0: 2067 6976 656e 206f 7264 6572 2e0a 0a20   given order... 
-000320e0: 2020 2020 2020 204e 6f74 6573 0a20 2020         Notes.   
-000320f0: 2020 2020 202d 2d2d 2d2d 0a20 2020 2020       -----.     
-00032100: 2020 2054 6869 7320 6f70 6572 6174 696f     This operatio
-00032110: 6e20 7265 7475 726e 7320 6120 7669 6577  n returns a view
-00032120: 206f 6620 6561 6368 2061 7272 6179 2773   of each array's
-00032130: 2064 6174 612e 2049 7420 6973 0a20 2020   data. It is.   
-00032140: 2020 2020 206c 617a 7920 666f 7220 6461       lazy for da
-00032150: 736b 2d62 6163 6b65 6420 4461 7461 4172  sk-backed DataAr
-00032160: 7261 7973 2062 7574 206e 6f74 2066 6f72  rays but not for
-00032170: 206e 756d 7079 2d62 6163 6b65 6420 4461   numpy-backed Da
-00032180: 7461 4172 7261 7973 0a20 2020 2020 2020  taArrays.       
-00032190: 202d 2d20 7468 6520 6461 7461 2077 696c   -- the data wil
-000321a0: 6c20 6265 2066 756c 6c79 206c 6f61 6465  l be fully loade
-000321b0: 6420 696e 746f 206d 656d 6f72 792e 0a0a  d into memory...
-000321c0: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-000321d0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-000321e0: 2d0a 2020 2020 2020 2020 6e75 6d70 792e  -.        numpy.
-000321f0: 7472 616e 7370 6f73 650a 2020 2020 2020  transpose.      
-00032200: 2020 4461 7461 4172 7261 792e 7472 616e    DataArray.tran
-00032210: 7370 6f73 650a 2020 2020 2020 2020 2222  spose.        ""
-00032220: 220a 2020 2020 2020 2020 2320 5261 6973  ".        # Rais
-00032230: 6520 6572 726f 7220 6966 206c 6973 7420  e error if list 
-00032240: 6973 2070 6173 7365 6420 6173 2064 696d  is passed as dim
-00032250: 730a 2020 2020 2020 2020 6966 2028 6c65  s.        if (le
-00032260: 6e28 6469 6d73 2920 3e20 3029 2061 6e64  n(dims) > 0) and
-00032270: 2028 6973 696e 7374 616e 6365 2864 696d   (isinstance(dim
-00032280: 735b 305d 2c20 6c69 7374 2929 3a0a 2020  s[0], list)):.  
-00032290: 2020 2020 2020 2020 2020 6c69 7374 5f66            list_f
-000322a0: 6978 203d 205b 6622 7b72 6570 7228 7829  ix = [f"{repr(x)
-000322b0: 7d22 2069 6620 6973 696e 7374 616e 6365  }" if isinstance
-000322c0: 2878 2c20 7374 7229 2065 6c73 6520 6622  (x, str) else f"
-000322d0: 7b78 7d22 2066 6f72 2078 2069 6e20 6469  {x}" for x in di
-000322e0: 6d73 5b30 5d5d 0a20 2020 2020 2020 2020  ms[0]].         
-000322f0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-00032300: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00032310: 2020 2020 6627 7472 616e 7370 6f73 6520      f'transpose 
-00032320: 7265 7175 6972 6573 2064 696d 7320 746f  requires dims to
-00032330: 2062 6520 7061 7373 6564 2061 7320 6d75   be passed as mu
-00032340: 6c74 6970 6c65 2061 7267 756d 656e 7473  ltiple arguments
-00032350: 2e20 4578 7065 6374 6564 2060 7b22 2c20  . Expected `{", 
-00032360: 222e 6a6f 696e 286c 6973 745f 6669 7829  ".join(list_fix)
-00032370: 7d60 2e20 5265 6365 6976 6564 2060 7b64  }`. Received `{d
-00032380: 696d 735b 305d 7d60 2069 6e73 7465 6164  ims[0]}` instead
-00032390: 270a 2020 2020 2020 2020 2020 2020 290a  '.            ).
-000323a0: 0a20 2020 2020 2020 2023 2055 7365 2069  .        # Use i
-000323b0: 6e66 6978 5f64 696d 7320 746f 2063 6865  nfix_dims to che
-000323c0: 636b 206f 6e63 6520 666f 7220 6d69 7373  ck once for miss
-000323d0: 696e 6720 6469 6d65 6e73 696f 6e73 0a20  ing dimensions. 
-000323e0: 2020 2020 2020 2069 6620 6c65 6e28 6469         if len(di
-000323f0: 6d73 2920 213d 2030 3a0a 2020 2020 2020  ms) != 0:.      
-00032400: 2020 2020 2020 5f20 3d20 6c69 7374 2869        _ = list(i
-00032410: 6e66 6978 5f64 696d 7328 6469 6d73 2c20  nfix_dims(dims, 
-00032420: 7365 6c66 2e64 696d 732c 206d 6973 7369  self.dims, missi
-00032430: 6e67 5f64 696d 7329 290a 0a20 2020 2020  ng_dims))..     
-00032440: 2020 2064 7320 3d20 7365 6c66 2e63 6f70     ds = self.cop
-00032450: 7928 290a 2020 2020 2020 2020 666f 7220  y().        for 
-00032460: 6e61 6d65 2c20 7661 7220 696e 2073 656c  name, var in sel
-00032470: 662e 5f76 6172 6961 626c 6573 2e69 7465  f._variables.ite
-00032480: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00032490: 2020 7661 725f 6469 6d73 203d 2074 7570    var_dims = tup
-000324a0: 6c65 2864 696d 2066 6f72 2064 696d 2069  le(dim for dim i
-000324b0: 6e20 6469 6d73 2069 6620 6469 6d20 696e  n dims if dim in
-000324c0: 2028 7661 722e 6469 6d73 202b 2028 2e2e   (var.dims + (..
-000324d0: 2e2c 2929 290a 2020 2020 2020 2020 2020  .,))).          
-000324e0: 2020 6473 2e5f 7661 7269 6162 6c65 735b    ds._variables[
-000324f0: 6e61 6d65 5d20 3d20 7661 722e 7472 616e  name] = var.tran
-00032500: 7370 6f73 6528 2a76 6172 5f64 696d 7329  spose(*var_dims)
-00032510: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00032520: 6473 0a0a 2020 2020 6465 6620 6472 6f70  ds..    def drop
-00032530: 6e61 280a 2020 2020 2020 2020 7365 6c66  na(.        self
-00032540: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
-00032550: 2020 2020 2064 696d 3a20 4861 7368 6162       dim: Hashab
-00032560: 6c65 2c0a 2020 2020 2020 2020 686f 773a  le,.        how:
-00032570: 204c 6974 6572 616c 5b22 616e 7922 2c20   Literal["any", 
-00032580: 2261 6c6c 225d 203d 2022 616e 7922 2c0a  "all"] = "any",.
-00032590: 2020 2020 2020 2020 7468 7265 7368 3a20          thresh: 
-000325a0: 696e 7420 7c20 4e6f 6e65 203d 204e 6f6e  int | None = Non
-000325b0: 652c 0a20 2020 2020 2020 2073 7562 7365  e,.        subse
-000325c0: 743a 2049 7465 7261 626c 655b 4861 7368  t: Iterable[Hash
-000325d0: 6162 6c65 5d20 7c20 4e6f 6e65 203d 204e  able] | None = N
-000325e0: 6f6e 652c 0a20 2020 2029 202d 3e20 545f  one,.    ) -> T_
-000325f0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-00032600: 2022 2222 5265 7475 726e 7320 6120 6e65   """Returns a ne
-00032610: 7720 6461 7461 7365 7420 7769 7468 2064  w dataset with d
-00032620: 726f 7070 6564 206c 6162 656c 7320 666f  ropped labels fo
-00032630: 7220 6d69 7373 696e 6720 7661 6c75 6573  r missing values
-00032640: 2061 6c6f 6e67 0a20 2020 2020 2020 2074   along.        t
-00032650: 6865 2070 726f 7669 6465 6420 6469 6d65  he provided dime
-00032660: 6e73 696f 6e2e 0a0a 2020 2020 2020 2020  nsion...        
-00032670: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00032680: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00032690: 2020 2020 2020 6469 6d20 3a20 6861 7368        dim : hash
-000326a0: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
-000326b0: 2044 696d 656e 7369 6f6e 2061 6c6f 6e67   Dimension along
-000326c0: 2077 6869 6368 2074 6f20 6472 6f70 206d   which to drop m
-000326d0: 6973 7369 6e67 2076 616c 7565 732e 2044  issing values. D
-000326e0: 726f 7070 696e 6720 616c 6f6e 670a 2020  ropping along.  
-000326f0: 2020 2020 2020 2020 2020 6d75 6c74 6970            multip
-00032700: 6c65 2064 696d 656e 7369 6f6e 7320 7369  le dimensions si
-00032710: 6d75 6c74 616e 656f 7573 6c79 2069 7320  multaneously is 
-00032720: 6e6f 7420 7965 7420 7375 7070 6f72 7465  not yet supporte
-00032730: 642e 0a20 2020 2020 2020 2068 6f77 203a  d..        how :
-00032740: 207b 2261 6e79 222c 2022 616c 6c22 7d2c   {"any", "all"},
-00032750: 2064 6566 6175 6c74 3a20 2261 6e79 220a   default: "any".
-00032760: 2020 2020 2020 2020 2020 2020 2d20 616e              - an
-00032770: 7920 3a20 6966 2061 6e79 204e 4120 7661  y : if any NA va
-00032780: 6c75 6573 2061 7265 2070 7265 7365 6e74  lues are present
-00032790: 2c20 6472 6f70 2074 6861 7420 6c61 6265  , drop that labe
-000327a0: 6c0a 2020 2020 2020 2020 2020 2020 2d20  l.            - 
-000327b0: 616c 6c20 3a20 6966 2061 6c6c 2076 616c  all : if all val
-000327c0: 7565 7320 6172 6520 4e41 2c20 6472 6f70  ues are NA, drop
-000327d0: 2074 6861 7420 6c61 6265 6c0a 0a20 2020   that label..   
-000327e0: 2020 2020 2074 6872 6573 6820 3a20 696e       thresh : in
-000327f0: 7420 6f72 204e 6f6e 652c 206f 7074 696f  t or None, optio
-00032800: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00032810: 4966 2073 7570 706c 6965 642c 2072 6571  If supplied, req
-00032820: 7569 7265 2074 6869 7320 6d61 6e79 206e  uire this many n
-00032830: 6f6e 2d4e 4120 7661 6c75 6573 2028 7375  on-NA values (su
-00032840: 6d6d 6564 206f 7665 7220 616c 6c20 7468  mmed over all th
-00032850: 6520 7375 6273 6574 2076 6172 6961 626c  e subset variabl
-00032860: 6573 292e 0a20 2020 2020 2020 2073 7562  es)..        sub
-00032870: 7365 7420 3a20 6974 6572 6162 6c65 206f  set : iterable o
-00032880: 6620 6861 7368 6162 6c65 206f 7220 4e6f  f hashable or No
-00032890: 6e65 2c20 6f70 7469 6f6e 616c 0a20 2020  ne, optional.   
-000328a0: 2020 2020 2020 2020 2057 6869 6368 2076           Which v
-000328b0: 6172 6961 626c 6573 2074 6f20 6368 6563  ariables to chec
-000328c0: 6b20 666f 7220 6d69 7373 696e 6720 7661  k for missing va
-000328d0: 6c75 6573 2e20 4279 2064 6566 6175 6c74  lues. By default
-000328e0: 2c20 616c 6c0a 2020 2020 2020 2020 2020  , all.          
-000328f0: 2020 7661 7269 6162 6c65 7320 696e 2074    variables in t
-00032900: 6865 2064 6174 6173 6574 2061 7265 2063  he dataset are c
-00032910: 6865 636b 6564 2e0a 0a20 2020 2020 2020  hecked...       
-00032920: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-00032930: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-00032940: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
-00032950: 2022 2222 0a20 2020 2020 2020 2023 2054   """.        # T
-00032960: 4f44 4f3a 2063 6f6e 7369 6465 7220 7375  ODO: consider su
-00032970: 7070 6f72 7469 6e67 206d 756c 7469 706c  pporting multipl
-00032980: 6520 6469 6d65 6e73 696f 6e73 3f20 4f72  e dimensions? Or
-00032990: 206e 6f74 2c20 6769 7665 6e20 7468 6174   not, given that
-000329a0: 0a20 2020 2020 2020 2023 2074 6865 7265  .        # there
-000329b0: 2061 7265 2073 6f6d 6520 7567 6c79 2065   are some ugly e
-000329c0: 6467 6520 6361 7365 732c 2065 2e67 2e2c  dge cases, e.g.,
-000329d0: 2070 616e 6461 7327 7320 6472 6f70 6e61   pandas's dropna
-000329e0: 2064 6966 6665 7273 0a20 2020 2020 2020   differs.       
-000329f0: 2023 2064 6570 656e 6469 6e67 206f 6e20   # depending on 
-00032a00: 7468 6520 6f72 6465 7220 6f66 2074 6865  the order of the
-00032a10: 2073 7570 706c 6965 6420 6178 6573 2e0a   supplied axes..
-00032a20: 0a20 2020 2020 2020 2069 6620 6469 6d20  .        if dim 
-00032a30: 6e6f 7420 696e 2073 656c 662e 6469 6d73  not in self.dims
-00032a40: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00032a50: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-00032a60: 227b 6469 6d7d 206d 7573 7420 6265 2061  "{dim} must be a
-00032a70: 2073 696e 676c 6520 6461 7461 7365 7420   single dataset 
-00032a80: 6469 6d65 6e73 696f 6e22 290a 0a20 2020  dimension")..   
-00032a90: 2020 2020 2069 6620 7375 6273 6574 2069       if subset i
-00032aa0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00032ab0: 2020 2020 7375 6273 6574 203d 2069 7465      subset = ite
-00032ac0: 7228 7365 6c66 2e64 6174 615f 7661 7273  r(self.data_vars
-00032ad0: 290a 0a20 2020 2020 2020 2063 6f75 6e74  )..        count
-00032ae0: 203d 206e 702e 7a65 726f 7328 7365 6c66   = np.zeros(self
-00032af0: 2e64 696d 735b 6469 6d5d 2c20 6474 7970  .dims[dim], dtyp
-00032b00: 653d 6e70 2e69 6e74 3634 290a 2020 2020  e=np.int64).    
-00032b10: 2020 2020 7369 7a65 203d 206e 702e 696e      size = np.in
-00032b20: 745f 2830 2920 2023 2066 6f72 2074 7970  t_(0)  # for typ
-00032b30: 6520 6368 6563 6b69 6e67 0a0a 2020 2020  e checking..    
-00032b40: 2020 2020 666f 7220 6b20 696e 2073 7562      for k in sub
-00032b50: 7365 743a 0a20 2020 2020 2020 2020 2020  set:.           
-00032b60: 2061 7272 6179 203d 2073 656c 662e 5f76   array = self._v
-00032b70: 6172 6961 626c 6573 5b6b 5d0a 2020 2020  ariables[k].    
-00032b80: 2020 2020 2020 2020 6966 2064 696d 2069          if dim i
-00032b90: 6e20 6172 7261 792e 6469 6d73 3a0a 2020  n array.dims:.  
-00032ba0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00032bb0: 6d73 203d 205b 6420 666f 7220 6420 696e  ms = [d for d in
-00032bc0: 2061 7272 6179 2e64 696d 7320 6966 2064   array.dims if d
-00032bd0: 2021 3d20 6469 6d5d 0a20 2020 2020 2020   != dim].       
-00032be0: 2020 2020 2020 2020 2063 6f75 6e74 202b           count +
-00032bf0: 3d20 6e70 2e61 7361 7272 6179 2861 7272  = np.asarray(arr
-00032c00: 6179 2e63 6f75 6e74 2864 696d 7329 2920  ay.count(dims)) 
-00032c10: 2023 2074 7970 653a 2069 676e 6f72 655b   # type: ignore[
-00032c20: 6174 7472 2d64 6566 696e 6564 5d0a 2020  attr-defined].  
-00032c30: 2020 2020 2020 2020 2020 2020 2020 7369                si
-00032c40: 7a65 202b 3d20 6d61 7468 2e70 726f 6428  ze += math.prod(
-00032c50: 5b73 656c 662e 6469 6d73 5b64 5d20 666f  [self.dims[d] fo
-00032c60: 7220 6420 696e 2064 696d 735d 290a 0a20  r d in dims]).. 
-00032c70: 2020 2020 2020 2069 6620 7468 7265 7368         if thresh
-00032c80: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00032c90: 2020 2020 2020 2020 2020 6d61 736b 203d            mask =
-00032ca0: 2063 6f75 6e74 203e 3d20 7468 7265 7368   count >= thresh
-00032cb0: 0a20 2020 2020 2020 2065 6c69 6620 686f  .        elif ho
-00032cc0: 7720 3d3d 2022 616e 7922 3a0a 2020 2020  w == "any":.    
-00032cd0: 2020 2020 2020 2020 6d61 736b 203d 2063          mask = c
-00032ce0: 6f75 6e74 203d 3d20 7369 7a65 0a20 2020  ount == size.   
-00032cf0: 2020 2020 2065 6c69 6620 686f 7720 3d3d       elif how ==
-00032d00: 2022 616c 6c22 3a0a 2020 2020 2020 2020   "all":.        
-00032d10: 2020 2020 6d61 736b 203d 2063 6f75 6e74      mask = count
-00032d20: 203e 2030 0a20 2020 2020 2020 2065 6c69   > 0.        eli
-00032d30: 6620 686f 7720 6973 206e 6f74 204e 6f6e  f how is not Non
-00032d40: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00032d50: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00032d60: 6622 696e 7661 6c69 6420 686f 7720 6f70  f"invalid how op
-00032d70: 7469 6f6e 3a20 7b68 6f77 7d22 290a 2020  tion: {how}").  
-00032d80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00032d90: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-00032da0: 7065 4572 726f 7228 226d 7573 7420 7370  peError("must sp
-00032db0: 6563 6966 7920 686f 7720 6f72 2074 6872  ecify how or thr
-00032dc0: 6573 6822 290a 0a20 2020 2020 2020 2072  esh")..        r
-00032dd0: 6574 7572 6e20 7365 6c66 2e69 7365 6c28  eturn self.isel(
-00032de0: 7b64 696d 3a20 6d61 736b 7d29 0a0a 2020  {dim: mask})..  
-00032df0: 2020 6465 6620 6669 6c6c 6e61 2873 656c    def fillna(sel
-00032e00: 663a 2054 5f44 6174 6173 6574 2c20 7661  f: T_Dataset, va
-00032e10: 6c75 653a 2041 6e79 2920 2d3e 2054 5f44  lue: Any) -> T_D
-00032e20: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-00032e30: 2222 2246 696c 6c20 6d69 7373 696e 6720  """Fill missing 
-00032e40: 7661 6c75 6573 2069 6e20 7468 6973 206f  values in this o
-00032e50: 626a 6563 742e 0a0a 2020 2020 2020 2020  bject...        
-00032e60: 5468 6973 206f 7065 7261 7469 6f6e 2066  This operation f
-00032e70: 6f6c 6c6f 7773 2074 6865 206e 6f72 6d61  ollows the norma
-00032e80: 6c20 6272 6f61 6463 6173 7469 6e67 2061  l broadcasting a
-00032e90: 6e64 2061 6c69 676e 6d65 6e74 2072 756c  nd alignment rul
-00032ea0: 6573 2074 6861 740a 2020 2020 2020 2020  es that.        
-00032eb0: 7861 7272 6179 2075 7365 7320 666f 7220  xarray uses for 
-00032ec0: 6269 6e61 7279 2061 7269 7468 6d65 7469  binary arithmeti
-00032ed0: 632c 2065 7863 6570 7420 7468 6520 7265  c, except the re
-00032ee0: 7375 6c74 2069 7320 616c 6967 6e65 6420  sult is aligned 
-00032ef0: 746f 2074 6869 730a 2020 2020 2020 2020  to this.        
-00032f00: 6f62 6a65 6374 2028 6060 6a6f 696e 3d27  object (``join='
-00032f10: 6c65 6674 2760 6029 2069 6e73 7465 6164  left'``) instead
-00032f20: 206f 6620 616c 6967 6e65 6420 746f 2074   of aligned to t
-00032f30: 6865 2069 6e74 6572 7365 6374 696f 6e20  he intersection 
-00032f40: 6f66 0a20 2020 2020 2020 2069 6e64 6578  of.        index
-00032f50: 2063 6f6f 7264 696e 6174 6573 2028 6060   coordinates (``
-00032f60: 6a6f 696e 3d27 696e 6e65 7227 6060 292e  join='inner'``).
-00032f70: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00032f80: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-00032f90: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00032fa0: 7661 6c75 6520 3a20 7363 616c 6172 2c20  value : scalar, 
-00032fb0: 6e64 6172 7261 792c 2044 6174 6141 7272  ndarray, DataArr
-00032fc0: 6179 2c20 6469 6374 206f 7220 4461 7461  ay, dict or Data
-00032fd0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
-00032fe0: 5573 6564 2074 6f20 6669 6c6c 2061 6c6c  Used to fill all
-00032ff0: 206d 6174 6368 696e 6720 6d69 7373 696e   matching missin
-00033000: 6720 7661 6c75 6573 2069 6e20 7468 6973  g values in this
-00033010: 2064 6174 6173 6574 2773 2064 6174 610a   dataset's data.
-00033020: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-00033030: 6162 6c65 732e 2053 6361 6c61 7273 2c20  ables. Scalars, 
-00033040: 6e64 6172 7261 7973 206f 7220 4461 7461  ndarrays or Data
-00033050: 4172 7261 7973 2061 7267 756d 656e 7473  Arrays arguments
-00033060: 2061 7265 2075 7365 6420 746f 0a20 2020   are used to.   
-00033070: 2020 2020 2020 2020 2066 696c 6c20 616c           fill al
-00033080: 6c20 6461 7461 2077 6974 6820 616c 6967  l data with alig
-00033090: 6e65 6420 636f 6f72 6469 6e61 7465 7320  ned coordinates 
-000330a0: 2866 6f72 2044 6174 6141 7272 6179 7329  (for DataArrays)
-000330b0: 2e0a 2020 2020 2020 2020 2020 2020 4469  ..            Di
-000330c0: 6374 696f 6e61 7269 6573 206f 7220 6461  ctionaries or da
-000330d0: 7461 7365 7473 206d 6174 6368 2064 6174  tasets match dat
-000330e0: 6120 7661 7269 6162 6c65 7320 616e 6420  a variables and 
-000330f0: 7468 656e 2061 6c69 676e 0a20 2020 2020  then align.     
-00033100: 2020 2020 2020 2063 6f6f 7264 696e 6174         coordinat
-00033110: 6573 2069 6620 6e65 6365 7373 6172 792e  es if necessary.
-00033120: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00033130: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00033140: 2d0a 2020 2020 2020 2020 4461 7461 7365  -.        Datase
-00033150: 740a 0a20 2020 2020 2020 2045 7861 6d70  t..        Examp
-00033160: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
-00033170: 2d2d 2d2d 0a20 2020 2020 2020 203e 3e3e  ----.        >>>
-00033180: 2064 7320 3d20 7872 2e44 6174 6173 6574   ds = xr.Dataset
-00033190: 280a 2020 2020 2020 2020 2e2e 2e20 2020  (.        ...   
-000331a0: 2020 7b0a 2020 2020 2020 2020 2e2e 2e20    {.        ... 
-000331b0: 2020 2020 2020 2020 2241 223a 2028 2278          "A": ("x
-000331c0: 222c 205b 6e70 2e6e 616e 2c20 322c 206e  ", [np.nan, 2, n
-000331d0: 702e 6e61 6e2c 2030 5d29 2c0a 2020 2020  p.nan, 0]),.    
-000331e0: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-000331f0: 2242 223a 2028 2278 222c 205b 332c 2034  "B": ("x", [3, 4
-00033200: 2c20 6e70 2e6e 616e 2c20 315d 292c 0a20  , np.nan, 1]),. 
-00033210: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
-00033220: 2020 2022 4322 3a20 2822 7822 2c20 5b6e     "C": ("x", [n
-00033230: 702e 6e61 6e2c 206e 702e 6e61 6e2c 206e  p.nan, np.nan, n
-00033240: 702e 6e61 6e2c 2035 5d29 2c0a 2020 2020  p.nan, 5]),.    
-00033250: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-00033260: 2244 223a 2028 2278 222c 205b 6e70 2e6e  "D": ("x", [np.n
-00033270: 616e 2c20 332c 206e 702e 6e61 6e2c 2034  an, 3, np.nan, 4
-00033280: 5d29 2c0a 2020 2020 2020 2020 2e2e 2e20  ]),.        ... 
-00033290: 2020 2020 7d2c 0a20 2020 2020 2020 202e      },.        .
-000332a0: 2e2e 2020 2020 2063 6f6f 7264 733d 7b22  ..     coords={"
-000332b0: 7822 3a20 5b30 2c20 312c 2032 2c20 335d  x": [0, 1, 2, 3]
-000332c0: 7d2c 0a20 2020 2020 2020 202e 2e2e 2029  },.        ... )
-000332d0: 0a20 2020 2020 2020 203e 3e3e 2064 730a  .        >>> ds.
-000332e0: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-000332f0: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-00033300: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
-00033310: 3a20 3429 0a20 2020 2020 2020 2043 6f6f  : 4).        Coo
-00033320: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
-00033330: 2020 2020 2a20 7820 2020 2020 2020 2028      * x        (
-00033340: 7829 2069 6e74 3634 2030 2031 2032 2033  x) int64 0 1 2 3
-00033350: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-00033360: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-00033370: 2020 2020 2041 2020 2020 2020 2020 2878       A        (x
-00033380: 2920 666c 6f61 7436 3420 6e61 6e20 322e  ) float64 nan 2.
-00033390: 3020 6e61 6e20 302e 300a 2020 2020 2020  0 nan 0.0.      
-000333a0: 2020 2020 2020 4220 2020 2020 2020 2028        B        (
-000333b0: 7829 2066 6c6f 6174 3634 2033 2e30 2034  x) float64 3.0 4
-000333c0: 2e30 206e 616e 2031 2e30 0a20 2020 2020  .0 nan 1.0.     
-000333d0: 2020 2020 2020 2043 2020 2020 2020 2020         C        
-000333e0: 2878 2920 666c 6f61 7436 3420 6e61 6e20  (x) float64 nan 
-000333f0: 6e61 6e20 6e61 6e20 352e 300a 2020 2020  nan nan 5.0.    
-00033400: 2020 2020 2020 2020 4420 2020 2020 2020          D       
-00033410: 2028 7829 2066 6c6f 6174 3634 206e 616e   (x) float64 nan
-00033420: 2033 2e30 206e 616e 2034 2e30 0a0a 2020   3.0 nan 4.0..  
-00033430: 2020 2020 2020 5265 706c 6163 6520 616c        Replace al
-00033440: 6c20 604e 614e 6020 7661 6c75 6573 2077  l `NaN` values w
-00033450: 6974 6820 3073 2e0a 0a20 2020 2020 2020  ith 0s...       
-00033460: 203e 3e3e 2064 732e 6669 6c6c 6e61 2830   >>> ds.fillna(0
-00033470: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
-00033480: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-00033490: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-000334a0: 2878 3a20 3429 0a20 2020 2020 2020 2043  (x: 4).        C
-000334b0: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-000334c0: 2020 2020 2020 2a20 7820 2020 2020 2020        * x       
-000334d0: 2028 7829 2069 6e74 3634 2030 2031 2032   (x) int64 0 1 2
-000334e0: 2033 0a20 2020 2020 2020 2044 6174 6120   3.        Data 
-000334f0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-00033500: 2020 2020 2020 2041 2020 2020 2020 2020         A        
-00033510: 2878 2920 666c 6f61 7436 3420 302e 3020  (x) float64 0.0 
-00033520: 322e 3020 302e 3020 302e 300a 2020 2020  2.0 0.0 0.0.    
-00033530: 2020 2020 2020 2020 4220 2020 2020 2020          B       
-00033540: 2028 7829 2066 6c6f 6174 3634 2033 2e30   (x) float64 3.0
-00033550: 2034 2e30 2030 2e30 2031 2e30 0a20 2020   4.0 0.0 1.0.   
-00033560: 2020 2020 2020 2020 2043 2020 2020 2020           C      
-00033570: 2020 2878 2920 666c 6f61 7436 3420 302e    (x) float64 0.
-00033580: 3020 302e 3020 302e 3020 352e 300a 2020  0 0.0 0.0 5.0.  
-00033590: 2020 2020 2020 2020 2020 4420 2020 2020            D     
-000335a0: 2020 2028 7829 2066 6c6f 6174 3634 2030     (x) float64 0
-000335b0: 2e30 2033 2e30 2030 2e30 2034 2e30 0a0a  .0 3.0 0.0 4.0..
-000335c0: 2020 2020 2020 2020 5265 706c 6163 6520          Replace 
-000335d0: 616c 6c20 604e 614e 6020 656c 656d 656e  all `NaN` elemen
-000335e0: 7473 2069 6e20 636f 6c75 6d6e 20e2 8098  ts in column ...
-000335f0: 41e2 8099 2c20 e280 9842 e280 992c 20e2  A..., ...B..., .
-00033600: 8098 43e2 8099 2c20 616e 6420 e280 9844  ..C..., and ...D
-00033610: e280 992c 2077 6974 6820 302c 2031 2c20  ..., with 0, 1, 
-00033620: 322c 2061 6e64 2033 2072 6573 7065 6374  2, and 3 respect
-00033630: 6976 656c 792e 0a0a 2020 2020 2020 2020  ively...        
-00033640: 3e3e 3e20 7661 6c75 6573 203d 207b 2241  >>> values = {"A
-00033650: 223a 2030 2c20 2242 223a 2031 2c20 2243  ": 0, "B": 1, "C
-00033660: 223a 2032 2c20 2244 223a 2033 7d0a 2020  ": 2, "D": 3}.  
-00033670: 2020 2020 2020 3e3e 3e20 6473 2e66 696c        >>> ds.fil
-00033680: 6c6e 6128 7661 6c75 653d 7661 6c75 6573  lna(value=values
-00033690: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
-000336a0: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-000336b0: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-000336c0: 2878 3a20 3429 0a20 2020 2020 2020 2043  (x: 4).        C
-000336d0: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-000336e0: 2020 2020 2020 2a20 7820 2020 2020 2020        * x       
-000336f0: 2028 7829 2069 6e74 3634 2030 2031 2032   (x) int64 0 1 2
-00033700: 2033 0a20 2020 2020 2020 2044 6174 6120   3.        Data 
-00033710: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-00033720: 2020 2020 2020 2041 2020 2020 2020 2020         A        
-00033730: 2878 2920 666c 6f61 7436 3420 302e 3020  (x) float64 0.0 
-00033740: 322e 3020 302e 3020 302e 300a 2020 2020  2.0 0.0 0.0.    
-00033750: 2020 2020 2020 2020 4220 2020 2020 2020          B       
-00033760: 2028 7829 2066 6c6f 6174 3634 2033 2e30   (x) float64 3.0
-00033770: 2034 2e30 2031 2e30 2031 2e30 0a20 2020   4.0 1.0 1.0.   
-00033780: 2020 2020 2020 2020 2043 2020 2020 2020           C      
-00033790: 2020 2878 2920 666c 6f61 7436 3420 322e    (x) float64 2.
-000337a0: 3020 322e 3020 322e 3020 352e 300a 2020  0 2.0 2.0 5.0.  
-000337b0: 2020 2020 2020 2020 2020 4420 2020 2020            D     
-000337c0: 2020 2028 7829 2066 6c6f 6174 3634 2033     (x) float64 3
-000337d0: 2e30 2033 2e30 2033 2e30 2034 2e30 0a20  .0 3.0 3.0 4.0. 
-000337e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000337f0: 2020 2069 6620 7574 696c 732e 6973 5f64     if utils.is_d
-00033800: 6963 745f 6c69 6b65 2876 616c 7565 293a  ict_like(value):
-00033810: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00033820: 7565 5f6b 6579 7320 3d20 6765 7461 7474  ue_keys = getatt
-00033830: 7228 7661 6c75 652c 2022 6461 7461 5f76  r(value, "data_v
-00033840: 6172 7322 2c20 7661 6c75 6529 2e6b 6579  ars", value).key
-00033850: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-00033860: 6966 206e 6f74 2073 6574 2876 616c 7565  if not set(value
-00033870: 5f6b 6579 7329 203c 3d20 7365 7428 7365  _keys) <= set(se
-00033880: 6c66 2e64 6174 615f 7661 7273 2e6b 6579  lf.data_vars.key
-00033890: 7328 2929 3a0a 2020 2020 2020 2020 2020  s()):.          
-000338a0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-000338b0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-000338c0: 2020 2020 2020 2020 2020 2020 2261 6c6c              "all
-000338d0: 2076 6172 6961 626c 6573 2069 6e20 7468   variables in th
-000338e0: 6520 6172 6775 6d65 6e74 2074 6f20 6066  e argument to `f
-000338f0: 696c 6c6e 6160 2022 0a20 2020 2020 2020  illna` ".       
-00033900: 2020 2020 2020 2020 2020 2020 2022 6d75               "mu
-00033910: 7374 2062 6520 636f 6e74 6169 6e65 6420  st be contained 
-00033920: 696e 2074 6865 206f 7269 6769 6e61 6c20  in the original 
-00033930: 6461 7461 7365 7422 0a20 2020 2020 2020  dataset".       
-00033940: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00033950: 2020 206f 7574 203d 206f 7073 2e66 696c     out = ops.fil
-00033960: 6c6e 6128 7365 6c66 2c20 7661 6c75 6529  lna(self, value)
-00033970: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00033980: 6f75 740a 0a20 2020 2064 6566 2069 6e74  out..    def int
-00033990: 6572 706f 6c61 7465 5f6e 6128 0a20 2020  erpolate_na(.   
-000339a0: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-000339b0: 6173 6574 2c0a 2020 2020 2020 2020 6469  aset,.        di
-000339c0: 6d3a 2048 6173 6861 626c 6520 7c20 4e6f  m: Hashable | No
-000339d0: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
-000339e0: 2020 206d 6574 686f 643a 2049 6e74 6572     method: Inter
-000339f0: 704f 7074 696f 6e73 203d 2022 6c69 6e65  pOptions = "line
-00033a00: 6172 222c 0a20 2020 2020 2020 206c 696d  ar",.        lim
-00033a10: 6974 3a20 696e 7420 7c20 4e6f 6e65 203d  it: int | None =
-00033a20: 204e 6f6e 652c 0a20 2020 2020 2020 2075   None,.        u
-00033a30: 7365 5f63 6f6f 7264 696e 6174 653a 2062  se_coordinate: b
-00033a40: 6f6f 6c20 7c20 4861 7368 6162 6c65 203d  ool | Hashable =
-00033a50: 2054 7275 652c 0a20 2020 2020 2020 206d   True,.        m
-00033a60: 6178 5f67 6170 3a20 280a 2020 2020 2020  ax_gap: (.      
-00033a70: 2020 2020 2020 696e 7420 7c20 666c 6f61        int | floa
-00033a80: 7420 7c20 7374 7220 7c20 7064 2e54 696d  t | str | pd.Tim
-00033a90: 6564 656c 7461 207c 206e 702e 7469 6d65  edelta | np.time
-00033aa0: 6465 6c74 6136 3420 7c20 6461 7465 7469  delta64 | dateti
-00033ab0: 6d65 2e74 696d 6564 656c 7461 0a20 2020  me.timedelta.   
-00033ac0: 2020 2020 2029 203d 204e 6f6e 652c 0a20       ) = None,. 
-00033ad0: 2020 2020 2020 202a 2a6b 7761 7267 733a         **kwargs:
-00033ae0: 2041 6e79 2c0a 2020 2020 2920 2d3e 2054   Any,.    ) -> T
-00033af0: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-00033b00: 2020 2222 2246 696c 6c20 696e 204e 614e    """Fill in NaN
-00033b10: 7320 6279 2069 6e74 6572 706f 6c61 7469  s by interpolati
-00033b20: 6e67 2061 6363 6f72 6469 6e67 2074 6f20  ng according to 
-00033b30: 6469 6666 6572 656e 7420 6d65 7468 6f64  different method
-00033b40: 732e 0a0a 2020 2020 2020 2020 5061 7261  s...        Para
-00033b50: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-00033b60: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00033b70: 2020 6469 6d20 3a20 4861 7368 6162 6c65    dim : Hashable
-00033b80: 206f 7220 4e6f 6e65 2c20 6f70 7469 6f6e   or None, option
-00033b90: 616c 0a20 2020 2020 2020 2020 2020 2053  al.            S
-00033ba0: 7065 6369 6669 6573 2074 6865 2064 696d  pecifies the dim
-00033bb0: 656e 7369 6f6e 2061 6c6f 6e67 2077 6869  ension along whi
-00033bc0: 6368 2074 6f20 696e 7465 7270 6f6c 6174  ch to interpolat
-00033bd0: 652e 0a20 2020 2020 2020 206d 6574 686f  e..        metho
-00033be0: 6420 3a20 7b22 6c69 6e65 6172 222c 2022  d : {"linear", "
-00033bf0: 6e65 6172 6573 7422 2c20 227a 6572 6f22  nearest", "zero"
-00033c00: 2c20 2273 6c69 6e65 6172 222c 2022 7175  , "slinear", "qu
-00033c10: 6164 7261 7469 6322 2c20 2263 7562 6963  adratic", "cubic
-00033c20: 222c 2022 706f 6c79 6e6f 6d69 616c 222c  ", "polynomial",
-00033c30: 205c 0a20 2020 2020 2020 2020 2020 2022   \.            "
-00033c40: 6261 7279 6365 6e74 7269 6322 2c20 226b  barycentric", "k
-00033c50: 726f 6722 2c20 2270 6368 6970 222c 2022  rog", "pchip", "
-00033c60: 7370 6c69 6e65 222c 2022 616b 696d 6122  spline", "akima"
-00033c70: 7d2c 2064 6566 6175 6c74 3a20 226c 696e  }, default: "lin
-00033c80: 6561 7222 0a20 2020 2020 2020 2020 2020  ear".           
-00033c90: 2053 7472 696e 6720 696e 6469 6361 7469   String indicati
-00033ca0: 6e67 2077 6869 6368 206d 6574 686f 6420  ng which method 
-00033cb0: 746f 2075 7365 2066 6f72 2069 6e74 6572  to use for inter
-00033cc0: 706f 6c61 7469 6f6e 3a0a 0a20 2020 2020  polation:..     
-00033cd0: 2020 2020 2020 202d 2027 6c69 6e65 6172         - 'linear
-00033ce0: 273a 206c 696e 6561 7220 696e 7465 7270  ': linear interp
-00033cf0: 6f6c 6174 696f 6e2e 2041 6464 6974 696f  olation. Additio
-00033d00: 6e61 6c20 6b65 7977 6f72 640a 2020 2020  nal keyword.    
-00033d10: 2020 2020 2020 2020 2020 6172 6775 6d65            argume
-00033d20: 6e74 7320 6172 6520 7061 7373 6564 2074  nts are passed t
-00033d30: 6f20 3a70 793a 6675 6e63 3a60 6e75 6d70  o :py:func:`nump
-00033d40: 792e 696e 7465 7270 600a 2020 2020 2020  y.interp`.      
-00033d50: 2020 2020 2020 2d20 276e 6561 7265 7374        - 'nearest
-00033d60: 272c 2027 7a65 726f 272c 2027 736c 696e  ', 'zero', 'slin
-00033d70: 6561 7227 2c20 2771 7561 6472 6174 6963  ear', 'quadratic
-00033d80: 272c 2027 6375 6269 6327 2c20 2770 6f6c  ', 'cubic', 'pol
-00033d90: 796e 6f6d 6961 6c27 3a0a 2020 2020 2020  ynomial':.      
-00033da0: 2020 2020 2020 2020 6172 6520 7061 7373          are pass
-00033db0: 6564 2074 6f20 3a70 793a 6675 6e63 3a60  ed to :py:func:`
-00033dc0: 7363 6970 792e 696e 7465 7270 6f6c 6174  scipy.interpolat
-00033dd0: 652e 696e 7465 7270 3164 602e 2049 660a  e.interp1d`. If.
-00033de0: 2020 2020 2020 2020 2020 2020 2020 6060                ``
-00033df0: 6d65 7468 6f64 3d27 706f 6c79 6e6f 6d69  method='polynomi
-00033e00: 616c 2760 602c 2074 6865 2060 606f 7264  al'``, the ``ord
-00033e10: 6572 6060 206b 6579 776f 7264 2061 7267  er`` keyword arg
-00033e20: 756d 656e 7420 6d75 7374 2061 6c73 6f20  ument must also 
-00033e30: 6265 0a20 2020 2020 2020 2020 2020 2020  be.             
-00033e40: 2070 726f 7669 6465 642e 0a20 2020 2020   provided..     
-00033e50: 2020 2020 2020 202d 2027 6261 7279 6365         - 'baryce
-00033e60: 6e74 7269 6327 2c20 276b 726f 6727 2c20  ntric', 'krog', 
-00033e70: 2770 6368 6970 272c 2027 7370 6c69 6e65  'pchip', 'spline
-00033e80: 272c 2027 616b 696d 6127 3a20 7573 6520  ', 'akima': use 
-00033e90: 7468 6569 720a 2020 2020 2020 2020 2020  their.          
-00033ea0: 2020 2020 7265 7370 6563 7469 7665 203a      respective :
-00033eb0: 7079 3a63 6c61 7373 3a60 7363 6970 792e  py:class:`scipy.
-00033ec0: 696e 7465 7270 6f6c 6174 6560 2063 6c61  interpolate` cla
-00033ed0: 7373 6573 2e0a 0a20 2020 2020 2020 2075  sses...        u
-00033ee0: 7365 5f63 6f6f 7264 696e 6174 6520 3a20  se_coordinate : 
-00033ef0: 626f 6f6c 206f 7220 4861 7368 6162 6c65  bool or Hashable
-00033f00: 2c20 6465 6661 756c 743a 2054 7275 650a  , default: True.
-00033f10: 2020 2020 2020 2020 2020 2020 5370 6563              Spec
-00033f20: 6966 6965 7320 7768 6963 6820 696e 6465  ifies which inde
-00033f30: 7820 746f 2075 7365 2061 7320 7468 6520  x to use as the 
-00033f40: 7820 7661 6c75 6573 2069 6e20 7468 6520  x values in the 
-00033f50: 696e 7465 7270 6f6c 6174 696f 6e0a 2020  interpolation.  
-00033f60: 2020 2020 2020 2020 2020 666f 726d 756c            formul
-00033f70: 6174 6564 2061 7320 6079 203d 2066 2878  ated as `y = f(x
-00033f80: 2960 2e20 4966 2046 616c 7365 2c20 7661  )`. If False, va
-00033f90: 6c75 6573 2061 7265 2074 7265 6174 6564  lues are treated
-00033fa0: 2061 7320 6966 0a20 2020 2020 2020 2020   as if.         
-00033fb0: 2020 2065 7161 756c 6c79 2d73 7061 6365     eqaully-space
-00033fc0: 6420 616c 6f6e 6720 6060 6469 6d60 602e  d along ``dim``.
-00033fd0: 2049 6620 5472 7565 2c20 7468 6520 496e   If True, the In
-00033fe0: 6465 7856 6172 6961 626c 6520 6064 696d  dexVariable `dim
-00033ff0: 6020 6973 0a20 2020 2020 2020 2020 2020  ` is.           
-00034000: 2075 7365 642e 2049 6620 6060 7573 655f   used. If ``use_
-00034010: 636f 6f72 6469 6e61 7465 6060 2069 7320  coordinate`` is 
-00034020: 6120 7374 7269 6e67 2c20 6974 2073 7065  a string, it spe
-00034030: 6369 6669 6573 2074 6865 206e 616d 6520  cifies the name 
-00034040: 6f66 2061 0a20 2020 2020 2020 2020 2020  of a.           
-00034050: 2063 6f6f 7264 696e 6174 6520 7661 7269   coordinate vari
-00034060: 6172 6961 626c 6520 746f 2075 7365 2061  ariable to use a
-00034070: 7320 7468 6520 696e 6465 782e 0a20 2020  s the index..   
-00034080: 2020 2020 206c 696d 6974 203a 2069 6e74       limit : int
-00034090: 2c20 6465 6661 756c 743a 204e 6f6e 650a  , default: None.
-000340a0: 2020 2020 2020 2020 2020 2020 4d61 7869              Maxi
-000340b0: 6d75 6d20 6e75 6d62 6572 206f 6620 636f  mum number of co
-000340c0: 6e73 6563 7574 6976 6520 4e61 4e73 2074  nsecutive NaNs t
-000340d0: 6f20 6669 6c6c 2e20 4d75 7374 2062 6520  o fill. Must be 
-000340e0: 6772 6561 7465 7220 7468 616e 2030 0a20  greater than 0. 
-000340f0: 2020 2020 2020 2020 2020 206f 7220 4e6f             or No
-00034100: 6e65 2066 6f72 206e 6f20 6c69 6d69 742e  ne for no limit.
-00034110: 2054 6869 7320 6669 6c6c 696e 6720 6973   This filling is
-00034120: 2064 6f6e 6520 7265 6761 7264 6c65 7373   done regardless
-00034130: 206f 6620 7468 6520 7369 7a65 206f 660a   of the size of.
-00034140: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00034150: 6761 7020 696e 2074 6865 2064 6174 612e  gap in the data.
-00034160: 2054 6f20 6f6e 6c79 2069 6e74 6572 706f   To only interpo
-00034170: 6c61 7465 206f 7665 7220 6761 7073 206c  late over gaps l
-00034180: 6573 7320 7468 616e 2061 2067 6976 656e  ess than a given
-00034190: 206c 656e 6774 682c 0a20 2020 2020 2020   length,.       
-000341a0: 2020 2020 2073 6565 2060 606d 6178 5f67       see ``max_g
-000341b0: 6170 6060 2e0a 2020 2020 2020 2020 6d61  ap``..        ma
-000341c0: 785f 6761 7020 3a20 696e 742c 2066 6c6f  x_gap : int, flo
-000341d0: 6174 2c20 7374 722c 2070 616e 6461 732e  at, str, pandas.
-000341e0: 5469 6d65 6465 6c74 612c 206e 756d 7079  Timedelta, numpy
-000341f0: 2e74 696d 6564 656c 7461 3634 2c20 6461  .timedelta64, da
-00034200: 7465 7469 6d65 2e74 696d 6564 656c 7461  tetime.timedelta
-00034210: 2c20 6465 6661 756c 743a 204e 6f6e 650a  , default: None.
-00034220: 2020 2020 2020 2020 2020 2020 4d61 7869              Maxi
-00034230: 6d75 6d20 7369 7a65 206f 6620 6761 702c  mum size of gap,
-00034240: 2061 2063 6f6e 7469 6e75 6f75 7320 7365   a continuous se
-00034250: 7175 656e 6365 206f 6620 4e61 4e73 2c20  quence of NaNs, 
-00034260: 7468 6174 2077 696c 6c20 6265 2066 696c  that will be fil
-00034270: 6c65 642e 0a20 2020 2020 2020 2020 2020  led..           
-00034280: 2055 7365 204e 6f6e 6520 666f 7220 6e6f   Use None for no
-00034290: 206c 696d 6974 2e20 5768 656e 2069 6e74   limit. When int
-000342a0: 6572 706f 6c61 7469 6e67 2061 6c6f 6e67  erpolating along
-000342b0: 2061 2064 6174 6574 696d 6536 3420 6469   a datetime64 di
-000342c0: 6d65 6e73 696f 6e0a 2020 2020 2020 2020  mension.        
-000342d0: 2020 2020 616e 6420 6060 7573 655f 636f      and ``use_co
-000342e0: 6f72 6469 6e61 7465 3d54 7275 6560 602c  ordinate=True``,
-000342f0: 2060 606d 6178 5f67 6170 6060 2063 616e   ``max_gap`` can
-00034300: 2062 6520 6f6e 6520 6f66 2074 6865 2066   be one of the f
-00034310: 6f6c 6c6f 7769 6e67 3a0a 0a20 2020 2020  ollowing:..     
-00034320: 2020 2020 2020 202d 2061 2073 7472 696e         - a strin
-00034330: 6720 7468 6174 2069 7320 7661 6c69 6420  g that is valid 
-00034340: 696e 7075 7420 666f 7220 7061 6e64 6173  input for pandas
-00034350: 2e74 6f5f 7469 6d65 6465 6c74 610a 2020  .to_timedelta.  
-00034360: 2020 2020 2020 2020 2020 2d20 6120 3a70            - a :p
-00034370: 793a 636c 6173 733a 606e 756d 7079 2e74  y:class:`numpy.t
-00034380: 696d 6564 656c 7461 3634 6020 6f62 6a65  imedelta64` obje
-00034390: 6374 0a20 2020 2020 2020 2020 2020 202d  ct.            -
-000343a0: 2061 203a 7079 3a63 6c61 7373 3a60 7061   a :py:class:`pa
-000343b0: 6e64 6173 2e54 696d 6564 656c 7461 6020  ndas.Timedelta` 
-000343c0: 6f62 6a65 6374 0a20 2020 2020 2020 2020  object.         
-000343d0: 2020 202d 2061 203a 7079 3a63 6c61 7373     - a :py:class
-000343e0: 3a60 6461 7465 7469 6d65 2e74 696d 6564  :`datetime.timed
-000343f0: 656c 7461 6020 6f62 6a65 6374 0a0a 2020  elta` object..  
-00034400: 2020 2020 2020 2020 2020 4f74 6865 7277            Otherw
-00034410: 6973 652c 2060 606d 6178 5f67 6170 6060  ise, ``max_gap``
-00034420: 206d 7573 7420 6265 2061 6e20 696e 7420   must be an int 
-00034430: 6f72 2061 2066 6c6f 6174 2e20 5573 6520  or a float. Use 
-00034440: 6f66 2060 606d 6178 5f67 6170 6060 2077  of ``max_gap`` w
-00034450: 6974 6820 756e 6c61 6265 6c65 640a 2020  ith unlabeled.  
-00034460: 2020 2020 2020 2020 2020 6469 6d65 6e73            dimens
-00034470: 696f 6e73 2068 6173 206e 6f74 2062 6565  ions has not bee
-00034480: 6e20 696d 706c 656d 656e 7465 6420 7965  n implemented ye
-00034490: 742e 2047 6170 206c 656e 6774 6820 6973  t. Gap length is
-000344a0: 2064 6566 696e 6564 2061 7320 7468 6520   defined as the 
-000344b0: 6469 6666 6572 656e 6365 0a20 2020 2020  difference.     
-000344c0: 2020 2020 2020 2062 6574 7765 656e 2063         between c
-000344d0: 6f6f 7264 696e 6174 6520 7661 6c75 6573  oordinate values
-000344e0: 2061 7420 7468 6520 6669 7273 7420 6461   at the first da
-000344f0: 7461 2070 6f69 6e74 2061 6674 6572 2061  ta point after a
-00034500: 2067 6170 2061 6e64 2074 6865 206c 6173   gap and the las
-00034510: 7420 7661 6c75 650a 2020 2020 2020 2020  t value.        
-00034520: 2020 2020 6265 666f 7265 2061 2067 6170      before a gap
-00034530: 2e20 466f 7220 6761 7073 2061 7420 7468  . For gaps at th
-00034540: 6520 6265 6769 6e6e 696e 6720 2865 6e64  e beginning (end
-00034550: 292c 2067 6170 206c 656e 6774 6820 6973  ), gap length is
-00034560: 2064 6566 696e 6564 2061 7320 7468 6520   defined as the 
-00034570: 6469 6666 6572 656e 6365 0a20 2020 2020  difference.     
-00034580: 2020 2020 2020 2062 6574 7765 656e 2063         between c
-00034590: 6f6f 7264 696e 6174 6520 7661 6c75 6573  oordinate values
-000345a0: 2061 7420 7468 6520 6669 7273 7420 286c   at the first (l
-000345b0: 6173 7429 2076 616c 6964 2064 6174 6120  ast) valid data 
-000345c0: 706f 696e 7420 616e 6420 7468 6520 6669  point and the fi
-000345d0: 7273 7420 286c 6173 7429 204e 614e 2e0a  rst (last) NaN..
-000345e0: 2020 2020 2020 2020 2020 2020 466f 7220              For 
-000345f0: 6578 616d 706c 652c 2063 6f6e 7369 6465  example, conside
-00034600: 723a 3a0a 0a20 2020 2020 2020 2020 2020  r::..           
-00034610: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
-00034620: 6141 7272 6179 2028 783a 2039 293e 0a20  aArray (x: 9)>. 
-00034630: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00034640: 7272 6179 285b 6e61 6e2c 206e 616e 2c20  rray([nan, nan, 
-00034650: 6e61 6e2c 2020 312e 2c20 6e61 6e2c 206e  nan,  1., nan, n
-00034660: 616e 2c20 2034 2e2c 206e 616e 2c20 6e61  an,  4., nan, na
-00034670: 6e5d 290a 2020 2020 2020 2020 2020 2020  n]).            
-00034680: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
-00034690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000346a0: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
-000346b0: 2920 696e 7436 3420 3020 3120 3220 3320  ) int64 0 1 2 3 
-000346c0: 3420 3520 3620 3720 380a 0a20 2020 2020  4 5 6 7 8..     
-000346d0: 2020 2020 2020 2054 6865 2067 6170 206c         The gap l
-000346e0: 656e 6774 6873 2061 7265 2033 2d30 203d  engths are 3-0 =
-000346f0: 2033 3b20 362d 3320 3d20 333b 2061 6e64   3; 6-3 = 3; and
-00034700: 2038 2d36 203d 2032 2072 6573 7065 6374   8-6 = 2 respect
-00034710: 6976 656c 790a 2020 2020 2020 2020 2a2a  ively.        **
-00034720: 6b77 6172 6773 203a 2064 6963 742c 206f  kwargs : dict, o
-00034730: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00034740: 2020 2020 7061 7261 6d65 7465 7273 2070      parameters p
-00034750: 6173 7365 6420 7665 7262 6174 696d 2074  assed verbatim t
-00034760: 6f20 7468 6520 756e 6465 726c 7969 6e67  o the underlying
-00034770: 2069 6e74 6572 706f 6c61 7469 6f6e 2066   interpolation f
-00034780: 756e 6374 696f 6e0a 0a20 2020 2020 2020  unction..       
-00034790: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-000347a0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-000347b0: 2069 6e74 6572 706f 6c61 7465 643a 2044   interpolated: D
-000347c0: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
-000347d0: 2020 2046 696c 6c65 6420 696e 2044 6174     Filled in Dat
-000347e0: 6173 6574 2e0a 0a20 2020 2020 2020 2053  aset...        S
-000347f0: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
-00034800: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00034810: 206e 756d 7079 2e69 6e74 6572 700a 2020   numpy.interp.  
-00034820: 2020 2020 2020 7363 6970 792e 696e 7465        scipy.inte
-00034830: 7270 6f6c 6174 650a 0a20 2020 2020 2020  rpolate..       
-00034840: 2045 7861 6d70 6c65 730a 2020 2020 2020   Examples.      
-00034850: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-00034860: 2020 203e 3e3e 2064 7320 3d20 7872 2e44     >>> ds = xr.D
-00034870: 6174 6173 6574 280a 2020 2020 2020 2020  ataset(.        
-00034880: 2e2e 2e20 2020 2020 7b0a 2020 2020 2020  ...     {.      
-00034890: 2020 2e2e 2e20 2020 2020 2020 2020 2241    ...         "A
-000348a0: 223a 2028 2278 222c 205b 6e70 2e6e 616e  ": ("x", [np.nan
-000348b0: 2c20 322c 2033 2c20 6e70 2e6e 616e 2c20  , 2, 3, np.nan, 
-000348c0: 305d 292c 0a20 2020 2020 2020 202e 2e2e  0]),.        ...
-000348d0: 2020 2020 2020 2020 2022 4222 3a20 2822           "B": ("
-000348e0: 7822 2c20 5b33 2c20 342c 206e 702e 6e61  x", [3, 4, np.na
-000348f0: 6e2c 2031 2c20 375d 292c 0a20 2020 2020  n, 1, 7]),.     
-00034900: 2020 202e 2e2e 2020 2020 2020 2020 2022     ...         "
-00034910: 4322 3a20 2822 7822 2c20 5b6e 702e 6e61  C": ("x", [np.na
-00034920: 6e2c 206e 702e 6e61 6e2c 206e 702e 6e61  n, np.nan, np.na
-00034930: 6e2c 2035 2c20 305d 292c 0a20 2020 2020  n, 5, 0]),.     
-00034940: 2020 202e 2e2e 2020 2020 2020 2020 2022     ...         "
-00034950: 4422 3a20 2822 7822 2c20 5b6e 702e 6e61  D": ("x", [np.na
-00034960: 6e2c 2033 2c20 6e70 2e6e 616e 2c20 2d31  n, 3, np.nan, -1
-00034970: 2c20 345d 292c 0a20 2020 2020 2020 202e  , 4]),.        .
-00034980: 2e2e 2020 2020 207d 2c0a 2020 2020 2020  ..     },.      
-00034990: 2020 2e2e 2e20 2020 2020 636f 6f72 6473    ...     coords
-000349a0: 3d7b 2278 223a 205b 302c 2031 2c20 322c  ={"x": [0, 1, 2,
-000349b0: 2033 2c20 345d 7d2c 0a20 2020 2020 2020   3, 4]},.       
-000349c0: 202e 2e2e 2029 0a20 2020 2020 2020 203e   ... ).        >
-000349d0: 3e3e 2064 730a 2020 2020 2020 2020 3c78  >> ds.        <x
-000349e0: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
-000349f0: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
-00034a00: 733a 2020 2878 3a20 3529 0a20 2020 2020  s:  (x: 5).     
-00034a10: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-00034a20: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
-00034a30: 2020 2020 2028 7829 2069 6e74 3634 2030       (x) int64 0
-00034a40: 2031 2032 2033 2034 0a20 2020 2020 2020   1 2 3 4.       
-00034a50: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
-00034a60: 0a20 2020 2020 2020 2020 2020 2041 2020  .            A  
-00034a70: 2020 2020 2020 2878 2920 666c 6f61 7436        (x) float6
-00034a80: 3420 6e61 6e20 322e 3020 332e 3020 6e61  4 nan 2.0 3.0 na
-00034a90: 6e20 302e 300a 2020 2020 2020 2020 2020  n 0.0.          
-00034aa0: 2020 4220 2020 2020 2020 2028 7829 2066    B        (x) f
-00034ab0: 6c6f 6174 3634 2033 2e30 2034 2e30 206e  loat64 3.0 4.0 n
-00034ac0: 616e 2031 2e30 2037 2e30 0a20 2020 2020  an 1.0 7.0.     
-00034ad0: 2020 2020 2020 2043 2020 2020 2020 2020         C        
-00034ae0: 2878 2920 666c 6f61 7436 3420 6e61 6e20  (x) float64 nan 
-00034af0: 6e61 6e20 6e61 6e20 352e 3020 302e 300a  nan nan 5.0 0.0.
-00034b00: 2020 2020 2020 2020 2020 2020 4420 2020              D   
-00034b10: 2020 2020 2028 7829 2066 6c6f 6174 3634       (x) float64
-00034b20: 206e 616e 2033 2e30 206e 616e 202d 312e   nan 3.0 nan -1.
-00034b30: 3020 342e 300a 0a20 2020 2020 2020 203e  0 4.0..        >
-00034b40: 3e3e 2064 732e 696e 7465 7270 6f6c 6174  >> ds.interpolat
-00034b50: 655f 6e61 2864 696d 3d22 7822 2c20 6d65  e_na(dim="x", me
-00034b60: 7468 6f64 3d22 6c69 6e65 6172 2229 0a20  thod="linear"). 
-00034b70: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
-00034b80: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
-00034b90: 4469 6d65 6e73 696f 6e73 3a20 2028 783a  Dimensions:  (x:
-00034ba0: 2035 290a 2020 2020 2020 2020 436f 6f72   5).        Coor
-00034bb0: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-00034bc0: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
-00034bd0: 2920 696e 7436 3420 3020 3120 3220 3320  ) int64 0 1 2 3 
-00034be0: 340a 2020 2020 2020 2020 4461 7461 2076  4.        Data v
-00034bf0: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
-00034c00: 2020 2020 2020 4120 2020 2020 2020 2028        A        (
-00034c10: 7829 2066 6c6f 6174 3634 206e 616e 2032  x) float64 nan 2
-00034c20: 2e30 2033 2e30 2031 2e35 2030 2e30 0a20  .0 3.0 1.5 0.0. 
-00034c30: 2020 2020 2020 2020 2020 2042 2020 2020             B    
-00034c40: 2020 2020 2878 2920 666c 6f61 7436 3420      (x) float64 
-00034c50: 332e 3020 342e 3020 322e 3520 312e 3020  3.0 4.0 2.5 1.0 
-00034c60: 372e 300a 2020 2020 2020 2020 2020 2020  7.0.            
-00034c70: 4320 2020 2020 2020 2028 7829 2066 6c6f  C        (x) flo
-00034c80: 6174 3634 206e 616e 206e 616e 206e 616e  at64 nan nan nan
-00034c90: 2035 2e30 2030 2e30 0a20 2020 2020 2020   5.0 0.0.       
-00034ca0: 2020 2020 2044 2020 2020 2020 2020 2878       D        (x
-00034cb0: 2920 666c 6f61 7436 3420 6e61 6e20 332e  ) float64 nan 3.
-00034cc0: 3020 312e 3020 2d31 2e30 2034 2e30 0a0a  0 1.0 -1.0 4.0..
-00034cd0: 2020 2020 2020 2020 3e3e 3e20 6473 2e69          >>> ds.i
-00034ce0: 6e74 6572 706f 6c61 7465 5f6e 6128 6469  nterpolate_na(di
-00034cf0: 6d3d 2278 222c 206d 6574 686f 643d 226c  m="x", method="l
-00034d00: 696e 6561 7222 2c20 6669 6c6c 5f76 616c  inear", fill_val
-00034d10: 7565 3d22 6578 7472 6170 6f6c 6174 6522  ue="extrapolate"
-00034d20: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
-00034d30: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-00034d40: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-00034d50: 2878 3a20 3529 0a20 2020 2020 2020 2043  (x: 5).        C
-00034d60: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-00034d70: 2020 2020 2020 2a20 7820 2020 2020 2020        * x       
-00034d80: 2028 7829 2069 6e74 3634 2030 2031 2032   (x) int64 0 1 2
-00034d90: 2033 2034 0a20 2020 2020 2020 2044 6174   3 4.        Dat
-00034da0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
-00034db0: 2020 2020 2020 2020 2041 2020 2020 2020           A      
-00034dc0: 2020 2878 2920 666c 6f61 7436 3420 312e    (x) float64 1.
-00034dd0: 3020 322e 3020 332e 3020 312e 3520 302e  0 2.0 3.0 1.5 0.
-00034de0: 300a 2020 2020 2020 2020 2020 2020 4220  0.            B 
-00034df0: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
-00034e00: 3634 2033 2e30 2034 2e30 2032 2e35 2031  64 3.0 4.0 2.5 1
-00034e10: 2e30 2037 2e30 0a20 2020 2020 2020 2020  .0 7.0.         
-00034e20: 2020 2043 2020 2020 2020 2020 2878 2920     C        (x) 
-00034e30: 666c 6f61 7436 3420 3230 2e30 2031 352e  float64 20.0 15.
-00034e40: 3020 3130 2e30 2035 2e30 2030 2e30 0a20  0 10.0 5.0 0.0. 
-00034e50: 2020 2020 2020 2020 2020 2044 2020 2020             D    
-00034e60: 2020 2020 2878 2920 666c 6f61 7436 3420      (x) float64 
-00034e70: 352e 3020 332e 3020 312e 3020 2d31 2e30  5.0 3.0 1.0 -1.0
-00034e80: 2034 2e30 0a20 2020 2020 2020 2022 2222   4.0.        """
-00034e90: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
-00034ea0: 7272 6179 2e63 6f72 652e 6d69 7373 696e  rray.core.missin
-00034eb0: 6720 696d 706f 7274 205f 6170 706c 795f  g import _apply_
-00034ec0: 6f76 6572 5f76 6172 735f 7769 7468 5f64  over_vars_with_d
-00034ed0: 696d 2c20 696e 7465 7270 5f6e 610a 0a20  im, interp_na.. 
-00034ee0: 2020 2020 2020 206e 6577 203d 205f 6170         new = _ap
-00034ef0: 706c 795f 6f76 6572 5f76 6172 735f 7769  ply_over_vars_wi
-00034f00: 7468 5f64 696d 280a 2020 2020 2020 2020  th_dim(.        
-00034f10: 2020 2020 696e 7465 7270 5f6e 612c 0a20      interp_na,. 
-00034f20: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-00034f30: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
-00034f40: 3d64 696d 2c0a 2020 2020 2020 2020 2020  =dim,.          
-00034f50: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
-00034f60: 0a20 2020 2020 2020 2020 2020 206c 696d  .            lim
-00034f70: 6974 3d6c 696d 6974 2c0a 2020 2020 2020  it=limit,.      
-00034f80: 2020 2020 2020 7573 655f 636f 6f72 6469        use_coordi
-00034f90: 6e61 7465 3d75 7365 5f63 6f6f 7264 696e  nate=use_coordin
-00034fa0: 6174 652c 0a20 2020 2020 2020 2020 2020  ate,.           
-00034fb0: 206d 6178 5f67 6170 3d6d 6178 5f67 6170   max_gap=max_gap
-00034fc0: 2c0a 2020 2020 2020 2020 2020 2020 2a2a  ,.            **
-00034fd0: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
-00034fe0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00034ff0: 206e 6577 0a0a 2020 2020 6465 6620 6666   new..    def ff
-00035000: 696c 6c28 7365 6c66 3a20 545f 4461 7461  ill(self: T_Data
-00035010: 7365 742c 2064 696d 3a20 4861 7368 6162  set, dim: Hashab
-00035020: 6c65 2c20 6c69 6d69 743a 2069 6e74 207c  le, limit: int |
-00035030: 204e 6f6e 6520 3d20 4e6f 6e65 2920 2d3e   None = None) ->
-00035040: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-00035050: 2020 2020 2222 2246 696c 6c20 4e61 4e20      """Fill NaN 
-00035060: 7661 6c75 6573 2062 7920 7072 6f70 6167  values by propag
-00035070: 6174 696e 6720 7661 6c75 6573 2066 6f72  ating values for
-00035080: 7761 7264 0a0a 2020 2020 2020 2020 2a52  ward..        *R
-00035090: 6571 7569 7265 7320 626f 7474 6c65 6e65  equires bottlene
-000350a0: 636b 2e2a 0a0a 2020 2020 2020 2020 5061  ck.*..        Pa
-000350b0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-000350c0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-000350d0: 2020 2020 6469 6d20 3a20 4861 7368 6162      dim : Hashab
-000350e0: 6c65 0a20 2020 2020 2020 2020 2020 2053  le.            S
-000350f0: 7065 6369 6669 6573 2074 6865 2064 696d  pecifies the dim
-00035100: 656e 7369 6f6e 2061 6c6f 6e67 2077 6869  ension along whi
-00035110: 6368 2074 6f20 7072 6f70 6167 6174 6520  ch to propagate 
-00035120: 7661 6c75 6573 2077 6865 6e0a 2020 2020  values when.    
-00035130: 2020 2020 2020 2020 6669 6c6c 696e 672e          filling.
-00035140: 0a20 2020 2020 2020 206c 696d 6974 203a  .        limit :
-00035150: 2069 6e74 206f 7220 4e6f 6e65 2c20 6f70   int or None, op
-00035160: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00035170: 2020 2054 6865 206d 6178 696d 756d 206e     The maximum n
-00035180: 756d 6265 7220 6f66 2063 6f6e 7365 6375  umber of consecu
-00035190: 7469 7665 204e 614e 2076 616c 7565 7320  tive NaN values 
-000351a0: 746f 2066 6f72 7761 7264 2066 696c 6c2e  to forward fill.
-000351b0: 2049 6e0a 2020 2020 2020 2020 2020 2020   In.            
-000351c0: 6f74 6865 7220 776f 7264 732c 2069 6620  other words, if 
-000351d0: 7468 6572 6520 6973 2061 2067 6170 2077  there is a gap w
-000351e0: 6974 6820 6d6f 7265 2074 6861 6e20 7468  ith more than th
-000351f0: 6973 206e 756d 6265 7220 6f66 0a20 2020  is number of.   
-00035200: 2020 2020 2020 2020 2063 6f6e 7365 6375           consecu
-00035210: 7469 7665 204e 614e 732c 2069 7420 7769  tive NaNs, it wi
-00035220: 6c6c 206f 6e6c 7920 6265 2070 6172 7469  ll only be parti
-00035230: 616c 6c79 2066 696c 6c65 642e 204d 7573  ally filled. Mus
-00035240: 7420 6265 2067 7265 6174 6572 0a20 2020  t be greater.   
-00035250: 2020 2020 2020 2020 2074 6861 6e20 3020           than 0 
-00035260: 6f72 204e 6f6e 6520 666f 7220 6e6f 206c  or None for no l
-00035270: 696d 6974 2e20 4d75 7374 2062 6520 4e6f  imit. Must be No
-00035280: 6e65 206f 7220 6772 6561 7465 7220 7468  ne or greater th
-00035290: 616e 206f 7220 6571 7561 6c0a 2020 2020  an or equal.    
-000352a0: 2020 2020 2020 2020 746f 2061 7869 7320          to axis 
-000352b0: 6c65 6e67 7468 2069 6620 6669 6c6c 696e  length if fillin
-000352c0: 6720 616c 6f6e 6720 6368 756e 6b65 6420  g along chunked 
-000352d0: 6178 6573 2028 6469 6d65 6e73 696f 6e73  axes (dimensions
-000352e0: 292e 0a0a 2020 2020 2020 2020 5265 7475  )...        Retu
-000352f0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-00035300: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
-00035310: 7365 740a 2020 2020 2020 2020 2222 220a  set.        """.
-00035320: 2020 2020 2020 2020 6672 6f6d 2078 6172          from xar
-00035330: 7261 792e 636f 7265 2e6d 6973 7369 6e67  ray.core.missing
-00035340: 2069 6d70 6f72 7420 5f61 7070 6c79 5f6f   import _apply_o
-00035350: 7665 725f 7661 7273 5f77 6974 685f 6469  ver_vars_with_di
-00035360: 6d2c 2066 6669 6c6c 0a0a 2020 2020 2020  m, ffill..      
-00035370: 2020 6e65 7720 3d20 5f61 7070 6c79 5f6f    new = _apply_o
-00035380: 7665 725f 7661 7273 5f77 6974 685f 6469  ver_vars_with_di
-00035390: 6d28 6666 696c 6c2c 2073 656c 662c 2064  m(ffill, self, d
-000353a0: 696d 3d64 696d 2c20 6c69 6d69 743d 6c69  im=dim, limit=li
-000353b0: 6d69 7429 0a20 2020 2020 2020 2072 6574  mit).        ret
-000353c0: 7572 6e20 6e65 770a 0a20 2020 2064 6566  urn new..    def
-000353d0: 2062 6669 6c6c 2873 656c 663a 2054 5f44   bfill(self: T_D
-000353e0: 6174 6173 6574 2c20 6469 6d3a 2048 6173  ataset, dim: Has
-000353f0: 6861 626c 652c 206c 696d 6974 3a20 696e  hable, limit: in
-00035400: 7420 7c20 4e6f 6e65 203d 204e 6f6e 6529  t | None = None)
-00035410: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
-00035420: 2020 2020 2020 2022 2222 4669 6c6c 204e         """Fill N
-00035430: 614e 2076 616c 7565 7320 6279 2070 726f  aN values by pro
-00035440: 7061 6761 7469 6e67 2076 616c 7565 7320  pagating values 
-00035450: 6261 636b 7761 7264 0a0a 2020 2020 2020  backward..      
-00035460: 2020 2a52 6571 7569 7265 7320 626f 7474    *Requires bott
-00035470: 6c65 6e65 636b 2e2a 0a0a 2020 2020 2020  leneck.*..      
-00035480: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00035490: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-000354a0: 2020 2020 2020 2020 6469 6d20 3a20 4861          dim : Ha
-000354b0: 7368 6162 6c65 0a20 2020 2020 2020 2020  shable.         
-000354c0: 2020 2053 7065 6369 6669 6573 2074 6865     Specifies the
-000354d0: 2064 696d 656e 7369 6f6e 2061 6c6f 6e67   dimension along
-000354e0: 2077 6869 6368 2074 6f20 7072 6f70 6167   which to propag
-000354f0: 6174 6520 7661 6c75 6573 2077 6865 6e0a  ate values when.
-00035500: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-00035510: 696e 672e 0a20 2020 2020 2020 206c 696d  ing..        lim
-00035520: 6974 203a 2069 6e74 206f 7220 4e6f 6e65  it : int or None
-00035530: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00035540: 2020 2020 2020 2054 6865 206d 6178 696d         The maxim
-00035550: 756d 206e 756d 6265 7220 6f66 2063 6f6e  um number of con
-00035560: 7365 6375 7469 7665 204e 614e 2076 616c  secutive NaN val
-00035570: 7565 7320 746f 2062 6163 6b77 6172 6420  ues to backward 
-00035580: 6669 6c6c 2e20 496e 0a20 2020 2020 2020  fill. In.       
-00035590: 2020 2020 206f 7468 6572 2077 6f72 6473       other words
-000355a0: 2c20 6966 2074 6865 7265 2069 7320 6120  , if there is a 
-000355b0: 6761 7020 7769 7468 206d 6f72 6520 7468  gap with more th
-000355c0: 616e 2074 6869 7320 6e75 6d62 6572 206f  an this number o
-000355d0: 660a 2020 2020 2020 2020 2020 2020 636f  f.            co
-000355e0: 6e73 6563 7574 6976 6520 4e61 4e73 2c20  nsecutive NaNs, 
-000355f0: 6974 2077 696c 6c20 6f6e 6c79 2062 6520  it will only be 
-00035600: 7061 7274 6961 6c6c 7920 6669 6c6c 6564  partially filled
-00035610: 2e20 4d75 7374 2062 6520 6772 6561 7465  . Must be greate
-00035620: 720a 2020 2020 2020 2020 2020 2020 7468  r.            th
-00035630: 616e 2030 206f 7220 4e6f 6e65 2066 6f72  an 0 or None for
-00035640: 206e 6f20 6c69 6d69 742e 204d 7573 7420   no limit. Must 
-00035650: 6265 204e 6f6e 6520 6f72 2067 7265 6174  be None or great
-00035660: 6572 2074 6861 6e20 6f72 2065 7175 616c  er than or equal
-00035670: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
-00035680: 6178 6973 206c 656e 6774 6820 6966 2066  axis length if f
-00035690: 696c 6c69 6e67 2061 6c6f 6e67 2063 6875  illing along chu
-000356a0: 6e6b 6564 2061 7865 7320 2864 696d 656e  nked axes (dimen
-000356b0: 7369 6f6e 7329 2e0a 0a20 2020 2020 2020  sions)...       
-000356c0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-000356d0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-000356e0: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
-000356f0: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00035700: 6d20 7861 7272 6179 2e63 6f72 652e 6d69  m xarray.core.mi
-00035710: 7373 696e 6720 696d 706f 7274 205f 6170  ssing import _ap
-00035720: 706c 795f 6f76 6572 5f76 6172 735f 7769  ply_over_vars_wi
-00035730: 7468 5f64 696d 2c20 6266 696c 6c0a 0a20  th_dim, bfill.. 
-00035740: 2020 2020 2020 206e 6577 203d 205f 6170         new = _ap
-00035750: 706c 795f 6f76 6572 5f76 6172 735f 7769  ply_over_vars_wi
-00035760: 7468 5f64 696d 2862 6669 6c6c 2c20 7365  th_dim(bfill, se
-00035770: 6c66 2c20 6469 6d3d 6469 6d2c 206c 696d  lf, dim=dim, lim
-00035780: 6974 3d6c 696d 6974 290a 2020 2020 2020  it=limit).      
-00035790: 2020 7265 7475 726e 206e 6577 0a0a 2020    return new..  
-000357a0: 2020 6465 6620 636f 6d62 696e 655f 6669    def combine_fi
-000357b0: 7273 7428 7365 6c66 3a20 545f 4461 7461  rst(self: T_Data
-000357c0: 7365 742c 206f 7468 6572 3a20 545f 4461  set, other: T_Da
-000357d0: 7461 7365 7429 202d 3e20 545f 4461 7461  taset) -> T_Data
-000357e0: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
-000357f0: 436f 6d62 696e 6520 7477 6f20 4461 7461  Combine two Data
-00035800: 7365 7473 2c20 6465 6661 756c 7420 746f  sets, default to
-00035810: 2064 6174 615f 7661 7273 206f 6620 7365   data_vars of se
-00035820: 6c66 2e0a 0a20 2020 2020 2020 2054 6865  lf...        The
-00035830: 206e 6577 2063 6f6f 7264 696e 6174 6573   new coordinates
-00035840: 2066 6f6c 6c6f 7720 7468 6520 6e6f 726d   follow the norm
-00035850: 616c 2062 726f 6164 6361 7374 696e 6720  al broadcasting 
-00035860: 616e 6420 616c 6967 6e6d 656e 7420 7275  and alignment ru
-00035870: 6c65 730a 2020 2020 2020 2020 6f66 2060  les.        of `
-00035880: 606a 6f69 6e3d 276f 7574 6572 2760 602e  `join='outer'``.
-00035890: 2020 5661 6361 6e74 2063 656c 6c73 2069    Vacant cells i
-000358a0: 6e20 7468 6520 6578 7061 6e64 6564 2063  n the expanded c
-000358b0: 6f6f 7264 696e 6174 6573 2061 7265 0a20  oordinates are. 
-000358c0: 2020 2020 2020 2066 696c 6c65 6420 7769         filled wi
-000358d0: 7468 206e 702e 6e61 6e2e 0a0a 2020 2020  th np.nan...    
-000358e0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-000358f0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00035900: 2d0a 2020 2020 2020 2020 6f74 6865 7220  -.        other 
-00035910: 3a20 4461 7461 7365 740a 2020 2020 2020  : Dataset.      
-00035920: 2020 2020 2020 5573 6564 2074 6f20 6669        Used to fi
-00035930: 6c6c 2061 6c6c 206d 6174 6368 696e 6720  ll all matching 
-00035940: 6d69 7373 696e 6720 7661 6c75 6573 2069  missing values i
-00035950: 6e20 7468 6973 2061 7272 6179 2e0a 0a20  n this array... 
-00035960: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-00035970: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-00035980: 2020 2020 2020 2044 6174 6173 6574 0a20         Dataset. 
-00035990: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000359a0: 2020 206f 7574 203d 206f 7073 2e66 696c     out = ops.fil
-000359b0: 6c6e 6128 7365 6c66 2c20 6f74 6865 722c  lna(self, other,
-000359c0: 206a 6f69 6e3d 226f 7574 6572 222c 2064   join="outer", d
-000359d0: 6174 6173 6574 5f6a 6f69 6e3d 226f 7574  ataset_join="out
-000359e0: 6572 2229 0a20 2020 2020 2020 2072 6574  er").        ret
-000359f0: 7572 6e20 6f75 740a 0a20 2020 2064 6566  urn out..    def
-00035a00: 2072 6564 7563 6528 0a20 2020 2020 2020   reduce(.       
-00035a10: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
-00035a20: 2c0a 2020 2020 2020 2020 6675 6e63 3a20  ,.        func: 
-00035a30: 4361 6c6c 6162 6c65 2c0a 2020 2020 2020  Callable,.      
-00035a40: 2020 6469 6d3a 2044 696d 7320 3d20 4e6f    dim: Dims = No
-00035a50: 6e65 2c0a 2020 2020 2020 2020 2a2c 0a20  ne,.        *,. 
-00035a60: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
-00035a70: 733a 2062 6f6f 6c20 7c20 4e6f 6e65 203d  s: bool | None =
-00035a80: 204e 6f6e 652c 0a20 2020 2020 2020 206b   None,.        k
-00035a90: 6565 7064 696d 733a 2062 6f6f 6c20 3d20  eepdims: bool = 
-00035aa0: 4661 6c73 652c 0a20 2020 2020 2020 206e  False,.        n
-00035ab0: 756d 6572 6963 5f6f 6e6c 793a 2062 6f6f  umeric_only: boo
-00035ac0: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-00035ad0: 2020 202a 2a6b 7761 7267 733a 2041 6e79     **kwargs: Any
-00035ae0: 2c0a 2020 2020 2920 2d3e 2054 5f44 6174  ,.    ) -> T_Dat
-00035af0: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
-00035b00: 2252 6564 7563 6520 7468 6973 2064 6174  "Reduce this dat
-00035b10: 6173 6574 2062 7920 6170 706c 7969 6e67  aset by applying
-00035b20: 2060 6675 6e63 6020 616c 6f6e 6720 736f   `func` along so
-00035b30: 6d65 2064 696d 656e 7369 6f6e 2873 292e  me dimension(s).
-00035b40: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00035b50: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-00035b60: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00035b70: 6675 6e63 203a 2063 616c 6c61 626c 650a  func : callable.
-00035b80: 2020 2020 2020 2020 2020 2020 4675 6e63              Func
-00035b90: 7469 6f6e 2077 6869 6368 2063 616e 2062  tion which can b
-00035ba0: 6520 6361 6c6c 6564 2069 6e20 7468 6520  e called in the 
-00035bb0: 666f 726d 0a20 2020 2020 2020 2020 2020  form.           
-00035bc0: 2060 6628 782c 2061 7869 733d 6178 6973   `f(x, axis=axis
-00035bd0: 2c20 2a2a 6b77 6172 6773 2960 2074 6f20  , **kwargs)` to 
-00035be0: 7265 7475 726e 2074 6865 2072 6573 756c  return the resul
-00035bf0: 7420 6f66 2072 6564 7563 696e 6720 616e  t of reducing an
-00035c00: 0a20 2020 2020 2020 2020 2020 206e 702e  .            np.
-00035c10: 6e64 6172 7261 7920 6f76 6572 2061 6e20  ndarray over an 
-00035c20: 696e 7465 6765 7220 7661 6c75 6564 2061  integer valued a
-00035c30: 7869 732e 0a20 2020 2020 2020 2064 696d  xis..        dim
-00035c40: 203a 2073 7472 2c20 4974 6572 6162 6c65   : str, Iterable
-00035c50: 206f 6620 4861 7368 6162 6c65 206f 7220   of Hashable or 
-00035c60: 4e6f 6e65 2c20 6f70 7469 6f6e 616c 0a20  None, optional. 
-00035c70: 2020 2020 2020 2020 2020 2044 696d 656e             Dimen
-00035c80: 7369 6f6e 2873 2920 6f76 6572 2077 6869  sion(s) over whi
-00035c90: 6368 2074 6f20 6170 706c 7920 6066 756e  ch to apply `fun
-00035ca0: 6360 2e20 4279 2064 6566 6175 6c74 2060  c`. By default `
-00035cb0: 6675 6e63 6020 6973 0a20 2020 2020 2020  func` is.       
-00035cc0: 2020 2020 2061 7070 6c69 6564 206f 7665       applied ove
-00035cd0: 7220 616c 6c20 6469 6d65 6e73 696f 6e73  r all dimensions
-00035ce0: 2e0a 2020 2020 2020 2020 6b65 6570 5f61  ..        keep_a
-00035cf0: 7474 7273 203a 2062 6f6f 6c20 6f72 204e  ttrs : bool or N
-00035d00: 6f6e 652c 206f 7074 696f 6e61 6c0a 2020  one, optional.  
-00035d10: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-00035d20: 652c 2074 6865 2064 6174 6173 6574 2773  e, the dataset's
-00035d30: 2061 7474 7269 6275 7465 7320 2860 6174   attributes (`at
-00035d40: 7472 7360 2920 7769 6c6c 2062 6520 636f  trs`) will be co
-00035d50: 7069 6564 2066 726f 6d0a 2020 2020 2020  pied from.      
-00035d60: 2020 2020 2020 7468 6520 6f72 6967 696e        the origin
-00035d70: 616c 206f 626a 6563 7420 746f 2074 6865  al object to the
-00035d80: 206e 6577 206f 6e65 2e20 2049 6620 4661   new one.  If Fa
-00035d90: 6c73 6520 2864 6566 6175 6c74 292c 2074  lse (default), t
-00035da0: 6865 206e 6577 0a20 2020 2020 2020 2020  he new.         
-00035db0: 2020 206f 626a 6563 7420 7769 6c6c 2062     object will b
-00035dc0: 6520 7265 7475 726e 6564 2077 6974 686f  e returned witho
-00035dd0: 7574 2061 7474 7269 6275 7465 732e 0a20  ut attributes.. 
-00035de0: 2020 2020 2020 206b 6565 7064 696d 7320         keepdims 
-00035df0: 3a20 626f 6f6c 2c20 6465 6661 756c 743a  : bool, default:
-00035e00: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-00035e10: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
-00035e20: 6469 6d65 6e73 696f 6e73 2077 6869 6368  dimensions which
-00035e30: 2061 7265 2072 6564 7563 6564 2061 7265   are reduced are
-00035e40: 206c 6566 7420 696e 2074 6865 2072 6573   left in the res
-00035e50: 756c 740a 2020 2020 2020 2020 2020 2020  ult.            
-00035e60: 6173 2064 696d 656e 7369 6f6e 7320 6f66  as dimensions of
-00035e70: 2073 697a 6520 6f6e 652e 2043 6f6f 7264   size one. Coord
-00035e80: 696e 6174 6573 2074 6861 7420 7573 6520  inates that use 
-00035e90: 7468 6573 6520 6469 6d65 6e73 696f 6e73  these dimensions
-00035ea0: 0a20 2020 2020 2020 2020 2020 2061 7265  .            are
-00035eb0: 2072 656d 6f76 6564 2e0a 2020 2020 2020   removed..      
-00035ec0: 2020 6e75 6d65 7269 635f 6f6e 6c79 203a    numeric_only :
-00035ed0: 2062 6f6f 6c2c 2064 6566 6175 6c74 3a20   bool, default: 
-00035ee0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00035ef0: 2020 4966 2054 7275 652c 206f 6e6c 7920    If True, only 
-00035f00: 6170 706c 7920 6060 6675 6e63 6060 2074  apply ``func`` t
-00035f10: 6f20 7661 7269 6162 6c65 7320 7769 7468  o variables with
-00035f20: 2061 206e 756d 6572 6963 2064 7479 7065   a numeric dtype
-00035f30: 2e0a 2020 2020 2020 2020 2a2a 6b77 6172  ..        **kwar
-00035f40: 6773 203a 2041 6e79 0a20 2020 2020 2020  gs : Any.       
-00035f50: 2020 2020 2041 6464 6974 696f 6e61 6c20       Additional 
-00035f60: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-00035f70: 7320 7061 7373 6564 206f 6e20 746f 2060  s passed on to `
-00035f80: 6066 756e 6360 602e 0a0a 2020 2020 2020  `func``...      
-00035f90: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00035fa0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00035fb0: 2020 7265 6475 6365 6420 3a20 4461 7461    reduced : Data
-00035fc0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
-00035fd0: 4461 7461 7365 7420 7769 7468 2074 6869  Dataset with thi
-00035fe0: 7320 6f62 6a65 6374 2773 2044 6174 6141  s object's DataA
-00035ff0: 7272 6179 7320 7265 706c 6163 6564 2077  rrays replaced w
-00036000: 6974 6820 6e65 7720 4461 7461 4172 7261  ith new DataArra
-00036010: 7973 0a20 2020 2020 2020 2020 2020 206f  ys.            o
-00036020: 6620 7375 6d6d 6172 697a 6564 2064 6174  f summarized dat
-00036030: 6120 616e 6420 7468 6520 696e 6469 6361  a and the indica
-00036040: 7465 6420 6469 6d65 6e73 696f 6e28 7329  ted dimension(s)
-00036050: 2072 656d 6f76 6564 2e0a 2020 2020 2020   removed..      
-00036060: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00036070: 206b 7761 7267 732e 6765 7428 2261 7869   kwargs.get("axi
-00036080: 7322 2c20 4e6f 6e65 2920 6973 206e 6f74  s", None) is not
-00036090: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000360a0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000360b0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-000360c0: 2020 2020 2022 7061 7373 696e 6720 2761       "passing 'a
-000360d0: 7869 7327 2074 6f20 4461 7461 7365 7420  xis' to Dataset 
-000360e0: 7265 6475 6365 206d 6574 686f 6473 2069  reduce methods i
-000360f0: 7320 616d 6269 6775 6f75 732e 220a 2020  s ambiguous.".  
-00036100: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00036110: 506c 6561 7365 2075 7365 2027 6469 6d27  Please use 'dim'
-00036120: 2069 6e73 7465 6164 2e22 0a20 2020 2020   instead.".     
-00036130: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00036140: 2020 6966 2064 696d 2069 7320 4e6f 6e65    if dim is None
-00036150: 206f 7220 6469 6d20 6973 202e 2e2e 3a0a   or dim is ...:.
-00036160: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
-00036170: 203d 2073 6574 2873 656c 662e 6469 6d73   = set(self.dims
-00036180: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
-00036190: 7369 6e73 7461 6e63 6528 6469 6d2c 2073  sinstance(dim, s
-000361a0: 7472 2920 6f72 206e 6f74 2069 7369 6e73  tr) or not isins
-000361b0: 7461 6e63 6528 6469 6d2c 2049 7465 7261  tance(dim, Itera
-000361c0: 626c 6529 3a0a 2020 2020 2020 2020 2020  ble):.          
-000361d0: 2020 6469 6d73 203d 207b 6469 6d7d 0a20    dims = {dim}. 
-000361e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000361f0: 2020 2020 2020 2020 2064 696d 7320 3d20           dims = 
-00036200: 7365 7428 6469 6d29 0a0a 2020 2020 2020  set(dim)..      
-00036210: 2020 6d69 7373 696e 675f 6469 6d65 6e73    missing_dimens
-00036220: 696f 6e73 203d 205b 6420 666f 7220 6420  ions = [d for d 
-00036230: 696e 2064 696d 7320 6966 2064 206e 6f74  in dims if d not
-00036240: 2069 6e20 7365 6c66 2e64 696d 735d 0a20   in self.dims]. 
-00036250: 2020 2020 2020 2069 6620 6d69 7373 696e         if missin
-00036260: 675f 6469 6d65 6e73 696f 6e73 3a0a 2020  g_dimensions:.  
-00036270: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00036280: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00036290: 2020 2020 2020 2020 2020 2020 6622 4461              f"Da
-000362a0: 7461 7365 7420 646f 6573 206e 6f74 2063  taset does not c
-000362b0: 6f6e 7461 696e 2074 6865 2064 696d 656e  ontain the dimen
-000362c0: 7369 6f6e 733a 207b 6d69 7373 696e 675f  sions: {missing_
-000362d0: 6469 6d65 6e73 696f 6e73 7d22 0a20 2020  dimensions}".   
-000362e0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-000362f0: 2020 2020 6966 206b 6565 705f 6174 7472      if keep_attr
-00036300: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00036310: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
-00036320: 7320 3d20 5f67 6574 5f6b 6565 705f 6174  s = _get_keep_at
-00036330: 7472 7328 6465 6661 756c 743d 4661 6c73  trs(default=Fals
-00036340: 6529 0a0a 2020 2020 2020 2020 7661 7269  e)..        vari
-00036350: 6162 6c65 733a 2064 6963 745b 4861 7368  ables: dict[Hash
-00036360: 6162 6c65 2c20 5661 7269 6162 6c65 5d20  able, Variable] 
-00036370: 3d20 7b7d 0a20 2020 2020 2020 2066 6f72  = {}.        for
-00036380: 206e 616d 652c 2076 6172 2069 6e20 7365   name, var in se
-00036390: 6c66 2e5f 7661 7269 6162 6c65 732e 6974  lf._variables.it
-000363a0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-000363b0: 2020 2072 6564 7563 655f 6469 6d73 203d     reduce_dims =
-000363c0: 205b 6420 666f 7220 6420 696e 2076 6172   [d for d in var
-000363d0: 2e64 696d 7320 6966 2064 2069 6e20 6469  .dims if d in di
-000363e0: 6d73 5d0a 2020 2020 2020 2020 2020 2020  ms].            
-000363f0: 6966 206e 616d 6520 696e 2073 656c 662e  if name in self.
-00036400: 636f 6f72 6473 3a0a 2020 2020 2020 2020  coords:.        
-00036410: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
-00036420: 6564 7563 655f 6469 6d73 3a0a 2020 2020  educe_dims:.    
-00036430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036440: 7661 7269 6162 6c65 735b 6e61 6d65 5d20  variables[name] 
-00036450: 3d20 7661 720a 2020 2020 2020 2020 2020  = var.          
-00036460: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00036470: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00036480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036490: 2023 2053 6f6d 6520 7265 6475 6374 696f   # Some reductio
-000364a0: 6e20 6675 6e63 7469 6f6e 7320 2865 2e67  n functions (e.g
-000364b0: 2e20 7374 642c 2076 6172 2920 6e65 6564  . std, var) need
-000364c0: 2074 6f20 7275 6e20 6f6e 2076 6172 6961   to run on varia
-000364d0: 626c 6573 0a20 2020 2020 2020 2020 2020  bles.           
-000364e0: 2020 2020 2020 2020 2023 2074 6861 7420           # that 
-000364f0: 646f 6e27 7420 6861 7665 2074 6865 2072  don't have the r
-00036500: 6564 7563 6520 6469 6d73 3a20 5052 3533  educe dims: PR53
-00036510: 3933 0a20 2020 2020 2020 2020 2020 2020  93.             
-00036520: 2020 2020 2020 206e 6f74 2072 6564 7563         not reduc
-00036530: 655f 6469 6d73 0a20 2020 2020 2020 2020  e_dims.         
-00036540: 2020 2020 2020 2020 2020 206f 7220 6e6f             or no
-00036550: 7420 6e75 6d65 7269 635f 6f6e 6c79 0a20  t numeric_only. 
-00036560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036570: 2020 206f 7220 6e70 2e69 7373 7562 6474     or np.issubdt
-00036580: 7970 6528 7661 722e 6474 7970 652c 206e  ype(var.dtype, n
-00036590: 702e 6e75 6d62 6572 290a 2020 2020 2020  p.number).      
-000365a0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-000365b0: 2028 7661 722e 6474 7970 6520 3d3d 206e   (var.dtype == n
-000365c0: 702e 626f 6f6c 5f29 0a20 2020 2020 2020  p.bool_).       
-000365d0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
-000365e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000365f0: 2320 7072 6566 6572 2074 6f20 6167 6772  # prefer to aggr
-00036600: 6567 6174 6520 6f76 6572 2061 7869 733d  egate over axis=
-00036610: 4e6f 6e65 2072 6174 6865 7220 7468 616e  None rather than
-00036620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036630: 2020 2020 2023 2061 7869 733d 2830 2c20       # axis=(0, 
-00036640: 3129 2069 6620 7468 6579 2077 696c 6c20  1) if they will 
-00036650: 6265 2065 7175 6976 616c 656e 742c 2062  be equivalent, b
-00036660: 6563 6175 7365 0a20 2020 2020 2020 2020  ecause.         
-00036670: 2020 2020 2020 2020 2020 2023 2074 6865             # the
-00036680: 2066 6f72 6d65 7220 6973 206f 6674 656e   former is often
-00036690: 206d 6f72 6520 6566 6669 6369 656e 740a   more efficient.
-000366a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000366b0: 2020 2020 2320 6b65 6570 2073 696e 676c      # keep singl
-000366c0: 652d 656c 656d 656e 7420 6469 6d73 2061  e-element dims a
-000366d0: 7320 6c69 7374 2c20 746f 2073 7570 706f  s list, to suppo
-000366e0: 7274 2048 6173 6861 626c 6573 0a20 2020  rt Hashables.   
-000366f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036700: 2072 6564 7563 655f 6d61 7962 655f 7369   reduce_maybe_si
-00036710: 6e67 6c65 203d 2028 0a20 2020 2020 2020  ngle = (.       
-00036720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036730: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-00036740: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00036750: 206c 656e 2872 6564 7563 655f 6469 6d73   len(reduce_dims
-00036760: 2920 3d3d 2076 6172 2e6e 6469 6d20 616e  ) == var.ndim an
-00036770: 6420 7661 722e 6e64 696d 2021 3d20 310a  d var.ndim != 1.
-00036780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036790: 2020 2020 2020 2020 656c 7365 2072 6564          else red
-000367a0: 7563 655f 6469 6d73 0a20 2020 2020 2020  uce_dims.       
-000367b0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-000367c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000367d0: 2020 2076 6172 6961 626c 6573 5b6e 616d     variables[nam
-000367e0: 655d 203d 2076 6172 2e72 6564 7563 6528  e] = var.reduce(
-000367f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036800: 2020 2020 2020 2020 2066 756e 632c 0a20           func,. 
-00036810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036820: 2020 2020 2020 2064 696d 3d72 6564 7563         dim=reduc
-00036830: 655f 6d61 7962 655f 7369 6e67 6c65 2c0a  e_maybe_single,.
-00036840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036850: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
-00036860: 7273 3d6b 6565 705f 6174 7472 732c 0a20  rs=keep_attrs,. 
-00036870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036880: 2020 2020 2020 206b 6565 7064 696d 733d         keepdims=
-00036890: 6b65 6570 6469 6d73 2c0a 2020 2020 2020  keepdims,.      
-000368a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000368b0: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
-000368c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000368d0: 290a 0a20 2020 2020 2020 2063 6f6f 7264  )..        coord
-000368e0: 5f6e 616d 6573 203d 207b 6b20 666f 7220  _names = {k for 
-000368f0: 6b20 696e 2073 656c 662e 636f 6f72 6473  k in self.coords
-00036900: 2069 6620 6b20 696e 2076 6172 6961 626c   if k in variabl
-00036910: 6573 7d0a 2020 2020 2020 2020 696e 6465  es}.        inde
-00036920: 7865 7320 3d20 7b6b 3a20 7620 666f 7220  xes = {k: v for 
-00036930: 6b2c 2076 2069 6e20 7365 6c66 2e5f 696e  k, v in self._in
-00036940: 6465 7865 732e 6974 656d 7328 2920 6966  dexes.items() if
-00036950: 206b 2069 6e20 7661 7269 6162 6c65 737d   k in variables}
-00036960: 0a20 2020 2020 2020 2061 7474 7273 203d  .        attrs =
-00036970: 2073 656c 662e 6174 7472 7320 6966 206b   self.attrs if k
-00036980: 6565 705f 6174 7472 7320 656c 7365 204e  eep_attrs else N
-00036990: 6f6e 650a 2020 2020 2020 2020 7265 7475  one.        retu
-000369a0: 726e 2073 656c 662e 5f72 6570 6c61 6365  rn self._replace
-000369b0: 5f77 6974 685f 6e65 775f 6469 6d73 280a  _with_new_dims(.
-000369c0: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-000369d0: 6162 6c65 732c 2063 6f6f 7264 5f6e 616d  ables, coord_nam
-000369e0: 6573 3d63 6f6f 7264 5f6e 616d 6573 2c20  es=coord_names, 
-000369f0: 6174 7472 733d 6174 7472 732c 2069 6e64  attrs=attrs, ind
-00036a00: 6578 6573 3d69 6e64 6578 6573 0a20 2020  exes=indexes.   
-00036a10: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00036a20: 6d61 7028 0a20 2020 2020 2020 2073 656c  map(.        sel
-00036a30: 663a 2054 5f44 6174 6173 6574 2c0a 2020  f: T_Dataset,.  
-00036a40: 2020 2020 2020 6675 6e63 3a20 4361 6c6c        func: Call
-00036a50: 6162 6c65 2c0a 2020 2020 2020 2020 6b65  able,.        ke
-00036a60: 6570 5f61 7474 7273 3a20 626f 6f6c 207c  ep_attrs: bool |
-00036a70: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00036a80: 2020 2020 2020 6172 6773 3a20 4974 6572        args: Iter
-00036a90: 6162 6c65 5b41 6e79 5d20 3d20 2829 2c0a  able[Any] = (),.
-00036aa0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-00036ab0: 3a20 416e 792c 0a20 2020 2029 202d 3e20  : Any,.    ) -> 
-00036ac0: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
-00036ad0: 2020 2022 2222 4170 706c 7920 6120 6675     """Apply a fu
-00036ae0: 6e63 7469 6f6e 2074 6f20 6561 6368 2064  nction to each d
-00036af0: 6174 6120 7661 7269 6162 6c65 2069 6e20  ata variable in 
-00036b00: 7468 6973 2064 6174 6173 6574 0a0a 2020  this dataset..  
-00036b10: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00036b20: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00036b30: 2d2d 2d0a 2020 2020 2020 2020 6675 6e63  ---.        func
-00036b40: 203a 2063 616c 6c61 626c 650a 2020 2020   : callable.    
-00036b50: 2020 2020 2020 2020 4675 6e63 7469 6f6e          Function
-00036b60: 2077 6869 6368 2063 616e 2062 6520 6361   which can be ca
-00036b70: 6c6c 6564 2069 6e20 7468 6520 666f 726d  lled in the form
-00036b80: 2060 6675 6e63 2878 2c20 2a61 7267 732c   `func(x, *args,
-00036b90: 202a 2a6b 7761 7267 7329 600a 2020 2020   **kwargs)`.    
-00036ba0: 2020 2020 2020 2020 746f 2074 7261 6e73          to trans
-00036bb0: 666f 726d 2065 6163 6820 4461 7461 4172  form each DataAr
-00036bc0: 7261 7920 6078 6020 696e 2074 6869 7320  ray `x` in this 
-00036bd0: 6461 7461 7365 7420 696e 746f 2061 6e6f  dataset into ano
-00036be0: 7468 6572 0a20 2020 2020 2020 2020 2020  ther.           
-00036bf0: 2044 6174 6141 7272 6179 2e0a 2020 2020   DataArray..    
-00036c00: 2020 2020 6b65 6570 5f61 7474 7273 203a      keep_attrs :
-00036c10: 2062 6f6f 6c20 6f72 204e 6f6e 652c 206f   bool or None, o
-00036c20: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00036c30: 2020 2020 4966 2054 7275 652c 2062 6f74      If True, bot
-00036c40: 6820 7468 6520 6461 7461 7365 7427 7320  h the dataset's 
-00036c50: 616e 6420 7661 7269 6162 6c65 7327 2061  and variables' a
-00036c60: 7474 7269 6275 7465 7320 2860 6174 7472  ttributes (`attr
-00036c70: 7360 2920 7769 6c6c 2062 650a 2020 2020  s`) will be.    
-00036c80: 2020 2020 2020 2020 636f 7069 6564 2066          copied f
-00036c90: 726f 6d20 7468 6520 6f72 6967 696e 616c  rom the original
-00036ca0: 206f 626a 6563 7473 2074 6f20 7468 6520   objects to the 
-00036cb0: 6e65 7720 6f6e 6573 2e20 4966 2046 616c  new ones. If Fal
-00036cc0: 7365 2c20 7468 6520 6e65 7720 6461 7461  se, the new data
-00036cd0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
-00036ce0: 616e 6420 7661 7269 6162 6c65 7320 7769  and variables wi
-00036cf0: 6c6c 2062 6520 7265 7475 726e 6564 2077  ll be returned w
-00036d00: 6974 686f 7574 2063 6f70 7969 6e67 2074  ithout copying t
-00036d10: 6865 2061 7474 7269 6275 7465 732e 0a20  he attributes.. 
-00036d20: 2020 2020 2020 2061 7267 7320 3a20 6974         args : it
-00036d30: 6572 6162 6c65 2c20 6f70 7469 6f6e 616c  erable, optional
-00036d40: 0a20 2020 2020 2020 2020 2020 2050 6f73  .            Pos
-00036d50: 6974 696f 6e61 6c20 6172 6775 6d65 6e74  itional argument
-00036d60: 7320 7061 7373 6564 206f 6e20 746f 2060  s passed on to `
-00036d70: 6675 6e63 602e 0a20 2020 2020 2020 202a  func`..        *
-00036d80: 2a6b 7761 7267 7320 3a20 416e 790a 2020  *kwargs : Any.  
-00036d90: 2020 2020 2020 2020 2020 4b65 7977 6f72            Keywor
-00036da0: 6420 6172 6775 6d65 6e74 7320 7061 7373  d arguments pass
-00036db0: 6564 206f 6e20 746f 2060 6675 6e63 602e  ed on to `func`.
-00036dc0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00036dd0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00036de0: 2d0a 2020 2020 2020 2020 6170 706c 6965  -.        applie
-00036df0: 6420 3a20 4461 7461 7365 740a 2020 2020  d : Dataset.    
-00036e00: 2020 2020 2020 2020 5265 7375 6c74 696e          Resultin
-00036e10: 6720 6461 7461 7365 7420 6672 6f6d 2061  g dataset from a
-00036e20: 7070 6c79 696e 6720 6060 6675 6e63 6060  pplying ``func``
-00036e30: 2074 6f20 6561 6368 2064 6174 6120 7661   to each data va
-00036e40: 7269 6162 6c65 2e0a 0a20 2020 2020 2020  riable...       
-00036e50: 2045 7861 6d70 6c65 730a 2020 2020 2020   Examples.      
-00036e60: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-00036e70: 2020 203e 3e3e 2064 6120 3d20 7872 2e44     >>> da = xr.D
-00036e80: 6174 6141 7272 6179 286e 702e 7261 6e64  ataArray(np.rand
-00036e90: 6f6d 2e72 616e 646e 2832 2c20 3329 290a  om.randn(2, 3)).
-00036ea0: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
-00036eb0: 2078 722e 4461 7461 7365 7428 7b22 666f   xr.Dataset({"fo
-00036ec0: 6f22 3a20 6461 2c20 2262 6172 223a 2028  o": da, "bar": (
-00036ed0: 2278 222c 205b 2d31 2c20 325d 297d 290a  "x", [-1, 2])}).
-00036ee0: 2020 2020 2020 2020 3e3e 3e20 6473 0a20          >>> ds. 
-00036ef0: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
-00036f00: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
-00036f10: 4469 6d65 6e73 696f 6e73 3a20 2028 6469  Dimensions:  (di
-00036f20: 6d5f 303a 2032 2c20 6469 6d5f 313a 2033  m_0: 2, dim_1: 3
-00036f30: 2c20 783a 2032 290a 2020 2020 2020 2020  , x: 2).        
-00036f40: 4469 6d65 6e73 696f 6e73 2077 6974 686f  Dimensions witho
-00036f50: 7574 2063 6f6f 7264 696e 6174 6573 3a20  ut coordinates: 
-00036f60: 6469 6d5f 302c 2064 696d 5f31 2c20 780a  dim_0, dim_1, x.
-00036f70: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-00036f80: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-00036f90: 2020 2020 666f 6f20 2020 2020 2028 6469      foo      (di
-00036fa0: 6d5f 302c 2064 696d 5f31 2920 666c 6f61  m_0, dim_1) floa
-00036fb0: 7436 3420 312e 3736 3420 302e 3430 3032  t64 1.764 0.4002
-00036fc0: 2030 2e39 3738 3720 322e 3234 3120 312e   0.9787 2.241 1.
-00036fd0: 3836 3820 2d30 2e39 3737 330a 2020 2020  868 -0.9773.    
-00036fe0: 2020 2020 2020 2020 6261 7220 2020 2020          bar     
-00036ff0: 2028 7829 2069 6e74 3634 202d 3120 320a   (x) int64 -1 2.
-00037000: 2020 2020 2020 2020 3e3e 3e20 6473 2e6d          >>> ds.m
-00037010: 6170 286e 702e 6661 6273 290a 2020 2020  ap(np.fabs).    
-00037020: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
-00037030: 7365 743e 0a20 2020 2020 2020 2044 696d  set>.        Dim
-00037040: 656e 7369 6f6e 733a 2020 2864 696d 5f30  ensions:  (dim_0
-00037050: 3a20 322c 2064 696d 5f31 3a20 332c 2078  : 2, dim_1: 3, x
-00037060: 3a20 3229 0a20 2020 2020 2020 2044 696d  : 2).        Dim
-00037070: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
-00037080: 636f 6f72 6469 6e61 7465 733a 2064 696d  coordinates: dim
-00037090: 5f30 2c20 6469 6d5f 312c 2078 0a20 2020  _0, dim_1, x.   
-000370a0: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
-000370b0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-000370c0: 2066 6f6f 2020 2020 2020 2864 696d 5f30   foo      (dim_0
-000370d0: 2c20 6469 6d5f 3129 2066 6c6f 6174 3634  , dim_1) float64
-000370e0: 2031 2e37 3634 2030 2e34 3030 3220 302e   1.764 0.4002 0.
-000370f0: 3937 3837 2032 2e32 3431 2031 2e38 3638  9787 2.241 1.868
-00037100: 2030 2e39 3737 330a 2020 2020 2020 2020   0.9773.        
-00037110: 2020 2020 6261 7220 2020 2020 2028 7829      bar      (x)
-00037120: 2066 6c6f 6174 3634 2031 2e30 2032 2e30   float64 1.0 2.0
-00037130: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00037140: 2020 2020 2069 6620 6b65 6570 5f61 7474       if keep_att
-00037150: 7273 2069 7320 4e6f 6e65 3a0a 2020 2020  rs is None:.    
-00037160: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
-00037170: 7273 203d 205f 6765 745f 6b65 6570 5f61  rs = _get_keep_a
-00037180: 7474 7273 2864 6566 6175 6c74 3d46 616c  ttrs(default=Fal
-00037190: 7365 290a 2020 2020 2020 2020 7661 7269  se).        vari
-000371a0: 6162 6c65 7320 3d20 7b0a 2020 2020 2020  ables = {.      
-000371b0: 2020 2020 2020 6b3a 206d 6179 6265 5f77        k: maybe_w
-000371c0: 7261 705f 6172 7261 7928 762c 2066 756e  rap_array(v, fun
-000371d0: 6328 762c 202a 6172 6773 2c20 2a2a 6b77  c(v, *args, **kw
-000371e0: 6172 6773 2929 0a20 2020 2020 2020 2020  args)).         
-000371f0: 2020 2066 6f72 206b 2c20 7620 696e 2073     for k, v in s
-00037200: 656c 662e 6461 7461 5f76 6172 732e 6974  elf.data_vars.it
-00037210: 656d 7328 290a 2020 2020 2020 2020 7d0a  ems().        }.
-00037220: 2020 2020 2020 2020 6966 206b 6565 705f          if keep_
-00037230: 6174 7472 733a 0a20 2020 2020 2020 2020  attrs:.         
-00037240: 2020 2066 6f72 206b 2c20 7620 696e 2076     for k, v in v
-00037250: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
-00037260: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00037270: 2020 762e 5f63 6f70 795f 6174 7472 735f    v._copy_attrs_
-00037280: 6672 6f6d 2873 656c 662e 6461 7461 5f76  from(self.data_v
-00037290: 6172 735b 6b5d 290a 2020 2020 2020 2020  ars[k]).        
-000372a0: 6174 7472 7320 3d20 7365 6c66 2e61 7474  attrs = self.att
-000372b0: 7273 2069 6620 6b65 6570 5f61 7474 7273  rs if keep_attrs
-000372c0: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
-000372d0: 2020 2072 6574 7572 6e20 7479 7065 2873     return type(s
-000372e0: 656c 6629 2876 6172 6961 626c 6573 2c20  elf)(variables, 
-000372f0: 6174 7472 733d 6174 7472 7329 0a0a 2020  attrs=attrs)..  
-00037300: 2020 6465 6620 6170 706c 7928 0a20 2020    def apply(.   
-00037310: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-00037320: 6173 6574 2c0a 2020 2020 2020 2020 6675  aset,.        fu
-00037330: 6e63 3a20 4361 6c6c 6162 6c65 2c0a 2020  nc: Callable,.  
-00037340: 2020 2020 2020 6b65 6570 5f61 7474 7273        keep_attrs
-00037350: 3a20 626f 6f6c 207c 204e 6f6e 6520 3d20  : bool | None = 
-00037360: 4e6f 6e65 2c0a 2020 2020 2020 2020 6172  None,.        ar
-00037370: 6773 3a20 4974 6572 6162 6c65 5b41 6e79  gs: Iterable[Any
-00037380: 5d20 3d20 2829 2c0a 2020 2020 2020 2020  ] = (),.        
-00037390: 2a2a 6b77 6172 6773 3a20 416e 792c 0a20  **kwargs: Any,. 
-000373a0: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
-000373b0: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
-000373c0: 2020 2020 2020 2042 6163 6b77 6172 6420         Backward 
-000373d0: 636f 6d70 6174 6962 6c65 2069 6d70 6c65  compatible imple
-000373e0: 6d65 6e74 6174 696f 6e20 6f66 2060 606d  mentation of ``m
-000373f0: 6170 6060 0a0a 2020 2020 2020 2020 5365  ap``..        Se
-00037400: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
-00037410: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00037420: 4461 7461 7365 742e 6d61 700a 2020 2020  Dataset.map.    
-00037430: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00037440: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
-00037450: 2020 2020 2020 2020 2020 2022 4461 7461             "Data
-00037460: 7365 742e 6170 706c 7920 6d61 7920 6265  set.apply may be
-00037470: 2064 6570 7265 6361 7465 6420 696e 2074   deprecated in t
-00037480: 6865 2066 7574 7572 652e 2055 7369 6e67  he future. Using
-00037490: 2044 6174 6173 6574 2e6d 6170 2069 7320   Dataset.map is 
-000374a0: 656e 636f 7572 6167 6564 222c 0a20 2020  encouraged",.   
-000374b0: 2020 2020 2020 2020 2050 656e 6469 6e67           Pending
-000374c0: 4465 7072 6563 6174 696f 6e57 6172 6e69  DeprecationWarni
-000374d0: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-000374e0: 7374 6163 6b6c 6576 656c 3d32 2c0a 2020  stacklevel=2,.  
-000374f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00037500: 7265 7475 726e 2073 656c 662e 6d61 7028  return self.map(
-00037510: 6675 6e63 2c20 6b65 6570 5f61 7474 7273  func, keep_attrs
-00037520: 2c20 6172 6773 2c20 2a2a 6b77 6172 6773  , args, **kwargs
-00037530: 290a 0a20 2020 2064 6566 2061 7373 6967  )..    def assig
-00037540: 6e28 0a20 2020 2020 2020 2073 656c 663a  n(.        self:
-00037550: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
-00037560: 2020 2020 7661 7269 6162 6c65 733a 204d      variables: M
-00037570: 6170 7069 6e67 5b41 6e79 2c20 416e 795d  apping[Any, Any]
-00037580: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00037590: 2020 2020 2020 2020 2a2a 7661 7269 6162          **variab
-000375a0: 6c65 735f 6b77 6172 6773 3a20 416e 792c  les_kwargs: Any,
-000375b0: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
-000375c0: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
-000375d0: 4173 7369 676e 206e 6577 2064 6174 6120  Assign new data 
-000375e0: 7661 7269 6162 6c65 7320 746f 2061 2044  variables to a D
-000375f0: 6174 6173 6574 2c20 7265 7475 726e 696e  ataset, returnin
-00037600: 6720 6120 6e65 7720 6f62 6a65 6374 0a20  g a new object. 
-00037610: 2020 2020 2020 2077 6974 6820 616c 6c20         with all 
-00037620: 7468 6520 6f72 6967 696e 616c 2076 6172  the original var
-00037630: 6961 626c 6573 2069 6e20 6164 6469 7469  iables in additi
-00037640: 6f6e 2074 6f20 7468 6520 6e65 7720 6f6e  on to the new on
-00037650: 6573 2e0a 0a20 2020 2020 2020 2050 6172  es...        Par
-00037660: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00037670: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00037680: 2020 2076 6172 6961 626c 6573 203a 206d     variables : m
-00037690: 6170 7069 6e67 206f 6620 6861 7368 6162  apping of hashab
-000376a0: 6c65 2074 6f20 416e 790a 2020 2020 2020  le to Any.      
-000376b0: 2020 2020 2020 4d61 7070 696e 6720 6672        Mapping fr
-000376c0: 6f6d 2076 6172 6961 626c 6573 206e 616d  om variables nam
-000376d0: 6573 2074 6f20 7468 6520 6e65 7720 7661  es to the new va
-000376e0: 6c75 6573 2e20 4966 2074 6865 206e 6577  lues. If the new
-000376f0: 2076 616c 7565 730a 2020 2020 2020 2020   values.        
-00037700: 2020 2020 6172 6520 6361 6c6c 6162 6c65      are callable
-00037710: 2c20 7468 6579 2061 7265 2063 6f6d 7075  , they are compu
-00037720: 7465 6420 6f6e 2074 6865 2044 6174 6173  ted on the Datas
-00037730: 6574 2061 6e64 2061 7373 6967 6e65 6420  et and assigned 
-00037740: 746f 206e 6577 0a20 2020 2020 2020 2020  to new.         
-00037750: 2020 2064 6174 6120 7661 7269 6162 6c65     data variable
-00037760: 732e 2049 6620 7468 6520 7661 6c75 6573  s. If the values
-00037770: 2061 7265 206e 6f74 2063 616c 6c61 626c   are not callabl
-00037780: 652c 2028 652e 672e 2061 2044 6174 6141  e, (e.g. a DataA
-00037790: 7272 6179 2c0a 2020 2020 2020 2020 2020  rray,.          
-000377a0: 2020 7363 616c 6172 2c20 6f72 2061 7272    scalar, or arr
-000377b0: 6179 292c 2074 6865 7920 6172 6520 7369  ay), they are si
-000377c0: 6d70 6c79 2061 7373 6967 6e65 642e 0a20  mply assigned.. 
-000377d0: 2020 2020 2020 202a 2a76 6172 6961 626c         **variabl
-000377e0: 6573 5f6b 7761 7267 730a 2020 2020 2020  es_kwargs.      
-000377f0: 2020 2020 2020 5468 6520 6b65 7977 6f72        The keywor
-00037800: 6420 6172 6775 6d65 6e74 7320 666f 726d  d arguments form
-00037810: 206f 6620 6060 7661 7269 6162 6c65 7360   of ``variables`
-00037820: 602e 0a20 2020 2020 2020 2020 2020 204f  `..            O
-00037830: 6e65 206f 6620 7661 7269 6162 6c65 7320  ne of variables 
-00037840: 6f72 2076 6172 6961 626c 6573 5f6b 7761  or variables_kwa
-00037850: 7267 7320 6d75 7374 2062 6520 7072 6f76  rgs must be prov
-00037860: 6964 6564 2e0a 0a20 2020 2020 2020 2052  ided...        R
-00037870: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
-00037880: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-00037890: 7320 3a20 4461 7461 7365 740a 2020 2020  s : Dataset.    
-000378a0: 2020 2020 2020 2020 4120 6e65 7720 4461          A new Da
-000378b0: 7461 7365 7420 7769 7468 2074 6865 206e  taset with the n
-000378c0: 6577 2076 6172 6961 626c 6573 2069 6e20  ew variables in 
-000378d0: 6164 6469 7469 6f6e 2074 6f20 616c 6c20  addition to all 
-000378e0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-000378f0: 6578 6973 7469 6e67 2076 6172 6961 626c  existing variabl
-00037900: 6573 2e0a 0a20 2020 2020 2020 204e 6f74  es...        Not
-00037910: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
-00037920: 0a20 2020 2020 2020 2053 696e 6365 2060  .        Since `
-00037930: 606b 7761 7267 7360 6020 6973 2061 2064  `kwargs`` is a d
-00037940: 6963 7469 6f6e 6172 792c 2074 6865 206f  ictionary, the o
-00037950: 7264 6572 206f 6620 796f 7572 2061 7267  rder of your arg
-00037960: 756d 656e 7473 206d 6179 206e 6f74 0a20  uments may not. 
-00037970: 2020 2020 2020 2062 6520 7072 6573 6572         be preser
-00037980: 7665 642c 2061 6e64 2073 6f20 7468 6520  ved, and so the 
-00037990: 6f72 6465 7220 6f66 2074 6865 206e 6577  order of the new
-000379a0: 2076 6172 6961 626c 6573 2069 7320 6e6f   variables is no
-000379b0: 7420 7765 6c6c 0a20 2020 2020 2020 2064  t well.        d
-000379c0: 6566 696e 6564 2e20 4173 7369 676e 696e  efined. Assignin
-000379d0: 6720 6d75 6c74 6970 6c65 2076 6172 6961  g multiple varia
-000379e0: 626c 6573 2077 6974 6869 6e20 7468 6520  bles within the 
-000379f0: 7361 6d65 2060 6061 7373 6967 6e60 6020  same ``assign`` 
-00037a00: 6973 0a20 2020 2020 2020 2070 6f73 7369  is.        possi
-00037a10: 626c 652c 2062 7574 2079 6f75 2063 616e  ble, but you can
-00037a20: 6e6f 7420 7265 6665 7265 6e63 6520 6f74  not reference ot
-00037a30: 6865 7220 7661 7269 6162 6c65 7320 6372  her variables cr
-00037a40: 6561 7465 6420 7769 7468 696e 2074 6865  eated within the
-00037a50: 0a20 2020 2020 2020 2073 616d 6520 6060  .        same ``
-00037a60: 6173 7369 676e 6060 2063 616c 6c2e 0a0a  assign`` call...
-00037a70: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-00037a80: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00037a90: 2d0a 2020 2020 2020 2020 7061 6e64 6173  -.        pandas
-00037aa0: 2e44 6174 6146 7261 6d65 2e61 7373 6967  .DataFrame.assig
-00037ab0: 6e0a 0a20 2020 2020 2020 2045 7861 6d70  n..        Examp
-00037ac0: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
-00037ad0: 2d2d 2d2d 0a20 2020 2020 2020 203e 3e3e  ----.        >>>
-00037ae0: 2078 203d 2078 722e 4461 7461 7365 7428   x = xr.Dataset(
-00037af0: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-00037b00: 207b 0a20 2020 2020 2020 202e 2e2e 2020   {.        ...  
-00037b10: 2020 2020 2020 2022 7465 6d70 6572 6174         "temperat
-00037b20: 7572 655f 6322 3a20 280a 2020 2020 2020  ure_c": (.      
-00037b30: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
-00037b40: 2020 2822 6c61 7422 2c20 226c 6f6e 2229    ("lat", "lon")
-00037b50: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-00037b60: 2020 2020 2020 2020 2020 3230 202a 206e            20 * n
-00037b70: 702e 7261 6e64 6f6d 2e72 616e 6428 3429  p.random.rand(4)
-00037b80: 2e72 6573 6861 7065 2832 2c20 3229 2c0a  .reshape(2, 2),.
-00037b90: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-00037ba0: 2020 2020 292c 0a20 2020 2020 2020 202e      ),.        .
-00037bb0: 2e2e 2020 2020 2020 2020 2022 7072 6563  ..         "prec
-00037bc0: 6970 6974 6174 696f 6e22 3a20 2828 226c  ipitation": (("l
-00037bd0: 6174 222c 2022 6c6f 6e22 292c 206e 702e  at", "lon"), np.
-00037be0: 7261 6e64 6f6d 2e72 616e 6428 3429 2e72  random.rand(4).r
-00037bf0: 6573 6861 7065 2832 2c20 3229 292c 0a20  eshape(2, 2)),. 
-00037c00: 2020 2020 2020 202e 2e2e 2020 2020 207d         ...     }
-00037c10: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-00037c20: 2020 636f 6f72 6473 3d7b 226c 6174 223a    coords={"lat":
-00037c30: 205b 3130 2c20 3230 5d2c 2022 6c6f 6e22   [10, 20], "lon"
-00037c40: 3a20 5b31 3530 2c20 3136 305d 7d2c 0a20  : [150, 160]},. 
-00037c50: 2020 2020 2020 202e 2e2e 2029 0a20 2020         ... ).   
-00037c60: 2020 2020 203e 3e3e 2078 0a20 2020 2020       >>> x.     
-00037c70: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
-00037c80: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
-00037c90: 6e73 696f 6e73 3a20 2020 2020 2020 2028  nsions:        (
-00037ca0: 6c61 743a 2032 2c20 6c6f 6e3a 2032 290a  lat: 2, lon: 2).
-00037cb0: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
-00037cc0: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
-00037cd0: 206c 6174 2020 2020 2020 2020 2020 2020   lat            
-00037ce0: 286c 6174 2920 696e 7436 3420 3130 2032  (lat) int64 10 2
-00037cf0: 300a 2020 2020 2020 2020 2020 2a20 6c6f  0.          * lo
-00037d00: 6e20 2020 2020 2020 2020 2020 2028 6c6f  n            (lo
-00037d10: 6e29 2069 6e74 3634 2031 3530 2031 3630  n) int64 150 160
-00037d20: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-00037d30: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-00037d40: 2020 2020 2074 656d 7065 7261 7475 7265       temperature
-00037d50: 5f63 2020 286c 6174 2c20 6c6f 6e29 2066  _c  (lat, lon) f
-00037d60: 6c6f 6174 3634 2031 302e 3938 2031 342e  loat64 10.98 14.
-00037d70: 3320 3132 2e30 3620 3130 2e39 0a20 2020  3 12.06 10.9.   
-00037d80: 2020 2020 2020 2020 2070 7265 6369 7069           precipi
-00037d90: 7461 7469 6f6e 2020 286c 6174 2c20 6c6f  tation  (lat, lo
-00037da0: 6e29 2066 6c6f 6174 3634 2030 2e34 3233  n) float64 0.423
-00037db0: 3720 302e 3634 3539 2030 2e34 3337 3620  7 0.6459 0.4376 
-00037dc0: 302e 3839 3138 0a0a 2020 2020 2020 2020  0.8918..        
-00037dd0: 5768 6572 6520 7468 6520 7661 6c75 6520  Where the value 
-00037de0: 6973 2061 2063 616c 6c61 626c 652c 2065  is a callable, e
-00037df0: 7661 6c75 6174 6564 206f 6e20 6461 7461  valuated on data
-00037e00: 7365 743a 0a0a 2020 2020 2020 2020 3e3e  set:..        >>
-00037e10: 3e20 782e 6173 7369 676e 2874 656d 7065  > x.assign(tempe
-00037e20: 7261 7475 7265 5f66 3d6c 616d 6264 6120  rature_f=lambda 
-00037e30: 783a 2078 2e74 656d 7065 7261 7475 7265  x: x.temperature
-00037e40: 5f63 202a 2039 202f 2035 202b 2033 3229  _c * 9 / 5 + 32)
-00037e50: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
-00037e60: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
-00037e70: 2020 4469 6d65 6e73 696f 6e73 3a20 2020    Dimensions:   
-00037e80: 2020 2020 2028 6c61 743a 2032 2c20 6c6f       (lat: 2, lo
-00037e90: 6e3a 2032 290a 2020 2020 2020 2020 436f  n: 2).        Co
-00037ea0: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
-00037eb0: 2020 2020 202a 206c 6174 2020 2020 2020       * lat      
-00037ec0: 2020 2020 2020 286c 6174 2920 696e 7436        (lat) int6
-00037ed0: 3420 3130 2032 300a 2020 2020 2020 2020  4 10 20.        
-00037ee0: 2020 2a20 6c6f 6e20 2020 2020 2020 2020    * lon         
-00037ef0: 2020 2028 6c6f 6e29 2069 6e74 3634 2031     (lon) int64 1
-00037f00: 3530 2031 3630 0a20 2020 2020 2020 2044  50 160.        D
-00037f10: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
-00037f20: 2020 2020 2020 2020 2020 2074 656d 7065             tempe
-00037f30: 7261 7475 7265 5f63 2020 286c 6174 2c20  rature_c  (lat, 
-00037f40: 6c6f 6e29 2066 6c6f 6174 3634 2031 302e  lon) float64 10.
-00037f50: 3938 2031 342e 3320 3132 2e30 3620 3130  98 14.3 12.06 10
-00037f60: 2e39 0a20 2020 2020 2020 2020 2020 2070  .9.            p
-00037f70: 7265 6369 7069 7461 7469 6f6e 2020 286c  recipitation  (l
-00037f80: 6174 2c20 6c6f 6e29 2066 6c6f 6174 3634  at, lon) float64
-00037f90: 2030 2e34 3233 3720 302e 3634 3539 2030   0.4237 0.6459 0
-00037fa0: 2e34 3337 3620 302e 3839 3138 0a20 2020  .4376 0.8918.   
-00037fb0: 2020 2020 2020 2020 2074 656d 7065 7261           tempera
-00037fc0: 7475 7265 5f66 2020 286c 6174 2c20 6c6f  ture_f  (lat, lo
-00037fd0: 6e29 2066 6c6f 6174 3634 2035 312e 3736  n) float64 51.76
-00037fe0: 2035 372e 3735 2035 332e 3720 3531 2e36   57.75 53.7 51.6
-00037ff0: 320a 0a20 2020 2020 2020 2041 6c74 6572  2..        Alter
-00038000: 6e61 7469 7665 6c79 2c20 7468 6520 7361  natively, the sa
-00038010: 6d65 2062 6568 6176 696f 7220 6361 6e20  me behavior can 
-00038020: 6265 2061 6368 6965 7665 6420 6279 2064  be achieved by d
-00038030: 6972 6563 746c 7920 7265 6665 7265 6e63  irectly referenc
-00038040: 696e 6720 616e 2065 7869 7374 696e 6720  ing an existing 
-00038050: 6461 7461 6172 7261 793a 0a0a 2020 2020  dataarray:..    
-00038060: 2020 2020 3e3e 3e20 782e 6173 7369 676e      >>> x.assign
-00038070: 2874 656d 7065 7261 7475 7265 5f66 3d78  (temperature_f=x
-00038080: 5b22 7465 6d70 6572 6174 7572 655f 6322  ["temperature_c"
-00038090: 5d20 2a20 3920 2f20 3520 2b20 3332 290a  ] * 9 / 5 + 32).
-000380a0: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-000380b0: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-000380c0: 2044 696d 656e 7369 6f6e 733a 2020 2020   Dimensions:    
-000380d0: 2020 2020 286c 6174 3a20 322c 206c 6f6e      (lat: 2, lon
-000380e0: 3a20 3229 0a20 2020 2020 2020 2043 6f6f  : 2).        Coo
-000380f0: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
-00038100: 2020 2020 2a20 6c61 7420 2020 2020 2020      * lat       
-00038110: 2020 2020 2028 6c61 7429 2069 6e74 3634       (lat) int64
-00038120: 2031 3020 3230 0a20 2020 2020 2020 2020   10 20.         
-00038130: 202a 206c 6f6e 2020 2020 2020 2020 2020   * lon          
-00038140: 2020 286c 6f6e 2920 696e 7436 3420 3135    (lon) int64 15
-00038150: 3020 3136 300a 2020 2020 2020 2020 4461  0 160.        Da
-00038160: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
-00038170: 2020 2020 2020 2020 2020 7465 6d70 6572            temper
-00038180: 6174 7572 655f 6320 2028 6c61 742c 206c  ature_c  (lat, l
-00038190: 6f6e 2920 666c 6f61 7436 3420 3130 2e39  on) float64 10.9
-000381a0: 3820 3134 2e33 2031 322e 3036 2031 302e  8 14.3 12.06 10.
-000381b0: 390a 2020 2020 2020 2020 2020 2020 7072  9.            pr
-000381c0: 6563 6970 6974 6174 696f 6e20 2028 6c61  ecipitation  (la
-000381d0: 742c 206c 6f6e 2920 666c 6f61 7436 3420  t, lon) float64 
-000381e0: 302e 3432 3337 2030 2e36 3435 3920 302e  0.4237 0.6459 0.
-000381f0: 3433 3736 2030 2e38 3931 380a 2020 2020  4376 0.8918.    
-00038200: 2020 2020 2020 2020 7465 6d70 6572 6174          temperat
-00038210: 7572 655f 6620 2028 6c61 742c 206c 6f6e  ure_f  (lat, lon
-00038220: 2920 666c 6f61 7436 3420 3531 2e37 3620  ) float64 51.76 
-00038230: 3537 2e37 3520 3533 2e37 2035 312e 3632  57.75 53.7 51.62
-00038240: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00038250: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
-00038260: 3d20 6569 7468 6572 5f64 6963 745f 6f72  = either_dict_or
-00038270: 5f6b 7761 7267 7328 7661 7269 6162 6c65  _kwargs(variable
-00038280: 732c 2076 6172 6961 626c 6573 5f6b 7761  s, variables_kwa
-00038290: 7267 732c 2022 6173 7369 676e 2229 0a20  rgs, "assign"). 
-000382a0: 2020 2020 2020 2064 6174 6120 3d20 7365         data = se
-000382b0: 6c66 2e63 6f70 7928 290a 2020 2020 2020  lf.copy().      
-000382c0: 2020 2320 646f 2061 6c6c 2063 616c 6375    # do all calcu
-000382d0: 6c61 7469 6f6e 7320 6669 7273 742e 2e2e  lations first...
-000382e0: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
-000382f0: 3a20 436f 6572 6369 626c 654d 6170 7069  : CoercibleMappi
-00038300: 6e67 203d 2064 6174 612e 5f63 616c 635f  ng = data._calc_
-00038310: 6173 7369 676e 5f72 6573 756c 7473 2876  assign_results(v
-00038320: 6172 6961 626c 6573 290a 2020 2020 2020  ariables).      
-00038330: 2020 6461 7461 2e63 6f6f 7264 732e 5f6d    data.coords._m
-00038340: 6179 6265 5f64 726f 705f 6d75 6c74 6969  aybe_drop_multii
-00038350: 6e64 6578 5f63 6f6f 7264 7328 7365 7428  ndex_coords(set(
-00038360: 7265 7375 6c74 732e 6b65 7973 2829 2929  results.keys()))
-00038370: 0a20 2020 2020 2020 2023 202e 2e2e 2061  .        # ... a
-00038380: 6e64 2074 6865 6e20 6173 7369 676e 0a20  nd then assign. 
-00038390: 2020 2020 2020 2064 6174 612e 7570 6461         data.upda
-000383a0: 7465 2872 6573 756c 7473 290a 2020 2020  te(results).    
-000383b0: 2020 2020 7265 7475 726e 2064 6174 610a      return data.
-000383c0: 0a20 2020 2064 6566 2074 6f5f 6172 7261  .    def to_arra
-000383d0: 7928 0a20 2020 2020 2020 2073 656c 662c  y(.        self,
-000383e0: 2064 696d 3a20 4861 7368 6162 6c65 203d   dim: Hashable =
-000383f0: 2022 7661 7269 6162 6c65 222c 206e 616d   "variable", nam
-00038400: 653a 2048 6173 6861 626c 6520 7c20 4e6f  e: Hashable | No
-00038410: 6e65 203d 204e 6f6e 650a 2020 2020 2920  ne = None.    ) 
-00038420: 2d3e 2044 6174 6141 7272 6179 3a0a 2020  -> DataArray:.  
-00038430: 2020 2020 2020 2222 2243 6f6e 7665 7274        """Convert
-00038440: 2074 6869 7320 6461 7461 7365 7420 696e   this dataset in
-00038450: 746f 2061 6e20 7861 7272 6179 2e44 6174  to an xarray.Dat
-00038460: 6141 7272 6179 0a0a 2020 2020 2020 2020  aArray..        
-00038470: 5468 6520 6461 7461 2076 6172 6961 626c  The data variabl
-00038480: 6573 206f 6620 7468 6973 2064 6174 6173  es of this datas
-00038490: 6574 2077 696c 6c20 6265 2062 726f 6164  et will be broad
-000384a0: 6361 7374 2061 6761 696e 7374 2065 6163  cast against eac
-000384b0: 6820 6f74 6865 720a 2020 2020 2020 2020  h other.        
-000384c0: 616e 6420 7374 6163 6b65 6420 616c 6f6e  and stacked alon
-000384d0: 6720 7468 6520 6669 7273 7420 6178 6973  g the first axis
-000384e0: 206f 6620 7468 6520 6e65 7720 6172 7261   of the new arra
-000384f0: 792e 2041 6c6c 2063 6f6f 7264 696e 6174  y. All coordinat
-00038500: 6573 206f 660a 2020 2020 2020 2020 7468  es of.        th
-00038510: 6973 2064 6174 6173 6574 2077 696c 6c20  is dataset will 
-00038520: 7265 6d61 696e 2063 6f6f 7264 696e 6174  remain coordinat
-00038530: 6573 2e0a 0a20 2020 2020 2020 2050 6172  es...        Par
-00038540: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00038550: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00038560: 2020 2064 696d 203a 2048 6173 6861 626c     dim : Hashabl
-00038570: 652c 2064 6566 6175 6c74 3a20 2276 6172  e, default: "var
-00038580: 6961 626c 6522 0a20 2020 2020 2020 2020  iable".         
-00038590: 2020 204e 616d 6520 6f66 2074 6865 206e     Name of the n
-000385a0: 6577 2064 696d 656e 7369 6f6e 2e0a 2020  ew dimension..  
-000385b0: 2020 2020 2020 6e61 6d65 203a 2048 6173        name : Has
-000385c0: 6861 626c 6520 6f72 204e 6f6e 652c 206f  hable or None, o
-000385d0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-000385e0: 2020 2020 4e61 6d65 206f 6620 7468 6520      Name of the 
-000385f0: 6e65 7720 6461 7461 2061 7272 6179 2e0a  new data array..
-00038600: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00038610: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00038620: 0a20 2020 2020 2020 2061 7272 6179 203a  .        array :
-00038630: 2078 6172 7261 792e 4461 7461 4172 7261   xarray.DataArra
-00038640: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
-00038650: 2020 2020 2020 6672 6f6d 2078 6172 7261        from xarra
-00038660: 792e 636f 7265 2e64 6174 6161 7272 6179  y.core.dataarray
-00038670: 2069 6d70 6f72 7420 4461 7461 4172 7261   import DataArra
-00038680: 790a 0a20 2020 2020 2020 2064 6174 615f  y..        data_
-00038690: 7661 7273 203d 205b 7365 6c66 2e76 6172  vars = [self.var
-000386a0: 6961 626c 6573 5b6b 5d20 666f 7220 6b20  iables[k] for k 
-000386b0: 696e 2073 656c 662e 6461 7461 5f76 6172  in self.data_var
-000386c0: 735d 0a20 2020 2020 2020 2062 726f 6164  s].        broad
-000386d0: 6361 7374 5f76 6172 7320 3d20 6272 6f61  cast_vars = broa
-000386e0: 6463 6173 745f 7661 7269 6162 6c65 7328  dcast_variables(
-000386f0: 2a64 6174 615f 7661 7273 290a 2020 2020  *data_vars).    
-00038700: 2020 2020 6461 7461 203d 2064 7563 6b5f      data = duck_
-00038710: 6172 7261 795f 6f70 732e 7374 6163 6b28  array_ops.stack(
-00038720: 5b62 2e64 6174 6120 666f 7220 6220 696e  [b.data for b in
-00038730: 2062 726f 6164 6361 7374 5f76 6172 735d   broadcast_vars]
-00038740: 2c20 6178 6973 3d30 290a 0a20 2020 2020  , axis=0)..     
-00038750: 2020 2064 696d 7320 3d20 2864 696d 2c29     dims = (dim,)
-00038760: 202b 2062 726f 6164 6361 7374 5f76 6172   + broadcast_var
-00038770: 735b 305d 2e64 696d 730a 2020 2020 2020  s[0].dims.      
-00038780: 2020 7661 7269 6162 6c65 203d 2056 6172    variable = Var
-00038790: 6961 626c 6528 6469 6d73 2c20 6461 7461  iable(dims, data
-000387a0: 2c20 7365 6c66 2e61 7474 7273 2c20 6661  , self.attrs, fa
-000387b0: 7374 7061 7468 3d54 7275 6529 0a0a 2020  stpath=True)..  
-000387c0: 2020 2020 2020 636f 6f72 6473 203d 207b        coords = {
-000387d0: 6b3a 2076 2e76 6172 6961 626c 6520 666f  k: v.variable fo
-000387e0: 7220 6b2c 2076 2069 6e20 7365 6c66 2e63  r k, v in self.c
-000387f0: 6f6f 7264 732e 6974 656d 7328 297d 0a20  oords.items()}. 
-00038800: 2020 2020 2020 2069 6e64 6578 6573 203d         indexes =
-00038810: 2066 696c 7465 725f 696e 6465 7865 735f   filter_indexes_
-00038820: 6672 6f6d 5f63 6f6f 7264 7328 7365 6c66  from_coords(self
-00038830: 2e5f 696e 6465 7865 732c 2073 6574 2863  ._indexes, set(c
-00038840: 6f6f 7264 7329 290a 2020 2020 2020 2020  oords)).        
-00038850: 6e65 775f 6469 6d5f 696e 6465 7820 3d20  new_dim_index = 
-00038860: 5061 6e64 6173 496e 6465 7828 6c69 7374  PandasIndex(list
-00038870: 2873 656c 662e 6461 7461 5f76 6172 7329  (self.data_vars)
-00038880: 2c20 6469 6d29 0a20 2020 2020 2020 2069  , dim).        i
-00038890: 6e64 6578 6573 5b64 696d 5d20 3d20 6e65  ndexes[dim] = ne
-000388a0: 775f 6469 6d5f 696e 6465 780a 2020 2020  w_dim_index.    
-000388b0: 2020 2020 636f 6f72 6473 2e75 7064 6174      coords.updat
-000388c0: 6528 6e65 775f 6469 6d5f 696e 6465 782e  e(new_dim_index.
-000388d0: 6372 6561 7465 5f76 6172 6961 626c 6573  create_variables
-000388e0: 2829 290a 0a20 2020 2020 2020 2072 6574  ())..        ret
-000388f0: 7572 6e20 4461 7461 4172 7261 792e 5f63  urn DataArray._c
-00038900: 6f6e 7374 7275 6374 5f64 6972 6563 7428  onstruct_direct(
-00038910: 7661 7269 6162 6c65 2c20 636f 6f72 6473  variable, coords
-00038920: 2c20 6e61 6d65 2c20 696e 6465 7865 7329  , name, indexes)
-00038930: 0a0a 2020 2020 6465 6620 5f6e 6f72 6d61  ..    def _norma
-00038940: 6c69 7a65 5f64 696d 5f6f 7264 6572 280a  lize_dim_order(.
-00038950: 2020 2020 2020 2020 7365 6c66 2c20 6469          self, di
-00038960: 6d5f 6f72 6465 723a 2053 6571 7565 6e63  m_order: Sequenc
-00038970: 655b 4861 7368 6162 6c65 5d20 7c20 4e6f  e[Hashable] | No
-00038980: 6e65 203d 204e 6f6e 650a 2020 2020 2920  ne = None.    ) 
-00038990: 2d3e 2064 6963 745b 4861 7368 6162 6c65  -> dict[Hashable
-000389a0: 2c20 696e 745d 3a0a 2020 2020 2020 2020  , int]:.        
-000389b0: 2222 220a 2020 2020 2020 2020 4368 6563  """.        Chec
-000389c0: 6b20 7468 6520 7661 6c69 6469 7479 206f  k the validity o
-000389d0: 6620 7468 6520 7072 6f76 6964 6564 2064  f the provided d
-000389e0: 696d 656e 7369 6f6e 7320 6966 2061 6e79  imensions if any
-000389f0: 2061 6e64 2072 6574 7572 6e20 7468 6520   and return the 
-00038a00: 6d61 7070 696e 670a 2020 2020 2020 2020  mapping.        
-00038a10: 6265 7477 6565 6e20 6469 6d65 6e73 696f  between dimensio
-00038a20: 6e20 6e61 6d65 2061 6e64 2074 6865 6972  n name and their
-00038a30: 2073 697a 652e 0a0a 2020 2020 2020 2020   size...        
-00038a40: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00038a50: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00038a60: 2020 2020 2020 6469 6d5f 6f72 6465 723a        dim_order:
-00038a70: 2053 6571 7565 6e63 6520 6f66 2048 6173   Sequence of Has
-00038a80: 6861 626c 6520 6f72 204e 6f6e 652c 206f  hable or None, o
-00038a90: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00038aa0: 2020 2020 4469 6d65 6e73 696f 6e20 6f72      Dimension or
-00038ab0: 6465 7220 746f 2076 616c 6964 6174 6520  der to validate 
-00038ac0: 2864 6566 6175 6c74 2074 6f20 7468 6520  (default to the 
-00038ad0: 616c 7068 6162 6574 6963 616c 206f 7264  alphabetical ord
-00038ae0: 6572 2069 6620 4e6f 6e65 292e 0a0a 2020  er if None)...  
-00038af0: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00038b00: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-00038b10: 2020 2020 2020 7265 7375 6c74 203a 2064        result : d
-00038b20: 6963 745b 4861 7368 6162 6c65 2c20 696e  ict[Hashable, in
-00038b30: 745d 0a20 2020 2020 2020 2020 2020 2056  t].            V
-00038b40: 616c 6964 6174 6564 2064 696d 656e 7369  alidated dimensi
-00038b50: 6f6e 7320 6d61 7070 696e 672e 0a0a 2020  ons mapping...  
-00038b60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00038b70: 2020 6966 2064 696d 5f6f 7264 6572 2069    if dim_order i
-00038b80: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00038b90: 2020 2020 6469 6d5f 6f72 6465 7220 3d20      dim_order = 
-00038ba0: 6c69 7374 2873 656c 662e 6469 6d73 290a  list(self.dims).
-00038bb0: 2020 2020 2020 2020 656c 6966 2073 6574          elif set
-00038bc0: 2864 696d 5f6f 7264 6572 2920 213d 2073  (dim_order) != s
-00038bd0: 6574 2873 656c 662e 6469 6d73 293a 0a20  et(self.dims):. 
-00038be0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00038bf0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00038c00: 2020 2020 2020 2020 2020 2020 2022 6469               "di
-00038c10: 6d5f 6f72 6465 7220 7b7d 2064 6f65 7320  m_order {} does 
-00038c20: 6e6f 7420 6d61 7463 6820 7468 6520 7365  not match the se
-00038c30: 7420 6f66 2064 696d 656e 7369 6f6e 7320  t of dimensions 
-00038c40: 6f66 2074 6869 7320 220a 2020 2020 2020  of this ".      
-00038c50: 2020 2020 2020 2020 2020 2244 6174 6173            "Datas
-00038c60: 6574 3a20 7b7d 222e 666f 726d 6174 2864  et: {}".format(d
-00038c70: 696d 5f6f 7264 6572 2c20 6c69 7374 2873  im_order, list(s
-00038c80: 656c 662e 6469 6d73 2929 0a20 2020 2020  elf.dims)).     
-00038c90: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00038ca0: 2020 6f72 6465 7265 645f 6469 6d73 203d    ordered_dims =
-00038cb0: 207b 6b3a 2073 656c 662e 6469 6d73 5b6b   {k: self.dims[k
-00038cc0: 5d20 666f 7220 6b20 696e 2064 696d 5f6f  ] for k in dim_o
-00038cd0: 7264 6572 7d0a 0a20 2020 2020 2020 2072  rder}..        r
-00038ce0: 6574 7572 6e20 6f72 6465 7265 645f 6469  eturn ordered_di
-00038cf0: 6d73 0a0a 2020 2020 6465 6620 746f 5f70  ms..    def to_p
-00038d00: 616e 6461 7328 7365 6c66 2920 2d3e 2070  andas(self) -> p
-00038d10: 642e 5365 7269 6573 207c 2070 642e 4461  d.Series | pd.Da
-00038d20: 7461 4672 616d 653a 0a20 2020 2020 2020  taFrame:.       
-00038d30: 2022 2222 436f 6e76 6572 7420 7468 6973   """Convert this
-00038d40: 2064 6174 6173 6574 2069 6e74 6f20 6120   dataset into a 
-00038d50: 7061 6e64 6173 206f 626a 6563 7420 7769  pandas object wi
-00038d60: 7468 6f75 7420 6368 616e 6769 6e67 2074  thout changing t
-00038d70: 6865 206e 756d 6265 7220 6f66 2064 696d  he number of dim
-00038d80: 656e 7369 6f6e 732e 0a0a 2020 2020 2020  ensions...      
-00038d90: 2020 5468 6520 7479 7065 206f 6620 7468    The type of th
-00038da0: 6520 7265 7475 726e 6564 206f 626a 6563  e returned objec
-00038db0: 7420 6465 7065 6e64 7320 6f6e 2074 6865  t depends on the
-00038dc0: 206e 756d 6265 7220 6f66 2044 6174 6173   number of Datas
-00038dd0: 6574 0a20 2020 2020 2020 2064 696d 656e  et.        dimen
-00038de0: 7369 6f6e 733a 0a0a 2020 2020 2020 2020  sions:..        
-00038df0: 2a20 3044 202d 3e20 6070 616e 6461 732e  * 0D -> `pandas.
-00038e00: 5365 7269 6573 600a 2020 2020 2020 2020  Series`.        
-00038e10: 2a20 3144 202d 3e20 6070 616e 6461 732e  * 1D -> `pandas.
-00038e20: 4461 7461 4672 616d 6560 0a0a 2020 2020  DataFrame`..    
-00038e30: 2020 2020 4f6e 6c79 2077 6f72 6b73 2066      Only works f
-00038e40: 6f72 2044 6174 6173 6574 7320 7769 7468  or Datasets with
-00038e50: 2031 206f 7220 6665 7765 7220 6469 6d65   1 or fewer dime
-00038e60: 6e73 696f 6e73 2e0a 2020 2020 2020 2020  nsions..        
-00038e70: 2222 220a 2020 2020 2020 2020 6966 206c  """.        if l
-00038e80: 656e 2873 656c 662e 6469 6d73 2920 3d3d  en(self.dims) ==
-00038e90: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00038ea0: 7265 7475 726e 2070 642e 5365 7269 6573  return pd.Series
-00038eb0: 287b 6b3a 2076 2e69 7465 6d28 2920 666f  ({k: v.item() fo
-00038ec0: 7220 6b2c 2076 2069 6e20 7365 6c66 2e69  r k, v in self.i
-00038ed0: 7465 6d73 2829 7d29 0a20 2020 2020 2020  tems()}).       
-00038ee0: 2069 6620 6c65 6e28 7365 6c66 2e64 696d   if len(self.dim
-00038ef0: 7329 203d 3d20 313a 0a20 2020 2020 2020  s) == 1:.       
-00038f00: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00038f10: 2e74 6f5f 6461 7461 6672 616d 6528 290a  .to_dataframe().
-00038f20: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00038f30: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00038f40: 2020 2020 2020 2263 616e 6e6f 7420 636f        "cannot co
-00038f50: 6e76 6572 7420 4461 7461 7365 7473 2077  nvert Datasets w
-00038f60: 6974 6820 2573 2064 696d 656e 7369 6f6e  ith %s dimension
-00038f70: 7320 696e 746f 2022 0a20 2020 2020 2020  s into ".       
-00038f80: 2020 2020 2022 7061 6e64 6173 206f 626a       "pandas obj
-00038f90: 6563 7473 2077 6974 686f 7574 2063 6861  ects without cha
-00038fa0: 6e67 696e 6720 7468 6520 6e75 6d62 6572  nging the number
-00038fb0: 206f 6620 6469 6d65 6e73 696f 6e73 2e20   of dimensions. 
-00038fc0: 220a 2020 2020 2020 2020 2020 2020 2250  ".            "P
-00038fd0: 6c65 6173 6520 7573 6520 4461 7461 7365  lease use Datase
-00038fe0: 742e 746f 5f64 6174 6166 7261 6d65 2829  t.to_dataframe()
-00038ff0: 2069 6e73 7465 6164 2e22 2025 206c 656e   instead." % len
-00039000: 2873 656c 662e 6469 6d73 290a 2020 2020  (self.dims).    
-00039010: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
-00039020: 746f 5f64 6174 6166 7261 6d65 2873 656c  to_dataframe(sel
-00039030: 662c 206f 7264 6572 6564 5f64 696d 733a  f, ordered_dims:
-00039040: 204d 6170 7069 6e67 5b41 6e79 2c20 696e   Mapping[Any, in
-00039050: 745d 293a 0a20 2020 2020 2020 2063 6f6c  t]):.        col
-00039060: 756d 6e73 203d 205b 6b20 666f 7220 6b20  umns = [k for k 
-00039070: 696e 2073 656c 662e 7661 7269 6162 6c65  in self.variable
-00039080: 7320 6966 206b 206e 6f74 2069 6e20 7365  s if k not in se
-00039090: 6c66 2e64 696d 735d 0a20 2020 2020 2020  lf.dims].       
-000390a0: 2064 6174 6120 3d20 5b0a 2020 2020 2020   data = [.      
-000390b0: 2020 2020 2020 7365 6c66 2e5f 7661 7269        self._vari
-000390c0: 6162 6c65 735b 6b5d 2e73 6574 5f64 696d  ables[k].set_dim
-000390d0: 7328 6f72 6465 7265 645f 6469 6d73 292e  s(ordered_dims).
-000390e0: 7661 6c75 6573 2e72 6573 6861 7065 282d  values.reshape(-
-000390f0: 3129 0a20 2020 2020 2020 2020 2020 2066  1).            f
-00039100: 6f72 206b 2069 6e20 636f 6c75 6d6e 730a  or k in columns.
-00039110: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-00039120: 2020 696e 6465 7820 3d20 7365 6c66 2e63    index = self.c
-00039130: 6f6f 7264 732e 746f 5f69 6e64 6578 285b  oords.to_index([
-00039140: 2a6f 7264 6572 6564 5f64 696d 735d 290a  *ordered_dims]).
-00039150: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-00039160: 642e 4461 7461 4672 616d 6528 6469 6374  d.DataFrame(dict
-00039170: 287a 6970 2863 6f6c 756d 6e73 2c20 6461  (zip(columns, da
-00039180: 7461 2929 2c20 696e 6465 783d 696e 6465  ta)), index=inde
-00039190: 7829 0a0a 2020 2020 6465 6620 746f 5f64  x)..    def to_d
-000391a0: 6174 6166 7261 6d65 2873 656c 662c 2064  ataframe(self, d
-000391b0: 696d 5f6f 7264 6572 3a20 5365 7175 656e  im_order: Sequen
-000391c0: 6365 5b48 6173 6861 626c 655d 207c 204e  ce[Hashable] | N
-000391d0: 6f6e 6520 3d20 4e6f 6e65 2920 2d3e 2070  one = None) -> p
-000391e0: 642e 4461 7461 4672 616d 653a 0a20 2020  d.DataFrame:.   
-000391f0: 2020 2020 2022 2222 436f 6e76 6572 7420       """Convert 
-00039200: 7468 6973 2064 6174 6173 6574 2069 6e74  this dataset int
-00039210: 6f20 6120 7061 6e64 6173 2e44 6174 6146  o a pandas.DataF
-00039220: 7261 6d65 2e0a 0a20 2020 2020 2020 204e  rame...        N
-00039230: 6f6e 2d69 6e64 6578 2076 6172 6961 626c  on-index variabl
-00039240: 6573 2069 6e20 7468 6973 2064 6174 6173  es in this datas
-00039250: 6574 2066 6f72 6d20 7468 6520 636f 6c75  et form the colu
-00039260: 6d6e 7320 6f66 2074 6865 0a20 2020 2020  mns of the.     
-00039270: 2020 2044 6174 6146 7261 6d65 2e20 5468     DataFrame. Th
-00039280: 6520 4461 7461 4672 616d 6520 6973 2069  e DataFrame is i
-00039290: 6e64 6578 6564 2062 7920 7468 6520 4361  ndexed by the Ca
-000392a0: 7274 6573 6961 6e20 7072 6f64 7563 7420  rtesian product 
-000392b0: 6f66 0a20 2020 2020 2020 2074 6869 7320  of.        this 
-000392c0: 6461 7461 7365 7427 7320 696e 6469 6365  dataset's indice
-000392d0: 732e 0a0a 2020 2020 2020 2020 5061 7261  s...        Para
-000392e0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-000392f0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00039300: 2020 6469 6d5f 6f72 6465 723a 2053 6571    dim_order: Seq
-00039310: 7565 6e63 6520 6f66 2048 6173 6861 626c  uence of Hashabl
-00039320: 6520 6f72 204e 6f6e 652c 206f 7074 696f  e or None, optio
-00039330: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00039340: 4869 6572 6172 6368 6963 616c 2064 696d  Hierarchical dim
-00039350: 656e 7369 6f6e 206f 7264 6572 2066 6f72  ension order for
-00039360: 2074 6865 2072 6573 756c 7469 6e67 2064   the resulting d
-00039370: 6174 6166 7261 6d65 2e20 416c 6c0a 2020  ataframe. All.  
-00039380: 2020 2020 2020 2020 2020 6172 7261 7973            arrays
-00039390: 2061 7265 2074 7261 6e73 706f 7365 6420   are transposed 
-000393a0: 746f 2074 6869 7320 6f72 6465 7220 616e  to this order an
-000393b0: 6420 7468 656e 2077 7269 7474 656e 206f  d then written o
-000393c0: 7574 2061 7320 666c 6174 0a20 2020 2020  ut as flat.     
-000393d0: 2020 2020 2020 2076 6563 746f 7273 2069         vectors i
-000393e0: 6e20 636f 6e74 6967 756f 7573 206f 7264  n contiguous ord
-000393f0: 6572 2c20 736f 2074 6865 206c 6173 7420  er, so the last 
-00039400: 6469 6d65 6e73 696f 6e20 696e 2074 6869  dimension in thi
-00039410: 7320 6c69 7374 0a20 2020 2020 2020 2020  s list.         
-00039420: 2020 2077 696c 6c20 6265 2063 6f6e 7469     will be conti
-00039430: 6775 6f75 7320 696e 2074 6865 2072 6573  guous in the res
-00039440: 756c 7469 6e67 2044 6174 6146 7261 6d65  ulting DataFrame
-00039450: 2e20 5468 6973 2068 6173 2061 206d 616a  . This has a maj
-00039460: 6f72 0a20 2020 2020 2020 2020 2020 2069  or.            i
-00039470: 6e66 6c75 656e 6365 206f 6e20 7768 6963  nfluence on whic
-00039480: 6820 6f70 6572 6174 696f 6e73 2061 7265  h operations are
-00039490: 2065 6666 6963 6965 6e74 206f 6e20 7468   efficient on th
-000394a0: 6520 7265 7375 6c74 696e 670a 2020 2020  e resulting.    
-000394b0: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
-000394c0: 652e 0a0a 2020 2020 2020 2020 2020 2020  e...            
-000394d0: 4966 2070 726f 7669 6465 642c 206d 7573  If provided, mus
-000394e0: 7420 696e 636c 7564 6520 616c 6c20 6469  t include all di
-000394f0: 6d65 6e73 696f 6e73 206f 6620 7468 6973  mensions of this
-00039500: 2064 6174 6173 6574 2e20 4279 0a20 2020   dataset. By.   
-00039510: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00039520: 2c20 6469 6d65 6e73 696f 6e73 2061 7265  , dimensions are
-00039530: 2073 6f72 7465 6420 616c 7068 6162 6574   sorted alphabet
-00039540: 6963 616c 6c79 2e0a 0a20 2020 2020 2020  ically...       
-00039550: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-00039560: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-00039570: 2072 6573 756c 7420 3a20 4461 7461 4672   result : DataFr
-00039580: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-00039590: 4461 7461 7365 7420 6173 2061 2070 616e  Dataset as a pan
-000395a0: 6461 7320 4461 7461 4672 616d 652e 0a0a  das DataFrame...
-000395b0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-000395c0: 2020 2020 206f 7264 6572 6564 5f64 696d       ordered_dim
-000395d0: 7320 3d20 7365 6c66 2e5f 6e6f 726d 616c  s = self._normal
-000395e0: 697a 655f 6469 6d5f 6f72 6465 7228 6469  ize_dim_order(di
-000395f0: 6d5f 6f72 6465 723d 6469 6d5f 6f72 6465  m_order=dim_orde
-00039600: 7229 0a0a 2020 2020 2020 2020 7265 7475  r)..        retu
-00039610: 726e 2073 656c 662e 5f74 6f5f 6461 7461  rn self._to_data
-00039620: 6672 616d 6528 6f72 6465 7265 645f 6469  frame(ordered_di
-00039630: 6d73 3d6f 7264 6572 6564 5f64 696d 7329  ms=ordered_dims)
-00039640: 0a0a 2020 2020 6465 6620 5f73 6574 5f73  ..    def _set_s
-00039650: 7061 7273 655f 6461 7461 5f66 726f 6d5f  parse_data_from_
-00039660: 6461 7461 6672 616d 6528 0a20 2020 2020  dataframe(.     
-00039670: 2020 2073 656c 662c 2069 6478 3a20 7064     self, idx: pd
-00039680: 2e49 6e64 6578 2c20 6172 7261 7973 3a20  .Index, arrays: 
-00039690: 6c69 7374 5b74 7570 6c65 5b48 6173 6861  list[tuple[Hasha
-000396a0: 626c 652c 206e 702e 6e64 6172 7261 795d  ble, np.ndarray]
-000396b0: 5d2c 2064 696d 733a 2074 7570 6c65 0a20  ], dims: tuple. 
-000396c0: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-000396d0: 2020 2020 2020 6672 6f6d 2073 7061 7273        from spars
-000396e0: 6520 696d 706f 7274 2043 4f4f 0a0a 2020  e import COO..  
-000396f0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00039700: 6e63 6528 6964 782c 2070 642e 4d75 6c74  nce(idx, pd.Mult
-00039710: 6949 6e64 6578 293a 0a20 2020 2020 2020  iIndex):.       
-00039720: 2020 2020 2063 6f6f 7264 7320 3d20 6e70       coords = np
-00039730: 2e73 7461 636b 285b 6e70 2e61 7361 7272  .stack([np.asarr
-00039740: 6179 2863 6f64 6529 2066 6f72 2063 6f64  ay(code) for cod
-00039750: 6520 696e 2069 6478 2e63 6f64 6573 5d2c  e in idx.codes],
-00039760: 2061 7869 733d 3029 0a20 2020 2020 2020   axis=0).       
-00039770: 2020 2020 2069 735f 736f 7274 6564 203d       is_sorted =
-00039780: 2069 6478 2e69 735f 6d6f 6e6f 746f 6e69   idx.is_monotoni
-00039790: 635f 696e 6372 6561 7369 6e67 0a20 2020  c_increasing.   
-000397a0: 2020 2020 2020 2020 2073 6861 7065 203d           shape =
-000397b0: 2074 7570 6c65 286c 6576 2e73 697a 6520   tuple(lev.size 
-000397c0: 666f 7220 6c65 7620 696e 2069 6478 2e6c  for lev in idx.l
-000397d0: 6576 656c 7329 0a20 2020 2020 2020 2065  evels).        e
-000397e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000397f0: 2063 6f6f 7264 7320 3d20 6e70 2e61 7261   coords = np.ara
-00039800: 6e67 6528 6964 782e 7369 7a65 292e 7265  nge(idx.size).re
-00039810: 7368 6170 6528 312c 202d 3129 0a20 2020  shape(1, -1).   
-00039820: 2020 2020 2020 2020 2069 735f 736f 7274           is_sort
-00039830: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
-00039840: 2020 2020 2020 7368 6170 6520 3d20 2869        shape = (i
-00039850: 6478 2e73 697a 652c 290a 0a20 2020 2020  dx.size,)..     
-00039860: 2020 2066 6f72 206e 616d 652c 2076 616c     for name, val
-00039870: 7565 7320 696e 2061 7272 6179 733a 0a20  ues in arrays:. 
-00039880: 2020 2020 2020 2020 2020 2023 2049 6e20             # In 
-00039890: 7669 7274 7561 6c6c 7920 616c 6c20 7265  virtually all re
-000398a0: 616c 2075 7365 2063 6173 6573 2c20 7468  al use cases, th
-000398b0: 6520 7370 6172 7365 2061 7272 6179 2077  e sparse array w
-000398c0: 696c 6c20 6e6f 7720 6861 7665 0a20 2020  ill now have.   
-000398d0: 2020 2020 2020 2020 2023 206d 6973 7369           # missi
-000398e0: 6e67 2076 616c 7565 7320 616e 6420 6e65  ng values and ne
-000398f0: 6564 7320 6120 6669 6c6c 5f76 616c 7565  eds a fill_value
-00039900: 2e20 466f 7220 636f 6e73 6973 7465 6e63  . For consistenc
-00039910: 792c 2064 6f6e 2774 0a20 2020 2020 2020  y, don't.       
-00039920: 2020 2020 2023 2073 7065 6369 616c 2063       # special c
-00039930: 6173 6520 7468 6520 7261 7265 2065 7863  ase the rare exc
-00039940: 6570 7469 6f6e 7320 2865 2e67 2e2c 2064  eptions (e.g., d
-00039950: 7479 7065 3d69 6e74 2077 6974 686f 7574  type=int without
-00039960: 2061 0a20 2020 2020 2020 2020 2020 2023   a.            #
-00039970: 204d 756c 7469 496e 6465 7829 2e0a 2020   MultiIndex)..  
-00039980: 2020 2020 2020 2020 2020 6474 7970 652c            dtype,
-00039990: 2066 696c 6c5f 7661 6c75 6520 3d20 7872   fill_value = xr
-000399a0: 6474 7970 6573 2e6d 6179 6265 5f70 726f  dtypes.maybe_pro
-000399b0: 6d6f 7465 2876 616c 7565 732e 6474 7970  mote(values.dtyp
-000399c0: 6529 0a20 2020 2020 2020 2020 2020 2076  e).            v
-000399d0: 616c 7565 7320 3d20 6e70 2e61 7361 7272  alues = np.asarr
-000399e0: 6179 2876 616c 7565 732c 2064 7479 7065  ay(values, dtype
-000399f0: 3d64 7479 7065 290a 0a20 2020 2020 2020  =dtype)..       
-00039a00: 2020 2020 2064 6174 6120 3d20 434f 4f28       data = COO(
-00039a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039a20: 2063 6f6f 7264 732c 0a20 2020 2020 2020   coords,.       
-00039a30: 2020 2020 2020 2020 2076 616c 7565 732c           values,
-00039a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039a50: 2073 6861 7065 2c0a 2020 2020 2020 2020   shape,.        
-00039a60: 2020 2020 2020 2020 6861 735f 6475 706c          has_dupl
-00039a70: 6963 6174 6573 3d46 616c 7365 2c0a 2020  icates=False,.  
-00039a80: 2020 2020 2020 2020 2020 2020 2020 736f                so
-00039a90: 7274 6564 3d69 735f 736f 7274 6564 2c0a  rted=is_sorted,.
-00039aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039ab0: 6669 6c6c 5f76 616c 7565 3d66 696c 6c5f  fill_value=fill_
-00039ac0: 7661 6c75 652c 0a20 2020 2020 2020 2020  value,.         
-00039ad0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00039ae0: 2073 656c 665b 6e61 6d65 5d20 3d20 2864   self[name] = (d
-00039af0: 696d 732c 2064 6174 6129 0a0a 2020 2020  ims, data)..    
-00039b00: 6465 6620 5f73 6574 5f6e 756d 7079 5f64  def _set_numpy_d
-00039b10: 6174 615f 6672 6f6d 5f64 6174 6166 7261  ata_from_datafra
-00039b20: 6d65 280a 2020 2020 2020 2020 7365 6c66  me(.        self
-00039b30: 2c20 6964 783a 2070 642e 496e 6465 782c  , idx: pd.Index,
-00039b40: 2061 7272 6179 733a 206c 6973 745b 7475   arrays: list[tu
-00039b50: 706c 655b 4861 7368 6162 6c65 2c20 6e70  ple[Hashable, np
-00039b60: 2e6e 6461 7272 6179 5d5d 2c20 6469 6d73  .ndarray]], dims
-00039b70: 3a20 7475 706c 650a 2020 2020 2920 2d3e  : tuple.    ) ->
-00039b80: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
-00039b90: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-00039ba0: 2869 6478 2c20 7064 2e4d 756c 7469 496e  (idx, pd.MultiIn
-00039bb0: 6465 7829 3a0a 2020 2020 2020 2020 2020  dex):.          
-00039bc0: 2020 666f 7220 6e61 6d65 2c20 7661 6c75    for name, valu
-00039bd0: 6573 2069 6e20 6172 7261 7973 3a0a 2020  es in arrays:.  
-00039be0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00039bf0: 6c66 5b6e 616d 655d 203d 2028 6469 6d73  lf[name] = (dims
-00039c00: 2c20 7661 6c75 6573 290a 2020 2020 2020  , values).      
-00039c10: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-00039c20: 2020 2020 2020 2320 4e42 3a20 7369 6d69        # NB: simi
-00039c30: 6c61 722c 206d 6f72 6520 6765 6e65 7261  lar, more genera
-00039c40: 6c20 6c6f 6769 632c 206e 6f77 2065 7869  l logic, now exi
-00039c50: 7374 7320 696e 0a20 2020 2020 2020 2023  sts in.        #
-00039c60: 2076 6172 6961 626c 652e 756e 7374 6163   variable.unstac
-00039c70: 6b5f 6f6e 6365 3b20 7765 2063 6f75 6c64  k_once; we could
-00039c80: 2063 6f6e 7369 6465 7220 636f 6d62 696e   consider combin
-00039c90: 696e 6720 7468 656d 2061 7420 736f 6d65  ing them at some
-00039ca0: 0a20 2020 2020 2020 2023 2070 6f69 6e74  .        # point
-00039cb0: 2e0a 0a20 2020 2020 2020 2073 6861 7065  ...        shape
-00039cc0: 203d 2074 7570 6c65 286c 6576 2e73 697a   = tuple(lev.siz
-00039cd0: 6520 666f 7220 6c65 7620 696e 2069 6478  e for lev in idx
-00039ce0: 2e6c 6576 656c 7329 0a20 2020 2020 2020  .levels).       
-00039cf0: 2069 6e64 6578 6572 203d 2074 7570 6c65   indexer = tuple
-00039d00: 2869 6478 2e63 6f64 6573 290a 0a20 2020  (idx.codes)..   
-00039d10: 2020 2020 2023 2057 6520 616c 7265 6164       # We alread
-00039d20: 7920 7665 7269 6669 6564 2074 6861 7420  y verified that 
-00039d30: 7468 6520 4d75 6c74 6949 6e64 6578 2068  the MultiIndex h
-00039d40: 6173 2061 6c6c 2075 6e69 7175 6520 7661  as all unique va
-00039d50: 6c75 6573 2c20 736f 0a20 2020 2020 2020  lues, so.       
-00039d60: 2023 2074 6865 7265 2061 7265 206d 6973   # there are mis
-00039d70: 7369 6e67 2076 616c 7565 7320 6966 2061  sing values if a
-00039d80: 6e64 206f 6e6c 7920 6966 2074 6865 2073  nd only if the s
-00039d90: 697a 6520 6f66 206f 7574 7075 7420 6172  ize of output ar
-00039da0: 7261 7973 2069 730a 2020 2020 2020 2020  rays is.        
-00039db0: 2320 6c61 7267 6572 2074 6861 7420 7468  # larger that th
-00039dc0: 6520 696e 6465 782e 0a20 2020 2020 2020  e index..       
-00039dd0: 206d 6973 7369 6e67 5f76 616c 7565 7320   missing_values 
-00039de0: 3d20 6d61 7468 2e70 726f 6428 7368 6170  = math.prod(shap
-00039df0: 6529 203e 2069 6478 2e73 6861 7065 5b30  e) > idx.shape[0
-00039e00: 5d0a 0a20 2020 2020 2020 2066 6f72 206e  ]..        for n
-00039e10: 616d 652c 2076 616c 7565 7320 696e 2061  ame, values in a
-00039e20: 7272 6179 733a 0a20 2020 2020 2020 2020  rrays:.         
-00039e30: 2020 2023 204e 756d 5079 2069 6e64 6578     # NumPy index
-00039e40: 696e 6720 6973 206d 7563 6820 6661 7374  ing is much fast
-00039e50: 6572 2074 6861 6e20 7573 696e 6720 4461  er than using Da
-00039e60: 7461 4672 616d 652e 7265 696e 6465 7828  taFrame.reindex(
-00039e70: 2920 746f 0a20 2020 2020 2020 2020 2020  ) to.           
-00039e80: 2023 2066 696c 6c20 696e 206d 6973 7369   # fill in missi
-00039e90: 6e67 2076 616c 7565 733a 0a20 2020 2020  ng values:.     
-00039ea0: 2020 2020 2020 2023 2068 7474 7073 3a2f         # https:/
-00039eb0: 2f73 7461 636b 6f76 6572 666c 6f77 2e63  /stackoverflow.c
-00039ec0: 6f6d 2f61 2f33 3530 3439 3839 392f 3830  om/a/35049899/80
-00039ed0: 3937 3035 0a20 2020 2020 2020 2020 2020  9705.           
-00039ee0: 2069 6620 6d69 7373 696e 675f 7661 6c75   if missing_valu
-00039ef0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00039f00: 2020 2020 6474 7970 652c 2066 696c 6c5f      dtype, fill_
-00039f10: 7661 6c75 6520 3d20 7872 6474 7970 6573  value = xrdtypes
-00039f20: 2e6d 6179 6265 5f70 726f 6d6f 7465 2876  .maybe_promote(v
-00039f30: 616c 7565 732e 6474 7970 6529 0a20 2020  alues.dtype).   
-00039f40: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00039f50: 6120 3d20 6e70 2e66 756c 6c28 7368 6170  a = np.full(shap
-00039f60: 652c 2066 696c 6c5f 7661 6c75 652c 2064  e, fill_value, d
-00039f70: 7479 7065 290a 2020 2020 2020 2020 2020  type).          
-00039f80: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00039f90: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
-00039fa0: 7265 2061 7265 206e 6f20 6d69 7373 696e  re are no missin
-00039fb0: 6720 7661 6c75 6573 2c20 6b65 6570 2074  g values, keep t
-00039fc0: 6865 2065 7869 7374 696e 6720 6474 7970  he existing dtyp
-00039fd0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00039fe0: 2020 2320 696e 7374 6561 6420 6f66 2070    # instead of p
-00039ff0: 726f 6d6f 7469 6e67 2074 6f20 7375 7070  romoting to supp
-0003a000: 6f72 7420 4e41 2c20 652e 672e 2c20 6b65  ort NA, e.g., ke
-0003a010: 6570 2069 6e74 6567 6572 0a20 2020 2020  ep integer.     
-0003a020: 2020 2020 2020 2020 2020 2023 2063 6f6c             # col
-0003a030: 756d 6e73 2061 7320 696e 7465 6765 7273  umns as integers
-0003a040: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003a050: 2020 2320 544f 444f 3a20 636f 6e73 6964    # TODO: consid
-0003a060: 6572 2072 656d 6f76 696e 6720 7468 6973  er removing this
-0003a070: 2073 7065 6369 616c 2063 6173 652c 2077   special case, w
-0003a080: 6869 6368 2064 6f65 736e 2774 0a20 2020  hich doesn't.   
-0003a090: 2020 2020 2020 2020 2020 2020 2023 2065               # e
-0003a0a0: 7869 7374 2066 6f72 2073 7061 7273 653d  xist for sparse=
-0003a0b0: 5472 7565 2e0a 2020 2020 2020 2020 2020  True..          
-0003a0c0: 2020 2020 2020 6461 7461 203d 206e 702e        data = np.
-0003a0d0: 7a65 726f 7328 7368 6170 652c 2076 616c  zeros(shape, val
-0003a0e0: 7565 732e 6474 7970 6529 0a20 2020 2020  ues.dtype).     
-0003a0f0: 2020 2020 2020 2064 6174 615b 696e 6465         data[inde
-0003a100: 7865 725d 203d 2076 616c 7565 730a 2020  xer] = values.  
-0003a110: 2020 2020 2020 2020 2020 7365 6c66 5b6e            self[n
-0003a120: 616d 655d 203d 2028 6469 6d73 2c20 6461  ame] = (dims, da
-0003a130: 7461 290a 0a20 2020 2040 636c 6173 736d  ta)..    @classm
-0003a140: 6574 686f 640a 2020 2020 6465 6620 6672  ethod.    def fr
-0003a150: 6f6d 5f64 6174 6166 7261 6d65 280a 2020  om_dataframe(.  
-0003a160: 2020 2020 2020 636c 733a 2074 7970 655b        cls: type[
-0003a170: 545f 4461 7461 7365 745d 2c20 6461 7461  T_Dataset], data
-0003a180: 6672 616d 653a 2070 642e 4461 7461 4672  frame: pd.DataFr
-0003a190: 616d 652c 2073 7061 7273 653a 2062 6f6f  ame, sparse: boo
-0003a1a0: 6c20 3d20 4661 6c73 650a 2020 2020 2920  l = False.    ) 
-0003a1b0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
-0003a1c0: 2020 2020 2020 2222 2243 6f6e 7665 7274        """Convert
-0003a1d0: 2061 2070 616e 6461 732e 4461 7461 4672   a pandas.DataFr
-0003a1e0: 616d 6520 696e 746f 2061 6e20 7861 7272  ame into an xarr
-0003a1f0: 6179 2e44 6174 6173 6574 0a0a 2020 2020  ay.Dataset..    
-0003a200: 2020 2020 4561 6368 2063 6f6c 756d 6e20      Each column 
-0003a210: 7769 6c6c 2062 6520 636f 6e76 6572 7465  will be converte
-0003a220: 6420 696e 746f 2061 6e20 696e 6465 7065  d into an indepe
-0003a230: 6e64 656e 7420 7661 7269 6162 6c65 2069  ndent variable i
-0003a240: 6e20 7468 650a 2020 2020 2020 2020 4461  n the.        Da
-0003a250: 7461 7365 742e 2049 6620 7468 6520 6461  taset. If the da
-0003a260: 7461 6672 616d 6527 7320 696e 6465 7820  taframe's index 
-0003a270: 6973 2061 204d 756c 7469 496e 6465 782c  is a MultiIndex,
-0003a280: 2069 7420 7769 6c6c 2062 6520 6578 7061   it will be expa
-0003a290: 6e64 6564 0a20 2020 2020 2020 2069 6e74  nded.        int
-0003a2a0: 6f20 6120 7465 6e73 6f72 2070 726f 6475  o a tensor produ
-0003a2b0: 6374 206f 6620 6f6e 652d 6469 6d65 6e73  ct of one-dimens
-0003a2c0: 696f 6e61 6c20 696e 6469 6365 7320 2866  ional indices (f
-0003a2d0: 696c 6c69 6e67 2069 6e20 6d69 7373 696e  illing in missin
-0003a2e0: 670a 2020 2020 2020 2020 7661 6c75 6573  g.        values
-0003a2f0: 2077 6974 6820 4e61 4e29 2e20 5468 6973   with NaN). This
-0003a300: 206d 6574 686f 6420 7769 6c6c 2070 726f   method will pro
-0003a310: 6475 6365 2061 2044 6174 6173 6574 2076  duce a Dataset v
-0003a320: 6572 7920 7369 6d69 6c61 7220 746f 0a20  ery similar to. 
-0003a330: 2020 2020 2020 2074 6861 7420 6f6e 2077         that on w
-0003a340: 6869 6368 2074 6865 2027 746f 5f64 6174  hich the 'to_dat
-0003a350: 6166 7261 6d65 2720 6d65 7468 6f64 2077  aframe' method w
-0003a360: 6173 2063 616c 6c65 642c 2065 7863 6570  as called, excep
-0003a370: 7420 7769 7468 0a20 2020 2020 2020 2070  t with.        p
-0003a380: 6f73 7369 626c 7920 7265 6475 6e64 616e  ossibly redundan
-0003a390: 7420 6469 6d65 6e73 696f 6e73 2028 7369  t dimensions (si
-0003a3a0: 6e63 6520 616c 6c20 6461 7461 7365 7420  nce all dataset 
-0003a3b0: 7661 7269 6162 6c65 7320 7769 6c6c 2068  variables will h
-0003a3c0: 6176 650a 2020 2020 2020 2020 7468 6520  ave.        the 
-0003a3d0: 7361 6d65 2064 696d 656e 7369 6f6e 616c  same dimensional
-0003a3e0: 6974 7929 0a0a 2020 2020 2020 2020 5061  ity)..        Pa
-0003a3f0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-0003a400: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-0003a410: 2020 2020 6461 7461 6672 616d 6520 3a20      dataframe : 
-0003a420: 4461 7461 4672 616d 650a 2020 2020 2020  DataFrame.      
-0003a430: 2020 2020 2020 4461 7461 4672 616d 6520        DataFrame 
-0003a440: 6672 6f6d 2077 6869 6368 2074 6f20 636f  from which to co
-0003a450: 7079 2064 6174 6120 616e 6420 696e 6469  py data and indi
-0003a460: 6365 732e 0a20 2020 2020 2020 2073 7061  ces..        spa
-0003a470: 7273 6520 3a20 626f 6f6c 2c20 6465 6661  rse : bool, defa
-0003a480: 756c 743a 2046 616c 7365 0a20 2020 2020  ult: False.     
-0003a490: 2020 2020 2020 2049 6620 7472 7565 2c20         If true, 
-0003a4a0: 6372 6561 7465 2061 2073 7061 7273 6520  create a sparse 
-0003a4b0: 6172 7261 7973 2069 6e73 7465 6164 206f  arrays instead o
-0003a4c0: 6620 6465 6e73 6520 6e75 6d70 7920 6172  f dense numpy ar
-0003a4d0: 7261 7973 2e20 5468 6973 0a20 2020 2020  rays. This.     
-0003a4e0: 2020 2020 2020 2063 616e 2070 6f74 656e         can poten
-0003a4f0: 7469 616c 6c79 2073 6176 6520 6120 6c61  tially save a la
-0003a500: 7267 6520 616d 6f75 6e74 206f 6620 6d65  rge amount of me
-0003a510: 6d6f 7279 2069 6620 7468 6520 4461 7461  mory if the Data
-0003a520: 4672 616d 6520 6861 730a 2020 2020 2020  Frame has.      
-0003a530: 2020 2020 2020 6120 4d75 6c74 6949 6e64        a MultiInd
-0003a540: 6578 2e20 5265 7175 6972 6573 2074 6865  ex. Requires the
-0003a550: 2073 7061 7273 6520 7061 636b 6167 6520   sparse package 
-0003a560: 2873 7061 7273 652e 7079 6461 7461 2e6f  (sparse.pydata.o
-0003a570: 7267 292e 0a0a 2020 2020 2020 2020 5265  rg)...        Re
-0003a580: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-0003a590: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4e65  -----.        Ne
-0003a5a0: 7720 4461 7461 7365 742e 0a0a 2020 2020  w Dataset...    
-0003a5b0: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-0003a5c0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-0003a5d0: 2020 2020 2020 7861 7272 6179 2e44 6174        xarray.Dat
-0003a5e0: 6141 7272 6179 2e66 726f 6d5f 7365 7269  aArray.from_seri
-0003a5f0: 6573 0a20 2020 2020 2020 2070 616e 6461  es.        panda
-0003a600: 732e 4461 7461 4672 616d 652e 746f 5f78  s.DataFrame.to_x
-0003a610: 6172 7261 790a 2020 2020 2020 2020 2222  array.        ""
-0003a620: 220a 2020 2020 2020 2020 2320 544f 444f  ".        # TODO
-0003a630: 3a20 4164 6420 616e 206f 7074 696f 6e20  : Add an option 
-0003a640: 746f 2072 656d 6f76 6520 6469 6d65 6e73  to remove dimens
-0003a650: 696f 6e73 2061 6c6f 6e67 2077 6869 6368  ions along which
-0003a660: 2074 6865 2076 6172 6961 626c 6573 0a20   the variables. 
-0003a670: 2020 2020 2020 2023 2061 7265 2063 6f6e         # are con
-0003a680: 7374 616e 742c 2074 6f20 656e 6162 6c65  stant, to enable
-0003a690: 2063 6f6e 7369 7374 656e 7420 7365 7269   consistent seri
-0003a6a0: 616c 697a 6174 696f 6e20 746f 2f66 726f  alization to/fro
-0003a6b0: 6d20 6120 6461 7461 6672 616d 652c 0a20  m a dataframe,. 
-0003a6c0: 2020 2020 2020 2023 2065 7665 6e20 6966         # even if
-0003a6d0: 2073 6f6d 6520 7661 7269 6162 6c65 7320   some variables 
-0003a6e0: 6861 7665 2064 6966 6665 7265 6e74 2064  have different d
-0003a6f0: 696d 656e 7369 6f6e 616c 6974 792e 0a0a  imensionality...
-0003a700: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-0003a710: 6174 6166 7261 6d65 2e63 6f6c 756d 6e73  ataframe.columns
-0003a720: 2e69 735f 756e 6971 7565 3a0a 2020 2020  .is_unique:.    
-0003a730: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0003a740: 6c75 6545 7272 6f72 2822 6361 6e6e 6f74  lueError("cannot
-0003a750: 2063 6f6e 7665 7274 2044 6174 6146 7261   convert DataFra
-0003a760: 6d65 2077 6974 6820 6e6f 6e2d 756e 6971  me with non-uniq
-0003a770: 7565 2063 6f6c 756d 6e73 2229 0a0a 2020  ue columns")..  
-0003a780: 2020 2020 2020 6964 7820 3d20 7265 6d6f        idx = remo
-0003a790: 7665 5f75 6e75 7365 645f 6c65 7665 6c73  ve_unused_levels
-0003a7a0: 5f63 6174 6567 6f72 6965 7328 6461 7461  _categories(data
-0003a7b0: 6672 616d 652e 696e 6465 7829 0a0a 2020  frame.index)..  
-0003a7c0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0003a7d0: 6e63 6528 6964 782c 2070 642e 4d75 6c74  nce(idx, pd.Mult
-0003a7e0: 6949 6e64 6578 2920 616e 6420 6e6f 7420  iIndex) and not 
-0003a7f0: 6964 782e 6973 5f75 6e69 7175 653a 0a20  idx.is_unique:. 
-0003a800: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0003a810: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-0003a820: 2020 2020 2020 2020 2020 2020 2022 6361               "ca
-0003a830: 6e6e 6f74 2063 6f6e 7665 7274 2061 2044  nnot convert a D
-0003a840: 6174 6146 7261 6d65 2077 6974 6820 6120  ataFrame with a 
-0003a850: 6e6f 6e2d 756e 6971 7565 204d 756c 7469  non-unique Multi
-0003a860: 496e 6465 7820 696e 746f 2078 6172 7261  Index into xarra
-0003a870: 7922 0a20 2020 2020 2020 2020 2020 2029  y".            )
-0003a880: 0a0a 2020 2020 2020 2020 2320 4361 7374  ..        # Cast
-0003a890: 2074 6f20 6120 4e75 6d50 7920 6172 7261   to a NumPy arra
-0003a8a0: 7920 6669 7273 742c 2069 6e20 6361 7365  y first, in case
-0003a8b0: 2074 6865 2053 6572 6965 7320 6973 2061   the Series is a
-0003a8c0: 2070 616e 6461 7320 4578 7465 6e73 696f   pandas Extensio
-0003a8d0: 6e0a 2020 2020 2020 2020 2320 6172 7261  n.        # arra
-0003a8e0: 7920 2877 6869 6368 2064 6f65 736e 2774  y (which doesn't
-0003a8f0: 2068 6176 6520 6120 7661 6c69 6420 4e75   have a valid Nu
-0003a900: 6d50 7920 6474 7970 6529 0a20 2020 2020  mPy dtype).     
-0003a910: 2020 2023 2054 4f44 4f3a 2061 6c6c 6f77     # TODO: allow
-0003a920: 2075 7365 7273 2074 6f20 636f 6e74 726f   users to contro
-0003a930: 6c20 686f 7720 7468 6973 2063 6173 7469  l how this casti
-0003a940: 6e67 2068 6170 7065 6e73 2c20 652e 672e  ng happens, e.g.
-0003a950: 2c20 6279 0a20 2020 2020 2020 2023 2066  , by.        # f
-0003a960: 6f72 7761 7264 696e 6720 6172 6775 6d65  orwarding argume
-0003a970: 6e74 7320 746f 2070 616e 6461 732e 5365  nts to pandas.Se
-0003a980: 7269 6573 2e74 6f5f 6e75 6d70 793f 0a20  ries.to_numpy?. 
-0003a990: 2020 2020 2020 2061 7272 6179 7320 3d20         arrays = 
-0003a9a0: 5b28 6b2c 206e 702e 6173 6172 7261 7928  [(k, np.asarray(
-0003a9b0: 7629 2920 666f 7220 6b2c 2076 2069 6e20  v)) for k, v in 
-0003a9c0: 6461 7461 6672 616d 652e 6974 656d 7328  dataframe.items(
-0003a9d0: 295d 0a0a 2020 2020 2020 2020 696e 6465  )]..        inde
-0003a9e0: 7865 733a 2064 6963 745b 4861 7368 6162  xes: dict[Hashab
-0003a9f0: 6c65 2c20 496e 6465 785d 203d 207b 7d0a  le, Index] = {}.
-0003aa00: 2020 2020 2020 2020 696e 6465 785f 7661          index_va
-0003aa10: 7273 3a20 6469 6374 5b48 6173 6861 626c  rs: dict[Hashabl
-0003aa20: 652c 2056 6172 6961 626c 655d 203d 207b  e, Variable] = {
-0003aa30: 7d0a 0a20 2020 2020 2020 2069 6620 6973  }..        if is
-0003aa40: 696e 7374 616e 6365 2869 6478 2c20 7064  instance(idx, pd
-0003aa50: 2e4d 756c 7469 496e 6465 7829 3a0a 2020  .MultiIndex):.  
-0003aa60: 2020 2020 2020 2020 2020 6469 6d73 203d            dims =
-0003aa70: 2074 7570 6c65 280a 2020 2020 2020 2020   tuple(.        
-0003aa80: 2020 2020 2020 2020 6e61 6d65 2069 6620          name if 
-0003aa90: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
-0003aaa0: 2065 6c73 6520 226c 6576 656c 5f25 6922   else "level_%i"
-0003aab0: 2025 206e 0a20 2020 2020 2020 2020 2020   % n.           
-0003aac0: 2020 2020 2066 6f72 206e 2c20 6e61 6d65       for n, name
-0003aad0: 2069 6e20 656e 756d 6572 6174 6528 6964   in enumerate(id
-0003aae0: 782e 6e61 6d65 7329 0a20 2020 2020 2020  x.names).       
-0003aaf0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0003ab00: 2020 2066 6f72 2064 696d 2c20 6c65 7620     for dim, lev 
-0003ab10: 696e 207a 6970 2864 696d 732c 2069 6478  in zip(dims, idx
-0003ab20: 2e6c 6576 656c 7329 3a0a 2020 2020 2020  .levels):.      
-0003ab30: 2020 2020 2020 2020 2020 7872 5f69 6478            xr_idx
-0003ab40: 203d 2050 616e 6461 7349 6e64 6578 286c   = PandasIndex(l
-0003ab50: 6576 2c20 6469 6d29 0a20 2020 2020 2020  ev, dim).       
-0003ab60: 2020 2020 2020 2020 2069 6e64 6578 6573           indexes
-0003ab70: 5b64 696d 5d20 3d20 7872 5f69 6478 0a20  [dim] = xr_idx. 
-0003ab80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0003ab90: 6e64 6578 5f76 6172 732e 7570 6461 7465  ndex_vars.update
-0003aba0: 2878 725f 6964 782e 6372 6561 7465 5f76  (xr_idx.create_v
-0003abb0: 6172 6961 626c 6573 2829 290a 2020 2020  ariables()).    
-0003abc0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0003abd0: 2020 2020 2020 696e 6465 785f 6e61 6d65        index_name
-0003abe0: 203d 2069 6478 2e6e 616d 6520 6966 2069   = idx.name if i
-0003abf0: 6478 2e6e 616d 6520 6973 206e 6f74 204e  dx.name is not N
-0003ac00: 6f6e 6520 656c 7365 2022 696e 6465 7822  one else "index"
-0003ac10: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
-0003ac20: 7320 3d20 2869 6e64 6578 5f6e 616d 652c  s = (index_name,
-0003ac30: 290a 2020 2020 2020 2020 2020 2020 7872  ).            xr
-0003ac40: 5f69 6478 203d 2050 616e 6461 7349 6e64  _idx = PandasInd
-0003ac50: 6578 2869 6478 2c20 696e 6465 785f 6e61  ex(idx, index_na
-0003ac60: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0003ac70: 696e 6465 7865 735b 696e 6465 785f 6e61  indexes[index_na
-0003ac80: 6d65 5d20 3d20 7872 5f69 6478 0a20 2020  me] = xr_idx.   
-0003ac90: 2020 2020 2020 2020 2069 6e64 6578 5f76           index_v
-0003aca0: 6172 732e 7570 6461 7465 2878 725f 6964  ars.update(xr_id
-0003acb0: 782e 6372 6561 7465 5f76 6172 6961 626c  x.create_variabl
-0003acc0: 6573 2829 290a 0a20 2020 2020 2020 206f  es())..        o
-0003acd0: 626a 203d 2063 6c73 2e5f 636f 6e73 7472  bj = cls._constr
-0003ace0: 7563 745f 6469 7265 6374 2869 6e64 6578  uct_direct(index
-0003acf0: 5f76 6172 732c 2073 6574 2869 6e64 6578  _vars, set(index
-0003ad00: 5f76 6172 7329 2c20 696e 6465 7865 733d  _vars), indexes=
-0003ad10: 696e 6465 7865 7329 0a0a 2020 2020 2020  indexes)..      
-0003ad20: 2020 6966 2073 7061 7273 653a 0a20 2020    if sparse:.   
-0003ad30: 2020 2020 2020 2020 206f 626a 2e5f 7365           obj._se
-0003ad40: 745f 7370 6172 7365 5f64 6174 615f 6672  t_sparse_data_fr
-0003ad50: 6f6d 5f64 6174 6166 7261 6d65 2869 6478  om_dataframe(idx
-0003ad60: 2c20 6172 7261 7973 2c20 6469 6d73 290a  , arrays, dims).
-0003ad70: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0003ad80: 2020 2020 2020 2020 2020 6f62 6a2e 5f73            obj._s
-0003ad90: 6574 5f6e 756d 7079 5f64 6174 615f 6672  et_numpy_data_fr
-0003ada0: 6f6d 5f64 6174 6166 7261 6d65 2869 6478  om_dataframe(idx
-0003adb0: 2c20 6172 7261 7973 2c20 6469 6d73 290a  , arrays, dims).
-0003adc0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0003add0: 626a 0a0a 2020 2020 6465 6620 746f 5f64  bj..    def to_d
-0003ade0: 6173 6b5f 6461 7461 6672 616d 6528 0a20  ask_dataframe(. 
-0003adf0: 2020 2020 2020 2073 656c 662c 2064 696d         self, dim
-0003ae00: 5f6f 7264 6572 3a20 5365 7175 656e 6365  _order: Sequence
-0003ae10: 5b48 6173 6861 626c 655d 207c 204e 6f6e  [Hashable] | Non
-0003ae20: 6520 3d20 4e6f 6e65 2c20 7365 745f 696e  e = None, set_in
-0003ae30: 6465 783a 2062 6f6f 6c20 3d20 4661 6c73  dex: bool = Fals
-0003ae40: 650a 2020 2020 2920 2d3e 2044 6173 6b44  e.    ) -> DaskD
-0003ae50: 6174 6146 7261 6d65 3a0a 2020 2020 2020  ataFrame:.      
-0003ae60: 2020 2222 220a 2020 2020 2020 2020 436f    """.        Co
-0003ae70: 6e76 6572 7420 7468 6973 2064 6174 6173  nvert this datas
-0003ae80: 6574 2069 6e74 6f20 6120 6461 736b 2e64  et into a dask.d
-0003ae90: 6174 6166 7261 6d65 2e44 6174 6146 7261  ataframe.DataFra
-0003aea0: 6d65 2e0a 0a20 2020 2020 2020 2054 6865  me...        The
-0003aeb0: 2064 696d 656e 7369 6f6e 732c 2063 6f6f   dimensions, coo
-0003aec0: 7264 696e 6174 6573 2061 6e64 2064 6174  rdinates and dat
-0003aed0: 6120 7661 7269 6162 6c65 7320 696e 2074  a variables in t
-0003aee0: 6869 7320 6461 7461 7365 7420 666f 726d  his dataset form
-0003aef0: 0a20 2020 2020 2020 2074 6865 2063 6f6c  .        the col
-0003af00: 756d 6e73 206f 6620 7468 6520 4461 7461  umns of the Data
-0003af10: 4672 616d 652e 0a0a 2020 2020 2020 2020  Frame...        
-0003af20: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-0003af30: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0003af40: 2020 2020 2020 6469 6d5f 6f72 6465 7220        dim_order 
-0003af50: 3a20 6c69 7374 2c20 6f70 7469 6f6e 616c  : list, optional
-0003af60: 0a20 2020 2020 2020 2020 2020 2048 6965  .            Hie
-0003af70: 7261 7263 6869 6361 6c20 6469 6d65 6e73  rarchical dimens
-0003af80: 696f 6e20 6f72 6465 7220 666f 7220 7468  ion order for th
-0003af90: 6520 7265 7375 6c74 696e 6720 6461 7461  e resulting data
-0003afa0: 6672 616d 652e 2041 6c6c 0a20 2020 2020  frame. All.     
-0003afb0: 2020 2020 2020 2061 7272 6179 7320 6172         arrays ar
-0003afc0: 6520 7472 616e 7370 6f73 6564 2074 6f20  e transposed to 
-0003afd0: 7468 6973 206f 7264 6572 2061 6e64 2074  this order and t
-0003afe0: 6865 6e20 7772 6974 7465 6e20 6f75 7420  hen written out 
-0003aff0: 6173 2066 6c61 740a 2020 2020 2020 2020  as flat.        
-0003b000: 2020 2020 7665 6374 6f72 7320 696e 2063      vectors in c
-0003b010: 6f6e 7469 6775 6f75 7320 6f72 6465 722c  ontiguous order,
-0003b020: 2073 6f20 7468 6520 6c61 7374 2064 696d   so the last dim
-0003b030: 656e 7369 6f6e 2069 6e20 7468 6973 206c  ension in this l
-0003b040: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
-0003b050: 7769 6c6c 2062 6520 636f 6e74 6967 756f  will be contiguo
-0003b060: 7573 2069 6e20 7468 6520 7265 7375 6c74  us in the result
-0003b070: 696e 6720 4461 7461 4672 616d 652e 2054  ing DataFrame. T
-0003b080: 6869 7320 6861 7320 6120 6d61 6a6f 720a  his has a major.
-0003b090: 2020 2020 2020 2020 2020 2020 696e 666c              infl
-0003b0a0: 7565 6e63 6520 6f6e 2077 6869 6368 206f  uence on which o
-0003b0b0: 7065 7261 7469 6f6e 7320 6172 6520 6566  perations are ef
-0003b0c0: 6669 6369 656e 7420 6f6e 2074 6865 2072  ficient on the r
-0003b0d0: 6573 756c 7469 6e67 2064 6173 6b0a 2020  esulting dask.  
-0003b0e0: 2020 2020 2020 2020 2020 6461 7461 6672            datafr
-0003b0f0: 616d 652e 0a0a 2020 2020 2020 2020 2020  ame...          
-0003b100: 2020 4966 2070 726f 7669 6465 642c 206d    If provided, m
-0003b110: 7573 7420 696e 636c 7564 6520 616c 6c20  ust include all 
-0003b120: 6469 6d65 6e73 696f 6e73 206f 6620 7468  dimensions of th
-0003b130: 6973 2064 6174 6173 6574 2e20 4279 0a20  is dataset. By. 
-0003b140: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-0003b150: 6c74 2c20 6469 6d65 6e73 696f 6e73 2061  lt, dimensions a
-0003b160: 7265 2073 6f72 7465 6420 616c 7068 6162  re sorted alphab
-0003b170: 6574 6963 616c 6c79 2e0a 2020 2020 2020  etically..      
-0003b180: 2020 7365 745f 696e 6465 7820 3a20 626f    set_index : bo
-0003b190: 6f6c 2c20 6465 6661 756c 743a 2046 616c  ol, default: Fal
-0003b1a0: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
-0003b1b0: 6620 7365 745f 696e 6465 783d 5472 7565  f set_index=True
-0003b1c0: 2c20 7468 6520 6461 736b 2044 6174 6146  , the dask DataF
-0003b1d0: 7261 6d65 2069 7320 696e 6465 7865 6420  rame is indexed 
-0003b1e0: 6279 2074 6869 7320 6461 7461 7365 7427  by this dataset'
-0003b1f0: 730a 2020 2020 2020 2020 2020 2020 636f  s.            co
-0003b200: 6f72 6469 6e61 7465 2e20 5369 6e63 6520  ordinate. Since 
-0003b210: 6461 736b 2044 6174 6146 7261 6d65 7320  dask DataFrames 
-0003b220: 646f 206e 6f74 2073 7570 706f 7274 206d  do not support m
-0003b230: 756c 7469 2d69 6e64 6578 6573 2c0a 2020  ulti-indexes,.  
-0003b240: 2020 2020 2020 2020 2020 7365 745f 696e            set_in
-0003b250: 6465 7820 6f6e 6c79 2077 6f72 6b73 2069  dex only works i
-0003b260: 6620 7468 6520 6461 7461 7365 7420 6f6e  f the dataset on
-0003b270: 6c79 2063 6f6e 7461 696e 7320 6f6e 6520  ly contains one 
-0003b280: 6469 6d65 6e73 696f 6e2e 0a0a 2020 2020  dimension...    
-0003b290: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-0003b2a0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-0003b2b0: 2020 2020 6461 736b 2e64 6174 6166 7261      dask.datafra
-0003b2c0: 6d65 2e44 6174 6146 7261 6d65 0a20 2020  me.DataFrame.   
-0003b2d0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0003b2e0: 2020 696d 706f 7274 2064 6173 6b2e 6172    import dask.ar
-0003b2f0: 7261 7920 6173 2064 610a 2020 2020 2020  ray as da.      
-0003b300: 2020 696d 706f 7274 2064 6173 6b2e 6461    import dask.da
-0003b310: 7461 6672 616d 6520 6173 2064 640a 0a20  taframe as dd.. 
-0003b320: 2020 2020 2020 206f 7264 6572 6564 5f64         ordered_d
-0003b330: 696d 7320 3d20 7365 6c66 2e5f 6e6f 726d  ims = self._norm
-0003b340: 616c 697a 655f 6469 6d5f 6f72 6465 7228  alize_dim_order(
-0003b350: 6469 6d5f 6f72 6465 723d 6469 6d5f 6f72  dim_order=dim_or
-0003b360: 6465 7229 0a0a 2020 2020 2020 2020 636f  der)..        co
-0003b370: 6c75 6d6e 7320 3d20 6c69 7374 286f 7264  lumns = list(ord
-0003b380: 6572 6564 5f64 696d 7329 0a20 2020 2020  ered_dims).     
-0003b390: 2020 2063 6f6c 756d 6e73 2e65 7874 656e     columns.exten
-0003b3a0: 6428 6b20 666f 7220 6b20 696e 2073 656c  d(k for k in sel
-0003b3b0: 662e 636f 6f72 6473 2069 6620 6b20 6e6f  f.coords if k no
-0003b3c0: 7420 696e 2073 656c 662e 6469 6d73 290a  t in self.dims).
-0003b3d0: 2020 2020 2020 2020 636f 6c75 6d6e 732e          columns.
-0003b3e0: 6578 7465 6e64 2873 656c 662e 6461 7461  extend(self.data
-0003b3f0: 5f76 6172 7329 0a0a 2020 2020 2020 2020  _vars)..        
-0003b400: 7365 7269 6573 5f6c 6973 7420 3d20 5b5d  series_list = []
-0003b410: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
-0003b420: 6520 696e 2063 6f6c 756d 6e73 3a0a 2020  e in columns:.  
-0003b430: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-0003b440: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0003b450: 6172 203d 2073 656c 662e 7661 7269 6162  ar = self.variab
-0003b460: 6c65 735b 6e61 6d65 5d0a 2020 2020 2020  les[name].      
-0003b470: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-0003b480: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-0003b490: 2020 2020 2020 2023 2064 696d 656e 7369         # dimensi
-0003b4a0: 6f6e 2077 6974 686f 7574 2061 206d 6174  on without a mat
-0003b4b0: 6368 696e 6720 636f 6f72 6469 6e61 7465  ching coordinate
-0003b4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003b4d0: 2073 697a 6520 3d20 7365 6c66 2e64 696d   size = self.dim
-0003b4e0: 735b 6e61 6d65 5d0a 2020 2020 2020 2020  s[name].        
-0003b4f0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0003b500: 612e 6172 616e 6765 2873 697a 652c 2063  a.arange(size, c
-0003b510: 6875 6e6b 733d 7369 7a65 2c20 6474 7970  hunks=size, dtyp
-0003b520: 653d 6e70 2e69 6e74 3634 290a 2020 2020  e=np.int64).    
-0003b530: 2020 2020 2020 2020 2020 2020 7661 7220              var 
-0003b540: 3d20 5661 7269 6162 6c65 2828 6e61 6d65  = Variable((name
-0003b550: 2c29 2c20 6461 7461 290a 0a20 2020 2020  ,), data)..     
-0003b560: 2020 2020 2020 2023 2049 6e64 6578 5661         # IndexVa
-0003b570: 7269 6162 6c65 206f 626a 6563 7473 2068  riable objects h
-0003b580: 6176 6520 6120 6475 6d6d 7920 2e63 6875  ave a dummy .chu
-0003b590: 6e6b 2829 206d 6574 686f 640a 2020 2020  nk() method.    
-0003b5a0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0003b5b0: 7461 6e63 6528 7661 722c 2049 6e64 6578  tance(var, Index
-0003b5c0: 5661 7269 6162 6c65 293a 0a20 2020 2020  Variable):.     
-0003b5d0: 2020 2020 2020 2020 2020 2076 6172 203d             var =
-0003b5e0: 2076 6172 2e74 6f5f 6261 7365 5f76 6172   var.to_base_var
-0003b5f0: 6961 626c 6528 290a 0a20 2020 2020 2020  iable()..       
-0003b600: 2020 2020 2023 204d 616b 6520 7375 7265       # Make sure
-0003b610: 2076 6172 2069 7320 6120 6461 736b 2061   var is a dask a
-0003b620: 7272 6179 2c20 6f74 6865 7277 6973 6520  rray, otherwise 
-0003b630: 7468 6520 6172 7261 7920 6361 6e20 6265  the array can be
-0003b640: 636f 6d65 2074 6f6f 206c 6172 6765 0a20  come too large. 
-0003b650: 2020 2020 2020 2020 2020 2023 2077 6865             # whe
-0003b660: 6e20 6974 2069 7320 6272 6f61 6463 6173  n it is broadcas
-0003b670: 7465 6420 746f 2073 6576 6572 616c 2064  ted to several d
-0003b680: 696d 656e 7369 6f6e 733a 0a20 2020 2020  imensions:.     
-0003b690: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-0003b6a0: 5f64 7563 6b5f 6461 736b 5f61 7272 6179  _duck_dask_array
-0003b6b0: 2876 6172 2e5f 6461 7461 293a 0a20 2020  (var._data):.   
-0003b6c0: 2020 2020 2020 2020 2020 2020 2076 6172               var
-0003b6d0: 203d 2076 6172 2e63 6875 6e6b 2829 0a0a   = var.chunk()..
-0003b6e0: 2020 2020 2020 2020 2020 2020 6461 736b              dask
-0003b6f0: 5f61 7272 6179 203d 2076 6172 2e73 6574  _array = var.set
-0003b700: 5f64 696d 7328 6f72 6465 7265 645f 6469  _dims(ordered_di
-0003b710: 6d73 292e 6368 756e 6b28 7365 6c66 2e63  ms).chunk(self.c
-0003b720: 6875 6e6b 7329 2e64 6174 610a 2020 2020  hunks).data.    
-0003b730: 2020 2020 2020 2020 7365 7269 6573 203d          series =
-0003b740: 2064 642e 6672 6f6d 5f61 7272 6179 2864   dd.from_array(d
-0003b750: 6173 6b5f 6172 7261 792e 7265 7368 6170  ask_array.reshap
-0003b760: 6528 2d31 292c 2063 6f6c 756d 6e73 3d5b  e(-1), columns=[
-0003b770: 6e61 6d65 5d29 0a20 2020 2020 2020 2020  name]).         
-0003b780: 2020 2073 6572 6965 735f 6c69 7374 2e61     series_list.a
-0003b790: 7070 656e 6428 7365 7269 6573 290a 0a20  ppend(series).. 
-0003b7a0: 2020 2020 2020 2064 6620 3d20 6464 2e63         df = dd.c
-0003b7b0: 6f6e 6361 7428 7365 7269 6573 5f6c 6973  oncat(series_lis
-0003b7c0: 742c 2061 7869 733d 3129 0a0a 2020 2020  t, axis=1)..    
-0003b7d0: 2020 2020 6966 2073 6574 5f69 6e64 6578      if set_index
-0003b7e0: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
-0003b7f0: 6d5f 6f72 6465 7220 3d20 5b2a 6f72 6465  m_order = [*orde
-0003b800: 7265 645f 6469 6d73 5d0a 0a20 2020 2020  red_dims]..     
-0003b810: 2020 2020 2020 2069 6620 6c65 6e28 6469         if len(di
-0003b820: 6d5f 6f72 6465 7229 203d 3d20 313a 0a20  m_order) == 1:. 
-0003b830: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0003b840: 6469 6d2c 2920 3d20 6469 6d5f 6f72 6465  dim,) = dim_orde
-0003b850: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-0003b860: 2020 6466 203d 2064 662e 7365 745f 696e    df = df.set_in
-0003b870: 6465 7828 6469 6d29 0a20 2020 2020 2020  dex(dim).       
-0003b880: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0003b890: 2020 2020 2020 2020 2020 2023 2074 7269             # tri
-0003b8a0: 6767 6572 7320 616e 2065 7272 6f72 2061  ggers an error a
-0003b8b0: 626f 7574 206d 756c 7469 2d69 6e64 6578  bout multi-index
-0003b8c0: 6573 2c20 6576 656e 2069 6620 6f6e 6c79  es, even if only
-0003b8d0: 206f 6e65 0a20 2020 2020 2020 2020 2020   one.           
-0003b8e0: 2020 2020 2023 2064 696d 656e 7369 6f6e       # dimension
-0003b8f0: 2069 7320 7061 7373 6564 0a20 2020 2020   is passed.     
-0003b900: 2020 2020 2020 2020 2020 2064 6620 3d20             df = 
-0003b910: 6466 2e73 6574 5f69 6e64 6578 2864 696d  df.set_index(dim
-0003b920: 5f6f 7264 6572 290a 0a20 2020 2020 2020  _order)..       
-0003b930: 2072 6574 7572 6e20 6466 0a0a 2020 2020   return df..    
-0003b940: 6465 6620 746f 5f64 6963 7428 7365 6c66  def to_dict(self
-0003b950: 2c20 6461 7461 3a20 626f 6f6c 203d 2054  , data: bool = T
-0003b960: 7275 652c 2065 6e63 6f64 696e 673a 2062  rue, encoding: b
-0003b970: 6f6f 6c20 3d20 4661 6c73 6529 202d 3e20  ool = False) -> 
-0003b980: 6469 6374 5b73 7472 2c20 416e 795d 3a0a  dict[str, Any]:.
-0003b990: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0003b9a0: 2020 2020 436f 6e76 6572 7420 7468 6973      Convert this
-0003b9b0: 2064 6174 6173 6574 2074 6f20 6120 6469   dataset to a di
-0003b9c0: 6374 696f 6e61 7279 2066 6f6c 6c6f 7769  ctionary followi
-0003b9d0: 6e67 2078 6172 7261 7920 6e61 6d69 6e67  ng xarray naming
-0003b9e0: 0a20 2020 2020 2020 2063 6f6e 7665 6e74  .        convent
-0003b9f0: 696f 6e73 2e0a 0a20 2020 2020 2020 2043  ions...        C
-0003ba00: 6f6e 7665 7274 7320 616c 6c20 7661 7269  onverts all vari
-0003ba10: 6162 6c65 7320 616e 6420 6174 7472 6962  ables and attrib
-0003ba20: 7574 6573 2074 6f20 6e61 7469 7665 2050  utes to native P
-0003ba30: 7974 686f 6e20 6f62 6a65 6374 730a 2020  ython objects.  
-0003ba40: 2020 2020 2020 5573 6566 756c 2066 6f72        Useful for
-0003ba50: 2063 6f6e 7665 7274 696e 6720 746f 206a   converting to j
-0003ba60: 736f 6e2e 2054 6f20 6176 6f69 6420 6461  son. To avoid da
-0003ba70: 7465 7469 6d65 2069 6e63 6f6d 7061 7469  tetime incompati
-0003ba80: 6269 6c69 7479 0a20 2020 2020 2020 2075  bility.        u
-0003ba90: 7365 2064 6563 6f64 655f 7469 6d65 733d  se decode_times=
-0003baa0: 4661 6c73 6520 6b77 6172 6720 696e 2078  False kwarg in x
-0003bab0: 6172 7272 6179 2e6f 7065 6e5f 6461 7461  arrray.open_data
-0003bac0: 7365 742e 0a0a 2020 2020 2020 2020 5061  set...        Pa
-0003bad0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-0003bae0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-0003baf0: 2020 2020 6461 7461 203a 2062 6f6f 6c2c      data : bool,
-0003bb00: 2064 6566 6175 6c74 3a20 5472 7565 0a20   default: True. 
-0003bb10: 2020 2020 2020 2020 2020 2057 6865 7468             Wheth
-0003bb20: 6572 2074 6f20 696e 636c 7564 6520 7468  er to include th
-0003bb30: 6520 6163 7475 616c 2064 6174 6120 696e  e actual data in
-0003bb40: 2074 6865 2064 6963 7469 6f6e 6172 792e   the dictionary.
-0003bb50: 2057 6865 6e20 7365 7420 746f 0a20 2020   When set to.   
-0003bb60: 2020 2020 2020 2020 2046 616c 7365 2c20           False, 
-0003bb70: 7265 7475 726e 7320 6a75 7374 2074 6865  returns just the
-0003bb80: 2073 6368 656d 612e 0a20 2020 2020 2020   schema..       
-0003bb90: 2065 6e63 6f64 696e 6720 3a20 626f 6f6c   encoding : bool
-0003bba0: 2c20 6465 6661 756c 743a 2046 616c 7365  , default: False
-0003bbb0: 0a20 2020 2020 2020 2020 2020 2057 6865  .            Whe
-0003bbc0: 7468 6572 2074 6f20 696e 636c 7564 6520  ther to include 
-0003bbd0: 7468 6520 4461 7461 7365 7427 7320 656e  the Dataset's en
-0003bbe0: 636f 6469 6e67 2069 6e20 7468 6520 6469  coding in the di
-0003bbf0: 6374 696f 6e61 7279 2e0a 0a20 2020 2020  ctionary...     
-0003bc00: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-0003bc10: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-0003bc20: 2020 2064 203a 2064 6963 740a 2020 2020     d : dict.    
-0003bc30: 2020 2020 2020 2020 4469 6374 2077 6974          Dict wit
-0003bc40: 6820 6b65 7973 3a20 2263 6f6f 7264 7322  h keys: "coords"
-0003bc50: 2c20 2261 7474 7273 222c 2022 6469 6d73  , "attrs", "dims
-0003bc60: 222c 2022 6461 7461 5f76 6172 7322 2061  ", "data_vars" a
-0003bc70: 6e64 206f 7074 696f 6e61 6c6c 790a 2020  nd optionally.  
-0003bc80: 2020 2020 2020 2020 2020 2265 6e63 6f64            "encod
-0003bc90: 696e 6722 2e0a 0a20 2020 2020 2020 2053  ing"...        S
-0003bca0: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
-0003bcb0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-0003bcc0: 2044 6174 6173 6574 2e66 726f 6d5f 6469   Dataset.from_di
-0003bcd0: 6374 0a20 2020 2020 2020 2044 6174 6141  ct.        DataA
-0003bce0: 7272 6179 2e74 6f5f 6469 6374 0a20 2020  rray.to_dict.   
-0003bcf0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0003bd00: 2064 3a20 6469 6374 203d 207b 0a20 2020   d: dict = {.   
-0003bd10: 2020 2020 2020 2020 2022 636f 6f72 6473           "coords
-0003bd20: 223a 207b 7d2c 0a20 2020 2020 2020 2020  ": {},.         
-0003bd30: 2020 2022 6174 7472 7322 3a20 6465 636f     "attrs": deco
-0003bd40: 6465 5f6e 756d 7079 5f64 6963 745f 7661  de_numpy_dict_va
-0003bd50: 6c75 6573 2873 656c 662e 6174 7472 7329  lues(self.attrs)
-0003bd60: 2c0a 2020 2020 2020 2020 2020 2020 2264  ,.            "d
-0003bd70: 696d 7322 3a20 6469 6374 2873 656c 662e  ims": dict(self.
-0003bd80: 6469 6d73 292c 0a20 2020 2020 2020 2020  dims),.         
-0003bd90: 2020 2022 6461 7461 5f76 6172 7322 3a20     "data_vars": 
-0003bda0: 7b7d 2c0a 2020 2020 2020 2020 7d0a 2020  {},.        }.  
-0003bdb0: 2020 2020 2020 666f 7220 6b20 696e 2073        for k in s
-0003bdc0: 656c 662e 636f 6f72 6473 3a0a 2020 2020  elf.coords:.    
-0003bdd0: 2020 2020 2020 2020 645b 2263 6f6f 7264          d["coord
-0003bde0: 7322 5d2e 7570 6461 7465 280a 2020 2020  s"].update(.    
-0003bdf0: 2020 2020 2020 2020 2020 2020 7b6b 3a20              {k: 
-0003be00: 7365 6c66 5b6b 5d2e 7661 7269 6162 6c65  self[k].variable
-0003be10: 2e74 6f5f 6469 6374 2864 6174 613d 6461  .to_dict(data=da
-0003be20: 7461 2c20 656e 636f 6469 6e67 3d65 6e63  ta, encoding=enc
-0003be30: 6f64 696e 6729 7d0a 2020 2020 2020 2020  oding)}.        
-0003be40: 2020 2020 290a 2020 2020 2020 2020 666f      ).        fo
-0003be50: 7220 6b20 696e 2073 656c 662e 6461 7461  r k in self.data
-0003be60: 5f76 6172 733a 0a20 2020 2020 2020 2020  _vars:.         
-0003be70: 2020 2064 5b22 6461 7461 5f76 6172 7322     d["data_vars"
-0003be80: 5d2e 7570 6461 7465 280a 2020 2020 2020  ].update(.      
-0003be90: 2020 2020 2020 2020 2020 7b6b 3a20 7365            {k: se
-0003bea0: 6c66 5b6b 5d2e 7661 7269 6162 6c65 2e74  lf[k].variable.t
-0003beb0: 6f5f 6469 6374 2864 6174 613d 6461 7461  o_dict(data=data
-0003bec0: 2c20 656e 636f 6469 6e67 3d65 6e63 6f64  , encoding=encod
-0003bed0: 696e 6729 7d0a 2020 2020 2020 2020 2020  ing)}.          
-0003bee0: 2020 290a 2020 2020 2020 2020 6966 2065    ).        if e
-0003bef0: 6e63 6f64 696e 673a 0a20 2020 2020 2020  ncoding:.       
-0003bf00: 2020 2020 2064 5b22 656e 636f 6469 6e67       d["encoding
-0003bf10: 225d 203d 2064 6963 7428 7365 6c66 2e65  "] = dict(self.e
-0003bf20: 6e63 6f64 696e 6729 0a20 2020 2020 2020  ncoding).       
-0003bf30: 2072 6574 7572 6e20 640a 0a20 2020 2040   return d..    @
-0003bf40: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-0003bf50: 6465 6620 6672 6f6d 5f64 6963 7428 636c  def from_dict(cl
-0003bf60: 733a 2074 7970 655b 545f 4461 7461 7365  s: type[T_Datase
-0003bf70: 745d 2c20 643a 204d 6170 7069 6e67 5b41  t], d: Mapping[A
-0003bf80: 6e79 2c20 416e 795d 2920 2d3e 2054 5f44  ny, Any]) -> T_D
-0003bf90: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-0003bfa0: 2222 2243 6f6e 7665 7274 2061 2064 6963  """Convert a dic
-0003bfb0: 7469 6f6e 6172 7920 696e 746f 2061 6e20  tionary into an 
-0003bfc0: 7861 7272 6179 2e44 6174 6173 6574 2e0a  xarray.Dataset..
-0003bfd0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0003bfe0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-0003bff0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-0003c000: 203a 2064 6963 742d 6c69 6b65 0a20 2020   : dict-like.   
-0003c010: 2020 2020 2020 2020 204d 6170 7069 6e67           Mapping
-0003c020: 2077 6974 6820 6120 6d69 6e69 6d75 6d20   with a minimum 
-0003c030: 7374 7275 6374 7572 6520 6f66 0a20 2020  structure of.   
-0003c040: 2020 2020 2020 2020 2020 2020 2060 607b               ``{
-0003c050: 2276 6172 5f30 223a 207b 2264 696d 7322  "var_0": {"dims"
-0003c060: 3a20 5b2e 2e5d 2c20 2264 6174 6122 3a20  : [..], "data": 
-0003c070: 5b2e 2e5d 7d2c 205c 0a20 2020 2020 2020  [..]}, \.       
-0003c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c090: 2020 2020 202e 2e2e 7d60 600a 0a20 2020       ...}``..   
-0003c0a0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-0003c0b0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-0003c0c0: 2020 2020 206f 626a 203a 2044 6174 6173       obj : Datas
-0003c0d0: 6574 0a0a 2020 2020 2020 2020 5365 6520  et..        See 
-0003c0e0: 616c 736f 0a20 2020 2020 2020 202d 2d2d  also.        ---
-0003c0f0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
-0003c100: 7461 7365 742e 746f 5f64 6963 740a 2020  taset.to_dict.  
-0003c110: 2020 2020 2020 4461 7461 4172 7261 792e        DataArray.
-0003c120: 6672 6f6d 5f64 6963 740a 0a20 2020 2020  from_dict..     
-0003c130: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
-0003c140: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-0003c150: 2020 2020 203e 3e3e 2064 203d 207b 0a20       >>> d = {. 
-0003c160: 2020 2020 2020 202e 2e2e 2020 2020 2022         ...     "
-0003c170: 7422 3a20 7b22 6469 6d73 223a 2028 2274  t": {"dims": ("t
-0003c180: 2229 2c20 2264 6174 6122 3a20 5b30 2c20  "), "data": [0, 
-0003c190: 312c 2032 5d7d 2c0a 2020 2020 2020 2020  1, 2]},.        
-0003c1a0: 2e2e 2e20 2020 2020 2261 223a 207b 2264  ...     "a": {"d
-0003c1b0: 696d 7322 3a20 2822 7422 292c 2022 6461  ims": ("t"), "da
-0003c1c0: 7461 223a 205b 2261 222c 2022 6222 2c20  ta": ["a", "b", 
-0003c1d0: 2263 225d 7d2c 0a20 2020 2020 2020 202e  "c"]},.        .
-0003c1e0: 2e2e 2020 2020 2022 6222 3a20 7b22 6469  ..     "b": {"di
-0003c1f0: 6d73 223a 2028 2274 2229 2c20 2264 6174  ms": ("t"), "dat
-0003c200: 6122 3a20 5b31 302c 2032 302c 2033 305d  a": [10, 20, 30]
-0003c210: 7d2c 0a20 2020 2020 2020 202e 2e2e 207d  },.        ... }
-0003c220: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
-0003c230: 3d20 7872 2e44 6174 6173 6574 2e66 726f  = xr.Dataset.fro
-0003c240: 6d5f 6469 6374 2864 290a 2020 2020 2020  m_dict(d).      
-0003c250: 2020 3e3e 3e20 6473 0a20 2020 2020 2020    >>> ds.       
-0003c260: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-0003c270: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-0003c280: 696f 6e73 3a20 2028 743a 2033 290a 2020  ions:  (t: 3).  
-0003c290: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
-0003c2a0: 733a 0a20 2020 2020 2020 2020 202a 2074  s:.          * t
-0003c2b0: 2020 2020 2020 2020 2874 2920 696e 7436          (t) int6
-0003c2c0: 3420 3020 3120 320a 2020 2020 2020 2020  4 0 1 2.        
-0003c2d0: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
-0003c2e0: 2020 2020 2020 2020 2020 2020 6120 2020              a   
-0003c2f0: 2020 2020 2028 7429 203c 5531 2027 6127       (t) <U1 'a'
-0003c300: 2027 6227 2027 6327 0a20 2020 2020 2020   'b' 'c'.       
-0003c310: 2020 2020 2062 2020 2020 2020 2020 2874       b        (t
-0003c320: 2920 696e 7436 3420 3130 2032 3020 3330  ) int64 10 20 30
-0003c330: 0a0a 2020 2020 2020 2020 3e3e 3e20 6420  ..        >>> d 
-0003c340: 3d20 7b0a 2020 2020 2020 2020 2e2e 2e20  = {.        ... 
-0003c350: 2020 2020 2263 6f6f 7264 7322 3a20 7b0a      "coords": {.
-0003c360: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-0003c370: 2020 2020 2274 223a 207b 2264 696d 7322      "t": {"dims"
-0003c380: 3a20 2274 222c 2022 6461 7461 223a 205b  : "t", "data": [
-0003c390: 302c 2031 2c20 325d 2c20 2261 7474 7273  0, 1, 2], "attrs
-0003c3a0: 223a 207b 2275 6e69 7473 223a 2022 7322  ": {"units": "s"
-0003c3b0: 7d7d 0a20 2020 2020 2020 202e 2e2e 2020  }}.        ...  
-0003c3c0: 2020 207d 2c0a 2020 2020 2020 2020 2e2e     },.        ..
-0003c3d0: 2e20 2020 2020 2261 7474 7273 223a 207b  .     "attrs": {
-0003c3e0: 2274 6974 6c65 223a 2022 6169 7220 7465  "title": "air te
-0003c3f0: 6d70 6572 6174 7572 6522 7d2c 0a20 2020  mperature"},.   
-0003c400: 2020 2020 202e 2e2e 2020 2020 2022 6469       ...     "di
-0003c410: 6d73 223a 2022 7422 2c0a 2020 2020 2020  ms": "t",.      
-0003c420: 2020 2e2e 2e20 2020 2020 2264 6174 615f    ...     "data_
-0003c430: 7661 7273 223a 207b 0a20 2020 2020 2020  vars": {.       
-0003c440: 202e 2e2e 2020 2020 2020 2020 2022 6122   ...         "a"
-0003c450: 3a20 7b22 6469 6d73 223a 2022 7422 2c20  : {"dims": "t", 
-0003c460: 2264 6174 6122 3a20 5b31 302c 2032 302c  "data": [10, 20,
-0003c470: 2033 305d 7d2c 0a20 2020 2020 2020 202e   30]},.        .
-0003c480: 2e2e 2020 2020 2020 2020 2022 6222 3a20  ..         "b": 
-0003c490: 7b22 6469 6d73 223a 2022 7422 2c20 2264  {"dims": "t", "d
-0003c4a0: 6174 6122 3a20 5b22 6122 2c20 2262 222c  ata": ["a", "b",
-0003c4b0: 2022 6322 5d7d 2c0a 2020 2020 2020 2020   "c"]},.        
-0003c4c0: 2e2e 2e20 2020 2020 7d2c 0a20 2020 2020  ...     },.     
-0003c4d0: 2020 202e 2e2e 207d 0a20 2020 2020 2020     ... }.       
-0003c4e0: 203e 3e3e 2064 7320 3d20 7872 2e44 6174   >>> ds = xr.Dat
-0003c4f0: 6173 6574 2e66 726f 6d5f 6469 6374 2864  aset.from_dict(d
-0003c500: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
-0003c510: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
-0003c520: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
-0003c530: 2020 4469 6d65 6e73 696f 6e73 3a20 2028    Dimensions:  (
-0003c540: 743a 2033 290a 2020 2020 2020 2020 436f  t: 3).        Co
-0003c550: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
-0003c560: 2020 2020 202a 2074 2020 2020 2020 2020       * t        
-0003c570: 2874 2920 696e 7436 3420 3020 3120 320a  (t) int64 0 1 2.
-0003c580: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-0003c590: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-0003c5a0: 2020 2020 6120 2020 2020 2020 2028 7429      a        (t)
-0003c5b0: 2069 6e74 3634 2031 3020 3230 2033 300a   int64 10 20 30.
-0003c5c0: 2020 2020 2020 2020 2020 2020 6220 2020              b   
-0003c5d0: 2020 2020 2028 7429 203c 5531 2027 6127       (t) <U1 'a'
-0003c5e0: 2027 6227 2027 6327 0a20 2020 2020 2020   'b' 'c'.       
-0003c5f0: 2041 7474 7269 6275 7465 733a 0a20 2020   Attributes:.   
-0003c600: 2020 2020 2020 2020 2074 6974 6c65 3a20           title: 
-0003c610: 2020 2061 6972 2074 656d 7065 7261 7475     air temperatu
-0003c620: 7265 0a0a 2020 2020 2020 2020 2222 220a  re..        """.
-0003c630: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-0003c640: 6573 3a20 4974 6572 6162 6c65 5b74 7570  es: Iterable[tup
-0003c650: 6c65 5b48 6173 6861 626c 652c 2041 6e79  le[Hashable, Any
-0003c660: 5d5d 0a20 2020 2020 2020 2069 6620 6e6f  ]].        if no
-0003c670: 7420 7b22 636f 6f72 6473 222c 2022 6461  t {"coords", "da
-0003c680: 7461 5f76 6172 7322 7d2e 6973 7375 6273  ta_vars"}.issubs
-0003c690: 6574 2873 6574 2864 2929 3a0a 2020 2020  et(set(d)):.    
-0003c6a0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0003c6b0: 7320 3d20 642e 6974 656d 7328 290a 2020  s = d.items().  
-0003c6c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0003c6d0: 2020 2020 2020 2020 696d 706f 7274 2069          import i
-0003c6e0: 7465 7274 6f6f 6c73 0a0a 2020 2020 2020  tertools..      
-0003c6f0: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
-0003c700: 3d20 6974 6572 746f 6f6c 732e 6368 6169  = itertools.chai
-0003c710: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-0003c720: 2020 2064 2e67 6574 2822 636f 6f72 6473     d.get("coords
-0003c730: 222c 207b 7d29 2e69 7465 6d73 2829 2c20  ", {}).items(), 
-0003c740: 642e 6765 7428 2264 6174 615f 7661 7273  d.get("data_vars
-0003c750: 222c 207b 7d29 2e69 7465 6d73 2829 0a20  ", {}).items(). 
-0003c760: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0003c770: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0003c780: 2020 2020 2020 7661 7269 6162 6c65 5f64        variable_d
-0003c790: 6963 7420 3d20 7b0a 2020 2020 2020 2020  ict = {.        
-0003c7a0: 2020 2020 2020 2020 6b3a 2028 765b 2264          k: (v["d
-0003c7b0: 696d 7322 5d2c 2076 5b22 6461 7461 225d  ims"], v["data"]
-0003c7c0: 2c20 762e 6765 7428 2261 7474 7273 2229  , v.get("attrs")
-0003c7d0: 2920 666f 7220 6b2c 2076 2069 6e20 7661  ) for k, v in va
-0003c7e0: 7269 6162 6c65 730a 2020 2020 2020 2020  riables.        
-0003c7f0: 2020 2020 7d0a 2020 2020 2020 2020 6578      }.        ex
-0003c800: 6365 7074 204b 6579 4572 726f 7220 6173  cept KeyError as
-0003c810: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0003c820: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0003c830: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0003c840: 2020 2263 616e 6e6f 7420 636f 6e76 6572    "cannot conver
-0003c850: 7420 6469 6374 2077 6974 686f 7574 2074  t dict without t
-0003c860: 6865 206b 6579 2022 0a20 2020 2020 2020  he key ".       
-0003c870: 2020 2020 2020 2020 2022 277b 6469 6d73           "'{dims
-0003c880: 5f64 6174 617d 2722 2e66 6f72 6d61 7428  _data}'".format(
-0003c890: 6469 6d73 5f64 6174 613d 7374 7228 652e  dims_data=str(e.
-0003c8a0: 6172 6773 5b30 5d29 290a 2020 2020 2020  args[0])).      
-0003c8b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0003c8c0: 6f62 6a20 3d20 636c 7328 7661 7269 6162  obj = cls(variab
-0003c8d0: 6c65 5f64 6963 7429 0a0a 2020 2020 2020  le_dict)..      
-0003c8e0: 2020 2320 7768 6174 2069 6620 636f 6f72    # what if coor
-0003c8f0: 6473 2061 7265 6e27 7420 6469 6d73 3f0a  ds aren't dims?.
-0003c900: 2020 2020 2020 2020 636f 6f72 6473 203d          coords =
-0003c910: 2073 6574 2864 2e67 6574 2822 636f 6f72   set(d.get("coor
-0003c920: 6473 222c 207b 7d29 2920 2d20 7365 7428  ds", {})) - set(
-0003c930: 642e 6765 7428 2264 696d 7322 2c20 7b7d  d.get("dims", {}
-0003c940: 2929 0a20 2020 2020 2020 206f 626a 203d  )).        obj =
-0003c950: 206f 626a 2e73 6574 5f63 6f6f 7264 7328   obj.set_coords(
-0003c960: 636f 6f72 6473 290a 0a20 2020 2020 2020  coords)..       
-0003c970: 206f 626a 2e61 7474 7273 2e75 7064 6174   obj.attrs.updat
-0003c980: 6528 642e 6765 7428 2261 7474 7273 222c  e(d.get("attrs",
-0003c990: 207b 7d29 290a 2020 2020 2020 2020 6f62   {})).        ob
-0003c9a0: 6a2e 656e 636f 6469 6e67 2e75 7064 6174  j.encoding.updat
-0003c9b0: 6528 642e 6765 7428 2265 6e63 6f64 696e  e(d.get("encodin
-0003c9c0: 6722 2c20 7b7d 2929 0a0a 2020 2020 2020  g", {}))..      
-0003c9d0: 2020 7265 7475 726e 206f 626a 0a0a 2020    return obj..  
-0003c9e0: 2020 6465 6620 5f75 6e61 7279 5f6f 7028    def _unary_op(
-0003c9f0: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-0003ca00: 2066 2c20 2a61 7267 732c 202a 2a6b 7761   f, *args, **kwa
-0003ca10: 7267 7329 202d 3e20 545f 4461 7461 7365  rgs) -> T_Datase
-0003ca20: 743a 0a20 2020 2020 2020 2076 6172 6961  t:.        varia
-0003ca30: 626c 6573 203d 207b 7d0a 2020 2020 2020  bles = {}.      
-0003ca40: 2020 6b65 6570 5f61 7474 7273 203d 206b    keep_attrs = k
-0003ca50: 7761 7267 732e 706f 7028 226b 6565 705f  wargs.pop("keep_
-0003ca60: 6174 7472 7322 2c20 4e6f 6e65 290a 2020  attrs", None).  
-0003ca70: 2020 2020 2020 6966 206b 6565 705f 6174        if keep_at
-0003ca80: 7472 7320 6973 204e 6f6e 653a 0a20 2020  trs is None:.   
-0003ca90: 2020 2020 2020 2020 206b 6565 705f 6174           keep_at
-0003caa0: 7472 7320 3d20 5f67 6574 5f6b 6565 705f  trs = _get_keep_
-0003cab0: 6174 7472 7328 6465 6661 756c 743d 5472  attrs(default=Tr
-0003cac0: 7565 290a 2020 2020 2020 2020 666f 7220  ue).        for 
-0003cad0: 6b2c 2076 2069 6e20 7365 6c66 2e5f 7661  k, v in self._va
-0003cae0: 7269 6162 6c65 732e 6974 656d 7328 293a  riables.items():
-0003caf0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0003cb00: 6b20 696e 2073 656c 662e 5f63 6f6f 7264  k in self._coord
-0003cb10: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
-0003cb20: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0003cb30: 735b 6b5d 203d 2076 0a20 2020 2020 2020  s[k] = v.       
-0003cb40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0003cb50: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-0003cb60: 626c 6573 5b6b 5d20 3d20 6628 762c 202a  bles[k] = f(v, *
-0003cb70: 6172 6773 2c20 2a2a 6b77 6172 6773 290a  args, **kwargs).
-0003cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cb90: 6966 206b 6565 705f 6174 7472 733a 0a20  if keep_attrs:. 
-0003cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cbb0: 2020 2076 6172 6961 626c 6573 5b6b 5d2e     variables[k].
-0003cbc0: 6174 7472 7320 3d20 762e 5f61 7474 7273  attrs = v._attrs
-0003cbd0: 0a20 2020 2020 2020 2061 7474 7273 203d  .        attrs =
-0003cbe0: 2073 656c 662e 5f61 7474 7273 2069 6620   self._attrs if 
-0003cbf0: 6b65 6570 5f61 7474 7273 2065 6c73 6520  keep_attrs else 
-0003cc00: 4e6f 6e65 0a20 2020 2020 2020 2072 6574  None.        ret
-0003cc10: 7572 6e20 7365 6c66 2e5f 7265 706c 6163  urn self._replac
-0003cc20: 655f 7769 7468 5f6e 6577 5f64 696d 7328  e_with_new_dims(
-0003cc30: 7661 7269 6162 6c65 732c 2061 7474 7273  variables, attrs
-0003cc40: 3d61 7474 7273 290a 0a20 2020 2064 6566  =attrs)..    def
-0003cc50: 205f 6269 6e61 7279 5f6f 7028 7365 6c66   _binary_op(self
-0003cc60: 2c20 6f74 6865 722c 2066 2c20 7265 666c  , other, f, refl
-0003cc70: 6578 6976 653d 4661 6c73 652c 206a 6f69  exive=False, joi
-0003cc80: 6e3d 4e6f 6e65 2920 2d3e 2044 6174 6173  n=None) -> Datas
-0003cc90: 6574 3a0a 2020 2020 2020 2020 6672 6f6d  et:.        from
-0003cca0: 2078 6172 7261 792e 636f 7265 2e64 6174   xarray.core.dat
-0003ccb0: 6161 7272 6179 2069 6d70 6f72 7420 4461  aarray import Da
-0003ccc0: 7461 4172 7261 790a 2020 2020 2020 2020  taArray.        
-0003ccd0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-0003cce0: 2e67 726f 7570 6279 2069 6d70 6f72 7420  .groupby import 
-0003ccf0: 4772 6f75 7042 790a 0a20 2020 2020 2020  GroupBy..       
-0003cd00: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
-0003cd10: 7468 6572 2c20 4772 6f75 7042 7929 3a0a  ther, GroupBy):.
-0003cd20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0003cd30: 726e 204e 6f74 496d 706c 656d 656e 7465  rn NotImplemente
-0003cd40: 640a 2020 2020 2020 2020 616c 6967 6e5f  d.        align_
-0003cd50: 7479 7065 203d 204f 5054 494f 4e53 5b22  type = OPTIONS["
-0003cd60: 6172 6974 686d 6574 6963 5f6a 6f69 6e22  arithmetic_join"
-0003cd70: 5d20 6966 206a 6f69 6e20 6973 204e 6f6e  ] if join is Non
-0003cd80: 6520 656c 7365 206a 6f69 6e0a 2020 2020  e else join.    
-0003cd90: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0003cda0: 6528 6f74 6865 722c 2028 4461 7461 4172  e(other, (DataAr
-0003cdb0: 7261 792c 2044 6174 6173 6574 2929 3a0a  ray, Dataset)):.
-0003cdc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003cdd0: 2c20 6f74 6865 7220 3d20 616c 6967 6e28  , other = align(
-0003cde0: 7365 6c66 2c20 6f74 6865 722c 206a 6f69  self, other, joi
-0003cdf0: 6e3d 616c 6967 6e5f 7479 7065 2c20 636f  n=align_type, co
-0003ce00: 7079 3d46 616c 7365 2920 2023 2074 7970  py=False)  # typ
-0003ce10: 653a 2069 676e 6f72 655b 6173 7369 676e  e: ignore[assign
-0003ce20: 6d65 6e74 5d0a 2020 2020 2020 2020 6720  ment].        g 
-0003ce30: 3d20 6620 6966 206e 6f74 2072 6566 6c65  = f if not refle
-0003ce40: 7869 7665 2065 6c73 6520 6c61 6d62 6461  xive else lambda
-0003ce50: 2078 2c20 793a 2066 2879 2c20 7829 0a20   x, y: f(y, x). 
-0003ce60: 2020 2020 2020 2064 7320 3d20 7365 6c66         ds = self
-0003ce70: 2e5f 6361 6c63 756c 6174 655f 6269 6e61  ._calculate_bina
-0003ce80: 7279 5f6f 7028 672c 206f 7468 6572 2c20  ry_op(g, other, 
-0003ce90: 6a6f 696e 3d61 6c69 676e 5f74 7970 6529  join=align_type)
-0003cea0: 0a20 2020 2020 2020 206b 6565 705f 6174  .        keep_at
-0003ceb0: 7472 7320 3d20 5f67 6574 5f6b 6565 705f  trs = _get_keep_
-0003cec0: 6174 7472 7328 6465 6661 756c 743d 4661  attrs(default=Fa
-0003ced0: 6c73 6529 0a20 2020 2020 2020 2069 6620  lse).        if 
-0003cee0: 6b65 6570 5f61 7474 7273 3a0a 2020 2020  keep_attrs:.    
-0003cef0: 2020 2020 2020 2020 6473 2e61 7474 7273          ds.attrs
-0003cf00: 203d 2073 656c 662e 6174 7472 730a 2020   = self.attrs.  
-0003cf10: 2020 2020 2020 7265 7475 726e 2064 730a        return ds.
-0003cf20: 0a20 2020 2064 6566 205f 696e 706c 6163  .    def _inplac
-0003cf30: 655f 6269 6e61 7279 5f6f 7028 7365 6c66  e_binary_op(self
-0003cf40: 3a20 545f 4461 7461 7365 742c 206f 7468  : T_Dataset, oth
-0003cf50: 6572 2c20 6629 202d 3e20 545f 4461 7461  er, f) -> T_Data
-0003cf60: 7365 743a 0a20 2020 2020 2020 2066 726f  set:.        fro
-0003cf70: 6d20 7861 7272 6179 2e63 6f72 652e 6461  m xarray.core.da
-0003cf80: 7461 6172 7261 7920 696d 706f 7274 2044  taarray import D
-0003cf90: 6174 6141 7272 6179 0a20 2020 2020 2020  ataArray.       
-0003cfa0: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
-0003cfb0: 652e 6772 6f75 7062 7920 696d 706f 7274  e.groupby import
-0003cfc0: 2047 726f 7570 4279 0a0a 2020 2020 2020   GroupBy..      
-0003cfd0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0003cfe0: 6f74 6865 722c 2047 726f 7570 4279 293a  other, GroupBy):
-0003cff0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0003d000: 7365 2054 7970 6545 7272 6f72 280a 2020  se TypeError(.  
-0003d010: 2020 2020 2020 2020 2020 2020 2020 2269                "i
-0003d020: 6e2d 706c 6163 6520 6f70 6572 6174 696f  n-place operatio
-0003d030: 6e73 2062 6574 7765 656e 2061 2044 6174  ns between a Dat
-0003d040: 6173 6574 2061 6e64 2022 0a20 2020 2020  aset and ".     
-0003d050: 2020 2020 2020 2020 2020 2022 6120 6772             "a gr
-0003d060: 6f75 7065 6420 6f62 6a65 6374 2061 7265  ouped object are
-0003d070: 206e 6f74 2070 6572 6d69 7474 6564 220a   not permitted".
-0003d080: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0003d090: 2020 2020 2020 2320 7765 2064 6f6e 2774        # we don't
-0003d0a0: 2061 6374 7561 6c6c 7920 6d6f 6469 6679   actually modify
-0003d0b0: 2061 7272 6179 7320 696e 2d70 6c61 6365   arrays in-place
-0003d0c0: 2077 6974 6820 696e 2d70 6c61 6365 2044   with in-place D
-0003d0d0: 6174 6173 6574 0a20 2020 2020 2020 2023  ataset.        #
-0003d0e0: 2061 7269 7468 6d65 7469 6320 2d2d 2074   arithmetic -- t
-0003d0f0: 6869 7320 6c65 7473 2075 7320 6175 746f  his lets us auto
-0003d100: 6d61 7469 6361 6c6c 7920 616c 6967 6e20  matically align 
-0003d110: 7468 696e 6773 0a20 2020 2020 2020 2069  things.        i
-0003d120: 6620 6973 696e 7374 616e 6365 286f 7468  f isinstance(oth
-0003d130: 6572 2c20 2844 6174 6141 7272 6179 2c20  er, (DataArray, 
-0003d140: 4461 7461 7365 7429 293a 0a20 2020 2020  Dataset)):.     
-0003d150: 2020 2020 2020 206f 7468 6572 203d 206f         other = o
-0003d160: 7468 6572 2e72 6569 6e64 6578 5f6c 696b  ther.reindex_lik
-0003d170: 6528 7365 6c66 2c20 636f 7079 3d46 616c  e(self, copy=Fal
-0003d180: 7365 290a 2020 2020 2020 2020 6720 3d20  se).        g = 
-0003d190: 6f70 732e 696e 706c 6163 655f 746f 5f6e  ops.inplace_to_n
-0003d1a0: 6f6e 696e 706c 6163 655f 6f70 2866 290a  oninplace_op(f).
-0003d1b0: 2020 2020 2020 2020 6473 203d 2073 656c          ds = sel
-0003d1c0: 662e 5f63 616c 6375 6c61 7465 5f62 696e  f._calculate_bin
-0003d1d0: 6172 795f 6f70 2867 2c20 6f74 6865 722c  ary_op(g, other,
-0003d1e0: 2069 6e70 6c61 6365 3d54 7275 6529 0a20   inplace=True). 
-0003d1f0: 2020 2020 2020 2073 656c 662e 5f72 6570         self._rep
-0003d200: 6c61 6365 5f77 6974 685f 6e65 775f 6469  lace_with_new_di
-0003d210: 6d73 280a 2020 2020 2020 2020 2020 2020  ms(.            
-0003d220: 6473 2e5f 7661 7269 6162 6c65 732c 0a20  ds._variables,. 
-0003d230: 2020 2020 2020 2020 2020 2064 732e 5f63             ds._c
-0003d240: 6f6f 7264 5f6e 616d 6573 2c0a 2020 2020  oord_names,.    
-0003d250: 2020 2020 2020 2020 6174 7472 733d 6473          attrs=ds
-0003d260: 2e5f 6174 7472 732c 0a20 2020 2020 2020  ._attrs,.       
-0003d270: 2020 2020 2069 6e64 6578 6573 3d64 732e       indexes=ds.
-0003d280: 5f69 6e64 6578 6573 2c0a 2020 2020 2020  _indexes,.      
-0003d290: 2020 2020 2020 696e 706c 6163 653d 5472        inplace=Tr
-0003d2a0: 7565 2c0a 2020 2020 2020 2020 290a 2020  ue,.        ).  
-0003d2b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0003d2c0: 660a 0a20 2020 2064 6566 205f 6361 6c63  f..    def _calc
-0003d2d0: 756c 6174 655f 6269 6e61 7279 5f6f 7028  ulate_binary_op(
-0003d2e0: 0a20 2020 2020 2020 2073 656c 662c 2066  .        self, f
-0003d2f0: 2c20 6f74 6865 722c 206a 6f69 6e3d 2269  , other, join="i
-0003d300: 6e6e 6572 222c 2069 6e70 6c61 6365 3a20  nner", inplace: 
-0003d310: 626f 6f6c 203d 2046 616c 7365 0a20 2020  bool = False.   
-0003d320: 2029 202d 3e20 4461 7461 7365 743a 0a20   ) -> Dataset:. 
-0003d330: 2020 2020 2020 2064 6566 2061 7070 6c79         def apply
-0003d340: 5f6f 7665 725f 626f 7468 286c 6873 5f64  _over_both(lhs_d
-0003d350: 6174 615f 7661 7273 2c20 7268 735f 6461  ata_vars, rhs_da
-0003d360: 7461 5f76 6172 732c 206c 6873 5f76 6172  ta_vars, lhs_var
-0003d370: 732c 2072 6873 5f76 6172 7329 3a0a 2020  s, rhs_vars):.  
-0003d380: 2020 2020 2020 2020 2020 6966 2069 6e70            if inp
-0003d390: 6c61 6365 2061 6e64 2073 6574 286c 6873  lace and set(lhs
-0003d3a0: 5f64 6174 615f 7661 7273 2920 213d 2073  _data_vars) != s
-0003d3b0: 6574 2872 6873 5f64 6174 615f 7661 7273  et(rhs_data_vars
-0003d3c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0003d3d0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0003d3e0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0003d3f0: 2020 2020 2020 2020 2022 6461 7461 7365           "datase
-0003d400: 7473 206d 7573 7420 6861 7665 2074 6865  ts must have the
-0003d410: 2073 616d 6520 6461 7461 2076 6172 6961   same data varia
-0003d420: 626c 6573 2022 0a20 2020 2020 2020 2020  bles ".         
-0003d430: 2020 2020 2020 2020 2020 2066 2266 6f72             f"for
-0003d440: 2069 6e2d 706c 6163 6520 6172 6974 686d   in-place arithm
-0003d450: 6574 6963 206f 7065 7261 7469 6f6e 733a  etic operations:
-0003d460: 207b 6c69 7374 286c 6873 5f64 6174 615f   {list(lhs_data_
-0003d470: 7661 7273 297d 2c20 7b6c 6973 7428 7268  vars)}, {list(rh
-0003d480: 735f 6461 7461 5f76 6172 7329 7d22 0a20  s_data_vars)}". 
-0003d490: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0003d4a0: 0a0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-0003d4b0: 7374 5f76 6172 7320 3d20 7b7d 0a0a 2020  st_vars = {}..  
-0003d4c0: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
-0003d4d0: 696e 206c 6873 5f64 6174 615f 7661 7273  in lhs_data_vars
-0003d4e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003d4f0: 2020 6966 206b 2069 6e20 7268 735f 6461    if k in rhs_da
-0003d500: 7461 5f76 6172 733a 0a20 2020 2020 2020  ta_vars:.       
-0003d510: 2020 2020 2020 2020 2020 2020 2064 6573               des
-0003d520: 745f 7661 7273 5b6b 5d20 3d20 6628 6c68  t_vars[k] = f(lh
-0003d530: 735f 7661 7273 5b6b 5d2c 2072 6873 5f76  s_vars[k], rhs_v
-0003d540: 6172 735b 6b5d 290a 2020 2020 2020 2020  ars[k]).        
-0003d550: 2020 2020 2020 2020 656c 6966 206a 6f69          elif joi
-0003d560: 6e20 696e 205b 226c 6566 7422 2c20 226f  n in ["left", "o
-0003d570: 7574 6572 225d 3a0a 2020 2020 2020 2020  uter"]:.        
-0003d580: 2020 2020 2020 2020 2020 2020 6465 7374              dest
-0003d590: 5f76 6172 735b 6b5d 203d 2066 286c 6873  _vars[k] = f(lhs
-0003d5a0: 5f76 6172 735b 6b5d 2c20 6e70 2e6e 616e  _vars[k], np.nan
-0003d5b0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-0003d5c0: 7220 6b20 696e 2072 6873 5f64 6174 615f  r k in rhs_data_
-0003d5d0: 7661 7273 3a0a 2020 2020 2020 2020 2020  vars:.          
-0003d5e0: 2020 2020 2020 6966 206b 206e 6f74 2069        if k not i
-0003d5f0: 6e20 6465 7374 5f76 6172 7320 616e 6420  n dest_vars and 
-0003d600: 6a6f 696e 2069 6e20 5b22 7269 6768 7422  join in ["right"
-0003d610: 2c20 226f 7574 6572 225d 3a0a 2020 2020  , "outer"]:.    
-0003d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d630: 6465 7374 5f76 6172 735b 6b5d 203d 2066  dest_vars[k] = f
-0003d640: 2872 6873 5f76 6172 735b 6b5d 2c20 6e70  (rhs_vars[k], np
-0003d650: 2e6e 616e 290a 2020 2020 2020 2020 2020  .nan).          
-0003d660: 2020 7265 7475 726e 2064 6573 745f 7661    return dest_va
-0003d670: 7273 0a0a 2020 2020 2020 2020 6966 2075  rs..        if u
-0003d680: 7469 6c73 2e69 735f 6469 6374 5f6c 696b  tils.is_dict_lik
-0003d690: 6528 6f74 6865 7229 2061 6e64 206e 6f74  e(other) and not
-0003d6a0: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
-0003d6b0: 722c 2044 6174 6173 6574 293a 0a20 2020  r, Dataset):.   
-0003d6c0: 2020 2020 2020 2020 2023 2063 616e 2774           # can't
-0003d6d0: 2075 7365 206f 7572 2073 686f 7274 6375   use our shortcu
-0003d6e0: 7420 6f66 2064 6f69 6e67 2074 6865 2062  t of doing the b
-0003d6f0: 696e 6172 7920 6f70 6572 6174 696f 6e20  inary operation 
-0003d700: 7769 7468 0a20 2020 2020 2020 2020 2020  with.           
-0003d710: 2023 2056 6172 6961 626c 6520 6f62 6a65   # Variable obje
-0003d720: 6374 732c 2073 6f20 6170 706c 7920 6f76  cts, so apply ov
-0003d730: 6572 206f 7572 2064 6174 6120 7661 7273  er our data vars
-0003d740: 2069 6e73 7465 6164 2e0a 2020 2020 2020   instead..      
-0003d750: 2020 2020 2020 6e65 775f 6461 7461 5f76        new_data_v
-0003d760: 6172 7320 3d20 6170 706c 795f 6f76 6572  ars = apply_over
-0003d770: 5f62 6f74 6828 0a20 2020 2020 2020 2020  _both(.         
-0003d780: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
-0003d790: 5f76 6172 732c 206f 7468 6572 2c20 7365  _vars, other, se
-0003d7a0: 6c66 2e64 6174 615f 7661 7273 2c20 6f74  lf.data_vars, ot
-0003d7b0: 6865 720a 2020 2020 2020 2020 2020 2020  her.            
-0003d7c0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0003d7d0: 7475 726e 2074 7970 6528 7365 6c66 2928  turn type(self)(
-0003d7e0: 6e65 775f 6461 7461 5f76 6172 7329 0a0a  new_data_vars)..
-0003d7f0: 2020 2020 2020 2020 6f74 6865 725f 636f          other_co
-0003d800: 6f72 6473 3a20 436f 6f72 6469 6e61 7465  ords: Coordinate
-0003d810: 7320 7c20 4e6f 6e65 203d 2067 6574 6174  s | None = getat
-0003d820: 7472 286f 7468 6572 2c20 2263 6f6f 7264  tr(other, "coord
-0003d830: 7322 2c20 4e6f 6e65 290a 2020 2020 2020  s", None).      
-0003d840: 2020 6473 203d 2073 656c 662e 636f 6f72    ds = self.coor
-0003d850: 6473 2e6d 6572 6765 286f 7468 6572 5f63  ds.merge(other_c
-0003d860: 6f6f 7264 7329 0a0a 2020 2020 2020 2020  oords)..        
-0003d870: 6966 2069 7369 6e73 7461 6e63 6528 6f74  if isinstance(ot
-0003d880: 6865 722c 2044 6174 6173 6574 293a 0a20  her, Dataset):. 
-0003d890: 2020 2020 2020 2020 2020 206e 6577 5f76             new_v
-0003d8a0: 6172 7320 3d20 6170 706c 795f 6f76 6572  ars = apply_over
-0003d8b0: 5f62 6f74 6828 0a20 2020 2020 2020 2020  _both(.         
-0003d8c0: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
-0003d8d0: 5f76 6172 732c 206f 7468 6572 2e64 6174  _vars, other.dat
-0003d8e0: 615f 7661 7273 2c20 7365 6c66 2e76 6172  a_vars, self.var
-0003d8f0: 6961 626c 6573 2c20 6f74 6865 722e 7661  iables, other.va
-0003d900: 7269 6162 6c65 730a 2020 2020 2020 2020  riables.        
-0003d910: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
-0003d920: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0003d930: 6f74 6865 725f 7661 7269 6162 6c65 203d  other_variable =
-0003d940: 2067 6574 6174 7472 286f 7468 6572 2c20   getattr(other, 
-0003d950: 2276 6172 6961 626c 6522 2c20 6f74 6865  "variable", othe
-0003d960: 7229 0a20 2020 2020 2020 2020 2020 206e  r).            n
-0003d970: 6577 5f76 6172 7320 3d20 7b6b 3a20 6628  ew_vars = {k: f(
-0003d980: 7365 6c66 2e76 6172 6961 626c 6573 5b6b  self.variables[k
-0003d990: 5d2c 206f 7468 6572 5f76 6172 6961 626c  ], other_variabl
-0003d9a0: 6529 2066 6f72 206b 2069 6e20 7365 6c66  e) for k in self
-0003d9b0: 2e64 6174 615f 7661 7273 7d0a 2020 2020  .data_vars}.    
-0003d9c0: 2020 2020 6473 2e5f 7661 7269 6162 6c65      ds._variable
-0003d9d0: 732e 7570 6461 7465 286e 6577 5f76 6172  s.update(new_var
-0003d9e0: 7329 0a20 2020 2020 2020 2064 732e 5f64  s).        ds._d
-0003d9f0: 696d 7320 3d20 6361 6c63 756c 6174 655f  ims = calculate_
-0003da00: 6469 6d65 6e73 696f 6e73 2864 732e 5f76  dimensions(ds._v
-0003da10: 6172 6961 626c 6573 290a 2020 2020 2020  ariables).      
-0003da20: 2020 7265 7475 726e 2064 730a 0a20 2020    return ds..   
-0003da30: 2064 6566 205f 636f 7079 5f61 7474 7273   def _copy_attrs
-0003da40: 5f66 726f 6d28 7365 6c66 2c20 6f74 6865  _from(self, othe
-0003da50: 7229 3a0a 2020 2020 2020 2020 7365 6c66  r):.        self
-0003da60: 2e61 7474 7273 203d 206f 7468 6572 2e61  .attrs = other.a
-0003da70: 7474 7273 0a20 2020 2020 2020 2066 6f72  ttrs.        for
-0003da80: 2076 2069 6e20 6f74 6865 722e 7661 7269   v in other.vari
-0003da90: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
-0003daa0: 2020 2069 6620 7620 696e 2073 656c 662e     if v in self.
-0003dab0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-0003dac0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003dad0: 7661 7269 6162 6c65 735b 765d 2e61 7474  variables[v].att
-0003dae0: 7273 203d 206f 7468 6572 2e76 6172 6961  rs = other.varia
-0003daf0: 626c 6573 5b76 5d2e 6174 7472 730a 0a20  bles[v].attrs.. 
-0003db00: 2020 2064 6566 2064 6966 6628 0a20 2020     def diff(.   
-0003db10: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-0003db20: 6173 6574 2c0a 2020 2020 2020 2020 6469  aset,.        di
-0003db30: 6d3a 2048 6173 6861 626c 652c 0a20 2020  m: Hashable,.   
-0003db40: 2020 2020 206e 3a20 696e 7420 3d20 312c       n: int = 1,
-0003db50: 0a20 2020 2020 2020 206c 6162 656c 3a20  .        label: 
-0003db60: 4c69 7465 7261 6c5b 2275 7070 6572 222c  Literal["upper",
-0003db70: 2022 6c6f 7765 7222 5d20 3d20 2275 7070   "lower"] = "upp
-0003db80: 6572 222c 0a20 2020 2029 202d 3e20 545f  er",.    ) -> T_
-0003db90: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-0003dba0: 2022 2222 4361 6c63 756c 6174 6520 7468   """Calculate th
-0003dbb0: 6520 6e2d 7468 206f 7264 6572 2064 6973  e n-th order dis
-0003dbc0: 6372 6574 6520 6469 6666 6572 656e 6365  crete difference
-0003dbd0: 2061 6c6f 6e67 2067 6976 656e 2061 7869   along given axi
-0003dbe0: 732e 0a0a 2020 2020 2020 2020 5061 7261  s...        Para
-0003dbf0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-0003dc00: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-0003dc10: 2020 6469 6d20 3a20 4861 7368 6162 6c65    dim : Hashable
-0003dc20: 0a20 2020 2020 2020 2020 2020 2044 696d  .            Dim
-0003dc30: 656e 7369 6f6e 206f 7665 7220 7768 6963  ension over whic
-0003dc40: 6820 746f 2063 616c 6375 6c61 7465 2074  h to calculate t
-0003dc50: 6865 2066 696e 6974 6520 6469 6666 6572  he finite differ
-0003dc60: 656e 6365 2e0a 2020 2020 2020 2020 6e20  ence..        n 
-0003dc70: 3a20 696e 742c 2064 6566 6175 6c74 3a20  : int, default: 
-0003dc80: 310a 2020 2020 2020 2020 2020 2020 5468  1.            Th
-0003dc90: 6520 6e75 6d62 6572 206f 6620 7469 6d65  e number of time
-0003dca0: 7320 7661 6c75 6573 2061 7265 2064 6966  s values are dif
-0003dcb0: 6665 7265 6e63 6564 2e0a 2020 2020 2020  ferenced..      
-0003dcc0: 2020 6c61 6265 6c20 3a20 7b22 7570 7065    label : {"uppe
-0003dcd0: 7222 2c20 226c 6f77 6572 227d 2c20 6465  r", "lower"}, de
-0003dce0: 6661 756c 743a 2022 7570 7065 7222 0a20  fault: "upper". 
-0003dcf0: 2020 2020 2020 2020 2020 2054 6865 206e             The n
-0003dd00: 6577 2063 6f6f 7264 696e 6174 6520 696e  ew coordinate in
-0003dd10: 2064 696d 656e 7369 6f6e 2060 6064 696d   dimension ``dim
-0003dd20: 6060 2077 696c 6c20 6861 7665 2074 6865  `` will have the
-0003dd30: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-0003dd40: 7565 7320 6f66 2065 6974 6865 7220 7468  ues of either th
-0003dd50: 6520 6d69 6e75 656e 6427 7320 6f72 2073  e minuend's or s
-0003dd60: 7562 7472 6168 656e 6427 7320 636f 6f72  ubtrahend's coor
-0003dd70: 6469 6e61 7465 0a20 2020 2020 2020 2020  dinate.         
-0003dd80: 2020 2066 6f72 2076 616c 7565 7320 2775     for values 'u
-0003dd90: 7070 6572 2720 616e 6420 276c 6f77 6572  pper' and 'lower
-0003dda0: 272c 2072 6573 7065 6374 6976 656c 792e  ', respectively.
-0003ddb0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0003ddc0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0003ddd0: 2d0a 2020 2020 2020 2020 6469 6666 6572  -.        differ
-0003dde0: 656e 6365 203a 2044 6174 6173 6574 0a20  ence : Dataset. 
-0003ddf0: 2020 2020 2020 2020 2020 2054 6865 206e             The n
-0003de00: 2d74 6820 6f72 6465 7220 6669 6e69 7465  -th order finite
-0003de10: 2064 6966 6665 7265 6e63 6520 6f66 2074   difference of t
-0003de20: 6869 7320 6f62 6a65 6374 2e0a 0a20 2020  his object...   
-0003de30: 2020 2020 204e 6f74 6573 0a20 2020 2020       Notes.     
-0003de40: 2020 202d 2d2d 2d2d 0a20 2020 2020 2020     -----.       
-0003de50: 2060 6e60 206d 6174 6368 6573 206e 756d   `n` matches num
-0003de60: 7079 2773 2062 6568 6176 696f 7220 616e  py's behavior an
-0003de70: 6420 6973 2064 6966 6665 7265 6e74 2066  d is different f
-0003de80: 726f 6d20 7061 6e64 6173 2720 6669 7273  rom pandas' firs
-0003de90: 7420 6172 6775 6d65 6e74 206e 616d 6564  t argument named
-0003dea0: 0a20 2020 2020 2020 2060 7065 7269 6f64  .        `period
-0003deb0: 7360 2e0a 0a20 2020 2020 2020 2045 7861  s`...        Exa
-0003dec0: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
-0003ded0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
-0003dee0: 3e3e 2064 7320 3d20 7872 2e44 6174 6173  >> ds = xr.Datas
-0003def0: 6574 287b 2266 6f6f 223a 2028 2278 222c  et({"foo": ("x",
-0003df00: 205b 352c 2035 2c20 362c 2036 5d29 7d29   [5, 5, 6, 6])})
-0003df10: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
-0003df20: 6469 6666 2822 7822 290a 2020 2020 2020  diff("x").      
-0003df30: 2020 3c78 6172 7261 792e 4461 7461 7365    <xarray.Datase
-0003df40: 743e 0a20 2020 2020 2020 2044 696d 656e  t>.        Dimen
-0003df50: 7369 6f6e 733a 2020 2878 3a20 3329 0a20  sions:  (x: 3). 
-0003df60: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
-0003df70: 7320 7769 7468 6f75 7420 636f 6f72 6469  s without coordi
-0003df80: 6e61 7465 733a 2078 0a20 2020 2020 2020  nates: x.       
-0003df90: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
-0003dfa0: 0a20 2020 2020 2020 2020 2020 2066 6f6f  .            foo
-0003dfb0: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
-0003dfc0: 3020 3120 300a 2020 2020 2020 2020 3e3e  0 1 0.        >>
-0003dfd0: 3e20 6473 2e64 6966 6628 2278 222c 2032  > ds.diff("x", 2
-0003dfe0: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
-0003dff0: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-0003e000: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-0003e010: 2878 3a20 3229 0a20 2020 2020 2020 2044  (x: 2).        D
-0003e020: 696d 656e 7369 6f6e 7320 7769 7468 6f75  imensions withou
-0003e030: 7420 636f 6f72 6469 6e61 7465 733a 2078  t coordinates: x
-0003e040: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-0003e050: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-0003e060: 2020 2020 2066 6f6f 2020 2020 2020 2878       foo      (x
-0003e070: 2920 696e 7436 3420 3120 2d31 0a0a 2020  ) int64 1 -1..  
-0003e080: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
-0003e090: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
-0003e0a0: 2020 2020 2020 2020 4461 7461 7365 742e          Dataset.
-0003e0b0: 6469 6666 6572 656e 7469 6174 650a 2020  differentiate.  
-0003e0c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0003e0d0: 2020 6966 206e 203d 3d20 303a 0a20 2020    if n == 0:.   
-0003e0e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0003e0f0: 7365 6c66 0a20 2020 2020 2020 2069 6620  self.        if 
-0003e100: 6e20 3c20 303a 0a20 2020 2020 2020 2020  n < 0:.         
-0003e110: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0003e120: 726f 7228 6622 6f72 6465 7220 606e 6020  ror(f"order `n` 
-0003e130: 6d75 7374 2062 6520 6e6f 6e2d 6e65 6761  must be non-nega
-0003e140: 7469 7665 2062 7574 2067 6f74 207b 6e7d  tive but got {n}
-0003e150: 2229 0a0a 2020 2020 2020 2020 2320 7072  ")..        # pr
-0003e160: 6570 6172 6520 736c 6963 6573 0a20 2020  epare slices.   
-0003e170: 2020 2020 2073 6c69 6365 5f73 7461 7274       slice_start
-0003e180: 203d 207b 6469 6d3a 2073 6c69 6365 284e   = {dim: slice(N
-0003e190: 6f6e 652c 202d 3129 7d0a 2020 2020 2020  one, -1)}.      
-0003e1a0: 2020 736c 6963 655f 656e 6420 3d20 7b64    slice_end = {d
-0003e1b0: 696d 3a20 736c 6963 6528 312c 204e 6f6e  im: slice(1, Non
-0003e1c0: 6529 7d0a 0a20 2020 2020 2020 2023 2070  e)}..        # p
-0003e1d0: 7265 7061 7265 206e 6577 2063 6f6f 7264  repare new coord
-0003e1e0: 696e 6174 650a 2020 2020 2020 2020 6966  inate.        if
-0003e1f0: 206c 6162 656c 203d 3d20 2275 7070 6572   label == "upper
-0003e200: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
-0003e210: 6c69 6365 5f6e 6577 203d 2073 6c69 6365  lice_new = slice
-0003e220: 5f65 6e64 0a20 2020 2020 2020 2065 6c69  _end.        eli
-0003e230: 6620 6c61 6265 6c20 3d3d 2022 6c6f 7765  f label == "lowe
-0003e240: 7222 3a0a 2020 2020 2020 2020 2020 2020  r":.            
-0003e250: 736c 6963 655f 6e65 7720 3d20 736c 6963  slice_new = slic
-0003e260: 655f 7374 6172 740a 2020 2020 2020 2020  e_start.        
-0003e270: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0003e280: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0003e290: 6f72 2822 5468 6520 276c 6162 656c 2720  or("The 'label' 
-0003e2a0: 6172 6775 6d65 6e74 2068 6173 2074 6f20  argument has to 
-0003e2b0: 6265 2065 6974 6865 7220 2775 7070 6572  be either 'upper
-0003e2c0: 2720 6f72 2027 6c6f 7765 7227 2229 0a0a  ' or 'lower'")..
-0003e2d0: 2020 2020 2020 2020 696e 6465 7865 732c          indexes,
-0003e2e0: 2069 6e64 6578 5f76 6172 7320 3d20 6973   index_vars = is
-0003e2f0: 656c 5f69 6e64 6578 6573 2873 656c 662e  el_indexes(self.
-0003e300: 7869 6e64 6578 6573 2c20 736c 6963 655f  xindexes, slice_
-0003e310: 6e65 7729 0a20 2020 2020 2020 2076 6172  new).        var
-0003e320: 6961 626c 6573 203d 207b 7d0a 0a20 2020  iables = {}..   
-0003e330: 2020 2020 2066 6f72 206e 616d 652c 2076       for name, v
-0003e340: 6172 2069 6e20 7365 6c66 2e76 6172 6961  ar in self.varia
-0003e350: 626c 6573 2e69 7465 6d73 2829 3a0a 2020  bles.items():.  
-0003e360: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-0003e370: 6520 696e 2069 6e64 6578 5f76 6172 733a  e in index_vars:
-0003e380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003e390: 2076 6172 6961 626c 6573 5b6e 616d 655d   variables[name]
-0003e3a0: 203d 2069 6e64 6578 5f76 6172 735b 6e61   = index_vars[na
-0003e3b0: 6d65 5d0a 2020 2020 2020 2020 2020 2020  me].            
-0003e3c0: 656c 6966 2064 696d 2069 6e20 7661 722e  elif dim in var.
-0003e3d0: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
-0003e3e0: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
-0003e3f0: 2073 656c 662e 6461 7461 5f76 6172 733a   self.data_vars:
-0003e400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003e410: 2020 2020 2076 6172 6961 626c 6573 5b6e       variables[n
-0003e420: 616d 655d 203d 2076 6172 2e69 7365 6c28  ame] = var.isel(
-0003e430: 736c 6963 655f 656e 6429 202d 2076 6172  slice_end) - var
-0003e440: 2e69 7365 6c28 736c 6963 655f 7374 6172  .isel(slice_star
-0003e450: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-0003e460: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003e470: 2020 2020 2020 2020 2020 2020 2076 6172               var
-0003e480: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
-0003e490: 6172 2e69 7365 6c28 736c 6963 655f 6e65  ar.isel(slice_ne
-0003e4a0: 7729 0a20 2020 2020 2020 2020 2020 2065  w).            e
-0003e4b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0003e4c0: 2020 2020 2076 6172 6961 626c 6573 5b6e       variables[n
-0003e4d0: 616d 655d 203d 2076 6172 0a0a 2020 2020  ame] = var..    
-0003e4e0: 2020 2020 6469 6666 6572 656e 6365 203d      difference =
-0003e4f0: 2073 656c 662e 5f72 6570 6c61 6365 5f77   self._replace_w
-0003e500: 6974 685f 6e65 775f 6469 6d73 2876 6172  ith_new_dims(var
-0003e510: 6961 626c 6573 2c20 696e 6465 7865 733d  iables, indexes=
-0003e520: 696e 6465 7865 7329 0a0a 2020 2020 2020  indexes)..      
-0003e530: 2020 6966 206e 203e 2031 3a0a 2020 2020    if n > 1:.    
-0003e540: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-0003e550: 6966 6665 7265 6e63 652e 6469 6666 2864  ifference.diff(d
-0003e560: 696d 2c20 6e20 2d20 3129 0a20 2020 2020  im, n - 1).     
-0003e570: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003e580: 2020 2020 2072 6574 7572 6e20 6469 6666       return diff
-0003e590: 6572 656e 6365 0a0a 2020 2020 6465 6620  erence..    def 
-0003e5a0: 7368 6966 7428 0a20 2020 2020 2020 2073  shift(.        s
-0003e5b0: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
-0003e5c0: 2020 2020 2020 2020 7368 6966 7473 3a20          shifts: 
-0003e5d0: 4d61 7070 696e 675b 416e 792c 2069 6e74  Mapping[Any, int
-0003e5e0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-0003e5f0: 0a20 2020 2020 2020 2066 696c 6c5f 7661  .        fill_va
-0003e600: 6c75 653a 2041 6e79 203d 2078 7264 7479  lue: Any = xrdty
-0003e610: 7065 732e 4e41 2c0a 2020 2020 2020 2020  pes.NA,.        
-0003e620: 2a2a 7368 6966 7473 5f6b 7761 7267 733a  **shifts_kwargs:
-0003e630: 2069 6e74 2c0a 2020 2020 2920 2d3e 2054   int,.    ) -> T
-0003e640: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-0003e650: 2020 2222 2253 6869 6674 2074 6869 7320    """Shift this 
-0003e660: 6461 7461 7365 7420 6279 2061 6e20 6f66  dataset by an of
-0003e670: 6673 6574 2061 6c6f 6e67 206f 6e65 206f  fset along one o
-0003e680: 7220 6d6f 7265 2064 696d 656e 7369 6f6e  r more dimension
-0003e690: 732e 0a0a 2020 2020 2020 2020 4f6e 6c79  s...        Only
-0003e6a0: 2064 6174 6120 7661 7269 6162 6c65 7320   data variables 
-0003e6b0: 6172 6520 6d6f 7665 643b 2063 6f6f 7264  are moved; coord
-0003e6c0: 696e 6174 6573 2073 7461 7920 696e 2070  inates stay in p
-0003e6d0: 6c61 6365 2e20 5468 6973 2069 730a 2020  lace. This is.  
-0003e6e0: 2020 2020 2020 636f 6e73 6973 7465 6e74        consistent
-0003e6f0: 2077 6974 6820 7468 6520 6265 6861 7669   with the behavi
-0003e700: 6f72 206f 6620 6060 7368 6966 7460 6020  or of ``shift`` 
-0003e710: 696e 2070 616e 6461 732e 0a0a 2020 2020  in pandas...    
-0003e720: 2020 2020 5661 6c75 6573 2073 6869 6674      Values shift
-0003e730: 6564 2066 726f 6d20 6265 796f 6e64 2061  ed from beyond a
-0003e740: 7272 6179 2062 6f75 6e64 7320 7769 6c6c  rray bounds will
-0003e750: 2061 7070 6561 7220 6174 206f 6e65 2065   appear at one e
-0003e760: 6e64 206f 660a 2020 2020 2020 2020 6561  nd of.        ea
-0003e770: 6368 2064 696d 656e 7369 6f6e 2c20 7768  ch dimension, wh
-0003e780: 6963 6820 6172 6520 6669 6c6c 6564 2061  ich are filled a
-0003e790: 6363 6f72 6469 6e67 2074 6f20 6066 696c  ccording to `fil
-0003e7a0: 6c5f 7661 6c75 6560 2e20 466f 7220 7065  l_value`. For pe
-0003e7b0: 7269 6f64 6963 0a20 2020 2020 2020 206f  riodic.        o
-0003e7c0: 6666 7365 7473 2069 6e73 7465 6164 2073  ffsets instead s
-0003e7d0: 6565 2060 726f 6c6c 602e 0a0a 2020 2020  ee `roll`...    
-0003e7e0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-0003e7f0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0003e800: 2d0a 2020 2020 2020 2020 7368 6966 7473  -.        shifts
-0003e810: 203a 206d 6170 7069 6e67 206f 6620 6861   : mapping of ha
-0003e820: 7368 6162 6c65 2074 6f20 696e 740a 2020  shable to int.  
-0003e830: 2020 2020 2020 2020 2020 496e 7465 6765            Intege
-0003e840: 7220 6f66 6673 6574 2074 6f20 7368 6966  r offset to shif
-0003e850: 7420 616c 6f6e 6720 6561 6368 206f 6620  t along each of 
-0003e860: 7468 6520 6769 7665 6e20 6469 6d65 6e73  the given dimens
-0003e870: 696f 6e73 2e0a 2020 2020 2020 2020 2020  ions..          
-0003e880: 2020 506f 7369 7469 7665 206f 6666 7365    Positive offse
-0003e890: 7473 2073 6869 6674 2074 6f20 7468 6520  ts shift to the 
-0003e8a0: 7269 6768 743b 206e 6567 6174 6976 6520  right; negative 
-0003e8b0: 6f66 6673 6574 7320 7368 6966 7420 746f  offsets shift to
-0003e8c0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-0003e8d0: 206c 6566 742e 0a20 2020 2020 2020 2066   left..        f
-0003e8e0: 696c 6c5f 7661 6c75 6520 3a20 7363 616c  ill_value : scal
-0003e8f0: 6172 206f 7220 6469 6374 2d6c 696b 652c  ar or dict-like,
-0003e900: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0003e910: 2020 2020 2020 5661 6c75 6520 746f 2075        Value to u
-0003e920: 7365 2066 6f72 206e 6577 6c79 206d 6973  se for newly mis
-0003e930: 7369 6e67 2076 616c 7565 732e 2049 6620  sing values. If 
-0003e940: 6120 6469 6374 2d6c 696b 652c 206d 6170  a dict-like, map
-0003e950: 730a 2020 2020 2020 2020 2020 2020 7661  s.            va
-0003e960: 7269 6162 6c65 206e 616d 6573 2028 696e  riable names (in
-0003e970: 636c 7564 696e 6720 636f 6f72 6469 6e61  cluding coordina
-0003e980: 7465 7329 2074 6f20 6669 6c6c 2076 616c  tes) to fill val
-0003e990: 7565 732e 0a20 2020 2020 2020 202a 2a73  ues..        **s
-0003e9a0: 6869 6674 735f 6b77 6172 6773 0a20 2020  hifts_kwargs.   
-0003e9b0: 2020 2020 2020 2020 2054 6865 206b 6579           The key
-0003e9c0: 776f 7264 2061 7267 756d 656e 7473 2066  word arguments f
-0003e9d0: 6f72 6d20 6f66 2060 6073 6869 6674 7360  orm of ``shifts`
-0003e9e0: 602e 0a20 2020 2020 2020 2020 2020 204f  `..            O
-0003e9f0: 6e65 206f 6620 7368 6966 7473 206f 7220  ne of shifts or 
-0003ea00: 7368 6966 7473 5f6b 7761 7267 7320 6d75  shifts_kwargs mu
-0003ea10: 7374 2062 6520 7072 6f76 6964 6564 2e0a  st be provided..
-0003ea20: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-0003ea30: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0003ea40: 0a20 2020 2020 2020 2073 6869 6674 6564  .        shifted
-0003ea50: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
-0003ea60: 2020 2020 2020 2044 6174 6173 6574 2077         Dataset w
-0003ea70: 6974 6820 7468 6520 7361 6d65 2063 6f6f  ith the same coo
-0003ea80: 7264 696e 6174 6573 2061 6e64 2061 7474  rdinates and att
-0003ea90: 7269 6275 7465 7320 6275 7420 7368 6966  ributes but shif
-0003eaa0: 7465 6420 6461 7461 0a20 2020 2020 2020  ted data.       
-0003eab0: 2020 2020 2076 6172 6961 626c 6573 2e0a       variables..
-0003eac0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-0003ead0: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-0003eae0: 2d2d 0a20 2020 2020 2020 2072 6f6c 6c0a  --.        roll.
-0003eaf0: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-0003eb00: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0003eb10: 2d2d 0a20 2020 2020 2020 203e 3e3e 2064  --.        >>> d
-0003eb20: 7320 3d20 7872 2e44 6174 6173 6574 287b  s = xr.Dataset({
-0003eb30: 2266 6f6f 223a 2028 2278 222c 206c 6973  "foo": ("x", lis
-0003eb40: 7428 2261 6263 6465 2229 297d 290a 2020  t("abcde"))}).  
-0003eb50: 2020 2020 2020 3e3e 3e20 6473 2e73 6869        >>> ds.shi
-0003eb60: 6674 2878 3d32 290a 2020 2020 2020 2020  ft(x=2).        
-0003eb70: 3c78 6172 7261 792e 4461 7461 7365 743e  <xarray.Dataset>
-0003eb80: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
-0003eb90: 6f6e 733a 2020 2878 3a20 3529 0a20 2020  ons:  (x: 5).   
-0003eba0: 2020 2020 2044 696d 656e 7369 6f6e 7320       Dimensions 
-0003ebb0: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
-0003ebc0: 7465 733a 2078 0a20 2020 2020 2020 2044  tes: x.        D
-0003ebd0: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
-0003ebe0: 2020 2020 2020 2020 2020 2066 6f6f 2020             foo  
-0003ebf0: 2020 2020 2878 2920 6f62 6a65 6374 206e      (x) object n
-0003ec00: 616e 206e 616e 2027 6127 2027 6227 2027  an nan 'a' 'b' '
-0003ec10: 6327 0a20 2020 2020 2020 2022 2222 0a20  c'.        """. 
-0003ec20: 2020 2020 2020 2073 6869 6674 7320 3d20         shifts = 
-0003ec30: 6569 7468 6572 5f64 6963 745f 6f72 5f6b  either_dict_or_k
-0003ec40: 7761 7267 7328 7368 6966 7473 2c20 7368  wargs(shifts, sh
-0003ec50: 6966 7473 5f6b 7761 7267 732c 2022 7368  ifts_kwargs, "sh
-0003ec60: 6966 7422 290a 2020 2020 2020 2020 696e  ift").        in
-0003ec70: 7661 6c69 6420 3d20 5b6b 2066 6f72 206b  valid = [k for k
-0003ec80: 2069 6e20 7368 6966 7473 2069 6620 6b20   in shifts if k 
-0003ec90: 6e6f 7420 696e 2073 656c 662e 6469 6d73  not in self.dims
-0003eca0: 5d0a 2020 2020 2020 2020 6966 2069 6e76  ].        if inv
-0003ecb0: 616c 6964 3a0a 2020 2020 2020 2020 2020  alid:.          
-0003ecc0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0003ecd0: 6f72 2866 2264 696d 656e 7369 6f6e 7320  or(f"dimensions 
-0003ece0: 7b69 6e76 616c 6964 2172 7d20 646f 206e  {invalid!r} do n
-0003ecf0: 6f74 2065 7869 7374 2229 0a0a 2020 2020  ot exist")..    
-0003ed00: 2020 2020 7661 7269 6162 6c65 7320 3d20      variables = 
-0003ed10: 7b7d 0a20 2020 2020 2020 2066 6f72 206e  {}.        for n
-0003ed20: 616d 652c 2076 6172 2069 6e20 7365 6c66  ame, var in self
-0003ed30: 2e76 6172 6961 626c 6573 2e69 7465 6d73  .variables.items
-0003ed40: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0003ed50: 6966 206e 616d 6520 696e 2073 656c 662e  if name in self.
-0003ed60: 6461 7461 5f76 6172 733a 0a20 2020 2020  data_vars:.     
-0003ed70: 2020 2020 2020 2020 2020 2066 696c 6c5f             fill_
-0003ed80: 7661 6c75 655f 203d 2028 0a20 2020 2020  value_ = (.     
-0003ed90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0003eda0: 696c 6c5f 7661 6c75 652e 6765 7428 6e61  ill_value.get(na
-0003edb0: 6d65 2c20 7872 6474 7970 6573 2e4e 4129  me, xrdtypes.NA)
-0003edc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003edd0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0003ede0: 6365 2866 696c 6c5f 7661 6c75 652c 2064  ce(fill_value, d
-0003edf0: 6963 7429 0a20 2020 2020 2020 2020 2020  ict).           
-0003ee00: 2020 2020 2020 2020 2065 6c73 6520 6669           else fi
-0003ee10: 6c6c 5f76 616c 7565 0a20 2020 2020 2020  ll_value.       
-0003ee20: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0003ee30: 2020 2020 2020 2020 2020 2020 7661 725f              var_
-0003ee40: 7368 6966 7473 203d 207b 6b3a 2076 2066  shifts = {k: v f
-0003ee50: 6f72 206b 2c20 7620 696e 2073 6869 6674  or k, v in shift
-0003ee60: 732e 6974 656d 7328 2920 6966 206b 2069  s.items() if k i
-0003ee70: 6e20 7661 722e 6469 6d73 7d0a 2020 2020  n var.dims}.    
-0003ee80: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-0003ee90: 6162 6c65 735b 6e61 6d65 5d20 3d20 7661  ables[name] = va
-0003eea0: 722e 7368 6966 7428 6669 6c6c 5f76 616c  r.shift(fill_val
-0003eeb0: 7565 3d66 696c 6c5f 7661 6c75 655f 2c20  ue=fill_value_, 
-0003eec0: 7368 6966 7473 3d76 6172 5f73 6869 6674  shifts=var_shift
-0003eed0: 7329 0a20 2020 2020 2020 2020 2020 2065  s).            e
-0003eee0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0003eef0: 2020 2020 2076 6172 6961 626c 6573 5b6e       variables[n
-0003ef00: 616d 655d 203d 2076 6172 0a0a 2020 2020  ame] = var..    
-0003ef10: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0003ef20: 5f72 6570 6c61 6365 2876 6172 6961 626c  _replace(variabl
-0003ef30: 6573 290a 0a20 2020 2064 6566 2072 6f6c  es)..    def rol
-0003ef40: 6c28 0a20 2020 2020 2020 2073 656c 663a  l(.        self:
-0003ef50: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
-0003ef60: 2020 2020 7368 6966 7473 3a20 4d61 7070      shifts: Mapp
-0003ef70: 696e 675b 416e 792c 2069 6e74 5d20 7c20  ing[Any, int] | 
-0003ef80: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-0003ef90: 2020 2020 2072 6f6c 6c5f 636f 6f72 6473       roll_coords
-0003efa0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-0003efb0: 2020 2020 2020 2020 2a2a 7368 6966 7473          **shifts
-0003efc0: 5f6b 7761 7267 733a 2069 6e74 2c0a 2020  _kwargs: int,.  
-0003efd0: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
-0003efe0: 3a0a 2020 2020 2020 2020 2222 2252 6f6c  :.        """Rol
-0003eff0: 6c20 7468 6973 2064 6174 6173 6574 2062  l this dataset b
-0003f000: 7920 616e 206f 6666 7365 7420 616c 6f6e  y an offset alon
-0003f010: 6720 6f6e 6520 6f72 206d 6f72 6520 6469  g one or more di
-0003f020: 6d65 6e73 696f 6e73 2e0a 0a20 2020 2020  mensions...     
-0003f030: 2020 2055 6e6c 696b 6520 7368 6966 742c     Unlike shift,
-0003f040: 2072 6f6c 6c20 7472 6561 7473 2074 6865   roll treats the
-0003f050: 2067 6976 656e 2064 696d 656e 7369 6f6e   given dimension
-0003f060: 7320 6173 2070 6572 696f 6469 632c 2073  s as periodic, s
-0003f070: 6f20 7769 6c6c 206e 6f74 0a20 2020 2020  o will not.     
-0003f080: 2020 2063 7265 6174 6520 616e 7920 6d69     create any mi
-0003f090: 7373 696e 6720 7661 6c75 6573 2074 6f20  ssing values to 
-0003f0a0: 6265 2066 696c 6c65 642e 0a0a 2020 2020  be filled...    
-0003f0b0: 2020 2020 416c 736f 2075 6e6c 696b 6520      Also unlike 
-0003f0c0: 7368 6966 742c 2072 6f6c 6c20 6d61 7920  shift, roll may 
-0003f0d0: 726f 7461 7465 2061 6c6c 2076 6172 6961  rotate all varia
-0003f0e0: 626c 6573 2c20 696e 636c 7564 696e 6720  bles, including 
-0003f0f0: 636f 6f72 6469 6e61 7465 730a 2020 2020  coordinates.    
-0003f100: 2020 2020 6966 2073 7065 6369 6669 6564      if specified
-0003f110: 2e20 5468 6520 6469 7265 6374 696f 6e20  . The direction 
-0003f120: 6f66 2072 6f74 6174 696f 6e20 6973 2063  of rotation is c
-0003f130: 6f6e 7369 7374 656e 7420 7769 7468 0a20  onsistent with. 
-0003f140: 2020 2020 2020 203a 7079 3a66 756e 633a         :py:func:
-0003f150: 606e 756d 7079 2e72 6f6c 6c60 2e0a 0a20  `numpy.roll`... 
-0003f160: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-0003f170: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0003f180: 2d2d 2d2d 0a20 2020 2020 2020 2073 6869  ----.        shi
-0003f190: 6674 7320 3a20 6d61 7070 696e 6720 6f66  fts : mapping of
-0003f1a0: 2068 6173 6861 626c 6520 746f 2069 6e74   hashable to int
-0003f1b0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0003f1c0: 2020 2020 2020 2041 2064 6963 7420 7769         A dict wi
-0003f1d0: 7468 206b 6579 7320 6d61 7463 6869 6e67  th keys matching
-0003f1e0: 2064 696d 656e 7369 6f6e 7320 616e 6420   dimensions and 
-0003f1f0: 7661 6c75 6573 2067 6976 656e 0a20 2020  values given.   
-0003f200: 2020 2020 2020 2020 2062 7920 696e 7465           by inte
-0003f210: 6765 7273 2074 6f20 726f 7461 7465 2065  gers to rotate e
-0003f220: 6163 6820 6f66 2074 6865 2067 6976 656e  ach of the given
-0003f230: 2064 696d 656e 7369 6f6e 732e 2050 6f73   dimensions. Pos
-0003f240: 6974 6976 650a 2020 2020 2020 2020 2020  itive.          
-0003f250: 2020 6f66 6673 6574 7320 726f 6c6c 2074    offsets roll t
-0003f260: 6f20 7468 6520 7269 6768 743b 206e 6567  o the right; neg
-0003f270: 6174 6976 6520 6f66 6673 6574 7320 726f  ative offsets ro
-0003f280: 6c6c 2074 6f20 7468 6520 6c65 6674 2e0a  ll to the left..
-0003f290: 2020 2020 2020 2020 726f 6c6c 5f63 6f6f          roll_coo
-0003f2a0: 7264 7320 3a20 626f 6f6c 2c20 6465 6661  rds : bool, defa
-0003f2b0: 756c 743a 2046 616c 7365 0a20 2020 2020  ult: False.     
-0003f2c0: 2020 2020 2020 2049 6e64 6963 6174 6573         Indicates
-0003f2d0: 2077 6865 7468 6572 2074 6f20 726f 6c6c   whether to roll
-0003f2e0: 2074 6865 2063 6f6f 7264 696e 6174 6573   the coordinates
-0003f2f0: 2062 7920 7468 6520 6f66 6673 6574 2074   by the offset t
-0003f300: 6f6f 2e0a 2020 2020 2020 2020 2a2a 7368  oo..        **sh
-0003f310: 6966 7473 5f6b 7761 7267 7320 3a20 7b64  ifts_kwargs : {d
-0003f320: 696d 3a20 6f66 6673 6574 2c20 2e2e 2e7d  im: offset, ...}
-0003f330: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0003f340: 2020 2020 2020 2054 6865 206b 6579 776f         The keywo
-0003f350: 7264 2061 7267 756d 656e 7473 2066 6f72  rd arguments for
-0003f360: 6d20 6f66 2060 6073 6869 6674 7360 602e  m of ``shifts``.
-0003f370: 0a20 2020 2020 2020 2020 2020 204f 6e65  .            One
-0003f380: 206f 6620 7368 6966 7473 206f 7220 7368   of shifts or sh
-0003f390: 6966 7473 5f6b 7761 7267 7320 6d75 7374  ifts_kwargs must
-0003f3a0: 2062 6520 7072 6f76 6964 6564 2e0a 0a20   be provided... 
-0003f3b0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-0003f3c0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-0003f3d0: 2020 2020 2020 2072 6f6c 6c65 6420 3a20         rolled : 
-0003f3e0: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
-0003f3f0: 2020 2020 4461 7461 7365 7420 7769 7468      Dataset with
-0003f400: 2074 6865 2073 616d 6520 6174 7472 6962   the same attrib
-0003f410: 7574 6573 2062 7574 2072 6f6c 6c65 6420  utes but rolled 
-0003f420: 6461 7461 2061 6e64 2063 6f6f 7264 696e  data and coordin
-0003f430: 6174 6573 2e0a 0a20 2020 2020 2020 2053  ates...        S
-0003f440: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
-0003f450: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-0003f460: 2073 6869 6674 0a0a 2020 2020 2020 2020   shift..        
-0003f470: 4578 616d 706c 6573 0a20 2020 2020 2020  Examples.       
-0003f480: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-0003f490: 2020 3e3e 3e20 6473 203d 2078 722e 4461    >>> ds = xr.Da
-0003f4a0: 7461 7365 7428 7b22 666f 6f22 3a20 2822  taset({"foo": ("
-0003f4b0: 7822 2c20 6c69 7374 2822 6162 6364 6522  x", list("abcde"
-0003f4c0: 2929 7d2c 2063 6f6f 7264 733d 7b22 7822  ))}, coords={"x"
-0003f4d0: 3a20 6e70 2e61 7261 6e67 6528 3529 7d29  : np.arange(5)})
-0003f4e0: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
-0003f4f0: 726f 6c6c 2878 3d32 290a 2020 2020 2020  roll(x=2).      
-0003f500: 2020 3c78 6172 7261 792e 4461 7461 7365    <xarray.Datase
-0003f510: 743e 0a20 2020 2020 2020 2044 696d 656e  t>.        Dimen
-0003f520: 7369 6f6e 733a 2020 2878 3a20 3529 0a20  sions:  (x: 5). 
-0003f530: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
-0003f540: 6573 3a0a 2020 2020 2020 2020 2020 2a20  es:.          * 
-0003f550: 7820 2020 2020 2020 2028 7829 2069 6e74  x        (x) int
-0003f560: 3634 2030 2031 2032 2033 2034 0a20 2020  64 0 1 2 3 4.   
-0003f570: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
-0003f580: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-0003f590: 2066 6f6f 2020 2020 2020 2878 2920 3c55   foo      (x) <U
-0003f5a0: 3120 2764 2720 2765 2720 2761 2720 2762  1 'd' 'e' 'a' 'b
-0003f5b0: 2720 2763 270a 0a20 2020 2020 2020 203e  ' 'c'..        >
-0003f5c0: 3e3e 2064 732e 726f 6c6c 2878 3d32 2c20  >> ds.roll(x=2, 
-0003f5d0: 726f 6c6c 5f63 6f6f 7264 733d 5472 7565  roll_coords=True
-0003f5e0: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
-0003f5f0: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-0003f600: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-0003f610: 2878 3a20 3529 0a20 2020 2020 2020 2043  (x: 5).        C
-0003f620: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-0003f630: 2020 2020 2020 2a20 7820 2020 2020 2020        * x       
-0003f640: 2028 7829 2069 6e74 3634 2033 2034 2030   (x) int64 3 4 0
-0003f650: 2031 2032 0a20 2020 2020 2020 2044 6174   1 2.        Dat
-0003f660: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
-0003f670: 2020 2020 2020 2020 2066 6f6f 2020 2020           foo    
-0003f680: 2020 2878 2920 3c55 3120 2764 2720 2765    (x) <U1 'd' 'e
-0003f690: 2720 2761 2720 2762 2720 2763 270a 0a20  ' 'a' 'b' 'c'.. 
-0003f6a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0003f6b0: 2020 2073 6869 6674 7320 3d20 6569 7468     shifts = eith
-0003f6c0: 6572 5f64 6963 745f 6f72 5f6b 7761 7267  er_dict_or_kwarg
-0003f6d0: 7328 7368 6966 7473 2c20 7368 6966 7473  s(shifts, shifts
-0003f6e0: 5f6b 7761 7267 732c 2022 726f 6c6c 2229  _kwargs, "roll")
-0003f6f0: 0a20 2020 2020 2020 2069 6e76 616c 6964  .        invalid
-0003f700: 203d 205b 6b20 666f 7220 6b20 696e 2073   = [k for k in s
-0003f710: 6869 6674 7320 6966 206b 206e 6f74 2069  hifts if k not i
-0003f720: 6e20 7365 6c66 2e64 696d 735d 0a20 2020  n self.dims].   
-0003f730: 2020 2020 2069 6620 696e 7661 6c69 643a       if invalid:
-0003f740: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0003f750: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-0003f760: 6469 6d65 6e73 696f 6e73 207b 696e 7661  dimensions {inva
-0003f770: 6c69 6421 727d 2064 6f20 6e6f 7420 6578  lid!r} do not ex
-0003f780: 6973 7422 290a 0a20 2020 2020 2020 2075  ist")..        u
-0003f790: 6e72 6f6c 6c65 645f 7661 7273 3a20 7475  nrolled_vars: tu
-0003f7a0: 706c 655b 4861 7368 6162 6c65 2c20 2e2e  ple[Hashable, ..
-0003f7b0: 2e5d 0a0a 2020 2020 2020 2020 6966 2072  .]..        if r
-0003f7c0: 6f6c 6c5f 636f 6f72 6473 3a0a 2020 2020  oll_coords:.    
-0003f7d0: 2020 2020 2020 2020 696e 6465 7865 732c          indexes,
-0003f7e0: 2069 6e64 6578 5f76 6172 7320 3d20 726f   index_vars = ro
-0003f7f0: 6c6c 5f69 6e64 6578 6573 2873 656c 662e  ll_indexes(self.
-0003f800: 7869 6e64 6578 6573 2c20 7368 6966 7473  xindexes, shifts
-0003f810: 290a 2020 2020 2020 2020 2020 2020 756e  ).            un
-0003f820: 726f 6c6c 6564 5f76 6172 7320 3d20 2829  rolled_vars = ()
-0003f830: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0003f840: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-0003f850: 6573 203d 2064 6963 7428 7365 6c66 2e5f  es = dict(self._
-0003f860: 696e 6465 7865 7329 0a20 2020 2020 2020  indexes).       
-0003f870: 2020 2020 2069 6e64 6578 5f76 6172 7320       index_vars 
-0003f880: 3d20 6469 6374 2873 656c 662e 7869 6e64  = dict(self.xind
-0003f890: 6578 6573 2e76 6172 6961 626c 6573 290a  exes.variables).
-0003f8a0: 2020 2020 2020 2020 2020 2020 756e 726f              unro
-0003f8b0: 6c6c 6564 5f76 6172 7320 3d20 7475 706c  lled_vars = tupl
-0003f8c0: 6528 7365 6c66 2e63 6f6f 7264 7329 0a0a  e(self.coords)..
-0003f8d0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0003f8e0: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
-0003f8f0: 6f72 206b 2c20 7661 7220 696e 2073 656c  or k, var in sel
-0003f900: 662e 7661 7269 6162 6c65 732e 6974 656d  f.variables.item
-0003f910: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0003f920: 2069 6620 6b20 696e 2069 6e64 6578 5f76   if k in index_v
-0003f930: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
-0003f940: 2020 2020 2076 6172 6961 626c 6573 5b6b       variables[k
-0003f950: 5d20 3d20 696e 6465 785f 7661 7273 5b6b  ] = index_vars[k
-0003f960: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
-0003f970: 6966 206b 206e 6f74 2069 6e20 756e 726f  if k not in unro
-0003f980: 6c6c 6564 5f76 6172 733a 0a20 2020 2020  lled_vars:.     
-0003f990: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-0003f9a0: 626c 6573 5b6b 5d20 3d20 7661 722e 726f  bles[k] = var.ro
-0003f9b0: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
-0003f9c0: 2020 2020 2020 2020 7368 6966 7473 3d7b          shifts={
-0003f9d0: 6b3a 2073 2066 6f72 206b 2c20 7320 696e  k: s for k, s in
-0003f9e0: 2073 6869 6674 732e 6974 656d 7328 2920   shifts.items() 
-0003f9f0: 6966 206b 2069 6e20 7661 722e 6469 6d73  if k in var.dims
-0003fa00: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0003fa10: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0003fa20: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0003fa30: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
-0003fa40: 6b5d 203d 2076 6172 0a0a 2020 2020 2020  k] = var..      
-0003fa50: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
-0003fa60: 6570 6c61 6365 2876 6172 6961 626c 6573  eplace(variables
-0003fa70: 2c20 696e 6465 7865 733d 696e 6465 7865  , indexes=indexe
-0003fa80: 7329 0a0a 2020 2020 6465 6620 736f 7274  s)..    def sort
-0003fa90: 6279 280a 2020 2020 2020 2020 7365 6c66  by(.        self
-0003faa0: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
-0003fab0: 2020 2020 2076 6172 6961 626c 6573 3a20       variables: 
-0003fac0: 4861 7368 6162 6c65 207c 2044 6174 6141  Hashable | DataA
-0003fad0: 7272 6179 207c 206c 6973 745b 4861 7368  rray | list[Hash
-0003fae0: 6162 6c65 207c 2044 6174 6141 7272 6179  able | DataArray
-0003faf0: 5d2c 0a20 2020 2020 2020 2061 7363 656e  ],.        ascen
-0003fb00: 6469 6e67 3a20 626f 6f6c 203d 2054 7275  ding: bool = Tru
-0003fb10: 652c 0a20 2020 2029 202d 3e20 545f 4461  e,.    ) -> T_Da
-0003fb20: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
-0003fb30: 2222 0a20 2020 2020 2020 2053 6f72 7420  "".        Sort 
-0003fb40: 6f62 6a65 6374 2062 7920 6c61 6265 6c73  object by labels
-0003fb50: 206f 7220 7661 6c75 6573 2028 616c 6f6e   or values (alon
-0003fb60: 6720 616e 2061 7869 7329 2e0a 0a20 2020  g an axis)...   
-0003fb70: 2020 2020 2053 6f72 7473 2074 6865 2064       Sorts the d
-0003fb80: 6174 6173 6574 2c20 6569 7468 6572 2061  ataset, either a
-0003fb90: 6c6f 6e67 2073 7065 6369 6669 6564 2064  long specified d
-0003fba0: 696d 656e 7369 6f6e 732c 0a20 2020 2020  imensions,.     
-0003fbb0: 2020 206f 7220 6163 636f 7264 696e 6720     or according 
-0003fbc0: 746f 2076 616c 7565 7320 6f66 2031 2d44  to values of 1-D
-0003fbd0: 2064 6174 6161 7272 6179 7320 7468 6174   dataarrays that
-0003fbe0: 2073 6861 7265 2064 696d 656e 7369 6f6e   share dimension
-0003fbf0: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
-0003fc00: 6c6c 696e 6720 6f62 6a65 6374 2e0a 0a20  lling object... 
-0003fc10: 2020 2020 2020 2049 6620 7468 6520 696e         If the in
-0003fc20: 7075 7420 7661 7269 6162 6c65 7320 6172  put variables ar
-0003fc30: 6520 6461 7461 6172 7261 7973 2c20 7468  e dataarrays, th
-0003fc40: 656e 2074 6865 2064 6174 6161 7272 6179  en the dataarray
-0003fc50: 7320 6172 6520 616c 6967 6e65 640a 2020  s are aligned.  
-0003fc60: 2020 2020 2020 2876 6961 206c 6566 742d        (via left-
-0003fc70: 6a6f 696e 2920 746f 2074 6865 2063 616c  join) to the cal
-0003fc80: 6c69 6e67 206f 626a 6563 7420 7072 696f  ling object prio
-0003fc90: 7220 746f 2073 6f72 7469 6e67 2062 7920  r to sorting by 
-0003fca0: 6365 6c6c 2076 616c 7565 732e 0a20 2020  cell values..   
-0003fcb0: 2020 2020 204e 614e 7320 6172 6520 736f       NaNs are so
-0003fcc0: 7274 6564 2074 6f20 7468 6520 656e 642c  rted to the end,
-0003fcd0: 2066 6f6c 6c6f 7769 6e67 204e 756d 7079   following Numpy
-0003fce0: 2063 6f6e 7665 6e74 696f 6e2e 0a0a 2020   convention...  
-0003fcf0: 2020 2020 2020 4966 206d 756c 7469 706c        If multipl
-0003fd00: 6520 736f 7274 7320 616c 6f6e 6720 7468  e sorts along th
-0003fd10: 6520 7361 6d65 2064 696d 656e 7369 6f6e  e same dimension
-0003fd20: 2069 730a 2020 2020 2020 2020 6769 7665   is.        give
-0003fd30: 6e2c 206e 756d 7079 2773 206c 6578 736f  n, numpy's lexso
-0003fd40: 7274 2069 7320 7065 7266 6f72 6d65 6420  rt is performed 
-0003fd50: 616c 6f6e 6720 7468 6174 2064 696d 656e  along that dimen
-0003fd60: 7369 6f6e 3a0a 2020 2020 2020 2020 6874  sion:.        ht
-0003fd70: 7470 733a 2f2f 6e75 6d70 792e 6f72 672f  tps://numpy.org/
-0003fd80: 646f 632f 7374 6162 6c65 2f72 6566 6572  doc/stable/refer
-0003fd90: 656e 6365 2f67 656e 6572 6174 6564 2f6e  ence/generated/n
-0003fda0: 756d 7079 2e6c 6578 736f 7274 2e68 746d  umpy.lexsort.htm
-0003fdb0: 6c0a 2020 2020 2020 2020 616e 6420 7468  l.        and th
-0003fdc0: 6520 4649 5253 5420 6b65 7920 696e 2074  e FIRST key in t
-0003fdd0: 6865 2073 6571 7565 6e63 6520 6973 2075  he sequence is u
-0003fde0: 7365 6420 6173 2074 6865 2070 7269 6d61  sed as the prima
-0003fdf0: 7279 2073 6f72 7420 6b65 792c 0a20 2020  ry sort key,.   
-0003fe00: 2020 2020 2066 6f6c 6c6f 7765 6420 6279       followed by
-0003fe10: 2074 6865 2032 6e64 206b 6579 2c20 6574   the 2nd key, et
-0003fe20: 632e 0a0a 2020 2020 2020 2020 5061 7261  c...        Para
-0003fe30: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-0003fe40: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-0003fe50: 2020 7661 7269 6162 6c65 7320 3a20 4861    variables : Ha
-0003fe60: 7368 6162 6c65 2c20 4461 7461 4172 7261  shable, DataArra
-0003fe70: 792c 206f 7220 6c69 7374 206f 6620 6861  y, or list of ha
-0003fe80: 7368 6162 6c65 206f 7220 4461 7461 4172  shable or DataAr
-0003fe90: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
-0003fea0: 3144 2044 6174 6141 7272 6179 206f 626a  1D DataArray obj
-0003feb0: 6563 7473 206f 7220 6e61 6d65 2873 2920  ects or name(s) 
-0003fec0: 6f66 2031 4420 7661 7269 6162 6c65 2873  of 1D variable(s
-0003fed0: 2920 696e 0a20 2020 2020 2020 2020 2020  ) in.           
-0003fee0: 2063 6f6f 7264 732f 6461 7461 5f76 6172   coords/data_var
-0003fef0: 7320 7768 6f73 6520 7661 6c75 6573 2061  s whose values a
-0003ff00: 7265 2075 7365 6420 746f 2073 6f72 7420  re used to sort 
-0003ff10: 7468 6520 6461 7461 7365 742e 0a20 2020  the dataset..   
-0003ff20: 2020 2020 2061 7363 656e 6469 6e67 203a       ascending :
-0003ff30: 2062 6f6f 6c2c 2064 6566 6175 6c74 3a20   bool, default: 
-0003ff40: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-0003ff50: 2057 6865 7468 6572 2074 6f20 736f 7274   Whether to sort
-0003ff60: 2062 7920 6173 6365 6e64 696e 6720 6f72   by ascending or
-0003ff70: 2064 6573 6365 6e64 696e 6720 6f72 6465   descending orde
-0003ff80: 722e 0a0a 2020 2020 2020 2020 5265 7475  r...        Retu
-0003ff90: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-0003ffa0: 2d2d 2d0a 2020 2020 2020 2020 736f 7274  ---.        sort
-0003ffb0: 6564 203a 2044 6174 6173 6574 0a20 2020  ed : Dataset.   
-0003ffc0: 2020 2020 2020 2020 2041 206e 6577 2064           A new d
-0003ffd0: 6174 6173 6574 2077 6865 7265 2061 6c6c  ataset where all
-0003ffe0: 2074 6865 2073 7065 6369 6669 6564 2064   the specified d
-0003fff0: 696d 7320 6172 6520 736f 7274 6564 2062  ims are sorted b
-00040000: 7920 6469 6d0a 2020 2020 2020 2020 2020  y dim.          
-00040010: 2020 6c61 6265 6c73 2e0a 0a20 2020 2020    labels...     
-00040020: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-00040030: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00040040: 2020 2020 2044 6174 6141 7272 6179 2e73       DataArray.s
-00040050: 6f72 7462 790a 2020 2020 2020 2020 6e75  ortby.        nu
-00040060: 6d70 792e 736f 7274 0a20 2020 2020 2020  mpy.sort.       
-00040070: 2070 616e 6461 732e 736f 7274 5f76 616c   pandas.sort_val
-00040080: 7565 730a 2020 2020 2020 2020 7061 6e64  ues.        pand
-00040090: 6173 2e73 6f72 745f 696e 6465 780a 0a20  as.sort_index.. 
-000400a0: 2020 2020 2020 2045 7861 6d70 6c65 730a         Examples.
-000400b0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-000400c0: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
-000400d0: 3d20 7872 2e44 6174 6173 6574 280a 2020  = xr.Dataset(.  
-000400e0: 2020 2020 2020 2e2e 2e20 2020 2020 7b0a        ...     {.
-000400f0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-00040100: 2020 2020 2241 223a 2028 2822 7822 2c20      "A": (("x", 
-00040110: 2279 2229 2c20 5b5b 312c 2032 5d2c 205b  "y"), [[1, 2], [
-00040120: 332c 2034 5d5d 292c 0a20 2020 2020 2020  3, 4]]),.       
-00040130: 202e 2e2e 2020 2020 2020 2020 2022 4222   ...         "B"
-00040140: 3a20 2828 2278 222c 2022 7922 292c 205b  : (("x", "y"), [
-00040150: 5b35 2c20 365d 2c20 5b37 2c20 385d 5d29  [5, 6], [7, 8]])
-00040160: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-00040170: 2020 7d2c 0a20 2020 2020 2020 202e 2e2e    },.        ...
-00040180: 2020 2020 2063 6f6f 7264 733d 7b22 7822       coords={"x"
-00040190: 3a20 5b22 6222 2c20 2261 225d 2c20 2279  : ["b", "a"], "y
-000401a0: 223a 205b 312c 2030 5d7d 2c0a 2020 2020  ": [1, 0]},.    
-000401b0: 2020 2020 2e2e 2e20 290a 2020 2020 2020      ... ).      
-000401c0: 2020 3e3e 3e20 6473 203d 2064 732e 736f    >>> ds = ds.so
-000401d0: 7274 6279 2822 7822 290a 2020 2020 2020  rtby("x").      
-000401e0: 2020 3e3e 3e20 6473 0a20 2020 2020 2020    >>> ds.       
-000401f0: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-00040200: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-00040210: 696f 6e73 3a20 2028 783a 2032 2c20 793a  ions:  (x: 2, y:
-00040220: 2032 290a 2020 2020 2020 2020 436f 6f72   2).        Coor
-00040230: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-00040240: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
-00040250: 2920 3c55 3120 2761 2720 2762 270a 2020  ) <U1 'a' 'b'.  
-00040260: 2020 2020 2020 2020 2a20 7920 2020 2020          * y     
-00040270: 2020 2028 7929 2069 6e74 3634 2031 2030     (y) int64 1 0
-00040280: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-00040290: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-000402a0: 2020 2020 2041 2020 2020 2020 2020 2878       A        (x
-000402b0: 2c20 7929 2069 6e74 3634 2033 2034 2031  , y) int64 3 4 1
-000402c0: 2032 0a20 2020 2020 2020 2020 2020 2042   2.            B
-000402d0: 2020 2020 2020 2020 2878 2c20 7929 2069          (x, y) i
-000402e0: 6e74 3634 2037 2038 2035 2036 0a20 2020  nt64 7 8 5 6.   
-000402f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00040300: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
-00040310: 652e 6461 7461 6172 7261 7920 696d 706f  e.dataarray impo
-00040320: 7274 2044 6174 6141 7272 6179 0a0a 2020  rt DataArray..  
-00040330: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-00040340: 6e73 7461 6e63 6528 7661 7269 6162 6c65  nstance(variable
-00040350: 732c 206c 6973 7429 3a0a 2020 2020 2020  s, list):.      
-00040360: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
-00040370: 3d20 5b76 6172 6961 626c 6573 5d0a 2020  = [variables].  
-00040380: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00040390: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-000403a0: 7320 3d20 7661 7269 6162 6c65 730a 2020  s = variables.  
-000403b0: 2020 2020 2020 6172 7261 7973 203d 205b        arrays = [
-000403c0: 7620 6966 2069 7369 6e73 7461 6e63 6528  v if isinstance(
-000403d0: 762c 2044 6174 6141 7272 6179 2920 656c  v, DataArray) el
-000403e0: 7365 2073 656c 665b 765d 2066 6f72 2076  se self[v] for v
-000403f0: 2069 6e20 7661 7269 6162 6c65 735d 0a20   in variables]. 
-00040400: 2020 2020 2020 2061 6c69 676e 6564 5f76         aligned_v
-00040410: 6172 7320 3d20 616c 6967 6e28 7365 6c66  ars = align(self
-00040420: 2c20 2a61 7272 6179 732c 206a 6f69 6e3d  , *arrays, join=
-00040430: 226c 6566 7422 2920 2023 2074 7970 653a  "left")  # type:
-00040440: 2069 676e 6f72 655b 7479 7065 2d76 6172   ignore[type-var
-00040450: 5d0a 2020 2020 2020 2020 616c 6967 6e65  ].        aligne
-00040460: 645f 7365 6c66 3a20 545f 4461 7461 7365  d_self: T_Datase
-00040470: 7420 3d20 616c 6967 6e65 645f 7661 7273  t = aligned_vars
-00040480: 5b30 5d20 2023 2074 7970 653a 2069 676e  [0]  # type: ign
-00040490: 6f72 655b 6173 7369 676e 6d65 6e74 5d0a  ore[assignment].
-000404a0: 2020 2020 2020 2020 616c 6967 6e65 645f          aligned_
-000404b0: 6f74 6865 725f 7661 7273 3a20 7475 706c  other_vars: tupl
-000404c0: 655b 4461 7461 4172 7261 792c 202e 2e2e  e[DataArray, ...
-000404d0: 5d20 3d20 616c 6967 6e65 645f 7661 7273  ] = aligned_vars
-000404e0: 5b31 3a5d 2020 2320 7479 7065 3a20 6967  [1:]  # type: ig
-000404f0: 6e6f 7265 5b61 7373 6967 6e6d 656e 745d  nore[assignment]
-00040500: 0a20 2020 2020 2020 2076 6172 735f 6279  .        vars_by
-00040510: 5f64 696d 203d 2064 6566 6175 6c74 6469  _dim = defaultdi
-00040520: 6374 286c 6973 7429 0a20 2020 2020 2020  ct(list).       
-00040530: 2066 6f72 2064 6174 615f 6172 7261 7920   for data_array 
-00040540: 696e 2061 6c69 676e 6564 5f6f 7468 6572  in aligned_other
-00040550: 5f76 6172 733a 0a20 2020 2020 2020 2020  _vars:.         
-00040560: 2020 2069 6620 6461 7461 5f61 7272 6179     if data_array
-00040570: 2e6e 6469 6d20 213d 2031 3a0a 2020 2020  .ndim != 1:.    
-00040580: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00040590: 6520 5661 6c75 6545 7272 6f72 2822 496e  e ValueError("In
-000405a0: 7075 7420 4461 7461 4172 7261 7920 6973  put DataArray is
-000405b0: 206e 6f74 2031 2d44 2e22 290a 2020 2020   not 1-D.").    
-000405c0: 2020 2020 2020 2020 286b 6579 2c29 203d          (key,) =
-000405d0: 2064 6174 615f 6172 7261 792e 6469 6d73   data_array.dims
-000405e0: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-000405f0: 735f 6279 5f64 696d 5b6b 6579 5d2e 6170  s_by_dim[key].ap
-00040600: 7065 6e64 2864 6174 615f 6172 7261 7929  pend(data_array)
-00040610: 0a0a 2020 2020 2020 2020 696e 6469 6365  ..        indice
-00040620: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
-00040630: 6f72 206b 6579 2c20 6172 7261 7973 2069  or key, arrays i
-00040640: 6e20 7661 7273 5f62 795f 6469 6d2e 6974  n vars_by_dim.it
-00040650: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-00040660: 2020 206f 7264 6572 203d 206e 702e 6c65     order = np.le
-00040670: 7873 6f72 7428 7475 706c 6528 7265 7665  xsort(tuple(reve
-00040680: 7273 6564 2861 7272 6179 7329 2929 0a20  rsed(arrays))). 
-00040690: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
-000406a0: 6573 5b6b 6579 5d20 3d20 6f72 6465 7220  es[key] = order 
-000406b0: 6966 2061 7363 656e 6469 6e67 2065 6c73  if ascending els
-000406c0: 6520 6f72 6465 725b 3a3a 2d31 5d0a 2020  e order[::-1].  
-000406d0: 2020 2020 2020 7265 7475 726e 2061 6c69        return ali
-000406e0: 676e 6564 5f73 656c 662e 6973 656c 2869  gned_self.isel(i
-000406f0: 6e64 6963 6573 290a 0a20 2020 2064 6566  ndices)..    def
-00040700: 2071 7561 6e74 696c 6528 0a20 2020 2020   quantile(.     
-00040710: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-00040720: 6574 2c0a 2020 2020 2020 2020 713a 2041  et,.        q: A
-00040730: 7272 6179 4c69 6b65 2c0a 2020 2020 2020  rrayLike,.      
-00040740: 2020 6469 6d3a 2044 696d 7320 3d20 4e6f    dim: Dims = No
-00040750: 6e65 2c0a 2020 2020 2020 2020 6d65 7468  ne,.        meth
-00040760: 6f64 3a20 5175 616e 7469 6c65 4d65 7468  od: QuantileMeth
-00040770: 6f64 7320 3d20 226c 696e 6561 7222 2c0a  ods = "linear",.
-00040780: 2020 2020 2020 2020 6e75 6d65 7269 635f          numeric_
-00040790: 6f6e 6c79 3a20 626f 6f6c 203d 2046 616c  only: bool = Fal
-000407a0: 7365 2c0a 2020 2020 2020 2020 6b65 6570  se,.        keep
-000407b0: 5f61 7474 7273 3a20 626f 6f6c 207c 204e  _attrs: bool | N
-000407c0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-000407d0: 2020 2020 736b 6970 6e61 3a20 626f 6f6c      skipna: bool
-000407e0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-000407f0: 2020 2020 2020 2020 696e 7465 7270 6f6c          interpol
-00040800: 6174 696f 6e3a 2051 7561 6e74 696c 654d  ation: QuantileM
-00040810: 6574 686f 6473 207c 204e 6f6e 6520 3d20  ethods | None = 
-00040820: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 2054  None,.    ) -> T
-00040830: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-00040840: 2020 2222 2243 6f6d 7075 7465 2074 6865    """Compute the
-00040850: 2071 7468 2071 7561 6e74 696c 6520 6f66   qth quantile of
-00040860: 2074 6865 2064 6174 6120 616c 6f6e 6720   the data along 
-00040870: 7468 6520 7370 6563 6966 6965 6420 6469  the specified di
-00040880: 6d65 6e73 696f 6e2e 0a0a 2020 2020 2020  mension...      
-00040890: 2020 5265 7475 726e 7320 7468 6520 7174    Returns the qt
-000408a0: 6820 7175 616e 7469 6c65 7328 7329 206f  h quantiles(s) o
-000408b0: 6620 7468 6520 6172 7261 7920 656c 656d  f the array elem
-000408c0: 656e 7473 2066 6f72 2065 6163 6820 7661  ents for each va
-000408d0: 7269 6162 6c65 0a20 2020 2020 2020 2069  riable.        i
-000408e0: 6e20 7468 6520 4461 7461 7365 742e 0a0a  n the Dataset...
-000408f0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00040900: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00040910: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7120  -----.        q 
-00040920: 3a20 666c 6f61 7420 6f72 2061 7272 6179  : float or array
-00040930: 2d6c 696b 6520 6f66 2066 6c6f 6174 0a20  -like of float. 
-00040940: 2020 2020 2020 2020 2020 2051 7561 6e74             Quant
-00040950: 696c 6520 746f 2063 6f6d 7075 7465 2c20  ile to compute, 
-00040960: 7768 6963 6820 6d75 7374 2062 6520 6265  which must be be
-00040970: 7477 6565 6e20 3020 616e 6420 3120 696e  tween 0 and 1 in
-00040980: 636c 7573 6976 652e 0a20 2020 2020 2020  clusive..       
-00040990: 2064 696d 203a 2073 7472 206f 7220 4974   dim : str or It
-000409a0: 6572 6162 6c65 206f 6620 4861 7368 6162  erable of Hashab
-000409b0: 6c65 2c20 6f70 7469 6f6e 616c 0a20 2020  le, optional.   
-000409c0: 2020 2020 2020 2020 2044 696d 656e 7369           Dimensi
-000409d0: 6f6e 2873 2920 6f76 6572 2077 6869 6368  on(s) over which
-000409e0: 2074 6f20 6170 706c 7920 7175 616e 7469   to apply quanti
-000409f0: 6c65 2e0a 2020 2020 2020 2020 6d65 7468  le..        meth
-00040a00: 6f64 203a 2073 7472 2c20 6465 6661 756c  od : str, defaul
-00040a10: 743a 2022 6c69 6e65 6172 220a 2020 2020  t: "linear".    
-00040a20: 2020 2020 2020 2020 5468 6973 206f 7074          This opt
-00040a30: 696f 6e61 6c20 7061 7261 6d65 7465 7220  ional parameter 
-00040a40: 7370 6563 6966 6965 7320 7468 6520 696e  specifies the in
-00040a50: 7465 7270 6f6c 6174 696f 6e20 6d65 7468  terpolation meth
-00040a60: 6f64 2074 6f20 7573 6520 7768 656e 2074  od to use when t
-00040a70: 6865 0a20 2020 2020 2020 2020 2020 2064  he.            d
-00040a80: 6573 6972 6564 2071 7561 6e74 696c 6520  esired quantile 
-00040a90: 6c69 6573 2062 6574 7765 656e 2074 776f  lies between two
-00040aa0: 2064 6174 6120 706f 696e 7473 2e20 5468   data points. Th
-00040ab0: 6520 6f70 7469 6f6e 7320 736f 7274 6564  e options sorted
-00040ac0: 2062 7920 7468 6569 7220 520a 2020 2020   by their R.    
-00040ad0: 2020 2020 2020 2020 7479 7065 2061 7320          type as 
-00040ae0: 7375 6d6d 6172 697a 6564 2069 6e20 7468  summarized in th
-00040af0: 6520 4826 4620 7061 7065 7220 5b31 5d5f  e H&F paper [1]_
-00040b00: 2061 7265 3a0a 0a20 2020 2020 2020 2020   are:..         
-00040b10: 2020 2020 2020 2031 2e20 2269 6e76 6572         1. "inver
-00040b20: 7465 645f 6364 6622 2028 2a29 0a20 2020  ted_cdf" (*).   
-00040b30: 2020 2020 2020 2020 2020 2020 2032 2e20               2. 
-00040b40: 2261 7665 7261 6765 645f 696e 7665 7274  "averaged_invert
-00040b50: 6564 5f63 6466 2220 282a 290a 2020 2020  ed_cdf" (*).    
-00040b60: 2020 2020 2020 2020 2020 2020 332e 2022              3. "
-00040b70: 636c 6f73 6573 745f 6f62 7365 7276 6174  closest_observat
-00040b80: 696f 6e22 2028 2a29 0a20 2020 2020 2020  ion" (*).       
-00040b90: 2020 2020 2020 2020 2034 2e20 2269 6e74           4. "int
-00040ba0: 6572 706f 6c61 7465 645f 696e 7665 7274  erpolated_invert
-00040bb0: 6564 5f63 6466 2220 282a 290a 2020 2020  ed_cdf" (*).    
-00040bc0: 2020 2020 2020 2020 2020 2020 352e 2022              5. "
-00040bd0: 6861 7a65 6e22 2028 2a29 0a20 2020 2020  hazen" (*).     
-00040be0: 2020 2020 2020 2020 2020 2036 2e20 2277             6. "w
-00040bf0: 6569 6275 6c6c 2220 282a 290a 2020 2020  eibull" (*).    
-00040c00: 2020 2020 2020 2020 2020 2020 372e 2022              7. "
-00040c10: 6c69 6e65 6172 2220 2028 6465 6661 756c  linear"  (defaul
-00040c20: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00040c30: 2020 2038 2e20 226d 6564 6961 6e5f 756e     8. "median_un
-00040c40: 6269 6173 6564 2220 282a 290a 2020 2020  biased" (*).    
-00040c50: 2020 2020 2020 2020 2020 2020 392e 2022              9. "
-00040c60: 6e6f 726d 616c 5f75 6e62 6961 7365 6422  normal_unbiased"
-00040c70: 2028 2a29 0a0a 2020 2020 2020 2020 2020   (*)..          
-00040c80: 2020 5468 6520 6669 7273 7420 7468 7265    The first thre
-00040c90: 6520 6d65 7468 6f64 7320 6172 6520 6469  e methods are di
-00040ca0: 7363 6f6e 7469 756f 7573 2e20 2054 6865  scontiuous.  The
-00040cb0: 2066 6f6c 6c6f 7769 6e67 2064 6973 636f   following disco
-00040cc0: 6e74 696e 756f 7573 0a20 2020 2020 2020  ntinuous.       
-00040cd0: 2020 2020 2076 6172 6961 7469 6f6e 7320       variations 
-00040ce0: 6f66 2074 6865 2064 6566 6175 6c74 2022  of the default "
-00040cf0: 6c69 6e65 6172 2220 2837 2e29 206f 7074  linear" (7.) opt
-00040d00: 696f 6e20 6172 6520 616c 736f 2061 7661  ion are also ava
-00040d10: 696c 6162 6c65 3a0a 0a20 2020 2020 2020  ilable:..       
-00040d20: 2020 2020 2020 2020 202a 2022 6c6f 7765           * "lowe
-00040d30: 7222 0a20 2020 2020 2020 2020 2020 2020  r".             
-00040d40: 2020 202a 2022 6869 6768 6572 220a 2020     * "higher".  
-00040d50: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-00040d60: 226d 6964 706f 696e 7422 0a20 2020 2020  "midpoint".     
-00040d70: 2020 2020 2020 2020 2020 202a 2022 6e65             * "ne
-00040d80: 6172 6573 7422 0a0a 2020 2020 2020 2020  arest"..        
-00040d90: 2020 2020 5365 6520 3a70 793a 6675 6e63      See :py:func
-00040da0: 3a60 6e75 6d70 792e 7175 616e 7469 6c65  :`numpy.quantile
-00040db0: 6020 6f72 205b 315d 5f20 666f 7220 6465  ` or [1]_ for de
-00040dc0: 7461 696c 732e 2054 6865 2022 6d65 7468  tails. The "meth
-00040dd0: 6f64 2220 6172 6775 6d65 6e74 0a20 2020  od" argument.   
-00040de0: 2020 2020 2020 2020 2077 6173 2070 7265           was pre
-00040df0: 7669 6f75 736c 7920 6361 6c6c 6564 2022  viously called "
-00040e00: 696e 7465 7270 6f6c 6174 696f 6e22 2c20  interpolation", 
-00040e10: 7265 6e61 6d65 6420 696e 2061 6363 6f72  renamed in accor
-00040e20: 6461 6e63 6520 7769 7468 206e 756d 7079  dance with numpy
-00040e30: 0a20 2020 2020 2020 2020 2020 2076 6572  .            ver
-00040e40: 7369 6f6e 2031 2e32 322e 302e 0a0a 2020  sion 1.22.0...  
-00040e50: 2020 2020 2020 2020 2020 282a 2920 5468            (*) Th
-00040e60: 6573 6520 6d65 7468 6f64 7320 7265 7175  ese methods requ
-00040e70: 6972 6520 6e75 6d70 7920 7665 7273 696f  ire numpy versio
-00040e80: 6e20 312e 3232 206f 7220 6e65 7765 722e  n 1.22 or newer.
-00040e90: 0a0a 2020 2020 2020 2020 6b65 6570 5f61  ..        keep_a
-00040ea0: 7474 7273 203a 2062 6f6f 6c2c 206f 7074  ttrs : bool, opt
-00040eb0: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-00040ec0: 2020 4966 2054 7275 652c 2074 6865 2064    If True, the d
-00040ed0: 6174 6173 6574 2773 2061 7474 7269 6275  ataset's attribu
-00040ee0: 7465 7320 2860 6174 7472 7360 2920 7769  tes (`attrs`) wi
-00040ef0: 6c6c 2062 6520 636f 7069 6564 2066 726f  ll be copied fro
-00040f00: 6d0a 2020 2020 2020 2020 2020 2020 7468  m.            th
-00040f10: 6520 6f72 6967 696e 616c 206f 626a 6563  e original objec
-00040f20: 7420 746f 2074 6865 206e 6577 206f 6e65  t to the new one
-00040f30: 2e20 2049 6620 4661 6c73 6520 2864 6566  .  If False (def
-00040f40: 6175 6c74 292c 2074 6865 206e 6577 0a20  ault), the new. 
-00040f50: 2020 2020 2020 2020 2020 206f 626a 6563             objec
-00040f60: 7420 7769 6c6c 2062 6520 7265 7475 726e  t will be return
-00040f70: 6564 2077 6974 686f 7574 2061 7474 7269  ed without attri
-00040f80: 6275 7465 732e 0a20 2020 2020 2020 206e  butes..        n
-00040f90: 756d 6572 6963 5f6f 6e6c 7920 3a20 626f  umeric_only : bo
-00040fa0: 6f6c 2c20 6f70 7469 6f6e 616c 0a20 2020  ol, optional.   
-00040fb0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-00040fc0: 2c20 6f6e 6c79 2061 7070 6c79 2060 6066  , only apply ``f
-00040fd0: 756e 6360 6020 746f 2076 6172 6961 626c  unc`` to variabl
-00040fe0: 6573 2077 6974 6820 6120 6e75 6d65 7269  es with a numeri
-00040ff0: 6320 6474 7970 652e 0a20 2020 2020 2020  c dtype..       
-00041000: 2073 6b69 706e 6120 3a20 626f 6f6c 2c20   skipna : bool, 
-00041010: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00041020: 2020 2020 2049 6620 5472 7565 2c20 736b       If True, sk
-00041030: 6970 206d 6973 7369 6e67 2076 616c 7565  ip missing value
-00041040: 7320 2861 7320 6d61 726b 6564 2062 7920  s (as marked by 
-00041050: 4e61 4e29 2e20 4279 2064 6566 6175 6c74  NaN). By default
-00041060: 2c20 6f6e 6c79 0a20 2020 2020 2020 2020  , only.         
-00041070: 2020 2073 6b69 7073 206d 6973 7369 6e67     skips missing
-00041080: 2076 616c 7565 7320 666f 7220 666c 6f61   values for floa
-00041090: 7420 6474 7970 6573 3b20 6f74 6865 7220  t dtypes; other 
-000410a0: 6474 7970 6573 2065 6974 6865 7220 646f  dtypes either do
-000410b0: 206e 6f74 0a20 2020 2020 2020 2020 2020   not.           
-000410c0: 2068 6176 6520 6120 7365 6e74 696e 656c   have a sentinel
-000410d0: 206d 6973 7369 6e67 2076 616c 7565 2028   missing value (
-000410e0: 696e 7429 206f 7220 736b 6970 6e61 3d54  int) or skipna=T
-000410f0: 7275 6520 6861 7320 6e6f 7420 6265 656e  rue has not been
-00041100: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
-00041110: 6c65 6d65 6e74 6564 2028 6f62 6a65 6374  lemented (object
-00041120: 2c20 6461 7465 7469 6d65 3634 206f 7220  , datetime64 or 
-00041130: 7469 6d65 6465 6c74 6136 3429 2e0a 0a20  timedelta64)... 
-00041140: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-00041150: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-00041160: 2020 2020 2020 2071 7561 6e74 696c 6573         quantiles
-00041170: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
-00041180: 2020 2020 2020 2049 6620 6071 6020 6973         If `q` is
-00041190: 2061 2073 696e 676c 6520 7175 616e 7469   a single quanti
-000411a0: 6c65 2c20 7468 656e 2074 6865 2072 6573  le, then the res
-000411b0: 756c 7420 6973 2061 2073 6361 6c61 7220  ult is a scalar 
-000411c0: 666f 7220 6561 6368 0a20 2020 2020 2020  for each.       
-000411d0: 2020 2020 2076 6172 6961 626c 6520 696e       variable in
-000411e0: 2064 6174 615f 7661 7273 2e20 4966 206d   data_vars. If m
-000411f0: 756c 7469 706c 6520 7065 7263 656e 7469  ultiple percenti
-00041200: 6c65 7320 6172 6520 6769 7665 6e2c 2066  les are given, f
-00041210: 6972 7374 0a20 2020 2020 2020 2020 2020  irst.           
-00041220: 2061 7869 7320 6f66 2074 6865 2072 6573   axis of the res
-00041230: 756c 7420 636f 7272 6573 706f 6e64 7320  ult corresponds 
-00041240: 746f 2074 6865 2071 7561 6e74 696c 6520  to the quantile 
-00041250: 616e 6420 6120 7175 616e 7469 6c65 0a20  and a quantile. 
-00041260: 2020 2020 2020 2020 2020 2064 696d 656e             dimen
-00041270: 7369 6f6e 2069 7320 6164 6465 6420 746f  sion is added to
-00041280: 2074 6865 2072 6574 7572 6e20 4461 7461   the return Data
-00041290: 7365 742e 2054 6865 206f 7468 6572 2064  set. The other d
-000412a0: 696d 656e 7369 6f6e 7320 6172 650a 2020  imensions are.  
-000412b0: 2020 2020 2020 2020 2020 7468 6520 6469            the di
-000412c0: 6d65 6e73 696f 6e73 2074 6861 7420 7265  mensions that re
-000412d0: 6d61 696e 2061 6674 6572 2074 6865 2072  main after the r
-000412e0: 6564 7563 7469 6f6e 206f 6620 7468 6520  eduction of the 
-000412f0: 6172 7261 792e 0a0a 2020 2020 2020 2020  array...        
-00041300: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-00041310: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00041320: 2020 6e75 6d70 792e 6e61 6e71 7561 6e74    numpy.nanquant
-00041330: 696c 652c 206e 756d 7079 2e71 7561 6e74  ile, numpy.quant
-00041340: 696c 652c 2070 616e 6461 732e 5365 7269  ile, pandas.Seri
-00041350: 6573 2e71 7561 6e74 696c 652c 2044 6174  es.quantile, Dat
-00041360: 6141 7272 6179 2e71 7561 6e74 696c 650a  aArray.quantile.
-00041370: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-00041380: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00041390: 2d2d 0a20 2020 2020 2020 203e 3e3e 2064  --.        >>> d
-000413a0: 7320 3d20 7872 2e44 6174 6173 6574 280a  s = xr.Dataset(.
-000413b0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-000413c0: 7b22 6122 3a20 2828 2278 222c 2022 7922  {"a": (("x", "y"
-000413d0: 292c 205b 5b30 2e37 2c20 342e 322c 2039  ), [[0.7, 4.2, 9
-000413e0: 2e34 2c20 312e 355d 2c20 5b36 2e35 2c20  .4, 1.5], [6.5, 
-000413f0: 372e 332c 2032 2e36 2c20 312e 395d 5d29  7.3, 2.6, 1.9]])
-00041400: 7d2c 0a20 2020 2020 2020 202e 2e2e 2020  },.        ...  
-00041410: 2020 2063 6f6f 7264 733d 7b22 7822 3a20     coords={"x": 
-00041420: 5b37 2c20 395d 2c20 2279 223a 205b 312c  [7, 9], "y": [1,
-00041430: 2031 2e35 2c20 322c 2032 2e35 5d7d 2c0a   1.5, 2, 2.5]},.
-00041440: 2020 2020 2020 2020 2e2e 2e20 290a 2020          ... ).  
-00041450: 2020 2020 2020 3e3e 3e20 6473 2e71 7561        >>> ds.qua
-00041460: 6e74 696c 6528 3029 2020 2320 6f72 2064  ntile(0)  # or d
-00041470: 732e 7175 616e 7469 6c65 2830 2c20 6469  s.quantile(0, di
-00041480: 6d3d 2e2e 2e29 0a20 2020 2020 2020 203c  m=...).        <
-00041490: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
-000414a0: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-000414b0: 6e73 3a20 2020 2829 0a20 2020 2020 2020  ns:   ().       
-000414c0: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
-000414d0: 2020 2020 2020 2020 2020 7175 616e 7469            quanti
-000414e0: 6c65 2020 666c 6f61 7436 3420 302e 300a  le  float64 0.0.
-000414f0: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-00041500: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-00041510: 2020 2020 6120 2020 2020 2020 2020 666c      a         fl
-00041520: 6f61 7436 3420 302e 370a 2020 2020 2020  oat64 0.7.      
-00041530: 2020 3e3e 3e20 6473 2e71 7561 6e74 696c    >>> ds.quantil
-00041540: 6528 302c 2064 696d 3d22 7822 290a 2020  e(0, dim="x").  
-00041550: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-00041560: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-00041570: 696d 656e 7369 6f6e 733a 2020 2028 793a  imensions:   (y:
-00041580: 2034 290a 2020 2020 2020 2020 436f 6f72   4).        Coor
-00041590: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-000415a0: 2020 202a 2079 2020 2020 2020 2020 2028     * y         (
-000415b0: 7929 2066 6c6f 6174 3634 2031 2e30 2031  y) float64 1.0 1
-000415c0: 2e35 2032 2e30 2032 2e35 0a20 2020 2020  .5 2.0 2.5.     
-000415d0: 2020 2020 2020 2071 7561 6e74 696c 6520         quantile 
-000415e0: 2066 6c6f 6174 3634 2030 2e30 0a20 2020   float64 0.0.   
-000415f0: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
-00041600: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-00041610: 2061 2020 2020 2020 2020 2028 7929 2066   a         (y) f
-00041620: 6c6f 6174 3634 2030 2e37 2034 2e32 2032  loat64 0.7 4.2 2
-00041630: 2e36 2031 2e35 0a20 2020 2020 2020 203e  .6 1.5.        >
-00041640: 3e3e 2064 732e 7175 616e 7469 6c65 285b  >> ds.quantile([
-00041650: 302c 2030 2e35 2c20 315d 290a 2020 2020  0, 0.5, 1]).    
-00041660: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
-00041670: 7365 743e 0a20 2020 2020 2020 2044 696d  set>.        Dim
-00041680: 656e 7369 6f6e 733a 2020 2028 7175 616e  ensions:   (quan
-00041690: 7469 6c65 3a20 3329 0a20 2020 2020 2020  tile: 3).       
-000416a0: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
-000416b0: 2020 2020 2020 2020 2a20 7175 616e 7469          * quanti
-000416c0: 6c65 2020 2871 7561 6e74 696c 6529 2066  le  (quantile) f
-000416d0: 6c6f 6174 3634 2030 2e30 2030 2e35 2031  loat64 0.0 0.5 1
-000416e0: 2e30 0a20 2020 2020 2020 2044 6174 6120  .0.        Data 
-000416f0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-00041700: 2020 2020 2020 2061 2020 2020 2020 2020         a        
-00041710: 2028 7175 616e 7469 6c65 2920 666c 6f61   (quantile) floa
-00041720: 7436 3420 302e 3720 332e 3420 392e 340a  t64 0.7 3.4 9.4.
-00041730: 2020 2020 2020 2020 3e3e 3e20 6473 2e71          >>> ds.q
-00041740: 7561 6e74 696c 6528 5b30 2c20 302e 352c  uantile([0, 0.5,
-00041750: 2031 5d2c 2064 696d 3d22 7822 290a 2020   1], dim="x").  
-00041760: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-00041770: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-00041780: 696d 656e 7369 6f6e 733a 2020 2028 7175  imensions:   (qu
-00041790: 616e 7469 6c65 3a20 332c 2079 3a20 3429  antile: 3, y: 4)
-000417a0: 0a20 2020 2020 2020 2043 6f6f 7264 696e  .        Coordin
-000417b0: 6174 6573 3a0a 2020 2020 2020 2020 2020  ates:.          
-000417c0: 2a20 7920 2020 2020 2020 2020 2879 2920  * y         (y) 
-000417d0: 666c 6f61 7436 3420 312e 3020 312e 3520  float64 1.0 1.5 
-000417e0: 322e 3020 322e 350a 2020 2020 2020 2020  2.0 2.5.        
-000417f0: 2020 2a20 7175 616e 7469 6c65 2020 2871    * quantile  (q
-00041800: 7561 6e74 696c 6529 2066 6c6f 6174 3634  uantile) float64
-00041810: 2030 2e30 2030 2e35 2031 2e30 0a20 2020   0.0 0.5 1.0.   
-00041820: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
-00041830: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-00041840: 2061 2020 2020 2020 2020 2028 7175 616e   a         (quan
-00041850: 7469 6c65 2c20 7929 2066 6c6f 6174 3634  tile, y) float64
-00041860: 2030 2e37 2034 2e32 2032 2e36 2031 2e35   0.7 4.2 2.6 1.5
-00041870: 2033 2e36 202e 2e2e 2031 2e37 2036 2e35   3.6 ... 1.7 6.5
-00041880: 2037 2e33 2039 2e34 2031 2e39 0a0a 2020   7.3 9.4 1.9..  
-00041890: 2020 2020 2020 5265 6665 7265 6e63 6573        References
-000418a0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-000418b0: 2d2d 2d0a 2020 2020 2020 2020 2e2e 205b  ---.        .. [
-000418c0: 315d 2052 2e20 4a2e 2048 796e 646d 616e  1] R. J. Hyndman
-000418d0: 2061 6e64 2059 2e20 4661 6e2c 0a20 2020   and Y. Fan,.   
-000418e0: 2020 2020 2020 2020 2253 616d 706c 6520          "Sample 
-000418f0: 7175 616e 7469 6c65 7320 696e 2073 7461  quantiles in sta
-00041900: 7469 7374 6963 616c 2070 6163 6b61 6765  tistical package
-00041910: 732c 220a 2020 2020 2020 2020 2020 2054  s,".           T
-00041920: 6865 2041 6d65 7269 6361 6e20 5374 6174  he American Stat
-00041930: 6973 7469 6369 616e 2c20 3530 2834 292c  istician, 50(4),
-00041940: 2070 702e 2033 3631 2d33 3635 2c20 3139   pp. 361-365, 19
-00041950: 3936 0a20 2020 2020 2020 2022 2222 0a0a  96.        """..
-00041960: 2020 2020 2020 2020 2320 696e 7465 7270          # interp
-00041970: 6f6c 6174 696f 6e20 7265 6e61 6d65 6420  olation renamed 
-00041980: 746f 206d 6574 686f 6420 696e 2076 6572  to method in ver
-00041990: 7369 6f6e 2030 2e32 312e 300a 2020 2020  sion 0.21.0.    
-000419a0: 2020 2020 2320 6368 6563 6b20 6865 7265      # check here
-000419b0: 2061 6e64 2069 6e20 7661 7269 6162 6c65   and in variable
-000419c0: 2074 6f20 6176 6f69 6420 7265 7065 6174   to avoid repeat
-000419d0: 6564 2077 6172 6e69 6e67 730a 2020 2020  ed warnings.    
-000419e0: 2020 2020 6966 2069 6e74 6572 706f 6c61      if interpola
-000419f0: 7469 6f6e 2069 7320 6e6f 7420 4e6f 6e65  tion is not None
-00041a00: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
-00041a10: 726e 696e 6773 2e77 6172 6e28 0a20 2020  rnings.warn(.   
-00041a20: 2020 2020 2020 2020 2020 2020 2022 5468               "Th
-00041a30: 6520 6069 6e74 6572 706f 6c61 7469 6f6e  e `interpolation
-00041a40: 6020 6172 6775 6d65 6e74 2074 6f20 7175  ` argument to qu
-00041a50: 616e 7469 6c65 2077 6173 2072 656e 616d  antile was renam
-00041a60: 6564 2074 6f20 606d 6574 686f 6460 2e22  ed to `method`."
-00041a70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00041a80: 2020 4675 7475 7265 5761 726e 696e 672c    FutureWarning,
-00041a90: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00041aa0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00041ab0: 6574 686f 6420 213d 2022 6c69 6e65 6172  ethod != "linear
-00041ac0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00041ad0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-00041ae0: 6f72 2822 4361 6e6e 6f74 2070 6173 7320  or("Cannot pass 
-00041af0: 696e 7465 7270 6f6c 6174 696f 6e20 616e  interpolation an
-00041b00: 6420 6d65 7468 6f64 206b 6579 776f 7264  d method keyword
-00041b10: 7321 2229 0a0a 2020 2020 2020 2020 2020  s!")..          
-00041b20: 2020 6d65 7468 6f64 203d 2069 6e74 6572    method = inter
-00041b30: 706f 6c61 7469 6f6e 0a0a 2020 2020 2020  polation..      
-00041b40: 2020 6469 6d73 3a20 7365 745b 4861 7368    dims: set[Hash
-00041b50: 6162 6c65 5d0a 2020 2020 2020 2020 6966  able].        if
-00041b60: 2069 7369 6e73 7461 6e63 6528 6469 6d2c   isinstance(dim,
-00041b70: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
-00041b80: 2020 2064 696d 7320 3d20 7b64 696d 7d0a     dims = {dim}.
-00041b90: 2020 2020 2020 2020 656c 6966 2064 696d          elif dim
-00041ba0: 2069 7320 4e6f 6e65 206f 7220 6469 6d20   is None or dim 
-00041bb0: 6973 202e 2e2e 3a0a 2020 2020 2020 2020  is ...:.        
-00041bc0: 2020 2020 6469 6d73 203d 2073 6574 2873      dims = set(s
-00041bd0: 656c 662e 6469 6d73 290a 2020 2020 2020  elf.dims).      
-00041be0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00041bf0: 2020 2020 6469 6d73 203d 2073 6574 2864      dims = set(d
-00041c00: 696d 290a 0a20 2020 2020 2020 205f 6173  im)..        _as
-00041c10: 7365 7274 5f65 6d70 7479 280a 2020 2020  sert_empty(.    
-00041c20: 2020 2020 2020 2020 7475 706c 6528 6420          tuple(d 
-00041c30: 666f 7220 6420 696e 2064 696d 7320 6966  for d in dims if
-00041c40: 2064 206e 6f74 2069 6e20 7365 6c66 2e64   d not in self.d
-00041c50: 696d 7329 2c0a 2020 2020 2020 2020 2020  ims),.          
-00041c60: 2020 2244 6174 6173 6574 2064 6f65 7320    "Dataset does 
-00041c70: 6e6f 7420 636f 6e74 6169 6e20 7468 6520  not contain the 
-00041c80: 6469 6d65 6e73 696f 6e73 3a20 2573 222c  dimensions: %s",
-00041c90: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00041ca0: 2020 2020 7120 3d20 6e70 2e61 7361 7272      q = np.asarr
-00041cb0: 6179 2871 2c20 6474 7970 653d 6e70 2e66  ay(q, dtype=np.f
-00041cc0: 6c6f 6174 3634 290a 0a20 2020 2020 2020  loat64)..       
-00041cd0: 2076 6172 6961 626c 6573 203d 207b 7d0a   variables = {}.
-00041ce0: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
-00041cf0: 2c20 7661 7220 696e 2073 656c 662e 7661  , var in self.va
-00041d00: 7269 6162 6c65 732e 6974 656d 7328 293a  riables.items():
-00041d10: 0a20 2020 2020 2020 2020 2020 2072 6564  .            red
-00041d20: 7563 655f 6469 6d73 203d 205b 6420 666f  uce_dims = [d fo
-00041d30: 7220 6420 696e 2076 6172 2e64 696d 7320  r d in var.dims 
-00041d40: 6966 2064 2069 6e20 6469 6d73 5d0a 2020  if d in dims].  
-00041d50: 2020 2020 2020 2020 2020 6966 2072 6564            if red
-00041d60: 7563 655f 6469 6d73 206f 7220 6e6f 7420  uce_dims or not 
-00041d70: 7661 722e 6469 6d73 3a0a 2020 2020 2020  var.dims:.      
-00041d80: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-00041d90: 6520 6e6f 7420 696e 2073 656c 662e 636f  e not in self.co
-00041da0: 6f72 6473 3a0a 2020 2020 2020 2020 2020  ords:.          
-00041db0: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
-00041dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041dd0: 2020 2020 2020 206e 6f74 206e 756d 6572         not numer
-00041de0: 6963 5f6f 6e6c 790a 2020 2020 2020 2020  ic_only.        
-00041df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041e00: 6f72 206e 702e 6973 7375 6264 7479 7065  or np.issubdtype
-00041e10: 2876 6172 2e64 7479 7065 2c20 6e70 2e6e  (var.dtype, np.n
-00041e20: 756d 6265 7229 0a20 2020 2020 2020 2020  umber).         
-00041e30: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00041e40: 7220 7661 722e 6474 7970 6520 3d3d 206e  r var.dtype == n
-00041e50: 702e 626f 6f6c 5f0a 2020 2020 2020 2020  p.bool_.        
-00041e60: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-00041e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041e80: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-00041e90: 5b6e 616d 655d 203d 2076 6172 2e71 7561  [name] = var.qua
-00041ea0: 6e74 696c 6528 0a20 2020 2020 2020 2020  ntile(.         
-00041eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041ec0: 2020 2071 2c0a 2020 2020 2020 2020 2020     q,.          
-00041ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041ee0: 2020 6469 6d3d 7265 6475 6365 5f64 696d    dim=reduce_dim
-00041ef0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00041f00: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00041f10: 6574 686f 643d 6d65 7468 6f64 2c0a 2020  ethod=method,.  
-00041f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041f30: 2020 2020 2020 2020 2020 6b65 6570 5f61            keep_a
-00041f40: 7474 7273 3d6b 6565 705f 6174 7472 732c  ttrs=keep_attrs,
-00041f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041f60: 2020 2020 2020 2020 2020 2020 2073 6b69               ski
-00041f70: 706e 613d 736b 6970 6e61 2c0a 2020 2020  pna=skipna,.    
-00041f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041f90: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-00041fa0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00041fb0: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-00041fc0: 6573 5b6e 616d 655d 203d 2076 6172 0a0a  es[name] = var..
-00041fd0: 2020 2020 2020 2020 2320 636f 6e73 7472          # constr
-00041fe0: 7563 7420 7468 6520 6e65 7720 6461 7461  uct the new data
-00041ff0: 7365 740a 2020 2020 2020 2020 636f 6f72  set.        coor
-00042000: 645f 6e61 6d65 7320 3d20 7b6b 2066 6f72  d_names = {k for
-00042010: 206b 2069 6e20 7365 6c66 2e63 6f6f 7264   k in self.coord
-00042020: 7320 6966 206b 2069 6e20 7661 7269 6162  s if k in variab
-00042030: 6c65 737d 0a20 2020 2020 2020 2069 6e64  les}.        ind
-00042040: 6578 6573 203d 207b 6b3a 2076 2066 6f72  exes = {k: v for
-00042050: 206b 2c20 7620 696e 2073 656c 662e 5f69   k, v in self._i
-00042060: 6e64 6578 6573 2e69 7465 6d73 2829 2069  ndexes.items() i
-00042070: 6620 6b20 696e 2076 6172 6961 626c 6573  f k in variables
-00042080: 7d0a 2020 2020 2020 2020 6966 206b 6565  }.        if kee
-00042090: 705f 6174 7472 7320 6973 204e 6f6e 653a  p_attrs is None:
-000420a0: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
-000420b0: 705f 6174 7472 7320 3d20 5f67 6574 5f6b  p_attrs = _get_k
-000420c0: 6565 705f 6174 7472 7328 6465 6661 756c  eep_attrs(defaul
-000420d0: 743d 4661 6c73 6529 0a20 2020 2020 2020  t=False).       
-000420e0: 2061 7474 7273 203d 2073 656c 662e 6174   attrs = self.at
-000420f0: 7472 7320 6966 206b 6565 705f 6174 7472  trs if keep_attr
-00042100: 7320 656c 7365 204e 6f6e 650a 2020 2020  s else None.    
-00042110: 2020 2020 6e65 7720 3d20 7365 6c66 2e5f      new = self._
-00042120: 7265 706c 6163 655f 7769 7468 5f6e 6577  replace_with_new
-00042130: 5f64 696d 7328 0a20 2020 2020 2020 2020  _dims(.         
-00042140: 2020 2076 6172 6961 626c 6573 2c20 636f     variables, co
-00042150: 6f72 645f 6e61 6d65 733d 636f 6f72 645f  ord_names=coord_
-00042160: 6e61 6d65 732c 2061 7474 7273 3d61 7474  names, attrs=att
-00042170: 7273 2c20 696e 6465 7865 733d 696e 6465  rs, indexes=inde
-00042180: 7865 730a 2020 2020 2020 2020 290a 2020  xes.        ).  
-00042190: 2020 2020 2020 7265 7475 726e 206e 6577        return new
-000421a0: 2e61 7373 6967 6e5f 636f 6f72 6473 2871  .assign_coords(q
-000421b0: 7561 6e74 696c 653d 7129 0a0a 2020 2020  uantile=q)..    
-000421c0: 6465 6620 7261 6e6b 280a 2020 2020 2020  def rank(.      
-000421d0: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
-000421e0: 742c 0a20 2020 2020 2020 2064 696d 3a20  t,.        dim: 
-000421f0: 4861 7368 6162 6c65 2c0a 2020 2020 2020  Hashable,.      
-00042200: 2020 7063 743a 2062 6f6f 6c20 3d20 4661    pct: bool = Fa
-00042210: 6c73 652c 0a20 2020 2020 2020 206b 6565  lse,.        kee
-00042220: 705f 6174 7472 733a 2062 6f6f 6c20 7c20  p_attrs: bool | 
-00042230: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00042240: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
-00042250: 0a20 2020 2020 2020 2022 2222 5261 6e6b  .        """Rank
-00042260: 7320 7468 6520 6461 7461 2e0a 0a20 2020  s the data...   
-00042270: 2020 2020 2045 7175 616c 2076 616c 7565       Equal value
-00042280: 7320 6172 6520 6173 7369 676e 6564 2061  s are assigned a
-00042290: 2072 616e 6b20 7468 6174 2069 7320 7468   rank that is th
-000422a0: 6520 6176 6572 6167 6520 6f66 2074 6865  e average of the
-000422b0: 2072 616e 6b73 2074 6861 740a 2020 2020   ranks that.    
-000422c0: 2020 2020 776f 756c 6420 6861 7665 2062      would have b
-000422d0: 6565 6e20 6f74 6865 7277 6973 6520 6173  een otherwise as
-000422e0: 7369 676e 6564 2074 6f20 616c 6c20 6f66  signed to all of
-000422f0: 2074 6865 2076 616c 7565 7320 7769 7468   the values with
-00042300: 696e 0a20 2020 2020 2020 2074 6861 7420  in.        that 
-00042310: 7365 742e 0a20 2020 2020 2020 2052 616e  set..        Ran
-00042320: 6b73 2062 6567 696e 2061 7420 312c 206e  ks begin at 1, n
-00042330: 6f74 2030 2e20 4966 2070 6374 2069 7320  ot 0. If pct is 
-00042340: 5472 7565 2c20 636f 6d70 7574 6573 2070  True, computes p
-00042350: 6572 6365 6e74 6167 6520 7261 6e6b 732e  ercentage ranks.
-00042360: 0a0a 2020 2020 2020 2020 4e61 4e73 2069  ..        NaNs i
-00042370: 6e20 7468 6520 696e 7075 7420 6172 7261  n the input arra
-00042380: 7920 6172 6520 7265 7475 726e 6564 2061  y are returned a
-00042390: 7320 4e61 4e73 2e0a 0a20 2020 2020 2020  s NaNs...       
-000423a0: 2054 6865 2060 626f 7474 6c65 6e65 636b   The `bottleneck
-000423b0: 6020 6c69 6272 6172 7920 6973 2072 6571  ` library is req
-000423c0: 7569 7265 642e 0a0a 2020 2020 2020 2020  uired...        
-000423d0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-000423e0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-000423f0: 2020 2020 2020 6469 6d20 3a20 4861 7368        dim : Hash
-00042400: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
-00042410: 2044 696d 656e 7369 6f6e 206f 7665 7220   Dimension over 
-00042420: 7768 6963 6820 746f 2063 6f6d 7075 7465  which to compute
-00042430: 2072 616e 6b2e 0a20 2020 2020 2020 2070   rank..        p
-00042440: 6374 203a 2062 6f6f 6c2c 2064 6566 6175  ct : bool, defau
-00042450: 6c74 3a20 4661 6c73 650a 2020 2020 2020  lt: False.      
-00042460: 2020 2020 2020 4966 2054 7275 652c 2063        If True, c
-00042470: 6f6d 7075 7465 2070 6572 6365 6e74 6167  ompute percentag
-00042480: 6520 7261 6e6b 732c 206f 7468 6572 7769  e ranks, otherwi
-00042490: 7365 2063 6f6d 7075 7465 2069 6e74 6567  se compute integ
-000424a0: 6572 2072 616e 6b73 2e0a 2020 2020 2020  er ranks..      
-000424b0: 2020 6b65 6570 5f61 7474 7273 203a 2062    keep_attrs : b
-000424c0: 6f6f 6c20 6f72 204e 6f6e 652c 206f 7074  ool or None, opt
-000424d0: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-000424e0: 2020 4966 2054 7275 652c 2074 6865 2064    If True, the d
-000424f0: 6174 6173 6574 2773 2061 7474 7269 6275  ataset's attribu
-00042500: 7465 7320 2860 6174 7472 7360 2920 7769  tes (`attrs`) wi
-00042510: 6c6c 2062 6520 636f 7069 6564 2066 726f  ll be copied fro
-00042520: 6d0a 2020 2020 2020 2020 2020 2020 7468  m.            th
-00042530: 6520 6f72 6967 696e 616c 206f 626a 6563  e original objec
-00042540: 7420 746f 2074 6865 206e 6577 206f 6e65  t to the new one
-00042550: 2e20 2049 6620 4661 6c73 652c 2074 6865  .  If False, the
-00042560: 206e 6577 0a20 2020 2020 2020 2020 2020   new.           
-00042570: 206f 626a 6563 7420 7769 6c6c 2062 6520   object will be 
-00042580: 7265 7475 726e 6564 2077 6974 686f 7574  returned without
-00042590: 2061 7474 7269 6275 7465 732e 0a0a 2020   attributes...  
-000425a0: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-000425b0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-000425c0: 2020 2020 2020 7261 6e6b 6564 203a 2044        ranked : D
-000425d0: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
-000425e0: 2020 2056 6172 6961 626c 6573 2074 6861     Variables tha
-000425f0: 7420 646f 206e 6f74 2064 6570 656e 6420  t do not depend 
-00042600: 6f6e 2060 6469 6d60 2061 7265 2064 726f  on `dim` are dro
-00042610: 7070 6564 2e0a 2020 2020 2020 2020 2222  pped..        ""
-00042620: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-00042630: 204f 5054 494f 4e53 5b22 7573 655f 626f   OPTIONS["use_bo
-00042640: 7474 6c65 6e65 636b 225d 3a0a 2020 2020  ttleneck"]:.    
-00042650: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
-00042660: 6e74 696d 6545 7272 6f72 280a 2020 2020  ntimeError(.    
-00042670: 2020 2020 2020 2020 2020 2020 2272 616e              "ran
-00042680: 6b20 7265 7175 6972 6573 2062 6f74 746c  k requires bottl
-00042690: 656e 6563 6b20 746f 2062 6520 656e 6162  eneck to be enab
-000426a0: 6c65 642e 220a 2020 2020 2020 2020 2020  led.".          
-000426b0: 2020 2020 2020 2220 4361 6c6c 2060 7872        " Call `xr
-000426c0: 2e73 6574 5f6f 7074 696f 6e73 2875 7365  .set_options(use
-000426d0: 5f62 6f74 746c 656e 6563 6b3d 5472 7565  _bottleneck=True
-000426e0: 2960 2074 6f20 656e 6162 6c65 2069 742e  )` to enable it.
-000426f0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00042700: 0a20 2020 2020 2020 2069 6620 6469 6d20  .        if dim 
-00042710: 6e6f 7420 696e 2073 656c 662e 6469 6d73  not in self.dims
-00042720: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00042730: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-00042740: 2244 6174 6173 6574 2064 6f65 7320 6e6f  "Dataset does no
-00042750: 7420 636f 6e74 6169 6e20 7468 6520 6469  t contain the di
-00042760: 6d65 6e73 696f 6e3a 207b 6469 6d7d 2229  mension: {dim}")
-00042770: 0a0a 2020 2020 2020 2020 7661 7269 6162  ..        variab
-00042780: 6c65 7320 3d20 7b7d 0a20 2020 2020 2020  les = {}.       
-00042790: 2066 6f72 206e 616d 652c 2076 6172 2069   for name, var i
-000427a0: 6e20 7365 6c66 2e76 6172 6961 626c 6573  n self.variables
-000427b0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-000427c0: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
-000427d0: 2073 656c 662e 6461 7461 5f76 6172 733a   self.data_vars:
-000427e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000427f0: 2069 6620 6469 6d20 696e 2076 6172 2e64   if dim in var.d
-00042800: 696d 733a 0a20 2020 2020 2020 2020 2020  ims:.           
-00042810: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-00042820: 6573 5b6e 616d 655d 203d 2076 6172 2e72  es[name] = var.r
-00042830: 616e 6b28 6469 6d2c 2070 6374 3d70 6374  ank(dim, pct=pct
-00042840: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00042850: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00042860: 2020 2020 7661 7269 6162 6c65 735b 6e61      variables[na
-00042870: 6d65 5d20 3d20 7661 720a 0a20 2020 2020  me] = var..     
-00042880: 2020 2063 6f6f 7264 5f6e 616d 6573 203d     coord_names =
-00042890: 2073 6574 2873 656c 662e 636f 6f72 6473   set(self.coords
-000428a0: 290a 2020 2020 2020 2020 6966 206b 6565  ).        if kee
-000428b0: 705f 6174 7472 7320 6973 204e 6f6e 653a  p_attrs is None:
-000428c0: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
-000428d0: 705f 6174 7472 7320 3d20 5f67 6574 5f6b  p_attrs = _get_k
-000428e0: 6565 705f 6174 7472 7328 6465 6661 756c  eep_attrs(defaul
-000428f0: 743d 4661 6c73 6529 0a20 2020 2020 2020  t=False).       
-00042900: 2061 7474 7273 203d 2073 656c 662e 6174   attrs = self.at
-00042910: 7472 7320 6966 206b 6565 705f 6174 7472  trs if keep_attr
-00042920: 7320 656c 7365 204e 6f6e 650a 2020 2020  s else None.    
-00042930: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00042940: 5f72 6570 6c61 6365 2876 6172 6961 626c  _replace(variabl
-00042950: 6573 2c20 636f 6f72 645f 6e61 6d65 732c  es, coord_names,
-00042960: 2061 7474 7273 3d61 7474 7273 290a 0a20   attrs=attrs).. 
-00042970: 2020 2064 6566 2064 6966 6665 7265 6e74     def different
-00042980: 6961 7465 280a 2020 2020 2020 2020 7365  iate(.        se
-00042990: 6c66 3a20 545f 4461 7461 7365 742c 0a20  lf: T_Dataset,. 
-000429a0: 2020 2020 2020 2063 6f6f 7264 3a20 4861         coord: Ha
-000429b0: 7368 6162 6c65 2c0a 2020 2020 2020 2020  shable,.        
-000429c0: 6564 6765 5f6f 7264 6572 3a20 4c69 7465  edge_order: Lite
-000429d0: 7261 6c5b 312c 2032 5d20 3d20 312c 0a20  ral[1, 2] = 1,. 
-000429e0: 2020 2020 2020 2064 6174 6574 696d 655f         datetime_
-000429f0: 756e 6974 3a20 4461 7465 7469 6d65 556e  unit: DatetimeUn
-00042a00: 6974 4f70 7469 6f6e 7320 7c20 4e6f 6e65  itOptions | None
-00042a10: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
-00042a20: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-00042a30: 2020 2020 2022 2222 2044 6966 6665 7265       """ Differe
-00042a40: 6e74 6961 7465 2077 6974 6820 7468 6520  ntiate with the 
-00042a50: 7365 636f 6e64 206f 7264 6572 2061 6363  second order acc
-00042a60: 7572 6174 6520 6365 6e74 7261 6c0a 2020  urate central.  
-00042a70: 2020 2020 2020 6469 6666 6572 656e 6365        difference
-00042a80: 732e 0a0a 2020 2020 2020 2020 2e2e 206e  s...        .. n
-00042a90: 6f74 653a 3a0a 2020 2020 2020 2020 2020  ote::.          
-00042aa0: 2020 5468 6973 2066 6561 7475 7265 2069    This feature i
-00042ab0: 7320 6c69 6d69 7465 6420 746f 2073 696d  s limited to sim
-00042ac0: 706c 6520 6361 7274 6573 6961 6e20 6765  ple cartesian ge
-00042ad0: 6f6d 6574 7279 2c20 692e 652e 2063 6f6f  ometry, i.e. coo
-00042ae0: 7264 0a20 2020 2020 2020 2020 2020 206d  rd.            m
-00042af0: 7573 7420 6265 206f 6e65 2064 696d 656e  ust be one dimen
-00042b00: 7369 6f6e 616c 2e0a 0a20 2020 2020 2020  sional...       
-00042b10: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00042b20: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00042b30: 2020 2020 2020 2063 6f6f 7264 203a 2048         coord : H
-00042b40: 6173 6861 626c 650a 2020 2020 2020 2020  ashable.        
-00042b50: 2020 2020 5468 6520 636f 6f72 6469 6e61      The coordina
-00042b60: 7465 2074 6f20 6265 2075 7365 6420 746f  te to be used to
-00042b70: 2063 6f6d 7075 7465 2074 6865 2067 7261   compute the gra
-00042b80: 6469 656e 742e 0a20 2020 2020 2020 2065  dient..        e
-00042b90: 6467 655f 6f72 6465 7220 3a20 7b31 2c20  dge_order : {1, 
-00042ba0: 327d 2c20 6465 6661 756c 743a 2031 0a20  2}, default: 1. 
-00042bb0: 2020 2020 2020 2020 2020 204e 2d74 6820             N-th 
-00042bc0: 6f72 6465 7220 6163 6375 7261 7465 2064  order accurate d
-00042bd0: 6966 6665 7265 6e63 6573 2061 7420 7468  ifferences at th
-00042be0: 6520 626f 756e 6461 7269 6573 2e0a 2020  e boundaries..  
-00042bf0: 2020 2020 2020 6461 7465 7469 6d65 5f75        datetime_u
-00042c00: 6e69 7420 3a20 4e6f 6e65 206f 7220 7b22  nit : None or {"
-00042c10: 5922 2c20 224d 222c 2022 5722 2c20 2244  Y", "M", "W", "D
-00042c20: 222c 2022 6822 2c20 226d 222c 2022 7322  ", "h", "m", "s"
-00042c30: 2c20 226d 7322 2c20 5c0a 2020 2020 2020  , "ms", \.      
-00042c40: 2020 2020 2020 2275 7322 2c20 226e 7322        "us", "ns"
-00042c50: 2c20 2270 7322 2c20 2266 7322 2c20 2261  , "ps", "fs", "a
-00042c60: 7322 2c20 4e6f 6e65 7d2c 2064 6566 6175  s", None}, defau
-00042c70: 6c74 3a20 4e6f 6e65 0a20 2020 2020 2020  lt: None.       
-00042c80: 2020 2020 2055 6e69 7420 746f 2063 6f6d       Unit to com
-00042c90: 7075 7465 2067 7261 6469 656e 742e 204f  pute gradient. O
-00042ca0: 6e6c 7920 7661 6c69 6420 666f 7220 6461  nly valid for da
-00042cb0: 7465 7469 6d65 2063 6f6f 7264 696e 6174  tetime coordinat
-00042cc0: 652e 0a0a 2020 2020 2020 2020 5265 7475  e...        Retu
-00042cd0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-00042ce0: 2d2d 2d0a 2020 2020 2020 2020 6469 6666  ---.        diff
-00042cf0: 6572 656e 7469 6174 6564 3a20 4461 7461  erentiated: Data
-00042d00: 7365 740a 0a20 2020 2020 2020 2053 6565  set..        See
-00042d10: 2061 6c73 6f0a 2020 2020 2020 2020 2d2d   also.        --
-00042d20: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 206e  ------.        n
-00042d30: 756d 7079 2e67 7261 6469 656e 743a 2063  umpy.gradient: c
-00042d40: 6f72 7265 7370 6f6e 6469 6e67 206e 756d  orresponding num
-00042d50: 7079 2066 756e 6374 696f 6e0a 2020 2020  py function.    
-00042d60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00042d70: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-00042d80: 2e76 6172 6961 626c 6520 696d 706f 7274  .variable import
-00042d90: 2056 6172 6961 626c 650a 0a20 2020 2020   Variable..     
-00042da0: 2020 2069 6620 636f 6f72 6420 6e6f 7420     if coord not 
-00042db0: 696e 2073 656c 662e 7661 7269 6162 6c65  in self.variable
-00042dc0: 7320 616e 6420 636f 6f72 6420 6e6f 7420  s and coord not 
-00042dd0: 696e 2073 656c 662e 6469 6d73 3a0a 2020  in self.dims:.  
-00042de0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00042df0: 5661 6c75 6545 7272 6f72 2866 2243 6f6f  ValueError(f"Coo
-00042e00: 7264 696e 6174 6520 7b63 6f6f 7264 7d20  rdinate {coord} 
-00042e10: 646f 6573 206e 6f74 2065 7869 7374 2e22  does not exist."
-00042e20: 290a 0a20 2020 2020 2020 2063 6f6f 7264  )..        coord
-00042e30: 5f76 6172 203d 2073 656c 665b 636f 6f72  _var = self[coor
-00042e40: 645d 2e76 6172 6961 626c 650a 2020 2020  d].variable.    
-00042e50: 2020 2020 6966 2063 6f6f 7264 5f76 6172      if coord_var
-00042e60: 2e6e 6469 6d20 213d 2031 3a0a 2020 2020  .ndim != 1:.    
-00042e70: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00042e80: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00042e90: 2020 2020 2020 2020 2020 2243 6f6f 7264            "Coord
-00042ea0: 696e 6174 6520 7b7d 206d 7573 7420 6265  inate {} must be
-00042eb0: 2031 2064 696d 656e 7369 6f6e 616c 2062   1 dimensional b
-00042ec0: 7574 2069 7320 7b7d 220a 2020 2020 2020  ut is {}".      
-00042ed0: 2020 2020 2020 2020 2020 2220 6469 6d65            " dime
-00042ee0: 6e73 696f 6e61 6c22 2e66 6f72 6d61 7428  nsional".format(
-00042ef0: 636f 6f72 642c 2063 6f6f 7264 5f76 6172  coord, coord_var
-00042f00: 2e6e 6469 6d29 0a20 2020 2020 2020 2020  .ndim).         
-00042f10: 2020 2029 0a0a 2020 2020 2020 2020 6469     )..        di
-00042f20: 6d20 3d20 636f 6f72 645f 7661 722e 6469  m = coord_var.di
-00042f30: 6d73 5b30 5d0a 2020 2020 2020 2020 6966  ms[0].        if
-00042f40: 205f 636f 6e74 6169 6e73 5f64 6174 6574   _contains_datet
-00042f50: 696d 655f 6c69 6b65 5f6f 626a 6563 7473  ime_like_objects
-00042f60: 2863 6f6f 7264 5f76 6172 293a 0a20 2020  (coord_var):.   
-00042f70: 2020 2020 2020 2020 2069 6620 636f 6f72           if coor
-00042f80: 645f 7661 722e 6474 7970 652e 6b69 6e64  d_var.dtype.kind
-00042f90: 2069 6e20 226d 4d22 2061 6e64 2064 6174   in "mM" and dat
-00042fa0: 6574 696d 655f 756e 6974 2069 7320 4e6f  etime_unit is No
-00042fb0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00042fc0: 2020 2020 6461 7465 7469 6d65 5f75 6e69      datetime_uni
-00042fd0: 7420 3d20 6361 7374 280a 2020 2020 2020  t = cast(.      
-00042fe0: 2020 2020 2020 2020 2020 2020 2020 2244                "D
-00042ff0: 6174 6574 696d 6555 6e69 744f 7074 696f  atetimeUnitOptio
-00043000: 6e73 222c 206e 702e 6461 7465 7469 6d65  ns", np.datetime
-00043010: 5f64 6174 6128 636f 6f72 645f 7661 722e  _data(coord_var.
-00043020: 6474 7970 6529 5b30 5d0a 2020 2020 2020  dtype)[0].      
-00043030: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00043040: 2020 2020 2020 2020 656c 6966 2064 6174          elif dat
-00043050: 6574 696d 655f 756e 6974 2069 7320 4e6f  etime_unit is No
-00043060: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00043070: 2020 2020 6461 7465 7469 6d65 5f75 6e69      datetime_uni
-00043080: 7420 3d20 2273 2220 2023 2044 6566 6175  t = "s"  # Defau
-00043090: 6c74 2074 6f20 7365 636f 6e64 7320 666f  lt to seconds fo
-000430a0: 7220 6366 7469 6d65 206f 626a 6563 7473  r cftime objects
-000430b0: 0a20 2020 2020 2020 2020 2020 2063 6f6f  .            coo
-000430c0: 7264 5f76 6172 203d 2063 6f6f 7264 5f76  rd_var = coord_v
-000430d0: 6172 2e5f 746f 5f6e 756d 6572 6963 2864  ar._to_numeric(d
-000430e0: 6174 6574 696d 655f 756e 6974 3d64 6174  atetime_unit=dat
-000430f0: 6574 696d 655f 756e 6974 290a 0a20 2020  etime_unit)..   
-00043100: 2020 2020 2076 6172 6961 626c 6573 203d       variables =
-00043110: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
-00043120: 6b2c 2076 2069 6e20 7365 6c66 2e76 6172  k, v in self.var
-00043130: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
-00043140: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00043150: 2069 6e20 7365 6c66 2e64 6174 615f 7661   in self.data_va
-00043160: 7273 2061 6e64 2064 696d 2069 6e20 762e  rs and dim in v.
-00043170: 6469 6d73 2061 6e64 206b 206e 6f74 2069  dims and k not i
-00043180: 6e20 7365 6c66 2e63 6f6f 7264 733a 0a20  n self.coords:. 
-00043190: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000431a0: 6620 5f63 6f6e 7461 696e 735f 6461 7465  f _contains_date
-000431b0: 7469 6d65 5f6c 696b 655f 6f62 6a65 6374  time_like_object
-000431c0: 7328 7629 3a0a 2020 2020 2020 2020 2020  s(v):.          
-000431d0: 2020 2020 2020 2020 2020 7620 3d20 762e            v = v.
-000431e0: 5f74 6f5f 6e75 6d65 7269 6328 6461 7465  _to_numeric(date
-000431f0: 7469 6d65 5f75 6e69 743d 6461 7465 7469  time_unit=dateti
-00043200: 6d65 5f75 6e69 7429 0a20 2020 2020 2020  me_unit).       
-00043210: 2020 2020 2020 2020 2067 7261 6420 3d20           grad = 
-00043220: 6475 636b 5f61 7272 6179 5f6f 7073 2e67  duck_array_ops.g
-00043230: 7261 6469 656e 7428 0a20 2020 2020 2020  radient(.       
-00043240: 2020 2020 2020 2020 2020 2020 2076 2e64               v.d
-00043250: 6174 612c 0a20 2020 2020 2020 2020 2020  ata,.           
-00043260: 2020 2020 2020 2020 2063 6f6f 7264 5f76           coord_v
-00043270: 6172 2e64 6174 612c 0a20 2020 2020 2020  ar.data,.       
-00043280: 2020 2020 2020 2020 2020 2020 2065 6467               edg
-00043290: 655f 6f72 6465 723d 6564 6765 5f6f 7264  e_order=edge_ord
-000432a0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-000432b0: 2020 2020 2020 2020 6178 6973 3d76 2e67          axis=v.g
-000432c0: 6574 5f61 7869 735f 6e75 6d28 6469 6d29  et_axis_num(dim)
-000432d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000432e0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-000432f0: 2020 2020 7661 7269 6162 6c65 735b 6b5d      variables[k]
-00043300: 203d 2056 6172 6961 626c 6528 762e 6469   = Variable(v.di
-00043310: 6d73 2c20 6772 6164 290a 2020 2020 2020  ms, grad).      
-00043320: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00043330: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-00043340: 6162 6c65 735b 6b5d 203d 2076 0a20 2020  ables[k] = v.   
-00043350: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00043360: 2e5f 7265 706c 6163 6528 7661 7269 6162  ._replace(variab
-00043370: 6c65 7329 0a0a 2020 2020 6465 6620 696e  les)..    def in
-00043380: 7465 6772 6174 6528 0a20 2020 2020 2020  tegrate(.       
-00043390: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
-000433a0: 2c0a 2020 2020 2020 2020 636f 6f72 643a  ,.        coord:
-000433b0: 2048 6173 6861 626c 6520 7c20 5365 7175   Hashable | Sequ
-000433c0: 656e 6365 5b48 6173 6861 626c 655d 2c0a  ence[Hashable],.
-000433d0: 2020 2020 2020 2020 6461 7465 7469 6d65          datetime
-000433e0: 5f75 6e69 743a 2044 6174 6574 696d 6555  _unit: DatetimeU
-000433f0: 6e69 744f 7074 696f 6e73 203d 204e 6f6e  nitOptions = Non
-00043400: 652c 0a20 2020 2029 202d 3e20 545f 4461  e,.    ) -> T_Da
-00043410: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
-00043420: 2222 496e 7465 6772 6174 6520 616c 6f6e  ""Integrate alon
-00043430: 6720 7468 6520 6769 7665 6e20 636f 6f72  g the given coor
-00043440: 6469 6e61 7465 2075 7369 6e67 2074 6865  dinate using the
-00043450: 2074 7261 7065 7a6f 6964 616c 2072 756c   trapezoidal rul
-00043460: 652e 0a0a 2020 2020 2020 2020 2e2e 206e  e...        .. n
-00043470: 6f74 653a 3a0a 2020 2020 2020 2020 2020  ote::.          
-00043480: 2020 5468 6973 2066 6561 7475 7265 2069    This feature i
-00043490: 7320 6c69 6d69 7465 6420 746f 2073 696d  s limited to sim
-000434a0: 706c 6520 6361 7274 6573 6961 6e20 6765  ple cartesian ge
-000434b0: 6f6d 6574 7279 2c20 692e 652e 2063 6f6f  ometry, i.e. coo
-000434c0: 7264 0a20 2020 2020 2020 2020 2020 206d  rd.            m
-000434d0: 7573 7420 6265 206f 6e65 2064 696d 656e  ust be one dimen
-000434e0: 7369 6f6e 616c 2e0a 0a20 2020 2020 2020  sional...       
-000434f0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00043500: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00043510: 2020 2020 2020 2063 6f6f 7264 203a 2068         coord : h
-00043520: 6173 6861 626c 652c 206f 7220 7365 7175  ashable, or sequ
-00043530: 656e 6365 206f 6620 6861 7368 6162 6c65  ence of hashable
-00043540: 0a20 2020 2020 2020 2020 2020 2043 6f6f  .            Coo
-00043550: 7264 696e 6174 6528 7329 2075 7365 6420  rdinate(s) used 
-00043560: 666f 7220 7468 6520 696e 7465 6772 6174  for the integrat
-00043570: 696f 6e2e 0a20 2020 2020 2020 2064 6174  ion..        dat
-00043580: 6574 696d 655f 756e 6974 203a 207b 2759  etime_unit : {'Y
-00043590: 272c 2027 4d27 2c20 2757 272c 2027 4427  ', 'M', 'W', 'D'
-000435a0: 2c20 2768 272c 2027 6d27 2c20 2773 272c  , 'h', 'm', 's',
-000435b0: 2027 6d73 272c 2027 7573 272c 2027 6e73   'ms', 'us', 'ns
-000435c0: 272c 205c 0a20 2020 2020 2020 2020 2020  ', \.           
-000435d0: 2020 2020 2020 2020 2020 2020 2027 7073               'ps
-000435e0: 272c 2027 6673 272c 2027 6173 272c 204e  ', 'fs', 'as', N
-000435f0: 6f6e 657d 2c20 6f70 7469 6f6e 616c 0a20  one}, optional. 
-00043600: 2020 2020 2020 2020 2020 2053 7065 6369             Speci
-00043610: 6679 2074 6865 2075 6e69 7420 6966 2064  fy the unit if d
-00043620: 6174 6574 696d 6520 636f 6f72 6469 6e61  atetime coordina
-00043630: 7465 2069 7320 7573 6564 2e0a 0a20 2020  te is used...   
-00043640: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00043650: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-00043660: 2020 2020 2069 6e74 6567 7261 7465 6420       integrated 
-00043670: 3a20 4461 7461 7365 740a 0a20 2020 2020  : Dataset..     
-00043680: 2020 2053 6565 2061 6c73 6f0a 2020 2020     See also.    
-00043690: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-000436a0: 2020 2020 2044 6174 6141 7272 6179 2e69       DataArray.i
-000436b0: 6e74 6567 7261 7465 0a20 2020 2020 2020  ntegrate.       
-000436c0: 206e 756d 7079 2e74 7261 707a 203a 2063   numpy.trapz : c
-000436d0: 6f72 7265 7370 6f6e 6469 6e67 206e 756d  orresponding num
-000436e0: 7079 2066 756e 6374 696f 6e0a 0a20 2020  py function..   
-000436f0: 2020 2020 2045 7861 6d70 6c65 730a 2020       Examples.  
-00043700: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-00043710: 2020 2020 2020 203e 3e3e 2064 7320 3d20         >>> ds = 
-00043720: 7872 2e44 6174 6173 6574 280a 2020 2020  xr.Dataset(.    
-00043730: 2020 2020 2e2e 2e20 2020 2020 6461 7461      ...     data
-00043740: 5f76 6172 733d 7b22 6122 3a20 2822 7822  _vars={"a": ("x"
-00043750: 2c20 5b35 2c20 352c 2036 2c20 365d 292c  , [5, 5, 6, 6]),
-00043760: 2022 6222 3a20 2822 7822 2c20 5b31 2c20   "b": ("x", [1, 
-00043770: 322c 2031 2c20 305d 297d 2c0a 2020 2020  2, 1, 0])},.    
-00043780: 2020 2020 2e2e 2e20 2020 2020 636f 6f72      ...     coor
-00043790: 6473 3d7b 2278 223a 205b 302c 2031 2c20  ds={"x": [0, 1, 
-000437a0: 322c 2033 5d2c 2022 7922 3a20 2822 7822  2, 3], "y": ("x"
-000437b0: 2c20 5b31 2c20 372c 2033 2c20 355d 297d  , [1, 7, 3, 5])}
-000437c0: 2c0a 2020 2020 2020 2020 2e2e 2e20 290a  ,.        ... ).
-000437d0: 2020 2020 2020 2020 3e3e 3e20 6473 0a20          >>> ds. 
-000437e0: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
-000437f0: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
-00043800: 4469 6d65 6e73 696f 6e73 3a20 2028 783a  Dimensions:  (x:
-00043810: 2034 290a 2020 2020 2020 2020 436f 6f72   4).        Coor
-00043820: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-00043830: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
-00043840: 2920 696e 7436 3420 3020 3120 3220 330a  ) int64 0 1 2 3.
-00043850: 2020 2020 2020 2020 2020 2020 7920 2020              y   
-00043860: 2020 2020 2028 7829 2069 6e74 3634 2031       (x) int64 1
-00043870: 2037 2033 2035 0a20 2020 2020 2020 2044   7 3 5.        D
-00043880: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
-00043890: 2020 2020 2020 2020 2020 2061 2020 2020             a    
-000438a0: 2020 2020 2878 2920 696e 7436 3420 3520      (x) int64 5 
-000438b0: 3520 3620 360a 2020 2020 2020 2020 2020  5 6 6.          
-000438c0: 2020 6220 2020 2020 2020 2028 7829 2069    b        (x) i
-000438d0: 6e74 3634 2031 2032 2031 2030 0a20 2020  nt64 1 2 1 0.   
-000438e0: 2020 2020 203e 3e3e 2064 732e 696e 7465       >>> ds.inte
-000438f0: 6772 6174 6528 2278 2229 0a20 2020 2020  grate("x").     
-00043900: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
-00043910: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
-00043920: 6e73 696f 6e73 3a20 2028 290a 2020 2020  nsions:  ().    
-00043930: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
-00043940: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00043950: 6120 2020 2020 2020 2066 6c6f 6174 3634  a        float64
-00043960: 2031 362e 350a 2020 2020 2020 2020 2020   16.5.          
-00043970: 2020 6220 2020 2020 2020 2066 6c6f 6174    b        float
-00043980: 3634 2033 2e35 0a20 2020 2020 2020 203e  64 3.5.        >
-00043990: 3e3e 2064 732e 696e 7465 6772 6174 6528  >> ds.integrate(
-000439a0: 2279 2229 0a20 2020 2020 2020 203c 7861  "y").        <xa
-000439b0: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
-000439c0: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
-000439d0: 3a20 2028 290a 2020 2020 2020 2020 4461  :  ().        Da
-000439e0: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
-000439f0: 2020 2020 2020 2020 2020 6120 2020 2020            a     
-00043a00: 2020 2066 6c6f 6174 3634 2032 302e 300a     float64 20.0.
-00043a10: 2020 2020 2020 2020 2020 2020 6220 2020              b   
-00043a20: 2020 2020 2066 6c6f 6174 3634 2034 2e30       float64 4.0
-00043a30: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00043a40: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-00043a50: 7374 616e 6365 2863 6f6f 7264 2c20 286c  stance(coord, (l
-00043a60: 6973 742c 2074 7570 6c65 2929 3a0a 2020  ist, tuple)):.  
-00043a70: 2020 2020 2020 2020 2020 636f 6f72 6420            coord 
-00043a80: 3d20 2863 6f6f 7264 2c29 0a20 2020 2020  = (coord,).     
-00043a90: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
-00043aa0: 0a20 2020 2020 2020 2066 6f72 2063 2069  .        for c i
-00043ab0: 6e20 636f 6f72 643a 0a20 2020 2020 2020  n coord:.       
-00043ac0: 2020 2020 2072 6573 756c 7420 3d20 7265       result = re
-00043ad0: 7375 6c74 2e5f 696e 7465 6772 6174 655f  sult._integrate_
-00043ae0: 6f6e 6528 632c 2064 6174 6574 696d 655f  one(c, datetime_
-00043af0: 756e 6974 3d64 6174 6574 696d 655f 756e  unit=datetime_un
-00043b00: 6974 290a 2020 2020 2020 2020 7265 7475  it).        retu
-00043b10: 726e 2072 6573 756c 740a 0a20 2020 2064  rn result..    d
-00043b20: 6566 205f 696e 7465 6772 6174 655f 6f6e  ef _integrate_on
-00043b30: 6528 7365 6c66 2c20 636f 6f72 642c 2064  e(self, coord, d
-00043b40: 6174 6574 696d 655f 756e 6974 3d4e 6f6e  atetime_unit=Non
-00043b50: 652c 2063 756d 756c 6174 6976 653d 4661  e, cumulative=Fa
-00043b60: 6c73 6529 3a0a 2020 2020 2020 2020 6672  lse):.        fr
-00043b70: 6f6d 2078 6172 7261 792e 636f 7265 2e76  om xarray.core.v
-00043b80: 6172 6961 626c 6520 696d 706f 7274 2056  ariable import V
-00043b90: 6172 6961 626c 650a 0a20 2020 2020 2020  ariable..       
-00043ba0: 2069 6620 636f 6f72 6420 6e6f 7420 696e   if coord not in
-00043bb0: 2073 656c 662e 7661 7269 6162 6c65 7320   self.variables 
-00043bc0: 616e 6420 636f 6f72 6420 6e6f 7420 696e  and coord not in
-00043bd0: 2073 656c 662e 6469 6d73 3a0a 2020 2020   self.dims:.    
-00043be0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00043bf0: 6c75 6545 7272 6f72 2866 2243 6f6f 7264  lueError(f"Coord
-00043c00: 696e 6174 6520 7b63 6f6f 7264 7d20 646f  inate {coord} do
-00043c10: 6573 206e 6f74 2065 7869 7374 2e22 290a  es not exist.").
-00043c20: 0a20 2020 2020 2020 2063 6f6f 7264 5f76  .        coord_v
-00043c30: 6172 203d 2073 656c 665b 636f 6f72 645d  ar = self[coord]
-00043c40: 2e76 6172 6961 626c 650a 2020 2020 2020  .variable.      
-00043c50: 2020 6966 2063 6f6f 7264 5f76 6172 2e6e    if coord_var.n
-00043c60: 6469 6d20 213d 2031 3a0a 2020 2020 2020  dim != 1:.      
-00043c70: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00043c80: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00043c90: 2020 2020 2020 2020 2243 6f6f 7264 696e          "Coordin
-00043ca0: 6174 6520 7b7d 206d 7573 7420 6265 2031  ate {} must be 1
-00043cb0: 2064 696d 656e 7369 6f6e 616c 2062 7574   dimensional but
-00043cc0: 2069 7320 7b7d 220a 2020 2020 2020 2020   is {}".        
-00043cd0: 2020 2020 2020 2020 2220 6469 6d65 6e73          " dimens
-00043ce0: 696f 6e61 6c22 2e66 6f72 6d61 7428 636f  ional".format(co
-00043cf0: 6f72 642c 2063 6f6f 7264 5f76 6172 2e6e  ord, coord_var.n
-00043d00: 6469 6d29 0a20 2020 2020 2020 2020 2020  dim).           
-00043d10: 2029 0a0a 2020 2020 2020 2020 6469 6d20   )..        dim 
-00043d20: 3d20 636f 6f72 645f 7661 722e 6469 6d73  = coord_var.dims
-00043d30: 5b30 5d0a 2020 2020 2020 2020 6966 205f  [0].        if _
-00043d40: 636f 6e74 6169 6e73 5f64 6174 6574 696d  contains_datetim
-00043d50: 655f 6c69 6b65 5f6f 626a 6563 7473 2863  e_like_objects(c
-00043d60: 6f6f 7264 5f76 6172 293a 0a20 2020 2020  oord_var):.     
-00043d70: 2020 2020 2020 2069 6620 636f 6f72 645f         if coord_
-00043d80: 7661 722e 6474 7970 652e 6b69 6e64 2069  var.dtype.kind i
-00043d90: 6e20 226d 4d22 2061 6e64 2064 6174 6574  n "mM" and datet
-00043da0: 696d 655f 756e 6974 2069 7320 4e6f 6e65  ime_unit is None
-00043db0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00043dc0: 2020 6461 7465 7469 6d65 5f75 6e69 742c    datetime_unit,
-00043dd0: 205f 203d 206e 702e 6461 7465 7469 6d65   _ = np.datetime
-00043de0: 5f64 6174 6128 636f 6f72 645f 7661 722e  _data(coord_var.
-00043df0: 6474 7970 6529 0a20 2020 2020 2020 2020  dtype).         
-00043e00: 2020 2065 6c69 6620 6461 7465 7469 6d65     elif datetime
-00043e10: 5f75 6e69 7420 6973 204e 6f6e 653a 0a20  _unit is None:. 
-00043e20: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00043e30: 6174 6574 696d 655f 756e 6974 203d 2022  atetime_unit = "
-00043e40: 7322 2020 2320 4465 6661 756c 7420 746f  s"  # Default to
-00043e50: 2073 6563 6f6e 6473 2066 6f72 2063 6674   seconds for cft
-00043e60: 696d 6520 6f62 6a65 6374 730a 2020 2020  ime objects.    
-00043e70: 2020 2020 2020 2020 636f 6f72 645f 7661          coord_va
-00043e80: 7220 3d20 636f 6f72 645f 7661 722e 5f72  r = coord_var._r
-00043e90: 6570 6c61 6365 280a 2020 2020 2020 2020  eplace(.        
-00043ea0: 2020 2020 2020 2020 6461 7461 3d64 6174          data=dat
-00043eb0: 6574 696d 655f 746f 5f6e 756d 6572 6963  etime_to_numeric
-00043ec0: 2863 6f6f 7264 5f76 6172 2e64 6174 612c  (coord_var.data,
-00043ed0: 2064 6174 6574 696d 655f 756e 6974 3d64   datetime_unit=d
-00043ee0: 6174 6574 696d 655f 756e 6974 290a 2020  atetime_unit).  
-00043ef0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00043f00: 2020 2020 2076 6172 6961 626c 6573 203d       variables =
-00043f10: 207b 7d0a 2020 2020 2020 2020 636f 6f72   {}.        coor
-00043f20: 645f 6e61 6d65 7320 3d20 7365 7428 290a  d_names = set().
-00043f30: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-00043f40: 2069 6e20 7365 6c66 2e76 6172 6961 626c   in self.variabl
-00043f50: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
-00043f60: 2020 2020 2020 2020 6966 206b 2069 6e20          if k in 
-00043f70: 7365 6c66 2e63 6f6f 7264 733a 0a20 2020  self.coords:.   
-00043f80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00043f90: 6469 6d20 6e6f 7420 696e 2076 2e64 696d  dim not in v.dim
-00043fa0: 7320 6f72 2063 756d 756c 6174 6976 653a  s or cumulative:
-00043fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00043fc0: 2020 2020 2076 6172 6961 626c 6573 5b6b       variables[k
-00043fd0: 5d20 3d20 760a 2020 2020 2020 2020 2020  ] = v.          
-00043fe0: 2020 2020 2020 2020 2020 636f 6f72 645f            coord_
-00043ff0: 6e61 6d65 732e 6164 6428 6b29 0a20 2020  names.add(k).   
-00044000: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00044010: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00044020: 6620 6b20 696e 2073 656c 662e 6461 7461  f k in self.data
-00044030: 5f76 6172 7320 616e 6420 6469 6d20 696e  _vars and dim in
-00044040: 2076 2e64 696d 733a 0a20 2020 2020 2020   v.dims:.       
-00044050: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00044060: 5f63 6f6e 7461 696e 735f 6461 7465 7469  _contains_dateti
-00044070: 6d65 5f6c 696b 655f 6f62 6a65 6374 7328  me_like_objects(
-00044080: 7629 3a0a 2020 2020 2020 2020 2020 2020  v):.            
-00044090: 2020 2020 2020 2020 2020 2020 7620 3d20              v = 
-000440a0: 6461 7465 7469 6d65 5f74 6f5f 6e75 6d65  datetime_to_nume
-000440b0: 7269 6328 762c 2064 6174 6574 696d 655f  ric(v, datetime_
-000440c0: 756e 6974 3d64 6174 6574 696d 655f 756e  unit=datetime_un
-000440d0: 6974 290a 2020 2020 2020 2020 2020 2020  it).            
-000440e0: 2020 2020 2020 2020 6966 2063 756d 756c          if cumul
-000440f0: 6174 6976 653a 0a20 2020 2020 2020 2020  ative:.         
-00044100: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00044110: 6e74 6567 203d 2064 7563 6b5f 6172 7261  nteg = duck_arra
-00044120: 795f 6f70 732e 6375 6d75 6c61 7469 7665  y_ops.cumulative
-00044130: 5f74 7261 7065 7a6f 6964 280a 2020 2020  _trapezoid(.    
-00044140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044150: 2020 2020 2020 2020 762e 6461 7461 2c20          v.data, 
-00044160: 636f 6f72 645f 7661 722e 6461 7461 2c20  coord_var.data, 
-00044170: 6178 6973 3d76 2e67 6574 5f61 7869 735f  axis=v.get_axis_
-00044180: 6e75 6d28 6469 6d29 0a20 2020 2020 2020  num(dim).       
-00044190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000441a0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-000441b0: 2020 2020 2020 2020 2020 2076 5f64 696d             v_dim
-000441c0: 7320 3d20 762e 6469 6d73 0a20 2020 2020  s = v.dims.     
-000441d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000441e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000441f0: 2020 2020 2020 2020 2020 2020 2069 6e74               int
-00044200: 6567 203d 2064 7563 6b5f 6172 7261 795f  eg = duck_array_
-00044210: 6f70 732e 7472 6170 7a28 0a20 2020 2020  ops.trapz(.     
-00044220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044230: 2020 2020 2020 2076 2e64 6174 612c 2063         v.data, c
-00044240: 6f6f 7264 5f76 6172 2e64 6174 612c 2061  oord_var.data, a
-00044250: 7869 733d 762e 6765 745f 6178 6973 5f6e  xis=v.get_axis_n
-00044260: 756d 2864 696d 290a 2020 2020 2020 2020  um(dim).        
+00027f10: 7420 6973 7375 6263 6c61 7373 2869 6e64  t issubclass(ind
+00027f20: 6578 5f63 6c73 2c20 496e 6465 7829 3a0a  ex_cls, Index):.
+00027f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f40: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+00027f50: 6622 7b69 6e64 6578 5f63 6c73 7d20 6973  f"{index_cls} is
+00027f60: 206e 6f74 2061 2073 7562 636c 6173 7320   not a subclass 
+00027f70: 6f66 2078 6172 7261 792e 496e 6465 7822  of xarray.Index"
+00027f80: 290a 0a20 2020 2020 2020 2069 6e76 616c  )..        inval
+00027f90: 6964 5f63 6f6f 7264 7320 3d20 7365 7428  id_coords = set(
+00027fa0: 636f 6f72 645f 6e61 6d65 7329 202d 2073  coord_names) - s
+00027fb0: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
+00027fc0: 0a0a 2020 2020 2020 2020 6966 2069 6e76  ..        if inv
+00027fd0: 616c 6964 5f63 6f6f 7264 733a 0a20 2020  alid_coords:.   
+00027fe0: 2020 2020 2020 2020 206d 7367 203d 205b           msg = [
+00027ff0: 2269 6e76 616c 6964 2063 6f6f 7264 696e  "invalid coordin
+00028000: 6174 6528 7329 225d 0a20 2020 2020 2020  ate(s)"].       
+00028010: 2020 2020 206e 6f5f 7661 7273 203d 2069       no_vars = i
+00028020: 6e76 616c 6964 5f63 6f6f 7264 7320 2d20  nvalid_coords - 
+00028030: 7365 7428 7365 6c66 2e5f 7661 7269 6162  set(self._variab
+00028040: 6c65 7329 0a20 2020 2020 2020 2020 2020  les).           
+00028050: 2064 6174 615f 7661 7273 203d 2069 6e76   data_vars = inv
+00028060: 616c 6964 5f63 6f6f 7264 7320 2d20 6e6f  alid_coords - no
+00028070: 5f76 6172 730a 2020 2020 2020 2020 2020  _vars.          
+00028080: 2020 6966 206e 6f5f 7661 7273 3a0a 2020    if no_vars:.  
+00028090: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
+000280a0: 672e 6170 7065 6e64 2866 2274 686f 7365  g.append(f"those
+000280b0: 2076 6172 6961 626c 6573 2064 6f6e 2774   variables don't
+000280c0: 2065 7869 7374 3a20 7b6e 6f5f 7661 7273   exist: {no_vars
+000280d0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+000280e0: 6966 2064 6174 615f 7661 7273 3a0a 2020  if data_vars:.  
+000280f0: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
+00028100: 672e 6170 7065 6e64 280a 2020 2020 2020  g.append(.      
+00028110: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00028120: 7468 6f73 6520 7661 7269 6162 6c65 7320  those variables 
+00028130: 6172 6520 6461 7461 2076 6172 6961 626c  are data variabl
+00028140: 6573 3a20 7b64 6174 615f 7661 7273 7d2c  es: {data_vars},
+00028150: 2075 7365 2060 7365 745f 636f 6f72 6473   use `set_coords
+00028160: 6020 6669 7273 7422 0a20 2020 2020 2020  ` first".       
+00028170: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00028180: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00028190: 7565 4572 726f 7228 225c 6e22 2e6a 6f69  ueError("\n".joi
+000281a0: 6e28 6d73 6729 290a 0a20 2020 2020 2020  n(msg))..       
+000281b0: 2023 2077 6520 636f 756c 6420 6265 206d   # we could be m
+000281c0: 6f72 6520 636c 6576 6572 2068 6572 6520  ore clever here 
+000281d0: 2865 2e67 2e2c 2064 726f 702d 696e 2069  (e.g., drop-in i
+000281e0: 6e64 6578 2072 6570 6c61 6365 6d65 6e74  ndex replacement
+000281f0: 2069 6620 696e 6465 780a 2020 2020 2020   if index.      
+00028200: 2020 2320 636f 6f72 6469 6e61 7465 7320    # coordinates 
+00028210: 646f 206e 6f74 2063 6f6e 666c 6963 7429  do not conflict)
+00028220: 2c20 6275 7420 6c65 7427 7320 6e6f 7420  , but let's not 
+00028230: 616c 6c6f 7720 7468 6973 2066 6f72 206e  allow this for n
+00028240: 6f77 0a20 2020 2020 2020 2069 6e64 6578  ow.        index
+00028250: 6564 5f63 6f6f 7264 7320 3d20 7365 7428  ed_coords = set(
+00028260: 636f 6f72 645f 6e61 6d65 7329 2026 2073  coord_names) & s
+00028270: 6574 2873 656c 662e 5f69 6e64 6578 6573  et(self._indexes
+00028280: 290a 0a20 2020 2020 2020 2069 6620 696e  )..        if in
+00028290: 6465 7865 645f 636f 6f72 6473 3a0a 2020  dexed_coords:.  
+000282a0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000282b0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+000282c0: 2020 2020 2020 2020 2020 2020 6622 7468              f"th
+000282d0: 6f73 6520 636f 6f72 6469 6e61 7465 7320  ose coordinates 
+000282e0: 616c 7265 6164 7920 6861 7665 2061 6e20  already have an 
+000282f0: 696e 6465 783a 207b 696e 6465 7865 645f  index: {indexed_
+00028300: 636f 6f72 6473 7d22 0a20 2020 2020 2020  coords}".       
+00028310: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00028320: 636f 6f72 645f 7661 7273 203d 207b 6e61  coord_vars = {na
+00028330: 6d65 3a20 7365 6c66 2e5f 7661 7269 6162  me: self._variab
+00028340: 6c65 735b 6e61 6d65 5d20 666f 7220 6e61  les[name] for na
+00028350: 6d65 2069 6e20 636f 6f72 645f 6e61 6d65  me in coord_name
+00028360: 737d 0a0a 2020 2020 2020 2020 696e 6465  s}..        inde
+00028370: 7820 3d20 696e 6465 785f 636c 732e 6672  x = index_cls.fr
+00028380: 6f6d 5f76 6172 6961 626c 6573 2863 6f6f  om_variables(coo
+00028390: 7264 5f76 6172 732c 206f 7074 696f 6e73  rd_vars, options
+000283a0: 3d6f 7074 696f 6e73 290a 0a20 2020 2020  =options)..     
+000283b0: 2020 206e 6577 5f63 6f6f 7264 5f76 6172     new_coord_var
+000283c0: 7320 3d20 696e 6465 782e 6372 6561 7465  s = index.create
+000283d0: 5f76 6172 6961 626c 6573 2863 6f6f 7264  _variables(coord
+000283e0: 5f76 6172 7329 0a0a 2020 2020 2020 2020  _vars)..        
+000283f0: 2320 7370 6563 6961 6c20 6361 7365 2066  # special case f
+00028400: 6f72 2073 6574 7469 6e67 2061 2070 616e  or setting a pan
+00028410: 6461 7320 6d75 6c74 692d 696e 6465 7820  das multi-index 
+00028420: 6672 6f6d 206c 6576 656c 2063 6f6f 7264  from level coord
+00028430: 696e 6174 6573 0a20 2020 2020 2020 2023  inates.        #
+00028440: 2054 4f44 4f3a 2072 656d 6f76 6520 6974   TODO: remove it
+00028450: 206f 6e63 6520 7765 2064 6570 7265 6369   once we depreci
+00028460: 6174 6520 7061 6e64 6173 206d 756c 7469  ate pandas multi
+00028470: 2d69 6e64 6578 2064 696d 656e 7369 6f6e  -index dimension
+00028480: 2028 7475 706c 650a 2020 2020 2020 2020   (tuple.        
+00028490: 2320 656c 656d 656e 7473 2920 636f 6f72  # elements) coor
+000284a0: 6469 6e61 7465 0a20 2020 2020 2020 2069  dinate.        i
+000284b0: 6620 6973 696e 7374 616e 6365 2869 6e64  f isinstance(ind
+000284c0: 6578 2c20 5061 6e64 6173 4d75 6c74 6949  ex, PandasMultiI
+000284d0: 6e64 6578 293a 0a20 2020 2020 2020 2020  ndex):.         
+000284e0: 2020 2063 6f6f 7264 5f6e 616d 6573 203d     coord_names =
+000284f0: 205b 696e 6465 782e 6469 6d5d 202b 206c   [index.dim] + l
+00028500: 6973 7428 636f 6f72 645f 6e61 6d65 7329  ist(coord_names)
+00028510: 0a0a 2020 2020 2020 2020 7661 7269 6162  ..        variab
+00028520: 6c65 733a 2064 6963 745b 4861 7368 6162  les: dict[Hashab
+00028530: 6c65 2c20 5661 7269 6162 6c65 5d0a 2020  le, Variable].  
+00028540: 2020 2020 2020 696e 6465 7865 733a 2064        indexes: d
+00028550: 6963 745b 4861 7368 6162 6c65 2c20 496e  ict[Hashable, In
+00028560: 6465 785d 0a0a 2020 2020 2020 2020 6966  dex]..        if
+00028570: 206c 656e 2863 6f6f 7264 5f6e 616d 6573   len(coord_names
+00028580: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+00028590: 2020 2020 7661 7269 6162 6c65 7320 3d20      variables = 
+000285a0: 7365 6c66 2e5f 7661 7269 6162 6c65 732e  self._variables.
+000285b0: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
+000285c0: 2020 2069 6e64 6578 6573 203d 2073 656c     indexes = sel
+000285d0: 662e 5f69 6e64 6578 6573 2e63 6f70 7928  f._indexes.copy(
+000285e0: 290a 0a20 2020 2020 2020 2020 2020 206e  )..            n
+000285f0: 616d 6520 3d20 6c69 7374 2863 6f6f 7264  ame = list(coord
+00028600: 5f6e 616d 6573 292e 706f 7028 290a 2020  _names).pop().  
+00028610: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
+00028620: 6520 696e 206e 6577 5f63 6f6f 7264 5f76  e in new_coord_v
+00028630: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
+00028640: 2020 2020 2076 6172 6961 626c 6573 5b6e       variables[n
+00028650: 616d 655d 203d 206e 6577 5f63 6f6f 7264  ame] = new_coord
+00028660: 5f76 6172 735b 6e61 6d65 5d0a 2020 2020  _vars[name].    
+00028670: 2020 2020 2020 2020 696e 6465 7865 735b          indexes[
+00028680: 6e61 6d65 5d20 3d20 696e 6465 780a 2020  name] = index.  
+00028690: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000286a0: 2020 2020 2020 2020 2320 7265 6f72 6465          # reorde
+000286b0: 7220 7661 7269 6162 6c65 7320 616e 6420  r variables and 
+000286c0: 696e 6465 7865 7320 736f 2074 6861 7420  indexes so that 
+000286d0: 636f 6f72 6469 6e61 7465 7320 6861 7669  coordinates havi
+000286e0: 6e67 2074 6865 2073 616d 650a 2020 2020  ng the same.    
+000286f0: 2020 2020 2020 2020 2320 696e 6465 7820          # index 
+00028700: 6172 6520 6e65 7874 2074 6f20 6561 6368  are next to each
+00028710: 206f 7468 6572 0a20 2020 2020 2020 2020   other.         
+00028720: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
+00028730: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
+00028740: 7220 6e61 6d65 2c20 7661 7220 696e 2073  r name, var in s
+00028750: 656c 662e 5f76 6172 6961 626c 6573 2e69  elf._variables.i
+00028760: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+00028770: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
+00028780: 6e6f 7420 696e 2063 6f6f 7264 5f6e 616d  not in coord_nam
+00028790: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+000287a0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+000287b0: 735b 6e61 6d65 5d20 3d20 7661 720a 0a20  s[name] = var.. 
+000287c0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+000287d0: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
+000287e0: 2020 2020 666f 7220 6e61 6d65 2c20 6964      for name, id
+000287f0: 7820 696e 2073 656c 662e 5f69 6e64 6578  x in self._index
+00028800: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
+00028810: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00028820: 616d 6520 6e6f 7420 696e 2063 6f6f 7264  ame not in coord
+00028830: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
+00028840: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00028850: 7865 735b 6e61 6d65 5d20 3d20 6964 780a  xes[name] = idx.
+00028860: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00028870: 206e 616d 6520 696e 2063 6f6f 7264 5f6e   name in coord_n
+00028880: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+00028890: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000288a0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+000288b0: 6172 6961 626c 6573 5b6e 616d 655d 203d  ariables[name] =
+000288c0: 206e 6577 5f63 6f6f 7264 5f76 6172 735b   new_coord_vars[
+000288d0: 6e61 6d65 5d0a 2020 2020 2020 2020 2020  name].          
+000288e0: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+000288f0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+00028900: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+00028910: 626c 6573 5b6e 616d 655d 203d 2073 656c  bles[name] = sel
+00028920: 662e 5f76 6172 6961 626c 6573 5b6e 616d  f._variables[nam
+00028930: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+00028940: 2020 2069 6e64 6578 6573 5b6e 616d 655d     indexes[name]
+00028950: 203d 2069 6e64 6578 0a0a 2020 2020 2020   = index..      
+00028960: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+00028970: 6570 6c61 6365 280a 2020 2020 2020 2020  eplace(.        
+00028980: 2020 2020 7661 7269 6162 6c65 733d 7661      variables=va
+00028990: 7269 6162 6c65 732c 0a20 2020 2020 2020  riables,.       
+000289a0: 2020 2020 2063 6f6f 7264 5f6e 616d 6573       coord_names
+000289b0: 3d73 656c 662e 5f63 6f6f 7264 5f6e 616d  =self._coord_nam
+000289c0: 6573 207c 2073 6574 2863 6f6f 7264 5f6e  es | set(coord_n
+000289d0: 616d 6573 292c 0a20 2020 2020 2020 2020  ames),.         
+000289e0: 2020 2069 6e64 6578 6573 3d69 6e64 6578     indexes=index
+000289f0: 6573 2c0a 2020 2020 2020 2020 290a 0a20  es,.        ).. 
+00028a00: 2020 2064 6566 2072 656f 7264 6572 5f6c     def reorder_l
+00028a10: 6576 656c 7328 0a20 2020 2020 2020 2073  evels(.        s
+00028a20: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
+00028a30: 2020 2020 2020 2020 6469 6d5f 6f72 6465          dim_orde
+00028a40: 723a 204d 6170 7069 6e67 5b41 6e79 2c20  r: Mapping[Any, 
+00028a50: 5365 7175 656e 6365 5b69 6e74 207c 2048  Sequence[int | H
+00028a60: 6173 6861 626c 655d 5d20 7c20 4e6f 6e65  ashable]] | None
+00028a70: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00028a80: 202a 2a64 696d 5f6f 7264 6572 5f6b 7761   **dim_order_kwa
+00028a90: 7267 733a 2053 6571 7565 6e63 655b 696e  rgs: Sequence[in
+00028aa0: 7420 7c20 4861 7368 6162 6c65 5d2c 0a20  t | Hashable],. 
+00028ab0: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
+00028ac0: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
+00028ad0: 6172 7261 6e67 6520 696e 6465 7820 6c65  arrange index le
+00028ae0: 7665 6c73 2075 7369 6e67 2069 6e70 7574  vels using input
+00028af0: 206f 7264 6572 2e0a 0a20 2020 2020 2020   order...       
+00028b00: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00028b10: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00028b20: 2020 2020 2020 2064 696d 5f6f 7264 6572         dim_order
+00028b30: 203a 2064 6963 742d 6c69 6b65 206f 6620   : dict-like of 
+00028b40: 4861 7368 6162 6c65 2074 6f20 5365 7175  Hashable to Sequ
+00028b50: 656e 6365 206f 6620 696e 7420 6f72 2048  ence of int or H
+00028b60: 6173 6861 626c 652c 206f 7074 696f 6e61  ashable, optiona
+00028b70: 6c0a 2020 2020 2020 2020 2020 2020 4d61  l.            Ma
+00028b80: 7070 696e 6720 6672 6f6d 206e 616d 6573  pping from names
+00028b90: 206d 6174 6368 696e 6720 6469 6d65 6e73   matching dimens
+00028ba0: 696f 6e73 2061 6e64 2076 616c 7565 7320  ions and values 
+00028bb0: 6769 7665 6e0a 2020 2020 2020 2020 2020  given.          
+00028bc0: 2020 6279 206c 6973 7473 2072 6570 7265    by lists repre
+00028bd0: 7365 6e74 696e 6720 6e65 7720 6c65 7665  senting new leve
+00028be0: 6c20 6f72 6465 7273 2e20 4576 6572 7920  l orders. Every 
+00028bf0: 6769 7665 6e20 6469 6d65 6e73 696f 6e0a  given dimension.
+00028c00: 2020 2020 2020 2020 2020 2020 6d75 7374              must
+00028c10: 2068 6176 6520 6120 6d75 6c74 692d 696e   have a multi-in
+00028c20: 6465 782e 0a20 2020 2020 2020 202a 2a64  dex..        **d
+00028c30: 696d 5f6f 7264 6572 5f6b 7761 7267 7320  im_order_kwargs 
+00028c40: 3a20 5365 7175 656e 6365 206f 6620 696e  : Sequence of in
+00028c50: 7420 6f72 2048 6173 6861 626c 652c 206f  t or Hashable, o
+00028c60: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00028c70: 2020 2020 5468 6520 6b65 7977 6f72 6420      The keyword 
+00028c80: 6172 6775 6d65 6e74 7320 666f 726d 206f  arguments form o
+00028c90: 6620 6060 6469 6d5f 6f72 6465 7260 602e  f ``dim_order``.
+00028ca0: 0a20 2020 2020 2020 2020 2020 204f 6e65  .            One
+00028cb0: 206f 6620 6469 6d5f 6f72 6465 7220 6f72   of dim_order or
+00028cc0: 2064 696d 5f6f 7264 6572 5f6b 7761 7267   dim_order_kwarg
+00028cd0: 7320 6d75 7374 2062 6520 7072 6f76 6964  s must be provid
+00028ce0: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
+00028cf0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+00028d00: 2d2d 2d2d 0a20 2020 2020 2020 206f 626a  ----.        obj
+00028d10: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
+00028d20: 2020 2020 2020 2041 6e6f 7468 6572 2064         Another d
+00028d30: 6174 6173 6574 2c20 7769 7468 2074 6869  ataset, with thi
+00028d40: 7320 6461 7461 7365 7427 7320 6461 7461  s dataset's data
+00028d50: 2062 7574 2072 6570 6c61 6365 640a 2020   but replaced.  
+00028d60: 2020 2020 2020 2020 2020 636f 6f72 6469            coordi
+00028d70: 6e61 7465 732e 0a20 2020 2020 2020 2022  nates..        "
+00028d80: 2222 0a20 2020 2020 2020 2064 696d 5f6f  "".        dim_o
+00028d90: 7264 6572 203d 2065 6974 6865 725f 6469  rder = either_di
+00028da0: 6374 5f6f 725f 6b77 6172 6773 2864 696d  ct_or_kwargs(dim
+00028db0: 5f6f 7264 6572 2c20 6469 6d5f 6f72 6465  _order, dim_orde
+00028dc0: 725f 6b77 6172 6773 2c20 2272 656f 7264  r_kwargs, "reord
+00028dd0: 6572 5f6c 6576 656c 7322 290a 2020 2020  er_levels").    
+00028de0: 2020 2020 7661 7269 6162 6c65 7320 3d20      variables = 
+00028df0: 7365 6c66 2e5f 7661 7269 6162 6c65 732e  self._variables.
+00028e00: 636f 7079 2829 0a20 2020 2020 2020 2069  copy().        i
+00028e10: 6e64 6578 6573 203d 2064 6963 7428 7365  ndexes = dict(se
+00028e20: 6c66 2e5f 696e 6465 7865 7329 0a20 2020  lf._indexes).   
+00028e30: 2020 2020 206e 6577 5f69 6e64 6578 6573       new_indexes
+00028e40: 3a20 6469 6374 5b48 6173 6861 626c 652c  : dict[Hashable,
+00028e50: 2049 6e64 6578 5d20 3d20 7b7d 0a20 2020   Index] = {}.   
+00028e60: 2020 2020 206e 6577 5f76 6172 6961 626c       new_variabl
+00028e70: 6573 3a20 6469 6374 5b48 6173 6861 626c  es: dict[Hashabl
+00028e80: 652c 2049 6e64 6578 5661 7269 6162 6c65  e, IndexVariable
+00028e90: 5d20 3d20 7b7d 0a0a 2020 2020 2020 2020  ] = {}..        
+00028ea0: 666f 7220 6469 6d2c 206f 7264 6572 2069  for dim, order i
+00028eb0: 6e20 6469 6d5f 6f72 6465 722e 6974 656d  n dim_order.item
+00028ec0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00028ed0: 2069 6e64 6578 203d 2073 656c 662e 5f69   index = self._i
+00028ee0: 6e64 6578 6573 5b64 696d 5d0a 0a20 2020  ndexes[dim]..   
+00028ef0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00028f00: 6973 696e 7374 616e 6365 2869 6e64 6578  isinstance(index
+00028f10: 2c20 5061 6e64 6173 4d75 6c74 6949 6e64  , PandasMultiInd
+00028f20: 6578 293a 0a20 2020 2020 2020 2020 2020  ex):.           
+00028f30: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00028f40: 4572 726f 7228 6622 636f 6f72 6469 6e61  Error(f"coordina
+00028f50: 7465 207b 6469 6d7d 2068 6173 206e 6f20  te {dim} has no 
+00028f60: 4d75 6c74 6949 6e64 6578 2229 0a0a 2020  MultiIndex")..  
+00028f70: 2020 2020 2020 2020 2020 6c65 7665 6c5f            level_
+00028f80: 7661 7273 203d 207b 6b3a 2073 656c 662e  vars = {k: self.
+00028f90: 5f76 6172 6961 626c 6573 5b6b 5d20 666f  _variables[k] fo
+00028fa0: 7220 6b20 696e 206f 7264 6572 7d0a 2020  r k in order}.  
+00028fb0: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
+00028fc0: 696e 6465 782e 7265 6f72 6465 725f 6c65  index.reorder_le
+00028fd0: 7665 6c73 286c 6576 656c 5f76 6172 7329  vels(level_vars)
+00028fe0: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
+00028ff0: 5f76 6172 7320 3d20 6964 782e 6372 6561  _vars = idx.crea
+00029000: 7465 5f76 6172 6961 626c 6573 286c 6576  te_variables(lev
+00029010: 656c 5f76 6172 7329 0a20 2020 2020 2020  el_vars).       
+00029020: 2020 2020 206e 6577 5f69 6e64 6578 6573       new_indexes
+00029030: 2e75 7064 6174 6528 7b6b 3a20 6964 7820  .update({k: idx 
+00029040: 666f 7220 6b20 696e 2069 6478 5f76 6172  for k in idx_var
+00029050: 737d 290a 2020 2020 2020 2020 2020 2020  s}).            
+00029060: 6e65 775f 7661 7269 6162 6c65 732e 7570  new_variables.up
+00029070: 6461 7465 2869 6478 5f76 6172 7329 0a0a  date(idx_vars)..
+00029080: 2020 2020 2020 2020 696e 6465 7865 7320          indexes 
+00029090: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
+000290a0: 2069 6e20 7365 6c66 2e5f 696e 6465 7865   in self._indexe
+000290b0: 732e 6974 656d 7328 2920 6966 206b 206e  s.items() if k n
+000290c0: 6f74 2069 6e20 6e65 775f 696e 6465 7865  ot in new_indexe
+000290d0: 737d 0a20 2020 2020 2020 2069 6e64 6578  s}.        index
+000290e0: 6573 2e75 7064 6174 6528 6e65 775f 696e  es.update(new_in
+000290f0: 6465 7865 7329 0a0a 2020 2020 2020 2020  dexes)..        
+00029100: 7661 7269 6162 6c65 7320 3d20 7b6b 3a20  variables = {k: 
+00029110: 7620 666f 7220 6b2c 2076 2069 6e20 7365  v for k, v in se
+00029120: 6c66 2e5f 7661 7269 6162 6c65 732e 6974  lf._variables.it
+00029130: 656d 7328 2920 6966 206b 206e 6f74 2069  ems() if k not i
+00029140: 6e20 6e65 775f 7661 7269 6162 6c65 737d  n new_variables}
+00029150: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
+00029160: 6573 2e75 7064 6174 6528 6e65 775f 7661  es.update(new_va
+00029170: 7269 6162 6c65 7329 0a0a 2020 2020 2020  riables)..      
+00029180: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+00029190: 6570 6c61 6365 2876 6172 6961 626c 6573  eplace(variables
+000291a0: 2c20 696e 6465 7865 733d 696e 6465 7865  , indexes=indexe
+000291b0: 7329 0a0a 2020 2020 6465 6620 5f67 6574  s)..    def _get
+000291c0: 5f73 7461 636b 5f69 6e64 6578 280a 2020  _stack_index(.  
+000291d0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+000291e0: 2020 2020 6469 6d2c 0a20 2020 2020 2020      dim,.       
+000291f0: 206d 756c 7469 3d46 616c 7365 2c0a 2020   multi=False,.  
+00029200: 2020 2020 2020 6372 6561 7465 5f69 6e64        create_ind
+00029210: 6578 3d46 616c 7365 2c0a 2020 2020 2920  ex=False,.    ) 
+00029220: 2d3e 2074 7570 6c65 5b49 6e64 6578 207c  -> tuple[Index |
+00029230: 204e 6f6e 652c 2064 6963 745b 4861 7368   None, dict[Hash
+00029240: 6162 6c65 2c20 5661 7269 6162 6c65 5d5d  able, Variable]]
+00029250: 3a0a 2020 2020 2020 2020 2222 2255 7365  :.        """Use
+00029260: 6420 6279 2073 7461 636b 2061 6e64 2075  d by stack and u
+00029270: 6e73 7461 636b 2074 6f20 6765 7420 6f6e  nstack to get on
+00029280: 6520 7061 6e64 6173 2028 6d75 6c74 692d  e pandas (multi-
+00029290: 2969 6e64 6578 2061 6d6f 6e67 0a20 2020  )index among.   
+000292a0: 2020 2020 2074 6865 2069 6e64 6578 6564       the indexed
+000292b0: 2063 6f6f 7264 696e 6174 6573 2061 6c6f   coordinates alo
+000292c0: 6e67 2064 696d 656e 7369 6f6e 2060 6469  ng dimension `di
+000292d0: 6d60 2e0a 0a20 2020 2020 2020 2049 6620  m`...        If 
+000292e0: 6578 6163 746c 7920 6f6e 6520 696e 6465  exactly one inde
+000292f0: 7820 6973 2066 6f75 6e64 2c20 7265 7475  x is found, retu
+00029300: 726e 2069 7420 7769 7468 2069 7473 2063  rn it with its c
+00029310: 6f72 7265 7370 6f6e 6469 6e67 0a20 2020  orresponding.   
+00029320: 2020 2020 2063 6f6f 7264 696e 6174 6520       coordinate 
+00029330: 7661 7269 6162 6c65 7328 7329 2c20 6f74  variables(s), ot
+00029340: 6865 7277 6973 6520 7265 7475 726e 204e  herwise return N
+00029350: 6f6e 6520 616e 6420 616e 2065 6d70 7479  one and an empty
+00029360: 2064 6963 742e 0a0a 2020 2020 2020 2020   dict...        
+00029370: 4966 2060 6372 6561 7465 5f69 6e64 6578  If `create_index
+00029380: 3d54 7275 6560 2c20 6372 6561 7465 2061  =True`, create a
+00029390: 206e 6577 2069 6e64 6578 2069 6620 6e6f   new index if no
+000293a0: 6e65 2069 7320 666f 756e 6420 6f72 2072  ne is found or r
+000293b0: 6169 7365 0a20 2020 2020 2020 2061 6e20  aise.        an 
+000293c0: 6572 726f 7220 6966 206d 756c 7469 706c  error if multipl
+000293d0: 6520 696e 6465 7865 7320 6172 6520 666f  e indexes are fo
+000293e0: 756e 642e 0a0a 2020 2020 2020 2020 2222  und...        ""
+000293f0: 220a 2020 2020 2020 2020 7374 6163 6b5f  ".        stack_
+00029400: 696e 6465 783a 2049 6e64 6578 207c 204e  index: Index | N
+00029410: 6f6e 6520 3d20 4e6f 6e65 0a20 2020 2020  one = None.     
+00029420: 2020 2073 7461 636b 5f63 6f6f 7264 733a     stack_coords:
+00029430: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
+00029440: 5661 7269 6162 6c65 5d20 3d20 7b7d 0a0a  Variable] = {}..
+00029450: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
+00029460: 2c20 696e 6465 7820 696e 2073 656c 662e  , index in self.
+00029470: 5f69 6e64 6578 6573 2e69 7465 6d73 2829  _indexes.items()
+00029480: 3a0a 2020 2020 2020 2020 2020 2020 7661  :.            va
+00029490: 7220 3d20 7365 6c66 2e5f 7661 7269 6162  r = self._variab
+000294a0: 6c65 735b 6e61 6d65 5d0a 2020 2020 2020  les[name].      
+000294b0: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+000294c0: 2020 2020 2020 2020 2020 2076 6172 2e6e             var.n
+000294d0: 6469 6d20 3d3d 2031 0a20 2020 2020 2020  dim == 1.       
+000294e0: 2020 2020 2020 2020 2061 6e64 2076 6172           and var
+000294f0: 2e64 696d 735b 305d 203d 3d20 6469 6d0a  .dims[0] == dim.
+00029500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029510: 616e 6420 280a 2020 2020 2020 2020 2020  and (.          
+00029520: 2020 2020 2020 2020 2020 2320 7374 6163            # stac
+00029530: 6b3a 206d 7573 7420 6265 2061 2073 696e  k: must be a sin
+00029540: 676c 6520 636f 6f72 6469 6e61 7465 2069  gle coordinate i
+00029550: 6e64 6578 0a20 2020 2020 2020 2020 2020  ndex.           
+00029560: 2020 2020 2020 2020 206e 6f74 206d 756c           not mul
+00029570: 7469 0a20 2020 2020 2020 2020 2020 2020  ti.             
+00029580: 2020 2020 2020 2061 6e64 206e 6f74 2073         and not s
+00029590: 656c 662e 7869 6e64 6578 6573 2e69 735f  elf.xindexes.is_
+000295a0: 6d75 6c74 6928 6e61 6d65 290a 2020 2020  multi(name).    
+000295b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000295c0: 2320 756e 7374 6163 6b3a 206d 7573 7420  # unstack: must 
+000295d0: 6265 2061 6e20 696e 6465 7820 7468 6174  be an index that
+000295e0: 2069 6d70 6c65 6d65 6e74 7320 2e75 6e73   implements .uns
+000295f0: 7461 636b 0a20 2020 2020 2020 2020 2020  tack.           
+00029600: 2020 2020 2020 2020 206f 7220 6d75 6c74           or mult
+00029610: 690a 2020 2020 2020 2020 2020 2020 2020  i.              
+00029620: 2020 2020 2020 616e 6420 7479 7065 2869        and type(i
+00029630: 6e64 6578 292e 756e 7374 6163 6b20 6973  ndex).unstack is
+00029640: 206e 6f74 2049 6e64 6578 2e75 6e73 7461   not Index.unsta
+00029650: 636b 0a20 2020 2020 2020 2020 2020 2020  ck.             
+00029660: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00029670: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00029680: 2020 2020 6966 2073 7461 636b 5f69 6e64      if stack_ind
+00029690: 6578 2069 7320 6e6f 7420 4e6f 6e65 2061  ex is not None a
+000296a0: 6e64 2069 6e64 6578 2069 7320 6e6f 7420  nd index is not 
+000296b0: 7374 6163 6b5f 696e 6465 783a 0a20 2020  stack_index:.   
+000296c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000296d0: 2023 206d 6f72 6520 7468 616e 206f 6e65   # more than one
+000296e0: 2069 6e64 6578 2066 6f75 6e64 2c20 7374   index found, st
+000296f0: 6f70 0a20 2020 2020 2020 2020 2020 2020  op.             
+00029700: 2020 2020 2020 2069 6620 6372 6561 7465         if create
+00029710: 5f69 6e64 6578 3a0a 2020 2020 2020 2020  _index:.        
+00029720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029730: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00029740: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00029750: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00029760: 6361 6e6e 6f74 2073 7461 636b 2064 696d  cannot stack dim
+00029770: 656e 7369 6f6e 207b 6469 6d21 727d 2077  ension {dim!r} w
+00029780: 6974 6820 6063 7265 6174 655f 696e 6465  ith `create_inde
+00029790: 783d 5472 7565 6020 220a 2020 2020 2020  x=True` ".      
+000297a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000297b0: 2020 2020 2020 2261 6e64 2077 6974 6820        "and with 
+000297c0: 6d6f 7265 2074 6861 6e20 6f6e 6520 696e  more than one in
+000297d0: 6465 7820 666f 756e 6420 616c 6f6e 6720  dex found along 
+000297e0: 7468 6174 2064 696d 656e 7369 6f6e 220a  that dimension".
+000297f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029800: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00029810: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00029820: 7475 726e 204e 6f6e 652c 207b 7d0a 2020  turn None, {}.  
+00029830: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00029840: 6163 6b5f 696e 6465 7820 3d20 696e 6465  ack_index = inde
+00029850: 780a 2020 2020 2020 2020 2020 2020 2020  x.              
+00029860: 2020 7374 6163 6b5f 636f 6f72 6473 5b6e    stack_coords[n
+00029870: 616d 655d 203d 2076 6172 0a0a 2020 2020  ame] = var..    
+00029880: 2020 2020 6966 2063 7265 6174 655f 696e      if create_in
+00029890: 6465 7820 616e 6420 7374 6163 6b5f 696e  dex and stack_in
+000298a0: 6465 7820 6973 204e 6f6e 653a 0a20 2020  dex is None:.   
+000298b0: 2020 2020 2020 2020 2069 6620 6469 6d20           if dim 
+000298c0: 696e 2073 656c 662e 5f76 6172 6961 626c  in self._variabl
+000298d0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+000298e0: 2020 2020 7661 7220 3d20 7365 6c66 2e5f      var = self._
+000298f0: 7661 7269 6162 6c65 735b 6469 6d5d 0a20  variables[dim]. 
+00029900: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00029910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029920: 205f 2c20 5f2c 2076 6172 203d 205f 6765   _, _, var = _ge
+00029930: 745f 7669 7274 7561 6c5f 7661 7269 6162  t_virtual_variab
+00029940: 6c65 2873 656c 662e 5f76 6172 6961 626c  le(self._variabl
+00029950: 6573 2c20 6469 6d2c 2073 656c 662e 6469  es, dim, self.di
+00029960: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
+00029970: 2320 6475 6d6d 7920 696e 6465 7820 286f  # dummy index (o
+00029980: 6e6c 7920 6073 7461 636b 5f63 6f6f 7264  nly `stack_coord
+00029990: 7360 2077 696c 6c20 6265 2075 7365 6420  s` will be used 
+000299a0: 746f 2063 6f6e 7374 7275 6374 2074 6865  to construct the
+000299b0: 206d 756c 7469 2d69 6e64 6578 290a 2020   multi-index).  
+000299c0: 2020 2020 2020 2020 2020 7374 6163 6b5f            stack_
+000299d0: 696e 6465 7820 3d20 5061 6e64 6173 496e  index = PandasIn
+000299e0: 6465 7828 5b30 5d2c 2064 696d 290a 2020  dex([0], dim).  
+000299f0: 2020 2020 2020 2020 2020 7374 6163 6b5f            stack_
+00029a00: 636f 6f72 6473 203d 207b 6469 6d3a 2076  coords = {dim: v
+00029a10: 6172 7d0a 0a20 2020 2020 2020 2072 6574  ar}..        ret
+00029a20: 7572 6e20 7374 6163 6b5f 696e 6465 782c  urn stack_index,
+00029a30: 2073 7461 636b 5f63 6f6f 7264 730a 0a20   stack_coords.. 
+00029a40: 2020 2064 6566 205f 7374 6163 6b5f 6f6e     def _stack_on
+00029a50: 6365 280a 2020 2020 2020 2020 7365 6c66  ce(.        self
+00029a60: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
+00029a70: 2020 2020 2064 696d 733a 2053 6571 7565       dims: Seque
+00029a80: 6e63 655b 4861 7368 6162 6c65 207c 2065  nce[Hashable | e
+00029a90: 6c6c 6970 7369 735d 2c0a 2020 2020 2020  llipsis],.      
+00029aa0: 2020 6e65 775f 6469 6d3a 2048 6173 6861    new_dim: Hasha
+00029ab0: 626c 652c 0a20 2020 2020 2020 2069 6e64  ble,.        ind
+00029ac0: 6578 5f63 6c73 3a20 7479 7065 5b49 6e64  ex_cls: type[Ind
+00029ad0: 6578 5d2c 0a20 2020 2020 2020 2063 7265  ex],.        cre
+00029ae0: 6174 655f 696e 6465 783a 2062 6f6f 6c20  ate_index: bool 
+00029af0: 7c20 4e6f 6e65 203d 2054 7275 652c 0a20  | None = True,. 
+00029b00: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
+00029b10: 743a 0a20 2020 2020 2020 2069 6620 6469  t:.        if di
+00029b20: 6d73 203d 3d20 2e2e 2e3a 0a20 2020 2020  ms == ...:.     
+00029b30: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00029b40: 7565 4572 726f 7228 2250 6c65 6173 6520  ueError("Please 
+00029b50: 7573 6520 5b2e 2e2e 5d20 666f 7220 6469  use [...] for di
+00029b60: 6d73 2c20 7261 7468 6572 2074 6861 6e20  ms, rather than 
+00029b70: 6a75 7374 202e 2e2e 2229 0a20 2020 2020  just ...").     
+00029b80: 2020 2069 6620 2e2e 2e20 696e 2064 696d     if ... in dim
+00029b90: 733a 0a20 2020 2020 2020 2020 2020 2064  s:.            d
+00029ba0: 696d 7320 3d20 6c69 7374 2869 6e66 6978  ims = list(infix
+00029bb0: 5f64 696d 7328 6469 6d73 2c20 7365 6c66  _dims(dims, self
+00029bc0: 2e64 696d 7329 290a 0a20 2020 2020 2020  .dims))..       
+00029bd0: 206e 6577 5f76 6172 6961 626c 6573 3a20   new_variables: 
+00029be0: 6469 6374 5b48 6173 6861 626c 652c 2056  dict[Hashable, V
+00029bf0: 6172 6961 626c 655d 203d 207b 7d0a 2020  ariable] = {}.  
+00029c00: 2020 2020 2020 7374 6163 6b65 645f 7661        stacked_va
+00029c10: 725f 6e61 6d65 733a 206c 6973 745b 4861  r_names: list[Ha
+00029c20: 7368 6162 6c65 5d20 3d20 5b5d 0a20 2020  shable] = [].   
+00029c30: 2020 2020 2064 726f 705f 696e 6465 7865       drop_indexe
+00029c40: 733a 206c 6973 745b 4861 7368 6162 6c65  s: list[Hashable
+00029c50: 5d20 3d20 5b5d 0a0a 2020 2020 2020 2020  ] = []..        
+00029c60: 666f 7220 6e61 6d65 2c20 7661 7220 696e  for name, var in
+00029c70: 2073 656c 662e 7661 7269 6162 6c65 732e   self.variables.
+00029c80: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+00029c90: 2020 2020 2069 6620 616e 7928 6420 696e       if any(d in
+00029ca0: 2076 6172 2e64 696d 7320 666f 7220 6420   var.dims for d 
+00029cb0: 696e 2064 696d 7329 3a0a 2020 2020 2020  in dims):.      
+00029cc0: 2020 2020 2020 2020 2020 6164 645f 6469            add_di
+00029cd0: 6d73 203d 205b 6420 666f 7220 6420 696e  ms = [d for d in
+00029ce0: 2064 696d 7320 6966 2064 206e 6f74 2069   dims if d not i
+00029cf0: 6e20 7661 722e 6469 6d73 5d0a 2020 2020  n var.dims].    
+00029d00: 2020 2020 2020 2020 2020 2020 7664 696d              vdim
+00029d10: 7320 3d20 6c69 7374 2876 6172 2e64 696d  s = list(var.dim
+00029d20: 7329 202b 2061 6464 5f64 696d 730a 2020  s) + add_dims.  
+00029d30: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00029d40: 6170 6520 3d20 5b73 656c 662e 6469 6d73  ape = [self.dims
+00029d50: 5b64 5d20 666f 7220 6420 696e 2076 6469  [d] for d in vdi
+00029d60: 6d73 5d0a 2020 2020 2020 2020 2020 2020  ms].            
+00029d70: 2020 2020 6578 705f 7661 7220 3d20 7661      exp_var = va
+00029d80: 722e 7365 745f 6469 6d73 2876 6469 6d73  r.set_dims(vdims
+00029d90: 2c20 7368 6170 6529 0a20 2020 2020 2020  , shape).       
+00029da0: 2020 2020 2020 2020 2073 7461 636b 6564           stacked
+00029db0: 5f76 6172 203d 2065 7870 5f76 6172 2e73  _var = exp_var.s
+00029dc0: 7461 636b 282a 2a7b 6e65 775f 6469 6d3a  tack(**{new_dim:
+00029dd0: 2064 696d 737d 290a 2020 2020 2020 2020   dims}).        
+00029de0: 2020 2020 2020 2020 6e65 775f 7661 7269          new_vari
+00029df0: 6162 6c65 735b 6e61 6d65 5d20 3d20 7374  ables[name] = st
+00029e00: 6163 6b65 645f 7661 720a 2020 2020 2020  acked_var.      
+00029e10: 2020 2020 2020 2020 2020 7374 6163 6b65            stacke
+00029e20: 645f 7661 725f 6e61 6d65 732e 6170 7065  d_var_names.appe
+00029e30: 6e64 286e 616d 6529 0a20 2020 2020 2020  nd(name).       
+00029e40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00029e50: 2020 2020 2020 2020 2020 206e 6577 5f76             new_v
+00029e60: 6172 6961 626c 6573 5b6e 616d 655d 203d  ariables[name] =
+00029e70: 2076 6172 2e63 6f70 7928 6465 6570 3d46   var.copy(deep=F
+00029e80: 616c 7365 290a 0a20 2020 2020 2020 2023  alse)..        #
+00029e90: 2064 726f 7020 696e 6465 7865 7320 6f66   drop indexes of
+00029ea0: 2073 7461 636b 6564 2063 6f6f 7264 696e   stacked coordin
+00029eb0: 6174 6573 2028 6966 2061 6e79 290a 2020  ates (if any).  
+00029ec0: 2020 2020 2020 666f 7220 6e61 6d65 2069        for name i
+00029ed0: 6e20 7374 6163 6b65 645f 7661 725f 6e61  n stacked_var_na
+00029ee0: 6d65 733a 0a20 2020 2020 2020 2020 2020  mes:.           
+00029ef0: 2064 726f 705f 696e 6465 7865 7320 2b3d   drop_indexes +=
+00029f00: 206c 6973 7428 7365 6c66 2e78 696e 6465   list(self.xinde
+00029f10: 7865 732e 6765 745f 616c 6c5f 636f 6f72  xes.get_all_coor
+00029f20: 6473 286e 616d 652c 2065 7272 6f72 733d  ds(name, errors=
+00029f30: 2269 676e 6f72 6522 2929 0a0a 2020 2020  "ignore"))..    
+00029f40: 2020 2020 6e65 775f 696e 6465 7865 7320      new_indexes 
+00029f50: 3d20 7b7d 0a20 2020 2020 2020 206e 6577  = {}.        new
+00029f60: 5f63 6f6f 7264 5f6e 616d 6573 203d 2073  _coord_names = s
+00029f70: 6574 2873 656c 662e 5f63 6f6f 7264 5f6e  et(self._coord_n
+00029f80: 616d 6573 290a 2020 2020 2020 2020 6966  ames).        if
+00029f90: 2063 7265 6174 655f 696e 6465 7820 6f72   create_index or
+00029fa0: 2063 7265 6174 655f 696e 6465 7820 6973   create_index is
+00029fb0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00029fc0: 2020 2070 726f 6475 6374 5f76 6172 733a     product_vars:
+00029fd0: 2064 6963 745b 416e 792c 2056 6172 6961   dict[Any, Varia
+00029fe0: 626c 655d 203d 207b 7d0a 2020 2020 2020  ble] = {}.      
+00029ff0: 2020 2020 2020 666f 7220 6469 6d20 696e        for dim in
+0002a000: 2064 696d 733a 0a20 2020 2020 2020 2020   dims:.         
+0002a010: 2020 2020 2020 2069 6478 2c20 6964 785f         idx, idx_
+0002a020: 7661 7273 203d 2073 656c 662e 5f67 6574  vars = self._get
+0002a030: 5f73 7461 636b 5f69 6e64 6578 2864 696d  _stack_index(dim
+0002a040: 2c20 6372 6561 7465 5f69 6e64 6578 3d63  , create_index=c
+0002a050: 7265 6174 655f 696e 6465 7829 0a20 2020  reate_index).   
+0002a060: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0002a070: 6964 7820 6973 206e 6f74 204e 6f6e 653a  idx is not None:
+0002a080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a090: 2020 2020 2070 726f 6475 6374 5f76 6172       product_var
+0002a0a0: 732e 7570 6461 7465 2869 6478 5f76 6172  s.update(idx_var
+0002a0b0: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+0002a0c0: 6966 206c 656e 2870 726f 6475 6374 5f76  if len(product_v
+0002a0d0: 6172 7329 203d 3d20 6c65 6e28 6469 6d73  ars) == len(dims
+0002a0e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0002a0f0: 2020 2069 6478 203d 2069 6e64 6578 5f63     idx = index_c
+0002a100: 6c73 2e73 7461 636b 2870 726f 6475 6374  ls.stack(product
+0002a110: 5f76 6172 732c 206e 6577 5f64 696d 290a  _vars, new_dim).
+0002a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a130: 6e65 775f 696e 6465 7865 735b 6e65 775f  new_indexes[new_
+0002a140: 6469 6d5d 203d 2069 6478 0a20 2020 2020  dim] = idx.     
+0002a150: 2020 2020 2020 2020 2020 206e 6577 5f69             new_i
+0002a160: 6e64 6578 6573 2e75 7064 6174 6528 7b6b  ndexes.update({k
+0002a170: 3a20 6964 7820 666f 7220 6b20 696e 2070  : idx for k in p
+0002a180: 726f 6475 6374 5f76 6172 737d 290a 2020  roduct_vars}).  
+0002a190: 2020 2020 2020 2020 2020 2020 2020 6964                id
+0002a1a0: 785f 7661 7273 203d 2069 6478 2e63 7265  x_vars = idx.cre
+0002a1b0: 6174 655f 7661 7269 6162 6c65 7328 7072  ate_variables(pr
+0002a1c0: 6f64 7563 745f 7661 7273 290a 2020 2020  oduct_vars).    
+0002a1d0: 2020 2020 2020 2020 2020 2020 2320 6b65              # ke
+0002a1e0: 6570 2063 6f6e 7369 7374 656e 7420 6d75  ep consistent mu
+0002a1f0: 6c74 692d 696e 6465 7820 636f 6f72 6469  lti-index coordi
+0002a200: 6e61 7465 206f 7264 6572 0a20 2020 2020  nate order.     
+0002a210: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+0002a220: 2069 6e20 6964 785f 7661 7273 3a0a 2020   in idx_vars:.  
+0002a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a240: 2020 6e65 775f 7661 7269 6162 6c65 732e    new_variables.
+0002a250: 706f 7028 6b2c 204e 6f6e 6529 0a20 2020  pop(k, None).   
+0002a260: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0002a270: 5f76 6172 6961 626c 6573 2e75 7064 6174  _variables.updat
+0002a280: 6528 6964 785f 7661 7273 290a 2020 2020  e(idx_vars).    
+0002a290: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0002a2a0: 636f 6f72 645f 6e61 6d65 732e 7570 6461  coord_names.upda
+0002a2b0: 7465 2869 6478 5f76 6172 7329 0a0a 2020  te(idx_vars)..  
+0002a2c0: 2020 2020 2020 696e 6465 7865 7320 3d20        indexes = 
+0002a2d0: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
+0002a2e0: 6e20 7365 6c66 2e5f 696e 6465 7865 732e  n self._indexes.
+0002a2f0: 6974 656d 7328 2920 6966 206b 206e 6f74  items() if k not
+0002a300: 2069 6e20 6472 6f70 5f69 6e64 6578 6573   in drop_indexes
+0002a310: 7d0a 2020 2020 2020 2020 696e 6465 7865  }.        indexe
+0002a320: 732e 7570 6461 7465 286e 6577 5f69 6e64  s.update(new_ind
+0002a330: 6578 6573 290a 0a20 2020 2020 2020 2072  exes)..        r
+0002a340: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
+0002a350: 6163 655f 7769 7468 5f6e 6577 5f64 696d  ace_with_new_dim
+0002a360: 7328 0a20 2020 2020 2020 2020 2020 206e  s(.            n
+0002a370: 6577 5f76 6172 6961 626c 6573 2c20 636f  ew_variables, co
+0002a380: 6f72 645f 6e61 6d65 733d 6e65 775f 636f  ord_names=new_co
+0002a390: 6f72 645f 6e61 6d65 732c 2069 6e64 6578  ord_names, index
+0002a3a0: 6573 3d69 6e64 6578 6573 0a20 2020 2020  es=indexes.     
+0002a3b0: 2020 2029 0a0a 2020 2020 6465 6620 7374     )..    def st
+0002a3c0: 6163 6b28 0a20 2020 2020 2020 2073 656c  ack(.        sel
+0002a3d0: 663a 2054 5f44 6174 6173 6574 2c0a 2020  f: T_Dataset,.  
+0002a3e0: 2020 2020 2020 6469 6d65 6e73 696f 6e73        dimensions
+0002a3f0: 3a20 4d61 7070 696e 675b 416e 792c 2053  : Mapping[Any, S
+0002a400: 6571 7565 6e63 655b 4861 7368 6162 6c65  equence[Hashable
+0002a410: 207c 2065 6c6c 6970 7369 735d 5d20 7c20   | ellipsis]] | 
+0002a420: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+0002a430: 2020 2020 2063 7265 6174 655f 696e 6465       create_inde
+0002a440: 783a 2062 6f6f 6c20 7c20 4e6f 6e65 203d  x: bool | None =
+0002a450: 2054 7275 652c 0a20 2020 2020 2020 2069   True,.        i
+0002a460: 6e64 6578 5f63 6c73 3a20 7479 7065 5b49  ndex_cls: type[I
+0002a470: 6e64 6578 5d20 3d20 5061 6e64 6173 4d75  ndex] = PandasMu
+0002a480: 6c74 6949 6e64 6578 2c0a 2020 2020 2020  ltiIndex,.      
+0002a490: 2020 2a2a 6469 6d65 6e73 696f 6e73 5f6b    **dimensions_k
+0002a4a0: 7761 7267 733a 2053 6571 7565 6e63 655b  wargs: Sequence[
+0002a4b0: 4861 7368 6162 6c65 207c 2065 6c6c 6970  Hashable | ellip
+0002a4c0: 7369 735d 2c0a 2020 2020 2920 2d3e 2054  sis],.    ) -> T
+0002a4d0: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
+0002a4e0: 2020 2222 220a 2020 2020 2020 2020 5374    """.        St
+0002a4f0: 6163 6b20 616e 7920 6e75 6d62 6572 206f  ack any number o
+0002a500: 6620 6578 6973 7469 6e67 2064 696d 656e  f existing dimen
+0002a510: 7369 6f6e 7320 696e 746f 2061 2073 696e  sions into a sin
+0002a520: 676c 6520 6e65 7720 6469 6d65 6e73 696f  gle new dimensio
+0002a530: 6e2e 0a0a 2020 2020 2020 2020 4e65 7720  n...        New 
+0002a540: 6469 6d65 6e73 696f 6e73 2077 696c 6c20  dimensions will 
+0002a550: 6265 2061 6464 6564 2061 7420 7468 6520  be added at the 
+0002a560: 656e 642c 2061 6e64 2062 7920 6465 6661  end, and by defa
+0002a570: 756c 7420 7468 6520 636f 7272 6573 706f  ult the correspo
+0002a580: 6e64 696e 670a 2020 2020 2020 2020 636f  nding.        co
+0002a590: 6f72 6469 6e61 7465 2076 6172 6961 626c  ordinate variabl
+0002a5a0: 6573 2077 696c 6c20 6265 2063 6f6d 6269  es will be combi
+0002a5b0: 6e65 6420 696e 746f 2061 204d 756c 7469  ned into a Multi
+0002a5c0: 496e 6465 782e 0a0a 2020 2020 2020 2020  Index...        
+0002a5d0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+0002a5e0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0002a5f0: 2020 2020 2020 6469 6d65 6e73 696f 6e73        dimensions
+0002a600: 203a 206d 6170 7069 6e67 206f 6620 6861   : mapping of ha
+0002a610: 7368 6162 6c65 2074 6f20 7365 7175 656e  shable to sequen
+0002a620: 6365 206f 6620 6861 7368 6162 6c65 0a20  ce of hashable. 
+0002a630: 2020 2020 2020 2020 2020 204d 6170 7069             Mappi
+0002a640: 6e67 206f 6620 7468 6520 666f 726d 2060  ng of the form `
+0002a650: 6e65 775f 6e61 6d65 3d28 6469 6d31 2c20  new_name=(dim1, 
+0002a660: 6469 6d32 2c20 2e2e 2e29 602e 204e 616d  dim2, ...)`. Nam
+0002a670: 6573 206f 6620 6e65 770a 2020 2020 2020  es of new.      
+0002a680: 2020 2020 2020 6469 6d65 6e73 696f 6e73        dimensions
+0002a690: 2c20 616e 6420 7468 6520 6578 6973 7469  , and the existi
+0002a6a0: 6e67 2064 696d 656e 7369 6f6e 7320 7468  ng dimensions th
+0002a6b0: 6174 2074 6865 7920 7265 706c 6163 652e  at they replace.
+0002a6c0: 2041 6e0a 2020 2020 2020 2020 2020 2020   An.            
+0002a6d0: 656c 6c69 7073 6973 2028 602e 2e2e 6029  ellipsis (`...`)
+0002a6e0: 2077 696c 6c20 6265 2072 6570 6c61 6365   will be replace
+0002a6f0: 6420 6279 2061 6c6c 2075 6e6c 6973 7465  d by all unliste
+0002a700: 6420 6469 6d65 6e73 696f 6e73 2e0a 2020  d dimensions..  
+0002a710: 2020 2020 2020 2020 2020 5061 7373 696e            Passin
+0002a720: 6720 6120 6c69 7374 2063 6f6e 7461 696e  g a list contain
+0002a730: 696e 6720 616e 2065 6c6c 6970 7369 7320  ing an ellipsis 
+0002a740: 2860 7374 6163 6b65 645f 6469 6d3d 5b2e  (`stacked_dim=[.
+0002a750: 2e2e 5d60 2920 7769 6c6c 2073 7461 636b  ..]`) will stack
+0002a760: 206f 7665 720a 2020 2020 2020 2020 2020   over.          
+0002a770: 2020 616c 6c20 6469 6d65 6e73 696f 6e73    all dimensions
+0002a780: 2e0a 2020 2020 2020 2020 6372 6561 7465  ..        create
+0002a790: 5f69 6e64 6578 203a 2062 6f6f 6c20 6f72  _index : bool or
+0002a7a0: 204e 6f6e 652c 2064 6566 6175 6c74 3a20   None, default: 
+0002a7b0: 5472 7565 0a0a 2020 2020 2020 2020 2020  True..          
+0002a7c0: 2020 2d20 5472 7565 3a20 6372 6561 7465    - True: create
+0002a7d0: 2061 206d 756c 7469 2d69 6e64 6578 2066   a multi-index f
+0002a7e0: 6f72 2065 6163 6820 6f66 2074 6865 2073  or each of the s
+0002a7f0: 7461 636b 6564 2064 696d 656e 7369 6f6e  tacked dimension
+0002a800: 732e 0a20 2020 2020 2020 2020 2020 202d  s..            -
+0002a810: 2046 616c 7365 3a20 646f 6e27 7420 6372   False: don't cr
+0002a820: 6561 7465 2061 6e79 2069 6e64 6578 2e0a  eate any index..
+0002a830: 2020 2020 2020 2020 2020 2020 2d20 4e6f              - No
+0002a840: 6e65 2e20 6372 6561 7465 2061 206d 756c  ne. create a mul
+0002a850: 7469 2d69 6e64 6578 206f 6e6c 7920 6966  ti-index only if
+0002a860: 2065 7861 6374 6c79 206f 6e65 2073 696e   exactly one sin
+0002a870: 676c 6520 2831 2d64 2920 636f 6f72 6469  gle (1-d) coordi
+0002a880: 6e61 7465 0a20 2020 2020 2020 2020 2020  nate.           
+0002a890: 2020 2069 6e64 6578 2069 7320 666f 756e     index is foun
+0002a8a0: 6420 666f 7220 6576 6572 7920 6469 6d65  d for every dime
+0002a8b0: 6e73 696f 6e20 746f 2073 7461 636b 2e0a  nsion to stack..
+0002a8c0: 0a20 2020 2020 2020 2069 6e64 6578 5f63  .        index_c
+0002a8d0: 6c73 3a20 496e 6465 782d 636c 6173 732c  ls: Index-class,
+0002a8e0: 2064 6566 6175 6c74 3a20 5061 6e64 6173   default: Pandas
+0002a8f0: 4d75 6c74 6949 6e64 6578 0a20 2020 2020  MultiIndex.     
+0002a900: 2020 2020 2020 2043 616e 2062 6520 7573         Can be us
+0002a910: 6564 2074 6f20 7061 7373 2061 2063 7573  ed to pass a cus
+0002a920: 746f 6d20 6d75 6c74 692d 696e 6465 7820  tom multi-index 
+0002a930: 7479 7065 2028 6d75 7374 2062 6520 616e  type (must be an
+0002a940: 2058 6172 7261 7920 696e 6465 7820 7468   Xarray index th
+0002a950: 6174 0a20 2020 2020 2020 2020 2020 2069  at.            i
+0002a960: 6d70 6c65 6d65 6e74 7320 602e 7374 6163  mplements `.stac
+0002a970: 6b28 2960 292e 2042 7920 6465 6661 756c  k()`). By defaul
+0002a980: 742c 2061 2070 616e 6461 7320 6d75 6c74  t, a pandas mult
+0002a990: 692d 696e 6465 7820 7772 6170 7065 7220  i-index wrapper 
+0002a9a0: 6973 2075 7365 642e 0a20 2020 2020 2020  is used..       
+0002a9b0: 202a 2a64 696d 656e 7369 6f6e 735f 6b77   **dimensions_kw
+0002a9c0: 6172 6773 0a20 2020 2020 2020 2020 2020  args.           
+0002a9d0: 2054 6865 206b 6579 776f 7264 2061 7267   The keyword arg
+0002a9e0: 756d 656e 7473 2066 6f72 6d20 6f66 2060  uments form of `
+0002a9f0: 6064 696d 656e 7369 6f6e 7360 602e 0a20  `dimensions``.. 
+0002aa00: 2020 2020 2020 2020 2020 204f 6e65 206f             One o
+0002aa10: 6620 6469 6d65 6e73 696f 6e73 206f 7220  f dimensions or 
+0002aa20: 6469 6d65 6e73 696f 6e73 5f6b 7761 7267  dimensions_kwarg
+0002aa30: 7320 6d75 7374 2062 6520 7072 6f76 6964  s must be provid
+0002aa40: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
+0002aa50: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+0002aa60: 2d2d 2d2d 0a20 2020 2020 2020 2073 7461  ----.        sta
+0002aa70: 636b 6564 203a 2044 6174 6173 6574 0a20  cked : Dataset. 
+0002aa80: 2020 2020 2020 2020 2020 2044 6174 6173             Datas
+0002aa90: 6574 2077 6974 6820 7374 6163 6b65 6420  et with stacked 
+0002aaa0: 6461 7461 2e0a 0a20 2020 2020 2020 2053  data...        S
+0002aab0: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+0002aac0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0002aad0: 2044 6174 6173 6574 2e75 6e73 7461 636b   Dataset.unstack
+0002aae0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0002aaf0: 2020 2020 2064 696d 656e 7369 6f6e 7320       dimensions 
+0002ab00: 3d20 6569 7468 6572 5f64 6963 745f 6f72  = either_dict_or
+0002ab10: 5f6b 7761 7267 7328 6469 6d65 6e73 696f  _kwargs(dimensio
+0002ab20: 6e73 2c20 6469 6d65 6e73 696f 6e73 5f6b  ns, dimensions_k
+0002ab30: 7761 7267 732c 2022 7374 6163 6b22 290a  wargs, "stack").
+0002ab40: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0002ab50: 2073 656c 660a 2020 2020 2020 2020 666f   self.        fo
+0002ab60: 7220 6e65 775f 6469 6d2c 2064 696d 7320  r new_dim, dims 
+0002ab70: 696e 2064 696d 656e 7369 6f6e 732e 6974  in dimensions.it
+0002ab80: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+0002ab90: 2020 2072 6573 756c 7420 3d20 7265 7375     result = resu
+0002aba0: 6c74 2e5f 7374 6163 6b5f 6f6e 6365 2864  lt._stack_once(d
+0002abb0: 696d 732c 206e 6577 5f64 696d 2c20 696e  ims, new_dim, in
+0002abc0: 6465 785f 636c 732c 2063 7265 6174 655f  dex_cls, create_
+0002abd0: 696e 6465 7829 0a20 2020 2020 2020 2072  index).        r
+0002abe0: 6574 7572 6e20 7265 7375 6c74 0a0a 2020  eturn result..  
+0002abf0: 2020 6465 6620 746f 5f73 7461 636b 6564    def to_stacked
+0002ac00: 5f61 7272 6179 280a 2020 2020 2020 2020  _array(.        
+0002ac10: 7365 6c66 2c0a 2020 2020 2020 2020 6e65  self,.        ne
+0002ac20: 775f 6469 6d3a 2048 6173 6861 626c 652c  w_dim: Hashable,
+0002ac30: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
+0002ac40: 6469 6d73 3a20 436f 6c6c 6563 7469 6f6e  dims: Collection
+0002ac50: 5b48 6173 6861 626c 655d 2c0a 2020 2020  [Hashable],.    
+0002ac60: 2020 2020 7661 7269 6162 6c65 5f64 696d      variable_dim
+0002ac70: 3a20 4861 7368 6162 6c65 203d 2022 7661  : Hashable = "va
+0002ac80: 7269 6162 6c65 222c 0a20 2020 2020 2020  riable",.       
+0002ac90: 206e 616d 653a 2048 6173 6861 626c 6520   name: Hashable 
+0002aca0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+0002acb0: 2020 2029 202d 3e20 4461 7461 4172 7261     ) -> DataArra
+0002acc0: 793a 0a20 2020 2020 2020 2022 2222 436f  y:.        """Co
+0002acd0: 6d62 696e 6520 7661 7269 6162 6c65 7320  mbine variables 
+0002ace0: 6f66 2064 6966 6665 7269 6e67 2064 696d  of differing dim
+0002acf0: 656e 7369 6f6e 616c 6974 7920 696e 746f  ensionality into
+0002ad00: 2061 2044 6174 6141 7272 6179 0a20 2020   a DataArray.   
+0002ad10: 2020 2020 2077 6974 686f 7574 2062 726f       without bro
+0002ad20: 6164 6361 7374 696e 672e 0a0a 2020 2020  adcasting...    
+0002ad30: 2020 2020 5468 6973 206d 6574 686f 6420      This method 
+0002ad40: 6973 2073 696d 696c 6172 2074 6f20 4461  is similar to Da
+0002ad50: 7461 7365 742e 746f 5f61 7272 6179 2062  taset.to_array b
+0002ad60: 7574 2064 6f65 7320 6e6f 7420 6272 6f61  ut does not broa
+0002ad70: 6463 6173 7420 7468 650a 2020 2020 2020  dcast the.      
+0002ad80: 2020 7661 7269 6162 6c65 732e 0a0a 2020    variables...  
+0002ad90: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+0002ada0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0002adb0: 2d2d 2d0a 2020 2020 2020 2020 6e65 775f  ---.        new_
+0002adc0: 6469 6d20 3a20 6861 7368 6162 6c65 0a20  dim : hashable. 
+0002add0: 2020 2020 2020 2020 2020 204e 616d 6520             Name 
+0002ade0: 6f66 2074 6865 206e 6577 2073 7461 636b  of the new stack
+0002adf0: 6564 2063 6f6f 7264 696e 6174 650a 2020  ed coordinate.  
+0002ae00: 2020 2020 2020 7361 6d70 6c65 5f64 696d        sample_dim
+0002ae10: 7320 3a20 436f 6c6c 6563 7469 6f6e 206f  s : Collection o
+0002ae20: 6620 6861 7368 6162 6c65 730a 2020 2020  f hashables.    
+0002ae30: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+0002ae40: 6469 6d65 6e73 696f 6e73 2074 6861 7420  dimensions that 
+0002ae50: 2a2a 7769 6c6c 206e 6f74 2a2a 2062 6520  **will not** be 
+0002ae60: 7374 6163 6b65 642e 2045 6163 6820 6172  stacked. Each ar
+0002ae70: 7261 7920 696e 2074 6865 0a20 2020 2020  ray in the.     
+0002ae80: 2020 2020 2020 2064 6174 6173 6574 206d         dataset m
+0002ae90: 7573 7420 7368 6172 6520 7468 6573 6520  ust share these 
+0002aea0: 6469 6d65 6e73 696f 6e73 2e20 466f 7220  dimensions. For 
+0002aeb0: 6d61 6368 696e 6520 6c65 6172 6e69 6e67  machine learning
+0002aec0: 0a20 2020 2020 2020 2020 2020 2061 7070  .            app
+0002aed0: 6c69 6361 7469 6f6e 732c 2074 6865 7365  lications, these
+0002aee0: 2064 6566 696e 6520 7468 6520 6469 6d65   define the dime
+0002aef0: 6e73 696f 6e73 206f 7665 7220 7768 6963  nsions over whic
+0002af00: 6820 7361 6d70 6c65 7320 6172 650a 2020  h samples are.  
+0002af10: 2020 2020 2020 2020 2020 6472 6177 6e2e            drawn.
+0002af20: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
+0002af30: 655f 6469 6d20 3a20 6861 7368 6162 6c65  e_dim : hashable
+0002af40: 2c20 6465 6661 756c 743a 2022 7661 7269  , default: "vari
+0002af50: 6162 6c65 220a 2020 2020 2020 2020 2020  able".          
+0002af60: 2020 4e61 6d65 206f 6620 7468 6520 6c65    Name of the le
+0002af70: 7665 6c20 696e 2074 6865 2073 7461 636b  vel in the stack
+0002af80: 6564 2063 6f6f 7264 696e 6174 6520 7768  ed coordinate wh
+0002af90: 6963 6820 636f 7272 6573 706f 6e64 7320  ich corresponds 
+0002afa0: 746f 0a20 2020 2020 2020 2020 2020 2074  to.            t
+0002afb0: 6865 2076 6172 6961 626c 6573 2e0a 2020  he variables..  
+0002afc0: 2020 2020 2020 6e61 6d65 203a 2068 6173        name : has
+0002afd0: 6861 626c 652c 206f 7074 696f 6e61 6c0a  hable, optional.
+0002afe0: 2020 2020 2020 2020 2020 2020 4e61 6d65              Name
+0002aff0: 206f 6620 7468 6520 6e65 7720 6461 7461   of the new data
+0002b000: 2061 7272 6179 2e0a 0a20 2020 2020 2020   array...       
+0002b010: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+0002b020: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+0002b030: 2073 7461 636b 6564 203a 2044 6174 6141   stacked : DataA
+0002b040: 7272 6179 0a20 2020 2020 2020 2020 2020  rray.           
+0002b050: 2044 6174 6141 7272 6179 2077 6974 6820   DataArray with 
+0002b060: 7468 6520 7370 6563 6966 6965 6420 6469  the specified di
+0002b070: 6d65 6e73 696f 6e73 2061 6e64 2064 6174  mensions and dat
+0002b080: 6120 7661 7269 6162 6c65 730a 2020 2020  a variables.    
+0002b090: 2020 2020 2020 2020 7374 6163 6b65 6420          stacked 
+0002b0a0: 746f 6765 7468 6572 2e20 5468 6520 7374  together. The st
+0002b0b0: 6163 6b65 6420 636f 6f72 6469 6e61 7465  acked coordinate
+0002b0c0: 2069 7320 6e61 6d65 6420 6060 6e65 775f   is named ``new_
+0002b0d0: 6469 6d60 600a 2020 2020 2020 2020 2020  dim``.          
+0002b0e0: 2020 616e 6420 7265 7072 6573 656e 7465    and represente
+0002b0f0: 6420 6279 2061 204d 756c 7469 496e 6465  d by a MultiInde
+0002b100: 7820 6f62 6a65 6374 2077 6974 6820 6120  x object with a 
+0002b110: 6c65 7665 6c20 636f 6e74 6169 6e69 6e67  level containing
+0002b120: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+0002b130: 2064 6174 6120 7661 7269 6162 6c65 206e   data variable n
+0002b140: 616d 6573 2e20 5468 6520 6e61 6d65 206f  ames. The name o
+0002b150: 6620 7468 6973 206c 6576 656c 2069 7320  f this level is 
+0002b160: 636f 6e74 726f 6c6c 6564 2075 7369 6e67  controlled using
+0002b170: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+0002b180: 2060 6076 6172 6961 626c 655f 6469 6d60   ``variable_dim`
+0002b190: 6020 6172 6775 6d65 6e74 2e0a 0a20 2020  ` argument...   
+0002b1a0: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+0002b1b0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+0002b1c0: 2020 2020 2020 2044 6174 6173 6574 2e74         Dataset.t
+0002b1d0: 6f5f 6172 7261 790a 2020 2020 2020 2020  o_array.        
+0002b1e0: 4461 7461 7365 742e 7374 6163 6b0a 2020  Dataset.stack.  
+0002b1f0: 2020 2020 2020 4461 7461 4172 7261 792e        DataArray.
+0002b200: 746f 5f75 6e73 7461 636b 6564 5f64 6174  to_unstacked_dat
+0002b210: 6173 6574 0a0a 2020 2020 2020 2020 4578  aset..        Ex
+0002b220: 616d 706c 6573 0a20 2020 2020 2020 202d  amples.        -
+0002b230: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0002b240: 3e3e 3e20 6461 7461 203d 2078 722e 4461  >>> data = xr.Da
+0002b250: 7461 7365 7428 0a20 2020 2020 2020 202e  taset(.        .
+0002b260: 2e2e 2020 2020 2064 6174 615f 7661 7273  ..     data_vars
+0002b270: 3d7b 0a20 2020 2020 2020 202e 2e2e 2020  ={.        ...  
+0002b280: 2020 2020 2020 2022 6122 3a20 2828 2278         "a": (("x
+0002b290: 222c 2022 7922 292c 205b 5b30 2c20 312c  ", "y"), [[0, 1,
+0002b2a0: 2032 5d2c 205b 332c 2034 2c20 355d 5d29   2], [3, 4, 5]])
+0002b2b0: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
+0002b2c0: 2020 2020 2020 2262 223a 2028 2278 222c        "b": ("x",
+0002b2d0: 205b 362c 2037 5d29 2c0a 2020 2020 2020   [6, 7]),.      
+0002b2e0: 2020 2e2e 2e20 2020 2020 7d2c 0a20 2020    ...     },.   
+0002b2f0: 2020 2020 202e 2e2e 2020 2020 2063 6f6f       ...     coo
+0002b300: 7264 733d 7b22 7922 3a20 5b22 7522 2c20  rds={"y": ["u", 
+0002b310: 2276 222c 2022 7722 5d7d 2c0a 2020 2020  "v", "w"]},.    
+0002b320: 2020 2020 2e2e 2e20 290a 0a20 2020 2020      ... )..     
+0002b330: 2020 203e 3e3e 2064 6174 610a 2020 2020     >>> data.    
+0002b340: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
+0002b350: 7365 743e 0a20 2020 2020 2020 2044 696d  set>.        Dim
+0002b360: 656e 7369 6f6e 733a 2020 2878 3a20 322c  ensions:  (x: 2,
+0002b370: 2079 3a20 3329 0a20 2020 2020 2020 2043   y: 3).        C
+0002b380: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
+0002b390: 2020 2020 2020 2a20 7920 2020 2020 2020        * y       
+0002b3a0: 2028 7929 203c 5531 2027 7527 2027 7627   (y) <U1 'u' 'v'
+0002b3b0: 2027 7727 0a20 2020 2020 2020 2044 696d   'w'.        Dim
+0002b3c0: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
+0002b3d0: 636f 6f72 6469 6e61 7465 733a 2078 0a20  coordinates: x. 
+0002b3e0: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
+0002b3f0: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
+0002b400: 2020 2061 2020 2020 2020 2020 2878 2c20     a        (x, 
+0002b410: 7929 2069 6e74 3634 2030 2031 2032 2033  y) int64 0 1 2 3
+0002b420: 2034 2035 0a20 2020 2020 2020 2020 2020   4 5.           
+0002b430: 2062 2020 2020 2020 2020 2878 2920 696e   b        (x) in
+0002b440: 7436 3420 3620 370a 0a20 2020 2020 2020  t64 6 7..       
+0002b450: 203e 3e3e 2064 6174 612e 746f 5f73 7461   >>> data.to_sta
+0002b460: 636b 6564 5f61 7272 6179 2822 7a22 2c20  cked_array("z", 
+0002b470: 7361 6d70 6c65 5f64 696d 733d 5b22 7822  sample_dims=["x"
+0002b480: 5d29 0a20 2020 2020 2020 203c 7861 7272  ]).        <xarr
+0002b490: 6179 2e44 6174 6141 7272 6179 2027 6127  ay.DataArray 'a'
+0002b4a0: 2028 783a 2032 2c20 7a3a 2034 293e 0a20   (x: 2, z: 4)>. 
+0002b4b0: 2020 2020 2020 2061 7272 6179 285b 5b30         array([[0
+0002b4c0: 2c20 312c 2032 2c20 365d 2c0a 2020 2020  , 1, 2, 6],.    
+0002b4d0: 2020 2020 2020 2020 2020 205b 332c 2034             [3, 4
+0002b4e0: 2c20 352c 2037 5d5d 290a 2020 2020 2020  , 5, 7]]).      
+0002b4f0: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+0002b500: 2020 2020 2020 2020 202a 207a 2020 2020           * z    
+0002b510: 2020 2020 2028 7a29 206f 626a 6563 7420       (z) object 
+0002b520: 4d75 6c74 6949 6e64 6578 0a20 2020 2020  MultiIndex.     
+0002b530: 2020 2020 202a 2076 6172 6961 626c 6520       * variable 
+0002b540: 2028 7a29 206f 626a 6563 7420 2761 2720   (z) object 'a' 
+0002b550: 2761 2720 2761 2720 2762 270a 2020 2020  'a' 'a' 'b'.    
+0002b560: 2020 2020 2020 2a20 7920 2020 2020 2020        * y       
+0002b570: 2020 287a 2920 6f62 6a65 6374 2027 7527    (z) object 'u'
+0002b580: 2027 7627 2027 7727 206e 616e 0a20 2020   'v' 'w' nan.   
+0002b590: 2020 2020 2044 696d 656e 7369 6f6e 7320       Dimensions 
+0002b5a0: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
+0002b5b0: 7465 733a 2078 0a0a 2020 2020 2020 2020  tes: x..        
+0002b5c0: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+0002b5d0: 2078 6172 7261 792e 636f 7265 2e63 6f6e   xarray.core.con
+0002b5e0: 6361 7420 696d 706f 7274 2063 6f6e 6361  cat import conca
+0002b5f0: 740a 0a20 2020 2020 2020 2073 7461 636b  t..        stack
+0002b600: 696e 675f 6469 6d73 203d 2074 7570 6c65  ing_dims = tuple
+0002b610: 2864 696d 2066 6f72 2064 696d 2069 6e20  (dim for dim in 
+0002b620: 7365 6c66 2e64 696d 7320 6966 2064 696d  self.dims if dim
+0002b630: 206e 6f74 2069 6e20 7361 6d70 6c65 5f64   not in sample_d
+0002b640: 696d 7329 0a0a 2020 2020 2020 2020 666f  ims)..        fo
+0002b650: 7220 7661 7269 6162 6c65 2069 6e20 7365  r variable in se
+0002b660: 6c66 3a0a 2020 2020 2020 2020 2020 2020  lf:.            
+0002b670: 6469 6d73 203d 2073 656c 665b 7661 7269  dims = self[vari
+0002b680: 6162 6c65 5d2e 6469 6d73 0a20 2020 2020  able].dims.     
+0002b690: 2020 2020 2020 2064 696d 735f 696e 636c         dims_incl
+0002b6a0: 7564 655f 7361 6d70 6c65 5f64 696d 7320  ude_sample_dims 
+0002b6b0: 3d20 7365 7428 7361 6d70 6c65 5f64 696d  = set(sample_dim
+0002b6c0: 7329 203c 3d20 7365 7428 6469 6d73 290a  s) <= set(dims).
+0002b6d0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0002b6e0: 6f74 2064 696d 735f 696e 636c 7564 655f  ot dims_include_
+0002b6f0: 7361 6d70 6c65 5f64 696d 733a 0a20 2020  sample_dims:.   
+0002b700: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0002b710: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+0002b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b730: 2020 2022 416c 6c20 7661 7269 6162 6c65     "All variable
+0002b740: 7320 696e 2074 6865 2064 6174 6173 6574  s in the dataset
+0002b750: 206d 7573 7420 636f 6e74 6169 6e20 7468   must contain th
+0002b760: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+0002b770: 2020 2020 2020 2020 2264 696d 656e 7369          "dimensi
+0002b780: 6f6e 7320 7b7d 2e22 2e66 6f72 6d61 7428  ons {}.".format(
+0002b790: 6469 6d73 290a 2020 2020 2020 2020 2020  dims).          
+0002b7a0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0002b7b0: 2064 6566 2065 6e73 7572 655f 7374 6163   def ensure_stac
+0002b7c0: 6b61 626c 6528 7661 6c29 3a0a 2020 2020  kable(val):.    
+0002b7d0: 2020 2020 2020 2020 6173 7369 676e 5f63          assign_c
+0002b7e0: 6f6f 7264 7320 3d20 7b76 6172 6961 626c  oords = {variabl
+0002b7f0: 655f 6469 6d3a 2076 616c 2e6e 616d 657d  e_dim: val.name}
+0002b800: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0002b810: 2064 696d 2069 6e20 7374 6163 6b69 6e67   dim in stacking
+0002b820: 5f64 696d 733a 0a20 2020 2020 2020 2020  _dims:.         
+0002b830: 2020 2020 2020 2069 6620 6469 6d20 6e6f         if dim no
+0002b840: 7420 696e 2076 616c 2e64 696d 733a 0a20  t in val.dims:. 
+0002b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b860: 2020 2061 7373 6967 6e5f 636f 6f72 6473     assign_coords
+0002b870: 5b64 696d 5d20 3d20 4e6f 6e65 0a0a 2020  [dim] = None..  
+0002b880: 2020 2020 2020 2020 2020 6578 7061 6e64            expand
+0002b890: 5f64 696d 7320 3d20 7365 7428 7374 6163  _dims = set(stac
+0002b8a0: 6b69 6e67 5f64 696d 7329 2e64 6966 6665  king_dims).diffe
+0002b8b0: 7265 6e63 6528 7365 7428 7661 6c2e 6469  rence(set(val.di
+0002b8c0: 6d73 2929 0a20 2020 2020 2020 2020 2020  ms)).           
+0002b8d0: 2065 7870 616e 645f 6469 6d73 2e61 6464   expand_dims.add
+0002b8e0: 2876 6172 6961 626c 655f 6469 6d29 0a20  (variable_dim). 
+0002b8f0: 2020 2020 2020 2020 2020 2023 206d 7573             # mus
+0002b900: 7420 6265 206c 6973 7420 666f 7220 2e65  t be list for .e
+0002b910: 7870 616e 645f 6469 6d73 0a20 2020 2020  xpand_dims.     
+0002b920: 2020 2020 2020 2065 7870 616e 645f 6469         expand_di
+0002b930: 6d73 203d 206c 6973 7428 6578 7061 6e64  ms = list(expand
+0002b940: 5f64 696d 7329 0a0a 2020 2020 2020 2020  _dims)..        
+0002b950: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
+0002b960: 2020 2020 2020 2020 2020 2020 2076 616c               val
+0002b970: 2e61 7373 6967 6e5f 636f 6f72 6473 282a  .assign_coords(*
+0002b980: 2a61 7373 6967 6e5f 636f 6f72 6473 290a  *assign_coords).
+0002b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b9a0: 2e65 7870 616e 645f 6469 6d73 2865 7870  .expand_dims(exp
+0002b9b0: 616e 645f 6469 6d73 290a 2020 2020 2020  and_dims).      
+0002b9c0: 2020 2020 2020 2020 2020 2e73 7461 636b            .stack
+0002b9d0: 287b 6e65 775f 6469 6d3a 2028 7661 7269  ({new_dim: (vari
+0002b9e0: 6162 6c65 5f64 696d 2c29 202b 2073 7461  able_dim,) + sta
+0002b9f0: 636b 696e 675f 6469 6d73 7d29 0a20 2020  cking_dims}).   
+0002ba00: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0002ba10: 2020 2020 2320 636f 6e63 6174 656e 6174      # concatenat
+0002ba20: 6520 7468 6520 6172 7261 7973 0a20 2020  e the arrays.   
+0002ba30: 2020 2020 2073 7461 636b 6162 6c65 5f76       stackable_v
+0002ba40: 6172 7320 3d20 5b65 6e73 7572 655f 7374  ars = [ensure_st
+0002ba50: 6163 6b61 626c 6528 7365 6c66 5b6b 6579  ackable(self[key
+0002ba60: 5d29 2066 6f72 206b 6579 2069 6e20 7365  ]) for key in se
+0002ba70: 6c66 2e64 6174 615f 7661 7273 5d0a 2020  lf.data_vars].  
+0002ba80: 2020 2020 2020 6461 7461 5f61 7272 6179        data_array
+0002ba90: 203d 2063 6f6e 6361 7428 7374 6163 6b61   = concat(stacka
+0002baa0: 626c 655f 7661 7273 2c20 6469 6d3d 6e65  ble_vars, dim=ne
+0002bab0: 775f 6469 6d29 0a0a 2020 2020 2020 2020  w_dim)..        
+0002bac0: 6966 206e 616d 6520 6973 206e 6f74 204e  if name is not N
+0002bad0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002bae0: 2064 6174 615f 6172 7261 792e 6e61 6d65   data_array.name
+0002baf0: 203d 206e 616d 650a 0a20 2020 2020 2020   = name..       
+0002bb00: 2072 6574 7572 6e20 6461 7461 5f61 7272   return data_arr
+0002bb10: 6179 0a0a 2020 2020 6465 6620 5f75 6e73  ay..    def _uns
+0002bb20: 7461 636b 5f6f 6e63 6528 0a20 2020 2020  tack_once(.     
+0002bb30: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+0002bb40: 6574 2c0a 2020 2020 2020 2020 6469 6d3a  et,.        dim:
+0002bb50: 2048 6173 6861 626c 652c 0a20 2020 2020   Hashable,.     
+0002bb60: 2020 2069 6e64 6578 5f61 6e64 5f76 6172     index_and_var
+0002bb70: 733a 2074 7570 6c65 5b49 6e64 6578 2c20  s: tuple[Index, 
+0002bb80: 6469 6374 5b48 6173 6861 626c 652c 2056  dict[Hashable, V
+0002bb90: 6172 6961 626c 655d 5d2c 0a20 2020 2020  ariable]],.     
+0002bba0: 2020 2066 696c 6c5f 7661 6c75 652c 0a20     fill_value,. 
+0002bbb0: 2020 2020 2020 2073 7061 7273 653a 2062         sparse: b
+0002bbc0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0002bbd0: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
+0002bbe0: 0a20 2020 2020 2020 2069 6e64 6578 2c20  .        index, 
+0002bbf0: 696e 6465 785f 7661 7273 203d 2069 6e64  index_vars = ind
+0002bc00: 6578 5f61 6e64 5f76 6172 730a 2020 2020  ex_and_vars.    
+0002bc10: 2020 2020 7661 7269 6162 6c65 733a 2064      variables: d
+0002bc20: 6963 745b 4861 7368 6162 6c65 2c20 5661  ict[Hashable, Va
+0002bc30: 7269 6162 6c65 5d20 3d20 7b7d 0a20 2020  riable] = {}.   
+0002bc40: 2020 2020 2069 6e64 6578 6573 203d 207b       indexes = {
+0002bc50: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
+0002bc60: 2073 656c 662e 5f69 6e64 6578 6573 2e69   self._indexes.i
+0002bc70: 7465 6d73 2829 2069 6620 6b20 213d 2064  tems() if k != d
+0002bc80: 696d 7d0a 0a20 2020 2020 2020 206e 6577  im}..        new
+0002bc90: 5f69 6e64 6578 6573 2c20 636c 6561 6e5f  _indexes, clean_
+0002bca0: 696e 6465 7820 3d20 696e 6465 782e 756e  index = index.un
+0002bcb0: 7374 6163 6b28 290a 2020 2020 2020 2020  stack().        
+0002bcc0: 696e 6465 7865 732e 7570 6461 7465 286e  indexes.update(n
+0002bcd0: 6577 5f69 6e64 6578 6573 290a 0a20 2020  ew_indexes)..   
+0002bce0: 2020 2020 2066 6f72 206e 616d 652c 2069       for name, i
+0002bcf0: 6478 2069 6e20 6e65 775f 696e 6465 7865  dx in new_indexe
+0002bd00: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+0002bd10: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+0002bd20: 2e75 7064 6174 6528 6964 782e 6372 6561  .update(idx.crea
+0002bd30: 7465 5f76 6172 6961 626c 6573 2869 6e64  te_variables(ind
+0002bd40: 6578 5f76 6172 7329 290a 0a20 2020 2020  ex_vars))..     
+0002bd50: 2020 2066 6f72 206e 616d 652c 2076 6172     for name, var
+0002bd60: 2069 6e20 7365 6c66 2e76 6172 6961 626c   in self.variabl
+0002bd70: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
+0002bd80: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
+0002bd90: 6e6f 7420 696e 2069 6e64 6578 5f76 6172  not in index_var
+0002bda0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0002bdb0: 2020 2069 6620 6469 6d20 696e 2076 6172     if dim in var
+0002bdc0: 2e64 696d 733a 0a20 2020 2020 2020 2020  .dims:.         
+0002bdd0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0002bde0: 696e 7374 616e 6365 2866 696c 6c5f 7661  instance(fill_va
+0002bdf0: 6c75 652c 204d 6170 7069 6e67 293a 0a20  lue, Mapping):. 
+0002be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002be10: 2020 2020 2020 2066 696c 6c5f 7661 6c75         fill_valu
+0002be20: 655f 203d 2066 696c 6c5f 7661 6c75 655b  e_ = fill_value[
+0002be30: 6e61 6d65 5d0a 2020 2020 2020 2020 2020  name].          
+0002be40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0002be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002be60: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
+0002be70: 7565 5f20 3d20 6669 6c6c 5f76 616c 7565  ue_ = fill_value
+0002be80: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002be90: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
+0002bea0: 6e61 6d65 5d20 3d20 7661 722e 5f75 6e73  name] = var._uns
+0002beb0: 7461 636b 5f6f 6e63 6528 0a20 2020 2020  tack_once(.     
+0002bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bed0: 2020 2069 6e64 6578 3d63 6c65 616e 5f69     index=clean_i
+0002bee0: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
+0002bef0: 2020 2020 2020 2020 2020 2020 2020 6469                di
+0002bf00: 6d3d 6469 6d2c 0a20 2020 2020 2020 2020  m=dim,.         
+0002bf10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0002bf20: 696c 6c5f 7661 6c75 653d 6669 6c6c 5f76  ill_value=fill_v
+0002bf30: 616c 7565 5f2c 0a20 2020 2020 2020 2020  alue_,.         
+0002bf40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002bf50: 7061 7273 653d 7370 6172 7365 2c0a 2020  parse=sparse,.  
+0002bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bf70: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0002bf80: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002bf90: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0002bfa0: 7269 6162 6c65 735b 6e61 6d65 5d20 3d20  riables[name] = 
+0002bfb0: 7661 720a 0a20 2020 2020 2020 2063 6f6f  var..        coo
+0002bfc0: 7264 5f6e 616d 6573 203d 2073 6574 2873  rd_names = set(s
+0002bfd0: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
+0002bfe0: 2920 2d20 7b64 696d 7d20 7c20 7365 7428  ) - {dim} | set(
+0002bff0: 6e65 775f 696e 6465 7865 7329 0a0a 2020  new_indexes)..  
+0002c000: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0002c010: 662e 5f72 6570 6c61 6365 5f77 6974 685f  f._replace_with_
+0002c020: 6e65 775f 6469 6d73 280a 2020 2020 2020  new_dims(.      
+0002c030: 2020 2020 2020 7661 7269 6162 6c65 732c        variables,
+0002c040: 2063 6f6f 7264 5f6e 616d 6573 3d63 6f6f   coord_names=coo
+0002c050: 7264 5f6e 616d 6573 2c20 696e 6465 7865  rd_names, indexe
+0002c060: 733d 696e 6465 7865 730a 2020 2020 2020  s=indexes.      
+0002c070: 2020 290a 0a20 2020 2064 6566 205f 756e    )..    def _un
+0002c080: 7374 6163 6b5f 6675 6c6c 5f72 6569 6e64  stack_full_reind
+0002c090: 6578 280a 2020 2020 2020 2020 7365 6c66  ex(.        self
+0002c0a0: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
+0002c0b0: 2020 2020 2064 696d 3a20 4861 7368 6162       dim: Hashab
+0002c0c0: 6c65 2c0a 2020 2020 2020 2020 696e 6465  le,.        inde
+0002c0d0: 785f 616e 645f 7661 7273 3a20 7475 706c  x_and_vars: tupl
+0002c0e0: 655b 496e 6465 782c 2064 6963 745b 4861  e[Index, dict[Ha
+0002c0f0: 7368 6162 6c65 2c20 5661 7269 6162 6c65  shable, Variable
+0002c100: 5d5d 2c0a 2020 2020 2020 2020 6669 6c6c  ]],.        fill
+0002c110: 5f76 616c 7565 2c0a 2020 2020 2020 2020  _value,.        
+0002c120: 7370 6172 7365 3a20 626f 6f6c 2c0a 2020  sparse: bool,.  
+0002c130: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
+0002c140: 3a0a 2020 2020 2020 2020 696e 6465 782c  :.        index,
+0002c150: 2069 6e64 6578 5f76 6172 7320 3d20 696e   index_vars = in
+0002c160: 6465 785f 616e 645f 7661 7273 0a20 2020  dex_and_vars.   
+0002c170: 2020 2020 2076 6172 6961 626c 6573 3a20       variables: 
+0002c180: 6469 6374 5b48 6173 6861 626c 652c 2056  dict[Hashable, V
+0002c190: 6172 6961 626c 655d 203d 207b 7d0a 2020  ariable] = {}.  
+0002c1a0: 2020 2020 2020 696e 6465 7865 7320 3d20        indexes = 
+0002c1b0: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
+0002c1c0: 6e20 7365 6c66 2e5f 696e 6465 7865 732e  n self._indexes.
+0002c1d0: 6974 656d 7328 2920 6966 206b 2021 3d20  items() if k != 
+0002c1e0: 6469 6d7d 0a0a 2020 2020 2020 2020 6e65  dim}..        ne
+0002c1f0: 775f 696e 6465 7865 732c 2063 6c65 616e  w_indexes, clean
+0002c200: 5f69 6e64 6578 203d 2069 6e64 6578 2e75  _index = index.u
+0002c210: 6e73 7461 636b 2829 0a20 2020 2020 2020  nstack().       
+0002c220: 2069 6e64 6578 6573 2e75 7064 6174 6528   indexes.update(
+0002c230: 6e65 775f 696e 6465 7865 7329 0a0a 2020  new_indexes)..  
+0002c240: 2020 2020 2020 6e65 775f 696e 6465 785f        new_index_
+0002c250: 7661 7269 6162 6c65 7320 3d20 7b7d 0a20  variables = {}. 
+0002c260: 2020 2020 2020 2066 6f72 206e 616d 652c         for name,
+0002c270: 2069 6478 2069 6e20 6e65 775f 696e 6465   idx in new_inde
+0002c280: 7865 732e 6974 656d 7328 293a 0a20 2020  xes.items():.   
+0002c290: 2020 2020 2020 2020 206e 6577 5f69 6e64           new_ind
+0002c2a0: 6578 5f76 6172 6961 626c 6573 2e75 7064  ex_variables.upd
+0002c2b0: 6174 6528 6964 782e 6372 6561 7465 5f76  ate(idx.create_v
+0002c2c0: 6172 6961 626c 6573 2869 6e64 6578 5f76  ariables(index_v
+0002c2d0: 6172 7329 290a 0a20 2020 2020 2020 206e  ars))..        n
+0002c2e0: 6577 5f64 696d 5f73 697a 6573 203d 207b  ew_dim_sizes = {
+0002c2f0: 6b3a 2076 2e73 697a 6520 666f 7220 6b2c  k: v.size for k,
+0002c300: 2076 2069 6e20 6e65 775f 696e 6465 785f   v in new_index_
+0002c310: 7661 7269 6162 6c65 732e 6974 656d 7328  variables.items(
+0002c320: 297d 0a20 2020 2020 2020 2076 6172 6961  )}.        varia
+0002c330: 626c 6573 2e75 7064 6174 6528 6e65 775f  bles.update(new_
+0002c340: 696e 6465 785f 7661 7269 6162 6c65 7329  index_variables)
+0002c350: 0a0a 2020 2020 2020 2020 2320 7461 6b65  ..        # take
+0002c360: 2061 2073 686f 7274 6375 7420 696e 2063   a shortcut in c
+0002c370: 6173 6520 7468 6520 4d75 6c74 6949 6e64  ase the MultiInd
+0002c380: 6578 2077 6173 206e 6f74 206d 6f64 6966  ex was not modif
+0002c390: 6965 642e 0a20 2020 2020 2020 2066 756c  ied..        ful
+0002c3a0: 6c5f 6964 7820 3d20 7064 2e4d 756c 7469  l_idx = pd.Multi
+0002c3b0: 496e 6465 782e 6672 6f6d 5f70 726f 6475  Index.from_produ
+0002c3c0: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
+0002c3d0: 636c 6561 6e5f 696e 6465 782e 6c65 7665  clean_index.leve
+0002c3e0: 6c73 2c20 6e61 6d65 733d 636c 6561 6e5f  ls, names=clean_
+0002c3f0: 696e 6465 782e 6e61 6d65 730a 2020 2020  index.names.    
+0002c400: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
+0002c410: 2063 6c65 616e 5f69 6e64 6578 2e65 7175   clean_index.equ
+0002c420: 616c 7328 6675 6c6c 5f69 6478 293a 0a20  als(full_idx):. 
+0002c430: 2020 2020 2020 2020 2020 206f 626a 203d             obj =
+0002c440: 2073 656c 660a 2020 2020 2020 2020 656c   self.        el
+0002c450: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002c460: 2320 544f 444f 3a20 7765 206d 6179 2064  # TODO: we may d
+0002c470: 6570 7265 6369 6174 6520 696d 706c 6963  epreciate implic
+0002c480: 6974 2072 652d 696e 6465 7869 6e67 2077  it re-indexing w
+0002c490: 6974 6820 6120 7061 6e64 6173 2e4d 756c  ith a pandas.Mul
+0002c4a0: 7469 496e 6465 780a 2020 2020 2020 2020  tiIndex.        
+0002c4b0: 2020 2020 7872 5f66 756c 6c5f 6964 7820      xr_full_idx 
+0002c4c0: 3d20 5061 6e64 6173 4d75 6c74 6949 6e64  = PandasMultiInd
+0002c4d0: 6578 2866 756c 6c5f 6964 782c 2064 696d  ex(full_idx, dim
+0002c4e0: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
+0002c4f0: 6465 7865 7273 203d 2049 6e64 6578 6573  dexers = Indexes
+0002c500: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0002c510: 2020 7b6b 3a20 7872 5f66 756c 6c5f 6964    {k: xr_full_id
+0002c520: 7820 666f 7220 6b20 696e 2069 6e64 6578  x for k in index
+0002c530: 5f76 6172 737d 2c0a 2020 2020 2020 2020  _vars},.        
+0002c540: 2020 2020 2020 2020 7872 5f66 756c 6c5f          xr_full_
+0002c550: 6964 782e 6372 6561 7465 5f76 6172 6961  idx.create_varia
+0002c560: 626c 6573 2869 6e64 6578 5f76 6172 7329  bles(index_vars)
+0002c570: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0002c580: 2020 2020 2020 2020 2020 2020 6f62 6a20              obj 
+0002c590: 3d20 7365 6c66 2e5f 7265 696e 6465 7828  = self._reindex(
+0002c5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c5b0: 2069 6e64 6578 6572 732c 2063 6f70 793d   indexers, copy=
+0002c5c0: 4661 6c73 652c 2066 696c 6c5f 7661 6c75  False, fill_valu
+0002c5d0: 653d 6669 6c6c 5f76 616c 7565 2c20 7370  e=fill_value, sp
+0002c5e0: 6172 7365 3d73 7061 7273 650a 2020 2020  arse=sparse.    
+0002c5f0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0002c600: 2020 2066 6f72 206e 616d 652c 2076 6172     for name, var
+0002c610: 2069 6e20 6f62 6a2e 7661 7269 6162 6c65   in obj.variable
+0002c620: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+0002c630: 2020 2020 2020 2069 6620 6e61 6d65 206e         if name n
+0002c640: 6f74 2069 6e20 696e 6465 785f 7661 7273  ot in index_vars
+0002c650: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002c660: 2020 6966 2064 696d 2069 6e20 7661 722e    if dim in var.
+0002c670: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
+0002c680: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+0002c690: 6c65 735b 6e61 6d65 5d20 3d20 7661 722e  les[name] = var.
+0002c6a0: 756e 7374 6163 6b28 7b64 696d 3a20 6e65  unstack({dim: ne
+0002c6b0: 775f 6469 6d5f 7369 7a65 737d 290a 2020  w_dim_sizes}).  
+0002c6c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0002c6d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002c6e0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+0002c6f0: 735b 6e61 6d65 5d20 3d20 7661 720a 0a20  s[name] = var.. 
+0002c700: 2020 2020 2020 2063 6f6f 7264 5f6e 616d         coord_nam
+0002c710: 6573 203d 2073 6574 2873 656c 662e 5f63  es = set(self._c
+0002c720: 6f6f 7264 5f6e 616d 6573 2920 2d20 7b64  oord_names) - {d
+0002c730: 696d 7d20 7c20 7365 7428 6e65 775f 6469  im} | set(new_di
+0002c740: 6d5f 7369 7a65 7329 0a0a 2020 2020 2020  m_sizes)..      
+0002c750: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+0002c760: 6570 6c61 6365 5f77 6974 685f 6e65 775f  eplace_with_new_
+0002c770: 6469 6d73 280a 2020 2020 2020 2020 2020  dims(.          
+0002c780: 2020 7661 7269 6162 6c65 732c 2063 6f6f    variables, coo
+0002c790: 7264 5f6e 616d 6573 3d63 6f6f 7264 5f6e  rd_names=coord_n
+0002c7a0: 616d 6573 2c20 696e 6465 7865 733d 696e  ames, indexes=in
+0002c7b0: 6465 7865 730a 2020 2020 2020 2020 290a  dexes.        ).
+0002c7c0: 0a20 2020 2064 6566 2075 6e73 7461 636b  .    def unstack
+0002c7d0: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
+0002c7e0: 545f 4461 7461 7365 742c 0a20 2020 2020  T_Dataset,.     
+0002c7f0: 2020 2064 696d 3a20 4469 6d73 203d 204e     dim: Dims = N
+0002c800: 6f6e 652c 0a20 2020 2020 2020 2066 696c  one,.        fil
+0002c810: 6c5f 7661 6c75 653a 2041 6e79 203d 2078  l_value: Any = x
+0002c820: 7264 7479 7065 732e 4e41 2c0a 2020 2020  rdtypes.NA,.    
+0002c830: 2020 2020 7370 6172 7365 3a20 626f 6f6c      sparse: bool
+0002c840: 203d 2046 616c 7365 2c0a 2020 2020 2920   = False,.    ) 
+0002c850: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+0002c860: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0002c870: 2020 556e 7374 6163 6b20 6578 6973 7469    Unstack existi
+0002c880: 6e67 2064 696d 656e 7369 6f6e 7320 636f  ng dimensions co
+0002c890: 7272 6573 706f 6e64 696e 6720 746f 204d  rresponding to M
+0002c8a0: 756c 7469 496e 6465 7865 7320 696e 746f  ultiIndexes into
+0002c8b0: 0a20 2020 2020 2020 206d 756c 7469 706c  .        multipl
+0002c8c0: 6520 6e65 7720 6469 6d65 6e73 696f 6e73  e new dimensions
+0002c8d0: 2e0a 0a20 2020 2020 2020 204e 6577 2064  ...        New d
+0002c8e0: 696d 656e 7369 6f6e 7320 7769 6c6c 2062  imensions will b
+0002c8f0: 6520 6164 6465 6420 6174 2074 6865 2065  e added at the e
+0002c900: 6e64 2e0a 0a20 2020 2020 2020 2050 6172  nd...        Par
+0002c910: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+0002c920: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+0002c930: 2020 2064 696d 203a 2073 7472 2c20 4974     dim : str, It
+0002c940: 6572 6162 6c65 206f 6620 4861 7368 6162  erable of Hashab
+0002c950: 6c65 206f 7220 4e6f 6e65 2c20 6f70 7469  le or None, opti
+0002c960: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+0002c970: 2044 696d 656e 7369 6f6e 2873 2920 6f76   Dimension(s) ov
+0002c980: 6572 2077 6869 6368 2074 6f20 756e 7374  er which to unst
+0002c990: 6163 6b2e 2042 7920 6465 6661 756c 7420  ack. By default 
+0002c9a0: 756e 7374 6163 6b73 2061 6c6c 0a20 2020  unstacks all.   
+0002c9b0: 2020 2020 2020 2020 204d 756c 7469 496e           MultiIn
+0002c9c0: 6465 7865 732e 0a20 2020 2020 2020 2066  dexes..        f
+0002c9d0: 696c 6c5f 7661 6c75 6520 3a20 7363 616c  ill_value : scal
+0002c9e0: 6172 206f 7220 6469 6374 2d6c 696b 652c  ar or dict-like,
+0002c9f0: 2064 6566 6175 6c74 3a20 6e61 6e0a 2020   default: nan.  
+0002ca00: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
+0002ca10: 746f 2062 6520 6669 6c6c 6564 2e20 4966  to be filled. If
+0002ca20: 2061 2064 6963 742d 6c69 6b65 2c20 6d61   a dict-like, ma
+0002ca30: 7073 2076 6172 6961 626c 6520 6e61 6d65  ps variable name
+0002ca40: 7320 746f 0a20 2020 2020 2020 2020 2020  s to.           
+0002ca50: 2066 696c 6c20 7661 6c75 6573 2e20 4966   fill values. If
+0002ca60: 206e 6f74 2070 726f 7669 6465 6420 6f72   not provided or
+0002ca70: 2069 6620 7468 6520 6469 6374 2d6c 696b   if the dict-lik
+0002ca80: 6520 646f 6573 206e 6f74 0a20 2020 2020  e does not.     
+0002ca90: 2020 2020 2020 2063 6f6e 7461 696e 2061         contain a
+0002caa0: 6c6c 2076 6172 6961 626c 6573 2c20 7468  ll variables, th
+0002cab0: 6520 6474 7970 6527 7320 4e41 2076 616c  e dtype's NA val
+0002cac0: 7565 2077 696c 6c20 6265 2075 7365 642e  ue will be used.
+0002cad0: 0a20 2020 2020 2020 2073 7061 7273 6520  .        sparse 
+0002cae0: 3a20 626f 6f6c 2c20 6465 6661 756c 743a  : bool, default:
+0002caf0: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+0002cb00: 2020 2075 7365 2073 7061 7273 652d 6172     use sparse-ar
+0002cb10: 7261 7920 6966 2054 7275 650a 0a20 2020  ray if True..   
+0002cb20: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+0002cb30: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+0002cb40: 2020 2020 2075 6e73 7461 636b 6564 203a       unstacked :
+0002cb50: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
+0002cb60: 2020 2020 2044 6174 6173 6574 2077 6974       Dataset wit
+0002cb70: 6820 756e 7374 6163 6b65 6420 6461 7461  h unstacked data
+0002cb80: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
+0002cb90: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+0002cba0: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
+0002cbb0: 6173 6574 2e73 7461 636b 0a20 2020 2020  aset.stack.     
+0002cbc0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+0002cbd0: 6966 2064 696d 2069 7320 4e6f 6e65 3a0a  if dim is None:.
+0002cbe0: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
+0002cbf0: 203d 206c 6973 7428 7365 6c66 2e64 696d   = list(self.dim
+0002cc00: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
+0002cc10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002cc20: 6973 696e 7374 616e 6365 2864 696d 2c20  isinstance(dim, 
+0002cc30: 7374 7229 206f 7220 6e6f 7420 6973 696e  str) or not isin
+0002cc40: 7374 616e 6365 2864 696d 2c20 4974 6572  stance(dim, Iter
+0002cc50: 6162 6c65 293a 0a20 2020 2020 2020 2020  able):.         
+0002cc60: 2020 2020 2020 2064 696d 7320 3d20 5b64         dims = [d
+0002cc70: 696d 5d0a 2020 2020 2020 2020 2020 2020  im].            
+0002cc80: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002cc90: 2020 2020 2020 6469 6d73 203d 206c 6973        dims = lis
+0002cca0: 7428 6469 6d29 0a0a 2020 2020 2020 2020  t(dim)..        
+0002ccb0: 2020 2020 6d69 7373 696e 675f 6469 6d73      missing_dims
+0002ccc0: 203d 205b 6420 666f 7220 6420 696e 2064   = [d for d in d
+0002ccd0: 696d 7320 6966 2064 206e 6f74 2069 6e20  ims if d not in 
+0002cce0: 7365 6c66 2e64 696d 735d 0a20 2020 2020  self.dims].     
+0002ccf0: 2020 2020 2020 2069 6620 6d69 7373 696e         if missin
+0002cd00: 675f 6469 6d73 3a0a 2020 2020 2020 2020  g_dims:.        
+0002cd10: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0002cd20: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+0002cd30: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0002cd40: 4461 7461 7365 7420 646f 6573 206e 6f74  Dataset does not
+0002cd50: 2063 6f6e 7461 696e 2074 6865 2064 696d   contain the dim
+0002cd60: 656e 7369 6f6e 733a 207b 6d69 7373 696e  ensions: {missin
+0002cd70: 675f 6469 6d73 7d22 0a20 2020 2020 2020  g_dims}".       
+0002cd80: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0002cd90: 2020 2020 2320 6561 6368 2073 7065 6369      # each speci
+0002cda0: 6669 6564 2064 696d 656e 7369 6f6e 206d  fied dimension m
+0002cdb0: 7573 7420 6861 7665 2065 7861 6374 6c79  ust have exactly
+0002cdc0: 206f 6e65 206d 756c 7469 2d69 6e64 6578   one multi-index
+0002cdd0: 0a20 2020 2020 2020 2073 7461 636b 6564  .        stacked
+0002cde0: 5f69 6e64 6578 6573 3a20 6469 6374 5b41  _indexes: dict[A
+0002cdf0: 6e79 2c20 7475 706c 655b 496e 6465 782c  ny, tuple[Index,
+0002ce00: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
+0002ce10: 5661 7269 6162 6c65 5d5d 5d20 3d20 7b7d  Variable]]] = {}
+0002ce20: 0a20 2020 2020 2020 2066 6f72 2064 2069  .        for d i
+0002ce30: 6e20 6469 6d73 3a0a 2020 2020 2020 2020  n dims:.        
+0002ce40: 2020 2020 6964 782c 2069 6478 5f76 6172      idx, idx_var
+0002ce50: 7320 3d20 7365 6c66 2e5f 6765 745f 7374  s = self._get_st
+0002ce60: 6163 6b5f 696e 6465 7828 642c 206d 756c  ack_index(d, mul
+0002ce70: 7469 3d54 7275 6529 0a20 2020 2020 2020  ti=True).       
+0002ce80: 2020 2020 2069 6620 6964 7820 6973 206e       if idx is n
+0002ce90: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0002cea0: 2020 2020 2020 2020 2073 7461 636b 6564           stacked
+0002ceb0: 5f69 6e64 6578 6573 5b64 5d20 3d20 6964  _indexes[d] = id
+0002cec0: 782c 2069 6478 5f76 6172 730a 0a20 2020  x, idx_vars..   
+0002ced0: 2020 2020 2069 6620 6469 6d20 6973 204e       if dim is N
+0002cee0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002cef0: 2064 696d 7320 3d20 6c69 7374 2873 7461   dims = list(sta
+0002cf00: 636b 6564 5f69 6e64 6578 6573 290a 2020  cked_indexes).  
+0002cf10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0002cf20: 2020 2020 2020 2020 6e6f 6e5f 6d75 6c74          non_mult
+0002cf30: 695f 6469 6d73 203d 2073 6574 2864 696d  i_dims = set(dim
+0002cf40: 7329 202d 2073 6574 2873 7461 636b 6564  s) - set(stacked
+0002cf50: 5f69 6e64 6578 6573 290a 2020 2020 2020  _indexes).      
+0002cf60: 2020 2020 2020 6966 206e 6f6e 5f6d 756c        if non_mul
+0002cf70: 7469 5f64 696d 733a 0a20 2020 2020 2020  ti_dims:.       
+0002cf80: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0002cf90: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+0002cfa0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0002cfb0: 6361 6e6e 6f74 2075 6e73 7461 636b 2064  cannot unstack d
+0002cfc0: 696d 656e 7369 6f6e 7320 7468 6174 2064  imensions that d
+0002cfd0: 6f20 6e6f 7420 220a 2020 2020 2020 2020  o not ".        
+0002cfe0: 2020 2020 2020 2020 2020 2020 6622 6861              f"ha
+0002cff0: 7665 2065 7861 6374 6c79 206f 6e65 206d  ve exactly one m
+0002d000: 756c 7469 2d69 6e64 6578 3a20 7b74 7570  ulti-index: {tup
+0002d010: 6c65 286e 6f6e 5f6d 756c 7469 5f64 696d  le(non_multi_dim
+0002d020: 7329 7d22 0a20 2020 2020 2020 2020 2020  s)}".           
+0002d030: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0002d040: 7265 7375 6c74 203d 2073 656c 662e 636f  result = self.co
+0002d050: 7079 2864 6565 703d 4661 6c73 6529 0a0a  py(deep=False)..
+0002d060: 2020 2020 2020 2020 2320 7765 2077 616e          # we wan
+0002d070: 7420 746f 2061 766f 6964 2061 6c6c 6f63  t to avoid alloc
+0002d080: 6174 696e 6720 616e 206f 626a 6563 742d  ating an object-
+0002d090: 6474 7970 6520 6e64 6172 7261 7920 666f  dtype ndarray fo
+0002d0a0: 7220 6120 4d75 6c74 6949 6e64 6578 2c0a  r a MultiIndex,.
+0002d0b0: 2020 2020 2020 2020 2320 736f 2077 6520          # so we 
+0002d0c0: 6361 6e27 7420 6a75 7374 2061 6363 6573  can't just acces
+0002d0d0: 7320 7365 6c66 2e76 6172 6961 626c 6573  s self.variables
+0002d0e0: 5b76 5d2e 6461 7461 2066 6f72 2065 7665  [v].data for eve
+0002d0f0: 7279 2076 6172 6961 626c 652e 0a20 2020  ry variable..   
+0002d100: 2020 2020 2023 2057 6520 6f6e 6c79 2063       # We only c
+0002d110: 6865 636b 2074 6865 206e 6f6e 2d69 6e64  heck the non-ind
+0002d120: 6578 2076 6172 6961 626c 6573 2e0a 2020  ex variables..  
+0002d130: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
+0002d140: 6769 7468 7562 2e63 6f6d 2f70 7964 6174  github.com/pydat
+0002d150: 612f 7861 7272 6179 2f69 7373 7565 732f  a/xarray/issues/
+0002d160: 3539 3032 0a20 2020 2020 2020 206e 6f6e  5902.        non
+0002d170: 696e 6465 7865 7320 3d20 5b0a 2020 2020  indexes = [.    
+0002d180: 2020 2020 2020 2020 7365 6c66 2e76 6172          self.var
+0002d190: 6961 626c 6573 5b6b 5d20 666f 7220 6b20  iables[k] for k 
+0002d1a0: 696e 2073 6574 2873 656c 662e 7661 7269  in set(self.vari
+0002d1b0: 6162 6c65 7329 202d 2073 6574 2873 656c  ables) - set(sel
+0002d1c0: 662e 5f69 6e64 6578 6573 290a 2020 2020  f._indexes).    
+0002d1d0: 2020 2020 5d0a 2020 2020 2020 2020 2320      ].        # 
+0002d1e0: 4e6f 7465 7320 666f 7220 6561 6368 206f  Notes for each o
+0002d1f0: 6620 7468 6573 6520 6361 7365 733a 0a20  f these cases:. 
+0002d200: 2020 2020 2020 2023 2031 2e20 4461 736b         # 1. Dask
+0002d210: 2061 7272 6179 7320 646f 6e27 7420 7375   arrays don't su
+0002d220: 7070 6f72 7420 6173 7369 676e 6d65 6e74  pport assignment
+0002d230: 2062 7920 696e 6465 782c 2077 6869 6368   by index, which
+0002d240: 2074 6865 2066 6173 7420 756e 7374 6163   the fast unstac
+0002d250: 6b0a 2020 2020 2020 2020 2320 2020 2066  k.        #    f
+0002d260: 756e 6374 696f 6e20 7265 7175 6972 6573  unction requires
+0002d270: 2e0a 2020 2020 2020 2020 2320 2020 2068  ..        #    h
+0002d280: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+0002d290: 6d2f 7079 6461 7461 2f78 6172 7261 792f  m/pydata/xarray/
+0002d2a0: 7075 6c6c 2f34 3734 3623 6973 7375 6563  pull/4746#issuec
+0002d2b0: 6f6d 6d65 6e74 2d37 3533 3238 3231 3235  omment-753282125
+0002d2c0: 0a20 2020 2020 2020 2023 2032 2e20 5370  .        # 2. Sp
+0002d2d0: 6172 7365 2064 6f65 736e 2774 2063 7572  arse doesn't cur
+0002d2e0: 7265 6e74 6c79 2073 7570 706f 7274 2028  rently support (
+0002d2f0: 7468 6f75 6768 2077 6520 636f 756c 6420  though we could 
+0002d300: 7370 6563 6961 6c2d 6361 7365 2069 7429  special-case it)
+0002d310: 0a20 2020 2020 2020 2023 2020 2020 6874  .        #    ht
+0002d320: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+0002d330: 2f70 7964 6174 612f 7370 6172 7365 2f69  /pydata/sparse/i
+0002d340: 7373 7565 732f 3432 320a 2020 2020 2020  ssues/422.      
+0002d350: 2020 2320 332e 2070 696e 7420 7265 7175    # 3. pint requ
+0002d360: 6972 6573 2063 6865 636b 696e 6720 6966  ires checking if
+0002d370: 2069 7427 7320 6120 4e75 6d50 7920 6172   it's a NumPy ar
+0002d380: 7261 7920 756e 7469 6c0a 2020 2020 2020  ray until.      
+0002d390: 2020 2320 2020 2068 7474 7073 3a2f 2f67    #    https://g
+0002d3a0: 6974 6875 622e 636f 6d2f 7079 6461 7461  ithub.com/pydata
+0002d3b0: 2f78 6172 7261 792f 7075 6c6c 2f34 3735  /xarray/pull/475
+0002d3c0: 3120 6973 2072 6573 6f6c 7665 642c 0a20  1 is resolved,. 
+0002d3d0: 2020 2020 2020 2023 2020 2020 4f6e 6365         #    Once
+0002d3e0: 2074 6861 7420 6973 2072 6573 6f6c 7665   that is resolve
+0002d3f0: 642c 2065 7870 6c69 6369 746c 7920 6578  d, explicitly ex
+0002d400: 636c 7564 6520 7069 6e74 2061 7272 6179  clude pint array
+0002d410: 732e 0a20 2020 2020 2020 2023 2020 2020  s..        #    
+0002d420: 7069 6e74 2064 6f65 736e 2774 2069 6d70  pint doesn't imp
+0002d430: 6c65 6d65 6e74 2060 6e70 2e66 756c 6c5f  lement `np.full_
+0002d440: 6c69 6b65 6020 696e 2061 2077 6179 2074  like` in a way t
+0002d450: 6861 7427 730a 2020 2020 2020 2020 2320  hat's.        # 
+0002d460: 2020 2063 7572 7265 6e74 6c79 2063 6f6d     currently com
+0002d470: 7061 7469 626c 652e 0a20 2020 2020 2020  patible..       
+0002d480: 2073 7061 7273 655f 6172 7261 795f 7479   sparse_array_ty
+0002d490: 7065 203d 2061 7272 6179 5f74 7970 6528  pe = array_type(
+0002d4a0: 2273 7061 7273 6522 290a 2020 2020 2020  "sparse").      
+0002d4b0: 2020 6e65 6564 735f 6675 6c6c 5f72 6569    needs_full_rei
+0002d4c0: 6e64 6578 203d 2061 6e79 280a 2020 2020  ndex = any(.    
+0002d4d0: 2020 2020 2020 2020 6973 5f64 7563 6b5f          is_duck_
+0002d4e0: 6461 736b 5f61 7272 6179 2876 2e64 6174  dask_array(v.dat
+0002d4f0: 6129 0a20 2020 2020 2020 2020 2020 206f  a).            o
+0002d500: 7220 6973 696e 7374 616e 6365 2876 2e64  r isinstance(v.d
+0002d510: 6174 612c 2073 7061 7273 655f 6172 7261  ata, sparse_arra
+0002d520: 795f 7479 7065 290a 2020 2020 2020 2020  y_type).        
+0002d530: 2020 2020 6f72 206e 6f74 2069 7369 6e73      or not isins
+0002d540: 7461 6e63 6528 762e 6461 7461 2c20 6e70  tance(v.data, np
+0002d550: 2e6e 6461 7272 6179 290a 2020 2020 2020  .ndarray).      
+0002d560: 2020 2020 2020 666f 7220 7620 696e 206e        for v in n
+0002d570: 6f6e 696e 6465 7865 730a 2020 2020 2020  onindexes.      
+0002d580: 2020 290a 0a20 2020 2020 2020 2066 6f72    )..        for
+0002d590: 2064 2069 6e20 6469 6d73 3a0a 2020 2020   d in dims:.    
+0002d5a0: 2020 2020 2020 2020 6966 206e 6565 6473          if needs
+0002d5b0: 5f66 756c 6c5f 7265 696e 6465 783a 0a20  _full_reindex:. 
+0002d5c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0002d5d0: 6573 756c 7420 3d20 7265 7375 6c74 2e5f  esult = result._
+0002d5e0: 756e 7374 6163 6b5f 6675 6c6c 5f72 6569  unstack_full_rei
+0002d5f0: 6e64 6578 280a 2020 2020 2020 2020 2020  ndex(.          
+0002d600: 2020 2020 2020 2020 2020 642c 2073 7461            d, sta
+0002d610: 636b 6564 5f69 6e64 6578 6573 5b64 5d2c  cked_indexes[d],
+0002d620: 2066 696c 6c5f 7661 6c75 652c 2073 7061   fill_value, spa
+0002d630: 7273 650a 2020 2020 2020 2020 2020 2020  rse.            
+0002d640: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0002d650: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002d660: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0002d670: 2072 6573 756c 742e 5f75 6e73 7461 636b   result._unstack
+0002d680: 5f6f 6e63 6528 642c 2073 7461 636b 6564  _once(d, stacked
+0002d690: 5f69 6e64 6578 6573 5b64 5d2c 2066 696c  _indexes[d], fil
+0002d6a0: 6c5f 7661 6c75 652c 2073 7061 7273 6529  l_value, sparse)
+0002d6b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002d6c0: 7265 7375 6c74 0a0a 2020 2020 6465 6620  result..    def 
+0002d6d0: 7570 6461 7465 2873 656c 663a 2054 5f44  update(self: T_D
+0002d6e0: 6174 6173 6574 2c20 6f74 6865 723a 2043  ataset, other: C
+0002d6f0: 6f65 7263 6962 6c65 4d61 7070 696e 6729  oercibleMapping)
+0002d700: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
+0002d710: 2020 2020 2020 2022 2222 5570 6461 7465         """Update
+0002d720: 2074 6869 7320 6461 7461 7365 7427 7320   this dataset's 
+0002d730: 7661 7269 6162 6c65 7320 7769 7468 2074  variables with t
+0002d740: 686f 7365 2066 726f 6d20 616e 6f74 6865  hose from anothe
+0002d750: 7220 6461 7461 7365 742e 0a0a 2020 2020  r dataset...    
+0002d760: 2020 2020 4a75 7374 206c 696b 6520 3a70      Just like :p
+0002d770: 793a 6d65 7468 3a60 6469 6374 2e75 7064  y:meth:`dict.upd
+0002d780: 6174 6560 2074 6869 7320 6973 2061 2069  ate` this is a i
+0002d790: 6e2d 706c 6163 6520 6f70 6572 6174 696f  n-place operatio
+0002d7a0: 6e2e 0a20 2020 2020 2020 2046 6f72 2061  n..        For a
+0002d7b0: 206e 6f6e 2d69 6e70 6c61 6365 2076 6572   non-inplace ver
+0002d7c0: 7369 6f6e 2c20 7365 6520 3a70 793a 6d65  sion, see :py:me
+0002d7d0: 7468 3a60 4461 7461 7365 742e 6d65 7267  th:`Dataset.merg
+0002d7e0: 6560 2e0a 0a20 2020 2020 2020 2050 6172  e`...        Par
+0002d7f0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+0002d800: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+0002d810: 2020 206f 7468 6572 203a 2044 6174 6173     other : Datas
+0002d820: 6574 206f 7220 6d61 7070 696e 670a 2020  et or mapping.  
+0002d830: 2020 2020 2020 2020 2020 5661 7269 6162            Variab
+0002d840: 6c65 7320 7769 7468 2077 6869 6368 2074  les with which t
+0002d850: 6f20 7570 6461 7465 2074 6869 7320 6461  o update this da
+0002d860: 7461 7365 742e 204f 6e65 206f 663a 0a0a  taset. One of:..
+0002d870: 2020 2020 2020 2020 2020 2020 2d20 4461              - Da
+0002d880: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
+0002d890: 2020 2d20 6d61 7070 696e 6720 7b76 6172    - mapping {var
+0002d8a0: 206e 616d 653a 2044 6174 6141 7272 6179   name: DataArray
+0002d8b0: 7d0a 2020 2020 2020 2020 2020 2020 2d20  }.            - 
+0002d8c0: 6d61 7070 696e 6720 7b76 6172 206e 616d  mapping {var nam
+0002d8d0: 653a 2056 6172 6961 626c 657d 0a20 2020  e: Variable}.   
+0002d8e0: 2020 2020 2020 2020 202d 206d 6170 7069           - mappi
+0002d8f0: 6e67 207b 7661 7220 6e61 6d65 3a20 2864  ng {var name: (d
+0002d900: 696d 656e 7369 6f6e 206e 616d 652c 2061  imension name, a
+0002d910: 7272 6179 2d6c 696b 6529 7d0a 2020 2020  rray-like)}.    
+0002d920: 2020 2020 2020 2020 2d20 6d61 7070 696e          - mappin
+0002d930: 6720 7b76 6172 206e 616d 653a 2028 7475  g {var name: (tu
+0002d940: 706c 6520 6f66 2064 696d 656e 7369 6f6e  ple of dimension
+0002d950: 206e 616d 6573 2c20 6172 7261 792d 6c69   names, array-li
+0002d960: 6b65 297d 0a0a 2020 2020 2020 2020 5265  ke)}..        Re
+0002d970: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+0002d980: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7570  -----.        up
+0002d990: 6461 7465 6420 3a20 4461 7461 7365 740a  dated : Dataset.
+0002d9a0: 2020 2020 2020 2020 2020 2020 5570 6461              Upda
+0002d9b0: 7465 6420 6461 7461 7365 742e 204e 6f74  ted dataset. Not
+0002d9c0: 6520 7468 6174 2073 696e 6365 2074 6865  e that since the
+0002d9d0: 2075 7064 6174 6520 6973 2069 6e2d 706c   update is in-pl
+0002d9e0: 6163 6520 7468 6973 2069 7320 7468 6520  ace this is the 
+0002d9f0: 696e 7075 740a 2020 2020 2020 2020 2020  input.          
+0002da00: 2020 6461 7461 7365 742e 0a0a 2020 2020    dataset...    
+0002da10: 2020 2020 2020 2020 4974 2069 7320 6465          It is de
+0002da20: 7072 6563 6174 6564 2073 696e 6365 2076  precated since v
+0002da30: 6572 7369 6f6e 2030 2e31 3720 616e 6420  ersion 0.17 and 
+0002da40: 7363 6865 6475 6c65 6420 746f 2062 6520  scheduled to be 
+0002da50: 7265 6d6f 7665 6420 696e 2030 2e32 312e  removed in 0.21.
+0002da60: 0a0a 2020 2020 2020 2020 5261 6973 6573  ..        Raises
+0002da70: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d0a  .        ------.
+0002da80: 2020 2020 2020 2020 5661 6c75 6545 7272          ValueErr
+0002da90: 6f72 0a20 2020 2020 2020 2020 2020 2049  or.            I
+0002daa0: 6620 616e 7920 6469 6d65 6e73 696f 6e73  f any dimensions
+0002dab0: 2077 6f75 6c64 2068 6176 6520 696e 636f   would have inco
+0002dac0: 6e73 6973 7465 6e74 2073 697a 6573 2069  nsistent sizes i
+0002dad0: 6e20 7468 6520 7570 6461 7465 640a 2020  n the updated.  
+0002dae0: 2020 2020 2020 2020 2020 6461 7461 7365            datase
+0002daf0: 742e 0a0a 2020 2020 2020 2020 5365 6520  t...        See 
+0002db00: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+0002db10: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
+0002db20: 7461 7365 742e 6173 7369 676e 0a20 2020  taset.assign.   
+0002db30: 2020 2020 2044 6174 6173 6574 2e6d 6572       Dataset.mer
+0002db40: 6765 0a20 2020 2020 2020 2022 2222 0a20  ge.        """. 
+0002db50: 2020 2020 2020 206d 6572 6765 5f72 6573         merge_res
+0002db60: 756c 7420 3d20 6461 7461 7365 745f 7570  ult = dataset_up
+0002db70: 6461 7465 5f6d 6574 686f 6428 7365 6c66  date_method(self
+0002db80: 2c20 6f74 6865 7229 0a20 2020 2020 2020  , other).       
+0002db90: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
+0002dba0: 706c 6163 6528 696e 706c 6163 653d 5472  place(inplace=Tr
+0002dbb0: 7565 2c20 2a2a 6d65 7267 655f 7265 7375  ue, **merge_resu
+0002dbc0: 6c74 2e5f 6173 6469 6374 2829 290a 0a20  lt._asdict()).. 
+0002dbd0: 2020 2064 6566 206d 6572 6765 280a 2020     def merge(.  
+0002dbe0: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
+0002dbf0: 7461 7365 742c 0a20 2020 2020 2020 206f  taset,.        o
+0002dc00: 7468 6572 3a20 436f 6572 6369 626c 654d  ther: CoercibleM
+0002dc10: 6170 7069 6e67 207c 2044 6174 6141 7272  apping | DataArr
+0002dc20: 6179 2c0a 2020 2020 2020 2020 6f76 6572  ay,.        over
+0002dc30: 7772 6974 655f 7661 7273 3a20 4861 7368  write_vars: Hash
+0002dc40: 6162 6c65 207c 2049 7465 7261 626c 655b  able | Iterable[
+0002dc50: 4861 7368 6162 6c65 5d20 3d20 6672 6f7a  Hashable] = froz
+0002dc60: 656e 7365 7428 292c 0a20 2020 2020 2020  enset(),.       
+0002dc70: 2063 6f6d 7061 743a 2043 6f6d 7061 744f   compat: CompatO
+0002dc80: 7074 696f 6e73 203d 2022 6e6f 5f63 6f6e  ptions = "no_con
+0002dc90: 666c 6963 7473 222c 0a20 2020 2020 2020  flicts",.       
+0002dca0: 206a 6f69 6e3a 204a 6f69 6e4f 7074 696f   join: JoinOptio
+0002dcb0: 6e73 203d 2022 6f75 7465 7222 2c0a 2020  ns = "outer",.  
+0002dcc0: 2020 2020 2020 6669 6c6c 5f76 616c 7565        fill_value
+0002dcd0: 3a20 416e 7920 3d20 7872 6474 7970 6573  : Any = xrdtypes
+0002dce0: 2e4e 412c 0a20 2020 2020 2020 2063 6f6d  .NA,.        com
+0002dcf0: 6269 6e65 5f61 7474 7273 3a20 436f 6d62  bine_attrs: Comb
+0002dd00: 696e 6541 7474 7273 4f70 7469 6f6e 7320  ineAttrsOptions 
+0002dd10: 3d20 226f 7665 7272 6964 6522 2c0a 2020  = "override",.  
+0002dd20: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
+0002dd30: 3a0a 2020 2020 2020 2020 2222 224d 6572  :.        """Mer
+0002dd40: 6765 2074 6865 2061 7272 6179 7320 6f66  ge the arrays of
+0002dd50: 2074 776f 2064 6174 6173 6574 7320 696e   two datasets in
+0002dd60: 746f 2061 2073 696e 676c 6520 6461 7461  to a single data
+0002dd70: 7365 742e 0a0a 2020 2020 2020 2020 5468  set...        Th
+0002dd80: 6973 206d 6574 686f 6420 6765 6e65 7261  is method genera
+0002dd90: 6c6c 7920 646f 6573 206e 6f74 2061 6c6c  lly does not all
+0002dda0: 6f77 2066 6f72 206f 7665 7272 6964 696e  ow for overridin
+0002ddb0: 6720 6461 7461 2c20 7769 7468 2074 6865  g data, with the
+0002ddc0: 0a20 2020 2020 2020 2065 7863 6570 7469  .        excepti
+0002ddd0: 6f6e 206f 6620 6174 7472 6962 7574 6573  on of attributes
+0002dde0: 2c20 7768 6963 6820 6172 6520 6967 6e6f  , which are igno
+0002ddf0: 7265 6420 6f6e 2074 6865 2073 6563 6f6e  red on the secon
+0002de00: 6420 6461 7461 7365 742e 0a20 2020 2020  d dataset..     
+0002de10: 2020 2056 6172 6961 626c 6573 2077 6974     Variables wit
+0002de20: 6820 7468 6520 7361 6d65 206e 616d 6520  h the same name 
+0002de30: 6172 6520 6368 6563 6b65 6420 666f 7220  are checked for 
+0002de40: 636f 6e66 6c69 6374 7320 7669 6120 7468  conflicts via th
+0002de50: 6520 6571 7561 6c73 0a20 2020 2020 2020  e equals.       
+0002de60: 206f 7220 6964 656e 7469 6361 6c20 6d65   or identical me
+0002de70: 7468 6f64 732e 0a0a 2020 2020 2020 2020  thods...        
+0002de80: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+0002de90: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0002dea0: 2020 2020 2020 6f74 6865 7220 3a20 4461        other : Da
+0002deb0: 7461 7365 7420 6f72 206d 6170 7069 6e67  taset or mapping
+0002dec0: 0a20 2020 2020 2020 2020 2020 2044 6174  .            Dat
+0002ded0: 6173 6574 206f 7220 7661 7269 6162 6c65  aset or variable
+0002dee0: 7320 746f 206d 6572 6765 2077 6974 6820  s to merge with 
+0002def0: 7468 6973 2064 6174 6173 6574 2e0a 2020  this dataset..  
+0002df00: 2020 2020 2020 6f76 6572 7772 6974 655f        overwrite_
+0002df10: 7661 7273 203a 2068 6173 6861 626c 6520  vars : hashable 
+0002df20: 6f72 2069 7465 7261 626c 6520 6f66 2068  or iterable of h
+0002df30: 6173 6861 626c 652c 206f 7074 696f 6e61  ashable, optiona
+0002df40: 6c0a 2020 2020 2020 2020 2020 2020 4966  l.            If
+0002df50: 2070 726f 7669 6465 642c 2075 7064 6174   provided, updat
+0002df60: 6520 7661 7269 6162 6c65 7320 6f66 2074  e variables of t
+0002df70: 6865 7365 206e 616d 6528 7329 2077 6974  hese name(s) wit
+0002df80: 686f 7574 2063 6865 636b 696e 6720 666f  hout checking fo
+0002df90: 720a 2020 2020 2020 2020 2020 2020 636f  r.            co
+0002dfa0: 6e66 6c69 6374 7320 696e 2074 6869 7320  nflicts in this 
+0002dfb0: 6461 7461 7365 742e 0a20 2020 2020 2020  dataset..       
+0002dfc0: 2063 6f6d 7061 7420 3a20 7b22 6964 656e   compat : {"iden
+0002dfd0: 7469 6361 6c22 2c20 2265 7175 616c 7322  tical", "equals"
+0002dfe0: 2c20 2262 726f 6164 6361 7374 5f65 7175  , "broadcast_equ
+0002dff0: 616c 7322 2c20 5c0a 2020 2020 2020 2020  als", \.        
+0002e000: 2020 2020 2020 2020 2020 226e 6f5f 636f            "no_co
+0002e010: 6e66 6c69 6374 7322 2c20 226f 7665 7272  nflicts", "overr
+0002e020: 6964 6522 2c20 226d 696e 696d 616c 227d  ide", "minimal"}
+0002e030: 2c20 6465 6661 756c 743a 2022 6e6f 5f63  , default: "no_c
+0002e040: 6f6e 666c 6963 7473 220a 2020 2020 2020  onflicts".      
+0002e050: 2020 2020 2020 5374 7269 6e67 2069 6e64        String ind
+0002e060: 6963 6174 696e 6720 686f 7720 746f 2063  icating how to c
+0002e070: 6f6d 7061 7265 2076 6172 6961 626c 6573  ompare variables
+0002e080: 206f 6620 7468 6520 7361 6d65 206e 616d   of the same nam
+0002e090: 6520 666f 720a 2020 2020 2020 2020 2020  e for.          
+0002e0a0: 2020 706f 7465 6e74 6961 6c20 636f 6e66    potential conf
+0002e0b0: 6c69 6374 733a 0a0a 2020 2020 2020 2020  licts:..        
+0002e0c0: 2020 2020 2d20 2769 6465 6e74 6963 616c      - 'identical
+0002e0d0: 273a 2061 6c6c 2076 616c 7565 732c 2064  ': all values, d
+0002e0e0: 696d 656e 7369 6f6e 7320 616e 6420 6174  imensions and at
+0002e0f0: 7472 6962 7574 6573 206d 7573 7420 6265  tributes must be
+0002e100: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+0002e110: 2020 2073 616d 652e 0a20 2020 2020 2020     same..       
+0002e120: 2020 2020 202d 2027 6571 7561 6c73 273a       - 'equals':
+0002e130: 2061 6c6c 2076 616c 7565 7320 616e 6420   all values and 
+0002e140: 6469 6d65 6e73 696f 6e73 206d 7573 7420  dimensions must 
+0002e150: 6265 2074 6865 2073 616d 652e 0a20 2020  be the same..   
+0002e160: 2020 2020 2020 2020 202d 2027 6272 6f61           - 'broa
+0002e170: 6463 6173 745f 6571 7561 6c73 273a 2061  dcast_equals': a
+0002e180: 6c6c 2076 616c 7565 7320 6d75 7374 2062  ll values must b
+0002e190: 6520 6571 7561 6c20 7768 656e 2076 6172  e equal when var
+0002e1a0: 6961 626c 6573 2061 7265 0a20 2020 2020  iables are.     
+0002e1b0: 2020 2020 2020 2020 2062 726f 6164 6361           broadca
+0002e1c0: 7374 2061 6761 696e 7374 2065 6163 6820  st against each 
+0002e1d0: 6f74 6865 7220 746f 2065 6e73 7572 6520  other to ensure 
+0002e1e0: 636f 6d6d 6f6e 2064 696d 656e 7369 6f6e  common dimension
+0002e1f0: 732e 0a20 2020 2020 2020 2020 2020 202d  s..            -
+0002e200: 2027 6e6f 5f63 6f6e 666c 6963 7473 273a   'no_conflicts':
+0002e210: 206f 6e6c 7920 7661 6c75 6573 2077 6869   only values whi
+0002e220: 6368 2061 7265 206e 6f74 206e 756c 6c20  ch are not null 
+0002e230: 696e 2062 6f74 6820 6461 7461 7365 7473  in both datasets
+0002e240: 0a20 2020 2020 2020 2020 2020 2020 206d  .              m
+0002e250: 7573 7420 6265 2065 7175 616c 2e20 5468  ust be equal. Th
+0002e260: 6520 7265 7475 726e 6564 2064 6174 6173  e returned datas
+0002e270: 6574 2074 6865 6e20 636f 6e74 6169 6e73  et then contains
+0002e280: 2074 6865 2063 6f6d 6269 6e61 7469 6f6e   the combination
+0002e290: 0a20 2020 2020 2020 2020 2020 2020 206f  .              o
+0002e2a0: 6620 616c 6c20 6e6f 6e2d 6e75 6c6c 2076  f all non-null v
+0002e2b0: 616c 7565 732e 0a20 2020 2020 2020 2020  alues..         
+0002e2c0: 2020 202d 2027 6f76 6572 7269 6465 273a     - 'override':
+0002e2d0: 2073 6b69 7020 636f 6d70 6172 696e 6720   skip comparing 
+0002e2e0: 616e 6420 7069 636b 2076 6172 6961 626c  and pick variabl
+0002e2f0: 6520 6672 6f6d 2066 6972 7374 2064 6174  e from first dat
+0002e300: 6173 6574 0a20 2020 2020 2020 2020 2020  aset.           
+0002e310: 202d 2027 6d69 6e69 6d61 6c27 3a20 6472   - 'minimal': dr
+0002e320: 6f70 2063 6f6e 666c 6963 7469 6e67 2063  op conflicting c
+0002e330: 6f6f 7264 696e 6174 6573 0a0a 2020 2020  oordinates..    
+0002e340: 2020 2020 6a6f 696e 203a 207b 226f 7574      join : {"out
+0002e350: 6572 222c 2022 696e 6e65 7222 2c20 226c  er", "inner", "l
+0002e360: 6566 7422 2c20 2272 6967 6874 222c 2022  eft", "right", "
+0002e370: 6578 6163 7422 2c20 226f 7665 7272 6964  exact", "overrid
+0002e380: 6522 7d2c 205c 0a20 2020 2020 2020 2020  e"}, \.         
+0002e390: 2020 2020 2020 6465 6661 756c 743a 2022        default: "
+0002e3a0: 6f75 7465 7222 0a20 2020 2020 2020 2020  outer".         
+0002e3b0: 2020 204d 6574 686f 6420 666f 7220 6a6f     Method for jo
+0002e3c0: 696e 696e 6720 6060 7365 6c66 6060 2061  ining ``self`` a
+0002e3d0: 6e64 2060 606f 7468 6572 6060 2061 6c6f  nd ``other`` alo
+0002e3e0: 6e67 2073 6861 7265 6420 6469 6d65 6e73  ng shared dimens
+0002e3f0: 696f 6e73 3a0a 0a20 2020 2020 2020 2020  ions:..         
+0002e400: 2020 202d 2027 6f75 7465 7227 3a20 7573     - 'outer': us
+0002e410: 6520 7468 6520 756e 696f 6e20 6f66 2074  e the union of t
+0002e420: 6865 2069 6e64 6578 6573 0a20 2020 2020  he indexes.     
+0002e430: 2020 2020 2020 202d 2027 696e 6e65 7227         - 'inner'
+0002e440: 3a20 7573 6520 7468 6520 696e 7465 7273  : use the inters
+0002e450: 6563 7469 6f6e 206f 6620 7468 6520 696e  ection of the in
+0002e460: 6465 7865 730a 2020 2020 2020 2020 2020  dexes.          
+0002e470: 2020 2d20 276c 6566 7427 3a20 7573 6520    - 'left': use 
+0002e480: 696e 6465 7865 7320 6672 6f6d 2060 6073  indexes from ``s
+0002e490: 656c 6660 600a 2020 2020 2020 2020 2020  elf``.          
+0002e4a0: 2020 2d20 2772 6967 6874 273a 2075 7365    - 'right': use
+0002e4b0: 2069 6e64 6578 6573 2066 726f 6d20 6060   indexes from ``
+0002e4c0: 6f74 6865 7260 600a 2020 2020 2020 2020  other``.        
+0002e4d0: 2020 2020 2d20 2765 7861 6374 273a 2065      - 'exact': e
+0002e4e0: 7272 6f72 2069 6e73 7465 6164 206f 6620  rror instead of 
+0002e4f0: 616c 6967 6e69 6e67 206e 6f6e 2d65 7175  aligning non-equ
+0002e500: 616c 2069 6e64 6578 6573 0a20 2020 2020  al indexes.     
+0002e510: 2020 2020 2020 202d 2027 6f76 6572 7269         - 'overri
+0002e520: 6465 273a 2075 7365 2069 6e64 6578 6573  de': use indexes
+0002e530: 2066 726f 6d20 6060 7365 6c66 6060 2074   from ``self`` t
+0002e540: 6861 7420 6172 6520 7468 6520 7361 6d65  hat are the same
+0002e550: 2073 697a 650a 2020 2020 2020 2020 2020   size.          
+0002e560: 2020 2020 6173 2074 686f 7365 206f 6620      as those of 
+0002e570: 6060 6f74 6865 7260 6020 696e 2074 6861  ``other`` in tha
+0002e580: 7420 6469 6d65 6e73 696f 6e0a 0a20 2020  t dimension..   
+0002e590: 2020 2020 2066 696c 6c5f 7661 6c75 6520       fill_value 
+0002e5a0: 3a20 7363 616c 6172 206f 7220 6469 6374  : scalar or dict
+0002e5b0: 2d6c 696b 652c 206f 7074 696f 6e61 6c0a  -like, optional.
+0002e5c0: 2020 2020 2020 2020 2020 2020 5661 6c75              Valu
+0002e5d0: 6520 746f 2075 7365 2066 6f72 206e 6577  e to use for new
+0002e5e0: 6c79 206d 6973 7369 6e67 2076 616c 7565  ly missing value
+0002e5f0: 732e 2049 6620 6120 6469 6374 2d6c 696b  s. If a dict-lik
+0002e600: 652c 206d 6170 730a 2020 2020 2020 2020  e, maps.        
+0002e610: 2020 2020 7661 7269 6162 6c65 206e 616d      variable nam
+0002e620: 6573 2028 696e 636c 7564 696e 6720 636f  es (including co
+0002e630: 6f72 6469 6e61 7465 7329 2074 6f20 6669  ordinates) to fi
+0002e640: 6c6c 2076 616c 7565 732e 0a20 2020 2020  ll values..     
+0002e650: 2020 2063 6f6d 6269 6e65 5f61 7474 7273     combine_attrs
+0002e660: 203a 207b 2264 726f 7022 2c20 2269 6465   : {"drop", "ide
+0002e670: 6e74 6963 616c 222c 2022 6e6f 5f63 6f6e  ntical", "no_con
+0002e680: 666c 6963 7473 222c 2022 6472 6f70 5f63  flicts", "drop_c
+0002e690: 6f6e 666c 6963 7473 222c 205c 0a20 2020  onflicts", \.   
+0002e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e6b0: 2020 2020 2020 226f 7665 7272 6964 6522        "override"
+0002e6c0: 7d20 6f72 2063 616c 6c61 626c 652c 2064  } or callable, d
+0002e6d0: 6566 6175 6c74 3a20 226f 7665 7272 6964  efault: "overrid
+0002e6e0: 6522 0a20 2020 2020 2020 2020 2020 2041  e".            A
+0002e6f0: 2063 616c 6c61 626c 6520 6f72 2061 2073   callable or a s
+0002e700: 7472 696e 6720 696e 6469 6361 7469 6e67  tring indicating
+0002e710: 2068 6f77 2074 6f20 636f 6d62 696e 6520   how to combine 
+0002e720: 6174 7472 7320 6f66 2074 6865 206f 626a  attrs of the obj
+0002e730: 6563 7473 2062 6569 6e67 0a20 2020 2020  ects being.     
+0002e740: 2020 2020 2020 206d 6572 6765 643a 0a0a         merged:..
+0002e750: 2020 2020 2020 2020 2020 2020 2d20 2264              - "d
+0002e760: 726f 7022 3a20 656d 7074 7920 6174 7472  rop": empty attr
+0002e770: 7320 6f6e 2072 6574 7572 6e65 6420 4461  s on returned Da
+0002e780: 7461 7365 742e 0a20 2020 2020 2020 2020  taset..         
+0002e790: 2020 202d 2022 6964 656e 7469 6361 6c22     - "identical"
+0002e7a0: 3a20 616c 6c20 6174 7472 7320 6d75 7374  : all attrs must
+0002e7b0: 2062 6520 7468 6520 7361 6d65 206f 6e20   be the same on 
+0002e7c0: 6576 6572 7920 6f62 6a65 6374 2e0a 2020  every object..  
+0002e7d0: 2020 2020 2020 2020 2020 2d20 226e 6f5f            - "no_
+0002e7e0: 636f 6e66 6c69 6374 7322 3a20 6174 7472  conflicts": attr
+0002e7f0: 7320 6672 6f6d 2061 6c6c 206f 626a 6563  s from all objec
+0002e800: 7473 2061 7265 2063 6f6d 6269 6e65 642c  ts are combined,
+0002e810: 2061 6e79 2074 6861 7420 6861 7665 0a20   any that have. 
+0002e820: 2020 2020 2020 2020 2020 2020 2074 6865               the
+0002e830: 2073 616d 6520 6e61 6d65 206d 7573 7420   same name must 
+0002e840: 616c 736f 2068 6176 6520 7468 6520 7361  also have the sa
+0002e850: 6d65 2076 616c 7565 2e0a 2020 2020 2020  me value..      
+0002e860: 2020 2020 2020 2d20 2264 726f 705f 636f        - "drop_co
+0002e870: 6e66 6c69 6374 7322 3a20 6174 7472 7320  nflicts": attrs 
+0002e880: 6672 6f6d 2061 6c6c 206f 626a 6563 7473  from all objects
+0002e890: 2061 7265 2063 6f6d 6269 6e65 642c 2061   are combined, a
+0002e8a0: 6e79 2074 6861 7420 6861 7665 0a20 2020  ny that have.   
+0002e8b0: 2020 2020 2020 2020 2020 2074 6865 2073             the s
+0002e8c0: 616d 6520 6e61 6d65 2062 7574 2064 6966  ame name but dif
+0002e8d0: 6665 7265 6e74 2076 616c 7565 7320 6172  ferent values ar
+0002e8e0: 6520 6472 6f70 7065 642e 0a20 2020 2020  e dropped..     
+0002e8f0: 2020 2020 2020 202d 2022 6f76 6572 7269         - "overri
+0002e900: 6465 223a 2073 6b69 7020 636f 6d70 6172  de": skip compar
+0002e910: 696e 6720 616e 6420 636f 7079 2061 7474  ing and copy att
+0002e920: 7273 2066 726f 6d20 7468 6520 6669 7273  rs from the firs
+0002e930: 7420 6461 7461 7365 7420 746f 0a20 2020  t dataset to.   
+0002e940: 2020 2020 2020 2020 2020 2074 6865 2072             the r
+0002e950: 6573 756c 742e 0a0a 2020 2020 2020 2020  esult...        
+0002e960: 2020 2020 4966 2061 2063 616c 6c61 626c      If a callabl
+0002e970: 652c 2069 7420 6d75 7374 2065 7870 6563  e, it must expec
+0002e980: 7420 6120 7365 7175 656e 6365 206f 6620  t a sequence of 
+0002e990: 6060 6174 7472 7360 6020 6469 6374 7320  ``attrs`` dicts 
+0002e9a0: 616e 6420 6120 636f 6e74 6578 7420 6f62  and a context ob
+0002e9b0: 6a65 6374 0a20 2020 2020 2020 2020 2020  ject.           
+0002e9c0: 2061 7320 6974 7320 6f6e 6c79 2070 6172   as its only par
+0002e9d0: 616d 6574 6572 732e 0a0a 2020 2020 2020  ameters...      
+0002e9e0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+0002e9f0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+0002ea00: 2020 6d65 7267 6564 203a 2044 6174 6173    merged : Datas
+0002ea10: 6574 0a20 2020 2020 2020 2020 2020 204d  et.            M
+0002ea20: 6572 6765 6420 6461 7461 7365 742e 0a0a  erged dataset...
+0002ea30: 2020 2020 2020 2020 5261 6973 6573 0a20          Raises. 
+0002ea40: 2020 2020 2020 202d 2d2d 2d2d 2d0a 2020         ------.  
+0002ea50: 2020 2020 2020 4d65 7267 6545 7272 6f72        MergeError
+0002ea60: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0002ea70: 616e 7920 7661 7269 6162 6c65 7320 636f  any variables co
+0002ea80: 6e66 6c69 6374 2028 7365 6520 6060 636f  nflict (see ``co
+0002ea90: 6d70 6174 6060 292e 0a0a 2020 2020 2020  mpat``)...      
+0002eaa0: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+0002eab0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+0002eac0: 2020 2020 4461 7461 7365 742e 7570 6461      Dataset.upda
+0002ead0: 7465 0a20 2020 2020 2020 2022 2222 0a20  te.        """. 
+0002eae0: 2020 2020 2020 2066 726f 6d20 7861 7272         from xarr
+0002eaf0: 6179 2e63 6f72 652e 6461 7461 6172 7261  ay.core.dataarra
+0002eb00: 7920 696d 706f 7274 2044 6174 6141 7272  y import DataArr
+0002eb10: 6179 0a0a 2020 2020 2020 2020 6f74 6865  ay..        othe
+0002eb20: 7220 3d20 6f74 6865 722e 746f 5f64 6174  r = other.to_dat
+0002eb30: 6173 6574 2829 2069 6620 6973 696e 7374  aset() if isinst
+0002eb40: 616e 6365 286f 7468 6572 2c20 4461 7461  ance(other, Data
+0002eb50: 4172 7261 7929 2065 6c73 6520 6f74 6865  Array) else othe
+0002eb60: 720a 2020 2020 2020 2020 6d65 7267 655f  r.        merge_
+0002eb70: 7265 7375 6c74 203d 2064 6174 6173 6574  result = dataset
+0002eb80: 5f6d 6572 6765 5f6d 6574 686f 6428 0a20  _merge_method(. 
+0002eb90: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+0002eba0: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+0002ebb0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+0002ebc0: 6f76 6572 7772 6974 655f 7661 7273 3d6f  overwrite_vars=o
+0002ebd0: 7665 7277 7269 7465 5f76 6172 732c 0a20  verwrite_vars,. 
+0002ebe0: 2020 2020 2020 2020 2020 2063 6f6d 7061             compa
+0002ebf0: 743d 636f 6d70 6174 2c0a 2020 2020 2020  t=compat,.      
+0002ec00: 2020 2020 2020 6a6f 696e 3d6a 6f69 6e2c        join=join,
+0002ec10: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+0002ec20: 6c5f 7661 6c75 653d 6669 6c6c 5f76 616c  l_value=fill_val
+0002ec30: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0002ec40: 636f 6d62 696e 655f 6174 7472 733d 636f  combine_attrs=co
+0002ec50: 6d62 696e 655f 6174 7472 732c 0a20 2020  mbine_attrs,.   
+0002ec60: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+0002ec70: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
+0002ec80: 6163 6528 2a2a 6d65 7267 655f 7265 7375  ace(**merge_resu
+0002ec90: 6c74 2e5f 6173 6469 6374 2829 290a 0a20  lt._asdict()).. 
+0002eca0: 2020 2064 6566 205f 6173 7365 7274 5f61     def _assert_a
+0002ecb0: 6c6c 5f69 6e5f 6461 7461 7365 7428 0a20  ll_in_dataset(. 
+0002ecc0: 2020 2020 2020 2073 656c 662c 206e 616d         self, nam
+0002ecd0: 6573 3a20 4974 6572 6162 6c65 5b48 6173  es: Iterable[Has
+0002ece0: 6861 626c 655d 2c20 7669 7274 7561 6c5f  hable], virtual_
+0002ecf0: 6f6b 6179 3a20 626f 6f6c 203d 2046 616c  okay: bool = Fal
+0002ed00: 7365 0a20 2020 2029 202d 3e20 4e6f 6e65  se.    ) -> None
+0002ed10: 3a0a 2020 2020 2020 2020 6261 645f 6e61  :.        bad_na
+0002ed20: 6d65 7320 3d20 7365 7428 6e61 6d65 7329  mes = set(names)
+0002ed30: 202d 2073 6574 2873 656c 662e 5f76 6172   - set(self._var
+0002ed40: 6961 626c 6573 290a 2020 2020 2020 2020  iables).        
+0002ed50: 6966 2076 6972 7475 616c 5f6f 6b61 793a  if virtual_okay:
+0002ed60: 0a20 2020 2020 2020 2020 2020 2062 6164  .            bad
+0002ed70: 5f6e 616d 6573 202d 3d20 7365 6c66 2e76  _names -= self.v
+0002ed80: 6972 7475 616c 5f76 6172 6961 626c 6573  irtual_variables
+0002ed90: 0a20 2020 2020 2020 2069 6620 6261 645f  .        if bad_
+0002eda0: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
+0002edb0: 2020 206f 7264 6572 6564 5f62 6164 5f6e     ordered_bad_n
+0002edc0: 616d 6573 203d 205b 6e61 6d65 2066 6f72  ames = [name for
+0002edd0: 206e 616d 6520 696e 206e 616d 6573 2069   name in names i
+0002ede0: 6620 6e61 6d65 2069 6e20 6261 645f 6e61  f name in bad_na
+0002edf0: 6d65 735d 0a20 2020 2020 2020 2020 2020  mes].           
+0002ee00: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0002ee10: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0002ee20: 2020 2066 2254 6865 7365 2076 6172 6961     f"These varia
+0002ee30: 626c 6573 2063 616e 6e6f 7420 6265 2066  bles cannot be f
+0002ee40: 6f75 6e64 2069 6e20 7468 6973 2064 6174  ound in this dat
+0002ee50: 6173 6574 3a20 7b6f 7264 6572 6564 5f62  aset: {ordered_b
+0002ee60: 6164 5f6e 616d 6573 7d22 0a20 2020 2020  ad_names}".     
+0002ee70: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0002ee80: 6620 6472 6f70 5f76 6172 7328 0a20 2020  f drop_vars(.   
+0002ee90: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
+0002eea0: 6173 6574 2c0a 2020 2020 2020 2020 6e61  aset,.        na
+0002eeb0: 6d65 733a 2048 6173 6861 626c 6520 7c20  mes: Hashable | 
+0002eec0: 4974 6572 6162 6c65 5b48 6173 6861 626c  Iterable[Hashabl
+0002eed0: 655d 2c0a 2020 2020 2020 2020 2a2c 0a20  e],.        *,. 
+0002eee0: 2020 2020 2020 2065 7272 6f72 733a 2045         errors: E
+0002eef0: 7272 6f72 4f70 7469 6f6e 7320 3d20 2272  rrorOptions = "r
+0002ef00: 6169 7365 222c 0a20 2020 2029 202d 3e20  aise",.    ) -> 
+0002ef10: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+0002ef20: 2020 2022 2222 4472 6f70 2076 6172 6961     """Drop varia
+0002ef30: 626c 6573 2066 726f 6d20 7468 6973 2064  bles from this d
+0002ef40: 6174 6173 6574 2e0a 0a20 2020 2020 2020  ataset...       
+0002ef50: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+0002ef60: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+0002ef70: 2020 2020 2020 206e 616d 6573 203a 2068         names : h
+0002ef80: 6173 6861 626c 6520 6f72 2069 7465 7261  ashable or itera
+0002ef90: 626c 6520 6f66 2068 6173 6861 626c 650a  ble of hashable.
+0002efa0: 2020 2020 2020 2020 2020 2020 4e61 6d65              Name
+0002efb0: 2873 2920 6f66 2076 6172 6961 626c 6573  (s) of variables
+0002efc0: 2074 6f20 6472 6f70 2e0a 2020 2020 2020   to drop..      
+0002efd0: 2020 6572 726f 7273 203a 207b 2272 6169    errors : {"rai
+0002efe0: 7365 222c 2022 6967 6e6f 7265 227d 2c20  se", "ignore"}, 
+0002eff0: 6465 6661 756c 743a 2022 7261 6973 6522  default: "raise"
+0002f000: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0002f010: 2772 6169 7365 272c 2072 6169 7365 7320  'raise', raises 
+0002f020: 6120 5661 6c75 6545 7272 6f72 2065 7272  a ValueError err
+0002f030: 6f72 2069 6620 616e 7920 6f66 2074 6865  or if any of the
+0002f040: 2076 6172 6961 626c 650a 2020 2020 2020   variable.      
+0002f050: 2020 2020 2020 7061 7373 6564 2061 7265        passed are
+0002f060: 206e 6f74 2069 6e20 7468 6520 6461 7461   not in the data
+0002f070: 7365 742e 2049 6620 2769 676e 6f72 6527  set. If 'ignore'
+0002f080: 2c20 616e 7920 6769 7665 6e20 6e61 6d65  , any given name
+0002f090: 7320 7468 6174 2061 7265 2069 6e20 7468  s that are in th
+0002f0a0: 650a 2020 2020 2020 2020 2020 2020 6461  e.            da
+0002f0b0: 7461 7365 7420 6172 6520 6472 6f70 7065  taset are droppe
+0002f0c0: 6420 616e 6420 6e6f 2065 7272 6f72 2069  d and no error i
+0002f0d0: 7320 7261 6973 6564 2e0a 0a20 2020 2020  s raised...     
+0002f0e0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+0002f0f0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+0002f100: 2020 2064 726f 7070 6564 203a 2044 6174     dropped : Dat
+0002f110: 6173 6574 0a0a 2020 2020 2020 2020 2222  aset..        ""
+0002f120: 220a 2020 2020 2020 2020 2320 7468 6520  ".        # the 
+0002f130: 4974 6572 6162 6c65 2063 6865 636b 2069  Iterable check i
+0002f140: 7320 7265 7175 6972 6564 2066 6f72 206d  s required for m
+0002f150: 7970 790a 2020 2020 2020 2020 6966 2069  ypy.        if i
+0002f160: 735f 7363 616c 6172 286e 616d 6573 2920  s_scalar(names) 
+0002f170: 6f72 206e 6f74 2069 7369 6e73 7461 6e63  or not isinstanc
+0002f180: 6528 6e61 6d65 732c 2049 7465 7261 626c  e(names, Iterabl
+0002f190: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0002f1a0: 6e61 6d65 7320 3d20 7b6e 616d 6573 7d0a  names = {names}.
+0002f1b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002f1c0: 2020 2020 2020 2020 2020 6e61 6d65 7320            names 
+0002f1d0: 3d20 7365 7428 6e61 6d65 7329 0a20 2020  = set(names).   
+0002f1e0: 2020 2020 2069 6620 6572 726f 7273 203d       if errors =
+0002f1f0: 3d20 2272 6169 7365 223a 0a20 2020 2020  = "raise":.     
+0002f200: 2020 2020 2020 2073 656c 662e 5f61 7373         self._ass
+0002f210: 6572 745f 616c 6c5f 696e 5f64 6174 6173  ert_all_in_datas
+0002f220: 6574 286e 616d 6573 290a 0a20 2020 2020  et(names)..     
+0002f230: 2020 2023 2047 4836 3530 350a 2020 2020     # GH6505.    
+0002f240: 2020 2020 6f74 6865 725f 6e61 6d65 7320      other_names 
+0002f250: 3d20 7365 7428 290a 2020 2020 2020 2020  = set().        
+0002f260: 666f 7220 7661 7220 696e 206e 616d 6573  for var in names
+0002f270: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
+0002f280: 7962 655f 6d69 6478 203d 2073 656c 662e  ybe_midx = self.
+0002f290: 5f69 6e64 6578 6573 2e67 6574 2876 6172  _indexes.get(var
+0002f2a0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
+0002f2b0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0002f2c0: 6528 6d61 7962 655f 6d69 6478 2c20 5061  e(maybe_midx, Pa
+0002f2d0: 6e64 6173 4d75 6c74 6949 6e64 6578 293a  ndasMultiIndex):
+0002f2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f2f0: 2069 6478 5f63 6f6f 7264 5f6e 616d 6573   idx_coord_names
+0002f300: 203d 2073 6574 286d 6179 6265 5f6d 6964   = set(maybe_mid
+0002f310: 782e 696e 6465 782e 6e61 6d65 7320 2b20  x.index.names + 
+0002f320: 5b6d 6179 6265 5f6d 6964 782e 6469 6d5d  [maybe_midx.dim]
+0002f330: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002f340: 2020 6964 785f 6f74 6865 725f 6e61 6d65    idx_other_name
+0002f350: 7320 3d20 6964 785f 636f 6f72 645f 6e61  s = idx_coord_na
+0002f360: 6d65 7320 2d20 7365 7428 6e61 6d65 7329  mes - set(names)
+0002f370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f380: 206f 7468 6572 5f6e 616d 6573 2e75 7064   other_names.upd
+0002f390: 6174 6528 6964 785f 6f74 6865 725f 6e61  ate(idx_other_na
+0002f3a0: 6d65 7329 0a20 2020 2020 2020 2069 6620  mes).        if 
+0002f3b0: 6f74 6865 725f 6e61 6d65 733a 0a20 2020  other_names:.   
+0002f3c0: 2020 2020 2020 2020 206e 616d 6573 207c           names |
+0002f3d0: 3d20 7365 7428 6f74 6865 725f 6e61 6d65  = set(other_name
+0002f3e0: 7329 0a20 2020 2020 2020 2020 2020 2077  s).            w
+0002f3f0: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
+0002f400: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0002f410: 4465 6c65 7469 6e67 2061 2073 696e 676c  Deleting a singl
+0002f420: 6520 6c65 7665 6c20 6f66 2061 204d 756c  e level of a Mul
+0002f430: 7469 496e 6465 7820 6973 2064 6570 7265  tiIndex is depre
+0002f440: 6361 7465 642e 2050 7265 7669 6f75 736c  cated. Previousl
+0002f450: 792c 2074 6869 7320 6465 6c65 7465 6420  y, this deleted 
+0002f460: 616c 6c20 6c65 7665 6c73 206f 6620 6120  all levels of a 
+0002f470: 4d75 6c74 6949 6e64 6578 2e20 220a 2020  MultiIndex. ".  
+0002f480: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0002f490: 506c 6561 7365 2061 6c73 6f20 6472 6f70  Please also drop
+0002f4a0: 2074 6865 2066 6f6c 6c6f 7769 6e67 2076   the following v
+0002f4b0: 6172 6961 626c 6573 3a20 7b6f 7468 6572  ariables: {other
+0002f4c0: 5f6e 616d 6573 2172 7d20 746f 2061 766f  _names!r} to avo
+0002f4d0: 6964 2061 6e20 6572 726f 7220 696e 2074  id an error in t
+0002f4e0: 6865 2066 7574 7572 652e 222c 0a20 2020  he future.",.   
+0002f4f0: 2020 2020 2020 2020 2020 2020 2044 6570               Dep
+0002f500: 7265 6361 7469 6f6e 5761 726e 696e 672c  recationWarning,
+0002f510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f520: 2073 7461 636b 6c65 7665 6c3d 322c 0a20   stacklevel=2,. 
+0002f530: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0002f540: 2020 2020 2020 6173 7365 7274 5f6e 6f5f        assert_no_
+0002f550: 696e 6465 785f 636f 7272 7570 7465 6428  index_corrupted(
+0002f560: 7365 6c66 2e78 696e 6465 7865 732c 206e  self.xindexes, n
+0002f570: 616d 6573 290a 0a20 2020 2020 2020 2076  ames)..        v
+0002f580: 6172 6961 626c 6573 203d 207b 6b3a 2076  ariables = {k: v
+0002f590: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
+0002f5a0: 662e 5f76 6172 6961 626c 6573 2e69 7465  f._variables.ite
+0002f5b0: 6d73 2829 2069 6620 6b20 6e6f 7420 696e  ms() if k not in
+0002f5c0: 206e 616d 6573 7d0a 2020 2020 2020 2020   names}.        
+0002f5d0: 636f 6f72 645f 6e61 6d65 7320 3d20 7b6b  coord_names = {k
+0002f5e0: 2066 6f72 206b 2069 6e20 7365 6c66 2e5f   for k in self._
+0002f5f0: 636f 6f72 645f 6e61 6d65 7320 6966 206b  coord_names if k
+0002f600: 2069 6e20 7661 7269 6162 6c65 737d 0a20   in variables}. 
+0002f610: 2020 2020 2020 2069 6e64 6578 6573 203d         indexes =
+0002f620: 207b 6b3a 2076 2066 6f72 206b 2c20 7620   {k: v for k, v 
+0002f630: 696e 2073 656c 662e 5f69 6e64 6578 6573  in self._indexes
+0002f640: 2e69 7465 6d73 2829 2069 6620 6b20 6e6f  .items() if k no
+0002f650: 7420 696e 206e 616d 6573 7d0a 2020 2020  t in names}.    
+0002f660: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0002f670: 5f72 6570 6c61 6365 5f77 6974 685f 6e65  _replace_with_ne
+0002f680: 775f 6469 6d73 280a 2020 2020 2020 2020  w_dims(.        
+0002f690: 2020 2020 7661 7269 6162 6c65 732c 2063      variables, c
+0002f6a0: 6f6f 7264 5f6e 616d 6573 3d63 6f6f 7264  oord_names=coord
+0002f6b0: 5f6e 616d 6573 2c20 696e 6465 7865 733d  _names, indexes=
+0002f6c0: 696e 6465 7865 730a 2020 2020 2020 2020  indexes.        
+0002f6d0: 290a 0a20 2020 2064 6566 2064 726f 705f  )..    def drop_
+0002f6e0: 696e 6465 7865 7328 0a20 2020 2020 2020  indexes(.       
+0002f6f0: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
+0002f700: 2c0a 2020 2020 2020 2020 636f 6f72 645f  ,.        coord_
+0002f710: 6e61 6d65 733a 2048 6173 6861 626c 6520  names: Hashable 
+0002f720: 7c20 4974 6572 6162 6c65 5b48 6173 6861  | Iterable[Hasha
+0002f730: 626c 655d 2c0a 2020 2020 2020 2020 2a2c  ble],.        *,
+0002f740: 0a20 2020 2020 2020 2065 7272 6f72 733a  .        errors:
+0002f750: 2045 7272 6f72 4f70 7469 6f6e 7320 3d20   ErrorOptions = 
+0002f760: 2272 6169 7365 222c 0a20 2020 2029 202d  "raise",.    ) -
+0002f770: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+0002f780: 2020 2020 2022 2222 4472 6f70 2074 6865       """Drop the
+0002f790: 2069 6e64 6578 6573 2061 7373 6967 6e65   indexes assigne
+0002f7a0: 6420 746f 2074 6865 2067 6976 656e 2063  d to the given c
+0002f7b0: 6f6f 7264 696e 6174 6573 2e0a 0a20 2020  oordinates...   
+0002f7c0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+0002f7d0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0002f7e0: 2d2d 0a20 2020 2020 2020 2063 6f6f 7264  --.        coord
+0002f7f0: 5f6e 616d 6573 203a 2068 6173 6861 626c  _names : hashabl
+0002f800: 6520 6f72 2069 7465 7261 626c 6520 6f66  e or iterable of
+0002f810: 2068 6173 6861 626c 650a 2020 2020 2020   hashable.      
+0002f820: 2020 2020 2020 4e61 6d65 2873 2920 6f66        Name(s) of
+0002f830: 2074 6865 2063 6f6f 7264 696e 6174 6528   the coordinate(
+0002f840: 7329 2066 6f72 2077 6869 6368 2074 6f20  s) for which to 
+0002f850: 6472 6f70 2074 6865 2069 6e64 6578 2e0a  drop the index..
+0002f860: 2020 2020 2020 2020 6572 726f 7273 203a          errors :
+0002f870: 207b 2272 6169 7365 222c 2022 6967 6e6f   {"raise", "igno
+0002f880: 7265 227d 2c20 6465 6661 756c 743a 2022  re"}, default: "
+0002f890: 7261 6973 6522 0a20 2020 2020 2020 2020  raise".         
+0002f8a0: 2020 2049 6620 2772 6169 7365 272c 2072     If 'raise', r
+0002f8b0: 6169 7365 7320 6120 5661 6c75 6545 7272  aises a ValueErr
+0002f8c0: 6f72 2065 7272 6f72 2069 6620 616e 7920  or error if any 
+0002f8d0: 6f66 2074 6865 2063 6f6f 7264 696e 6174  of the coordinat
+0002f8e0: 6573 0a20 2020 2020 2020 2020 2020 2070  es.            p
+0002f8f0: 6173 7365 6420 6861 7665 206e 6f20 696e  assed have no in
+0002f900: 6465 7820 6f72 2061 7265 206e 6f74 2069  dex or are not i
+0002f910: 6e20 7468 6520 6461 7461 7365 742e 0a20  n the dataset.. 
+0002f920: 2020 2020 2020 2020 2020 2049 6620 2769             If 'i
+0002f930: 676e 6f72 6527 2c20 6e6f 2065 7272 6f72  gnore', no error
+0002f940: 2069 7320 7261 6973 6564 2e0a 0a20 2020   is raised...   
+0002f950: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+0002f960: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+0002f970: 2020 2020 2064 726f 7070 6564 203a 2044       dropped : D
+0002f980: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
+0002f990: 2020 2041 206e 6577 2064 6174 6173 6574     A new dataset
+0002f9a0: 2077 6974 6820 6472 6f70 7065 6420 696e   with dropped in
+0002f9b0: 6465 7865 732e 0a0a 2020 2020 2020 2020  dexes...        
+0002f9c0: 2222 220a 2020 2020 2020 2020 2320 7468  """.        # th
+0002f9d0: 6520 4974 6572 6162 6c65 2063 6865 636b  e Iterable check
+0002f9e0: 2069 7320 7265 7175 6972 6564 2066 6f72   is required for
+0002f9f0: 206d 7970 790a 2020 2020 2020 2020 6966   mypy.        if
+0002fa00: 2069 735f 7363 616c 6172 2863 6f6f 7264   is_scalar(coord
+0002fa10: 5f6e 616d 6573 2920 6f72 206e 6f74 2069  _names) or not i
+0002fa20: 7369 6e73 7461 6e63 6528 636f 6f72 645f  sinstance(coord_
+0002fa30: 6e61 6d65 732c 2049 7465 7261 626c 6529  names, Iterable)
+0002fa40: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+0002fa50: 6f72 645f 6e61 6d65 7320 3d20 7b63 6f6f  ord_names = {coo
+0002fa60: 7264 5f6e 616d 6573 7d0a 2020 2020 2020  rd_names}.      
+0002fa70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002fa80: 2020 2020 636f 6f72 645f 6e61 6d65 7320      coord_names 
+0002fa90: 3d20 7365 7428 636f 6f72 645f 6e61 6d65  = set(coord_name
+0002faa0: 7329 0a0a 2020 2020 2020 2020 6966 2065  s)..        if e
+0002fab0: 7272 6f72 7320 3d3d 2022 7261 6973 6522  rrors == "raise"
+0002fac0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
+0002fad0: 7661 6c69 645f 636f 6f72 6473 203d 2063  valid_coords = c
+0002fae0: 6f6f 7264 5f6e 616d 6573 202d 2073 656c  oord_names - sel
+0002faf0: 662e 5f63 6f6f 7264 5f6e 616d 6573 0a20  f._coord_names. 
+0002fb00: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+0002fb10: 7661 6c69 645f 636f 6f72 6473 3a0a 2020  valid_coords:.  
+0002fb20: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0002fb30: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+0002fb40: 2274 686f 7365 2063 6f6f 7264 696e 6174  "those coordinat
+0002fb50: 6573 2064 6f6e 2774 2065 7869 7374 3a20  es don't exist: 
+0002fb60: 7b69 6e76 616c 6964 5f63 6f6f 7264 737d  {invalid_coords}
+0002fb70: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+0002fb80: 756e 696e 6465 7865 645f 636f 6f72 6473  unindexed_coords
+0002fb90: 203d 2073 6574 2863 6f6f 7264 5f6e 616d   = set(coord_nam
+0002fba0: 6573 2920 2d20 7365 7428 7365 6c66 2e5f  es) - set(self._
+0002fbb0: 696e 6465 7865 7329 0a20 2020 2020 2020  indexes).       
+0002fbc0: 2020 2020 2069 6620 756e 696e 6465 7865       if unindexe
+0002fbd0: 645f 636f 6f72 6473 3a0a 2020 2020 2020  d_coords:.      
+0002fbe0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0002fbf0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+0002fc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fc10: 6622 7468 6f73 6520 636f 6f72 6469 6e61  f"those coordina
+0002fc20: 7465 7320 646f 206e 6f74 2068 6176 6520  tes do not have 
+0002fc30: 616e 2069 6e64 6578 3a20 7b75 6e69 6e64  an index: {unind
+0002fc40: 6578 6564 5f63 6f6f 7264 737d 220a 2020  exed_coords}".  
+0002fc50: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0002fc60: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
+0002fc70: 6e6f 5f69 6e64 6578 5f63 6f72 7275 7074  no_index_corrupt
+0002fc80: 6564 2873 656c 662e 7869 6e64 6578 6573  ed(self.xindexes
+0002fc90: 2c20 636f 6f72 645f 6e61 6d65 732c 2061  , coord_names, a
+0002fca0: 6374 696f 6e3d 2272 656d 6f76 6520 696e  ction="remove in
+0002fcb0: 6465 7828 6573 2922 290a 0a20 2020 2020  dex(es)")..     
+0002fcc0: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
+0002fcd0: 7d0a 2020 2020 2020 2020 666f 7220 6e61  }.        for na
+0002fce0: 6d65 2c20 7661 7220 696e 2073 656c 662e  me, var in self.
+0002fcf0: 5f76 6172 6961 626c 6573 2e69 7465 6d73  _variables.items
+0002fd00: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0002fd10: 6966 206e 616d 6520 696e 2063 6f6f 7264  if name in coord
+0002fd20: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
+0002fd30: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+0002fd40: 735b 6e61 6d65 5d20 3d20 7661 722e 746f  s[name] = var.to
+0002fd50: 5f62 6173 655f 7661 7269 6162 6c65 2829  _base_variable()
+0002fd60: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0002fd70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002fd80: 2020 2076 6172 6961 626c 6573 5b6e 616d     variables[nam
+0002fd90: 655d 203d 2076 6172 0a0a 2020 2020 2020  e] = var..      
+0002fda0: 2020 696e 6465 7865 7320 3d20 7b6b 3a20    indexes = {k: 
+0002fdb0: 7620 666f 7220 6b2c 2076 2069 6e20 7365  v for k, v in se
+0002fdc0: 6c66 2e5f 696e 6465 7865 732e 6974 656d  lf._indexes.item
+0002fdd0: 7328 2920 6966 206b 206e 6f74 2069 6e20  s() if k not in 
+0002fde0: 636f 6f72 645f 6e61 6d65 737d 0a0a 2020  coord_names}..  
+0002fdf0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0002fe00: 662e 5f72 6570 6c61 6365 2876 6172 6961  f._replace(varia
+0002fe10: 626c 6573 3d76 6172 6961 626c 6573 2c20  bles=variables, 
+0002fe20: 696e 6465 7865 733d 696e 6465 7865 7329  indexes=indexes)
+0002fe30: 0a0a 2020 2020 6465 6620 6472 6f70 280a  ..    def drop(.
+0002fe40: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
+0002fe50: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
+0002fe60: 206c 6162 656c 733d 4e6f 6e65 2c0a 2020   labels=None,.  
+0002fe70: 2020 2020 2020 6469 6d3d 4e6f 6e65 2c0a        dim=None,.
+0002fe80: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
+0002fe90: 2020 2065 7272 6f72 733a 2045 7272 6f72     errors: Error
+0002fea0: 4f70 7469 6f6e 7320 3d20 2272 6169 7365  Options = "raise
+0002feb0: 222c 0a20 2020 2020 2020 202a 2a6c 6162  ",.        **lab
+0002fec0: 656c 735f 6b77 6172 6773 2c0a 2020 2020  els_kwargs,.    
+0002fed0: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+0002fee0: 2020 2020 2020 2020 2222 2242 6163 6b77          """Backw
+0002fef0: 6172 6420 636f 6d70 6174 6962 6c65 206d  ard compatible m
+0002ff00: 6574 686f 6420 6261 7365 6420 6f6e 2060  ethod based on `
+0002ff10: 6472 6f70 5f76 6172 7360 2061 6e64 2060  drop_vars` and `
+0002ff20: 6472 6f70 5f73 656c 600a 0a20 2020 2020  drop_sel`..     
+0002ff30: 2020 2055 7369 6e67 2065 6974 6865 7220     Using either 
+0002ff40: 6064 726f 705f 7661 7273 6020 6f72 2060  `drop_vars` or `
+0002ff50: 6472 6f70 5f73 656c 6020 6973 2065 6e63  drop_sel` is enc
+0002ff60: 6f75 7261 6765 640a 0a20 2020 2020 2020  ouraged..       
+0002ff70: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
+0002ff80: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+0002ff90: 2020 2044 6174 6173 6574 2e64 726f 705f     Dataset.drop_
+0002ffa0: 7661 7273 0a20 2020 2020 2020 2044 6174  vars.        Dat
+0002ffb0: 6173 6574 2e64 726f 705f 7365 6c0a 2020  aset.drop_sel.  
+0002ffc0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0002ffd0: 2020 6966 2065 7272 6f72 7320 6e6f 7420    if errors not 
+0002ffe0: 696e 205b 2272 6169 7365 222c 2022 6967  in ["raise", "ig
+0002fff0: 6e6f 7265 225d 3a0a 2020 2020 2020 2020  nore"]:.        
+00030000: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00030010: 7272 6f72 2827 6572 726f 7273 206d 7573  rror('errors mus
+00030020: 7420 6265 2065 6974 6865 7220 2272 6169  t be either "rai
+00030030: 7365 2220 6f72 2022 6967 6e6f 7265 2227  se" or "ignore"'
+00030040: 290a 0a20 2020 2020 2020 2069 6620 6973  )..        if is
+00030050: 5f64 6963 745f 6c69 6b65 286c 6162 656c  _dict_like(label
+00030060: 7329 2061 6e64 206e 6f74 2069 7369 6e73  s) and not isins
+00030070: 7461 6e63 6528 6c61 6265 6c73 2c20 6469  tance(labels, di
+00030080: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
+00030090: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
+000300a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000300b0: 2264 726f 7070 696e 6720 636f 6f72 6469  "dropping coordi
+000300c0: 6e61 7465 7320 7573 696e 6720 6064 726f  nates using `dro
+000300d0: 7060 2069 7320 6265 2064 6570 7265 6361  p` is be depreca
+000300e0: 7465 643b 2075 7365 2064 726f 705f 7661  ted; use drop_va
+000300f0: 7273 2e22 2c0a 2020 2020 2020 2020 2020  rs.",.          
+00030100: 2020 2020 2020 4675 7475 7265 5761 726e        FutureWarn
+00030110: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
+00030120: 2020 2020 2073 7461 636b 6c65 7665 6c3d       stacklevel=
+00030130: 322c 0a20 2020 2020 2020 2020 2020 2029  2,.            )
+00030140: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00030150: 7572 6e20 7365 6c66 2e64 726f 705f 7661  urn self.drop_va
+00030160: 7273 286c 6162 656c 732c 2065 7272 6f72  rs(labels, error
+00030170: 733d 6572 726f 7273 290a 0a20 2020 2020  s=errors)..     
+00030180: 2020 2069 6620 6c61 6265 6c73 5f6b 7761     if labels_kwa
+00030190: 7267 7320 6f72 2069 7369 6e73 7461 6e63  rgs or isinstanc
+000301a0: 6528 6c61 6265 6c73 2c20 6469 6374 293a  e(labels, dict):
+000301b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000301c0: 6469 6d20 6973 206e 6f74 204e 6f6e 653a  dim is not None:
+000301d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000301e0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+000301f0: 7228 2263 616e 6e6f 7420 7370 6563 6966  r("cannot specif
+00030200: 7920 6469 6d20 616e 6420 6469 6374 2d6c  y dim and dict-l
+00030210: 696b 6520 6172 6775 6d65 6e74 732e 2229  ike arguments.")
+00030220: 0a20 2020 2020 2020 2020 2020 206c 6162  .            lab
+00030230: 656c 7320 3d20 6569 7468 6572 5f64 6963  els = either_dic
+00030240: 745f 6f72 5f6b 7761 7267 7328 6c61 6265  t_or_kwargs(labe
+00030250: 6c73 2c20 6c61 6265 6c73 5f6b 7761 7267  ls, labels_kwarg
+00030260: 732c 2022 6472 6f70 2229 0a0a 2020 2020  s, "drop")..    
+00030270: 2020 2020 6966 2064 696d 2069 7320 4e6f      if dim is No
+00030280: 6e65 2061 6e64 2028 6973 5f73 6361 6c61  ne and (is_scala
+00030290: 7228 6c61 6265 6c73 2920 6f72 2069 7369  r(labels) or isi
+000302a0: 6e73 7461 6e63 6528 6c61 6265 6c73 2c20  nstance(labels, 
+000302b0: 4974 6572 6162 6c65 2929 3a0a 2020 2020  Iterable)):.    
+000302c0: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+000302d0: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
+000302e0: 2020 2020 2020 2022 6472 6f70 7069 6e67         "dropping
+000302f0: 2076 6172 6961 626c 6573 2075 7369 6e67   variables using
+00030300: 2060 6472 6f70 6020 7769 6c6c 2062 6520   `drop` will be 
+00030310: 6465 7072 6563 6174 6564 3b20 7573 696e  deprecated; usin
+00030320: 6720 6472 6f70 5f76 6172 7320 6973 2065  g drop_vars is e
+00030330: 6e63 6f75 7261 6765 642e 222c 0a20 2020  ncouraged.",.   
+00030340: 2020 2020 2020 2020 2020 2020 2050 656e               Pen
+00030350: 6469 6e67 4465 7072 6563 6174 696f 6e57  dingDeprecationW
+00030360: 6172 6e69 6e67 2c0a 2020 2020 2020 2020  arning,.        
+00030370: 2020 2020 2020 2020 7374 6163 6b6c 6576          stacklev
+00030380: 656c 3d32 2c0a 2020 2020 2020 2020 2020  el=2,.          
+00030390: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+000303a0: 7265 7475 726e 2073 656c 662e 6472 6f70  return self.drop
+000303b0: 5f76 6172 7328 6c61 6265 6c73 2c20 6572  _vars(labels, er
+000303c0: 726f 7273 3d65 7272 6f72 7329 0a20 2020  rors=errors).   
+000303d0: 2020 2020 2069 6620 6469 6d20 6973 206e       if dim is n
+000303e0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000303f0: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
+00030400: 726e 280a 2020 2020 2020 2020 2020 2020  rn(.            
+00030410: 2020 2020 2264 726f 7070 696e 6720 6c61      "dropping la
+00030420: 6265 6c73 2075 7369 6e67 206c 6973 742d  bels using list-
+00030430: 6c69 6b65 206c 6162 656c 7320 6973 2064  like labels is d
+00030440: 6570 7265 6361 7465 643b 2075 7369 6e67  eprecated; using
+00030450: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00030460: 2020 2022 6469 6374 2d6c 696b 6520 6172     "dict-like ar
+00030470: 6775 6d65 6e74 7320 7769 7468 2060 6472  guments with `dr
+00030480: 6f70 5f73 656c 602c 2065 2e67 2e20 6064  op_sel`, e.g. `d
+00030490: 732e 6472 6f70 5f73 656c 2864 696d 3d5b  s.drop_sel(dim=[
+000304a0: 6c61 6265 6c73 5d29 2e22 2c0a 2020 2020  labels]).",.    
+000304b0: 2020 2020 2020 2020 2020 2020 4465 7072              Depr
+000304c0: 6563 6174 696f 6e57 6172 6e69 6e67 2c0a  ecationWarning,.
+000304d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000304e0: 7374 6163 6b6c 6576 656c 3d32 2c0a 2020  stacklevel=2,.  
+000304f0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00030500: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00030510: 656c 662e 6472 6f70 5f73 656c 287b 6469  elf.drop_sel({di
+00030520: 6d3a 206c 6162 656c 737d 2c20 6572 726f  m: labels}, erro
+00030530: 7273 3d65 7272 6f72 732c 202a 2a6c 6162  rs=errors, **lab
+00030540: 656c 735f 6b77 6172 6773 290a 0a20 2020  els_kwargs)..   
+00030550: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
+00030560: 726e 280a 2020 2020 2020 2020 2020 2020  rn(.            
+00030570: 2264 726f 7070 696e 6720 6c61 6265 6c73  "dropping labels
+00030580: 2075 7369 6e67 2060 6472 6f70 6020 7769   using `drop` wi
+00030590: 6c6c 2062 6520 6465 7072 6563 6174 6564  ll be deprecated
+000305a0: 3b20 7573 696e 6720 6472 6f70 5f73 656c  ; using drop_sel
+000305b0: 2069 7320 656e 636f 7572 6167 6564 2e22   is encouraged."
+000305c0: 2c0a 2020 2020 2020 2020 2020 2020 5065  ,.            Pe
+000305d0: 6e64 696e 6744 6570 7265 6361 7469 6f6e  ndingDeprecation
+000305e0: 5761 726e 696e 672c 0a20 2020 2020 2020  Warning,.       
+000305f0: 2020 2020 2073 7461 636b 6c65 7665 6c3d       stacklevel=
+00030600: 322c 0a20 2020 2020 2020 2029 0a20 2020  2,.        ).   
+00030610: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00030620: 2e64 726f 705f 7365 6c28 6c61 6265 6c73  .drop_sel(labels
+00030630: 2c20 6572 726f 7273 3d65 7272 6f72 7329  , errors=errors)
+00030640: 0a0a 2020 2020 6465 6620 6472 6f70 5f73  ..    def drop_s
+00030650: 656c 280a 2020 2020 2020 2020 7365 6c66  el(.        self
+00030660: 3a20 545f 4461 7461 7365 742c 206c 6162  : T_Dataset, lab
+00030670: 656c 733d 4e6f 6e65 2c20 2a2c 2065 7272  els=None, *, err
+00030680: 6f72 733a 2045 7272 6f72 4f70 7469 6f6e  ors: ErrorOption
+00030690: 7320 3d20 2272 6169 7365 222c 202a 2a6c  s = "raise", **l
+000306a0: 6162 656c 735f 6b77 6172 6773 0a20 2020  abels_kwargs.   
+000306b0: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
+000306c0: 0a20 2020 2020 2020 2022 2222 4472 6f70  .        """Drop
+000306d0: 2069 6e64 6578 206c 6162 656c 7320 6672   index labels fr
+000306e0: 6f6d 2074 6869 7320 6461 7461 7365 742e  om this dataset.
+000306f0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+00030700: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+00030710: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00030720: 6c61 6265 6c73 203a 206d 6170 7069 6e67  labels : mapping
+00030730: 206f 6620 6861 7368 6162 6c65 2074 6f20   of hashable to 
+00030740: 416e 790a 2020 2020 2020 2020 2020 2020  Any.            
+00030750: 496e 6465 7820 6c61 6265 6c73 2074 6f20  Index labels to 
+00030760: 6472 6f70 0a20 2020 2020 2020 2065 7272  drop.        err
+00030770: 6f72 7320 3a20 7b22 7261 6973 6522 2c20  ors : {"raise", 
+00030780: 2269 676e 6f72 6522 7d2c 2064 6566 6175  "ignore"}, defau
+00030790: 6c74 3a20 2272 6169 7365 220a 2020 2020  lt: "raise".    
+000307a0: 2020 2020 2020 2020 4966 2027 7261 6973          If 'rais
+000307b0: 6527 2c20 7261 6973 6573 2061 2056 616c  e', raises a Val
+000307c0: 7565 4572 726f 7220 6572 726f 7220 6966  ueError error if
+000307d0: 0a20 2020 2020 2020 2020 2020 2061 6e79  .            any
+000307e0: 206f 6620 7468 6520 696e 6465 7820 6c61   of the index la
+000307f0: 6265 6c73 2070 6173 7365 6420 6172 6520  bels passed are 
+00030800: 6e6f 740a 2020 2020 2020 2020 2020 2020  not.            
+00030810: 696e 2074 6865 2064 6174 6173 6574 2e20  in the dataset. 
+00030820: 4966 2027 6967 6e6f 7265 272c 2061 6e79  If 'ignore', any
+00030830: 2067 6976 656e 206c 6162 656c 7320 7468   given labels th
+00030840: 6174 2061 7265 2069 6e20 7468 650a 2020  at are in the.  
+00030850: 2020 2020 2020 2020 2020 6461 7461 7365            datase
+00030860: 7420 6172 6520 6472 6f70 7065 6420 616e  t are dropped an
+00030870: 6420 6e6f 2065 7272 6f72 2069 7320 7261  d no error is ra
+00030880: 6973 6564 2e0a 2020 2020 2020 2020 2a2a  ised..        **
+00030890: 6c61 6265 6c73 5f6b 7761 7267 7320 3a20  labels_kwargs : 
+000308a0: 7b64 696d 3a20 6c61 6265 6c2c 202e 2e2e  {dim: label, ...
+000308b0: 7d2c 206f 7074 696f 6e61 6c0a 2020 2020  }, optional.    
+000308c0: 2020 2020 2020 2020 5468 6520 6b65 7977          The keyw
+000308d0: 6f72 6420 6172 6775 6d65 6e74 7320 666f  ord arguments fo
+000308e0: 726d 206f 6620 6060 6469 6d60 6020 616e  rm of ``dim`` an
+000308f0: 6420 6060 6c61 6265 6c73 6060 0a0a 2020  d ``labels``..  
+00030900: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+00030910: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+00030920: 2020 2020 2020 6472 6f70 7065 6420 3a20        dropped : 
+00030930: 4461 7461 7365 740a 0a20 2020 2020 2020  Dataset..       
+00030940: 2045 7861 6d70 6c65 730a 2020 2020 2020   Examples.      
+00030950: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+00030960: 2020 203e 3e3e 2064 6174 6120 3d20 6e70     >>> data = np
+00030970: 2e61 7261 6e67 6528 3629 2e72 6573 6861  .arange(6).resha
+00030980: 7065 2832 2c20 3329 0a20 2020 2020 2020  pe(2, 3).       
+00030990: 203e 3e3e 206c 6162 656c 7320 3d20 5b22   >>> labels = ["
+000309a0: 6122 2c20 2262 222c 2022 6322 5d0a 2020  a", "b", "c"].  
+000309b0: 2020 2020 2020 3e3e 3e20 6473 203d 2078        >>> ds = x
+000309c0: 722e 4461 7461 7365 7428 7b22 4122 3a20  r.Dataset({"A": 
+000309d0: 285b 2278 222c 2022 7922 5d2c 2064 6174  (["x", "y"], dat
+000309e0: 6129 2c20 2279 223a 206c 6162 656c 737d  a), "y": labels}
+000309f0: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
+00030a00: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
+00030a10: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
+00030a20: 2020 4469 6d65 6e73 696f 6e73 3a20 2028    Dimensions:  (
+00030a30: 783a 2032 2c20 793a 2033 290a 2020 2020  x: 2, y: 3).    
+00030a40: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
+00030a50: 0a20 2020 2020 2020 2020 202a 2079 2020  .          * y  
+00030a60: 2020 2020 2020 2879 2920 3c55 3120 2761        (y) <U1 'a
+00030a70: 2720 2762 2720 2763 270a 2020 2020 2020  ' 'b' 'c'.      
+00030a80: 2020 4469 6d65 6e73 696f 6e73 2077 6974    Dimensions wit
+00030a90: 686f 7574 2063 6f6f 7264 696e 6174 6573  hout coordinates
+00030aa0: 3a20 780a 2020 2020 2020 2020 4461 7461  : x.        Data
+00030ab0: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+00030ac0: 2020 2020 2020 2020 4120 2020 2020 2020          A       
+00030ad0: 2028 782c 2079 2920 696e 7436 3420 3020   (x, y) int64 0 
+00030ae0: 3120 3220 3320 3420 350a 2020 2020 2020  1 2 3 4 5.      
+00030af0: 2020 3e3e 3e20 6473 2e64 726f 705f 7365    >>> ds.drop_se
+00030b00: 6c28 793d 5b22 6122 2c20 2263 225d 290a  l(y=["a", "c"]).
+00030b10: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+00030b20: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+00030b30: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
+00030b40: 3a20 322c 2079 3a20 3129 0a20 2020 2020  : 2, y: 1).     
+00030b50: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+00030b60: 2020 2020 2020 2020 2020 2a20 7920 2020            * y   
+00030b70: 2020 2020 2028 7929 203c 5531 2027 6227       (y) <U1 'b'
+00030b80: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+00030b90: 6f6e 7320 7769 7468 6f75 7420 636f 6f72  ons without coor
+00030ba0: 6469 6e61 7465 733a 2078 0a20 2020 2020  dinates: x.     
+00030bb0: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
+00030bc0: 733a 0a20 2020 2020 2020 2020 2020 2041  s:.            A
+00030bd0: 2020 2020 2020 2020 2878 2c20 7929 2069          (x, y) i
+00030be0: 6e74 3634 2031 2034 0a20 2020 2020 2020  nt64 1 4.       
+00030bf0: 203e 3e3e 2064 732e 6472 6f70 5f73 656c   >>> ds.drop_sel
+00030c00: 2879 3d22 6222 290a 2020 2020 2020 2020  (y="b").        
+00030c10: 3c78 6172 7261 792e 4461 7461 7365 743e  <xarray.Dataset>
+00030c20: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+00030c30: 6f6e 733a 2020 2878 3a20 322c 2079 3a20  ons:  (x: 2, y: 
+00030c40: 3229 0a20 2020 2020 2020 2043 6f6f 7264  2).        Coord
+00030c50: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
+00030c60: 2020 2a20 7920 2020 2020 2020 2028 7929    * y        (y)
+00030c70: 203c 5531 2027 6127 2027 6327 0a20 2020   <U1 'a' 'c'.   
+00030c80: 2020 2020 2044 696d 656e 7369 6f6e 7320       Dimensions 
+00030c90: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
+00030ca0: 7465 733a 2078 0a20 2020 2020 2020 2044  tes: x.        D
+00030cb0: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+00030cc0: 2020 2020 2020 2020 2020 2041 2020 2020             A    
+00030cd0: 2020 2020 2878 2c20 7929 2069 6e74 3634      (x, y) int64
+00030ce0: 2030 2032 2033 2035 0a20 2020 2020 2020   0 2 3 5.       
+00030cf0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00030d00: 6572 726f 7273 206e 6f74 2069 6e20 5b22  errors not in ["
+00030d10: 7261 6973 6522 2c20 2269 676e 6f72 6522  raise", "ignore"
+00030d20: 5d3a 0a20 2020 2020 2020 2020 2020 2072  ]:.            r
+00030d30: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00030d40: 2765 7272 6f72 7320 6d75 7374 2062 6520  'errors must be 
+00030d50: 6569 7468 6572 2022 7261 6973 6522 206f  either "raise" o
+00030d60: 7220 2269 676e 6f72 6522 2729 0a0a 2020  r "ignore"')..  
+00030d70: 2020 2020 2020 6c61 6265 6c73 203d 2065        labels = e
+00030d80: 6974 6865 725f 6469 6374 5f6f 725f 6b77  ither_dict_or_kw
+00030d90: 6172 6773 286c 6162 656c 732c 206c 6162  args(labels, lab
+00030da0: 656c 735f 6b77 6172 6773 2c20 2264 726f  els_kwargs, "dro
+00030db0: 705f 7365 6c22 290a 0a20 2020 2020 2020  p_sel")..       
+00030dc0: 2064 7320 3d20 7365 6c66 0a20 2020 2020   ds = self.     
+00030dd0: 2020 2066 6f72 2064 696d 2c20 6c61 6265     for dim, labe
+00030de0: 6c73 5f66 6f72 5f64 696d 2069 6e20 6c61  ls_for_dim in la
+00030df0: 6265 6c73 2e69 7465 6d73 2829 3a0a 2020  bels.items():.  
+00030e00: 2020 2020 2020 2020 2020 2320 446f 6e27            # Don'
+00030e10: 7420 6361 7374 2074 6f20 7365 742c 2061  t cast to set, a
+00030e20: 7320 6974 2077 6f75 6c64 2068 6172 6d20  s it would harm 
+00030e30: 7065 7266 6f72 6d61 6e63 6520 7768 656e  performance when
+00030e40: 206c 6162 656c 730a 2020 2020 2020 2020   labels.        
+00030e50: 2020 2020 2320 6973 2061 206c 6172 6765      # is a large
+00030e60: 206e 756d 7079 2061 7272 6179 0a20 2020   numpy array.   
+00030e70: 2020 2020 2020 2020 2069 6620 7574 696c           if util
+00030e80: 732e 6973 5f73 6361 6c61 7228 6c61 6265  s.is_scalar(labe
+00030e90: 6c73 5f66 6f72 5f64 696d 293a 0a20 2020  ls_for_dim):.   
+00030ea0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
+00030eb0: 656c 735f 666f 725f 6469 6d20 3d20 5b6c  els_for_dim = [l
+00030ec0: 6162 656c 735f 666f 725f 6469 6d5d 0a20  abels_for_dim]. 
+00030ed0: 2020 2020 2020 2020 2020 206c 6162 656c             label
+00030ee0: 735f 666f 725f 6469 6d20 3d20 6e70 2e61  s_for_dim = np.a
+00030ef0: 7361 7272 6179 286c 6162 656c 735f 666f  sarray(labels_fo
+00030f00: 725f 6469 6d29 0a20 2020 2020 2020 2020  r_dim).         
+00030f10: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00030f20: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
+00030f30: 7365 6c66 2e67 6574 5f69 6e64 6578 2864  self.get_index(d
+00030f40: 696d 290a 2020 2020 2020 2020 2020 2020  im).            
+00030f50: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
+00030f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00030f70: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00030f80: 7228 6622 6469 6d65 6e73 696f 6e20 7b64  r(f"dimension {d
+00030f90: 696d 2172 7d20 646f 6573 206e 6f74 2068  im!r} does not h
+00030fa0: 6176 6520 636f 6f72 6469 6e61 7465 206c  ave coordinate l
+00030fb0: 6162 656c 7322 290a 2020 2020 2020 2020  abels").        
+00030fc0: 2020 2020 6e65 775f 696e 6465 7820 3d20      new_index = 
+00030fd0: 696e 6465 782e 6472 6f70 286c 6162 656c  index.drop(label
+00030fe0: 735f 666f 725f 6469 6d2c 2065 7272 6f72  s_for_dim, error
+00030ff0: 733d 6572 726f 7273 290a 2020 2020 2020  s=errors).      
+00031000: 2020 2020 2020 6473 203d 2064 732e 6c6f        ds = ds.lo
+00031010: 635b 7b64 696d 3a20 6e65 775f 696e 6465  c[{dim: new_inde
+00031020: 787d 5d0a 2020 2020 2020 2020 7265 7475  x}].        retu
+00031030: 726e 2064 730a 0a20 2020 2064 6566 2064  rn ds..    def d
+00031040: 726f 705f 6973 656c 2873 656c 663a 2054  rop_isel(self: T
+00031050: 5f44 6174 6173 6574 2c20 696e 6465 7865  _Dataset, indexe
+00031060: 7273 3d4e 6f6e 652c 202a 2a69 6e64 6578  rs=None, **index
+00031070: 6572 735f 6b77 6172 6773 2920 2d3e 2054  ers_kwargs) -> T
+00031080: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
+00031090: 2020 2222 2244 726f 7020 696e 6465 7820    """Drop index 
+000310a0: 706f 7369 7469 6f6e 7320 6672 6f6d 2074  positions from t
+000310b0: 6869 7320 4461 7461 7365 742e 0a0a 2020  his Dataset...  
+000310c0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+000310d0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000310e0: 2d2d 2d0a 2020 2020 2020 2020 696e 6465  ---.        inde
+000310f0: 7865 7273 203a 206d 6170 7069 6e67 206f  xers : mapping o
+00031100: 6620 6861 7368 6162 6c65 2074 6f20 416e  f hashable to An
+00031110: 790a 2020 2020 2020 2020 2020 2020 496e  y.            In
+00031120: 6465 7820 6c6f 6361 7469 6f6e 7320 746f  dex locations to
+00031130: 2064 726f 700a 2020 2020 2020 2020 2a2a   drop.        **
+00031140: 696e 6465 7865 7273 5f6b 7761 7267 7320  indexers_kwargs 
+00031150: 3a20 7b64 696d 3a20 706f 7369 7469 6f6e  : {dim: position
+00031160: 2c20 2e2e 2e7d 2c20 6f70 7469 6f6e 616c  , ...}, optional
+00031170: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+00031180: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+00031190: 7473 2066 6f72 6d20 6f66 2060 6064 696d  ts form of ``dim
+000311a0: 6060 2061 6e64 2060 6070 6f73 6974 696f  `` and ``positio
+000311b0: 6e73 6060 0a0a 2020 2020 2020 2020 5265  ns``..        Re
+000311c0: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+000311d0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6472  -----.        dr
+000311e0: 6f70 7065 6420 3a20 4461 7461 7365 740a  opped : Dataset.
+000311f0: 0a20 2020 2020 2020 2052 6169 7365 730a  .        Raises.
+00031200: 2020 2020 2020 2020 2d2d 2d2d 2d2d 0a20          ------. 
+00031210: 2020 2020 2020 2049 6e64 6578 4572 726f         IndexErro
+00031220: 720a 0a20 2020 2020 2020 2045 7861 6d70  r..        Examp
+00031230: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
+00031240: 2d2d 2d2d 0a20 2020 2020 2020 203e 3e3e  ----.        >>>
+00031250: 2064 6174 6120 3d20 6e70 2e61 7261 6e67   data = np.arang
+00031260: 6528 3629 2e72 6573 6861 7065 2832 2c20  e(6).reshape(2, 
+00031270: 3329 0a20 2020 2020 2020 203e 3e3e 206c  3).        >>> l
+00031280: 6162 656c 7320 3d20 5b22 6122 2c20 2262  abels = ["a", "b
+00031290: 222c 2022 6322 5d0a 2020 2020 2020 2020  ", "c"].        
+000312a0: 3e3e 3e20 6473 203d 2078 722e 4461 7461  >>> ds = xr.Data
+000312b0: 7365 7428 7b22 4122 3a20 285b 2278 222c  set({"A": (["x",
+000312c0: 2022 7922 5d2c 2064 6174 6129 2c20 2279   "y"], data), "y
+000312d0: 223a 206c 6162 656c 737d 290a 2020 2020  ": labels}).    
+000312e0: 2020 2020 3e3e 3e20 6473 0a20 2020 2020      >>> ds.     
+000312f0: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
+00031300: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
+00031310: 6e73 696f 6e73 3a20 2028 783a 2032 2c20  nsions:  (x: 2, 
+00031320: 793a 2033 290a 2020 2020 2020 2020 436f  y: 3).        Co
+00031330: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
+00031340: 2020 2020 202a 2079 2020 2020 2020 2020       * y        
+00031350: 2879 2920 3c55 3120 2761 2720 2762 2720  (y) <U1 'a' 'b' 
+00031360: 2763 270a 2020 2020 2020 2020 4469 6d65  'c'.        Dime
+00031370: 6e73 696f 6e73 2077 6974 686f 7574 2063  nsions without c
+00031380: 6f6f 7264 696e 6174 6573 3a20 780a 2020  oordinates: x.  
+00031390: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
+000313a0: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+000313b0: 2020 4120 2020 2020 2020 2028 782c 2079    A        (x, y
+000313c0: 2920 696e 7436 3420 3020 3120 3220 3320  ) int64 0 1 2 3 
+000313d0: 3420 350a 2020 2020 2020 2020 3e3e 3e20  4 5.        >>> 
+000313e0: 6473 2e64 726f 705f 6973 656c 2879 3d5b  ds.drop_isel(y=[
+000313f0: 302c 2032 5d29 0a20 2020 2020 2020 203c  0, 2]).        <
+00031400: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
+00031410: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+00031420: 6e73 3a20 2028 783a 2032 2c20 793a 2031  ns:  (x: 2, y: 1
+00031430: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
+00031440: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
+00031450: 202a 2079 2020 2020 2020 2020 2879 2920   * y        (y) 
+00031460: 3c55 3120 2762 270a 2020 2020 2020 2020  <U1 'b'.        
+00031470: 4469 6d65 6e73 696f 6e73 2077 6974 686f  Dimensions witho
+00031480: 7574 2063 6f6f 7264 696e 6174 6573 3a20  ut coordinates: 
+00031490: 780a 2020 2020 2020 2020 4461 7461 2076  x.        Data v
+000314a0: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+000314b0: 2020 2020 2020 4120 2020 2020 2020 2028        A        (
+000314c0: 782c 2079 2920 696e 7436 3420 3120 340a  x, y) int64 1 4.
+000314d0: 2020 2020 2020 2020 3e3e 3e20 6473 2e64          >>> ds.d
+000314e0: 726f 705f 6973 656c 2879 3d31 290a 2020  rop_isel(y=1).  
+000314f0: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
+00031500: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
+00031510: 696d 656e 7369 6f6e 733a 2020 2878 3a20  imensions:  (x: 
+00031520: 322c 2079 3a20 3229 0a20 2020 2020 2020  2, y: 2).       
+00031530: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+00031540: 2020 2020 2020 2020 2a20 7920 2020 2020          * y     
+00031550: 2020 2028 7929 203c 5531 2027 6127 2027     (y) <U1 'a' '
+00031560: 6327 0a20 2020 2020 2020 2044 696d 656e  c'.        Dimen
+00031570: 7369 6f6e 7320 7769 7468 6f75 7420 636f  sions without co
+00031580: 6f72 6469 6e61 7465 733a 2078 0a20 2020  ordinates: x.   
+00031590: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
+000315a0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+000315b0: 2041 2020 2020 2020 2020 2878 2c20 7929   A        (x, y)
+000315c0: 2069 6e74 3634 2030 2032 2033 2035 0a20   int64 0 2 3 5. 
+000315d0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+000315e0: 2020 2020 696e 6465 7865 7273 203d 2065      indexers = e
+000315f0: 6974 6865 725f 6469 6374 5f6f 725f 6b77  ither_dict_or_kw
+00031600: 6172 6773 2869 6e64 6578 6572 732c 2069  args(indexers, i
+00031610: 6e64 6578 6572 735f 6b77 6172 6773 2c20  ndexers_kwargs, 
+00031620: 2264 726f 705f 6973 656c 2229 0a0a 2020  "drop_isel")..  
+00031630: 2020 2020 2020 6473 203d 2073 656c 660a        ds = self.
+00031640: 2020 2020 2020 2020 6469 6d65 6e73 696f          dimensio
+00031650: 6e5f 696e 6465 7820 3d20 7b7d 0a20 2020  n_index = {}.   
+00031660: 2020 2020 2066 6f72 2064 696d 2c20 706f       for dim, po
+00031670: 735f 666f 725f 6469 6d20 696e 2069 6e64  s_for_dim in ind
+00031680: 6578 6572 732e 6974 656d 7328 293a 0a20  exers.items():. 
+00031690: 2020 2020 2020 2020 2020 2023 2044 6f6e             # Don
+000316a0: 2774 2063 6173 7420 746f 2073 6574 2c20  't cast to set, 
+000316b0: 6173 2069 7420 776f 756c 6420 6861 726d  as it would harm
+000316c0: 2070 6572 666f 726d 616e 6365 2077 6865   performance whe
+000316d0: 6e20 6c61 6265 6c73 0a20 2020 2020 2020  n labels.       
+000316e0: 2020 2020 2023 2069 7320 6120 6c61 7267       # is a larg
+000316f0: 6520 6e75 6d70 7920 6172 7261 790a 2020  e numpy array.  
+00031700: 2020 2020 2020 2020 2020 6966 2075 7469            if uti
+00031710: 6c73 2e69 735f 7363 616c 6172 2870 6f73  ls.is_scalar(pos
+00031720: 5f66 6f72 5f64 696d 293a 0a20 2020 2020  _for_dim):.     
+00031730: 2020 2020 2020 2020 2020 2070 6f73 5f66             pos_f
+00031740: 6f72 5f64 696d 203d 205b 706f 735f 666f  or_dim = [pos_fo
+00031750: 725f 6469 6d5d 0a20 2020 2020 2020 2020  r_dim].         
+00031760: 2020 2070 6f73 5f66 6f72 5f64 696d 203d     pos_for_dim =
+00031770: 206e 702e 6173 6172 7261 7928 706f 735f   np.asarray(pos_
+00031780: 666f 725f 6469 6d29 0a20 2020 2020 2020  for_dim).       
+00031790: 2020 2020 2069 6e64 6578 203d 2073 656c       index = sel
+000317a0: 662e 6765 745f 696e 6465 7828 6469 6d29  f.get_index(dim)
+000317b0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+000317c0: 5f69 6e64 6578 203d 2069 6e64 6578 2e64  _index = index.d
+000317d0: 656c 6574 6528 706f 735f 666f 725f 6469  elete(pos_for_di
+000317e0: 6d29 0a20 2020 2020 2020 2020 2020 2064  m).            d
+000317f0: 696d 656e 7369 6f6e 5f69 6e64 6578 5b64  imension_index[d
+00031800: 696d 5d20 3d20 6e65 775f 696e 6465 780a  im] = new_index.
+00031810: 2020 2020 2020 2020 6473 203d 2064 732e          ds = ds.
+00031820: 6c6f 635b 6469 6d65 6e73 696f 6e5f 696e  loc[dimension_in
+00031830: 6465 785d 0a20 2020 2020 2020 2072 6574  dex].        ret
+00031840: 7572 6e20 6473 0a0a 2020 2020 6465 6620  urn ds..    def 
+00031850: 6472 6f70 5f64 696d 7328 0a20 2020 2020  drop_dims(.     
+00031860: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+00031870: 6574 2c0a 2020 2020 2020 2020 6472 6f70  et,.        drop
+00031880: 5f64 696d 733a 2073 7472 207c 2049 7465  _dims: str | Ite
+00031890: 7261 626c 655b 4861 7368 6162 6c65 5d2c  rable[Hashable],
+000318a0: 0a20 2020 2020 2020 202a 2c0a 2020 2020  .        *,.    
+000318b0: 2020 2020 6572 726f 7273 3a20 4572 726f      errors: Erro
+000318c0: 724f 7074 696f 6e73 203d 2022 7261 6973  rOptions = "rais
+000318d0: 6522 2c0a 2020 2020 2920 2d3e 2054 5f44  e",.    ) -> T_D
+000318e0: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
+000318f0: 2222 2244 726f 7020 6469 6d65 6e73 696f  """Drop dimensio
+00031900: 6e73 2061 6e64 2061 7373 6f63 6961 7465  ns and associate
+00031910: 6420 7661 7269 6162 6c65 7320 6672 6f6d  d variables from
+00031920: 2074 6869 7320 6461 7461 7365 742e 0a0a   this dataset...
+00031930: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00031940: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00031950: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6472  -----.        dr
+00031960: 6f70 5f64 696d 7320 3a20 7374 7220 6f72  op_dims : str or
+00031970: 2049 7465 7261 626c 6520 6f66 2048 6173   Iterable of Has
+00031980: 6861 626c 650a 2020 2020 2020 2020 2020  hable.          
+00031990: 2020 4469 6d65 6e73 696f 6e20 6f72 2064    Dimension or d
+000319a0: 696d 656e 7369 6f6e 7320 746f 2064 726f  imensions to dro
+000319b0: 702e 0a20 2020 2020 2020 2065 7272 6f72  p..        error
+000319c0: 7320 3a20 7b22 7261 6973 6522 2c20 2269  s : {"raise", "i
+000319d0: 676e 6f72 6522 7d2c 2064 6566 6175 6c74  gnore"}, default
+000319e0: 3a20 2272 6169 7365 220a 2020 2020 2020  : "raise".      
+000319f0: 2020 2020 2020 4966 2027 7261 6973 6527        If 'raise'
+00031a00: 2c20 7261 6973 6573 2061 2056 616c 7565  , raises a Value
+00031a10: 4572 726f 7220 6572 726f 7220 6966 2061  Error error if a
+00031a20: 6e79 206f 6620 7468 650a 2020 2020 2020  ny of the.      
+00031a30: 2020 2020 2020 6469 6d65 6e73 696f 6e73        dimensions
+00031a40: 2070 6173 7365 6420 6172 6520 6e6f 7420   passed are not 
+00031a50: 696e 2074 6865 2064 6174 6173 6574 2e20  in the dataset. 
+00031a60: 4966 2027 6967 6e6f 7265 272c 2061 6e79  If 'ignore', any
+00031a70: 2067 6976 656e 0a20 2020 2020 2020 2020   given.         
+00031a80: 2020 2064 696d 656e 7369 6f6e 7320 7468     dimensions th
+00031a90: 6174 2061 7265 2069 6e20 7468 6520 6461  at are in the da
+00031aa0: 7461 7365 7420 6172 6520 6472 6f70 7065  taset are droppe
+00031ab0: 6420 616e 6420 6e6f 2065 7272 6f72 2069  d and no error i
+00031ac0: 7320 7261 6973 6564 2e0a 0a20 2020 2020  s raised...     
+00031ad0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+00031ae0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+00031af0: 2020 206f 626a 203a 2044 6174 6173 6574     obj : Dataset
+00031b00: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+00031b10: 2064 6174 6173 6574 2077 6974 686f 7574   dataset without
+00031b20: 2074 6865 2067 6976 656e 2064 696d 656e   the given dimen
+00031b30: 7369 6f6e 7320 286f 7220 616e 7920 7661  sions (or any va
+00031b40: 7269 6162 6c65 730a 2020 2020 2020 2020  riables.        
+00031b50: 2020 2020 636f 6e74 6169 6e69 6e67 2074      containing t
+00031b60: 686f 7365 2064 696d 656e 7369 6f6e 7329  hose dimensions)
+00031b70: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00031b80: 2020 2020 2020 6966 2065 7272 6f72 7320        if errors 
+00031b90: 6e6f 7420 696e 205b 2272 6169 7365 222c  not in ["raise",
+00031ba0: 2022 6967 6e6f 7265 225d 3a0a 2020 2020   "ignore"]:.    
+00031bb0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00031bc0: 6c75 6545 7272 6f72 2827 6572 726f 7273  lueError('errors
+00031bd0: 206d 7573 7420 6265 2065 6974 6865 7220   must be either 
+00031be0: 2272 6169 7365 2220 6f72 2022 6967 6e6f  "raise" or "igno
+00031bf0: 7265 2227 290a 0a20 2020 2020 2020 2069  re"')..        i
+00031c00: 6620 6973 696e 7374 616e 6365 2864 726f  f isinstance(dro
+00031c10: 705f 6469 6d73 2c20 7374 7229 206f 7220  p_dims, str) or 
+00031c20: 6e6f 7420 6973 696e 7374 616e 6365 2864  not isinstance(d
+00031c30: 726f 705f 6469 6d73 2c20 4974 6572 6162  rop_dims, Iterab
+00031c40: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+00031c50: 2064 726f 705f 6469 6d73 203d 207b 6472   drop_dims = {dr
+00031c60: 6f70 5f64 696d 737d 0a20 2020 2020 2020  op_dims}.       
+00031c70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00031c80: 2020 2064 726f 705f 6469 6d73 203d 2073     drop_dims = s
+00031c90: 6574 2864 726f 705f 6469 6d73 290a 0a20  et(drop_dims).. 
+00031ca0: 2020 2020 2020 2069 6620 6572 726f 7273         if errors
+00031cb0: 203d 3d20 2272 6169 7365 223a 0a20 2020   == "raise":.   
+00031cc0: 2020 2020 2020 2020 206d 6973 7369 6e67           missing
+00031cd0: 5f64 696d 7320 3d20 6472 6f70 5f64 696d  _dims = drop_dim
+00031ce0: 7320 2d20 7365 7428 7365 6c66 2e64 696d  s - set(self.dim
+00031cf0: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
+00031d00: 6620 6d69 7373 696e 675f 6469 6d73 3a0a  f missing_dims:.
+00031d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031d20: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00031d30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00031d40: 2020 2020 2020 6622 4461 7461 7365 7420        f"Dataset 
+00031d50: 646f 6573 206e 6f74 2063 6f6e 7461 696e  does not contain
+00031d60: 2074 6865 2064 696d 656e 7369 6f6e 733a   the dimensions:
+00031d70: 207b 6d69 7373 696e 675f 6469 6d73 7d22   {missing_dims}"
+00031d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031d90: 2029 0a0a 2020 2020 2020 2020 6472 6f70   )..        drop
+00031da0: 5f76 6172 7320 3d20 7b6b 2066 6f72 206b  _vars = {k for k
+00031db0: 2c20 7620 696e 2073 656c 662e 5f76 6172  , v in self._var
+00031dc0: 6961 626c 6573 2e69 7465 6d73 2829 2069  iables.items() i
+00031dd0: 6620 7365 7428 762e 6469 6d73 2920 2620  f set(v.dims) & 
+00031de0: 6472 6f70 5f64 696d 737d 0a20 2020 2020  drop_dims}.     
+00031df0: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
+00031e00: 726f 705f 7661 7273 2864 726f 705f 7661  rop_vars(drop_va
+00031e10: 7273 290a 0a20 2020 2064 6566 2074 7261  rs)..    def tra
+00031e20: 6e73 706f 7365 280a 2020 2020 2020 2020  nspose(.        
+00031e30: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
+00031e40: 0a20 2020 2020 2020 202a 6469 6d73 3a20  .        *dims: 
+00031e50: 4861 7368 6162 6c65 2c0a 2020 2020 2020  Hashable,.      
+00031e60: 2020 6d69 7373 696e 675f 6469 6d73 3a20    missing_dims: 
+00031e70: 4572 726f 724f 7074 696f 6e73 5769 7468  ErrorOptionsWith
+00031e80: 5761 726e 203d 2022 7261 6973 6522 2c0a  Warn = "raise",.
+00031e90: 2020 2020 2920 2d3e 2054 5f44 6174 6173      ) -> T_Datas
+00031ea0: 6574 3a0a 2020 2020 2020 2020 2222 2252  et:.        """R
+00031eb0: 6574 7572 6e20 6120 6e65 7720 4461 7461  eturn a new Data
+00031ec0: 7365 7420 6f62 6a65 6374 2077 6974 6820  set object with 
+00031ed0: 616c 6c20 6172 7261 7920 6469 6d65 6e73  all array dimens
+00031ee0: 696f 6e73 2074 7261 6e73 706f 7365 642e  ions transposed.
+00031ef0: 0a0a 2020 2020 2020 2020 416c 7468 6f75  ..        Althou
+00031f00: 6768 2074 6865 206f 7264 6572 206f 6620  gh the order of 
+00031f10: 6469 6d65 6e73 696f 6e73 206f 6e20 6561  dimensions on ea
+00031f20: 6368 2061 7272 6179 2077 696c 6c20 6368  ch array will ch
+00031f30: 616e 6765 2c20 7468 6520 6461 7461 7365  ange, the datase
+00031f40: 740a 2020 2020 2020 2020 6469 6d65 6e73  t.        dimens
+00031f50: 696f 6e73 2074 6865 6d73 656c 7665 7320  ions themselves 
+00031f60: 7769 6c6c 2072 656d 6169 6e20 696e 2066  will remain in f
+00031f70: 6978 6564 2028 736f 7274 6564 2920 6f72  ixed (sorted) or
+00031f80: 6465 722e 0a0a 2020 2020 2020 2020 5061  der...        Pa
+00031f90: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00031fa0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00031fb0: 2020 2020 2a64 696d 7320 3a20 6861 7368      *dims : hash
+00031fc0: 6162 6c65 2c20 6f70 7469 6f6e 616c 0a20  able, optional. 
+00031fd0: 2020 2020 2020 2020 2020 2042 7920 6465             By de
+00031fe0: 6661 756c 742c 2072 6576 6572 7365 2074  fault, reverse t
+00031ff0: 6865 2064 696d 656e 7369 6f6e 7320 6f6e  he dimensions on
+00032000: 2065 6163 6820 6172 7261 792e 204f 7468   each array. Oth
+00032010: 6572 7769 7365 2c0a 2020 2020 2020 2020  erwise,.        
+00032020: 2020 2020 7265 6f72 6465 7220 7468 6520      reorder the 
+00032030: 6469 6d65 6e73 696f 6e73 2074 6f20 7468  dimensions to th
+00032040: 6973 206f 7264 6572 2e0a 2020 2020 2020  is order..      
+00032050: 2020 6d69 7373 696e 675f 6469 6d73 203a    missing_dims :
+00032060: 207b 2272 6169 7365 222c 2022 7761 726e   {"raise", "warn
+00032070: 222c 2022 6967 6e6f 7265 227d 2c20 6465  ", "ignore"}, de
+00032080: 6661 756c 743a 2022 7261 6973 6522 0a20  fault: "raise". 
+00032090: 2020 2020 2020 2020 2020 2057 6861 7420             What 
+000320a0: 746f 2064 6f20 6966 2064 696d 656e 7369  to do if dimensi
+000320b0: 6f6e 7320 7468 6174 2073 686f 756c 6420  ons that should 
+000320c0: 6265 2073 656c 6563 7465 6420 6672 6f6d  be selected from
+000320d0: 2061 7265 206e 6f74 2070 7265 7365 6e74   are not present
+000320e0: 2069 6e20 7468 650a 2020 2020 2020 2020   in the.        
+000320f0: 2020 2020 4461 7461 7365 743a 0a20 2020      Dataset:.   
+00032100: 2020 2020 2020 2020 202d 2022 7261 6973           - "rais
+00032110: 6522 3a20 7261 6973 6520 616e 2065 7863  e": raise an exc
+00032120: 6570 7469 6f6e 0a20 2020 2020 2020 2020  eption.         
+00032130: 2020 202d 2022 7761 726e 223a 2072 6169     - "warn": rai
+00032140: 7365 2061 2077 6172 6e69 6e67 2c20 616e  se a warning, an
+00032150: 6420 6967 6e6f 7265 2074 6865 206d 6973  d ignore the mis
+00032160: 7369 6e67 2064 696d 656e 7369 6f6e 730a  sing dimensions.
+00032170: 2020 2020 2020 2020 2020 2020 2d20 2269              - "i
+00032180: 676e 6f72 6522 3a20 6967 6e6f 7265 2074  gnore": ignore t
+00032190: 6865 206d 6973 7369 6e67 2064 696d 656e  he missing dimen
+000321a0: 7369 6f6e 730a 0a20 2020 2020 2020 2052  sions..        R
+000321b0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+000321c0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2074  ------.        t
+000321d0: 7261 6e73 706f 7365 6420 3a20 4461 7461  ransposed : Data
+000321e0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
+000321f0: 4561 6368 2061 7272 6179 2069 6e20 7468  Each array in th
+00032200: 6520 6461 7461 7365 7420 2869 6e63 6c75  e dataset (inclu
+00032210: 6469 6e67 2920 636f 6f72 6469 6e61 7465  ding) coordinate
+00032220: 7320 7769 6c6c 2062 650a 2020 2020 2020  s will be.      
+00032230: 2020 2020 2020 7472 616e 7370 6f73 6564        transposed
+00032240: 2074 6f20 7468 6520 6769 7665 6e20 6f72   to the given or
+00032250: 6465 722e 0a0a 2020 2020 2020 2020 4e6f  der...        No
+00032260: 7465 730a 2020 2020 2020 2020 2d2d 2d2d  tes.        ----
+00032270: 2d0a 2020 2020 2020 2020 5468 6973 206f  -.        This o
+00032280: 7065 7261 7469 6f6e 2072 6574 7572 6e73  peration returns
+00032290: 2061 2076 6965 7720 6f66 2065 6163 6820   a view of each 
+000322a0: 6172 7261 7927 7320 6461 7461 2e20 4974  array's data. It
+000322b0: 2069 730a 2020 2020 2020 2020 6c61 7a79   is.        lazy
+000322c0: 2066 6f72 2064 6173 6b2d 6261 636b 6564   for dask-backed
+000322d0: 2044 6174 6141 7272 6179 7320 6275 7420   DataArrays but 
+000322e0: 6e6f 7420 666f 7220 6e75 6d70 792d 6261  not for numpy-ba
+000322f0: 636b 6564 2044 6174 6141 7272 6179 730a  cked DataArrays.
+00032300: 2020 2020 2020 2020 2d2d 2074 6865 2064          -- the d
+00032310: 6174 6120 7769 6c6c 2062 6520 6675 6c6c  ata will be full
+00032320: 7920 6c6f 6164 6564 2069 6e74 6f20 6d65  y loaded into me
+00032330: 6d6f 7279 2e0a 0a20 2020 2020 2020 2053  mory...        S
+00032340: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+00032350: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00032360: 206e 756d 7079 2e74 7261 6e73 706f 7365   numpy.transpose
+00032370: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
+00032380: 6179 2e74 7261 6e73 706f 7365 0a20 2020  ay.transpose.   
+00032390: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000323a0: 2023 2052 6169 7365 2065 7272 6f72 2069   # Raise error i
+000323b0: 6620 6c69 7374 2069 7320 7061 7373 6564  f list is passed
+000323c0: 2061 7320 6469 6d73 0a20 2020 2020 2020   as dims.       
+000323d0: 2069 6620 286c 656e 2864 696d 7329 203e   if (len(dims) >
+000323e0: 2030 2920 616e 6420 2869 7369 6e73 7461   0) and (isinsta
+000323f0: 6e63 6528 6469 6d73 5b30 5d2c 206c 6973  nce(dims[0], lis
+00032400: 7429 293a 0a20 2020 2020 2020 2020 2020  t)):.           
+00032410: 206c 6973 745f 6669 7820 3d20 5b66 227b   list_fix = [f"{
+00032420: 7265 7072 2878 297d 2220 6966 2069 7369  repr(x)}" if isi
+00032430: 6e73 7461 6e63 6528 782c 2073 7472 2920  nstance(x, str) 
+00032440: 656c 7365 2066 227b 787d 2220 666f 7220  else f"{x}" for 
+00032450: 7820 696e 2064 696d 735b 305d 5d0a 2020  x in dims[0]].  
+00032460: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00032470: 5479 7065 4572 726f 7228 0a20 2020 2020  TypeError(.     
+00032480: 2020 2020 2020 2020 2020 2066 2774 7261             f'tra
+00032490: 6e73 706f 7365 2072 6571 7569 7265 7320  nspose requires 
+000324a0: 6469 6d73 2074 6f20 6265 2070 6173 7365  dims to be passe
+000324b0: 6420 6173 206d 756c 7469 706c 6520 6172  d as multiple ar
+000324c0: 6775 6d65 6e74 732e 2045 7870 6563 7465  guments. Expecte
+000324d0: 6420 607b 222c 2022 2e6a 6f69 6e28 6c69  d `{", ".join(li
+000324e0: 7374 5f66 6978 297d 602e 2052 6563 6569  st_fix)}`. Recei
+000324f0: 7665 6420 607b 6469 6d73 5b30 5d7d 6020  ved `{dims[0]}` 
+00032500: 696e 7374 6561 6427 0a20 2020 2020 2020  instead'.       
+00032510: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00032520: 2320 5573 6520 696e 6669 785f 6469 6d73  # Use infix_dims
+00032530: 2074 6f20 6368 6563 6b20 6f6e 6365 2066   to check once f
+00032540: 6f72 206d 6973 7369 6e67 2064 696d 656e  or missing dimen
+00032550: 7369 6f6e 730a 2020 2020 2020 2020 6966  sions.        if
+00032560: 206c 656e 2864 696d 7329 2021 3d20 303a   len(dims) != 0:
+00032570: 0a20 2020 2020 2020 2020 2020 205f 203d  .            _ =
+00032580: 206c 6973 7428 696e 6669 785f 6469 6d73   list(infix_dims
+00032590: 2864 696d 732c 2073 656c 662e 6469 6d73  (dims, self.dims
+000325a0: 2c20 6d69 7373 696e 675f 6469 6d73 2929  , missing_dims))
+000325b0: 0a0a 2020 2020 2020 2020 6473 203d 2073  ..        ds = s
+000325c0: 656c 662e 636f 7079 2829 0a20 2020 2020  elf.copy().     
+000325d0: 2020 2066 6f72 206e 616d 652c 2076 6172     for name, var
+000325e0: 2069 6e20 7365 6c66 2e5f 7661 7269 6162   in self._variab
+000325f0: 6c65 732e 6974 656d 7328 293a 0a20 2020  les.items():.   
+00032600: 2020 2020 2020 2020 2076 6172 5f64 696d           var_dim
+00032610: 7320 3d20 7475 706c 6528 6469 6d20 666f  s = tuple(dim fo
+00032620: 7220 6469 6d20 696e 2064 696d 7320 6966  r dim in dims if
+00032630: 2064 696d 2069 6e20 2876 6172 2e64 696d   dim in (var.dim
+00032640: 7320 2b20 282e 2e2e 2c29 2929 0a20 2020  s + (...,))).   
+00032650: 2020 2020 2020 2020 2064 732e 5f76 6172           ds._var
+00032660: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
+00032670: 6172 2e74 7261 6e73 706f 7365 282a 7661  ar.transpose(*va
+00032680: 725f 6469 6d73 290a 2020 2020 2020 2020  r_dims).        
+00032690: 7265 7475 726e 2064 730a 0a20 2020 2064  return ds..    d
+000326a0: 6566 2064 726f 706e 6128 0a20 2020 2020  ef dropna(.     
+000326b0: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+000326c0: 6574 2c0a 2020 2020 2020 2020 6469 6d3a  et,.        dim:
+000326d0: 2048 6173 6861 626c 652c 0a20 2020 2020   Hashable,.     
+000326e0: 2020 2068 6f77 3a20 4c69 7465 7261 6c5b     how: Literal[
+000326f0: 2261 6e79 222c 2022 616c 6c22 5d20 3d20  "any", "all"] = 
+00032700: 2261 6e79 222c 0a20 2020 2020 2020 2074  "any",.        t
+00032710: 6872 6573 683a 2069 6e74 207c 204e 6f6e  hresh: int | Non
+00032720: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00032730: 2020 7375 6273 6574 3a20 4974 6572 6162    subset: Iterab
+00032740: 6c65 5b48 6173 6861 626c 655d 207c 204e  le[Hashable] | N
+00032750: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+00032760: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+00032770: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00032780: 6e73 2061 206e 6577 2064 6174 6173 6574  ns a new dataset
+00032790: 2077 6974 6820 6472 6f70 7065 6420 6c61   with dropped la
+000327a0: 6265 6c73 2066 6f72 206d 6973 7369 6e67  bels for missing
+000327b0: 2076 616c 7565 7320 616c 6f6e 670a 2020   values along.  
+000327c0: 2020 2020 2020 7468 6520 7072 6f76 6964        the provid
+000327d0: 6564 2064 696d 656e 7369 6f6e 2e0a 0a20  ed dimension... 
+000327e0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+000327f0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00032800: 2d2d 2d2d 0a20 2020 2020 2020 2064 696d  ----.        dim
+00032810: 203a 2068 6173 6861 626c 650a 2020 2020   : hashable.    
+00032820: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+00032830: 6e20 616c 6f6e 6720 7768 6963 6820 746f  n along which to
+00032840: 2064 726f 7020 6d69 7373 696e 6720 7661   drop missing va
+00032850: 6c75 6573 2e20 4472 6f70 7069 6e67 2061  lues. Dropping a
+00032860: 6c6f 6e67 0a20 2020 2020 2020 2020 2020  long.           
+00032870: 206d 756c 7469 706c 6520 6469 6d65 6e73   multiple dimens
+00032880: 696f 6e73 2073 696d 756c 7461 6e65 6f75  ions simultaneou
+00032890: 736c 7920 6973 206e 6f74 2079 6574 2073  sly is not yet s
+000328a0: 7570 706f 7274 6564 2e0a 2020 2020 2020  upported..      
+000328b0: 2020 686f 7720 3a20 7b22 616e 7922 2c20    how : {"any", 
+000328c0: 2261 6c6c 227d 2c20 6465 6661 756c 743a  "all"}, default:
+000328d0: 2022 616e 7922 0a20 2020 2020 2020 2020   "any".         
+000328e0: 2020 202d 2061 6e79 203a 2069 6620 616e     - any : if an
+000328f0: 7920 4e41 2076 616c 7565 7320 6172 6520  y NA values are 
+00032900: 7072 6573 656e 742c 2064 726f 7020 7468  present, drop th
+00032910: 6174 206c 6162 656c 0a20 2020 2020 2020  at label.       
+00032920: 2020 2020 202d 2061 6c6c 203a 2069 6620       - all : if 
+00032930: 616c 6c20 7661 6c75 6573 2061 7265 204e  all values are N
+00032940: 412c 2064 726f 7020 7468 6174 206c 6162  A, drop that lab
+00032950: 656c 0a0a 2020 2020 2020 2020 7468 7265  el..        thre
+00032960: 7368 203a 2069 6e74 206f 7220 4e6f 6e65  sh : int or None
+00032970: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+00032980: 2020 2020 2020 2049 6620 7375 7070 6c69         If suppli
+00032990: 6564 2c20 7265 7175 6972 6520 7468 6973  ed, require this
+000329a0: 206d 616e 7920 6e6f 6e2d 4e41 2076 616c   many non-NA val
+000329b0: 7565 7320 2873 756d 6d65 6420 6f76 6572  ues (summed over
+000329c0: 2061 6c6c 2074 6865 2073 7562 7365 7420   all the subset 
+000329d0: 7661 7269 6162 6c65 7329 2e0a 2020 2020  variables)..    
+000329e0: 2020 2020 7375 6273 6574 203a 2069 7465      subset : ite
+000329f0: 7261 626c 6520 6f66 2068 6173 6861 626c  rable of hashabl
+00032a00: 6520 6f72 204e 6f6e 652c 206f 7074 696f  e or None, optio
+00032a10: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+00032a20: 5768 6963 6820 7661 7269 6162 6c65 7320  Which variables 
+00032a30: 746f 2063 6865 636b 2066 6f72 206d 6973  to check for mis
+00032a40: 7369 6e67 2076 616c 7565 732e 2042 7920  sing values. By 
+00032a50: 6465 6661 756c 742c 2061 6c6c 0a20 2020  default, all.   
+00032a60: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+00032a70: 6573 2069 6e20 7468 6520 6461 7461 7365  es in the datase
+00032a80: 7420 6172 6520 6368 6563 6b65 642e 0a0a  t are checked...
+00032a90: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+00032aa0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+00032ab0: 2020 2020 2020 2020 4461 7461 7365 740a          Dataset.
+00032ac0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00032ad0: 2020 2020 2320 544f 444f 3a20 636f 6e73      # TODO: cons
+00032ae0: 6964 6572 2073 7570 706f 7274 696e 6720  ider supporting 
+00032af0: 6d75 6c74 6970 6c65 2064 696d 656e 7369  multiple dimensi
+00032b00: 6f6e 733f 204f 7220 6e6f 742c 2067 6976  ons? Or not, giv
+00032b10: 656e 2074 6861 740a 2020 2020 2020 2020  en that.        
+00032b20: 2320 7468 6572 6520 6172 6520 736f 6d65  # there are some
+00032b30: 2075 676c 7920 6564 6765 2063 6173 6573   ugly edge cases
+00032b40: 2c20 652e 672e 2c20 7061 6e64 6173 2773  , e.g., pandas's
+00032b50: 2064 726f 706e 6120 6469 6666 6572 730a   dropna differs.
+00032b60: 2020 2020 2020 2020 2320 6465 7065 6e64          # depend
+00032b70: 696e 6720 6f6e 2074 6865 206f 7264 6572  ing on the order
+00032b80: 206f 6620 7468 6520 7375 7070 6c69 6564   of the supplied
+00032b90: 2061 7865 732e 0a0a 2020 2020 2020 2020   axes...        
+00032ba0: 6966 2064 696d 206e 6f74 2069 6e20 7365  if dim not in se
+00032bb0: 6c66 2e64 696d 733a 0a20 2020 2020 2020  lf.dims:.       
+00032bc0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00032bd0: 4572 726f 7228 6622 7b64 696d 7d20 6d75  Error(f"{dim} mu
+00032be0: 7374 2062 6520 6120 7369 6e67 6c65 2064  st be a single d
+00032bf0: 6174 6173 6574 2064 696d 656e 7369 6f6e  ataset dimension
+00032c00: 2229 0a0a 2020 2020 2020 2020 6966 2073  ")..        if s
+00032c10: 7562 7365 7420 6973 204e 6f6e 653a 0a20  ubset is None:. 
+00032c20: 2020 2020 2020 2020 2020 2073 7562 7365             subse
+00032c30: 7420 3d20 6974 6572 2873 656c 662e 6461  t = iter(self.da
+00032c40: 7461 5f76 6172 7329 0a0a 2020 2020 2020  ta_vars)..      
+00032c50: 2020 636f 756e 7420 3d20 6e70 2e7a 6572    count = np.zer
+00032c60: 6f73 2873 656c 662e 6469 6d73 5b64 696d  os(self.dims[dim
+00032c70: 5d2c 2064 7479 7065 3d6e 702e 696e 7436  ], dtype=np.int6
+00032c80: 3429 0a20 2020 2020 2020 2073 697a 6520  4).        size 
+00032c90: 3d20 6e70 2e69 6e74 5f28 3029 2020 2320  = np.int_(0)  # 
+00032ca0: 666f 7220 7479 7065 2063 6865 636b 696e  for type checkin
+00032cb0: 670a 0a20 2020 2020 2020 2066 6f72 206b  g..        for k
+00032cc0: 2069 6e20 7375 6273 6574 3a0a 2020 2020   in subset:.    
+00032cd0: 2020 2020 2020 2020 6172 7261 7920 3d20          array = 
+00032ce0: 7365 6c66 2e5f 7661 7269 6162 6c65 735b  self._variables[
+00032cf0: 6b5d 0a20 2020 2020 2020 2020 2020 2069  k].            i
+00032d00: 6620 6469 6d20 696e 2061 7272 6179 2e64  f dim in array.d
+00032d10: 696d 733a 0a20 2020 2020 2020 2020 2020  ims:.           
+00032d20: 2020 2020 2064 696d 7320 3d20 5b64 2066       dims = [d f
+00032d30: 6f72 2064 2069 6e20 6172 7261 792e 6469  or d in array.di
+00032d40: 6d73 2069 6620 6420 213d 2064 696d 5d0a  ms if d != dim].
+00032d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032d60: 636f 756e 7420 2b3d 206e 702e 6173 6172  count += np.asar
+00032d70: 7261 7928 6172 7261 792e 636f 756e 7428  ray(array.count(
+00032d80: 6469 6d73 2929 2020 2320 7479 7065 3a20  dims))  # type: 
+00032d90: 6967 6e6f 7265 5b61 7474 722d 6465 6669  ignore[attr-defi
+00032da0: 6e65 645d 0a20 2020 2020 2020 2020 2020  ned].           
+00032db0: 2020 2020 2073 697a 6520 2b3d 206d 6174       size += mat
+00032dc0: 682e 7072 6f64 285b 7365 6c66 2e64 696d  h.prod([self.dim
+00032dd0: 735b 645d 2066 6f72 2064 2069 6e20 6469  s[d] for d in di
+00032de0: 6d73 5d29 0a0a 2020 2020 2020 2020 6966  ms])..        if
+00032df0: 2074 6872 6573 6820 6973 206e 6f74 204e   thresh is not N
+00032e00: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00032e10: 206d 6173 6b20 3d20 636f 756e 7420 3e3d   mask = count >=
+00032e20: 2074 6872 6573 680a 2020 2020 2020 2020   thresh.        
+00032e30: 656c 6966 2068 6f77 203d 3d20 2261 6e79  elif how == "any
+00032e40: 223a 0a20 2020 2020 2020 2020 2020 206d  ":.            m
+00032e50: 6173 6b20 3d20 636f 756e 7420 3d3d 2073  ask = count == s
+00032e60: 697a 650a 2020 2020 2020 2020 656c 6966  ize.        elif
+00032e70: 2068 6f77 203d 3d20 2261 6c6c 223a 0a20   how == "all":. 
+00032e80: 2020 2020 2020 2020 2020 206d 6173 6b20             mask 
+00032e90: 3d20 636f 756e 7420 3e20 300a 2020 2020  = count > 0.    
+00032ea0: 2020 2020 656c 6966 2068 6f77 2069 7320      elif how is 
+00032eb0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00032ec0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00032ed0: 6545 7272 6f72 2866 2269 6e76 616c 6964  eError(f"invalid
+00032ee0: 2068 6f77 206f 7074 696f 6e3a 207b 686f   how option: {ho
+00032ef0: 777d 2229 0a20 2020 2020 2020 2065 6c73  w}").        els
+00032f00: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00032f10: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
+00032f20: 6d75 7374 2073 7065 6369 6679 2068 6f77  must specify how
+00032f30: 206f 7220 7468 7265 7368 2229 0a0a 2020   or thresh")..  
+00032f40: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00032f50: 662e 6973 656c 287b 6469 6d3a 206d 6173  f.isel({dim: mas
+00032f60: 6b7d 290a 0a20 2020 2064 6566 2066 696c  k})..    def fil
+00032f70: 6c6e 6128 7365 6c66 3a20 545f 4461 7461  lna(self: T_Data
+00032f80: 7365 742c 2076 616c 7565 3a20 416e 7929  set, value: Any)
+00032f90: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
+00032fa0: 2020 2020 2020 2022 2222 4669 6c6c 206d         """Fill m
+00032fb0: 6973 7369 6e67 2076 616c 7565 7320 696e  issing values in
+00032fc0: 2074 6869 7320 6f62 6a65 6374 2e0a 0a20   this object... 
+00032fd0: 2020 2020 2020 2054 6869 7320 6f70 6572         This oper
+00032fe0: 6174 696f 6e20 666f 6c6c 6f77 7320 7468  ation follows th
+00032ff0: 6520 6e6f 726d 616c 2062 726f 6164 6361  e normal broadca
+00033000: 7374 696e 6720 616e 6420 616c 6967 6e6d  sting and alignm
+00033010: 656e 7420 7275 6c65 7320 7468 6174 0a20  ent rules that. 
+00033020: 2020 2020 2020 2078 6172 7261 7920 7573         xarray us
+00033030: 6573 2066 6f72 2062 696e 6172 7920 6172  es for binary ar
+00033040: 6974 686d 6574 6963 2c20 6578 6365 7074  ithmetic, except
+00033050: 2074 6865 2072 6573 756c 7420 6973 2061   the result is a
+00033060: 6c69 676e 6564 2074 6f20 7468 6973 0a20  ligned to this. 
+00033070: 2020 2020 2020 206f 626a 6563 7420 2860         object (`
+00033080: 606a 6f69 6e3d 276c 6566 7427 6060 2920  `join='left'``) 
+00033090: 696e 7374 6561 6420 6f66 2061 6c69 676e  instead of align
+000330a0: 6564 2074 6f20 7468 6520 696e 7465 7273  ed to the inters
+000330b0: 6563 7469 6f6e 206f 660a 2020 2020 2020  ection of.      
+000330c0: 2020 696e 6465 7820 636f 6f72 6469 6e61    index coordina
+000330d0: 7465 7320 2860 606a 6f69 6e3d 2769 6e6e  tes (``join='inn
+000330e0: 6572 2760 6029 2e0a 0a20 2020 2020 2020  er'``)...       
+000330f0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00033100: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00033110: 2020 2020 2020 2076 616c 7565 203a 2073         value : s
+00033120: 6361 6c61 722c 206e 6461 7272 6179 2c20  calar, ndarray, 
+00033130: 4461 7461 4172 7261 792c 2064 6963 7420  DataArray, dict 
+00033140: 6f72 2044 6174 6173 6574 0a20 2020 2020  or Dataset.     
+00033150: 2020 2020 2020 2055 7365 6420 746f 2066         Used to f
+00033160: 696c 6c20 616c 6c20 6d61 7463 6869 6e67  ill all matching
+00033170: 206d 6973 7369 6e67 2076 616c 7565 7320   missing values 
+00033180: 696e 2074 6869 7320 6461 7461 7365 7427  in this dataset'
+00033190: 7320 6461 7461 0a20 2020 2020 2020 2020  s data.         
+000331a0: 2020 2076 6172 6961 626c 6573 2e20 5363     variables. Sc
+000331b0: 616c 6172 732c 206e 6461 7272 6179 7320  alars, ndarrays 
+000331c0: 6f72 2044 6174 6141 7272 6179 7320 6172  or DataArrays ar
+000331d0: 6775 6d65 6e74 7320 6172 6520 7573 6564  guments are used
+000331e0: 2074 6f0a 2020 2020 2020 2020 2020 2020   to.            
+000331f0: 6669 6c6c 2061 6c6c 2064 6174 6120 7769  fill all data wi
+00033200: 7468 2061 6c69 676e 6564 2063 6f6f 7264  th aligned coord
+00033210: 696e 6174 6573 2028 666f 7220 4461 7461  inates (for Data
+00033220: 4172 7261 7973 292e 0a20 2020 2020 2020  Arrays)..       
+00033230: 2020 2020 2044 6963 7469 6f6e 6172 6965       Dictionarie
+00033240: 7320 6f72 2064 6174 6173 6574 7320 6d61  s or datasets ma
+00033250: 7463 6820 6461 7461 2076 6172 6961 626c  tch data variabl
+00033260: 6573 2061 6e64 2074 6865 6e20 616c 6967  es and then alig
+00033270: 6e0a 2020 2020 2020 2020 2020 2020 636f  n.            co
+00033280: 6f72 6469 6e61 7465 7320 6966 206e 6563  ordinates if nec
+00033290: 6573 7361 7279 2e0a 0a20 2020 2020 2020  essary...       
+000332a0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+000332b0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+000332c0: 2044 6174 6173 6574 0a0a 2020 2020 2020   Dataset..      
+000332d0: 2020 4578 616d 706c 6573 0a20 2020 2020    Examples.     
+000332e0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+000332f0: 2020 2020 3e3e 3e20 6473 203d 2078 722e      >>> ds = xr.
+00033300: 4461 7461 7365 7428 0a20 2020 2020 2020  Dataset(.       
+00033310: 202e 2e2e 2020 2020 207b 0a20 2020 2020   ...     {.     
+00033320: 2020 202e 2e2e 2020 2020 2020 2020 2022     ...         "
+00033330: 4122 3a20 2822 7822 2c20 5b6e 702e 6e61  A": ("x", [np.na
+00033340: 6e2c 2032 2c20 6e70 2e6e 616e 2c20 305d  n, 2, np.nan, 0]
+00033350: 292c 0a20 2020 2020 2020 202e 2e2e 2020  ),.        ...  
+00033360: 2020 2020 2020 2022 4222 3a20 2822 7822         "B": ("x"
+00033370: 2c20 5b33 2c20 342c 206e 702e 6e61 6e2c  , [3, 4, np.nan,
+00033380: 2031 5d29 2c0a 2020 2020 2020 2020 2e2e   1]),.        ..
+00033390: 2e20 2020 2020 2020 2020 2243 223a 2028  .         "C": (
+000333a0: 2278 222c 205b 6e70 2e6e 616e 2c20 6e70  "x", [np.nan, np
+000333b0: 2e6e 616e 2c20 6e70 2e6e 616e 2c20 355d  .nan, np.nan, 5]
+000333c0: 292c 0a20 2020 2020 2020 202e 2e2e 2020  ),.        ...  
+000333d0: 2020 2020 2020 2022 4422 3a20 2822 7822         "D": ("x"
+000333e0: 2c20 5b6e 702e 6e61 6e2c 2033 2c20 6e70  , [np.nan, 3, np
+000333f0: 2e6e 616e 2c20 345d 292c 0a20 2020 2020  .nan, 4]),.     
+00033400: 2020 202e 2e2e 2020 2020 207d 2c0a 2020     ...     },.  
+00033410: 2020 2020 2020 2e2e 2e20 2020 2020 636f        ...     co
+00033420: 6f72 6473 3d7b 2278 223a 205b 302c 2031  ords={"x": [0, 1
+00033430: 2c20 322c 2033 5d7d 2c0a 2020 2020 2020  , 2, 3]},.      
+00033440: 2020 2e2e 2e20 290a 2020 2020 2020 2020    ... ).        
+00033450: 3e3e 3e20 6473 0a20 2020 2020 2020 203c  >>> ds.        <
+00033460: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
+00033470: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+00033480: 6e73 3a20 2028 783a 2034 290a 2020 2020  ns:  (x: 4).    
+00033490: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
+000334a0: 0a20 2020 2020 2020 2020 202a 2078 2020  .          * x  
+000334b0: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
+000334c0: 3020 3120 3220 330a 2020 2020 2020 2020  0 1 2 3.        
+000334d0: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
+000334e0: 2020 2020 2020 2020 2020 2020 4120 2020              A   
+000334f0: 2020 2020 2028 7829 2066 6c6f 6174 3634       (x) float64
+00033500: 206e 616e 2032 2e30 206e 616e 2030 2e30   nan 2.0 nan 0.0
+00033510: 0a20 2020 2020 2020 2020 2020 2042 2020  .            B  
+00033520: 2020 2020 2020 2878 2920 666c 6f61 7436        (x) float6
+00033530: 3420 332e 3020 342e 3020 6e61 6e20 312e  4 3.0 4.0 nan 1.
+00033540: 300a 2020 2020 2020 2020 2020 2020 4320  0.            C 
+00033550: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
+00033560: 3634 206e 616e 206e 616e 206e 616e 2035  64 nan nan nan 5
+00033570: 2e30 0a20 2020 2020 2020 2020 2020 2044  .0.            D
+00033580: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
+00033590: 7436 3420 6e61 6e20 332e 3020 6e61 6e20  t64 nan 3.0 nan 
+000335a0: 342e 300a 0a20 2020 2020 2020 2052 6570  4.0..        Rep
+000335b0: 6c61 6365 2061 6c6c 2060 4e61 4e60 2076  lace all `NaN` v
+000335c0: 616c 7565 7320 7769 7468 2030 732e 0a0a  alues with 0s...
+000335d0: 2020 2020 2020 2020 3e3e 3e20 6473 2e66          >>> ds.f
+000335e0: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
+000335f0: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
+00033600: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
+00033610: 696f 6e73 3a20 2028 783a 2034 290a 2020  ions:  (x: 4).  
+00033620: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
+00033630: 733a 0a20 2020 2020 2020 2020 202a 2078  s:.          * x
+00033640: 2020 2020 2020 2020 2878 2920 696e 7436          (x) int6
+00033650: 3420 3020 3120 3220 330a 2020 2020 2020  4 0 1 2 3.      
+00033660: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
+00033670: 3a0a 2020 2020 2020 2020 2020 2020 4120  :.            A 
+00033680: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
+00033690: 3634 2030 2e30 2032 2e30 2030 2e30 2030  64 0.0 2.0 0.0 0
+000336a0: 2e30 0a20 2020 2020 2020 2020 2020 2042  .0.            B
+000336b0: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
+000336c0: 7436 3420 332e 3020 342e 3020 302e 3020  t64 3.0 4.0 0.0 
+000336d0: 312e 300a 2020 2020 2020 2020 2020 2020  1.0.            
+000336e0: 4320 2020 2020 2020 2028 7829 2066 6c6f  C        (x) flo
+000336f0: 6174 3634 2030 2e30 2030 2e30 2030 2e30  at64 0.0 0.0 0.0
+00033700: 2035 2e30 0a20 2020 2020 2020 2020 2020   5.0.           
+00033710: 2044 2020 2020 2020 2020 2878 2920 666c   D        (x) fl
+00033720: 6f61 7436 3420 302e 3020 332e 3020 302e  oat64 0.0 3.0 0.
+00033730: 3020 342e 300a 0a20 2020 2020 2020 2052  0 4.0..        R
+00033740: 6570 6c61 6365 2061 6c6c 2060 4e61 4e60  eplace all `NaN`
+00033750: 2065 6c65 6d65 6e74 7320 696e 2063 6f6c   elements in col
+00033760: 756d 6e20 e280 9841 e280 992c 20e2 8098  umn ...A..., ...
+00033770: 42e2 8099 2c20 e280 9843 e280 992c 2061  B..., ...C..., a
+00033780: 6e64 20e2 8098 44e2 8099 2c20 7769 7468  nd ...D..., with
+00033790: 2030 2c20 312c 2032 2c20 616e 6420 3320   0, 1, 2, and 3 
+000337a0: 7265 7370 6563 7469 7665 6c79 2e0a 0a20  respectively... 
+000337b0: 2020 2020 2020 203e 3e3e 2076 616c 7565         >>> value
+000337c0: 7320 3d20 7b22 4122 3a20 302c 2022 4222  s = {"A": 0, "B"
+000337d0: 3a20 312c 2022 4322 3a20 322c 2022 4422  : 1, "C": 2, "D"
+000337e0: 3a20 337d 0a20 2020 2020 2020 203e 3e3e  : 3}.        >>>
+000337f0: 2064 732e 6669 6c6c 6e61 2876 616c 7565   ds.fillna(value
+00033800: 3d76 616c 7565 7329 0a20 2020 2020 2020  =values).       
+00033810: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
+00033820: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
+00033830: 696f 6e73 3a20 2028 783a 2034 290a 2020  ions:  (x: 4).  
+00033840: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
+00033850: 733a 0a20 2020 2020 2020 2020 202a 2078  s:.          * x
+00033860: 2020 2020 2020 2020 2878 2920 696e 7436          (x) int6
+00033870: 3420 3020 3120 3220 330a 2020 2020 2020  4 0 1 2 3.      
+00033880: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
+00033890: 3a0a 2020 2020 2020 2020 2020 2020 4120  :.            A 
+000338a0: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
+000338b0: 3634 2030 2e30 2032 2e30 2030 2e30 2030  64 0.0 2.0 0.0 0
+000338c0: 2e30 0a20 2020 2020 2020 2020 2020 2042  .0.            B
+000338d0: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
+000338e0: 7436 3420 332e 3020 342e 3020 312e 3020  t64 3.0 4.0 1.0 
+000338f0: 312e 300a 2020 2020 2020 2020 2020 2020  1.0.            
+00033900: 4320 2020 2020 2020 2028 7829 2066 6c6f  C        (x) flo
+00033910: 6174 3634 2032 2e30 2032 2e30 2032 2e30  at64 2.0 2.0 2.0
+00033920: 2035 2e30 0a20 2020 2020 2020 2020 2020   5.0.           
+00033930: 2044 2020 2020 2020 2020 2878 2920 666c   D        (x) fl
+00033940: 6f61 7436 3420 332e 3020 332e 3020 332e  oat64 3.0 3.0 3.
+00033950: 3020 342e 300a 2020 2020 2020 2020 2222  0 4.0.        ""
+00033960: 220a 2020 2020 2020 2020 6966 2075 7469  ".        if uti
+00033970: 6c73 2e69 735f 6469 6374 5f6c 696b 6528  ls.is_dict_like(
+00033980: 7661 6c75 6529 3a0a 2020 2020 2020 2020  value):.        
+00033990: 2020 2020 7661 6c75 655f 6b65 7973 203d      value_keys =
+000339a0: 2067 6574 6174 7472 2876 616c 7565 2c20   getattr(value, 
+000339b0: 2264 6174 615f 7661 7273 222c 2076 616c  "data_vars", val
+000339c0: 7565 292e 6b65 7973 2829 0a20 2020 2020  ue).keys().     
+000339d0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+000339e0: 7428 7661 6c75 655f 6b65 7973 2920 3c3d  t(value_keys) <=
+000339f0: 2073 6574 2873 656c 662e 6461 7461 5f76   set(self.data_v
+00033a00: 6172 732e 6b65 7973 2829 293a 0a20 2020  ars.keys()):.   
+00033a10: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00033a20: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00033a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033a40: 2020 2022 616c 6c20 7661 7269 6162 6c65     "all variable
+00033a50: 7320 696e 2074 6865 2061 7267 756d 656e  s in the argumen
+00033a60: 7420 746f 2060 6669 6c6c 6e61 6020 220a  t to `fillna` ".
+00033a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033a80: 2020 2020 226d 7573 7420 6265 2063 6f6e      "must be con
+00033a90: 7461 696e 6564 2069 6e20 7468 6520 6f72  tained in the or
+00033aa0: 6967 696e 616c 2064 6174 6173 6574 220a  iginal dataset".
+00033ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033ac0: 290a 2020 2020 2020 2020 6f75 7420 3d20  ).        out = 
+00033ad0: 6f70 732e 6669 6c6c 6e61 2873 656c 662c  ops.fillna(self,
+00033ae0: 2076 616c 7565 290a 2020 2020 2020 2020   value).        
+00033af0: 7265 7475 726e 206f 7574 0a0a 2020 2020  return out..    
+00033b00: 6465 6620 696e 7465 7270 6f6c 6174 655f  def interpolate_
+00033b10: 6e61 280a 2020 2020 2020 2020 7365 6c66  na(.        self
+00033b20: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
+00033b30: 2020 2020 2064 696d 3a20 4861 7368 6162       dim: Hashab
+00033b40: 6c65 207c 204e 6f6e 6520 3d20 4e6f 6e65  le | None = None
+00033b50: 2c0a 2020 2020 2020 2020 6d65 7468 6f64  ,.        method
+00033b60: 3a20 496e 7465 7270 4f70 7469 6f6e 7320  : InterpOptions 
+00033b70: 3d20 226c 696e 6561 7222 2c0a 2020 2020  = "linear",.    
+00033b80: 2020 2020 6c69 6d69 743a 2069 6e74 207c      limit: int |
+00033b90: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+00033ba0: 2020 2020 2020 7573 655f 636f 6f72 6469        use_coordi
+00033bb0: 6e61 7465 3a20 626f 6f6c 207c 2048 6173  nate: bool | Has
+00033bc0: 6861 626c 6520 3d20 5472 7565 2c0a 2020  hable = True,.  
+00033bd0: 2020 2020 2020 6d61 785f 6761 703a 2028        max_gap: (
+00033be0: 0a20 2020 2020 2020 2020 2020 2069 6e74  .            int
+00033bf0: 207c 2066 6c6f 6174 207c 2073 7472 207c   | float | str |
+00033c00: 2070 642e 5469 6d65 6465 6c74 6120 7c20   pd.Timedelta | 
+00033c10: 6e70 2e74 696d 6564 656c 7461 3634 207c  np.timedelta64 |
+00033c20: 2064 6174 6574 696d 652e 7469 6d65 6465   datetime.timede
+00033c30: 6c74 610a 2020 2020 2020 2020 2920 3d20  lta.        ) = 
+00033c40: 4e6f 6e65 2c0a 2020 2020 2020 2020 2a2a  None,.        **
+00033c50: 6b77 6172 6773 3a20 416e 792c 0a20 2020  kwargs: Any,.   
+00033c60: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
+00033c70: 0a20 2020 2020 2020 2022 2222 4669 6c6c  .        """Fill
+00033c80: 2069 6e20 4e61 4e73 2062 7920 696e 7465   in NaNs by inte
+00033c90: 7270 6f6c 6174 696e 6720 6163 636f 7264  rpolating accord
+00033ca0: 696e 6720 746f 2064 6966 6665 7265 6e74  ing to different
+00033cb0: 206d 6574 686f 6473 2e0a 0a20 2020 2020   methods...     
+00033cc0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00033cd0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00033ce0: 0a20 2020 2020 2020 2064 696d 203a 2048  .        dim : H
+00033cf0: 6173 6861 626c 6520 6f72 204e 6f6e 652c  ashable or None,
+00033d00: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00033d10: 2020 2020 2020 5370 6563 6966 6965 7320        Specifies 
+00033d20: 7468 6520 6469 6d65 6e73 696f 6e20 616c  the dimension al
+00033d30: 6f6e 6720 7768 6963 6820 746f 2069 6e74  ong which to int
+00033d40: 6572 706f 6c61 7465 2e0a 2020 2020 2020  erpolate..      
+00033d50: 2020 6d65 7468 6f64 203a 207b 226c 696e    method : {"lin
+00033d60: 6561 7222 2c20 226e 6561 7265 7374 222c  ear", "nearest",
+00033d70: 2022 7a65 726f 222c 2022 736c 696e 6561   "zero", "slinea
+00033d80: 7222 2c20 2271 7561 6472 6174 6963 222c  r", "quadratic",
+00033d90: 2022 6375 6269 6322 2c20 2270 6f6c 796e   "cubic", "polyn
+00033da0: 6f6d 6961 6c22 2c20 5c0a 2020 2020 2020  omial", \.      
+00033db0: 2020 2020 2020 2262 6172 7963 656e 7472        "barycentr
+00033dc0: 6963 222c 2022 6b72 6f67 222c 2022 7063  ic", "krog", "pc
+00033dd0: 6869 7022 2c20 2273 706c 696e 6522 2c20  hip", "spline", 
+00033de0: 2261 6b69 6d61 227d 2c20 6465 6661 756c  "akima"}, defaul
+00033df0: 743a 2022 6c69 6e65 6172 220a 2020 2020  t: "linear".    
+00033e00: 2020 2020 2020 2020 5374 7269 6e67 2069          String i
+00033e10: 6e64 6963 6174 696e 6720 7768 6963 6820  ndicating which 
+00033e20: 6d65 7468 6f64 2074 6f20 7573 6520 666f  method to use fo
+00033e30: 7220 696e 7465 7270 6f6c 6174 696f 6e3a  r interpolation:
+00033e40: 0a0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
+00033e50: 276c 696e 6561 7227 3a20 6c69 6e65 6172  'linear': linear
+00033e60: 2069 6e74 6572 706f 6c61 7469 6f6e 2e20   interpolation. 
+00033e70: 4164 6469 7469 6f6e 616c 206b 6579 776f  Additional keywo
+00033e80: 7264 0a20 2020 2020 2020 2020 2020 2020  rd.             
+00033e90: 2061 7267 756d 656e 7473 2061 7265 2070   arguments are p
+00033ea0: 6173 7365 6420 746f 203a 7079 3a66 756e  assed to :py:fun
+00033eb0: 633a 606e 756d 7079 2e69 6e74 6572 7060  c:`numpy.interp`
+00033ec0: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
+00033ed0: 6e65 6172 6573 7427 2c20 277a 6572 6f27  nearest', 'zero'
+00033ee0: 2c20 2773 6c69 6e65 6172 272c 2027 7175  , 'slinear', 'qu
+00033ef0: 6164 7261 7469 6327 2c20 2763 7562 6963  adratic', 'cubic
+00033f00: 272c 2027 706f 6c79 6e6f 6d69 616c 273a  ', 'polynomial':
+00033f10: 0a20 2020 2020 2020 2020 2020 2020 2061  .              a
+00033f20: 7265 2070 6173 7365 6420 746f 203a 7079  re passed to :py
+00033f30: 3a66 756e 633a 6073 6369 7079 2e69 6e74  :func:`scipy.int
+00033f40: 6572 706f 6c61 7465 2e69 6e74 6572 7031  erpolate.interp1
+00033f50: 6460 2e20 4966 0a20 2020 2020 2020 2020  d`. If.         
+00033f60: 2020 2020 2060 606d 6574 686f 643d 2770       ``method='p
+00033f70: 6f6c 796e 6f6d 6961 6c27 6060 2c20 7468  olynomial'``, th
+00033f80: 6520 6060 6f72 6465 7260 6020 6b65 7977  e ``order`` keyw
+00033f90: 6f72 6420 6172 6775 6d65 6e74 206d 7573  ord argument mus
+00033fa0: 7420 616c 736f 2062 650a 2020 2020 2020  t also be.      
+00033fb0: 2020 2020 2020 2020 7072 6f76 6964 6564          provided
+00033fc0: 2e0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
+00033fd0: 2762 6172 7963 656e 7472 6963 272c 2027  'barycentric', '
+00033fe0: 6b72 6f67 272c 2027 7063 6869 7027 2c20  krog', 'pchip', 
+00033ff0: 2773 706c 696e 6527 2c20 2761 6b69 6d61  'spline', 'akima
+00034000: 273a 2075 7365 2074 6865 6972 0a20 2020  ': use their.   
+00034010: 2020 2020 2020 2020 2020 2072 6573 7065             respe
+00034020: 6374 6976 6520 3a70 793a 636c 6173 733a  ctive :py:class:
+00034030: 6073 6369 7079 2e69 6e74 6572 706f 6c61  `scipy.interpola
+00034040: 7465 6020 636c 6173 7365 732e 0a0a 2020  te` classes...  
+00034050: 2020 2020 2020 7573 655f 636f 6f72 6469        use_coordi
+00034060: 6e61 7465 203a 2062 6f6f 6c20 6f72 2048  nate : bool or H
+00034070: 6173 6861 626c 652c 2064 6566 6175 6c74  ashable, default
+00034080: 3a20 5472 7565 0a20 2020 2020 2020 2020  : True.         
+00034090: 2020 2053 7065 6369 6669 6573 2077 6869     Specifies whi
+000340a0: 6368 2069 6e64 6578 2074 6f20 7573 6520  ch index to use 
+000340b0: 6173 2074 6865 2078 2076 616c 7565 7320  as the x values 
+000340c0: 696e 2074 6865 2069 6e74 6572 706f 6c61  in the interpola
+000340d0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+000340e0: 2066 6f72 6d75 6c61 7465 6420 6173 2060   formulated as `
+000340f0: 7920 3d20 6628 7829 602e 2049 6620 4661  y = f(x)`. If Fa
+00034100: 6c73 652c 2076 616c 7565 7320 6172 6520  lse, values are 
+00034110: 7472 6561 7465 6420 6173 2069 660a 2020  treated as if.  
+00034120: 2020 2020 2020 2020 2020 6571 7561 6c6c            equall
+00034130: 792d 7370 6163 6564 2061 6c6f 6e67 2060  y-spaced along `
+00034140: 6064 696d 6060 2e20 4966 2054 7275 652c  `dim``. If True,
+00034150: 2074 6865 2049 6e64 6578 5661 7269 6162   the IndexVariab
+00034160: 6c65 2060 6469 6d60 2069 730a 2020 2020  le `dim` is.    
+00034170: 2020 2020 2020 2020 7573 6564 2e20 4966          used. If
+00034180: 2060 6075 7365 5f63 6f6f 7264 696e 6174   ``use_coordinat
+00034190: 6560 6020 6973 2061 2073 7472 696e 672c  e`` is a string,
+000341a0: 2069 7420 7370 6563 6966 6965 7320 7468   it specifies th
+000341b0: 6520 6e61 6d65 206f 6620 610a 2020 2020  e name of a.    
+000341c0: 2020 2020 2020 2020 636f 6f72 6469 6e61          coordina
+000341d0: 7465 2076 6172 6961 626c 6520 746f 2075  te variable to u
+000341e0: 7365 2061 7320 7468 6520 696e 6465 782e  se as the index.
+000341f0: 0a20 2020 2020 2020 206c 696d 6974 203a  .        limit :
+00034200: 2069 6e74 2c20 6465 6661 756c 743a 204e   int, default: N
+00034210: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00034220: 4d61 7869 6d75 6d20 6e75 6d62 6572 206f  Maximum number o
+00034230: 6620 636f 6e73 6563 7574 6976 6520 4e61  f consecutive Na
+00034240: 4e73 2074 6f20 6669 6c6c 2e20 4d75 7374  Ns to fill. Must
+00034250: 2062 6520 6772 6561 7465 7220 7468 616e   be greater than
+00034260: 2030 0a20 2020 2020 2020 2020 2020 206f   0.            o
+00034270: 7220 4e6f 6e65 2066 6f72 206e 6f20 6c69  r None for no li
+00034280: 6d69 742e 2054 6869 7320 6669 6c6c 696e  mit. This fillin
+00034290: 6720 6973 2064 6f6e 6520 7265 6761 7264  g is done regard
+000342a0: 6c65 7373 206f 6620 7468 6520 7369 7a65  less of the size
+000342b0: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
+000342c0: 7468 6520 6761 7020 696e 2074 6865 2064  the gap in the d
+000342d0: 6174 612e 2054 6f20 6f6e 6c79 2069 6e74  ata. To only int
+000342e0: 6572 706f 6c61 7465 206f 7665 7220 6761  erpolate over ga
+000342f0: 7073 206c 6573 7320 7468 616e 2061 2067  ps less than a g
+00034300: 6976 656e 206c 656e 6774 682c 0a20 2020  iven length,.   
+00034310: 2020 2020 2020 2020 2073 6565 2060 606d           see ``m
+00034320: 6178 5f67 6170 6060 2e0a 2020 2020 2020  ax_gap``..      
+00034330: 2020 6d61 785f 6761 7020 3a20 696e 742c    max_gap : int,
+00034340: 2066 6c6f 6174 2c20 7374 722c 2070 616e   float, str, pan
+00034350: 6461 732e 5469 6d65 6465 6c74 612c 206e  das.Timedelta, n
+00034360: 756d 7079 2e74 696d 6564 656c 7461 3634  umpy.timedelta64
+00034370: 2c20 6461 7465 7469 6d65 2e74 696d 6564  , datetime.timed
+00034380: 656c 7461 2c20 6465 6661 756c 743a 204e  elta, default: N
+00034390: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+000343a0: 4d61 7869 6d75 6d20 7369 7a65 206f 6620  Maximum size of 
+000343b0: 6761 702c 2061 2063 6f6e 7469 6e75 6f75  gap, a continuou
+000343c0: 7320 7365 7175 656e 6365 206f 6620 4e61  s sequence of Na
+000343d0: 4e73 2c20 7468 6174 2077 696c 6c20 6265  Ns, that will be
+000343e0: 2066 696c 6c65 642e 0a20 2020 2020 2020   filled..       
+000343f0: 2020 2020 2055 7365 204e 6f6e 6520 666f       Use None fo
+00034400: 7220 6e6f 206c 696d 6974 2e20 5768 656e  r no limit. When
+00034410: 2069 6e74 6572 706f 6c61 7469 6e67 2061   interpolating a
+00034420: 6c6f 6e67 2061 2064 6174 6574 696d 6536  long a datetime6
+00034430: 3420 6469 6d65 6e73 696f 6e0a 2020 2020  4 dimension.    
+00034440: 2020 2020 2020 2020 616e 6420 6060 7573          and ``us
+00034450: 655f 636f 6f72 6469 6e61 7465 3d54 7275  e_coordinate=Tru
+00034460: 6560 602c 2060 606d 6178 5f67 6170 6060  e``, ``max_gap``
+00034470: 2063 616e 2062 6520 6f6e 6520 6f66 2074   can be one of t
+00034480: 6865 2066 6f6c 6c6f 7769 6e67 3a0a 0a20  he following:.. 
+00034490: 2020 2020 2020 2020 2020 202d 2061 2073             - a s
+000344a0: 7472 696e 6720 7468 6174 2069 7320 7661  tring that is va
+000344b0: 6c69 6420 696e 7075 7420 666f 7220 7061  lid input for pa
+000344c0: 6e64 6173 2e74 6f5f 7469 6d65 6465 6c74  ndas.to_timedelt
+000344d0: 610a 2020 2020 2020 2020 2020 2020 2d20  a.            - 
+000344e0: 6120 3a70 793a 636c 6173 733a 606e 756d  a :py:class:`num
+000344f0: 7079 2e74 696d 6564 656c 7461 3634 6020  py.timedelta64` 
+00034500: 6f62 6a65 6374 0a20 2020 2020 2020 2020  object.         
+00034510: 2020 202d 2061 203a 7079 3a63 6c61 7373     - a :py:class
+00034520: 3a60 7061 6e64 6173 2e54 696d 6564 656c  :`pandas.Timedel
+00034530: 7461 6020 6f62 6a65 6374 0a20 2020 2020  ta` object.     
+00034540: 2020 2020 2020 202d 2061 203a 7079 3a63         - a :py:c
+00034550: 6c61 7373 3a60 6461 7465 7469 6d65 2e74  lass:`datetime.t
+00034560: 696d 6564 656c 7461 6020 6f62 6a65 6374  imedelta` object
+00034570: 0a0a 2020 2020 2020 2020 2020 2020 4f74  ..            Ot
+00034580: 6865 7277 6973 652c 2060 606d 6178 5f67  herwise, ``max_g
+00034590: 6170 6060 206d 7573 7420 6265 2061 6e20  ap`` must be an 
+000345a0: 696e 7420 6f72 2061 2066 6c6f 6174 2e20  int or a float. 
+000345b0: 5573 6520 6f66 2060 606d 6178 5f67 6170  Use of ``max_gap
+000345c0: 6060 2077 6974 6820 756e 6c61 6265 6c65  `` with unlabele
+000345d0: 640a 2020 2020 2020 2020 2020 2020 6469  d.            di
+000345e0: 6d65 6e73 696f 6e73 2068 6173 206e 6f74  mensions has not
+000345f0: 2062 6565 6e20 696d 706c 656d 656e 7465   been implemente
+00034600: 6420 7965 742e 2047 6170 206c 656e 6774  d yet. Gap lengt
+00034610: 6820 6973 2064 6566 696e 6564 2061 7320  h is defined as 
+00034620: 7468 6520 6469 6666 6572 656e 6365 0a20  the difference. 
+00034630: 2020 2020 2020 2020 2020 2062 6574 7765             betwe
+00034640: 656e 2063 6f6f 7264 696e 6174 6520 7661  en coordinate va
+00034650: 6c75 6573 2061 7420 7468 6520 6669 7273  lues at the firs
+00034660: 7420 6461 7461 2070 6f69 6e74 2061 6674  t data point aft
+00034670: 6572 2061 2067 6170 2061 6e64 2074 6865  er a gap and the
+00034680: 206c 6173 7420 7661 6c75 650a 2020 2020   last value.    
+00034690: 2020 2020 2020 2020 6265 666f 7265 2061          before a
+000346a0: 2067 6170 2e20 466f 7220 6761 7073 2061   gap. For gaps a
+000346b0: 7420 7468 6520 6265 6769 6e6e 696e 6720  t the beginning 
+000346c0: 2865 6e64 292c 2067 6170 206c 656e 6774  (end), gap lengt
+000346d0: 6820 6973 2064 6566 696e 6564 2061 7320  h is defined as 
+000346e0: 7468 6520 6469 6666 6572 656e 6365 0a20  the difference. 
+000346f0: 2020 2020 2020 2020 2020 2062 6574 7765             betwe
+00034700: 656e 2063 6f6f 7264 696e 6174 6520 7661  en coordinate va
+00034710: 6c75 6573 2061 7420 7468 6520 6669 7273  lues at the firs
+00034720: 7420 286c 6173 7429 2076 616c 6964 2064  t (last) valid d
+00034730: 6174 6120 706f 696e 7420 616e 6420 7468  ata point and th
+00034740: 6520 6669 7273 7420 286c 6173 7429 204e  e first (last) N
+00034750: 614e 2e0a 2020 2020 2020 2020 2020 2020  aN..            
+00034760: 466f 7220 6578 616d 706c 652c 2063 6f6e  For example, con
+00034770: 7369 6465 723a 3a0a 0a20 2020 2020 2020  sider::..       
+00034780: 2020 2020 2020 2020 203c 7861 7272 6179           <xarray
+00034790: 2e44 6174 6141 7272 6179 2028 783a 2039  .DataArray (x: 9
+000347a0: 293e 0a20 2020 2020 2020 2020 2020 2020  )>.             
+000347b0: 2020 2061 7272 6179 285b 6e61 6e2c 206e     array([nan, n
+000347c0: 616e 2c20 6e61 6e2c 2020 312e 2c20 6e61  an, nan,  1., na
+000347d0: 6e2c 206e 616e 2c20 2034 2e2c 206e 616e  n, nan,  4., nan
+000347e0: 2c20 6e61 6e5d 290a 2020 2020 2020 2020  , nan]).        
+000347f0: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
+00034800: 7465 733a 0a20 2020 2020 2020 2020 2020  tes:.           
+00034810: 2020 2020 2020 202a 2078 2020 2020 2020         * x      
+00034820: 2020 2878 2920 696e 7436 3420 3020 3120    (x) int64 0 1 
+00034830: 3220 3320 3420 3520 3620 3720 380a 0a20  2 3 4 5 6 7 8.. 
+00034840: 2020 2020 2020 2020 2020 2054 6865 2067             The g
+00034850: 6170 206c 656e 6774 6873 2061 7265 2033  ap lengths are 3
+00034860: 2d30 203d 2033 3b20 362d 3320 3d20 333b  -0 = 3; 6-3 = 3;
+00034870: 2061 6e64 2038 2d36 203d 2032 2072 6573   and 8-6 = 2 res
+00034880: 7065 6374 6976 656c 790a 2020 2020 2020  pectively.      
+00034890: 2020 2a2a 6b77 6172 6773 203a 2064 6963    **kwargs : dic
+000348a0: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
+000348b0: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
+000348c0: 7273 2070 6173 7365 6420 7665 7262 6174  rs passed verbat
+000348d0: 696d 2074 6f20 7468 6520 756e 6465 726c  im to the underl
+000348e0: 7969 6e67 2069 6e74 6572 706f 6c61 7469  ying interpolati
+000348f0: 6f6e 2066 756e 6374 696f 6e0a 0a20 2020  on function..   
+00034900: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+00034910: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+00034920: 2020 2020 2069 6e74 6572 706f 6c61 7465       interpolate
+00034930: 643a 2044 6174 6173 6574 0a20 2020 2020  d: Dataset.     
+00034940: 2020 2020 2020 2046 696c 6c65 6420 696e         Filled in
+00034950: 2044 6174 6173 6574 2e0a 0a20 2020 2020   Dataset...     
+00034960: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+00034970: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00034980: 2020 2020 206e 756d 7079 2e69 6e74 6572       numpy.inter
+00034990: 700a 2020 2020 2020 2020 7363 6970 792e  p.        scipy.
+000349a0: 696e 7465 7270 6f6c 6174 650a 0a20 2020  interpolate..   
+000349b0: 2020 2020 2045 7861 6d70 6c65 730a 2020       Examples.  
+000349c0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+000349d0: 2020 2020 2020 203e 3e3e 2064 7320 3d20         >>> ds = 
+000349e0: 7872 2e44 6174 6173 6574 280a 2020 2020  xr.Dataset(.    
+000349f0: 2020 2020 2e2e 2e20 2020 2020 7b0a 2020      ...     {.  
+00034a00: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
+00034a10: 2020 2241 223a 2028 2278 222c 205b 6e70    "A": ("x", [np
+00034a20: 2e6e 616e 2c20 322c 2033 2c20 6e70 2e6e  .nan, 2, 3, np.n
+00034a30: 616e 2c20 305d 292c 0a20 2020 2020 2020  an, 0]),.       
+00034a40: 202e 2e2e 2020 2020 2020 2020 2022 4222   ...         "B"
+00034a50: 3a20 2822 7822 2c20 5b33 2c20 342c 206e  : ("x", [3, 4, n
+00034a60: 702e 6e61 6e2c 2031 2c20 375d 292c 0a20  p.nan, 1, 7]),. 
+00034a70: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
+00034a80: 2020 2022 4322 3a20 2822 7822 2c20 5b6e     "C": ("x", [n
+00034a90: 702e 6e61 6e2c 206e 702e 6e61 6e2c 206e  p.nan, np.nan, n
+00034aa0: 702e 6e61 6e2c 2035 2c20 305d 292c 0a20  p.nan, 5, 0]),. 
+00034ab0: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
+00034ac0: 2020 2022 4422 3a20 2822 7822 2c20 5b6e     "D": ("x", [n
+00034ad0: 702e 6e61 6e2c 2033 2c20 6e70 2e6e 616e  p.nan, 3, np.nan
+00034ae0: 2c20 2d31 2c20 345d 292c 0a20 2020 2020  , -1, 4]),.     
+00034af0: 2020 202e 2e2e 2020 2020 207d 2c0a 2020     ...     },.  
+00034b00: 2020 2020 2020 2e2e 2e20 2020 2020 636f        ...     co
+00034b10: 6f72 6473 3d7b 2278 223a 205b 302c 2031  ords={"x": [0, 1
+00034b20: 2c20 322c 2033 2c20 345d 7d2c 0a20 2020  , 2, 3, 4]},.   
+00034b30: 2020 2020 202e 2e2e 2029 0a20 2020 2020       ... ).     
+00034b40: 2020 203e 3e3e 2064 730a 2020 2020 2020     >>> ds.      
+00034b50: 2020 3c78 6172 7261 792e 4461 7461 7365    <xarray.Datase
+00034b60: 743e 0a20 2020 2020 2020 2044 696d 656e  t>.        Dimen
+00034b70: 7369 6f6e 733a 2020 2878 3a20 3529 0a20  sions:  (x: 5). 
+00034b80: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
+00034b90: 6573 3a0a 2020 2020 2020 2020 2020 2a20  es:.          * 
+00034ba0: 7820 2020 2020 2020 2028 7829 2069 6e74  x        (x) int
+00034bb0: 3634 2030 2031 2032 2033 2034 0a20 2020  64 0 1 2 3 4.   
+00034bc0: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
+00034bd0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+00034be0: 2041 2020 2020 2020 2020 2878 2920 666c   A        (x) fl
+00034bf0: 6f61 7436 3420 6e61 6e20 322e 3020 332e  oat64 nan 2.0 3.
+00034c00: 3020 6e61 6e20 302e 300a 2020 2020 2020  0 nan 0.0.      
+00034c10: 2020 2020 2020 4220 2020 2020 2020 2028        B        (
+00034c20: 7829 2066 6c6f 6174 3634 2033 2e30 2034  x) float64 3.0 4
+00034c30: 2e30 206e 616e 2031 2e30 2037 2e30 0a20  .0 nan 1.0 7.0. 
+00034c40: 2020 2020 2020 2020 2020 2043 2020 2020             C    
+00034c50: 2020 2020 2878 2920 666c 6f61 7436 3420      (x) float64 
+00034c60: 6e61 6e20 6e61 6e20 6e61 6e20 352e 3020  nan nan nan 5.0 
+00034c70: 302e 300a 2020 2020 2020 2020 2020 2020  0.0.            
+00034c80: 4420 2020 2020 2020 2028 7829 2066 6c6f  D        (x) flo
+00034c90: 6174 3634 206e 616e 2033 2e30 206e 616e  at64 nan 3.0 nan
+00034ca0: 202d 312e 3020 342e 300a 0a20 2020 2020   -1.0 4.0..     
+00034cb0: 2020 203e 3e3e 2064 732e 696e 7465 7270     >>> ds.interp
+00034cc0: 6f6c 6174 655f 6e61 2864 696d 3d22 7822  olate_na(dim="x"
+00034cd0: 2c20 6d65 7468 6f64 3d22 6c69 6e65 6172  , method="linear
+00034ce0: 2229 0a20 2020 2020 2020 203c 7861 7272  ").        <xarr
+00034cf0: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
+00034d00: 2020 2020 4469 6d65 6e73 696f 6e73 3a20      Dimensions: 
+00034d10: 2028 783a 2035 290a 2020 2020 2020 2020   (x: 5).        
+00034d20: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
+00034d30: 2020 2020 2020 202a 2078 2020 2020 2020         * x      
+00034d40: 2020 2878 2920 696e 7436 3420 3020 3120    (x) int64 0 1 
+00034d50: 3220 3320 340a 2020 2020 2020 2020 4461  2 3 4.        Da
+00034d60: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
+00034d70: 2020 2020 2020 2020 2020 4120 2020 2020            A     
+00034d80: 2020 2028 7829 2066 6c6f 6174 3634 206e     (x) float64 n
+00034d90: 616e 2032 2e30 2033 2e30 2031 2e35 2030  an 2.0 3.0 1.5 0
+00034da0: 2e30 0a20 2020 2020 2020 2020 2020 2042  .0.            B
+00034db0: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
+00034dc0: 7436 3420 332e 3020 342e 3020 322e 3520  t64 3.0 4.0 2.5 
+00034dd0: 312e 3020 372e 300a 2020 2020 2020 2020  1.0 7.0.        
+00034de0: 2020 2020 4320 2020 2020 2020 2028 7829      C        (x)
+00034df0: 2066 6c6f 6174 3634 206e 616e 206e 616e   float64 nan nan
+00034e00: 206e 616e 2035 2e30 2030 2e30 0a20 2020   nan 5.0 0.0.   
+00034e10: 2020 2020 2020 2020 2044 2020 2020 2020           D      
+00034e20: 2020 2878 2920 666c 6f61 7436 3420 6e61    (x) float64 na
+00034e30: 6e20 332e 3020 312e 3020 2d31 2e30 2034  n 3.0 1.0 -1.0 4
+00034e40: 2e30 0a0a 2020 2020 2020 2020 3e3e 3e20  .0..        >>> 
+00034e50: 6473 2e69 6e74 6572 706f 6c61 7465 5f6e  ds.interpolate_n
+00034e60: 6128 6469 6d3d 2278 222c 206d 6574 686f  a(dim="x", metho
+00034e70: 643d 226c 696e 6561 7222 2c20 6669 6c6c  d="linear", fill
+00034e80: 5f76 616c 7565 3d22 6578 7472 6170 6f6c  _value="extrapol
+00034e90: 6174 6522 290a 2020 2020 2020 2020 3c78  ate").        <x
+00034ea0: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
+00034eb0: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+00034ec0: 733a 2020 2878 3a20 3529 0a20 2020 2020  s:  (x: 5).     
+00034ed0: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+00034ee0: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
+00034ef0: 2020 2020 2028 7829 2069 6e74 3634 2030       (x) int64 0
+00034f00: 2031 2032 2033 2034 0a20 2020 2020 2020   1 2 3 4.       
+00034f10: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
+00034f20: 0a20 2020 2020 2020 2020 2020 2041 2020  .            A  
+00034f30: 2020 2020 2020 2878 2920 666c 6f61 7436        (x) float6
+00034f40: 3420 312e 3020 322e 3020 332e 3020 312e  4 1.0 2.0 3.0 1.
+00034f50: 3520 302e 300a 2020 2020 2020 2020 2020  5 0.0.          
+00034f60: 2020 4220 2020 2020 2020 2028 7829 2066    B        (x) f
+00034f70: 6c6f 6174 3634 2033 2e30 2034 2e30 2032  loat64 3.0 4.0 2
+00034f80: 2e35 2031 2e30 2037 2e30 0a20 2020 2020  .5 1.0 7.0.     
+00034f90: 2020 2020 2020 2043 2020 2020 2020 2020         C        
+00034fa0: 2878 2920 666c 6f61 7436 3420 3230 2e30  (x) float64 20.0
+00034fb0: 2031 352e 3020 3130 2e30 2035 2e30 2030   15.0 10.0 5.0 0
+00034fc0: 2e30 0a20 2020 2020 2020 2020 2020 2044  .0.            D
+00034fd0: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
+00034fe0: 7436 3420 352e 3020 332e 3020 312e 3020  t64 5.0 3.0 1.0 
+00034ff0: 2d31 2e30 2034 2e30 0a20 2020 2020 2020  -1.0 4.0.       
+00035000: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
+00035010: 6d20 7861 7272 6179 2e63 6f72 652e 6d69  m xarray.core.mi
+00035020: 7373 696e 6720 696d 706f 7274 205f 6170  ssing import _ap
+00035030: 706c 795f 6f76 6572 5f76 6172 735f 7769  ply_over_vars_wi
+00035040: 7468 5f64 696d 2c20 696e 7465 7270 5f6e  th_dim, interp_n
+00035050: 610a 0a20 2020 2020 2020 206e 6577 203d  a..        new =
+00035060: 205f 6170 706c 795f 6f76 6572 5f76 6172   _apply_over_var
+00035070: 735f 7769 7468 5f64 696d 280a 2020 2020  s_with_dim(.    
+00035080: 2020 2020 2020 2020 696e 7465 7270 5f6e          interp_n
+00035090: 612c 0a20 2020 2020 2020 2020 2020 2073  a,.            s
+000350a0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+000350b0: 2064 696d 3d64 696d 2c0a 2020 2020 2020   dim=dim,.      
+000350c0: 2020 2020 2020 6d65 7468 6f64 3d6d 6574        method=met
+000350d0: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
+000350e0: 206c 696d 6974 3d6c 696d 6974 2c0a 2020   limit=limit,.  
+000350f0: 2020 2020 2020 2020 2020 7573 655f 636f            use_co
+00035100: 6f72 6469 6e61 7465 3d75 7365 5f63 6f6f  ordinate=use_coo
+00035110: 7264 696e 6174 652c 0a20 2020 2020 2020  rdinate,.       
+00035120: 2020 2020 206d 6178 5f67 6170 3d6d 6178       max_gap=max
+00035130: 5f67 6170 2c0a 2020 2020 2020 2020 2020  _gap,.          
+00035140: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+00035150: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+00035160: 7475 726e 206e 6577 0a0a 2020 2020 6465  turn new..    de
+00035170: 6620 6666 696c 6c28 7365 6c66 3a20 545f  f ffill(self: T_
+00035180: 4461 7461 7365 742c 2064 696d 3a20 4861  Dataset, dim: Ha
+00035190: 7368 6162 6c65 2c20 6c69 6d69 743a 2069  shable, limit: i
+000351a0: 6e74 207c 204e 6f6e 6520 3d20 4e6f 6e65  nt | None = None
+000351b0: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+000351c0: 2020 2020 2020 2020 2222 2246 696c 6c20          """Fill 
+000351d0: 4e61 4e20 7661 6c75 6573 2062 7920 7072  NaN values by pr
+000351e0: 6f70 6167 6174 696e 6720 7661 6c75 6573  opagating values
+000351f0: 2066 6f72 7761 7264 0a0a 2020 2020 2020   forward..      
+00035200: 2020 2a52 6571 7569 7265 7320 626f 7474    *Requires bott
+00035210: 6c65 6e65 636b 2e2a 0a0a 2020 2020 2020  leneck.*..      
+00035220: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00035230: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00035240: 2020 2020 2020 2020 6469 6d20 3a20 4861          dim : Ha
+00035250: 7368 6162 6c65 0a20 2020 2020 2020 2020  shable.         
+00035260: 2020 2053 7065 6369 6669 6573 2074 6865     Specifies the
+00035270: 2064 696d 656e 7369 6f6e 2061 6c6f 6e67   dimension along
+00035280: 2077 6869 6368 2074 6f20 7072 6f70 6167   which to propag
+00035290: 6174 6520 7661 6c75 6573 2077 6865 6e0a  ate values when.
+000352a0: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
+000352b0: 696e 672e 0a20 2020 2020 2020 206c 696d  ing..        lim
+000352c0: 6974 203a 2069 6e74 206f 7220 4e6f 6e65  it : int or None
+000352d0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+000352e0: 2020 2020 2020 2054 6865 206d 6178 696d         The maxim
+000352f0: 756d 206e 756d 6265 7220 6f66 2063 6f6e  um number of con
+00035300: 7365 6375 7469 7665 204e 614e 2076 616c  secutive NaN val
+00035310: 7565 7320 746f 2066 6f72 7761 7264 2066  ues to forward f
+00035320: 696c 6c2e 2049 6e0a 2020 2020 2020 2020  ill. In.        
+00035330: 2020 2020 6f74 6865 7220 776f 7264 732c      other words,
+00035340: 2069 6620 7468 6572 6520 6973 2061 2067   if there is a g
+00035350: 6170 2077 6974 6820 6d6f 7265 2074 6861  ap with more tha
+00035360: 6e20 7468 6973 206e 756d 6265 7220 6f66  n this number of
+00035370: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00035380: 7365 6375 7469 7665 204e 614e 732c 2069  secutive NaNs, i
+00035390: 7420 7769 6c6c 206f 6e6c 7920 6265 2070  t will only be p
+000353a0: 6172 7469 616c 6c79 2066 696c 6c65 642e  artially filled.
+000353b0: 204d 7573 7420 6265 2067 7265 6174 6572   Must be greater
+000353c0: 0a20 2020 2020 2020 2020 2020 2074 6861  .            tha
+000353d0: 6e20 3020 6f72 204e 6f6e 6520 666f 7220  n 0 or None for 
+000353e0: 6e6f 206c 696d 6974 2e20 4d75 7374 2062  no limit. Must b
+000353f0: 6520 4e6f 6e65 206f 7220 6772 6561 7465  e None or greate
+00035400: 7220 7468 616e 206f 7220 6571 7561 6c0a  r than or equal.
+00035410: 2020 2020 2020 2020 2020 2020 746f 2061              to a
+00035420: 7869 7320 6c65 6e67 7468 2069 6620 6669  xis length if fi
+00035430: 6c6c 696e 6720 616c 6f6e 6720 6368 756e  lling along chun
+00035440: 6b65 6420 6178 6573 2028 6469 6d65 6e73  ked axes (dimens
+00035450: 696f 6e73 292e 0a0a 2020 2020 2020 2020  ions)...        
+00035460: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+00035470: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00035480: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
+00035490: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+000354a0: 2078 6172 7261 792e 636f 7265 2e6d 6973   xarray.core.mis
+000354b0: 7369 6e67 2069 6d70 6f72 7420 5f61 7070  sing import _app
+000354c0: 6c79 5f6f 7665 725f 7661 7273 5f77 6974  ly_over_vars_wit
+000354d0: 685f 6469 6d2c 2066 6669 6c6c 0a0a 2020  h_dim, ffill..  
+000354e0: 2020 2020 2020 6e65 7720 3d20 5f61 7070        new = _app
+000354f0: 6c79 5f6f 7665 725f 7661 7273 5f77 6974  ly_over_vars_wit
+00035500: 685f 6469 6d28 6666 696c 6c2c 2073 656c  h_dim(ffill, sel
+00035510: 662c 2064 696d 3d64 696d 2c20 6c69 6d69  f, dim=dim, limi
+00035520: 743d 6c69 6d69 7429 0a20 2020 2020 2020  t=limit).       
+00035530: 2072 6574 7572 6e20 6e65 770a 0a20 2020   return new..   
+00035540: 2064 6566 2062 6669 6c6c 2873 656c 663a   def bfill(self:
+00035550: 2054 5f44 6174 6173 6574 2c20 6469 6d3a   T_Dataset, dim:
+00035560: 2048 6173 6861 626c 652c 206c 696d 6974   Hashable, limit
+00035570: 3a20 696e 7420 7c20 4e6f 6e65 203d 204e  : int | None = N
+00035580: 6f6e 6529 202d 3e20 545f 4461 7461 7365  one) -> T_Datase
+00035590: 743a 0a20 2020 2020 2020 2022 2222 4669  t:.        """Fi
+000355a0: 6c6c 204e 614e 2076 616c 7565 7320 6279  ll NaN values by
+000355b0: 2070 726f 7061 6761 7469 6e67 2076 616c   propagating val
+000355c0: 7565 7320 6261 636b 7761 7264 0a0a 2020  ues backward..  
+000355d0: 2020 2020 2020 2a52 6571 7569 7265 7320        *Requires 
+000355e0: 626f 7474 6c65 6e65 636b 2e2a 0a0a 2020  bottleneck.*..  
+000355f0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00035600: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00035610: 2d2d 2d0a 2020 2020 2020 2020 6469 6d20  ---.        dim 
+00035620: 3a20 4861 7368 6162 6c65 0a20 2020 2020  : Hashable.     
+00035630: 2020 2020 2020 2053 7065 6369 6669 6573         Specifies
+00035640: 2074 6865 2064 696d 656e 7369 6f6e 2061   the dimension a
+00035650: 6c6f 6e67 2077 6869 6368 2074 6f20 7072  long which to pr
+00035660: 6f70 6167 6174 6520 7661 6c75 6573 2077  opagate values w
+00035670: 6865 6e0a 2020 2020 2020 2020 2020 2020  hen.            
+00035680: 6669 6c6c 696e 672e 0a20 2020 2020 2020  filling..       
+00035690: 206c 696d 6974 203a 2069 6e74 206f 7220   limit : int or 
+000356a0: 4e6f 6e65 2c20 6f70 7469 6f6e 616c 0a20  None, optional. 
+000356b0: 2020 2020 2020 2020 2020 2054 6865 206d             The m
+000356c0: 6178 696d 756d 206e 756d 6265 7220 6f66  aximum number of
+000356d0: 2063 6f6e 7365 6375 7469 7665 204e 614e   consecutive NaN
+000356e0: 2076 616c 7565 7320 746f 2062 6163 6b77   values to backw
+000356f0: 6172 6420 6669 6c6c 2e20 496e 0a20 2020  ard fill. In.   
+00035700: 2020 2020 2020 2020 206f 7468 6572 2077           other w
+00035710: 6f72 6473 2c20 6966 2074 6865 7265 2069  ords, if there i
+00035720: 7320 6120 6761 7020 7769 7468 206d 6f72  s a gap with mor
+00035730: 6520 7468 616e 2074 6869 7320 6e75 6d62  e than this numb
+00035740: 6572 206f 660a 2020 2020 2020 2020 2020  er of.          
+00035750: 2020 636f 6e73 6563 7574 6976 6520 4e61    consecutive Na
+00035760: 4e73 2c20 6974 2077 696c 6c20 6f6e 6c79  Ns, it will only
+00035770: 2062 6520 7061 7274 6961 6c6c 7920 6669   be partially fi
+00035780: 6c6c 6564 2e20 4d75 7374 2062 6520 6772  lled. Must be gr
+00035790: 6561 7465 720a 2020 2020 2020 2020 2020  eater.          
+000357a0: 2020 7468 616e 2030 206f 7220 4e6f 6e65    than 0 or None
+000357b0: 2066 6f72 206e 6f20 6c69 6d69 742e 204d   for no limit. M
+000357c0: 7573 7420 6265 204e 6f6e 6520 6f72 2067  ust be None or g
+000357d0: 7265 6174 6572 2074 6861 6e20 6f72 2065  reater than or e
+000357e0: 7175 616c 0a20 2020 2020 2020 2020 2020  qual.           
+000357f0: 2074 6f20 6178 6973 206c 656e 6774 6820   to axis length 
+00035800: 6966 2066 696c 6c69 6e67 2061 6c6f 6e67  if filling along
+00035810: 2063 6875 6e6b 6564 2061 7865 7320 2864   chunked axes (d
+00035820: 696d 656e 7369 6f6e 7329 2e0a 0a20 2020  imensions)...   
+00035830: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+00035840: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+00035850: 2020 2020 2044 6174 6173 6574 0a20 2020       Dataset.   
+00035860: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00035870: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
+00035880: 652e 6d69 7373 696e 6720 696d 706f 7274  e.missing import
+00035890: 205f 6170 706c 795f 6f76 6572 5f76 6172   _apply_over_var
+000358a0: 735f 7769 7468 5f64 696d 2c20 6266 696c  s_with_dim, bfil
+000358b0: 6c0a 0a20 2020 2020 2020 206e 6577 203d  l..        new =
+000358c0: 205f 6170 706c 795f 6f76 6572 5f76 6172   _apply_over_var
+000358d0: 735f 7769 7468 5f64 696d 2862 6669 6c6c  s_with_dim(bfill
+000358e0: 2c20 7365 6c66 2c20 6469 6d3d 6469 6d2c  , self, dim=dim,
+000358f0: 206c 696d 6974 3d6c 696d 6974 290a 2020   limit=limit).  
+00035900: 2020 2020 2020 7265 7475 726e 206e 6577        return new
+00035910: 0a0a 2020 2020 6465 6620 636f 6d62 696e  ..    def combin
+00035920: 655f 6669 7273 7428 7365 6c66 3a20 545f  e_first(self: T_
+00035930: 4461 7461 7365 742c 206f 7468 6572 3a20  Dataset, other: 
+00035940: 545f 4461 7461 7365 7429 202d 3e20 545f  T_Dataset) -> T_
+00035950: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+00035960: 2022 2222 436f 6d62 696e 6520 7477 6f20   """Combine two 
+00035970: 4461 7461 7365 7473 2c20 6465 6661 756c  Datasets, defaul
+00035980: 7420 746f 2064 6174 615f 7661 7273 206f  t to data_vars o
+00035990: 6620 7365 6c66 2e0a 0a20 2020 2020 2020  f self...       
+000359a0: 2054 6865 206e 6577 2063 6f6f 7264 696e   The new coordin
+000359b0: 6174 6573 2066 6f6c 6c6f 7720 7468 6520  ates follow the 
+000359c0: 6e6f 726d 616c 2062 726f 6164 6361 7374  normal broadcast
+000359d0: 696e 6720 616e 6420 616c 6967 6e6d 656e  ing and alignmen
+000359e0: 7420 7275 6c65 730a 2020 2020 2020 2020  t rules.        
+000359f0: 6f66 2060 606a 6f69 6e3d 276f 7574 6572  of ``join='outer
+00035a00: 2760 602e 2020 5661 6361 6e74 2063 656c  '``.  Vacant cel
+00035a10: 6c73 2069 6e20 7468 6520 6578 7061 6e64  ls in the expand
+00035a20: 6564 2063 6f6f 7264 696e 6174 6573 2061  ed coordinates a
+00035a30: 7265 0a20 2020 2020 2020 2066 696c 6c65  re.        fille
+00035a40: 6420 7769 7468 206e 702e 6e61 6e2e 0a0a  d with np.nan...
+00035a50: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00035a60: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00035a70: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6f74  -----.        ot
+00035a80: 6865 7220 3a20 4461 7461 7365 740a 2020  her : Dataset.  
+00035a90: 2020 2020 2020 2020 2020 5573 6564 2074            Used t
+00035aa0: 6f20 6669 6c6c 2061 6c6c 206d 6174 6368  o fill all match
+00035ab0: 696e 6720 6d69 7373 696e 6720 7661 6c75  ing missing valu
+00035ac0: 6573 2069 6e20 7468 6973 2061 7272 6179  es in this array
+00035ad0: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00035ae0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00035af0: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
+00035b00: 6574 0a20 2020 2020 2020 2022 2222 0a20  et.        """. 
+00035b10: 2020 2020 2020 206f 7574 203d 206f 7073         out = ops
+00035b20: 2e66 696c 6c6e 6128 7365 6c66 2c20 6f74  .fillna(self, ot
+00035b30: 6865 722c 206a 6f69 6e3d 226f 7574 6572  her, join="outer
+00035b40: 222c 2064 6174 6173 6574 5f6a 6f69 6e3d  ", dataset_join=
+00035b50: 226f 7574 6572 2229 0a20 2020 2020 2020  "outer").       
+00035b60: 2072 6574 7572 6e20 6f75 740a 0a20 2020   return out..   
+00035b70: 2064 6566 2072 6564 7563 6528 0a20 2020   def reduce(.   
+00035b80: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
+00035b90: 6173 6574 2c0a 2020 2020 2020 2020 6675  aset,.        fu
+00035ba0: 6e63 3a20 4361 6c6c 6162 6c65 2c0a 2020  nc: Callable,.  
+00035bb0: 2020 2020 2020 6469 6d3a 2044 696d 7320        dim: Dims 
+00035bc0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00035bd0: 2a2c 0a20 2020 2020 2020 206b 6565 705f  *,.        keep_
+00035be0: 6174 7472 733a 2062 6f6f 6c20 7c20 4e6f  attrs: bool | No
+00035bf0: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+00035c00: 2020 206b 6565 7064 696d 733a 2062 6f6f     keepdims: boo
+00035c10: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+00035c20: 2020 206e 756d 6572 6963 5f6f 6e6c 793a     numeric_only:
+00035c30: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+00035c40: 2020 2020 2020 202a 2a6b 7761 7267 733a         **kwargs:
+00035c50: 2041 6e79 2c0a 2020 2020 2920 2d3e 2054   Any,.    ) -> T
+00035c60: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
+00035c70: 2020 2222 2252 6564 7563 6520 7468 6973    """Reduce this
+00035c80: 2064 6174 6173 6574 2062 7920 6170 706c   dataset by appl
+00035c90: 7969 6e67 2060 6675 6e63 6020 616c 6f6e  ying `func` alon
+00035ca0: 6720 736f 6d65 2064 696d 656e 7369 6f6e  g some dimension
+00035cb0: 2873 292e 0a0a 2020 2020 2020 2020 5061  (s)...        Pa
+00035cc0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00035cd0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00035ce0: 2020 2020 6675 6e63 203a 2063 616c 6c61      func : calla
+00035cf0: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
+00035d00: 4675 6e63 7469 6f6e 2077 6869 6368 2063  Function which c
+00035d10: 616e 2062 6520 6361 6c6c 6564 2069 6e20  an be called in 
+00035d20: 7468 6520 666f 726d 0a20 2020 2020 2020  the form.       
+00035d30: 2020 2020 2060 6628 782c 2061 7869 733d       `f(x, axis=
+00035d40: 6178 6973 2c20 2a2a 6b77 6172 6773 2960  axis, **kwargs)`
+00035d50: 2074 6f20 7265 7475 726e 2074 6865 2072   to return the r
+00035d60: 6573 756c 7420 6f66 2072 6564 7563 696e  esult of reducin
+00035d70: 6720 616e 0a20 2020 2020 2020 2020 2020  g an.           
+00035d80: 206e 702e 6e64 6172 7261 7920 6f76 6572   np.ndarray over
+00035d90: 2061 6e20 696e 7465 6765 7220 7661 6c75   an integer valu
+00035da0: 6564 2061 7869 732e 0a20 2020 2020 2020  ed axis..       
+00035db0: 2064 696d 203a 2073 7472 2c20 4974 6572   dim : str, Iter
+00035dc0: 6162 6c65 206f 6620 4861 7368 6162 6c65  able of Hashable
+00035dd0: 206f 7220 4e6f 6e65 2c20 6f70 7469 6f6e   or None, option
+00035de0: 616c 0a20 2020 2020 2020 2020 2020 2044  al.            D
+00035df0: 696d 656e 7369 6f6e 2873 2920 6f76 6572  imension(s) over
+00035e00: 2077 6869 6368 2074 6f20 6170 706c 7920   which to apply 
+00035e10: 6066 756e 6360 2e20 4279 2064 6566 6175  `func`. By defau
+00035e20: 6c74 2060 6675 6e63 6020 6973 0a20 2020  lt `func` is.   
+00035e30: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
+00035e40: 206f 7665 7220 616c 6c20 6469 6d65 6e73   over all dimens
+00035e50: 696f 6e73 2e0a 2020 2020 2020 2020 6b65  ions..        ke
+00035e60: 6570 5f61 7474 7273 203a 2062 6f6f 6c20  ep_attrs : bool 
+00035e70: 6f72 204e 6f6e 652c 206f 7074 696f 6e61  or None, optiona
+00035e80: 6c0a 2020 2020 2020 2020 2020 2020 4966  l.            If
+00035e90: 2054 7275 652c 2074 6865 2064 6174 6173   True, the datas
+00035ea0: 6574 2773 2061 7474 7269 6275 7465 7320  et's attributes 
+00035eb0: 2860 6174 7472 7360 2920 7769 6c6c 2062  (`attrs`) will b
+00035ec0: 6520 636f 7069 6564 2066 726f 6d0a 2020  e copied from.  
+00035ed0: 2020 2020 2020 2020 2020 7468 6520 6f72            the or
+00035ee0: 6967 696e 616c 206f 626a 6563 7420 746f  iginal object to
+00035ef0: 2074 6865 206e 6577 206f 6e65 2e20 2049   the new one.  I
+00035f00: 6620 4661 6c73 6520 2864 6566 6175 6c74  f False (default
+00035f10: 292c 2074 6865 206e 6577 0a20 2020 2020  ), the new.     
+00035f20: 2020 2020 2020 206f 626a 6563 7420 7769         object wi
+00035f30: 6c6c 2062 6520 7265 7475 726e 6564 2077  ll be returned w
+00035f40: 6974 686f 7574 2061 7474 7269 6275 7465  ithout attribute
+00035f50: 732e 0a20 2020 2020 2020 206b 6565 7064  s..        keepd
+00035f60: 696d 7320 3a20 626f 6f6c 2c20 6465 6661  ims : bool, defa
+00035f70: 756c 743a 2046 616c 7365 0a20 2020 2020  ult: False.     
+00035f80: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+00035f90: 7468 6520 6469 6d65 6e73 696f 6e73 2077  the dimensions w
+00035fa0: 6869 6368 2061 7265 2072 6564 7563 6564  hich are reduced
+00035fb0: 2061 7265 206c 6566 7420 696e 2074 6865   are left in the
+00035fc0: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
+00035fd0: 2020 2020 6173 2064 696d 656e 7369 6f6e      as dimension
+00035fe0: 7320 6f66 2073 697a 6520 6f6e 652e 2043  s of size one. C
+00035ff0: 6f6f 7264 696e 6174 6573 2074 6861 7420  oordinates that 
+00036000: 7573 6520 7468 6573 6520 6469 6d65 6e73  use these dimens
+00036010: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
+00036020: 2061 7265 2072 656d 6f76 6564 2e0a 2020   are removed..  
+00036030: 2020 2020 2020 6e75 6d65 7269 635f 6f6e        numeric_on
+00036040: 6c79 203a 2062 6f6f 6c2c 2064 6566 6175  ly : bool, defau
+00036050: 6c74 3a20 4661 6c73 650a 2020 2020 2020  lt: False.      
+00036060: 2020 2020 2020 4966 2054 7275 652c 206f        If True, o
+00036070: 6e6c 7920 6170 706c 7920 6060 6675 6e63  nly apply ``func
+00036080: 6060 2074 6f20 7661 7269 6162 6c65 7320  `` to variables 
+00036090: 7769 7468 2061 206e 756d 6572 6963 2064  with a numeric d
+000360a0: 7479 7065 2e0a 2020 2020 2020 2020 2a2a  type..        **
+000360b0: 6b77 6172 6773 203a 2041 6e79 0a20 2020  kwargs : Any.   
+000360c0: 2020 2020 2020 2020 2041 6464 6974 696f           Additio
+000360d0: 6e61 6c20 6b65 7977 6f72 6420 6172 6775  nal keyword argu
+000360e0: 6d65 6e74 7320 7061 7373 6564 206f 6e20  ments passed on 
+000360f0: 746f 2060 6066 756e 6360 602e 0a0a 2020  to ``func``...  
+00036100: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+00036110: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+00036120: 2020 2020 2020 7265 6475 6365 6420 3a20        reduced : 
+00036130: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
+00036140: 2020 2020 4461 7461 7365 7420 7769 7468      Dataset with
+00036150: 2074 6869 7320 6f62 6a65 6374 2773 2044   this object's D
+00036160: 6174 6141 7272 6179 7320 7265 706c 6163  ataArrays replac
+00036170: 6564 2077 6974 6820 6e65 7720 4461 7461  ed with new Data
+00036180: 4172 7261 7973 0a20 2020 2020 2020 2020  Arrays.         
+00036190: 2020 206f 6620 7375 6d6d 6172 697a 6564     of summarized
+000361a0: 2064 6174 6120 616e 6420 7468 6520 696e   data and the in
+000361b0: 6469 6361 7465 6420 6469 6d65 6e73 696f  dicated dimensio
+000361c0: 6e28 7329 2072 656d 6f76 6564 2e0a 2020  n(s) removed..  
+000361d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000361e0: 2020 6966 206b 7761 7267 732e 6765 7428    if kwargs.get(
+000361f0: 2261 7869 7322 2c20 4e6f 6e65 2920 6973  "axis", None) is
+00036200: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00036210: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00036220: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+00036230: 2020 2020 2020 2020 2022 7061 7373 696e           "passin
+00036240: 6720 2761 7869 7327 2074 6f20 4461 7461  g 'axis' to Data
+00036250: 7365 7420 7265 6475 6365 206d 6574 686f  set reduce metho
+00036260: 6473 2069 7320 616d 6269 6775 6f75 732e  ds is ambiguous.
+00036270: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00036280: 2020 2220 506c 6561 7365 2075 7365 2027    " Please use '
+00036290: 6469 6d27 2069 6e73 7465 6164 2e22 0a20  dim' instead.". 
+000362a0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+000362b0: 2020 2020 2020 6966 2064 696d 2069 7320        if dim is 
+000362c0: 4e6f 6e65 206f 7220 6469 6d20 6973 202e  None or dim is .
+000362d0: 2e2e 3a0a 2020 2020 2020 2020 2020 2020  ..:.            
+000362e0: 6469 6d73 203d 2073 6574 2873 656c 662e  dims = set(self.
+000362f0: 6469 6d73 290a 2020 2020 2020 2020 656c  dims).        el
+00036300: 6966 2069 7369 6e73 7461 6e63 6528 6469  if isinstance(di
+00036310: 6d2c 2073 7472 2920 6f72 206e 6f74 2069  m, str) or not i
+00036320: 7369 6e73 7461 6e63 6528 6469 6d2c 2049  sinstance(dim, I
+00036330: 7465 7261 626c 6529 3a0a 2020 2020 2020  terable):.      
+00036340: 2020 2020 2020 6469 6d73 203d 207b 6469        dims = {di
+00036350: 6d7d 0a20 2020 2020 2020 2065 6c73 653a  m}.        else:
+00036360: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+00036370: 7320 3d20 7365 7428 6469 6d29 0a0a 2020  s = set(dim)..  
+00036380: 2020 2020 2020 6d69 7373 696e 675f 6469        missing_di
+00036390: 6d65 6e73 696f 6e73 203d 205b 6420 666f  mensions = [d fo
+000363a0: 7220 6420 696e 2064 696d 7320 6966 2064  r d in dims if d
+000363b0: 206e 6f74 2069 6e20 7365 6c66 2e64 696d   not in self.dim
+000363c0: 735d 0a20 2020 2020 2020 2069 6620 6d69  s].        if mi
+000363d0: 7373 696e 675f 6469 6d65 6e73 696f 6e73  ssing_dimensions
+000363e0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+000363f0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00036400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036410: 6622 4461 7461 7365 7420 646f 6573 206e  f"Dataset does n
+00036420: 6f74 2063 6f6e 7461 696e 2074 6865 2064  ot contain the d
+00036430: 696d 656e 7369 6f6e 733a 207b 6d69 7373  imensions: {miss
+00036440: 696e 675f 6469 6d65 6e73 696f 6e73 7d22  ing_dimensions}"
+00036450: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00036460: 2020 2020 2020 2020 6966 206b 6565 705f          if keep_
+00036470: 6174 7472 7320 6973 204e 6f6e 653a 0a20  attrs is None:. 
+00036480: 2020 2020 2020 2020 2020 206b 6565 705f             keep_
+00036490: 6174 7472 7320 3d20 5f67 6574 5f6b 6565  attrs = _get_kee
+000364a0: 705f 6174 7472 7328 6465 6661 756c 743d  p_attrs(default=
+000364b0: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
+000364c0: 7661 7269 6162 6c65 733a 2064 6963 745b  variables: dict[
+000364d0: 4861 7368 6162 6c65 2c20 5661 7269 6162  Hashable, Variab
+000364e0: 6c65 5d20 3d20 7b7d 0a20 2020 2020 2020  le] = {}.       
+000364f0: 2066 6f72 206e 616d 652c 2076 6172 2069   for name, var i
+00036500: 6e20 7365 6c66 2e5f 7661 7269 6162 6c65  n self._variable
+00036510: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+00036520: 2020 2020 2020 2072 6564 7563 655f 6469         reduce_di
+00036530: 6d73 203d 205b 6420 666f 7220 6420 696e  ms = [d for d in
+00036540: 2076 6172 2e64 696d 7320 6966 2064 2069   var.dims if d i
+00036550: 6e20 6469 6d73 5d0a 2020 2020 2020 2020  n dims].        
+00036560: 2020 2020 6966 206e 616d 6520 696e 2073      if name in s
+00036570: 656c 662e 636f 6f72 6473 3a0a 2020 2020  elf.coords:.    
+00036580: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00036590: 6f74 2072 6564 7563 655f 6469 6d73 3a0a  ot reduce_dims:.
+000365a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000365b0: 2020 2020 7661 7269 6162 6c65 735b 6e61      variables[na
+000365c0: 6d65 5d20 3d20 7661 720a 2020 2020 2020  me] = var.      
+000365d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000365e0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+000365f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036600: 2020 2020 2023 2053 6f6d 6520 7265 6475       # Some redu
+00036610: 6374 696f 6e20 6675 6e63 7469 6f6e 7320  ction functions 
+00036620: 2865 2e67 2e20 7374 642c 2076 6172 2920  (e.g. std, var) 
+00036630: 6e65 6564 2074 6f20 7275 6e20 6f6e 2076  need to run on v
+00036640: 6172 6961 626c 6573 0a20 2020 2020 2020  ariables.       
+00036650: 2020 2020 2020 2020 2020 2020 2023 2074               # t
+00036660: 6861 7420 646f 6e27 7420 6861 7665 2074  hat don't have t
+00036670: 6865 2072 6564 7563 6520 6469 6d73 3a20  he reduce dims: 
+00036680: 5052 3533 3933 0a20 2020 2020 2020 2020  PR5393.         
+00036690: 2020 2020 2020 2020 2020 206e 6f74 2072             not r
+000366a0: 6564 7563 655f 6469 6d73 0a20 2020 2020  educe_dims.     
+000366b0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000366c0: 7220 6e6f 7420 6e75 6d65 7269 635f 6f6e  r not numeric_on
+000366d0: 6c79 0a20 2020 2020 2020 2020 2020 2020  ly.             
+000366e0: 2020 2020 2020 206f 7220 6e70 2e69 7373         or np.iss
+000366f0: 7562 6474 7970 6528 7661 722e 6474 7970  ubdtype(var.dtyp
+00036700: 652c 206e 702e 6e75 6d62 6572 290a 2020  e, np.number).  
+00036710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036720: 2020 6f72 2028 7661 722e 6474 7970 6520    or (var.dtype 
+00036730: 3d3d 206e 702e 626f 6f6c 5f29 0a20 2020  == np.bool_).   
+00036740: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
+00036750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036760: 2020 2020 2320 7072 6566 6572 2074 6f20      # prefer to 
+00036770: 6167 6772 6567 6174 6520 6f76 6572 2061  aggregate over a
+00036780: 7869 733d 4e6f 6e65 2072 6174 6865 7220  xis=None rather 
+00036790: 7468 616e 0a20 2020 2020 2020 2020 2020  than.           
+000367a0: 2020 2020 2020 2020 2023 2061 7869 733d           # axis=
+000367b0: 2830 2c20 3129 2069 6620 7468 6579 2077  (0, 1) if they w
+000367c0: 696c 6c20 6265 2065 7175 6976 616c 656e  ill be equivalen
+000367d0: 742c 2062 6563 6175 7365 0a20 2020 2020  t, because.     
+000367e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000367f0: 2074 6865 2066 6f72 6d65 7220 6973 206f   the former is o
+00036800: 6674 656e 206d 6f72 6520 6566 6669 6369  ften more effici
+00036810: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+00036820: 2020 2020 2020 2020 2320 6b65 6570 2073          # keep s
+00036830: 696e 676c 652d 656c 656d 656e 7420 6469  ingle-element di
+00036840: 6d73 2061 7320 6c69 7374 2c20 746f 2073  ms as list, to s
+00036850: 7570 706f 7274 2048 6173 6861 626c 6573  upport Hashables
+00036860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036870: 2020 2020 2072 6564 7563 655f 6d61 7962       reduce_mayb
+00036880: 655f 7369 6e67 6c65 203d 2028 0a20 2020  e_single = (.   
+00036890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000368a0: 2020 2020 204e 6f6e 650a 2020 2020 2020       None.      
+000368b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000368c0: 2020 6966 206c 656e 2872 6564 7563 655f    if len(reduce_
+000368d0: 6469 6d73 2920 3d3d 2076 6172 2e6e 6469  dims) == var.ndi
+000368e0: 6d20 616e 6420 7661 722e 6e64 696d 2021  m and var.ndim !
+000368f0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00036900: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00036910: 2072 6564 7563 655f 6469 6d73 0a20 2020   reduce_dims.   
+00036920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036930: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00036940: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+00036950: 5b6e 616d 655d 203d 2076 6172 2e72 6564  [name] = var.red
+00036960: 7563 6528 0a20 2020 2020 2020 2020 2020  uce(.           
+00036970: 2020 2020 2020 2020 2020 2020 2066 756e               fun
+00036980: 632c 0a20 2020 2020 2020 2020 2020 2020  c,.             
+00036990: 2020 2020 2020 2020 2020 2064 696d 3d72             dim=r
+000369a0: 6564 7563 655f 6d61 7962 655f 7369 6e67  educe_maybe_sing
+000369b0: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+000369c0: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
+000369d0: 5f61 7474 7273 3d6b 6565 705f 6174 7472  _attrs=keep_attr
+000369e0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+000369f0: 2020 2020 2020 2020 2020 206b 6565 7064             keepd
+00036a00: 696d 733d 6b65 6570 6469 6d73 2c0a 2020  ims=keepdims,.  
+00036a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036a20: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
+00036a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036a40: 2020 2020 290a 0a20 2020 2020 2020 2063      )..        c
+00036a50: 6f6f 7264 5f6e 616d 6573 203d 207b 6b20  oord_names = {k 
+00036a60: 666f 7220 6b20 696e 2073 656c 662e 636f  for k in self.co
+00036a70: 6f72 6473 2069 6620 6b20 696e 2076 6172  ords if k in var
+00036a80: 6961 626c 6573 7d0a 2020 2020 2020 2020  iables}.        
+00036a90: 696e 6465 7865 7320 3d20 7b6b 3a20 7620  indexes = {k: v 
+00036aa0: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
+00036ab0: 2e5f 696e 6465 7865 732e 6974 656d 7328  ._indexes.items(
+00036ac0: 2920 6966 206b 2069 6e20 7661 7269 6162  ) if k in variab
+00036ad0: 6c65 737d 0a20 2020 2020 2020 2061 7474  les}.        att
+00036ae0: 7273 203d 2073 656c 662e 6174 7472 7320  rs = self.attrs 
+00036af0: 6966 206b 6565 705f 6174 7472 7320 656c  if keep_attrs el
+00036b00: 7365 204e 6f6e 650a 2020 2020 2020 2020  se None.        
+00036b10: 7265 7475 726e 2073 656c 662e 5f72 6570  return self._rep
+00036b20: 6c61 6365 5f77 6974 685f 6e65 775f 6469  lace_with_new_di
+00036b30: 6d73 280a 2020 2020 2020 2020 2020 2020  ms(.            
+00036b40: 7661 7269 6162 6c65 732c 2063 6f6f 7264  variables, coord
+00036b50: 5f6e 616d 6573 3d63 6f6f 7264 5f6e 616d  _names=coord_nam
+00036b60: 6573 2c20 6174 7472 733d 6174 7472 732c  es, attrs=attrs,
+00036b70: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
+00036b80: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00036b90: 6465 6620 6d61 7028 0a20 2020 2020 2020  def map(.       
+00036ba0: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
+00036bb0: 2c0a 2020 2020 2020 2020 6675 6e63 3a20  ,.        func: 
+00036bc0: 4361 6c6c 6162 6c65 2c0a 2020 2020 2020  Callable,.      
+00036bd0: 2020 6b65 6570 5f61 7474 7273 3a20 626f    keep_attrs: bo
+00036be0: 6f6c 207c 204e 6f6e 6520 3d20 4e6f 6e65  ol | None = None
+00036bf0: 2c0a 2020 2020 2020 2020 6172 6773 3a20  ,.        args: 
+00036c00: 4974 6572 6162 6c65 5b41 6e79 5d20 3d20  Iterable[Any] = 
+00036c10: 2829 2c0a 2020 2020 2020 2020 2a2a 6b77  (),.        **kw
+00036c20: 6172 6773 3a20 416e 792c 0a20 2020 2029  args: Any,.    )
+00036c30: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
+00036c40: 2020 2020 2020 2022 2222 4170 706c 7920         """Apply 
+00036c50: 6120 6675 6e63 7469 6f6e 2074 6f20 6561  a function to ea
+00036c60: 6368 2064 6174 6120 7661 7269 6162 6c65  ch data variable
+00036c70: 2069 6e20 7468 6973 2064 6174 6173 6574   in this dataset
+00036c80: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+00036c90: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+00036ca0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00036cb0: 6675 6e63 203a 2063 616c 6c61 626c 650a  func : callable.
+00036cc0: 2020 2020 2020 2020 2020 2020 4675 6e63              Func
+00036cd0: 7469 6f6e 2077 6869 6368 2063 616e 2062  tion which can b
+00036ce0: 6520 6361 6c6c 6564 2069 6e20 7468 6520  e called in the 
+00036cf0: 666f 726d 2060 6675 6e63 2878 2c20 2a61  form `func(x, *a
+00036d00: 7267 732c 202a 2a6b 7761 7267 7329 600a  rgs, **kwargs)`.
+00036d10: 2020 2020 2020 2020 2020 2020 746f 2074              to t
+00036d20: 7261 6e73 666f 726d 2065 6163 6820 4461  ransform each Da
+00036d30: 7461 4172 7261 7920 6078 6020 696e 2074  taArray `x` in t
+00036d40: 6869 7320 6461 7461 7365 7420 696e 746f  his dataset into
+00036d50: 2061 6e6f 7468 6572 0a20 2020 2020 2020   another.       
+00036d60: 2020 2020 2044 6174 6141 7272 6179 2e0a       DataArray..
+00036d70: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
+00036d80: 7273 203a 2062 6f6f 6c20 6f72 204e 6f6e  rs : bool or Non
+00036d90: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
+00036da0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00036db0: 2062 6f74 6820 7468 6520 6461 7461 7365   both the datase
+00036dc0: 7427 7320 616e 6420 7661 7269 6162 6c65  t's and variable
+00036dd0: 7327 2061 7474 7269 6275 7465 7320 2860  s' attributes (`
+00036de0: 6174 7472 7360 2920 7769 6c6c 2062 650a  attrs`) will be.
+00036df0: 2020 2020 2020 2020 2020 2020 636f 7069              copi
+00036e00: 6564 2066 726f 6d20 7468 6520 6f72 6967  ed from the orig
+00036e10: 696e 616c 206f 626a 6563 7473 2074 6f20  inal objects to 
+00036e20: 7468 6520 6e65 7720 6f6e 6573 2e20 4966  the new ones. If
+00036e30: 2046 616c 7365 2c20 7468 6520 6e65 7720   False, the new 
+00036e40: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
+00036e50: 2020 2020 616e 6420 7661 7269 6162 6c65      and variable
+00036e60: 7320 7769 6c6c 2062 6520 7265 7475 726e  s will be return
+00036e70: 6564 2077 6974 686f 7574 2063 6f70 7969  ed without copyi
+00036e80: 6e67 2074 6865 2061 7474 7269 6275 7465  ng the attribute
+00036e90: 732e 0a20 2020 2020 2020 2061 7267 7320  s..        args 
+00036ea0: 3a20 6974 6572 6162 6c65 2c20 6f70 7469  : iterable, opti
+00036eb0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00036ec0: 2050 6f73 6974 696f 6e61 6c20 6172 6775   Positional argu
+00036ed0: 6d65 6e74 7320 7061 7373 6564 206f 6e20  ments passed on 
+00036ee0: 746f 2060 6675 6e63 602e 0a20 2020 2020  to `func`..     
+00036ef0: 2020 202a 2a6b 7761 7267 7320 3a20 416e     **kwargs : An
+00036f00: 790a 2020 2020 2020 2020 2020 2020 4b65  y.            Ke
+00036f10: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
+00036f20: 7061 7373 6564 206f 6e20 746f 2060 6675  passed on to `fu
+00036f30: 6e63 602e 0a0a 2020 2020 2020 2020 5265  nc`...        Re
+00036f40: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+00036f50: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6170  -----.        ap
+00036f60: 706c 6965 6420 3a20 4461 7461 7365 740a  plied : Dataset.
+00036f70: 2020 2020 2020 2020 2020 2020 5265 7375              Resu
+00036f80: 6c74 696e 6720 6461 7461 7365 7420 6672  lting dataset fr
+00036f90: 6f6d 2061 7070 6c79 696e 6720 6060 6675  om applying ``fu
+00036fa0: 6e63 6060 2074 6f20 6561 6368 2064 6174  nc`` to each dat
+00036fb0: 6120 7661 7269 6162 6c65 2e0a 0a20 2020  a variable...   
+00036fc0: 2020 2020 2045 7861 6d70 6c65 730a 2020       Examples.  
+00036fd0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+00036fe0: 2020 2020 2020 203e 3e3e 2064 6120 3d20         >>> da = 
+00036ff0: 7872 2e44 6174 6141 7272 6179 286e 702e  xr.DataArray(np.
+00037000: 7261 6e64 6f6d 2e72 616e 646e 2832 2c20  random.randn(2, 
+00037010: 3329 290a 2020 2020 2020 2020 3e3e 3e20  3)).        >>> 
+00037020: 6473 203d 2078 722e 4461 7461 7365 7428  ds = xr.Dataset(
+00037030: 7b22 666f 6f22 3a20 6461 2c20 2262 6172  {"foo": da, "bar
+00037040: 223a 2028 2278 222c 205b 2d31 2c20 325d  ": ("x", [-1, 2]
+00037050: 297d 290a 2020 2020 2020 2020 3e3e 3e20  )}).        >>> 
+00037060: 6473 0a20 2020 2020 2020 203c 7861 7272  ds.        <xarr
+00037070: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
+00037080: 2020 2020 4469 6d65 6e73 696f 6e73 3a20      Dimensions: 
+00037090: 2028 6469 6d5f 303a 2032 2c20 6469 6d5f   (dim_0: 2, dim_
+000370a0: 313a 2033 2c20 783a 2032 290a 2020 2020  1: 3, x: 2).    
+000370b0: 2020 2020 4469 6d65 6e73 696f 6e73 2077      Dimensions w
+000370c0: 6974 686f 7574 2063 6f6f 7264 696e 6174  ithout coordinat
+000370d0: 6573 3a20 6469 6d5f 302c 2064 696d 5f31  es: dim_0, dim_1
+000370e0: 2c20 780a 2020 2020 2020 2020 4461 7461  , x.        Data
+000370f0: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+00037100: 2020 2020 2020 2020 666f 6f20 2020 2020          foo     
+00037110: 2028 6469 6d5f 302c 2064 696d 5f31 2920   (dim_0, dim_1) 
+00037120: 666c 6f61 7436 3420 312e 3736 3420 302e  float64 1.764 0.
+00037130: 3430 3032 2030 2e39 3738 3720 322e 3234  4002 0.9787 2.24
+00037140: 3120 312e 3836 3820 2d30 2e39 3737 330a  1 1.868 -0.9773.
+00037150: 2020 2020 2020 2020 2020 2020 6261 7220              bar 
+00037160: 2020 2020 2028 7829 2069 6e74 3634 202d       (x) int64 -
+00037170: 3120 320a 2020 2020 2020 2020 3e3e 3e20  1 2.        >>> 
+00037180: 6473 2e6d 6170 286e 702e 6661 6273 290a  ds.map(np.fabs).
+00037190: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+000371a0: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+000371b0: 2044 696d 656e 7369 6f6e 733a 2020 2864   Dimensions:  (d
+000371c0: 696d 5f30 3a20 322c 2064 696d 5f31 3a20  im_0: 2, dim_1: 
+000371d0: 332c 2078 3a20 3229 0a20 2020 2020 2020  3, x: 2).       
+000371e0: 2044 696d 656e 7369 6f6e 7320 7769 7468   Dimensions with
+000371f0: 6f75 7420 636f 6f72 6469 6e61 7465 733a  out coordinates:
+00037200: 2064 696d 5f30 2c20 6469 6d5f 312c 2078   dim_0, dim_1, x
+00037210: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
+00037220: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+00037230: 2020 2020 2066 6f6f 2020 2020 2020 2864       foo      (d
+00037240: 696d 5f30 2c20 6469 6d5f 3129 2066 6c6f  im_0, dim_1) flo
+00037250: 6174 3634 2031 2e37 3634 2030 2e34 3030  at64 1.764 0.400
+00037260: 3220 302e 3937 3837 2032 2e32 3431 2031  2 0.9787 2.241 1
+00037270: 2e38 3638 2030 2e39 3737 330a 2020 2020  .868 0.9773.    
+00037280: 2020 2020 2020 2020 6261 7220 2020 2020          bar     
+00037290: 2028 7829 2066 6c6f 6174 3634 2031 2e30   (x) float64 1.0
+000372a0: 2032 2e30 0a20 2020 2020 2020 2022 2222   2.0.        """
+000372b0: 0a20 2020 2020 2020 2069 6620 6b65 6570  .        if keep
+000372c0: 5f61 7474 7273 2069 7320 4e6f 6e65 3a0a  _attrs is None:.
+000372d0: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
+000372e0: 5f61 7474 7273 203d 205f 6765 745f 6b65  _attrs = _get_ke
+000372f0: 6570 5f61 7474 7273 2864 6566 6175 6c74  ep_attrs(default
+00037300: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+00037310: 7661 7269 6162 6c65 7320 3d20 7b0a 2020  variables = {.  
+00037320: 2020 2020 2020 2020 2020 6b3a 206d 6179            k: may
+00037330: 6265 5f77 7261 705f 6172 7261 7928 762c  be_wrap_array(v,
+00037340: 2066 756e 6328 762c 202a 6172 6773 2c20   func(v, *args, 
+00037350: 2a2a 6b77 6172 6773 2929 0a20 2020 2020  **kwargs)).     
+00037360: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
+00037370: 696e 2073 656c 662e 6461 7461 5f76 6172  in self.data_var
+00037380: 732e 6974 656d 7328 290a 2020 2020 2020  s.items().      
+00037390: 2020 7d0a 2020 2020 2020 2020 6966 206b    }.        if k
+000373a0: 6565 705f 6174 7472 733a 0a20 2020 2020  eep_attrs:.     
+000373b0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
+000373c0: 696e 2076 6172 6961 626c 6573 2e69 7465  in variables.ite
+000373d0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+000373e0: 2020 2020 2020 762e 5f63 6f70 795f 6174        v._copy_at
+000373f0: 7472 735f 6672 6f6d 2873 656c 662e 6461  trs_from(self.da
+00037400: 7461 5f76 6172 735b 6b5d 290a 2020 2020  ta_vars[k]).    
+00037410: 2020 2020 6174 7472 7320 3d20 7365 6c66      attrs = self
+00037420: 2e61 7474 7273 2069 6620 6b65 6570 5f61  .attrs if keep_a
+00037430: 7474 7273 2065 6c73 6520 4e6f 6e65 0a20  ttrs else None. 
+00037440: 2020 2020 2020 2072 6574 7572 6e20 7479         return ty
+00037450: 7065 2873 656c 6629 2876 6172 6961 626c  pe(self)(variabl
+00037460: 6573 2c20 6174 7472 733d 6174 7472 7329  es, attrs=attrs)
+00037470: 0a0a 2020 2020 6465 6620 6170 706c 7928  ..    def apply(
+00037480: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
+00037490: 5f44 6174 6173 6574 2c0a 2020 2020 2020  _Dataset,.      
+000374a0: 2020 6675 6e63 3a20 4361 6c6c 6162 6c65    func: Callable
+000374b0: 2c0a 2020 2020 2020 2020 6b65 6570 5f61  ,.        keep_a
+000374c0: 7474 7273 3a20 626f 6f6c 207c 204e 6f6e  ttrs: bool | Non
+000374d0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+000374e0: 2020 6172 6773 3a20 4974 6572 6162 6c65    args: Iterable
+000374f0: 5b41 6e79 5d20 3d20 2829 2c0a 2020 2020  [Any] = (),.    
+00037500: 2020 2020 2a2a 6b77 6172 6773 3a20 416e      **kwargs: An
+00037510: 792c 0a20 2020 2029 202d 3e20 545f 4461  y,.    ) -> T_Da
+00037520: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+00037530: 2222 0a20 2020 2020 2020 2042 6163 6b77  "".        Backw
+00037540: 6172 6420 636f 6d70 6174 6962 6c65 2069  ard compatible i
+00037550: 6d70 6c65 6d65 6e74 6174 696f 6e20 6f66  mplementation of
+00037560: 2060 606d 6170 6060 0a0a 2020 2020 2020   ``map``..      
+00037570: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+00037580: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+00037590: 2020 2020 4461 7461 7365 742e 6d61 700a      Dataset.map.
+000375a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000375b0: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
+000375c0: 6e28 0a20 2020 2020 2020 2020 2020 2022  n(.            "
+000375d0: 4461 7461 7365 742e 6170 706c 7920 6d61  Dataset.apply ma
+000375e0: 7920 6265 2064 6570 7265 6361 7465 6420  y be deprecated 
+000375f0: 696e 2074 6865 2066 7574 7572 652e 2055  in the future. U
+00037600: 7369 6e67 2044 6174 6173 6574 2e6d 6170  sing Dataset.map
+00037610: 2069 7320 656e 636f 7572 6167 6564 222c   is encouraged",
+00037620: 0a20 2020 2020 2020 2020 2020 2050 656e  .            Pen
+00037630: 6469 6e67 4465 7072 6563 6174 696f 6e57  dingDeprecationW
+00037640: 6172 6e69 6e67 2c0a 2020 2020 2020 2020  arning,.        
+00037650: 2020 2020 7374 6163 6b6c 6576 656c 3d32      stacklevel=2
+00037660: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00037670: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00037680: 6d61 7028 6675 6e63 2c20 6b65 6570 5f61  map(func, keep_a
+00037690: 7474 7273 2c20 6172 6773 2c20 2a2a 6b77  ttrs, args, **kw
+000376a0: 6172 6773 290a 0a20 2020 2064 6566 2061  args)..    def a
+000376b0: 7373 6967 6e28 0a20 2020 2020 2020 2073  ssign(.        s
+000376c0: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
+000376d0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+000376e0: 733a 204d 6170 7069 6e67 5b41 6e79 2c20  s: Mapping[Any, 
+000376f0: 416e 795d 207c 204e 6f6e 6520 3d20 4e6f  Any] | None = No
+00037700: 6e65 2c0a 2020 2020 2020 2020 2a2a 7661  ne,.        **va
+00037710: 7269 6162 6c65 735f 6b77 6172 6773 3a20  riables_kwargs: 
+00037720: 416e 792c 0a20 2020 2029 202d 3e20 545f  Any,.    ) -> T_
+00037730: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+00037740: 2022 2222 4173 7369 676e 206e 6577 2064   """Assign new d
+00037750: 6174 6120 7661 7269 6162 6c65 7320 746f  ata variables to
+00037760: 2061 2044 6174 6173 6574 2c20 7265 7475   a Dataset, retu
+00037770: 726e 696e 6720 6120 6e65 7720 6f62 6a65  rning a new obje
+00037780: 6374 0a20 2020 2020 2020 2077 6974 6820  ct.        with 
+00037790: 616c 6c20 7468 6520 6f72 6967 696e 616c  all the original
+000377a0: 2076 6172 6961 626c 6573 2069 6e20 6164   variables in ad
+000377b0: 6469 7469 6f6e 2074 6f20 7468 6520 6e65  dition to the ne
+000377c0: 7720 6f6e 6573 2e0a 0a20 2020 2020 2020  w ones...       
+000377d0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+000377e0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+000377f0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+00037800: 203a 206d 6170 7069 6e67 206f 6620 6861   : mapping of ha
+00037810: 7368 6162 6c65 2074 6f20 416e 790a 2020  shable to Any.  
+00037820: 2020 2020 2020 2020 2020 4d61 7070 696e            Mappin
+00037830: 6720 6672 6f6d 2076 6172 6961 626c 6573  g from variables
+00037840: 206e 616d 6573 2074 6f20 7468 6520 6e65   names to the ne
+00037850: 7720 7661 6c75 6573 2e20 4966 2074 6865  w values. If the
+00037860: 206e 6577 2076 616c 7565 730a 2020 2020   new values.    
+00037870: 2020 2020 2020 2020 6172 6520 6361 6c6c          are call
+00037880: 6162 6c65 2c20 7468 6579 2061 7265 2063  able, they are c
+00037890: 6f6d 7075 7465 6420 6f6e 2074 6865 2044  omputed on the D
+000378a0: 6174 6173 6574 2061 6e64 2061 7373 6967  ataset and assig
+000378b0: 6e65 6420 746f 206e 6577 0a20 2020 2020  ned to new.     
+000378c0: 2020 2020 2020 2064 6174 6120 7661 7269         data vari
+000378d0: 6162 6c65 732e 2049 6620 7468 6520 7661  ables. If the va
+000378e0: 6c75 6573 2061 7265 206e 6f74 2063 616c  lues are not cal
+000378f0: 6c61 626c 652c 2028 652e 672e 2061 2044  lable, (e.g. a D
+00037900: 6174 6141 7272 6179 2c0a 2020 2020 2020  ataArray,.      
+00037910: 2020 2020 2020 7363 616c 6172 2c20 6f72        scalar, or
+00037920: 2061 7272 6179 292c 2074 6865 7920 6172   array), they ar
+00037930: 6520 7369 6d70 6c79 2061 7373 6967 6e65  e simply assigne
+00037940: 642e 0a20 2020 2020 2020 202a 2a76 6172  d..        **var
+00037950: 6961 626c 6573 5f6b 7761 7267 730a 2020  iables_kwargs.  
+00037960: 2020 2020 2020 2020 2020 5468 6520 6b65            The ke
+00037970: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
+00037980: 666f 726d 206f 6620 6060 7661 7269 6162  form of ``variab
+00037990: 6c65 7360 602e 0a20 2020 2020 2020 2020  les``..         
+000379a0: 2020 204f 6e65 206f 6620 7661 7269 6162     One of variab
+000379b0: 6c65 7320 6f72 2076 6172 6961 626c 6573  les or variables
+000379c0: 5f6b 7761 7267 7320 6d75 7374 2062 6520  _kwargs must be 
+000379d0: 7072 6f76 6964 6564 2e0a 0a20 2020 2020  provided...     
+000379e0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+000379f0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+00037a00: 2020 2064 7320 3a20 4461 7461 7365 740a     ds : Dataset.
+00037a10: 2020 2020 2020 2020 2020 2020 4120 6e65              A ne
+00037a20: 7720 4461 7461 7365 7420 7769 7468 2074  w Dataset with t
+00037a30: 6865 206e 6577 2076 6172 6961 626c 6573  he new variables
+00037a40: 2069 6e20 6164 6469 7469 6f6e 2074 6f20   in addition to 
+00037a50: 616c 6c20 7468 650a 2020 2020 2020 2020  all the.        
+00037a60: 2020 2020 6578 6973 7469 6e67 2076 6172      existing var
+00037a70: 6961 626c 6573 2e0a 0a20 2020 2020 2020  iables...       
+00037a80: 204e 6f74 6573 0a20 2020 2020 2020 202d   Notes.        -
+00037a90: 2d2d 2d2d 0a20 2020 2020 2020 2053 696e  ----.        Sin
+00037aa0: 6365 2060 606b 7761 7267 7360 6020 6973  ce ``kwargs`` is
+00037ab0: 2061 2064 6963 7469 6f6e 6172 792c 2074   a dictionary, t
+00037ac0: 6865 206f 7264 6572 206f 6620 796f 7572  he order of your
+00037ad0: 2061 7267 756d 656e 7473 206d 6179 206e   arguments may n
+00037ae0: 6f74 0a20 2020 2020 2020 2062 6520 7072  ot.        be pr
+00037af0: 6573 6572 7665 642c 2061 6e64 2073 6f20  eserved, and so 
+00037b00: 7468 6520 6f72 6465 7220 6f66 2074 6865  the order of the
+00037b10: 206e 6577 2076 6172 6961 626c 6573 2069   new variables i
+00037b20: 7320 6e6f 7420 7765 6c6c 0a20 2020 2020  s not well.     
+00037b30: 2020 2064 6566 696e 6564 2e20 4173 7369     defined. Assi
+00037b40: 676e 696e 6720 6d75 6c74 6970 6c65 2076  gning multiple v
+00037b50: 6172 6961 626c 6573 2077 6974 6869 6e20  ariables within 
+00037b60: 7468 6520 7361 6d65 2060 6061 7373 6967  the same ``assig
+00037b70: 6e60 6020 6973 0a20 2020 2020 2020 2070  n`` is.        p
+00037b80: 6f73 7369 626c 652c 2062 7574 2079 6f75  ossible, but you
+00037b90: 2063 616e 6e6f 7420 7265 6665 7265 6e63   cannot referenc
+00037ba0: 6520 6f74 6865 7220 7661 7269 6162 6c65  e other variable
+00037bb0: 7320 6372 6561 7465 6420 7769 7468 696e  s created within
+00037bc0: 2074 6865 0a20 2020 2020 2020 2073 616d   the.        sam
+00037bd0: 6520 6060 6173 7369 676e 6060 2063 616c  e ``assign`` cal
+00037be0: 6c2e 0a0a 2020 2020 2020 2020 5365 6520  l...        See 
+00037bf0: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+00037c00: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7061  -----.        pa
+00037c10: 6e64 6173 2e44 6174 6146 7261 6d65 2e61  ndas.DataFrame.a
+00037c20: 7373 6967 6e0a 0a20 2020 2020 2020 2045  ssign..        E
+00037c30: 7861 6d70 6c65 730a 2020 2020 2020 2020  xamples.        
+00037c40: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00037c50: 203e 3e3e 2078 203d 2078 722e 4461 7461   >>> x = xr.Data
+00037c60: 7365 7428 0a20 2020 2020 2020 202e 2e2e  set(.        ...
+00037c70: 2020 2020 207b 0a20 2020 2020 2020 202e       {.        .
+00037c80: 2e2e 2020 2020 2020 2020 2022 7465 6d70  ..         "temp
+00037c90: 6572 6174 7572 655f 6322 3a20 280a 2020  erature_c": (.  
+00037ca0: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
+00037cb0: 2020 2020 2020 2822 6c61 7422 2c20 226c        ("lat", "l
+00037cc0: 6f6e 2229 2c0a 2020 2020 2020 2020 2e2e  on"),.        ..
+00037cd0: 2e20 2020 2020 2020 2020 2020 2020 3230  .             20
+00037ce0: 202a 206e 702e 7261 6e64 6f6d 2e72 616e   * np.random.ran
+00037cf0: 6428 3429 2e72 6573 6861 7065 2832 2c20  d(4).reshape(2, 
+00037d00: 3229 2c0a 2020 2020 2020 2020 2e2e 2e20  2),.        ... 
+00037d10: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+00037d20: 2020 202e 2e2e 2020 2020 2020 2020 2022     ...         "
+00037d30: 7072 6563 6970 6974 6174 696f 6e22 3a20  precipitation": 
+00037d40: 2828 226c 6174 222c 2022 6c6f 6e22 292c  (("lat", "lon"),
+00037d50: 206e 702e 7261 6e64 6f6d 2e72 616e 6428   np.random.rand(
+00037d60: 3429 2e72 6573 6861 7065 2832 2c20 3229  4).reshape(2, 2)
+00037d70: 292c 0a20 2020 2020 2020 202e 2e2e 2020  ),.        ...  
+00037d80: 2020 207d 2c0a 2020 2020 2020 2020 2e2e     },.        ..
+00037d90: 2e20 2020 2020 636f 6f72 6473 3d7b 226c  .     coords={"l
+00037da0: 6174 223a 205b 3130 2c20 3230 5d2c 2022  at": [10, 20], "
+00037db0: 6c6f 6e22 3a20 5b31 3530 2c20 3136 305d  lon": [150, 160]
+00037dc0: 7d2c 0a20 2020 2020 2020 202e 2e2e 2029  },.        ... )
+00037dd0: 0a20 2020 2020 2020 203e 3e3e 2078 0a20  .        >>> x. 
+00037de0: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
+00037df0: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
+00037e00: 4469 6d65 6e73 696f 6e73 3a20 2020 2020  Dimensions:     
+00037e10: 2020 2028 6c61 743a 2032 2c20 6c6f 6e3a     (lat: 2, lon:
+00037e20: 2032 290a 2020 2020 2020 2020 436f 6f72   2).        Coor
+00037e30: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
+00037e40: 2020 202a 206c 6174 2020 2020 2020 2020     * lat        
+00037e50: 2020 2020 286c 6174 2920 696e 7436 3420      (lat) int64 
+00037e60: 3130 2032 300a 2020 2020 2020 2020 2020  10 20.          
+00037e70: 2a20 6c6f 6e20 2020 2020 2020 2020 2020  * lon           
+00037e80: 2028 6c6f 6e29 2069 6e74 3634 2031 3530   (lon) int64 150
+00037e90: 2031 3630 0a20 2020 2020 2020 2044 6174   160.        Dat
+00037ea0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
+00037eb0: 2020 2020 2020 2020 2074 656d 7065 7261           tempera
+00037ec0: 7475 7265 5f63 2020 286c 6174 2c20 6c6f  ture_c  (lat, lo
+00037ed0: 6e29 2066 6c6f 6174 3634 2031 302e 3938  n) float64 10.98
+00037ee0: 2031 342e 3320 3132 2e30 3620 3130 2e39   14.3 12.06 10.9
+00037ef0: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+00037f00: 6369 7069 7461 7469 6f6e 2020 286c 6174  cipitation  (lat
+00037f10: 2c20 6c6f 6e29 2066 6c6f 6174 3634 2030  , lon) float64 0
+00037f20: 2e34 3233 3720 302e 3634 3539 2030 2e34  .4237 0.6459 0.4
+00037f30: 3337 3620 302e 3839 3138 0a0a 2020 2020  376 0.8918..    
+00037f40: 2020 2020 5768 6572 6520 7468 6520 7661      Where the va
+00037f50: 6c75 6520 6973 2061 2063 616c 6c61 626c  lue is a callabl
+00037f60: 652c 2065 7661 6c75 6174 6564 206f 6e20  e, evaluated on 
+00037f70: 6461 7461 7365 743a 0a0a 2020 2020 2020  dataset:..      
+00037f80: 2020 3e3e 3e20 782e 6173 7369 676e 2874    >>> x.assign(t
+00037f90: 656d 7065 7261 7475 7265 5f66 3d6c 616d  emperature_f=lam
+00037fa0: 6264 6120 783a 2078 2e74 656d 7065 7261  bda x: x.tempera
+00037fb0: 7475 7265 5f63 202a 2039 202f 2035 202b  ture_c * 9 / 5 +
+00037fc0: 2033 3229 0a20 2020 2020 2020 203c 7861   32).        <xa
+00037fd0: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
+00037fe0: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
+00037ff0: 3a20 2020 2020 2020 2028 6c61 743a 2032  :        (lat: 2
+00038000: 2c20 6c6f 6e3a 2032 290a 2020 2020 2020  , lon: 2).      
+00038010: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+00038020: 2020 2020 2020 2020 202a 206c 6174 2020           * lat  
+00038030: 2020 2020 2020 2020 2020 286c 6174 2920            (lat) 
+00038040: 696e 7436 3420 3130 2032 300a 2020 2020  int64 10 20.    
+00038050: 2020 2020 2020 2a20 6c6f 6e20 2020 2020        * lon     
+00038060: 2020 2020 2020 2028 6c6f 6e29 2069 6e74         (lon) int
+00038070: 3634 2031 3530 2031 3630 0a20 2020 2020  64 150 160.     
+00038080: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
+00038090: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
+000380a0: 656d 7065 7261 7475 7265 5f63 2020 286c  emperature_c  (l
+000380b0: 6174 2c20 6c6f 6e29 2066 6c6f 6174 3634  at, lon) float64
+000380c0: 2031 302e 3938 2031 342e 3320 3132 2e30   10.98 14.3 12.0
+000380d0: 3620 3130 2e39 0a20 2020 2020 2020 2020  6 10.9.         
+000380e0: 2020 2070 7265 6369 7069 7461 7469 6f6e     precipitation
+000380f0: 2020 286c 6174 2c20 6c6f 6e29 2066 6c6f    (lat, lon) flo
+00038100: 6174 3634 2030 2e34 3233 3720 302e 3634  at64 0.4237 0.64
+00038110: 3539 2030 2e34 3337 3620 302e 3839 3138  59 0.4376 0.8918
+00038120: 0a20 2020 2020 2020 2020 2020 2074 656d  .            tem
+00038130: 7065 7261 7475 7265 5f66 2020 286c 6174  perature_f  (lat
+00038140: 2c20 6c6f 6e29 2066 6c6f 6174 3634 2035  , lon) float64 5
+00038150: 312e 3736 2035 372e 3735 2035 332e 3720  1.76 57.75 53.7 
+00038160: 3531 2e36 320a 0a20 2020 2020 2020 2041  51.62..        A
+00038170: 6c74 6572 6e61 7469 7665 6c79 2c20 7468  lternatively, th
+00038180: 6520 7361 6d65 2062 6568 6176 696f 7220  e same behavior 
+00038190: 6361 6e20 6265 2061 6368 6965 7665 6420  can be achieved 
+000381a0: 6279 2064 6972 6563 746c 7920 7265 6665  by directly refe
+000381b0: 7265 6e63 696e 6720 616e 2065 7869 7374  rencing an exist
+000381c0: 696e 6720 6461 7461 6172 7261 793a 0a0a  ing dataarray:..
+000381d0: 2020 2020 2020 2020 3e3e 3e20 782e 6173          >>> x.as
+000381e0: 7369 676e 2874 656d 7065 7261 7475 7265  sign(temperature
+000381f0: 5f66 3d78 5b22 7465 6d70 6572 6174 7572  _f=x["temperatur
+00038200: 655f 6322 5d20 2a20 3920 2f20 3520 2b20  e_c"] * 9 / 5 + 
+00038210: 3332 290a 2020 2020 2020 2020 3c78 6172  32).        <xar
+00038220: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+00038230: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+00038240: 2020 2020 2020 2020 286c 6174 3a20 322c          (lat: 2,
+00038250: 206c 6f6e 3a20 3229 0a20 2020 2020 2020   lon: 2).       
+00038260: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+00038270: 2020 2020 2020 2020 2a20 6c61 7420 2020          * lat   
+00038280: 2020 2020 2020 2020 2028 6c61 7429 2069           (lat) i
+00038290: 6e74 3634 2031 3020 3230 0a20 2020 2020  nt64 10 20.     
+000382a0: 2020 2020 202a 206c 6f6e 2020 2020 2020       * lon      
+000382b0: 2020 2020 2020 286c 6f6e 2920 696e 7436        (lon) int6
+000382c0: 3420 3135 3020 3136 300a 2020 2020 2020  4 150 160.      
+000382d0: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
+000382e0: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
+000382f0: 6d70 6572 6174 7572 655f 6320 2028 6c61  mperature_c  (la
+00038300: 742c 206c 6f6e 2920 666c 6f61 7436 3420  t, lon) float64 
+00038310: 3130 2e39 3820 3134 2e33 2031 322e 3036  10.98 14.3 12.06
+00038320: 2031 302e 390a 2020 2020 2020 2020 2020   10.9.          
+00038330: 2020 7072 6563 6970 6974 6174 696f 6e20    precipitation 
+00038340: 2028 6c61 742c 206c 6f6e 2920 666c 6f61   (lat, lon) floa
+00038350: 7436 3420 302e 3432 3337 2030 2e36 3435  t64 0.4237 0.645
+00038360: 3920 302e 3433 3736 2030 2e38 3931 380a  9 0.4376 0.8918.
+00038370: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+00038380: 6572 6174 7572 655f 6620 2028 6c61 742c  erature_f  (lat,
+00038390: 206c 6f6e 2920 666c 6f61 7436 3420 3531   lon) float64 51
+000383a0: 2e37 3620 3537 2e37 3520 3533 2e37 2035  .76 57.75 53.7 5
+000383b0: 312e 3632 0a0a 2020 2020 2020 2020 2222  1.62..        ""
+000383c0: 220a 2020 2020 2020 2020 7661 7269 6162  ".        variab
+000383d0: 6c65 7320 3d20 6569 7468 6572 5f64 6963  les = either_dic
+000383e0: 745f 6f72 5f6b 7761 7267 7328 7661 7269  t_or_kwargs(vari
+000383f0: 6162 6c65 732c 2076 6172 6961 626c 6573  ables, variables
+00038400: 5f6b 7761 7267 732c 2022 6173 7369 676e  _kwargs, "assign
+00038410: 2229 0a20 2020 2020 2020 2064 6174 6120  ").        data 
+00038420: 3d20 7365 6c66 2e63 6f70 7928 290a 2020  = self.copy().  
+00038430: 2020 2020 2020 2320 646f 2061 6c6c 2063        # do all c
+00038440: 616c 6375 6c61 7469 6f6e 7320 6669 7273  alculations firs
+00038450: 742e 2e2e 0a20 2020 2020 2020 2072 6573  t....        res
+00038460: 756c 7473 3a20 436f 6572 6369 626c 654d  ults: CoercibleM
+00038470: 6170 7069 6e67 203d 2064 6174 612e 5f63  apping = data._c
+00038480: 616c 635f 6173 7369 676e 5f72 6573 756c  alc_assign_resul
+00038490: 7473 2876 6172 6961 626c 6573 290a 2020  ts(variables).  
+000384a0: 2020 2020 2020 6461 7461 2e63 6f6f 7264        data.coord
+000384b0: 732e 5f6d 6179 6265 5f64 726f 705f 6d75  s._maybe_drop_mu
+000384c0: 6c74 6969 6e64 6578 5f63 6f6f 7264 7328  ltiindex_coords(
+000384d0: 7365 7428 7265 7375 6c74 732e 6b65 7973  set(results.keys
+000384e0: 2829 2929 0a20 2020 2020 2020 2023 202e  ())).        # .
+000384f0: 2e2e 2061 6e64 2074 6865 6e20 6173 7369  .. and then assi
+00038500: 676e 0a20 2020 2020 2020 2064 6174 612e  gn.        data.
+00038510: 7570 6461 7465 2872 6573 756c 7473 290a  update(results).
+00038520: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00038530: 6174 610a 0a20 2020 2064 6566 2074 6f5f  ata..    def to_
+00038540: 6172 7261 7928 0a20 2020 2020 2020 2073  array(.        s
+00038550: 656c 662c 2064 696d 3a20 4861 7368 6162  elf, dim: Hashab
+00038560: 6c65 203d 2022 7661 7269 6162 6c65 222c  le = "variable",
+00038570: 206e 616d 653a 2048 6173 6861 626c 6520   name: Hashable 
+00038580: 7c20 4e6f 6e65 203d 204e 6f6e 650a 2020  | None = None.  
+00038590: 2020 2920 2d3e 2044 6174 6141 7272 6179    ) -> DataArray
+000385a0: 3a0a 2020 2020 2020 2020 2222 2243 6f6e  :.        """Con
+000385b0: 7665 7274 2074 6869 7320 6461 7461 7365  vert this datase
+000385c0: 7420 696e 746f 2061 6e20 7861 7272 6179  t into an xarray
+000385d0: 2e44 6174 6141 7272 6179 0a0a 2020 2020  .DataArray..    
+000385e0: 2020 2020 5468 6520 6461 7461 2076 6172      The data var
+000385f0: 6961 626c 6573 206f 6620 7468 6973 2064  iables of this d
+00038600: 6174 6173 6574 2077 696c 6c20 6265 2062  ataset will be b
+00038610: 726f 6164 6361 7374 2061 6761 696e 7374  roadcast against
+00038620: 2065 6163 6820 6f74 6865 720a 2020 2020   each other.    
+00038630: 2020 2020 616e 6420 7374 6163 6b65 6420      and stacked 
+00038640: 616c 6f6e 6720 7468 6520 6669 7273 7420  along the first 
+00038650: 6178 6973 206f 6620 7468 6520 6e65 7720  axis of the new 
+00038660: 6172 7261 792e 2041 6c6c 2063 6f6f 7264  array. All coord
+00038670: 696e 6174 6573 206f 660a 2020 2020 2020  inates of.      
+00038680: 2020 7468 6973 2064 6174 6173 6574 2077    this dataset w
+00038690: 696c 6c20 7265 6d61 696e 2063 6f6f 7264  ill remain coord
+000386a0: 696e 6174 6573 2e0a 0a20 2020 2020 2020  inates...       
+000386b0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+000386c0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+000386d0: 2020 2020 2020 2064 696d 203a 2048 6173         dim : Has
+000386e0: 6861 626c 652c 2064 6566 6175 6c74 3a20  hable, default: 
+000386f0: 2276 6172 6961 626c 6522 0a20 2020 2020  "variable".     
+00038700: 2020 2020 2020 204e 616d 6520 6f66 2074         Name of t
+00038710: 6865 206e 6577 2064 696d 656e 7369 6f6e  he new dimension
+00038720: 2e0a 2020 2020 2020 2020 6e61 6d65 203a  ..        name :
+00038730: 2048 6173 6861 626c 6520 6f72 204e 6f6e   Hashable or Non
+00038740: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
+00038750: 2020 2020 2020 2020 4e61 6d65 206f 6620          Name of 
+00038760: 7468 6520 6e65 7720 6461 7461 2061 7272  the new data arr
+00038770: 6179 2e0a 0a20 2020 2020 2020 2052 6574  ay...        Ret
+00038780: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+00038790: 2d2d 2d2d 0a20 2020 2020 2020 2061 7272  ----.        arr
+000387a0: 6179 203a 2078 6172 7261 792e 4461 7461  ay : xarray.Data
+000387b0: 4172 7261 790a 2020 2020 2020 2020 2222  Array.        ""
+000387c0: 220a 2020 2020 2020 2020 6672 6f6d 2078  ".        from x
+000387d0: 6172 7261 792e 636f 7265 2e64 6174 6161  array.core.dataa
+000387e0: 7272 6179 2069 6d70 6f72 7420 4461 7461  rray import Data
+000387f0: 4172 7261 790a 0a20 2020 2020 2020 2064  Array..        d
+00038800: 6174 615f 7661 7273 203d 205b 7365 6c66  ata_vars = [self
+00038810: 2e76 6172 6961 626c 6573 5b6b 5d20 666f  .variables[k] fo
+00038820: 7220 6b20 696e 2073 656c 662e 6461 7461  r k in self.data
+00038830: 5f76 6172 735d 0a20 2020 2020 2020 2062  _vars].        b
+00038840: 726f 6164 6361 7374 5f76 6172 7320 3d20  roadcast_vars = 
+00038850: 6272 6f61 6463 6173 745f 7661 7269 6162  broadcast_variab
+00038860: 6c65 7328 2a64 6174 615f 7661 7273 290a  les(*data_vars).
+00038870: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+00038880: 7563 6b5f 6172 7261 795f 6f70 732e 7374  uck_array_ops.st
+00038890: 6163 6b28 5b62 2e64 6174 6120 666f 7220  ack([b.data for 
+000388a0: 6220 696e 2062 726f 6164 6361 7374 5f76  b in broadcast_v
+000388b0: 6172 735d 2c20 6178 6973 3d30 290a 0a20  ars], axis=0).. 
+000388c0: 2020 2020 2020 2064 696d 7320 3d20 2864         dims = (d
+000388d0: 696d 2c29 202b 2062 726f 6164 6361 7374  im,) + broadcast
+000388e0: 5f76 6172 735b 305d 2e64 696d 730a 2020  _vars[0].dims.  
+000388f0: 2020 2020 2020 7661 7269 6162 6c65 203d        variable =
+00038900: 2056 6172 6961 626c 6528 6469 6d73 2c20   Variable(dims, 
+00038910: 6461 7461 2c20 7365 6c66 2e61 7474 7273  data, self.attrs
+00038920: 2c20 6661 7374 7061 7468 3d54 7275 6529  , fastpath=True)
+00038930: 0a0a 2020 2020 2020 2020 636f 6f72 6473  ..        coords
+00038940: 203d 207b 6b3a 2076 2e76 6172 6961 626c   = {k: v.variabl
+00038950: 6520 666f 7220 6b2c 2076 2069 6e20 7365  e for k, v in se
+00038960: 6c66 2e63 6f6f 7264 732e 6974 656d 7328  lf.coords.items(
+00038970: 297d 0a20 2020 2020 2020 2069 6e64 6578  )}.        index
+00038980: 6573 203d 2066 696c 7465 725f 696e 6465  es = filter_inde
+00038990: 7865 735f 6672 6f6d 5f63 6f6f 7264 7328  xes_from_coords(
+000389a0: 7365 6c66 2e5f 696e 6465 7865 732c 2073  self._indexes, s
+000389b0: 6574 2863 6f6f 7264 7329 290a 2020 2020  et(coords)).    
+000389c0: 2020 2020 6e65 775f 6469 6d5f 696e 6465      new_dim_inde
+000389d0: 7820 3d20 5061 6e64 6173 496e 6465 7828  x = PandasIndex(
+000389e0: 6c69 7374 2873 656c 662e 6461 7461 5f76  list(self.data_v
+000389f0: 6172 7329 2c20 6469 6d29 0a20 2020 2020  ars), dim).     
+00038a00: 2020 2069 6e64 6578 6573 5b64 696d 5d20     indexes[dim] 
+00038a10: 3d20 6e65 775f 6469 6d5f 696e 6465 780a  = new_dim_index.
+00038a20: 2020 2020 2020 2020 636f 6f72 6473 2e75          coords.u
+00038a30: 7064 6174 6528 6e65 775f 6469 6d5f 696e  pdate(new_dim_in
+00038a40: 6465 782e 6372 6561 7465 5f76 6172 6961  dex.create_varia
+00038a50: 626c 6573 2829 290a 0a20 2020 2020 2020  bles())..       
+00038a60: 2072 6574 7572 6e20 4461 7461 4172 7261   return DataArra
+00038a70: 792e 5f63 6f6e 7374 7275 6374 5f64 6972  y._construct_dir
+00038a80: 6563 7428 7661 7269 6162 6c65 2c20 636f  ect(variable, co
+00038a90: 6f72 6473 2c20 6e61 6d65 2c20 696e 6465  ords, name, inde
+00038aa0: 7865 7329 0a0a 2020 2020 6465 6620 5f6e  xes)..    def _n
+00038ab0: 6f72 6d61 6c69 7a65 5f64 696d 5f6f 7264  ormalize_dim_ord
+00038ac0: 6572 280a 2020 2020 2020 2020 7365 6c66  er(.        self
+00038ad0: 2c20 6469 6d5f 6f72 6465 723a 2053 6571  , dim_order: Seq
+00038ae0: 7565 6e63 655b 4861 7368 6162 6c65 5d20  uence[Hashable] 
+00038af0: 7c20 4e6f 6e65 203d 204e 6f6e 650a 2020  | None = None.  
+00038b00: 2020 2920 2d3e 2064 6963 745b 4861 7368    ) -> dict[Hash
+00038b10: 6162 6c65 2c20 696e 745d 3a0a 2020 2020  able, int]:.    
+00038b20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00038b30: 4368 6563 6b20 7468 6520 7661 6c69 6469  Check the validi
+00038b40: 7479 206f 6620 7468 6520 7072 6f76 6964  ty of the provid
+00038b50: 6564 2064 696d 656e 7369 6f6e 7320 6966  ed dimensions if
+00038b60: 2061 6e79 2061 6e64 2072 6574 7572 6e20   any and return 
+00038b70: 7468 6520 6d61 7070 696e 670a 2020 2020  the mapping.    
+00038b80: 2020 2020 6265 7477 6565 6e20 6469 6d65      between dime
+00038b90: 6e73 696f 6e20 6e61 6d65 2061 6e64 2074  nsion name and t
+00038ba0: 6865 6972 2073 697a 652e 0a0a 2020 2020  heir size...    
+00038bb0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00038bc0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00038bd0: 2d0a 2020 2020 2020 2020 6469 6d5f 6f72  -.        dim_or
+00038be0: 6465 723a 2053 6571 7565 6e63 6520 6f66  der: Sequence of
+00038bf0: 2048 6173 6861 626c 6520 6f72 204e 6f6e   Hashable or Non
+00038c00: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
+00038c10: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+00038c20: 6e20 6f72 6465 7220 746f 2076 616c 6964  n order to valid
+00038c30: 6174 6520 2864 6566 6175 6c74 2074 6f20  ate (default to 
+00038c40: 7468 6520 616c 7068 6162 6574 6963 616c  the alphabetical
+00038c50: 206f 7264 6572 2069 6620 4e6f 6e65 292e   order if None).
+00038c60: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00038c70: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00038c80: 2d0a 2020 2020 2020 2020 7265 7375 6c74  -.        result
+00038c90: 203a 2064 6963 745b 4861 7368 6162 6c65   : dict[Hashable
+00038ca0: 2c20 696e 745d 0a20 2020 2020 2020 2020  , int].         
+00038cb0: 2020 2056 616c 6964 6174 6564 2064 696d     Validated dim
+00038cc0: 656e 7369 6f6e 7320 6d61 7070 696e 672e  ensions mapping.
+00038cd0: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00038ce0: 2020 2020 2020 6966 2064 696d 5f6f 7264        if dim_ord
+00038cf0: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
+00038d00: 2020 2020 2020 2020 6469 6d5f 6f72 6465          dim_orde
+00038d10: 7220 3d20 6c69 7374 2873 656c 662e 6469  r = list(self.di
+00038d20: 6d73 290a 2020 2020 2020 2020 656c 6966  ms).        elif
+00038d30: 2073 6574 2864 696d 5f6f 7264 6572 2920   set(dim_order) 
+00038d40: 213d 2073 6574 2873 656c 662e 6469 6d73  != set(self.dims
+00038d50: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00038d60: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00038d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00038d80: 2022 6469 6d5f 6f72 6465 7220 7b7d 2064   "dim_order {} d
+00038d90: 6f65 7320 6e6f 7420 6d61 7463 6820 7468  oes not match th
+00038da0: 6520 7365 7420 6f66 2064 696d 656e 7369  e set of dimensi
+00038db0: 6f6e 7320 6f66 2074 6869 7320 220a 2020  ons of this ".  
+00038dc0: 2020 2020 2020 2020 2020 2020 2020 2244                "D
+00038dd0: 6174 6173 6574 3a20 7b7d 222e 666f 726d  ataset: {}".form
+00038de0: 6174 2864 696d 5f6f 7264 6572 2c20 6c69  at(dim_order, li
+00038df0: 7374 2873 656c 662e 6469 6d73 2929 0a20  st(self.dims)). 
+00038e00: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00038e10: 2020 2020 2020 6f72 6465 7265 645f 6469        ordered_di
+00038e20: 6d73 203d 207b 6b3a 2073 656c 662e 6469  ms = {k: self.di
+00038e30: 6d73 5b6b 5d20 666f 7220 6b20 696e 2064  ms[k] for k in d
+00038e40: 696d 5f6f 7264 6572 7d0a 0a20 2020 2020  im_order}..     
+00038e50: 2020 2072 6574 7572 6e20 6f72 6465 7265     return ordere
+00038e60: 645f 6469 6d73 0a0a 2020 2020 6465 6620  d_dims..    def 
+00038e70: 746f 5f70 616e 6461 7328 7365 6c66 2920  to_pandas(self) 
+00038e80: 2d3e 2070 642e 5365 7269 6573 207c 2070  -> pd.Series | p
+00038e90: 642e 4461 7461 4672 616d 653a 0a20 2020  d.DataFrame:.   
+00038ea0: 2020 2020 2022 2222 436f 6e76 6572 7420       """Convert 
+00038eb0: 7468 6973 2064 6174 6173 6574 2069 6e74  this dataset int
+00038ec0: 6f20 6120 7061 6e64 6173 206f 626a 6563  o a pandas objec
+00038ed0: 7420 7769 7468 6f75 7420 6368 616e 6769  t without changi
+00038ee0: 6e67 2074 6865 206e 756d 6265 7220 6f66  ng the number of
+00038ef0: 2064 696d 656e 7369 6f6e 732e 0a0a 2020   dimensions...  
+00038f00: 2020 2020 2020 5468 6520 7479 7065 206f        The type o
+00038f10: 6620 7468 6520 7265 7475 726e 6564 206f  f the returned o
+00038f20: 626a 6563 7420 6465 7065 6e64 7320 6f6e  bject depends on
+00038f30: 2074 6865 206e 756d 6265 7220 6f66 2044   the number of D
+00038f40: 6174 6173 6574 0a20 2020 2020 2020 2064  ataset.        d
+00038f50: 696d 656e 7369 6f6e 733a 0a0a 2020 2020  imensions:..    
+00038f60: 2020 2020 2a20 3044 202d 3e20 6070 616e      * 0D -> `pan
+00038f70: 6461 732e 5365 7269 6573 600a 2020 2020  das.Series`.    
+00038f80: 2020 2020 2a20 3144 202d 3e20 6070 616e      * 1D -> `pan
+00038f90: 6461 732e 4461 7461 4672 616d 6560 0a0a  das.DataFrame`..
+00038fa0: 2020 2020 2020 2020 4f6e 6c79 2077 6f72          Only wor
+00038fb0: 6b73 2066 6f72 2044 6174 6173 6574 7320  ks for Datasets 
+00038fc0: 7769 7468 2031 206f 7220 6665 7765 7220  with 1 or fewer 
+00038fd0: 6469 6d65 6e73 696f 6e73 2e0a 2020 2020  dimensions..    
+00038fe0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00038ff0: 6966 206c 656e 2873 656c 662e 6469 6d73  if len(self.dims
+00039000: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+00039010: 2020 2020 7265 7475 726e 2070 642e 5365      return pd.Se
+00039020: 7269 6573 287b 6b3a 2076 2e69 7465 6d28  ries({k: v.item(
+00039030: 2920 666f 7220 6b2c 2076 2069 6e20 7365  ) for k, v in se
+00039040: 6c66 2e69 7465 6d73 2829 7d29 0a20 2020  lf.items()}).   
+00039050: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
+00039060: 2e64 696d 7329 203d 3d20 313a 0a20 2020  .dims) == 1:.   
+00039070: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00039080: 7365 6c66 2e74 6f5f 6461 7461 6672 616d  self.to_datafram
+00039090: 6528 290a 2020 2020 2020 2020 7261 6973  e().        rais
+000390a0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+000390b0: 2020 2020 2020 2020 2020 2263 616e 6e6f            "canno
+000390c0: 7420 636f 6e76 6572 7420 4461 7461 7365  t convert Datase
+000390d0: 7473 2077 6974 6820 2573 2064 696d 656e  ts with %s dimen
+000390e0: 7369 6f6e 7320 696e 746f 2022 0a20 2020  sions into ".   
+000390f0: 2020 2020 2020 2020 2022 7061 6e64 6173           "pandas
+00039100: 206f 626a 6563 7473 2077 6974 686f 7574   objects without
+00039110: 2063 6861 6e67 696e 6720 7468 6520 6e75   changing the nu
+00039120: 6d62 6572 206f 6620 6469 6d65 6e73 696f  mber of dimensio
+00039130: 6e73 2e20 220a 2020 2020 2020 2020 2020  ns. ".          
+00039140: 2020 2250 6c65 6173 6520 7573 6520 4461    "Please use Da
+00039150: 7461 7365 742e 746f 5f64 6174 6166 7261  taset.to_datafra
+00039160: 6d65 2829 2069 6e73 7465 6164 2e22 2025  me() instead." %
+00039170: 206c 656e 2873 656c 662e 6469 6d73 290a   len(self.dims).
+00039180: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00039190: 6566 205f 746f 5f64 6174 6166 7261 6d65  ef _to_dataframe
+000391a0: 2873 656c 662c 206f 7264 6572 6564 5f64  (self, ordered_d
+000391b0: 696d 733a 204d 6170 7069 6e67 5b41 6e79  ims: Mapping[Any
+000391c0: 2c20 696e 745d 293a 0a20 2020 2020 2020  , int]):.       
+000391d0: 2063 6f6c 756d 6e73 203d 205b 6b20 666f   columns = [k fo
+000391e0: 7220 6b20 696e 2073 656c 662e 7661 7269  r k in self.vari
+000391f0: 6162 6c65 7320 6966 206b 206e 6f74 2069  ables if k not i
+00039200: 6e20 7365 6c66 2e64 696d 735d 0a20 2020  n self.dims].   
+00039210: 2020 2020 2064 6174 6120 3d20 5b0a 2020       data = [.  
+00039220: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00039230: 7661 7269 6162 6c65 735b 6b5d 2e73 6574  variables[k].set
+00039240: 5f64 696d 7328 6f72 6465 7265 645f 6469  _dims(ordered_di
+00039250: 6d73 292e 7661 6c75 6573 2e72 6573 6861  ms).values.resha
+00039260: 7065 282d 3129 0a20 2020 2020 2020 2020  pe(-1).         
+00039270: 2020 2066 6f72 206b 2069 6e20 636f 6c75     for k in colu
+00039280: 6d6e 730a 2020 2020 2020 2020 5d0a 2020  mns.        ].  
+00039290: 2020 2020 2020 696e 6465 7820 3d20 7365        index = se
+000392a0: 6c66 2e63 6f6f 7264 732e 746f 5f69 6e64  lf.coords.to_ind
+000392b0: 6578 285b 2a6f 7264 6572 6564 5f64 696d  ex([*ordered_dim
+000392c0: 735d 290a 2020 2020 2020 2020 7265 7475  s]).        retu
+000392d0: 726e 2070 642e 4461 7461 4672 616d 6528  rn pd.DataFrame(
+000392e0: 6469 6374 287a 6970 2863 6f6c 756d 6e73  dict(zip(columns
+000392f0: 2c20 6461 7461 2929 2c20 696e 6465 783d  , data)), index=
+00039300: 696e 6465 7829 0a0a 2020 2020 6465 6620  index)..    def 
+00039310: 746f 5f64 6174 6166 7261 6d65 2873 656c  to_dataframe(sel
+00039320: 662c 2064 696d 5f6f 7264 6572 3a20 5365  f, dim_order: Se
+00039330: 7175 656e 6365 5b48 6173 6861 626c 655d  quence[Hashable]
+00039340: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2920   | None = None) 
+00039350: 2d3e 2070 642e 4461 7461 4672 616d 653a  -> pd.DataFrame:
+00039360: 0a20 2020 2020 2020 2022 2222 436f 6e76  .        """Conv
+00039370: 6572 7420 7468 6973 2064 6174 6173 6574  ert this dataset
+00039380: 2069 6e74 6f20 6120 7061 6e64 6173 2e44   into a pandas.D
+00039390: 6174 6146 7261 6d65 2e0a 0a20 2020 2020  ataFrame...     
+000393a0: 2020 204e 6f6e 2d69 6e64 6578 2076 6172     Non-index var
+000393b0: 6961 626c 6573 2069 6e20 7468 6973 2064  iables in this d
+000393c0: 6174 6173 6574 2066 6f72 6d20 7468 6520  ataset form the 
+000393d0: 636f 6c75 6d6e 7320 6f66 2074 6865 0a20  columns of the. 
+000393e0: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
+000393f0: 2e20 5468 6520 4461 7461 4672 616d 6520  . The DataFrame 
+00039400: 6973 2069 6e64 6578 6564 2062 7920 7468  is indexed by th
+00039410: 6520 4361 7274 6573 6961 6e20 7072 6f64  e Cartesian prod
+00039420: 7563 7420 6f66 0a20 2020 2020 2020 2074  uct of.        t
+00039430: 6869 7320 6461 7461 7365 7427 7320 696e  his dataset's in
+00039440: 6469 6365 732e 0a0a 2020 2020 2020 2020  dices...        
+00039450: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00039460: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00039470: 2020 2020 2020 6469 6d5f 6f72 6465 723a        dim_order:
+00039480: 2053 6571 7565 6e63 6520 6f66 2048 6173   Sequence of Has
+00039490: 6861 626c 6520 6f72 204e 6f6e 652c 206f  hable or None, o
+000394a0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+000394b0: 2020 2020 4869 6572 6172 6368 6963 616c      Hierarchical
+000394c0: 2064 696d 656e 7369 6f6e 206f 7264 6572   dimension order
+000394d0: 2066 6f72 2074 6865 2072 6573 756c 7469   for the resulti
+000394e0: 6e67 2064 6174 6166 7261 6d65 2e20 416c  ng dataframe. Al
+000394f0: 6c0a 2020 2020 2020 2020 2020 2020 6172  l.            ar
+00039500: 7261 7973 2061 7265 2074 7261 6e73 706f  rays are transpo
+00039510: 7365 6420 746f 2074 6869 7320 6f72 6465  sed to this orde
+00039520: 7220 616e 6420 7468 656e 2077 7269 7474  r and then writt
+00039530: 656e 206f 7574 2061 7320 666c 6174 0a20  en out as flat. 
+00039540: 2020 2020 2020 2020 2020 2076 6563 746f             vecto
+00039550: 7273 2069 6e20 636f 6e74 6967 756f 7573  rs in contiguous
+00039560: 206f 7264 6572 2c20 736f 2074 6865 206c   order, so the l
+00039570: 6173 7420 6469 6d65 6e73 696f 6e20 696e  ast dimension in
+00039580: 2074 6869 7320 6c69 7374 0a20 2020 2020   this list.     
+00039590: 2020 2020 2020 2077 696c 6c20 6265 2063         will be c
+000395a0: 6f6e 7469 6775 6f75 7320 696e 2074 6865  ontiguous in the
+000395b0: 2072 6573 756c 7469 6e67 2044 6174 6146   resulting DataF
+000395c0: 7261 6d65 2e20 5468 6973 2068 6173 2061  rame. This has a
+000395d0: 206d 616a 6f72 0a20 2020 2020 2020 2020   major.         
+000395e0: 2020 2069 6e66 6c75 656e 6365 206f 6e20     influence on 
+000395f0: 7768 6963 6820 6f70 6572 6174 696f 6e73  which operations
+00039600: 2061 7265 2065 6666 6963 6965 6e74 206f   are efficient o
+00039610: 6e20 7468 6520 7265 7375 6c74 696e 670a  n the resulting.
+00039620: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00039630: 6672 616d 652e 0a0a 2020 2020 2020 2020  frame...        
+00039640: 2020 2020 4966 2070 726f 7669 6465 642c      If provided,
+00039650: 206d 7573 7420 696e 636c 7564 6520 616c   must include al
+00039660: 6c20 6469 6d65 6e73 696f 6e73 206f 6620  l dimensions of 
+00039670: 7468 6973 2064 6174 6173 6574 2e20 4279  this dataset. By
+00039680: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00039690: 6175 6c74 2c20 6469 6d65 6e73 696f 6e73  ault, dimensions
+000396a0: 2061 7265 2073 6f72 7465 6420 616c 7068   are sorted alph
+000396b0: 6162 6574 6963 616c 6c79 2e0a 0a20 2020  abetically...   
+000396c0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+000396d0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+000396e0: 2020 2020 2072 6573 756c 7420 3a20 4461       result : Da
+000396f0: 7461 4672 616d 650a 2020 2020 2020 2020  taFrame.        
+00039700: 2020 2020 4461 7461 7365 7420 6173 2061      Dataset as a
+00039710: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
+00039720: 652e 0a0a 2020 2020 2020 2020 2222 220a  e...        """.
+00039730: 0a20 2020 2020 2020 206f 7264 6572 6564  .        ordered
+00039740: 5f64 696d 7320 3d20 7365 6c66 2e5f 6e6f  _dims = self._no
+00039750: 726d 616c 697a 655f 6469 6d5f 6f72 6465  rmalize_dim_orde
+00039760: 7228 6469 6d5f 6f72 6465 723d 6469 6d5f  r(dim_order=dim_
+00039770: 6f72 6465 7229 0a0a 2020 2020 2020 2020  order)..        
+00039780: 7265 7475 726e 2073 656c 662e 5f74 6f5f  return self._to_
+00039790: 6461 7461 6672 616d 6528 6f72 6465 7265  dataframe(ordere
+000397a0: 645f 6469 6d73 3d6f 7264 6572 6564 5f64  d_dims=ordered_d
+000397b0: 696d 7329 0a0a 2020 2020 6465 6620 5f73  ims)..    def _s
+000397c0: 6574 5f73 7061 7273 655f 6461 7461 5f66  et_sparse_data_f
+000397d0: 726f 6d5f 6461 7461 6672 616d 6528 0a20  rom_dataframe(. 
+000397e0: 2020 2020 2020 2073 656c 662c 2069 6478         self, idx
+000397f0: 3a20 7064 2e49 6e64 6578 2c20 6172 7261  : pd.Index, arra
+00039800: 7973 3a20 6c69 7374 5b74 7570 6c65 5b48  ys: list[tuple[H
+00039810: 6173 6861 626c 652c 206e 702e 6e64 6172  ashable, np.ndar
+00039820: 7261 795d 5d2c 2064 696d 733a 2074 7570  ray]], dims: tup
+00039830: 6c65 0a20 2020 2029 202d 3e20 4e6f 6e65  le.    ) -> None
+00039840: 3a0a 2020 2020 2020 2020 6672 6f6d 2073  :.        from s
+00039850: 7061 7273 6520 696d 706f 7274 2043 4f4f  parse import COO
+00039860: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
+00039870: 6e73 7461 6e63 6528 6964 782c 2070 642e  nstance(idx, pd.
+00039880: 4d75 6c74 6949 6e64 6578 293a 0a20 2020  MultiIndex):.   
+00039890: 2020 2020 2020 2020 2063 6f6f 7264 7320           coords 
+000398a0: 3d20 6e70 2e73 7461 636b 285b 6e70 2e61  = np.stack([np.a
+000398b0: 7361 7272 6179 2863 6f64 6529 2066 6f72  sarray(code) for
+000398c0: 2063 6f64 6520 696e 2069 6478 2e63 6f64   code in idx.cod
+000398d0: 6573 5d2c 2061 7869 733d 3029 0a20 2020  es], axis=0).   
+000398e0: 2020 2020 2020 2020 2069 735f 736f 7274           is_sort
+000398f0: 6564 203d 2069 6478 2e69 735f 6d6f 6e6f  ed = idx.is_mono
+00039900: 746f 6e69 635f 696e 6372 6561 7369 6e67  tonic_increasing
+00039910: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
+00039920: 7065 203d 2074 7570 6c65 286c 6576 2e73  pe = tuple(lev.s
+00039930: 697a 6520 666f 7220 6c65 7620 696e 2069  ize for lev in i
+00039940: 6478 2e6c 6576 656c 7329 0a20 2020 2020  dx.levels).     
+00039950: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00039960: 2020 2020 2063 6f6f 7264 7320 3d20 6e70       coords = np
+00039970: 2e61 7261 6e67 6528 6964 782e 7369 7a65  .arange(idx.size
+00039980: 292e 7265 7368 6170 6528 312c 202d 3129  ).reshape(1, -1)
+00039990: 0a20 2020 2020 2020 2020 2020 2069 735f  .            is_
+000399a0: 736f 7274 6564 203d 2054 7275 650a 2020  sorted = True.  
+000399b0: 2020 2020 2020 2020 2020 7368 6170 6520            shape 
+000399c0: 3d20 2869 6478 2e73 697a 652c 290a 0a20  = (idx.size,).. 
+000399d0: 2020 2020 2020 2066 6f72 206e 616d 652c         for name,
+000399e0: 2076 616c 7565 7320 696e 2061 7272 6179   values in array
+000399f0: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
+00039a00: 2049 6e20 7669 7274 7561 6c6c 7920 616c   In virtually al
+00039a10: 6c20 7265 616c 2075 7365 2063 6173 6573  l real use cases
+00039a20: 2c20 7468 6520 7370 6172 7365 2061 7272  , the sparse arr
+00039a30: 6179 2077 696c 6c20 6e6f 7720 6861 7665  ay will now have
+00039a40: 0a20 2020 2020 2020 2020 2020 2023 206d  .            # m
+00039a50: 6973 7369 6e67 2076 616c 7565 7320 616e  issing values an
+00039a60: 6420 6e65 6564 7320 6120 6669 6c6c 5f76  d needs a fill_v
+00039a70: 616c 7565 2e20 466f 7220 636f 6e73 6973  alue. For consis
+00039a80: 7465 6e63 792c 2064 6f6e 2774 0a20 2020  tency, don't.   
+00039a90: 2020 2020 2020 2020 2023 2073 7065 6369           # speci
+00039aa0: 616c 2063 6173 6520 7468 6520 7261 7265  al case the rare
+00039ab0: 2065 7863 6570 7469 6f6e 7320 2865 2e67   exceptions (e.g
+00039ac0: 2e2c 2064 7479 7065 3d69 6e74 2077 6974  ., dtype=int wit
+00039ad0: 686f 7574 2061 0a20 2020 2020 2020 2020  hout a.         
+00039ae0: 2020 2023 204d 756c 7469 496e 6465 7829     # MultiIndex)
+00039af0: 2e0a 2020 2020 2020 2020 2020 2020 6474  ..            dt
+00039b00: 7970 652c 2066 696c 6c5f 7661 6c75 6520  ype, fill_value 
+00039b10: 3d20 7872 6474 7970 6573 2e6d 6179 6265  = xrdtypes.maybe
+00039b20: 5f70 726f 6d6f 7465 2876 616c 7565 732e  _promote(values.
+00039b30: 6474 7970 6529 0a20 2020 2020 2020 2020  dtype).         
+00039b40: 2020 2076 616c 7565 7320 3d20 6e70 2e61     values = np.a
+00039b50: 7361 7272 6179 2876 616c 7565 732c 2064  sarray(values, d
+00039b60: 7479 7065 3d64 7479 7065 290a 0a20 2020  type=dtype)..   
+00039b70: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
+00039b80: 434f 4f28 0a20 2020 2020 2020 2020 2020  COO(.           
+00039b90: 2020 2020 2063 6f6f 7264 732c 0a20 2020       coords,.   
+00039ba0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00039bb0: 7565 732c 0a20 2020 2020 2020 2020 2020  ues,.           
+00039bc0: 2020 2020 2073 6861 7065 2c0a 2020 2020       shape,.    
+00039bd0: 2020 2020 2020 2020 2020 2020 6861 735f              has_
+00039be0: 6475 706c 6963 6174 6573 3d46 616c 7365  duplicates=False
+00039bf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00039c00: 2020 736f 7274 6564 3d69 735f 736f 7274    sorted=is_sort
+00039c10: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+00039c20: 2020 2020 6669 6c6c 5f76 616c 7565 3d66      fill_value=f
+00039c30: 696c 6c5f 7661 6c75 652c 0a20 2020 2020  ill_value,.     
+00039c40: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00039c50: 2020 2020 2073 656c 665b 6e61 6d65 5d20       self[name] 
+00039c60: 3d20 2864 696d 732c 2064 6174 6129 0a0a  = (dims, data)..
+00039c70: 2020 2020 6465 6620 5f73 6574 5f6e 756d      def _set_num
+00039c80: 7079 5f64 6174 615f 6672 6f6d 5f64 6174  py_data_from_dat
+00039c90: 6166 7261 6d65 280a 2020 2020 2020 2020  aframe(.        
+00039ca0: 7365 6c66 2c20 6964 783a 2070 642e 496e  self, idx: pd.In
+00039cb0: 6465 782c 2061 7272 6179 733a 206c 6973  dex, arrays: lis
+00039cc0: 745b 7475 706c 655b 4861 7368 6162 6c65  t[tuple[Hashable
+00039cd0: 2c20 6e70 2e6e 6461 7272 6179 5d5d 2c20  , np.ndarray]], 
+00039ce0: 6469 6d73 3a20 7475 706c 650a 2020 2020  dims: tuple.    
+00039cf0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00039d00: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+00039d10: 616e 6365 2869 6478 2c20 7064 2e4d 756c  ance(idx, pd.Mul
+00039d20: 7469 496e 6465 7829 3a0a 2020 2020 2020  tiIndex):.      
+00039d30: 2020 2020 2020 666f 7220 6e61 6d65 2c20        for name, 
+00039d40: 7661 6c75 6573 2069 6e20 6172 7261 7973  values in arrays
+00039d50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00039d60: 2020 7365 6c66 5b6e 616d 655d 203d 2028    self[name] = (
+00039d70: 6469 6d73 2c20 7661 6c75 6573 290a 2020  dims, values).  
+00039d80: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00039d90: 0a0a 2020 2020 2020 2020 2320 4e42 3a20  ..        # NB: 
+00039da0: 7369 6d69 6c61 722c 206d 6f72 6520 6765  similar, more ge
+00039db0: 6e65 7261 6c20 6c6f 6769 632c 206e 6f77  neral logic, now
+00039dc0: 2065 7869 7374 7320 696e 0a20 2020 2020   exists in.     
+00039dd0: 2020 2023 2076 6172 6961 626c 652e 756e     # variable.un
+00039de0: 7374 6163 6b5f 6f6e 6365 3b20 7765 2063  stack_once; we c
+00039df0: 6f75 6c64 2063 6f6e 7369 6465 7220 636f  ould consider co
+00039e00: 6d62 696e 696e 6720 7468 656d 2061 7420  mbining them at 
+00039e10: 736f 6d65 0a20 2020 2020 2020 2023 2070  some.        # p
+00039e20: 6f69 6e74 2e0a 0a20 2020 2020 2020 2073  oint...        s
+00039e30: 6861 7065 203d 2074 7570 6c65 286c 6576  hape = tuple(lev
+00039e40: 2e73 697a 6520 666f 7220 6c65 7620 696e  .size for lev in
+00039e50: 2069 6478 2e6c 6576 656c 7329 0a20 2020   idx.levels).   
+00039e60: 2020 2020 2069 6e64 6578 6572 203d 2074       indexer = t
+00039e70: 7570 6c65 2869 6478 2e63 6f64 6573 290a  uple(idx.codes).
+00039e80: 0a20 2020 2020 2020 2023 2057 6520 616c  .        # We al
+00039e90: 7265 6164 7920 7665 7269 6669 6564 2074  ready verified t
+00039ea0: 6861 7420 7468 6520 4d75 6c74 6949 6e64  hat the MultiInd
+00039eb0: 6578 2068 6173 2061 6c6c 2075 6e69 7175  ex has all uniqu
+00039ec0: 6520 7661 6c75 6573 2c20 736f 0a20 2020  e values, so.   
+00039ed0: 2020 2020 2023 2074 6865 7265 2061 7265       # there are
+00039ee0: 206d 6973 7369 6e67 2076 616c 7565 7320   missing values 
+00039ef0: 6966 2061 6e64 206f 6e6c 7920 6966 2074  if and only if t
+00039f00: 6865 2073 697a 6520 6f66 206f 7574 7075  he size of outpu
+00039f10: 7420 6172 7261 7973 2069 730a 2020 2020  t arrays is.    
+00039f20: 2020 2020 2320 6c61 7267 6572 2074 6861      # larger tha
+00039f30: 7420 7468 6520 696e 6465 782e 0a20 2020  t the index..   
+00039f40: 2020 2020 206d 6973 7369 6e67 5f76 616c       missing_val
+00039f50: 7565 7320 3d20 6d61 7468 2e70 726f 6428  ues = math.prod(
+00039f60: 7368 6170 6529 203e 2069 6478 2e73 6861  shape) > idx.sha
+00039f70: 7065 5b30 5d0a 0a20 2020 2020 2020 2066  pe[0]..        f
+00039f80: 6f72 206e 616d 652c 2076 616c 7565 7320  or name, values 
+00039f90: 696e 2061 7272 6179 733a 0a20 2020 2020  in arrays:.     
+00039fa0: 2020 2020 2020 2023 204e 756d 5079 2069         # NumPy i
+00039fb0: 6e64 6578 696e 6720 6973 206d 7563 6820  ndexing is much 
+00039fc0: 6661 7374 6572 2074 6861 6e20 7573 696e  faster than usin
+00039fd0: 6720 4461 7461 4672 616d 652e 7265 696e  g DataFrame.rein
+00039fe0: 6465 7828 2920 746f 0a20 2020 2020 2020  dex() to.       
+00039ff0: 2020 2020 2023 2066 696c 6c20 696e 206d       # fill in m
+0003a000: 6973 7369 6e67 2076 616c 7565 733a 0a20  issing values:. 
+0003a010: 2020 2020 2020 2020 2020 2023 2068 7474             # htt
+0003a020: 7073 3a2f 2f73 7461 636b 6f76 6572 666c  ps://stackoverfl
+0003a030: 6f77 2e63 6f6d 2f61 2f33 3530 3439 3839  ow.com/a/3504989
+0003a040: 392f 3830 3937 3035 0a20 2020 2020 2020  9/809705.       
+0003a050: 2020 2020 2069 6620 6d69 7373 696e 675f       if missing_
+0003a060: 7661 6c75 6573 3a0a 2020 2020 2020 2020  values:.        
+0003a070: 2020 2020 2020 2020 6474 7970 652c 2066          dtype, f
+0003a080: 696c 6c5f 7661 6c75 6520 3d20 7872 6474  ill_value = xrdt
+0003a090: 7970 6573 2e6d 6179 6265 5f70 726f 6d6f  ypes.maybe_promo
+0003a0a0: 7465 2876 616c 7565 732e 6474 7970 6529  te(values.dtype)
+0003a0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a0c0: 2064 6174 6120 3d20 6e70 2e66 756c 6c28   data = np.full(
+0003a0d0: 7368 6170 652c 2066 696c 6c5f 7661 6c75  shape, fill_valu
+0003a0e0: 652c 2064 7479 7065 290a 2020 2020 2020  e, dtype).      
+0003a0f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0003a100: 2020 2020 2020 2020 2020 2020 2320 4966              # If
+0003a110: 2074 6865 7265 2061 7265 206e 6f20 6d69   there are no mi
+0003a120: 7373 696e 6720 7661 6c75 6573 2c20 6b65  ssing values, ke
+0003a130: 6570 2074 6865 2065 7869 7374 696e 6720  ep the existing 
+0003a140: 6474 7970 650a 2020 2020 2020 2020 2020  dtype.          
+0003a150: 2020 2020 2020 2320 696e 7374 6561 6420        # instead 
+0003a160: 6f66 2070 726f 6d6f 7469 6e67 2074 6f20  of promoting to 
+0003a170: 7375 7070 6f72 7420 4e41 2c20 652e 672e  support NA, e.g.
+0003a180: 2c20 6b65 6570 2069 6e74 6567 6572 0a20  , keep integer. 
+0003a190: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0003a1a0: 2063 6f6c 756d 6e73 2061 7320 696e 7465   columns as inte
+0003a1b0: 6765 7273 2e0a 2020 2020 2020 2020 2020  gers..          
+0003a1c0: 2020 2020 2020 2320 544f 444f 3a20 636f        # TODO: co
+0003a1d0: 6e73 6964 6572 2072 656d 6f76 696e 6720  nsider removing 
+0003a1e0: 7468 6973 2073 7065 6369 616c 2063 6173  this special cas
+0003a1f0: 652c 2077 6869 6368 2064 6f65 736e 2774  e, which doesn't
+0003a200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a210: 2023 2065 7869 7374 2066 6f72 2073 7061   # exist for spa
+0003a220: 7273 653d 5472 7565 2e0a 2020 2020 2020  rse=True..      
+0003a230: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+0003a240: 206e 702e 7a65 726f 7328 7368 6170 652c   np.zeros(shape,
+0003a250: 2076 616c 7565 732e 6474 7970 6529 0a20   values.dtype). 
+0003a260: 2020 2020 2020 2020 2020 2064 6174 615b             data[
+0003a270: 696e 6465 7865 725d 203d 2076 616c 7565  indexer] = value
+0003a280: 730a 2020 2020 2020 2020 2020 2020 7365  s.            se
+0003a290: 6c66 5b6e 616d 655d 203d 2028 6469 6d73  lf[name] = (dims
+0003a2a0: 2c20 6461 7461 290a 0a20 2020 2040 636c  , data)..    @cl
+0003a2b0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0003a2c0: 6620 6672 6f6d 5f64 6174 6166 7261 6d65  f from_dataframe
+0003a2d0: 280a 2020 2020 2020 2020 636c 733a 2074  (.        cls: t
+0003a2e0: 7970 655b 545f 4461 7461 7365 745d 2c20  ype[T_Dataset], 
+0003a2f0: 6461 7461 6672 616d 653a 2070 642e 4461  dataframe: pd.Da
+0003a300: 7461 4672 616d 652c 2073 7061 7273 653a  taFrame, sparse:
+0003a310: 2062 6f6f 6c20 3d20 4661 6c73 650a 2020   bool = False.  
+0003a320: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
+0003a330: 3a0a 2020 2020 2020 2020 2222 2243 6f6e  :.        """Con
+0003a340: 7665 7274 2061 2070 616e 6461 732e 4461  vert a pandas.Da
+0003a350: 7461 4672 616d 6520 696e 746f 2061 6e20  taFrame into an 
+0003a360: 7861 7272 6179 2e44 6174 6173 6574 0a0a  xarray.Dataset..
+0003a370: 2020 2020 2020 2020 4561 6368 2063 6f6c          Each col
+0003a380: 756d 6e20 7769 6c6c 2062 6520 636f 6e76  umn will be conv
+0003a390: 6572 7465 6420 696e 746f 2061 6e20 696e  erted into an in
+0003a3a0: 6465 7065 6e64 656e 7420 7661 7269 6162  dependent variab
+0003a3b0: 6c65 2069 6e20 7468 650a 2020 2020 2020  le in the.      
+0003a3c0: 2020 4461 7461 7365 742e 2049 6620 7468    Dataset. If th
+0003a3d0: 6520 6461 7461 6672 616d 6527 7320 696e  e dataframe's in
+0003a3e0: 6465 7820 6973 2061 204d 756c 7469 496e  dex is a MultiIn
+0003a3f0: 6465 782c 2069 7420 7769 6c6c 2062 6520  dex, it will be 
+0003a400: 6578 7061 6e64 6564 0a20 2020 2020 2020  expanded.       
+0003a410: 2069 6e74 6f20 6120 7465 6e73 6f72 2070   into a tensor p
+0003a420: 726f 6475 6374 206f 6620 6f6e 652d 6469  roduct of one-di
+0003a430: 6d65 6e73 696f 6e61 6c20 696e 6469 6365  mensional indice
+0003a440: 7320 2866 696c 6c69 6e67 2069 6e20 6d69  s (filling in mi
+0003a450: 7373 696e 670a 2020 2020 2020 2020 7661  ssing.        va
+0003a460: 6c75 6573 2077 6974 6820 4e61 4e29 2e20  lues with NaN). 
+0003a470: 5468 6973 206d 6574 686f 6420 7769 6c6c  This method will
+0003a480: 2070 726f 6475 6365 2061 2044 6174 6173   produce a Datas
+0003a490: 6574 2076 6572 7920 7369 6d69 6c61 7220  et very similar 
+0003a4a0: 746f 0a20 2020 2020 2020 2074 6861 7420  to.        that 
+0003a4b0: 6f6e 2077 6869 6368 2074 6865 2027 746f  on which the 'to
+0003a4c0: 5f64 6174 6166 7261 6d65 2720 6d65 7468  _dataframe' meth
+0003a4d0: 6f64 2077 6173 2063 616c 6c65 642c 2065  od was called, e
+0003a4e0: 7863 6570 7420 7769 7468 0a20 2020 2020  xcept with.     
+0003a4f0: 2020 2070 6f73 7369 626c 7920 7265 6475     possibly redu
+0003a500: 6e64 616e 7420 6469 6d65 6e73 696f 6e73  ndant dimensions
+0003a510: 2028 7369 6e63 6520 616c 6c20 6461 7461   (since all data
+0003a520: 7365 7420 7661 7269 6162 6c65 7320 7769  set variables wi
+0003a530: 6c6c 2068 6176 650a 2020 2020 2020 2020  ll have.        
+0003a540: 7468 6520 7361 6d65 2064 696d 656e 7369  the same dimensi
+0003a550: 6f6e 616c 6974 7929 0a0a 2020 2020 2020  onality)..      
+0003a560: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0003a570: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0003a580: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
+0003a590: 6520 3a20 4461 7461 4672 616d 650a 2020  e : DataFrame.  
+0003a5a0: 2020 2020 2020 2020 2020 4461 7461 4672            DataFr
+0003a5b0: 616d 6520 6672 6f6d 2077 6869 6368 2074  ame from which t
+0003a5c0: 6f20 636f 7079 2064 6174 6120 616e 6420  o copy data and 
+0003a5d0: 696e 6469 6365 732e 0a20 2020 2020 2020  indices..       
+0003a5e0: 2073 7061 7273 6520 3a20 626f 6f6c 2c20   sparse : bool, 
+0003a5f0: 6465 6661 756c 743a 2046 616c 7365 0a20  default: False. 
+0003a600: 2020 2020 2020 2020 2020 2049 6620 7472             If tr
+0003a610: 7565 2c20 6372 6561 7465 2061 2073 7061  ue, create a spa
+0003a620: 7273 6520 6172 7261 7973 2069 6e73 7465  rse arrays inste
+0003a630: 6164 206f 6620 6465 6e73 6520 6e75 6d70  ad of dense nump
+0003a640: 7920 6172 7261 7973 2e20 5468 6973 0a20  y arrays. This. 
+0003a650: 2020 2020 2020 2020 2020 2063 616e 2070             can p
+0003a660: 6f74 656e 7469 616c 6c79 2073 6176 6520  otentially save 
+0003a670: 6120 6c61 7267 6520 616d 6f75 6e74 206f  a large amount o
+0003a680: 6620 6d65 6d6f 7279 2069 6620 7468 6520  f memory if the 
+0003a690: 4461 7461 4672 616d 6520 6861 730a 2020  DataFrame has.  
+0003a6a0: 2020 2020 2020 2020 2020 6120 4d75 6c74            a Mult
+0003a6b0: 6949 6e64 6578 2e20 5265 7175 6972 6573  iIndex. Requires
+0003a6c0: 2074 6865 2073 7061 7273 6520 7061 636b   the sparse pack
+0003a6d0: 6167 6520 2873 7061 7273 652e 7079 6461  age (sparse.pyda
+0003a6e0: 7461 2e6f 7267 292e 0a0a 2020 2020 2020  ta.org)...      
+0003a6f0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+0003a700: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+0003a710: 2020 4e65 7720 4461 7461 7365 742e 0a0a    New Dataset...
+0003a720: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+0003a730: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0003a740: 2d0a 2020 2020 2020 2020 7861 7272 6179  -.        xarray
+0003a750: 2e44 6174 6141 7272 6179 2e66 726f 6d5f  .DataArray.from_
+0003a760: 7365 7269 6573 0a20 2020 2020 2020 2070  series.        p
+0003a770: 616e 6461 732e 4461 7461 4672 616d 652e  andas.DataFrame.
+0003a780: 746f 5f78 6172 7261 790a 2020 2020 2020  to_xarray.      
+0003a790: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
+0003a7a0: 544f 444f 3a20 4164 6420 616e 206f 7074  TODO: Add an opt
+0003a7b0: 696f 6e20 746f 2072 656d 6f76 6520 6469  ion to remove di
+0003a7c0: 6d65 6e73 696f 6e73 2061 6c6f 6e67 2077  mensions along w
+0003a7d0: 6869 6368 2074 6865 2076 6172 6961 626c  hich the variabl
+0003a7e0: 6573 0a20 2020 2020 2020 2023 2061 7265  es.        # are
+0003a7f0: 2063 6f6e 7374 616e 742c 2074 6f20 656e   constant, to en
+0003a800: 6162 6c65 2063 6f6e 7369 7374 656e 7420  able consistent 
+0003a810: 7365 7269 616c 697a 6174 696f 6e20 746f  serialization to
+0003a820: 2f66 726f 6d20 6120 6461 7461 6672 616d  /from a datafram
+0003a830: 652c 0a20 2020 2020 2020 2023 2065 7665  e,.        # eve
+0003a840: 6e20 6966 2073 6f6d 6520 7661 7269 6162  n if some variab
+0003a850: 6c65 7320 6861 7665 2064 6966 6665 7265  les have differe
+0003a860: 6e74 2064 696d 656e 7369 6f6e 616c 6974  nt dimensionalit
+0003a870: 792e 0a0a 2020 2020 2020 2020 6966 206e  y...        if n
+0003a880: 6f74 2064 6174 6166 7261 6d65 2e63 6f6c  ot dataframe.col
+0003a890: 756d 6e73 2e69 735f 756e 6971 7565 3a0a  umns.is_unique:.
+0003a8a0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0003a8b0: 6520 5661 6c75 6545 7272 6f72 2822 6361  e ValueError("ca
+0003a8c0: 6e6e 6f74 2063 6f6e 7665 7274 2044 6174  nnot convert Dat
+0003a8d0: 6146 7261 6d65 2077 6974 6820 6e6f 6e2d  aFrame with non-
+0003a8e0: 756e 6971 7565 2063 6f6c 756d 6e73 2229  unique columns")
+0003a8f0: 0a0a 2020 2020 2020 2020 6964 7820 3d20  ..        idx = 
+0003a900: 7265 6d6f 7665 5f75 6e75 7365 645f 6c65  remove_unused_le
+0003a910: 7665 6c73 5f63 6174 6567 6f72 6965 7328  vels_categories(
+0003a920: 6461 7461 6672 616d 652e 696e 6465 7829  dataframe.index)
+0003a930: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
+0003a940: 6e73 7461 6e63 6528 6964 782c 2070 642e  nstance(idx, pd.
+0003a950: 4d75 6c74 6949 6e64 6578 2920 616e 6420  MultiIndex) and 
+0003a960: 6e6f 7420 6964 782e 6973 5f75 6e69 7175  not idx.is_uniqu
+0003a970: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0003a980: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0003a990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a9a0: 2022 6361 6e6e 6f74 2063 6f6e 7665 7274   "cannot convert
+0003a9b0: 2061 2044 6174 6146 7261 6d65 2077 6974   a DataFrame wit
+0003a9c0: 6820 6120 6e6f 6e2d 756e 6971 7565 204d  h a non-unique M
+0003a9d0: 756c 7469 496e 6465 7820 696e 746f 2078  ultiIndex into x
+0003a9e0: 6172 7261 7922 0a20 2020 2020 2020 2020  array".         
+0003a9f0: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+0003aa00: 4361 7374 2074 6f20 6120 4e75 6d50 7920  Cast to a NumPy 
+0003aa10: 6172 7261 7920 6669 7273 742c 2069 6e20  array first, in 
+0003aa20: 6361 7365 2074 6865 2053 6572 6965 7320  case the Series 
+0003aa30: 6973 2061 2070 616e 6461 7320 4578 7465  is a pandas Exte
+0003aa40: 6e73 696f 6e0a 2020 2020 2020 2020 2320  nsion.        # 
+0003aa50: 6172 7261 7920 2877 6869 6368 2064 6f65  array (which doe
+0003aa60: 736e 2774 2068 6176 6520 6120 7661 6c69  sn't have a vali
+0003aa70: 6420 4e75 6d50 7920 6474 7970 6529 0a20  d NumPy dtype). 
+0003aa80: 2020 2020 2020 2023 2054 4f44 4f3a 2061         # TODO: a
+0003aa90: 6c6c 6f77 2075 7365 7273 2074 6f20 636f  llow users to co
+0003aaa0: 6e74 726f 6c20 686f 7720 7468 6973 2063  ntrol how this c
+0003aab0: 6173 7469 6e67 2068 6170 7065 6e73 2c20  asting happens, 
+0003aac0: 652e 672e 2c20 6279 0a20 2020 2020 2020  e.g., by.       
+0003aad0: 2023 2066 6f72 7761 7264 696e 6720 6172   # forwarding ar
+0003aae0: 6775 6d65 6e74 7320 746f 2070 616e 6461  guments to panda
+0003aaf0: 732e 5365 7269 6573 2e74 6f5f 6e75 6d70  s.Series.to_nump
+0003ab00: 793f 0a20 2020 2020 2020 2061 7272 6179  y?.        array
+0003ab10: 7320 3d20 5b28 6b2c 206e 702e 6173 6172  s = [(k, np.asar
+0003ab20: 7261 7928 7629 2920 666f 7220 6b2c 2076  ray(v)) for k, v
+0003ab30: 2069 6e20 6461 7461 6672 616d 652e 6974   in dataframe.it
+0003ab40: 656d 7328 295d 0a0a 2020 2020 2020 2020  ems()]..        
+0003ab50: 696e 6465 7865 733a 2064 6963 745b 4861  indexes: dict[Ha
+0003ab60: 7368 6162 6c65 2c20 496e 6465 785d 203d  shable, Index] =
+0003ab70: 207b 7d0a 2020 2020 2020 2020 696e 6465   {}.        inde
+0003ab80: 785f 7661 7273 3a20 6469 6374 5b48 6173  x_vars: dict[Has
+0003ab90: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
+0003aba0: 203d 207b 7d0a 0a20 2020 2020 2020 2069   = {}..        i
+0003abb0: 6620 6973 696e 7374 616e 6365 2869 6478  f isinstance(idx
+0003abc0: 2c20 7064 2e4d 756c 7469 496e 6465 7829  , pd.MultiIndex)
+0003abd0: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
+0003abe0: 6d73 203d 2074 7570 6c65 280a 2020 2020  ms = tuple(.    
+0003abf0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0003ac00: 2069 6620 6e61 6d65 2069 7320 6e6f 7420   if name is not 
+0003ac10: 4e6f 6e65 2065 6c73 6520 226c 6576 656c  None else "level
+0003ac20: 5f25 6922 2025 206e 0a20 2020 2020 2020  _%i" % n.       
+0003ac30: 2020 2020 2020 2020 2066 6f72 206e 2c20           for n, 
+0003ac40: 6e61 6d65 2069 6e20 656e 756d 6572 6174  name in enumerat
+0003ac50: 6528 6964 782e 6e61 6d65 7329 0a20 2020  e(idx.names).   
+0003ac60: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0003ac70: 2020 2020 2020 2066 6f72 2064 696d 2c20         for dim, 
+0003ac80: 6c65 7620 696e 207a 6970 2864 696d 732c  lev in zip(dims,
+0003ac90: 2069 6478 2e6c 6576 656c 7329 3a0a 2020   idx.levels):.  
+0003aca0: 2020 2020 2020 2020 2020 2020 2020 7872                xr
+0003acb0: 5f69 6478 203d 2050 616e 6461 7349 6e64  _idx = PandasInd
+0003acc0: 6578 286c 6576 2c20 6469 6d29 0a20 2020  ex(lev, dim).   
+0003acd0: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+0003ace0: 6578 6573 5b64 696d 5d20 3d20 7872 5f69  exes[dim] = xr_i
+0003acf0: 6478 0a20 2020 2020 2020 2020 2020 2020  dx.             
+0003ad00: 2020 2069 6e64 6578 5f76 6172 732e 7570     index_vars.up
+0003ad10: 6461 7465 2878 725f 6964 782e 6372 6561  date(xr_idx.crea
+0003ad20: 7465 5f76 6172 6961 626c 6573 2829 290a  te_variables()).
+0003ad30: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0003ad40: 2020 2020 2020 2020 2020 696e 6465 785f            index_
+0003ad50: 6e61 6d65 203d 2069 6478 2e6e 616d 6520  name = idx.name 
+0003ad60: 6966 2069 6478 2e6e 616d 6520 6973 206e  if idx.name is n
+0003ad70: 6f74 204e 6f6e 6520 656c 7365 2022 696e  ot None else "in
+0003ad80: 6465 7822 0a20 2020 2020 2020 2020 2020  dex".           
+0003ad90: 2064 696d 7320 3d20 2869 6e64 6578 5f6e   dims = (index_n
+0003ada0: 616d 652c 290a 2020 2020 2020 2020 2020  ame,).          
+0003adb0: 2020 7872 5f69 6478 203d 2050 616e 6461    xr_idx = Panda
+0003adc0: 7349 6e64 6578 2869 6478 2c20 696e 6465  sIndex(idx, inde
+0003add0: 785f 6e61 6d65 290a 2020 2020 2020 2020  x_name).        
+0003ade0: 2020 2020 696e 6465 7865 735b 696e 6465      indexes[inde
+0003adf0: 785f 6e61 6d65 5d20 3d20 7872 5f69 6478  x_name] = xr_idx
+0003ae00: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+0003ae10: 6578 5f76 6172 732e 7570 6461 7465 2878  ex_vars.update(x
+0003ae20: 725f 6964 782e 6372 6561 7465 5f76 6172  r_idx.create_var
+0003ae30: 6961 626c 6573 2829 290a 0a20 2020 2020  iables())..     
+0003ae40: 2020 206f 626a 203d 2063 6c73 2e5f 636f     obj = cls._co
+0003ae50: 6e73 7472 7563 745f 6469 7265 6374 2869  nstruct_direct(i
+0003ae60: 6e64 6578 5f76 6172 732c 2073 6574 2869  ndex_vars, set(i
+0003ae70: 6e64 6578 5f76 6172 7329 2c20 696e 6465  ndex_vars), inde
+0003ae80: 7865 733d 696e 6465 7865 7329 0a0a 2020  xes=indexes)..  
+0003ae90: 2020 2020 2020 6966 2073 7061 7273 653a        if sparse:
+0003aea0: 0a20 2020 2020 2020 2020 2020 206f 626a  .            obj
+0003aeb0: 2e5f 7365 745f 7370 6172 7365 5f64 6174  ._set_sparse_dat
+0003aec0: 615f 6672 6f6d 5f64 6174 6166 7261 6d65  a_from_dataframe
+0003aed0: 2869 6478 2c20 6172 7261 7973 2c20 6469  (idx, arrays, di
+0003aee0: 6d73 290a 2020 2020 2020 2020 656c 7365  ms).        else
+0003aef0: 3a0a 2020 2020 2020 2020 2020 2020 6f62  :.            ob
+0003af00: 6a2e 5f73 6574 5f6e 756d 7079 5f64 6174  j._set_numpy_dat
+0003af10: 615f 6672 6f6d 5f64 6174 6166 7261 6d65  a_from_dataframe
+0003af20: 2869 6478 2c20 6172 7261 7973 2c20 6469  (idx, arrays, di
+0003af30: 6d73 290a 2020 2020 2020 2020 7265 7475  ms).        retu
+0003af40: 726e 206f 626a 0a0a 2020 2020 6465 6620  rn obj..    def 
+0003af50: 746f 5f64 6173 6b5f 6461 7461 6672 616d  to_dask_datafram
+0003af60: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
+0003af70: 2064 696d 5f6f 7264 6572 3a20 5365 7175   dim_order: Sequ
+0003af80: 656e 6365 5b48 6173 6861 626c 655d 207c  ence[Hashable] |
+0003af90: 204e 6f6e 6520 3d20 4e6f 6e65 2c20 7365   None = None, se
+0003afa0: 745f 696e 6465 783a 2062 6f6f 6c20 3d20  t_index: bool = 
+0003afb0: 4661 6c73 650a 2020 2020 2920 2d3e 2044  False.    ) -> D
+0003afc0: 6173 6b44 6174 6146 7261 6d65 3a0a 2020  askDataFrame:.  
+0003afd0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0003afe0: 2020 436f 6e76 6572 7420 7468 6973 2064    Convert this d
+0003aff0: 6174 6173 6574 2069 6e74 6f20 6120 6461  ataset into a da
+0003b000: 736b 2e64 6174 6166 7261 6d65 2e44 6174  sk.dataframe.Dat
+0003b010: 6146 7261 6d65 2e0a 0a20 2020 2020 2020  aFrame...       
+0003b020: 2054 6865 2064 696d 656e 7369 6f6e 732c   The dimensions,
+0003b030: 2063 6f6f 7264 696e 6174 6573 2061 6e64   coordinates and
+0003b040: 2064 6174 6120 7661 7269 6162 6c65 7320   data variables 
+0003b050: 696e 2074 6869 7320 6461 7461 7365 7420  in this dataset 
+0003b060: 666f 726d 0a20 2020 2020 2020 2074 6865  form.        the
+0003b070: 2063 6f6c 756d 6e73 206f 6620 7468 6520   columns of the 
+0003b080: 4461 7461 4672 616d 652e 0a0a 2020 2020  DataFrame...    
+0003b090: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0003b0a0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0003b0b0: 2d0a 2020 2020 2020 2020 6469 6d5f 6f72  -.        dim_or
+0003b0c0: 6465 7220 3a20 6c69 7374 2c20 6f70 7469  der : list, opti
+0003b0d0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+0003b0e0: 2048 6965 7261 7263 6869 6361 6c20 6469   Hierarchical di
+0003b0f0: 6d65 6e73 696f 6e20 6f72 6465 7220 666f  mension order fo
+0003b100: 7220 7468 6520 7265 7375 6c74 696e 6720  r the resulting 
+0003b110: 6461 7461 6672 616d 652e 2041 6c6c 0a20  dataframe. All. 
+0003b120: 2020 2020 2020 2020 2020 2061 7272 6179             array
+0003b130: 7320 6172 6520 7472 616e 7370 6f73 6564  s are transposed
+0003b140: 2074 6f20 7468 6973 206f 7264 6572 2061   to this order a
+0003b150: 6e64 2074 6865 6e20 7772 6974 7465 6e20  nd then written 
+0003b160: 6f75 7420 6173 2066 6c61 740a 2020 2020  out as flat.    
+0003b170: 2020 2020 2020 2020 7665 6374 6f72 7320          vectors 
+0003b180: 696e 2063 6f6e 7469 6775 6f75 7320 6f72  in contiguous or
+0003b190: 6465 722c 2073 6f20 7468 6520 6c61 7374  der, so the last
+0003b1a0: 2064 696d 656e 7369 6f6e 2069 6e20 7468   dimension in th
+0003b1b0: 6973 206c 6973 740a 2020 2020 2020 2020  is list.        
+0003b1c0: 2020 2020 7769 6c6c 2062 6520 636f 6e74      will be cont
+0003b1d0: 6967 756f 7573 2069 6e20 7468 6520 7265  iguous in the re
+0003b1e0: 7375 6c74 696e 6720 4461 7461 4672 616d  sulting DataFram
+0003b1f0: 652e 2054 6869 7320 6861 7320 6120 6d61  e. This has a ma
+0003b200: 6a6f 720a 2020 2020 2020 2020 2020 2020  jor.            
+0003b210: 696e 666c 7565 6e63 6520 6f6e 2077 6869  influence on whi
+0003b220: 6368 206f 7065 7261 7469 6f6e 7320 6172  ch operations ar
+0003b230: 6520 6566 6669 6369 656e 7420 6f6e 2074  e efficient on t
+0003b240: 6865 2072 6573 756c 7469 6e67 2064 6173  he resulting das
+0003b250: 6b0a 2020 2020 2020 2020 2020 2020 6461  k.            da
+0003b260: 7461 6672 616d 652e 0a0a 2020 2020 2020  taframe...      
+0003b270: 2020 2020 2020 4966 2070 726f 7669 6465        If provide
+0003b280: 642c 206d 7573 7420 696e 636c 7564 6520  d, must include 
+0003b290: 616c 6c20 6469 6d65 6e73 696f 6e73 206f  all dimensions o
+0003b2a0: 6620 7468 6973 2064 6174 6173 6574 2e20  f this dataset. 
+0003b2b0: 4279 0a20 2020 2020 2020 2020 2020 2064  By.            d
+0003b2c0: 6566 6175 6c74 2c20 6469 6d65 6e73 696f  efault, dimensio
+0003b2d0: 6e73 2061 7265 2073 6f72 7465 6420 616c  ns are sorted al
+0003b2e0: 7068 6162 6574 6963 616c 6c79 2e0a 2020  phabetically..  
+0003b2f0: 2020 2020 2020 7365 745f 696e 6465 7820        set_index 
+0003b300: 3a20 626f 6f6c 2c20 6465 6661 756c 743a  : bool, default:
+0003b310: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+0003b320: 2020 2049 6620 7365 745f 696e 6465 783d     If set_index=
+0003b330: 5472 7565 2c20 7468 6520 6461 736b 2044  True, the dask D
+0003b340: 6174 6146 7261 6d65 2069 7320 696e 6465  ataFrame is inde
+0003b350: 7865 6420 6279 2074 6869 7320 6461 7461  xed by this data
+0003b360: 7365 7427 730a 2020 2020 2020 2020 2020  set's.          
+0003b370: 2020 636f 6f72 6469 6e61 7465 2e20 5369    coordinate. Si
+0003b380: 6e63 6520 6461 736b 2044 6174 6146 7261  nce dask DataFra
+0003b390: 6d65 7320 646f 206e 6f74 2073 7570 706f  mes do not suppo
+0003b3a0: 7274 206d 756c 7469 2d69 6e64 6578 6573  rt multi-indexes
+0003b3b0: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
+0003b3c0: 745f 696e 6465 7820 6f6e 6c79 2077 6f72  t_index only wor
+0003b3d0: 6b73 2069 6620 7468 6520 6461 7461 7365  ks if the datase
+0003b3e0: 7420 6f6e 6c79 2063 6f6e 7461 696e 7320  t only contains 
+0003b3f0: 6f6e 6520 6469 6d65 6e73 696f 6e2e 0a0a  one dimension...
+0003b400: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+0003b410: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+0003b420: 2020 2020 2020 2020 6461 736b 2e64 6174          dask.dat
+0003b430: 6166 7261 6d65 2e44 6174 6146 7261 6d65  aframe.DataFrame
+0003b440: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0003b450: 2020 2020 2020 696d 706f 7274 2064 6173        import das
+0003b460: 6b2e 6172 7261 7920 6173 2064 610a 2020  k.array as da.  
+0003b470: 2020 2020 2020 696d 706f 7274 2064 6173        import das
+0003b480: 6b2e 6461 7461 6672 616d 6520 6173 2064  k.dataframe as d
+0003b490: 640a 0a20 2020 2020 2020 206f 7264 6572  d..        order
+0003b4a0: 6564 5f64 696d 7320 3d20 7365 6c66 2e5f  ed_dims = self._
+0003b4b0: 6e6f 726d 616c 697a 655f 6469 6d5f 6f72  normalize_dim_or
+0003b4c0: 6465 7228 6469 6d5f 6f72 6465 723d 6469  der(dim_order=di
+0003b4d0: 6d5f 6f72 6465 7229 0a0a 2020 2020 2020  m_order)..      
+0003b4e0: 2020 636f 6c75 6d6e 7320 3d20 6c69 7374    columns = list
+0003b4f0: 286f 7264 6572 6564 5f64 696d 7329 0a20  (ordered_dims). 
+0003b500: 2020 2020 2020 2063 6f6c 756d 6e73 2e65         columns.e
+0003b510: 7874 656e 6428 6b20 666f 7220 6b20 696e  xtend(k for k in
+0003b520: 2073 656c 662e 636f 6f72 6473 2069 6620   self.coords if 
+0003b530: 6b20 6e6f 7420 696e 2073 656c 662e 6469  k not in self.di
+0003b540: 6d73 290a 2020 2020 2020 2020 636f 6c75  ms).        colu
+0003b550: 6d6e 732e 6578 7465 6e64 2873 656c 662e  mns.extend(self.
+0003b560: 6461 7461 5f76 6172 7329 0a0a 2020 2020  data_vars)..    
+0003b570: 2020 2020 7365 7269 6573 5f6c 6973 7420      series_list 
+0003b580: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+0003b590: 206e 616d 6520 696e 2063 6f6c 756d 6e73   name in columns
+0003b5a0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+0003b5b0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0003b5c0: 2020 2076 6172 203d 2073 656c 662e 7661     var = self.va
+0003b5d0: 7269 6162 6c65 735b 6e61 6d65 5d0a 2020  riables[name].  
+0003b5e0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0003b5f0: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
+0003b600: 2020 2020 2020 2020 2020 2023 2064 696d             # dim
+0003b610: 656e 7369 6f6e 2077 6974 686f 7574 2061  ension without a
+0003b620: 206d 6174 6368 696e 6720 636f 6f72 6469   matching coordi
+0003b630: 6e61 7465 0a20 2020 2020 2020 2020 2020  nate.           
+0003b640: 2020 2020 2073 697a 6520 3d20 7365 6c66       size = self
+0003b650: 2e64 696d 735b 6e61 6d65 5d0a 2020 2020  .dims[name].    
+0003b660: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0003b670: 203d 2064 612e 6172 616e 6765 2873 697a   = da.arange(siz
+0003b680: 652c 2063 6875 6e6b 733d 7369 7a65 2c20  e, chunks=size, 
+0003b690: 6474 7970 653d 6e70 2e69 6e74 3634 290a  dtype=np.int64).
+0003b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b6b0: 7661 7220 3d20 5661 7269 6162 6c65 2828  var = Variable((
+0003b6c0: 6e61 6d65 2c29 2c20 6461 7461 290a 0a20  name,), data).. 
+0003b6d0: 2020 2020 2020 2020 2020 2023 2049 6e64             # Ind
+0003b6e0: 6578 5661 7269 6162 6c65 206f 626a 6563  exVariable objec
+0003b6f0: 7473 2068 6176 6520 6120 6475 6d6d 7920  ts have a dummy 
+0003b700: 2e63 6875 6e6b 2829 206d 6574 686f 640a  .chunk() method.
+0003b710: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0003b720: 7369 6e73 7461 6e63 6528 7661 722c 2049  sinstance(var, I
+0003b730: 6e64 6578 5661 7269 6162 6c65 293a 0a20  ndexVariable):. 
+0003b740: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0003b750: 6172 203d 2076 6172 2e74 6f5f 6261 7365  ar = var.to_base
+0003b760: 5f76 6172 6961 626c 6528 290a 0a20 2020  _variable()..   
+0003b770: 2020 2020 2020 2020 2023 204d 616b 6520           # Make 
+0003b780: 7375 7265 2076 6172 2069 7320 6120 6461  sure var is a da
+0003b790: 736b 2061 7272 6179 2c20 6f74 6865 7277  sk array, otherw
+0003b7a0: 6973 6520 7468 6520 6172 7261 7920 6361  ise the array ca
+0003b7b0: 6e20 6265 636f 6d65 2074 6f6f 206c 6172  n become too lar
+0003b7c0: 6765 0a20 2020 2020 2020 2020 2020 2023  ge.            #
+0003b7d0: 2077 6865 6e20 6974 2069 7320 6272 6f61   when it is broa
+0003b7e0: 6463 6173 7465 6420 746f 2073 6576 6572  dcasted to sever
+0003b7f0: 616c 2064 696d 656e 7369 6f6e 733a 0a20  al dimensions:. 
+0003b800: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0003b810: 7420 6973 5f64 7563 6b5f 6461 736b 5f61  t is_duck_dask_a
+0003b820: 7272 6179 2876 6172 2e5f 6461 7461 293a  rray(var._data):
+0003b830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003b840: 2076 6172 203d 2076 6172 2e63 6875 6e6b   var = var.chunk
+0003b850: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+0003b860: 6461 736b 5f61 7272 6179 203d 2076 6172  dask_array = var
+0003b870: 2e73 6574 5f64 696d 7328 6f72 6465 7265  .set_dims(ordere
+0003b880: 645f 6469 6d73 292e 6368 756e 6b28 7365  d_dims).chunk(se
+0003b890: 6c66 2e63 6875 6e6b 7329 2e64 6174 610a  lf.chunks).data.
+0003b8a0: 2020 2020 2020 2020 2020 2020 7365 7269              seri
+0003b8b0: 6573 203d 2064 642e 6672 6f6d 5f61 7272  es = dd.from_arr
+0003b8c0: 6179 2864 6173 6b5f 6172 7261 792e 7265  ay(dask_array.re
+0003b8d0: 7368 6170 6528 2d31 292c 2063 6f6c 756d  shape(-1), colum
+0003b8e0: 6e73 3d5b 6e61 6d65 5d29 0a20 2020 2020  ns=[name]).     
+0003b8f0: 2020 2020 2020 2073 6572 6965 735f 6c69         series_li
+0003b900: 7374 2e61 7070 656e 6428 7365 7269 6573  st.append(series
+0003b910: 290a 0a20 2020 2020 2020 2064 6620 3d20  )..        df = 
+0003b920: 6464 2e63 6f6e 6361 7428 7365 7269 6573  dd.concat(series
+0003b930: 5f6c 6973 742c 2061 7869 733d 3129 0a0a  _list, axis=1)..
+0003b940: 2020 2020 2020 2020 6966 2073 6574 5f69          if set_i
+0003b950: 6e64 6578 3a0a 2020 2020 2020 2020 2020  ndex:.          
+0003b960: 2020 6469 6d5f 6f72 6465 7220 3d20 5b2a    dim_order = [*
+0003b970: 6f72 6465 7265 645f 6469 6d73 5d0a 0a20  ordered_dims].. 
+0003b980: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0003b990: 6e28 6469 6d5f 6f72 6465 7229 203d 3d20  n(dim_order) == 
+0003b9a0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+0003b9b0: 2020 2028 6469 6d2c 2920 3d20 6469 6d5f     (dim,) = dim_
+0003b9c0: 6f72 6465 720a 2020 2020 2020 2020 2020  order.          
+0003b9d0: 2020 2020 2020 6466 203d 2064 662e 7365        df = df.se
+0003b9e0: 745f 696e 6465 7828 6469 6d29 0a20 2020  t_index(dim).   
+0003b9f0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0003ba00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0003ba10: 2074 7269 6767 6572 7320 616e 2065 7272   triggers an err
+0003ba20: 6f72 2061 626f 7574 206d 756c 7469 2d69  or about multi-i
+0003ba30: 6e64 6578 6573 2c20 6576 656e 2069 6620  ndexes, even if 
+0003ba40: 6f6e 6c79 206f 6e65 0a20 2020 2020 2020  only one.       
+0003ba50: 2020 2020 2020 2020 2023 2064 696d 656e           # dimen
+0003ba60: 7369 6f6e 2069 7320 7061 7373 6564 0a20  sion is passed. 
+0003ba70: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0003ba80: 6620 3d20 6466 2e73 6574 5f69 6e64 6578  f = df.set_index
+0003ba90: 2864 696d 5f6f 7264 6572 290a 0a20 2020  (dim_order)..   
+0003baa0: 2020 2020 2072 6574 7572 6e20 6466 0a0a       return df..
+0003bab0: 2020 2020 6465 6620 746f 5f64 6963 7428      def to_dict(
+0003bac0: 7365 6c66 2c20 6461 7461 3a20 626f 6f6c  self, data: bool
+0003bad0: 203d 2054 7275 652c 2065 6e63 6f64 696e   = True, encodin
+0003bae0: 673a 2062 6f6f 6c20 3d20 4661 6c73 6529  g: bool = False)
+0003baf0: 202d 3e20 6469 6374 5b73 7472 2c20 416e   -> dict[str, An
+0003bb00: 795d 3a0a 2020 2020 2020 2020 2222 220a  y]:.        """.
+0003bb10: 2020 2020 2020 2020 436f 6e76 6572 7420          Convert 
+0003bb20: 7468 6973 2064 6174 6173 6574 2074 6f20  this dataset to 
+0003bb30: 6120 6469 6374 696f 6e61 7279 2066 6f6c  a dictionary fol
+0003bb40: 6c6f 7769 6e67 2078 6172 7261 7920 6e61  lowing xarray na
+0003bb50: 6d69 6e67 0a20 2020 2020 2020 2063 6f6e  ming.        con
+0003bb60: 7665 6e74 696f 6e73 2e0a 0a20 2020 2020  ventions...     
+0003bb70: 2020 2043 6f6e 7665 7274 7320 616c 6c20     Converts all 
+0003bb80: 7661 7269 6162 6c65 7320 616e 6420 6174  variables and at
+0003bb90: 7472 6962 7574 6573 2074 6f20 6e61 7469  tributes to nati
+0003bba0: 7665 2050 7974 686f 6e20 6f62 6a65 6374  ve Python object
+0003bbb0: 730a 2020 2020 2020 2020 5573 6566 756c  s.        Useful
+0003bbc0: 2066 6f72 2063 6f6e 7665 7274 696e 6720   for converting 
+0003bbd0: 746f 206a 736f 6e2e 2054 6f20 6176 6f69  to json. To avoi
+0003bbe0: 6420 6461 7465 7469 6d65 2069 6e63 6f6d  d datetime incom
+0003bbf0: 7061 7469 6269 6c69 7479 0a20 2020 2020  patibility.     
+0003bc00: 2020 2075 7365 2064 6563 6f64 655f 7469     use decode_ti
+0003bc10: 6d65 733d 4661 6c73 6520 6b77 6172 6720  mes=False kwarg 
+0003bc20: 696e 2078 6172 7272 6179 2e6f 7065 6e5f  in xarrray.open_
+0003bc30: 6461 7461 7365 742e 0a0a 2020 2020 2020  dataset...      
+0003bc40: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0003bc50: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0003bc60: 2020 2020 2020 2020 6461 7461 203a 2062          data : b
+0003bc70: 6f6f 6c2c 2064 6566 6175 6c74 3a20 5472  ool, default: Tr
+0003bc80: 7565 0a20 2020 2020 2020 2020 2020 2057  ue.            W
+0003bc90: 6865 7468 6572 2074 6f20 696e 636c 7564  hether to includ
+0003bca0: 6520 7468 6520 6163 7475 616c 2064 6174  e the actual dat
+0003bcb0: 6120 696e 2074 6865 2064 6963 7469 6f6e  a in the diction
+0003bcc0: 6172 792e 2057 6865 6e20 7365 7420 746f  ary. When set to
+0003bcd0: 0a20 2020 2020 2020 2020 2020 2046 616c  .            Fal
+0003bce0: 7365 2c20 7265 7475 726e 7320 6a75 7374  se, returns just
+0003bcf0: 2074 6865 2073 6368 656d 612e 0a20 2020   the schema..   
+0003bd00: 2020 2020 2065 6e63 6f64 696e 6720 3a20       encoding : 
+0003bd10: 626f 6f6c 2c20 6465 6661 756c 743a 2046  bool, default: F
+0003bd20: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0003bd30: 2057 6865 7468 6572 2074 6f20 696e 636c   Whether to incl
+0003bd40: 7564 6520 7468 6520 4461 7461 7365 7427  ude the Dataset'
+0003bd50: 7320 656e 636f 6469 6e67 2069 6e20 7468  s encoding in th
+0003bd60: 6520 6469 6374 696f 6e61 7279 2e0a 0a20  e dictionary... 
+0003bd70: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+0003bd80: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+0003bd90: 2020 2020 2020 2064 203a 2064 6963 740a         d : dict.
+0003bda0: 2020 2020 2020 2020 2020 2020 4469 6374              Dict
+0003bdb0: 2077 6974 6820 6b65 7973 3a20 2263 6f6f   with keys: "coo
+0003bdc0: 7264 7322 2c20 2261 7474 7273 222c 2022  rds", "attrs", "
+0003bdd0: 6469 6d73 222c 2022 6461 7461 5f76 6172  dims", "data_var
+0003bde0: 7322 2061 6e64 206f 7074 696f 6e61 6c6c  s" and optionall
+0003bdf0: 790a 2020 2020 2020 2020 2020 2020 2265  y.            "e
+0003be00: 6e63 6f64 696e 6722 2e0a 0a20 2020 2020  ncoding"...     
+0003be10: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+0003be20: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0003be30: 2020 2020 2044 6174 6173 6574 2e66 726f       Dataset.fro
+0003be40: 6d5f 6469 6374 0a20 2020 2020 2020 2044  m_dict.        D
+0003be50: 6174 6141 7272 6179 2e74 6f5f 6469 6374  ataArray.to_dict
+0003be60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0003be70: 2020 2020 2064 3a20 6469 6374 203d 207b       d: dict = {
+0003be80: 0a20 2020 2020 2020 2020 2020 2022 636f  .            "co
+0003be90: 6f72 6473 223a 207b 7d2c 0a20 2020 2020  ords": {},.     
+0003bea0: 2020 2020 2020 2022 6174 7472 7322 3a20         "attrs": 
+0003beb0: 6465 636f 6465 5f6e 756d 7079 5f64 6963  decode_numpy_dic
+0003bec0: 745f 7661 6c75 6573 2873 656c 662e 6174  t_values(self.at
+0003bed0: 7472 7329 2c0a 2020 2020 2020 2020 2020  trs),.          
+0003bee0: 2020 2264 696d 7322 3a20 6469 6374 2873    "dims": dict(s
+0003bef0: 656c 662e 6469 6d73 292c 0a20 2020 2020  elf.dims),.     
+0003bf00: 2020 2020 2020 2022 6461 7461 5f76 6172         "data_var
+0003bf10: 7322 3a20 7b7d 2c0a 2020 2020 2020 2020  s": {},.        
+0003bf20: 7d0a 2020 2020 2020 2020 666f 7220 6b20  }.        for k 
+0003bf30: 696e 2073 656c 662e 636f 6f72 6473 3a0a  in self.coords:.
+0003bf40: 2020 2020 2020 2020 2020 2020 645b 2263              d["c
+0003bf50: 6f6f 7264 7322 5d2e 7570 6461 7465 280a  oords"].update(.
+0003bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bf70: 7b6b 3a20 7365 6c66 5b6b 5d2e 7661 7269  {k: self[k].vari
+0003bf80: 6162 6c65 2e74 6f5f 6469 6374 2864 6174  able.to_dict(dat
+0003bf90: 613d 6461 7461 2c20 656e 636f 6469 6e67  a=data, encoding
+0003bfa0: 3d65 6e63 6f64 696e 6729 7d0a 2020 2020  =encoding)}.    
+0003bfb0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0003bfc0: 2020 666f 7220 6b20 696e 2073 656c 662e    for k in self.
+0003bfd0: 6461 7461 5f76 6172 733a 0a20 2020 2020  data_vars:.     
+0003bfe0: 2020 2020 2020 2064 5b22 6461 7461 5f76         d["data_v
+0003bff0: 6172 7322 5d2e 7570 6461 7465 280a 2020  ars"].update(.  
+0003c000: 2020 2020 2020 2020 2020 2020 2020 7b6b                {k
+0003c010: 3a20 7365 6c66 5b6b 5d2e 7661 7269 6162  : self[k].variab
+0003c020: 6c65 2e74 6f5f 6469 6374 2864 6174 613d  le.to_dict(data=
+0003c030: 6461 7461 2c20 656e 636f 6469 6e67 3d65  data, encoding=e
+0003c040: 6e63 6f64 696e 6729 7d0a 2020 2020 2020  ncoding)}.      
+0003c050: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0003c060: 6966 2065 6e63 6f64 696e 673a 0a20 2020  if encoding:.   
+0003c070: 2020 2020 2020 2020 2064 5b22 656e 636f           d["enco
+0003c080: 6469 6e67 225d 203d 2064 6963 7428 7365  ding"] = dict(se
+0003c090: 6c66 2e65 6e63 6f64 696e 6729 0a20 2020  lf.encoding).   
+0003c0a0: 2020 2020 2072 6574 7572 6e20 640a 0a20       return d.. 
+0003c0b0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+0003c0c0: 2020 2020 6465 6620 6672 6f6d 5f64 6963      def from_dic
+0003c0d0: 7428 636c 733a 2074 7970 655b 545f 4461  t(cls: type[T_Da
+0003c0e0: 7461 7365 745d 2c20 643a 204d 6170 7069  taset], d: Mappi
+0003c0f0: 6e67 5b41 6e79 2c20 416e 795d 2920 2d3e  ng[Any, Any]) ->
+0003c100: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
+0003c110: 2020 2020 2222 2243 6f6e 7665 7274 2061      """Convert a
+0003c120: 2064 6963 7469 6f6e 6172 7920 696e 746f   dictionary into
+0003c130: 2061 6e20 7861 7272 6179 2e44 6174 6173   an xarray.Datas
+0003c140: 6574 2e0a 0a20 2020 2020 2020 2050 6172  et...        Par
+0003c150: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+0003c160: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+0003c170: 2020 2064 203a 2064 6963 742d 6c69 6b65     d : dict-like
+0003c180: 0a20 2020 2020 2020 2020 2020 204d 6170  .            Map
+0003c190: 7069 6e67 2077 6974 6820 6120 6d69 6e69  ping with a mini
+0003c1a0: 6d75 6d20 7374 7275 6374 7572 6520 6f66  mum structure of
+0003c1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c1c0: 2060 607b 2276 6172 5f30 223a 207b 2264   ``{"var_0": {"d
+0003c1d0: 696d 7322 3a20 5b2e 2e5d 2c20 2264 6174  ims": [..], "dat
+0003c1e0: 6122 3a20 5b2e 2e5d 7d2c 205c 0a20 2020  a": [..]}, \.   
+0003c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c200: 2020 2020 2020 2020 202e 2e2e 7d60 600a           ...}``.
+0003c210: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+0003c220: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0003c230: 0a20 2020 2020 2020 206f 626a 203a 2044  .        obj : D
+0003c240: 6174 6173 6574 0a0a 2020 2020 2020 2020  ataset..        
+0003c250: 5365 6520 616c 736f 0a20 2020 2020 2020  See also.       
+0003c260: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+0003c270: 2020 4461 7461 7365 742e 746f 5f64 6963    Dataset.to_dic
+0003c280: 740a 2020 2020 2020 2020 4461 7461 4172  t.        DataAr
+0003c290: 7261 792e 6672 6f6d 5f64 6963 740a 0a20  ray.from_dict.. 
+0003c2a0: 2020 2020 2020 2045 7861 6d70 6c65 730a         Examples.
+0003c2b0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0003c2c0: 0a20 2020 2020 2020 203e 3e3e 2064 203d  .        >>> d =
+0003c2d0: 207b 0a20 2020 2020 2020 202e 2e2e 2020   {.        ...  
+0003c2e0: 2020 2022 7422 3a20 7b22 6469 6d73 223a     "t": {"dims":
+0003c2f0: 2028 2274 2229 2c20 2264 6174 6122 3a20   ("t"), "data": 
+0003c300: 5b30 2c20 312c 2032 5d7d 2c0a 2020 2020  [0, 1, 2]},.    
+0003c310: 2020 2020 2e2e 2e20 2020 2020 2261 223a      ...     "a":
+0003c320: 207b 2264 696d 7322 3a20 2822 7422 292c   {"dims": ("t"),
+0003c330: 2022 6461 7461 223a 205b 2261 222c 2022   "data": ["a", "
+0003c340: 6222 2c20 2263 225d 7d2c 0a20 2020 2020  b", "c"]},.     
+0003c350: 2020 202e 2e2e 2020 2020 2022 6222 3a20     ...     "b": 
+0003c360: 7b22 6469 6d73 223a 2028 2274 2229 2c20  {"dims": ("t"), 
+0003c370: 2264 6174 6122 3a20 5b31 302c 2032 302c  "data": [10, 20,
+0003c380: 2033 305d 7d2c 0a20 2020 2020 2020 202e   30]},.        .
+0003c390: 2e2e 207d 0a20 2020 2020 2020 203e 3e3e  .. }.        >>>
+0003c3a0: 2064 7320 3d20 7872 2e44 6174 6173 6574   ds = xr.Dataset
+0003c3b0: 2e66 726f 6d5f 6469 6374 2864 290a 2020  .from_dict(d).  
+0003c3c0: 2020 2020 2020 3e3e 3e20 6473 0a20 2020        >>> ds.   
+0003c3d0: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
+0003c3e0: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
+0003c3f0: 6d65 6e73 696f 6e73 3a20 2028 743a 2033  mensions:  (t: 3
+0003c400: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
+0003c410: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
+0003c420: 202a 2074 2020 2020 2020 2020 2874 2920   * t        (t) 
+0003c430: 696e 7436 3420 3020 3120 320a 2020 2020  int64 0 1 2.    
+0003c440: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
+0003c450: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0003c460: 6120 2020 2020 2020 2028 7429 203c 5531  a        (t) <U1
+0003c470: 2027 6127 2027 6227 2027 6327 0a20 2020   'a' 'b' 'c'.   
+0003c480: 2020 2020 2020 2020 2062 2020 2020 2020           b      
+0003c490: 2020 2874 2920 696e 7436 3420 3130 2032    (t) int64 10 2
+0003c4a0: 3020 3330 0a0a 2020 2020 2020 2020 3e3e  0 30..        >>
+0003c4b0: 3e20 6420 3d20 7b0a 2020 2020 2020 2020  > d = {.        
+0003c4c0: 2e2e 2e20 2020 2020 2263 6f6f 7264 7322  ...     "coords"
+0003c4d0: 3a20 7b0a 2020 2020 2020 2020 2e2e 2e20  : {.        ... 
+0003c4e0: 2020 2020 2020 2020 2274 223a 207b 2264          "t": {"d
+0003c4f0: 696d 7322 3a20 2274 222c 2022 6461 7461  ims": "t", "data
+0003c500: 223a 205b 302c 2031 2c20 325d 2c20 2261  ": [0, 1, 2], "a
+0003c510: 7474 7273 223a 207b 2275 6e69 7473 223a  ttrs": {"units":
+0003c520: 2022 7322 7d7d 0a20 2020 2020 2020 202e   "s"}}.        .
+0003c530: 2e2e 2020 2020 207d 2c0a 2020 2020 2020  ..     },.      
+0003c540: 2020 2e2e 2e20 2020 2020 2261 7474 7273    ...     "attrs
+0003c550: 223a 207b 2274 6974 6c65 223a 2022 6169  ": {"title": "ai
+0003c560: 7220 7465 6d70 6572 6174 7572 6522 7d2c  r temperature"},
+0003c570: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+0003c580: 2022 6469 6d73 223a 2022 7422 2c0a 2020   "dims": "t",.  
+0003c590: 2020 2020 2020 2e2e 2e20 2020 2020 2264        ...     "d
+0003c5a0: 6174 615f 7661 7273 223a 207b 0a20 2020  ata_vars": {.   
+0003c5b0: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
+0003c5c0: 2022 6122 3a20 7b22 6469 6d73 223a 2022   "a": {"dims": "
+0003c5d0: 7422 2c20 2264 6174 6122 3a20 5b31 302c  t", "data": [10,
+0003c5e0: 2032 302c 2033 305d 7d2c 0a20 2020 2020   20, 30]},.     
+0003c5f0: 2020 202e 2e2e 2020 2020 2020 2020 2022     ...         "
+0003c600: 6222 3a20 7b22 6469 6d73 223a 2022 7422  b": {"dims": "t"
+0003c610: 2c20 2264 6174 6122 3a20 5b22 6122 2c20  , "data": ["a", 
+0003c620: 2262 222c 2022 6322 5d7d 2c0a 2020 2020  "b", "c"]},.    
+0003c630: 2020 2020 2e2e 2e20 2020 2020 7d2c 0a20      ...     },. 
+0003c640: 2020 2020 2020 202e 2e2e 207d 0a20 2020         ... }.   
+0003c650: 2020 2020 203e 3e3e 2064 7320 3d20 7872       >>> ds = xr
+0003c660: 2e44 6174 6173 6574 2e66 726f 6d5f 6469  .Dataset.from_di
+0003c670: 6374 2864 290a 2020 2020 2020 2020 3e3e  ct(d).        >>
+0003c680: 3e20 6473 0a20 2020 2020 2020 203c 7861  > ds.        <xa
+0003c690: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
+0003c6a0: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
+0003c6b0: 3a20 2028 743a 2033 290a 2020 2020 2020  :  (t: 3).      
+0003c6c0: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+0003c6d0: 2020 2020 2020 2020 202a 2074 2020 2020           * t    
+0003c6e0: 2020 2020 2874 2920 696e 7436 3420 3020      (t) int64 0 
+0003c6f0: 3120 320a 2020 2020 2020 2020 4461 7461  1 2.        Data
+0003c700: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+0003c710: 2020 2020 2020 2020 6120 2020 2020 2020          a       
+0003c720: 2028 7429 2069 6e74 3634 2031 3020 3230   (t) int64 10 20
+0003c730: 2033 300a 2020 2020 2020 2020 2020 2020   30.            
+0003c740: 6220 2020 2020 2020 2028 7429 203c 5531  b        (t) <U1
+0003c750: 2027 6127 2027 6227 2027 6327 0a20 2020   'a' 'b' 'c'.   
+0003c760: 2020 2020 2041 7474 7269 6275 7465 733a       Attributes:
+0003c770: 0a20 2020 2020 2020 2020 2020 2074 6974  .            tit
+0003c780: 6c65 3a20 2020 2061 6972 2074 656d 7065  le:    air tempe
+0003c790: 7261 7475 7265 0a0a 2020 2020 2020 2020  rature..        
+0003c7a0: 2222 220a 0a20 2020 2020 2020 2076 6172  """..        var
+0003c7b0: 6961 626c 6573 3a20 4974 6572 6162 6c65  iables: Iterable
+0003c7c0: 5b74 7570 6c65 5b48 6173 6861 626c 652c  [tuple[Hashable,
+0003c7d0: 2041 6e79 5d5d 0a20 2020 2020 2020 2069   Any]].        i
+0003c7e0: 6620 6e6f 7420 7b22 636f 6f72 6473 222c  f not {"coords",
+0003c7f0: 2022 6461 7461 5f76 6172 7322 7d2e 6973   "data_vars"}.is
+0003c800: 7375 6273 6574 2873 6574 2864 2929 3a0a  subset(set(d)):.
+0003c810: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+0003c820: 6162 6c65 7320 3d20 642e 6974 656d 7328  ables = d.items(
+0003c830: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0003c840: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+0003c850: 7274 2069 7465 7274 6f6f 6c73 0a0a 2020  rt itertools..  
+0003c860: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+0003c870: 6c65 7320 3d20 6974 6572 746f 6f6c 732e  les = itertools.
+0003c880: 6368 6169 6e28 0a20 2020 2020 2020 2020  chain(.         
+0003c890: 2020 2020 2020 2064 2e67 6574 2822 636f         d.get("co
+0003c8a0: 6f72 6473 222c 207b 7d29 2e69 7465 6d73  ords", {}).items
+0003c8b0: 2829 2c20 642e 6765 7428 2264 6174 615f  (), d.get("data_
+0003c8c0: 7661 7273 222c 207b 7d29 2e69 7465 6d73  vars", {}).items
+0003c8d0: 2829 0a20 2020 2020 2020 2020 2020 2029  ().            )
+0003c8e0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+0003c8f0: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+0003c900: 6c65 5f64 6963 7420 3d20 7b0a 2020 2020  le_dict = {.    
+0003c910: 2020 2020 2020 2020 2020 2020 6b3a 2028              k: (
+0003c920: 765b 2264 696d 7322 5d2c 2076 5b22 6461  v["dims"], v["da
+0003c930: 7461 225d 2c20 762e 6765 7428 2261 7474  ta"], v.get("att
+0003c940: 7273 2229 2920 666f 7220 6b2c 2076 2069  rs")) for k, v i
+0003c950: 6e20 7661 7269 6162 6c65 730a 2020 2020  n variables.    
+0003c960: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0003c970: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+0003c980: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
+0003c990: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0003c9a0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0003c9b0: 2020 2020 2020 2263 616e 6e6f 7420 636f        "cannot co
+0003c9c0: 6e76 6572 7420 6469 6374 2077 6974 686f  nvert dict witho
+0003c9d0: 7574 2074 6865 206b 6579 2022 0a20 2020  ut the key ".   
+0003c9e0: 2020 2020 2020 2020 2020 2020 2022 277b               "'{
+0003c9f0: 6469 6d73 5f64 6174 617d 2722 2e66 6f72  dims_data}'".for
+0003ca00: 6d61 7428 6469 6d73 5f64 6174 613d 7374  mat(dims_data=st
+0003ca10: 7228 652e 6172 6773 5b30 5d29 290a 2020  r(e.args[0])).  
+0003ca20: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0003ca30: 2020 2020 6f62 6a20 3d20 636c 7328 7661      obj = cls(va
+0003ca40: 7269 6162 6c65 5f64 6963 7429 0a0a 2020  riable_dict)..  
+0003ca50: 2020 2020 2020 2320 7768 6174 2069 6620        # what if 
+0003ca60: 636f 6f72 6473 2061 7265 6e27 7420 6469  coords aren't di
+0003ca70: 6d73 3f0a 2020 2020 2020 2020 636f 6f72  ms?.        coor
+0003ca80: 6473 203d 2073 6574 2864 2e67 6574 2822  ds = set(d.get("
+0003ca90: 636f 6f72 6473 222c 207b 7d29 2920 2d20  coords", {})) - 
+0003caa0: 7365 7428 642e 6765 7428 2264 696d 7322  set(d.get("dims"
+0003cab0: 2c20 7b7d 2929 0a20 2020 2020 2020 206f  , {})).        o
+0003cac0: 626a 203d 206f 626a 2e73 6574 5f63 6f6f  bj = obj.set_coo
+0003cad0: 7264 7328 636f 6f72 6473 290a 0a20 2020  rds(coords)..   
+0003cae0: 2020 2020 206f 626a 2e61 7474 7273 2e75       obj.attrs.u
+0003caf0: 7064 6174 6528 642e 6765 7428 2261 7474  pdate(d.get("att
+0003cb00: 7273 222c 207b 7d29 290a 2020 2020 2020  rs", {})).      
+0003cb10: 2020 6f62 6a2e 656e 636f 6469 6e67 2e75    obj.encoding.u
+0003cb20: 7064 6174 6528 642e 6765 7428 2265 6e63  pdate(d.get("enc
+0003cb30: 6f64 696e 6722 2c20 7b7d 2929 0a0a 2020  oding", {}))..  
+0003cb40: 2020 2020 2020 7265 7475 726e 206f 626a        return obj
+0003cb50: 0a0a 2020 2020 6465 6620 5f75 6e61 7279  ..    def _unary
+0003cb60: 5f6f 7028 7365 6c66 3a20 545f 4461 7461  _op(self: T_Data
+0003cb70: 7365 742c 2066 2c20 2a61 7267 732c 202a  set, f, *args, *
+0003cb80: 2a6b 7761 7267 7329 202d 3e20 545f 4461  *kwargs) -> T_Da
+0003cb90: 7461 7365 743a 0a20 2020 2020 2020 2076  taset:.        v
+0003cba0: 6172 6961 626c 6573 203d 207b 7d0a 2020  ariables = {}.  
+0003cbb0: 2020 2020 2020 6b65 6570 5f61 7474 7273        keep_attrs
+0003cbc0: 203d 206b 7761 7267 732e 706f 7028 226b   = kwargs.pop("k
+0003cbd0: 6565 705f 6174 7472 7322 2c20 4e6f 6e65  eep_attrs", None
+0003cbe0: 290a 2020 2020 2020 2020 6966 206b 6565  ).        if kee
+0003cbf0: 705f 6174 7472 7320 6973 204e 6f6e 653a  p_attrs is None:
+0003cc00: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
+0003cc10: 705f 6174 7472 7320 3d20 5f67 6574 5f6b  p_attrs = _get_k
+0003cc20: 6565 705f 6174 7472 7328 6465 6661 756c  eep_attrs(defaul
+0003cc30: 743d 5472 7565 290a 2020 2020 2020 2020  t=True).        
+0003cc40: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
+0003cc50: 2e5f 7661 7269 6162 6c65 732e 6974 656d  ._variables.item
+0003cc60: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0003cc70: 2069 6620 6b20 696e 2073 656c 662e 5f63   if k in self._c
+0003cc80: 6f6f 7264 5f6e 616d 6573 3a0a 2020 2020  oord_names:.    
+0003cc90: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+0003cca0: 6162 6c65 735b 6b5d 203d 2076 0a20 2020  ables[k] = v.   
+0003ccb0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0003ccc0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0003ccd0: 6172 6961 626c 6573 5b6b 5d20 3d20 6628  ariables[k] = f(
+0003cce0: 762c 202a 6172 6773 2c20 2a2a 6b77 6172  v, *args, **kwar
+0003ccf0: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
+0003cd00: 2020 2020 6966 206b 6565 705f 6174 7472      if keep_attr
+0003cd10: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0003cd20: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+0003cd30: 5b6b 5d2e 6174 7472 7320 3d20 762e 5f61  [k].attrs = v._a
+0003cd40: 7474 7273 0a20 2020 2020 2020 2061 7474  ttrs.        att
+0003cd50: 7273 203d 2073 656c 662e 5f61 7474 7273  rs = self._attrs
+0003cd60: 2069 6620 6b65 6570 5f61 7474 7273 2065   if keep_attrs e
+0003cd70: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
+0003cd80: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
+0003cd90: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
+0003cda0: 696d 7328 7661 7269 6162 6c65 732c 2061  ims(variables, a
+0003cdb0: 7474 7273 3d61 7474 7273 290a 0a20 2020  ttrs=attrs)..   
+0003cdc0: 2064 6566 205f 6269 6e61 7279 5f6f 7028   def _binary_op(
+0003cdd0: 7365 6c66 2c20 6f74 6865 722c 2066 2c20  self, other, f, 
+0003cde0: 7265 666c 6578 6976 653d 4661 6c73 652c  reflexive=False,
+0003cdf0: 206a 6f69 6e3d 4e6f 6e65 2920 2d3e 2044   join=None) -> D
+0003ce00: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
+0003ce10: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
+0003ce20: 2e64 6174 6161 7272 6179 2069 6d70 6f72  .dataarray impor
+0003ce30: 7420 4461 7461 4172 7261 790a 2020 2020  t DataArray.    
+0003ce40: 2020 2020 6672 6f6d 2078 6172 7261 792e      from xarray.
+0003ce50: 636f 7265 2e67 726f 7570 6279 2069 6d70  core.groupby imp
+0003ce60: 6f72 7420 4772 6f75 7042 790a 0a20 2020  ort GroupBy..   
+0003ce70: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0003ce80: 6365 286f 7468 6572 2c20 4772 6f75 7042  ce(other, GroupB
+0003ce90: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
+0003cea0: 7265 7475 726e 204e 6f74 496d 706c 656d  return NotImplem
+0003ceb0: 656e 7465 640a 2020 2020 2020 2020 616c  ented.        al
+0003cec0: 6967 6e5f 7479 7065 203d 204f 5054 494f  ign_type = OPTIO
+0003ced0: 4e53 5b22 6172 6974 686d 6574 6963 5f6a  NS["arithmetic_j
+0003cee0: 6f69 6e22 5d20 6966 206a 6f69 6e20 6973  oin"] if join is
+0003cef0: 204e 6f6e 6520 656c 7365 206a 6f69 6e0a   None else join.
+0003cf00: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0003cf10: 7461 6e63 6528 6f74 6865 722c 2028 4461  tance(other, (Da
+0003cf20: 7461 4172 7261 792c 2044 6174 6173 6574  taArray, Dataset
+0003cf30: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0003cf40: 7365 6c66 2c20 6f74 6865 7220 3d20 616c  self, other = al
+0003cf50: 6967 6e28 7365 6c66 2c20 6f74 6865 722c  ign(self, other,
+0003cf60: 206a 6f69 6e3d 616c 6967 6e5f 7479 7065   join=align_type
+0003cf70: 2c20 636f 7079 3d46 616c 7365 2920 2023  , copy=False)  #
+0003cf80: 2074 7970 653a 2069 676e 6f72 655b 6173   type: ignore[as
+0003cf90: 7369 676e 6d65 6e74 5d0a 2020 2020 2020  signment].      
+0003cfa0: 2020 6720 3d20 6620 6966 206e 6f74 2072    g = f if not r
+0003cfb0: 6566 6c65 7869 7665 2065 6c73 6520 6c61  eflexive else la
+0003cfc0: 6d62 6461 2078 2c20 793a 2066 2879 2c20  mbda x, y: f(y, 
+0003cfd0: 7829 0a20 2020 2020 2020 2064 7320 3d20  x).        ds = 
+0003cfe0: 7365 6c66 2e5f 6361 6c63 756c 6174 655f  self._calculate_
+0003cff0: 6269 6e61 7279 5f6f 7028 672c 206f 7468  binary_op(g, oth
+0003d000: 6572 2c20 6a6f 696e 3d61 6c69 676e 5f74  er, join=align_t
+0003d010: 7970 6529 0a20 2020 2020 2020 206b 6565  ype).        kee
+0003d020: 705f 6174 7472 7320 3d20 5f67 6574 5f6b  p_attrs = _get_k
+0003d030: 6565 705f 6174 7472 7328 6465 6661 756c  eep_attrs(defaul
+0003d040: 743d 4661 6c73 6529 0a20 2020 2020 2020  t=False).       
+0003d050: 2069 6620 6b65 6570 5f61 7474 7273 3a0a   if keep_attrs:.
+0003d060: 2020 2020 2020 2020 2020 2020 6473 2e61              ds.a
+0003d070: 7474 7273 203d 2073 656c 662e 6174 7472  ttrs = self.attr
+0003d080: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
+0003d090: 2064 730a 0a20 2020 2064 6566 205f 696e   ds..    def _in
+0003d0a0: 706c 6163 655f 6269 6e61 7279 5f6f 7028  place_binary_op(
+0003d0b0: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
+0003d0c0: 206f 7468 6572 2c20 6629 202d 3e20 545f   other, f) -> T_
+0003d0d0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+0003d0e0: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
+0003d0f0: 652e 6461 7461 6172 7261 7920 696d 706f  e.dataarray impo
+0003d100: 7274 2044 6174 6141 7272 6179 0a20 2020  rt DataArray.   
+0003d110: 2020 2020 2066 726f 6d20 7861 7272 6179       from xarray
+0003d120: 2e63 6f72 652e 6772 6f75 7062 7920 696d  .core.groupby im
+0003d130: 706f 7274 2047 726f 7570 4279 0a0a 2020  port GroupBy..  
+0003d140: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0003d150: 6e63 6528 6f74 6865 722c 2047 726f 7570  nce(other, Group
+0003d160: 4279 293a 0a20 2020 2020 2020 2020 2020  By):.           
+0003d170: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+0003d180: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0003d190: 2020 2269 6e2d 706c 6163 6520 6f70 6572    "in-place oper
+0003d1a0: 6174 696f 6e73 2062 6574 7765 656e 2061  ations between a
+0003d1b0: 2044 6174 6173 6574 2061 6e64 2022 0a20   Dataset and ". 
+0003d1c0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0003d1d0: 6120 6772 6f75 7065 6420 6f62 6a65 6374  a grouped object
+0003d1e0: 2061 7265 206e 6f74 2070 6572 6d69 7474   are not permitt
+0003d1f0: 6564 220a 2020 2020 2020 2020 2020 2020  ed".            
+0003d200: 290a 2020 2020 2020 2020 2320 7765 2064  ).        # we d
+0003d210: 6f6e 2774 2061 6374 7561 6c6c 7920 6d6f  on't actually mo
+0003d220: 6469 6679 2061 7272 6179 7320 696e 2d70  dify arrays in-p
+0003d230: 6c61 6365 2077 6974 6820 696e 2d70 6c61  lace with in-pla
+0003d240: 6365 2044 6174 6173 6574 0a20 2020 2020  ce Dataset.     
+0003d250: 2020 2023 2061 7269 7468 6d65 7469 6320     # arithmetic 
+0003d260: 2d2d 2074 6869 7320 6c65 7473 2075 7320  -- this lets us 
+0003d270: 6175 746f 6d61 7469 6361 6c6c 7920 616c  automatically al
+0003d280: 6967 6e20 7468 696e 6773 0a20 2020 2020  ign things.     
+0003d290: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0003d2a0: 286f 7468 6572 2c20 2844 6174 6141 7272  (other, (DataArr
+0003d2b0: 6179 2c20 4461 7461 7365 7429 293a 0a20  ay, Dataset)):. 
+0003d2c0: 2020 2020 2020 2020 2020 206f 7468 6572             other
+0003d2d0: 203d 206f 7468 6572 2e72 6569 6e64 6578   = other.reindex
+0003d2e0: 5f6c 696b 6528 7365 6c66 2c20 636f 7079  _like(self, copy
+0003d2f0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+0003d300: 6720 3d20 6f70 732e 696e 706c 6163 655f  g = ops.inplace_
+0003d310: 746f 5f6e 6f6e 696e 706c 6163 655f 6f70  to_noninplace_op
+0003d320: 2866 290a 2020 2020 2020 2020 6473 203d  (f).        ds =
+0003d330: 2073 656c 662e 5f63 616c 6375 6c61 7465   self._calculate
+0003d340: 5f62 696e 6172 795f 6f70 2867 2c20 6f74  _binary_op(g, ot
+0003d350: 6865 722c 2069 6e70 6c61 6365 3d54 7275  her, inplace=Tru
+0003d360: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
+0003d370: 5f72 6570 6c61 6365 5f77 6974 685f 6e65  _replace_with_ne
+0003d380: 775f 6469 6d73 280a 2020 2020 2020 2020  w_dims(.        
+0003d390: 2020 2020 6473 2e5f 7661 7269 6162 6c65      ds._variable
+0003d3a0: 732c 0a20 2020 2020 2020 2020 2020 2064  s,.            d
+0003d3b0: 732e 5f63 6f6f 7264 5f6e 616d 6573 2c0a  s._coord_names,.
+0003d3c0: 2020 2020 2020 2020 2020 2020 6174 7472              attr
+0003d3d0: 733d 6473 2e5f 6174 7472 732c 0a20 2020  s=ds._attrs,.   
+0003d3e0: 2020 2020 2020 2020 2069 6e64 6578 6573           indexes
+0003d3f0: 3d64 732e 5f69 6e64 6578 6573 2c0a 2020  =ds._indexes,.  
+0003d400: 2020 2020 2020 2020 2020 696e 706c 6163            inplac
+0003d410: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+0003d420: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0003d430: 2073 656c 660a 0a20 2020 2064 6566 205f   self..    def _
+0003d440: 6361 6c63 756c 6174 655f 6269 6e61 7279  calculate_binary
+0003d450: 5f6f 7028 0a20 2020 2020 2020 2073 656c  _op(.        sel
+0003d460: 662c 2066 2c20 6f74 6865 722c 206a 6f69  f, f, other, joi
+0003d470: 6e3d 2269 6e6e 6572 222c 2069 6e70 6c61  n="inner", inpla
+0003d480: 6365 3a20 626f 6f6c 203d 2046 616c 7365  ce: bool = False
+0003d490: 0a20 2020 2029 202d 3e20 4461 7461 7365  .    ) -> Datase
+0003d4a0: 743a 0a20 2020 2020 2020 2064 6566 2061  t:.        def a
+0003d4b0: 7070 6c79 5f6f 7665 725f 626f 7468 286c  pply_over_both(l
+0003d4c0: 6873 5f64 6174 615f 7661 7273 2c20 7268  hs_data_vars, rh
+0003d4d0: 735f 6461 7461 5f76 6172 732c 206c 6873  s_data_vars, lhs
+0003d4e0: 5f76 6172 732c 2072 6873 5f76 6172 7329  _vars, rhs_vars)
+0003d4f0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0003d500: 2069 6e70 6c61 6365 2061 6e64 2073 6574   inplace and set
+0003d510: 286c 6873 5f64 6174 615f 7661 7273 2920  (lhs_data_vars) 
+0003d520: 213d 2073 6574 2872 6873 5f64 6174 615f  != set(rhs_data_
+0003d530: 7661 7273 293a 0a20 2020 2020 2020 2020  vars):.         
+0003d540: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0003d550: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+0003d560: 2020 2020 2020 2020 2020 2020 2022 6461               "da
+0003d570: 7461 7365 7473 206d 7573 7420 6861 7665  tasets must have
+0003d580: 2074 6865 2073 616d 6520 6461 7461 2076   the same data v
+0003d590: 6172 6961 626c 6573 2022 0a20 2020 2020  ariables ".     
+0003d5a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0003d5b0: 2266 6f72 2069 6e2d 706c 6163 6520 6172  "for in-place ar
+0003d5c0: 6974 686d 6574 6963 206f 7065 7261 7469  ithmetic operati
+0003d5d0: 6f6e 733a 207b 6c69 7374 286c 6873 5f64  ons: {list(lhs_d
+0003d5e0: 6174 615f 7661 7273 297d 2c20 7b6c 6973  ata_vars)}, {lis
+0003d5f0: 7428 7268 735f 6461 7461 5f76 6172 7329  t(rhs_data_vars)
+0003d600: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+0003d610: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0003d620: 2020 6465 7374 5f76 6172 7320 3d20 7b7d    dest_vars = {}
+0003d630: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+0003d640: 7220 6b20 696e 206c 6873 5f64 6174 615f  r k in lhs_data_
+0003d650: 7661 7273 3a0a 2020 2020 2020 2020 2020  vars:.          
+0003d660: 2020 2020 2020 6966 206b 2069 6e20 7268        if k in rh
+0003d670: 735f 6461 7461 5f76 6172 733a 0a20 2020  s_data_vars:.   
+0003d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d690: 2064 6573 745f 7661 7273 5b6b 5d20 3d20   dest_vars[k] = 
+0003d6a0: 6628 6c68 735f 7661 7273 5b6b 5d2c 2072  f(lhs_vars[k], r
+0003d6b0: 6873 5f76 6172 735b 6b5d 290a 2020 2020  hs_vars[k]).    
+0003d6c0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0003d6d0: 206a 6f69 6e20 696e 205b 226c 6566 7422   join in ["left"
+0003d6e0: 2c20 226f 7574 6572 225d 3a0a 2020 2020  , "outer"]:.    
+0003d6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d700: 6465 7374 5f76 6172 735b 6b5d 203d 2066  dest_vars[k] = f
+0003d710: 286c 6873 5f76 6172 735b 6b5d 2c20 6e70  (lhs_vars[k], np
+0003d720: 2e6e 616e 290a 2020 2020 2020 2020 2020  .nan).          
+0003d730: 2020 666f 7220 6b20 696e 2072 6873 5f64    for k in rhs_d
+0003d740: 6174 615f 7661 7273 3a0a 2020 2020 2020  ata_vars:.      
+0003d750: 2020 2020 2020 2020 2020 6966 206b 206e            if k n
+0003d760: 6f74 2069 6e20 6465 7374 5f76 6172 7320  ot in dest_vars 
+0003d770: 616e 6420 6a6f 696e 2069 6e20 5b22 7269  and join in ["ri
+0003d780: 6768 7422 2c20 226f 7574 6572 225d 3a0a  ght", "outer"]:.
+0003d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d7a0: 2020 2020 6465 7374 5f76 6172 735b 6b5d      dest_vars[k]
+0003d7b0: 203d 2066 2872 6873 5f76 6172 735b 6b5d   = f(rhs_vars[k]
+0003d7c0: 2c20 6e70 2e6e 616e 290a 2020 2020 2020  , np.nan).      
+0003d7d0: 2020 2020 2020 7265 7475 726e 2064 6573        return des
+0003d7e0: 745f 7661 7273 0a0a 2020 2020 2020 2020  t_vars..        
+0003d7f0: 6966 2075 7469 6c73 2e69 735f 6469 6374  if utils.is_dict
+0003d800: 5f6c 696b 6528 6f74 6865 7229 2061 6e64  _like(other) and
+0003d810: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0003d820: 6f74 6865 722c 2044 6174 6173 6574 293a  other, Dataset):
+0003d830: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
+0003d840: 616e 2774 2075 7365 206f 7572 2073 686f  an't use our sho
+0003d850: 7274 6375 7420 6f66 2064 6f69 6e67 2074  rtcut of doing t
+0003d860: 6865 2062 696e 6172 7920 6f70 6572 6174  he binary operat
+0003d870: 696f 6e20 7769 7468 0a20 2020 2020 2020  ion with.       
+0003d880: 2020 2020 2023 2056 6172 6961 626c 6520       # Variable 
+0003d890: 6f62 6a65 6374 732c 2073 6f20 6170 706c  objects, so appl
+0003d8a0: 7920 6f76 6572 206f 7572 2064 6174 6120  y over our data 
+0003d8b0: 7661 7273 2069 6e73 7465 6164 2e0a 2020  vars instead..  
+0003d8c0: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+0003d8d0: 7461 5f76 6172 7320 3d20 6170 706c 795f  ta_vars = apply_
+0003d8e0: 6f76 6572 5f62 6f74 6828 0a20 2020 2020  over_both(.     
+0003d8f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003d900: 6461 7461 5f76 6172 732c 206f 7468 6572  data_vars, other
+0003d910: 2c20 7365 6c66 2e64 6174 615f 7661 7273  , self.data_vars
+0003d920: 2c20 6f74 6865 720a 2020 2020 2020 2020  , other.        
+0003d930: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0003d940: 2020 7265 7475 726e 2074 7970 6528 7365    return type(se
+0003d950: 6c66 2928 6e65 775f 6461 7461 5f76 6172  lf)(new_data_var
+0003d960: 7329 0a0a 2020 2020 2020 2020 6f74 6865  s)..        othe
+0003d970: 725f 636f 6f72 6473 3a20 436f 6f72 6469  r_coords: Coordi
+0003d980: 6e61 7465 7320 7c20 4e6f 6e65 203d 2067  nates | None = g
+0003d990: 6574 6174 7472 286f 7468 6572 2c20 2263  etattr(other, "c
+0003d9a0: 6f6f 7264 7322 2c20 4e6f 6e65 290a 2020  oords", None).  
+0003d9b0: 2020 2020 2020 6473 203d 2073 656c 662e        ds = self.
+0003d9c0: 636f 6f72 6473 2e6d 6572 6765 286f 7468  coords.merge(oth
+0003d9d0: 6572 5f63 6f6f 7264 7329 0a0a 2020 2020  er_coords)..    
+0003d9e0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0003d9f0: 6528 6f74 6865 722c 2044 6174 6173 6574  e(other, Dataset
+0003da00: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
+0003da10: 6577 5f76 6172 7320 3d20 6170 706c 795f  ew_vars = apply_
+0003da20: 6f76 6572 5f62 6f74 6828 0a20 2020 2020  over_both(.     
+0003da30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003da40: 6461 7461 5f76 6172 732c 206f 7468 6572  data_vars, other
+0003da50: 2e64 6174 615f 7661 7273 2c20 7365 6c66  .data_vars, self
+0003da60: 2e76 6172 6961 626c 6573 2c20 6f74 6865  .variables, othe
+0003da70: 722e 7661 7269 6162 6c65 730a 2020 2020  r.variables.    
+0003da80: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0003da90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0003daa0: 2020 2020 6f74 6865 725f 7661 7269 6162      other_variab
+0003dab0: 6c65 203d 2067 6574 6174 7472 286f 7468  le = getattr(oth
+0003dac0: 6572 2c20 2276 6172 6961 626c 6522 2c20  er, "variable", 
+0003dad0: 6f74 6865 7229 0a20 2020 2020 2020 2020  other).         
+0003dae0: 2020 206e 6577 5f76 6172 7320 3d20 7b6b     new_vars = {k
+0003daf0: 3a20 6628 7365 6c66 2e76 6172 6961 626c  : f(self.variabl
+0003db00: 6573 5b6b 5d2c 206f 7468 6572 5f76 6172  es[k], other_var
+0003db10: 6961 626c 6529 2066 6f72 206b 2069 6e20  iable) for k in 
+0003db20: 7365 6c66 2e64 6174 615f 7661 7273 7d0a  self.data_vars}.
+0003db30: 2020 2020 2020 2020 6473 2e5f 7661 7269          ds._vari
+0003db40: 6162 6c65 732e 7570 6461 7465 286e 6577  ables.update(new
+0003db50: 5f76 6172 7329 0a20 2020 2020 2020 2064  _vars).        d
+0003db60: 732e 5f64 696d 7320 3d20 6361 6c63 756c  s._dims = calcul
+0003db70: 6174 655f 6469 6d65 6e73 696f 6e73 2864  ate_dimensions(d
+0003db80: 732e 5f76 6172 6961 626c 6573 290a 2020  s._variables).  
+0003db90: 2020 2020 2020 7265 7475 726e 2064 730a        return ds.
+0003dba0: 0a20 2020 2064 6566 205f 636f 7079 5f61  .    def _copy_a
+0003dbb0: 7474 7273 5f66 726f 6d28 7365 6c66 2c20  ttrs_from(self, 
+0003dbc0: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
+0003dbd0: 7365 6c66 2e61 7474 7273 203d 206f 7468  self.attrs = oth
+0003dbe0: 6572 2e61 7474 7273 0a20 2020 2020 2020  er.attrs.       
+0003dbf0: 2066 6f72 2076 2069 6e20 6f74 6865 722e   for v in other.
+0003dc00: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+0003dc10: 2020 2020 2020 2069 6620 7620 696e 2073         if v in s
+0003dc20: 656c 662e 7661 7269 6162 6c65 733a 0a20  elf.variables:. 
+0003dc30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0003dc40: 656c 662e 7661 7269 6162 6c65 735b 765d  elf.variables[v]
+0003dc50: 2e61 7474 7273 203d 206f 7468 6572 2e76  .attrs = other.v
+0003dc60: 6172 6961 626c 6573 5b76 5d2e 6174 7472  ariables[v].attr
+0003dc70: 730a 0a20 2020 2064 6566 2064 6966 6628  s..    def diff(
+0003dc80: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
+0003dc90: 5f44 6174 6173 6574 2c0a 2020 2020 2020  _Dataset,.      
+0003dca0: 2020 6469 6d3a 2048 6173 6861 626c 652c    dim: Hashable,
+0003dcb0: 0a20 2020 2020 2020 206e 3a20 696e 7420  .        n: int 
+0003dcc0: 3d20 312c 0a20 2020 2020 2020 206c 6162  = 1,.        lab
+0003dcd0: 656c 3a20 4c69 7465 7261 6c5b 2275 7070  el: Literal["upp
+0003dce0: 6572 222c 2022 6c6f 7765 7222 5d20 3d20  er", "lower"] = 
+0003dcf0: 2275 7070 6572 222c 0a20 2020 2029 202d  "upper",.    ) -
+0003dd00: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+0003dd10: 2020 2020 2022 2222 4361 6c63 756c 6174       """Calculat
+0003dd20: 6520 7468 6520 6e2d 7468 206f 7264 6572  e the n-th order
+0003dd30: 2064 6973 6372 6574 6520 6469 6666 6572   discrete differ
+0003dd40: 656e 6365 2061 6c6f 6e67 2067 6976 656e  ence along given
+0003dd50: 2061 7869 732e 0a0a 2020 2020 2020 2020   axis...        
+0003dd60: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+0003dd70: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0003dd80: 2020 2020 2020 6469 6d20 3a20 4861 7368        dim : Hash
+0003dd90: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
+0003dda0: 2044 696d 656e 7369 6f6e 206f 7665 7220   Dimension over 
+0003ddb0: 7768 6963 6820 746f 2063 616c 6375 6c61  which to calcula
+0003ddc0: 7465 2074 6865 2066 696e 6974 6520 6469  te the finite di
+0003ddd0: 6666 6572 656e 6365 2e0a 2020 2020 2020  fference..      
+0003dde0: 2020 6e20 3a20 696e 742c 2064 6566 6175    n : int, defau
+0003ddf0: 6c74 3a20 310a 2020 2020 2020 2020 2020  lt: 1.          
+0003de00: 2020 5468 6520 6e75 6d62 6572 206f 6620    The number of 
+0003de10: 7469 6d65 7320 7661 6c75 6573 2061 7265  times values are
+0003de20: 2064 6966 6665 7265 6e63 6564 2e0a 2020   differenced..  
+0003de30: 2020 2020 2020 6c61 6265 6c20 3a20 7b22        label : {"
+0003de40: 7570 7065 7222 2c20 226c 6f77 6572 227d  upper", "lower"}
+0003de50: 2c20 6465 6661 756c 743a 2022 7570 7065  , default: "uppe
+0003de60: 7222 0a20 2020 2020 2020 2020 2020 2054  r".            T
+0003de70: 6865 206e 6577 2063 6f6f 7264 696e 6174  he new coordinat
+0003de80: 6520 696e 2064 696d 656e 7369 6f6e 2060  e in dimension `
+0003de90: 6064 696d 6060 2077 696c 6c20 6861 7665  `dim`` will have
+0003dea0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+0003deb0: 2076 616c 7565 7320 6f66 2065 6974 6865   values of eithe
+0003dec0: 7220 7468 6520 6d69 6e75 656e 6427 7320  r the minuend's 
+0003ded0: 6f72 2073 7562 7472 6168 656e 6427 7320  or subtrahend's 
+0003dee0: 636f 6f72 6469 6e61 7465 0a20 2020 2020  coordinate.     
+0003def0: 2020 2020 2020 2066 6f72 2076 616c 7565         for value
+0003df00: 7320 2775 7070 6572 2720 616e 6420 276c  s 'upper' and 'l
+0003df10: 6f77 6572 272c 2072 6573 7065 6374 6976  ower', respectiv
+0003df20: 656c 792e 0a0a 2020 2020 2020 2020 5265  ely...        Re
+0003df30: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+0003df40: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6469  -----.        di
+0003df50: 6666 6572 656e 6365 203a 2044 6174 6173  fference : Datas
+0003df60: 6574 0a20 2020 2020 2020 2020 2020 2054  et.            T
+0003df70: 6865 206e 2d74 6820 6f72 6465 7220 6669  he n-th order fi
+0003df80: 6e69 7465 2064 6966 6665 7265 6e63 6520  nite difference 
+0003df90: 6f66 2074 6869 7320 6f62 6a65 6374 2e0a  of this object..
+0003dfa0: 0a20 2020 2020 2020 204e 6f74 6573 0a20  .        Notes. 
+0003dfb0: 2020 2020 2020 202d 2d2d 2d2d 0a20 2020         -----.   
+0003dfc0: 2020 2020 2060 6e60 206d 6174 6368 6573       `n` matches
+0003dfd0: 206e 756d 7079 2773 2062 6568 6176 696f   numpy's behavio
+0003dfe0: 7220 616e 6420 6973 2064 6966 6665 7265  r and is differe
+0003dff0: 6e74 2066 726f 6d20 7061 6e64 6173 2720  nt from pandas' 
+0003e000: 6669 7273 7420 6172 6775 6d65 6e74 206e  first argument n
+0003e010: 616d 6564 0a20 2020 2020 2020 2060 7065  amed.        `pe
+0003e020: 7269 6f64 7360 2e0a 0a20 2020 2020 2020  riods`...       
+0003e030: 2045 7861 6d70 6c65 730a 2020 2020 2020   Examples.      
+0003e040: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+0003e050: 2020 203e 3e3e 2064 7320 3d20 7872 2e44     >>> ds = xr.D
+0003e060: 6174 6173 6574 287b 2266 6f6f 223a 2028  ataset({"foo": (
+0003e070: 2278 222c 205b 352c 2035 2c20 362c 2036  "x", [5, 5, 6, 6
+0003e080: 5d29 7d29 0a20 2020 2020 2020 203e 3e3e  ])}).        >>>
+0003e090: 2064 732e 6469 6666 2822 7822 290a 2020   ds.diff("x").  
+0003e0a0: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
+0003e0b0: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
+0003e0c0: 696d 656e 7369 6f6e 733a 2020 2878 3a20  imensions:  (x: 
+0003e0d0: 3329 0a20 2020 2020 2020 2044 696d 656e  3).        Dimen
+0003e0e0: 7369 6f6e 7320 7769 7468 6f75 7420 636f  sions without co
+0003e0f0: 6f72 6469 6e61 7465 733a 2078 0a20 2020  ordinates: x.   
+0003e100: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
+0003e110: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+0003e120: 2066 6f6f 2020 2020 2020 2878 2920 696e   foo      (x) in
+0003e130: 7436 3420 3020 3120 300a 2020 2020 2020  t64 0 1 0.      
+0003e140: 2020 3e3e 3e20 6473 2e64 6966 6628 2278    >>> ds.diff("x
+0003e150: 222c 2032 290a 2020 2020 2020 2020 3c78  ", 2).        <x
+0003e160: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
+0003e170: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+0003e180: 733a 2020 2878 3a20 3229 0a20 2020 2020  s:  (x: 2).     
+0003e190: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
+0003e1a0: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
+0003e1b0: 733a 2078 0a20 2020 2020 2020 2044 6174  s: x.        Dat
+0003e1c0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
+0003e1d0: 2020 2020 2020 2020 2066 6f6f 2020 2020           foo    
+0003e1e0: 2020 2878 2920 696e 7436 3420 3120 2d31    (x) int64 1 -1
+0003e1f0: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
+0003e200: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
+0003e210: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
+0003e220: 7365 742e 6469 6666 6572 656e 7469 6174  set.differentiat
+0003e230: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+0003e240: 2020 2020 2020 6966 206e 203d 3d20 303a        if n == 0:
+0003e250: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0003e260: 7572 6e20 7365 6c66 0a20 2020 2020 2020  urn self.       
+0003e270: 2069 6620 6e20 3c20 303a 0a20 2020 2020   if n < 0:.     
+0003e280: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0003e290: 7565 4572 726f 7228 6622 6f72 6465 7220  ueError(f"order 
+0003e2a0: 606e 6020 6d75 7374 2062 6520 6e6f 6e2d  `n` must be non-
+0003e2b0: 6e65 6761 7469 7665 2062 7574 2067 6f74  negative but got
+0003e2c0: 207b 6e7d 2229 0a0a 2020 2020 2020 2020   {n}")..        
+0003e2d0: 2320 7072 6570 6172 6520 736c 6963 6573  # prepare slices
+0003e2e0: 0a20 2020 2020 2020 2073 6c69 6365 5f73  .        slice_s
+0003e2f0: 7461 7274 203d 207b 6469 6d3a 2073 6c69  tart = {dim: sli
+0003e300: 6365 284e 6f6e 652c 202d 3129 7d0a 2020  ce(None, -1)}.  
+0003e310: 2020 2020 2020 736c 6963 655f 656e 6420        slice_end 
+0003e320: 3d20 7b64 696d 3a20 736c 6963 6528 312c  = {dim: slice(1,
+0003e330: 204e 6f6e 6529 7d0a 0a20 2020 2020 2020   None)}..       
+0003e340: 2023 2070 7265 7061 7265 206e 6577 2063   # prepare new c
+0003e350: 6f6f 7264 696e 6174 650a 2020 2020 2020  oordinate.      
+0003e360: 2020 6966 206c 6162 656c 203d 3d20 2275    if label == "u
+0003e370: 7070 6572 223a 0a20 2020 2020 2020 2020  pper":.         
+0003e380: 2020 2073 6c69 6365 5f6e 6577 203d 2073     slice_new = s
+0003e390: 6c69 6365 5f65 6e64 0a20 2020 2020 2020  lice_end.       
+0003e3a0: 2065 6c69 6620 6c61 6265 6c20 3d3d 2022   elif label == "
+0003e3b0: 6c6f 7765 7222 3a0a 2020 2020 2020 2020  lower":.        
+0003e3c0: 2020 2020 736c 6963 655f 6e65 7720 3d20      slice_new = 
+0003e3d0: 736c 6963 655f 7374 6172 740a 2020 2020  slice_start.    
+0003e3e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003e3f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0003e400: 6545 7272 6f72 2822 5468 6520 276c 6162  eError("The 'lab
+0003e410: 656c 2720 6172 6775 6d65 6e74 2068 6173  el' argument has
+0003e420: 2074 6f20 6265 2065 6974 6865 7220 2775   to be either 'u
+0003e430: 7070 6572 2720 6f72 2027 6c6f 7765 7227  pper' or 'lower'
+0003e440: 2229 0a0a 2020 2020 2020 2020 696e 6465  ")..        inde
+0003e450: 7865 732c 2069 6e64 6578 5f76 6172 7320  xes, index_vars 
+0003e460: 3d20 6973 656c 5f69 6e64 6578 6573 2873  = isel_indexes(s
+0003e470: 656c 662e 7869 6e64 6578 6573 2c20 736c  elf.xindexes, sl
+0003e480: 6963 655f 6e65 7729 0a20 2020 2020 2020  ice_new).       
+0003e490: 2076 6172 6961 626c 6573 203d 207b 7d0a   variables = {}.
+0003e4a0: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
+0003e4b0: 652c 2076 6172 2069 6e20 7365 6c66 2e76  e, var in self.v
+0003e4c0: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
+0003e4d0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0003e4e0: 206e 616d 6520 696e 2069 6e64 6578 5f76   name in index_v
+0003e4f0: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
+0003e500: 2020 2020 2076 6172 6961 626c 6573 5b6e       variables[n
+0003e510: 616d 655d 203d 2069 6e64 6578 5f76 6172  ame] = index_var
+0003e520: 735b 6e61 6d65 5d0a 2020 2020 2020 2020  s[name].        
+0003e530: 2020 2020 656c 6966 2064 696d 2069 6e20      elif dim in 
+0003e540: 7661 722e 6469 6d73 3a0a 2020 2020 2020  var.dims:.      
+0003e550: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
+0003e560: 6520 696e 2073 656c 662e 6461 7461 5f76  e in self.data_v
+0003e570: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
+0003e580: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+0003e590: 6573 5b6e 616d 655d 203d 2076 6172 2e69  es[name] = var.i
+0003e5a0: 7365 6c28 736c 6963 655f 656e 6429 202d  sel(slice_end) -
+0003e5b0: 2076 6172 2e69 7365 6c28 736c 6963 655f   var.isel(slice_
+0003e5c0: 7374 6172 7429 0a20 2020 2020 2020 2020  start).         
+0003e5d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0003e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e5f0: 2076 6172 6961 626c 6573 5b6e 616d 655d   variables[name]
+0003e600: 203d 2076 6172 2e69 7365 6c28 736c 6963   = var.isel(slic
+0003e610: 655f 6e65 7729 0a20 2020 2020 2020 2020  e_new).         
+0003e620: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0003e630: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+0003e640: 6573 5b6e 616d 655d 203d 2076 6172 0a0a  es[name] = var..
+0003e650: 2020 2020 2020 2020 6469 6666 6572 656e          differen
+0003e660: 6365 203d 2073 656c 662e 5f72 6570 6c61  ce = self._repla
+0003e670: 6365 5f77 6974 685f 6e65 775f 6469 6d73  ce_with_new_dims
+0003e680: 2876 6172 6961 626c 6573 2c20 696e 6465  (variables, inde
+0003e690: 7865 733d 696e 6465 7865 7329 0a0a 2020  xes=indexes)..  
+0003e6a0: 2020 2020 2020 6966 206e 203e 2031 3a0a        if n > 1:.
+0003e6b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0003e6c0: 726e 2064 6966 6665 7265 6e63 652e 6469  rn difference.di
+0003e6d0: 6666 2864 696d 2c20 6e20 2d20 3129 0a20  ff(dim, n - 1). 
+0003e6e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0003e6f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0003e700: 6469 6666 6572 656e 6365 0a0a 2020 2020  difference..    
+0003e710: 6465 6620 7368 6966 7428 0a20 2020 2020  def shift(.     
+0003e720: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+0003e730: 6574 2c0a 2020 2020 2020 2020 7368 6966  et,.        shif
+0003e740: 7473 3a20 4d61 7070 696e 675b 416e 792c  ts: Mapping[Any,
+0003e750: 2069 6e74 5d20 7c20 4e6f 6e65 203d 204e   int] | None = N
+0003e760: 6f6e 652c 0a20 2020 2020 2020 2066 696c  one,.        fil
+0003e770: 6c5f 7661 6c75 653a 2041 6e79 203d 2078  l_value: Any = x
+0003e780: 7264 7479 7065 732e 4e41 2c0a 2020 2020  rdtypes.NA,.    
+0003e790: 2020 2020 2a2a 7368 6966 7473 5f6b 7761      **shifts_kwa
+0003e7a0: 7267 733a 2069 6e74 2c0a 2020 2020 2920  rgs: int,.    ) 
+0003e7b0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+0003e7c0: 2020 2020 2020 2222 2253 6869 6674 2074        """Shift t
+0003e7d0: 6869 7320 6461 7461 7365 7420 6279 2061  his dataset by a
+0003e7e0: 6e20 6f66 6673 6574 2061 6c6f 6e67 206f  n offset along o
+0003e7f0: 6e65 206f 7220 6d6f 7265 2064 696d 656e  ne or more dimen
+0003e800: 7369 6f6e 732e 0a0a 2020 2020 2020 2020  sions...        
+0003e810: 4f6e 6c79 2064 6174 6120 7661 7269 6162  Only data variab
+0003e820: 6c65 7320 6172 6520 6d6f 7665 643b 2063  les are moved; c
+0003e830: 6f6f 7264 696e 6174 6573 2073 7461 7920  oordinates stay 
+0003e840: 696e 2070 6c61 6365 2e20 5468 6973 2069  in place. This i
+0003e850: 730a 2020 2020 2020 2020 636f 6e73 6973  s.        consis
+0003e860: 7465 6e74 2077 6974 6820 7468 6520 6265  tent with the be
+0003e870: 6861 7669 6f72 206f 6620 6060 7368 6966  havior of ``shif
+0003e880: 7460 6020 696e 2070 616e 6461 732e 0a0a  t`` in pandas...
+0003e890: 2020 2020 2020 2020 5661 6c75 6573 2073          Values s
+0003e8a0: 6869 6674 6564 2066 726f 6d20 6265 796f  hifted from beyo
+0003e8b0: 6e64 2061 7272 6179 2062 6f75 6e64 7320  nd array bounds 
+0003e8c0: 7769 6c6c 2061 7070 6561 7220 6174 206f  will appear at o
+0003e8d0: 6e65 2065 6e64 206f 660a 2020 2020 2020  ne end of.      
+0003e8e0: 2020 6561 6368 2064 696d 656e 7369 6f6e    each dimension
+0003e8f0: 2c20 7768 6963 6820 6172 6520 6669 6c6c  , which are fill
+0003e900: 6564 2061 6363 6f72 6469 6e67 2074 6f20  ed according to 
+0003e910: 6066 696c 6c5f 7661 6c75 6560 2e20 466f  `fill_value`. Fo
+0003e920: 7220 7065 7269 6f64 6963 0a20 2020 2020  r periodic.     
+0003e930: 2020 206f 6666 7365 7473 2069 6e73 7465     offsets inste
+0003e940: 6164 2073 6565 2060 726f 6c6c 602e 0a0a  ad see `roll`...
+0003e950: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+0003e960: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+0003e970: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7368  -----.        sh
+0003e980: 6966 7473 203a 206d 6170 7069 6e67 206f  ifts : mapping o
+0003e990: 6620 6861 7368 6162 6c65 2074 6f20 696e  f hashable to in
+0003e9a0: 740a 2020 2020 2020 2020 2020 2020 496e  t.            In
+0003e9b0: 7465 6765 7220 6f66 6673 6574 2074 6f20  teger offset to 
+0003e9c0: 7368 6966 7420 616c 6f6e 6720 6561 6368  shift along each
+0003e9d0: 206f 6620 7468 6520 6769 7665 6e20 6469   of the given di
+0003e9e0: 6d65 6e73 696f 6e73 2e0a 2020 2020 2020  mensions..      
+0003e9f0: 2020 2020 2020 506f 7369 7469 7665 206f        Positive o
+0003ea00: 6666 7365 7473 2073 6869 6674 2074 6f20  ffsets shift to 
+0003ea10: 7468 6520 7269 6768 743b 206e 6567 6174  the right; negat
+0003ea20: 6976 6520 6f66 6673 6574 7320 7368 6966  ive offsets shif
+0003ea30: 7420 746f 2074 6865 0a20 2020 2020 2020  t to the.       
+0003ea40: 2020 2020 206c 6566 742e 0a20 2020 2020       left..     
+0003ea50: 2020 2066 696c 6c5f 7661 6c75 6520 3a20     fill_value : 
+0003ea60: 7363 616c 6172 206f 7220 6469 6374 2d6c  scalar or dict-l
+0003ea70: 696b 652c 206f 7074 696f 6e61 6c0a 2020  ike, optional.  
+0003ea80: 2020 2020 2020 2020 2020 5661 6c75 6520            Value 
+0003ea90: 746f 2075 7365 2066 6f72 206e 6577 6c79  to use for newly
+0003eaa0: 206d 6973 7369 6e67 2076 616c 7565 732e   missing values.
+0003eab0: 2049 6620 6120 6469 6374 2d6c 696b 652c   If a dict-like,
+0003eac0: 206d 6170 730a 2020 2020 2020 2020 2020   maps.          
+0003ead0: 2020 7661 7269 6162 6c65 206e 616d 6573    variable names
+0003eae0: 2028 696e 636c 7564 696e 6720 636f 6f72   (including coor
+0003eaf0: 6469 6e61 7465 7329 2074 6f20 6669 6c6c  dinates) to fill
+0003eb00: 2076 616c 7565 732e 0a20 2020 2020 2020   values..       
+0003eb10: 202a 2a73 6869 6674 735f 6b77 6172 6773   **shifts_kwargs
+0003eb20: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+0003eb30: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+0003eb40: 7473 2066 6f72 6d20 6f66 2060 6073 6869  ts form of ``shi
+0003eb50: 6674 7360 602e 0a20 2020 2020 2020 2020  fts``..         
+0003eb60: 2020 204f 6e65 206f 6620 7368 6966 7473     One of shifts
+0003eb70: 206f 7220 7368 6966 7473 5f6b 7761 7267   or shifts_kwarg
+0003eb80: 7320 6d75 7374 2062 6520 7072 6f76 6964  s must be provid
+0003eb90: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
+0003eba0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+0003ebb0: 2d2d 2d2d 0a20 2020 2020 2020 2073 6869  ----.        shi
+0003ebc0: 6674 6564 203a 2044 6174 6173 6574 0a20  fted : Dataset. 
+0003ebd0: 2020 2020 2020 2020 2020 2044 6174 6173             Datas
+0003ebe0: 6574 2077 6974 6820 7468 6520 7361 6d65  et with the same
+0003ebf0: 2063 6f6f 7264 696e 6174 6573 2061 6e64   coordinates and
+0003ec00: 2061 7474 7269 6275 7465 7320 6275 7420   attributes but 
+0003ec10: 7368 6966 7465 6420 6461 7461 0a20 2020  shifted data.   
+0003ec20: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+0003ec30: 6573 2e0a 0a20 2020 2020 2020 2053 6565  es...        See
+0003ec40: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+0003ec50: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2072  ------.        r
+0003ec60: 6f6c 6c0a 0a20 2020 2020 2020 2045 7861  oll..        Exa
+0003ec70: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
+0003ec80: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
+0003ec90: 3e3e 2064 7320 3d20 7872 2e44 6174 6173  >> ds = xr.Datas
+0003eca0: 6574 287b 2266 6f6f 223a 2028 2278 222c  et({"foo": ("x",
+0003ecb0: 206c 6973 7428 2261 6263 6465 2229 297d   list("abcde"))}
+0003ecc0: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
+0003ecd0: 2e73 6869 6674 2878 3d32 290a 2020 2020  .shift(x=2).    
+0003ece0: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
+0003ecf0: 7365 743e 0a20 2020 2020 2020 2044 696d  set>.        Dim
+0003ed00: 656e 7369 6f6e 733a 2020 2878 3a20 3529  ensions:  (x: 5)
+0003ed10: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+0003ed20: 6f6e 7320 7769 7468 6f75 7420 636f 6f72  ons without coor
+0003ed30: 6469 6e61 7465 733a 2078 0a20 2020 2020  dinates: x.     
+0003ed40: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
+0003ed50: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
+0003ed60: 6f6f 2020 2020 2020 2878 2920 6f62 6a65  oo      (x) obje
+0003ed70: 6374 206e 616e 206e 616e 2027 6127 2027  ct nan nan 'a' '
+0003ed80: 6227 2027 6327 0a20 2020 2020 2020 2022  b' 'c'.        "
+0003ed90: 2222 0a20 2020 2020 2020 2073 6869 6674  "".        shift
+0003eda0: 7320 3d20 6569 7468 6572 5f64 6963 745f  s = either_dict_
+0003edb0: 6f72 5f6b 7761 7267 7328 7368 6966 7473  or_kwargs(shifts
+0003edc0: 2c20 7368 6966 7473 5f6b 7761 7267 732c  , shifts_kwargs,
+0003edd0: 2022 7368 6966 7422 290a 2020 2020 2020   "shift").      
+0003ede0: 2020 696e 7661 6c69 6420 3d20 5b6b 2066    invalid = [k f
+0003edf0: 6f72 206b 2069 6e20 7368 6966 7473 2069  or k in shifts i
+0003ee00: 6620 6b20 6e6f 7420 696e 2073 656c 662e  f k not in self.
+0003ee10: 6469 6d73 5d0a 2020 2020 2020 2020 6966  dims].        if
+0003ee20: 2069 6e76 616c 6964 3a0a 2020 2020 2020   invalid:.      
+0003ee30: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0003ee40: 6545 7272 6f72 2866 2264 696d 656e 7369  eError(f"dimensi
+0003ee50: 6f6e 7320 7b69 6e76 616c 6964 2172 7d20  ons {invalid!r} 
+0003ee60: 646f 206e 6f74 2065 7869 7374 2229 0a0a  do not exist")..
+0003ee70: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+0003ee80: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
+0003ee90: 6f72 206e 616d 652c 2076 6172 2069 6e20  or name, var in 
+0003eea0: 7365 6c66 2e76 6172 6961 626c 6573 2e69  self.variables.i
+0003eeb0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+0003eec0: 2020 2020 6966 206e 616d 6520 696e 2073      if name in s
+0003eed0: 656c 662e 6461 7461 5f76 6172 733a 0a20  elf.data_vars:. 
+0003eee0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0003eef0: 696c 6c5f 7661 6c75 655f 203d 2028 0a20  ill_value_ = (. 
+0003ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ef10: 2020 2066 696c 6c5f 7661 6c75 652e 6765     fill_value.ge
+0003ef20: 7428 6e61 6d65 2c20 7872 6474 7970 6573  t(name, xrdtypes
+0003ef30: 2e4e 4129 0a20 2020 2020 2020 2020 2020  .NA).           
+0003ef40: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0003ef50: 7374 616e 6365 2866 696c 6c5f 7661 6c75  stance(fill_valu
+0003ef60: 652c 2064 6963 7429 0a20 2020 2020 2020  e, dict).       
+0003ef70: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0003ef80: 6520 6669 6c6c 5f76 616c 7565 0a20 2020  e fill_value.   
+0003ef90: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+0003efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003efb0: 7661 725f 7368 6966 7473 203d 207b 6b3a  var_shifts = {k:
+0003efc0: 2076 2066 6f72 206b 2c20 7620 696e 2073   v for k, v in s
+0003efd0: 6869 6674 732e 6974 656d 7328 2920 6966  hifts.items() if
+0003efe0: 206b 2069 6e20 7661 722e 6469 6d73 7d0a   k in var.dims}.
+0003eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f000: 7661 7269 6162 6c65 735b 6e61 6d65 5d20  variables[name] 
+0003f010: 3d20 7661 722e 7368 6966 7428 6669 6c6c  = var.shift(fill
+0003f020: 5f76 616c 7565 3d66 696c 6c5f 7661 6c75  _value=fill_valu
+0003f030: 655f 2c20 7368 6966 7473 3d76 6172 5f73  e_, shifts=var_s
+0003f040: 6869 6674 7329 0a20 2020 2020 2020 2020  hifts).         
+0003f050: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0003f060: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+0003f070: 6573 5b6e 616d 655d 203d 2076 6172 0a0a  es[name] = var..
+0003f080: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0003f090: 656c 662e 5f72 6570 6c61 6365 2876 6172  elf._replace(var
+0003f0a0: 6961 626c 6573 290a 0a20 2020 2064 6566  iables)..    def
+0003f0b0: 2072 6f6c 6c28 0a20 2020 2020 2020 2073   roll(.        s
+0003f0c0: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
+0003f0d0: 2020 2020 2020 2020 7368 6966 7473 3a20          shifts: 
+0003f0e0: 4d61 7070 696e 675b 416e 792c 2069 6e74  Mapping[Any, int
+0003f0f0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+0003f100: 0a20 2020 2020 2020 2072 6f6c 6c5f 636f  .        roll_co
+0003f110: 6f72 6473 3a20 626f 6f6c 203d 2046 616c  ords: bool = Fal
+0003f120: 7365 2c0a 2020 2020 2020 2020 2a2a 7368  se,.        **sh
+0003f130: 6966 7473 5f6b 7761 7267 733a 2069 6e74  ifts_kwargs: int
+0003f140: 2c0a 2020 2020 2920 2d3e 2054 5f44 6174  ,.    ) -> T_Dat
+0003f150: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
+0003f160: 2252 6f6c 6c20 7468 6973 2064 6174 6173  "Roll this datas
+0003f170: 6574 2062 7920 616e 206f 6666 7365 7420  et by an offset 
+0003f180: 616c 6f6e 6720 6f6e 6520 6f72 206d 6f72  along one or mor
+0003f190: 6520 6469 6d65 6e73 696f 6e73 2e0a 0a20  e dimensions... 
+0003f1a0: 2020 2020 2020 2055 6e6c 696b 6520 7368         Unlike sh
+0003f1b0: 6966 742c 2072 6f6c 6c20 7472 6561 7473  ift, roll treats
+0003f1c0: 2074 6865 2067 6976 656e 2064 696d 656e   the given dimen
+0003f1d0: 7369 6f6e 7320 6173 2070 6572 696f 6469  sions as periodi
+0003f1e0: 632c 2073 6f20 7769 6c6c 206e 6f74 0a20  c, so will not. 
+0003f1f0: 2020 2020 2020 2063 7265 6174 6520 616e         create an
+0003f200: 7920 6d69 7373 696e 6720 7661 6c75 6573  y missing values
+0003f210: 2074 6f20 6265 2066 696c 6c65 642e 0a0a   to be filled...
+0003f220: 2020 2020 2020 2020 416c 736f 2075 6e6c          Also unl
+0003f230: 696b 6520 7368 6966 742c 2072 6f6c 6c20  ike shift, roll 
+0003f240: 6d61 7920 726f 7461 7465 2061 6c6c 2076  may rotate all v
+0003f250: 6172 6961 626c 6573 2c20 696e 636c 7564  ariables, includ
+0003f260: 696e 6720 636f 6f72 6469 6e61 7465 730a  ing coordinates.
+0003f270: 2020 2020 2020 2020 6966 2073 7065 6369          if speci
+0003f280: 6669 6564 2e20 5468 6520 6469 7265 6374  fied. The direct
+0003f290: 696f 6e20 6f66 2072 6f74 6174 696f 6e20  ion of rotation 
+0003f2a0: 6973 2063 6f6e 7369 7374 656e 7420 7769  is consistent wi
+0003f2b0: 7468 0a20 2020 2020 2020 203a 7079 3a66  th.        :py:f
+0003f2c0: 756e 633a 606e 756d 7079 2e72 6f6c 6c60  unc:`numpy.roll`
+0003f2d0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+0003f2e0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+0003f2f0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0003f300: 2073 6869 6674 7320 3a20 6d61 7070 696e   shifts : mappin
+0003f310: 6720 6f66 2068 6173 6861 626c 6520 746f  g of hashable to
+0003f320: 2069 6e74 2c20 6f70 7469 6f6e 616c 0a20   int, optional. 
+0003f330: 2020 2020 2020 2020 2020 2041 2064 6963             A dic
+0003f340: 7420 7769 7468 206b 6579 7320 6d61 7463  t with keys matc
+0003f350: 6869 6e67 2064 696d 656e 7369 6f6e 7320  hing dimensions 
+0003f360: 616e 6420 7661 6c75 6573 2067 6976 656e  and values given
+0003f370: 0a20 2020 2020 2020 2020 2020 2062 7920  .            by 
+0003f380: 696e 7465 6765 7273 2074 6f20 726f 7461  integers to rota
+0003f390: 7465 2065 6163 6820 6f66 2074 6865 2067  te each of the g
+0003f3a0: 6976 656e 2064 696d 656e 7369 6f6e 732e  iven dimensions.
+0003f3b0: 2050 6f73 6974 6976 650a 2020 2020 2020   Positive.      
+0003f3c0: 2020 2020 2020 6f66 6673 6574 7320 726f        offsets ro
+0003f3d0: 6c6c 2074 6f20 7468 6520 7269 6768 743b  ll to the right;
+0003f3e0: 206e 6567 6174 6976 6520 6f66 6673 6574   negative offset
+0003f3f0: 7320 726f 6c6c 2074 6f20 7468 6520 6c65  s roll to the le
+0003f400: 6674 2e0a 2020 2020 2020 2020 726f 6c6c  ft..        roll
+0003f410: 5f63 6f6f 7264 7320 3a20 626f 6f6c 2c20  _coords : bool, 
+0003f420: 6465 6661 756c 743a 2046 616c 7365 0a20  default: False. 
+0003f430: 2020 2020 2020 2020 2020 2049 6e64 6963             Indic
+0003f440: 6174 6573 2077 6865 7468 6572 2074 6f20  ates whether to 
+0003f450: 726f 6c6c 2074 6865 2063 6f6f 7264 696e  roll the coordin
+0003f460: 6174 6573 2062 7920 7468 6520 6f66 6673  ates by the offs
+0003f470: 6574 2074 6f6f 2e0a 2020 2020 2020 2020  et too..        
+0003f480: 2a2a 7368 6966 7473 5f6b 7761 7267 7320  **shifts_kwargs 
+0003f490: 3a20 7b64 696d 3a20 6f66 6673 6574 2c20  : {dim: offset, 
+0003f4a0: 2e2e 2e7d 2c20 6f70 7469 6f6e 616c 0a20  ...}, optional. 
+0003f4b0: 2020 2020 2020 2020 2020 2054 6865 206b             The k
+0003f4c0: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+0003f4d0: 2066 6f72 6d20 6f66 2060 6073 6869 6674   form of ``shift
+0003f4e0: 7360 602e 0a20 2020 2020 2020 2020 2020  s``..           
+0003f4f0: 204f 6e65 206f 6620 7368 6966 7473 206f   One of shifts o
+0003f500: 7220 7368 6966 7473 5f6b 7761 7267 7320  r shifts_kwargs 
+0003f510: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
+0003f520: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+0003f530: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+0003f540: 2d2d 0a20 2020 2020 2020 2072 6f6c 6c65  --.        rolle
+0003f550: 6420 3a20 4461 7461 7365 740a 2020 2020  d : Dataset.    
+0003f560: 2020 2020 2020 2020 4461 7461 7365 7420          Dataset 
+0003f570: 7769 7468 2074 6865 2073 616d 6520 6174  with the same at
+0003f580: 7472 6962 7574 6573 2062 7574 2072 6f6c  tributes but rol
+0003f590: 6c65 6420 6461 7461 2061 6e64 2063 6f6f  led data and coo
+0003f5a0: 7264 696e 6174 6573 2e0a 0a20 2020 2020  rdinates...     
+0003f5b0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+0003f5c0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0003f5d0: 2020 2020 2073 6869 6674 0a0a 2020 2020       shift..    
+0003f5e0: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
+0003f5f0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+0003f600: 2020 2020 2020 3e3e 3e20 6473 203d 2078        >>> ds = x
+0003f610: 722e 4461 7461 7365 7428 7b22 666f 6f22  r.Dataset({"foo"
+0003f620: 3a20 2822 7822 2c20 6c69 7374 2822 6162  : ("x", list("ab
+0003f630: 6364 6522 2929 7d2c 2063 6f6f 7264 733d  cde"))}, coords=
+0003f640: 7b22 7822 3a20 6e70 2e61 7261 6e67 6528  {"x": np.arange(
+0003f650: 3529 7d29 0a20 2020 2020 2020 203e 3e3e  5)}).        >>>
+0003f660: 2064 732e 726f 6c6c 2878 3d32 290a 2020   ds.roll(x=2).  
+0003f670: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
+0003f680: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
+0003f690: 696d 656e 7369 6f6e 733a 2020 2878 3a20  imensions:  (x: 
+0003f6a0: 3529 0a20 2020 2020 2020 2043 6f6f 7264  5).        Coord
+0003f6b0: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
+0003f6c0: 2020 2a20 7820 2020 2020 2020 2028 7829    * x        (x)
+0003f6d0: 2069 6e74 3634 2030 2031 2032 2033 2034   int64 0 1 2 3 4
+0003f6e0: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
+0003f6f0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+0003f700: 2020 2020 2066 6f6f 2020 2020 2020 2878       foo      (x
+0003f710: 2920 3c55 3120 2764 2720 2765 2720 2761  ) <U1 'd' 'e' 'a
+0003f720: 2720 2762 2720 2763 270a 0a20 2020 2020  ' 'b' 'c'..     
+0003f730: 2020 203e 3e3e 2064 732e 726f 6c6c 2878     >>> ds.roll(x
+0003f740: 3d32 2c20 726f 6c6c 5f63 6f6f 7264 733d  =2, roll_coords=
+0003f750: 5472 7565 290a 2020 2020 2020 2020 3c78  True).        <x
+0003f760: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
+0003f770: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+0003f780: 733a 2020 2878 3a20 3529 0a20 2020 2020  s:  (x: 5).     
+0003f790: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+0003f7a0: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
+0003f7b0: 2020 2020 2028 7829 2069 6e74 3634 2033       (x) int64 3
+0003f7c0: 2034 2030 2031 2032 0a20 2020 2020 2020   4 0 1 2.       
+0003f7d0: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
+0003f7e0: 0a20 2020 2020 2020 2020 2020 2066 6f6f  .            foo
+0003f7f0: 2020 2020 2020 2878 2920 3c55 3120 2764        (x) <U1 'd
+0003f800: 2720 2765 2720 2761 2720 2762 2720 2763  ' 'e' 'a' 'b' 'c
+0003f810: 270a 0a20 2020 2020 2020 2022 2222 0a20  '..        """. 
+0003f820: 2020 2020 2020 2073 6869 6674 7320 3d20         shifts = 
+0003f830: 6569 7468 6572 5f64 6963 745f 6f72 5f6b  either_dict_or_k
+0003f840: 7761 7267 7328 7368 6966 7473 2c20 7368  wargs(shifts, sh
+0003f850: 6966 7473 5f6b 7761 7267 732c 2022 726f  ifts_kwargs, "ro
+0003f860: 6c6c 2229 0a20 2020 2020 2020 2069 6e76  ll").        inv
+0003f870: 616c 6964 203d 205b 6b20 666f 7220 6b20  alid = [k for k 
+0003f880: 696e 2073 6869 6674 7320 6966 206b 206e  in shifts if k n
+0003f890: 6f74 2069 6e20 7365 6c66 2e64 696d 735d  ot in self.dims]
+0003f8a0: 0a20 2020 2020 2020 2069 6620 696e 7661  .        if inva
+0003f8b0: 6c69 643a 0a20 2020 2020 2020 2020 2020  lid:.           
+0003f8c0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0003f8d0: 7228 6622 6469 6d65 6e73 696f 6e73 207b  r(f"dimensions {
+0003f8e0: 696e 7661 6c69 6421 727d 2064 6f20 6e6f  invalid!r} do no
+0003f8f0: 7420 6578 6973 7422 290a 0a20 2020 2020  t exist")..     
+0003f900: 2020 2075 6e72 6f6c 6c65 645f 7661 7273     unrolled_vars
+0003f910: 3a20 7475 706c 655b 4861 7368 6162 6c65  : tuple[Hashable
+0003f920: 2c20 2e2e 2e5d 0a0a 2020 2020 2020 2020  , ...]..        
+0003f930: 6966 2072 6f6c 6c5f 636f 6f72 6473 3a0a  if roll_coords:.
+0003f940: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+0003f950: 7865 732c 2069 6e64 6578 5f76 6172 7320  xes, index_vars 
+0003f960: 3d20 726f 6c6c 5f69 6e64 6578 6573 2873  = roll_indexes(s
+0003f970: 656c 662e 7869 6e64 6578 6573 2c20 7368  elf.xindexes, sh
+0003f980: 6966 7473 290a 2020 2020 2020 2020 2020  ifts).          
+0003f990: 2020 756e 726f 6c6c 6564 5f76 6172 7320    unrolled_vars 
+0003f9a0: 3d20 2829 0a20 2020 2020 2020 2065 6c73  = ().        els
+0003f9b0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+0003f9c0: 6e64 6578 6573 203d 2064 6963 7428 7365  ndexes = dict(se
+0003f9d0: 6c66 2e5f 696e 6465 7865 7329 0a20 2020  lf._indexes).   
+0003f9e0: 2020 2020 2020 2020 2069 6e64 6578 5f76           index_v
+0003f9f0: 6172 7320 3d20 6469 6374 2873 656c 662e  ars = dict(self.
+0003fa00: 7869 6e64 6578 6573 2e76 6172 6961 626c  xindexes.variabl
+0003fa10: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+0003fa20: 756e 726f 6c6c 6564 5f76 6172 7320 3d20  unrolled_vars = 
+0003fa30: 7475 706c 6528 7365 6c66 2e63 6f6f 7264  tuple(self.coord
+0003fa40: 7329 0a0a 2020 2020 2020 2020 7661 7269  s)..        vari
+0003fa50: 6162 6c65 7320 3d20 7b7d 0a20 2020 2020  ables = {}.     
+0003fa60: 2020 2066 6f72 206b 2c20 7661 7220 696e     for k, var in
+0003fa70: 2073 656c 662e 7661 7269 6162 6c65 732e   self.variables.
+0003fa80: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0003fa90: 2020 2020 2069 6620 6b20 696e 2069 6e64       if k in ind
+0003faa0: 6578 5f76 6172 733a 0a20 2020 2020 2020  ex_vars:.       
+0003fab0: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+0003fac0: 6573 5b6b 5d20 3d20 696e 6465 785f 7661  es[k] = index_va
+0003fad0: 7273 5b6b 5d0a 2020 2020 2020 2020 2020  rs[k].          
+0003fae0: 2020 656c 6966 206b 206e 6f74 2069 6e20    elif k not in 
+0003faf0: 756e 726f 6c6c 6564 5f76 6172 733a 0a20  unrolled_vars:. 
+0003fb00: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0003fb10: 6172 6961 626c 6573 5b6b 5d20 3d20 7661  ariables[k] = va
+0003fb20: 722e 726f 6c6c 280a 2020 2020 2020 2020  r.roll(.        
+0003fb30: 2020 2020 2020 2020 2020 2020 7368 6966              shif
+0003fb40: 7473 3d7b 6b3a 2073 2066 6f72 206b 2c20  ts={k: s for k, 
+0003fb50: 7320 696e 2073 6869 6674 732e 6974 656d  s in shifts.item
+0003fb60: 7328 2920 6966 206b 2069 6e20 7661 722e  s() if k in var.
+0003fb70: 6469 6d73 7d0a 2020 2020 2020 2020 2020  dims}.          
+0003fb80: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0003fb90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003fba0: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+0003fbb0: 6c65 735b 6b5d 203d 2076 6172 0a0a 2020  les[k] = var..  
+0003fbc0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0003fbd0: 662e 5f72 6570 6c61 6365 2876 6172 6961  f._replace(varia
+0003fbe0: 626c 6573 2c20 696e 6465 7865 733d 696e  bles, indexes=in
+0003fbf0: 6465 7865 7329 0a0a 2020 2020 6465 6620  dexes)..    def 
+0003fc00: 736f 7274 6279 280a 2020 2020 2020 2020  sortby(.        
+0003fc10: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
+0003fc20: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
+0003fc30: 6573 3a20 4861 7368 6162 6c65 207c 2044  es: Hashable | D
+0003fc40: 6174 6141 7272 6179 207c 206c 6973 745b  ataArray | list[
+0003fc50: 4861 7368 6162 6c65 207c 2044 6174 6141  Hashable | DataA
+0003fc60: 7272 6179 5d2c 0a20 2020 2020 2020 2061  rray],.        a
+0003fc70: 7363 656e 6469 6e67 3a20 626f 6f6c 203d  scending: bool =
+0003fc80: 2054 7275 652c 0a20 2020 2029 202d 3e20   True,.    ) -> 
+0003fc90: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+0003fca0: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
+0003fcb0: 6f72 7420 6f62 6a65 6374 2062 7920 6c61  ort object by la
+0003fcc0: 6265 6c73 206f 7220 7661 6c75 6573 2028  bels or values (
+0003fcd0: 616c 6f6e 6720 616e 2061 7869 7329 2e0a  along an axis)..
+0003fce0: 0a20 2020 2020 2020 2053 6f72 7473 2074  .        Sorts t
+0003fcf0: 6865 2064 6174 6173 6574 2c20 6569 7468  he dataset, eith
+0003fd00: 6572 2061 6c6f 6e67 2073 7065 6369 6669  er along specifi
+0003fd10: 6564 2064 696d 656e 7369 6f6e 732c 0a20  ed dimensions,. 
+0003fd20: 2020 2020 2020 206f 7220 6163 636f 7264         or accord
+0003fd30: 696e 6720 746f 2076 616c 7565 7320 6f66  ing to values of
+0003fd40: 2031 2d44 2064 6174 6161 7272 6179 7320   1-D dataarrays 
+0003fd50: 7468 6174 2073 6861 7265 2064 696d 656e  that share dimen
+0003fd60: 7369 6f6e 0a20 2020 2020 2020 2077 6974  sion.        wit
+0003fd70: 6820 6361 6c6c 696e 6720 6f62 6a65 6374  h calling object
+0003fd80: 2e0a 0a20 2020 2020 2020 2049 6620 7468  ...        If th
+0003fd90: 6520 696e 7075 7420 7661 7269 6162 6c65  e input variable
+0003fda0: 7320 6172 6520 6461 7461 6172 7261 7973  s are dataarrays
+0003fdb0: 2c20 7468 656e 2074 6865 2064 6174 6161  , then the dataa
+0003fdc0: 7272 6179 7320 6172 6520 616c 6967 6e65  rrays are aligne
+0003fdd0: 640a 2020 2020 2020 2020 2876 6961 206c  d.        (via l
+0003fde0: 6566 742d 6a6f 696e 2920 746f 2074 6865  eft-join) to the
+0003fdf0: 2063 616c 6c69 6e67 206f 626a 6563 7420   calling object 
+0003fe00: 7072 696f 7220 746f 2073 6f72 7469 6e67  prior to sorting
+0003fe10: 2062 7920 6365 6c6c 2076 616c 7565 732e   by cell values.
+0003fe20: 0a20 2020 2020 2020 204e 614e 7320 6172  .        NaNs ar
+0003fe30: 6520 736f 7274 6564 2074 6f20 7468 6520  e sorted to the 
+0003fe40: 656e 642c 2066 6f6c 6c6f 7769 6e67 204e  end, following N
+0003fe50: 756d 7079 2063 6f6e 7665 6e74 696f 6e2e  umpy convention.
+0003fe60: 0a0a 2020 2020 2020 2020 4966 206d 756c  ..        If mul
+0003fe70: 7469 706c 6520 736f 7274 7320 616c 6f6e  tiple sorts alon
+0003fe80: 6720 7468 6520 7361 6d65 2064 696d 656e  g the same dimen
+0003fe90: 7369 6f6e 2069 730a 2020 2020 2020 2020  sion is.        
+0003fea0: 6769 7665 6e2c 206e 756d 7079 2773 206c  given, numpy's l
+0003feb0: 6578 736f 7274 2069 7320 7065 7266 6f72  exsort is perfor
+0003fec0: 6d65 6420 616c 6f6e 6720 7468 6174 2064  med along that d
+0003fed0: 696d 656e 7369 6f6e 3a0a 2020 2020 2020  imension:.      
+0003fee0: 2020 6874 7470 733a 2f2f 6e75 6d70 792e    https://numpy.
+0003fef0: 6f72 672f 646f 632f 7374 6162 6c65 2f72  org/doc/stable/r
+0003ff00: 6566 6572 656e 6365 2f67 656e 6572 6174  eference/generat
+0003ff10: 6564 2f6e 756d 7079 2e6c 6578 736f 7274  ed/numpy.lexsort
+0003ff20: 2e68 746d 6c0a 2020 2020 2020 2020 616e  .html.        an
+0003ff30: 6420 7468 6520 4649 5253 5420 6b65 7920  d the FIRST key 
+0003ff40: 696e 2074 6865 2073 6571 7565 6e63 6520  in the sequence 
+0003ff50: 6973 2075 7365 6420 6173 2074 6865 2070  is used as the p
+0003ff60: 7269 6d61 7279 2073 6f72 7420 6b65 792c  rimary sort key,
+0003ff70: 0a20 2020 2020 2020 2066 6f6c 6c6f 7765  .        followe
+0003ff80: 6420 6279 2074 6865 2032 6e64 206b 6579  d by the 2nd key
+0003ff90: 2c20 6574 632e 0a0a 2020 2020 2020 2020  , etc...        
+0003ffa0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+0003ffb0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0003ffc0: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
+0003ffd0: 3a20 4861 7368 6162 6c65 2c20 4461 7461  : Hashable, Data
+0003ffe0: 4172 7261 792c 206f 7220 6c69 7374 206f  Array, or list o
+0003fff0: 6620 6861 7368 6162 6c65 206f 7220 4461  f hashable or Da
+00040000: 7461 4172 7261 790a 2020 2020 2020 2020  taArray.        
+00040010: 2020 2020 3144 2044 6174 6141 7272 6179      1D DataArray
+00040020: 206f 626a 6563 7473 206f 7220 6e61 6d65   objects or name
+00040030: 2873 2920 6f66 2031 4420 7661 7269 6162  (s) of 1D variab
+00040040: 6c65 2873 2920 696e 0a20 2020 2020 2020  le(s) in.       
+00040050: 2020 2020 2063 6f6f 7264 732f 6461 7461       coords/data
+00040060: 5f76 6172 7320 7768 6f73 6520 7661 6c75  _vars whose valu
+00040070: 6573 2061 7265 2075 7365 6420 746f 2073  es are used to s
+00040080: 6f72 7420 7468 6520 6461 7461 7365 742e  ort the dataset.
+00040090: 0a20 2020 2020 2020 2061 7363 656e 6469  .        ascendi
+000400a0: 6e67 203a 2062 6f6f 6c2c 2064 6566 6175  ng : bool, defau
+000400b0: 6c74 3a20 5472 7565 0a20 2020 2020 2020  lt: True.       
+000400c0: 2020 2020 2057 6865 7468 6572 2074 6f20       Whether to 
+000400d0: 736f 7274 2062 7920 6173 6365 6e64 696e  sort by ascendin
+000400e0: 6720 6f72 2064 6573 6365 6e64 696e 6720  g or descending 
+000400f0: 6f72 6465 722e 0a0a 2020 2020 2020 2020  order...        
+00040100: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+00040110: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00040120: 736f 7274 6564 203a 2044 6174 6173 6574  sorted : Dataset
+00040130: 0a20 2020 2020 2020 2020 2020 2041 206e  .            A n
+00040140: 6577 2064 6174 6173 6574 2077 6865 7265  ew dataset where
+00040150: 2061 6c6c 2074 6865 2073 7065 6369 6669   all the specifi
+00040160: 6564 2064 696d 7320 6172 6520 736f 7274  ed dims are sort
+00040170: 6564 2062 7920 6469 6d0a 2020 2020 2020  ed by dim.      
+00040180: 2020 2020 2020 6c61 6265 6c73 2e0a 0a20        labels... 
+00040190: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+000401a0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000401b0: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
+000401c0: 6179 2e73 6f72 7462 790a 2020 2020 2020  ay.sortby.      
+000401d0: 2020 6e75 6d70 792e 736f 7274 0a20 2020    numpy.sort.   
+000401e0: 2020 2020 2070 616e 6461 732e 736f 7274       pandas.sort
+000401f0: 5f76 616c 7565 730a 2020 2020 2020 2020  _values.        
+00040200: 7061 6e64 6173 2e73 6f72 745f 696e 6465  pandas.sort_inde
+00040210: 780a 0a20 2020 2020 2020 2045 7861 6d70  x..        Examp
+00040220: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
+00040230: 2d2d 2d2d 0a20 2020 2020 2020 203e 3e3e  ----.        >>>
+00040240: 2064 7320 3d20 7872 2e44 6174 6173 6574   ds = xr.Dataset
+00040250: 280a 2020 2020 2020 2020 2e2e 2e20 2020  (.        ...   
+00040260: 2020 7b0a 2020 2020 2020 2020 2e2e 2e20    {.        ... 
+00040270: 2020 2020 2020 2020 2241 223a 2028 2822          "A": (("
+00040280: 7822 2c20 2279 2229 2c20 5b5b 312c 2032  x", "y"), [[1, 2
+00040290: 5d2c 205b 332c 2034 5d5d 292c 0a20 2020  ], [3, 4]]),.   
+000402a0: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
+000402b0: 2022 4222 3a20 2828 2278 222c 2022 7922   "B": (("x", "y"
+000402c0: 292c 205b 5b35 2c20 365d 2c20 5b37 2c20  ), [[5, 6], [7, 
+000402d0: 385d 5d29 2c0a 2020 2020 2020 2020 2e2e  8]]),.        ..
+000402e0: 2e20 2020 2020 7d2c 0a20 2020 2020 2020  .     },.       
+000402f0: 202e 2e2e 2020 2020 2063 6f6f 7264 733d   ...     coords=
+00040300: 7b22 7822 3a20 5b22 6222 2c20 2261 225d  {"x": ["b", "a"]
+00040310: 2c20 2279 223a 205b 312c 2030 5d7d 2c0a  , "y": [1, 0]},.
+00040320: 2020 2020 2020 2020 2e2e 2e20 290a 2020          ... ).  
+00040330: 2020 2020 2020 3e3e 3e20 6473 203d 2064        >>> ds = d
+00040340: 732e 736f 7274 6279 2822 7822 290a 2020  s.sortby("x").  
+00040350: 2020 2020 2020 3e3e 3e20 6473 0a20 2020        >>> ds.   
+00040360: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
+00040370: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
+00040380: 6d65 6e73 696f 6e73 3a20 2028 783a 2032  mensions:  (x: 2
+00040390: 2c20 793a 2032 290a 2020 2020 2020 2020  , y: 2).        
+000403a0: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
+000403b0: 2020 2020 2020 202a 2078 2020 2020 2020         * x      
+000403c0: 2020 2878 2920 3c55 3120 2761 2720 2762    (x) <U1 'a' 'b
+000403d0: 270a 2020 2020 2020 2020 2020 2a20 7920  '.          * y 
+000403e0: 2020 2020 2020 2028 7929 2069 6e74 3634         (y) int64
+000403f0: 2031 2030 0a20 2020 2020 2020 2044 6174   1 0.        Dat
+00040400: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
+00040410: 2020 2020 2020 2020 2041 2020 2020 2020           A      
+00040420: 2020 2878 2c20 7929 2069 6e74 3634 2033    (x, y) int64 3
+00040430: 2034 2031 2032 0a20 2020 2020 2020 2020   4 1 2.         
+00040440: 2020 2042 2020 2020 2020 2020 2878 2c20     B        (x, 
+00040450: 7929 2069 6e74 3634 2037 2038 2035 2036  y) int64 7 8 5 6
+00040460: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00040470: 2020 2020 2066 726f 6d20 7861 7272 6179       from xarray
+00040480: 2e63 6f72 652e 6461 7461 6172 7261 7920  .core.dataarray 
+00040490: 696d 706f 7274 2044 6174 6141 7272 6179  import DataArray
+000404a0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+000404b0: 2069 7369 6e73 7461 6e63 6528 7661 7269   isinstance(vari
+000404c0: 6162 6c65 732c 206c 6973 7429 3a0a 2020  ables, list):.  
+000404d0: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+000404e0: 6c65 7320 3d20 5b76 6172 6961 626c 6573  les = [variables
+000404f0: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
+00040500: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+00040510: 6162 6c65 7320 3d20 7661 7269 6162 6c65  ables = variable
+00040520: 730a 2020 2020 2020 2020 6172 7261 7973  s.        arrays
+00040530: 203d 205b 7620 6966 2069 7369 6e73 7461   = [v if isinsta
+00040540: 6e63 6528 762c 2044 6174 6141 7272 6179  nce(v, DataArray
+00040550: 2920 656c 7365 2073 656c 665b 765d 2066  ) else self[v] f
+00040560: 6f72 2076 2069 6e20 7661 7269 6162 6c65  or v in variable
+00040570: 735d 0a20 2020 2020 2020 2061 6c69 676e  s].        align
+00040580: 6564 5f76 6172 7320 3d20 616c 6967 6e28  ed_vars = align(
+00040590: 7365 6c66 2c20 2a61 7272 6179 732c 206a  self, *arrays, j
+000405a0: 6f69 6e3d 226c 6566 7422 2920 2023 2074  oin="left")  # t
+000405b0: 7970 653a 2069 676e 6f72 655b 7479 7065  ype: ignore[type
+000405c0: 2d76 6172 5d0a 2020 2020 2020 2020 616c  -var].        al
+000405d0: 6967 6e65 645f 7365 6c66 3a20 545f 4461  igned_self: T_Da
+000405e0: 7461 7365 7420 3d20 616c 6967 6e65 645f  taset = aligned_
+000405f0: 7661 7273 5b30 5d20 2023 2074 7970 653a  vars[0]  # type:
+00040600: 2069 676e 6f72 655b 6173 7369 676e 6d65   ignore[assignme
+00040610: 6e74 5d0a 2020 2020 2020 2020 616c 6967  nt].        alig
+00040620: 6e65 645f 6f74 6865 725f 7661 7273 3a20  ned_other_vars: 
+00040630: 7475 706c 655b 4461 7461 4172 7261 792c  tuple[DataArray,
+00040640: 202e 2e2e 5d20 3d20 616c 6967 6e65 645f   ...] = aligned_
+00040650: 7661 7273 5b31 3a5d 2020 2320 7479 7065  vars[1:]  # type
+00040660: 3a20 6967 6e6f 7265 5b61 7373 6967 6e6d  : ignore[assignm
+00040670: 656e 745d 0a20 2020 2020 2020 2076 6172  ent].        var
+00040680: 735f 6279 5f64 696d 203d 2064 6566 6175  s_by_dim = defau
+00040690: 6c74 6469 6374 286c 6973 7429 0a20 2020  ltdict(list).   
+000406a0: 2020 2020 2066 6f72 2064 6174 615f 6172       for data_ar
+000406b0: 7261 7920 696e 2061 6c69 676e 6564 5f6f  ray in aligned_o
+000406c0: 7468 6572 5f76 6172 733a 0a20 2020 2020  ther_vars:.     
+000406d0: 2020 2020 2020 2069 6620 6461 7461 5f61         if data_a
+000406e0: 7272 6179 2e6e 6469 6d20 213d 2031 3a0a  rray.ndim != 1:.
+000406f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040700: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00040710: 2822 496e 7075 7420 4461 7461 4172 7261  ("Input DataArra
+00040720: 7920 6973 206e 6f74 2031 2d44 2e22 290a  y is not 1-D.").
+00040730: 2020 2020 2020 2020 2020 2020 286b 6579              (key
+00040740: 2c29 203d 2064 6174 615f 6172 7261 792e  ,) = data_array.
+00040750: 6469 6d73 0a20 2020 2020 2020 2020 2020  dims.           
+00040760: 2076 6172 735f 6279 5f64 696d 5b6b 6579   vars_by_dim[key
+00040770: 5d2e 6170 7065 6e64 2864 6174 615f 6172  ].append(data_ar
+00040780: 7261 7929 0a0a 2020 2020 2020 2020 696e  ray)..        in
+00040790: 6469 6365 7320 3d20 7b7d 0a20 2020 2020  dices = {}.     
+000407a0: 2020 2066 6f72 206b 6579 2c20 6172 7261     for key, arra
+000407b0: 7973 2069 6e20 7661 7273 5f62 795f 6469  ys in vars_by_di
+000407c0: 6d2e 6974 656d 7328 293a 0a20 2020 2020  m.items():.     
+000407d0: 2020 2020 2020 206f 7264 6572 203d 206e         order = n
+000407e0: 702e 6c65 7873 6f72 7428 7475 706c 6528  p.lexsort(tuple(
+000407f0: 7265 7665 7273 6564 2861 7272 6179 7329  reversed(arrays)
+00040800: 2929 0a20 2020 2020 2020 2020 2020 2069  )).            i
+00040810: 6e64 6963 6573 5b6b 6579 5d20 3d20 6f72  ndices[key] = or
+00040820: 6465 7220 6966 2061 7363 656e 6469 6e67  der if ascending
+00040830: 2065 6c73 6520 6f72 6465 725b 3a3a 2d31   else order[::-1
+00040840: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
+00040850: 2061 6c69 676e 6564 5f73 656c 662e 6973   aligned_self.is
+00040860: 656c 2869 6e64 6963 6573 290a 0a20 2020  el(indices)..   
+00040870: 2064 6566 2071 7561 6e74 696c 6528 0a20   def quantile(. 
+00040880: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
+00040890: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
+000408a0: 713a 2041 7272 6179 4c69 6b65 2c0a 2020  q: ArrayLike,.  
+000408b0: 2020 2020 2020 6469 6d3a 2044 696d 7320        dim: Dims 
+000408c0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000408d0: 6d65 7468 6f64 3a20 5175 616e 7469 6c65  method: Quantile
+000408e0: 4d65 7468 6f64 7320 3d20 226c 696e 6561  Methods = "linea
+000408f0: 7222 2c0a 2020 2020 2020 2020 6e75 6d65  r",.        nume
+00040900: 7269 635f 6f6e 6c79 3a20 626f 6f6c 203d  ric_only: bool =
+00040910: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+00040920: 6b65 6570 5f61 7474 7273 3a20 626f 6f6c  keep_attrs: bool
+00040930: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00040940: 2020 2020 2020 2020 736b 6970 6e61 3a20          skipna: 
+00040950: 626f 6f6c 207c 204e 6f6e 6520 3d20 4e6f  bool | None = No
+00040960: 6e65 2c0a 2020 2020 2020 2020 696e 7465  ne,.        inte
+00040970: 7270 6f6c 6174 696f 6e3a 2051 7561 6e74  rpolation: Quant
+00040980: 696c 654d 6574 686f 6473 207c 204e 6f6e  ileMethods | Non
+00040990: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
+000409a0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+000409b0: 2020 2020 2020 2222 2243 6f6d 7075 7465        """Compute
+000409c0: 2074 6865 2071 7468 2071 7561 6e74 696c   the qth quantil
+000409d0: 6520 6f66 2074 6865 2064 6174 6120 616c  e of the data al
+000409e0: 6f6e 6720 7468 6520 7370 6563 6966 6965  ong the specifie
+000409f0: 6420 6469 6d65 6e73 696f 6e2e 0a0a 2020  d dimension...  
+00040a00: 2020 2020 2020 5265 7475 726e 7320 7468        Returns th
+00040a10: 6520 7174 6820 7175 616e 7469 6c65 7328  e qth quantiles(
+00040a20: 7329 206f 6620 7468 6520 6172 7261 7920  s) of the array 
+00040a30: 656c 656d 656e 7473 2066 6f72 2065 6163  elements for eac
+00040a40: 6820 7661 7269 6162 6c65 0a20 2020 2020  h variable.     
+00040a50: 2020 2069 6e20 7468 6520 4461 7461 7365     in the Datase
+00040a60: 742e 0a0a 2020 2020 2020 2020 5061 7261  t...        Para
+00040a70: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+00040a80: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00040a90: 2020 7120 3a20 666c 6f61 7420 6f72 2061    q : float or a
+00040aa0: 7272 6179 2d6c 696b 6520 6f66 2066 6c6f  rray-like of flo
+00040ab0: 6174 0a20 2020 2020 2020 2020 2020 2051  at.            Q
+00040ac0: 7561 6e74 696c 6520 746f 2063 6f6d 7075  uantile to compu
+00040ad0: 7465 2c20 7768 6963 6820 6d75 7374 2062  te, which must b
+00040ae0: 6520 6265 7477 6565 6e20 3020 616e 6420  e between 0 and 
+00040af0: 3120 696e 636c 7573 6976 652e 0a20 2020  1 inclusive..   
+00040b00: 2020 2020 2064 696d 203a 2073 7472 206f       dim : str o
+00040b10: 7220 4974 6572 6162 6c65 206f 6620 4861  r Iterable of Ha
+00040b20: 7368 6162 6c65 2c20 6f70 7469 6f6e 616c  shable, optional
+00040b30: 0a20 2020 2020 2020 2020 2020 2044 696d  .            Dim
+00040b40: 656e 7369 6f6e 2873 2920 6f76 6572 2077  ension(s) over w
+00040b50: 6869 6368 2074 6f20 6170 706c 7920 7175  hich to apply qu
+00040b60: 616e 7469 6c65 2e0a 2020 2020 2020 2020  antile..        
+00040b70: 6d65 7468 6f64 203a 2073 7472 2c20 6465  method : str, de
+00040b80: 6661 756c 743a 2022 6c69 6e65 6172 220a  fault: "linear".
+00040b90: 2020 2020 2020 2020 2020 2020 5468 6973              This
+00040ba0: 206f 7074 696f 6e61 6c20 7061 7261 6d65   optional parame
+00040bb0: 7465 7220 7370 6563 6966 6965 7320 7468  ter specifies th
+00040bc0: 6520 696e 7465 7270 6f6c 6174 696f 6e20  e interpolation 
+00040bd0: 6d65 7468 6f64 2074 6f20 7573 6520 7768  method to use wh
+00040be0: 656e 2074 6865 0a20 2020 2020 2020 2020  en the.         
+00040bf0: 2020 2064 6573 6972 6564 2071 7561 6e74     desired quant
+00040c00: 696c 6520 6c69 6573 2062 6574 7765 656e  ile lies between
+00040c10: 2074 776f 2064 6174 6120 706f 696e 7473   two data points
+00040c20: 2e20 5468 6520 6f70 7469 6f6e 7320 736f  . The options so
+00040c30: 7274 6564 2062 7920 7468 6569 7220 520a  rted by their R.
+00040c40: 2020 2020 2020 2020 2020 2020 7479 7065              type
+00040c50: 2061 7320 7375 6d6d 6172 697a 6564 2069   as summarized i
+00040c60: 6e20 7468 6520 4826 4620 7061 7065 7220  n the H&F paper 
+00040c70: 5b31 5d5f 2061 7265 3a0a 0a20 2020 2020  [1]_ are:..     
+00040c80: 2020 2020 2020 2020 2020 2031 2e20 2269             1. "i
+00040c90: 6e76 6572 7465 645f 6364 6622 2028 2a29  nverted_cdf" (*)
+00040ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040cb0: 2032 2e20 2261 7665 7261 6765 645f 696e   2. "averaged_in
+00040cc0: 7665 7274 6564 5f63 6466 2220 282a 290a  verted_cdf" (*).
+00040cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040ce0: 332e 2022 636c 6f73 6573 745f 6f62 7365  3. "closest_obse
+00040cf0: 7276 6174 696f 6e22 2028 2a29 0a20 2020  rvation" (*).   
+00040d00: 2020 2020 2020 2020 2020 2020 2034 2e20               4. 
+00040d10: 2269 6e74 6572 706f 6c61 7465 645f 696e  "interpolated_in
+00040d20: 7665 7274 6564 5f63 6466 2220 282a 290a  verted_cdf" (*).
+00040d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040d40: 352e 2022 6861 7a65 6e22 2028 2a29 0a20  5. "hazen" (*). 
+00040d50: 2020 2020 2020 2020 2020 2020 2020 2036                 6
+00040d60: 2e20 2277 6569 6275 6c6c 2220 282a 290a  . "weibull" (*).
+00040d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040d80: 372e 2022 6c69 6e65 6172 2220 2028 6465  7. "linear"  (de
+00040d90: 6661 756c 7429 0a20 2020 2020 2020 2020  fault).         
+00040da0: 2020 2020 2020 2038 2e20 226d 6564 6961         8. "media
+00040db0: 6e5f 756e 6269 6173 6564 2220 282a 290a  n_unbiased" (*).
+00040dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040dd0: 392e 2022 6e6f 726d 616c 5f75 6e62 6961  9. "normal_unbia
+00040de0: 7365 6422 2028 2a29 0a0a 2020 2020 2020  sed" (*)..      
+00040df0: 2020 2020 2020 5468 6520 6669 7273 7420        The first 
+00040e00: 7468 7265 6520 6d65 7468 6f64 7320 6172  three methods ar
+00040e10: 6520 6469 7363 6f6e 7469 756f 7573 2e20  e discontiuous. 
+00040e20: 2054 6865 2066 6f6c 6c6f 7769 6e67 2064   The following d
+00040e30: 6973 636f 6e74 696e 756f 7573 0a20 2020  iscontinuous.   
+00040e40: 2020 2020 2020 2020 2076 6172 6961 7469           variati
+00040e50: 6f6e 7320 6f66 2074 6865 2064 6566 6175  ons of the defau
+00040e60: 6c74 2022 6c69 6e65 6172 2220 2837 2e29  lt "linear" (7.)
+00040e70: 206f 7074 696f 6e20 6172 6520 616c 736f   option are also
+00040e80: 2061 7661 696c 6162 6c65 3a0a 0a20 2020   available:..   
+00040e90: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00040ea0: 6c6f 7765 7222 0a20 2020 2020 2020 2020  lower".         
+00040eb0: 2020 2020 2020 202a 2022 6869 6768 6572         * "higher
+00040ec0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00040ed0: 2020 2a20 226d 6964 706f 696e 7422 0a20    * "midpoint". 
+00040ee0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00040ef0: 2022 6e65 6172 6573 7422 0a0a 2020 2020   "nearest"..    
+00040f00: 2020 2020 2020 2020 5365 6520 3a70 793a          See :py:
+00040f10: 6675 6e63 3a60 6e75 6d70 792e 7175 616e  func:`numpy.quan
+00040f20: 7469 6c65 6020 6f72 205b 315d 5f20 666f  tile` or [1]_ fo
+00040f30: 7220 6465 7461 696c 732e 2054 6865 2022  r details. The "
+00040f40: 6d65 7468 6f64 2220 6172 6775 6d65 6e74  method" argument
+00040f50: 0a20 2020 2020 2020 2020 2020 2077 6173  .            was
+00040f60: 2070 7265 7669 6f75 736c 7920 6361 6c6c   previously call
+00040f70: 6564 2022 696e 7465 7270 6f6c 6174 696f  ed "interpolatio
+00040f80: 6e22 2c20 7265 6e61 6d65 6420 696e 2061  n", renamed in a
+00040f90: 6363 6f72 6461 6e63 6520 7769 7468 206e  ccordance with n
+00040fa0: 756d 7079 0a20 2020 2020 2020 2020 2020  umpy.           
+00040fb0: 2076 6572 7369 6f6e 2031 2e32 322e 302e   version 1.22.0.
+00040fc0: 0a0a 2020 2020 2020 2020 2020 2020 282a  ..            (*
+00040fd0: 2920 5468 6573 6520 6d65 7468 6f64 7320  ) These methods 
+00040fe0: 7265 7175 6972 6520 6e75 6d70 7920 7665  require numpy ve
+00040ff0: 7273 696f 6e20 312e 3232 206f 7220 6e65  rsion 1.22 or ne
+00041000: 7765 722e 0a0a 2020 2020 2020 2020 6b65  wer...        ke
+00041010: 6570 5f61 7474 7273 203a 2062 6f6f 6c2c  ep_attrs : bool,
+00041020: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00041030: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
+00041040: 6865 2064 6174 6173 6574 2773 2061 7474  he dataset's att
+00041050: 7269 6275 7465 7320 2860 6174 7472 7360  ributes (`attrs`
+00041060: 2920 7769 6c6c 2062 6520 636f 7069 6564  ) will be copied
+00041070: 2066 726f 6d0a 2020 2020 2020 2020 2020   from.          
+00041080: 2020 7468 6520 6f72 6967 696e 616c 206f    the original o
+00041090: 626a 6563 7420 746f 2074 6865 206e 6577  bject to the new
+000410a0: 206f 6e65 2e20 2049 6620 4661 6c73 6520   one.  If False 
+000410b0: 2864 6566 6175 6c74 292c 2074 6865 206e  (default), the n
+000410c0: 6577 0a20 2020 2020 2020 2020 2020 206f  ew.            o
+000410d0: 626a 6563 7420 7769 6c6c 2062 6520 7265  bject will be re
+000410e0: 7475 726e 6564 2077 6974 686f 7574 2061  turned without a
+000410f0: 7474 7269 6275 7465 732e 0a20 2020 2020  ttributes..     
+00041100: 2020 206e 756d 6572 6963 5f6f 6e6c 7920     numeric_only 
+00041110: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
+00041120: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00041130: 5472 7565 2c20 6f6e 6c79 2061 7070 6c79  True, only apply
+00041140: 2060 6066 756e 6360 6020 746f 2076 6172   ``func`` to var
+00041150: 6961 626c 6573 2077 6974 6820 6120 6e75  iables with a nu
+00041160: 6d65 7269 6320 6474 7970 652e 0a20 2020  meric dtype..   
+00041170: 2020 2020 2073 6b69 706e 6120 3a20 626f       skipna : bo
+00041180: 6f6c 2c20 6f70 7469 6f6e 616c 0a20 2020  ol, optional.   
+00041190: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+000411a0: 2c20 736b 6970 206d 6973 7369 6e67 2076  , skip missing v
+000411b0: 616c 7565 7320 2861 7320 6d61 726b 6564  alues (as marked
+000411c0: 2062 7920 4e61 4e29 2e20 4279 2064 6566   by NaN). By def
+000411d0: 6175 6c74 2c20 6f6e 6c79 0a20 2020 2020  ault, only.     
+000411e0: 2020 2020 2020 2073 6b69 7073 206d 6973         skips mis
+000411f0: 7369 6e67 2076 616c 7565 7320 666f 7220  sing values for 
+00041200: 666c 6f61 7420 6474 7970 6573 3b20 6f74  float dtypes; ot
+00041210: 6865 7220 6474 7970 6573 2065 6974 6865  her dtypes eithe
+00041220: 7220 646f 206e 6f74 0a20 2020 2020 2020  r do not.       
+00041230: 2020 2020 2068 6176 6520 6120 7365 6e74       have a sent
+00041240: 696e 656c 206d 6973 7369 6e67 2076 616c  inel missing val
+00041250: 7565 2028 696e 7429 206f 7220 736b 6970  ue (int) or skip
+00041260: 6e61 3d54 7275 6520 6861 7320 6e6f 7420  na=True has not 
+00041270: 6265 656e 0a20 2020 2020 2020 2020 2020  been.           
+00041280: 2069 6d70 6c65 6d65 6e74 6564 2028 6f62   implemented (ob
+00041290: 6a65 6374 2c20 6461 7465 7469 6d65 3634  ject, datetime64
+000412a0: 206f 7220 7469 6d65 6465 6c74 6136 3429   or timedelta64)
+000412b0: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+000412c0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+000412d0: 2d2d 0a20 2020 2020 2020 2071 7561 6e74  --.        quant
+000412e0: 696c 6573 203a 2044 6174 6173 6574 0a20  iles : Dataset. 
+000412f0: 2020 2020 2020 2020 2020 2049 6620 6071             If `q
+00041300: 6020 6973 2061 2073 696e 676c 6520 7175  ` is a single qu
+00041310: 616e 7469 6c65 2c20 7468 656e 2074 6865  antile, then the
+00041320: 2072 6573 756c 7420 6973 2061 2073 6361   result is a sca
+00041330: 6c61 7220 666f 7220 6561 6368 0a20 2020  lar for each.   
+00041340: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+00041350: 6520 696e 2064 6174 615f 7661 7273 2e20  e in data_vars. 
+00041360: 4966 206d 756c 7469 706c 6520 7065 7263  If multiple perc
+00041370: 656e 7469 6c65 7320 6172 6520 6769 7665  entiles are give
+00041380: 6e2c 2066 6972 7374 0a20 2020 2020 2020  n, first.       
+00041390: 2020 2020 2061 7869 7320 6f66 2074 6865       axis of the
+000413a0: 2072 6573 756c 7420 636f 7272 6573 706f   result correspo
+000413b0: 6e64 7320 746f 2074 6865 2071 7561 6e74  nds to the quant
+000413c0: 696c 6520 616e 6420 6120 7175 616e 7469  ile and a quanti
+000413d0: 6c65 0a20 2020 2020 2020 2020 2020 2064  le.            d
+000413e0: 696d 656e 7369 6f6e 2069 7320 6164 6465  imension is adde
+000413f0: 6420 746f 2074 6865 2072 6574 7572 6e20  d to the return 
+00041400: 4461 7461 7365 742e 2054 6865 206f 7468  Dataset. The oth
+00041410: 6572 2064 696d 656e 7369 6f6e 7320 6172  er dimensions ar
+00041420: 650a 2020 2020 2020 2020 2020 2020 7468  e.            th
+00041430: 6520 6469 6d65 6e73 696f 6e73 2074 6861  e dimensions tha
+00041440: 7420 7265 6d61 696e 2061 6674 6572 2074  t remain after t
+00041450: 6865 2072 6564 7563 7469 6f6e 206f 6620  he reduction of 
+00041460: 7468 6520 6172 7261 792e 0a0a 2020 2020  the array...    
+00041470: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
+00041480: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+00041490: 2020 2020 2020 6e75 6d70 792e 6e61 6e71        numpy.nanq
+000414a0: 7561 6e74 696c 652c 206e 756d 7079 2e71  uantile, numpy.q
+000414b0: 7561 6e74 696c 652c 2070 616e 6461 732e  uantile, pandas.
+000414c0: 5365 7269 6573 2e71 7561 6e74 696c 652c  Series.quantile,
+000414d0: 2044 6174 6141 7272 6179 2e71 7561 6e74   DataArray.quant
+000414e0: 696c 650a 0a20 2020 2020 2020 2045 7861  ile..        Exa
+000414f0: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
+00041500: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
+00041510: 3e3e 2064 7320 3d20 7872 2e44 6174 6173  >> ds = xr.Datas
+00041520: 6574 280a 2020 2020 2020 2020 2e2e 2e20  et(.        ... 
+00041530: 2020 2020 7b22 6122 3a20 2828 2278 222c      {"a": (("x",
+00041540: 2022 7922 292c 205b 5b30 2e37 2c20 342e   "y"), [[0.7, 4.
+00041550: 322c 2039 2e34 2c20 312e 355d 2c20 5b36  2, 9.4, 1.5], [6
+00041560: 2e35 2c20 372e 332c 2032 2e36 2c20 312e  .5, 7.3, 2.6, 1.
+00041570: 395d 5d29 7d2c 0a20 2020 2020 2020 202e  9]])},.        .
+00041580: 2e2e 2020 2020 2063 6f6f 7264 733d 7b22  ..     coords={"
+00041590: 7822 3a20 5b37 2c20 395d 2c20 2279 223a  x": [7, 9], "y":
+000415a0: 205b 312c 2031 2e35 2c20 322c 2032 2e35   [1, 1.5, 2, 2.5
+000415b0: 5d7d 2c0a 2020 2020 2020 2020 2e2e 2e20  ]},.        ... 
+000415c0: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
+000415d0: 2e71 7561 6e74 696c 6528 3029 2020 2320  .quantile(0)  # 
+000415e0: 6f72 2064 732e 7175 616e 7469 6c65 2830  or ds.quantile(0
+000415f0: 2c20 6469 6d3d 2e2e 2e29 0a20 2020 2020  , dim=...).     
+00041600: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
+00041610: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
+00041620: 6e73 696f 6e73 3a20 2020 2829 0a20 2020  nsions:   ().   
+00041630: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
+00041640: 3a0a 2020 2020 2020 2020 2020 2020 7175  :.            qu
+00041650: 616e 7469 6c65 2020 666c 6f61 7436 3420  antile  float64 
+00041660: 302e 300a 2020 2020 2020 2020 4461 7461  0.0.        Data
+00041670: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+00041680: 2020 2020 2020 2020 6120 2020 2020 2020          a       
+00041690: 2020 666c 6f61 7436 3420 302e 370a 2020    float64 0.7.  
+000416a0: 2020 2020 2020 3e3e 3e20 6473 2e71 7561        >>> ds.qua
+000416b0: 6e74 696c 6528 302c 2064 696d 3d22 7822  ntile(0, dim="x"
+000416c0: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
+000416d0: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
+000416e0: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
+000416f0: 2028 793a 2034 290a 2020 2020 2020 2020   (y: 4).        
+00041700: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
+00041710: 2020 2020 2020 202a 2079 2020 2020 2020         * y      
+00041720: 2020 2028 7929 2066 6c6f 6174 3634 2031     (y) float64 1
+00041730: 2e30 2031 2e35 2032 2e30 2032 2e35 0a20  .0 1.5 2.0 2.5. 
+00041740: 2020 2020 2020 2020 2020 2071 7561 6e74             quant
+00041750: 696c 6520 2066 6c6f 6174 3634 2030 2e30  ile  float64 0.0
+00041760: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
+00041770: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+00041780: 2020 2020 2061 2020 2020 2020 2020 2028       a         (
+00041790: 7929 2066 6c6f 6174 3634 2030 2e37 2034  y) float64 0.7 4
+000417a0: 2e32 2032 2e36 2031 2e35 0a20 2020 2020  .2 2.6 1.5.     
+000417b0: 2020 203e 3e3e 2064 732e 7175 616e 7469     >>> ds.quanti
+000417c0: 6c65 285b 302c 2030 2e35 2c20 315d 290a  le([0, 0.5, 1]).
+000417d0: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+000417e0: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+000417f0: 2044 696d 656e 7369 6f6e 733a 2020 2028   Dimensions:   (
+00041800: 7175 616e 7469 6c65 3a20 3329 0a20 2020  quantile: 3).   
+00041810: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
+00041820: 3a0a 2020 2020 2020 2020 2020 2a20 7175  :.          * qu
+00041830: 616e 7469 6c65 2020 2871 7561 6e74 696c  antile  (quantil
+00041840: 6529 2066 6c6f 6174 3634 2030 2e30 2030  e) float64 0.0 0
+00041850: 2e35 2031 2e30 0a20 2020 2020 2020 2044  .5 1.0.        D
+00041860: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+00041870: 2020 2020 2020 2020 2020 2061 2020 2020             a    
+00041880: 2020 2020 2028 7175 616e 7469 6c65 2920       (quantile) 
+00041890: 666c 6f61 7436 3420 302e 3720 332e 3420  float64 0.7 3.4 
+000418a0: 392e 340a 2020 2020 2020 2020 3e3e 3e20  9.4.        >>> 
+000418b0: 6473 2e71 7561 6e74 696c 6528 5b30 2c20  ds.quantile([0, 
+000418c0: 302e 352c 2031 5d2c 2064 696d 3d22 7822  0.5, 1], dim="x"
+000418d0: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
+000418e0: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
+000418f0: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
+00041900: 2028 7175 616e 7469 6c65 3a20 332c 2079   (quantile: 3, y
+00041910: 3a20 3429 0a20 2020 2020 2020 2043 6f6f  : 4).        Coo
+00041920: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
+00041930: 2020 2020 2a20 7920 2020 2020 2020 2020      * y         
+00041940: 2879 2920 666c 6f61 7436 3420 312e 3020  (y) float64 1.0 
+00041950: 312e 3520 322e 3020 322e 350a 2020 2020  1.5 2.0 2.5.    
+00041960: 2020 2020 2020 2a20 7175 616e 7469 6c65        * quantile
+00041970: 2020 2871 7561 6e74 696c 6529 2066 6c6f    (quantile) flo
+00041980: 6174 3634 2030 2e30 2030 2e35 2031 2e30  at64 0.0 0.5 1.0
+00041990: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
+000419a0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+000419b0: 2020 2020 2061 2020 2020 2020 2020 2028       a         (
+000419c0: 7175 616e 7469 6c65 2c20 7929 2066 6c6f  quantile, y) flo
+000419d0: 6174 3634 2030 2e37 2034 2e32 2032 2e36  at64 0.7 4.2 2.6
+000419e0: 2031 2e35 2033 2e36 202e 2e2e 2031 2e37   1.5 3.6 ... 1.7
+000419f0: 2036 2e35 2037 2e33 2039 2e34 2031 2e39   6.5 7.3 9.4 1.9
+00041a00: 0a0a 2020 2020 2020 2020 5265 6665 7265  ..        Refere
+00041a10: 6e63 6573 0a20 2020 2020 2020 202d 2d2d  nces.        ---
+00041a20: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00041a30: 2e2e 205b 315d 2052 2e20 4a2e 2048 796e  .. [1] R. J. Hyn
+00041a40: 646d 616e 2061 6e64 2059 2e20 4661 6e2c  dman and Y. Fan,
+00041a50: 0a20 2020 2020 2020 2020 2020 2253 616d  .           "Sam
+00041a60: 706c 6520 7175 616e 7469 6c65 7320 696e  ple quantiles in
+00041a70: 2073 7461 7469 7374 6963 616c 2070 6163   statistical pac
+00041a80: 6b61 6765 732c 220a 2020 2020 2020 2020  kages,".        
+00041a90: 2020 2054 6865 2041 6d65 7269 6361 6e20     The American 
+00041aa0: 5374 6174 6973 7469 6369 616e 2c20 3530  Statistician, 50
+00041ab0: 2834 292c 2070 702e 2033 3631 2d33 3635  (4), pp. 361-365
+00041ac0: 2c20 3139 3936 0a20 2020 2020 2020 2022  , 1996.        "
+00041ad0: 2222 0a0a 2020 2020 2020 2020 2320 696e  ""..        # in
+00041ae0: 7465 7270 6f6c 6174 696f 6e20 7265 6e61  terpolation rena
+00041af0: 6d65 6420 746f 206d 6574 686f 6420 696e  med to method in
+00041b00: 2076 6572 7369 6f6e 2030 2e32 312e 300a   version 0.21.0.
+00041b10: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+00041b20: 6865 7265 2061 6e64 2069 6e20 7661 7269  here and in vari
+00041b30: 6162 6c65 2074 6f20 6176 6f69 6420 7265  able to avoid re
+00041b40: 7065 6174 6564 2077 6172 6e69 6e67 730a  peated warnings.
+00041b50: 2020 2020 2020 2020 6966 2069 6e74 6572          if inter
+00041b60: 706f 6c61 7469 6f6e 2069 7320 6e6f 7420  polation is not 
+00041b70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00041b80: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
+00041b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00041ba0: 2022 5468 6520 6069 6e74 6572 706f 6c61   "The `interpola
+00041bb0: 7469 6f6e 6020 6172 6775 6d65 6e74 2074  tion` argument t
+00041bc0: 6f20 7175 616e 7469 6c65 2077 6173 2072  o quantile was r
+00041bd0: 656e 616d 6564 2074 6f20 606d 6574 686f  enamed to `metho
+00041be0: 6460 2e22 2c0a 2020 2020 2020 2020 2020  d`.",.          
+00041bf0: 2020 2020 2020 4675 7475 7265 5761 726e        FutureWarn
+00041c00: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
+00041c10: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+00041c20: 6966 206d 6574 686f 6420 213d 2022 6c69  if method != "li
+00041c30: 6e65 6172 223a 0a20 2020 2020 2020 2020  near":.         
+00041c40: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00041c50: 6545 7272 6f72 2822 4361 6e6e 6f74 2070  eError("Cannot p
+00041c60: 6173 7320 696e 7465 7270 6f6c 6174 696f  ass interpolatio
+00041c70: 6e20 616e 6420 6d65 7468 6f64 206b 6579  n and method key
+00041c80: 776f 7264 7321 2229 0a0a 2020 2020 2020  words!")..      
+00041c90: 2020 2020 2020 6d65 7468 6f64 203d 2069        method = i
+00041ca0: 6e74 6572 706f 6c61 7469 6f6e 0a0a 2020  nterpolation..  
+00041cb0: 2020 2020 2020 6469 6d73 3a20 7365 745b        dims: set[
+00041cc0: 4861 7368 6162 6c65 5d0a 2020 2020 2020  Hashable].      
+00041cd0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00041ce0: 6469 6d2c 2073 7472 293a 0a20 2020 2020  dim, str):.     
+00041cf0: 2020 2020 2020 2064 696d 7320 3d20 7b64         dims = {d
+00041d00: 696d 7d0a 2020 2020 2020 2020 656c 6966  im}.        elif
+00041d10: 2064 696d 2069 7320 4e6f 6e65 206f 7220   dim is None or 
+00041d20: 6469 6d20 6973 202e 2e2e 3a0a 2020 2020  dim is ...:.    
+00041d30: 2020 2020 2020 2020 6469 6d73 203d 2073          dims = s
+00041d40: 6574 2873 656c 662e 6469 6d73 290a 2020  et(self.dims).  
+00041d50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00041d60: 2020 2020 2020 2020 6469 6d73 203d 2073          dims = s
+00041d70: 6574 2864 696d 290a 0a20 2020 2020 2020  et(dim)..       
+00041d80: 205f 6173 7365 7274 5f65 6d70 7479 280a   _assert_empty(.
+00041d90: 2020 2020 2020 2020 2020 2020 7475 706c              tupl
+00041da0: 6528 6420 666f 7220 6420 696e 2064 696d  e(d for d in dim
+00041db0: 7320 6966 2064 206e 6f74 2069 6e20 7365  s if d not in se
+00041dc0: 6c66 2e64 696d 7329 2c0a 2020 2020 2020  lf.dims),.      
+00041dd0: 2020 2020 2020 2244 6174 6173 6574 2064        "Dataset d
+00041de0: 6f65 7320 6e6f 7420 636f 6e74 6169 6e20  oes not contain 
+00041df0: 7468 6520 6469 6d65 6e73 696f 6e73 3a20  the dimensions: 
+00041e00: 2573 222c 0a20 2020 2020 2020 2029 0a0a  %s",.        )..
+00041e10: 2020 2020 2020 2020 7120 3d20 6e70 2e61          q = np.a
+00041e20: 7361 7272 6179 2871 2c20 6474 7970 653d  sarray(q, dtype=
+00041e30: 6e70 2e66 6c6f 6174 3634 290a 0a20 2020  np.float64)..   
+00041e40: 2020 2020 2076 6172 6961 626c 6573 203d       variables =
+00041e50: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
+00041e60: 6e61 6d65 2c20 7661 7220 696e 2073 656c  name, var in sel
+00041e70: 662e 7661 7269 6162 6c65 732e 6974 656d  f.variables.item
+00041e80: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00041e90: 2072 6564 7563 655f 6469 6d73 203d 205b   reduce_dims = [
+00041ea0: 6420 666f 7220 6420 696e 2076 6172 2e64  d for d in var.d
+00041eb0: 696d 7320 6966 2064 2069 6e20 6469 6d73  ims if d in dims
+00041ec0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+00041ed0: 2072 6564 7563 655f 6469 6d73 206f 7220   reduce_dims or 
+00041ee0: 6e6f 7420 7661 722e 6469 6d73 3a0a 2020  not var.dims:.  
+00041ef0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00041f00: 206e 616d 6520 6e6f 7420 696e 2073 656c   name not in sel
+00041f10: 662e 636f 6f72 6473 3a0a 2020 2020 2020  f.coords:.      
+00041f20: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00041f30: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00041f40: 2020 2020 2020 2020 2020 206e 6f74 206e             not n
+00041f50: 756d 6572 6963 5f6f 6e6c 790a 2020 2020  umeric_only.    
+00041f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041f70: 2020 2020 6f72 206e 702e 6973 7375 6264      or np.issubd
+00041f80: 7479 7065 2876 6172 2e64 7479 7065 2c20  type(var.dtype, 
+00041f90: 6e70 2e6e 756d 6265 7229 0a20 2020 2020  np.number).     
+00041fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041fb0: 2020 206f 7220 7661 722e 6474 7970 6520     or var.dtype 
+00041fc0: 3d3d 206e 702e 626f 6f6c 5f0a 2020 2020  == np.bool_.    
+00041fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041fe0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00041ff0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+00042000: 626c 6573 5b6e 616d 655d 203d 2076 6172  bles[name] = var
+00042010: 2e71 7561 6e74 696c 6528 0a20 2020 2020  .quantile(.     
+00042020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042030: 2020 2020 2020 2071 2c0a 2020 2020 2020         q,.      
+00042040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042050: 2020 2020 2020 6469 6d3d 7265 6475 6365        dim=reduce
+00042060: 5f64 696d 732c 0a20 2020 2020 2020 2020  _dims,.         
+00042070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042080: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+00042090: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000420a0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+000420b0: 6570 5f61 7474 7273 3d6b 6565 705f 6174  ep_attrs=keep_at
+000420c0: 7472 732c 0a20 2020 2020 2020 2020 2020  trs,.           
+000420d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000420e0: 2073 6b69 706e 613d 736b 6970 6e61 2c0a   skipna=skipna,.
+000420f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042100: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00042110: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00042120: 2020 2020 2020 2020 2020 2020 2076 6172               var
+00042130: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
+00042140: 6172 0a0a 2020 2020 2020 2020 2320 636f  ar..        # co
+00042150: 6e73 7472 7563 7420 7468 6520 6e65 7720  nstruct the new 
+00042160: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
+00042170: 636f 6f72 645f 6e61 6d65 7320 3d20 7b6b  coord_names = {k
+00042180: 2066 6f72 206b 2069 6e20 7365 6c66 2e63   for k in self.c
+00042190: 6f6f 7264 7320 6966 206b 2069 6e20 7661  oords if k in va
+000421a0: 7269 6162 6c65 737d 0a20 2020 2020 2020  riables}.       
+000421b0: 2069 6e64 6578 6573 203d 207b 6b3a 2076   indexes = {k: v
+000421c0: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
+000421d0: 662e 5f69 6e64 6578 6573 2e69 7465 6d73  f._indexes.items
+000421e0: 2829 2069 6620 6b20 696e 2076 6172 6961  () if k in varia
+000421f0: 626c 6573 7d0a 2020 2020 2020 2020 6966  bles}.        if
+00042200: 206b 6565 705f 6174 7472 7320 6973 204e   keep_attrs is N
+00042210: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00042220: 206b 6565 705f 6174 7472 7320 3d20 5f67   keep_attrs = _g
+00042230: 6574 5f6b 6565 705f 6174 7472 7328 6465  et_keep_attrs(de
+00042240: 6661 756c 743d 4661 6c73 6529 0a20 2020  fault=False).   
+00042250: 2020 2020 2061 7474 7273 203d 2073 656c       attrs = sel
+00042260: 662e 6174 7472 7320 6966 206b 6565 705f  f.attrs if keep_
+00042270: 6174 7472 7320 656c 7365 204e 6f6e 650a  attrs else None.
+00042280: 2020 2020 2020 2020 6e65 7720 3d20 7365          new = se
+00042290: 6c66 2e5f 7265 706c 6163 655f 7769 7468  lf._replace_with
+000422a0: 5f6e 6577 5f64 696d 7328 0a20 2020 2020  _new_dims(.     
+000422b0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+000422c0: 2c20 636f 6f72 645f 6e61 6d65 733d 636f  , coord_names=co
+000422d0: 6f72 645f 6e61 6d65 732c 2061 7474 7273  ord_names, attrs
+000422e0: 3d61 7474 7273 2c20 696e 6465 7865 733d  =attrs, indexes=
+000422f0: 696e 6465 7865 730a 2020 2020 2020 2020  indexes.        
+00042300: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00042310: 206e 6577 2e61 7373 6967 6e5f 636f 6f72   new.assign_coor
+00042320: 6473 2871 7561 6e74 696c 653d 7129 0a0a  ds(quantile=q)..
+00042330: 2020 2020 6465 6620 7261 6e6b 280a 2020      def rank(.  
+00042340: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
+00042350: 7461 7365 742c 0a20 2020 2020 2020 2064  taset,.        d
+00042360: 696d 3a20 4861 7368 6162 6c65 2c0a 2020  im: Hashable,.  
+00042370: 2020 2020 2020 7063 743a 2062 6f6f 6c20        pct: bool 
+00042380: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+00042390: 206b 6565 705f 6174 7472 733a 2062 6f6f   keep_attrs: boo
+000423a0: 6c20 7c20 4e6f 6e65 203d 204e 6f6e 652c  l | None = None,
+000423b0: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
+000423c0: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
+000423d0: 5261 6e6b 7320 7468 6520 6461 7461 2e0a  Ranks the data..
+000423e0: 0a20 2020 2020 2020 2045 7175 616c 2076  .        Equal v
+000423f0: 616c 7565 7320 6172 6520 6173 7369 676e  alues are assign
+00042400: 6564 2061 2072 616e 6b20 7468 6174 2069  ed a rank that i
+00042410: 7320 7468 6520 6176 6572 6167 6520 6f66  s the average of
+00042420: 2074 6865 2072 616e 6b73 2074 6861 740a   the ranks that.
+00042430: 2020 2020 2020 2020 776f 756c 6420 6861          would ha
+00042440: 7665 2062 6565 6e20 6f74 6865 7277 6973  ve been otherwis
+00042450: 6520 6173 7369 676e 6564 2074 6f20 616c  e assigned to al
+00042460: 6c20 6f66 2074 6865 2076 616c 7565 7320  l of the values 
+00042470: 7769 7468 696e 0a20 2020 2020 2020 2074  within.        t
+00042480: 6861 7420 7365 742e 0a20 2020 2020 2020  hat set..       
+00042490: 2052 616e 6b73 2062 6567 696e 2061 7420   Ranks begin at 
+000424a0: 312c 206e 6f74 2030 2e20 4966 2070 6374  1, not 0. If pct
+000424b0: 2069 7320 5472 7565 2c20 636f 6d70 7574   is True, comput
+000424c0: 6573 2070 6572 6365 6e74 6167 6520 7261  es percentage ra
+000424d0: 6e6b 732e 0a0a 2020 2020 2020 2020 4e61  nks...        Na
+000424e0: 4e73 2069 6e20 7468 6520 696e 7075 7420  Ns in the input 
+000424f0: 6172 7261 7920 6172 6520 7265 7475 726e  array are return
+00042500: 6564 2061 7320 4e61 4e73 2e0a 0a20 2020  ed as NaNs...   
+00042510: 2020 2020 2054 6865 2060 626f 7474 6c65       The `bottle
+00042520: 6e65 636b 6020 6c69 6272 6172 7920 6973  neck` library is
+00042530: 2072 6571 7569 7265 642e 0a0a 2020 2020   required...    
+00042540: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00042550: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00042560: 2d0a 2020 2020 2020 2020 6469 6d20 3a20  -.        dim : 
+00042570: 4861 7368 6162 6c65 0a20 2020 2020 2020  Hashable.       
+00042580: 2020 2020 2044 696d 656e 7369 6f6e 206f       Dimension o
+00042590: 7665 7220 7768 6963 6820 746f 2063 6f6d  ver which to com
+000425a0: 7075 7465 2072 616e 6b2e 0a20 2020 2020  pute rank..     
+000425b0: 2020 2070 6374 203a 2062 6f6f 6c2c 2064     pct : bool, d
+000425c0: 6566 6175 6c74 3a20 4661 6c73 650a 2020  efault: False.  
+000425d0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+000425e0: 652c 2063 6f6d 7075 7465 2070 6572 6365  e, compute perce
+000425f0: 6e74 6167 6520 7261 6e6b 732c 206f 7468  ntage ranks, oth
+00042600: 6572 7769 7365 2063 6f6d 7075 7465 2069  erwise compute i
+00042610: 6e74 6567 6572 2072 616e 6b73 2e0a 2020  nteger ranks..  
+00042620: 2020 2020 2020 6b65 6570 5f61 7474 7273        keep_attrs
+00042630: 203a 2062 6f6f 6c20 6f72 204e 6f6e 652c   : bool or None,
+00042640: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00042650: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
+00042660: 6865 2064 6174 6173 6574 2773 2061 7474  he dataset's att
+00042670: 7269 6275 7465 7320 2860 6174 7472 7360  ributes (`attrs`
+00042680: 2920 7769 6c6c 2062 6520 636f 7069 6564  ) will be copied
+00042690: 2066 726f 6d0a 2020 2020 2020 2020 2020   from.          
+000426a0: 2020 7468 6520 6f72 6967 696e 616c 206f    the original o
+000426b0: 626a 6563 7420 746f 2074 6865 206e 6577  bject to the new
+000426c0: 206f 6e65 2e20 2049 6620 4661 6c73 652c   one.  If False,
+000426d0: 2074 6865 206e 6577 0a20 2020 2020 2020   the new.       
+000426e0: 2020 2020 206f 626a 6563 7420 7769 6c6c       object will
+000426f0: 2062 6520 7265 7475 726e 6564 2077 6974   be returned wit
+00042700: 686f 7574 2061 7474 7269 6275 7465 732e  hout attributes.
+00042710: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00042720: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00042730: 2d0a 2020 2020 2020 2020 7261 6e6b 6564  -.        ranked
+00042740: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
+00042750: 2020 2020 2020 2056 6172 6961 626c 6573         Variables
+00042760: 2074 6861 7420 646f 206e 6f74 2064 6570   that do not dep
+00042770: 656e 6420 6f6e 2060 6469 6d60 2061 7265  end on `dim` are
+00042780: 2064 726f 7070 6564 2e0a 2020 2020 2020   dropped..      
+00042790: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+000427a0: 206e 6f74 204f 5054 494f 4e53 5b22 7573   not OPTIONS["us
+000427b0: 655f 626f 7474 6c65 6e65 636b 225d 3a0a  e_bottleneck"]:.
+000427c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000427d0: 6520 5275 6e74 696d 6545 7272 6f72 280a  e RuntimeError(.
+000427e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000427f0: 2272 616e 6b20 7265 7175 6972 6573 2062  "rank requires b
+00042800: 6f74 746c 656e 6563 6b20 746f 2062 6520  ottleneck to be 
+00042810: 656e 6162 6c65 642e 220a 2020 2020 2020  enabled.".      
+00042820: 2020 2020 2020 2020 2020 2220 4361 6c6c            " Call
+00042830: 2060 7872 2e73 6574 5f6f 7074 696f 6e73   `xr.set_options
+00042840: 2875 7365 5f62 6f74 746c 656e 6563 6b3d  (use_bottleneck=
+00042850: 5472 7565 2960 2074 6f20 656e 6162 6c65  True)` to enable
+00042860: 2069 742e 220a 2020 2020 2020 2020 2020   it.".          
+00042870: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
+00042880: 6469 6d20 6e6f 7420 696e 2073 656c 662e  dim not in self.
+00042890: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
+000428a0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+000428b0: 6f72 2866 2244 6174 6173 6574 2064 6f65  or(f"Dataset doe
+000428c0: 7320 6e6f 7420 636f 6e74 6169 6e20 7468  s not contain th
+000428d0: 6520 6469 6d65 6e73 696f 6e3a 207b 6469  e dimension: {di
+000428e0: 6d7d 2229 0a0a 2020 2020 2020 2020 7661  m}")..        va
+000428f0: 7269 6162 6c65 7320 3d20 7b7d 0a20 2020  riables = {}.   
+00042900: 2020 2020 2066 6f72 206e 616d 652c 2076       for name, v
+00042910: 6172 2069 6e20 7365 6c66 2e76 6172 6961  ar in self.varia
+00042920: 626c 6573 2e69 7465 6d73 2829 3a0a 2020  bles.items():.  
+00042930: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
+00042940: 6520 696e 2073 656c 662e 6461 7461 5f76  e in self.data_v
+00042950: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
+00042960: 2020 2020 2069 6620 6469 6d20 696e 2076       if dim in v
+00042970: 6172 2e64 696d 733a 0a20 2020 2020 2020  ar.dims:.       
+00042980: 2020 2020 2020 2020 2020 2020 2076 6172               var
+00042990: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
+000429a0: 6172 2e72 616e 6b28 6469 6d2c 2070 6374  ar.rank(dim, pct
+000429b0: 3d70 6374 290a 2020 2020 2020 2020 2020  =pct).          
+000429c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000429d0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+000429e0: 735b 6e61 6d65 5d20 3d20 7661 720a 0a20  s[name] = var.. 
+000429f0: 2020 2020 2020 2063 6f6f 7264 5f6e 616d         coord_nam
+00042a00: 6573 203d 2073 6574 2873 656c 662e 636f  es = set(self.co
+00042a10: 6f72 6473 290a 2020 2020 2020 2020 6966  ords).        if
+00042a20: 206b 6565 705f 6174 7472 7320 6973 204e   keep_attrs is N
+00042a30: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00042a40: 206b 6565 705f 6174 7472 7320 3d20 5f67   keep_attrs = _g
+00042a50: 6574 5f6b 6565 705f 6174 7472 7328 6465  et_keep_attrs(de
+00042a60: 6661 756c 743d 4661 6c73 6529 0a20 2020  fault=False).   
+00042a70: 2020 2020 2061 7474 7273 203d 2073 656c       attrs = sel
+00042a80: 662e 6174 7472 7320 6966 206b 6565 705f  f.attrs if keep_
+00042a90: 6174 7472 7320 656c 7365 204e 6f6e 650a  attrs else None.
+00042aa0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00042ab0: 656c 662e 5f72 6570 6c61 6365 2876 6172  elf._replace(var
+00042ac0: 6961 626c 6573 2c20 636f 6f72 645f 6e61  iables, coord_na
+00042ad0: 6d65 732c 2061 7474 7273 3d61 7474 7273  mes, attrs=attrs
+00042ae0: 290a 0a20 2020 2064 6566 2064 6966 6665  )..    def diffe
+00042af0: 7265 6e74 6961 7465 280a 2020 2020 2020  rentiate(.      
+00042b00: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
+00042b10: 742c 0a20 2020 2020 2020 2063 6f6f 7264  t,.        coord
+00042b20: 3a20 4861 7368 6162 6c65 2c0a 2020 2020  : Hashable,.    
+00042b30: 2020 2020 6564 6765 5f6f 7264 6572 3a20      edge_order: 
+00042b40: 4c69 7465 7261 6c5b 312c 2032 5d20 3d20  Literal[1, 2] = 
+00042b50: 312c 0a20 2020 2020 2020 2064 6174 6574  1,.        datet
+00042b60: 696d 655f 756e 6974 3a20 4461 7465 7469  ime_unit: Dateti
+00042b70: 6d65 556e 6974 4f70 7469 6f6e 7320 7c20  meUnitOptions | 
+00042b80: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+00042b90: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
+00042ba0: 0a20 2020 2020 2020 2022 2222 2044 6966  .        """ Dif
+00042bb0: 6665 7265 6e74 6961 7465 2077 6974 6820  ferentiate with 
+00042bc0: 7468 6520 7365 636f 6e64 206f 7264 6572  the second order
+00042bd0: 2061 6363 7572 6174 6520 6365 6e74 7261   accurate centra
+00042be0: 6c0a 2020 2020 2020 2020 6469 6666 6572  l.        differ
+00042bf0: 656e 6365 732e 0a0a 2020 2020 2020 2020  ences...        
+00042c00: 2e2e 206e 6f74 653a 3a0a 2020 2020 2020  .. note::.      
+00042c10: 2020 2020 2020 5468 6973 2066 6561 7475        This featu
+00042c20: 7265 2069 7320 6c69 6d69 7465 6420 746f  re is limited to
+00042c30: 2073 696d 706c 6520 6361 7274 6573 6961   simple cartesia
+00042c40: 6e20 6765 6f6d 6574 7279 2c20 692e 652e  n geometry, i.e.
+00042c50: 2063 6f6f 7264 0a20 2020 2020 2020 2020   coord.         
+00042c60: 2020 206d 7573 7420 6265 206f 6e65 2064     must be one d
+00042c70: 696d 656e 7369 6f6e 616c 2e0a 0a20 2020  imensional...   
+00042c80: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00042c90: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00042ca0: 2d2d 0a20 2020 2020 2020 2063 6f6f 7264  --.        coord
+00042cb0: 203a 2048 6173 6861 626c 650a 2020 2020   : Hashable.    
+00042cc0: 2020 2020 2020 2020 5468 6520 636f 6f72          The coor
+00042cd0: 6469 6e61 7465 2074 6f20 6265 2075 7365  dinate to be use
+00042ce0: 6420 746f 2063 6f6d 7075 7465 2074 6865  d to compute the
+00042cf0: 2067 7261 6469 656e 742e 0a20 2020 2020   gradient..     
+00042d00: 2020 2065 6467 655f 6f72 6465 7220 3a20     edge_order : 
+00042d10: 7b31 2c20 327d 2c20 6465 6661 756c 743a  {1, 2}, default:
+00042d20: 2031 0a20 2020 2020 2020 2020 2020 204e   1.            N
+00042d30: 2d74 6820 6f72 6465 7220 6163 6375 7261  -th order accura
+00042d40: 7465 2064 6966 6665 7265 6e63 6573 2061  te differences a
+00042d50: 7420 7468 6520 626f 756e 6461 7269 6573  t the boundaries
+00042d60: 2e0a 2020 2020 2020 2020 6461 7465 7469  ..        dateti
+00042d70: 6d65 5f75 6e69 7420 3a20 4e6f 6e65 206f  me_unit : None o
+00042d80: 7220 7b22 5922 2c20 224d 222c 2022 5722  r {"Y", "M", "W"
+00042d90: 2c20 2244 222c 2022 6822 2c20 226d 222c  , "D", "h", "m",
+00042da0: 2022 7322 2c20 226d 7322 2c20 5c0a 2020   "s", "ms", \.  
+00042db0: 2020 2020 2020 2020 2020 2275 7322 2c20            "us", 
+00042dc0: 226e 7322 2c20 2270 7322 2c20 2266 7322  "ns", "ps", "fs"
+00042dd0: 2c20 2261 7322 2c20 4e6f 6e65 7d2c 2064  , "as", None}, d
+00042de0: 6566 6175 6c74 3a20 4e6f 6e65 0a20 2020  efault: None.   
+00042df0: 2020 2020 2020 2020 2055 6e69 7420 746f           Unit to
+00042e00: 2063 6f6d 7075 7465 2067 7261 6469 656e   compute gradien
+00042e10: 742e 204f 6e6c 7920 7661 6c69 6420 666f  t. Only valid fo
+00042e20: 7220 6461 7465 7469 6d65 2063 6f6f 7264  r datetime coord
+00042e30: 696e 6174 652e 0a0a 2020 2020 2020 2020  inate...        
+00042e40: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+00042e50: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00042e60: 6469 6666 6572 656e 7469 6174 6564 3a20  differentiated: 
+00042e70: 4461 7461 7365 740a 0a20 2020 2020 2020  Dataset..       
+00042e80: 2053 6565 2061 6c73 6f0a 2020 2020 2020   See also.      
+00042e90: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+00042ea0: 2020 206e 756d 7079 2e67 7261 6469 656e     numpy.gradien
+00042eb0: 743a 2063 6f72 7265 7370 6f6e 6469 6e67  t: corresponding
+00042ec0: 206e 756d 7079 2066 756e 6374 696f 6e0a   numpy function.
+00042ed0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00042ee0: 2020 2020 6672 6f6d 2078 6172 7261 792e      from xarray.
+00042ef0: 636f 7265 2e76 6172 6961 626c 6520 696d  core.variable im
+00042f00: 706f 7274 2056 6172 6961 626c 650a 0a20  port Variable.. 
+00042f10: 2020 2020 2020 2069 6620 636f 6f72 6420         if coord 
+00042f20: 6e6f 7420 696e 2073 656c 662e 7661 7269  not in self.vari
+00042f30: 6162 6c65 7320 616e 6420 636f 6f72 6420  ables and coord 
+00042f40: 6e6f 7420 696e 2073 656c 662e 6469 6d73  not in self.dims
+00042f50: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00042f60: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+00042f70: 2243 6f6f 7264 696e 6174 6520 7b63 6f6f  "Coordinate {coo
+00042f80: 7264 7d20 646f 6573 206e 6f74 2065 7869  rd} does not exi
+00042f90: 7374 2e22 290a 0a20 2020 2020 2020 2063  st.")..        c
+00042fa0: 6f6f 7264 5f76 6172 203d 2073 656c 665b  oord_var = self[
+00042fb0: 636f 6f72 645d 2e76 6172 6961 626c 650a  coord].variable.
+00042fc0: 2020 2020 2020 2020 6966 2063 6f6f 7264          if coord
+00042fd0: 5f76 6172 2e6e 6469 6d20 213d 2031 3a0a  _var.ndim != 1:.
+00042fe0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00042ff0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00043000: 2020 2020 2020 2020 2020 2020 2020 2243                "C
+00043010: 6f6f 7264 696e 6174 6520 7b7d 206d 7573  oordinate {} mus
+00043020: 7420 6265 2031 2064 696d 656e 7369 6f6e  t be 1 dimension
+00043030: 616c 2062 7574 2069 7320 7b7d 220a 2020  al but is {}".  
+00043040: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+00043050: 6469 6d65 6e73 696f 6e61 6c22 2e66 6f72  dimensional".for
+00043060: 6d61 7428 636f 6f72 642c 2063 6f6f 7264  mat(coord, coord
+00043070: 5f76 6172 2e6e 6469 6d29 0a20 2020 2020  _var.ndim).     
+00043080: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00043090: 2020 6469 6d20 3d20 636f 6f72 645f 7661    dim = coord_va
+000430a0: 722e 6469 6d73 5b30 5d0a 2020 2020 2020  r.dims[0].      
+000430b0: 2020 6966 205f 636f 6e74 6169 6e73 5f64    if _contains_d
+000430c0: 6174 6574 696d 655f 6c69 6b65 5f6f 626a  atetime_like_obj
+000430d0: 6563 7473 2863 6f6f 7264 5f76 6172 293a  ects(coord_var):
+000430e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000430f0: 636f 6f72 645f 7661 722e 6474 7970 652e  coord_var.dtype.
+00043100: 6b69 6e64 2069 6e20 226d 4d22 2061 6e64  kind in "mM" and
+00043110: 2064 6174 6574 696d 655f 756e 6974 2069   datetime_unit i
+00043120: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00043130: 2020 2020 2020 2020 6461 7465 7469 6d65          datetime
+00043140: 5f75 6e69 7420 3d20 6361 7374 280a 2020  _unit = cast(.  
+00043150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043160: 2020 2244 6174 6574 696d 6555 6e69 744f    "DatetimeUnitO
+00043170: 7074 696f 6e73 222c 206e 702e 6461 7465  ptions", np.date
+00043180: 7469 6d65 5f64 6174 6128 636f 6f72 645f  time_data(coord_
+00043190: 7661 722e 6474 7970 6529 5b30 5d0a 2020  var.dtype)[0].  
+000431a0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000431b0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000431c0: 2064 6174 6574 696d 655f 756e 6974 2069   datetime_unit i
+000431d0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000431e0: 2020 2020 2020 2020 6461 7465 7469 6d65          datetime
+000431f0: 5f75 6e69 7420 3d20 2273 2220 2023 2044  _unit = "s"  # D
+00043200: 6566 6175 6c74 2074 6f20 7365 636f 6e64  efault to second
+00043210: 7320 666f 7220 6366 7469 6d65 206f 626a  s for cftime obj
+00043220: 6563 7473 0a20 2020 2020 2020 2020 2020  ects.           
+00043230: 2063 6f6f 7264 5f76 6172 203d 2063 6f6f   coord_var = coo
+00043240: 7264 5f76 6172 2e5f 746f 5f6e 756d 6572  rd_var._to_numer
+00043250: 6963 2864 6174 6574 696d 655f 756e 6974  ic(datetime_unit
+00043260: 3d64 6174 6574 696d 655f 756e 6974 290a  =datetime_unit).
+00043270: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
+00043280: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
+00043290: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
+000432a0: 2e76 6172 6961 626c 6573 2e69 7465 6d73  .variables.items
+000432b0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+000432c0: 6966 206b 2069 6e20 7365 6c66 2e64 6174  if k in self.dat
+000432d0: 615f 7661 7273 2061 6e64 2064 696d 2069  a_vars and dim i
+000432e0: 6e20 762e 6469 6d73 2061 6e64 206b 206e  n v.dims and k n
+000432f0: 6f74 2069 6e20 7365 6c66 2e63 6f6f 7264  ot in self.coord
+00043300: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00043310: 2020 2069 6620 5f63 6f6e 7461 696e 735f     if _contains_
+00043320: 6461 7465 7469 6d65 5f6c 696b 655f 6f62  datetime_like_ob
+00043330: 6a65 6374 7328 7629 3a0a 2020 2020 2020  jects(v):.      
+00043340: 2020 2020 2020 2020 2020 2020 2020 7620                v 
+00043350: 3d20 762e 5f74 6f5f 6e75 6d65 7269 6328  = v._to_numeric(
+00043360: 6461 7465 7469 6d65 5f75 6e69 743d 6461  datetime_unit=da
+00043370: 7465 7469 6d65 5f75 6e69 7429 0a20 2020  tetime_unit).   
+00043380: 2020 2020 2020 2020 2020 2020 2067 7261               gra
+00043390: 6420 3d20 6475 636b 5f61 7272 6179 5f6f  d = duck_array_o
+000433a0: 7073 2e67 7261 6469 656e 7428 0a20 2020  ps.gradient(.   
+000433b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000433c0: 2076 2e64 6174 612c 0a20 2020 2020 2020   v.data,.       
+000433d0: 2020 2020 2020 2020 2020 2020 2063 6f6f               coo
+000433e0: 7264 5f76 6172 2e64 6174 612c 0a20 2020  rd_var.data,.   
+000433f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043400: 2065 6467 655f 6f72 6465 723d 6564 6765   edge_order=edge
+00043410: 5f6f 7264 6572 2c0a 2020 2020 2020 2020  _order,.        
+00043420: 2020 2020 2020 2020 2020 2020 6178 6973              axis
+00043430: 3d76 2e67 6574 5f61 7869 735f 6e75 6d28  =v.get_axis_num(
+00043440: 6469 6d29 2c0a 2020 2020 2020 2020 2020  dim),.          
+00043450: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00043460: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+00043470: 735b 6b5d 203d 2056 6172 6961 626c 6528  s[k] = Variable(
+00043480: 762e 6469 6d73 2c20 6772 6164 290a 2020  v.dims, grad).  
+00043490: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000434a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000434b0: 7661 7269 6162 6c65 735b 6b5d 203d 2076  variables[k] = v
+000434c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000434d0: 7365 6c66 2e5f 7265 706c 6163 6528 7661  self._replace(va
+000434e0: 7269 6162 6c65 7329 0a0a 2020 2020 6465  riables)..    de
+000434f0: 6620 696e 7465 6772 6174 6528 0a20 2020  f integrate(.   
+00043500: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
+00043510: 6173 6574 2c0a 2020 2020 2020 2020 636f  aset,.        co
+00043520: 6f72 643a 2048 6173 6861 626c 6520 7c20  ord: Hashable | 
+00043530: 5365 7175 656e 6365 5b48 6173 6861 626c  Sequence[Hashabl
+00043540: 655d 2c0a 2020 2020 2020 2020 6461 7465  e],.        date
+00043550: 7469 6d65 5f75 6e69 743a 2044 6174 6574  time_unit: Datet
+00043560: 696d 6555 6e69 744f 7074 696f 6e73 203d  imeUnitOptions =
+00043570: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
+00043580: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+00043590: 2020 2022 2222 496e 7465 6772 6174 6520     """Integrate 
+000435a0: 616c 6f6e 6720 7468 6520 6769 7665 6e20  along the given 
+000435b0: 636f 6f72 6469 6e61 7465 2075 7369 6e67  coordinate using
+000435c0: 2074 6865 2074 7261 7065 7a6f 6964 616c   the trapezoidal
+000435d0: 2072 756c 652e 0a0a 2020 2020 2020 2020   rule...        
+000435e0: 2e2e 206e 6f74 653a 3a0a 2020 2020 2020  .. note::.      
+000435f0: 2020 2020 2020 5468 6973 2066 6561 7475        This featu
+00043600: 7265 2069 7320 6c69 6d69 7465 6420 746f  re is limited to
+00043610: 2073 696d 706c 6520 6361 7274 6573 6961   simple cartesia
+00043620: 6e20 6765 6f6d 6574 7279 2c20 692e 652e  n geometry, i.e.
+00043630: 2063 6f6f 7264 0a20 2020 2020 2020 2020   coord.         
+00043640: 2020 206d 7573 7420 6265 206f 6e65 2064     must be one d
+00043650: 696d 656e 7369 6f6e 616c 2e0a 0a20 2020  imensional...   
+00043660: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00043670: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00043680: 2d2d 0a20 2020 2020 2020 2063 6f6f 7264  --.        coord
+00043690: 203a 2068 6173 6861 626c 652c 206f 7220   : hashable, or 
+000436a0: 7365 7175 656e 6365 206f 6620 6861 7368  sequence of hash
+000436b0: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
+000436c0: 2043 6f6f 7264 696e 6174 6528 7329 2075   Coordinate(s) u
+000436d0: 7365 6420 666f 7220 7468 6520 696e 7465  sed for the inte
+000436e0: 6772 6174 696f 6e2e 0a20 2020 2020 2020  gration..       
+000436f0: 2064 6174 6574 696d 655f 756e 6974 203a   datetime_unit :
+00043700: 207b 2759 272c 2027 4d27 2c20 2757 272c   {'Y', 'M', 'W',
+00043710: 2027 4427 2c20 2768 272c 2027 6d27 2c20   'D', 'h', 'm', 
+00043720: 2773 272c 2027 6d73 272c 2027 7573 272c  's', 'ms', 'us',
+00043730: 2027 6e73 272c 205c 0a20 2020 2020 2020   'ns', \.       
+00043740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043750: 2027 7073 272c 2027 6673 272c 2027 6173   'ps', 'fs', 'as
+00043760: 272c 204e 6f6e 657d 2c20 6f70 7469 6f6e  ', None}, option
+00043770: 616c 0a20 2020 2020 2020 2020 2020 2053  al.            S
+00043780: 7065 6369 6679 2074 6865 2075 6e69 7420  pecify the unit 
+00043790: 6966 2064 6174 6574 696d 6520 636f 6f72  if datetime coor
+000437a0: 6469 6e61 7465 2069 7320 7573 6564 2e0a  dinate is used..
+000437b0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+000437c0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000437d0: 0a20 2020 2020 2020 2069 6e74 6567 7261  .        integra
+000437e0: 7465 6420 3a20 4461 7461 7365 740a 0a20  ted : Dataset.. 
+000437f0: 2020 2020 2020 2053 6565 2061 6c73 6f0a         See also.
+00043800: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00043810: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
+00043820: 6179 2e69 6e74 6567 7261 7465 0a20 2020  ay.integrate.   
+00043830: 2020 2020 206e 756d 7079 2e74 7261 707a       numpy.trapz
+00043840: 203a 2063 6f72 7265 7370 6f6e 6469 6e67   : corresponding
+00043850: 206e 756d 7079 2066 756e 6374 696f 6e0a   numpy function.
+00043860: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
+00043870: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00043880: 2d2d 0a20 2020 2020 2020 203e 3e3e 2064  --.        >>> d
+00043890: 7320 3d20 7872 2e44 6174 6173 6574 280a  s = xr.Dataset(.
+000438a0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+000438b0: 6461 7461 5f76 6172 733d 7b22 6122 3a20  data_vars={"a": 
+000438c0: 2822 7822 2c20 5b35 2c20 352c 2036 2c20  ("x", [5, 5, 6, 
+000438d0: 365d 292c 2022 6222 3a20 2822 7822 2c20  6]), "b": ("x", 
+000438e0: 5b31 2c20 322c 2031 2c20 305d 297d 2c0a  [1, 2, 1, 0])},.
+000438f0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+00043900: 636f 6f72 6473 3d7b 2278 223a 205b 302c  coords={"x": [0,
+00043910: 2031 2c20 322c 2033 5d2c 2022 7922 3a20   1, 2, 3], "y": 
+00043920: 2822 7822 2c20 5b31 2c20 372c 2033 2c20  ("x", [1, 7, 3, 
+00043930: 355d 297d 2c0a 2020 2020 2020 2020 2e2e  5])},.        ..
+00043940: 2e20 290a 2020 2020 2020 2020 3e3e 3e20  . ).        >>> 
+00043950: 6473 0a20 2020 2020 2020 203c 7861 7272  ds.        <xarr
+00043960: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
+00043970: 2020 2020 4469 6d65 6e73 696f 6e73 3a20      Dimensions: 
+00043980: 2028 783a 2034 290a 2020 2020 2020 2020   (x: 4).        
+00043990: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
+000439a0: 2020 2020 2020 202a 2078 2020 2020 2020         * x      
+000439b0: 2020 2878 2920 696e 7436 3420 3020 3120    (x) int64 0 1 
+000439c0: 3220 330a 2020 2020 2020 2020 2020 2020  2 3.            
+000439d0: 7920 2020 2020 2020 2028 7829 2069 6e74  y        (x) int
+000439e0: 3634 2031 2037 2033 2035 0a20 2020 2020  64 1 7 3 5.     
+000439f0: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
+00043a00: 733a 0a20 2020 2020 2020 2020 2020 2061  s:.            a
+00043a10: 2020 2020 2020 2020 2878 2920 696e 7436          (x) int6
+00043a20: 3420 3520 3520 3620 360a 2020 2020 2020  4 5 5 6 6.      
+00043a30: 2020 2020 2020 6220 2020 2020 2020 2028        b        (
+00043a40: 7829 2069 6e74 3634 2031 2032 2031 2030  x) int64 1 2 1 0
+00043a50: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
+00043a60: 696e 7465 6772 6174 6528 2278 2229 0a20  integrate("x"). 
+00043a70: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
+00043a80: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
+00043a90: 4469 6d65 6e73 696f 6e73 3a20 2028 290a  Dimensions:  ().
+00043aa0: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
+00043ab0: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
+00043ac0: 2020 2020 6120 2020 2020 2020 2066 6c6f      a        flo
+00043ad0: 6174 3634 2031 362e 350a 2020 2020 2020  at64 16.5.      
+00043ae0: 2020 2020 2020 6220 2020 2020 2020 2066        b        f
+00043af0: 6c6f 6174 3634 2033 2e35 0a20 2020 2020  loat64 3.5.     
+00043b00: 2020 203e 3e3e 2064 732e 696e 7465 6772     >>> ds.integr
+00043b10: 6174 6528 2279 2229 0a20 2020 2020 2020  ate("y").       
+00043b20: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
+00043b30: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
+00043b40: 696f 6e73 3a20 2028 290a 2020 2020 2020  ions:  ().      
+00043b50: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
+00043b60: 3a0a 2020 2020 2020 2020 2020 2020 6120  :.            a 
+00043b70: 2020 2020 2020 2066 6c6f 6174 3634 2032         float64 2
+00043b80: 302e 300a 2020 2020 2020 2020 2020 2020  0.0.            
+00043b90: 6220 2020 2020 2020 2066 6c6f 6174 3634  b        float64
+00043ba0: 2034 2e30 0a20 2020 2020 2020 2022 2222   4.0.        """
+00043bb0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00043bc0: 6973 696e 7374 616e 6365 2863 6f6f 7264  isinstance(coord
+00043bd0: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
+00043be0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+00043bf0: 6f72 6420 3d20 2863 6f6f 7264 2c29 0a20  ord = (coord,). 
+00043c00: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00043c10: 7365 6c66 0a20 2020 2020 2020 2066 6f72  self.        for
+00043c20: 2063 2069 6e20 636f 6f72 643a 0a20 2020   c in coord:.   
+00043c30: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+00043c40: 3d20 7265 7375 6c74 2e5f 696e 7465 6772  = result._integr
+00043c50: 6174 655f 6f6e 6528 632c 2064 6174 6574  ate_one(c, datet
+00043c60: 696d 655f 756e 6974 3d64 6174 6574 696d  ime_unit=datetim
+00043c70: 655f 756e 6974 290a 2020 2020 2020 2020  e_unit).        
+00043c80: 7265 7475 726e 2072 6573 756c 740a 0a20  return result.. 
+00043c90: 2020 2064 6566 205f 696e 7465 6772 6174     def _integrat
+00043ca0: 655f 6f6e 6528 7365 6c66 2c20 636f 6f72  e_one(self, coor
+00043cb0: 642c 2064 6174 6574 696d 655f 756e 6974  d, datetime_unit
+00043cc0: 3d4e 6f6e 652c 2063 756d 756c 6174 6976  =None, cumulativ
+00043cd0: 653d 4661 6c73 6529 3a0a 2020 2020 2020  e=False):.      
+00043ce0: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
+00043cf0: 7265 2e76 6172 6961 626c 6520 696d 706f  re.variable impo
+00043d00: 7274 2056 6172 6961 626c 650a 0a20 2020  rt Variable..   
+00043d10: 2020 2020 2069 6620 636f 6f72 6420 6e6f       if coord no
+00043d20: 7420 696e 2073 656c 662e 7661 7269 6162  t in self.variab
+00043d30: 6c65 7320 616e 6420 636f 6f72 6420 6e6f  les and coord no
+00043d40: 7420 696e 2073 656c 662e 6469 6d73 3a0a  t in self.dims:.
+00043d50: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00043d60: 6520 5661 6c75 6545 7272 6f72 2866 2243  e ValueError(f"C
+00043d70: 6f6f 7264 696e 6174 6520 7b63 6f6f 7264  oordinate {coord
+00043d80: 7d20 646f 6573 206e 6f74 2065 7869 7374  } does not exist
+00043d90: 2e22 290a 0a20 2020 2020 2020 2063 6f6f  .")..        coo
+00043da0: 7264 5f76 6172 203d 2073 656c 665b 636f  rd_var = self[co
+00043db0: 6f72 645d 2e76 6172 6961 626c 650a 2020  ord].variable.  
+00043dc0: 2020 2020 2020 6966 2063 6f6f 7264 5f76        if coord_v
+00043dd0: 6172 2e6e 6469 6d20 213d 2031 3a0a 2020  ar.ndim != 1:.  
+00043de0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00043df0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00043e00: 2020 2020 2020 2020 2020 2020 2243 6f6f              "Coo
+00043e10: 7264 696e 6174 6520 7b7d 206d 7573 7420  rdinate {} must 
+00043e20: 6265 2031 2064 696d 656e 7369 6f6e 616c  be 1 dimensional
+00043e30: 2062 7574 2069 7320 7b7d 220a 2020 2020   but is {}".    
+00043e40: 2020 2020 2020 2020 2020 2020 2220 6469              " di
+00043e50: 6d65 6e73 696f 6e61 6c22 2e66 6f72 6d61  mensional".forma
+00043e60: 7428 636f 6f72 642c 2063 6f6f 7264 5f76  t(coord, coord_v
+00043e70: 6172 2e6e 6469 6d29 0a20 2020 2020 2020  ar.ndim).       
+00043e80: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00043e90: 6469 6d20 3d20 636f 6f72 645f 7661 722e  dim = coord_var.
+00043ea0: 6469 6d73 5b30 5d0a 2020 2020 2020 2020  dims[0].        
+00043eb0: 6966 205f 636f 6e74 6169 6e73 5f64 6174  if _contains_dat
+00043ec0: 6574 696d 655f 6c69 6b65 5f6f 626a 6563  etime_like_objec
+00043ed0: 7473 2863 6f6f 7264 5f76 6172 293a 0a20  ts(coord_var):. 
+00043ee0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+00043ef0: 6f72 645f 7661 722e 6474 7970 652e 6b69  ord_var.dtype.ki
+00043f00: 6e64 2069 6e20 226d 4d22 2061 6e64 2064  nd in "mM" and d
+00043f10: 6174 6574 696d 655f 756e 6974 2069 7320  atetime_unit is 
+00043f20: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00043f30: 2020 2020 2020 6461 7465 7469 6d65 5f75        datetime_u
+00043f40: 6e69 742c 205f 203d 206e 702e 6461 7465  nit, _ = np.date
+00043f50: 7469 6d65 5f64 6174 6128 636f 6f72 645f  time_data(coord_
+00043f60: 7661 722e 6474 7970 6529 0a20 2020 2020  var.dtype).     
+00043f70: 2020 2020 2020 2065 6c69 6620 6461 7465         elif date
+00043f80: 7469 6d65 5f75 6e69 7420 6973 204e 6f6e  time_unit is Non
+00043f90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00043fa0: 2020 2064 6174 6574 696d 655f 756e 6974     datetime_unit
+00043fb0: 203d 2022 7322 2020 2320 4465 6661 756c   = "s"  # Defaul
+00043fc0: 7420 746f 2073 6563 6f6e 6473 2066 6f72  t to seconds for
+00043fd0: 2063 6674 696d 6520 6f62 6a65 6374 730a   cftime objects.
+00043fe0: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
+00043ff0: 645f 7661 7220 3d20 636f 6f72 645f 7661  d_var = coord_va
+00044000: 722e 5f72 6570 6c61 6365 280a 2020 2020  r._replace(.    
+00044010: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00044020: 3d64 6174 6574 696d 655f 746f 5f6e 756d  =datetime_to_num
+00044030: 6572 6963 2863 6f6f 7264 5f76 6172 2e64  eric(coord_var.d
+00044040: 6174 612c 2064 6174 6574 696d 655f 756e  ata, datetime_un
+00044050: 6974 3d64 6174 6574 696d 655f 756e 6974  it=datetime_unit
+00044060: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+00044070: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
+00044080: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
+00044090: 636f 6f72 645f 6e61 6d65 7320 3d20 7365  coord_names = se
+000440a0: 7428 290a 2020 2020 2020 2020 666f 7220  t().        for 
+000440b0: 6b2c 2076 2069 6e20 7365 6c66 2e76 6172  k, v in self.var
+000440c0: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
+000440d0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+000440e0: 2069 6e20 7365 6c66 2e63 6f6f 7264 733a   in self.coords:
+000440f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044100: 2069 6620 6469 6d20 6e6f 7420 696e 2076   if dim not in v
+00044110: 2e64 696d 7320 6f72 2063 756d 756c 6174  .dims or cumulat
+00044120: 6976 653a 0a20 2020 2020 2020 2020 2020  ive:.           
+00044130: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+00044140: 6573 5b6b 5d20 3d20 760a 2020 2020 2020  es[k] = v.      
+00044150: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00044160: 6f72 645f 6e61 6d65 732e 6164 6428 6b29  ord_names.add(k)
+00044170: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00044180: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00044190: 2020 2069 6620 6b20 696e 2073 656c 662e     if k in self.
+000441a0: 6461 7461 5f76 6172 7320 616e 6420 6469  data_vars and di
+000441b0: 6d20 696e 2076 2e64 696d 733a 0a20 2020  m in v.dims:.   
+000441c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000441d0: 2069 6620 5f63 6f6e 7461 696e 735f 6461   if _contains_da
+000441e0: 7465 7469 6d65 5f6c 696b 655f 6f62 6a65  tetime_like_obje
+000441f0: 6374 7328 7629 3a0a 2020 2020 2020 2020  cts(v):.        
+00044200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044210: 7620 3d20 6461 7465 7469 6d65 5f74 6f5f  v = datetime_to_
+00044220: 6e75 6d65 7269 6328 762c 2064 6174 6574  numeric(v, datet
+00044230: 696d 655f 756e 6974 3d64 6174 6574 696d  ime_unit=datetim
+00044240: 655f 756e 6974 290a 2020 2020 2020 2020  e_unit).        
+00044250: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00044260: 756d 756c 6174 6976 653a 0a20 2020 2020  umulative:.     
 00044270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044280: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00044290: 2020 2020 2020 2020 2020 765f 6469 6d73            v_dims
-000442a0: 203d 206c 6973 7428 762e 6469 6d73 290a   = list(v.dims).
+00044280: 2020 2069 6e74 6567 203d 2064 7563 6b5f     integ = duck_
+00044290: 6172 7261 795f 6f70 732e 6375 6d75 6c61  array_ops.cumula
+000442a0: 7469 7665 5f74 7261 7065 7a6f 6964 280a  tive_trapezoid(.
 000442b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000442c0: 2020 2020 2020 2020 765f 6469 6d73 2e72          v_dims.r
-000442d0: 656d 6f76 6528 6469 6d29 0a20 2020 2020  emove(dim).     
-000442e0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000442f0: 6172 6961 626c 6573 5b6b 5d20 3d20 5661  ariables[k] = Va
-00044300: 7269 6162 6c65 2876 5f64 696d 732c 2069  riable(v_dims, i
-00044310: 6e74 6567 290a 2020 2020 2020 2020 2020  nteg).          
-00044320: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00044330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044340: 7661 7269 6162 6c65 735b 6b5d 203d 2076  variables[k] = v
-00044350: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
-00044360: 203d 207b 6b3a 2076 2066 6f72 206b 2c20   = {k: v for k, 
-00044370: 7620 696e 2073 656c 662e 5f69 6e64 6578  v in self._index
-00044380: 6573 2e69 7465 6d73 2829 2069 6620 6b20  es.items() if k 
-00044390: 696e 2076 6172 6961 626c 6573 7d0a 2020  in variables}.  
-000443a0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000443b0: 662e 5f72 6570 6c61 6365 5f77 6974 685f  f._replace_with_
-000443c0: 6e65 775f 6469 6d73 280a 2020 2020 2020  new_dims(.      
-000443d0: 2020 2020 2020 7661 7269 6162 6c65 732c        variables,
-000443e0: 2063 6f6f 7264 5f6e 616d 6573 3d63 6f6f   coord_names=coo
-000443f0: 7264 5f6e 616d 6573 2c20 696e 6465 7865  rd_names, indexe
-00044400: 733d 696e 6465 7865 730a 2020 2020 2020  s=indexes.      
-00044410: 2020 290a 0a20 2020 2064 6566 2063 756d    )..    def cum
-00044420: 756c 6174 6976 655f 696e 7465 6772 6174  ulative_integrat
-00044430: 6528 0a20 2020 2020 2020 2073 656c 663a  e(.        self:
-00044440: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
-00044450: 2020 2020 636f 6f72 643a 2048 6173 6861      coord: Hasha
-00044460: 626c 6520 7c20 5365 7175 656e 6365 5b48  ble | Sequence[H
-00044470: 6173 6861 626c 655d 2c0a 2020 2020 2020  ashable],.      
-00044480: 2020 6461 7465 7469 6d65 5f75 6e69 743a    datetime_unit:
-00044490: 2044 6174 6574 696d 6555 6e69 744f 7074   DatetimeUnitOpt
-000444a0: 696f 6e73 203d 204e 6f6e 652c 0a20 2020  ions = None,.   
-000444b0: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
-000444c0: 0a20 2020 2020 2020 2022 2222 496e 7465  .        """Inte
-000444d0: 6772 6174 6520 616c 6f6e 6720 7468 6520  grate along the 
-000444e0: 6769 7665 6e20 636f 6f72 6469 6e61 7465  given coordinate
-000444f0: 2075 7369 6e67 2074 6865 2074 7261 7065   using the trape
-00044500: 7a6f 6964 616c 2072 756c 652e 0a0a 2020  zoidal rule...  
-00044510: 2020 2020 2020 2e2e 206e 6f74 653a 3a0a        .. note::.
-00044520: 2020 2020 2020 2020 2020 2020 5468 6973              This
-00044530: 2066 6561 7475 7265 2069 7320 6c69 6d69   feature is limi
-00044540: 7465 6420 746f 2073 696d 706c 6520 6361  ted to simple ca
-00044550: 7274 6573 6961 6e20 6765 6f6d 6574 7279  rtesian geometry
-00044560: 2c20 692e 652e 2063 6f6f 7264 0a20 2020  , i.e. coord.   
-00044570: 2020 2020 2020 2020 206d 7573 7420 6265           must be
-00044580: 206f 6e65 2064 696d 656e 7369 6f6e 616c   one dimensional
-00044590: 2e0a 0a20 2020 2020 2020 2020 2020 2054  ...            T
-000445a0: 6865 2066 6972 7374 2065 6e74 7279 206f  he first entry o
-000445b0: 6620 7468 6520 6375 6d75 6c61 7469 7665  f the cumulative
-000445c0: 2069 6e74 6567 7261 6c20 6f66 2065 6163   integral of eac
-000445d0: 6820 7661 7269 6162 6c65 2069 7320 616c  h variable is al
-000445e0: 7761 7973 2030 2c20 696e 0a20 2020 2020  ways 0, in.     
-000445f0: 2020 2020 2020 206f 7264 6572 2074 6f20         order to 
-00044600: 6b65 6570 2074 6865 206c 656e 6774 6820  keep the length 
-00044610: 6f66 2074 6865 2064 696d 656e 7369 6f6e  of the dimension
-00044620: 2075 6e63 6861 6e67 6564 2062 6574 7765   unchanged betwe
-00044630: 656e 2069 6e70 7574 2061 6e64 0a20 2020  en input and.   
-00044640: 2020 2020 2020 2020 206f 7574 7075 742e           output.
-00044650: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00044660: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-00044670: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00044680: 636f 6f72 6420 3a20 6861 7368 6162 6c65  coord : hashable
-00044690: 2c20 6f72 2073 6571 7565 6e63 6520 6f66  , or sequence of
-000446a0: 2068 6173 6861 626c 650a 2020 2020 2020   hashable.      
-000446b0: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
-000446c0: 2873 2920 7573 6564 2066 6f72 2074 6865  (s) used for the
-000446d0: 2069 6e74 6567 7261 7469 6f6e 2e0a 2020   integration..  
-000446e0: 2020 2020 2020 6461 7465 7469 6d65 5f75        datetime_u
-000446f0: 6e69 7420 3a20 7b27 5927 2c20 274d 272c  nit : {'Y', 'M',
-00044700: 2027 5727 2c20 2744 272c 2027 6827 2c20   'W', 'D', 'h', 
-00044710: 276d 272c 2027 7327 2c20 276d 7327 2c20  'm', 's', 'ms', 
-00044720: 2775 7327 2c20 276e 7327 2c20 5c0a 2020  'us', 'ns', \.  
-00044730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044740: 2020 2020 2020 2770 7327 2c20 2766 7327        'ps', 'fs'
-00044750: 2c20 2761 7327 2c20 4e6f 6e65 7d2c 206f  , 'as', None}, o
-00044760: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00044770: 2020 2020 5370 6563 6966 7920 7468 6520      Specify the 
-00044780: 756e 6974 2069 6620 6461 7465 7469 6d65  unit if datetime
-00044790: 2063 6f6f 7264 696e 6174 6520 6973 2075   coordinate is u
-000447a0: 7365 642e 0a0a 2020 2020 2020 2020 5265  sed...        Re
-000447b0: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-000447c0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 696e  -----.        in
-000447d0: 7465 6772 6174 6564 203a 2044 6174 6173  tegrated : Datas
-000447e0: 6574 0a0a 2020 2020 2020 2020 5365 6520  et..        See 
-000447f0: 616c 736f 0a20 2020 2020 2020 202d 2d2d  also.        ---
-00044800: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
-00044810: 7461 4172 7261 792e 6375 6d75 6c61 7469  taArray.cumulati
-00044820: 7665 5f69 6e74 6567 7261 7465 0a20 2020  ve_integrate.   
-00044830: 2020 2020 2073 6369 7079 2e69 6e74 6567       scipy.integ
-00044840: 7261 7465 2e63 756d 756c 6174 6976 655f  rate.cumulative_
-00044850: 7472 6170 657a 6f69 6420 3a20 636f 7272  trapezoid : corr
-00044860: 6573 706f 6e64 696e 6720 7363 6970 7920  esponding scipy 
-00044870: 6675 6e63 7469 6f6e 0a0a 2020 2020 2020  function..      
-00044880: 2020 4578 616d 706c 6573 0a20 2020 2020    Examples.     
-00044890: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-000448a0: 2020 2020 3e3e 3e20 6473 203d 2078 722e      >>> ds = xr.
-000448b0: 4461 7461 7365 7428 0a20 2020 2020 2020  Dataset(.       
-000448c0: 202e 2e2e 2020 2020 2064 6174 615f 7661   ...     data_va
-000448d0: 7273 3d7b 2261 223a 2028 2278 222c 205b  rs={"a": ("x", [
-000448e0: 352c 2035 2c20 362c 2036 5d29 2c20 2262  5, 5, 6, 6]), "b
-000448f0: 223a 2028 2278 222c 205b 312c 2032 2c20  ": ("x", [1, 2, 
-00044900: 312c 2030 5d29 7d2c 0a20 2020 2020 2020  1, 0])},.       
-00044910: 202e 2e2e 2020 2020 2063 6f6f 7264 733d   ...     coords=
-00044920: 7b22 7822 3a20 5b30 2c20 312c 2032 2c20  {"x": [0, 1, 2, 
-00044930: 335d 2c20 2279 223a 2028 2278 222c 205b  3], "y": ("x", [
-00044940: 312c 2037 2c20 332c 2035 5d29 7d2c 0a20  1, 7, 3, 5])},. 
-00044950: 2020 2020 2020 202e 2e2e 2029 0a20 2020         ... ).   
-00044960: 2020 2020 203e 3e3e 2064 730a 2020 2020       >>> ds.    
-00044970: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
-00044980: 7365 743e 0a20 2020 2020 2020 2044 696d  set>.        Dim
-00044990: 656e 7369 6f6e 733a 2020 2878 3a20 3429  ensions:  (x: 4)
-000449a0: 0a20 2020 2020 2020 2043 6f6f 7264 696e  .        Coordin
-000449b0: 6174 6573 3a0a 2020 2020 2020 2020 2020  ates:.          
-000449c0: 2a20 7820 2020 2020 2020 2028 7829 2069  * x        (x) i
-000449d0: 6e74 3634 2030 2031 2032 2033 0a20 2020  nt64 0 1 2 3.   
-000449e0: 2020 2020 2020 2020 2079 2020 2020 2020           y      
-000449f0: 2020 2878 2920 696e 7436 3420 3120 3720    (x) int64 1 7 
-00044a00: 3320 350a 2020 2020 2020 2020 4461 7461  3 5.        Data
-00044a10: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-00044a20: 2020 2020 2020 2020 6120 2020 2020 2020          a       
-00044a30: 2028 7829 2069 6e74 3634 2035 2035 2036   (x) int64 5 5 6
-00044a40: 2036 0a20 2020 2020 2020 2020 2020 2062   6.            b
-00044a50: 2020 2020 2020 2020 2878 2920 696e 7436          (x) int6
-00044a60: 3420 3120 3220 3120 300a 2020 2020 2020  4 1 2 1 0.      
-00044a70: 2020 3e3e 3e20 6473 2e63 756d 756c 6174    >>> ds.cumulat
-00044a80: 6976 655f 696e 7465 6772 6174 6528 2278  ive_integrate("x
-00044a90: 2229 0a20 2020 2020 2020 203c 7861 7272  ").        <xarr
-00044aa0: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
-00044ab0: 2020 2020 4469 6d65 6e73 696f 6e73 3a20      Dimensions: 
-00044ac0: 2028 783a 2034 290a 2020 2020 2020 2020   (x: 4).        
-00044ad0: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
-00044ae0: 2020 2020 2020 202a 2078 2020 2020 2020         * x      
-00044af0: 2020 2878 2920 696e 7436 3420 3020 3120    (x) int64 0 1 
-00044b00: 3220 330a 2020 2020 2020 2020 2020 2020  2 3.            
-00044b10: 7920 2020 2020 2020 2028 7829 2069 6e74  y        (x) int
-00044b20: 3634 2031 2037 2033 2035 0a20 2020 2020  64 1 7 3 5.     
-00044b30: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
-00044b40: 733a 0a20 2020 2020 2020 2020 2020 2061  s:.            a
-00044b50: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
-00044b60: 7436 3420 302e 3020 352e 3020 3130 2e35  t64 0.0 5.0 10.5
-00044b70: 2031 362e 350a 2020 2020 2020 2020 2020   16.5.          
-00044b80: 2020 6220 2020 2020 2020 2028 7829 2066    b        (x) f
-00044b90: 6c6f 6174 3634 2030 2e30 2031 2e35 2033  loat64 0.0 1.5 3
-00044ba0: 2e30 2033 2e35 0a20 2020 2020 2020 203e  .0 3.5.        >
-00044bb0: 3e3e 2064 732e 6375 6d75 6c61 7469 7665  >> ds.cumulative
-00044bc0: 5f69 6e74 6567 7261 7465 2822 7922 290a  _integrate("y").
-00044bd0: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-00044be0: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-00044bf0: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
-00044c00: 3a20 3429 0a20 2020 2020 2020 2043 6f6f  : 4).        Coo
-00044c10: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
-00044c20: 2020 2020 2a20 7820 2020 2020 2020 2028      * x        (
-00044c30: 7829 2069 6e74 3634 2030 2031 2032 2033  x) int64 0 1 2 3
-00044c40: 0a20 2020 2020 2020 2020 2020 2079 2020  .            y  
-00044c50: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
-00044c60: 3120 3720 3320 350a 2020 2020 2020 2020  1 7 3 5.        
-00044c70: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
-00044c80: 2020 2020 2020 2020 2020 2020 6120 2020              a   
-00044c90: 2020 2020 2028 7829 2066 6c6f 6174 3634       (x) float64
-00044ca0: 2030 2e30 2033 302e 3020 382e 3020 3230   0.0 30.0 8.0 20
-00044cb0: 2e30 0a20 2020 2020 2020 2020 2020 2062  .0.            b
-00044cc0: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
-00044cd0: 7436 3420 302e 3020 392e 3020 332e 3020  t64 0.0 9.0 3.0 
-00044ce0: 342e 300a 2020 2020 2020 2020 2222 220a  4.0.        """.
-00044cf0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00044d00: 7369 6e73 7461 6e63 6528 636f 6f72 642c  sinstance(coord,
-00044d10: 2028 6c69 7374 2c20 7475 706c 6529 293a   (list, tuple)):
-00044d20: 0a20 2020 2020 2020 2020 2020 2063 6f6f  .            coo
-00044d30: 7264 203d 2028 636f 6f72 642c 290a 2020  rd = (coord,).  
-00044d40: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
-00044d50: 656c 660a 2020 2020 2020 2020 666f 7220  elf.        for 
-00044d60: 6320 696e 2063 6f6f 7264 3a0a 2020 2020  c in coord:.    
-00044d70: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00044d80: 2072 6573 756c 742e 5f69 6e74 6567 7261   result._integra
-00044d90: 7465 5f6f 6e65 280a 2020 2020 2020 2020  te_one(.        
-00044da0: 2020 2020 2020 2020 632c 2064 6174 6574          c, datet
-00044db0: 696d 655f 756e 6974 3d64 6174 6574 696d  ime_unit=datetim
-00044dc0: 655f 756e 6974 2c20 6375 6d75 6c61 7469  e_unit, cumulati
-00044dd0: 7665 3d54 7275 650a 2020 2020 2020 2020  ve=True.        
-00044de0: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
-00044df0: 7475 726e 2072 6573 756c 740a 0a20 2020  turn result..   
-00044e00: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00044e10: 6566 2072 6561 6c28 7365 6c66 3a20 545f  ef real(self: T_
-00044e20: 4461 7461 7365 7429 202d 3e20 545f 4461  Dataset) -> T_Da
-00044e30: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
-00044e40: 2222 0a20 2020 2020 2020 2054 6865 2072  "".        The r
-00044e50: 6561 6c20 7061 7274 206f 6620 6561 6368  eal part of each
-00044e60: 2064 6174 6120 7661 7269 6162 6c65 2e0a   data variable..
-00044e70: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-00044e80: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-00044e90: 2d2d 0a20 2020 2020 2020 206e 756d 7079  --.        numpy
-00044ea0: 2e6e 6461 7272 6179 2e72 6561 6c0a 2020  .ndarray.real.  
-00044eb0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00044ec0: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
-00044ed0: 7028 6c61 6d62 6461 2078 3a20 782e 7265  p(lambda x: x.re
-00044ee0: 616c 2c20 6b65 6570 5f61 7474 7273 3d54  al, keep_attrs=T
-00044ef0: 7275 6529 0a0a 2020 2020 4070 726f 7065  rue)..    @prope
-00044f00: 7274 790a 2020 2020 6465 6620 696d 6167  rty.    def imag
-00044f10: 2873 656c 663a 2054 5f44 6174 6173 6574  (self: T_Dataset
-00044f20: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-00044f30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00044f40: 2020 2020 5468 6520 696d 6167 696e 6172      The imaginar
-00044f50: 7920 7061 7274 206f 6620 6561 6368 2064  y part of each d
-00044f60: 6174 6120 7661 7269 6162 6c65 2e0a 0a20  ata variable... 
-00044f70: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00044f80: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00044f90: 0a20 2020 2020 2020 206e 756d 7079 2e6e  .        numpy.n
-00044fa0: 6461 7272 6179 2e69 6d61 670a 2020 2020  darray.imag.    
-00044fb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00044fc0: 7265 7475 726e 2073 656c 662e 6d61 7028  return self.map(
-00044fd0: 6c61 6d62 6461 2078 3a20 782e 696d 6167  lambda x: x.imag
-00044fe0: 2c20 6b65 6570 5f61 7474 7273 3d54 7275  , keep_attrs=Tru
-00044ff0: 6529 0a0a 2020 2020 706c 6f74 203d 2075  e)..    plot = u
-00045000: 7469 6c73 2e55 6e63 6163 6865 6441 6363  tils.UncachedAcc
-00045010: 6573 736f 7228 4461 7461 7365 7450 6c6f  essor(DatasetPlo
-00045020: 7441 6363 6573 736f 7229 0a0a 2020 2020  tAccessor)..    
-00045030: 6465 6620 6669 6c74 6572 5f62 795f 6174  def filter_by_at
-00045040: 7472 7328 7365 6c66 3a20 545f 4461 7461  trs(self: T_Data
-00045050: 7365 742c 202a 2a6b 7761 7267 7329 202d  set, **kwargs) -
-00045060: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-00045070: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00045080: 6120 6060 4461 7461 7365 7460 6020 7769  a ``Dataset`` wi
-00045090: 7468 2076 6172 6961 626c 6573 2074 6861  th variables tha
-000450a0: 7420 6d61 7463 6820 7370 6563 6966 6963  t match specific
-000450b0: 2063 6f6e 6469 7469 6f6e 732e 0a0a 2020   conditions...  
-000450c0: 2020 2020 2020 4361 6e20 7061 7373 2069        Can pass i
-000450d0: 6e20 6060 6b65 793d 7661 6c75 6560 6020  n ``key=value`` 
-000450e0: 6f72 2060 606b 6579 3d63 616c 6c61 626c  or ``key=callabl
-000450f0: 6560 602e 2020 4120 4461 7461 7365 7420  e``.  A Dataset 
-00045100: 6973 2072 6574 7572 6e65 640a 2020 2020  is returned.    
-00045110: 2020 2020 636f 6e74 6169 6e69 6e67 206f      containing o
-00045120: 6e6c 7920 7468 6520 7661 7269 6162 6c65  nly the variable
-00045130: 7320 666f 7220 7768 6963 6820 616c 6c20  s for which all 
-00045140: 7468 6520 6669 6c74 6572 2074 6573 7473  the filter tests
-00045150: 2070 6173 732e 0a20 2020 2020 2020 2054   pass..        T
-00045160: 6865 7365 2074 6573 7473 2061 7265 2065  hese tests are e
-00045170: 6974 6865 7220 6060 6b65 793d 7661 6c75  ither ``key=valu
-00045180: 6560 6020 666f 7220 7768 6963 6820 7468  e`` for which th
-00045190: 6520 6174 7472 6962 7574 6520 6060 6b65  e attribute ``ke
-000451a0: 7960 600a 2020 2020 2020 2020 6861 7320  y``.        has 
-000451b0: 7468 6520 6578 6163 7420 7661 6c75 6520  the exact value 
-000451c0: 6060 7661 6c75 6560 6020 6f72 2074 6865  ``value`` or the
-000451d0: 2063 616c 6c61 626c 6520 7061 7373 6564   callable passed
-000451e0: 2069 6e74 6f0a 2020 2020 2020 2020 6060   into.        ``
-000451f0: 6b65 793d 6361 6c6c 6162 6c65 6060 2072  key=callable`` r
-00045200: 6574 7572 6e73 2054 7275 652e 2054 6865  eturns True. The
-00045210: 2063 616c 6c61 626c 6520 7769 6c6c 2062   callable will b
-00045220: 6520 7061 7373 6564 2061 2073 696e 676c  e passed a singl
-00045230: 650a 2020 2020 2020 2020 7661 6c75 652c  e.        value,
-00045240: 2065 6974 6865 7220 7468 6520 7661 6c75   either the valu
-00045250: 6520 6f66 2074 6865 2061 7474 7269 6275  e of the attribu
-00045260: 7465 2060 606b 6579 6060 206f 7220 6060  te ``key`` or ``
-00045270: 4e6f 6e65 6060 2069 6620 7468 650a 2020  None`` if the.  
-00045280: 2020 2020 2020 4461 7461 4172 7261 7920        DataArray 
-00045290: 646f 6573 206e 6f74 2068 6176 6520 616e  does not have an
-000452a0: 2061 7474 7269 6275 7465 2077 6974 6820   attribute with 
-000452b0: 7468 6520 6e61 6d65 2060 606b 6579 6060  the name ``key``
-000452c0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-000452d0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-000452e0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-000452f0: 202a 2a6b 7761 7267 730a 2020 2020 2020   **kwargs.      
-00045300: 2020 2020 2020 6b65 7920 3a20 7374 720a        key : str.
-00045310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045320: 4174 7472 6962 7574 6520 6e61 6d65 2e0a  Attribute name..
-00045330: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-00045340: 6520 3a20 6361 6c6c 6162 6c65 206f 7220  e : callable or 
-00045350: 6f62 6a0a 2020 2020 2020 2020 2020 2020  obj.            
-00045360: 2020 2020 4966 2076 616c 7565 2069 7320      If value is 
-00045370: 6120 6361 6c6c 6162 6c65 2c20 6974 2073  a callable, it s
-00045380: 686f 756c 6420 7265 7475 726e 2061 2062  hould return a b
-00045390: 6f6f 6c65 616e 2069 6e20 7468 6520 666f  oolean in the fo
-000453a0: 726d 0a20 2020 2020 2020 2020 2020 2020  rm.             
-000453b0: 2020 206f 6620 626f 6f6c 203d 2066 756e     of bool = fun
-000453c0: 6328 6174 7472 2920 7768 6572 6520 6174  c(attr) where at
-000453d0: 7472 2069 7320 6461 2e61 7474 7273 5b6b  tr is da.attrs[k
-000453e0: 6579 5d2e 0a20 2020 2020 2020 2020 2020  ey]..           
-000453f0: 2020 2020 204f 7468 6572 7769 7365 2c20       Otherwise, 
-00045400: 7661 6c75 6520 7769 6c6c 2062 6520 636f  value will be co
-00045410: 6d70 6172 6564 2074 6f20 7468 6520 6561  mpared to the ea
-00045420: 6368 0a20 2020 2020 2020 2020 2020 2020  ch.             
-00045430: 2020 2044 6174 6141 7272 6179 2773 2061     DataArray's a
-00045440: 7474 7273 5b6b 6579 5d2e 0a0a 2020 2020  ttrs[key]...    
-00045450: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-00045460: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-00045470: 2020 2020 6e65 7720 3a20 4461 7461 7365      new : Datase
-00045480: 740a 2020 2020 2020 2020 2020 2020 4e65  t.            Ne
-00045490: 7720 6461 7461 7365 7420 7769 7468 2076  w dataset with v
-000454a0: 6172 6961 626c 6573 2066 696c 7465 7265  ariables filtere
-000454b0: 6420 6279 2061 7474 7269 6275 7465 2e0a  d by attribute..
-000454c0: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-000454d0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-000454e0: 2d2d 0a20 2020 2020 2020 203e 3e3e 2074  --.        >>> t
-000454f0: 656d 7020 3d20 3135 202b 2038 202a 206e  emp = 15 + 8 * n
-00045500: 702e 7261 6e64 6f6d 2e72 616e 646e 2832  p.random.randn(2
-00045510: 2c20 322c 2033 290a 2020 2020 2020 2020  , 2, 3).        
-00045520: 3e3e 3e20 7072 6563 6970 203d 2031 3020  >>> precip = 10 
-00045530: 2a20 6e70 2e72 616e 646f 6d2e 7261 6e64  * np.random.rand
-00045540: 2832 2c20 322c 2033 290a 2020 2020 2020  (2, 2, 3).      
-00045550: 2020 3e3e 3e20 6c6f 6e20 3d20 5b5b 2d39    >>> lon = [[-9
-00045560: 392e 3833 2c20 2d39 392e 3332 5d2c 205b  9.83, -99.32], [
-00045570: 2d39 392e 3739 2c20 2d39 392e 3233 5d5d  -99.79, -99.23]]
-00045580: 0a20 2020 2020 2020 203e 3e3e 206c 6174  .        >>> lat
-00045590: 203d 205b 5b34 322e 3235 2c20 3432 2e32   = [[42.25, 42.2
-000455a0: 315d 2c20 5b34 322e 3633 2c20 3432 2e35  1], [42.63, 42.5
-000455b0: 395d 5d0a 2020 2020 2020 2020 3e3e 3e20  9]].        >>> 
-000455c0: 6469 6d73 203d 205b 2278 222c 2022 7922  dims = ["x", "y"
-000455d0: 2c20 2274 696d 6522 5d0a 2020 2020 2020  , "time"].      
-000455e0: 2020 3e3e 3e20 7465 6d70 5f61 7474 7220    >>> temp_attr 
-000455f0: 3d20 6469 6374 2873 7461 6e64 6172 645f  = dict(standard_
-00045600: 6e61 6d65 3d22 6169 725f 706f 7465 6e74  name="air_potent
-00045610: 6961 6c5f 7465 6d70 6572 6174 7572 6522  ial_temperature"
-00045620: 290a 2020 2020 2020 2020 3e3e 3e20 7072  ).        >>> pr
-00045630: 6563 6970 5f61 7474 7220 3d20 6469 6374  ecip_attr = dict
-00045640: 2873 7461 6e64 6172 645f 6e61 6d65 3d22  (standard_name="
-00045650: 636f 6e76 6563 7469 7665 5f70 7265 6369  convective_preci
-00045660: 7069 7461 7469 6f6e 5f66 6c75 7822 290a  pitation_flux").
-00045670: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
-00045680: 3d20 7872 2e44 6174 6173 6574 280a 2020  = xr.Dataset(.  
-00045690: 2020 2020 2020 2e2e 2e20 2020 2020 6469        ...     di
-000456a0: 6374 280a 2020 2020 2020 2020 2e2e 2e20  ct(.        ... 
-000456b0: 2020 2020 2020 2020 7465 6d70 6572 6174          temperat
-000456c0: 7572 653d 2864 696d 732c 2074 656d 702c  ure=(dims, temp,
-000456d0: 2074 656d 705f 6174 7472 292c 0a20 2020   temp_attr),.   
-000456e0: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
-000456f0: 2070 7265 6369 7069 7461 7469 6f6e 3d28   precipitation=(
-00045700: 6469 6d73 2c20 7072 6563 6970 2c20 7072  dims, precip, pr
-00045710: 6563 6970 5f61 7474 7229 2c0a 2020 2020  ecip_attr),.    
-00045720: 2020 2020 2e2e 2e20 2020 2020 292c 0a20      ...     ),. 
-00045730: 2020 2020 2020 202e 2e2e 2020 2020 2063         ...     c
-00045740: 6f6f 7264 733d 6469 6374 280a 2020 2020  oords=dict(.    
-00045750: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-00045760: 6c6f 6e3d 285b 2278 222c 2022 7922 5d2c  lon=(["x", "y"],
-00045770: 206c 6f6e 292c 0a20 2020 2020 2020 202e   lon),.        .
-00045780: 2e2e 2020 2020 2020 2020 206c 6174 3d28  ..         lat=(
-00045790: 5b22 7822 2c20 2279 225d 2c20 6c61 7429  ["x", "y"], lat)
-000457a0: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-000457b0: 2020 2020 2020 7469 6d65 3d70 642e 6461        time=pd.da
-000457c0: 7465 5f72 616e 6765 2822 3230 3134 2d30  te_range("2014-0
-000457d0: 392d 3036 222c 2070 6572 696f 6473 3d33  9-06", periods=3
-000457e0: 292c 0a20 2020 2020 2020 202e 2e2e 2020  ),.        ...  
-000457f0: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-00045800: 5f74 696d 653d 7064 2e54 696d 6573 7461  _time=pd.Timesta
-00045810: 6d70 2822 3230 3134 2d30 392d 3035 2229  mp("2014-09-05")
-00045820: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-00045830: 2020 292c 0a20 2020 2020 2020 202e 2e2e    ),.        ...
-00045840: 2029 0a0a 2020 2020 2020 2020 4765 7420   )..        Get 
-00045850: 7661 7269 6162 6c65 7320 6d61 7463 6869  variables matchi
-00045860: 6e67 2061 2073 7065 6369 6669 6320 7374  ng a specific st
-00045870: 616e 6461 7264 5f6e 616d 653a 0a0a 2020  andard_name:..  
-00045880: 2020 2020 2020 3e3e 3e20 6473 2e66 696c        >>> ds.fil
-00045890: 7465 725f 6279 5f61 7474 7273 2873 7461  ter_by_attrs(sta
-000458a0: 6e64 6172 645f 6e61 6d65 3d22 636f 6e76  ndard_name="conv
-000458b0: 6563 7469 7665 5f70 7265 6369 7069 7461  ective_precipita
-000458c0: 7469 6f6e 5f66 6c75 7822 290a 2020 2020  tion_flux").    
-000458d0: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
-000458e0: 7365 743e 0a20 2020 2020 2020 2044 696d  set>.        Dim
-000458f0: 656e 7369 6f6e 733a 2020 2020 2020 2020  ensions:        
-00045900: 2028 783a 2032 2c20 793a 2032 2c20 7469   (x: 2, y: 2, ti
-00045910: 6d65 3a20 3329 0a20 2020 2020 2020 2043  me: 3).        C
-00045920: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-00045930: 2020 2020 2020 2020 6c6f 6e20 2020 2020          lon     
-00045940: 2020 2020 2020 2020 2878 2c20 7929 2066          (x, y) f
-00045950: 6c6f 6174 3634 202d 3939 2e38 3320 2d39  loat64 -99.83 -9
-00045960: 392e 3332 202d 3939 2e37 3920 2d39 392e  9.32 -99.79 -99.
-00045970: 3233 0a20 2020 2020 2020 2020 2020 206c  23.            l
-00045980: 6174 2020 2020 2020 2020 2020 2020 2028  at             (
-00045990: 782c 2079 2920 666c 6f61 7436 3420 3432  x, y) float64 42
-000459a0: 2e32 3520 3432 2e32 3120 3432 2e36 3320  .25 42.21 42.63 
-000459b0: 3432 2e35 390a 2020 2020 2020 2020 2020  42.59.          
-000459c0: 2a20 7469 6d65 2020 2020 2020 2020 2020  * time          
-000459d0: 2020 2874 696d 6529 2064 6174 6574 696d    (time) datetim
-000459e0: 6536 345b 6e73 5d20 3230 3134 2d30 392d  e64[ns] 2014-09-
-000459f0: 3036 2032 3031 342d 3039 2d30 3720 3230  06 2014-09-07 20
-00045a00: 3134 2d30 392d 3038 0a20 2020 2020 2020  14-09-08.       
-00045a10: 2020 2020 2072 6566 6572 656e 6365 5f74       reference_t
-00045a20: 696d 6520 2064 6174 6574 696d 6536 345b  ime  datetime64[
-00045a30: 6e73 5d20 3230 3134 2d30 392d 3035 0a20  ns] 2014-09-05. 
-00045a40: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
-00045a50: 7320 7769 7468 6f75 7420 636f 6f72 6469  s without coordi
-00045a60: 6e61 7465 733a 2078 2c20 790a 2020 2020  nates: x, y.    
-00045a70: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
-00045a80: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00045a90: 7072 6563 6970 6974 6174 696f 6e20 2020  precipitation   
-00045aa0: 2878 2c20 792c 2074 696d 6529 2066 6c6f  (x, y, time) flo
-00045ab0: 6174 3634 2035 2e36 3820 392e 3235 3620  at64 5.68 9.256 
-00045ac0: 302e 3731 3034 202e 2e2e 2037 2e39 3932  0.7104 ... 7.992
-00045ad0: 2034 2e36 3135 2037 2e38 3035 0a0a 2020   4.615 7.805..  
-00045ae0: 2020 2020 2020 4765 7420 616c 6c20 7661        Get all va
-00045af0: 7269 6162 6c65 7320 7468 6174 2068 6176  riables that hav
-00045b00: 6520 6120 7374 616e 6461 7264 5f6e 616d  e a standard_nam
-00045b10: 6520 6174 7472 6962 7574 653a 0a0a 2020  e attribute:..  
-00045b20: 2020 2020 2020 3e3e 3e20 7374 616e 6461        >>> standa
-00045b30: 7264 5f6e 616d 6520 3d20 6c61 6d62 6461  rd_name = lambda
-00045b40: 2076 3a20 7620 6973 206e 6f74 204e 6f6e   v: v is not Non
-00045b50: 650a 2020 2020 2020 2020 3e3e 3e20 6473  e.        >>> ds
-00045b60: 2e66 696c 7465 725f 6279 5f61 7474 7273  .filter_by_attrs
-00045b70: 2873 7461 6e64 6172 645f 6e61 6d65 3d73  (standard_name=s
-00045b80: 7461 6e64 6172 645f 6e61 6d65 290a 2020  tandard_name).  
-00045b90: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-00045ba0: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-00045bb0: 696d 656e 7369 6f6e 733a 2020 2020 2020  imensions:      
-00045bc0: 2020 2028 783a 2032 2c20 793a 2032 2c20     (x: 2, y: 2, 
-00045bd0: 7469 6d65 3a20 3329 0a20 2020 2020 2020  time: 3).       
-00045be0: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
-00045bf0: 2020 2020 2020 2020 2020 6c6f 6e20 2020            lon   
-00045c00: 2020 2020 2020 2020 2020 2878 2c20 7929            (x, y)
-00045c10: 2066 6c6f 6174 3634 202d 3939 2e38 3320   float64 -99.83 
-00045c20: 2d39 392e 3332 202d 3939 2e37 3920 2d39  -99.32 -99.79 -9
-00045c30: 392e 3233 0a20 2020 2020 2020 2020 2020  9.23.           
-00045c40: 206c 6174 2020 2020 2020 2020 2020 2020   lat            
-00045c50: 2028 782c 2079 2920 666c 6f61 7436 3420   (x, y) float64 
-00045c60: 3432 2e32 3520 3432 2e32 3120 3432 2e36  42.25 42.21 42.6
-00045c70: 3320 3432 2e35 390a 2020 2020 2020 2020  3 42.59.        
-00045c80: 2020 2a20 7469 6d65 2020 2020 2020 2020    * time        
-00045c90: 2020 2020 2874 696d 6529 2064 6174 6574      (time) datet
-00045ca0: 696d 6536 345b 6e73 5d20 3230 3134 2d30  ime64[ns] 2014-0
-00045cb0: 392d 3036 2032 3031 342d 3039 2d30 3720  9-06 2014-09-07 
-00045cc0: 3230 3134 2d30 392d 3038 0a20 2020 2020  2014-09-08.     
-00045cd0: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-00045ce0: 5f74 696d 6520 2064 6174 6574 696d 6536  _time  datetime6
-00045cf0: 345b 6e73 5d20 3230 3134 2d30 392d 3035  4[ns] 2014-09-05
-00045d00: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
-00045d10: 6f6e 7320 7769 7468 6f75 7420 636f 6f72  ons without coor
-00045d20: 6469 6e61 7465 733a 2078 2c20 790a 2020  dinates: x, y.  
-00045d30: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
-00045d40: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
-00045d50: 2020 7465 6d70 6572 6174 7572 6520 2020    temperature   
-00045d60: 2020 2878 2c20 792c 2074 696d 6529 2066    (x, y, time) f
-00045d70: 6c6f 6174 3634 2032 392e 3131 2031 382e  loat64 29.11 18.
-00045d80: 3220 3232 2e38 3320 2e2e 2e20 3138 2e32  2 22.83 ... 18.2
-00045d90: 3820 3136 2e31 3520 3236 2e36 330a 2020  8 16.15 26.63.  
-00045da0: 2020 2020 2020 2020 2020 7072 6563 6970            precip
-00045db0: 6974 6174 696f 6e20 2020 2878 2c20 792c  itation   (x, y,
-00045dc0: 2074 696d 6529 2066 6c6f 6174 3634 2035   time) float64 5
-00045dd0: 2e36 3820 392e 3235 3620 302e 3731 3034  .68 9.256 0.7104
-00045de0: 202e 2e2e 2037 2e39 3932 2034 2e36 3135   ... 7.992 4.615
-00045df0: 2037 2e38 3035 0a0a 2020 2020 2020 2020   7.805..        
-00045e00: 2222 220a 2020 2020 2020 2020 7365 6c65  """.        sele
-00045e10: 6374 696f 6e20 3d20 5b5d 0a20 2020 2020  ction = [].     
-00045e20: 2020 2066 6f72 2076 6172 5f6e 616d 652c     for var_name,
-00045e30: 2076 6172 6961 626c 6520 696e 2073 656c   variable in sel
-00045e40: 662e 7661 7269 6162 6c65 732e 6974 656d  f.variables.item
-00045e50: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00045e60: 2068 6173 5f76 616c 7565 5f66 6c61 6720   has_value_flag 
-00045e70: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00045e80: 2020 2020 666f 7220 6174 7472 5f6e 616d      for attr_nam
-00045e90: 652c 2070 6174 7465 726e 2069 6e20 6b77  e, pattern in kw
-00045ea0: 6172 6773 2e69 7465 6d73 2829 3a0a 2020  args.items():.  
-00045eb0: 2020 2020 2020 2020 2020 2020 2020 6174                at
-00045ec0: 7472 5f76 616c 7565 203d 2076 6172 6961  tr_value = varia
-00045ed0: 626c 652e 6174 7472 732e 6765 7428 6174  ble.attrs.get(at
-00045ee0: 7472 5f6e 616d 6529 0a20 2020 2020 2020  tr_name).       
-00045ef0: 2020 2020 2020 2020 2069 6620 2863 616c           if (cal
-00045f00: 6c61 626c 6528 7061 7474 6572 6e29 2061  lable(pattern) a
-00045f10: 6e64 2070 6174 7465 726e 2861 7474 725f  nd pattern(attr_
-00045f20: 7661 6c75 6529 2920 6f72 2061 7474 725f  value)) or attr_
-00045f30: 7661 6c75 6520 3d3d 2070 6174 7465 726e  value == pattern
-00045f40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00045f50: 2020 2020 2020 6861 735f 7661 6c75 655f        has_value_
-00045f60: 666c 6167 203d 2054 7275 650a 2020 2020  flag = True.    
-00045f70: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00045f80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00045f90: 2020 2020 2020 6861 735f 7661 6c75 655f        has_value_
-00045fa0: 666c 6167 203d 2046 616c 7365 0a20 2020  flag = False.   
-00045fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045fc0: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00045fd0: 2020 2069 6620 6861 735f 7661 6c75 655f     if has_value_
-00045fe0: 666c 6167 2069 7320 5472 7565 3a0a 2020  flag is True:.  
-00045ff0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00046000: 6c65 6374 696f 6e2e 6170 7065 6e64 2876  lection.append(v
-00046010: 6172 5f6e 616d 6529 0a20 2020 2020 2020  ar_name).       
-00046020: 2072 6574 7572 6e20 7365 6c66 5b73 656c   return self[sel
-00046030: 6563 7469 6f6e 5d0a 0a20 2020 2064 6566  ection]..    def
-00046040: 2075 6e69 6679 5f63 6875 6e6b 7328 7365   unify_chunks(se
-00046050: 6c66 3a20 545f 4461 7461 7365 7429 202d  lf: T_Dataset) -
-00046060: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-00046070: 2020 2020 2022 2222 556e 6966 7920 6368       """Unify ch
-00046080: 756e 6b20 7369 7a65 2061 6c6f 6e67 2061  unk size along a
-00046090: 6c6c 2063 6875 6e6b 6564 2064 696d 656e  ll chunked dimen
-000460a0: 7369 6f6e 7320 6f66 2074 6869 7320 4461  sions of this Da
-000460b0: 7461 7365 742e 0a0a 2020 2020 2020 2020  taset...        
-000460c0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-000460d0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-000460e0: 4461 7461 7365 7420 7769 7468 2063 6f6e  Dataset with con
-000460f0: 7369 7374 656e 7420 6368 756e 6b20 7369  sistent chunk si
-00046100: 7a65 7320 666f 7220 616c 6c20 6461 736b  zes for all dask
-00046110: 2d61 7272 6179 2076 6172 6961 626c 6573  -array variables
-00046120: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-00046130: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-00046140: 2d2d 2d0a 2020 2020 2020 2020 6461 736b  ---.        dask
-00046150: 2e61 7272 6179 2e63 6f72 652e 756e 6966  .array.core.unif
-00046160: 795f 6368 756e 6b73 0a20 2020 2020 2020  y_chunks.       
-00046170: 2022 2222 0a0a 2020 2020 2020 2020 7265   """..        re
-00046180: 7475 726e 2075 6e69 6679 5f63 6875 6e6b  turn unify_chunk
-00046190: 7328 7365 6c66 295b 305d 0a0a 2020 2020  s(self)[0]..    
-000461a0: 6465 6620 6d61 705f 626c 6f63 6b73 280a  def map_blocks(.
-000461b0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-000461c0: 2020 2020 2020 6675 6e63 3a20 4361 6c6c        func: Call
-000461d0: 6162 6c65 5b2e 2e2e 2c20 545f 5861 7272  able[..., T_Xarr
-000461e0: 6179 5d2c 0a20 2020 2020 2020 2061 7267  ay],.        arg
-000461f0: 733a 2053 6571 7565 6e63 655b 416e 795d  s: Sequence[Any]
-00046200: 203d 2028 292c 0a20 2020 2020 2020 206b   = (),.        k
-00046210: 7761 7267 733a 204d 6170 7069 6e67 5b73  wargs: Mapping[s
-00046220: 7472 2c20 416e 795d 207c 204e 6f6e 6520  tr, Any] | None 
-00046230: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00046240: 7465 6d70 6c61 7465 3a20 4461 7461 4172  template: DataAr
-00046250: 7261 7920 7c20 4461 7461 7365 7420 7c20  ray | Dataset | 
-00046260: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00046270: 2029 202d 3e20 545f 5861 7272 6179 3a0a   ) -> T_Xarray:.
-00046280: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00046290: 2020 2020 4170 706c 7920 6120 6675 6e63      Apply a func
-000462a0: 7469 6f6e 2074 6f20 6561 6368 2062 6c6f  tion to each blo
-000462b0: 636b 206f 6620 7468 6973 2044 6174 6173  ck of this Datas
-000462c0: 6574 2e0a 0a20 2020 2020 2020 202e 2e20  et...        .. 
-000462d0: 7761 726e 696e 673a 3a0a 2020 2020 2020  warning::.      
-000462e0: 2020 2020 2020 5468 6973 206d 6574 686f        This metho
-000462f0: 6420 6973 2065 7870 6572 696d 656e 7461  d is experimenta
-00046300: 6c20 616e 6420 6974 7320 7369 676e 6174  l and its signat
-00046310: 7572 6520 6d61 7920 6368 616e 6765 2e0a  ure may change..
-00046320: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00046330: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00046340: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2066  ------.        f
-00046350: 756e 6320 3a20 6361 6c6c 6162 6c65 0a20  unc : callable. 
-00046360: 2020 2020 2020 2020 2020 2055 7365 722d             User-
-00046370: 7072 6f76 6964 6564 2066 756e 6374 696f  provided functio
-00046380: 6e20 7468 6174 2061 6363 6570 7473 2061  n that accepts a
-00046390: 2044 6174 6173 6574 2061 7320 6974 7320   Dataset as its 
-000463a0: 6669 7273 740a 2020 2020 2020 2020 2020  first.          
-000463b0: 2020 7061 7261 6d65 7465 722e 2054 6865    parameter. The
-000463c0: 2066 756e 6374 696f 6e20 7769 6c6c 2072   function will r
-000463d0: 6563 6569 7665 2061 2073 7562 7365 7420  eceive a subset 
-000463e0: 6f72 2027 626c 6f63 6b27 206f 6620 7468  or 'block' of th
-000463f0: 6973 2044 6174 6173 6574 2028 7365 6520  is Dataset (see 
-00046400: 6265 6c6f 7729 2c0a 2020 2020 2020 2020  below),.        
-00046410: 2020 2020 636f 7272 6573 706f 6e64 696e      correspondin
-00046420: 6720 746f 206f 6e65 2063 6875 6e6b 2061  g to one chunk a
-00046430: 6c6f 6e67 2065 6163 6820 6368 756e 6b65  long each chunke
-00046440: 6420 6469 6d65 6e73 696f 6e2e 2060 6066  d dimension. ``f
-00046450: 756e 6360 6020 7769 6c6c 2062 650a 2020  unc`` will be.  
-00046460: 2020 2020 2020 2020 2020 6578 6563 7574            execut
-00046470: 6564 2061 7320 6060 6675 6e63 2873 7562  ed as ``func(sub
-00046480: 7365 745f 6461 7461 7365 742c 202a 7375  set_dataset, *su
-00046490: 6273 6574 5f61 7267 732c 202a 2a6b 7761  bset_args, **kwa
-000464a0: 7267 7329 6060 2e0a 0a20 2020 2020 2020  rgs)``...       
-000464b0: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
-000464c0: 6f6e 206d 7573 7420 7265 7475 726e 2065  on must return e
-000464d0: 6974 6865 7220 6120 7369 6e67 6c65 2044  ither a single D
-000464e0: 6174 6141 7272 6179 206f 7220 6120 7369  ataArray or a si
-000464f0: 6e67 6c65 2044 6174 6173 6574 2e0a 0a20  ngle Dataset... 
-00046500: 2020 2020 2020 2020 2020 2054 6869 7320             This 
-00046510: 6675 6e63 7469 6f6e 2063 616e 6e6f 7420  function cannot 
-00046520: 6164 6420 6120 6e65 7720 6368 756e 6b65  add a new chunke
-00046530: 6420 6469 6d65 6e73 696f 6e2e 0a20 2020  d dimension..   
-00046540: 2020 2020 2061 7267 7320 3a20 7365 7175       args : sequ
-00046550: 656e 6365 0a20 2020 2020 2020 2020 2020  ence.           
-00046560: 2050 6173 7365 6420 746f 2066 756e 6320   Passed to func 
-00046570: 6166 7465 7220 756e 7061 636b 696e 6720  after unpacking 
-00046580: 616e 6420 7375 6273 6574 7469 6e67 2061  and subsetting a
-00046590: 6e79 2078 6172 7261 7920 6f62 6a65 6374  ny xarray object
-000465a0: 7320 6279 2062 6c6f 636b 732e 0a20 2020  s by blocks..   
-000465b0: 2020 2020 2020 2020 2078 6172 7261 7920           xarray 
-000465c0: 6f62 6a65 6374 7320 696e 2061 7267 7320  objects in args 
-000465d0: 6d75 7374 2062 6520 616c 6967 6e65 6420  must be aligned 
-000465e0: 7769 7468 206f 626a 2c20 6f74 6865 7277  with obj, otherw
-000465f0: 6973 6520 616e 2065 7272 6f72 2069 7320  ise an error is 
-00046600: 7261 6973 6564 2e0a 2020 2020 2020 2020  raised..        
-00046610: 6b77 6172 6773 203a 204d 6170 7069 6e67  kwargs : Mapping
-00046620: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
-00046630: 2020 2020 2050 6173 7365 6420 7665 7262       Passed verb
-00046640: 6174 696d 2074 6f20 6675 6e63 2061 6674  atim to func aft
-00046650: 6572 2075 6e70 6163 6b69 6e67 2e20 7861  er unpacking. xa
-00046660: 7272 6179 206f 626a 6563 7473 2c20 6966  rray objects, if
-00046670: 2061 6e79 2c20 7769 6c6c 206e 6f74 2062   any, will not b
-00046680: 650a 2020 2020 2020 2020 2020 2020 7375  e.            su
-00046690: 6273 6574 2074 6f20 626c 6f63 6b73 2e20  bset to blocks. 
-000466a0: 5061 7373 696e 6720 6461 736b 2063 6f6c  Passing dask col
-000466b0: 6c65 6374 696f 6e73 2069 6e20 6b77 6172  lections in kwar
-000466c0: 6773 2069 7320 6e6f 7420 616c 6c6f 7765  gs is not allowe
-000466d0: 642e 0a20 2020 2020 2020 2074 656d 706c  d..        templ
-000466e0: 6174 6520 3a20 4461 7461 4172 7261 792c  ate : DataArray,
-000466f0: 2044 6174 6173 6574 206f 7220 4e6f 6e65   Dataset or None
-00046700: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00046710: 2020 2020 2020 2078 6172 7261 7920 6f62         xarray ob
-00046720: 6a65 6374 2072 6570 7265 7365 6e74 696e  ject representin
-00046730: 6720 7468 6520 6669 6e61 6c20 7265 7375  g the final resu
-00046740: 6c74 2061 6674 6572 2063 6f6d 7075 7465  lt after compute
-00046750: 2069 7320 6361 6c6c 6564 2e20 4966 206e   is called. If n
-00046760: 6f74 2070 726f 7669 6465 642c 0a20 2020  ot provided,.   
-00046770: 2020 2020 2020 2020 2074 6865 2066 756e           the fun
-00046780: 6374 696f 6e20 7769 6c6c 2062 6520 6669  ction will be fi
-00046790: 7273 7420 7275 6e20 6f6e 206d 6f63 6b65  rst run on mocke
-000467a0: 642d 7570 2064 6174 612c 2074 6861 7420  d-up data, that 
-000467b0: 6c6f 6f6b 7320 6c69 6b65 2074 6869 7320  looks like this 
-000467c0: 6f62 6a65 6374 2062 7574 0a20 2020 2020  object but.     
-000467d0: 2020 2020 2020 2068 6173 2073 697a 6573         has sizes
-000467e0: 2030 2c20 746f 2064 6574 6572 6d69 6e65   0, to determine
-000467f0: 2070 726f 7065 7274 6965 7320 6f66 2074   properties of t
-00046800: 6865 2072 6574 7572 6e65 6420 6f62 6a65  he returned obje
-00046810: 6374 2073 7563 6820 6173 2064 7479 7065  ct such as dtype
-00046820: 2c0a 2020 2020 2020 2020 2020 2020 7661  ,.            va
-00046830: 7269 6162 6c65 206e 616d 6573 2c20 6174  riable names, at
-00046840: 7472 6962 7574 6573 2c20 6e65 7720 6469  tributes, new di
-00046850: 6d65 6e73 696f 6e73 2061 6e64 206e 6577  mensions and new
-00046860: 2069 6e64 6578 6573 2028 6966 2061 6e79   indexes (if any
-00046870: 292e 0a20 2020 2020 2020 2020 2020 2060  )..            `
-00046880: 6074 656d 706c 6174 6560 6020 6d75 7374  `template`` must
-00046890: 2062 6520 7072 6f76 6964 6564 2069 6620   be provided if 
-000468a0: 7468 6520 6675 6e63 7469 6f6e 2063 6861  the function cha
-000468b0: 6e67 6573 2074 6865 2073 697a 6520 6f66  nges the size of
-000468c0: 2065 7869 7374 696e 6720 6469 6d65 6e73   existing dimens
-000468d0: 696f 6e73 2e0a 2020 2020 2020 2020 2020  ions..          
-000468e0: 2020 5768 656e 2070 726f 7669 6465 642c    When provided,
-000468f0: 2060 6061 7474 7273 6060 206f 6e20 7661   ``attrs`` on va
-00046900: 7269 6162 6c65 7320 696e 2060 7465 6d70  riables in `temp
-00046910: 6c61 7465 6020 6172 6520 636f 7069 6564  late` are copied
-00046920: 206f 7665 7220 746f 2074 6865 2072 6573   over to the res
-00046930: 756c 742e 2041 6e79 0a20 2020 2020 2020  ult. Any.       
-00046940: 2020 2020 2060 6061 7474 7273 6060 2073       ``attrs`` s
-00046950: 6574 2062 7920 6060 6675 6e63 6060 2077  et by ``func`` w
-00046960: 696c 6c20 6265 2069 676e 6f72 6564 2e0a  ill be ignored..
-00046970: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00046980: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00046990: 0a20 2020 2020 2020 2041 2073 696e 676c  .        A singl
-000469a0: 6520 4461 7461 4172 7261 7920 6f72 2044  e DataArray or D
-000469b0: 6174 6173 6574 2077 6974 6820 6461 736b  ataset with dask
-000469c0: 2062 6163 6b65 6e64 2c20 7265 6173 7365   backend, reasse
-000469d0: 6d62 6c65 6420 6672 6f6d 2074 6865 206f  mbled from the o
-000469e0: 7574 7075 7473 206f 6620 7468 650a 2020  utputs of the.  
-000469f0: 2020 2020 2020 6675 6e63 7469 6f6e 2e0a        function..
-00046a00: 0a20 2020 2020 2020 204e 6f74 6573 0a20  .        Notes. 
-00046a10: 2020 2020 2020 202d 2d2d 2d2d 0a20 2020         -----.   
-00046a20: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
-00046a30: 6f6e 2069 7320 6465 7369 676e 6564 2066  on is designed f
-00046a40: 6f72 2077 6865 6e20 6060 6675 6e63 6060  or when ``func``
-00046a50: 206e 6565 6473 2074 6f20 6d61 6e69 7075   needs to manipu
-00046a60: 6c61 7465 2061 2077 686f 6c65 2078 6172  late a whole xar
-00046a70: 7261 7920 6f62 6a65 6374 0a20 2020 2020  ray object.     
-00046a80: 2020 2073 7562 7365 7420 746f 2065 6163     subset to eac
-00046a90: 6820 626c 6f63 6b2e 2045 6163 6820 626c  h block. Each bl
-00046aa0: 6f63 6b20 6973 206c 6f61 6465 6420 696e  ock is loaded in
-00046ab0: 746f 206d 656d 6f72 792e 2049 6e20 7468  to memory. In th
-00046ac0: 6520 6d6f 7265 2063 6f6d 6d6f 6e20 6361  e more common ca
-00046ad0: 7365 2077 6865 7265 0a20 2020 2020 2020  se where.       
-00046ae0: 2060 6066 756e 6360 6020 6361 6e20 776f   ``func`` can wo
-00046af0: 726b 206f 6e20 6e75 6d70 7920 6172 7261  rk on numpy arra
-00046b00: 7973 2c20 6974 2069 7320 7265 636f 6d6d  ys, it is recomm
-00046b10: 656e 6465 6420 746f 2075 7365 2060 6061  ended to use ``a
-00046b20: 7070 6c79 5f75 6675 6e63 6060 2e0a 0a20  pply_ufunc``... 
-00046b30: 2020 2020 2020 2049 6620 6e6f 6e65 206f         If none o
-00046b40: 6620 7468 6520 7661 7269 6162 6c65 7320  f the variables 
-00046b50: 696e 2074 6869 7320 6f62 6a65 6374 2069  in this object i
-00046b60: 7320 6261 636b 6564 2062 7920 6461 736b  s backed by dask
-00046b70: 2061 7272 6179 732c 2063 616c 6c69 6e67   arrays, calling
-00046b80: 2074 6869 7320 6675 6e63 7469 6f6e 2069   this function i
-00046b90: 730a 2020 2020 2020 2020 6571 7569 7661  s.        equiva
-00046ba0: 6c65 6e74 2074 6f20 6361 6c6c 696e 6720  lent to calling 
-00046bb0: 6060 6675 6e63 286f 626a 2c20 2a61 7267  ``func(obj, *arg
-00046bc0: 732c 202a 2a6b 7761 7267 7329 6060 2e0a  s, **kwargs)``..
-00046bd0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-00046be0: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-00046bf0: 2d2d 0a20 2020 2020 2020 2064 6173 6b2e  --.        dask.
-00046c00: 6172 7261 792e 6d61 705f 626c 6f63 6b73  array.map_blocks
-00046c10: 2c20 7861 7272 6179 2e61 7070 6c79 5f75  , xarray.apply_u
-00046c20: 6675 6e63 2c20 7861 7272 6179 2e44 6174  func, xarray.Dat
-00046c30: 6173 6574 2e6d 6170 5f62 6c6f 636b 730a  aset.map_blocks.
-00046c40: 2020 2020 2020 2020 7861 7272 6179 2e44          xarray.D
-00046c50: 6174 6141 7272 6179 2e6d 6170 5f62 6c6f  ataArray.map_blo
-00046c60: 636b 730a 0a20 2020 2020 2020 2045 7861  cks..        Exa
-00046c70: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
-00046c80: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2043  ------.        C
-00046c90: 616c 6375 6c61 7465 2061 6e20 616e 6f6d  alculate an anom
-00046ca0: 616c 7920 6672 6f6d 2063 6c69 6d61 746f  aly from climato
-00046cb0: 6c6f 6779 2075 7369 6e67 2060 602e 6772  logy using ``.gr
-00046cc0: 6f75 7062 7928 2960 602e 2055 7369 6e67  oupby()``. Using
-00046cd0: 0a20 2020 2020 2020 2060 6078 722e 6d61  .        ``xr.ma
-00046ce0: 705f 626c 6f63 6b73 2829 6060 2061 6c6c  p_blocks()`` all
-00046cf0: 6f77 7320 666f 7220 7061 7261 6c6c 656c  ows for parallel
-00046d00: 206f 7065 7261 7469 6f6e 7320 7769 7468   operations with
-00046d10: 206b 6e6f 776c 6564 6765 206f 6620 6060   knowledge of ``
-00046d20: 7861 7272 6179 6060 2c0a 2020 2020 2020  xarray``,.      
-00046d30: 2020 6974 7320 696e 6469 6365 732c 2061    its indices, a
-00046d40: 6e64 2069 7473 206d 6574 686f 6473 206c  nd its methods l
-00046d50: 696b 6520 6060 2e67 726f 7570 6279 2829  ike ``.groupby()
-00046d60: 6060 2e0a 0a20 2020 2020 2020 203e 3e3e  ``...        >>>
-00046d70: 2064 6566 2063 616c 6375 6c61 7465 5f61   def calculate_a
-00046d80: 6e6f 6d61 6c79 2864 612c 2067 726f 7570  nomaly(da, group
-00046d90: 6279 5f74 7970 653d 2274 696d 652e 6d6f  by_type="time.mo
-00046da0: 6e74 6822 293a 0a20 2020 2020 2020 202e  nth"):.        .
-00046db0: 2e2e 2020 2020 2067 6220 3d20 6461 2e67  ..     gb = da.g
-00046dc0: 726f 7570 6279 2867 726f 7570 6279 5f74  roupby(groupby_t
-00046dd0: 7970 6529 0a20 2020 2020 2020 202e 2e2e  ype).        ...
-00046de0: 2020 2020 2063 6c69 6d20 3d20 6762 2e6d       clim = gb.m
-00046df0: 6561 6e28 6469 6d3d 2274 696d 6522 290a  ean(dim="time").
-00046e00: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-00046e10: 7265 7475 726e 2067 6220 2d20 636c 696d  return gb - clim
-00046e20: 0a20 2020 2020 2020 202e 2e2e 0a20 2020  .        ....   
-00046e30: 2020 2020 203e 3e3e 2074 696d 6520 3d20       >>> time = 
-00046e40: 7872 2e63 6674 696d 655f 7261 6e67 6528  xr.cftime_range(
-00046e50: 2231 3939 302d 3031 222c 2022 3139 3932  "1990-01", "1992
-00046e60: 2d30 3122 2c20 6672 6571 3d22 4d22 290a  -01", freq="M").
-00046e70: 2020 2020 2020 2020 3e3e 3e20 6d6f 6e74          >>> mont
-00046e80: 6820 3d20 7872 2e44 6174 6141 7272 6179  h = xr.DataArray
-00046e90: 2874 696d 652e 6d6f 6e74 682c 2063 6f6f  (time.month, coo
-00046ea0: 7264 733d 7b22 7469 6d65 223a 2074 696d  rds={"time": tim
-00046eb0: 657d 2c20 6469 6d73 3d5b 2274 696d 6522  e}, dims=["time"
-00046ec0: 5d29 0a20 2020 2020 2020 203e 3e3e 206e  ]).        >>> n
-00046ed0: 702e 7261 6e64 6f6d 2e73 6565 6428 3132  p.random.seed(12
-00046ee0: 3329 0a20 2020 2020 2020 203e 3e3e 2061  3).        >>> a
-00046ef0: 7272 6179 203d 2078 722e 4461 7461 4172  rray = xr.DataAr
-00046f00: 7261 7928 0a20 2020 2020 2020 202e 2e2e  ray(.        ...
-00046f10: 2020 2020 206e 702e 7261 6e64 6f6d 2e72       np.random.r
-00046f20: 616e 6428 6c65 6e28 7469 6d65 2929 2c0a  and(len(time)),.
-00046f30: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-00046f40: 6469 6d73 3d5b 2274 696d 6522 5d2c 0a20  dims=["time"],. 
-00046f50: 2020 2020 2020 202e 2e2e 2020 2020 2063         ...     c
-00046f60: 6f6f 7264 733d 7b22 7469 6d65 223a 2074  oords={"time": t
-00046f70: 696d 652c 2022 6d6f 6e74 6822 3a20 6d6f  ime, "month": mo
-00046f80: 6e74 687d 2c0a 2020 2020 2020 2020 2e2e  nth},.        ..
-00046f90: 2e20 292e 6368 756e 6b28 290a 2020 2020  . ).chunk().    
-00046fa0: 2020 2020 3e3e 3e20 6473 203d 2078 722e      >>> ds = xr.
-00046fb0: 4461 7461 7365 7428 7b22 6122 3a20 6172  Dataset({"a": ar
-00046fc0: 7261 797d 290a 2020 2020 2020 2020 3e3e  ray}).        >>
-00046fd0: 3e20 6473 2e6d 6170 5f62 6c6f 636b 7328  > ds.map_blocks(
-00046fe0: 6361 6c63 756c 6174 655f 616e 6f6d 616c  calculate_anomal
-00046ff0: 792c 2074 656d 706c 6174 653d 6473 292e  y, template=ds).
-00047000: 636f 6d70 7574 6528 290a 2020 2020 2020  compute().      
-00047010: 2020 3c78 6172 7261 792e 4461 7461 7365    <xarray.Datase
-00047020: 743e 0a20 2020 2020 2020 2044 696d 656e  t>.        Dimen
-00047030: 7369 6f6e 733a 2020 2874 696d 653a 2032  sions:  (time: 2
-00047040: 3429 0a20 2020 2020 2020 2043 6f6f 7264  4).        Coord
-00047050: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
-00047060: 2020 2a20 7469 6d65 2020 2020 2028 7469    * time     (ti
-00047070: 6d65 2920 6f62 6a65 6374 2031 3939 302d  me) object 1990-
-00047080: 3031 2d33 3120 3030 3a30 303a 3030 202e  01-31 00:00:00 .
-00047090: 2e2e 2031 3939 312d 3132 2d33 3120 3030  .. 1991-12-31 00
-000470a0: 3a30 303a 3030 0a20 2020 2020 2020 2020  :00:00.         
-000470b0: 2020 206d 6f6e 7468 2020 2020 2874 696d     month    (tim
-000470c0: 6529 2069 6e74 3634 2031 2032 2033 2034  e) int64 1 2 3 4
-000470d0: 2035 2036 2037 2038 2039 2031 3020 3131   5 6 7 8 9 10 11
-000470e0: 2031 3220 3120 3220 3320 3420 3520 3620   12 1 2 3 4 5 6 
-000470f0: 3720 3820 3920 3130 2031 3120 3132 0a20  7 8 9 10 11 12. 
-00047100: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
-00047110: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
-00047120: 2020 2061 2020 2020 2020 2020 2874 696d     a        (tim
-00047130: 6529 2066 6c6f 6174 3634 2030 2e31 3238  e) float64 0.128
-00047140: 3920 302e 3131 3332 202d 302e 3038 3536  9 0.1132 -0.0856
-00047150: 202e 2e2e 2030 2e32 3238 3720 302e 3139   ... 0.2287 0.19
-00047160: 3036 202d 302e 3035 3930 310a 0a20 2020  06 -0.05901..   
-00047170: 2020 2020 204e 6f74 6520 7468 6174 206f       Note that o
-00047180: 6e65 206d 7573 7420 6578 706c 6963 6974  ne must explicit
-00047190: 6c79 2075 7365 2060 6061 7267 733d 5b5d  ly use ``args=[]
-000471a0: 6060 2061 6e64 2060 606b 7761 7267 733d  `` and ``kwargs=
-000471b0: 7b7d 6060 2074 6f20 7061 7373 2061 7267  {}`` to pass arg
-000471c0: 756d 656e 7473 0a20 2020 2020 2020 2074  uments.        t
-000471d0: 6f20 7468 6520 6675 6e63 7469 6f6e 2062  o the function b
-000471e0: 6569 6e67 2061 7070 6c69 6564 2069 6e20  eing applied in 
-000471f0: 6060 7872 2e6d 6170 5f62 6c6f 636b 7328  ``xr.map_blocks(
-00047200: 2960 603a 0a0a 2020 2020 2020 2020 3e3e  )``:..        >>
-00047210: 3e20 6473 2e6d 6170 5f62 6c6f 636b 7328  > ds.map_blocks(
-00047220: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-00047230: 2063 616c 6375 6c61 7465 5f61 6e6f 6d61   calculate_anoma
-00047240: 6c79 2c0a 2020 2020 2020 2020 2e2e 2e20  ly,.        ... 
-00047250: 2020 2020 6b77 6172 6773 3d7b 2267 726f      kwargs={"gro
-00047260: 7570 6279 5f74 7970 6522 3a20 2274 696d  upby_type": "tim
-00047270: 652e 7965 6172 227d 2c0a 2020 2020 2020  e.year"},.      
-00047280: 2020 2e2e 2e20 2020 2020 7465 6d70 6c61    ...     templa
-00047290: 7465 3d64 732c 0a20 2020 2020 2020 202e  te=ds,.        .
-000472a0: 2e2e 2029 0a20 2020 2020 2020 203c 7861  .. ).        <xa
-000472b0: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
-000472c0: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
-000472d0: 3a20 2028 7469 6d65 3a20 3234 290a 2020  :  (time: 24).  
-000472e0: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
-000472f0: 733a 0a20 2020 2020 2020 2020 202a 2074  s:.          * t
-00047300: 696d 6520 2020 2020 2874 696d 6529 206f  ime     (time) o
-00047310: 626a 6563 7420 3139 3930 2d30 312d 3331  bject 1990-01-31
-00047320: 2030 303a 3030 3a30 3020 2e2e 2e20 3139   00:00:00 ... 19
-00047330: 3931 2d31 322d 3331 2030 303a 3030 3a30  91-12-31 00:00:0
-00047340: 300a 2020 2020 2020 2020 2020 2020 6d6f  0.            mo
-00047350: 6e74 6820 2020 2028 7469 6d65 2920 696e  nth    (time) in
-00047360: 7436 3420 6461 736b 2e61 7272 6179 3c63  t64 dask.array<c
-00047370: 6875 6e6b 7369 7a65 3d28 3234 2c29 2c20  hunksize=(24,), 
-00047380: 6d65 7461 3d6e 702e 6e64 6172 7261 793e  meta=np.ndarray>
-00047390: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-000473a0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-000473b0: 2020 2020 2061 2020 2020 2020 2020 2874       a        (t
-000473c0: 696d 6529 2066 6c6f 6174 3634 2064 6173  ime) float64 das
-000473d0: 6b2e 6172 7261 793c 6368 756e 6b73 697a  k.array<chunksiz
-000473e0: 653d 2832 342c 292c 206d 6574 613d 6e70  e=(24,), meta=np
-000473f0: 2e6e 6461 7272 6179 3e0a 2020 2020 2020  .ndarray>.      
-00047400: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-00047410: 6f6d 2078 6172 7261 792e 636f 7265 2e70  om xarray.core.p
-00047420: 6172 616c 6c65 6c20 696d 706f 7274 206d  arallel import m
-00047430: 6170 5f62 6c6f 636b 730a 0a20 2020 2020  ap_blocks..     
-00047440: 2020 2072 6574 7572 6e20 6d61 705f 626c     return map_bl
-00047450: 6f63 6b73 2866 756e 632c 2073 656c 662c  ocks(func, self,
-00047460: 2061 7267 732c 206b 7761 7267 732c 2074   args, kwargs, t
-00047470: 656d 706c 6174 6529 0a0a 2020 2020 6465  emplate)..    de
-00047480: 6620 706f 6c79 6669 7428 0a20 2020 2020  f polyfit(.     
-00047490: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-000474a0: 6574 2c0a 2020 2020 2020 2020 6469 6d3a  et,.        dim:
-000474b0: 2048 6173 6861 626c 652c 0a20 2020 2020   Hashable,.     
-000474c0: 2020 2064 6567 3a20 696e 742c 0a20 2020     deg: int,.   
-000474d0: 2020 2020 2073 6b69 706e 613a 2062 6f6f       skipna: boo
-000474e0: 6c20 7c20 4e6f 6e65 203d 204e 6f6e 652c  l | None = None,
-000474f0: 0a20 2020 2020 2020 2072 636f 6e64 3a20  .        rcond: 
-00047500: 666c 6f61 7420 7c20 4e6f 6e65 203d 204e  float | None = N
-00047510: 6f6e 652c 0a20 2020 2020 2020 2077 3a20  one,.        w: 
-00047520: 4861 7368 6162 6c65 207c 2041 6e79 203d  Hashable | Any =
-00047530: 204e 6f6e 652c 0a20 2020 2020 2020 2066   None,.        f
-00047540: 756c 6c3a 2062 6f6f 6c20 3d20 4661 6c73  ull: bool = Fals
-00047550: 652c 0a20 2020 2020 2020 2063 6f76 3a20  e,.        cov: 
-00047560: 626f 6f6c 207c 204c 6974 6572 616c 5b22  bool | Literal["
-00047570: 756e 7363 616c 6564 225d 203d 2046 616c  unscaled"] = Fal
-00047580: 7365 2c0a 2020 2020 2920 2d3e 2054 5f44  se,.    ) -> T_D
-00047590: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-000475a0: 2222 220a 2020 2020 2020 2020 4c65 6173  """.        Leas
-000475b0: 7420 7371 7561 7265 7320 706f 6c79 6e6f  t squares polyno
-000475c0: 6d69 616c 2066 6974 2e0a 0a20 2020 2020  mial fit...     
-000475d0: 2020 2054 6869 7320 7265 706c 6963 6174     This replicat
-000475e0: 6573 2074 6865 2062 6568 6176 696f 7572  es the behaviour
-000475f0: 206f 6620 606e 756d 7079 2e70 6f6c 7966   of `numpy.polyf
-00047600: 6974 6020 6275 7420 6469 6666 6572 7320  it` but differs 
-00047610: 6279 2073 6b69 7070 696e 670a 2020 2020  by skipping.    
-00047620: 2020 2020 696e 7661 6c69 6420 7661 6c75      invalid valu
-00047630: 6573 2077 6865 6e20 6073 6b69 706e 6120  es when `skipna 
-00047640: 3d20 5472 7565 602e 0a0a 2020 2020 2020  = True`...      
-00047650: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00047660: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00047670: 2020 2020 2020 2020 6469 6d20 3a20 6861          dim : ha
-00047680: 7368 6162 6c65 0a20 2020 2020 2020 2020  shable.         
-00047690: 2020 2043 6f6f 7264 696e 6174 6520 616c     Coordinate al
-000476a0: 6f6e 6720 7768 6963 6820 746f 2066 6974  ong which to fit
-000476b0: 2074 6865 2070 6f6c 796e 6f6d 6961 6c73   the polynomials
-000476c0: 2e0a 2020 2020 2020 2020 6465 6720 3a20  ..        deg : 
-000476d0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-000476e0: 4465 6772 6565 206f 6620 7468 6520 6669  Degree of the fi
-000476f0: 7474 696e 6720 706f 6c79 6e6f 6d69 616c  tting polynomial
-00047700: 2e0a 2020 2020 2020 2020 736b 6970 6e61  ..        skipna
-00047710: 203a 2062 6f6f 6c20 6f72 204e 6f6e 652c   : bool or None,
-00047720: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00047730: 2020 2020 2020 4966 2054 7275 652c 2072        If True, r
-00047740: 656d 6f76 6573 2061 6c6c 2069 6e76 616c  emoves all inval
-00047750: 6964 2076 616c 7565 7320 6265 666f 7265  id values before
-00047760: 2066 6974 7469 6e67 2065 6163 6820 3144   fitting each 1D
-00047770: 2073 6c69 6365 7320 6f66 2074 6865 2061   slices of the a
-00047780: 7272 6179 2e0a 2020 2020 2020 2020 2020  rray..          
-00047790: 2020 4465 6661 756c 7420 6973 2054 7275    Default is Tru
-000477a0: 6520 6966 2064 6174 6120 6973 2073 746f  e if data is sto
-000477b0: 7265 6420 696e 2061 2064 6173 6b2e 6172  red in a dask.ar
-000477c0: 7261 7920 6f72 2069 6620 7468 6572 6520  ray or if there 
-000477d0: 6973 2061 6e79 0a20 2020 2020 2020 2020  is any.         
-000477e0: 2020 2069 6e76 616c 6964 2076 616c 7565     invalid value
-000477f0: 732c 2046 616c 7365 206f 7468 6572 7769  s, False otherwi
-00047800: 7365 2e0a 2020 2020 2020 2020 7263 6f6e  se..        rcon
-00047810: 6420 3a20 666c 6f61 7420 6f72 204e 6f6e  d : float or Non
-00047820: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
-00047830: 2020 2020 2020 2020 5265 6c61 7469 7665          Relative
-00047840: 2063 6f6e 6469 7469 6f6e 206e 756d 6265   condition numbe
-00047850: 7220 746f 2074 6865 2066 6974 2e0a 2020  r to the fit..  
-00047860: 2020 2020 2020 7720 3a20 6861 7368 6162        w : hashab
-00047870: 6c65 206f 7220 416e 792c 206f 7074 696f  le or Any, optio
-00047880: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00047890: 5765 6967 6874 7320 746f 2061 7070 6c79  Weights to apply
-000478a0: 2074 6f20 7468 6520 792d 636f 6f72 6469   to the y-coordi
-000478b0: 6e61 7465 206f 6620 7468 6520 7361 6d70  nate of the samp
-000478c0: 6c65 2070 6f69 6e74 732e 0a20 2020 2020  le points..     
-000478d0: 2020 2020 2020 2043 616e 2062 6520 616e         Can be an
-000478e0: 2061 7272 6179 2d6c 696b 6520 6f62 6a65   array-like obje
-000478f0: 6374 206f 7220 7468 6520 6e61 6d65 206f  ct or the name o
-00047900: 6620 6120 636f 6f72 6469 6e61 7465 2069  f a coordinate i
-00047910: 6e20 7468 6520 6461 7461 7365 742e 0a20  n the dataset.. 
-00047920: 2020 2020 2020 2066 756c 6c20 3a20 626f         full : bo
-00047930: 6f6c 2c20 6465 6661 756c 743a 2046 616c  ol, default: Fal
-00047940: 7365 0a20 2020 2020 2020 2020 2020 2057  se.            W
-00047950: 6865 7468 6572 2074 6f20 7265 7475 726e  hether to return
-00047960: 2074 6865 2072 6573 6964 7561 6c73 2c20   the residuals, 
-00047970: 6d61 7472 6978 2072 616e 6b20 616e 6420  matrix rank and 
-00047980: 7369 6e67 756c 6172 2076 616c 7565 7320  singular values 
-00047990: 696e 2061 6464 6974 696f 6e0a 2020 2020  in addition.    
-000479a0: 2020 2020 2020 2020 746f 2074 6865 2063          to the c
-000479b0: 6f65 6666 6963 6965 6e74 732e 0a20 2020  oefficients..   
-000479c0: 2020 2020 2063 6f76 203a 2062 6f6f 6c20       cov : bool 
-000479d0: 6f72 2022 756e 7363 616c 6564 222c 2064  or "unscaled", d
-000479e0: 6566 6175 6c74 3a20 4661 6c73 650a 2020  efault: False.  
-000479f0: 2020 2020 2020 2020 2020 5768 6574 6865            Whethe
-00047a00: 7220 746f 2072 6574 7572 6e20 746f 2074  r to return to t
-00047a10: 6865 2063 6f76 6172 6961 6e63 6520 6d61  he covariance ma
-00047a20: 7472 6978 2069 6e20 6164 6469 7469 6f6e  trix in addition
-00047a30: 2074 6f20 7468 6520 636f 6566 6669 6369   to the coeffici
-00047a40: 656e 7473 2e0a 2020 2020 2020 2020 2020  ents..          
-00047a50: 2020 5468 6520 6d61 7472 6978 2069 7320    The matrix is 
-00047a60: 6e6f 7420 7363 616c 6564 2069 6620 6063  not scaled if `c
-00047a70: 6f76 3d27 756e 7363 616c 6564 2760 2e0a  ov='unscaled'`..
-00047a80: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00047a90: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00047aa0: 0a20 2020 2020 2020 2070 6f6c 7966 6974  .        polyfit
-00047ab0: 5f72 6573 756c 7473 203a 2044 6174 6173  _results : Datas
-00047ac0: 6574 0a20 2020 2020 2020 2020 2020 2041  et.            A
-00047ad0: 2073 696e 676c 6520 6461 7461 7365 7420   single dataset 
-00047ae0: 7768 6963 6820 636f 6e74 6169 6e73 2028  which contains (
-00047af0: 666f 7220 6561 6368 2022 7661 7222 2069  for each "var" i
-00047b00: 6e20 7468 6520 696e 7075 7420 6461 7461  n the input data
-00047b10: 7365 7429 3a0a 0a20 2020 2020 2020 2020  set):..         
-00047b20: 2020 205b 7661 725d 5f70 6f6c 7966 6974     [var]_polyfit
-00047b30: 5f63 6f65 6666 6963 6965 6e74 730a 2020  _coefficients.  
-00047b40: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-00047b50: 6520 636f 6566 6669 6369 656e 7473 206f  e coefficients o
-00047b60: 6620 7468 6520 6265 7374 2066 6974 2066  f the best fit f
-00047b70: 6f72 2065 6163 6820 7661 7269 6162 6c65  or each variable
-00047b80: 2069 6e20 7468 6973 2064 6174 6173 6574   in this dataset
-00047b90: 2e0a 2020 2020 2020 2020 2020 2020 5b76  ..            [v
-00047ba0: 6172 5d5f 706f 6c79 6669 745f 7265 7369  ar]_polyfit_resi
-00047bb0: 6475 616c 730a 2020 2020 2020 2020 2020  duals.          
-00047bc0: 2020 2020 2020 5468 6520 7265 7369 6475        The residu
-00047bd0: 616c 7320 6f66 2074 6865 206c 6561 7374  als of the least
-00047be0: 2d73 7175 6172 6520 636f 6d70 7574 6174  -square computat
-00047bf0: 696f 6e20 666f 7220 6561 6368 2076 6172  ion for each var
-00047c00: 6961 626c 6520 286f 6e6c 7920 696e 636c  iable (only incl
-00047c10: 7564 6564 2069 6620 6066 756c 6c3d 5472  uded if `full=Tr
-00047c20: 7565 6029 0a20 2020 2020 2020 2020 2020  ue`).           
-00047c30: 2020 2020 2057 6865 6e20 7468 6520 6d61       When the ma
-00047c40: 7472 6978 2072 616e 6b20 6973 2064 6566  trix rank is def
-00047c50: 6963 6965 6e74 2c20 6e70 2e6e 616e 2069  icient, np.nan i
-00047c60: 7320 7265 7475 726e 6564 2e0a 2020 2020  s returned..    
-00047c70: 2020 2020 2020 2020 5b64 696d 5d5f 6d61          [dim]_ma
-00047c80: 7472 6978 5f72 616e 6b0a 2020 2020 2020  trix_rank.      
-00047c90: 2020 2020 2020 2020 2020 5468 6520 6566            The ef
-00047ca0: 6665 6374 6976 6520 7261 6e6b 206f 6620  fective rank of 
-00047cb0: 7468 6520 7363 616c 6564 2056 616e 6465  the scaled Vande
-00047cc0: 726d 6f6e 6465 2063 6f65 6666 6963 6965  rmonde coefficie
-00047cd0: 6e74 206d 6174 7269 7820 286f 6e6c 7920  nt matrix (only 
-00047ce0: 696e 636c 7564 6564 2069 6620 6066 756c  included if `ful
-00047cf0: 6c3d 5472 7565 6029 0a20 2020 2020 2020  l=True`).       
-00047d00: 2020 2020 2020 2020 2054 6865 2072 616e           The ran
-00047d10: 6b20 6973 2063 6f6d 7075 7465 6420 6967  k is computed ig
-00047d20: 6e6f 7269 6e67 2074 6865 204e 614e 2076  noring the NaN v
-00047d30: 616c 7565 7320 7468 6174 206d 6967 6874  alues that might
-00047d40: 2062 6520 736b 6970 7065 642e 0a20 2020   be skipped..   
-00047d50: 2020 2020 2020 2020 205b 6469 6d5d 5f73           [dim]_s
-00047d60: 696e 6775 6c61 725f 7661 6c75 6573 0a20  ingular_values. 
-00047d70: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-00047d80: 6865 2073 696e 6775 6c61 7220 7661 6c75  he singular valu
-00047d90: 6573 206f 6620 7468 6520 7363 616c 6564  es of the scaled
-00047da0: 2056 616e 6465 726d 6f6e 6465 2063 6f65   Vandermonde coe
-00047db0: 6666 6963 6965 6e74 206d 6174 7269 7820  fficient matrix 
-00047dc0: 286f 6e6c 7920 696e 636c 7564 6564 2069  (only included i
-00047dd0: 6620 6066 756c 6c3d 5472 7565 6029 0a20  f `full=True`). 
-00047de0: 2020 2020 2020 2020 2020 205b 7661 725d             [var]
-00047df0: 5f70 6f6c 7966 6974 5f63 6f76 6172 6961  _polyfit_covaria
-00047e00: 6e63 650a 2020 2020 2020 2020 2020 2020  nce.            
-00047e10: 2020 2020 5468 6520 636f 7661 7269 616e      The covarian
-00047e20: 6365 206d 6174 7269 7820 6f66 2074 6865  ce matrix of the
-00047e30: 2070 6f6c 796e 6f6d 6961 6c20 636f 6566   polynomial coef
-00047e40: 6669 6369 656e 7420 6573 7469 6d61 7465  ficient estimate
-00047e50: 7320 286f 6e6c 7920 696e 636c 7564 6564  s (only included
-00047e60: 2069 6620 6066 756c 6c3d 4661 6c73 6560   if `full=False`
-00047e70: 2061 6e64 2060 636f 763d 5472 7565 6029   and `cov=True`)
-00047e80: 0a0a 2020 2020 2020 2020 5761 726e 730a  ..        Warns.
-00047e90: 2020 2020 2020 2020 2d2d 2d2d 2d0a 2020          -----.  
-00047ea0: 2020 2020 2020 5261 6e6b 5761 726e 696e        RankWarnin
-00047eb0: 670a 2020 2020 2020 2020 2020 2020 5468  g.            Th
-00047ec0: 6520 7261 6e6b 206f 6620 7468 6520 636f  e rank of the co
-00047ed0: 6566 6669 6369 656e 7420 6d61 7472 6978  efficient matrix
-00047ee0: 2069 6e20 7468 6520 6c65 6173 742d 7371   in the least-sq
-00047ef0: 7561 7265 7320 6669 7420 6973 2064 6566  uares fit is def
-00047f00: 6963 6965 6e74 2e0a 2020 2020 2020 2020  icient..        
-00047f10: 2020 2020 5468 6520 7761 726e 696e 6720      The warning 
-00047f20: 6973 206e 6f74 2072 6169 7365 6420 7769  is not raised wi
-00047f30: 7468 2069 6e2d 6d65 6d6f 7279 2028 6e6f  th in-memory (no
-00047f40: 7420 6461 736b 2920 6461 7461 2061 6e64  t dask) data and
-00047f50: 2060 6675 6c6c 3d54 7275 6560 2e0a 0a20   `full=True`... 
-00047f60: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00047f70: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00047f80: 0a20 2020 2020 2020 206e 756d 7079 2e70  .        numpy.p
-00047f90: 6f6c 7966 6974 0a20 2020 2020 2020 206e  olyfit.        n
-00047fa0: 756d 7079 2e70 6f6c 7976 616c 0a20 2020  umpy.polyval.   
-00047fb0: 2020 2020 2078 6172 7261 792e 706f 6c79       xarray.poly
-00047fc0: 7661 6c0a 2020 2020 2020 2020 2222 220a  val.        """.
-00047fd0: 2020 2020 2020 2020 6672 6f6d 2078 6172          from xar
-00047fe0: 7261 792e 636f 7265 2e64 6174 6161 7272  ray.core.dataarr
-00047ff0: 6179 2069 6d70 6f72 7420 4461 7461 4172  ay import DataAr
-00048000: 7261 790a 0a20 2020 2020 2020 2076 6172  ray..        var
-00048010: 6961 626c 6573 203d 207b 7d0a 2020 2020  iables = {}.    
-00048020: 2020 2020 736b 6970 6e61 5f64 6120 3d20      skipna_da = 
-00048030: 736b 6970 6e61 0a0a 2020 2020 2020 2020  skipna..        
-00048040: 7820 3d20 6765 745f 636c 6561 6e5f 696e  x = get_clean_in
-00048050: 7465 7270 5f69 6e64 6578 2873 656c 662c  terp_index(self,
-00048060: 2064 696d 2c20 7374 7269 6374 3d46 616c   dim, strict=Fal
-00048070: 7365 290a 2020 2020 2020 2020 786e 616d  se).        xnam
-00048080: 6520 3d20 6622 7b73 656c 665b 6469 6d5d  e = f"{self[dim]
-00048090: 2e6e 616d 657d 5f22 0a20 2020 2020 2020  .name}_".       
-000480a0: 206f 7264 6572 203d 2069 6e74 2864 6567   order = int(deg
-000480b0: 2920 2b20 310a 2020 2020 2020 2020 6c68  ) + 1.        lh
-000480c0: 7320 3d20 6e70 2e76 616e 6465 7228 782c  s = np.vander(x,
-000480d0: 206f 7264 6572 290a 0a20 2020 2020 2020   order)..       
-000480e0: 2069 6620 7263 6f6e 6420 6973 204e 6f6e   if rcond is Non
-000480f0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00048100: 636f 6e64 203d 2028 0a20 2020 2020 2020  cond = (.       
-00048110: 2020 2020 2020 2020 2078 2e73 6861 7065           x.shape
-00048120: 5b30 5d20 2a20 6e70 2e63 6f72 652e 6669  [0] * np.core.fi
-00048130: 6e66 6f28 782e 6474 7970 6529 2e65 7073  nfo(x.dtype).eps
-00048140: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
-00048150: 5b61 7474 722d 6465 6669 6e65 645d 0a20  [attr-defined]. 
-00048160: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00048170: 2020 2020 2020 2320 5765 6967 6874 733a        # Weights:
-00048180: 0a20 2020 2020 2020 2069 6620 7720 6973  .        if w is
-00048190: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-000481a0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-000481b0: 616e 6365 2877 2c20 4861 7368 6162 6c65  ance(w, Hashable
-000481c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000481d0: 2020 2077 203d 2073 656c 662e 636f 6f72     w = self.coor
-000481e0: 6473 5b77 5d0a 2020 2020 2020 2020 2020  ds[w].          
-000481f0: 2020 7720 3d20 6e70 2e61 7361 7272 6179    w = np.asarray
-00048200: 2877 290a 2020 2020 2020 2020 2020 2020  (w).            
-00048210: 6966 2077 2e6e 6469 6d20 213d 2031 3a0a  if w.ndim != 1:.
-00048220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048230: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-00048240: 2245 7870 6563 7465 6420 6120 312d 6420  "Expected a 1-d 
-00048250: 6172 7261 7920 666f 7220 7765 6967 6874  array for weight
-00048260: 732e 2229 0a20 2020 2020 2020 2020 2020  s.").           
-00048270: 2069 6620 772e 7368 6170 655b 305d 2021   if w.shape[0] !
-00048280: 3d20 6c68 732e 7368 6170 655b 305d 3a0a  = lhs.shape[0]:.
-00048290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000482a0: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-000482b0: 6622 4578 7065 6374 6564 2077 2061 6e64  f"Expected w and
-000482c0: 207b 6469 6d7d 2074 6f20 6861 7665 2074   {dim} to have t
-000482d0: 6865 2073 616d 6520 6c65 6e67 7468 2229  he same length")
-000482e0: 0a20 2020 2020 2020 2020 2020 206c 6873  .            lhs
-000482f0: 202a 3d20 775b 3a2c 206e 702e 6e65 7761   *= w[:, np.newa
-00048300: 7869 735d 0a0a 2020 2020 2020 2020 2320  xis]..        # 
-00048310: 5363 616c 696e 670a 2020 2020 2020 2020  Scaling.        
-00048320: 7363 616c 6520 3d20 6e70 2e73 7172 7428  scale = np.sqrt(
-00048330: 286c 6873 202a 206c 6873 292e 7375 6d28  (lhs * lhs).sum(
-00048340: 6178 6973 3d30 2929 0a20 2020 2020 2020  axis=0)).       
-00048350: 206c 6873 202f 3d20 7363 616c 650a 0a20   lhs /= scale.. 
-00048360: 2020 2020 2020 2064 6567 7265 655f 6469         degree_di
-00048370: 6d20 3d20 7574 696c 732e 6765 745f 7465  m = utils.get_te
-00048380: 6d70 5f64 696d 6e61 6d65 2873 656c 662e  mp_dimname(self.
-00048390: 6469 6d73 2c20 2264 6567 7265 6522 290a  dims, "degree").
-000483a0: 0a20 2020 2020 2020 2072 616e 6b20 3d20  .        rank = 
-000483b0: 6e70 2e6c 696e 616c 672e 6d61 7472 6978  np.linalg.matrix
-000483c0: 5f72 616e 6b28 6c68 7329 0a0a 2020 2020  _rank(lhs)..    
-000483d0: 2020 2020 6966 2066 756c 6c3a 0a20 2020      if full:.   
-000483e0: 2020 2020 2020 2020 2072 616e 6b20 3d20           rank = 
-000483f0: 4461 7461 4172 7261 7928 7261 6e6b 2c20  DataArray(rank, 
-00048400: 6e61 6d65 3d78 6e61 6d65 202b 2022 6d61  name=xname + "ma
-00048410: 7472 6978 5f72 616e 6b22 290a 2020 2020  trix_rank").    
-00048420: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-00048430: 735b 7261 6e6b 2e6e 616d 655d 203d 2072  s[rank.name] = r
-00048440: 616e 6b0a 2020 2020 2020 2020 2020 2020  ank.            
-00048450: 5f73 696e 6720 3d20 6e70 2e6c 696e 616c  _sing = np.linal
-00048460: 672e 7376 6428 6c68 732c 2063 6f6d 7075  g.svd(lhs, compu
-00048470: 7465 5f75 763d 4661 6c73 6529 0a20 2020  te_uv=False).   
-00048480: 2020 2020 2020 2020 2073 696e 6720 3d20           sing = 
-00048490: 4461 7461 4172 7261 7928 0a20 2020 2020  DataArray(.     
-000484a0: 2020 2020 2020 2020 2020 205f 7369 6e67             _sing
-000484b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000484c0: 2020 6469 6d73 3d28 6465 6772 6565 5f64    dims=(degree_d
-000484d0: 696d 2c29 2c0a 2020 2020 2020 2020 2020  im,),.          
-000484e0: 2020 2020 2020 636f 6f72 6473 3d7b 6465        coords={de
-000484f0: 6772 6565 5f64 696d 3a20 6e70 2e61 7261  gree_dim: np.ara
-00048500: 6e67 6528 7261 6e6b 202d 2031 2c20 2d31  nge(rank - 1, -1
-00048510: 2c20 2d31 297d 2c0a 2020 2020 2020 2020  , -1)},.        
-00048520: 2020 2020 2020 2020 6e61 6d65 3d78 6e61          name=xna
-00048530: 6d65 202b 2022 7369 6e67 756c 6172 5f76  me + "singular_v
-00048540: 616c 7565 7322 2c0a 2020 2020 2020 2020  alues",.        
-00048550: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00048560: 2020 7661 7269 6162 6c65 735b 7369 6e67    variables[sing
-00048570: 2e6e 616d 655d 203d 2073 696e 670a 0a20  .name] = sing.. 
-00048580: 2020 2020 2020 2066 6f72 206e 616d 652c         for name,
-00048590: 2064 6120 696e 2073 656c 662e 6461 7461   da in self.data
-000485a0: 5f76 6172 732e 6974 656d 7328 293a 0a20  _vars.items():. 
-000485b0: 2020 2020 2020 2020 2020 2069 6620 6469             if di
-000485c0: 6d20 6e6f 7420 696e 2064 612e 6469 6d73  m not in da.dims
-000485d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000485e0: 2020 636f 6e74 696e 7565 0a0a 2020 2020    continue..    
-000485f0: 2020 2020 2020 2020 6966 2069 735f 6475          if is_du
-00048600: 636b 5f64 6173 6b5f 6172 7261 7928 6461  ck_dask_array(da
-00048610: 2e64 6174 6129 2061 6e64 2028 0a20 2020  .data) and (.   
-00048620: 2020 2020 2020 2020 2020 2020 2072 616e               ran
-00048630: 6b20 213d 206f 7264 6572 206f 7220 6675  k != order or fu
-00048640: 6c6c 206f 7220 736b 6970 6e61 2069 7320  ll or skipna is 
-00048650: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00048660: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-00048670: 2020 2020 2320 4375 7272 656e 7420 616c      # Current al
-00048680: 676f 7269 7468 6d20 7769 7468 2064 6173  gorithm with das
-00048690: 6b20 616e 6420 736b 6970 6e61 3d46 616c  k and skipna=Fal
-000486a0: 7365 206e 6569 7468 6572 2073 7570 706f  se neither suppo
-000486b0: 7274 730a 2020 2020 2020 2020 2020 2020  rts.            
-000486c0: 2020 2020 2320 6465 6669 6369 656e 7420      # deficient 
-000486d0: 7261 6e6b 7320 6e6f 7220 646f 6573 2069  ranks nor does i
-000486e0: 7420 6f75 7470 7574 2074 6865 2022 6675  t output the "fu
-000486f0: 6c6c 2220 696e 666f 2028 6973 7375 6520  ll" info (issue 
-00048700: 6461 736b 2f64 6173 6b23 3635 3136 290a  dask/dask#6516).
-00048710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048720: 736b 6970 6e61 5f64 6120 3d20 5472 7565  skipna_da = True
-00048730: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00048740: 6620 736b 6970 6e61 2069 7320 4e6f 6e65  f skipna is None
-00048750: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00048760: 2020 736b 6970 6e61 5f64 6120 3d20 626f    skipna_da = bo
-00048770: 6f6c 286e 702e 616e 7928 6461 2e69 736e  ol(np.any(da.isn
-00048780: 756c 6c28 2929 290a 0a20 2020 2020 2020  ull()))..       
-00048790: 2020 2020 2064 696d 735f 746f 5f73 7461       dims_to_sta
-000487a0: 636b 203d 205b 6469 6d6e 616d 6520 666f  ck = [dimname fo
-000487b0: 7220 6469 6d6e 616d 6520 696e 2064 612e  r dimname in da.
-000487c0: 6469 6d73 2069 6620 6469 6d6e 616d 6520  dims if dimname 
-000487d0: 213d 2064 696d 5d0a 2020 2020 2020 2020  != dim].        
-000487e0: 2020 2020 7374 6163 6b65 645f 636f 6f72      stacked_coor
-000487f0: 6473 3a20 6469 6374 5b48 6173 6861 626c  ds: dict[Hashabl
-00048800: 652c 2044 6174 6141 7272 6179 5d20 3d20  e, DataArray] = 
-00048810: 7b7d 0a20 2020 2020 2020 2020 2020 2069  {}.            i
-00048820: 6620 6469 6d73 5f74 6f5f 7374 6163 6b3a  f dims_to_stack:
-00048830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048840: 2073 7461 636b 6564 5f64 696d 203d 2075   stacked_dim = u
-00048850: 7469 6c73 2e67 6574 5f74 656d 705f 6469  tils.get_temp_di
-00048860: 6d6e 616d 6528 6469 6d73 5f74 6f5f 7374  mname(dims_to_st
-00048870: 6163 6b2c 2022 7374 6163 6b65 6422 290a  ack, "stacked").
-00048880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048890: 7268 7320 3d20 6461 2e74 7261 6e73 706f  rhs = da.transpo
-000488a0: 7365 2864 696d 2c20 2a64 696d 735f 746f  se(dim, *dims_to
-000488b0: 5f73 7461 636b 292e 7374 6163 6b28 0a20  _stack).stack(. 
-000488c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000488d0: 2020 207b 7374 6163 6b65 645f 6469 6d3a     {stacked_dim:
-000488e0: 2064 696d 735f 746f 5f73 7461 636b 7d0a   dims_to_stack}.
-000488f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048900: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00048910: 2020 7374 6163 6b65 645f 636f 6f72 6473    stacked_coords
-00048920: 203d 207b 7374 6163 6b65 645f 6469 6d3a   = {stacked_dim:
-00048930: 2072 6873 5b73 7461 636b 6564 5f64 696d   rhs[stacked_dim
-00048940: 5d7d 0a20 2020 2020 2020 2020 2020 2020  ]}.             
-00048950: 2020 2073 6361 6c65 5f64 6120 3d20 7363     scale_da = sc
-00048960: 616c 655b 3a2c 206e 702e 6e65 7761 7869  ale[:, np.newaxi
-00048970: 735d 0a20 2020 2020 2020 2020 2020 2065  s].            e
-00048980: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00048990: 2020 2020 2072 6873 203d 2064 610a 2020       rhs = da.  
-000489a0: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-000489b0: 616c 655f 6461 203d 2073 6361 6c65 0a0a  ale_da = scale..
-000489c0: 2020 2020 2020 2020 2020 2020 6966 2077              if w
-000489d0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000489e0: 2020 2020 2020 2020 2020 2020 2020 7268                rh
-000489f0: 7320 2a3d 2077 5b3a 2c20 6e70 2e6e 6577  s *= w[:, np.new
-00048a00: 6178 6973 5d0a 0a20 2020 2020 2020 2020  axis]..         
-00048a10: 2020 2077 6974 6820 7761 726e 696e 6773     with warnings
-00048a20: 2e63 6174 6368 5f77 6172 6e69 6e67 7328  .catch_warnings(
-00048a30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00048a40: 2020 2069 6620 6675 6c6c 3a20 2023 2043     if full:  # C
-00048a50: 6f70 7920 6e70 2e70 6f6c 7966 6974 2062  opy np.polyfit b
-00048a60: 6568 6176 696f 720a 2020 2020 2020 2020  ehavior.        
-00048a70: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-00048a80: 696e 6773 2e73 696d 706c 6566 696c 7465  ings.simplefilte
-00048a90: 7228 2269 676e 6f72 6522 2c20 6e70 2e52  r("ignore", np.R
-00048aa0: 616e 6b57 6172 6e69 6e67 290a 2020 2020  ankWarning).    
-00048ab0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00048ac0: 3a20 2023 2052 6169 7365 206f 6e6c 7920  :  # Raise only 
-00048ad0: 6f6e 6365 2070 6572 2076 6172 6961 626c  once per variabl
-00048ae0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00048af0: 2020 2020 2020 7761 726e 696e 6773 2e73        warnings.s
-00048b00: 696d 706c 6566 696c 7465 7228 226f 6e63  implefilter("onc
-00048b10: 6522 2c20 6e70 2e52 616e 6b57 6172 6e69  e", np.RankWarni
-00048b20: 6e67 290a 0a20 2020 2020 2020 2020 2020  ng)..           
-00048b30: 2020 2020 2063 6f65 6666 732c 2072 6573       coeffs, res
-00048b40: 6964 7561 6c73 203d 2064 7563 6b5f 6172  iduals = duck_ar
-00048b50: 7261 795f 6f70 732e 6c65 6173 745f 7371  ray_ops.least_sq
-00048b60: 7561 7265 7328 0a20 2020 2020 2020 2020  uares(.         
-00048b70: 2020 2020 2020 2020 2020 206c 6873 2c20             lhs, 
-00048b80: 7268 732e 6461 7461 2c20 7263 6f6e 643d  rhs.data, rcond=
-00048b90: 7263 6f6e 642c 2073 6b69 706e 613d 736b  rcond, skipna=sk
-00048ba0: 6970 6e61 5f64 610a 2020 2020 2020 2020  ipna_da.        
-00048bb0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00048bc0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00048bd0: 616e 6365 286e 616d 652c 2073 7472 293a  ance(name, str):
-00048be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048bf0: 206e 616d 6520 3d20 6622 7b6e 616d 657d   name = f"{name}
-00048c00: 5f22 0a20 2020 2020 2020 2020 2020 2065  _".            e
-00048c10: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00048c20: 2020 2020 2023 2054 6875 7320 6120 5265       # Thus a Re
-00048c30: 7072 4f62 6a65 6374 203d 3e20 706f 6c79  prObject => poly
-00048c40: 6669 7420 7761 7320 6361 6c6c 6564 206f  fit was called o
-00048c50: 6e20 6120 4461 7461 4172 7261 790a 2020  n a DataArray.  
-00048c60: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-00048c70: 6d65 203d 2022 220a 0a20 2020 2020 2020  me = ""..       
-00048c80: 2020 2020 2063 6f65 6666 7320 3d20 4461       coeffs = Da
-00048c90: 7461 4172 7261 7928 0a20 2020 2020 2020  taArray(.       
-00048ca0: 2020 2020 2020 2020 2063 6f65 6666 7320           coeffs 
-00048cb0: 2f20 7363 616c 655f 6461 2c0a 2020 2020  / scale_da,.    
-00048cc0: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
-00048cd0: 3d5b 6465 6772 6565 5f64 696d 5d20 2b20  =[degree_dim] + 
-00048ce0: 6c69 7374 2873 7461 636b 6564 5f63 6f6f  list(stacked_coo
-00048cf0: 7264 732e 6b65 7973 2829 292c 0a20 2020  rds.keys()),.   
-00048d00: 2020 2020 2020 2020 2020 2020 2063 6f6f               coo
-00048d10: 7264 733d 7b64 6567 7265 655f 6469 6d3a  rds={degree_dim:
-00048d20: 206e 702e 6172 616e 6765 286f 7264 6572   np.arange(order
-00048d30: 295b 3a3a 2d31 5d2c 202a 2a73 7461 636b  )[::-1], **stack
-00048d40: 6564 5f63 6f6f 7264 737d 2c0a 2020 2020  ed_coords},.    
-00048d50: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00048d60: 3d6e 616d 6520 2b20 2270 6f6c 7966 6974  =name + "polyfit
-00048d70: 5f63 6f65 6666 6963 6965 6e74 7322 2c0a  _coefficients",.
-00048d80: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00048d90: 2020 2020 2020 2020 2020 6966 2064 696d            if dim
-00048da0: 735f 746f 5f73 7461 636b 3a0a 2020 2020  s_to_stack:.    
-00048db0: 2020 2020 2020 2020 2020 2020 636f 6566              coef
-00048dc0: 6673 203d 2063 6f65 6666 732e 756e 7374  fs = coeffs.unst
-00048dd0: 6163 6b28 7374 6163 6b65 645f 6469 6d29  ack(stacked_dim)
-00048de0: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-00048df0: 6961 626c 6573 5b63 6f65 6666 732e 6e61  iables[coeffs.na
-00048e00: 6d65 5d20 3d20 636f 6566 6673 0a0a 2020  me] = coeffs..  
-00048e10: 2020 2020 2020 2020 2020 6966 2066 756c            if ful
-00048e20: 6c20 6f72 2028 636f 7620 6973 2054 7275  l or (cov is Tru
-00048e30: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00048e40: 2020 2020 7265 7369 6475 616c 7320 3d20      residuals = 
-00048e50: 4461 7461 4172 7261 7928 0a20 2020 2020  DataArray(.     
-00048e60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00048e70: 6573 6964 7561 6c73 2069 6620 6469 6d73  esiduals if dims
-00048e80: 5f74 6f5f 7374 6163 6b20 656c 7365 2072  _to_stack else r
-00048e90: 6573 6964 7561 6c73 2e73 7175 6565 7a65  esiduals.squeeze
-00048ea0: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-00048eb0: 2020 2020 2020 2020 6469 6d73 3d6c 6973          dims=lis
-00048ec0: 7428 7374 6163 6b65 645f 636f 6f72 6473  t(stacked_coords
-00048ed0: 2e6b 6579 7328 2929 2c0a 2020 2020 2020  .keys()),.      
-00048ee0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00048ef0: 6f72 6473 3d73 7461 636b 6564 5f63 6f6f  ords=stacked_coo
-00048f00: 7264 732c 0a20 2020 2020 2020 2020 2020  rds,.           
-00048f10: 2020 2020 2020 2020 206e 616d 653d 6e61           name=na
-00048f20: 6d65 202b 2022 706f 6c79 6669 745f 7265  me + "polyfit_re
-00048f30: 7369 6475 616c 7322 2c0a 2020 2020 2020  siduals",.      
-00048f40: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00048f50: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00048f60: 696d 735f 746f 5f73 7461 636b 3a0a 2020  ims_to_stack:.  
-00048f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048f80: 2020 7265 7369 6475 616c 7320 3d20 7265    residuals = re
-00048f90: 7369 6475 616c 732e 756e 7374 6163 6b28  siduals.unstack(
-00048fa0: 7374 6163 6b65 645f 6469 6d29 0a20 2020  stacked_dim).   
-00048fb0: 2020 2020 2020 2020 2020 2020 2076 6172               var
-00048fc0: 6961 626c 6573 5b72 6573 6964 7561 6c73  iables[residuals
-00048fd0: 2e6e 616d 655d 203d 2072 6573 6964 7561  .name] = residua
-00048fe0: 6c73 0a0a 2020 2020 2020 2020 2020 2020  ls..            
-00048ff0: 6966 2063 6f76 3a0a 2020 2020 2020 2020  if cov:.        
-00049000: 2020 2020 2020 2020 5662 6173 6520 3d20          Vbase = 
-00049010: 6e70 2e6c 696e 616c 672e 696e 7628 6e70  np.linalg.inv(np
-00049020: 2e64 6f74 286c 6873 2e54 2c20 6c68 7329  .dot(lhs.T, lhs)
-00049030: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00049040: 2020 5662 6173 6520 2f3d 206e 702e 6f75    Vbase /= np.ou
-00049050: 7465 7228 7363 616c 652c 2073 6361 6c65  ter(scale, scale
-00049060: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00049070: 2020 6966 2063 6f76 203d 3d20 2275 6e73    if cov == "uns
-00049080: 6361 6c65 6422 3a0a 2020 2020 2020 2020  caled":.        
-00049090: 2020 2020 2020 2020 2020 2020 6661 6320              fac 
-000490a0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-000490b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000490c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000490d0: 2078 2e73 6861 7065 5b30 5d20 3c3d 206f   x.shape[0] <= o
-000490e0: 7264 6572 3a0a 2020 2020 2020 2020 2020  rder:.          
-000490f0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00049100: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-00049110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049120: 2020 2020 2020 2020 2020 2020 2254 6865              "The
-00049130: 206e 756d 6265 7220 6f66 2064 6174 6120   number of data 
-00049140: 706f 696e 7473 206d 7573 7420 6578 6365  points must exce
-00049150: 6564 206f 7264 6572 2074 6f20 7363 616c  ed order to scal
-00049160: 6520 7468 6520 636f 7661 7269 616e 6365  e the covariance
-00049170: 206d 6174 7269 782e 220a 2020 2020 2020   matrix.".      
-00049180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049190: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-000491a0: 2020 2020 2020 2020 6661 6320 3d20 7265          fac = re
-000491b0: 7369 6475 616c 7320 2f20 2878 2e73 6861  siduals / (x.sha
-000491c0: 7065 5b30 5d20 2d20 6f72 6465 7229 0a20  pe[0] - order). 
-000491d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000491e0: 6f76 6172 6961 6e63 6520 3d20 4461 7461  ovariance = Data
-000491f0: 4172 7261 7928 5662 6173 652c 2064 696d  Array(Vbase, dim
-00049200: 733d 2822 636f 765f 6922 2c20 2263 6f76  s=("cov_i", "cov
-00049210: 5f6a 2229 2920 2a20 6661 630a 2020 2020  _j")) * fac.    
-00049220: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-00049230: 6162 6c65 735b 6e61 6d65 202b 2022 706f  ables[name + "po
-00049240: 6c79 6669 745f 636f 7661 7269 616e 6365  lyfit_covariance
-00049250: 225d 203d 2063 6f76 6172 6961 6e63 650a  "] = covariance.
-00049260: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00049270: 7479 7065 2873 656c 6629 2864 6174 615f  type(self)(data_
-00049280: 7661 7273 3d76 6172 6961 626c 6573 2c20  vars=variables, 
-00049290: 6174 7472 733d 7365 6c66 2e61 7474 7273  attrs=self.attrs
-000492a0: 2e63 6f70 7928 2929 0a0a 2020 2020 6465  .copy())..    de
-000492b0: 6620 7061 6428 0a20 2020 2020 2020 2073  f pad(.        s
-000492c0: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
-000492d0: 2020 2020 2020 2020 7061 645f 7769 6474          pad_widt
-000492e0: 683a 204d 6170 7069 6e67 5b41 6e79 2c20  h: Mapping[Any, 
-000492f0: 696e 7420 7c20 7475 706c 655b 696e 742c  int | tuple[int,
-00049300: 2069 6e74 5d5d 207c 204e 6f6e 6520 3d20   int]] | None = 
-00049310: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d6f  None,.        mo
-00049320: 6465 3a20 5061 644d 6f64 654f 7074 696f  de: PadModeOptio
-00049330: 6e73 203d 2022 636f 6e73 7461 6e74 222c  ns = "constant",
-00049340: 0a20 2020 2020 2020 2073 7461 745f 6c65  .        stat_le
-00049350: 6e67 7468 3a20 696e 740a 2020 2020 2020  ngth: int.      
-00049360: 2020 7c20 7475 706c 655b 696e 742c 2069    | tuple[int, i
-00049370: 6e74 5d0a 2020 2020 2020 2020 7c20 4d61  nt].        | Ma
-00049380: 7070 696e 675b 416e 792c 2074 7570 6c65  pping[Any, tuple
-00049390: 5b69 6e74 2c20 696e 745d 5d0a 2020 2020  [int, int]].    
-000493a0: 2020 2020 7c20 4e6f 6e65 203d 204e 6f6e      | None = Non
-000493b0: 652c 0a20 2020 2020 2020 2063 6f6e 7374  e,.        const
-000493c0: 616e 745f 7661 6c75 6573 3a20 280a 2020  ant_values: (.  
-000493d0: 2020 2020 2020 2020 2020 666c 6f61 7420            float 
-000493e0: 7c20 7475 706c 655b 666c 6f61 742c 2066  | tuple[float, f
-000493f0: 6c6f 6174 5d20 7c20 4d61 7070 696e 675b  loat] | Mapping[
-00049400: 416e 792c 2074 7570 6c65 5b66 6c6f 6174  Any, tuple[float
-00049410: 2c20 666c 6f61 745d 5d20 7c20 4e6f 6e65  , float]] | None
-00049420: 0a20 2020 2020 2020 2029 203d 204e 6f6e  .        ) = Non
-00049430: 652c 0a20 2020 2020 2020 2065 6e64 5f76  e,.        end_v
-00049440: 616c 7565 733a 2069 6e74 207c 2074 7570  alues: int | tup
-00049450: 6c65 5b69 6e74 2c20 696e 745d 207c 204d  le[int, int] | M
-00049460: 6170 7069 6e67 5b41 6e79 2c20 7475 706c  apping[Any, tupl
-00049470: 655b 696e 742c 2069 6e74 5d5d 207c 204e  e[int, int]] | N
-00049480: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00049490: 2020 2020 7265 666c 6563 745f 7479 7065      reflect_type
-000494a0: 3a20 5061 6452 6566 6c65 6374 4f70 7469  : PadReflectOpti
-000494b0: 6f6e 7320 3d20 4e6f 6e65 2c0a 2020 2020  ons = None,.    
-000494c0: 2020 2020 6b65 6570 5f61 7474 7273 3a20      keep_attrs: 
-000494d0: 626f 6f6c 207c 204e 6f6e 6520 3d20 4e6f  bool | None = No
-000494e0: 6e65 2c0a 2020 2020 2020 2020 2a2a 7061  ne,.        **pa
-000494f0: 645f 7769 6474 685f 6b77 6172 6773 3a20  d_width_kwargs: 
-00049500: 416e 792c 0a20 2020 2029 202d 3e20 545f  Any,.    ) -> T_
-00049510: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-00049520: 2022 2222 5061 6420 7468 6973 2064 6174   """Pad this dat
-00049530: 6173 6574 2061 6c6f 6e67 206f 6e65 206f  aset along one o
-00049540: 7220 6d6f 7265 2064 696d 656e 7369 6f6e  r more dimension
-00049550: 732e 0a0a 2020 2020 2020 2020 2e2e 2077  s...        .. w
-00049560: 6172 6e69 6e67 3a3a 0a20 2020 2020 2020  arning::.       
-00049570: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
-00049580: 6f6e 2069 7320 6578 7065 7269 6d65 6e74  on is experiment
-00049590: 616c 2061 6e64 2069 7473 2062 6568 6176  al and its behav
-000495a0: 696f 7572 2069 7320 6c69 6b65 6c79 2074  iour is likely t
-000495b0: 6f20 6368 616e 6765 0a20 2020 2020 2020  o change.       
-000495c0: 2020 2020 2065 7370 6563 6961 6c6c 7920       especially 
-000495d0: 7265 6761 7264 696e 6720 7061 6464 696e  regarding paddin
-000495e0: 6720 6f66 2064 696d 656e 7369 6f6e 2063  g of dimension c
-000495f0: 6f6f 7264 696e 6174 6573 2028 6f72 2049  oordinates (or I
-00049600: 6e64 6578 5661 7269 6162 6c65 7329 2e0a  ndexVariables)..
-00049610: 0a20 2020 2020 2020 2057 6865 6e20 7573  .        When us
-00049620: 696e 6720 6f6e 6520 6f66 2074 6865 206d  ing one of the m
-00049630: 6f64 6573 2028 2265 6467 6522 2c20 2272  odes ("edge", "r
-00049640: 6566 6c65 6374 222c 2022 7379 6d6d 6574  eflect", "symmet
-00049650: 7269 6322 2c20 2277 7261 7022 292c 0a20  ric", "wrap"),. 
-00049660: 2020 2020 2020 2063 6f6f 7264 696e 6174         coordinat
-00049670: 6573 2077 696c 6c20 6265 2070 6164 6465  es will be padde
-00049680: 6420 7769 7468 2074 6865 2073 616d 6520  d with the same 
-00049690: 6d6f 6465 2c20 6f74 6865 7277 6973 6520  mode, otherwise 
-000496a0: 636f 6f72 6469 6e61 7465 730a 2020 2020  coordinates.    
-000496b0: 2020 2020 6172 6520 7061 6464 6564 2075      are padded u
-000496c0: 7369 6e67 2074 6865 2022 636f 6e73 7461  sing the "consta
-000496d0: 6e74 2220 6d6f 6465 2077 6974 6820 6669  nt" mode with fi
-000496e0: 6c6c 5f76 616c 7565 2064 7479 7065 732e  ll_value dtypes.
-000496f0: 4e41 2e0a 0a20 2020 2020 2020 2050 6172  NA...        Par
-00049700: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00049710: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00049720: 2020 2070 6164 5f77 6964 7468 203a 206d     pad_width : m
-00049730: 6170 7069 6e67 206f 6620 6861 7368 6162  apping of hashab
-00049740: 6c65 2074 6f20 7475 706c 6520 6f66 2069  le to tuple of i
-00049750: 6e74 0a20 2020 2020 2020 2020 2020 204d  nt.            M
-00049760: 6170 7069 6e67 2077 6974 6820 7468 6520  apping with the 
-00049770: 666f 726d 206f 6620 7b64 696d 3a20 2870  form of {dim: (p
-00049780: 6164 5f62 6566 6f72 652c 2070 6164 5f61  ad_before, pad_a
-00049790: 6674 6572 297d 0a20 2020 2020 2020 2020  fter)}.         
-000497a0: 2020 2064 6573 6372 6962 696e 6720 7468     describing th
-000497b0: 6520 6e75 6d62 6572 206f 6620 7661 6c75  e number of valu
-000497c0: 6573 2070 6164 6465 6420 616c 6f6e 6720  es padded along 
-000497d0: 6561 6368 2064 696d 656e 7369 6f6e 2e0a  each dimension..
-000497e0: 2020 2020 2020 2020 2020 2020 7b64 696d              {dim
-000497f0: 3a20 7061 647d 2069 7320 6120 7368 6f72  : pad} is a shor
-00049800: 7463 7574 2066 6f72 2070 6164 5f62 6566  tcut for pad_bef
-00049810: 6f72 6520 3d20 7061 645f 6166 7465 7220  ore = pad_after 
-00049820: 3d20 7061 640a 2020 2020 2020 2020 6d6f  = pad.        mo
-00049830: 6465 203a 207b 2263 6f6e 7374 616e 7422  de : {"constant"
-00049840: 2c20 2265 6467 6522 2c20 226c 696e 6561  , "edge", "linea
-00049850: 725f 7261 6d70 222c 2022 6d61 7869 6d75  r_ramp", "maximu
-00049860: 6d22 2c20 226d 6561 6e22 2c20 226d 6564  m", "mean", "med
-00049870: 6961 6e22 2c20 5c0a 2020 2020 2020 2020  ian", \.        
-00049880: 2020 2020 226d 696e 696d 756d 222c 2022      "minimum", "
-00049890: 7265 666c 6563 7422 2c20 2273 796d 6d65  reflect", "symme
-000498a0: 7472 6963 222c 2022 7772 6170 227d 2c20  tric", "wrap"}, 
-000498b0: 6465 6661 756c 743a 2022 636f 6e73 7461  default: "consta
-000498c0: 6e74 220a 2020 2020 2020 2020 2020 2020  nt".            
-000498d0: 486f 7720 746f 2070 6164 2074 6865 2044  How to pad the D
-000498e0: 6174 6141 7272 6179 2028 7461 6b65 6e20  ataArray (taken 
-000498f0: 6672 6f6d 206e 756d 7079 2064 6f63 7329  from numpy docs)
-00049900: 3a0a 0a20 2020 2020 2020 2020 2020 202d  :..            -
-00049910: 2022 636f 6e73 7461 6e74 223a 2050 6164   "constant": Pad
-00049920: 7320 7769 7468 2061 2063 6f6e 7374 616e  s with a constan
-00049930: 7420 7661 6c75 652e 0a20 2020 2020 2020  t value..       
-00049940: 2020 2020 202d 2022 6564 6765 223a 2050       - "edge": P
-00049950: 6164 7320 7769 7468 2074 6865 2065 6467  ads with the edg
-00049960: 6520 7661 6c75 6573 206f 6620 6172 7261  e values of arra
-00049970: 792e 0a20 2020 2020 2020 2020 2020 202d  y..            -
-00049980: 2022 6c69 6e65 6172 5f72 616d 7022 3a20   "linear_ramp": 
-00049990: 5061 6473 2077 6974 6820 7468 6520 6c69  Pads with the li
-000499a0: 6e65 6172 2072 616d 7020 6265 7477 6565  near ramp betwee
-000499b0: 6e20 656e 645f 7661 6c75 6520 616e 6420  n end_value and 
-000499c0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-000499d0: 2020 6172 7261 7920 6564 6765 2076 616c    array edge val
-000499e0: 7565 2e0a 2020 2020 2020 2020 2020 2020  ue..            
-000499f0: 2d20 226d 6178 696d 756d 223a 2050 6164  - "maximum": Pad
-00049a00: 7320 7769 7468 2074 6865 206d 6178 696d  s with the maxim
-00049a10: 756d 2076 616c 7565 206f 6620 616c 6c20  um value of all 
-00049a20: 6f72 2070 6172 7420 6f66 2074 6865 0a20  or part of the. 
-00049a30: 2020 2020 2020 2020 2020 2020 2076 6563               vec
-00049a40: 746f 7220 616c 6f6e 6720 6561 6368 2061  tor along each a
-00049a50: 7869 732e 0a20 2020 2020 2020 2020 2020  xis..           
-00049a60: 202d 2022 6d65 616e 223a 2050 6164 7320   - "mean": Pads 
-00049a70: 7769 7468 2074 6865 206d 6561 6e20 7661  with the mean va
-00049a80: 6c75 6520 6f66 2061 6c6c 206f 7220 7061  lue of all or pa
-00049a90: 7274 206f 6620 7468 650a 2020 2020 2020  rt of the.      
-00049aa0: 2020 2020 2020 2020 7665 6374 6f72 2061          vector a
-00049ab0: 6c6f 6e67 2065 6163 6820 6178 6973 2e0a  long each axis..
-00049ac0: 2020 2020 2020 2020 2020 2020 2d20 226d              - "m
-00049ad0: 6564 6961 6e22 3a20 5061 6473 2077 6974  edian": Pads wit
-00049ae0: 6820 7468 6520 6d65 6469 616e 2076 616c  h the median val
-00049af0: 7565 206f 6620 616c 6c20 6f72 2070 6172  ue of all or par
-00049b00: 7420 6f66 2074 6865 0a20 2020 2020 2020  t of the.       
-00049b10: 2020 2020 2020 2076 6563 746f 7220 616c         vector al
-00049b20: 6f6e 6720 6561 6368 2061 7869 732e 0a20  ong each axis.. 
-00049b30: 2020 2020 2020 2020 2020 202d 2022 6d69             - "mi
-00049b40: 6e69 6d75 6d22 3a20 5061 6473 2077 6974  nimum": Pads wit
-00049b50: 6820 7468 6520 6d69 6e69 6d75 6d20 7661  h the minimum va
-00049b60: 6c75 6520 6f66 2061 6c6c 206f 7220 7061  lue of all or pa
-00049b70: 7274 206f 6620 7468 650a 2020 2020 2020  rt of the.      
-00049b80: 2020 2020 2020 2020 7665 6374 6f72 2061          vector a
-00049b90: 6c6f 6e67 2065 6163 6820 6178 6973 2e0a  long each axis..
-00049ba0: 2020 2020 2020 2020 2020 2020 2d20 2272              - "r
-00049bb0: 6566 6c65 6374 223a 2050 6164 7320 7769  eflect": Pads wi
-00049bc0: 7468 2074 6865 2072 6566 6c65 6374 696f  th the reflectio
-00049bd0: 6e20 6f66 2074 6865 2076 6563 746f 7220  n of the vector 
-00049be0: 6d69 7272 6f72 6564 206f 6e0a 2020 2020  mirrored on.    
-00049bf0: 2020 2020 2020 2020 2020 7468 6520 6669            the fi
-00049c00: 7273 7420 616e 6420 6c61 7374 2076 616c  rst and last val
-00049c10: 7565 7320 6f66 2074 6865 2076 6563 746f  ues of the vecto
-00049c20: 7220 616c 6f6e 6720 6561 6368 2061 7869  r along each axi
-00049c30: 732e 0a20 2020 2020 2020 2020 2020 202d  s..            -
-00049c40: 2022 7379 6d6d 6574 7269 6322 3a20 5061   "symmetric": Pa
-00049c50: 6473 2077 6974 6820 7468 6520 7265 666c  ds with the refl
-00049c60: 6563 7469 6f6e 206f 6620 7468 6520 7665  ection of the ve
-00049c70: 6374 6f72 206d 6972 726f 7265 640a 2020  ctor mirrored.  
-00049c80: 2020 2020 2020 2020 2020 2020 616c 6f6e              alon
-00049c90: 6720 7468 6520 6564 6765 206f 6620 7468  g the edge of th
-00049ca0: 6520 6172 7261 792e 0a20 2020 2020 2020  e array..       
-00049cb0: 2020 2020 202d 2022 7772 6170 223a 2050       - "wrap": P
-00049cc0: 6164 7320 7769 7468 2074 6865 2077 7261  ads with the wra
-00049cd0: 7020 6f66 2074 6865 2076 6563 746f 7220  p of the vector 
-00049ce0: 616c 6f6e 6720 7468 6520 6178 6973 2e0a  along the axis..
-00049cf0: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-00049d00: 6520 6669 7273 7420 7661 6c75 6573 2061  e first values a
-00049d10: 7265 2075 7365 6420 746f 2070 6164 2074  re used to pad t
-00049d20: 6865 2065 6e64 2061 6e64 2074 6865 0a20  he end and the. 
-00049d30: 2020 2020 2020 2020 2020 2020 2065 6e64               end
-00049d40: 2076 616c 7565 7320 6172 6520 7573 6564   values are used
-00049d50: 2074 6f20 7061 6420 7468 6520 6265 6769   to pad the begi
-00049d60: 6e6e 696e 672e 0a0a 2020 2020 2020 2020  nning...        
-00049d70: 7374 6174 5f6c 656e 6774 6820 3a20 696e  stat_length : in
-00049d80: 742c 2074 7570 6c65 206f 7220 6d61 7070  t, tuple or mapp
-00049d90: 696e 6720 6f66 2068 6173 6861 626c 6520  ing of hashable 
-00049da0: 746f 2074 7570 6c65 2c20 6465 6661 756c  to tuple, defaul
-00049db0: 743a 204e 6f6e 650a 2020 2020 2020 2020  t: None.        
-00049dc0: 2020 2020 5573 6564 2069 6e20 276d 6178      Used in 'max
-00049dd0: 696d 756d 272c 2027 6d65 616e 272c 2027  imum', 'mean', '
-00049de0: 6d65 6469 616e 272c 2061 6e64 2027 6d69  median', and 'mi
-00049df0: 6e69 6d75 6d27 2e20 204e 756d 6265 7220  nimum'.  Number 
-00049e00: 6f66 0a20 2020 2020 2020 2020 2020 2076  of.            v
-00049e10: 616c 7565 7320 6174 2065 6467 6520 6f66  alues at edge of
-00049e20: 2065 6163 6820 6178 6973 2075 7365 6420   each axis used 
-00049e30: 746f 2063 616c 6375 6c61 7465 2074 6865  to calculate the
-00049e40: 2073 7461 7469 7374 6963 2076 616c 7565   statistic value
-00049e50: 2e0a 2020 2020 2020 2020 2020 2020 7b64  ..            {d
-00049e60: 696d 5f31 3a20 2862 6566 6f72 655f 312c  im_1: (before_1,
-00049e70: 2061 6674 6572 5f31 292c 202e 2e2e 2064   after_1), ... d
-00049e80: 696d 5f4e 3a20 2862 6566 6f72 655f 4e2c  im_N: (before_N,
-00049e90: 2061 6674 6572 5f4e 297d 2075 6e69 7175   after_N)} uniqu
-00049ea0: 650a 2020 2020 2020 2020 2020 2020 7374  e.            st
-00049eb0: 6174 6973 7469 6320 6c65 6e67 7468 7320  atistic lengths 
-00049ec0: 616c 6f6e 6720 6561 6368 2064 696d 656e  along each dimen
-00049ed0: 7369 6f6e 2e0a 2020 2020 2020 2020 2020  sion..          
-00049ee0: 2020 2828 6265 666f 7265 2c20 6166 7465    ((before, afte
-00049ef0: 7229 2c29 2079 6965 6c64 7320 7361 6d65  r),) yields same
-00049f00: 2062 6566 6f72 6520 616e 6420 6166 7465   before and afte
-00049f10: 7220 7374 6174 6973 7469 6320 6c65 6e67  r statistic leng
-00049f20: 7468 730a 2020 2020 2020 2020 2020 2020  ths.            
-00049f30: 666f 7220 6561 6368 2064 696d 656e 7369  for each dimensi
-00049f40: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
-00049f50: 2873 7461 745f 6c65 6e67 7468 2c29 206f  (stat_length,) o
-00049f60: 7220 696e 7420 6973 2061 2073 686f 7274  r int is a short
-00049f70: 6375 7420 666f 7220 6265 666f 7265 203d  cut for before =
-00049f80: 2061 6674 6572 203d 2073 7461 7469 7374   after = statist
-00049f90: 6963 0a20 2020 2020 2020 2020 2020 206c  ic.            l
-00049fa0: 656e 6774 6820 666f 7220 616c 6c20 6178  ength for all ax
-00049fb0: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
-00049fc0: 4465 6661 756c 7420 6973 2060 604e 6f6e  Default is ``Non
-00049fd0: 6560 602c 2074 6f20 7573 6520 7468 6520  e``, to use the 
-00049fe0: 656e 7469 7265 2061 7869 732e 0a20 2020  entire axis..   
-00049ff0: 2020 2020 2063 6f6e 7374 616e 745f 7661       constant_va
-0004a000: 6c75 6573 203a 2073 6361 6c61 722c 2074  lues : scalar, t
-0004a010: 7570 6c65 206f 7220 6d61 7070 696e 6720  uple or mapping 
-0004a020: 6f66 2068 6173 6861 626c 6520 746f 2074  of hashable to t
-0004a030: 7570 6c65 2c20 6465 6661 756c 743a 2030  uple, default: 0
-0004a040: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
-0004a050: 6420 696e 2027 636f 6e73 7461 6e74 272e  d in 'constant'.
-0004a060: 2020 5468 6520 7661 6c75 6573 2074 6f20    The values to 
-0004a070: 7365 7420 7468 6520 7061 6464 6564 2076  set the padded v
-0004a080: 616c 7565 7320 666f 7220 6561 6368 0a20  alues for each. 
-0004a090: 2020 2020 2020 2020 2020 2061 7869 732e             axis.
-0004a0a0: 0a20 2020 2020 2020 2020 2020 2060 607b  .            ``{
-0004a0b0: 6469 6d5f 313a 2028 6265 666f 7265 5f31  dim_1: (before_1
-0004a0c0: 2c20 6166 7465 725f 3129 2c20 2e2e 2e20  , after_1), ... 
-0004a0d0: 6469 6d5f 4e3a 2028 6265 666f 7265 5f4e  dim_N: (before_N
-0004a0e0: 2c20 6166 7465 725f 4e29 7d60 6020 756e  , after_N)}`` un
-0004a0f0: 6971 7565 0a20 2020 2020 2020 2020 2020  ique.           
-0004a100: 2070 6164 2063 6f6e 7374 616e 7473 2061   pad constants a
-0004a110: 6c6f 6e67 2065 6163 6820 6469 6d65 6e73  long each dimens
-0004a120: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
-0004a130: 2060 6028 2862 6566 6f72 652c 2061 6674   ``((before, aft
-0004a140: 6572 292c 2960 6020 7969 656c 6473 2073  er),)`` yields s
-0004a150: 616d 6520 6265 666f 7265 2061 6e64 2061  ame before and a
-0004a160: 6674 6572 2063 6f6e 7374 616e 7473 2066  fter constants f
-0004a170: 6f72 2065 6163 680a 2020 2020 2020 2020  or each.        
-0004a180: 2020 2020 6469 6d65 6e73 696f 6e2e 0a20      dimension.. 
-0004a190: 2020 2020 2020 2020 2020 2060 6028 636f             ``(co
-0004a1a0: 6e73 7461 6e74 2c29 6060 206f 7220 6060  nstant,)`` or ``
-0004a1b0: 636f 6e73 7461 6e74 6060 2069 7320 6120  constant`` is a 
-0004a1c0: 7368 6f72 7463 7574 2066 6f72 2060 6062  shortcut for ``b
-0004a1d0: 6566 6f72 6520 3d20 6166 7465 7220 3d20  efore = after = 
-0004a1e0: 636f 6e73 7461 6e74 6060 2066 6f72 0a20  constant`` for. 
-0004a1f0: 2020 2020 2020 2020 2020 2061 6c6c 2064             all d
-0004a200: 696d 656e 7369 6f6e 732e 0a20 2020 2020  imensions..     
-0004a210: 2020 2020 2020 2044 6566 6175 6c74 2069         Default i
-0004a220: 7320 302e 0a20 2020 2020 2020 2065 6e64  s 0..        end
-0004a230: 5f76 616c 7565 7320 3a20 7363 616c 6172  _values : scalar
-0004a240: 2c20 7475 706c 6520 6f72 206d 6170 7069  , tuple or mappi
-0004a250: 6e67 206f 6620 6861 7368 6162 6c65 2074  ng of hashable t
-0004a260: 6f20 7475 706c 652c 2064 6566 6175 6c74  o tuple, default
-0004a270: 3a20 300a 2020 2020 2020 2020 2020 2020  : 0.            
-0004a280: 5573 6564 2069 6e20 276c 696e 6561 725f  Used in 'linear_
-0004a290: 7261 6d70 272e 2020 5468 6520 7661 6c75  ramp'.  The valu
-0004a2a0: 6573 2075 7365 6420 666f 7220 7468 6520  es used for the 
-0004a2b0: 656e 6469 6e67 2076 616c 7565 206f 6620  ending value of 
-0004a2c0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-0004a2d0: 6c69 6e65 6172 5f72 616d 7020 616e 6420  linear_ramp and 
-0004a2e0: 7468 6174 2077 696c 6c20 666f 726d 2074  that will form t
-0004a2f0: 6865 2065 6467 6520 6f66 2074 6865 2070  he edge of the p
-0004a300: 6164 6465 6420 6172 7261 792e 0a20 2020  added array..   
-0004a310: 2020 2020 2020 2020 2060 607b 6469 6d5f           ``{dim_
-0004a320: 313a 2028 6265 666f 7265 5f31 2c20 6166  1: (before_1, af
-0004a330: 7465 725f 3129 2c20 2e2e 2e20 6469 6d5f  ter_1), ... dim_
-0004a340: 4e3a 2028 6265 666f 7265 5f4e 2c20 6166  N: (before_N, af
-0004a350: 7465 725f 4e29 7d60 6020 756e 6971 7565  ter_N)}`` unique
-0004a360: 0a20 2020 2020 2020 2020 2020 2065 6e64  .            end
-0004a370: 2076 616c 7565 7320 616c 6f6e 6720 6561   values along ea
-0004a380: 6368 2064 696d 656e 7369 6f6e 2e0a 2020  ch dimension..  
-0004a390: 2020 2020 2020 2020 2020 6060 2828 6265            ``((be
-0004a3a0: 666f 7265 2c20 6166 7465 7229 2c29 6060  fore, after),)``
-0004a3b0: 2079 6965 6c64 7320 7361 6d65 2062 6566   yields same bef
-0004a3c0: 6f72 6520 616e 6420 6166 7465 7220 656e  ore and after en
-0004a3d0: 6420 7661 6c75 6573 2066 6f72 2065 6163  d values for eac
-0004a3e0: 680a 2020 2020 2020 2020 2020 2020 6178  h.            ax
-0004a3f0: 6973 2e0a 2020 2020 2020 2020 2020 2020  is..            
-0004a400: 6060 2863 6f6e 7374 616e 742c 2960 6020  ``(constant,)`` 
-0004a410: 6f72 2060 6063 6f6e 7374 616e 7460 6020  or ``constant`` 
-0004a420: 6973 2061 2073 686f 7274 6375 7420 666f  is a shortcut fo
-0004a430: 7220 6060 6265 666f 7265 203d 2061 6674  r ``before = aft
-0004a440: 6572 203d 2063 6f6e 7374 616e 7460 6020  er = constant`` 
-0004a450: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
-0004a460: 616c 6c20 6178 6573 2e0a 2020 2020 2020  all axes..      
-0004a470: 2020 2020 2020 4465 6661 756c 7420 6973        Default is
-0004a480: 2030 2e0a 2020 2020 2020 2020 7265 666c   0..        refl
-0004a490: 6563 745f 7479 7065 203a 207b 2265 7665  ect_type : {"eve
-0004a4a0: 6e22 2c20 226f 6464 222c 204e 6f6e 657d  n", "odd", None}
-0004a4b0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0004a4c0: 2020 2020 2020 2055 7365 6420 696e 2022         Used in "
-0004a4d0: 7265 666c 6563 7422 2c20 616e 6420 2273  reflect", and "s
-0004a4e0: 796d 6d65 7472 6963 222e 2020 5468 6520  ymmetric".  The 
-0004a4f0: 2265 7665 6e22 2073 7479 6c65 2069 7320  "even" style is 
-0004a500: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-0004a510: 6465 6661 756c 7420 7769 7468 2061 6e20  default with an 
-0004a520: 756e 616c 7465 7265 6420 7265 666c 6563  unaltered reflec
-0004a530: 7469 6f6e 2061 726f 756e 6420 7468 6520  tion around the 
-0004a540: 6564 6765 2076 616c 7565 2e20 2046 6f72  edge value.  For
-0004a550: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-0004a560: 2022 6f64 6422 2073 7479 6c65 2c20 7468   "odd" style, th
-0004a570: 6520 6578 7465 6e64 6564 2070 6172 7420  e extended part 
-0004a580: 6f66 2074 6865 2061 7272 6179 2069 7320  of the array is 
-0004a590: 6372 6561 7465 6420 6279 0a20 2020 2020  created by.     
-0004a5a0: 2020 2020 2020 2073 7562 7472 6163 7469         subtracti
-0004a5b0: 6e67 2074 6865 2072 6566 6c65 6374 6564  ng the reflected
-0004a5c0: 2076 616c 7565 7320 6672 6f6d 2074 776f   values from two
-0004a5d0: 2074 696d 6573 2074 6865 2065 6467 6520   times the edge 
-0004a5e0: 7661 6c75 652e 0a20 2020 2020 2020 206b  value..        k
-0004a5f0: 6565 705f 6174 7472 7320 3a20 626f 6f6c  eep_attrs : bool
-0004a600: 206f 7220 4e6f 6e65 2c20 6f70 7469 6f6e   or None, option
-0004a610: 616c 0a20 2020 2020 2020 2020 2020 2049  al.            I
-0004a620: 6620 5472 7565 2c20 7468 6520 6174 7472  f True, the attr
-0004a630: 6962 7574 6573 2028 6060 6174 7472 7360  ibutes (``attrs`
-0004a640: 6029 2077 696c 6c20 6265 2063 6f70 6965  `) will be copie
-0004a650: 6420 6672 6f6d 2074 6865 0a20 2020 2020  d from the.     
-0004a660: 2020 2020 2020 206f 7269 6769 6e61 6c20         original 
-0004a670: 6f62 6a65 6374 2074 6f20 7468 6520 6e65  object to the ne
-0004a680: 7720 6f6e 652e 2049 6620 4661 6c73 652c  w one. If False,
-0004a690: 2074 6865 206e 6577 206f 626a 6563 740a   the new object.
-0004a6a0: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
-0004a6b0: 2062 6520 7265 7475 726e 6564 2077 6974   be returned wit
-0004a6c0: 686f 7574 2061 7474 7269 6275 7465 732e  hout attributes.
-0004a6d0: 0a20 2020 2020 2020 202a 2a70 6164 5f77  .        **pad_w
-0004a6e0: 6964 7468 5f6b 7761 7267 730a 2020 2020  idth_kwargs.    
-0004a6f0: 2020 2020 2020 2020 5468 6520 6b65 7977          The keyw
-0004a700: 6f72 6420 6172 6775 6d65 6e74 7320 666f  ord arguments fo
-0004a710: 726d 206f 6620 6060 7061 645f 7769 6474  rm of ``pad_widt
-0004a720: 6860 602e 0a20 2020 2020 2020 2020 2020  h``..           
-0004a730: 204f 6e65 206f 6620 6060 7061 645f 7769   One of ``pad_wi
-0004a740: 6474 6860 6020 6f72 2060 6070 6164 5f77  dth`` or ``pad_w
-0004a750: 6964 7468 5f6b 7761 7267 7360 6020 6d75  idth_kwargs`` mu
-0004a760: 7374 2062 6520 7072 6f76 6964 6564 2e0a  st be provided..
-0004a770: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-0004a780: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0004a790: 0a20 2020 2020 2020 2070 6164 6465 6420  .        padded 
-0004a7a0: 3a20 4461 7461 7365 740a 2020 2020 2020  : Dataset.      
-0004a7b0: 2020 2020 2020 4461 7461 7365 7420 7769        Dataset wi
-0004a7c0: 7468 2074 6865 2070 6164 6465 6420 636f  th the padded co
-0004a7d0: 6f72 6469 6e61 7465 7320 616e 6420 6461  ordinates and da
-0004a7e0: 7461 2e0a 0a20 2020 2020 2020 2053 6565  ta...        See
-0004a7f0: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-0004a800: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
-0004a810: 6174 6173 6574 2e73 6869 6674 2c20 4461  ataset.shift, Da
-0004a820: 7461 7365 742e 726f 6c6c 2c20 4461 7461  taset.roll, Data
-0004a830: 7365 742e 6266 696c 6c2c 2044 6174 6173  set.bfill, Datas
-0004a840: 6574 2e66 6669 6c6c 2c20 6e75 6d70 792e  et.ffill, numpy.
-0004a850: 7061 642c 2064 6173 6b2e 6172 7261 792e  pad, dask.array.
-0004a860: 7061 640a 0a20 2020 2020 2020 204e 6f74  pad..        Not
-0004a870: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
-0004a880: 0a20 2020 2020 2020 2042 7920 6465 6661  .        By defa
-0004a890: 756c 7420 7768 656e 2060 606d 6f64 653d  ult when ``mode=
-0004a8a0: 2263 6f6e 7374 616e 7422 6060 2061 6e64  "constant"`` and
-0004a8b0: 2060 6063 6f6e 7374 616e 745f 7661 6c75   ``constant_valu
-0004a8c0: 6573 3d4e 6f6e 6560 602c 2069 6e74 6567  es=None``, integ
-0004a8d0: 6572 2074 7970 6573 2077 696c 6c20 6265  er types will be
-0004a8e0: 0a20 2020 2020 2020 2070 726f 6d6f 7465  .        promote
-0004a8f0: 6420 746f 2060 6066 6c6f 6174 6060 2061  d to ``float`` a
-0004a900: 6e64 2070 6164 6465 6420 7769 7468 2060  nd padded with `
-0004a910: 606e 702e 6e61 6e60 602e 2054 6f20 6176  `np.nan``. To av
-0004a920: 6f69 6420 7479 7065 2070 726f 6d6f 7469  oid type promoti
-0004a930: 6f6e 0a20 2020 2020 2020 2073 7065 6369  on.        speci
-0004a940: 6679 2060 6063 6f6e 7374 616e 745f 7661  fy ``constant_va
-0004a950: 6c75 6573 3d6e 702e 6e61 6e60 600a 0a20  lues=np.nan``.. 
-0004a960: 2020 2020 2020 2050 6164 6469 6e67 2063         Padding c
-0004a970: 6f6f 7264 696e 6174 6573 2077 696c 6c20  oordinates will 
-0004a980: 6472 6f70 2074 6865 6972 2063 6f72 7265  drop their corre
-0004a990: 7370 6f6e 6469 6e67 2069 6e64 6578 2028  sponding index (
-0004a9a0: 6966 2061 6e79 2920 616e 6420 7769 6c6c  if any) and will
-0004a9b0: 2072 6573 6574 2064 6566 6175 6c74 0a20   reset default. 
-0004a9c0: 2020 2020 2020 2069 6e64 6578 6573 2066         indexes f
-0004a9d0: 6f72 2064 696d 656e 7369 6f6e 2063 6f6f  or dimension coo
-0004a9e0: 7264 696e 6174 6573 2e0a 0a20 2020 2020  rdinates...     
-0004a9f0: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
-0004aa00: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-0004aa10: 2020 2020 203e 3e3e 2064 7320 3d20 7872       >>> ds = xr
-0004aa20: 2e44 6174 6173 6574 287b 2266 6f6f 223a  .Dataset({"foo":
-0004aa30: 2028 2278 222c 2072 616e 6765 2835 2929   ("x", range(5))
-0004aa40: 7d29 0a20 2020 2020 2020 203e 3e3e 2064  }).        >>> d
-0004aa50: 732e 7061 6428 783d 2831 2c20 3229 290a  s.pad(x=(1, 2)).
-0004aa60: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-0004aa70: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-0004aa80: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
-0004aa90: 3a20 3829 0a20 2020 2020 2020 2044 696d  : 8).        Dim
-0004aaa0: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
-0004aab0: 636f 6f72 6469 6e61 7465 733a 2078 0a20  coordinates: x. 
-0004aac0: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
-0004aad0: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
-0004aae0: 2020 2066 6f6f 2020 2020 2020 2878 2920     foo      (x) 
-0004aaf0: 666c 6f61 7436 3420 6e61 6e20 302e 3020  float64 nan 0.0 
-0004ab00: 312e 3020 322e 3020 332e 3020 342e 3020  1.0 2.0 3.0 4.0 
-0004ab10: 6e61 6e20 6e61 6e0a 2020 2020 2020 2020  nan nan.        
-0004ab20: 2222 220a 2020 2020 2020 2020 7061 645f  """.        pad_
-0004ab30: 7769 6474 6820 3d20 6569 7468 6572 5f64  width = either_d
-0004ab40: 6963 745f 6f72 5f6b 7761 7267 7328 7061  ict_or_kwargs(pa
-0004ab50: 645f 7769 6474 682c 2070 6164 5f77 6964  d_width, pad_wid
-0004ab60: 7468 5f6b 7761 7267 732c 2022 7061 6422  th_kwargs, "pad"
-0004ab70: 290a 0a20 2020 2020 2020 2069 6620 6d6f  )..        if mo
-0004ab80: 6465 2069 6e20 2822 6564 6765 222c 2022  de in ("edge", "
-0004ab90: 7265 666c 6563 7422 2c20 2273 796d 6d65  reflect", "symme
-0004aba0: 7472 6963 222c 2022 7772 6170 2229 3a0a  tric", "wrap"):.
-0004abb0: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
-0004abc0: 645f 7061 645f 6d6f 6465 203d 206d 6f64  d_pad_mode = mod
-0004abd0: 650a 2020 2020 2020 2020 2020 2020 636f  e.            co
-0004abe0: 6f72 645f 7061 645f 6f70 7469 6f6e 7320  ord_pad_options 
-0004abf0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-0004ac00: 2020 2020 2273 7461 745f 6c65 6e67 7468      "stat_length
-0004ac10: 223a 2073 7461 745f 6c65 6e67 7468 2c0a  ": stat_length,.
-0004ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ac30: 2263 6f6e 7374 616e 745f 7661 6c75 6573  "constant_values
-0004ac40: 223a 2063 6f6e 7374 616e 745f 7661 6c75  ": constant_valu
-0004ac50: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-0004ac60: 2020 2020 2265 6e64 5f76 616c 7565 7322      "end_values"
-0004ac70: 3a20 656e 645f 7661 6c75 6573 2c0a 2020  : end_values,.  
-0004ac80: 2020 2020 2020 2020 2020 2020 2020 2272                "r
-0004ac90: 6566 6c65 6374 5f74 7970 6522 3a20 7265  eflect_type": re
-0004aca0: 666c 6563 745f 7479 7065 2c0a 2020 2020  flect_type,.    
-0004acb0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0004acc0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0004acd0: 2020 2020 636f 6f72 645f 7061 645f 6d6f      coord_pad_mo
-0004ace0: 6465 203d 2022 636f 6e73 7461 6e74 220a  de = "constant".
-0004acf0: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
-0004ad00: 645f 7061 645f 6f70 7469 6f6e 7320 3d20  d_pad_options = 
-0004ad10: 7b7d 0a0a 2020 2020 2020 2020 6966 206b  {}..        if k
-0004ad20: 6565 705f 6174 7472 7320 6973 204e 6f6e  eep_attrs is Non
-0004ad30: 653a 0a20 2020 2020 2020 2020 2020 206b  e:.            k
-0004ad40: 6565 705f 6174 7472 7320 3d20 5f67 6574  eep_attrs = _get
-0004ad50: 5f6b 6565 705f 6174 7472 7328 6465 6661  _keep_attrs(defa
-0004ad60: 756c 743d 5472 7565 290a 0a20 2020 2020  ult=True)..     
-0004ad70: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
-0004ad80: 7d0a 0a20 2020 2020 2020 2023 206b 6565  }..        # kee
-0004ad90: 7020 696e 6465 7865 7320 7468 6174 2077  p indexes that w
-0004ada0: 6f6e 2774 2062 6520 6166 6665 6374 6564  on't be affected
-0004adb0: 2062 7920 7061 6420 616e 6420 6472 6f70   by pad and drop
-0004adc0: 2061 6c6c 206f 7468 6572 2069 6e64 6578   all other index
-0004add0: 6573 0a20 2020 2020 2020 2078 696e 6465  es.        xinde
-0004ade0: 7865 7320 3d20 7365 6c66 2e78 696e 6465  xes = self.xinde
-0004adf0: 7865 730a 2020 2020 2020 2020 7061 645f  xes.        pad_
-0004ae00: 6469 6d73 203d 2073 6574 2870 6164 5f77  dims = set(pad_w
-0004ae10: 6964 7468 290a 2020 2020 2020 2020 696e  idth).        in
-0004ae20: 6465 7865 7320 3d20 7b7d 0a20 2020 2020  dexes = {}.     
-0004ae30: 2020 2066 6f72 206b 2c20 6964 7820 696e     for k, idx in
-0004ae40: 2078 696e 6465 7865 732e 6974 656d 7328   xindexes.items(
-0004ae50: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0004ae60: 6620 6e6f 7420 7061 645f 6469 6d73 2e69  f not pad_dims.i
-0004ae70: 6e74 6572 7365 6374 696f 6e28 7869 6e64  ntersection(xind
-0004ae80: 6578 6573 2e67 6574 5f61 6c6c 5f64 696d  exes.get_all_dim
-0004ae90: 7328 6b29 293a 0a20 2020 2020 2020 2020  s(k)):.         
-0004aea0: 2020 2020 2020 2069 6e64 6578 6573 5b6b         indexes[k
-0004aeb0: 5d20 3d20 6964 780a 0a20 2020 2020 2020  ] = idx..       
-0004aec0: 2066 6f72 206e 616d 652c 2076 6172 2069   for name, var i
-0004aed0: 6e20 7365 6c66 2e76 6172 6961 626c 6573  n self.variables
-0004aee0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-0004aef0: 2020 2020 2020 7661 725f 7061 645f 7769        var_pad_wi
-0004af00: 6474 6820 3d20 7b6b 3a20 7620 666f 7220  dth = {k: v for 
-0004af10: 6b2c 2076 2069 6e20 7061 645f 7769 6474  k, v in pad_widt
-0004af20: 682e 6974 656d 7328 2920 6966 206b 2069  h.items() if k i
-0004af30: 6e20 7661 722e 6469 6d73 7d0a 2020 2020  n var.dims}.    
-0004af40: 2020 2020 2020 2020 6966 206e 6f74 2076          if not v
-0004af50: 6172 5f70 6164 5f77 6964 7468 3a0a 2020  ar_pad_width:.  
-0004af60: 2020 2020 2020 2020 2020 2020 2020 7661                va
-0004af70: 7269 6162 6c65 735b 6e61 6d65 5d20 3d20  riables[name] = 
-0004af80: 7661 720a 2020 2020 2020 2020 2020 2020  var.            
-0004af90: 656c 6966 206e 616d 6520 696e 2073 656c  elif name in sel
-0004afa0: 662e 6461 7461 5f76 6172 733a 0a20 2020  f.data_vars:.   
-0004afb0: 2020 2020 2020 2020 2020 2020 2076 6172               var
-0004afc0: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
-0004afd0: 6172 2e70 6164 280a 2020 2020 2020 2020  ar.pad(.        
-0004afe0: 2020 2020 2020 2020 2020 2020 7061 645f              pad_
-0004aff0: 7769 6474 683d 7661 725f 7061 645f 7769  width=var_pad_wi
-0004b000: 6474 682c 0a20 2020 2020 2020 2020 2020  dth,.           
-0004b010: 2020 2020 2020 2020 206d 6f64 653d 6d6f           mode=mo
-0004b020: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
-0004b030: 2020 2020 2020 2020 7374 6174 5f6c 656e          stat_len
-0004b040: 6774 683d 7374 6174 5f6c 656e 6774 682c  gth=stat_length,
-0004b050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b060: 2020 2020 2063 6f6e 7374 616e 745f 7661       constant_va
-0004b070: 6c75 6573 3d63 6f6e 7374 616e 745f 7661  lues=constant_va
-0004b080: 6c75 6573 2c0a 2020 2020 2020 2020 2020  lues,.          
-0004b090: 2020 2020 2020 2020 2020 656e 645f 7661            end_va
-0004b0a0: 6c75 6573 3d65 6e64 5f76 616c 7565 732c  lues=end_values,
-0004b0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b0c0: 2020 2020 2072 6566 6c65 6374 5f74 7970       reflect_typ
-0004b0d0: 653d 7265 666c 6563 745f 7479 7065 2c0a  e=reflect_type,.
-0004b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b0f0: 2020 2020 6b65 6570 5f61 7474 7273 3d6b      keep_attrs=k
-0004b100: 6565 705f 6174 7472 732c 0a20 2020 2020  eep_attrs,.     
-0004b110: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0004b120: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0004b130: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0004b140: 6172 6961 626c 6573 5b6e 616d 655d 203d  ariables[name] =
-0004b150: 2076 6172 2e70 6164 280a 2020 2020 2020   var.pad(.      
-0004b160: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0004b170: 645f 7769 6474 683d 7661 725f 7061 645f  d_width=var_pad_
-0004b180: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
-0004b190: 2020 2020 2020 2020 2020 206d 6f64 653d             mode=
-0004b1a0: 636f 6f72 645f 7061 645f 6d6f 6465 2c0a  coord_pad_mode,.
-0004b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b1c0: 2020 2020 6b65 6570 5f61 7474 7273 3d6b      keep_attrs=k
-0004b1d0: 6565 705f 6174 7472 732c 0a20 2020 2020  eep_attrs,.     
-0004b1e0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-0004b1f0: 2a63 6f6f 7264 5f70 6164 5f6f 7074 696f  *coord_pad_optio
-0004b200: 6e73 2c20 2023 2074 7970 653a 2069 676e  ns,  # type: ign
-0004b210: 6f72 655b 6172 672d 7479 7065 5d0a 2020  ore[arg-type].  
-0004b220: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0004b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b240: 2320 7265 7365 7420 6465 6661 756c 7420  # reset default 
-0004b250: 696e 6465 7820 6f66 2064 696d 656e 7369  index of dimensi
-0004b260: 6f6e 2063 6f6f 7264 696e 6174 6573 0a20  on coordinates. 
-0004b270: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004b280: 6620 286e 616d 652c 2920 3d3d 2076 6172  f (name,) == var
-0004b290: 2e64 696d 733a 0a20 2020 2020 2020 2020  .dims:.         
-0004b2a0: 2020 2020 2020 2020 2020 2064 696d 5f76             dim_v
-0004b2b0: 6172 203d 207b 6e61 6d65 3a20 7661 7269  ar = {name: vari
-0004b2c0: 6162 6c65 735b 6e61 6d65 5d7d 0a20 2020  ables[name]}.   
+000442c0: 2020 2020 2020 2020 2020 2020 762e 6461              v.da
+000442d0: 7461 2c20 636f 6f72 645f 7661 722e 6461  ta, coord_var.da
+000442e0: 7461 2c20 6178 6973 3d76 2e67 6574 5f61  ta, axis=v.get_a
+000442f0: 7869 735f 6e75 6d28 6469 6d29 0a20 2020  xis_num(dim).   
+00044300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044310: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00044320: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00044330: 5f64 696d 7320 3d20 762e 6469 6d73 0a20  _dims = v.dims. 
+00044340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044350: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00044360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044370: 2069 6e74 6567 203d 2064 7563 6b5f 6172   integ = duck_ar
+00044380: 7261 795f 6f70 732e 7472 6170 7a28 0a20  ray_ops.trapz(. 
+00044390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000443a0: 2020 2020 2020 2020 2020 2076 2e64 6174             v.dat
+000443b0: 612c 2063 6f6f 7264 5f76 6172 2e64 6174  a, coord_var.dat
+000443c0: 612c 2061 7869 733d 762e 6765 745f 6178  a, axis=v.get_ax
+000443d0: 6973 5f6e 756d 2864 696d 290a 2020 2020  is_num(dim).    
+000443e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000443f0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00044400: 2020 2020 2020 2020 2020 2020 2020 765f                v_
+00044410: 6469 6d73 203d 206c 6973 7428 762e 6469  dims = list(v.di
+00044420: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
+00044430: 2020 2020 2020 2020 2020 2020 765f 6469              v_di
+00044440: 6d73 2e72 656d 6f76 6528 6469 6d29 0a20  ms.remove(dim). 
+00044450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044460: 2020 2076 6172 6961 626c 6573 5b6b 5d20     variables[k] 
+00044470: 3d20 5661 7269 6162 6c65 2876 5f64 696d  = Variable(v_dim
+00044480: 732c 2069 6e74 6567 290a 2020 2020 2020  s, integ).      
+00044490: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000444a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000444b0: 2020 2020 7661 7269 6162 6c65 735b 6b5d      variables[k]
+000444c0: 203d 2076 0a20 2020 2020 2020 2069 6e64   = v.        ind
+000444d0: 6578 6573 203d 207b 6b3a 2076 2066 6f72  exes = {k: v for
+000444e0: 206b 2c20 7620 696e 2073 656c 662e 5f69   k, v in self._i
+000444f0: 6e64 6578 6573 2e69 7465 6d73 2829 2069  ndexes.items() i
+00044500: 6620 6b20 696e 2076 6172 6961 626c 6573  f k in variables
+00044510: 7d0a 2020 2020 2020 2020 7265 7475 726e  }.        return
+00044520: 2073 656c 662e 5f72 6570 6c61 6365 5f77   self._replace_w
+00044530: 6974 685f 6e65 775f 6469 6d73 280a 2020  ith_new_dims(.  
+00044540: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+00044550: 6c65 732c 2063 6f6f 7264 5f6e 616d 6573  les, coord_names
+00044560: 3d63 6f6f 7264 5f6e 616d 6573 2c20 696e  =coord_names, in
+00044570: 6465 7865 733d 696e 6465 7865 730a 2020  dexes=indexes.  
+00044580: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00044590: 2063 756d 756c 6174 6976 655f 696e 7465   cumulative_inte
+000445a0: 6772 6174 6528 0a20 2020 2020 2020 2073  grate(.        s
+000445b0: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
+000445c0: 2020 2020 2020 2020 636f 6f72 643a 2048          coord: H
+000445d0: 6173 6861 626c 6520 7c20 5365 7175 656e  ashable | Sequen
+000445e0: 6365 5b48 6173 6861 626c 655d 2c0a 2020  ce[Hashable],.  
+000445f0: 2020 2020 2020 6461 7465 7469 6d65 5f75        datetime_u
+00044600: 6e69 743a 2044 6174 6574 696d 6555 6e69  nit: DatetimeUni
+00044610: 744f 7074 696f 6e73 203d 204e 6f6e 652c  tOptions = None,
+00044620: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
+00044630: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
+00044640: 496e 7465 6772 6174 6520 616c 6f6e 6720  Integrate along 
+00044650: 7468 6520 6769 7665 6e20 636f 6f72 6469  the given coordi
+00044660: 6e61 7465 2075 7369 6e67 2074 6865 2074  nate using the t
+00044670: 7261 7065 7a6f 6964 616c 2072 756c 652e  rapezoidal rule.
+00044680: 0a0a 2020 2020 2020 2020 2e2e 206e 6f74  ..        .. not
+00044690: 653a 3a0a 2020 2020 2020 2020 2020 2020  e::.            
+000446a0: 5468 6973 2066 6561 7475 7265 2069 7320  This feature is 
+000446b0: 6c69 6d69 7465 6420 746f 2073 696d 706c  limited to simpl
+000446c0: 6520 6361 7274 6573 6961 6e20 6765 6f6d  e cartesian geom
+000446d0: 6574 7279 2c20 692e 652e 2063 6f6f 7264  etry, i.e. coord
+000446e0: 0a20 2020 2020 2020 2020 2020 206d 7573  .            mus
+000446f0: 7420 6265 206f 6e65 2064 696d 656e 7369  t be one dimensi
+00044700: 6f6e 616c 2e0a 0a20 2020 2020 2020 2020  onal...         
+00044710: 2020 2054 6865 2066 6972 7374 2065 6e74     The first ent
+00044720: 7279 206f 6620 7468 6520 6375 6d75 6c61  ry of the cumula
+00044730: 7469 7665 2069 6e74 6567 7261 6c20 6f66  tive integral of
+00044740: 2065 6163 6820 7661 7269 6162 6c65 2069   each variable i
+00044750: 7320 616c 7761 7973 2030 2c20 696e 0a20  s always 0, in. 
+00044760: 2020 2020 2020 2020 2020 206f 7264 6572             order
+00044770: 2074 6f20 6b65 6570 2074 6865 206c 656e   to keep the len
+00044780: 6774 6820 6f66 2074 6865 2064 696d 656e  gth of the dimen
+00044790: 7369 6f6e 2075 6e63 6861 6e67 6564 2062  sion unchanged b
+000447a0: 6574 7765 656e 2069 6e70 7574 2061 6e64  etween input and
+000447b0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+000447c0: 7075 742e 0a0a 2020 2020 2020 2020 5061  put...        Pa
+000447d0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+000447e0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+000447f0: 2020 2020 636f 6f72 6420 3a20 6861 7368      coord : hash
+00044800: 6162 6c65 2c20 6f72 2073 6571 7565 6e63  able, or sequenc
+00044810: 6520 6f66 2068 6173 6861 626c 650a 2020  e of hashable.  
+00044820: 2020 2020 2020 2020 2020 436f 6f72 6469            Coordi
+00044830: 6e61 7465 2873 2920 7573 6564 2066 6f72  nate(s) used for
+00044840: 2074 6865 2069 6e74 6567 7261 7469 6f6e   the integration
+00044850: 2e0a 2020 2020 2020 2020 6461 7465 7469  ..        dateti
+00044860: 6d65 5f75 6e69 7420 3a20 7b27 5927 2c20  me_unit : {'Y', 
+00044870: 274d 272c 2027 5727 2c20 2744 272c 2027  'M', 'W', 'D', '
+00044880: 6827 2c20 276d 272c 2027 7327 2c20 276d  h', 'm', 's', 'm
+00044890: 7327 2c20 2775 7327 2c20 276e 7327 2c20  s', 'us', 'ns', 
+000448a0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+000448b0: 2020 2020 2020 2020 2020 2770 7327 2c20            'ps', 
+000448c0: 2766 7327 2c20 2761 7327 2c20 4e6f 6e65  'fs', 'as', None
+000448d0: 7d2c 206f 7074 696f 6e61 6c0a 2020 2020  }, optional.    
+000448e0: 2020 2020 2020 2020 5370 6563 6966 7920          Specify 
+000448f0: 7468 6520 756e 6974 2069 6620 6461 7465  the unit if date
+00044900: 7469 6d65 2063 6f6f 7264 696e 6174 6520  time coordinate 
+00044910: 6973 2075 7365 642e 0a0a 2020 2020 2020  is used...      
+00044920: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+00044930: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+00044940: 2020 696e 7465 6772 6174 6564 203a 2044    integrated : D
+00044950: 6174 6173 6574 0a0a 2020 2020 2020 2020  ataset..        
+00044960: 5365 6520 616c 736f 0a20 2020 2020 2020  See also.       
+00044970: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+00044980: 2020 4461 7461 4172 7261 792e 6375 6d75    DataArray.cumu
+00044990: 6c61 7469 7665 5f69 6e74 6567 7261 7465  lative_integrate
+000449a0: 0a20 2020 2020 2020 2073 6369 7079 2e69  .        scipy.i
+000449b0: 6e74 6567 7261 7465 2e63 756d 756c 6174  ntegrate.cumulat
+000449c0: 6976 655f 7472 6170 657a 6f69 6420 3a20  ive_trapezoid : 
+000449d0: 636f 7272 6573 706f 6e64 696e 6720 7363  corresponding sc
+000449e0: 6970 7920 6675 6e63 7469 6f6e 0a0a 2020  ipy function..  
+000449f0: 2020 2020 2020 4578 616d 706c 6573 0a20        Examples. 
+00044a00: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+00044a10: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
+00044a20: 2078 722e 4461 7461 7365 7428 0a20 2020   xr.Dataset(.   
+00044a30: 2020 2020 202e 2e2e 2020 2020 2064 6174       ...     dat
+00044a40: 615f 7661 7273 3d7b 2261 223a 2028 2278  a_vars={"a": ("x
+00044a50: 222c 205b 352c 2035 2c20 362c 2036 5d29  ", [5, 5, 6, 6])
+00044a60: 2c20 2262 223a 2028 2278 222c 205b 312c  , "b": ("x", [1,
+00044a70: 2032 2c20 312c 2030 5d29 7d2c 0a20 2020   2, 1, 0])},.   
+00044a80: 2020 2020 202e 2e2e 2020 2020 2063 6f6f       ...     coo
+00044a90: 7264 733d 7b22 7822 3a20 5b30 2c20 312c  rds={"x": [0, 1,
+00044aa0: 2032 2c20 335d 2c20 2279 223a 2028 2278   2, 3], "y": ("x
+00044ab0: 222c 205b 312c 2037 2c20 332c 2035 5d29  ", [1, 7, 3, 5])
+00044ac0: 7d2c 0a20 2020 2020 2020 202e 2e2e 2029  },.        ... )
+00044ad0: 0a20 2020 2020 2020 203e 3e3e 2064 730a  .        >>> ds.
+00044ae0: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+00044af0: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+00044b00: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
+00044b10: 3a20 3429 0a20 2020 2020 2020 2043 6f6f  : 4).        Coo
+00044b20: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
+00044b30: 2020 2020 2a20 7820 2020 2020 2020 2028      * x        (
+00044b40: 7829 2069 6e74 3634 2030 2031 2032 2033  x) int64 0 1 2 3
+00044b50: 0a20 2020 2020 2020 2020 2020 2079 2020  .            y  
+00044b60: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
+00044b70: 3120 3720 3320 350a 2020 2020 2020 2020  1 7 3 5.        
+00044b80: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
+00044b90: 2020 2020 2020 2020 2020 2020 6120 2020              a   
+00044ba0: 2020 2020 2028 7829 2069 6e74 3634 2035       (x) int64 5
+00044bb0: 2035 2036 2036 0a20 2020 2020 2020 2020   5 6 6.         
+00044bc0: 2020 2062 2020 2020 2020 2020 2878 2920     b        (x) 
+00044bd0: 696e 7436 3420 3120 3220 3120 300a 2020  int64 1 2 1 0.  
+00044be0: 2020 2020 2020 3e3e 3e20 6473 2e63 756d        >>> ds.cum
+00044bf0: 756c 6174 6976 655f 696e 7465 6772 6174  ulative_integrat
+00044c00: 6528 2278 2229 0a20 2020 2020 2020 203c  e("x").        <
+00044c10: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
+00044c20: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+00044c30: 6e73 3a20 2028 783a 2034 290a 2020 2020  ns:  (x: 4).    
+00044c40: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
+00044c50: 0a20 2020 2020 2020 2020 202a 2078 2020  .          * x  
+00044c60: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
+00044c70: 3020 3120 3220 330a 2020 2020 2020 2020  0 1 2 3.        
+00044c80: 2020 2020 7920 2020 2020 2020 2028 7829      y        (x)
+00044c90: 2069 6e74 3634 2031 2037 2033 2035 0a20   int64 1 7 3 5. 
+00044ca0: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
+00044cb0: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
+00044cc0: 2020 2061 2020 2020 2020 2020 2878 2920     a        (x) 
+00044cd0: 666c 6f61 7436 3420 302e 3020 352e 3020  float64 0.0 5.0 
+00044ce0: 3130 2e35 2031 362e 350a 2020 2020 2020  10.5 16.5.      
+00044cf0: 2020 2020 2020 6220 2020 2020 2020 2028        b        (
+00044d00: 7829 2066 6c6f 6174 3634 2030 2e30 2031  x) float64 0.0 1
+00044d10: 2e35 2033 2e30 2033 2e35 0a20 2020 2020  .5 3.0 3.5.     
+00044d20: 2020 203e 3e3e 2064 732e 6375 6d75 6c61     >>> ds.cumula
+00044d30: 7469 7665 5f69 6e74 6567 7261 7465 2822  tive_integrate("
+00044d40: 7922 290a 2020 2020 2020 2020 3c78 6172  y").        <xar
+00044d50: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+00044d60: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+00044d70: 2020 2878 3a20 3429 0a20 2020 2020 2020    (x: 4).       
+00044d80: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+00044d90: 2020 2020 2020 2020 2a20 7820 2020 2020          * x     
+00044da0: 2020 2028 7829 2069 6e74 3634 2030 2031     (x) int64 0 1
+00044db0: 2032 2033 0a20 2020 2020 2020 2020 2020   2 3.           
+00044dc0: 2079 2020 2020 2020 2020 2878 2920 696e   y        (x) in
+00044dd0: 7436 3420 3120 3720 3320 350a 2020 2020  t64 1 7 3 5.    
+00044de0: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
+00044df0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00044e00: 6120 2020 2020 2020 2028 7829 2066 6c6f  a        (x) flo
+00044e10: 6174 3634 2030 2e30 2033 302e 3020 382e  at64 0.0 30.0 8.
+00044e20: 3020 3230 2e30 0a20 2020 2020 2020 2020  0 20.0.         
+00044e30: 2020 2062 2020 2020 2020 2020 2878 2920     b        (x) 
+00044e40: 666c 6f61 7436 3420 302e 3020 392e 3020  float64 0.0 9.0 
+00044e50: 332e 3020 342e 300a 2020 2020 2020 2020  3.0 4.0.        
+00044e60: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
+00044e70: 6f74 2069 7369 6e73 7461 6e63 6528 636f  ot isinstance(co
+00044e80: 6f72 642c 2028 6c69 7374 2c20 7475 706c  ord, (list, tupl
+00044e90: 6529 293a 0a20 2020 2020 2020 2020 2020  e)):.           
+00044ea0: 2063 6f6f 7264 203d 2028 636f 6f72 642c   coord = (coord,
+00044eb0: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
+00044ec0: 203d 2073 656c 660a 2020 2020 2020 2020   = self.        
+00044ed0: 666f 7220 6320 696e 2063 6f6f 7264 3a0a  for c in coord:.
+00044ee0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00044ef0: 6c74 203d 2072 6573 756c 742e 5f69 6e74  lt = result._int
+00044f00: 6567 7261 7465 5f6f 6e65 280a 2020 2020  egrate_one(.    
+00044f10: 2020 2020 2020 2020 2020 2020 632c 2064              c, d
+00044f20: 6174 6574 696d 655f 756e 6974 3d64 6174  atetime_unit=dat
+00044f30: 6574 696d 655f 756e 6974 2c20 6375 6d75  etime_unit, cumu
+00044f40: 6c61 7469 7665 3d54 7275 650a 2020 2020  lative=True.    
+00044f50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00044f60: 2020 7265 7475 726e 2072 6573 756c 740a    return result.
+00044f70: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00044f80: 2020 2064 6566 2072 6561 6c28 7365 6c66     def real(self
+00044f90: 3a20 545f 4461 7461 7365 7429 202d 3e20  : T_Dataset) -> 
+00044fa0: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+00044fb0: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+00044fc0: 6865 2072 6561 6c20 7061 7274 206f 6620  he real part of 
+00044fd0: 6561 6368 2064 6174 6120 7661 7269 6162  each data variab
+00044fe0: 6c65 2e0a 0a20 2020 2020 2020 2053 6565  le...        See
+00044ff0: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+00045000: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 206e  ------.        n
+00045010: 756d 7079 2e6e 6461 7272 6179 2e72 6561  umpy.ndarray.rea
+00045020: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
+00045030: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00045040: 662e 6d61 7028 6c61 6d62 6461 2078 3a20  f.map(lambda x: 
+00045050: 782e 7265 616c 2c20 6b65 6570 5f61 7474  x.real, keep_att
+00045060: 7273 3d54 7275 6529 0a0a 2020 2020 4070  rs=True)..    @p
+00045070: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+00045080: 696d 6167 2873 656c 663a 2054 5f44 6174  imag(self: T_Dat
+00045090: 6173 6574 2920 2d3e 2054 5f44 6174 6173  aset) -> T_Datas
+000450a0: 6574 3a0a 2020 2020 2020 2020 2222 220a  et:.        """.
+000450b0: 2020 2020 2020 2020 5468 6520 696d 6167          The imag
+000450c0: 696e 6172 7920 7061 7274 206f 6620 6561  inary part of ea
+000450d0: 6368 2064 6174 6120 7661 7269 6162 6c65  ch data variable
+000450e0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
+000450f0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+00045100: 2d2d 2d2d 0a20 2020 2020 2020 206e 756d  ----.        num
+00045110: 7079 2e6e 6461 7272 6179 2e69 6d61 670a  py.ndarray.imag.
+00045120: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00045130: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00045140: 6d61 7028 6c61 6d62 6461 2078 3a20 782e  map(lambda x: x.
+00045150: 696d 6167 2c20 6b65 6570 5f61 7474 7273  imag, keep_attrs
+00045160: 3d54 7275 6529 0a0a 2020 2020 706c 6f74  =True)..    plot
+00045170: 203d 2075 7469 6c73 2e55 6e63 6163 6865   = utils.Uncache
+00045180: 6441 6363 6573 736f 7228 4461 7461 7365  dAccessor(Datase
+00045190: 7450 6c6f 7441 6363 6573 736f 7229 0a0a  tPlotAccessor)..
+000451a0: 2020 2020 6465 6620 6669 6c74 6572 5f62      def filter_b
+000451b0: 795f 6174 7472 7328 7365 6c66 3a20 545f  y_attrs(self: T_
+000451c0: 4461 7461 7365 742c 202a 2a6b 7761 7267  Dataset, **kwarg
+000451d0: 7329 202d 3e20 545f 4461 7461 7365 743a  s) -> T_Dataset:
+000451e0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+000451f0: 726e 7320 6120 6060 4461 7461 7365 7460  rns a ``Dataset`
+00045200: 6020 7769 7468 2076 6172 6961 626c 6573  ` with variables
+00045210: 2074 6861 7420 6d61 7463 6820 7370 6563   that match spec
+00045220: 6966 6963 2063 6f6e 6469 7469 6f6e 732e  ific conditions.
+00045230: 0a0a 2020 2020 2020 2020 4361 6e20 7061  ..        Can pa
+00045240: 7373 2069 6e20 6060 6b65 793d 7661 6c75  ss in ``key=valu
+00045250: 6560 6020 6f72 2060 606b 6579 3d63 616c  e`` or ``key=cal
+00045260: 6c61 626c 6560 602e 2020 4120 4461 7461  lable``.  A Data
+00045270: 7365 7420 6973 2072 6574 7572 6e65 640a  set is returned.
+00045280: 2020 2020 2020 2020 636f 6e74 6169 6e69          containi
+00045290: 6e67 206f 6e6c 7920 7468 6520 7661 7269  ng only the vari
+000452a0: 6162 6c65 7320 666f 7220 7768 6963 6820  ables for which 
+000452b0: 616c 6c20 7468 6520 6669 6c74 6572 2074  all the filter t
+000452c0: 6573 7473 2070 6173 732e 0a20 2020 2020  ests pass..     
+000452d0: 2020 2054 6865 7365 2074 6573 7473 2061     These tests a
+000452e0: 7265 2065 6974 6865 7220 6060 6b65 793d  re either ``key=
+000452f0: 7661 6c75 6560 6020 666f 7220 7768 6963  value`` for whic
+00045300: 6820 7468 6520 6174 7472 6962 7574 6520  h the attribute 
+00045310: 6060 6b65 7960 600a 2020 2020 2020 2020  ``key``.        
+00045320: 6861 7320 7468 6520 6578 6163 7420 7661  has the exact va
+00045330: 6c75 6520 6060 7661 6c75 6560 6020 6f72  lue ``value`` or
+00045340: 2074 6865 2063 616c 6c61 626c 6520 7061   the callable pa
+00045350: 7373 6564 2069 6e74 6f0a 2020 2020 2020  ssed into.      
+00045360: 2020 6060 6b65 793d 6361 6c6c 6162 6c65    ``key=callable
+00045370: 6060 2072 6574 7572 6e73 2054 7275 652e  `` returns True.
+00045380: 2054 6865 2063 616c 6c61 626c 6520 7769   The callable wi
+00045390: 6c6c 2062 6520 7061 7373 6564 2061 2073  ll be passed a s
+000453a0: 696e 676c 650a 2020 2020 2020 2020 7661  ingle.        va
+000453b0: 6c75 652c 2065 6974 6865 7220 7468 6520  lue, either the 
+000453c0: 7661 6c75 6520 6f66 2074 6865 2061 7474  value of the att
+000453d0: 7269 6275 7465 2060 606b 6579 6060 206f  ribute ``key`` o
+000453e0: 7220 6060 4e6f 6e65 6060 2069 6620 7468  r ``None`` if th
+000453f0: 650a 2020 2020 2020 2020 4461 7461 4172  e.        DataAr
+00045400: 7261 7920 646f 6573 206e 6f74 2068 6176  ray does not hav
+00045410: 6520 616e 2061 7474 7269 6275 7465 2077  e an attribute w
+00045420: 6974 6820 7468 6520 6e61 6d65 2060 606b  ith the name ``k
+00045430: 6579 6060 2e0a 0a20 2020 2020 2020 2050  ey``...        P
+00045440: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+00045450: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00045460: 2020 2020 202a 2a6b 7761 7267 730a 2020       **kwargs.  
+00045470: 2020 2020 2020 2020 2020 6b65 7920 3a20            key : 
+00045480: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
+00045490: 2020 2020 4174 7472 6962 7574 6520 6e61      Attribute na
+000454a0: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
+000454b0: 7661 6c75 6520 3a20 6361 6c6c 6162 6c65  value : callable
+000454c0: 206f 7220 6f62 6a0a 2020 2020 2020 2020   or obj.        
+000454d0: 2020 2020 2020 2020 4966 2076 616c 7565          If value
+000454e0: 2069 7320 6120 6361 6c6c 6162 6c65 2c20   is a callable, 
+000454f0: 6974 2073 686f 756c 6420 7265 7475 726e  it should return
+00045500: 2061 2062 6f6f 6c65 616e 2069 6e20 7468   a boolean in th
+00045510: 6520 666f 726d 0a20 2020 2020 2020 2020  e form.         
+00045520: 2020 2020 2020 206f 6620 626f 6f6c 203d         of bool =
+00045530: 2066 756e 6328 6174 7472 2920 7768 6572   func(attr) wher
+00045540: 6520 6174 7472 2069 7320 6461 2e61 7474  e attr is da.att
+00045550: 7273 5b6b 6579 5d2e 0a20 2020 2020 2020  rs[key]..       
+00045560: 2020 2020 2020 2020 204f 7468 6572 7769           Otherwi
+00045570: 7365 2c20 7661 6c75 6520 7769 6c6c 2062  se, value will b
+00045580: 6520 636f 6d70 6172 6564 2074 6f20 7468  e compared to th
+00045590: 6520 6561 6368 0a20 2020 2020 2020 2020  e each.         
+000455a0: 2020 2020 2020 2044 6174 6141 7272 6179         DataArray
+000455b0: 2773 2061 7474 7273 5b6b 6579 5d2e 0a0a  's attrs[key]...
+000455c0: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+000455d0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+000455e0: 2020 2020 2020 2020 6e65 7720 3a20 4461          new : Da
+000455f0: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
+00045600: 2020 4e65 7720 6461 7461 7365 7420 7769    New dataset wi
+00045610: 7468 2076 6172 6961 626c 6573 2066 696c  th variables fil
+00045620: 7465 7265 6420 6279 2061 7474 7269 6275  tered by attribu
+00045630: 7465 2e0a 0a20 2020 2020 2020 2045 7861  te...        Exa
+00045640: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
+00045650: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
+00045660: 3e3e 2074 656d 7020 3d20 3135 202b 2038  >> temp = 15 + 8
+00045670: 202a 206e 702e 7261 6e64 6f6d 2e72 616e   * np.random.ran
+00045680: 646e 2832 2c20 322c 2033 290a 2020 2020  dn(2, 2, 3).    
+00045690: 2020 2020 3e3e 3e20 7072 6563 6970 203d      >>> precip =
+000456a0: 2031 3020 2a20 6e70 2e72 616e 646f 6d2e   10 * np.random.
+000456b0: 7261 6e64 2832 2c20 322c 2033 290a 2020  rand(2, 2, 3).  
+000456c0: 2020 2020 2020 3e3e 3e20 6c6f 6e20 3d20        >>> lon = 
+000456d0: 5b5b 2d39 392e 3833 2c20 2d39 392e 3332  [[-99.83, -99.32
+000456e0: 5d2c 205b 2d39 392e 3739 2c20 2d39 392e  ], [-99.79, -99.
+000456f0: 3233 5d5d 0a20 2020 2020 2020 203e 3e3e  23]].        >>>
+00045700: 206c 6174 203d 205b 5b34 322e 3235 2c20   lat = [[42.25, 
+00045710: 3432 2e32 315d 2c20 5b34 322e 3633 2c20  42.21], [42.63, 
+00045720: 3432 2e35 395d 5d0a 2020 2020 2020 2020  42.59]].        
+00045730: 3e3e 3e20 6469 6d73 203d 205b 2278 222c  >>> dims = ["x",
+00045740: 2022 7922 2c20 2274 696d 6522 5d0a 2020   "y", "time"].  
+00045750: 2020 2020 2020 3e3e 3e20 7465 6d70 5f61        >>> temp_a
+00045760: 7474 7220 3d20 6469 6374 2873 7461 6e64  ttr = dict(stand
+00045770: 6172 645f 6e61 6d65 3d22 6169 725f 706f  ard_name="air_po
+00045780: 7465 6e74 6961 6c5f 7465 6d70 6572 6174  tential_temperat
+00045790: 7572 6522 290a 2020 2020 2020 2020 3e3e  ure").        >>
+000457a0: 3e20 7072 6563 6970 5f61 7474 7220 3d20  > precip_attr = 
+000457b0: 6469 6374 2873 7461 6e64 6172 645f 6e61  dict(standard_na
+000457c0: 6d65 3d22 636f 6e76 6563 7469 7665 5f70  me="convective_p
+000457d0: 7265 6369 7069 7461 7469 6f6e 5f66 6c75  recipitation_flu
+000457e0: 7822 290a 0a20 2020 2020 2020 203e 3e3e  x")..        >>>
+000457f0: 2064 7320 3d20 7872 2e44 6174 6173 6574   ds = xr.Dataset
+00045800: 280a 2020 2020 2020 2020 2e2e 2e20 2020  (.        ...   
+00045810: 2020 6469 6374 280a 2020 2020 2020 2020    dict(.        
+00045820: 2e2e 2e20 2020 2020 2020 2020 7465 6d70  ...         temp
+00045830: 6572 6174 7572 653d 2864 696d 732c 2074  erature=(dims, t
+00045840: 656d 702c 2074 656d 705f 6174 7472 292c  emp, temp_attr),
+00045850: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+00045860: 2020 2020 2070 7265 6369 7069 7461 7469       precipitati
+00045870: 6f6e 3d28 6469 6d73 2c20 7072 6563 6970  on=(dims, precip
+00045880: 2c20 7072 6563 6970 5f61 7474 7229 2c0a  , precip_attr),.
+00045890: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+000458a0: 292c 0a20 2020 2020 2020 202e 2e2e 2020  ),.        ...  
+000458b0: 2020 2063 6f6f 7264 733d 6469 6374 280a     coords=dict(.
+000458c0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+000458d0: 2020 2020 6c6f 6e3d 285b 2278 222c 2022      lon=(["x", "
+000458e0: 7922 5d2c 206c 6f6e 292c 0a20 2020 2020  y"], lon),.     
+000458f0: 2020 202e 2e2e 2020 2020 2020 2020 206c     ...         l
+00045900: 6174 3d28 5b22 7822 2c20 2279 225d 2c20  at=(["x", "y"], 
+00045910: 6c61 7429 2c0a 2020 2020 2020 2020 2e2e  lat),.        ..
+00045920: 2e20 2020 2020 2020 2020 7469 6d65 3d70  .         time=p
+00045930: 642e 6461 7465 5f72 616e 6765 2822 3230  d.date_range("20
+00045940: 3134 2d30 392d 3036 222c 2070 6572 696f  14-09-06", perio
+00045950: 6473 3d33 292c 0a20 2020 2020 2020 202e  ds=3),.        .
+00045960: 2e2e 2020 2020 2020 2020 2072 6566 6572  ..         refer
+00045970: 656e 6365 5f74 696d 653d 7064 2e54 696d  ence_time=pd.Tim
+00045980: 6573 7461 6d70 2822 3230 3134 2d30 392d  estamp("2014-09-
+00045990: 3035 2229 2c0a 2020 2020 2020 2020 2e2e  05"),.        ..
+000459a0: 2e20 2020 2020 292c 0a20 2020 2020 2020  .     ),.       
+000459b0: 202e 2e2e 2029 0a0a 2020 2020 2020 2020   ... )..        
+000459c0: 4765 7420 7661 7269 6162 6c65 7320 6d61  Get variables ma
+000459d0: 7463 6869 6e67 2061 2073 7065 6369 6669  tching a specifi
+000459e0: 6320 7374 616e 6461 7264 5f6e 616d 653a  c standard_name:
+000459f0: 0a0a 2020 2020 2020 2020 3e3e 3e20 6473  ..        >>> ds
+00045a00: 2e66 696c 7465 725f 6279 5f61 7474 7273  .filter_by_attrs
+00045a10: 2873 7461 6e64 6172 645f 6e61 6d65 3d22  (standard_name="
+00045a20: 636f 6e76 6563 7469 7665 5f70 7265 6369  convective_preci
+00045a30: 7069 7461 7469 6f6e 5f66 6c75 7822 290a  pitation_flux").
+00045a40: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+00045a50: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+00045a60: 2044 696d 656e 7369 6f6e 733a 2020 2020   Dimensions:    
+00045a70: 2020 2020 2028 783a 2032 2c20 793a 2032       (x: 2, y: 2
+00045a80: 2c20 7469 6d65 3a20 3329 0a20 2020 2020  , time: 3).     
+00045a90: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+00045aa0: 2020 2020 2020 2020 2020 2020 6c6f 6e20              lon 
+00045ab0: 2020 2020 2020 2020 2020 2020 2878 2c20              (x, 
+00045ac0: 7929 2066 6c6f 6174 3634 202d 3939 2e38  y) float64 -99.8
+00045ad0: 3320 2d39 392e 3332 202d 3939 2e37 3920  3 -99.32 -99.79 
+00045ae0: 2d39 392e 3233 0a20 2020 2020 2020 2020  -99.23.         
+00045af0: 2020 206c 6174 2020 2020 2020 2020 2020     lat          
+00045b00: 2020 2028 782c 2079 2920 666c 6f61 7436     (x, y) float6
+00045b10: 3420 3432 2e32 3520 3432 2e32 3120 3432  4 42.25 42.21 42
+00045b20: 2e36 3320 3432 2e35 390a 2020 2020 2020  .63 42.59.      
+00045b30: 2020 2020 2a20 7469 6d65 2020 2020 2020      * time      
+00045b40: 2020 2020 2020 2874 696d 6529 2064 6174        (time) dat
+00045b50: 6574 696d 6536 345b 6e73 5d20 3230 3134  etime64[ns] 2014
+00045b60: 2d30 392d 3036 2032 3031 342d 3039 2d30  -09-06 2014-09-0
+00045b70: 3720 3230 3134 2d30 392d 3038 0a20 2020  7 2014-09-08.   
+00045b80: 2020 2020 2020 2020 2072 6566 6572 656e           referen
+00045b90: 6365 5f74 696d 6520 2064 6174 6574 696d  ce_time  datetim
+00045ba0: 6536 345b 6e73 5d20 3230 3134 2d30 392d  e64[ns] 2014-09-
+00045bb0: 3035 0a20 2020 2020 2020 2044 696d 656e  05.        Dimen
+00045bc0: 7369 6f6e 7320 7769 7468 6f75 7420 636f  sions without co
+00045bd0: 6f72 6469 6e61 7465 733a 2078 2c20 790a  ordinates: x, y.
+00045be0: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
+00045bf0: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
+00045c00: 2020 2020 7072 6563 6970 6974 6174 696f      precipitatio
+00045c10: 6e20 2020 2878 2c20 792c 2074 696d 6529  n   (x, y, time)
+00045c20: 2066 6c6f 6174 3634 2035 2e36 3820 392e   float64 5.68 9.
+00045c30: 3235 3620 302e 3731 3034 202e 2e2e 2037  256 0.7104 ... 7
+00045c40: 2e39 3932 2034 2e36 3135 2037 2e38 3035  .992 4.615 7.805
+00045c50: 0a0a 2020 2020 2020 2020 4765 7420 616c  ..        Get al
+00045c60: 6c20 7661 7269 6162 6c65 7320 7468 6174  l variables that
+00045c70: 2068 6176 6520 6120 7374 616e 6461 7264   have a standard
+00045c80: 5f6e 616d 6520 6174 7472 6962 7574 653a  _name attribute:
+00045c90: 0a0a 2020 2020 2020 2020 3e3e 3e20 7374  ..        >>> st
+00045ca0: 616e 6461 7264 5f6e 616d 6520 3d20 6c61  andard_name = la
+00045cb0: 6d62 6461 2076 3a20 7620 6973 206e 6f74  mbda v: v is not
+00045cc0: 204e 6f6e 650a 2020 2020 2020 2020 3e3e   None.        >>
+00045cd0: 3e20 6473 2e66 696c 7465 725f 6279 5f61  > ds.filter_by_a
+00045ce0: 7474 7273 2873 7461 6e64 6172 645f 6e61  ttrs(standard_na
+00045cf0: 6d65 3d73 7461 6e64 6172 645f 6e61 6d65  me=standard_name
+00045d00: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
+00045d10: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
+00045d20: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
+00045d30: 2020 2020 2020 2028 783a 2032 2c20 793a         (x: 2, y:
+00045d40: 2032 2c20 7469 6d65 3a20 3329 0a20 2020   2, time: 3).   
+00045d50: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
+00045d60: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00045d70: 6e20 2020 2020 2020 2020 2020 2020 2878  n             (x
+00045d80: 2c20 7929 2066 6c6f 6174 3634 202d 3939  , y) float64 -99
+00045d90: 2e38 3320 2d39 392e 3332 202d 3939 2e37  .83 -99.32 -99.7
+00045da0: 3920 2d39 392e 3233 0a20 2020 2020 2020  9 -99.23.       
+00045db0: 2020 2020 206c 6174 2020 2020 2020 2020       lat        
+00045dc0: 2020 2020 2028 782c 2079 2920 666c 6f61       (x, y) floa
+00045dd0: 7436 3420 3432 2e32 3520 3432 2e32 3120  t64 42.25 42.21 
+00045de0: 3432 2e36 3320 3432 2e35 390a 2020 2020  42.63 42.59.    
+00045df0: 2020 2020 2020 2a20 7469 6d65 2020 2020        * time    
+00045e00: 2020 2020 2020 2020 2874 696d 6529 2064          (time) d
+00045e10: 6174 6574 696d 6536 345b 6e73 5d20 3230  atetime64[ns] 20
+00045e20: 3134 2d30 392d 3036 2032 3031 342d 3039  14-09-06 2014-09
+00045e30: 2d30 3720 3230 3134 2d30 392d 3038 0a20  -07 2014-09-08. 
+00045e40: 2020 2020 2020 2020 2020 2072 6566 6572             refer
+00045e50: 656e 6365 5f74 696d 6520 2064 6174 6574  ence_time  datet
+00045e60: 696d 6536 345b 6e73 5d20 3230 3134 2d30  ime64[ns] 2014-0
+00045e70: 392d 3035 0a20 2020 2020 2020 2044 696d  9-05.        Dim
+00045e80: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
+00045e90: 636f 6f72 6469 6e61 7465 733a 2078 2c20  coordinates: x, 
+00045ea0: 790a 2020 2020 2020 2020 4461 7461 2076  y.        Data v
+00045eb0: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+00045ec0: 2020 2020 2020 7465 6d70 6572 6174 7572        temperatur
+00045ed0: 6520 2020 2020 2878 2c20 792c 2074 696d  e     (x, y, tim
+00045ee0: 6529 2066 6c6f 6174 3634 2032 392e 3131  e) float64 29.11
+00045ef0: 2031 382e 3220 3232 2e38 3320 2e2e 2e20   18.2 22.83 ... 
+00045f00: 3138 2e32 3820 3136 2e31 3520 3236 2e36  18.28 16.15 26.6
+00045f10: 330a 2020 2020 2020 2020 2020 2020 7072  3.            pr
+00045f20: 6563 6970 6974 6174 696f 6e20 2020 2878  ecipitation   (x
+00045f30: 2c20 792c 2074 696d 6529 2066 6c6f 6174  , y, time) float
+00045f40: 3634 2035 2e36 3820 392e 3235 3620 302e  64 5.68 9.256 0.
+00045f50: 3731 3034 202e 2e2e 2037 2e39 3932 2034  7104 ... 7.992 4
+00045f60: 2e36 3135 2037 2e38 3035 0a0a 2020 2020  .615 7.805..    
+00045f70: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00045f80: 7365 6c65 6374 696f 6e20 3d20 5b5d 0a20  selection = []. 
+00045f90: 2020 2020 2020 2066 6f72 2076 6172 5f6e         for var_n
+00045fa0: 616d 652c 2076 6172 6961 626c 6520 696e  ame, variable in
+00045fb0: 2073 656c 662e 7661 7269 6162 6c65 732e   self.variables.
+00045fc0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+00045fd0: 2020 2020 2068 6173 5f76 616c 7565 5f66       has_value_f
+00045fe0: 6c61 6720 3d20 4661 6c73 650a 2020 2020  lag = False.    
+00045ff0: 2020 2020 2020 2020 666f 7220 6174 7472          for attr
+00046000: 5f6e 616d 652c 2070 6174 7465 726e 2069  _name, pattern i
+00046010: 6e20 6b77 6172 6773 2e69 7465 6d73 2829  n kwargs.items()
+00046020: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00046030: 2020 6174 7472 5f76 616c 7565 203d 2076    attr_value = v
+00046040: 6172 6961 626c 652e 6174 7472 732e 6765  ariable.attrs.ge
+00046050: 7428 6174 7472 5f6e 616d 6529 0a20 2020  t(attr_name).   
+00046060: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00046070: 2863 616c 6c61 626c 6528 7061 7474 6572  (callable(patter
+00046080: 6e29 2061 6e64 2070 6174 7465 726e 2861  n) and pattern(a
+00046090: 7474 725f 7661 6c75 6529 2920 6f72 2061  ttr_value)) or a
+000460a0: 7474 725f 7661 6c75 6520 3d3d 2070 6174  ttr_value == pat
+000460b0: 7465 726e 3a0a 2020 2020 2020 2020 2020  tern:.          
+000460c0: 2020 2020 2020 2020 2020 6861 735f 7661            has_va
+000460d0: 6c75 655f 666c 6167 203d 2054 7275 650a  lue_flag = True.
+000460e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000460f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00046100: 2020 2020 2020 2020 2020 6861 735f 7661            has_va
+00046110: 6c75 655f 666c 6167 203d 2046 616c 7365  lue_flag = False
+00046120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046130: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+00046140: 2020 2020 2020 2069 6620 6861 735f 7661         if has_va
+00046150: 6c75 655f 666c 6167 2069 7320 5472 7565  lue_flag is True
+00046160: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00046170: 2020 7365 6c65 6374 696f 6e2e 6170 7065    selection.appe
+00046180: 6e64 2876 6172 5f6e 616d 6529 0a20 2020  nd(var_name).   
+00046190: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000461a0: 5b73 656c 6563 7469 6f6e 5d0a 0a20 2020  [selection]..   
+000461b0: 2064 6566 2075 6e69 6679 5f63 6875 6e6b   def unify_chunk
+000461c0: 7328 7365 6c66 3a20 545f 4461 7461 7365  s(self: T_Datase
+000461d0: 7429 202d 3e20 545f 4461 7461 7365 743a  t) -> T_Dataset:
+000461e0: 0a20 2020 2020 2020 2022 2222 556e 6966  .        """Unif
+000461f0: 7920 6368 756e 6b20 7369 7a65 2061 6c6f  y chunk size alo
+00046200: 6e67 2061 6c6c 2063 6875 6e6b 6564 2064  ng all chunked d
+00046210: 696d 656e 7369 6f6e 7320 6f66 2074 6869  imensions of thi
+00046220: 7320 4461 7461 7365 742e 0a0a 2020 2020  s Dataset...    
+00046230: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00046240: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00046250: 2020 2020 4461 7461 7365 7420 7769 7468      Dataset with
+00046260: 2063 6f6e 7369 7374 656e 7420 6368 756e   consistent chun
+00046270: 6b20 7369 7a65 7320 666f 7220 616c 6c20  k sizes for all 
+00046280: 6461 736b 2d61 7272 6179 2076 6172 6961  dask-array varia
+00046290: 626c 6573 0a0a 2020 2020 2020 2020 5365  bles..        Se
+000462a0: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
+000462b0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+000462c0: 6461 736b 2e61 7272 6179 2e63 6f72 652e  dask.array.core.
+000462d0: 756e 6966 795f 6368 756e 6b73 0a20 2020  unify_chunks.   
+000462e0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+000462f0: 2020 7265 7475 726e 2075 6e69 6679 5f63    return unify_c
+00046300: 6875 6e6b 7328 7365 6c66 295b 305d 0a0a  hunks(self)[0]..
+00046310: 2020 2020 6465 6620 6d61 705f 626c 6f63      def map_bloc
+00046320: 6b73 280a 2020 2020 2020 2020 7365 6c66  ks(.        self
+00046330: 2c0a 2020 2020 2020 2020 6675 6e63 3a20  ,.        func: 
+00046340: 4361 6c6c 6162 6c65 5b2e 2e2e 2c20 545f  Callable[..., T_
+00046350: 5861 7272 6179 5d2c 0a20 2020 2020 2020  Xarray],.       
+00046360: 2061 7267 733a 2053 6571 7565 6e63 655b   args: Sequence[
+00046370: 416e 795d 203d 2028 292c 0a20 2020 2020  Any] = (),.     
+00046380: 2020 206b 7761 7267 733a 204d 6170 7069     kwargs: Mappi
+00046390: 6e67 5b73 7472 2c20 416e 795d 207c 204e  ng[str, Any] | N
+000463a0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+000463b0: 2020 2020 7465 6d70 6c61 7465 3a20 4461      template: Da
+000463c0: 7461 4172 7261 7920 7c20 4461 7461 7365  taArray | Datase
+000463d0: 7420 7c20 4e6f 6e65 203d 204e 6f6e 652c  t | None = None,
+000463e0: 0a20 2020 2029 202d 3e20 545f 5861 7272  .    ) -> T_Xarr
+000463f0: 6179 3a0a 2020 2020 2020 2020 2222 220a  ay:.        """.
+00046400: 2020 2020 2020 2020 4170 706c 7920 6120          Apply a 
+00046410: 6675 6e63 7469 6f6e 2074 6f20 6561 6368  function to each
+00046420: 2062 6c6f 636b 206f 6620 7468 6973 2044   block of this D
+00046430: 6174 6173 6574 2e0a 0a20 2020 2020 2020  ataset...       
+00046440: 202e 2e20 7761 726e 696e 673a 3a0a 2020   .. warning::.  
+00046450: 2020 2020 2020 2020 2020 5468 6973 206d            This m
+00046460: 6574 686f 6420 6973 2065 7870 6572 696d  ethod is experim
+00046470: 656e 7461 6c20 616e 6420 6974 7320 7369  ental and its si
+00046480: 676e 6174 7572 6520 6d61 7920 6368 616e  gnature may chan
+00046490: 6765 2e0a 0a20 2020 2020 2020 2050 6172  ge...        Par
+000464a0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+000464b0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+000464c0: 2020 2066 756e 6320 3a20 6361 6c6c 6162     func : callab
+000464d0: 6c65 0a20 2020 2020 2020 2020 2020 2055  le.            U
+000464e0: 7365 722d 7072 6f76 6964 6564 2066 756e  ser-provided fun
+000464f0: 6374 696f 6e20 7468 6174 2061 6363 6570  ction that accep
+00046500: 7473 2061 2044 6174 6173 6574 2061 7320  ts a Dataset as 
+00046510: 6974 7320 6669 7273 740a 2020 2020 2020  its first.      
+00046520: 2020 2020 2020 7061 7261 6d65 7465 722e        parameter.
+00046530: 2054 6865 2066 756e 6374 696f 6e20 7769   The function wi
+00046540: 6c6c 2072 6563 6569 7665 2061 2073 7562  ll receive a sub
+00046550: 7365 7420 6f72 2027 626c 6f63 6b27 206f  set or 'block' o
+00046560: 6620 7468 6973 2044 6174 6173 6574 2028  f this Dataset (
+00046570: 7365 6520 6265 6c6f 7729 2c0a 2020 2020  see below),.    
+00046580: 2020 2020 2020 2020 636f 7272 6573 706f          correspo
+00046590: 6e64 696e 6720 746f 206f 6e65 2063 6875  nding to one chu
+000465a0: 6e6b 2061 6c6f 6e67 2065 6163 6820 6368  nk along each ch
+000465b0: 756e 6b65 6420 6469 6d65 6e73 696f 6e2e  unked dimension.
+000465c0: 2060 6066 756e 6360 6020 7769 6c6c 2062   ``func`` will b
+000465d0: 650a 2020 2020 2020 2020 2020 2020 6578  e.            ex
+000465e0: 6563 7574 6564 2061 7320 6060 6675 6e63  ecuted as ``func
+000465f0: 2873 7562 7365 745f 6461 7461 7365 742c  (subset_dataset,
+00046600: 202a 7375 6273 6574 5f61 7267 732c 202a   *subset_args, *
+00046610: 2a6b 7761 7267 7329 6060 2e0a 0a20 2020  *kwargs)``...   
+00046620: 2020 2020 2020 2020 2054 6869 7320 6675           This fu
+00046630: 6e63 7469 6f6e 206d 7573 7420 7265 7475  nction must retu
+00046640: 726e 2065 6974 6865 7220 6120 7369 6e67  rn either a sing
+00046650: 6c65 2044 6174 6141 7272 6179 206f 7220  le DataArray or 
+00046660: 6120 7369 6e67 6c65 2044 6174 6173 6574  a single Dataset
+00046670: 2e0a 0a20 2020 2020 2020 2020 2020 2054  ...            T
+00046680: 6869 7320 6675 6e63 7469 6f6e 2063 616e  his function can
+00046690: 6e6f 7420 6164 6420 6120 6e65 7720 6368  not add a new ch
+000466a0: 756e 6b65 6420 6469 6d65 6e73 696f 6e2e  unked dimension.
+000466b0: 0a20 2020 2020 2020 2061 7267 7320 3a20  .        args : 
+000466c0: 7365 7175 656e 6365 0a20 2020 2020 2020  sequence.       
+000466d0: 2020 2020 2050 6173 7365 6420 746f 2066       Passed to f
+000466e0: 756e 6320 6166 7465 7220 756e 7061 636b  unc after unpack
+000466f0: 696e 6720 616e 6420 7375 6273 6574 7469  ing and subsetti
+00046700: 6e67 2061 6e79 2078 6172 7261 7920 6f62  ng any xarray ob
+00046710: 6a65 6374 7320 6279 2062 6c6f 636b 732e  jects by blocks.
+00046720: 0a20 2020 2020 2020 2020 2020 2078 6172  .            xar
+00046730: 7261 7920 6f62 6a65 6374 7320 696e 2061  ray objects in a
+00046740: 7267 7320 6d75 7374 2062 6520 616c 6967  rgs must be alig
+00046750: 6e65 6420 7769 7468 206f 626a 2c20 6f74  ned with obj, ot
+00046760: 6865 7277 6973 6520 616e 2065 7272 6f72  herwise an error
+00046770: 2069 7320 7261 6973 6564 2e0a 2020 2020   is raised..    
+00046780: 2020 2020 6b77 6172 6773 203a 204d 6170      kwargs : Map
+00046790: 7069 6e67 206f 7220 4e6f 6e65 0a20 2020  ping or None.   
+000467a0: 2020 2020 2020 2020 2050 6173 7365 6420           Passed 
+000467b0: 7665 7262 6174 696d 2074 6f20 6675 6e63  verbatim to func
+000467c0: 2061 6674 6572 2075 6e70 6163 6b69 6e67   after unpacking
+000467d0: 2e20 7861 7272 6179 206f 626a 6563 7473  . xarray objects
+000467e0: 2c20 6966 2061 6e79 2c20 7769 6c6c 206e  , if any, will n
+000467f0: 6f74 2062 650a 2020 2020 2020 2020 2020  ot be.          
+00046800: 2020 7375 6273 6574 2074 6f20 626c 6f63    subset to bloc
+00046810: 6b73 2e20 5061 7373 696e 6720 6461 736b  ks. Passing dask
+00046820: 2063 6f6c 6c65 6374 696f 6e73 2069 6e20   collections in 
+00046830: 6b77 6172 6773 2069 7320 6e6f 7420 616c  kwargs is not al
+00046840: 6c6f 7765 642e 0a20 2020 2020 2020 2074  lowed..        t
+00046850: 656d 706c 6174 6520 3a20 4461 7461 4172  emplate : DataAr
+00046860: 7261 792c 2044 6174 6173 6574 206f 7220  ray, Dataset or 
+00046870: 4e6f 6e65 2c20 6f70 7469 6f6e 616c 0a20  None, optional. 
+00046880: 2020 2020 2020 2020 2020 2078 6172 7261             xarra
+00046890: 7920 6f62 6a65 6374 2072 6570 7265 7365  y object represe
+000468a0: 6e74 696e 6720 7468 6520 6669 6e61 6c20  nting the final 
+000468b0: 7265 7375 6c74 2061 6674 6572 2063 6f6d  result after com
+000468c0: 7075 7465 2069 7320 6361 6c6c 6564 2e20  pute is called. 
+000468d0: 4966 206e 6f74 2070 726f 7669 6465 642c  If not provided,
+000468e0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+000468f0: 2066 756e 6374 696f 6e20 7769 6c6c 2062   function will b
+00046900: 6520 6669 7273 7420 7275 6e20 6f6e 206d  e first run on m
+00046910: 6f63 6b65 642d 7570 2064 6174 612c 2074  ocked-up data, t
+00046920: 6861 7420 6c6f 6f6b 7320 6c69 6b65 2074  hat looks like t
+00046930: 6869 7320 6f62 6a65 6374 2062 7574 0a20  his object but. 
+00046940: 2020 2020 2020 2020 2020 2068 6173 2073             has s
+00046950: 697a 6573 2030 2c20 746f 2064 6574 6572  izes 0, to deter
+00046960: 6d69 6e65 2070 726f 7065 7274 6965 7320  mine properties 
+00046970: 6f66 2074 6865 2072 6574 7572 6e65 6420  of the returned 
+00046980: 6f62 6a65 6374 2073 7563 6820 6173 2064  object such as d
+00046990: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
+000469a0: 2020 7661 7269 6162 6c65 206e 616d 6573    variable names
+000469b0: 2c20 6174 7472 6962 7574 6573 2c20 6e65  , attributes, ne
+000469c0: 7720 6469 6d65 6e73 696f 6e73 2061 6e64  w dimensions and
+000469d0: 206e 6577 2069 6e64 6578 6573 2028 6966   new indexes (if
+000469e0: 2061 6e79 292e 0a20 2020 2020 2020 2020   any)..         
+000469f0: 2020 2060 6074 656d 706c 6174 6560 6020     ``template`` 
+00046a00: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
+00046a10: 2069 6620 7468 6520 6675 6e63 7469 6f6e   if the function
+00046a20: 2063 6861 6e67 6573 2074 6865 2073 697a   changes the siz
+00046a30: 6520 6f66 2065 7869 7374 696e 6720 6469  e of existing di
+00046a40: 6d65 6e73 696f 6e73 2e0a 2020 2020 2020  mensions..      
+00046a50: 2020 2020 2020 5768 656e 2070 726f 7669        When provi
+00046a60: 6465 642c 2060 6061 7474 7273 6060 206f  ded, ``attrs`` o
+00046a70: 6e20 7661 7269 6162 6c65 7320 696e 2060  n variables in `
+00046a80: 7465 6d70 6c61 7465 6020 6172 6520 636f  template` are co
+00046a90: 7069 6564 206f 7665 7220 746f 2074 6865  pied over to the
+00046aa0: 2072 6573 756c 742e 2041 6e79 0a20 2020   result. Any.   
+00046ab0: 2020 2020 2020 2020 2060 6061 7474 7273           ``attrs
+00046ac0: 6060 2073 6574 2062 7920 6060 6675 6e63  `` set by ``func
+00046ad0: 6060 2077 696c 6c20 6265 2069 676e 6f72  `` will be ignor
+00046ae0: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
+00046af0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+00046b00: 2d2d 2d2d 0a20 2020 2020 2020 2041 2073  ----.        A s
+00046b10: 696e 676c 6520 4461 7461 4172 7261 7920  ingle DataArray 
+00046b20: 6f72 2044 6174 6173 6574 2077 6974 6820  or Dataset with 
+00046b30: 6461 736b 2062 6163 6b65 6e64 2c20 7265  dask backend, re
+00046b40: 6173 7365 6d62 6c65 6420 6672 6f6d 2074  assembled from t
+00046b50: 6865 206f 7574 7075 7473 206f 6620 7468  he outputs of th
+00046b60: 650a 2020 2020 2020 2020 6675 6e63 7469  e.        functi
+00046b70: 6f6e 2e0a 0a20 2020 2020 2020 204e 6f74  on...        Not
+00046b80: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
+00046b90: 0a20 2020 2020 2020 2054 6869 7320 6675  .        This fu
+00046ba0: 6e63 7469 6f6e 2069 7320 6465 7369 676e  nction is design
+00046bb0: 6564 2066 6f72 2077 6865 6e20 6060 6675  ed for when ``fu
+00046bc0: 6e63 6060 206e 6565 6473 2074 6f20 6d61  nc`` needs to ma
+00046bd0: 6e69 7075 6c61 7465 2061 2077 686f 6c65  nipulate a whole
+00046be0: 2078 6172 7261 7920 6f62 6a65 6374 0a20   xarray object. 
+00046bf0: 2020 2020 2020 2073 7562 7365 7420 746f         subset to
+00046c00: 2065 6163 6820 626c 6f63 6b2e 2045 6163   each block. Eac
+00046c10: 6820 626c 6f63 6b20 6973 206c 6f61 6465  h block is loade
+00046c20: 6420 696e 746f 206d 656d 6f72 792e 2049  d into memory. I
+00046c30: 6e20 7468 6520 6d6f 7265 2063 6f6d 6d6f  n the more commo
+00046c40: 6e20 6361 7365 2077 6865 7265 0a20 2020  n case where.   
+00046c50: 2020 2020 2060 6066 756e 6360 6020 6361       ``func`` ca
+00046c60: 6e20 776f 726b 206f 6e20 6e75 6d70 7920  n work on numpy 
+00046c70: 6172 7261 7973 2c20 6974 2069 7320 7265  arrays, it is re
+00046c80: 636f 6d6d 656e 6465 6420 746f 2075 7365  commended to use
+00046c90: 2060 6061 7070 6c79 5f75 6675 6e63 6060   ``apply_ufunc``
+00046ca0: 2e0a 0a20 2020 2020 2020 2049 6620 6e6f  ...        If no
+00046cb0: 6e65 206f 6620 7468 6520 7661 7269 6162  ne of the variab
+00046cc0: 6c65 7320 696e 2074 6869 7320 6f62 6a65  les in this obje
+00046cd0: 6374 2069 7320 6261 636b 6564 2062 7920  ct is backed by 
+00046ce0: 6461 736b 2061 7272 6179 732c 2063 616c  dask arrays, cal
+00046cf0: 6c69 6e67 2074 6869 7320 6675 6e63 7469  ling this functi
+00046d00: 6f6e 2069 730a 2020 2020 2020 2020 6571  on is.        eq
+00046d10: 7569 7661 6c65 6e74 2074 6f20 6361 6c6c  uivalent to call
+00046d20: 696e 6720 6060 6675 6e63 286f 626a 2c20  ing ``func(obj, 
+00046d30: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
+00046d40: 6060 2e0a 0a20 2020 2020 2020 2053 6565  ``...        See
+00046d50: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+00046d60: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
+00046d70: 6173 6b2e 6172 7261 792e 6d61 705f 626c  ask.array.map_bl
+00046d80: 6f63 6b73 2c20 7861 7272 6179 2e61 7070  ocks, xarray.app
+00046d90: 6c79 5f75 6675 6e63 2c20 7861 7272 6179  ly_ufunc, xarray
+00046da0: 2e44 6174 6173 6574 2e6d 6170 5f62 6c6f  .Dataset.map_blo
+00046db0: 636b 730a 2020 2020 2020 2020 7861 7272  cks.        xarr
+00046dc0: 6179 2e44 6174 6141 7272 6179 2e6d 6170  ay.DataArray.map
+00046dd0: 5f62 6c6f 636b 730a 0a20 2020 2020 2020  _blocks..       
+00046de0: 2045 7861 6d70 6c65 730a 2020 2020 2020   Examples.      
+00046df0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+00046e00: 2020 2043 616c 6375 6c61 7465 2061 6e20     Calculate an 
+00046e10: 616e 6f6d 616c 7920 6672 6f6d 2063 6c69  anomaly from cli
+00046e20: 6d61 746f 6c6f 6779 2075 7369 6e67 2060  matology using `
+00046e30: 602e 6772 6f75 7062 7928 2960 602e 2055  `.groupby()``. U
+00046e40: 7369 6e67 0a20 2020 2020 2020 2060 6078  sing.        ``x
+00046e50: 722e 6d61 705f 626c 6f63 6b73 2829 6060  r.map_blocks()``
+00046e60: 2061 6c6c 6f77 7320 666f 7220 7061 7261   allows for para
+00046e70: 6c6c 656c 206f 7065 7261 7469 6f6e 7320  llel operations 
+00046e80: 7769 7468 206b 6e6f 776c 6564 6765 206f  with knowledge o
+00046e90: 6620 6060 7861 7272 6179 6060 2c0a 2020  f ``xarray``,.  
+00046ea0: 2020 2020 2020 6974 7320 696e 6469 6365        its indice
+00046eb0: 732c 2061 6e64 2069 7473 206d 6574 686f  s, and its metho
+00046ec0: 6473 206c 696b 6520 6060 2e67 726f 7570  ds like ``.group
+00046ed0: 6279 2829 6060 2e0a 0a20 2020 2020 2020  by()``...       
+00046ee0: 203e 3e3e 2064 6566 2063 616c 6375 6c61   >>> def calcula
+00046ef0: 7465 5f61 6e6f 6d61 6c79 2864 612c 2067  te_anomaly(da, g
+00046f00: 726f 7570 6279 5f74 7970 653d 2274 696d  roupby_type="tim
+00046f10: 652e 6d6f 6e74 6822 293a 0a20 2020 2020  e.month"):.     
+00046f20: 2020 202e 2e2e 2020 2020 2067 6220 3d20     ...     gb = 
+00046f30: 6461 2e67 726f 7570 6279 2867 726f 7570  da.groupby(group
+00046f40: 6279 5f74 7970 6529 0a20 2020 2020 2020  by_type).       
+00046f50: 202e 2e2e 2020 2020 2063 6c69 6d20 3d20   ...     clim = 
+00046f60: 6762 2e6d 6561 6e28 6469 6d3d 2274 696d  gb.mean(dim="tim
+00046f70: 6522 290a 2020 2020 2020 2020 2e2e 2e20  e").        ... 
+00046f80: 2020 2020 7265 7475 726e 2067 6220 2d20      return gb - 
+00046f90: 636c 696d 0a20 2020 2020 2020 202e 2e2e  clim.        ...
+00046fa0: 0a20 2020 2020 2020 203e 3e3e 2074 696d  .        >>> tim
+00046fb0: 6520 3d20 7872 2e63 6674 696d 655f 7261  e = xr.cftime_ra
+00046fc0: 6e67 6528 2231 3939 302d 3031 222c 2022  nge("1990-01", "
+00046fd0: 3139 3932 2d30 3122 2c20 6672 6571 3d22  1992-01", freq="
+00046fe0: 4d22 290a 2020 2020 2020 2020 3e3e 3e20  M").        >>> 
+00046ff0: 6d6f 6e74 6820 3d20 7872 2e44 6174 6141  month = xr.DataA
+00047000: 7272 6179 2874 696d 652e 6d6f 6e74 682c  rray(time.month,
+00047010: 2063 6f6f 7264 733d 7b22 7469 6d65 223a   coords={"time":
+00047020: 2074 696d 657d 2c20 6469 6d73 3d5b 2274   time}, dims=["t
+00047030: 696d 6522 5d29 0a20 2020 2020 2020 203e  ime"]).        >
+00047040: 3e3e 206e 702e 7261 6e64 6f6d 2e73 6565  >> np.random.see
+00047050: 6428 3132 3329 0a20 2020 2020 2020 203e  d(123).        >
+00047060: 3e3e 2061 7272 6179 203d 2078 722e 4461  >> array = xr.Da
+00047070: 7461 4172 7261 7928 0a20 2020 2020 2020  taArray(.       
+00047080: 202e 2e2e 2020 2020 206e 702e 7261 6e64   ...     np.rand
+00047090: 6f6d 2e72 616e 6428 6c65 6e28 7469 6d65  om.rand(len(time
+000470a0: 2929 2c0a 2020 2020 2020 2020 2e2e 2e20  )),.        ... 
+000470b0: 2020 2020 6469 6d73 3d5b 2274 696d 6522      dims=["time"
+000470c0: 5d2c 0a20 2020 2020 2020 202e 2e2e 2020  ],.        ...  
+000470d0: 2020 2063 6f6f 7264 733d 7b22 7469 6d65     coords={"time
+000470e0: 223a 2074 696d 652c 2022 6d6f 6e74 6822  ": time, "month"
+000470f0: 3a20 6d6f 6e74 687d 2c0a 2020 2020 2020  : month},.      
+00047100: 2020 2e2e 2e20 292e 6368 756e 6b28 290a    ... ).chunk().
+00047110: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
+00047120: 2078 722e 4461 7461 7365 7428 7b22 6122   xr.Dataset({"a"
+00047130: 3a20 6172 7261 797d 290a 2020 2020 2020  : array}).      
+00047140: 2020 3e3e 3e20 6473 2e6d 6170 5f62 6c6f    >>> ds.map_blo
+00047150: 636b 7328 6361 6c63 756c 6174 655f 616e  cks(calculate_an
+00047160: 6f6d 616c 792c 2074 656d 706c 6174 653d  omaly, template=
+00047170: 6473 292e 636f 6d70 7574 6528 290a 2020  ds).compute().  
+00047180: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
+00047190: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
+000471a0: 696d 656e 7369 6f6e 733a 2020 2874 696d  imensions:  (tim
+000471b0: 653a 2032 3429 0a20 2020 2020 2020 2043  e: 24).        C
+000471c0: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
+000471d0: 2020 2020 2020 2a20 7469 6d65 2020 2020        * time    
+000471e0: 2028 7469 6d65 2920 6f62 6a65 6374 2031   (time) object 1
+000471f0: 3939 302d 3031 2d33 3120 3030 3a30 303a  990-01-31 00:00:
+00047200: 3030 202e 2e2e 2031 3939 312d 3132 2d33  00 ... 1991-12-3
+00047210: 3120 3030 3a30 303a 3030 0a20 2020 2020  1 00:00:00.     
+00047220: 2020 2020 2020 206d 6f6e 7468 2020 2020         month    
+00047230: 2874 696d 6529 2069 6e74 3634 2031 2032  (time) int64 1 2
+00047240: 2033 2034 2035 2036 2037 2038 2039 2031   3 4 5 6 7 8 9 1
+00047250: 3020 3131 2031 3220 3120 3220 3320 3420  0 11 12 1 2 3 4 
+00047260: 3520 3620 3720 3820 3920 3130 2031 3120  5 6 7 8 9 10 11 
+00047270: 3132 0a20 2020 2020 2020 2044 6174 6120  12.        Data 
+00047280: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+00047290: 2020 2020 2020 2061 2020 2020 2020 2020         a        
+000472a0: 2874 696d 6529 2066 6c6f 6174 3634 2030  (time) float64 0
+000472b0: 2e31 3238 3920 302e 3131 3332 202d 302e  .1289 0.1132 -0.
+000472c0: 3038 3536 202e 2e2e 2030 2e32 3238 3720  0856 ... 0.2287 
+000472d0: 302e 3139 3036 202d 302e 3035 3930 310a  0.1906 -0.05901.
+000472e0: 0a20 2020 2020 2020 204e 6f74 6520 7468  .        Note th
+000472f0: 6174 206f 6e65 206d 7573 7420 6578 706c  at one must expl
+00047300: 6963 6974 6c79 2075 7365 2060 6061 7267  icitly use ``arg
+00047310: 733d 5b5d 6060 2061 6e64 2060 606b 7761  s=[]`` and ``kwa
+00047320: 7267 733d 7b7d 6060 2074 6f20 7061 7373  rgs={}`` to pass
+00047330: 2061 7267 756d 656e 7473 0a20 2020 2020   arguments.     
+00047340: 2020 2074 6f20 7468 6520 6675 6e63 7469     to the functi
+00047350: 6f6e 2062 6569 6e67 2061 7070 6c69 6564  on being applied
+00047360: 2069 6e20 6060 7872 2e6d 6170 5f62 6c6f   in ``xr.map_blo
+00047370: 636b 7328 2960 603a 0a0a 2020 2020 2020  cks()``:..      
+00047380: 2020 3e3e 3e20 6473 2e6d 6170 5f62 6c6f    >>> ds.map_blo
+00047390: 636b 7328 0a20 2020 2020 2020 202e 2e2e  cks(.        ...
+000473a0: 2020 2020 2063 616c 6375 6c61 7465 5f61       calculate_a
+000473b0: 6e6f 6d61 6c79 2c0a 2020 2020 2020 2020  nomaly,.        
+000473c0: 2e2e 2e20 2020 2020 6b77 6172 6773 3d7b  ...     kwargs={
+000473d0: 2267 726f 7570 6279 5f74 7970 6522 3a20  "groupby_type": 
+000473e0: 2274 696d 652e 7965 6172 227d 2c0a 2020  "time.year"},.  
+000473f0: 2020 2020 2020 2e2e 2e20 2020 2020 7465        ...     te
+00047400: 6d70 6c61 7465 3d64 732c 0a20 2020 2020  mplate=ds,.     
+00047410: 2020 202e 2e2e 2029 0a20 2020 2020 2020     ... ).       
+00047420: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
+00047430: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
+00047440: 696f 6e73 3a20 2028 7469 6d65 3a20 3234  ions:  (time: 24
+00047450: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
+00047460: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
+00047470: 202a 2074 696d 6520 2020 2020 2874 696d   * time     (tim
+00047480: 6529 206f 626a 6563 7420 3139 3930 2d30  e) object 1990-0
+00047490: 312d 3331 2030 303a 3030 3a30 3020 2e2e  1-31 00:00:00 ..
+000474a0: 2e20 3139 3931 2d31 322d 3331 2030 303a  . 1991-12-31 00:
+000474b0: 3030 3a30 300a 2020 2020 2020 2020 2020  00:00.          
+000474c0: 2020 6d6f 6e74 6820 2020 2028 7469 6d65    month    (time
+000474d0: 2920 696e 7436 3420 6461 736b 2e61 7272  ) int64 dask.arr
+000474e0: 6179 3c63 6875 6e6b 7369 7a65 3d28 3234  ay<chunksize=(24
+000474f0: 2c29 2c20 6d65 7461 3d6e 702e 6e64 6172  ,), meta=np.ndar
+00047500: 7261 793e 0a20 2020 2020 2020 2044 6174  ray>.        Dat
+00047510: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
+00047520: 2020 2020 2020 2020 2061 2020 2020 2020           a      
+00047530: 2020 2874 696d 6529 2066 6c6f 6174 3634    (time) float64
+00047540: 2064 6173 6b2e 6172 7261 793c 6368 756e   dask.array<chun
+00047550: 6b73 697a 653d 2832 342c 292c 206d 6574  ksize=(24,), met
+00047560: 613d 6e70 2e6e 6461 7272 6179 3e0a 2020  a=np.ndarray>.  
+00047570: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00047580: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
+00047590: 7265 2e70 6172 616c 6c65 6c20 696d 706f  re.parallel impo
+000475a0: 7274 206d 6170 5f62 6c6f 636b 730a 0a20  rt map_blocks.. 
+000475b0: 2020 2020 2020 2072 6574 7572 6e20 6d61         return ma
+000475c0: 705f 626c 6f63 6b73 2866 756e 632c 2073  p_blocks(func, s
+000475d0: 656c 662c 2061 7267 732c 206b 7761 7267  elf, args, kwarg
+000475e0: 732c 2074 656d 706c 6174 6529 0a0a 2020  s, template)..  
+000475f0: 2020 6465 6620 706f 6c79 6669 7428 0a20    def polyfit(. 
+00047600: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
+00047610: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
+00047620: 6469 6d3a 2048 6173 6861 626c 652c 0a20  dim: Hashable,. 
+00047630: 2020 2020 2020 2064 6567 3a20 696e 742c         deg: int,
+00047640: 0a20 2020 2020 2020 2073 6b69 706e 613a  .        skipna:
+00047650: 2062 6f6f 6c20 7c20 4e6f 6e65 203d 204e   bool | None = N
+00047660: 6f6e 652c 0a20 2020 2020 2020 2072 636f  one,.        rco
+00047670: 6e64 3a20 666c 6f61 7420 7c20 4e6f 6e65  nd: float | None
+00047680: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00047690: 2077 3a20 4861 7368 6162 6c65 207c 2041   w: Hashable | A
+000476a0: 6e79 203d 204e 6f6e 652c 0a20 2020 2020  ny = None,.     
+000476b0: 2020 2066 756c 6c3a 2062 6f6f 6c20 3d20     full: bool = 
+000476c0: 4661 6c73 652c 0a20 2020 2020 2020 2063  False,.        c
+000476d0: 6f76 3a20 626f 6f6c 207c 204c 6974 6572  ov: bool | Liter
+000476e0: 616c 5b22 756e 7363 616c 6564 225d 203d  al["unscaled"] =
+000476f0: 2046 616c 7365 2c0a 2020 2020 2920 2d3e   False,.    ) ->
+00047700: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
+00047710: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00047720: 4c65 6173 7420 7371 7561 7265 7320 706f  Least squares po
+00047730: 6c79 6e6f 6d69 616c 2066 6974 2e0a 0a20  lynomial fit... 
+00047740: 2020 2020 2020 2054 6869 7320 7265 706c         This repl
+00047750: 6963 6174 6573 2074 6865 2062 6568 6176  icates the behav
+00047760: 696f 7572 206f 6620 606e 756d 7079 2e70  iour of `numpy.p
+00047770: 6f6c 7966 6974 6020 6275 7420 6469 6666  olyfit` but diff
+00047780: 6572 7320 6279 2073 6b69 7070 696e 670a  ers by skipping.
+00047790: 2020 2020 2020 2020 696e 7661 6c69 6420          invalid 
+000477a0: 7661 6c75 6573 2077 6865 6e20 6073 6b69  values when `ski
+000477b0: 706e 6120 3d20 5472 7565 602e 0a0a 2020  pna = True`...  
+000477c0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+000477d0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000477e0: 2d2d 2d0a 2020 2020 2020 2020 6469 6d20  ---.        dim 
+000477f0: 3a20 6861 7368 6162 6c65 0a20 2020 2020  : hashable.     
+00047800: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
+00047810: 6520 616c 6f6e 6720 7768 6963 6820 746f  e along which to
+00047820: 2066 6974 2074 6865 2070 6f6c 796e 6f6d   fit the polynom
+00047830: 6961 6c73 2e0a 2020 2020 2020 2020 6465  ials..        de
+00047840: 6720 3a20 696e 740a 2020 2020 2020 2020  g : int.        
+00047850: 2020 2020 4465 6772 6565 206f 6620 7468      Degree of th
+00047860: 6520 6669 7474 696e 6720 706f 6c79 6e6f  e fitting polyno
+00047870: 6d69 616c 2e0a 2020 2020 2020 2020 736b  mial..        sk
+00047880: 6970 6e61 203a 2062 6f6f 6c20 6f72 204e  ipna : bool or N
+00047890: 6f6e 652c 206f 7074 696f 6e61 6c0a 2020  one, optional.  
+000478a0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+000478b0: 652c 2072 656d 6f76 6573 2061 6c6c 2069  e, removes all i
+000478c0: 6e76 616c 6964 2076 616c 7565 7320 6265  nvalid values be
+000478d0: 666f 7265 2066 6974 7469 6e67 2065 6163  fore fitting eac
+000478e0: 6820 3144 2073 6c69 6365 7320 6f66 2074  h 1D slices of t
+000478f0: 6865 2061 7272 6179 2e0a 2020 2020 2020  he array..      
+00047900: 2020 2020 2020 4465 6661 756c 7420 6973        Default is
+00047910: 2054 7275 6520 6966 2064 6174 6120 6973   True if data is
+00047920: 2073 746f 7265 6420 696e 2061 2064 6173   stored in a das
+00047930: 6b2e 6172 7261 7920 6f72 2069 6620 7468  k.array or if th
+00047940: 6572 6520 6973 2061 6e79 0a20 2020 2020  ere is any.     
+00047950: 2020 2020 2020 2069 6e76 616c 6964 2076         invalid v
+00047960: 616c 7565 732c 2046 616c 7365 206f 7468  alues, False oth
+00047970: 6572 7769 7365 2e0a 2020 2020 2020 2020  erwise..        
+00047980: 7263 6f6e 6420 3a20 666c 6f61 7420 6f72  rcond : float or
+00047990: 204e 6f6e 652c 206f 7074 696f 6e61 6c0a   None, optional.
+000479a0: 2020 2020 2020 2020 2020 2020 5265 6c61              Rela
+000479b0: 7469 7665 2063 6f6e 6469 7469 6f6e 206e  tive condition n
+000479c0: 756d 6265 7220 746f 2074 6865 2066 6974  umber to the fit
+000479d0: 2e0a 2020 2020 2020 2020 7720 3a20 6861  ..        w : ha
+000479e0: 7368 6162 6c65 206f 7220 416e 792c 206f  shable or Any, o
+000479f0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00047a00: 2020 2020 5765 6967 6874 7320 746f 2061      Weights to a
+00047a10: 7070 6c79 2074 6f20 7468 6520 792d 636f  pply to the y-co
+00047a20: 6f72 6469 6e61 7465 206f 6620 7468 6520  ordinate of the 
+00047a30: 7361 6d70 6c65 2070 6f69 6e74 732e 0a20  sample points.. 
+00047a40: 2020 2020 2020 2020 2020 2043 616e 2062             Can b
+00047a50: 6520 616e 2061 7272 6179 2d6c 696b 6520  e an array-like 
+00047a60: 6f62 6a65 6374 206f 7220 7468 6520 6e61  object or the na
+00047a70: 6d65 206f 6620 6120 636f 6f72 6469 6e61  me of a coordina
+00047a80: 7465 2069 6e20 7468 6520 6461 7461 7365  te in the datase
+00047a90: 742e 0a20 2020 2020 2020 2066 756c 6c20  t..        full 
+00047aa0: 3a20 626f 6f6c 2c20 6465 6661 756c 743a  : bool, default:
+00047ab0: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+00047ac0: 2020 2057 6865 7468 6572 2074 6f20 7265     Whether to re
+00047ad0: 7475 726e 2074 6865 2072 6573 6964 7561  turn the residua
+00047ae0: 6c73 2c20 6d61 7472 6978 2072 616e 6b20  ls, matrix rank 
+00047af0: 616e 6420 7369 6e67 756c 6172 2076 616c  and singular val
+00047b00: 7565 7320 696e 2061 6464 6974 696f 6e0a  ues in addition.
+00047b10: 2020 2020 2020 2020 2020 2020 746f 2074              to t
+00047b20: 6865 2063 6f65 6666 6963 6965 6e74 732e  he coefficients.
+00047b30: 0a20 2020 2020 2020 2063 6f76 203a 2062  .        cov : b
+00047b40: 6f6f 6c20 6f72 2022 756e 7363 616c 6564  ool or "unscaled
+00047b50: 222c 2064 6566 6175 6c74 3a20 4661 6c73  ", default: Fals
+00047b60: 650a 2020 2020 2020 2020 2020 2020 5768  e.            Wh
+00047b70: 6574 6865 7220 746f 2072 6574 7572 6e20  ether to return 
+00047b80: 746f 2074 6865 2063 6f76 6172 6961 6e63  to the covarianc
+00047b90: 6520 6d61 7472 6978 2069 6e20 6164 6469  e matrix in addi
+00047ba0: 7469 6f6e 2074 6f20 7468 6520 636f 6566  tion to the coef
+00047bb0: 6669 6369 656e 7473 2e0a 2020 2020 2020  ficients..      
+00047bc0: 2020 2020 2020 5468 6520 6d61 7472 6978        The matrix
+00047bd0: 2069 7320 6e6f 7420 7363 616c 6564 2069   is not scaled i
+00047be0: 6620 6063 6f76 3d27 756e 7363 616c 6564  f `cov='unscaled
+00047bf0: 2760 2e0a 0a20 2020 2020 2020 2052 6574  '`...        Ret
+00047c00: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+00047c10: 2d2d 2d2d 0a20 2020 2020 2020 2070 6f6c  ----.        pol
+00047c20: 7966 6974 5f72 6573 756c 7473 203a 2044  yfit_results : D
+00047c30: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
+00047c40: 2020 2041 2073 696e 676c 6520 6461 7461     A single data
+00047c50: 7365 7420 7768 6963 6820 636f 6e74 6169  set which contai
+00047c60: 6e73 2028 666f 7220 6561 6368 2022 7661  ns (for each "va
+00047c70: 7222 2069 6e20 7468 6520 696e 7075 7420  r" in the input 
+00047c80: 6461 7461 7365 7429 3a0a 0a20 2020 2020  dataset):..     
+00047c90: 2020 2020 2020 205b 7661 725d 5f70 6f6c         [var]_pol
+00047ca0: 7966 6974 5f63 6f65 6666 6963 6965 6e74  yfit_coefficient
+00047cb0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00047cc0: 2020 5468 6520 636f 6566 6669 6369 656e    The coefficien
+00047cd0: 7473 206f 6620 7468 6520 6265 7374 2066  ts of the best f
+00047ce0: 6974 2066 6f72 2065 6163 6820 7661 7269  it for each vari
+00047cf0: 6162 6c65 2069 6e20 7468 6973 2064 6174  able in this dat
+00047d00: 6173 6574 2e0a 2020 2020 2020 2020 2020  aset..          
+00047d10: 2020 5b76 6172 5d5f 706f 6c79 6669 745f    [var]_polyfit_
+00047d20: 7265 7369 6475 616c 730a 2020 2020 2020  residuals.      
+00047d30: 2020 2020 2020 2020 2020 5468 6520 7265            The re
+00047d40: 7369 6475 616c 7320 6f66 2074 6865 206c  siduals of the l
+00047d50: 6561 7374 2d73 7175 6172 6520 636f 6d70  east-square comp
+00047d60: 7574 6174 696f 6e20 666f 7220 6561 6368  utation for each
+00047d70: 2076 6172 6961 626c 6520 286f 6e6c 7920   variable (only 
+00047d80: 696e 636c 7564 6564 2069 6620 6066 756c  included if `ful
+00047d90: 6c3d 5472 7565 6029 0a20 2020 2020 2020  l=True`).       
+00047da0: 2020 2020 2020 2020 2057 6865 6e20 7468           When th
+00047db0: 6520 6d61 7472 6978 2072 616e 6b20 6973  e matrix rank is
+00047dc0: 2064 6566 6963 6965 6e74 2c20 6e70 2e6e   deficient, np.n
+00047dd0: 616e 2069 7320 7265 7475 726e 6564 2e0a  an is returned..
+00047de0: 2020 2020 2020 2020 2020 2020 5b64 696d              [dim
+00047df0: 5d5f 6d61 7472 6978 5f72 616e 6b0a 2020  ]_matrix_rank.  
+00047e00: 2020 2020 2020 2020 2020 2020 2020 5468                Th
+00047e10: 6520 6566 6665 6374 6976 6520 7261 6e6b  e effective rank
+00047e20: 206f 6620 7468 6520 7363 616c 6564 2056   of the scaled V
+00047e30: 616e 6465 726d 6f6e 6465 2063 6f65 6666  andermonde coeff
+00047e40: 6963 6965 6e74 206d 6174 7269 7820 286f  icient matrix (o
+00047e50: 6e6c 7920 696e 636c 7564 6564 2069 6620  nly included if 
+00047e60: 6066 756c 6c3d 5472 7565 6029 0a20 2020  `full=True`).   
+00047e70: 2020 2020 2020 2020 2020 2020 2054 6865               The
+00047e80: 2072 616e 6b20 6973 2063 6f6d 7075 7465   rank is compute
+00047e90: 6420 6967 6e6f 7269 6e67 2074 6865 204e  d ignoring the N
+00047ea0: 614e 2076 616c 7565 7320 7468 6174 206d  aN values that m
+00047eb0: 6967 6874 2062 6520 736b 6970 7065 642e  ight be skipped.
+00047ec0: 0a20 2020 2020 2020 2020 2020 205b 6469  .            [di
+00047ed0: 6d5d 5f73 696e 6775 6c61 725f 7661 6c75  m]_singular_valu
+00047ee0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00047ef0: 2020 2054 6865 2073 696e 6775 6c61 7220     The singular 
+00047f00: 7661 6c75 6573 206f 6620 7468 6520 7363  values of the sc
+00047f10: 616c 6564 2056 616e 6465 726d 6f6e 6465  aled Vandermonde
+00047f20: 2063 6f65 6666 6963 6965 6e74 206d 6174   coefficient mat
+00047f30: 7269 7820 286f 6e6c 7920 696e 636c 7564  rix (only includ
+00047f40: 6564 2069 6620 6066 756c 6c3d 5472 7565  ed if `full=True
+00047f50: 6029 0a20 2020 2020 2020 2020 2020 205b  `).            [
+00047f60: 7661 725d 5f70 6f6c 7966 6974 5f63 6f76  var]_polyfit_cov
+00047f70: 6172 6961 6e63 650a 2020 2020 2020 2020  ariance.        
+00047f80: 2020 2020 2020 2020 5468 6520 636f 7661          The cova
+00047f90: 7269 616e 6365 206d 6174 7269 7820 6f66  riance matrix of
+00047fa0: 2074 6865 2070 6f6c 796e 6f6d 6961 6c20   the polynomial 
+00047fb0: 636f 6566 6669 6369 656e 7420 6573 7469  coefficient esti
+00047fc0: 6d61 7465 7320 286f 6e6c 7920 696e 636c  mates (only incl
+00047fd0: 7564 6564 2069 6620 6066 756c 6c3d 4661  uded if `full=Fa
+00047fe0: 6c73 6560 2061 6e64 2060 636f 763d 5472  lse` and `cov=Tr
+00047ff0: 7565 6029 0a0a 2020 2020 2020 2020 5761  ue`)..        Wa
+00048000: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+00048010: 2d0a 2020 2020 2020 2020 5261 6e6b 5761  -.        RankWa
+00048020: 726e 696e 670a 2020 2020 2020 2020 2020  rning.          
+00048030: 2020 5468 6520 7261 6e6b 206f 6620 7468    The rank of th
+00048040: 6520 636f 6566 6669 6369 656e 7420 6d61  e coefficient ma
+00048050: 7472 6978 2069 6e20 7468 6520 6c65 6173  trix in the leas
+00048060: 742d 7371 7561 7265 7320 6669 7420 6973  t-squares fit is
+00048070: 2064 6566 6963 6965 6e74 2e0a 2020 2020   deficient..    
+00048080: 2020 2020 2020 2020 5468 6520 7761 726e          The warn
+00048090: 696e 6720 6973 206e 6f74 2072 6169 7365  ing is not raise
+000480a0: 6420 7769 7468 2069 6e2d 6d65 6d6f 7279  d with in-memory
+000480b0: 2028 6e6f 7420 6461 736b 2920 6461 7461   (not dask) data
+000480c0: 2061 6e64 2060 6675 6c6c 3d54 7275 6560   and `full=True`
+000480d0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
+000480e0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+000480f0: 2d2d 2d2d 0a20 2020 2020 2020 206e 756d  ----.        num
+00048100: 7079 2e70 6f6c 7966 6974 0a20 2020 2020  py.polyfit.     
+00048110: 2020 206e 756d 7079 2e70 6f6c 7976 616c     numpy.polyval
+00048120: 0a20 2020 2020 2020 2078 6172 7261 792e  .        xarray.
+00048130: 706f 6c79 7661 6c0a 2020 2020 2020 2020  polyval.        
+00048140: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+00048150: 2078 6172 7261 792e 636f 7265 2e64 6174   xarray.core.dat
+00048160: 6161 7272 6179 2069 6d70 6f72 7420 4461  aarray import Da
+00048170: 7461 4172 7261 790a 0a20 2020 2020 2020  taArray..       
+00048180: 2076 6172 6961 626c 6573 203d 207b 7d0a   variables = {}.
+00048190: 2020 2020 2020 2020 736b 6970 6e61 5f64          skipna_d
+000481a0: 6120 3d20 736b 6970 6e61 0a0a 2020 2020  a = skipna..    
+000481b0: 2020 2020 7820 3d20 6765 745f 636c 6561      x = get_clea
+000481c0: 6e5f 696e 7465 7270 5f69 6e64 6578 2873  n_interp_index(s
+000481d0: 656c 662c 2064 696d 2c20 7374 7269 6374  elf, dim, strict
+000481e0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+000481f0: 786e 616d 6520 3d20 6622 7b73 656c 665b  xname = f"{self[
+00048200: 6469 6d5d 2e6e 616d 657d 5f22 0a20 2020  dim].name}_".   
+00048210: 2020 2020 206f 7264 6572 203d 2069 6e74       order = int
+00048220: 2864 6567 2920 2b20 310a 2020 2020 2020  (deg) + 1.      
+00048230: 2020 6c68 7320 3d20 6e70 2e76 616e 6465    lhs = np.vande
+00048240: 7228 782c 206f 7264 6572 290a 0a20 2020  r(x, order)..   
+00048250: 2020 2020 2069 6620 7263 6f6e 6420 6973       if rcond is
+00048260: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00048270: 2020 2072 636f 6e64 203d 2028 0a20 2020     rcond = (.   
+00048280: 2020 2020 2020 2020 2020 2020 2078 2e73               x.s
+00048290: 6861 7065 5b30 5d20 2a20 6e70 2e63 6f72  hape[0] * np.cor
+000482a0: 652e 6669 6e66 6f28 782e 6474 7970 6529  e.finfo(x.dtype)
+000482b0: 2e65 7073 2020 2320 7479 7065 3a20 6967  .eps  # type: ig
+000482c0: 6e6f 7265 5b61 7474 722d 6465 6669 6e65  nore[attr-define
+000482d0: 645d 0a20 2020 2020 2020 2020 2020 2029  d].            )
+000482e0: 0a0a 2020 2020 2020 2020 2320 5765 6967  ..        # Weig
+000482f0: 6874 733a 0a20 2020 2020 2020 2069 6620  hts:.        if 
+00048300: 7720 6973 206e 6f74 204e 6f6e 653a 0a20  w is not None:. 
+00048310: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00048320: 696e 7374 616e 6365 2877 2c20 4861 7368  instance(w, Hash
+00048330: 6162 6c65 293a 0a20 2020 2020 2020 2020  able):.         
+00048340: 2020 2020 2020 2077 203d 2073 656c 662e         w = self.
+00048350: 636f 6f72 6473 5b77 5d0a 2020 2020 2020  coords[w].      
+00048360: 2020 2020 2020 7720 3d20 6e70 2e61 7361        w = np.asa
+00048370: 7272 6179 2877 290a 2020 2020 2020 2020  rray(w).        
+00048380: 2020 2020 6966 2077 2e6e 6469 6d20 213d      if w.ndim !=
+00048390: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+000483a0: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+000483b0: 726f 7228 2245 7870 6563 7465 6420 6120  ror("Expected a 
+000483c0: 312d 6420 6172 7261 7920 666f 7220 7765  1-d array for we
+000483d0: 6967 6874 732e 2229 0a20 2020 2020 2020  ights.").       
+000483e0: 2020 2020 2069 6620 772e 7368 6170 655b       if w.shape[
+000483f0: 305d 2021 3d20 6c68 732e 7368 6170 655b  0] != lhs.shape[
+00048400: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
+00048410: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+00048420: 726f 7228 6622 4578 7065 6374 6564 2077  ror(f"Expected w
+00048430: 2061 6e64 207b 6469 6d7d 2074 6f20 6861   and {dim} to ha
+00048440: 7665 2074 6865 2073 616d 6520 6c65 6e67  ve the same leng
+00048450: 7468 2229 0a20 2020 2020 2020 2020 2020  th").           
+00048460: 206c 6873 202a 3d20 775b 3a2c 206e 702e   lhs *= w[:, np.
+00048470: 6e65 7761 7869 735d 0a0a 2020 2020 2020  newaxis]..      
+00048480: 2020 2320 5363 616c 696e 670a 2020 2020    # Scaling.    
+00048490: 2020 2020 7363 616c 6520 3d20 6e70 2e73      scale = np.s
+000484a0: 7172 7428 286c 6873 202a 206c 6873 292e  qrt((lhs * lhs).
+000484b0: 7375 6d28 6178 6973 3d30 2929 0a20 2020  sum(axis=0)).   
+000484c0: 2020 2020 206c 6873 202f 3d20 7363 616c       lhs /= scal
+000484d0: 650a 0a20 2020 2020 2020 2064 6567 7265  e..        degre
+000484e0: 655f 6469 6d20 3d20 7574 696c 732e 6765  e_dim = utils.ge
+000484f0: 745f 7465 6d70 5f64 696d 6e61 6d65 2873  t_temp_dimname(s
+00048500: 656c 662e 6469 6d73 2c20 2264 6567 7265  elf.dims, "degre
+00048510: 6522 290a 0a20 2020 2020 2020 2072 616e  e")..        ran
+00048520: 6b20 3d20 6e70 2e6c 696e 616c 672e 6d61  k = np.linalg.ma
+00048530: 7472 6978 5f72 616e 6b28 6c68 7329 0a0a  trix_rank(lhs)..
+00048540: 2020 2020 2020 2020 6966 2066 756c 6c3a          if full:
+00048550: 0a20 2020 2020 2020 2020 2020 2072 616e  .            ran
+00048560: 6b20 3d20 4461 7461 4172 7261 7928 7261  k = DataArray(ra
+00048570: 6e6b 2c20 6e61 6d65 3d78 6e61 6d65 202b  nk, name=xname +
+00048580: 2022 6d61 7472 6978 5f72 616e 6b22 290a   "matrix_rank").
+00048590: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+000485a0: 6162 6c65 735b 7261 6e6b 2e6e 616d 655d  ables[rank.name]
+000485b0: 203d 2072 616e 6b0a 2020 2020 2020 2020   = rank.        
+000485c0: 2020 2020 5f73 696e 6720 3d20 6e70 2e6c      _sing = np.l
+000485d0: 696e 616c 672e 7376 6428 6c68 732c 2063  inalg.svd(lhs, c
+000485e0: 6f6d 7075 7465 5f75 763d 4661 6c73 6529  ompute_uv=False)
+000485f0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
+00048600: 6720 3d20 4461 7461 4172 7261 7928 0a20  g = DataArray(. 
+00048610: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00048620: 7369 6e67 2c0a 2020 2020 2020 2020 2020  sing,.          
+00048630: 2020 2020 2020 6469 6d73 3d28 6465 6772        dims=(degr
+00048640: 6565 5f64 696d 2c29 2c0a 2020 2020 2020  ee_dim,),.      
+00048650: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
+00048660: 3d7b 6465 6772 6565 5f64 696d 3a20 6e70  ={degree_dim: np
+00048670: 2e61 7261 6e67 6528 7261 6e6b 202d 2031  .arange(rank - 1
+00048680: 2c20 2d31 2c20 2d31 297d 2c0a 2020 2020  , -1, -1)},.    
+00048690: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+000486a0: 3d78 6e61 6d65 202b 2022 7369 6e67 756c  =xname + "singul
+000486b0: 6172 5f76 616c 7565 7322 2c0a 2020 2020  ar_values",.    
+000486c0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000486d0: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
+000486e0: 7369 6e67 2e6e 616d 655d 203d 2073 696e  sing.name] = sin
+000486f0: 670a 0a20 2020 2020 2020 2066 6f72 206e  g..        for n
+00048700: 616d 652c 2064 6120 696e 2073 656c 662e  ame, da in self.
+00048710: 6461 7461 5f76 6172 732e 6974 656d 7328  data_vars.items(
+00048720: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+00048730: 6620 6469 6d20 6e6f 7420 696e 2064 612e  f dim not in da.
+00048740: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
+00048750: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+00048760: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00048770: 735f 6475 636b 5f64 6173 6b5f 6172 7261  s_duck_dask_arra
+00048780: 7928 6461 2e64 6174 6129 2061 6e64 2028  y(da.data) and (
+00048790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000487a0: 2072 616e 6b20 213d 206f 7264 6572 206f   rank != order o
+000487b0: 7220 6675 6c6c 206f 7220 736b 6970 6e61  r full or skipna
+000487c0: 2069 7320 4e6f 6e65 0a20 2020 2020 2020   is None.       
+000487d0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+000487e0: 2020 2020 2020 2020 2320 4375 7272 656e          # Curren
+000487f0: 7420 616c 676f 7269 7468 6d20 7769 7468  t algorithm with
+00048800: 2064 6173 6b20 616e 6420 736b 6970 6e61   dask and skipna
+00048810: 3d46 616c 7365 206e 6569 7468 6572 2073  =False neither s
+00048820: 7570 706f 7274 730a 2020 2020 2020 2020  upports.        
+00048830: 2020 2020 2020 2020 2320 6465 6669 6369          # defici
+00048840: 656e 7420 7261 6e6b 7320 6e6f 7220 646f  ent ranks nor do
+00048850: 6573 2069 7420 6f75 7470 7574 2074 6865  es it output the
+00048860: 2022 6675 6c6c 2220 696e 666f 2028 6973   "full" info (is
+00048870: 7375 6520 6461 736b 2f64 6173 6b23 3635  sue dask/dask#65
+00048880: 3136 290a 2020 2020 2020 2020 2020 2020  16).            
+00048890: 2020 2020 736b 6970 6e61 5f64 6120 3d20      skipna_da = 
+000488a0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+000488b0: 2065 6c69 6620 736b 6970 6e61 2069 7320   elif skipna is 
+000488c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000488d0: 2020 2020 2020 736b 6970 6e61 5f64 6120        skipna_da 
+000488e0: 3d20 626f 6f6c 286e 702e 616e 7928 6461  = bool(np.any(da
+000488f0: 2e69 736e 756c 6c28 2929 290a 0a20 2020  .isnull()))..   
+00048900: 2020 2020 2020 2020 2064 696d 735f 746f           dims_to
+00048910: 5f73 7461 636b 203d 205b 6469 6d6e 616d  _stack = [dimnam
+00048920: 6520 666f 7220 6469 6d6e 616d 6520 696e  e for dimname in
+00048930: 2064 612e 6469 6d73 2069 6620 6469 6d6e   da.dims if dimn
+00048940: 616d 6520 213d 2064 696d 5d0a 2020 2020  ame != dim].    
+00048950: 2020 2020 2020 2020 7374 6163 6b65 645f          stacked_
+00048960: 636f 6f72 6473 3a20 6469 6374 5b48 6173  coords: dict[Has
+00048970: 6861 626c 652c 2044 6174 6141 7272 6179  hable, DataArray
+00048980: 5d20 3d20 7b7d 0a20 2020 2020 2020 2020  ] = {}.         
+00048990: 2020 2069 6620 6469 6d73 5f74 6f5f 7374     if dims_to_st
+000489a0: 6163 6b3a 0a20 2020 2020 2020 2020 2020  ack:.           
+000489b0: 2020 2020 2073 7461 636b 6564 5f64 696d       stacked_dim
+000489c0: 203d 2075 7469 6c73 2e67 6574 5f74 656d   = utils.get_tem
+000489d0: 705f 6469 6d6e 616d 6528 6469 6d73 5f74  p_dimname(dims_t
+000489e0: 6f5f 7374 6163 6b2c 2022 7374 6163 6b65  o_stack, "stacke
+000489f0: 6422 290a 2020 2020 2020 2020 2020 2020  d").            
+00048a00: 2020 2020 7268 7320 3d20 6461 2e74 7261      rhs = da.tra
+00048a10: 6e73 706f 7365 2864 696d 2c20 2a64 696d  nspose(dim, *dim
+00048a20: 735f 746f 5f73 7461 636b 292e 7374 6163  s_to_stack).stac
+00048a30: 6b28 0a20 2020 2020 2020 2020 2020 2020  k(.             
+00048a40: 2020 2020 2020 207b 7374 6163 6b65 645f         {stacked_
+00048a50: 6469 6d3a 2064 696d 735f 746f 5f73 7461  dim: dims_to_sta
+00048a60: 636b 7d0a 2020 2020 2020 2020 2020 2020  ck}.            
+00048a70: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00048a80: 2020 2020 2020 7374 6163 6b65 645f 636f        stacked_co
+00048a90: 6f72 6473 203d 207b 7374 6163 6b65 645f  ords = {stacked_
+00048aa0: 6469 6d3a 2072 6873 5b73 7461 636b 6564  dim: rhs[stacked
+00048ab0: 5f64 696d 5d7d 0a20 2020 2020 2020 2020  _dim]}.         
+00048ac0: 2020 2020 2020 2073 6361 6c65 5f64 6120         scale_da 
+00048ad0: 3d20 7363 616c 655b 3a2c 206e 702e 6e65  = scale[:, np.ne
+00048ae0: 7761 7869 735d 0a20 2020 2020 2020 2020  waxis].         
+00048af0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00048b00: 2020 2020 2020 2020 2072 6873 203d 2064           rhs = d
+00048b10: 610a 2020 2020 2020 2020 2020 2020 2020  a.              
+00048b20: 2020 7363 616c 655f 6461 203d 2073 6361    scale_da = sca
+00048b30: 6c65 0a0a 2020 2020 2020 2020 2020 2020  le..            
+00048b40: 6966 2077 2069 7320 6e6f 7420 4e6f 6e65  if w is not None
+00048b50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00048b60: 2020 7268 7320 2a3d 2077 5b3a 2c20 6e70    rhs *= w[:, np
+00048b70: 2e6e 6577 6178 6973 5d0a 0a20 2020 2020  .newaxis]..     
+00048b80: 2020 2020 2020 2077 6974 6820 7761 726e         with warn
+00048b90: 696e 6773 2e63 6174 6368 5f77 6172 6e69  ings.catch_warni
+00048ba0: 6e67 7328 293a 0a20 2020 2020 2020 2020  ngs():.         
+00048bb0: 2020 2020 2020 2069 6620 6675 6c6c 3a20         if full: 
+00048bc0: 2023 2043 6f70 7920 6e70 2e70 6f6c 7966   # Copy np.polyf
+00048bd0: 6974 2062 6568 6176 696f 720a 2020 2020  it behavior.    
+00048be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048bf0: 7761 726e 696e 6773 2e73 696d 706c 6566  warnings.simplef
+00048c00: 696c 7465 7228 2269 676e 6f72 6522 2c20  ilter("ignore", 
+00048c10: 6e70 2e52 616e 6b57 6172 6e69 6e67 290a  np.RankWarning).
+00048c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048c30: 656c 7365 3a20 2023 2052 6169 7365 206f  else:  # Raise o
+00048c40: 6e6c 7920 6f6e 6365 2070 6572 2076 6172  nly once per var
+00048c50: 6961 626c 650a 2020 2020 2020 2020 2020  iable.          
+00048c60: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00048c70: 6773 2e73 696d 706c 6566 696c 7465 7228  gs.simplefilter(
+00048c80: 226f 6e63 6522 2c20 6e70 2e52 616e 6b57  "once", np.RankW
+00048c90: 6172 6e69 6e67 290a 0a20 2020 2020 2020  arning)..       
+00048ca0: 2020 2020 2020 2020 2063 6f65 6666 732c           coeffs,
+00048cb0: 2072 6573 6964 7561 6c73 203d 2064 7563   residuals = duc
+00048cc0: 6b5f 6172 7261 795f 6f70 732e 6c65 6173  k_array_ops.leas
+00048cd0: 745f 7371 7561 7265 7328 0a20 2020 2020  t_squares(.     
+00048ce0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00048cf0: 6873 2c20 7268 732e 6461 7461 2c20 7263  hs, rhs.data, rc
+00048d00: 6f6e 643d 7263 6f6e 642c 2073 6b69 706e  ond=rcond, skipn
+00048d10: 613d 736b 6970 6e61 5f64 610a 2020 2020  a=skipna_da.    
+00048d20: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00048d30: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00048d40: 696e 7374 616e 6365 286e 616d 652c 2073  instance(name, s
+00048d50: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
+00048d60: 2020 2020 206e 616d 6520 3d20 6622 7b6e       name = f"{n
+00048d70: 616d 657d 5f22 0a20 2020 2020 2020 2020  ame}_".         
+00048d80: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00048d90: 2020 2020 2020 2020 2023 2054 6875 7320           # Thus 
+00048da0: 6120 5265 7072 4f62 6a65 6374 203d 3e20  a ReprObject => 
+00048db0: 706f 6c79 6669 7420 7761 7320 6361 6c6c  polyfit was call
+00048dc0: 6564 206f 6e20 6120 4461 7461 4172 7261  ed on a DataArra
+00048dd0: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+00048de0: 2020 6e61 6d65 203d 2022 220a 0a20 2020    name = ""..   
+00048df0: 2020 2020 2020 2020 2063 6f65 6666 7320           coeffs 
+00048e00: 3d20 4461 7461 4172 7261 7928 0a20 2020  = DataArray(.   
+00048e10: 2020 2020 2020 2020 2020 2020 2063 6f65               coe
+00048e20: 6666 7320 2f20 7363 616c 655f 6461 2c0a  ffs / scale_da,.
+00048e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048e40: 6469 6d73 3d5b 6465 6772 6565 5f64 696d  dims=[degree_dim
+00048e50: 5d20 2b20 6c69 7374 2873 7461 636b 6564  ] + list(stacked
+00048e60: 5f63 6f6f 7264 732e 6b65 7973 2829 292c  _coords.keys()),
+00048e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00048e80: 2063 6f6f 7264 733d 7b64 6567 7265 655f   coords={degree_
+00048e90: 6469 6d3a 206e 702e 6172 616e 6765 286f  dim: np.arange(o
+00048ea0: 7264 6572 295b 3a3a 2d31 5d2c 202a 2a73  rder)[::-1], **s
+00048eb0: 7461 636b 6564 5f63 6f6f 7264 737d 2c0a  tacked_coords},.
+00048ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048ed0: 6e61 6d65 3d6e 616d 6520 2b20 2270 6f6c  name=name + "pol
+00048ee0: 7966 6974 5f63 6f65 6666 6963 6965 6e74  yfit_coefficient
+00048ef0: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
+00048f00: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00048f10: 2064 696d 735f 746f 5f73 7461 636b 3a0a   dims_to_stack:.
+00048f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048f30: 636f 6566 6673 203d 2063 6f65 6666 732e  coeffs = coeffs.
+00048f40: 756e 7374 6163 6b28 7374 6163 6b65 645f  unstack(stacked_
+00048f50: 6469 6d29 0a20 2020 2020 2020 2020 2020  dim).           
+00048f60: 2076 6172 6961 626c 6573 5b63 6f65 6666   variables[coeff
+00048f70: 732e 6e61 6d65 5d20 3d20 636f 6566 6673  s.name] = coeffs
+00048f80: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00048f90: 2066 756c 6c20 6f72 2028 636f 7620 6973   full or (cov is
+00048fa0: 2054 7275 6529 3a0a 2020 2020 2020 2020   True):.        
+00048fb0: 2020 2020 2020 2020 7265 7369 6475 616c          residual
+00048fc0: 7320 3d20 4461 7461 4172 7261 7928 0a20  s = DataArray(. 
+00048fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048fe0: 2020 2072 6573 6964 7561 6c73 2069 6620     residuals if 
+00048ff0: 6469 6d73 5f74 6f5f 7374 6163 6b20 656c  dims_to_stack el
+00049000: 7365 2072 6573 6964 7561 6c73 2e73 7175  se residuals.squ
+00049010: 6565 7a65 2829 2c0a 2020 2020 2020 2020  eeze(),.        
+00049020: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
+00049030: 3d6c 6973 7428 7374 6163 6b65 645f 636f  =list(stacked_co
+00049040: 6f72 6473 2e6b 6579 7328 2929 2c0a 2020  ords.keys()),.  
+00049050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049060: 2020 636f 6f72 6473 3d73 7461 636b 6564    coords=stacked
+00049070: 5f63 6f6f 7264 732c 0a20 2020 2020 2020  _coords,.       
+00049080: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+00049090: 653d 6e61 6d65 202b 2022 706f 6c79 6669  e=name + "polyfi
+000490a0: 745f 7265 7369 6475 616c 7322 2c0a 2020  t_residuals",.  
+000490b0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000490c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000490d0: 6966 2064 696d 735f 746f 5f73 7461 636b  if dims_to_stack
+000490e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000490f0: 2020 2020 2020 7265 7369 6475 616c 7320        residuals 
+00049100: 3d20 7265 7369 6475 616c 732e 756e 7374  = residuals.unst
+00049110: 6163 6b28 7374 6163 6b65 645f 6469 6d29  ack(stacked_dim)
+00049120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049130: 2076 6172 6961 626c 6573 5b72 6573 6964   variables[resid
+00049140: 7561 6c73 2e6e 616d 655d 203d 2072 6573  uals.name] = res
+00049150: 6964 7561 6c73 0a0a 2020 2020 2020 2020  iduals..        
+00049160: 2020 2020 6966 2063 6f76 3a0a 2020 2020      if cov:.    
+00049170: 2020 2020 2020 2020 2020 2020 5662 6173              Vbas
+00049180: 6520 3d20 6e70 2e6c 696e 616c 672e 696e  e = np.linalg.in
+00049190: 7628 6e70 2e64 6f74 286c 6873 2e54 2c20  v(np.dot(lhs.T, 
+000491a0: 6c68 7329 290a 2020 2020 2020 2020 2020  lhs)).          
+000491b0: 2020 2020 2020 5662 6173 6520 2f3d 206e        Vbase /= n
+000491c0: 702e 6f75 7465 7228 7363 616c 652c 2073  p.outer(scale, s
+000491d0: 6361 6c65 290a 2020 2020 2020 2020 2020  cale).          
+000491e0: 2020 2020 2020 6966 2063 6f76 203d 3d20        if cov == 
+000491f0: 2275 6e73 6361 6c65 6422 3a0a 2020 2020  "unscaled":.    
+00049200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049210: 6661 6320 3d20 310a 2020 2020 2020 2020  fac = 1.        
+00049220: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00049230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049240: 2020 6966 2078 2e73 6861 7065 5b30 5d20    if x.shape[0] 
+00049250: 3c3d 206f 7264 6572 3a0a 2020 2020 2020  <= order:.      
+00049260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049270: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00049280: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00049290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000492a0: 2254 6865 206e 756d 6265 7220 6f66 2064  "The number of d
+000492b0: 6174 6120 706f 696e 7473 206d 7573 7420  ata points must 
+000492c0: 6578 6365 6564 206f 7264 6572 2074 6f20  exceed order to 
+000492d0: 7363 616c 6520 7468 6520 636f 7661 7269  scale the covari
+000492e0: 616e 6365 206d 6174 7269 782e 220a 2020  ance matrix.".  
+000492f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049300: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00049310: 2020 2020 2020 2020 2020 2020 6661 6320              fac 
+00049320: 3d20 7265 7369 6475 616c 7320 2f20 2878  = residuals / (x
+00049330: 2e73 6861 7065 5b30 5d20 2d20 6f72 6465  .shape[0] - orde
+00049340: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
+00049350: 2020 2063 6f76 6172 6961 6e63 6520 3d20     covariance = 
+00049360: 4461 7461 4172 7261 7928 5662 6173 652c  DataArray(Vbase,
+00049370: 2064 696d 733d 2822 636f 765f 6922 2c20   dims=("cov_i", 
+00049380: 2263 6f76 5f6a 2229 2920 2a20 6661 630a  "cov_j")) * fac.
+00049390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000493a0: 7661 7269 6162 6c65 735b 6e61 6d65 202b  variables[name +
+000493b0: 2022 706f 6c79 6669 745f 636f 7661 7269   "polyfit_covari
+000493c0: 616e 6365 225d 203d 2063 6f76 6172 6961  ance"] = covaria
+000493d0: 6e63 650a 0a20 2020 2020 2020 2072 6574  nce..        ret
+000493e0: 7572 6e20 7479 7065 2873 656c 6629 2864  urn type(self)(d
+000493f0: 6174 615f 7661 7273 3d76 6172 6961 626c  ata_vars=variabl
+00049400: 6573 2c20 6174 7472 733d 7365 6c66 2e61  es, attrs=self.a
+00049410: 7474 7273 2e63 6f70 7928 2929 0a0a 2020  ttrs.copy())..  
+00049420: 2020 6465 6620 7061 6428 0a20 2020 2020    def pad(.     
+00049430: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+00049440: 6574 2c0a 2020 2020 2020 2020 7061 645f  et,.        pad_
+00049450: 7769 6474 683a 204d 6170 7069 6e67 5b41  width: Mapping[A
+00049460: 6e79 2c20 696e 7420 7c20 7475 706c 655b  ny, int | tuple[
+00049470: 696e 742c 2069 6e74 5d5d 207c 204e 6f6e  int, int]] | Non
+00049480: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00049490: 2020 6d6f 6465 3a20 5061 644d 6f64 654f    mode: PadModeO
+000494a0: 7074 696f 6e73 203d 2022 636f 6e73 7461  ptions = "consta
+000494b0: 6e74 222c 0a20 2020 2020 2020 2073 7461  nt",.        sta
+000494c0: 745f 6c65 6e67 7468 3a20 696e 740a 2020  t_length: int.  
+000494d0: 2020 2020 2020 7c20 7475 706c 655b 696e        | tuple[in
+000494e0: 742c 2069 6e74 5d0a 2020 2020 2020 2020  t, int].        
+000494f0: 7c20 4d61 7070 696e 675b 416e 792c 2074  | Mapping[Any, t
+00049500: 7570 6c65 5b69 6e74 2c20 696e 745d 5d0a  uple[int, int]].
+00049510: 2020 2020 2020 2020 7c20 4e6f 6e65 203d          | None =
+00049520: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
+00049530: 6f6e 7374 616e 745f 7661 6c75 6573 3a20  onstant_values: 
+00049540: 280a 2020 2020 2020 2020 2020 2020 666c  (.            fl
+00049550: 6f61 7420 7c20 7475 706c 655b 666c 6f61  oat | tuple[floa
+00049560: 742c 2066 6c6f 6174 5d20 7c20 4d61 7070  t, float] | Mapp
+00049570: 696e 675b 416e 792c 2074 7570 6c65 5b66  ing[Any, tuple[f
+00049580: 6c6f 6174 2c20 666c 6f61 745d 5d20 7c20  loat, float]] | 
+00049590: 4e6f 6e65 0a20 2020 2020 2020 2029 203d  None.        ) =
+000495a0: 204e 6f6e 652c 0a20 2020 2020 2020 2065   None,.        e
+000495b0: 6e64 5f76 616c 7565 733a 2069 6e74 207c  nd_values: int |
+000495c0: 2074 7570 6c65 5b69 6e74 2c20 696e 745d   tuple[int, int]
+000495d0: 207c 204d 6170 7069 6e67 5b41 6e79 2c20   | Mapping[Any, 
+000495e0: 7475 706c 655b 696e 742c 2069 6e74 5d5d  tuple[int, int]]
+000495f0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00049600: 2020 2020 2020 2020 7265 666c 6563 745f          reflect_
+00049610: 7479 7065 3a20 5061 6452 6566 6c65 6374  type: PadReflect
+00049620: 4f70 7469 6f6e 7320 3d20 4e6f 6e65 2c0a  Options = None,.
+00049630: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
+00049640: 7273 3a20 626f 6f6c 207c 204e 6f6e 6520  rs: bool | None 
+00049650: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00049660: 2a2a 7061 645f 7769 6474 685f 6b77 6172  **pad_width_kwar
+00049670: 6773 3a20 416e 792c 0a20 2020 2029 202d  gs: Any,.    ) -
+00049680: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+00049690: 2020 2020 2022 2222 5061 6420 7468 6973       """Pad this
+000496a0: 2064 6174 6173 6574 2061 6c6f 6e67 206f   dataset along o
+000496b0: 6e65 206f 7220 6d6f 7265 2064 696d 656e  ne or more dimen
+000496c0: 7369 6f6e 732e 0a0a 2020 2020 2020 2020  sions...        
+000496d0: 2e2e 2077 6172 6e69 6e67 3a3a 0a20 2020  .. warning::.   
+000496e0: 2020 2020 2020 2020 2054 6869 7320 6675           This fu
+000496f0: 6e63 7469 6f6e 2069 7320 6578 7065 7269  nction is experi
+00049700: 6d65 6e74 616c 2061 6e64 2069 7473 2062  mental and its b
+00049710: 6568 6176 696f 7572 2069 7320 6c69 6b65  ehaviour is like
+00049720: 6c79 2074 6f20 6368 616e 6765 0a20 2020  ly to change.   
+00049730: 2020 2020 2020 2020 2065 7370 6563 6961           especia
+00049740: 6c6c 7920 7265 6761 7264 696e 6720 7061  lly regarding pa
+00049750: 6464 696e 6720 6f66 2064 696d 656e 7369  dding of dimensi
+00049760: 6f6e 2063 6f6f 7264 696e 6174 6573 2028  on coordinates (
+00049770: 6f72 2049 6e64 6578 5661 7269 6162 6c65  or IndexVariable
+00049780: 7329 2e0a 0a20 2020 2020 2020 2057 6865  s)...        Whe
+00049790: 6e20 7573 696e 6720 6f6e 6520 6f66 2074  n using one of t
+000497a0: 6865 206d 6f64 6573 2028 2265 6467 6522  he modes ("edge"
+000497b0: 2c20 2272 6566 6c65 6374 222c 2022 7379  , "reflect", "sy
+000497c0: 6d6d 6574 7269 6322 2c20 2277 7261 7022  mmetric", "wrap"
+000497d0: 292c 0a20 2020 2020 2020 2063 6f6f 7264  ),.        coord
+000497e0: 696e 6174 6573 2077 696c 6c20 6265 2070  inates will be p
+000497f0: 6164 6465 6420 7769 7468 2074 6865 2073  added with the s
+00049800: 616d 6520 6d6f 6465 2c20 6f74 6865 7277  ame mode, otherw
+00049810: 6973 6520 636f 6f72 6469 6e61 7465 730a  ise coordinates.
+00049820: 2020 2020 2020 2020 6172 6520 7061 6464          are padd
+00049830: 6564 2075 7369 6e67 2074 6865 2022 636f  ed using the "co
+00049840: 6e73 7461 6e74 2220 6d6f 6465 2077 6974  nstant" mode wit
+00049850: 6820 6669 6c6c 5f76 616c 7565 2064 7479  h fill_value dty
+00049860: 7065 732e 4e41 2e0a 0a20 2020 2020 2020  pes.NA...       
+00049870: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00049880: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00049890: 2020 2020 2020 2070 6164 5f77 6964 7468         pad_width
+000498a0: 203a 206d 6170 7069 6e67 206f 6620 6861   : mapping of ha
+000498b0: 7368 6162 6c65 2074 6f20 7475 706c 6520  shable to tuple 
+000498c0: 6f66 2069 6e74 0a20 2020 2020 2020 2020  of int.         
+000498d0: 2020 204d 6170 7069 6e67 2077 6974 6820     Mapping with 
+000498e0: 7468 6520 666f 726d 206f 6620 7b64 696d  the form of {dim
+000498f0: 3a20 2870 6164 5f62 6566 6f72 652c 2070  : (pad_before, p
+00049900: 6164 5f61 6674 6572 297d 0a20 2020 2020  ad_after)}.     
+00049910: 2020 2020 2020 2064 6573 6372 6962 696e         describin
+00049920: 6720 7468 6520 6e75 6d62 6572 206f 6620  g the number of 
+00049930: 7661 6c75 6573 2070 6164 6465 6420 616c  values padded al
+00049940: 6f6e 6720 6561 6368 2064 696d 656e 7369  ong each dimensi
+00049950: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
+00049960: 7b64 696d 3a20 7061 647d 2069 7320 6120  {dim: pad} is a 
+00049970: 7368 6f72 7463 7574 2066 6f72 2070 6164  shortcut for pad
+00049980: 5f62 6566 6f72 6520 3d20 7061 645f 6166  _before = pad_af
+00049990: 7465 7220 3d20 7061 640a 2020 2020 2020  ter = pad.      
+000499a0: 2020 6d6f 6465 203a 207b 2263 6f6e 7374    mode : {"const
+000499b0: 616e 7422 2c20 2265 6467 6522 2c20 226c  ant", "edge", "l
+000499c0: 696e 6561 725f 7261 6d70 222c 2022 6d61  inear_ramp", "ma
+000499d0: 7869 6d75 6d22 2c20 226d 6561 6e22 2c20  ximum", "mean", 
+000499e0: 226d 6564 6961 6e22 2c20 5c0a 2020 2020  "median", \.    
+000499f0: 2020 2020 2020 2020 226d 696e 696d 756d          "minimum
+00049a00: 222c 2022 7265 666c 6563 7422 2c20 2273  ", "reflect", "s
+00049a10: 796d 6d65 7472 6963 222c 2022 7772 6170  ymmetric", "wrap
+00049a20: 227d 2c20 6465 6661 756c 743a 2022 636f  "}, default: "co
+00049a30: 6e73 7461 6e74 220a 2020 2020 2020 2020  nstant".        
+00049a40: 2020 2020 486f 7720 746f 2070 6164 2074      How to pad t
+00049a50: 6865 2044 6174 6141 7272 6179 2028 7461  he DataArray (ta
+00049a60: 6b65 6e20 6672 6f6d 206e 756d 7079 2064  ken from numpy d
+00049a70: 6f63 7329 3a0a 0a20 2020 2020 2020 2020  ocs):..         
+00049a80: 2020 202d 2022 636f 6e73 7461 6e74 223a     - "constant":
+00049a90: 2050 6164 7320 7769 7468 2061 2063 6f6e   Pads with a con
+00049aa0: 7374 616e 7420 7661 6c75 652e 0a20 2020  stant value..   
+00049ab0: 2020 2020 2020 2020 202d 2022 6564 6765           - "edge
+00049ac0: 223a 2050 6164 7320 7769 7468 2074 6865  ": Pads with the
+00049ad0: 2065 6467 6520 7661 6c75 6573 206f 6620   edge values of 
+00049ae0: 6172 7261 792e 0a20 2020 2020 2020 2020  array..         
+00049af0: 2020 202d 2022 6c69 6e65 6172 5f72 616d     - "linear_ram
+00049b00: 7022 3a20 5061 6473 2077 6974 6820 7468  p": Pads with th
+00049b10: 6520 6c69 6e65 6172 2072 616d 7020 6265  e linear ramp be
+00049b20: 7477 6565 6e20 656e 645f 7661 6c75 6520  tween end_value 
+00049b30: 616e 6420 7468 650a 2020 2020 2020 2020  and the.        
+00049b40: 2020 2020 2020 6172 7261 7920 6564 6765        array edge
+00049b50: 2076 616c 7565 2e0a 2020 2020 2020 2020   value..        
+00049b60: 2020 2020 2d20 226d 6178 696d 756d 223a      - "maximum":
+00049b70: 2050 6164 7320 7769 7468 2074 6865 206d   Pads with the m
+00049b80: 6178 696d 756d 2076 616c 7565 206f 6620  aximum value of 
+00049b90: 616c 6c20 6f72 2070 6172 7420 6f66 2074  all or part of t
+00049ba0: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
+00049bb0: 2076 6563 746f 7220 616c 6f6e 6720 6561   vector along ea
+00049bc0: 6368 2061 7869 732e 0a20 2020 2020 2020  ch axis..       
+00049bd0: 2020 2020 202d 2022 6d65 616e 223a 2050       - "mean": P
+00049be0: 6164 7320 7769 7468 2074 6865 206d 6561  ads with the mea
+00049bf0: 6e20 7661 6c75 6520 6f66 2061 6c6c 206f  n value of all o
+00049c00: 7220 7061 7274 206f 6620 7468 650a 2020  r part of the.  
+00049c10: 2020 2020 2020 2020 2020 2020 7665 6374              vect
+00049c20: 6f72 2061 6c6f 6e67 2065 6163 6820 6178  or along each ax
+00049c30: 6973 2e0a 2020 2020 2020 2020 2020 2020  is..            
+00049c40: 2d20 226d 6564 6961 6e22 3a20 5061 6473  - "median": Pads
+00049c50: 2077 6974 6820 7468 6520 6d65 6469 616e   with the median
+00049c60: 2076 616c 7565 206f 6620 616c 6c20 6f72   value of all or
+00049c70: 2070 6172 7420 6f66 2074 6865 0a20 2020   part of the.   
+00049c80: 2020 2020 2020 2020 2020 2076 6563 746f             vecto
+00049c90: 7220 616c 6f6e 6720 6561 6368 2061 7869  r along each axi
+00049ca0: 732e 0a20 2020 2020 2020 2020 2020 202d  s..            -
+00049cb0: 2022 6d69 6e69 6d75 6d22 3a20 5061 6473   "minimum": Pads
+00049cc0: 2077 6974 6820 7468 6520 6d69 6e69 6d75   with the minimu
+00049cd0: 6d20 7661 6c75 6520 6f66 2061 6c6c 206f  m value of all o
+00049ce0: 7220 7061 7274 206f 6620 7468 650a 2020  r part of the.  
+00049cf0: 2020 2020 2020 2020 2020 2020 7665 6374              vect
+00049d00: 6f72 2061 6c6f 6e67 2065 6163 6820 6178  or along each ax
+00049d10: 6973 2e0a 2020 2020 2020 2020 2020 2020  is..            
+00049d20: 2d20 2272 6566 6c65 6374 223a 2050 6164  - "reflect": Pad
+00049d30: 7320 7769 7468 2074 6865 2072 6566 6c65  s with the refle
+00049d40: 6374 696f 6e20 6f66 2074 6865 2076 6563  ction of the vec
+00049d50: 746f 7220 6d69 7272 6f72 6564 206f 6e0a  tor mirrored on.
+00049d60: 2020 2020 2020 2020 2020 2020 2020 7468                th
+00049d70: 6520 6669 7273 7420 616e 6420 6c61 7374  e first and last
+00049d80: 2076 616c 7565 7320 6f66 2074 6865 2076   values of the v
+00049d90: 6563 746f 7220 616c 6f6e 6720 6561 6368  ector along each
+00049da0: 2061 7869 732e 0a20 2020 2020 2020 2020   axis..         
+00049db0: 2020 202d 2022 7379 6d6d 6574 7269 6322     - "symmetric"
+00049dc0: 3a20 5061 6473 2077 6974 6820 7468 6520  : Pads with the 
+00049dd0: 7265 666c 6563 7469 6f6e 206f 6620 7468  reflection of th
+00049de0: 6520 7665 6374 6f72 206d 6972 726f 7265  e vector mirrore
+00049df0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+00049e00: 616c 6f6e 6720 7468 6520 6564 6765 206f  along the edge o
+00049e10: 6620 7468 6520 6172 7261 792e 0a20 2020  f the array..   
+00049e20: 2020 2020 2020 2020 202d 2022 7772 6170           - "wrap
+00049e30: 223a 2050 6164 7320 7769 7468 2074 6865  ": Pads with the
+00049e40: 2077 7261 7020 6f66 2074 6865 2076 6563   wrap of the vec
+00049e50: 746f 7220 616c 6f6e 6720 7468 6520 6178  tor along the ax
+00049e60: 6973 2e0a 2020 2020 2020 2020 2020 2020  is..            
+00049e70: 2020 5468 6520 6669 7273 7420 7661 6c75    The first valu
+00049e80: 6573 2061 7265 2075 7365 6420 746f 2070  es are used to p
+00049e90: 6164 2074 6865 2065 6e64 2061 6e64 2074  ad the end and t
+00049ea0: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
+00049eb0: 2065 6e64 2076 616c 7565 7320 6172 6520   end values are 
+00049ec0: 7573 6564 2074 6f20 7061 6420 7468 6520  used to pad the 
+00049ed0: 6265 6769 6e6e 696e 672e 0a0a 2020 2020  beginning...    
+00049ee0: 2020 2020 7374 6174 5f6c 656e 6774 6820      stat_length 
+00049ef0: 3a20 696e 742c 2074 7570 6c65 206f 7220  : int, tuple or 
+00049f00: 6d61 7070 696e 6720 6f66 2068 6173 6861  mapping of hasha
+00049f10: 626c 6520 746f 2074 7570 6c65 2c20 6465  ble to tuple, de
+00049f20: 6661 756c 743a 204e 6f6e 650a 2020 2020  fault: None.    
+00049f30: 2020 2020 2020 2020 5573 6564 2069 6e20          Used in 
+00049f40: 276d 6178 696d 756d 272c 2027 6d65 616e  'maximum', 'mean
+00049f50: 272c 2027 6d65 6469 616e 272c 2061 6e64  ', 'median', and
+00049f60: 2027 6d69 6e69 6d75 6d27 2e20 204e 756d   'minimum'.  Num
+00049f70: 6265 7220 6f66 0a20 2020 2020 2020 2020  ber of.         
+00049f80: 2020 2076 616c 7565 7320 6174 2065 6467     values at edg
+00049f90: 6520 6f66 2065 6163 6820 6178 6973 2075  e of each axis u
+00049fa0: 7365 6420 746f 2063 616c 6375 6c61 7465  sed to calculate
+00049fb0: 2074 6865 2073 7461 7469 7374 6963 2076   the statistic v
+00049fc0: 616c 7565 2e0a 2020 2020 2020 2020 2020  alue..          
+00049fd0: 2020 7b64 696d 5f31 3a20 2862 6566 6f72    {dim_1: (befor
+00049fe0: 655f 312c 2061 6674 6572 5f31 292c 202e  e_1, after_1), .
+00049ff0: 2e2e 2064 696d 5f4e 3a20 2862 6566 6f72  .. dim_N: (befor
+0004a000: 655f 4e2c 2061 6674 6572 5f4e 297d 2075  e_N, after_N)} u
+0004a010: 6e69 7175 650a 2020 2020 2020 2020 2020  nique.          
+0004a020: 2020 7374 6174 6973 7469 6320 6c65 6e67    statistic leng
+0004a030: 7468 7320 616c 6f6e 6720 6561 6368 2064  ths along each d
+0004a040: 696d 656e 7369 6f6e 2e0a 2020 2020 2020  imension..      
+0004a050: 2020 2020 2020 2828 6265 666f 7265 2c20        ((before, 
+0004a060: 6166 7465 7229 2c29 2079 6965 6c64 7320  after),) yields 
+0004a070: 7361 6d65 2062 6566 6f72 6520 616e 6420  same before and 
+0004a080: 6166 7465 7220 7374 6174 6973 7469 6320  after statistic 
+0004a090: 6c65 6e67 7468 730a 2020 2020 2020 2020  lengths.        
+0004a0a0: 2020 2020 666f 7220 6561 6368 2064 696d      for each dim
+0004a0b0: 656e 7369 6f6e 2e0a 2020 2020 2020 2020  ension..        
+0004a0c0: 2020 2020 2873 7461 745f 6c65 6e67 7468      (stat_length
+0004a0d0: 2c29 206f 7220 696e 7420 6973 2061 2073  ,) or int is a s
+0004a0e0: 686f 7274 6375 7420 666f 7220 6265 666f  hortcut for befo
+0004a0f0: 7265 203d 2061 6674 6572 203d 2073 7461  re = after = sta
+0004a100: 7469 7374 6963 0a20 2020 2020 2020 2020  tistic.         
+0004a110: 2020 206c 656e 6774 6820 666f 7220 616c     length for al
+0004a120: 6c20 6178 6573 2e0a 2020 2020 2020 2020  l axes..        
+0004a130: 2020 2020 4465 6661 756c 7420 6973 2060      Default is `
+0004a140: 604e 6f6e 6560 602c 2074 6f20 7573 6520  `None``, to use 
+0004a150: 7468 6520 656e 7469 7265 2061 7869 732e  the entire axis.
+0004a160: 0a20 2020 2020 2020 2063 6f6e 7374 616e  .        constan
+0004a170: 745f 7661 6c75 6573 203a 2073 6361 6c61  t_values : scala
+0004a180: 722c 2074 7570 6c65 206f 7220 6d61 7070  r, tuple or mapp
+0004a190: 696e 6720 6f66 2068 6173 6861 626c 6520  ing of hashable 
+0004a1a0: 746f 2074 7570 6c65 2c20 6465 6661 756c  to tuple, defaul
+0004a1b0: 743a 2030 0a20 2020 2020 2020 2020 2020  t: 0.           
+0004a1c0: 2055 7365 6420 696e 2027 636f 6e73 7461   Used in 'consta
+0004a1d0: 6e74 272e 2020 5468 6520 7661 6c75 6573  nt'.  The values
+0004a1e0: 2074 6f20 7365 7420 7468 6520 7061 6464   to set the padd
+0004a1f0: 6564 2076 616c 7565 7320 666f 7220 6561  ed values for ea
+0004a200: 6368 0a20 2020 2020 2020 2020 2020 2061  ch.            a
+0004a210: 7869 732e 0a20 2020 2020 2020 2020 2020  xis..           
+0004a220: 2060 607b 6469 6d5f 313a 2028 6265 666f   ``{dim_1: (befo
+0004a230: 7265 5f31 2c20 6166 7465 725f 3129 2c20  re_1, after_1), 
+0004a240: 2e2e 2e20 6469 6d5f 4e3a 2028 6265 666f  ... dim_N: (befo
+0004a250: 7265 5f4e 2c20 6166 7465 725f 4e29 7d60  re_N, after_N)}`
+0004a260: 6020 756e 6971 7565 0a20 2020 2020 2020  ` unique.       
+0004a270: 2020 2020 2070 6164 2063 6f6e 7374 616e       pad constan
+0004a280: 7473 2061 6c6f 6e67 2065 6163 6820 6469  ts along each di
+0004a290: 6d65 6e73 696f 6e2e 0a20 2020 2020 2020  mension..       
+0004a2a0: 2020 2020 2060 6028 2862 6566 6f72 652c       ``((before,
+0004a2b0: 2061 6674 6572 292c 2960 6020 7969 656c   after),)`` yiel
+0004a2c0: 6473 2073 616d 6520 6265 666f 7265 2061  ds same before a
+0004a2d0: 6e64 2061 6674 6572 2063 6f6e 7374 616e  nd after constan
+0004a2e0: 7473 2066 6f72 2065 6163 680a 2020 2020  ts for each.    
+0004a2f0: 2020 2020 2020 2020 6469 6d65 6e73 696f          dimensio
+0004a300: 6e2e 0a20 2020 2020 2020 2020 2020 2060  n..            `
+0004a310: 6028 636f 6e73 7461 6e74 2c29 6060 206f  `(constant,)`` o
+0004a320: 7220 6060 636f 6e73 7461 6e74 6060 2069  r ``constant`` i
+0004a330: 7320 6120 7368 6f72 7463 7574 2066 6f72  s a shortcut for
+0004a340: 2060 6062 6566 6f72 6520 3d20 6166 7465   ``before = afte
+0004a350: 7220 3d20 636f 6e73 7461 6e74 6060 2066  r = constant`` f
+0004a360: 6f72 0a20 2020 2020 2020 2020 2020 2061  or.            a
+0004a370: 6c6c 2064 696d 656e 7369 6f6e 732e 0a20  ll dimensions.. 
+0004a380: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
+0004a390: 6c74 2069 7320 302e 0a20 2020 2020 2020  lt is 0..       
+0004a3a0: 2065 6e64 5f76 616c 7565 7320 3a20 7363   end_values : sc
+0004a3b0: 616c 6172 2c20 7475 706c 6520 6f72 206d  alar, tuple or m
+0004a3c0: 6170 7069 6e67 206f 6620 6861 7368 6162  apping of hashab
+0004a3d0: 6c65 2074 6f20 7475 706c 652c 2064 6566  le to tuple, def
+0004a3e0: 6175 6c74 3a20 300a 2020 2020 2020 2020  ault: 0.        
+0004a3f0: 2020 2020 5573 6564 2069 6e20 276c 696e      Used in 'lin
+0004a400: 6561 725f 7261 6d70 272e 2020 5468 6520  ear_ramp'.  The 
+0004a410: 7661 6c75 6573 2075 7365 6420 666f 7220  values used for 
+0004a420: 7468 6520 656e 6469 6e67 2076 616c 7565  the ending value
+0004a430: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
+0004a440: 2020 2020 6c69 6e65 6172 5f72 616d 7020      linear_ramp 
+0004a450: 616e 6420 7468 6174 2077 696c 6c20 666f  and that will fo
+0004a460: 726d 2074 6865 2065 6467 6520 6f66 2074  rm the edge of t
+0004a470: 6865 2070 6164 6465 6420 6172 7261 792e  he padded array.
+0004a480: 0a20 2020 2020 2020 2020 2020 2060 607b  .            ``{
+0004a490: 6469 6d5f 313a 2028 6265 666f 7265 5f31  dim_1: (before_1
+0004a4a0: 2c20 6166 7465 725f 3129 2c20 2e2e 2e20  , after_1), ... 
+0004a4b0: 6469 6d5f 4e3a 2028 6265 666f 7265 5f4e  dim_N: (before_N
+0004a4c0: 2c20 6166 7465 725f 4e29 7d60 6020 756e  , after_N)}`` un
+0004a4d0: 6971 7565 0a20 2020 2020 2020 2020 2020  ique.           
+0004a4e0: 2065 6e64 2076 616c 7565 7320 616c 6f6e   end values alon
+0004a4f0: 6720 6561 6368 2064 696d 656e 7369 6f6e  g each dimension
+0004a500: 2e0a 2020 2020 2020 2020 2020 2020 6060  ..            ``
+0004a510: 2828 6265 666f 7265 2c20 6166 7465 7229  ((before, after)
+0004a520: 2c29 6060 2079 6965 6c64 7320 7361 6d65  ,)`` yields same
+0004a530: 2062 6566 6f72 6520 616e 6420 6166 7465   before and afte
+0004a540: 7220 656e 6420 7661 6c75 6573 2066 6f72  r end values for
+0004a550: 2065 6163 680a 2020 2020 2020 2020 2020   each.          
+0004a560: 2020 6178 6973 2e0a 2020 2020 2020 2020    axis..        
+0004a570: 2020 2020 6060 2863 6f6e 7374 616e 742c      ``(constant,
+0004a580: 2960 6020 6f72 2060 6063 6f6e 7374 616e  )`` or ``constan
+0004a590: 7460 6020 6973 2061 2073 686f 7274 6375  t`` is a shortcu
+0004a5a0: 7420 666f 7220 6060 6265 666f 7265 203d  t for ``before =
+0004a5b0: 2061 6674 6572 203d 2063 6f6e 7374 616e   after = constan
+0004a5c0: 7460 6020 666f 720a 2020 2020 2020 2020  t`` for.        
+0004a5d0: 2020 2020 616c 6c20 6178 6573 2e0a 2020      all axes..  
+0004a5e0: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
+0004a5f0: 7420 6973 2030 2e0a 2020 2020 2020 2020  t is 0..        
+0004a600: 7265 666c 6563 745f 7479 7065 203a 207b  reflect_type : {
+0004a610: 2265 7665 6e22 2c20 226f 6464 222c 204e  "even", "odd", N
+0004a620: 6f6e 657d 2c20 6f70 7469 6f6e 616c 0a20  one}, optional. 
+0004a630: 2020 2020 2020 2020 2020 2055 7365 6420             Used 
+0004a640: 696e 2022 7265 666c 6563 7422 2c20 616e  in "reflect", an
+0004a650: 6420 2273 796d 6d65 7472 6963 222e 2020  d "symmetric".  
+0004a660: 5468 6520 2265 7665 6e22 2073 7479 6c65  The "even" style
+0004a670: 2069 7320 7468 650a 2020 2020 2020 2020   is the.        
+0004a680: 2020 2020 6465 6661 756c 7420 7769 7468      default with
+0004a690: 2061 6e20 756e 616c 7465 7265 6420 7265   an unaltered re
+0004a6a0: 666c 6563 7469 6f6e 2061 726f 756e 6420  flection around 
+0004a6b0: 7468 6520 6564 6765 2076 616c 7565 2e20  the edge value. 
+0004a6c0: 2046 6f72 0a20 2020 2020 2020 2020 2020   For.           
+0004a6d0: 2074 6865 2022 6f64 6422 2073 7479 6c65   the "odd" style
+0004a6e0: 2c20 7468 6520 6578 7465 6e64 6564 2070  , the extended p
+0004a6f0: 6172 7420 6f66 2074 6865 2061 7272 6179  art of the array
+0004a700: 2069 7320 6372 6561 7465 6420 6279 0a20   is created by. 
+0004a710: 2020 2020 2020 2020 2020 2073 7562 7472             subtr
+0004a720: 6163 7469 6e67 2074 6865 2072 6566 6c65  acting the refle
+0004a730: 6374 6564 2076 616c 7565 7320 6672 6f6d  cted values from
+0004a740: 2074 776f 2074 696d 6573 2074 6865 2065   two times the e
+0004a750: 6467 6520 7661 6c75 652e 0a20 2020 2020  dge value..     
+0004a760: 2020 206b 6565 705f 6174 7472 7320 3a20     keep_attrs : 
+0004a770: 626f 6f6c 206f 7220 4e6f 6e65 2c20 6f70  bool or None, op
+0004a780: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+0004a790: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
+0004a7a0: 6174 7472 6962 7574 6573 2028 6060 6174  attributes (``at
+0004a7b0: 7472 7360 6029 2077 696c 6c20 6265 2063  trs``) will be c
+0004a7c0: 6f70 6965 6420 6672 6f6d 2074 6865 0a20  opied from the. 
+0004a7d0: 2020 2020 2020 2020 2020 206f 7269 6769             origi
+0004a7e0: 6e61 6c20 6f62 6a65 6374 2074 6f20 7468  nal object to th
+0004a7f0: 6520 6e65 7720 6f6e 652e 2049 6620 4661  e new one. If Fa
+0004a800: 6c73 652c 2074 6865 206e 6577 206f 626a  lse, the new obj
+0004a810: 6563 740a 2020 2020 2020 2020 2020 2020  ect.            
+0004a820: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
+0004a830: 2077 6974 686f 7574 2061 7474 7269 6275   without attribu
+0004a840: 7465 732e 0a20 2020 2020 2020 202a 2a70  tes..        **p
+0004a850: 6164 5f77 6964 7468 5f6b 7761 7267 730a  ad_width_kwargs.
+0004a860: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0004a870: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
+0004a880: 7320 666f 726d 206f 6620 6060 7061 645f  s form of ``pad_
+0004a890: 7769 6474 6860 602e 0a20 2020 2020 2020  width``..       
+0004a8a0: 2020 2020 204f 6e65 206f 6620 6060 7061       One of ``pa
+0004a8b0: 645f 7769 6474 6860 6020 6f72 2060 6070  d_width`` or ``p
+0004a8c0: 6164 5f77 6964 7468 5f6b 7761 7267 7360  ad_width_kwargs`
+0004a8d0: 6020 6d75 7374 2062 6520 7072 6f76 6964  ` must be provid
+0004a8e0: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
+0004a8f0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+0004a900: 2d2d 2d2d 0a20 2020 2020 2020 2070 6164  ----.        pad
+0004a910: 6465 6420 3a20 4461 7461 7365 740a 2020  ded : Dataset.  
+0004a920: 2020 2020 2020 2020 2020 4461 7461 7365            Datase
+0004a930: 7420 7769 7468 2074 6865 2070 6164 6465  t with the padde
+0004a940: 6420 636f 6f72 6469 6e61 7465 7320 616e  d coordinates an
+0004a950: 6420 6461 7461 2e0a 0a20 2020 2020 2020  d data...       
+0004a960: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
+0004a970: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+0004a980: 2020 2044 6174 6173 6574 2e73 6869 6674     Dataset.shift
+0004a990: 2c20 4461 7461 7365 742e 726f 6c6c 2c20  , Dataset.roll, 
+0004a9a0: 4461 7461 7365 742e 6266 696c 6c2c 2044  Dataset.bfill, D
+0004a9b0: 6174 6173 6574 2e66 6669 6c6c 2c20 6e75  ataset.ffill, nu
+0004a9c0: 6d70 792e 7061 642c 2064 6173 6b2e 6172  mpy.pad, dask.ar
+0004a9d0: 7261 792e 7061 640a 0a20 2020 2020 2020  ray.pad..       
+0004a9e0: 204e 6f74 6573 0a20 2020 2020 2020 202d   Notes.        -
+0004a9f0: 2d2d 2d2d 0a20 2020 2020 2020 2042 7920  ----.        By 
+0004aa00: 6465 6661 756c 7420 7768 656e 2060 606d  default when ``m
+0004aa10: 6f64 653d 2263 6f6e 7374 616e 7422 6060  ode="constant"``
+0004aa20: 2061 6e64 2060 6063 6f6e 7374 616e 745f   and ``constant_
+0004aa30: 7661 6c75 6573 3d4e 6f6e 6560 602c 2069  values=None``, i
+0004aa40: 6e74 6567 6572 2074 7970 6573 2077 696c  nteger types wil
+0004aa50: 6c20 6265 0a20 2020 2020 2020 2070 726f  l be.        pro
+0004aa60: 6d6f 7465 6420 746f 2060 6066 6c6f 6174  moted to ``float
+0004aa70: 6060 2061 6e64 2070 6164 6465 6420 7769  `` and padded wi
+0004aa80: 7468 2060 606e 702e 6e61 6e60 602e 2054  th ``np.nan``. T
+0004aa90: 6f20 6176 6f69 6420 7479 7065 2070 726f  o avoid type pro
+0004aaa0: 6d6f 7469 6f6e 0a20 2020 2020 2020 2073  motion.        s
+0004aab0: 7065 6369 6679 2060 6063 6f6e 7374 616e  pecify ``constan
+0004aac0: 745f 7661 6c75 6573 3d6e 702e 6e61 6e60  t_values=np.nan`
+0004aad0: 600a 0a20 2020 2020 2020 2050 6164 6469  `..        Paddi
+0004aae0: 6e67 2063 6f6f 7264 696e 6174 6573 2077  ng coordinates w
+0004aaf0: 696c 6c20 6472 6f70 2074 6865 6972 2063  ill drop their c
+0004ab00: 6f72 7265 7370 6f6e 6469 6e67 2069 6e64  orresponding ind
+0004ab10: 6578 2028 6966 2061 6e79 2920 616e 6420  ex (if any) and 
+0004ab20: 7769 6c6c 2072 6573 6574 2064 6566 6175  will reset defau
+0004ab30: 6c74 0a20 2020 2020 2020 2069 6e64 6578  lt.        index
+0004ab40: 6573 2066 6f72 2064 696d 656e 7369 6f6e  es for dimension
+0004ab50: 2063 6f6f 7264 696e 6174 6573 2e0a 0a20   coordinates... 
+0004ab60: 2020 2020 2020 2045 7861 6d70 6c65 730a         Examples.
+0004ab70: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0004ab80: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
+0004ab90: 3d20 7872 2e44 6174 6173 6574 287b 2266  = xr.Dataset({"f
+0004aba0: 6f6f 223a 2028 2278 222c 2072 616e 6765  oo": ("x", range
+0004abb0: 2835 2929 7d29 0a20 2020 2020 2020 203e  (5))}).        >
+0004abc0: 3e3e 2064 732e 7061 6428 783d 2831 2c20  >> ds.pad(x=(1, 
+0004abd0: 3229 290a 2020 2020 2020 2020 3c78 6172  2)).        <xar
+0004abe0: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+0004abf0: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+0004ac00: 2020 2878 3a20 3829 0a20 2020 2020 2020    (x: 8).       
+0004ac10: 2044 696d 656e 7369 6f6e 7320 7769 7468   Dimensions with
+0004ac20: 6f75 7420 636f 6f72 6469 6e61 7465 733a  out coordinates:
+0004ac30: 2078 0a20 2020 2020 2020 2044 6174 6120   x.        Data 
+0004ac40: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+0004ac50: 2020 2020 2020 2066 6f6f 2020 2020 2020         foo      
+0004ac60: 2878 2920 666c 6f61 7436 3420 6e61 6e20  (x) float64 nan 
+0004ac70: 302e 3020 312e 3020 322e 3020 332e 3020  0.0 1.0 2.0 3.0 
+0004ac80: 342e 3020 6e61 6e20 6e61 6e0a 2020 2020  4.0 nan nan.    
+0004ac90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0004aca0: 7061 645f 7769 6474 6820 3d20 6569 7468  pad_width = eith
+0004acb0: 6572 5f64 6963 745f 6f72 5f6b 7761 7267  er_dict_or_kwarg
+0004acc0: 7328 7061 645f 7769 6474 682c 2070 6164  s(pad_width, pad
+0004acd0: 5f77 6964 7468 5f6b 7761 7267 732c 2022  _width_kwargs, "
+0004ace0: 7061 6422 290a 0a20 2020 2020 2020 2069  pad")..        i
+0004acf0: 6620 6d6f 6465 2069 6e20 2822 6564 6765  f mode in ("edge
+0004ad00: 222c 2022 7265 666c 6563 7422 2c20 2273  ", "reflect", "s
+0004ad10: 796d 6d65 7472 6963 222c 2022 7772 6170  ymmetric", "wrap
+0004ad20: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+0004ad30: 636f 6f72 645f 7061 645f 6d6f 6465 203d  coord_pad_mode =
+0004ad40: 206d 6f64 650a 2020 2020 2020 2020 2020   mode.          
+0004ad50: 2020 636f 6f72 645f 7061 645f 6f70 7469    coord_pad_opti
+0004ad60: 6f6e 7320 3d20 7b0a 2020 2020 2020 2020  ons = {.        
+0004ad70: 2020 2020 2020 2020 2273 7461 745f 6c65          "stat_le
+0004ad80: 6e67 7468 223a 2073 7461 745f 6c65 6e67  ngth": stat_leng
+0004ad90: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+0004ada0: 2020 2020 2263 6f6e 7374 616e 745f 7661      "constant_va
+0004adb0: 6c75 6573 223a 2063 6f6e 7374 616e 745f  lues": constant_
+0004adc0: 7661 6c75 6573 2c0a 2020 2020 2020 2020  values,.        
+0004add0: 2020 2020 2020 2020 2265 6e64 5f76 616c          "end_val
+0004ade0: 7565 7322 3a20 656e 645f 7661 6c75 6573  ues": end_values
+0004adf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0004ae00: 2020 2272 6566 6c65 6374 5f74 7970 6522    "reflect_type"
+0004ae10: 3a20 7265 666c 6563 745f 7479 7065 2c0a  : reflect_type,.
+0004ae20: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+0004ae30: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0004ae40: 2020 2020 2020 2020 636f 6f72 645f 7061          coord_pa
+0004ae50: 645f 6d6f 6465 203d 2022 636f 6e73 7461  d_mode = "consta
+0004ae60: 6e74 220a 2020 2020 2020 2020 2020 2020  nt".            
+0004ae70: 636f 6f72 645f 7061 645f 6f70 7469 6f6e  coord_pad_option
+0004ae80: 7320 3d20 7b7d 0a0a 2020 2020 2020 2020  s = {}..        
+0004ae90: 6966 206b 6565 705f 6174 7472 7320 6973  if keep_attrs is
+0004aea0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0004aeb0: 2020 206b 6565 705f 6174 7472 7320 3d20     keep_attrs = 
+0004aec0: 5f67 6574 5f6b 6565 705f 6174 7472 7328  _get_keep_attrs(
+0004aed0: 6465 6661 756c 743d 5472 7565 290a 0a20  default=True).. 
+0004aee0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+0004aef0: 203d 207b 7d0a 0a20 2020 2020 2020 2023   = {}..        #
+0004af00: 206b 6565 7020 696e 6465 7865 7320 7468   keep indexes th
+0004af10: 6174 2077 6f6e 2774 2062 6520 6166 6665  at won't be affe
+0004af20: 6374 6564 2062 7920 7061 6420 616e 6420  cted by pad and 
+0004af30: 6472 6f70 2061 6c6c 206f 7468 6572 2069  drop all other i
+0004af40: 6e64 6578 6573 0a20 2020 2020 2020 2078  ndexes.        x
+0004af50: 696e 6465 7865 7320 3d20 7365 6c66 2e78  indexes = self.x
+0004af60: 696e 6465 7865 730a 2020 2020 2020 2020  indexes.        
+0004af70: 7061 645f 6469 6d73 203d 2073 6574 2870  pad_dims = set(p
+0004af80: 6164 5f77 6964 7468 290a 2020 2020 2020  ad_width).      
+0004af90: 2020 696e 6465 7865 7320 3d20 7b7d 0a20    indexes = {}. 
+0004afa0: 2020 2020 2020 2066 6f72 206b 2c20 6964         for k, id
+0004afb0: 7820 696e 2078 696e 6465 7865 732e 6974  x in xindexes.it
+0004afc0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+0004afd0: 2020 2069 6620 6e6f 7420 7061 645f 6469     if not pad_di
+0004afe0: 6d73 2e69 6e74 6572 7365 6374 696f 6e28  ms.intersection(
+0004aff0: 7869 6e64 6578 6573 2e67 6574 5f61 6c6c  xindexes.get_all
+0004b000: 5f64 696d 7328 6b29 293a 0a20 2020 2020  _dims(k)):.     
+0004b010: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+0004b020: 6573 5b6b 5d20 3d20 6964 780a 0a20 2020  es[k] = idx..   
+0004b030: 2020 2020 2066 6f72 206e 616d 652c 2076       for name, v
+0004b040: 6172 2069 6e20 7365 6c66 2e76 6172 6961  ar in self.varia
+0004b050: 626c 6573 2e69 7465 6d73 2829 3a0a 2020  bles.items():.  
+0004b060: 2020 2020 2020 2020 2020 7661 725f 7061            var_pa
+0004b070: 645f 7769 6474 6820 3d20 7b6b 3a20 7620  d_width = {k: v 
+0004b080: 666f 7220 6b2c 2076 2069 6e20 7061 645f  for k, v in pad_
+0004b090: 7769 6474 682e 6974 656d 7328 2920 6966  width.items() if
+0004b0a0: 206b 2069 6e20 7661 722e 6469 6d73 7d0a   k in var.dims}.
+0004b0b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0004b0c0: 6f74 2076 6172 5f70 6164 5f77 6964 7468  ot var_pad_width
+0004b0d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004b0e0: 2020 7661 7269 6162 6c65 735b 6e61 6d65    variables[name
+0004b0f0: 5d20 3d20 7661 720a 2020 2020 2020 2020  ] = var.        
+0004b100: 2020 2020 656c 6966 206e 616d 6520 696e      elif name in
+0004b110: 2073 656c 662e 6461 7461 5f76 6172 733a   self.data_vars:
+0004b120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b130: 2076 6172 6961 626c 6573 5b6e 616d 655d   variables[name]
+0004b140: 203d 2076 6172 2e70 6164 280a 2020 2020   = var.pad(.    
+0004b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b160: 7061 645f 7769 6474 683d 7661 725f 7061  pad_width=var_pa
+0004b170: 645f 7769 6474 682c 0a20 2020 2020 2020  d_width,.       
+0004b180: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0004b190: 653d 6d6f 6465 2c0a 2020 2020 2020 2020  e=mode,.        
+0004b1a0: 2020 2020 2020 2020 2020 2020 7374 6174              stat
+0004b1b0: 5f6c 656e 6774 683d 7374 6174 5f6c 656e  _length=stat_len
+0004b1c0: 6774 682c 0a20 2020 2020 2020 2020 2020  gth,.           
+0004b1d0: 2020 2020 2020 2020 2063 6f6e 7374 616e           constan
+0004b1e0: 745f 7661 6c75 6573 3d63 6f6e 7374 616e  t_values=constan
+0004b1f0: 745f 7661 6c75 6573 2c0a 2020 2020 2020  t_values,.      
+0004b200: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0004b210: 645f 7661 6c75 6573 3d65 6e64 5f76 616c  d_values=end_val
+0004b220: 7565 732c 0a20 2020 2020 2020 2020 2020  ues,.           
+0004b230: 2020 2020 2020 2020 2072 6566 6c65 6374           reflect
+0004b240: 5f74 7970 653d 7265 666c 6563 745f 7479  _type=reflect_ty
+0004b250: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
+0004b260: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
+0004b270: 7273 3d6b 6565 705f 6174 7472 732c 0a20  rs=keep_attrs,. 
+0004b280: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0004b290: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0004b2a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0004b2b0: 2020 2076 6172 6961 626c 6573 5b6e 616d     variables[nam
+0004b2c0: 655d 203d 2076 6172 2e70 6164 280a 2020  e] = var.pad(.  
 0004b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b2e0: 2069 6e64 6578 203d 2050 616e 6461 7349   index = PandasI
-0004b2f0: 6e64 6578 2e66 726f 6d5f 7661 7269 6162  ndex.from_variab
-0004b300: 6c65 7328 6469 6d5f 7661 722c 206f 7074  les(dim_var, opt
-0004b310: 696f 6e73 3d7b 7d29 0a20 2020 2020 2020  ions={}).       
-0004b320: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-0004b330: 6578 5f76 6172 7320 3d20 696e 6465 782e  ex_vars = index.
-0004b340: 6372 6561 7465 5f76 6172 6961 626c 6573  create_variables
-0004b350: 2864 696d 5f76 6172 290a 2020 2020 2020  (dim_var).      
-0004b360: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0004b370: 6465 7865 735b 6e61 6d65 5d20 3d20 696e  dexes[name] = in
-0004b380: 6465 780a 2020 2020 2020 2020 2020 2020  dex.            
-0004b390: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0004b3a0: 735b 6e61 6d65 5d20 3d20 696e 6465 785f  s[name] = index_
-0004b3b0: 7661 7273 5b6e 616d 655d 0a0a 2020 2020  vars[name]..    
-0004b3c0: 2020 2020 6174 7472 7320 3d20 7365 6c66      attrs = self
-0004b3d0: 2e5f 6174 7472 7320 6966 206b 6565 705f  ._attrs if keep_
-0004b3e0: 6174 7472 7320 656c 7365 204e 6f6e 650a  attrs else None.
-0004b3f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0004b400: 656c 662e 5f72 6570 6c61 6365 5f77 6974  elf._replace_wit
-0004b410: 685f 6e65 775f 6469 6d73 2876 6172 6961  h_new_dims(varia
-0004b420: 626c 6573 2c20 696e 6465 7865 733d 696e  bles, indexes=in
-0004b430: 6465 7865 732c 2061 7474 7273 3d61 7474  dexes, attrs=att
-0004b440: 7273 290a 0a20 2020 2064 6566 2069 6478  rs)..    def idx
-0004b450: 6d69 6e28 0a20 2020 2020 2020 2073 656c  min(.        sel
-0004b460: 663a 2054 5f44 6174 6173 6574 2c0a 2020  f: T_Dataset,.  
-0004b470: 2020 2020 2020 6469 6d3a 2048 6173 6861        dim: Hasha
-0004b480: 626c 6520 7c20 4e6f 6e65 203d 204e 6f6e  ble | None = Non
-0004b490: 652c 0a20 2020 2020 2020 2073 6b69 706e  e,.        skipn
-0004b4a0: 613a 2062 6f6f 6c20 7c20 4e6f 6e65 203d  a: bool | None =
-0004b4b0: 204e 6f6e 652c 0a20 2020 2020 2020 2066   None,.        f
-0004b4c0: 696c 6c5f 7661 6c75 653a 2041 6e79 203d  ill_value: Any =
-0004b4d0: 2078 7264 7479 7065 732e 4e41 2c0a 2020   xrdtypes.NA,.  
-0004b4e0: 2020 2020 2020 6b65 6570 5f61 7474 7273        keep_attrs
-0004b4f0: 3a20 626f 6f6c 207c 204e 6f6e 6520 3d20  : bool | None = 
-0004b500: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 2054  None,.    ) -> T
-0004b510: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-0004b520: 2020 2222 2252 6574 7572 6e20 7468 6520    """Return the 
-0004b530: 636f 6f72 6469 6e61 7465 206c 6162 656c  coordinate label
-0004b540: 206f 6620 7468 6520 6d69 6e69 6d75 6d20   of the minimum 
-0004b550: 7661 6c75 6520 616c 6f6e 6720 6120 6469  value along a di
-0004b560: 6d65 6e73 696f 6e2e 0a0a 2020 2020 2020  mension...      
-0004b570: 2020 5265 7475 726e 7320 6120 6e65 7720    Returns a new 
-0004b580: 6044 6174 6173 6574 6020 6e61 6d65 6420  `Dataset` named 
-0004b590: 6166 7465 7220 7468 6520 6469 6d65 6e73  after the dimens
-0004b5a0: 696f 6e20 7769 7468 2074 6865 2076 616c  ion with the val
-0004b5b0: 7565 7320 6f66 0a20 2020 2020 2020 2074  ues of.        t
-0004b5c0: 6865 2063 6f6f 7264 696e 6174 6520 6c61  he coordinate la
-0004b5d0: 6265 6c73 2061 6c6f 6e67 2074 6861 7420  bels along that 
-0004b5e0: 6469 6d65 6e73 696f 6e20 636f 7272 6573  dimension corres
-0004b5f0: 706f 6e64 696e 6720 746f 206d 696e 696d  ponding to minim
-0004b600: 756d 0a20 2020 2020 2020 2076 616c 7565  um.        value
-0004b610: 7320 616c 6f6e 6720 7468 6174 2064 696d  s along that dim
-0004b620: 656e 7369 6f6e 2e0a 0a20 2020 2020 2020  ension...       
-0004b630: 2049 6e20 636f 6d70 6172 6973 6f6e 2074   In comparison t
-0004b640: 6f20 3a70 793a 6d65 7468 3a60 7e44 6174  o :py:meth:`~Dat
-0004b650: 6173 6574 2e61 7267 6d69 6e60 2c20 7468  aset.argmin`, th
-0004b660: 6973 2072 6574 7572 6e73 2074 6865 0a20  is returns the. 
-0004b670: 2020 2020 2020 2063 6f6f 7264 696e 6174         coordinat
-0004b680: 6520 6c61 6265 6c20 7768 696c 6520 3a70  e label while :p
-0004b690: 793a 6d65 7468 3a60 7e44 6174 6173 6574  y:meth:`~Dataset
-0004b6a0: 2e61 7267 6d69 6e60 2072 6574 7572 6e73  .argmin` returns
-0004b6b0: 2074 6865 2069 6e64 6578 2e0a 0a20 2020   the index...   
-0004b6c0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-0004b6d0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0004b6e0: 2d2d 0a20 2020 2020 2020 2064 696d 203a  --.        dim :
-0004b6f0: 2048 6173 6861 626c 652c 206f 7074 696f   Hashable, optio
-0004b700: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-0004b710: 4469 6d65 6e73 696f 6e20 6f76 6572 2077  Dimension over w
-0004b720: 6869 6368 2074 6f20 6170 706c 7920 6069  hich to apply `i
-0004b730: 6478 6d69 6e60 2e20 2054 6869 7320 6973  dxmin`.  This is
-0004b740: 206f 7074 696f 6e61 6c20 666f 7220 3144   optional for 1D
-0004b750: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-0004b760: 6961 626c 6573 2c20 6275 7420 7265 7175  iables, but requ
-0004b770: 6972 6564 2066 6f72 2076 6172 6961 626c  ired for variabl
-0004b780: 6573 2077 6974 6820 3220 6f72 206d 6f72  es with 2 or mor
-0004b790: 6520 6469 6d65 6e73 696f 6e73 2e0a 2020  e dimensions..  
-0004b7a0: 2020 2020 2020 736b 6970 6e61 203a 2062        skipna : b
-0004b7b0: 6f6f 6c20 6f72 204e 6f6e 652c 206f 7074  ool or None, opt
-0004b7c0: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-0004b7d0: 2020 4966 2054 7275 652c 2073 6b69 7020    If True, skip 
-0004b7e0: 6d69 7373 696e 6720 7661 6c75 6573 2028  missing values (
-0004b7f0: 6173 206d 6172 6b65 6420 6279 204e 614e  as marked by NaN
-0004b800: 292e 2042 7920 6465 6661 756c 742c 206f  ). By default, o
-0004b810: 6e6c 790a 2020 2020 2020 2020 2020 2020  nly.            
-0004b820: 736b 6970 7320 6d69 7373 696e 6720 7661  skips missing va
-0004b830: 6c75 6573 2066 6f72 2060 6066 6c6f 6174  lues for ``float
-0004b840: 6060 2c20 6060 636f 6d70 6c65 7860 602c  ``, ``complex``,
-0004b850: 2061 6e64 2060 606f 626a 6563 7460 600a   and ``object``.
-0004b860: 2020 2020 2020 2020 2020 2020 6474 7970              dtyp
-0004b870: 6573 3b20 6f74 6865 7220 6474 7970 6573  es; other dtypes
-0004b880: 2065 6974 6865 7220 646f 206e 6f74 2068   either do not h
-0004b890: 6176 6520 6120 7365 6e74 696e 656c 206d  ave a sentinel m
-0004b8a0: 6973 7369 6e67 2076 616c 7565 0a20 2020  issing value.   
-0004b8b0: 2020 2020 2020 2020 2028 6060 696e 7460           (``int`
-0004b8c0: 6029 206f 7220 6060 736b 6970 6e61 3d54  `) or ``skipna=T
-0004b8d0: 7275 6560 6020 6861 7320 6e6f 7420 6265  rue`` has not be
-0004b8e0: 656e 2069 6d70 6c65 6d65 6e74 6564 0a20  en implemented. 
-0004b8f0: 2020 2020 2020 2020 2020 2028 6060 6461             (``da
-0004b900: 7465 7469 6d65 3634 6060 206f 7220 6060  tetime64`` or ``
-0004b910: 7469 6d65 6465 6c74 6136 3460 6029 2e0a  timedelta64``)..
-0004b920: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
-0004b930: 7565 203a 2041 6e79 2c20 6465 6661 756c  ue : Any, defaul
-0004b940: 743a 204e 614e 0a20 2020 2020 2020 2020  t: NaN.         
-0004b950: 2020 2056 616c 7565 2074 6f20 6265 2066     Value to be f
-0004b960: 696c 6c65 6420 696e 2063 6173 6520 616c  illed in case al
-0004b970: 6c20 6f66 2074 6865 2076 616c 7565 7320  l of the values 
-0004b980: 616c 6f6e 6720 6120 6469 6d65 6e73 696f  along a dimensio
-0004b990: 6e20 6172 650a 2020 2020 2020 2020 2020  n are.          
-0004b9a0: 2020 6e75 6c6c 2e20 2042 7920 6465 6661    null.  By defa
-0004b9b0: 756c 7420 7468 6973 2069 7320 4e61 4e2e  ult this is NaN.
-0004b9c0: 2020 5468 6520 6669 6c6c 2076 616c 7565    The fill value
-0004b9d0: 2061 6e64 2072 6573 756c 7420 6172 650a   and result are.
-0004b9e0: 2020 2020 2020 2020 2020 2020 6175 746f              auto
-0004b9f0: 6d61 7469 6361 6c6c 7920 636f 6e76 6572  matically conver
-0004ba00: 7465 6420 746f 2061 2063 6f6d 7061 7469  ted to a compati
-0004ba10: 626c 6520 6474 7970 6520 6966 2070 6f73  ble dtype if pos
-0004ba20: 7369 626c 652e 0a20 2020 2020 2020 2020  sible..         
-0004ba30: 2020 2049 676e 6f72 6564 2069 6620 6060     Ignored if ``
-0004ba40: 736b 6970 6e61 6060 2069 7320 4661 6c73  skipna`` is Fals
-0004ba50: 652e 0a20 2020 2020 2020 206b 6565 705f  e..        keep_
-0004ba60: 6174 7472 7320 3a20 626f 6f6c 206f 7220  attrs : bool or 
-0004ba70: 4e6f 6e65 2c20 6f70 7469 6f6e 616c 0a20  None, optional. 
-0004ba80: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
-0004ba90: 7565 2c20 7468 6520 6174 7472 6962 7574  ue, the attribut
-0004baa0: 6573 2028 6060 6174 7472 7360 6029 2077  es (``attrs``) w
-0004bab0: 696c 6c20 6265 2063 6f70 6965 6420 6672  ill be copied fr
-0004bac0: 6f6d 2074 6865 0a20 2020 2020 2020 2020  om the.         
-0004bad0: 2020 206f 7269 6769 6e61 6c20 6f62 6a65     original obje
-0004bae0: 6374 2074 6f20 7468 6520 6e65 7720 6f6e  ct to the new on
-0004baf0: 652e 2049 6620 4661 6c73 652c 2074 6865  e. If False, the
-0004bb00: 206e 6577 206f 626a 6563 740a 2020 2020   new object.    
-0004bb10: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
-0004bb20: 7265 7475 726e 6564 2077 6974 686f 7574  returned without
-0004bb30: 2061 7474 7269 6275 7465 732e 0a0a 2020   attributes...  
-0004bb40: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-0004bb50: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-0004bb60: 2020 2020 2020 7265 6475 6365 6420 3a20        reduced : 
-0004bb70: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
-0004bb80: 2020 2020 4e65 7720 6044 6174 6173 6574      New `Dataset
-0004bb90: 6020 6f62 6a65 6374 2077 6974 6820 6069  ` object with `i
-0004bba0: 6478 6d69 6e60 2061 7070 6c69 6564 2074  dxmin` applied t
-0004bbb0: 6f20 6974 7320 6461 7461 2061 6e64 2074  o its data and t
-0004bbc0: 6865 0a20 2020 2020 2020 2020 2020 2069  he.            i
-0004bbd0: 6e64 6963 6174 6564 2064 696d 656e 7369  ndicated dimensi
-0004bbe0: 6f6e 2072 656d 6f76 6564 2e0a 0a20 2020  on removed...   
-0004bbf0: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
-0004bc00: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-0004bc10: 2020 2020 2020 2044 6174 6141 7272 6179         DataArray
-0004bc20: 2e69 6478 6d69 6e2c 2044 6174 6173 6574  .idxmin, Dataset
-0004bc30: 2e69 6478 6d61 782c 2044 6174 6173 6574  .idxmax, Dataset
-0004bc40: 2e6d 696e 2c20 4461 7461 7365 742e 6172  .min, Dataset.ar
-0004bc50: 676d 696e 0a0a 2020 2020 2020 2020 4578  gmin..        Ex
-0004bc60: 616d 706c 6573 0a20 2020 2020 2020 202d  amples.        -
-0004bc70: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0004bc80: 3e3e 3e20 6172 7261 7931 203d 2078 722e  >>> array1 = xr.
-0004bc90: 4461 7461 4172 7261 7928 0a20 2020 2020  DataArray(.     
-0004bca0: 2020 202e 2e2e 2020 2020 205b 302c 2032     ...     [0, 2
-0004bcb0: 2c20 312c 2030 2c20 2d32 5d2c 2064 696d  , 1, 0, -2], dim
-0004bcc0: 733d 2278 222c 2063 6f6f 7264 733d 7b22  s="x", coords={"
-0004bcd0: 7822 3a20 5b22 6122 2c20 2262 222c 2022  x": ["a", "b", "
-0004bce0: 6322 2c20 2264 222c 2022 6522 5d7d 0a20  c", "d", "e"]}. 
-0004bcf0: 2020 2020 2020 202e 2e2e 2029 0a20 2020         ... ).   
-0004bd00: 2020 2020 203e 3e3e 2061 7272 6179 3220       >>> array2 
-0004bd10: 3d20 7872 2e44 6174 6141 7272 6179 280a  = xr.DataArray(.
-0004bd20: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-0004bd30: 5b0a 2020 2020 2020 2020 2e2e 2e20 2020  [.        ...   
-0004bd40: 2020 2020 2020 5b32 2e30 2c20 312e 302c        [2.0, 1.0,
-0004bd50: 2032 2e30 2c20 302e 302c 202d 322e 305d   2.0, 0.0, -2.0]
-0004bd60: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-0004bd70: 2020 2020 2020 5b2d 342e 302c 206e 702e        [-4.0, np.
-0004bd80: 4e61 4e2c 2032 2e30 2c20 6e70 2e4e 614e  NaN, 2.0, np.NaN
-0004bd90: 2c20 2d32 2e30 5d2c 0a20 2020 2020 2020  , -2.0],.       
-0004bda0: 202e 2e2e 2020 2020 2020 2020 205b 6e70   ...         [np
-0004bdb0: 2e4e 614e 2c20 6e70 2e4e 614e 2c20 312e  .NaN, np.NaN, 1.
-0004bdc0: 302c 206e 702e 4e61 4e2c 206e 702e 4e61  0, np.NaN, np.Na
-0004bdd0: 4e5d 2c0a 2020 2020 2020 2020 2e2e 2e20  N],.        ... 
-0004bde0: 2020 2020 5d2c 0a20 2020 2020 2020 202e      ],.        .
-0004bdf0: 2e2e 2020 2020 2064 696d 733d 5b22 7922  ..     dims=["y"
-0004be00: 2c20 2278 225d 2c0a 2020 2020 2020 2020  , "x"],.        
-0004be10: 2e2e 2e20 2020 2020 636f 6f72 6473 3d7b  ...     coords={
-0004be20: 2279 223a 205b 2d31 2c20 302c 2031 5d2c  "y": [-1, 0, 1],
-0004be30: 2022 7822 3a20 5b22 6122 2c20 2262 222c   "x": ["a", "b",
-0004be40: 2022 6322 2c20 2264 222c 2022 6522 5d7d   "c", "d", "e"]}
-0004be50: 2c0a 2020 2020 2020 2020 2e2e 2e20 290a  ,.        ... ).
-0004be60: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
-0004be70: 2078 722e 4461 7461 7365 7428 7b22 696e   xr.Dataset({"in
-0004be80: 7422 3a20 6172 7261 7931 2c20 2266 6c6f  t": array1, "flo
-0004be90: 6174 223a 2061 7272 6179 327d 290a 2020  at": array2}).  
-0004bea0: 2020 2020 2020 3e3e 3e20 6473 2e6d 696e        >>> ds.min
-0004beb0: 2864 696d 3d22 7822 290a 2020 2020 2020  (dim="x").      
-0004bec0: 2020 3c78 6172 7261 792e 4461 7461 7365    <xarray.Datase
-0004bed0: 743e 0a20 2020 2020 2020 2044 696d 656e  t>.        Dimen
-0004bee0: 7369 6f6e 733a 2020 2879 3a20 3329 0a20  sions:  (y: 3). 
-0004bef0: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
-0004bf00: 6573 3a0a 2020 2020 2020 2020 2020 2a20  es:.          * 
-0004bf10: 7920 2020 2020 2020 2028 7929 2069 6e74  y        (y) int
-0004bf20: 3634 202d 3120 3020 310a 2020 2020 2020  64 -1 0 1.      
-0004bf30: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
-0004bf40: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
-0004bf50: 7420 2020 2020 2069 6e74 3634 202d 320a  t      int64 -2.
-0004bf60: 2020 2020 2020 2020 2020 2020 666c 6f61              floa
-0004bf70: 7420 2020 2028 7929 2066 6c6f 6174 3634  t    (y) float64
-0004bf80: 202d 322e 3020 2d34 2e30 2031 2e30 0a20   -2.0 -4.0 1.0. 
-0004bf90: 2020 2020 2020 203e 3e3e 2064 732e 6172         >>> ds.ar
-0004bfa0: 676d 696e 2864 696d 3d22 7822 290a 2020  gmin(dim="x").  
-0004bfb0: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-0004bfc0: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-0004bfd0: 696d 656e 7369 6f6e 733a 2020 2879 3a20  imensions:  (y: 
-0004bfe0: 3329 0a20 2020 2020 2020 2043 6f6f 7264  3).        Coord
-0004bff0: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
-0004c000: 2020 2a20 7920 2020 2020 2020 2028 7929    * y        (y)
-0004c010: 2069 6e74 3634 202d 3120 3020 310a 2020   int64 -1 0 1.  
-0004c020: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
-0004c030: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
-0004c040: 2020 696e 7420 2020 2020 2069 6e74 3634    int      int64
-0004c050: 2034 0a20 2020 2020 2020 2020 2020 2066   4.            f
-0004c060: 6c6f 6174 2020 2020 2879 2920 696e 7436  loat    (y) int6
-0004c070: 3420 3420 3020 320a 2020 2020 2020 2020  4 4 0 2.        
-0004c080: 3e3e 3e20 6473 2e69 6478 6d69 6e28 6469  >>> ds.idxmin(di
-0004c090: 6d3d 2278 2229 0a20 2020 2020 2020 203c  m="x").        <
-0004c0a0: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
-0004c0b0: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-0004c0c0: 6e73 3a20 2028 793a 2033 290a 2020 2020  ns:  (y: 3).    
-0004c0d0: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
-0004c0e0: 0a20 2020 2020 2020 2020 202a 2079 2020  .          * y  
-0004c0f0: 2020 2020 2020 2879 2920 696e 7436 3420        (y) int64 
-0004c100: 2d31 2030 2031 0a20 2020 2020 2020 2044  -1 0 1.        D
-0004c110: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
-0004c120: 2020 2020 2020 2020 2020 2069 6e74 2020             int  
-0004c130: 2020 2020 3c55 3120 2765 270a 2020 2020      <U1 'e'.    
-0004c140: 2020 2020 2020 2020 666c 6f61 7420 2020          float   
-0004c150: 2028 7929 206f 626a 6563 7420 2765 2720   (y) object 'e' 
-0004c160: 2761 2720 2763 270a 2020 2020 2020 2020  'a' 'c'.        
-0004c170: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0004c180: 726e 2073 656c 662e 6d61 7028 0a20 2020  rn self.map(.   
-0004c190: 2020 2020 2020 2020 206d 6574 686f 6463           methodc
-0004c1a0: 616c 6c65 7228 0a20 2020 2020 2020 2020  aller(.         
-0004c1b0: 2020 2020 2020 2022 6964 786d 696e 222c         "idxmin",
-0004c1c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004c1d0: 2064 696d 3d64 696d 2c0a 2020 2020 2020   dim=dim,.      
-0004c1e0: 2020 2020 2020 2020 2020 736b 6970 6e61            skipna
-0004c1f0: 3d73 6b69 706e 612c 0a20 2020 2020 2020  =skipna,.       
-0004c200: 2020 2020 2020 2020 2066 696c 6c5f 7661           fill_va
-0004c210: 6c75 653d 6669 6c6c 5f76 616c 7565 2c0a  lue=fill_value,.
-0004c220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c230: 6b65 6570 5f61 7474 7273 3d6b 6565 705f  keep_attrs=keep_
-0004c240: 6174 7472 732c 0a20 2020 2020 2020 2020  attrs,.         
-0004c250: 2020 2029 0a20 2020 2020 2020 2029 0a0a     ).        )..
-0004c260: 2020 2020 6465 6620 6964 786d 6178 280a      def idxmax(.
-0004c270: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
-0004c280: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
-0004c290: 2064 696d 3a20 4861 7368 6162 6c65 207c   dim: Hashable |
-0004c2a0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-0004c2b0: 2020 2020 2020 736b 6970 6e61 3a20 626f        skipna: bo
-0004c2c0: 6f6c 207c 204e 6f6e 6520 3d20 4e6f 6e65  ol | None = None
-0004c2d0: 2c0a 2020 2020 2020 2020 6669 6c6c 5f76  ,.        fill_v
-0004c2e0: 616c 7565 3a20 416e 7920 3d20 7872 6474  alue: Any = xrdt
-0004c2f0: 7970 6573 2e4e 412c 0a20 2020 2020 2020  ypes.NA,.       
-0004c300: 206b 6565 705f 6174 7472 733a 2062 6f6f   keep_attrs: boo
-0004c310: 6c20 7c20 4e6f 6e65 203d 204e 6f6e 652c  l | None = None,
-0004c320: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
-0004c330: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
-0004c340: 5265 7475 726e 2074 6865 2063 6f6f 7264  Return the coord
-0004c350: 696e 6174 6520 6c61 6265 6c20 6f66 2074  inate label of t
-0004c360: 6865 206d 6178 696d 756d 2076 616c 7565  he maximum value
-0004c370: 2061 6c6f 6e67 2061 2064 696d 656e 7369   along a dimensi
-0004c380: 6f6e 2e0a 0a20 2020 2020 2020 2052 6574  on...        Ret
-0004c390: 7572 6e73 2061 206e 6577 2060 4461 7461  urns a new `Data
-0004c3a0: 7365 7460 206e 616d 6564 2061 6674 6572  set` named after
-0004c3b0: 2074 6865 2064 696d 656e 7369 6f6e 2077   the dimension w
-0004c3c0: 6974 6820 7468 6520 7661 6c75 6573 206f  ith the values o
-0004c3d0: 660a 2020 2020 2020 2020 7468 6520 636f  f.        the co
-0004c3e0: 6f72 6469 6e61 7465 206c 6162 656c 7320  ordinate labels 
-0004c3f0: 616c 6f6e 6720 7468 6174 2064 696d 656e  along that dimen
-0004c400: 7369 6f6e 2063 6f72 7265 7370 6f6e 6469  sion correspondi
-0004c410: 6e67 2074 6f20 6d61 7869 6d75 6d0a 2020  ng to maximum.  
-0004c420: 2020 2020 2020 7661 6c75 6573 2061 6c6f        values alo
-0004c430: 6e67 2074 6861 7420 6469 6d65 6e73 696f  ng that dimensio
-0004c440: 6e2e 0a0a 2020 2020 2020 2020 496e 2063  n...        In c
-0004c450: 6f6d 7061 7269 736f 6e20 746f 203a 7079  omparison to :py
-0004c460: 3a6d 6574 683a 607e 4461 7461 7365 742e  :meth:`~Dataset.
-0004c470: 6172 676d 6178 602c 2074 6869 7320 7265  argmax`, this re
-0004c480: 7475 726e 7320 7468 650a 2020 2020 2020  turns the.      
-0004c490: 2020 636f 6f72 6469 6e61 7465 206c 6162    coordinate lab
-0004c4a0: 656c 2077 6869 6c65 203a 7079 3a6d 6574  el while :py:met
-0004c4b0: 683a 607e 4461 7461 7365 742e 6172 676d  h:`~Dataset.argm
-0004c4c0: 6178 6020 7265 7475 726e 7320 7468 6520  ax` returns the 
-0004c4d0: 696e 6465 782e 0a0a 2020 2020 2020 2020  index...        
-0004c4e0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-0004c4f0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0004c500: 2020 2020 2020 6469 6d20 3a20 7374 722c        dim : str,
-0004c510: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0004c520: 2020 2020 2020 4469 6d65 6e73 696f 6e20        Dimension 
-0004c530: 6f76 6572 2077 6869 6368 2074 6f20 6170  over which to ap
-0004c540: 706c 7920 6069 6478 6d61 7860 2e20 2054  ply `idxmax`.  T
-0004c550: 6869 7320 6973 206f 7074 696f 6e61 6c20  his is optional 
-0004c560: 666f 7220 3144 0a20 2020 2020 2020 2020  for 1D.         
-0004c570: 2020 2076 6172 6961 626c 6573 2c20 6275     variables, bu
-0004c580: 7420 7265 7175 6972 6564 2066 6f72 2076  t required for v
-0004c590: 6172 6961 626c 6573 2077 6974 6820 3220  ariables with 2 
-0004c5a0: 6f72 206d 6f72 6520 6469 6d65 6e73 696f  or more dimensio
-0004c5b0: 6e73 2e0a 2020 2020 2020 2020 736b 6970  ns..        skip
-0004c5c0: 6e61 203a 2062 6f6f 6c20 6f72 204e 6f6e  na : bool or Non
-0004c5d0: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
-0004c5e0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-0004c5f0: 2073 6b69 7020 6d69 7373 696e 6720 7661   skip missing va
-0004c600: 6c75 6573 2028 6173 206d 6172 6b65 6420  lues (as marked 
-0004c610: 6279 204e 614e 292e 2042 7920 6465 6661  by NaN). By defa
-0004c620: 756c 742c 206f 6e6c 790a 2020 2020 2020  ult, only.      
-0004c630: 2020 2020 2020 736b 6970 7320 6d69 7373        skips miss
-0004c640: 696e 6720 7661 6c75 6573 2066 6f72 2060  ing values for `
-0004c650: 6066 6c6f 6174 6060 2c20 6060 636f 6d70  `float``, ``comp
-0004c660: 6c65 7860 602c 2061 6e64 2060 606f 626a  lex``, and ``obj
-0004c670: 6563 7460 600a 2020 2020 2020 2020 2020  ect``.          
-0004c680: 2020 6474 7970 6573 3b20 6f74 6865 7220    dtypes; other 
-0004c690: 6474 7970 6573 2065 6974 6865 7220 646f  dtypes either do
-0004c6a0: 206e 6f74 2068 6176 6520 6120 7365 6e74   not have a sent
-0004c6b0: 696e 656c 206d 6973 7369 6e67 2076 616c  inel missing val
-0004c6c0: 7565 0a20 2020 2020 2020 2020 2020 2028  ue.            (
-0004c6d0: 6060 696e 7460 6029 206f 7220 6060 736b  ``int``) or ``sk
-0004c6e0: 6970 6e61 3d54 7275 6560 6020 6861 7320  ipna=True`` has 
-0004c6f0: 6e6f 7420 6265 656e 2069 6d70 6c65 6d65  not been impleme
-0004c700: 6e74 6564 0a20 2020 2020 2020 2020 2020  nted.           
-0004c710: 2028 6060 6461 7465 7469 6d65 3634 6060   (``datetime64``
-0004c720: 206f 7220 6060 7469 6d65 6465 6c74 6136   or ``timedelta6
-0004c730: 3460 6029 2e0a 2020 2020 2020 2020 6669  4``)..        fi
-0004c740: 6c6c 5f76 616c 7565 203a 2041 6e79 2c20  ll_value : Any, 
-0004c750: 6465 6661 756c 743a 204e 614e 0a20 2020  default: NaN.   
-0004c760: 2020 2020 2020 2020 2056 616c 7565 2074           Value t
-0004c770: 6f20 6265 2066 696c 6c65 6420 696e 2063  o be filled in c
-0004c780: 6173 6520 616c 6c20 6f66 2074 6865 2076  ase all of the v
-0004c790: 616c 7565 7320 616c 6f6e 6720 6120 6469  alues along a di
-0004c7a0: 6d65 6e73 696f 6e20 6172 650a 2020 2020  mension are.    
-0004c7b0: 2020 2020 2020 2020 6e75 6c6c 2e20 2042          null.  B
-0004c7c0: 7920 6465 6661 756c 7420 7468 6973 2069  y default this i
-0004c7d0: 7320 4e61 4e2e 2020 5468 6520 6669 6c6c  s NaN.  The fill
-0004c7e0: 2076 616c 7565 2061 6e64 2072 6573 756c   value and resul
-0004c7f0: 7420 6172 650a 2020 2020 2020 2020 2020  t are.          
-0004c800: 2020 6175 746f 6d61 7469 6361 6c6c 7920    automatically 
-0004c810: 636f 6e76 6572 7465 6420 746f 2061 2063  converted to a c
-0004c820: 6f6d 7061 7469 626c 6520 6474 7970 6520  ompatible dtype 
-0004c830: 6966 2070 6f73 7369 626c 652e 0a20 2020  if possible..   
-0004c840: 2020 2020 2020 2020 2049 676e 6f72 6564           Ignored
-0004c850: 2069 6620 6060 736b 6970 6e61 6060 2069   if ``skipna`` i
-0004c860: 7320 4661 6c73 652e 0a20 2020 2020 2020  s False..       
-0004c870: 206b 6565 705f 6174 7472 7320 3a20 626f   keep_attrs : bo
-0004c880: 6f6c 206f 7220 4e6f 6e65 2c20 6f70 7469  ol or None, opti
-0004c890: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-0004c8a0: 2049 6620 5472 7565 2c20 7468 6520 6174   If True, the at
-0004c8b0: 7472 6962 7574 6573 2028 6060 6174 7472  tributes (``attr
-0004c8c0: 7360 6029 2077 696c 6c20 6265 2063 6f70  s``) will be cop
-0004c8d0: 6965 6420 6672 6f6d 2074 6865 0a20 2020  ied from the.   
-0004c8e0: 2020 2020 2020 2020 206f 7269 6769 6e61           origina
-0004c8f0: 6c20 6f62 6a65 6374 2074 6f20 7468 6520  l object to the 
-0004c900: 6e65 7720 6f6e 652e 2049 6620 4661 6c73  new one. If Fals
-0004c910: 652c 2074 6865 206e 6577 206f 626a 6563  e, the new objec
-0004c920: 740a 2020 2020 2020 2020 2020 2020 7769  t.            wi
-0004c930: 6c6c 2062 6520 7265 7475 726e 6564 2077  ll be returned w
-0004c940: 6974 686f 7574 2061 7474 7269 6275 7465  ithout attribute
-0004c950: 732e 0a0a 2020 2020 2020 2020 5265 7475  s...        Retu
-0004c960: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-0004c970: 2d2d 2d0a 2020 2020 2020 2020 7265 6475  ---.        redu
-0004c980: 6365 6420 3a20 4461 7461 7365 740a 2020  ced : Dataset.  
-0004c990: 2020 2020 2020 2020 2020 4e65 7720 6044            New `D
-0004c9a0: 6174 6173 6574 6020 6f62 6a65 6374 2077  ataset` object w
-0004c9b0: 6974 6820 6069 6478 6d61 7860 2061 7070  ith `idxmax` app
-0004c9c0: 6c69 6564 2074 6f20 6974 7320 6461 7461  lied to its data
-0004c9d0: 2061 6e64 2074 6865 0a20 2020 2020 2020   and the.       
-0004c9e0: 2020 2020 2069 6e64 6963 6174 6564 2064       indicated d
-0004c9f0: 696d 656e 7369 6f6e 2072 656d 6f76 6564  imension removed
-0004ca00: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-0004ca10: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-0004ca20: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
-0004ca30: 6141 7272 6179 2e69 6478 6d61 782c 2044  aArray.idxmax, D
-0004ca40: 6174 6173 6574 2e69 6478 6d69 6e2c 2044  ataset.idxmin, D
-0004ca50: 6174 6173 6574 2e6d 6178 2c20 4461 7461  ataset.max, Data
-0004ca60: 7365 742e 6172 676d 6178 0a0a 2020 2020  set.argmax..    
-0004ca70: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
-0004ca80: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-0004ca90: 2020 2020 2020 3e3e 3e20 6172 7261 7931        >>> array1
-0004caa0: 203d 2078 722e 4461 7461 4172 7261 7928   = xr.DataArray(
-0004cab0: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-0004cac0: 205b 302c 2032 2c20 312c 2030 2c20 2d32   [0, 2, 1, 0, -2
-0004cad0: 5d2c 2064 696d 733d 2278 222c 2063 6f6f  ], dims="x", coo
-0004cae0: 7264 733d 7b22 7822 3a20 5b22 6122 2c20  rds={"x": ["a", 
-0004caf0: 2262 222c 2022 6322 2c20 2264 222c 2022  "b", "c", "d", "
-0004cb00: 6522 5d7d 0a20 2020 2020 2020 202e 2e2e  e"]}.        ...
-0004cb10: 2029 0a20 2020 2020 2020 203e 3e3e 2061   ).        >>> a
-0004cb20: 7272 6179 3220 3d20 7872 2e44 6174 6141  rray2 = xr.DataA
-0004cb30: 7272 6179 280a 2020 2020 2020 2020 2e2e  rray(.        ..
-0004cb40: 2e20 2020 2020 5b0a 2020 2020 2020 2020  .     [.        
-0004cb50: 2e2e 2e20 2020 2020 2020 2020 5b32 2e30  ...         [2.0
-0004cb60: 2c20 312e 302c 2032 2e30 2c20 302e 302c  , 1.0, 2.0, 0.0,
-0004cb70: 202d 322e 305d 2c0a 2020 2020 2020 2020   -2.0],.        
-0004cb80: 2e2e 2e20 2020 2020 2020 2020 5b2d 342e  ...         [-4.
-0004cb90: 302c 206e 702e 4e61 4e2c 2032 2e30 2c20  0, np.NaN, 2.0, 
-0004cba0: 6e70 2e4e 614e 2c20 2d32 2e30 5d2c 0a20  np.NaN, -2.0],. 
-0004cbb0: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
-0004cbc0: 2020 205b 6e70 2e4e 614e 2c20 6e70 2e4e     [np.NaN, np.N
-0004cbd0: 614e 2c20 312e 302c 206e 702e 4e61 4e2c  aN, 1.0, np.NaN,
-0004cbe0: 206e 702e 4e61 4e5d 2c0a 2020 2020 2020   np.NaN],.      
-0004cbf0: 2020 2e2e 2e20 2020 2020 5d2c 0a20 2020    ...     ],.   
-0004cc00: 2020 2020 202e 2e2e 2020 2020 2064 696d       ...     dim
-0004cc10: 733d 5b22 7922 2c20 2278 225d 2c0a 2020  s=["y", "x"],.  
-0004cc20: 2020 2020 2020 2e2e 2e20 2020 2020 636f        ...     co
-0004cc30: 6f72 6473 3d7b 2279 223a 205b 2d31 2c20  ords={"y": [-1, 
-0004cc40: 302c 2031 5d2c 2022 7822 3a20 5b22 6122  0, 1], "x": ["a"
-0004cc50: 2c20 2262 222c 2022 6322 2c20 2264 222c  , "b", "c", "d",
-0004cc60: 2022 6522 5d7d 2c0a 2020 2020 2020 2020   "e"]},.        
-0004cc70: 2e2e 2e20 290a 2020 2020 2020 2020 3e3e  ... ).        >>
-0004cc80: 3e20 6473 203d 2078 722e 4461 7461 7365  > ds = xr.Datase
-0004cc90: 7428 7b22 696e 7422 3a20 6172 7261 7931  t({"int": array1
-0004cca0: 2c20 2266 6c6f 6174 223a 2061 7272 6179  , "float": array
-0004ccb0: 327d 290a 2020 2020 2020 2020 3e3e 3e20  2}).        >>> 
-0004ccc0: 6473 2e6d 6178 2864 696d 3d22 7822 290a  ds.max(dim="x").
-0004ccd0: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-0004cce0: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-0004ccf0: 2044 696d 656e 7369 6f6e 733a 2020 2879   Dimensions:  (y
-0004cd00: 3a20 3329 0a20 2020 2020 2020 2043 6f6f  : 3).        Coo
-0004cd10: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
-0004cd20: 2020 2020 2a20 7920 2020 2020 2020 2028      * y        (
-0004cd30: 7929 2069 6e74 3634 202d 3120 3020 310a  y) int64 -1 0 1.
-0004cd40: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-0004cd50: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-0004cd60: 2020 2020 696e 7420 2020 2020 2069 6e74      int      int
-0004cd70: 3634 2032 0a20 2020 2020 2020 2020 2020  64 2.           
-0004cd80: 2066 6c6f 6174 2020 2020 2879 2920 666c   float    (y) fl
-0004cd90: 6f61 7436 3420 322e 3020 322e 3020 312e  oat64 2.0 2.0 1.
-0004cda0: 300a 2020 2020 2020 2020 3e3e 3e20 6473  0.        >>> ds
-0004cdb0: 2e61 7267 6d61 7828 6469 6d3d 2278 2229  .argmax(dim="x")
-0004cdc0: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
-0004cdd0: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
-0004cde0: 2020 4469 6d65 6e73 696f 6e73 3a20 2028    Dimensions:  (
-0004cdf0: 793a 2033 290a 2020 2020 2020 2020 436f  y: 3).        Co
-0004ce00: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
-0004ce10: 2020 2020 202a 2079 2020 2020 2020 2020       * y        
-0004ce20: 2879 2920 696e 7436 3420 2d31 2030 2031  (y) int64 -1 0 1
-0004ce30: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-0004ce40: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-0004ce50: 2020 2020 2069 6e74 2020 2020 2020 696e       int      in
-0004ce60: 7436 3420 310a 2020 2020 2020 2020 2020  t64 1.          
-0004ce70: 2020 666c 6f61 7420 2020 2028 7929 2069    float    (y) i
-0004ce80: 6e74 3634 2030 2032 2032 0a20 2020 2020  nt64 0 2 2.     
-0004ce90: 2020 203e 3e3e 2064 732e 6964 786d 6178     >>> ds.idxmax
-0004cea0: 2864 696d 3d22 7822 290a 2020 2020 2020  (dim="x").      
-0004ceb0: 2020 3c78 6172 7261 792e 4461 7461 7365    <xarray.Datase
-0004cec0: 743e 0a20 2020 2020 2020 2044 696d 656e  t>.        Dimen
-0004ced0: 7369 6f6e 733a 2020 2879 3a20 3329 0a20  sions:  (y: 3). 
-0004cee0: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
-0004cef0: 6573 3a0a 2020 2020 2020 2020 2020 2a20  es:.          * 
-0004cf00: 7920 2020 2020 2020 2028 7929 2069 6e74  y        (y) int
-0004cf10: 3634 202d 3120 3020 310a 2020 2020 2020  64 -1 0 1.      
-0004cf20: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
-0004cf30: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
-0004cf40: 7420 2020 2020 203c 5531 2027 6227 0a20  t      <U1 'b'. 
-0004cf50: 2020 2020 2020 2020 2020 2066 6c6f 6174             float
-0004cf60: 2020 2020 2879 2920 6f62 6a65 6374 2027      (y) object '
-0004cf70: 6127 2027 6327 2027 6327 0a20 2020 2020  a' 'c' 'c'.     
-0004cf80: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-0004cf90: 6574 7572 6e20 7365 6c66 2e6d 6170 280a  eturn self.map(.
-0004cfa0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-0004cfb0: 6f64 6361 6c6c 6572 280a 2020 2020 2020  odcaller(.      
-0004cfc0: 2020 2020 2020 2020 2020 2269 6478 6d61            "idxma
-0004cfd0: 7822 2c0a 2020 2020 2020 2020 2020 2020  x",.            
-0004cfe0: 2020 2020 6469 6d3d 6469 6d2c 0a20 2020      dim=dim,.   
-0004cff0: 2020 2020 2020 2020 2020 2020 2073 6b69               ski
-0004d000: 706e 613d 736b 6970 6e61 2c0a 2020 2020  pna=skipna,.    
-0004d010: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-0004d020: 5f76 616c 7565 3d66 696c 6c5f 7661 6c75  _value=fill_valu
-0004d030: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0004d040: 2020 206b 6565 705f 6174 7472 733d 6b65     keep_attrs=ke
-0004d050: 6570 5f61 7474 7273 2c0a 2020 2020 2020  ep_attrs,.      
-0004d060: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0004d070: 290a 0a20 2020 2064 6566 2061 7267 6d69  )..    def argmi
-0004d080: 6e28 7365 6c66 3a20 545f 4461 7461 7365  n(self: T_Datase
-0004d090: 742c 2064 696d 3a20 4861 7368 6162 6c65  t, dim: Hashable
-0004d0a0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c20   | None = None, 
-0004d0b0: 2a2a 6b77 6172 6773 2920 2d3e 2054 5f44  **kwargs) -> T_D
-0004d0c0: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-0004d0d0: 2222 2249 6e64 6963 6573 206f 6620 7468  """Indices of th
-0004d0e0: 6520 6d69 6e69 6d61 206f 6620 7468 6520  e minima of the 
-0004d0f0: 6d65 6d62 6572 2076 6172 6961 626c 6573  member variables
-0004d100: 2e0a 0a20 2020 2020 2020 2049 6620 7468  ...        If th
-0004d110: 6572 6520 6172 6520 6d75 6c74 6970 6c65  ere are multiple
-0004d120: 206d 696e 696d 612c 2074 6865 2069 6e64   minima, the ind
-0004d130: 6963 6573 206f 6620 7468 6520 6669 7273  ices of the firs
-0004d140: 7420 6f6e 6520 666f 756e 6420 7769 6c6c  t one found will
-0004d150: 2062 650a 2020 2020 2020 2020 7265 7475   be.        retu
-0004d160: 726e 6564 2e0a 0a20 2020 2020 2020 2050  rned...        P
-0004d170: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-0004d180: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0004d190: 2020 2020 2064 696d 203a 2048 6173 6861       dim : Hasha
-0004d1a0: 626c 652c 206f 7074 696f 6e61 6c0a 2020  ble, optional.  
-0004d1b0: 2020 2020 2020 2020 2020 5468 6520 6469            The di
-0004d1c0: 6d65 6e73 696f 6e20 6f76 6572 2077 6869  mension over whi
-0004d1d0: 6368 2074 6f20 6669 6e64 2074 6865 206d  ch to find the m
-0004d1e0: 696e 696d 756d 2e20 4279 2064 6566 6175  inimum. By defau
-0004d1f0: 6c74 2c20 6669 6e64 7320 6d69 6e69 6d75  lt, finds minimu
-0004d200: 6d20 6f76 6572 0a20 2020 2020 2020 2020  m over.         
-0004d210: 2020 2061 6c6c 2064 696d 656e 7369 6f6e     all dimension
-0004d220: 7320 2d20 666f 7220 6e6f 7720 7265 7475  s - for now retu
-0004d230: 726e 696e 6720 616e 2069 6e74 2066 6f72  rning an int for
-0004d240: 2062 6163 6b77 6172 6420 636f 6d70 6174   backward compat
-0004d250: 6962 696c 6974 792c 2062 7574 0a20 2020  ibility, but.   
-0004d260: 2020 2020 2020 2020 2074 6869 7320 6973           this is
-0004d270: 2064 6570 7265 6361 7465 642c 2069 6e20   deprecated, in 
-0004d280: 6675 7475 7265 2077 696c 6c20 6265 2061  future will be a
-0004d290: 6e20 6572 726f 722c 2073 696e 6365 2044  n error, since D
-0004d2a0: 6174 6141 7272 6179 2e61 7267 6d69 6e20  ataArray.argmin 
-0004d2b0: 7769 6c6c 0a20 2020 2020 2020 2020 2020  will.           
-0004d2c0: 2072 6574 7572 6e20 6120 6469 6374 2077   return a dict w
-0004d2d0: 6974 6820 696e 6469 6365 7320 666f 7220  ith indices for 
-0004d2e0: 616c 6c20 6469 6d65 6e73 696f 6e73 2c20  all dimensions, 
-0004d2f0: 7768 6963 6820 646f 6573 206e 6f74 206d  which does not m
-0004d300: 616b 6520 7365 6e73 6520 666f 720a 2020  ake sense for.  
-0004d310: 2020 2020 2020 2020 2020 6120 4461 7461            a Data
-0004d320: 7365 742e 0a20 2020 2020 2020 206b 6565  set..        kee
-0004d330: 705f 6174 7472 7320 3a20 626f 6f6c 2c20  p_attrs : bool, 
-0004d340: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0004d350: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
-0004d360: 6520 6174 7472 6962 7574 6573 2028 6061  e attributes (`a
-0004d370: 7474 7273 6029 2077 696c 6c20 6265 2063  ttrs`) will be c
-0004d380: 6f70 6965 6420 6672 6f6d 2074 6865 206f  opied from the o
-0004d390: 7269 6769 6e61 6c0a 2020 2020 2020 2020  riginal.        
-0004d3a0: 2020 2020 6f62 6a65 6374 2074 6f20 7468      object to th
-0004d3b0: 6520 6e65 7720 6f6e 652e 2020 4966 2046  e new one.  If F
-0004d3c0: 616c 7365 2028 6465 6661 756c 7429 2c20  alse (default), 
-0004d3d0: 7468 6520 6e65 7720 6f62 6a65 6374 2077  the new object w
-0004d3e0: 696c 6c20 6265 0a20 2020 2020 2020 2020  ill be.         
-0004d3f0: 2020 2072 6574 7572 6e65 6420 7769 7468     returned with
-0004d400: 6f75 7420 6174 7472 6962 7574 6573 2e0a  out attributes..
-0004d410: 2020 2020 2020 2020 736b 6970 6e61 203a          skipna :
-0004d420: 2062 6f6f 6c2c 206f 7074 696f 6e61 6c0a   bool, optional.
-0004d430: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-0004d440: 7275 652c 2073 6b69 7020 6d69 7373 696e  rue, skip missin
-0004d450: 6720 7661 6c75 6573 2028 6173 206d 6172  g values (as mar
-0004d460: 6b65 6420 6279 204e 614e 292e 2042 7920  ked by NaN). By 
-0004d470: 6465 6661 756c 742c 206f 6e6c 790a 2020  default, only.  
-0004d480: 2020 2020 2020 2020 2020 736b 6970 7320            skips 
-0004d490: 6d69 7373 696e 6720 7661 6c75 6573 2066  missing values f
-0004d4a0: 6f72 2066 6c6f 6174 2064 7479 7065 733b  or float dtypes;
-0004d4b0: 206f 7468 6572 2064 7479 7065 7320 6569   other dtypes ei
-0004d4c0: 7468 6572 2064 6f20 6e6f 740a 2020 2020  ther do not.    
-0004d4d0: 2020 2020 2020 2020 6861 7665 2061 2073          have a s
-0004d4e0: 656e 7469 6e65 6c20 6d69 7373 696e 6720  entinel missing 
-0004d4f0: 7661 6c75 6520 2869 6e74 2920 6f72 2073  value (int) or s
-0004d500: 6b69 706e 613d 5472 7565 2068 6173 206e  kipna=True has n
-0004d510: 6f74 2062 6565 6e0a 2020 2020 2020 2020  ot been.        
-0004d520: 2020 2020 696d 706c 656d 656e 7465 6420      implemented 
-0004d530: 286f 626a 6563 742c 2064 6174 6574 696d  (object, datetim
-0004d540: 6536 3420 6f72 2074 696d 6564 656c 7461  e64 or timedelta
-0004d550: 3634 292e 0a0a 2020 2020 2020 2020 5265  64)...        Re
-0004d560: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-0004d570: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7265  -----.        re
-0004d580: 7375 6c74 203a 2044 6174 6173 6574 0a0a  sult : Dataset..
-0004d590: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-0004d5a0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0004d5b0: 2d0a 2020 2020 2020 2020 4461 7461 4172  -.        DataAr
-0004d5c0: 7261 792e 6172 676d 696e 0a20 2020 2020  ray.argmin.     
-0004d5d0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0004d5e0: 6620 6469 6d20 6973 204e 6f6e 653a 0a20  f dim is None:. 
-0004d5f0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0004d600: 6e67 732e 7761 726e 280a 2020 2020 2020  ngs.warn(.      
-0004d610: 2020 2020 2020 2020 2020 224f 6e63 6520            "Once 
-0004d620: 7468 6520 6265 6861 7669 6f75 7220 6f66  the behaviour of
-0004d630: 2044 6174 6141 7272 6179 2e61 7267 6d69   DataArray.argmi
-0004d640: 6e28 2920 616e 6420 5661 7269 6162 6c65  n() and Variable
-0004d650: 2e61 7267 6d69 6e28 2920 7769 7468 6f75  .argmin() withou
-0004d660: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
-0004d670: 2020 2020 2264 696d 2063 6861 6e67 6573      "dim changes
-0004d680: 2074 6f20 7265 7475 726e 2061 2064 6963   to return a dic
-0004d690: 7420 6f66 2069 6e64 6963 6573 206f 6620  t of indices of 
-0004d6a0: 6561 6368 2064 696d 656e 7369 6f6e 2c20  each dimension, 
-0004d6b0: 666f 7220 220a 2020 2020 2020 2020 2020  for ".          
-0004d6c0: 2020 2020 2020 2263 6f6e 7369 7374 656e        "consisten
-0004d6d0: 6379 2069 7420 7769 6c6c 2062 6520 616e  cy it will be an
-0004d6e0: 2065 7272 6f72 2074 6f20 6361 6c6c 2044   error to call D
-0004d6f0: 6174 6173 6574 2e61 7267 6d69 6e28 2920  ataset.argmin() 
-0004d700: 7769 7468 206e 6f20 6172 6775 6d65 6e74  with no argument
-0004d710: 2c22 0a20 2020 2020 2020 2020 2020 2020  ,".             
-0004d720: 2020 2022 7369 6e63 6520 7765 2064 6f6e     "since we don
-0004d730: 2774 2072 6574 7572 6e20 6120 6469 6374  't return a dict
-0004d740: 206f 6620 4461 7461 7365 7473 2e22 2c0a   of Datasets.",.
-0004d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d760: 4465 7072 6563 6174 696f 6e57 6172 6e69  DeprecationWarni
-0004d770: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-0004d780: 2020 2020 7374 6163 6b6c 6576 656c 3d32      stacklevel=2
-0004d790: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0004d7a0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-0004d7b0: 2020 2020 2020 2020 2064 696d 2069 7320           dim is 
-0004d7c0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0004d7d0: 206f 7220 286e 6f74 2069 7369 6e73 7461   or (not isinsta
-0004d7e0: 6e63 6528 6469 6d2c 2053 6571 7565 6e63  nce(dim, Sequenc
-0004d7f0: 6529 2061 6e64 2064 696d 2069 7320 6e6f  e) and dim is no
-0004d800: 7420 2e2e 2e29 0a20 2020 2020 2020 2020  t ...).         
-0004d810: 2020 206f 7220 6973 696e 7374 616e 6365     or isinstance
-0004d820: 2864 696d 2c20 7374 7229 0a20 2020 2020  (dim, str).     
-0004d830: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-0004d840: 2020 2320 5265 7475 726e 2069 6e74 2069    # Return int i
-0004d850: 6e64 6578 2069 6620 7369 6e67 6c65 2064  ndex if single d
-0004d860: 696d 656e 7369 6f6e 2069 7320 7061 7373  imension is pass
-0004d870: 6564 2c20 616e 6420 6973 206e 6f74 2070  ed, and is not p
-0004d880: 6172 7420 6f66 2061 0a20 2020 2020 2020  art of a.       
-0004d890: 2020 2020 2023 2073 6571 7565 6e63 650a       # sequence.
-0004d8a0: 2020 2020 2020 2020 2020 2020 6172 676d              argm
-0004d8b0: 696e 5f66 756e 6320 3d20 6765 7461 7474  in_func = getatt
-0004d8c0: 7228 6475 636b 5f61 7272 6179 5f6f 7073  r(duck_array_ops
-0004d8d0: 2c20 2261 7267 6d69 6e22 290a 2020 2020  , "argmin").    
-0004d8e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0004d8f0: 656c 662e 7265 6475 6365 280a 2020 2020  elf.reduce(.    
-0004d900: 2020 2020 2020 2020 2020 2020 6172 676d              argm
-0004d910: 696e 5f66 756e 632c 2064 696d 3d4e 6f6e  in_func, dim=Non
-0004d920: 6520 6966 2064 696d 2069 7320 4e6f 6e65  e if dim is None
-0004d930: 2065 6c73 6520 5b64 696d 5d2c 202a 2a6b   else [dim], **k
-0004d940: 7761 7267 730a 2020 2020 2020 2020 2020  wargs.          
-0004d950: 2020 290a 2020 2020 2020 2020 656c 7365    ).        else
-0004d960: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0004d970: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-0004d980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d990: 2257 6865 6e20 6469 6d20 6973 2061 2073  "When dim is a s
-0004d9a0: 6571 7565 6e63 6520 6f72 202e 2e2e 2c20  equence or ..., 
-0004d9b0: 4461 7461 4172 7261 792e 6172 676d 696e  DataArray.argmin
-0004d9c0: 2829 2072 6574 7572 6e73 2061 2064 6963  () returns a dic
-0004d9d0: 742e 2022 0a20 2020 2020 2020 2020 2020  t. ".           
-0004d9e0: 2020 2020 2022 6469 6374 7320 6361 6e6e       "dicts cann
-0004d9f0: 6f74 2062 6520 636f 6e74 6169 6e65 6420  ot be contained 
-0004da00: 696e 2061 2044 6174 6173 6574 2c20 736f  in a Dataset, so
-0004da10: 2063 616e 6e6f 7420 6361 6c6c 2022 0a20   cannot call ". 
-0004da20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0004da30: 4461 7461 7365 742e 6172 676d 696e 2829  Dataset.argmin()
-0004da40: 2077 6974 6820 6120 7365 7175 656e 6365   with a sequence
-0004da50: 206f 7220 2e2e 2e20 666f 7220 6469 6d22   or ... for dim"
-0004da60: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-0004da70: 2020 2020 6465 6620 6172 676d 6178 2873      def argmax(s
-0004da80: 656c 663a 2054 5f44 6174 6173 6574 2c20  elf: T_Dataset, 
-0004da90: 6469 6d3a 2048 6173 6861 626c 6520 7c20  dim: Hashable | 
-0004daa0: 4e6f 6e65 203d 204e 6f6e 652c 202a 2a6b  None = None, **k
-0004dab0: 7761 7267 7329 202d 3e20 545f 4461 7461  wargs) -> T_Data
-0004dac0: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
-0004dad0: 496e 6469 6365 7320 6f66 2074 6865 206d  Indices of the m
-0004dae0: 6178 696d 6120 6f66 2074 6865 206d 656d  axima of the mem
-0004daf0: 6265 7220 7661 7269 6162 6c65 732e 0a0a  ber variables...
-0004db00: 2020 2020 2020 2020 4966 2074 6865 7265          If there
-0004db10: 2061 7265 206d 756c 7469 706c 6520 6d61   are multiple ma
-0004db20: 7869 6d61 2c20 7468 6520 696e 6469 6365  xima, the indice
-0004db30: 7320 6f66 2074 6865 2066 6972 7374 206f  s of the first o
-0004db40: 6e65 2066 6f75 6e64 2077 696c 6c20 6265  ne found will be
-0004db50: 0a20 2020 2020 2020 2072 6574 7572 6e65  .        returne
-0004db60: 642e 0a0a 2020 2020 2020 2020 5061 7261  d...        Para
-0004db70: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-0004db80: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-0004db90: 2020 6469 6d20 3a20 7374 722c 206f 7074    dim : str, opt
-0004dba0: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-0004dbb0: 2020 5468 6520 6469 6d65 6e73 696f 6e20    The dimension 
-0004dbc0: 6f76 6572 2077 6869 6368 2074 6f20 6669  over which to fi
-0004dbd0: 6e64 2074 6865 206d 6178 696d 756d 2e20  nd the maximum. 
-0004dbe0: 4279 2064 6566 6175 6c74 2c20 6669 6e64  By default, find
-0004dbf0: 7320 6d61 7869 6d75 6d20 6f76 6572 0a20  s maximum over. 
-0004dc00: 2020 2020 2020 2020 2020 2061 6c6c 2064             all d
-0004dc10: 696d 656e 7369 6f6e 7320 2d20 666f 7220  imensions - for 
-0004dc20: 6e6f 7720 7265 7475 726e 696e 6720 616e  now returning an
-0004dc30: 2069 6e74 2066 6f72 2062 6163 6b77 6172   int for backwar
-0004dc40: 6420 636f 6d70 6174 6962 696c 6974 792c  d compatibility,
-0004dc50: 2062 7574 0a20 2020 2020 2020 2020 2020   but.           
-0004dc60: 2074 6869 7320 6973 2064 6570 7265 6361   this is depreca
-0004dc70: 7465 642c 2069 6e20 6675 7475 7265 2077  ted, in future w
-0004dc80: 696c 6c20 6265 2061 6e20 6572 726f 722c  ill be an error,
-0004dc90: 2073 696e 6365 2044 6174 6141 7272 6179   since DataArray
-0004dca0: 2e61 7267 6d61 7820 7769 6c6c 0a20 2020  .argmax will.   
-0004dcb0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0004dcc0: 6120 6469 6374 2077 6974 6820 696e 6469  a dict with indi
-0004dcd0: 6365 7320 666f 7220 616c 6c20 6469 6d65  ces for all dime
-0004dce0: 6e73 696f 6e73 2c20 7768 6963 6820 646f  nsions, which do
-0004dcf0: 6573 206e 6f74 206d 616b 6520 7365 6e73  es not make sens
-0004dd00: 6520 666f 720a 2020 2020 2020 2020 2020  e for.          
-0004dd10: 2020 6120 4461 7461 7365 742e 0a20 2020    a Dataset..   
-0004dd20: 2020 2020 206b 6565 705f 6174 7472 7320       keep_attrs 
-0004dd30: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
-0004dd40: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0004dd50: 5472 7565 2c20 7468 6520 6174 7472 6962  True, the attrib
-0004dd60: 7574 6573 2028 6061 7474 7273 6029 2077  utes (`attrs`) w
-0004dd70: 696c 6c20 6265 2063 6f70 6965 6420 6672  ill be copied fr
-0004dd80: 6f6d 2074 6865 206f 7269 6769 6e61 6c0a  om the original.
-0004dd90: 2020 2020 2020 2020 2020 2020 6f62 6a65              obje
-0004dda0: 6374 2074 6f20 7468 6520 6e65 7720 6f6e  ct to the new on
-0004ddb0: 652e 2020 4966 2046 616c 7365 2028 6465  e.  If False (de
-0004ddc0: 6661 756c 7429 2c20 7468 6520 6e65 7720  fault), the new 
-0004ddd0: 6f62 6a65 6374 2077 696c 6c20 6265 0a20  object will be. 
-0004dde0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0004ddf0: 6e65 6420 7769 7468 6f75 7420 6174 7472  ned without attr
-0004de00: 6962 7574 6573 2e0a 2020 2020 2020 2020  ibutes..        
-0004de10: 736b 6970 6e61 203a 2062 6f6f 6c2c 206f  skipna : bool, o
-0004de20: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-0004de30: 2020 2020 4966 2054 7275 652c 2073 6b69      If True, ski
-0004de40: 7020 6d69 7373 696e 6720 7661 6c75 6573  p missing values
-0004de50: 2028 6173 206d 6172 6b65 6420 6279 204e   (as marked by N
-0004de60: 614e 292e 2042 7920 6465 6661 756c 742c  aN). By default,
-0004de70: 206f 6e6c 790a 2020 2020 2020 2020 2020   only.          
-0004de80: 2020 736b 6970 7320 6d69 7373 696e 6720    skips missing 
-0004de90: 7661 6c75 6573 2066 6f72 2066 6c6f 6174  values for float
-0004dea0: 2064 7479 7065 733b 206f 7468 6572 2064   dtypes; other d
-0004deb0: 7479 7065 7320 6569 7468 6572 2064 6f20  types either do 
-0004dec0: 6e6f 740a 2020 2020 2020 2020 2020 2020  not.            
-0004ded0: 6861 7665 2061 2073 656e 7469 6e65 6c20  have a sentinel 
-0004dee0: 6d69 7373 696e 6720 7661 6c75 6520 2869  missing value (i
-0004def0: 6e74 2920 6f72 2073 6b69 706e 613d 5472  nt) or skipna=Tr
-0004df00: 7565 2068 6173 206e 6f74 2062 6565 6e0a  ue has not been.
-0004df10: 2020 2020 2020 2020 2020 2020 696d 706c              impl
-0004df20: 656d 656e 7465 6420 286f 626a 6563 742c  emented (object,
-0004df30: 2064 6174 6574 696d 6536 3420 6f72 2074   datetime64 or t
-0004df40: 696d 6564 656c 7461 3634 292e 0a0a 2020  imedelta64)...  
-0004df50: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-0004df60: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-0004df70: 2020 2020 2020 7265 7375 6c74 203a 2044        result : D
-0004df80: 6174 6173 6574 0a0a 2020 2020 2020 2020  ataset..        
-0004df90: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-0004dfa0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-0004dfb0: 2020 4461 7461 4172 7261 792e 6172 676d    DataArray.argm
-0004dfc0: 6178 0a0a 2020 2020 2020 2020 2222 220a  ax..        """.
-0004dfd0: 2020 2020 2020 2020 6966 2064 696d 2069          if dim i
-0004dfe0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0004dff0: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
-0004e000: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-0004e010: 2020 2022 4f6e 6365 2074 6865 2062 6568     "Once the beh
-0004e020: 6176 696f 7572 206f 6620 4461 7461 4172  aviour of DataAr
-0004e030: 7261 792e 6172 676d 696e 2829 2061 6e64  ray.argmin() and
-0004e040: 2056 6172 6961 626c 652e 6172 676d 696e   Variable.argmin
-0004e050: 2829 2077 6974 686f 7574 2022 0a20 2020  () without ".   
-0004e060: 2020 2020 2020 2020 2020 2020 2022 6469               "di
-0004e070: 6d20 6368 616e 6765 7320 746f 2072 6574  m changes to ret
-0004e080: 7572 6e20 6120 6469 6374 206f 6620 696e  urn a dict of in
-0004e090: 6469 6365 7320 6f66 2065 6163 6820 6469  dices of each di
-0004e0a0: 6d65 6e73 696f 6e2c 2066 6f72 2022 0a20  mension, for ". 
-0004e0b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0004e0c0: 636f 6e73 6973 7465 6e63 7920 6974 2077  consistency it w
-0004e0d0: 696c 6c20 6265 2061 6e20 6572 726f 7220  ill be an error 
-0004e0e0: 746f 2063 616c 6c20 4461 7461 7365 742e  to call Dataset.
-0004e0f0: 6172 676d 696e 2829 2077 6974 6820 6e6f  argmin() with no
-0004e100: 2061 7267 756d 656e 742c 220a 2020 2020   argument,".    
-0004e110: 2020 2020 2020 2020 2020 2020 2273 696e              "sin
-0004e120: 6365 2077 6520 646f 6e27 7420 7265 7475  ce we don't retu
-0004e130: 726e 2061 2064 6963 7420 6f66 2044 6174  rn a dict of Dat
-0004e140: 6173 6574 732e 222c 0a20 2020 2020 2020  asets.",.       
-0004e150: 2020 2020 2020 2020 2044 6570 7265 6361           Depreca
-0004e160: 7469 6f6e 5761 726e 696e 672c 0a20 2020  tionWarning,.   
-0004e170: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-0004e180: 636b 6c65 7665 6c3d 322c 0a20 2020 2020  cklevel=2,.     
-0004e190: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0004e1a0: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
-0004e1b0: 2020 6469 6d20 6973 204e 6f6e 650a 2020    dim is None.  
-0004e1c0: 2020 2020 2020 2020 2020 6f72 2028 6e6f            or (no
-0004e1d0: 7420 6973 696e 7374 616e 6365 2864 696d  t isinstance(dim
-0004e1e0: 2c20 5365 7175 656e 6365 2920 616e 6420  , Sequence) and 
-0004e1f0: 6469 6d20 6973 206e 6f74 202e 2e2e 290a  dim is not ...).
-0004e200: 2020 2020 2020 2020 2020 2020 6f72 2069              or i
-0004e210: 7369 6e73 7461 6e63 6528 6469 6d2c 2073  sinstance(dim, s
-0004e220: 7472 290a 2020 2020 2020 2020 293a 0a20  tr).        ):. 
-0004e230: 2020 2020 2020 2020 2020 2023 2052 6574             # Ret
-0004e240: 7572 6e20 696e 7420 696e 6465 7820 6966  urn int index if
-0004e250: 2073 696e 676c 6520 6469 6d65 6e73 696f   single dimensio
-0004e260: 6e20 6973 2070 6173 7365 642c 2061 6e64  n is passed, and
-0004e270: 2069 7320 6e6f 7420 7061 7274 206f 6620   is not part of 
-0004e280: 610a 2020 2020 2020 2020 2020 2020 2320  a.            # 
-0004e290: 7365 7175 656e 6365 0a20 2020 2020 2020  sequence.       
-0004e2a0: 2020 2020 2061 7267 6d61 785f 6675 6e63       argmax_func
-0004e2b0: 203d 2067 6574 6174 7472 2864 7563 6b5f   = getattr(duck_
-0004e2c0: 6172 7261 795f 6f70 732c 2022 6172 676d  array_ops, "argm
-0004e2d0: 6178 2229 0a20 2020 2020 2020 2020 2020  ax").           
-0004e2e0: 2072 6574 7572 6e20 7365 6c66 2e72 6564   return self.red
-0004e2f0: 7563 6528 0a20 2020 2020 2020 2020 2020  uce(.           
-0004e300: 2020 2020 2061 7267 6d61 785f 6675 6e63       argmax_func
-0004e310: 2c20 6469 6d3d 4e6f 6e65 2069 6620 6469  , dim=None if di
-0004e320: 6d20 6973 204e 6f6e 6520 656c 7365 205b  m is None else [
-0004e330: 6469 6d5d 2c20 2a2a 6b77 6172 6773 0a20  dim], **kwargs. 
-0004e340: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0004e350: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0004e360: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0004e370: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-0004e380: 2020 2020 2020 2020 2022 5768 656e 2064           "When d
-0004e390: 696d 2069 7320 6120 7365 7175 656e 6365  im is a sequence
-0004e3a0: 206f 7220 2e2e 2e2c 2044 6174 6141 7272   or ..., DataArr
-0004e3b0: 6179 2e61 7267 6d69 6e28 2920 7265 7475  ay.argmin() retu
-0004e3c0: 726e 7320 6120 6469 6374 2e20 220a 2020  rns a dict. ".  
-0004e3d0: 2020 2020 2020 2020 2020 2020 2020 2264                "d
-0004e3e0: 6963 7473 2063 616e 6e6f 7420 6265 2063  icts cannot be c
-0004e3f0: 6f6e 7461 696e 6564 2069 6e20 6120 4461  ontained in a Da
-0004e400: 7461 7365 742c 2073 6f20 6361 6e6e 6f74  taset, so cannot
-0004e410: 2063 616c 6c20 220a 2020 2020 2020 2020   call ".        
-0004e420: 2020 2020 2020 2020 2244 6174 6173 6574          "Dataset
-0004e430: 2e61 7267 6d69 6e28 2920 7769 7468 2061  .argmin() with a
-0004e440: 2073 6571 7565 6e63 6520 6f72 202e 2e2e   sequence or ...
-0004e450: 2066 6f72 2064 696d 220a 2020 2020 2020   for dim".      
-0004e460: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-0004e470: 2071 7565 7279 280a 2020 2020 2020 2020   query(.        
-0004e480: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-0004e490: 0a20 2020 2020 2020 2071 7565 7269 6573  .        queries
-0004e4a0: 3a20 4d61 7070 696e 675b 416e 792c 2041  : Mapping[Any, A
-0004e4b0: 6e79 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ny] | None = Non
-0004e4c0: 652c 0a20 2020 2020 2020 2070 6172 7365  e,.        parse
-0004e4d0: 723a 2051 7565 7279 5061 7273 6572 4f70  r: QueryParserOp
-0004e4e0: 7469 6f6e 7320 3d20 2270 616e 6461 7322  tions = "pandas"
-0004e4f0: 2c0a 2020 2020 2020 2020 656e 6769 6e65  ,.        engine
-0004e500: 3a20 5175 6572 7945 6e67 696e 654f 7074  : QueryEngineOpt
-0004e510: 696f 6e73 203d 204e 6f6e 652c 0a20 2020  ions = None,.   
-0004e520: 2020 2020 206d 6973 7369 6e67 5f64 696d       missing_dim
-0004e530: 733a 2045 7272 6f72 4f70 7469 6f6e 7357  s: ErrorOptionsW
-0004e540: 6974 6857 6172 6e20 3d20 2272 6169 7365  ithWarn = "raise
-0004e550: 222c 0a20 2020 2020 2020 202a 2a71 7565  ",.        **que
-0004e560: 7269 6573 5f6b 7761 7267 733a 2041 6e79  ries_kwargs: Any
-0004e570: 2c0a 2020 2020 2920 2d3e 2054 5f44 6174  ,.    ) -> T_Dat
-0004e580: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
-0004e590: 2252 6574 7572 6e20 6120 6e65 7720 6461  "Return a new da
-0004e5a0: 7461 7365 7420 7769 7468 2065 6163 6820  taset with each 
-0004e5b0: 6172 7261 7920 696e 6465 7865 6420 616c  array indexed al
-0004e5c0: 6f6e 6720 7468 6520 7370 6563 6966 6965  ong the specifie
-0004e5d0: 640a 2020 2020 2020 2020 6469 6d65 6e73  d.        dimens
-0004e5e0: 696f 6e28 7329 2c20 7768 6572 6520 7468  ion(s), where th
-0004e5f0: 6520 696e 6465 7865 7273 2061 7265 2067  e indexers are g
-0004e600: 6976 656e 2061 7320 7374 7269 6e67 7320  iven as strings 
-0004e610: 636f 6e74 6169 6e69 6e67 0a20 2020 2020  containing.     
-0004e620: 2020 2050 7974 686f 6e20 6578 7072 6573     Python expres
-0004e630: 7369 6f6e 7320 746f 2062 6520 6576 616c  sions to be eval
-0004e640: 7561 7465 6420 6167 6169 6e73 7420 7468  uated against th
-0004e650: 6520 6461 7461 2076 6172 6961 626c 6573  e data variables
-0004e660: 2069 6e20 7468 650a 2020 2020 2020 2020   in the.        
-0004e670: 6461 7461 7365 742e 0a0a 2020 2020 2020  dataset...      
-0004e680: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-0004e690: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-0004e6a0: 2020 2020 2020 2020 7175 6572 6965 7320          queries 
-0004e6b0: 3a20 6469 6374 2d6c 696b 652c 206f 7074  : dict-like, opt
-0004e6c0: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-0004e6d0: 2020 4120 6469 6374 2d6c 696b 6520 7769    A dict-like wi
-0004e6e0: 7468 206b 6579 7320 6d61 7463 6869 6e67  th keys matching
-0004e6f0: 2064 696d 656e 7369 6f6e 7320 616e 6420   dimensions and 
-0004e700: 7661 6c75 6573 2067 6976 656e 2062 7920  values given by 
-0004e710: 7374 7269 6e67 730a 2020 2020 2020 2020  strings.        
-0004e720: 2020 2020 636f 6e74 6169 6e69 6e67 2050      containing P
-0004e730: 7974 686f 6e20 6578 7072 6573 7369 6f6e  ython expression
-0004e740: 7320 746f 2062 6520 6576 616c 7561 7465  s to be evaluate
-0004e750: 6420 6167 6169 6e73 7420 7468 6520 6461  d against the da
-0004e760: 7461 2076 6172 6961 626c 6573 0a20 2020  ta variables.   
-0004e770: 2020 2020 2020 2020 2069 6e20 7468 6520           in the 
-0004e780: 6461 7461 7365 742e 2054 6865 2065 7870  dataset. The exp
-0004e790: 7265 7373 696f 6e73 2077 696c 6c20 6265  ressions will be
-0004e7a0: 2065 7661 6c75 6174 6564 2075 7369 6e67   evaluated using
-0004e7b0: 2074 6865 2070 616e 6461 730a 2020 2020   the pandas.    
-0004e7c0: 2020 2020 2020 2020 6576 616c 2829 2066          eval() f
-0004e7d0: 756e 6374 696f 6e2c 2061 6e64 2063 616e  unction, and can
-0004e7e0: 2063 6f6e 7461 696e 2061 6e79 2076 616c   contain any val
-0004e7f0: 6964 2050 7974 686f 6e20 6578 7072 6573  id Python expres
-0004e800: 7369 6f6e 7320 6275 7420 6361 6e6e 6f74  sions but cannot
-0004e810: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-0004e820: 7461 696e 2061 6e79 2050 7974 686f 6e20  tain any Python 
-0004e830: 7374 6174 656d 656e 7473 2e0a 2020 2020  statements..    
-0004e840: 2020 2020 7061 7273 6572 203a 207b 2270      parser : {"p
-0004e850: 616e 6461 7322 2c20 2270 7974 686f 6e22  andas", "python"
-0004e860: 7d2c 2064 6566 6175 6c74 3a20 2270 616e  }, default: "pan
-0004e870: 6461 7322 0a20 2020 2020 2020 2020 2020  das".           
-0004e880: 2054 6865 2070 6172 7365 7220 746f 2075   The parser to u
-0004e890: 7365 2074 6f20 636f 6e73 7472 7563 7420  se to construct 
-0004e8a0: 7468 6520 7379 6e74 6178 2074 7265 6520  the syntax tree 
-0004e8b0: 6672 6f6d 2074 6865 2065 7870 7265 7373  from the express
-0004e8c0: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
-0004e8d0: 2054 6865 2064 6566 6175 6c74 206f 6620   The default of 
-0004e8e0: 2770 616e 6461 7327 2070 6172 7365 7320  'pandas' parses 
-0004e8f0: 636f 6465 2073 6c69 6768 746c 7920 6469  code slightly di
-0004e900: 6666 6572 656e 7420 7468 616e 2073 7461  fferent than sta
-0004e910: 6e64 6172 640a 2020 2020 2020 2020 2020  ndard.          
-0004e920: 2020 5079 7468 6f6e 2e20 416c 7465 726e    Python. Altern
-0004e930: 6174 6976 656c 792c 2079 6f75 2063 616e  atively, you can
-0004e940: 2070 6172 7365 2061 6e20 6578 7072 6573   parse an expres
-0004e950: 7369 6f6e 2075 7369 6e67 2074 6865 2027  sion using the '
-0004e960: 7079 7468 6f6e 270a 2020 2020 2020 2020  python'.        
-0004e970: 2020 2020 7061 7273 6572 2074 6f20 7265      parser to re
-0004e980: 7461 696e 2073 7472 6963 7420 5079 7468  tain strict Pyth
-0004e990: 6f6e 2073 656d 616e 7469 6373 2e0a 2020  on semantics..  
-0004e9a0: 2020 2020 2020 656e 6769 6e65 203a 207b        engine : {
-0004e9b0: 2270 7974 686f 6e22 2c20 226e 756d 6578  "python", "numex
-0004e9c0: 7072 222c 204e 6f6e 657d 2c20 6465 6661  pr", None}, defa
-0004e9d0: 756c 743a 204e 6f6e 650a 2020 2020 2020  ult: None.      
-0004e9e0: 2020 2020 2020 5468 6520 656e 6769 6e65        The engine
-0004e9f0: 2075 7365 6420 746f 2065 7661 6c75 6174   used to evaluat
-0004ea00: 6520 7468 6520 6578 7072 6573 7369 6f6e  e the expression
-0004ea10: 2e20 5375 7070 6f72 7465 6420 656e 6769  . Supported engi
-0004ea20: 6e65 7320 6172 653a 0a0a 2020 2020 2020  nes are:..      
-0004ea30: 2020 2020 2020 2d20 4e6f 6e65 3a20 7472        - None: tr
-0004ea40: 6965 7320 746f 2075 7365 206e 756d 6578  ies to use numex
-0004ea50: 7072 2c20 6661 6c6c 7320 6261 636b 2074  pr, falls back t
-0004ea60: 6f20 7079 7468 6f6e 0a20 2020 2020 2020  o python.       
-0004ea70: 2020 2020 202d 2022 6e75 6d65 7870 7222       - "numexpr"
-0004ea80: 3a20 6576 616c 7561 7465 7320 6578 7072  : evaluates expr
-0004ea90: 6573 7369 6f6e 7320 7573 696e 6720 6e75  essions using nu
-0004eaa0: 6d65 7870 720a 2020 2020 2020 2020 2020  mexpr.          
-0004eab0: 2020 2d20 2270 7974 686f 6e22 3a20 7065    - "python": pe
-0004eac0: 7266 6f72 6d73 206f 7065 7261 7469 6f6e  rforms operation
-0004ead0: 7320 6173 2069 6620 796f 7520 6861 6420  s as if you had 
-0004eae0: 6576 616c e280 9964 2069 6e20 746f 7020  eval...d in top 
-0004eaf0: 6c65 7665 6c20 7079 7468 6f6e 0a0a 2020  level python..  
-0004eb00: 2020 2020 2020 6d69 7373 696e 675f 6469        missing_di
-0004eb10: 6d73 203a 207b 2272 6169 7365 222c 2022  ms : {"raise", "
-0004eb20: 7761 726e 222c 2022 6967 6e6f 7265 227d  warn", "ignore"}
-0004eb30: 2c20 6465 6661 756c 743a 2022 7261 6973  , default: "rais
-0004eb40: 6522 0a20 2020 2020 2020 2020 2020 2057  e".            W
-0004eb50: 6861 7420 746f 2064 6f20 6966 2064 696d  hat to do if dim
-0004eb60: 656e 7369 6f6e 7320 7468 6174 2073 686f  ensions that sho
-0004eb70: 756c 6420 6265 2073 656c 6563 7465 6420  uld be selected 
-0004eb80: 6672 6f6d 2061 7265 206e 6f74 2070 7265  from are not pre
-0004eb90: 7365 6e74 2069 6e20 7468 650a 2020 2020  sent in the.    
-0004eba0: 2020 2020 2020 2020 4461 7461 7365 743a          Dataset:
-0004ebb0: 0a0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
-0004ebc0: 2272 6169 7365 223a 2072 6169 7365 2061  "raise": raise a
-0004ebd0: 6e20 6578 6365 7074 696f 6e0a 2020 2020  n exception.    
-0004ebe0: 2020 2020 2020 2020 2d20 2277 6172 6e22          - "warn"
-0004ebf0: 3a20 7261 6973 6520 6120 7761 726e 696e  : raise a warnin
-0004ec00: 672c 2061 6e64 2069 676e 6f72 6520 7468  g, and ignore th
-0004ec10: 6520 6d69 7373 696e 6720 6469 6d65 6e73  e missing dimens
-0004ec20: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
-0004ec30: 202d 2022 6967 6e6f 7265 223a 2069 676e   - "ignore": ign
-0004ec40: 6f72 6520 7468 6520 6d69 7373 696e 6720  ore the missing 
-0004ec50: 6469 6d65 6e73 696f 6e73 0a0a 2020 2020  dimensions..    
-0004ec60: 2020 2020 2a2a 7175 6572 6965 735f 6b77      **queries_kw
-0004ec70: 6172 6773 203a 207b 6469 6d3a 2071 7565  args : {dim: que
-0004ec80: 7279 2c20 2e2e 2e7d 2c20 6f70 7469 6f6e  ry, ...}, option
-0004ec90: 616c 0a20 2020 2020 2020 2020 2020 2054  al.            T
-0004eca0: 6865 206b 6579 776f 7264 2061 7267 756d  he keyword argum
-0004ecb0: 656e 7473 2066 6f72 6d20 6f66 2060 6071  ents form of ``q
-0004ecc0: 7565 7269 6573 6060 2e0a 2020 2020 2020  ueries``..      
-0004ecd0: 2020 2020 2020 4f6e 6520 6f66 2071 7565        One of que
-0004ece0: 7269 6573 206f 7220 7175 6572 6965 735f  ries or queries_
-0004ecf0: 6b77 6172 6773 206d 7573 7420 6265 2070  kwargs must be p
-0004ed00: 726f 7669 6465 642e 0a0a 2020 2020 2020  rovided...      
-0004ed10: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-0004ed20: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-0004ed30: 2020 6f62 6a20 3a20 4461 7461 7365 740a    obj : Dataset.
-0004ed40: 2020 2020 2020 2020 2020 2020 4120 6e65              A ne
-0004ed50: 7720 4461 7461 7365 7420 7769 7468 2074  w Dataset with t
-0004ed60: 6865 2073 616d 6520 636f 6e74 656e 7473  he same contents
-0004ed70: 2061 7320 7468 6973 2064 6174 6173 6574   as this dataset
-0004ed80: 2c20 6578 6365 7074 2065 6163 680a 2020  , except each.  
-0004ed90: 2020 2020 2020 2020 2020 6172 7261 7920            array 
-0004eda0: 616e 6420 6469 6d65 6e73 696f 6e20 6973  and dimension is
-0004edb0: 2069 6e64 6578 6564 2062 7920 7468 6520   indexed by the 
-0004edc0: 7265 7375 6c74 7320 6f66 2074 6865 2061  results of the a
-0004edd0: 7070 726f 7072 6961 7465 0a20 2020 2020  ppropriate.     
-0004ede0: 2020 2020 2020 2071 7565 7269 6573 2e0a         queries..
-0004edf0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-0004ee00: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-0004ee10: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
-0004ee20: 6574 2e69 7365 6c0a 2020 2020 2020 2020  et.isel.        
-0004ee30: 7061 6e64 6173 2e65 7661 6c0a 0a20 2020  pandas.eval..   
-0004ee40: 2020 2020 2045 7861 6d70 6c65 730a 2020       Examples.  
-0004ee50: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-0004ee60: 2020 2020 2020 203e 3e3e 2061 203d 206e         >>> a = n
-0004ee70: 702e 6172 616e 6765 2830 2c20 352c 2031  p.arange(0, 5, 1
-0004ee80: 290a 2020 2020 2020 2020 3e3e 3e20 6220  ).        >>> b 
-0004ee90: 3d20 6e70 2e6c 696e 7370 6163 6528 302c  = np.linspace(0,
-0004eea0: 2031 2c20 3529 0a20 2020 2020 2020 203e   1, 5).        >
-0004eeb0: 3e3e 2064 7320 3d20 7872 2e44 6174 6173  >> ds = xr.Datas
-0004eec0: 6574 287b 2261 223a 2028 2278 222c 2061  et({"a": ("x", a
-0004eed0: 292c 2022 6222 3a20 2822 7822 2c20 6229  ), "b": ("x", b)
-0004eee0: 7d29 0a20 2020 2020 2020 203e 3e3e 2064  }).        >>> d
-0004eef0: 730a 2020 2020 2020 2020 3c78 6172 7261  s.        <xarra
-0004ef00: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-0004ef10: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-0004ef20: 2878 3a20 3529 0a20 2020 2020 2020 2044  (x: 5).        D
-0004ef30: 696d 656e 7369 6f6e 7320 7769 7468 6f75  imensions withou
-0004ef40: 7420 636f 6f72 6469 6e61 7465 733a 2078  t coordinates: x
-0004ef50: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-0004ef60: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-0004ef70: 2020 2020 2061 2020 2020 2020 2020 2878       a        (x
-0004ef80: 2920 696e 7436 3420 3020 3120 3220 3320  ) int64 0 1 2 3 
-0004ef90: 340a 2020 2020 2020 2020 2020 2020 6220  4.            b 
-0004efa0: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
-0004efb0: 3634 2030 2e30 2030 2e32 3520 302e 3520  64 0.0 0.25 0.5 
-0004efc0: 302e 3735 2031 2e30 0a20 2020 2020 2020  0.75 1.0.       
-0004efd0: 203e 3e3e 2064 732e 7175 6572 7928 783d   >>> ds.query(x=
-0004efe0: 2261 203e 2032 2229 0a20 2020 2020 2020  "a > 2").       
-0004eff0: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-0004f000: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-0004f010: 696f 6e73 3a20 2028 783a 2032 290a 2020  ions:  (x: 2).  
-0004f020: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
-0004f030: 2077 6974 686f 7574 2063 6f6f 7264 696e   without coordin
-0004f040: 6174 6573 3a20 780a 2020 2020 2020 2020  ates: x.        
-0004f050: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
-0004f060: 2020 2020 2020 2020 2020 2020 6120 2020              a   
-0004f070: 2020 2020 2028 7829 2069 6e74 3634 2033       (x) int64 3
-0004f080: 2034 0a20 2020 2020 2020 2020 2020 2062   4.            b
-0004f090: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
-0004f0a0: 7436 3420 302e 3735 2031 2e30 0a20 2020  t64 0.75 1.0.   
-0004f0b0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0004f0c0: 2020 2320 616c 6c6f 7720 7175 6572 6965    # allow querie
-0004f0d0: 7320 746f 2062 6520 6769 7665 6e20 6569  s to be given ei
-0004f0e0: 7468 6572 2061 7320 6120 6469 6374 206f  ther as a dict o
-0004f0f0: 7220 6173 206b 7761 7267 730a 2020 2020  r as kwargs.    
-0004f100: 2020 2020 7175 6572 6965 7320 3d20 6569      queries = ei
-0004f110: 7468 6572 5f64 6963 745f 6f72 5f6b 7761  ther_dict_or_kwa
-0004f120: 7267 7328 7175 6572 6965 732c 2071 7565  rgs(queries, que
-0004f130: 7269 6573 5f6b 7761 7267 732c 2022 7175  ries_kwargs, "qu
-0004f140: 6572 7922 290a 0a20 2020 2020 2020 2023  ery")..        #
-0004f150: 2063 6865 636b 2071 7565 7269 6573 0a20   check queries. 
-0004f160: 2020 2020 2020 2066 6f72 2064 696d 2c20         for dim, 
-0004f170: 6578 7072 2069 6e20 7175 6572 6965 732e  expr in queries.
-0004f180: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0004f190: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-0004f1a0: 7374 616e 6365 2865 7870 722c 2073 7472  stance(expr, str
-0004f1b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0004f1c0: 2020 206d 7367 203d 2066 2265 7870 7220     msg = f"expr 
-0004f1d0: 666f 7220 6469 6d20 7b64 696d 7d20 6d75  for dim {dim} mu
-0004f1e0: 7374 2062 6520 6120 7374 7269 6e67 2074  st be a string t
-0004f1f0: 6f20 6265 2065 7661 6c75 6174 6564 2c20  o be evaluated, 
-0004f200: 7b74 7970 6528 6578 7072 297d 2067 6976  {type(expr)} giv
-0004f210: 656e 220a 2020 2020 2020 2020 2020 2020  en".            
-0004f220: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0004f230: 7272 6f72 286d 7367 290a 0a20 2020 2020  rror(msg)..     
-0004f240: 2020 2023 2065 7661 6c75 6174 6520 7468     # evaluate th
-0004f250: 6520 7175 6572 6965 7320 746f 2063 7265  e queries to cre
-0004f260: 6174 6520 7468 6520 696e 6465 7865 7273  ate the indexers
-0004f270: 0a20 2020 2020 2020 2069 6e64 6578 6572  .        indexer
-0004f280: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-0004f290: 2020 6469 6d3a 2070 642e 6576 616c 2865    dim: pd.eval(e
-0004f2a0: 7870 722c 2072 6573 6f6c 7665 7273 3d5b  xpr, resolvers=[
-0004f2b0: 7365 6c66 5d2c 2070 6172 7365 723d 7061  self], parser=pa
-0004f2c0: 7273 6572 2c20 656e 6769 6e65 3d65 6e67  rser, engine=eng
-0004f2d0: 696e 6529 0a20 2020 2020 2020 2020 2020  ine).           
-0004f2e0: 2066 6f72 2064 696d 2c20 6578 7072 2069   for dim, expr i
-0004f2f0: 6e20 7175 6572 6965 732e 6974 656d 7328  n queries.items(
-0004f300: 290a 2020 2020 2020 2020 7d0a 0a20 2020  ).        }..   
-0004f310: 2020 2020 2023 2061 7070 6c79 2074 6865       # apply the
-0004f320: 2073 656c 6563 7469 6f6e 0a20 2020 2020   selection.     
-0004f330: 2020 2072 6574 7572 6e20 7365 6c66 2e69     return self.i
-0004f340: 7365 6c28 696e 6465 7865 7273 2c20 6d69  sel(indexers, mi
-0004f350: 7373 696e 675f 6469 6d73 3d6d 6973 7369  ssing_dims=missi
-0004f360: 6e67 5f64 696d 7329 0a0a 2020 2020 6465  ng_dims)..    de
-0004f370: 6620 6375 7276 6566 6974 280a 2020 2020  f curvefit(.    
-0004f380: 2020 2020 7365 6c66 3a20 545f 4461 7461      self: T_Data
-0004f390: 7365 742c 0a20 2020 2020 2020 2063 6f6f  set,.        coo
-0004f3a0: 7264 733a 2073 7472 207c 2044 6174 6141  rds: str | DataA
-0004f3b0: 7272 6179 207c 2049 7465 7261 626c 655b  rray | Iterable[
-0004f3c0: 7374 7220 7c20 4461 7461 4172 7261 795d  str | DataArray]
-0004f3d0: 2c0a 2020 2020 2020 2020 6675 6e63 3a20  ,.        func: 
-0004f3e0: 4361 6c6c 6162 6c65 5b2e 2e2e 2c20 416e  Callable[..., An
-0004f3f0: 795d 2c0a 2020 2020 2020 2020 7265 6475  y],.        redu
-0004f400: 6365 5f64 696d 733a 2044 696d 7320 3d20  ce_dims: Dims = 
-0004f410: 4e6f 6e65 2c0a 2020 2020 2020 2020 736b  None,.        sk
-0004f420: 6970 6e61 3a20 626f 6f6c 203d 2054 7275  ipna: bool = Tru
-0004f430: 652c 0a20 2020 2020 2020 2070 303a 2064  e,.        p0: d
-0004f440: 6963 745b 7374 722c 2041 6e79 5d20 7c20  ict[str, Any] | 
-0004f450: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-0004f460: 2020 2020 2062 6f75 6e64 733a 2064 6963       bounds: dic
-0004f470: 745b 7374 722c 2041 6e79 5d20 7c20 4e6f  t[str, Any] | No
-0004f480: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
-0004f490: 2020 2070 6172 616d 5f6e 616d 6573 3a20     param_names: 
-0004f4a0: 5365 7175 656e 6365 5b73 7472 5d20 7c20  Sequence[str] | 
-0004f4b0: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-0004f4c0: 2020 2020 206b 7761 7267 733a 2064 6963       kwargs: dic
-0004f4d0: 745b 7374 722c 2041 6e79 5d20 7c20 4e6f  t[str, Any] | No
-0004f4e0: 6e65 203d 204e 6f6e 652c 0a20 2020 2029  ne = None,.    )
-0004f4f0: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
-0004f500: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0004f510: 2020 2043 7572 7665 2066 6974 7469 6e67     Curve fitting
-0004f520: 206f 7074 696d 697a 6174 696f 6e20 666f   optimization fo
-0004f530: 7220 6172 6269 7472 6172 7920 6675 6e63  r arbitrary func
-0004f540: 7469 6f6e 732e 0a0a 2020 2020 2020 2020  tions...        
-0004f550: 5772 6170 7320 6073 6369 7079 2e6f 7074  Wraps `scipy.opt
-0004f560: 696d 697a 652e 6375 7276 655f 6669 7460  imize.curve_fit`
-0004f570: 2077 6974 6820 6061 7070 6c79 5f75 6675   with `apply_ufu
-0004f580: 6e63 602e 0a0a 2020 2020 2020 2020 5061  nc`...        Pa
-0004f590: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-0004f5a0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-0004f5b0: 2020 2020 636f 6f72 6473 203a 2068 6173      coords : has
-0004f5c0: 6861 626c 652c 2044 6174 6141 7272 6179  hable, DataArray
-0004f5d0: 2c20 6f72 2073 6571 7565 6e63 6520 6f66  , or sequence of
-0004f5e0: 2068 6173 6861 626c 6520 6f72 2044 6174   hashable or Dat
-0004f5f0: 6141 7272 6179 0a20 2020 2020 2020 2020  aArray.         
-0004f600: 2020 2049 6e64 6570 656e 6465 6e74 2063     Independent c
-0004f610: 6f6f 7264 696e 6174 6528 7329 206f 7665  oordinate(s) ove
-0004f620: 7220 7768 6963 6820 746f 2070 6572 666f  r which to perfo
-0004f630: 726d 2074 6865 2063 7572 7665 2066 6974  rm the curve fit
-0004f640: 7469 6e67 2e20 4d75 7374 2073 6861 7265  ting. Must share
-0004f650: 0a20 2020 2020 2020 2020 2020 2061 7420  .            at 
-0004f660: 6c65 6173 7420 6f6e 6520 6469 6d65 6e73  least one dimens
-0004f670: 696f 6e20 7769 7468 2074 6865 2063 616c  ion with the cal
-0004f680: 6c69 6e67 206f 626a 6563 742e 2057 6865  ling object. Whe
-0004f690: 6e20 6669 7474 696e 6720 6d75 6c74 692d  n fitting multi-
-0004f6a0: 6469 6d65 6e73 696f 6e61 6c0a 2020 2020  dimensional.    
-0004f6b0: 2020 2020 2020 2020 6675 6e63 7469 6f6e          function
-0004f6c0: 732c 2073 7570 706c 7920 6063 6f6f 7264  s, supply `coord
-0004f6d0: 7360 2061 7320 6120 7365 7175 656e 6365  s` as a sequence
-0004f6e0: 2069 6e20 7468 6520 7361 6d65 206f 7264   in the same ord
-0004f6f0: 6572 2061 7320 6172 6775 6d65 6e74 7320  er as arguments 
-0004f700: 696e 0a20 2020 2020 2020 2020 2020 2060  in.            `
-0004f710: 6675 6e63 602e 2054 6f20 6669 7420 616c  func`. To fit al
-0004f720: 6f6e 6720 6578 6973 7469 6e67 2064 696d  ong existing dim
-0004f730: 656e 7369 6f6e 7320 6f66 2074 6865 2063  ensions of the c
-0004f740: 616c 6c69 6e67 206f 626a 6563 742c 2060  alling object, `
-0004f750: 636f 6f72 6473 6020 6361 6e0a 2020 2020  coords` can.    
-0004f760: 2020 2020 2020 2020 616c 736f 2062 6520          also be 
-0004f770: 7370 6563 6966 6965 6420 6173 2061 2073  specified as a s
-0004f780: 7472 206f 7220 7365 7175 656e 6365 206f  tr or sequence o
-0004f790: 6620 7374 7273 2e0a 2020 2020 2020 2020  f strs..        
-0004f7a0: 6675 6e63 203a 2063 616c 6c61 626c 650a  func : callable.
-0004f7b0: 2020 2020 2020 2020 2020 2020 5573 6572              User
-0004f7c0: 2073 7065 6369 6669 6564 2066 756e 6374   specified funct
-0004f7d0: 696f 6e20 696e 2074 6865 2066 6f72 6d20  ion in the form 
-0004f7e0: 6066 2878 2c20 2a70 6172 616d 7329 6020  `f(x, *params)` 
-0004f7f0: 7768 6963 6820 7265 7475 726e 7320 6120  which returns a 
-0004f800: 6e75 6d70 790a 2020 2020 2020 2020 2020  numpy.          
-0004f810: 2020 6172 7261 7920 6f66 206c 656e 6774    array of lengt
-0004f820: 6820 606c 656e 2878 2960 2e20 6070 6172  h `len(x)`. `par
-0004f830: 616d 7360 2061 7265 2074 6865 2066 6974  ams` are the fit
-0004f840: 7461 626c 6520 7061 7261 6d65 7465 7273  table parameters
-0004f850: 2077 6869 6368 2061 7265 206f 7074 696d   which are optim
-0004f860: 697a 6564 0a20 2020 2020 2020 2020 2020  ized.           
-0004f870: 2062 7920 7363 6970 7920 6375 7276 655f   by scipy curve_
-0004f880: 6669 742e 2060 7860 2063 616e 2061 6c73  fit. `x` can als
-0004f890: 6f20 6265 2073 7065 6369 6669 6564 2061  o be specified a
-0004f8a0: 7320 6120 7365 7175 656e 6365 2063 6f6e  s a sequence con
-0004f8b0: 7461 696e 696e 6720 6d75 6c74 6970 6c65  taining multiple
-0004f8c0: 0a20 2020 2020 2020 2020 2020 2063 6f6f  .            coo
-0004f8d0: 7264 696e 6174 6573 2c20 652e 672e 2060  rdinates, e.g. `
-0004f8e0: 6628 2878 302c 2078 3129 2c20 2a70 6172  f((x0, x1), *par
-0004f8f0: 616d 7329 602e 0a20 2020 2020 2020 2072  ams)`..        r
-0004f900: 6564 7563 655f 6469 6d73 203a 2073 7472  educe_dims : str
-0004f910: 2c20 4974 6572 6162 6c65 206f 6620 4861  , Iterable of Ha
-0004f920: 7368 6162 6c65 206f 7220 4e6f 6e65 2c20  shable or None, 
-0004f930: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0004f940: 2020 2020 2041 6464 6974 696f 6e61 6c20       Additional 
-0004f950: 6469 6d65 6e73 696f 6e28 7329 206f 7665  dimension(s) ove
-0004f960: 7220 7768 6963 6820 746f 2061 6767 7265  r which to aggre
-0004f970: 6761 7465 2077 6869 6c65 2066 6974 7469  gate while fitti
-0004f980: 6e67 2e20 466f 7220 6578 616d 706c 652c  ng. For example,
-0004f990: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
-0004f9a0: 6c69 6e67 2060 6473 2e63 7572 7665 6669  ling `ds.curvefi
-0004f9b0: 7428 636f 6f72 6473 3d27 7469 6d65 272c  t(coords='time',
-0004f9c0: 2072 6564 7563 655f 6469 6d73 3d5b 276c   reduce_dims=['l
-0004f9d0: 6174 272c 2027 6c6f 6e27 5d2c 202e 2e2e  at', 'lon'], ...
-0004f9e0: 2960 2077 696c 6c0a 2020 2020 2020 2020  )` will.        
-0004f9f0: 2020 2020 6167 6772 6567 6174 6520 616c      aggregate al
-0004fa00: 6c20 6c61 7420 616e 6420 6c6f 6e20 706f  l lat and lon po
-0004fa10: 696e 7473 2061 6e64 2066 6974 2074 6865  ints and fit the
-0004fa20: 2073 7065 6369 6669 6564 2066 756e 6374   specified funct
-0004fa30: 696f 6e20 616c 6f6e 6720 7468 650a 2020  ion along the.  
-0004fa40: 2020 2020 2020 2020 2020 7469 6d65 2064            time d
-0004fa50: 696d 656e 7369 6f6e 2e0a 2020 2020 2020  imension..      
-0004fa60: 2020 736b 6970 6e61 203a 2062 6f6f 6c2c    skipna : bool,
-0004fa70: 2064 6566 6175 6c74 3a20 5472 7565 0a20   default: True. 
-0004fa80: 2020 2020 2020 2020 2020 2057 6865 7468             Wheth
-0004fa90: 6572 2074 6f20 736b 6970 206d 6973 7369  er to skip missi
-0004faa0: 6e67 2076 616c 7565 7320 7768 656e 2066  ng values when f
-0004fab0: 6974 7469 6e67 2e20 4465 6661 756c 7420  itting. Default 
-0004fac0: 6973 2054 7275 652e 0a20 2020 2020 2020  is True..       
-0004fad0: 2070 3020 3a20 6469 6374 2d6c 696b 652c   p0 : dict-like,
-0004fae0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0004faf0: 2020 2020 2020 4f70 7469 6f6e 616c 2064        Optional d
-0004fb00: 6963 7469 6f6e 6172 7920 6f66 2070 6172  ictionary of par
-0004fb10: 616d 6574 6572 206e 616d 6573 2074 6f20  ameter names to 
-0004fb20: 696e 6974 6961 6c20 6775 6573 7365 7320  initial guesses 
-0004fb30: 7061 7373 6564 2074 6f20 7468 650a 2020  passed to the.  
-0004fb40: 2020 2020 2020 2020 2020 6063 7572 7665            `curve
-0004fb50: 5f66 6974 6020 6070 3060 2061 7267 2e20  _fit` `p0` arg. 
-0004fb60: 4966 206e 6f6e 6520 6f72 206f 6e6c 7920  If none or only 
-0004fb70: 736f 6d65 2070 6172 616d 6574 6572 7320  some parameters 
-0004fb80: 6172 6520 7061 7373 6564 2c20 7468 6520  are passed, the 
-0004fb90: 7265 7374 2077 696c 6c0a 2020 2020 2020  rest will.      
-0004fba0: 2020 2020 2020 6265 2061 7373 6967 6e65        be assigne
-0004fbb0: 6420 696e 6974 6961 6c20 7661 6c75 6573  d initial values
-0004fbc0: 2066 6f6c 6c6f 7769 6e67 2074 6865 2064   following the d
-0004fbd0: 6566 6175 6c74 2073 6369 7079 2062 6568  efault scipy beh
-0004fbe0: 6176 696f 722e 0a20 2020 2020 2020 2062  avior..        b
-0004fbf0: 6f75 6e64 7320 3a20 6469 6374 2d6c 696b  ounds : dict-lik
-0004fc00: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
-0004fc10: 2020 2020 2020 2020 4f70 7469 6f6e 616c          Optional
-0004fc20: 2064 6963 7469 6f6e 6172 7920 6f66 2070   dictionary of p
-0004fc30: 6172 616d 6574 6572 206e 616d 6573 2074  arameter names t
-0004fc40: 6f20 626f 756e 6469 6e67 2076 616c 7565  o bounding value
-0004fc50: 7320 7061 7373 6564 2074 6f20 7468 650a  s passed to the.
-0004fc60: 2020 2020 2020 2020 2020 2020 6063 7572              `cur
-0004fc70: 7665 5f66 6974 6020 6062 6f75 6e64 7360  ve_fit` `bounds`
-0004fc80: 2061 7267 2e20 4966 206e 6f6e 6520 6f72   arg. If none or
-0004fc90: 206f 6e6c 7920 736f 6d65 2070 6172 616d   only some param
-0004fca0: 6574 6572 7320 6172 6520 7061 7373 6564  eters are passed
-0004fcb0: 2c20 7468 6520 7265 7374 0a20 2020 2020  , the rest.     
-0004fcc0: 2020 2020 2020 2077 696c 6c20 6265 2075         will be u
-0004fcd0: 6e62 6f75 6e64 6564 2066 6f6c 6c6f 7769  nbounded followi
-0004fce0: 6e67 2074 6865 2064 6566 6175 6c74 2073  ng the default s
-0004fcf0: 6369 7079 2062 6568 6176 696f 722e 0a20  cipy behavior.. 
-0004fd00: 2020 2020 2020 2070 6172 616d 5f6e 616d         param_nam
-0004fd10: 6573 203a 2073 6571 7565 6e63 6520 6f66  es : sequence of
-0004fd20: 2068 6173 6861 626c 652c 206f 7074 696f   hashable, optio
-0004fd30: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-0004fd40: 5365 7175 656e 6365 206f 6620 6e61 6d65  Sequence of name
-0004fd50: 7320 666f 7220 7468 6520 6669 7474 6162  s for the fittab
-0004fd60: 6c65 2070 6172 616d 6574 6572 7320 6f66  le parameters of
-0004fd70: 2060 6675 6e63 602e 2049 6620 6e6f 7420   `func`. If not 
-0004fd80: 7375 7070 6c69 6564 2c0a 2020 2020 2020  supplied,.      
-0004fd90: 2020 2020 2020 7468 6973 2077 696c 6c20        this will 
-0004fda0: 6265 2061 7574 6f6d 6174 6963 616c 6c79  be automatically
-0004fdb0: 2064 6574 6572 6d69 6e65 6420 6279 2061   determined by a
-0004fdc0: 7267 756d 656e 7473 206f 6620 6066 756e  rguments of `fun
-0004fdd0: 6360 2e20 6070 6172 616d 5f6e 616d 6573  c`. `param_names
-0004fde0: 600a 2020 2020 2020 2020 2020 2020 7368  `.            sh
-0004fdf0: 6f75 6c64 2062 6520 6d61 6e75 616c 6c79  ould be manually
-0004fe00: 2073 7570 706c 6965 6420 7768 656e 2066   supplied when f
-0004fe10: 6974 7469 6e67 2061 2066 756e 6374 696f  itting a functio
-0004fe20: 6e20 7468 6174 2074 616b 6573 2061 2076  n that takes a v
-0004fe30: 6172 6961 626c 650a 2020 2020 2020 2020  ariable.        
-0004fe40: 2020 2020 6e75 6d62 6572 206f 6620 7061      number of pa
-0004fe50: 7261 6d65 7465 7273 2e0a 2020 2020 2020  rameters..      
-0004fe60: 2020 2a2a 6b77 6172 6773 203a 206f 7074    **kwargs : opt
-0004fe70: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-0004fe80: 2020 4164 6469 7469 6f6e 616c 206b 6579    Additional key
-0004fe90: 776f 7264 2061 7267 756d 656e 7473 2074  word arguments t
-0004fea0: 6f20 7061 7373 6564 2074 6f20 7363 6970  o passed to scip
-0004feb0: 7920 6375 7276 655f 6669 742e 0a0a 2020  y curve_fit...  
-0004fec0: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-0004fed0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-0004fee0: 2020 2020 2020 6375 7276 6566 6974 5f72        curvefit_r
-0004fef0: 6573 756c 7473 203a 2044 6174 6173 6574  esults : Dataset
-0004ff00: 0a20 2020 2020 2020 2020 2020 2041 2073  .            A s
-0004ff10: 696e 676c 6520 6461 7461 7365 7420 7768  ingle dataset wh
-0004ff20: 6963 6820 636f 6e74 6169 6e73 3a0a 0a20  ich contains:.. 
-0004ff30: 2020 2020 2020 2020 2020 205b 7661 725d             [var]
-0004ff40: 5f63 7572 7665 6669 745f 636f 6566 6669  _curvefit_coeffi
-0004ff50: 6369 656e 7473 0a20 2020 2020 2020 2020  cients.         
-0004ff60: 2020 2020 2020 2054 6865 2063 6f65 6666         The coeff
-0004ff70: 6963 6965 6e74 7320 6f66 2074 6865 2062  icients of the b
-0004ff80: 6573 7420 6669 742e 0a20 2020 2020 2020  est fit..       
-0004ff90: 2020 2020 205b 7661 725d 5f63 7572 7665       [var]_curve
-0004ffa0: 6669 745f 636f 7661 7269 616e 6365 0a20  fit_covariance. 
-0004ffb0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-0004ffc0: 6865 2063 6f76 6172 6961 6e63 6520 6d61  he covariance ma
-0004ffd0: 7472 6978 206f 6620 7468 6520 636f 6566  trix of the coef
-0004ffe0: 6669 6369 656e 7420 6573 7469 6d61 7465  ficient estimate
-0004fff0: 732e 0a0a 2020 2020 2020 2020 5365 6520  s...        See 
-00050000: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
-00050010: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
-00050020: 7461 7365 742e 706f 6c79 6669 740a 2020  taset.polyfit.  
-00050030: 2020 2020 2020 7363 6970 792e 6f70 7469        scipy.opti
-00050040: 6d69 7a65 2e63 7572 7665 5f66 6974 0a20  mize.curve_fit. 
-00050050: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00050060: 2020 2066 726f 6d20 7363 6970 792e 6f70     from scipy.op
-00050070: 7469 6d69 7a65 2069 6d70 6f72 7420 6375  timize import cu
-00050080: 7276 655f 6669 740a 0a20 2020 2020 2020  rve_fit..       
-00050090: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
-000500a0: 652e 616c 6967 6e6d 656e 7420 696d 706f  e.alignment impo
-000500b0: 7274 2062 726f 6164 6361 7374 0a20 2020  rt broadcast.   
-000500c0: 2020 2020 2066 726f 6d20 7861 7272 6179       from xarray
-000500d0: 2e63 6f72 652e 636f 6d70 7574 6174 696f  .core.computatio
-000500e0: 6e20 696d 706f 7274 2061 7070 6c79 5f75  n import apply_u
-000500f0: 6675 6e63 0a20 2020 2020 2020 2066 726f  func.        fro
-00050100: 6d20 7861 7272 6179 2e63 6f72 652e 6461  m xarray.core.da
-00050110: 7461 6172 7261 7920 696d 706f 7274 205f  taarray import _
-00050120: 5448 4953 5f41 5252 4159 2c20 4461 7461  THIS_ARRAY, Data
-00050130: 4172 7261 790a 0a20 2020 2020 2020 2069  Array..        i
-00050140: 6620 7030 2069 7320 4e6f 6e65 3a0a 2020  f p0 is None:.  
-00050150: 2020 2020 2020 2020 2020 7030 203d 207b            p0 = {
-00050160: 7d0a 2020 2020 2020 2020 6966 2062 6f75  }.        if bou
-00050170: 6e64 7320 6973 204e 6f6e 653a 0a20 2020  nds is None:.   
-00050180: 2020 2020 2020 2020 2062 6f75 6e64 7320           bounds 
-00050190: 3d20 7b7d 0a20 2020 2020 2020 2069 6620  = {}.        if 
-000501a0: 6b77 6172 6773 2069 7320 4e6f 6e65 3a0a  kwargs is None:.
-000501b0: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
-000501c0: 6773 203d 207b 7d0a 0a20 2020 2020 2020  gs = {}..       
-000501d0: 2072 6564 7563 655f 6469 6d73 5f3a 206c   reduce_dims_: l
-000501e0: 6973 745b 4861 7368 6162 6c65 5d0a 2020  ist[Hashable].  
-000501f0: 2020 2020 2020 6966 206e 6f74 2072 6564        if not red
-00050200: 7563 655f 6469 6d73 3a0a 2020 2020 2020  uce_dims:.      
-00050210: 2020 2020 2020 7265 6475 6365 5f64 696d        reduce_dim
-00050220: 735f 203d 205b 5d0a 2020 2020 2020 2020  s_ = [].        
-00050230: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-00050240: 7265 6475 6365 5f64 696d 732c 2073 7472  reduce_dims, str
-00050250: 2920 6f72 206e 6f74 2069 7369 6e73 7461  ) or not isinsta
-00050260: 6e63 6528 7265 6475 6365 5f64 696d 732c  nce(reduce_dims,
-00050270: 2049 7465 7261 626c 6529 3a0a 2020 2020   Iterable):.    
-00050280: 2020 2020 2020 2020 7265 6475 6365 5f64          reduce_d
-00050290: 696d 735f 203d 205b 7265 6475 6365 5f64  ims_ = [reduce_d
-000502a0: 696d 735d 0a20 2020 2020 2020 2065 6c73  ims].        els
-000502b0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-000502c0: 6564 7563 655f 6469 6d73 5f20 3d20 6c69  educe_dims_ = li
-000502d0: 7374 2872 6564 7563 655f 6469 6d73 290a  st(reduce_dims).
-000502e0: 0a20 2020 2020 2020 2069 6620 280a 2020  .        if (.  
-000502f0: 2020 2020 2020 2020 2020 6973 696e 7374            isinst
-00050300: 616e 6365 2863 6f6f 7264 732c 2073 7472  ance(coords, str
-00050310: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
-00050320: 2069 7369 6e73 7461 6e63 6528 636f 6f72   isinstance(coor
-00050330: 6473 2c20 4461 7461 4172 7261 7929 0a20  ds, DataArray). 
-00050340: 2020 2020 2020 2020 2020 206f 7220 6e6f             or no
-00050350: 7420 6973 696e 7374 616e 6365 2863 6f6f  t isinstance(coo
-00050360: 7264 732c 2049 7465 7261 626c 6529 0a20  rds, Iterable). 
-00050370: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-00050380: 2020 2020 2020 636f 6f72 6473 203d 205b        coords = [
-00050390: 636f 6f72 6473 5d0a 2020 2020 2020 2020  coords].        
-000503a0: 636f 6f72 6473 5f3a 2053 6571 7565 6e63  coords_: Sequenc
-000503b0: 655b 4461 7461 4172 7261 795d 203d 205b  e[DataArray] = [
-000503c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000503d0: 665b 636f 6f72 645d 2069 6620 6973 696e  f[coord] if isin
-000503e0: 7374 616e 6365 2863 6f6f 7264 2c20 7374  stance(coord, st
-000503f0: 7229 2065 6c73 6520 636f 6f72 6420 666f  r) else coord fo
-00050400: 7220 636f 6f72 6420 696e 2063 6f6f 7264  r coord in coord
-00050410: 730a 2020 2020 2020 2020 5d0a 0a20 2020  s.        ]..   
-00050420: 2020 2020 2023 2044 6574 6572 6d69 6e65       # Determine
-00050430: 2077 6865 7468 6572 2061 6e79 2063 6f6f   whether any coo
-00050440: 7264 7320 6172 6520 6469 6d73 206f 6e20  rds are dims on 
-00050450: 7365 6c66 0a20 2020 2020 2020 2066 6f72  self.        for
-00050460: 2063 6f6f 7264 2069 6e20 636f 6f72 6473   coord in coords
-00050470: 5f3a 0a20 2020 2020 2020 2020 2020 2072  _:.            r
-00050480: 6564 7563 655f 6469 6d73 5f20 2b3d 205b  educe_dims_ += [
-00050490: 6320 666f 7220 6320 696e 2073 656c 662e  c for c in self.
-000504a0: 6469 6d73 2069 6620 636f 6f72 642e 6571  dims if coord.eq
-000504b0: 7561 6c73 2873 656c 665b 635d 295d 0a20  uals(self[c])]. 
-000504c0: 2020 2020 2020 2072 6564 7563 655f 6469         reduce_di
-000504d0: 6d73 5f20 3d20 6c69 7374 2873 6574 2872  ms_ = list(set(r
-000504e0: 6564 7563 655f 6469 6d73 5f29 290a 2020  educe_dims_)).  
-000504f0: 2020 2020 2020 7072 6573 6572 7665 645f        preserved_
-00050500: 6469 6d73 203d 206c 6973 7428 7365 7428  dims = list(set(
-00050510: 7365 6c66 2e64 696d 7329 202d 2073 6574  self.dims) - set
-00050520: 2872 6564 7563 655f 6469 6d73 5f29 290a  (reduce_dims_)).
-00050530: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
-00050540: 6564 7563 655f 6469 6d73 5f3a 0a20 2020  educe_dims_:.   
-00050550: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00050560: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00050570: 2020 2020 2020 2020 2020 2022 4e6f 2061             "No a
-00050580: 7267 756d 656e 7473 2074 6f20 6063 6f6f  rguments to `coo
-00050590: 7264 7360 2077 6572 6520 6964 656e 7469  rds` were identi
-000505a0: 6669 6564 2061 7320 6120 6469 6d65 6e73  fied as a dimens
-000505b0: 696f 6e20 6f6e 2074 6865 2063 616c 6c69  ion on the calli
-000505c0: 6e67 2022 0a20 2020 2020 2020 2020 2020  ng ".           
-000505d0: 2020 2020 2022 6f62 6a65 6374 2c20 616e       "object, an
-000505e0: 6420 6e6f 2064 696d 7320 7765 7265 2073  d no dims were s
-000505f0: 7570 706c 6965 6420 746f 2060 7265 6475  upplied to `redu
-00050600: 6365 5f64 696d 7360 2e20 5468 6973 2077  ce_dims`. This w
-00050610: 6f75 6c64 2072 6573 756c 7420 220a 2020  ould result ".  
-00050620: 2020 2020 2020 2020 2020 2020 2020 2269                "i
-00050630: 6e20 6669 7474 696e 6720 6f6e 2073 6361  n fitting on sca
-00050640: 6c61 7220 6461 7461 2e22 0a20 2020 2020  lar data.".     
-00050650: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00050660: 2020 2320 4272 6f61 6463 6173 7420 616c    # Broadcast al
-00050670: 6c20 636f 6f72 6473 2077 6974 6820 6561  l coords with ea
-00050680: 6368 206f 7468 6572 0a20 2020 2020 2020  ch other.       
-00050690: 2063 6f6f 7264 735f 203d 2062 726f 6164   coords_ = broad
-000506a0: 6361 7374 282a 636f 6f72 6473 5f29 0a20  cast(*coords_). 
-000506b0: 2020 2020 2020 2063 6f6f 7264 735f 203d         coords_ =
-000506c0: 205b 0a20 2020 2020 2020 2020 2020 2063   [.            c
-000506d0: 6f6f 7264 2e62 726f 6164 6361 7374 5f6c  oord.broadcast_l
-000506e0: 696b 6528 7365 6c66 2c20 6578 636c 7564  ike(self, exclud
-000506f0: 653d 7072 6573 6572 7665 645f 6469 6d73  e=preserved_dims
-00050700: 2920 666f 7220 636f 6f72 6420 696e 2063  ) for coord in c
-00050710: 6f6f 7264 735f 0a20 2020 2020 2020 205d  oords_.        ]
-00050720: 0a0a 2020 2020 2020 2020 7061 7261 6d73  ..        params
-00050730: 2c20 6675 6e63 5f61 7267 7320 3d20 5f67  , func_args = _g
-00050740: 6574 5f66 756e 635f 6172 6773 2866 756e  et_func_args(fun
-00050750: 632c 2070 6172 616d 5f6e 616d 6573 290a  c, param_names).
-00050760: 2020 2020 2020 2020 7061 7261 6d5f 6465          param_de
-00050770: 6661 756c 7473 2c20 626f 756e 6473 5f64  faults, bounds_d
-00050780: 6566 6175 6c74 7320 3d20 5f69 6e69 7469  efaults = _initi
-00050790: 616c 697a 655f 6375 7276 6566 6974 5f70  alize_curvefit_p
-000507a0: 6172 616d 7328 0a20 2020 2020 2020 2020  arams(.         
-000507b0: 2020 2070 6172 616d 732c 2070 302c 2062     params, p0, b
-000507c0: 6f75 6e64 732c 2066 756e 635f 6172 6773  ounds, func_args
-000507d0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-000507e0: 2020 206e 5f70 6172 616d 7320 3d20 6c65     n_params = le
-000507f0: 6e28 7061 7261 6d73 290a 2020 2020 2020  n(params).      
-00050800: 2020 6b77 6172 6773 2e73 6574 6465 6661    kwargs.setdefa
-00050810: 756c 7428 2270 3022 2c20 5b70 6172 616d  ult("p0", [param
-00050820: 5f64 6566 6175 6c74 735b 705d 2066 6f72  _defaults[p] for
-00050830: 2070 2069 6e20 7061 7261 6d73 5d29 0a20   p in params]). 
-00050840: 2020 2020 2020 206b 7761 7267 732e 7365         kwargs.se
-00050850: 7464 6566 6175 6c74 280a 2020 2020 2020  tdefault(.      
-00050860: 2020 2020 2020 2262 6f75 6e64 7322 2c0a        "bounds",.
-00050870: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
-00050880: 2020 2020 2020 2020 2020 2020 2020 5b62                [b
-00050890: 6f75 6e64 735f 6465 6661 756c 7473 5b70  ounds_defaults[p
-000508a0: 5d5b 305d 2066 6f72 2070 2069 6e20 7061  ][0] for p in pa
-000508b0: 7261 6d73 5d2c 0a20 2020 2020 2020 2020  rams],.         
-000508c0: 2020 2020 2020 205b 626f 756e 6473 5f64         [bounds_d
-000508d0: 6566 6175 6c74 735b 705d 5b31 5d20 666f  efaults[p][1] fo
-000508e0: 7220 7020 696e 2070 6172 616d 735d 2c0a  r p in params],.
-000508f0: 2020 2020 2020 2020 2020 2020 5d2c 0a20              ],. 
-00050900: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00050910: 2020 6465 6620 5f77 7261 7070 6572 2859    def _wrapper(Y
-00050920: 2c20 2a63 6f6f 7264 735f 2c20 2a2a 6b77  , *coords_, **kw
-00050930: 6172 6773 293a 0a20 2020 2020 2020 2020  args):.         
-00050940: 2020 2023 2057 7261 7020 6375 7276 655f     # Wrap curve_
-00050950: 6669 7420 7769 7468 2072 6176 656c 6564  fit with raveled
-00050960: 2063 6f6f 7264 696e 6174 6573 2061 6e64   coordinates and
-00050970: 2070 6f69 6e74 7769 7365 204e 614e 2068   pointwise NaN h
-00050980: 616e 646c 696e 670a 2020 2020 2020 2020  andling.        
-00050990: 2020 2020 7820 3d20 6e70 2e76 7374 6163      x = np.vstac
-000509a0: 6b28 5b63 2e72 6176 656c 2829 2066 6f72  k([c.ravel() for
-000509b0: 2063 2069 6e20 636f 6f72 6473 5f5d 290a   c in coords_]).
-000509c0: 2020 2020 2020 2020 2020 2020 7920 3d20              y = 
-000509d0: 592e 7261 7665 6c28 290a 2020 2020 2020  Y.ravel().      
-000509e0: 2020 2020 2020 6966 2073 6b69 706e 613a        if skipna:
-000509f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00050a00: 206d 6173 6b20 3d20 6e70 2e61 6c6c 285b   mask = np.all([
-00050a10: 6e70 2e61 6e79 287e 6e70 2e69 736e 616e  np.any(~np.isnan
-00050a20: 2878 292c 2061 7869 733d 3029 2c20 7e6e  (x), axis=0), ~n
-00050a30: 702e 6973 6e61 6e28 7929 5d2c 2061 7869  p.isnan(y)], axi
-00050a40: 733d 3029 0a20 2020 2020 2020 2020 2020  s=0).           
-00050a50: 2020 2020 2078 203d 2078 5b3a 2c20 6d61       x = x[:, ma
-00050a60: 736b 5d0a 2020 2020 2020 2020 2020 2020  sk].            
-00050a70: 2020 2020 7920 3d20 795b 6d61 736b 5d0a      y = y[mask].
-00050a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050a90: 6966 206e 6f74 206c 656e 2879 293a 0a20  if not len(y):. 
-00050aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050ab0: 2020 2070 6f70 7420 3d20 6e70 2e66 756c     popt = np.ful
-00050ac0: 6c28 5b6e 5f70 6172 616d 735d 2c20 6e70  l([n_params], np
-00050ad0: 2e6e 616e 290a 2020 2020 2020 2020 2020  .nan).          
-00050ae0: 2020 2020 2020 2020 2020 7063 6f76 203d            pcov =
-00050af0: 206e 702e 6675 6c6c 285b 6e5f 7061 7261   np.full([n_para
-00050b00: 6d73 2c20 6e5f 7061 7261 6d73 5d2c 206e  ms, n_params], n
-00050b10: 702e 6e61 6e29 0a20 2020 2020 2020 2020  p.nan).         
-00050b20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00050b30: 6e20 706f 7074 2c20 7063 6f76 0a20 2020  n popt, pcov.   
-00050b40: 2020 2020 2020 2020 2078 203d 206e 702e           x = np.
-00050b50: 7371 7565 657a 6528 7829 0a20 2020 2020  squeeze(x).     
-00050b60: 2020 2020 2020 2070 6f70 742c 2070 636f         popt, pco
-00050b70: 7620 3d20 6375 7276 655f 6669 7428 6675  v = curve_fit(fu
-00050b80: 6e63 2c20 782c 2079 2c20 2a2a 6b77 6172  nc, x, y, **kwar
-00050b90: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
-00050ba0: 7265 7475 726e 2070 6f70 742c 2070 636f  return popt, pco
-00050bb0: 760a 0a20 2020 2020 2020 2072 6573 756c  v..        resul
-00050bc0: 7420 3d20 7479 7065 2873 656c 6629 2829  t = type(self)()
-00050bd0: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
-00050be0: 652c 2064 6120 696e 2073 656c 662e 6461  e, da in self.da
-00050bf0: 7461 5f76 6172 732e 6974 656d 7328 293a  ta_vars.items():
-00050c00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00050c10: 6e61 6d65 2069 7320 5f54 4849 535f 4152  name is _THIS_AR
-00050c20: 5241 593a 0a20 2020 2020 2020 2020 2020  RAY:.           
-00050c30: 2020 2020 206e 616d 6520 3d20 2222 0a20       name = "". 
-00050c40: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00050c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00050c60: 206e 616d 6520 3d20 6622 7b73 7472 286e   name = f"{str(n
-00050c70: 616d 6529 7d5f 220a 0a20 2020 2020 2020  ame)}_"..       
-00050c80: 2020 2020 2070 6f70 742c 2070 636f 7620       popt, pcov 
-00050c90: 3d20 6170 706c 795f 7566 756e 6328 0a20  = apply_ufunc(. 
-00050ca0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-00050cb0: 7772 6170 7065 722c 0a20 2020 2020 2020  wrapper,.       
-00050cc0: 2020 2020 2020 2020 2064 612c 0a20 2020           da,.   
-00050cd0: 2020 2020 2020 2020 2020 2020 202a 636f               *co
-00050ce0: 6f72 6473 5f2c 0a20 2020 2020 2020 2020  ords_,.         
-00050cf0: 2020 2020 2020 2076 6563 746f 7269 7a65         vectorize
-00050d00: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-00050d10: 2020 2020 2020 2064 6173 6b3d 2270 6172         dask="par
-00050d20: 616c 6c65 6c69 7a65 6422 2c0a 2020 2020  allelized",.    
-00050d30: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-00050d40: 745f 636f 7265 5f64 696d 733d 5b72 6564  t_core_dims=[red
-00050d50: 7563 655f 6469 6d73 5f20 666f 7220 6420  uce_dims_ for d 
-00050d60: 696e 2072 616e 6765 286c 656e 2863 6f6f  in range(len(coo
-00050d70: 7264 735f 2920 2b20 3129 5d2c 0a20 2020  rds_) + 1)],.   
-00050d80: 2020 2020 2020 2020 2020 2020 206f 7574               out
-00050d90: 7075 745f 636f 7265 5f64 696d 733d 5b5b  put_core_dims=[[
-00050da0: 2270 6172 616d 225d 2c20 5b22 636f 765f  "param"], ["cov_
-00050db0: 6922 2c20 2263 6f76 5f6a 225d 5d2c 0a20  i", "cov_j"]],. 
-00050dc0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00050dd0: 6173 6b5f 6775 6675 6e63 5f6b 7761 7267  ask_gufunc_kwarg
-00050de0: 733d 7b0a 2020 2020 2020 2020 2020 2020  s={.            
-00050df0: 2020 2020 2020 2020 226f 7574 7075 745f          "output_
-00050e00: 7369 7a65 7322 3a20 7b0a 2020 2020 2020  sizes": {.      
-00050e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050e20: 2020 2270 6172 616d 223a 206e 5f70 6172    "param": n_par
-00050e30: 616d 732c 0a20 2020 2020 2020 2020 2020  ams,.           
-00050e40: 2020 2020 2020 2020 2020 2020 2022 636f               "co
-00050e50: 765f 6922 3a20 6e5f 7061 7261 6d73 2c0a  v_i": n_params,.
-00050e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050e70: 2020 2020 2020 2020 2263 6f76 5f6a 223a          "cov_j":
-00050e80: 206e 5f70 6172 616d 732c 0a20 2020 2020   n_params,.     
-00050e90: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00050ea0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00050eb0: 2020 7d2c 0a20 2020 2020 2020 2020 2020    },.           
-00050ec0: 2020 2020 206f 7574 7075 745f 6474 7970       output_dtyp
-00050ed0: 6573 3d28 6e70 2e66 6c6f 6174 3634 2c20  es=(np.float64, 
-00050ee0: 6e70 2e66 6c6f 6174 3634 292c 0a20 2020  np.float64),.   
-00050ef0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00050f00: 6c75 6465 5f64 696d 733d 7365 7428 7265  lude_dims=set(re
-00050f10: 6475 6365 5f64 696d 735f 292c 0a20 2020  duce_dims_),.   
-00050f20: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
-00050f30: 7267 733d 6b77 6172 6773 2c0a 2020 2020  rgs=kwargs,.    
-00050f40: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00050f50: 2020 2020 2020 7265 7375 6c74 5b6e 616d        result[nam
-00050f60: 6520 2b20 2263 7572 7665 6669 745f 636f  e + "curvefit_co
-00050f70: 6566 6669 6369 656e 7473 225d 203d 2070  efficients"] = p
-00050f80: 6f70 740a 2020 2020 2020 2020 2020 2020  opt.            
-00050f90: 7265 7375 6c74 5b6e 616d 6520 2b20 2263  result[name + "c
-00050fa0: 7572 7665 6669 745f 636f 7661 7269 616e  urvefit_covarian
-00050fb0: 6365 225d 203d 2070 636f 760a 0a20 2020  ce"] = pcov..   
-00050fc0: 2020 2020 2072 6573 756c 7420 3d20 7265       result = re
-00050fd0: 7375 6c74 2e61 7373 6967 6e5f 636f 6f72  sult.assign_coor
-00050fe0: 6473 280a 2020 2020 2020 2020 2020 2020  ds(.            
-00050ff0: 7b22 7061 7261 6d22 3a20 7061 7261 6d73  {"param": params
-00051000: 2c20 2263 6f76 5f69 223a 2070 6172 616d  , "cov_i": param
-00051010: 732c 2022 636f 765f 6a22 3a20 7061 7261  s, "cov_j": para
-00051020: 6d73 7d0a 2020 2020 2020 2020 290a 2020  ms}.        ).  
-00051030: 2020 2020 2020 7265 7375 6c74 2e61 7474        result.att
-00051040: 7273 203d 2073 656c 662e 6174 7472 732e  rs = self.attrs.
-00051050: 636f 7079 2829 0a0a 2020 2020 2020 2020  copy()..        
-00051060: 7265 7475 726e 2072 6573 756c 740a 0a20  return result.. 
-00051070: 2020 2064 6566 2064 726f 705f 6475 706c     def drop_dupl
-00051080: 6963 6174 6573 280a 2020 2020 2020 2020  icates(.        
-00051090: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-000510a0: 0a20 2020 2020 2020 2064 696d 3a20 4861  .        dim: Ha
-000510b0: 7368 6162 6c65 207c 2049 7465 7261 626c  shable | Iterabl
-000510c0: 655b 4861 7368 6162 6c65 5d2c 0a20 2020  e[Hashable],.   
-000510d0: 2020 2020 206b 6565 703a 204c 6974 6572       keep: Liter
-000510e0: 616c 5b22 6669 7273 7422 2c20 226c 6173  al["first", "las
-000510f0: 7422 2c20 4661 6c73 655d 203d 2022 6669  t", False] = "fi
-00051100: 7273 7422 2c0a 2020 2020 2920 2d3e 2054  rst",.    ) -> T
-00051110: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-00051120: 2020 2222 2252 6574 7572 6e73 2061 206e    """Returns a n
-00051130: 6577 2044 6174 6173 6574 2077 6974 6820  ew Dataset with 
-00051140: 6475 706c 6963 6174 6520 6469 6d65 6e73  duplicate dimens
-00051150: 696f 6e20 7661 6c75 6573 2072 656d 6f76  ion values remov
-00051160: 6564 2e0a 0a20 2020 2020 2020 2050 6172  ed...        Par
-00051170: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00051180: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00051190: 2020 2064 696d 203a 2064 696d 656e 7369     dim : dimensi
-000511a0: 6f6e 206c 6162 656c 206f 7220 6c61 6265  on label or labe
-000511b0: 6c73 0a20 2020 2020 2020 2020 2020 2050  ls.            P
-000511c0: 6173 7320 602e 2e2e 6020 746f 2064 726f  ass `...` to dro
-000511d0: 7020 6475 706c 6963 6174 6573 2061 6c6f  p duplicates alo
-000511e0: 6e67 2061 6c6c 2064 696d 656e 7369 6f6e  ng all dimension
-000511f0: 732e 0a20 2020 2020 2020 206b 6565 7020  s..        keep 
-00051200: 3a20 7b22 6669 7273 7422 2c20 226c 6173  : {"first", "las
-00051210: 7422 2c20 4661 6c73 657d 2c20 6465 6661  t", False}, defa
-00051220: 756c 743a 2022 6669 7273 7422 0a20 2020  ult: "first".   
-00051230: 2020 2020 2020 2020 2044 6574 6572 6d69           Determi
-00051240: 6e65 7320 7768 6963 6820 6475 706c 6963  nes which duplic
-00051250: 6174 6573 2028 6966 2061 6e79 2920 746f  ates (if any) to
-00051260: 206b 6565 702e 0a20 2020 2020 2020 2020   keep..         
-00051270: 2020 202d 2060 6022 6669 7273 7422 6060     - ``"first"``
-00051280: 203a 2044 726f 7020 6475 706c 6963 6174   : Drop duplicat
-00051290: 6573 2065 7863 6570 7420 666f 7220 7468  es except for th
-000512a0: 6520 6669 7273 7420 6f63 6375 7272 656e  e first occurren
-000512b0: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
-000512c0: 2d20 6060 226c 6173 7422 6060 203a 2044  - ``"last"`` : D
-000512d0: 726f 7020 6475 706c 6963 6174 6573 2065  rop duplicates e
-000512e0: 7863 6570 7420 666f 7220 7468 6520 6c61  xcept for the la
-000512f0: 7374 206f 6363 7572 7265 6e63 652e 0a20  st occurrence.. 
-00051300: 2020 2020 2020 2020 2020 202d 2046 616c             - Fal
-00051310: 7365 203a 2044 726f 7020 616c 6c20 6475  se : Drop all du
-00051320: 706c 6963 6174 6573 2e0a 0a20 2020 2020  plicates...     
-00051330: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-00051340: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-00051350: 2020 2044 6174 6173 6574 0a0a 2020 2020     Dataset..    
-00051360: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-00051370: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-00051380: 2020 2020 2020 4461 7461 4172 7261 792e        DataArray.
-00051390: 6472 6f70 5f64 7570 6c69 6361 7465 730a  drop_duplicates.
-000513a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000513b0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000513c0: 6528 6469 6d2c 2073 7472 293a 0a20 2020  e(dim, str):.   
-000513d0: 2020 2020 2020 2020 2064 696d 733a 2049           dims: I
-000513e0: 7465 7261 626c 6520 3d20 2864 696d 2c29  terable = (dim,)
-000513f0: 0a20 2020 2020 2020 2065 6c69 6620 6469  .        elif di
-00051400: 6d20 6973 202e 2e2e 3a0a 2020 2020 2020  m is ...:.      
-00051410: 2020 2020 2020 6469 6d73 203d 2073 656c        dims = sel
-00051420: 662e 6469 6d73 0a20 2020 2020 2020 2065  f.dims.        e
-00051430: 6c69 6620 6e6f 7420 6973 696e 7374 616e  lif not isinstan
-00051440: 6365 2864 696d 2c20 4974 6572 6162 6c65  ce(dim, Iterable
-00051450: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
-00051460: 696d 7320 3d20 5b64 696d 5d0a 2020 2020  ims = [dim].    
-00051470: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00051480: 2020 2020 2020 6469 6d73 203d 2064 696d        dims = dim
-00051490: 0a0a 2020 2020 2020 2020 6d69 7373 696e  ..        missin
-000514a0: 675f 6469 6d73 203d 2073 6574 2864 696d  g_dims = set(dim
-000514b0: 7329 202d 2073 6574 2873 656c 662e 6469  s) - set(self.di
-000514c0: 6d73 290a 2020 2020 2020 2020 6966 206d  ms).        if m
-000514d0: 6973 7369 6e67 5f64 696d 733a 0a20 2020  issing_dims:.   
-000514e0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000514f0: 616c 7565 4572 726f 7228 6622 277b 6d69  alueError(f"'{mi
-00051500: 7373 696e 675f 6469 6d73 7d27 206e 6f74  ssing_dims}' not
-00051510: 2066 6f75 6e64 2069 6e20 6469 6d65 6e73   found in dimens
-00051520: 696f 6e73 2229 0a0a 2020 2020 2020 2020  ions")..        
-00051530: 696e 6465 7865 7320 3d20 7b64 696d 3a20  indexes = {dim: 
-00051540: 7e73 656c 662e 6765 745f 696e 6465 7828  ~self.get_index(
-00051550: 6469 6d29 2e64 7570 6c69 6361 7465 6428  dim).duplicated(
-00051560: 6b65 6570 3d6b 6565 7029 2066 6f72 2064  keep=keep) for d
-00051570: 696d 2069 6e20 6469 6d73 7d0a 2020 2020  im in dims}.    
-00051580: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00051590: 6973 656c 2869 6e64 6578 6573 290a 0a20  isel(indexes).. 
-000515a0: 2020 2064 6566 2063 6f6e 7665 7274 5f63     def convert_c
-000515b0: 616c 656e 6461 7228 0a20 2020 2020 2020  alendar(.       
-000515c0: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
-000515d0: 2c0a 2020 2020 2020 2020 6361 6c65 6e64  ,.        calend
-000515e0: 6172 3a20 4346 4361 6c65 6e64 6172 2c0a  ar: CFCalendar,.
-000515f0: 2020 2020 2020 2020 6469 6d3a 2048 6173          dim: Has
-00051600: 6861 626c 6520 3d20 2274 696d 6522 2c0a  hable = "time",.
-00051610: 2020 2020 2020 2020 616c 6967 6e5f 6f6e          align_on
-00051620: 3a20 4c69 7465 7261 6c5b 2264 6174 6522  : Literal["date"
-00051630: 2c20 2279 6561 7222 2c20 4e6f 6e65 5d20  , "year", None] 
-00051640: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00051650: 6d69 7373 696e 673a 2041 6e79 207c 204e  missing: Any | N
-00051660: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00051670: 2020 2020 7573 655f 6366 7469 6d65 3a20      use_cftime: 
-00051680: 626f 6f6c 207c 204e 6f6e 6520 3d20 4e6f  bool | None = No
-00051690: 6e65 2c0a 2020 2020 2920 2d3e 2054 5f44  ne,.    ) -> T_D
-000516a0: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-000516b0: 2222 2243 6f6e 7665 7274 2074 6865 2044  """Convert the D
-000516c0: 6174 6173 6574 2074 6f20 616e 6f74 6865  ataset to anothe
-000516d0: 7220 6361 6c65 6e64 6172 2e0a 0a20 2020  r calendar...   
-000516e0: 2020 2020 204f 6e6c 7920 636f 6e76 6572       Only conver
-000516f0: 7473 2074 6865 2069 6e64 6976 6964 7561  ts the individua
-00051700: 6c20 7469 6d65 7374 616d 7073 2c20 646f  l timestamps, do
-00051710: 6573 206e 6f74 206d 6f64 6966 7920 616e  es not modify an
-00051720: 7920 6461 7461 2065 7863 6570 740a 2020  y data except.  
-00051730: 2020 2020 2020 696e 2064 726f 7070 696e        in droppin
-00051740: 6720 696e 7661 6c69 642f 7375 7270 6c75  g invalid/surplu
-00051750: 7320 6461 7465 7320 6f72 2069 6e73 6572  s dates or inser
-00051760: 7469 6e67 206d 6973 7369 6e67 2064 6174  ting missing dat
-00051770: 6573 2e0a 0a20 2020 2020 2020 2049 6620  es...        If 
-00051780: 7468 6520 736f 7572 6365 2061 6e64 2074  the source and t
-00051790: 6172 6765 7420 6361 6c65 6e64 6172 7320  arget calendars 
-000517a0: 6172 6520 6569 7468 6572 206e 6f5f 6c65  are either no_le
-000517b0: 6170 2c20 616c 6c5f 6c65 6170 206f 7220  ap, all_leap or 
-000517c0: 610a 2020 2020 2020 2020 7374 616e 6461  a.        standa
-000517d0: 7264 2074 7970 652c 206f 6e6c 7920 7468  rd type, only th
-000517e0: 6520 7479 7065 206f 6620 7468 6520 7469  e type of the ti
-000517f0: 6d65 2061 7272 6179 2069 7320 6d6f 6469  me array is modi
-00051800: 6669 6564 2e0a 2020 2020 2020 2020 5768  fied..        Wh
-00051810: 656e 2063 6f6e 7665 7274 696e 6720 746f  en converting to
-00051820: 2061 206c 6561 7020 7965 6172 2066 726f   a leap year fro
-00051830: 6d20 6120 6e6f 6e2d 6c65 6170 2079 6561  m a non-leap yea
-00051840: 722c 2074 6865 2032 3974 6820 6f66 2046  r, the 29th of F
-00051850: 6562 7275 6172 790a 2020 2020 2020 2020  ebruary.        
-00051860: 6973 2072 656d 6f76 6564 2066 726f 6d20  is removed from 
-00051870: 7468 6520 6172 7261 792e 2049 6e20 7468  the array. In th
-00051880: 6520 6f74 6865 7220 6469 7265 6374 696f  e other directio
-00051890: 6e20 7468 6520 3239 7468 206f 6620 4665  n the 29th of Fe
-000518a0: 6272 7561 7279 0a20 2020 2020 2020 2077  bruary.        w
-000518b0: 696c 6c20 6265 206d 6973 7369 6e67 2069  ill be missing i
-000518c0: 6e20 7468 6520 6f75 7470 7574 2c20 756e  n the output, un
-000518d0: 6c65 7373 2060 6d69 7373 696e 6760 2069  less `missing` i
-000518e0: 7320 7370 6563 6966 6965 642c 0a20 2020  s specified,.   
-000518f0: 2020 2020 2069 6e20 7768 6963 6820 6361       in which ca
-00051900: 7365 2074 6861 7420 7661 6c75 6520 6973  se that value is
-00051910: 2069 6e73 6572 7465 642e 0a0a 2020 2020   inserted...    
-00051920: 2020 2020 466f 7220 636f 6e76 6572 7369      For conversi
-00051930: 6f6e 7320 696e 766f 6c76 696e 6720 6033  ons involving `3
-00051940: 3630 5f64 6179 6020 6361 6c65 6e64 6172  60_day` calendar
-00051950: 732c 2073 6565 204e 6f74 6573 2e0a 0a20  s, see Notes... 
-00051960: 2020 2020 2020 2054 6869 7320 6d65 7468         This meth
-00051970: 6f64 2069 7320 7361 6665 2074 6f20 7573  od is safe to us
-00051980: 6520 7769 7468 2073 7562 2d64 6169 6c79  e with sub-daily
-00051990: 2064 6174 6120 6173 2069 7420 646f 6573   data as it does
-000519a0: 6e27 7420 746f 7563 6820 7468 650a 2020  n't touch the.  
-000519b0: 2020 2020 2020 7469 6d65 2070 6172 7420        time part 
-000519c0: 6f66 2074 6865 2074 696d 6573 7461 6d70  of the timestamp
-000519d0: 732e 0a0a 2020 2020 2020 2020 5061 7261  s...        Para
-000519e0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-000519f0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00051a00: 2063 616c 656e 6461 7220 3a20 7374 720a   calendar : str.
-00051a10: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-00051a20: 7461 7267 6574 2063 616c 656e 6461 7220  target calendar 
-00051a30: 6e61 6d65 2e0a 2020 2020 2020 2020 6469  name..        di
-00051a40: 6d20 3a20 4861 7368 6162 6c65 2c20 6465  m : Hashable, de
-00051a50: 6661 756c 743a 2022 7469 6d65 220a 2020  fault: "time".  
-00051a60: 2020 2020 2020 2020 2020 4e61 6d65 206f            Name o
-00051a70: 6620 7468 6520 7469 6d65 2063 6f6f 7264  f the time coord
-00051a80: 696e 6174 652e 0a20 2020 2020 2020 2061  inate..        a
-00051a90: 6c69 676e 5f6f 6e20 3a20 7b4e 6f6e 652c  lign_on : {None,
-00051aa0: 2027 6461 7465 272c 2027 7965 6172 277d   'date', 'year'}
-00051ab0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00051ac0: 2020 2020 2020 204d 7573 7420 6265 2073         Must be s
-00051ad0: 7065 6369 6669 6564 2077 6865 6e20 6569  pecified when ei
-00051ae0: 7468 6572 2073 6f75 7263 6520 6f72 2074  ther source or t
-00051af0: 6172 6765 7420 6973 2061 2060 3336 305f  arget is a `360_
-00051b00: 6461 7960 2063 616c 656e 6461 722c 0a20  day` calendar,. 
-00051b10: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
-00051b20: 6564 206f 7468 6572 7769 7365 2e20 5365  ed otherwise. Se
-00051b30: 6520 4e6f 7465 732e 0a20 2020 2020 2020  e Notes..       
-00051b40: 206d 6973 7369 6e67 203a 2041 6e79 206f   missing : Any o
-00051b50: 7220 4e6f 6e65 2c20 6f70 7469 6f6e 616c  r None, optional
-00051b60: 0a20 2020 2020 2020 2020 2020 2042 7920  .            By 
-00051b70: 6465 6661 756c 742c 2069 2e65 2e20 6966  default, i.e. if
-00051b80: 2074 6865 2076 616c 7565 2069 7320 4e6f   the value is No
-00051b90: 6e65 2c20 7468 6973 206d 6574 686f 6420  ne, this method 
-00051ba0: 7769 6c6c 2073 696d 706c 7920 6174 7465  will simply atte
-00051bb0: 6d70 740a 2020 2020 2020 2020 2020 2020  mpt.            
-00051bc0: 746f 2063 6f6e 7665 7274 2074 6865 2064  to convert the d
-00051bd0: 6174 6573 2069 6e20 7468 6520 736f 7572  ates in the sour
-00051be0: 6365 2063 616c 656e 6461 7220 746f 2074  ce calendar to t
-00051bf0: 6865 2073 616d 6520 6461 7465 7320 696e  he same dates in
-00051c00: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00051c10: 2074 6172 6765 7420 6361 6c65 6e64 6172   target calendar
-00051c20: 2c20 616e 6420 6472 6f70 2061 6e79 206f  , and drop any o
-00051c30: 6620 7468 6f73 6520 7468 6174 2061 7265  f those that are
-00051c40: 206e 6f74 2070 6f73 7369 626c 6520 746f   not possible to
-00051c50: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00051c60: 7265 7365 6e74 2e20 2049 6620 6120 7661  resent.  If a va
-00051c70: 6c75 6520 6973 2070 726f 7669 6465 642c  lue is provided,
-00051c80: 2061 206e 6577 2074 696d 6520 636f 6f72   a new time coor
-00051c90: 6469 6e61 7465 2077 696c 6c20 6265 0a20  dinate will be. 
-00051ca0: 2020 2020 2020 2020 2020 2063 7265 6174             creat
-00051cb0: 6564 2069 6e20 7468 6520 7461 7267 6574  ed in the target
-00051cc0: 2063 616c 656e 6461 7220 7769 7468 2074   calendar with t
-00051cd0: 6865 2073 616d 6520 6672 6571 7565 6e63  he same frequenc
-00051ce0: 7920 6173 2074 6865 206f 7269 6769 6e61  y as the origina
-00051cf0: 6c0a 2020 2020 2020 2020 2020 2020 7469  l.            ti
-00051d00: 6d65 2063 6f6f 7264 696e 6174 653b 2066  me coordinate; f
-00051d10: 6f72 2061 6e79 2064 6174 6573 2074 6861  or any dates tha
-00051d20: 7420 6172 6520 6e6f 7420 7072 6573 656e  t are not presen
-00051d30: 7420 696e 2074 6865 2073 6f75 7263 652c  t in the source,
-00051d40: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00051d50: 2064 6174 6120 7769 6c6c 2062 6520 6669   data will be fi
-00051d60: 6c6c 6564 2077 6974 6820 7468 6973 2076  lled with this v
-00051d70: 616c 7565 2e20 204e 6f74 6520 7468 6174  alue.  Note that
-00051d80: 2075 7369 6e67 2074 6869 7320 6d6f 6465   using this mode
-00051d90: 2072 6571 7569 7265 730a 2020 2020 2020   requires.      
-00051da0: 2020 2020 2020 7468 6174 2074 6865 2073        that the s
-00051db0: 6f75 7263 6520 6461 7461 2068 6176 6520  ource data have 
-00051dc0: 616e 2069 6e66 6572 6162 6c65 2066 7265  an inferable fre
-00051dd0: 7175 656e 6379 3b20 666f 7220 6d6f 7265  quency; for more
-00051de0: 2069 6e66 6f72 6d61 7469 6f6e 0a20 2020   information.   
-00051df0: 2020 2020 2020 2020 2073 6565 203a 7079           see :py
-00051e00: 3a66 756e 633a 6078 6172 7261 792e 696e  :func:`xarray.in
-00051e10: 6665 725f 6672 6571 602e 2020 466f 7220  fer_freq`.  For 
-00051e20: 6365 7274 6169 6e20 6672 6571 7565 6e63  certain frequenc
-00051e30: 792c 2073 6f75 7263 652c 2061 6e64 0a20  y, source, and. 
-00051e40: 2020 2020 2020 2020 2020 2074 6172 6765             targe
-00051e50: 7420 6361 6c65 6e64 6172 2063 6f6d 6269  t calendar combi
-00051e60: 6e61 7469 6f6e 732c 2074 6869 7320 636f  nations, this co
-00051e70: 756c 6420 7265 7375 6c74 2069 6e20 6d61  uld result in ma
-00051e80: 6e79 206d 6973 7369 6e67 2076 616c 7565  ny missing value
-00051e90: 732c 2073 6565 206e 6f74 6573 2e0a 2020  s, see notes..  
-00051ea0: 2020 2020 2020 7573 655f 6366 7469 6d65        use_cftime
-00051eb0: 203a 2062 6f6f 6c20 6f72 204e 6f6e 652c   : bool or None,
-00051ec0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00051ed0: 2020 2020 2020 5768 6574 6865 7220 746f        Whether to
-00051ee0: 2075 7365 2063 6674 696d 6520 6f62 6a65   use cftime obje
-00051ef0: 6374 7320 696e 2074 6865 206f 7574 7075  cts in the outpu
-00051f00: 742c 206f 6e6c 7920 7573 6564 2069 6620  t, only used if 
-00051f10: 6063 616c 656e 6461 7260 0a20 2020 2020  `calendar`.     
-00051f20: 2020 2020 2020 2069 7320 6f6e 6520 6f66         is one of
-00051f30: 207b 2270 726f 6c65 7074 6963 5f67 7265   {"proleptic_gre
-00051f40: 676f 7269 616e 222c 2022 6772 6567 6f72  gorian", "gregor
-00051f50: 6961 6e22 206f 7220 2273 7461 6e64 6172  ian" or "standar
-00051f60: 6422 7d2e 0a20 2020 2020 2020 2020 2020  d"}..           
-00051f70: 2049 6620 5472 7565 2c20 7468 6520 6e65   If True, the ne
-00051f80: 7720 7469 6d65 2061 7869 7320 7573 6573  w time axis uses
-00051f90: 2063 6674 696d 6520 6f62 6a65 6374 732e   cftime objects.
-00051fa0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00051fb0: 4e6f 6e65 2028 6465 6661 756c 7429 2c20  None (default), 
-00051fc0: 6974 2075 7365 7320 3a70 793a 636c 6173  it uses :py:clas
-00051fd0: 733a 606e 756d 7079 2e64 6174 6574 696d  s:`numpy.datetim
-00051fe0: 6536 3460 2076 616c 7565 7320 6966 2074  e64` values if t
-00051ff0: 6865 0a20 2020 2020 2020 2020 2020 2064  he.            d
-00052000: 6174 6520 7261 6e67 6520 7065 726d 6974  ate range permit
-00052010: 7320 6974 2c20 616e 6420 3a70 793a 636c  s it, and :py:cl
-00052020: 6173 733a 6063 6674 696d 652e 6461 7465  ass:`cftime.date
-00052030: 7469 6d65 6020 6f62 6a65 6374 7320 6966  time` objects if
-00052040: 206e 6f74 2e0a 2020 2020 2020 2020 2020   not..          
-00052050: 2020 4966 2046 616c 7365 2c20 6974 2075    If False, it u
-00052060: 7365 7320 3a70 793a 636c 6173 733a 606e  ses :py:class:`n
-00052070: 756d 7079 2e64 6174 6574 696d 6536 3460  umpy.datetime64`
-00052080: 2020 6f72 2066 6169 6c73 2e0a 0a20 2020    or fails...   
-00052090: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-000520a0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-000520b0: 2020 2020 2044 6174 6173 6574 0a20 2020       Dataset.   
-000520c0: 2020 2020 2020 2020 2043 6f70 7920 6f66           Copy of
-000520d0: 2074 6865 2064 6174 6161 7272 6179 2077   the dataarray w
-000520e0: 6974 6820 7468 6520 7469 6d65 2063 6f6f  ith the time coo
-000520f0: 7264 696e 6174 6520 636f 6e76 6572 7465  rdinate converte
-00052100: 6420 746f 2074 6865 0a20 2020 2020 2020  d to the.       
-00052110: 2020 2020 2074 6172 6765 7420 6361 6c65       target cale
-00052120: 6e64 6172 2e20 4966 2027 6d69 7373 696e  ndar. If 'missin
-00052130: 6727 2077 6173 204e 6f6e 6520 2864 6566  g' was None (def
-00052140: 6175 6c74 292c 2069 6e76 616c 6964 2064  ault), invalid d
-00052150: 6174 6573 2069 6e0a 2020 2020 2020 2020  ates in.        
-00052160: 2020 2020 7468 6520 6e65 7720 6361 6c65      the new cale
-00052170: 6e64 6172 2061 7265 2064 726f 7070 6564  ndar are dropped
-00052180: 2c20 6275 7420 6d69 7373 696e 6720 6461  , but missing da
-00052190: 7465 7320 6172 6520 6e6f 7420 696e 7365  tes are not inse
-000521a0: 7274 6564 2e0a 2020 2020 2020 2020 2020  rted..          
-000521b0: 2020 4966 2060 6d69 7373 696e 6760 2077    If `missing` w
-000521c0: 6173 2067 6976 656e 2c20 7468 6520 6e65  as given, the ne
-000521d0: 7720 6461 7461 2069 7320 7265 696e 6465  w data is reinde
-000521e0: 7865 6420 746f 2068 6176 6520 6120 7469  xed to have a ti
-000521f0: 6d65 2061 7869 730a 2020 2020 2020 2020  me axis.        
-00052200: 2020 2020 7769 7468 2074 6865 2073 616d      with the sam
-00052210: 6520 6672 6571 7565 6e63 7920 6173 2074  e frequency as t
-00052220: 6865 2073 6f75 7263 652c 2062 7574 2069  he source, but i
-00052230: 6e20 7468 6520 6e65 7720 6361 6c65 6e64  n the new calend
-00052240: 6172 3b20 616e 790a 2020 2020 2020 2020  ar; any.        
-00052250: 2020 2020 6d69 7373 696e 6720 6461 7461      missing data
-00052260: 706f 696e 7473 2061 7265 2066 696c 6c65  points are fille
-00052270: 6420 7769 7468 2060 6d69 7373 696e 6760  d with `missing`
-00052280: 2e0a 0a20 2020 2020 2020 204e 6f74 6573  ...        Notes
-00052290: 0a20 2020 2020 2020 202d 2d2d 2d2d 0a20  .        -----. 
-000522a0: 2020 2020 2020 2050 6173 7369 6e67 2061         Passing a
-000522b0: 2076 616c 7565 2074 6f20 606d 6973 7369   value to `missi
-000522c0: 6e67 6020 6973 206f 6e6c 7920 7573 6162  ng` is only usab
-000522d0: 6c65 2069 6620 7468 6520 736f 7572 6365  le if the source
-000522e0: 2773 2074 696d 6520 636f 6f72 6469 6e61  's time coordina
-000522f0: 7465 2061 7320 616e 0a20 2020 2020 2020  te as an.       
-00052300: 2069 6e66 6572 6162 6c65 2066 7265 7175   inferable frequ
-00052310: 656e 6369 6573 2028 7365 6520 3a70 793a  encies (see :py:
-00052320: 6675 6e63 3a60 7e78 6172 7261 792e 696e  func:`~xarray.in
-00052330: 6665 725f 6672 6571 6029 2061 6e64 2069  fer_freq`) and i
-00052340: 7320 6f6e 6c79 2061 7070 726f 7072 6961  s only appropria
-00052350: 7465 0a20 2020 2020 2020 2069 6620 7468  te.        if th
-00052360: 6520 7461 7267 6574 2063 6f6f 7264 696e  e target coordin
-00052370: 6174 652c 2067 656e 6572 6174 6564 2066  ate, generated f
-00052380: 726f 6d20 7468 6973 2066 7265 7175 656e  rom this frequen
-00052390: 6379 2c20 6861 7320 6461 7465 7320 6571  cy, has dates eq
-000523a0: 7569 7661 6c65 6e74 2074 6f20 7468 650a  uivalent to the.
-000523b0: 2020 2020 2020 2020 736f 7572 6365 2e20          source. 
-000523c0: 4974 2069 7320 7573 7561 6c6c 7920 2a2a  It is usually **
-000523d0: 6e6f 742a 2a20 6170 7072 6f70 7269 6174  not** appropriat
-000523e0: 6520 746f 2075 7365 2074 6869 7320 6d6f  e to use this mo
-000523f0: 6465 2077 6974 683a 0a0a 2020 2020 2020  de with:..      
-00052400: 2020 2d20 5065 7269 6f64 2d65 6e64 2066    - Period-end f
-00052410: 7265 7175 656e 6369 6573 203a 2027 4127  requencies : 'A'
-00052420: 2c20 2759 272c 2027 5127 206f 7220 274d  , 'Y', 'Q' or 'M
-00052430: 272c 2069 6e20 6f70 706f 7369 7469 6f6e  ', in opposition
-00052440: 2074 6f20 2741 5327 2027 5953 272c 2027   to 'AS' 'YS', '
-00052450: 5153 2720 616e 6420 274d 5327 0a20 2020  QS' and 'MS'.   
-00052460: 2020 2020 202d 2053 7562 2d6d 6f6e 7468       - Sub-month
-00052470: 6c79 2066 7265 7175 656e 6369 6573 2074  ly frequencies t
-00052480: 6861 7420 646f 206e 6f74 2064 6976 6964  hat do not divid
-00052490: 6520 6120 6461 7920 6576 656e 6c79 203a  e a day evenly :
-000524a0: 2027 5727 2c20 276e 4427 2077 6865 7265   'W', 'nD' where
-000524b0: 2060 4e20 213d 2031 600a 2020 2020 2020   `N != 1`.      
-000524c0: 2020 2020 2020 6f72 2027 6d48 2720 7768        or 'mH' wh
-000524d0: 6572 6520 3234 2025 206d 2021 3d20 3029  ere 24 % m != 0)
-000524e0: 2e0a 0a20 2020 2020 2020 2049 6620 6f6e  ...        If on
-000524f0: 6520 6f66 2074 6865 2073 6f75 7263 6520  e of the source 
-00052500: 6f72 2074 6172 6765 7420 6361 6c65 6e64  or target calend
-00052510: 6172 7320 6973 2060 2233 3630 5f64 6179  ars is `"360_day
-00052520: 2260 2c20 6061 6c69 676e 5f6f 6e60 206d  "`, `align_on` m
-00052530: 7573 740a 2020 2020 2020 2020 6265 2073  ust.        be s
-00052540: 7065 6369 6669 6564 2061 6e64 2074 776f  pecified and two
-00052550: 206f 7074 696f 6e73 2061 7265 206f 6666   options are off
-00052560: 6572 6564 2e0a 0a20 2020 2020 2020 202d  ered...        -
-00052570: 2022 7965 6172 220a 2020 2020 2020 2020   "year".        
-00052580: 2020 2020 5468 6520 6461 7465 7320 6172      The dates ar
-00052590: 6520 7472 616e 736c 6174 6564 2061 6363  e translated acc
-000525a0: 6f72 6469 6e67 2074 6f20 7468 6569 7220  ording to their 
-000525b0: 7265 6c61 7469 7665 2070 6f73 6974 696f  relative positio
-000525c0: 6e20 696e 2074 6865 2079 6561 722c 0a20  n in the year,. 
-000525d0: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
-000525e0: 696e 6720 7468 6569 7220 6f72 6967 696e  ing their origin
-000525f0: 616c 206d 6f6e 7468 2061 6e64 2064 6179  al month and day
-00052600: 2069 6e66 6f72 6d61 7469 6f6e 2c20 6d65   information, me
-00052610: 616e 696e 6720 7468 6174 2074 6865 0a20  aning that the. 
-00052620: 2020 2020 2020 2020 2020 206d 6973 7369             missi
-00052630: 6e67 2f73 7572 706c 7573 2064 6179 7320  ng/surplus days 
-00052640: 6172 6520 6164 6465 642f 7265 6d6f 7665  are added/remove
-00052650: 6420 6174 2072 6567 756c 6172 2069 6e74  d at regular int
-00052660: 6572 7661 6c73 2e0a 0a20 2020 2020 2020  ervals...       
-00052670: 2020 2020 2046 726f 6d20 6120 6033 3630       From a `360
-00052680: 5f64 6179 6020 746f 2061 2073 7461 6e64  _day` to a stand
-00052690: 6172 6420 6361 6c65 6e64 6172 2c20 7468  ard calendar, th
-000526a0: 6520 6f75 7470 7574 2077 696c 6c20 6265  e output will be
-000526b0: 206d 6973 7369 6e67 2074 6865 0a20 2020   missing the.   
-000526c0: 2020 2020 2020 2020 2066 6f6c 6c6f 7769           followi
-000526d0: 6e67 2064 6174 6573 2028 6461 7920 6f66  ng dates (day of
-000526e0: 2079 6561 7220 696e 2070 6172 656e 7468   year in parenth
-000526f0: 6573 6573 293a 0a0a 2020 2020 2020 2020  eses):..        
-00052700: 2020 2020 546f 2061 206c 6561 7020 7965      To a leap ye
-00052710: 6172 3a0a 2020 2020 2020 2020 2020 2020  ar:.            
-00052720: 2020 2020 4a61 6e75 6172 7920 3331 7374      January 31st
-00052730: 2028 3331 292c 204d 6172 6368 2033 3173   (31), March 31s
-00052740: 7420 2839 3129 2c20 4a75 6e65 2031 7374  t (91), June 1st
-00052750: 2028 3135 3329 2c20 4a75 6c79 2033 3173   (153), July 31s
-00052760: 7420 2832 3133 292c 0a20 2020 2020 2020  t (213),.       
-00052770: 2020 2020 2020 2020 2053 6570 7465 6d62           Septemb
-00052780: 6572 2033 3173 7420 2832 3735 2920 616e  er 31st (275) an
-00052790: 6420 4e6f 7665 6d62 6572 2033 3074 6820  d November 30th 
-000527a0: 2833 3335 292e 0a20 2020 2020 2020 2020  (335)..         
-000527b0: 2020 2054 6f20 6120 6e6f 6e2d 6c65 6170     To a non-leap
-000527c0: 2079 6561 723a 0a20 2020 2020 2020 2020   year:.         
-000527d0: 2020 2020 2020 2046 6562 7275 6172 7920         February 
-000527e0: 3674 6820 2833 3629 2c20 4170 7269 6c20  6th (36), April 
-000527f0: 3139 7468 2028 3130 3929 2c20 4a75 6c79  19th (109), July
-00052800: 2032 6e64 2028 3138 3329 2c0a 2020 2020   2nd (183),.    
-00052810: 2020 2020 2020 2020 2020 2020 5365 7074              Sept
-00052820: 656d 6265 7220 3132 7468 2028 3235 3529  ember 12th (255)
-00052830: 2c20 4e6f 7665 6d62 6572 2032 3574 6820  , November 25th 
-00052840: 2833 3239 292e 0a0a 2020 2020 2020 2020  (329)...        
-00052850: 2020 2020 4672 6f6d 2061 2073 7461 6e64      From a stand
-00052860: 6172 6420 6361 6c65 6e64 6172 2074 6f20  ard calendar to 
-00052870: 6120 6022 3336 305f 6461 7922 602c 2074  a `"360_day"`, t
-00052880: 6865 2066 6f6c 6c6f 7769 6e67 2064 6174  he following dat
-00052890: 6573 2069 6e20 7468 650a 2020 2020 2020  es in the.      
-000528a0: 2020 2020 2020 736f 7572 6365 2061 7272        source arr
-000528b0: 6179 2077 696c 6c20 6265 2064 726f 7070  ay will be dropp
-000528c0: 6564 3a0a 0a20 2020 2020 2020 2020 2020  ed:..           
-000528d0: 2046 726f 6d20 6120 6c65 6170 2079 6561   From a leap yea
-000528e0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-000528f0: 2020 204a 616e 7561 7279 2033 3173 7420     January 31st 
-00052900: 2833 3129 2c20 4170 7269 6c20 3173 7420  (31), April 1st 
-00052910: 2839 3229 2c20 4a75 6e65 2031 7374 2028  (92), June 1st (
-00052920: 3135 3329 2c20 4175 6775 7374 2031 7374  153), August 1st
-00052930: 2028 3231 3429 2c0a 2020 2020 2020 2020   (214),.        
-00052940: 2020 2020 2020 2020 5365 7074 656d 6265          Septembe
-00052950: 7220 3331 7374 2028 3237 3529 2c20 4465  r 31st (275), De
-00052960: 6365 6d62 6572 2031 7374 2028 3333 3629  cember 1st (336)
-00052970: 0a20 2020 2020 2020 2020 2020 2046 726f  .            Fro
-00052980: 6d20 6120 6e6f 6e2d 6c65 6170 2079 6561  m a non-leap yea
-00052990: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-000529a0: 2020 2046 6562 7275 6172 7920 3674 6820     February 6th 
-000529b0: 2833 3729 2c20 4170 7269 6c20 3230 7468  (37), April 20th
-000529c0: 2028 3131 3029 2c20 4a75 6c79 2032 6e64   (110), July 2nd
-000529d0: 2028 3138 3329 2c0a 2020 2020 2020 2020   (183),.        
-000529e0: 2020 2020 2020 2020 5365 7074 656d 6265          Septembe
-000529f0: 7220 3133 7468 2028 3235 3629 2c20 4e6f  r 13th (256), No
-00052a00: 7665 6d62 6572 2032 3574 6820 2833 3239  vember 25th (329
-00052a10: 290a 0a20 2020 2020 2020 2020 2020 2054  )..            T
-00052a20: 6869 7320 6f70 7469 6f6e 2069 7320 6265  his option is be
-00052a30: 7374 2075 7365 6420 6f6e 2064 6169 6c79  st used on daily
-00052a40: 2061 6e64 2073 7562 6461 696c 7920 6461   and subdaily da
-00052a50: 7461 2e0a 0a20 2020 2020 2020 202d 2022  ta...        - "
-00052a60: 6461 7465 220a 2020 2020 2020 2020 2020  date".          
-00052a70: 2020 5468 6520 6d6f 6e74 682f 6461 7920    The month/day 
-00052a80: 696e 666f 726d 6174 696f 6e20 6973 2063  information is c
-00052a90: 6f6e 7365 7276 6564 2061 6e64 2069 6e76  onserved and inv
-00052aa0: 616c 6964 2064 6174 6573 2061 7265 2064  alid dates are d
-00052ab0: 726f 7070 6564 0a20 2020 2020 2020 2020  ropped.         
-00052ac0: 2020 2066 726f 6d20 7468 6520 6f75 7470     from the outp
-00052ad0: 7574 2e20 5468 6973 206d 6561 6e73 2074  ut. This means t
-00052ae0: 6861 7420 7768 656e 2063 6f6e 7665 7274  hat when convert
-00052af0: 696e 6720 6672 6f6d 2061 2060 2233 3630  ing from a `"360
-00052b00: 5f64 6179 2260 2074 6f20 610a 2020 2020  _day"` to a.    
-00052b10: 2020 2020 2020 2020 7374 616e 6461 7264          standard
-00052b20: 2063 616c 656e 6461 722c 2061 6c6c 2033   calendar, all 3
-00052b30: 3173 7420 284a 616e 2c20 4d61 7263 682c  1st (Jan, March,
-00052b40: 204d 6179 2c20 4a75 6c79 2c20 4175 6775   May, July, Augu
-00052b50: 7374 2c20 4f63 746f 6265 7220 616e 640a  st, October and.
-00052b60: 2020 2020 2020 2020 2020 2020 4465 6365              Dece
-00052b70: 6d62 6572 2920 7769 6c6c 2062 6520 6d69  mber) will be mi
-00052b80: 7373 696e 6720 6173 2074 6865 7265 2069  ssing as there i
-00052b90: 7320 6e6f 2065 7175 6976 616c 656e 7420  s no equivalent 
-00052ba0: 6461 7465 7320 696e 2074 6865 0a20 2020  dates in the.   
-00052bb0: 2020 2020 2020 2020 2060 2233 3630 5f64           `"360_d
-00052bc0: 6179 2260 2063 616c 656e 6461 7220 616e  ay"` calendar an
-00052bd0: 6420 7468 6520 3239 7468 2028 6f6e 206e  d the 29th (on n
-00052be0: 6f6e 2d6c 6561 7020 7965 6172 7329 2061  on-leap years) a
-00052bf0: 6e64 2033 3074 6820 6f66 2046 6562 7275  nd 30th of Febru
-00052c00: 6172 790a 2020 2020 2020 2020 2020 2020  ary.            
-00052c10: 7769 6c6c 2062 6520 6472 6f70 7065 6420  will be dropped 
-00052c20: 6173 2074 6865 7265 2061 7265 206e 6f20  as there are no 
-00052c30: 6571 7569 7661 6c65 6e74 2064 6174 6573  equivalent dates
-00052c40: 2069 6e20 6120 7374 616e 6461 7264 2063   in a standard c
-00052c50: 616c 656e 6461 722e 0a0a 2020 2020 2020  alendar...      
-00052c60: 2020 2020 2020 5468 6973 206f 7074 696f        This optio
-00052c70: 6e20 6973 2062 6573 7420 7573 6564 2077  n is best used w
-00052c80: 6974 6820 6461 7461 206f 6e20 6120 6672  ith data on a fr
-00052c90: 6571 7565 6e63 7920 636f 6172 7365 7220  equency coarser 
-00052ca0: 7468 616e 2064 6169 6c79 2e0a 2020 2020  than daily..    
-00052cb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00052cc0: 7265 7475 726e 2063 6f6e 7665 7274 5f63  return convert_c
-00052cd0: 616c 656e 6461 7228 0a20 2020 2020 2020  alendar(.       
-00052ce0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00052cf0: 2020 2020 2020 2063 616c 656e 6461 722c         calendar,
-00052d00: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
-00052d10: 3d64 696d 2c0a 2020 2020 2020 2020 2020  =dim,.          
-00052d20: 2020 616c 6967 6e5f 6f6e 3d61 6c69 676e    align_on=align
-00052d30: 5f6f 6e2c 0a20 2020 2020 2020 2020 2020  _on,.           
-00052d40: 206d 6973 7369 6e67 3d6d 6973 7369 6e67   missing=missing
-00052d50: 2c0a 2020 2020 2020 2020 2020 2020 7573  ,.            us
-00052d60: 655f 6366 7469 6d65 3d75 7365 5f63 6674  e_cftime=use_cft
-00052d70: 696d 652c 0a20 2020 2020 2020 2029 0a0a  ime,.        )..
-00052d80: 2020 2020 6465 6620 696e 7465 7270 5f63      def interp_c
-00052d90: 616c 656e 6461 7228 0a20 2020 2020 2020  alendar(.       
-00052da0: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
-00052db0: 2c0a 2020 2020 2020 2020 7461 7267 6574  ,.        target
-00052dc0: 3a20 7064 2e44 6174 6574 696d 6549 6e64  : pd.DatetimeInd
-00052dd0: 6578 207c 2043 4654 696d 6549 6e64 6578  ex | CFTimeIndex
-00052de0: 207c 2044 6174 6141 7272 6179 2c0a 2020   | DataArray,.  
-00052df0: 2020 2020 2020 6469 6d3a 2048 6173 6861        dim: Hasha
-00052e00: 626c 6520 3d20 2274 696d 6522 2c0a 2020  ble = "time",.  
-00052e10: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
-00052e20: 3a0a 2020 2020 2020 2020 2222 2249 6e74  :.        """Int
-00052e30: 6572 706f 6c61 7465 7320 7468 6520 4461  erpolates the Da
-00052e40: 7461 7365 7420 746f 2061 6e6f 7468 6572  taset to another
-00052e50: 2063 616c 656e 6461 7220 6261 7365 6420   calendar based 
-00052e60: 6f6e 2064 6563 696d 616c 2079 6561 7220  on decimal year 
-00052e70: 6d65 6173 7572 652e 0a0a 2020 2020 2020  measure...      
-00052e80: 2020 4561 6368 2074 696d 6573 7461 6d70    Each timestamp
-00052e90: 2069 6e20 6073 6f75 7263 6560 2061 6e64   in `source` and
-00052ea0: 2060 7461 7267 6574 6020 6172 6520 6669   `target` are fi
-00052eb0: 7273 7420 636f 6e76 6572 7465 6420 746f  rst converted to
-00052ec0: 2074 6865 6972 2064 6563 696d 616c 0a20   their decimal. 
-00052ed0: 2020 2020 2020 2079 6561 7220 6571 7569         year equi
-00052ee0: 7661 6c65 6e74 2074 6865 6e20 6073 6f75  valent then `sou
-00052ef0: 7263 6560 2069 7320 696e 7465 7270 6f6c  rce` is interpol
-00052f00: 6174 6564 206f 6e20 7468 6520 7461 7267  ated on the targ
-00052f10: 6574 2063 6f6f 7264 696e 6174 652e 0a20  et coordinate.. 
-00052f20: 2020 2020 2020 2054 6865 2064 6563 696d         The decim
-00052f30: 616c 2079 6561 7220 6f66 2061 2074 696d  al year of a tim
-00052f40: 6573 7461 6d70 2069 7320 6974 7320 7965  estamp is its ye
-00052f50: 6172 2070 6c75 7320 6974 7320 7375 622d  ar plus its sub-
-00052f60: 7965 6172 2063 6f6d 706f 6e65 6e74 0a20  year component. 
-00052f70: 2020 2020 2020 2063 6f6e 7665 7274 6564         converted
-00052f80: 2074 6f20 7468 6520 6672 6163 7469 6f6e   to the fraction
-00052f90: 206f 6620 6974 7320 7965 6172 2e20 466f   of its year. Fo
-00052fa0: 7220 6578 616d 706c 6520 2232 3030 302d  r example "2000-
-00052fb0: 3033 2d30 3120 3132 3a30 3022 2069 730a  03-01 12:00" is.
-00052fc0: 2020 2020 2020 2020 3230 3030 2e31 3635          2000.165
-00052fd0: 3320 696e 2061 2073 7461 6e64 6172 6420  3 in a standard 
-00052fe0: 6361 6c65 6e64 6172 206f 7220 3230 3030  calendar or 2000
-00052ff0: 2e31 3633 3031 2069 6e20 6120 6022 6e6f  .16301 in a `"no
-00053000: 6c65 6170 2260 2063 616c 656e 6461 722e  leap"` calendar.
-00053010: 0a0a 2020 2020 2020 2020 5468 6973 206d  ..        This m
-00053020: 6574 686f 6420 7368 6f75 6c64 206f 6e6c  ethod should onl
-00053030: 7920 6265 2075 7365 6420 7768 656e 2074  y be used when t
-00053040: 6865 2074 696d 6520 2848 483a 4d4d 3a53  he time (HH:MM:S
-00053050: 5329 2069 6e66 6f72 6d61 7469 6f6e 206f  S) information o
-00053060: 660a 2020 2020 2020 2020 7469 6d65 2063  f.        time c
-00053070: 6f6f 7264 696e 6174 6520 6973 206e 6f74  oordinate is not
-00053080: 2069 6d70 6f72 7461 6e74 2e0a 0a20 2020   important...   
-00053090: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-000530a0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-000530b0: 2d2d 0a20 2020 2020 2020 2074 6172 6765  --.        targe
-000530c0: 743a 2044 6174 6141 7272 6179 206f 7220  t: DataArray or 
-000530d0: 4461 7465 7469 6d65 496e 6465 7820 6f72  DatetimeIndex or
-000530e0: 2043 4654 696d 6549 6e64 6578 0a20 2020   CFTimeIndex.   
-000530f0: 2020 2020 2020 2020 2054 6865 2074 6172           The tar
-00053100: 6765 7420 7469 6d65 2063 6f6f 7264 696e  get time coordin
-00053110: 6174 6520 6f66 2061 2076 616c 6964 2064  ate of a valid d
-00053120: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
-00053130: 2028 6e70 2e64 6174 6574 696d 6536 3420   (np.datetime64 
-00053140: 6f72 2063 6674 696d 6520 6f62 6a65 6374  or cftime object
-00053150: 7329 0a20 2020 2020 2020 2064 696d 203a  s).        dim :
-00053160: 2048 6173 6861 626c 652c 2064 6566 6175   Hashable, defau
-00053170: 6c74 3a20 2274 696d 6522 0a20 2020 2020  lt: "time".     
-00053180: 2020 2020 2020 2054 6865 2074 696d 6520         The time 
-00053190: 636f 6f72 6469 6e61 7465 206e 616d 652e  coordinate name.
-000531a0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-000531b0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d0a  .        ------.
-000531c0: 2020 2020 2020 2020 4461 7461 4172 7261          DataArra
-000531d0: 790a 2020 2020 2020 2020 2020 2020 5468  y.            Th
-000531e0: 6520 736f 7572 6365 2069 6e74 6572 706f  e source interpo
-000531f0: 6c61 7465 6420 6f6e 2074 6865 2064 6563  lated on the dec
-00053200: 696d 616c 2079 6561 7273 206f 6620 7461  imal years of ta
-00053210: 7267 6574 2c0a 2020 2020 2020 2020 2222  rget,.        ""
-00053220: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00053230: 2069 6e74 6572 705f 6361 6c65 6e64 6172   interp_calendar
-00053240: 2873 656c 662c 2074 6172 6765 742c 2064  (self, target, d
-00053250: 696d 3d64 696d 290a 0a20 2020 2064 6566  im=dim)..    def
-00053260: 2067 726f 7570 6279 280a 2020 2020 2020   groupby(.      
-00053270: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00053280: 6772 6f75 703a 2048 6173 6861 626c 6520  group: Hashable 
-00053290: 7c20 4461 7461 4172 7261 7920 7c20 496e  | DataArray | In
-000532a0: 6465 7856 6172 6961 626c 652c 0a20 2020  dexVariable,.   
-000532b0: 2020 2020 2073 7175 6565 7a65 3a20 626f       squeeze: bo
-000532c0: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
-000532d0: 2020 2072 6573 746f 7265 5f63 6f6f 7264     restore_coord
-000532e0: 5f64 696d 733a 2062 6f6f 6c20 3d20 4661  _dims: bool = Fa
-000532f0: 6c73 652c 0a20 2020 2029 202d 3e20 4461  lse,.    ) -> Da
-00053300: 7461 7365 7447 726f 7570 4279 3a0a 2020  tasetGroupBy:.  
-00053310: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-00053320: 2061 2044 6174 6173 6574 4772 6f75 7042   a DatasetGroupB
-00053330: 7920 6f62 6a65 6374 2066 6f72 2070 6572  y object for per
-00053340: 666f 726d 696e 6720 6772 6f75 7065 6420  forming grouped 
-00053350: 6f70 6572 6174 696f 6e73 2e0a 0a20 2020  operations...   
-00053360: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00053370: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00053380: 2d2d 0a20 2020 2020 2020 2067 726f 7570  --.        group
-00053390: 203a 2048 6173 6861 626c 652c 2044 6174   : Hashable, Dat
-000533a0: 6141 7272 6179 206f 7220 496e 6465 7856  aArray or IndexV
-000533b0: 6172 6961 626c 650a 2020 2020 2020 2020  ariable.        
-000533c0: 2020 2020 4172 7261 7920 7768 6f73 6520      Array whose 
-000533d0: 756e 6971 7565 2076 616c 7565 7320 7368  unique values sh
-000533e0: 6f75 6c64 2062 6520 7573 6564 2074 6f20  ould be used to 
-000533f0: 6772 6f75 7020 7468 6973 2061 7272 6179  group this array
-00053400: 2e20 4966 2061 0a20 2020 2020 2020 2020  . If a.         
-00053410: 2020 2073 7472 696e 672c 206d 7573 7420     string, must 
-00053420: 6265 2074 6865 206e 616d 6520 6f66 2061  be the name of a
-00053430: 2076 6172 6961 626c 6520 636f 6e74 6169   variable contai
-00053440: 6e65 6420 696e 2074 6869 7320 6461 7461  ned in this data
-00053450: 7365 742e 0a20 2020 2020 2020 2073 7175  set..        squ
-00053460: 6565 7a65 203a 2062 6f6f 6c2c 2064 6566  eeze : bool, def
-00053470: 6175 6c74 3a20 5472 7565 0a20 2020 2020  ault: True.     
-00053480: 2020 2020 2020 2049 6620 2267 726f 7570         If "group
-00053490: 2220 6973 2061 2064 696d 656e 7369 6f6e  " is a dimension
-000534a0: 206f 6620 616e 7920 6172 7261 7973 2069   of any arrays i
-000534b0: 6e20 7468 6973 2064 6174 6173 6574 2c20  n this dataset, 
-000534c0: 6073 7175 6565 7a65 600a 2020 2020 2020  `squeeze`.      
-000534d0: 2020 2020 2020 636f 6e74 726f 6c73 2077        controls w
-000534e0: 6865 7468 6572 2074 6865 2073 7562 6172  hether the subar
-000534f0: 7261 7973 2068 6176 6520 6120 6469 6d65  rays have a dime
-00053500: 6e73 696f 6e20 6f66 206c 656e 6774 6820  nsion of length 
-00053510: 3120 616c 6f6e 670a 2020 2020 2020 2020  1 along.        
-00053520: 2020 2020 7468 6174 2064 696d 656e 7369      that dimensi
-00053530: 6f6e 206f 7220 6966 2074 6865 2064 696d  on or if the dim
-00053540: 656e 7369 6f6e 2069 7320 7371 7565 657a  ension is squeez
-00053550: 6564 206f 7574 2e0a 2020 2020 2020 2020  ed out..        
-00053560: 7265 7374 6f72 655f 636f 6f72 645f 6469  restore_coord_di
-00053570: 6d73 203a 2062 6f6f 6c2c 2064 6566 6175  ms : bool, defau
-00053580: 6c74 3a20 4661 6c73 650a 2020 2020 2020  lt: False.      
-00053590: 2020 2020 2020 4966 2054 7275 652c 2061        If True, a
-000535a0: 6c73 6f20 7265 7374 6f72 6520 7468 6520  lso restore the 
-000535b0: 6469 6d65 6e73 696f 6e20 6f72 6465 7220  dimension order 
-000535c0: 6f66 206d 756c 7469 2d64 696d 656e 7369  of multi-dimensi
-000535d0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-000535e0: 2063 6f6f 7264 696e 6174 6573 2e0a 0a20   coordinates... 
-000535f0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-00053600: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-00053610: 2020 2020 2020 2067 726f 7570 6564 203a         grouped :
-00053620: 2044 6174 6173 6574 4772 6f75 7042 790a   DatasetGroupBy.
-00053630: 2020 2020 2020 2020 2020 2020 4120 6044              A `D
-00053640: 6174 6173 6574 4772 6f75 7042 7960 206f  atasetGroupBy` o
-00053650: 626a 6563 7420 7061 7474 6572 6e65 6420  bject patterned 
-00053660: 6166 7465 7220 6070 616e 6461 732e 4772  after `pandas.Gr
-00053670: 6f75 7042 7960 2074 6861 7420 6361 6e20  oupBy` that can 
-00053680: 6265 0a20 2020 2020 2020 2020 2020 2069  be.            i
-00053690: 7465 7261 7465 6420 6f76 6572 2069 6e20  terated over in 
-000536a0: 7468 6520 666f 726d 206f 6620 6028 756e  the form of `(un
-000536b0: 6971 7565 5f76 616c 7565 2c20 6772 6f75  ique_value, grou
-000536c0: 7065 645f 6172 7261 7929 6020 7061 6972  ped_array)` pair
-000536d0: 732e 0a0a 2020 2020 2020 2020 5365 6520  s...        See 
-000536e0: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
-000536f0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 3a72  -----.        :r
-00053700: 6566 3a60 6772 6f75 7062 7960 0a20 2020  ef:`groupby`.   
-00053710: 2020 2020 2020 2020 2055 7365 7273 2067           Users g
-00053720: 7569 6465 2065 7870 6c61 6e61 7469 6f6e  uide explanation
-00053730: 206f 6620 686f 7720 746f 2067 726f 7570   of how to group
-00053740: 2061 6e64 2062 696e 2064 6174 612e 0a20   and bin data.. 
-00053750: 2020 2020 2020 2044 6174 6173 6574 2e67         Dataset.g
-00053760: 726f 7570 6279 5f62 696e 730a 2020 2020  roupby_bins.    
-00053770: 2020 2020 4461 7461 4172 7261 792e 6772      DataArray.gr
-00053780: 6f75 7062 790a 2020 2020 2020 2020 636f  oupby.        co
-00053790: 7265 2e67 726f 7570 6279 2e44 6174 6173  re.groupby.Datas
-000537a0: 6574 4772 6f75 7042 790a 2020 2020 2020  etGroupBy.      
-000537b0: 2020 7061 6e64 6173 2e44 6174 6146 7261    pandas.DataFra
-000537c0: 6d65 2e67 726f 7570 6279 0a20 2020 2020  me.groupby.     
-000537d0: 2020 2044 6174 6173 6574 2e72 6573 616d     Dataset.resam
-000537e0: 706c 650a 2020 2020 2020 2020 4461 7461  ple.        Data
-000537f0: 4172 7261 792e 7265 7361 6d70 6c65 0a20  Array.resample. 
-00053800: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00053810: 2020 2066 726f 6d20 7861 7272 6179 2e63     from xarray.c
-00053820: 6f72 652e 6772 6f75 7062 7920 696d 706f  ore.groupby impo
-00053830: 7274 2044 6174 6173 6574 4772 6f75 7042  rt DatasetGroupB
-00053840: 790a 0a20 2020 2020 2020 2023 2057 6869  y..        # Whi
-00053850: 6c65 2077 6520 646f 6e27 7420 6765 6e65  le we don't gene
-00053860: 7261 6c6c 7920 6368 6563 6b20 7468 6520  rally check the 
-00053870: 7479 7065 206f 6620 6576 6572 7920 6172  type of every ar
-00053880: 672c 2070 6173 7369 6e67 0a20 2020 2020  g, passing.     
-00053890: 2020 2023 206d 756c 7469 706c 6520 6469     # multiple di
-000538a0: 6d65 6e73 696f 6e73 2061 7320 6d75 6c74  mensions as mult
-000538b0: 6970 6c65 2061 7267 756d 656e 7473 2069  iple arguments i
-000538c0: 7320 636f 6d6d 6f6e 2065 6e6f 7567 682c  s common enough,
-000538d0: 2061 6e64 2074 6865 0a20 2020 2020 2020   and the.       
-000538e0: 2023 2063 6f6e 7365 7175 656e 6365 7320   # consequences 
-000538f0: 6869 6464 656e 2065 6e6f 7567 6820 2873  hidden enough (s
-00053900: 7472 696e 6773 2065 7661 6c75 6174 6520  trings evaluate 
-00053910: 6173 2074 7275 6529 2074 6f20 7761 7272  as true) to warr
-00053920: 616e 740a 2020 2020 2020 2020 2320 6368  ant.        # ch
-00053930: 6563 6b69 6e67 2068 6572 652e 0a20 2020  ecking here..   
-00053940: 2020 2020 2023 2041 2066 7574 7572 6520       # A future 
-00053950: 7665 7273 696f 6e20 636f 756c 6420 6d61  version could ma
-00053960: 6b65 2073 7175 6565 7a65 206b 7761 7267  ke squeeze kwarg
-00053970: 206f 6e6c 792c 2062 7574 2077 6f75 6c64   only, but would
-00053980: 2066 6163 650a 2020 2020 2020 2020 2320   face.        # 
-00053990: 6261 636b 7761 7264 2d63 6f6d 7061 7420  backward-compat 
-000539a0: 6973 7375 6573 2e0a 2020 2020 2020 2020  issues..        
-000539b0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-000539c0: 6528 7371 7565 657a 652c 2062 6f6f 6c29  e(squeeze, bool)
-000539d0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000539e0: 6973 6520 5479 7065 4572 726f 7228 0a20  ise TypeError(. 
-000539f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00053a00: 2260 7371 7565 657a 6560 206d 7573 7420  "`squeeze` must 
-00053a10: 6265 2054 7275 6520 6f72 2046 616c 7365  be True or False
-00053a20: 2c20 6275 7420 7b73 7175 6565 7a65 7d20  , but {squeeze} 
-00053a30: 7761 7320 7375 7070 6c69 6564 220a 2020  was supplied".  
-00053a40: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00053a50: 2020 2020 2072 6574 7572 6e20 4461 7461       return Data
-00053a60: 7365 7447 726f 7570 4279 280a 2020 2020  setGroupBy(.    
-00053a70: 2020 2020 2020 2020 7365 6c66 2c20 6772          self, gr
-00053a80: 6f75 702c 2073 7175 6565 7a65 3d73 7175  oup, squeeze=squ
-00053a90: 6565 7a65 2c20 7265 7374 6f72 655f 636f  eeze, restore_co
-00053aa0: 6f72 645f 6469 6d73 3d72 6573 746f 7265  ord_dims=restore
-00053ab0: 5f63 6f6f 7264 5f64 696d 730a 2020 2020  _coord_dims.    
-00053ac0: 2020 2020 290a 0a20 2020 2064 6566 2067      )..    def g
-00053ad0: 726f 7570 6279 5f62 696e 7328 0a20 2020  roupby_bins(.   
-00053ae0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00053af0: 2020 2067 726f 7570 3a20 4861 7368 6162     group: Hashab
-00053b00: 6c65 207c 2044 6174 6141 7272 6179 207c  le | DataArray |
-00053b10: 2049 6e64 6578 5661 7269 6162 6c65 2c0a   IndexVariable,.
-00053b20: 2020 2020 2020 2020 6269 6e73 3a20 4172          bins: Ar
-00053b30: 7261 794c 696b 652c 0a20 2020 2020 2020  rayLike,.       
-00053b40: 2072 6967 6874 3a20 626f 6f6c 203d 2054   right: bool = T
-00053b50: 7275 652c 0a20 2020 2020 2020 206c 6162  rue,.        lab
-00053b60: 656c 733a 2041 7272 6179 4c69 6b65 207c  els: ArrayLike |
-00053b70: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00053b80: 2020 2020 2020 7072 6563 6973 696f 6e3a        precision:
-00053b90: 2069 6e74 203d 2033 2c0a 2020 2020 2020   int = 3,.      
-00053ba0: 2020 696e 636c 7564 655f 6c6f 7765 7374    include_lowest
-00053bb0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-00053bc0: 2020 2020 2020 2020 7371 7565 657a 653a          squeeze:
-00053bd0: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
-00053be0: 2020 2020 2020 7265 7374 6f72 655f 636f        restore_co
-00053bf0: 6f72 645f 6469 6d73 3a20 626f 6f6c 203d  ord_dims: bool =
-00053c00: 2046 616c 7365 2c0a 2020 2020 2920 2d3e   False,.    ) ->
-00053c10: 2044 6174 6173 6574 4772 6f75 7042 793a   DatasetGroupBy:
-00053c20: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-00053c30: 726e 7320 6120 4461 7461 7365 7447 726f  rns a DatasetGro
-00053c40: 7570 4279 206f 626a 6563 7420 666f 7220  upBy object for 
-00053c50: 7065 7266 6f72 6d69 6e67 2067 726f 7570  performing group
-00053c60: 6564 206f 7065 7261 7469 6f6e 732e 0a0a  ed operations...
-00053c70: 2020 2020 2020 2020 5261 7468 6572 2074          Rather t
-00053c80: 6861 6e20 7573 696e 6720 616c 6c20 756e  han using all un
-00053c90: 6971 7565 2076 616c 7565 7320 6f66 2060  ique values of `
-00053ca0: 6772 6f75 7060 2c20 7468 6520 7661 6c75  group`, the valu
-00053cb0: 6573 2061 7265 2064 6973 6372 6574 697a  es are discretiz
-00053cc0: 6564 0a20 2020 2020 2020 2066 6972 7374  ed.        first
-00053cd0: 2062 7920 6170 706c 7969 6e67 2060 7061   by applying `pa
-00053ce0: 6e64 6173 2e63 7574 6020 5b31 5d5f 2074  ndas.cut` [1]_ t
-00053cf0: 6f20 6067 726f 7570 602e 0a0a 2020 2020  o `group`...    
-00053d00: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00053d10: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00053d20: 2d0a 2020 2020 2020 2020 6772 6f75 7020  -.        group 
-00053d30: 3a20 4861 7368 6162 6c65 2c20 4461 7461  : Hashable, Data
-00053d40: 4172 7261 7920 6f72 2049 6e64 6578 5661  Array or IndexVa
-00053d50: 7269 6162 6c65 0a20 2020 2020 2020 2020  riable.         
-00053d60: 2020 2041 7272 6179 2077 686f 7365 2062     Array whose b
-00053d70: 696e 6e65 6420 7661 6c75 6573 2073 686f  inned values sho
-00053d80: 756c 6420 6265 2075 7365 6420 746f 2067  uld be used to g
-00053d90: 726f 7570 2074 6869 7320 6172 7261 792e  roup this array.
-00053da0: 2049 6620 610a 2020 2020 2020 2020 2020   If a.          
-00053db0: 2020 7374 7269 6e67 2c20 6d75 7374 2062    string, must b
-00053dc0: 6520 7468 6520 6e61 6d65 206f 6620 6120  e the name of a 
-00053dd0: 7661 7269 6162 6c65 2063 6f6e 7461 696e  variable contain
-00053de0: 6564 2069 6e20 7468 6973 2064 6174 6173  ed in this datas
-00053df0: 6574 2e0a 2020 2020 2020 2020 6269 6e73  et..        bins
-00053e00: 203a 2069 6e74 206f 7220 6172 7261 792d   : int or array-
-00053e10: 6c69 6b65 0a20 2020 2020 2020 2020 2020  like.           
-00053e20: 2049 6620 6269 6e73 2069 7320 616e 2069   If bins is an i
-00053e30: 6e74 2c20 6974 2064 6566 696e 6573 2074  nt, it defines t
-00053e40: 6865 206e 756d 6265 7220 6f66 2065 7175  he number of equ
-00053e50: 616c 2d77 6964 7468 2062 696e 7320 696e  al-width bins in
-00053e60: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00053e70: 2072 616e 6765 206f 6620 782e 2048 6f77   range of x. How
-00053e80: 6576 6572 2c20 696e 2074 6869 7320 6361  ever, in this ca
-00053e90: 7365 2c20 7468 6520 7261 6e67 6520 6f66  se, the range of
-00053ea0: 2078 2069 7320 6578 7465 6e64 6564 2062   x is extended b
-00053eb0: 7920 2e31 250a 2020 2020 2020 2020 2020  y .1%.          
-00053ec0: 2020 6f6e 2065 6163 6820 7369 6465 2074    on each side t
-00053ed0: 6f20 696e 636c 7564 6520 7468 6520 6d69  o include the mi
-00053ee0: 6e20 6f72 206d 6178 2076 616c 7565 7320  n or max values 
-00053ef0: 6f66 2078 2e20 4966 2062 696e 7320 6973  of x. If bins is
-00053f00: 2061 0a20 2020 2020 2020 2020 2020 2073   a.            s
-00053f10: 6571 7565 6e63 6520 6974 2064 6566 696e  equence it defin
-00053f20: 6573 2074 6865 2062 696e 2065 6467 6573  es the bin edges
-00053f30: 2061 6c6c 6f77 696e 6720 666f 7220 6e6f   allowing for no
-00053f40: 6e2d 756e 6966 6f72 6d20 6269 6e0a 2020  n-uniform bin.  
-00053f50: 2020 2020 2020 2020 2020 7769 6474 682e            width.
-00053f60: 204e 6f20 6578 7465 6e73 696f 6e20 6f66   No extension of
-00053f70: 2074 6865 2072 616e 6765 206f 6620 7820   the range of x 
-00053f80: 6973 2064 6f6e 6520 696e 2074 6869 7320  is done in this 
-00053f90: 6361 7365 2e0a 2020 2020 2020 2020 7269  case..        ri
-00053fa0: 6768 7420 3a20 626f 6f6c 2c20 6465 6661  ght : bool, defa
-00053fb0: 756c 743a 2054 7275 650a 2020 2020 2020  ult: True.      
-00053fc0: 2020 2020 2020 496e 6469 6361 7465 7320        Indicates 
-00053fd0: 7768 6574 6865 7220 7468 6520 6269 6e73  whether the bins
-00053fe0: 2069 6e63 6c75 6465 2074 6865 2072 6967   include the rig
-00053ff0: 6874 6d6f 7374 2065 6467 6520 6f72 206e  htmost edge or n
-00054000: 6f74 2e20 4966 0a20 2020 2020 2020 2020  ot. If.         
-00054010: 2020 2072 6967 6874 203d 3d20 5472 7565     right == True
-00054020: 2028 7468 6520 6465 6661 756c 7429 2c20   (the default), 
-00054030: 7468 656e 2074 6865 2062 696e 7320 5b31  then the bins [1
-00054040: 2c32 2c33 2c34 5d20 696e 6469 6361 7465  ,2,3,4] indicate
-00054050: 0a20 2020 2020 2020 2020 2020 2028 312c  .            (1,
-00054060: 325d 2c20 2832 2c33 5d2c 2028 332c 345d  2], (2,3], (3,4]
-00054070: 2e0a 2020 2020 2020 2020 6c61 6265 6c73  ..        labels
-00054080: 203a 2061 7272 6179 2d6c 696b 6520 6f72   : array-like or
-00054090: 2062 6f6f 6c2c 2064 6566 6175 6c74 3a20   bool, default: 
-000540a0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-000540b0: 2055 7365 6420 6173 206c 6162 656c 7320   Used as labels 
-000540c0: 666f 7220 7468 6520 7265 7375 6c74 696e  for the resultin
-000540d0: 6720 6269 6e73 2e20 4d75 7374 2062 6520  g bins. Must be 
-000540e0: 6f66 2074 6865 2073 616d 6520 6c65 6e67  of the same leng
-000540f0: 7468 2061 730a 2020 2020 2020 2020 2020  th as.          
-00054100: 2020 7468 6520 7265 7375 6c74 696e 6720    the resulting 
-00054110: 6269 6e73 2e20 4966 2046 616c 7365 2c20  bins. If False, 
-00054120: 7374 7269 6e67 2062 696e 206c 6162 656c  string bin label
-00054130: 7320 6172 6520 6173 7369 676e 6564 2062  s are assigned b
-00054140: 790a 2020 2020 2020 2020 2020 2020 6070  y.            `p
-00054150: 616e 6461 732e 6375 7460 2e0a 2020 2020  andas.cut`..    
-00054160: 2020 2020 7072 6563 6973 696f 6e20 3a20      precision : 
-00054170: 696e 742c 2064 6566 6175 6c74 3a20 330a  int, default: 3.
-00054180: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-00054190: 7072 6563 6973 696f 6e20 6174 2077 6869  precision at whi
-000541a0: 6368 2074 6f20 7374 6f72 6520 616e 6420  ch to store and 
-000541b0: 6469 7370 6c61 7920 7468 6520 6269 6e73  display the bins
-000541c0: 206c 6162 656c 732e 0a20 2020 2020 2020   labels..       
-000541d0: 2069 6e63 6c75 6465 5f6c 6f77 6573 7420   include_lowest 
-000541e0: 3a20 626f 6f6c 2c20 6465 6661 756c 743a  : bool, default:
-000541f0: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-00054200: 2020 2057 6865 7468 6572 2074 6865 2066     Whether the f
-00054210: 6972 7374 2069 6e74 6572 7661 6c20 7368  irst interval sh
-00054220: 6f75 6c64 2062 6520 6c65 6674 2d69 6e63  ould be left-inc
-00054230: 6c75 7369 7665 206f 7220 6e6f 742e 0a20  lusive or not.. 
-00054240: 2020 2020 2020 2073 7175 6565 7a65 203a         squeeze :
-00054250: 2062 6f6f 6c2c 2064 6566 6175 6c74 3a20   bool, default: 
-00054260: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00054270: 2049 6620 2267 726f 7570 2220 6973 2061   If "group" is a
-00054280: 2064 696d 656e 7369 6f6e 206f 6620 616e   dimension of an
-00054290: 7920 6172 7261 7973 2069 6e20 7468 6973  y arrays in this
-000542a0: 2064 6174 6173 6574 2c20 6073 7175 6565   dataset, `squee
-000542b0: 7a65 600a 2020 2020 2020 2020 2020 2020  ze`.            
-000542c0: 636f 6e74 726f 6c73 2077 6865 7468 6572  controls whether
-000542d0: 2074 6865 2073 7562 6172 7261 7973 2068   the subarrays h
-000542e0: 6176 6520 6120 6469 6d65 6e73 696f 6e20  ave a dimension 
-000542f0: 6f66 206c 656e 6774 6820 3120 616c 6f6e  of length 1 alon
-00054300: 670a 2020 2020 2020 2020 2020 2020 7468  g.            th
-00054310: 6174 2064 696d 656e 7369 6f6e 206f 7220  at dimension or 
-00054320: 6966 2074 6865 2064 696d 656e 7369 6f6e  if the dimension
-00054330: 2069 7320 7371 7565 657a 6564 206f 7574   is squeezed out
-00054340: 2e0a 2020 2020 2020 2020 7265 7374 6f72  ..        restor
-00054350: 655f 636f 6f72 645f 6469 6d73 203a 2062  e_coord_dims : b
-00054360: 6f6f 6c2c 2064 6566 6175 6c74 3a20 4661  ool, default: Fa
-00054370: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00054380: 4966 2054 7275 652c 2061 6c73 6f20 7265  If True, also re
-00054390: 7374 6f72 6520 7468 6520 6469 6d65 6e73  store the dimens
-000543a0: 696f 6e20 6f72 6465 7220 6f66 206d 756c  ion order of mul
-000543b0: 7469 2d64 696d 656e 7369 6f6e 616c 0a20  ti-dimensional. 
-000543c0: 2020 2020 2020 2020 2020 2063 6f6f 7264             coord
-000543d0: 696e 6174 6573 2e0a 0a20 2020 2020 2020  inates...       
-000543e0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-000543f0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-00054400: 2067 726f 7570 6564 203a 2044 6174 6173   grouped : Datas
-00054410: 6574 4772 6f75 7042 790a 2020 2020 2020  etGroupBy.      
-00054420: 2020 2020 2020 4120 6044 6174 6173 6574        A `Dataset
-00054430: 4772 6f75 7042 7960 206f 626a 6563 7420  GroupBy` object 
-00054440: 7061 7474 6572 6e65 6420 6166 7465 7220  patterned after 
-00054450: 6070 616e 6461 732e 4772 6f75 7042 7960  `pandas.GroupBy`
-00054460: 2074 6861 7420 6361 6e20 6265 0a20 2020   that can be.   
-00054470: 2020 2020 2020 2020 2069 7465 7261 7465           iterate
-00054480: 6420 6f76 6572 2069 6e20 7468 6520 666f  d over in the fo
-00054490: 726d 206f 6620 6028 756e 6971 7565 5f76  rm of `(unique_v
-000544a0: 616c 7565 2c20 6772 6f75 7065 645f 6172  alue, grouped_ar
-000544b0: 7261 7929 6020 7061 6972 732e 0a20 2020  ray)` pairs..   
-000544c0: 2020 2020 2020 2020 2054 6865 206e 616d           The nam
-000544d0: 6520 6f66 2074 6865 2067 726f 7570 2068  e of the group h
-000544e0: 6173 2074 6865 2061 6464 6564 2073 7566  as the added suf
-000544f0: 6669 7820 605f 6269 6e73 6020 696e 206f  fix `_bins` in o
-00054500: 7264 6572 2074 6f0a 2020 2020 2020 2020  rder to.        
-00054510: 2020 2020 6469 7374 696e 6775 6973 6820      distinguish 
-00054520: 6974 2066 726f 6d20 7468 6520 6f72 6967  it from the orig
-00054530: 696e 616c 2076 6172 6961 626c 652e 0a0a  inal variable...
-00054540: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-00054550: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00054560: 2d0a 2020 2020 2020 2020 3a72 6566 3a60  -.        :ref:`
-00054570: 6772 6f75 7062 7960 0a20 2020 2020 2020  groupby`.       
-00054580: 2020 2020 2055 7365 7273 2067 7569 6465       Users guide
-00054590: 2065 7870 6c61 6e61 7469 6f6e 206f 6620   explanation of 
-000545a0: 686f 7720 746f 2067 726f 7570 2061 6e64  how to group and
-000545b0: 2062 696e 2064 6174 612e 0a20 2020 2020   bin data..     
-000545c0: 2020 2044 6174 6173 6574 2e67 726f 7570     Dataset.group
-000545d0: 6279 0a20 2020 2020 2020 2044 6174 6141  by.        DataA
-000545e0: 7272 6179 2e67 726f 7570 6279 5f62 696e  rray.groupby_bin
-000545f0: 730a 2020 2020 2020 2020 636f 7265 2e67  s.        core.g
-00054600: 726f 7570 6279 2e44 6174 6173 6574 4772  roupby.DatasetGr
-00054610: 6f75 7042 790a 2020 2020 2020 2020 7061  oupBy.        pa
-00054620: 6e64 6173 2e44 6174 6146 7261 6d65 2e67  ndas.DataFrame.g
-00054630: 726f 7570 6279 0a0a 2020 2020 2020 2020  roupby..        
-00054640: 5265 6665 7265 6e63 6573 0a20 2020 2020  References.     
-00054650: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00054660: 2020 2020 2020 2e2e 205b 315d 2068 7474        .. [1] htt
-00054670: 703a 2f2f 7061 6e64 6173 2e70 7964 6174  p://pandas.pydat
-00054680: 612e 6f72 672f 7061 6e64 6173 2d64 6f63  a.org/pandas-doc
-00054690: 732f 7374 6162 6c65 2f67 656e 6572 6174  s/stable/generat
-000546a0: 6564 2f70 616e 6461 732e 6375 742e 6874  ed/pandas.cut.ht
-000546b0: 6d6c 0a20 2020 2020 2020 2022 2222 0a20  ml.        """. 
-000546c0: 2020 2020 2020 2066 726f 6d20 7861 7272         from xarr
-000546d0: 6179 2e63 6f72 652e 6772 6f75 7062 7920  ay.core.groupby 
-000546e0: 696d 706f 7274 2044 6174 6173 6574 4772  import DatasetGr
-000546f0: 6f75 7042 790a 0a20 2020 2020 2020 2072  oupBy..        r
-00054700: 6574 7572 6e20 4461 7461 7365 7447 726f  eturn DatasetGro
-00054710: 7570 4279 280a 2020 2020 2020 2020 2020  upBy(.          
-00054720: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00054730: 2020 2020 6772 6f75 702c 0a20 2020 2020      group,.     
-00054740: 2020 2020 2020 2073 7175 6565 7a65 3d73         squeeze=s
-00054750: 7175 6565 7a65 2c0a 2020 2020 2020 2020  queeze,.        
-00054760: 2020 2020 6269 6e73 3d62 696e 732c 0a20      bins=bins,. 
-00054770: 2020 2020 2020 2020 2020 2072 6573 746f             resto
-00054780: 7265 5f63 6f6f 7264 5f64 696d 733d 7265  re_coord_dims=re
-00054790: 7374 6f72 655f 636f 6f72 645f 6469 6d73  store_coord_dims
-000547a0: 2c0a 2020 2020 2020 2020 2020 2020 6375  ,.            cu
-000547b0: 745f 6b77 6172 6773 3d7b 0a20 2020 2020  t_kwargs={.     
-000547c0: 2020 2020 2020 2020 2020 2022 7269 6768             "righ
-000547d0: 7422 3a20 7269 6768 742c 0a20 2020 2020  t": right,.     
-000547e0: 2020 2020 2020 2020 2020 2022 6c61 6265             "labe
-000547f0: 6c73 223a 206c 6162 656c 732c 0a20 2020  ls": labels,.   
-00054800: 2020 2020 2020 2020 2020 2020 2022 7072               "pr
-00054810: 6563 6973 696f 6e22 3a20 7072 6563 6973  ecision": precis
-00054820: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-00054830: 2020 2020 2022 696e 636c 7564 655f 6c6f       "include_lo
-00054840: 7765 7374 223a 2069 6e63 6c75 6465 5f6c  west": include_l
-00054850: 6f77 6573 742c 0a20 2020 2020 2020 2020  owest,.         
-00054860: 2020 207d 2c0a 2020 2020 2020 2020 290a     },.        ).
-00054870: 0a20 2020 2064 6566 2077 6569 6768 7465  .    def weighte
-00054880: 6428 7365 6c66 2c20 7765 6967 6874 733a  d(self, weights:
-00054890: 2044 6174 6141 7272 6179 2920 2d3e 2044   DataArray) -> D
-000548a0: 6174 6173 6574 5765 6967 6874 6564 3a0a  atasetWeighted:.
-000548b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000548c0: 2020 2020 5765 6967 6874 6564 2044 6174      Weighted Dat
-000548d0: 6173 6574 206f 7065 7261 7469 6f6e 732e  aset operations.
-000548e0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-000548f0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-00054900: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00054910: 7765 6967 6874 7320 3a20 4461 7461 4172  weights : DataAr
-00054920: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
-00054930: 416e 2061 7272 6179 206f 6620 7765 6967  An array of weig
-00054940: 6874 7320 6173 736f 6369 6174 6564 2077  hts associated w
-00054950: 6974 6820 7468 6520 7661 6c75 6573 2069  ith the values i
-00054960: 6e20 7468 6973 2044 6174 6173 6574 2e0a  n this Dataset..
-00054970: 2020 2020 2020 2020 2020 2020 4561 6368              Each
-00054980: 2076 616c 7565 2069 6e20 7468 6520 6461   value in the da
-00054990: 7461 2063 6f6e 7472 6962 7574 6573 2074  ta contributes t
-000549a0: 6f20 7468 6520 7265 6475 6374 696f 6e20  o the reduction 
-000549b0: 6f70 6572 6174 696f 6e0a 2020 2020 2020  operation.      
-000549c0: 2020 2020 2020 6163 636f 7264 696e 6720        according 
-000549d0: 746f 2069 7473 2061 7373 6f63 6961 7465  to its associate
-000549e0: 6420 7765 6967 6874 2e0a 0a20 2020 2020  d weight...     
-000549f0: 2020 204e 6f74 6573 0a20 2020 2020 2020     Notes.       
-00054a00: 202d 2d2d 2d2d 0a20 2020 2020 2020 2060   -----.        `
-00054a10: 6077 6569 6768 7473 6060 206d 7573 7420  `weights`` must 
-00054a20: 6265 2061 2044 6174 6141 7272 6179 2061  be a DataArray a
-00054a30: 6e64 2063 616e 6e6f 7420 636f 6e74 6169  nd cannot contai
-00054a40: 6e20 6d69 7373 696e 6720 7661 6c75 6573  n missing values
-00054a50: 2e0a 2020 2020 2020 2020 4d69 7373 696e  ..        Missin
-00054a60: 6720 7661 6c75 6573 2063 616e 2062 6520  g values can be 
-00054a70: 7265 706c 6163 6564 2062 7920 6060 7765  replaced by ``we
-00054a80: 6967 6874 732e 6669 6c6c 6e61 2830 2960  ights.fillna(0)`
-00054a90: 602e 0a0a 2020 2020 2020 2020 5265 7475  `...        Retu
-00054aa0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-00054ab0: 2d2d 2d0a 2020 2020 2020 2020 636f 7265  ---.        core
-00054ac0: 2e77 6569 6768 7465 642e 4461 7461 7365  .weighted.Datase
-00054ad0: 7457 6569 6768 7465 640a 0a20 2020 2020  tWeighted..     
-00054ae0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-00054af0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00054b00: 2020 2020 2044 6174 6141 7272 6179 2e77       DataArray.w
-00054b10: 6569 6768 7465 640a 2020 2020 2020 2020  eighted.        
-00054b20: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-00054b30: 2078 6172 7261 792e 636f 7265 2e77 6569   xarray.core.wei
-00054b40: 6768 7465 6420 696d 706f 7274 2044 6174  ghted import Dat
-00054b50: 6173 6574 5765 6967 6874 6564 0a0a 2020  asetWeighted..  
-00054b60: 2020 2020 2020 7265 7475 726e 2044 6174        return Dat
-00054b70: 6173 6574 5765 6967 6874 6564 2873 656c  asetWeighted(sel
-00054b80: 662c 2077 6569 6768 7473 290a 0a20 2020  f, weights)..   
-00054b90: 2064 6566 2072 6f6c 6c69 6e67 280a 2020   def rolling(.  
-00054ba0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00054bb0: 2020 2020 6469 6d3a 204d 6170 7069 6e67      dim: Mapping
-00054bc0: 5b41 6e79 2c20 696e 745d 207c 204e 6f6e  [Any, int] | Non
-00054bd0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00054be0: 2020 6d69 6e5f 7065 7269 6f64 733a 2069    min_periods: i
-00054bf0: 6e74 207c 204e 6f6e 6520 3d20 4e6f 6e65  nt | None = None
-00054c00: 2c0a 2020 2020 2020 2020 6365 6e74 6572  ,.        center
-00054c10: 3a20 626f 6f6c 207c 204d 6170 7069 6e67  : bool | Mapping
-00054c20: 5b41 6e79 2c20 626f 6f6c 5d20 3d20 4661  [Any, bool] = Fa
-00054c30: 6c73 652c 0a20 2020 2020 2020 202a 2a77  lse,.        **w
-00054c40: 696e 646f 775f 6b77 6172 6773 3a20 696e  indow_kwargs: in
-00054c50: 742c 0a20 2020 2029 202d 3e20 4461 7461  t,.    ) -> Data
-00054c60: 7365 7452 6f6c 6c69 6e67 3a0a 2020 2020  setRolling:.    
-00054c70: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00054c80: 526f 6c6c 696e 6720 7769 6e64 6f77 206f  Rolling window o
-00054c90: 626a 6563 7420 666f 7220 4461 7461 7365  bject for Datase
-00054ca0: 7473 2e0a 0a20 2020 2020 2020 2050 6172  ts...        Par
-00054cb0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00054cc0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00054cd0: 2020 2064 696d 203a 2064 6963 742c 206f     dim : dict, o
-00054ce0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00054cf0: 2020 2020 4d61 7070 696e 6720 6672 6f6d      Mapping from
-00054d00: 2074 6865 2064 696d 656e 7369 6f6e 206e   the dimension n
-00054d10: 616d 6520 746f 2063 7265 6174 6520 7468  ame to create th
-00054d20: 6520 726f 6c6c 696e 6720 6974 6572 6174  e rolling iterat
-00054d30: 6f72 0a20 2020 2020 2020 2020 2020 2061  or.            a
-00054d40: 6c6f 6e67 2028 652e 672e 2060 7469 6d65  long (e.g. `time
-00054d50: 6029 2074 6f20 6974 7320 6d6f 7669 6e67  `) to its moving
-00054d60: 2077 696e 646f 7720 7369 7a65 2e0a 2020   window size..  
-00054d70: 2020 2020 2020 6d69 6e5f 7065 7269 6f64        min_period
-00054d80: 7320 3a20 696e 7420 6f72 204e 6f6e 652c  s : int or None,
-00054d90: 2064 6566 6175 6c74 3a20 4e6f 6e65 0a20   default: None. 
-00054da0: 2020 2020 2020 2020 2020 204d 696e 696d             Minim
-00054db0: 756d 206e 756d 6265 7220 6f66 206f 6273  um number of obs
-00054dc0: 6572 7661 7469 6f6e 7320 696e 2077 696e  ervations in win
-00054dd0: 646f 7720 7265 7175 6972 6564 2074 6f20  dow required to 
-00054de0: 6861 7665 2061 2076 616c 7565 0a20 2020  have a value.   
-00054df0: 2020 2020 2020 2020 2028 6f74 6865 7277           (otherw
-00054e00: 6973 6520 7265 7375 6c74 2069 7320 4e41  ise result is NA
-00054e10: 292e 2054 6865 2064 6566 6175 6c74 2c20  ). The default, 
-00054e20: 4e6f 6e65 2c20 6973 2065 7175 6976 616c  None, is equival
-00054e30: 656e 7420 746f 0a20 2020 2020 2020 2020  ent to.         
-00054e40: 2020 2073 6574 7469 6e67 206d 696e 5f70     setting min_p
-00054e50: 6572 696f 6473 2065 7175 616c 2074 6f20  eriods equal to 
-00054e60: 7468 6520 7369 7a65 206f 6620 7468 6520  the size of the 
-00054e70: 7769 6e64 6f77 2e0a 2020 2020 2020 2020  window..        
-00054e80: 6365 6e74 6572 203a 2062 6f6f 6c20 6f72  center : bool or
-00054e90: 204d 6170 7069 6e67 2074 6f20 696e 742c   Mapping to int,
-00054ea0: 2064 6566 6175 6c74 3a20 4661 6c73 650a   default: False.
-00054eb0: 2020 2020 2020 2020 2020 2020 5365 7420              Set 
-00054ec0: 7468 6520 6c61 6265 6c73 2061 7420 7468  the labels at th
-00054ed0: 6520 6365 6e74 6572 206f 6620 7468 6520  e center of the 
-00054ee0: 7769 6e64 6f77 2e0a 2020 2020 2020 2020  window..        
-00054ef0: 2a2a 7769 6e64 6f77 5f6b 7761 7267 7320  **window_kwargs 
-00054f00: 3a20 6f70 7469 6f6e 616c 0a20 2020 2020  : optional.     
-00054f10: 2020 2020 2020 2054 6865 206b 6579 776f         The keywo
-00054f20: 7264 2061 7267 756d 656e 7473 2066 6f72  rd arguments for
-00054f30: 6d20 6f66 2060 6064 696d 6060 2e0a 2020  m of ``dim``..  
-00054f40: 2020 2020 2020 2020 2020 4f6e 6520 6f66            One of
-00054f50: 2064 696d 206f 7220 7769 6e64 6f77 5f6b   dim or window_k
-00054f60: 7761 7267 7320 6d75 7374 2062 6520 7072  wargs must be pr
-00054f70: 6f76 6964 6564 2e0a 0a20 2020 2020 2020  ovided...       
-00054f80: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-00054f90: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-00054fa0: 2063 6f72 652e 726f 6c6c 696e 672e 4461   core.rolling.Da
-00054fb0: 7461 7365 7452 6f6c 6c69 6e67 0a0a 2020  tasetRolling..  
-00054fc0: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
-00054fd0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
-00054fe0: 2020 2020 2020 2020 636f 7265 2e72 6f6c          core.rol
-00054ff0: 6c69 6e67 2e44 6174 6173 6574 526f 6c6c  ling.DatasetRoll
-00055000: 696e 670a 2020 2020 2020 2020 4461 7461  ing.        Data
-00055010: 4172 7261 792e 726f 6c6c 696e 670a 2020  Array.rolling.  
-00055020: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00055030: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
-00055040: 7265 2e72 6f6c 6c69 6e67 2069 6d70 6f72  re.rolling impor
-00055050: 7420 4461 7461 7365 7452 6f6c 6c69 6e67  t DatasetRolling
-00055060: 0a0a 2020 2020 2020 2020 6469 6d20 3d20  ..        dim = 
-00055070: 6569 7468 6572 5f64 6963 745f 6f72 5f6b  either_dict_or_k
-00055080: 7761 7267 7328 6469 6d2c 2077 696e 646f  wargs(dim, windo
-00055090: 775f 6b77 6172 6773 2c20 2272 6f6c 6c69  w_kwargs, "rolli
-000550a0: 6e67 2229 0a20 2020 2020 2020 2072 6574  ng").        ret
-000550b0: 7572 6e20 4461 7461 7365 7452 6f6c 6c69  urn DatasetRolli
-000550c0: 6e67 2873 656c 662c 2064 696d 2c20 6d69  ng(self, dim, mi
-000550d0: 6e5f 7065 7269 6f64 733d 6d69 6e5f 7065  n_periods=min_pe
-000550e0: 7269 6f64 732c 2063 656e 7465 723d 6365  riods, center=ce
-000550f0: 6e74 6572 290a 0a20 2020 2064 6566 2063  nter)..    def c
-00055100: 6f61 7273 656e 280a 2020 2020 2020 2020  oarsen(.        
-00055110: 7365 6c66 2c0a 2020 2020 2020 2020 6469  self,.        di
-00055120: 6d3a 204d 6170 7069 6e67 5b41 6e79 2c20  m: Mapping[Any, 
-00055130: 696e 745d 207c 204e 6f6e 6520 3d20 4e6f  int] | None = No
-00055140: 6e65 2c0a 2020 2020 2020 2020 626f 756e  ne,.        boun
-00055150: 6461 7279 3a20 436f 6172 7365 6e42 6f75  dary: CoarsenBou
-00055160: 6e64 6172 794f 7074 696f 6e73 203d 2022  ndaryOptions = "
-00055170: 6578 6163 7422 2c0a 2020 2020 2020 2020  exact",.        
-00055180: 7369 6465 3a20 5369 6465 4f70 7469 6f6e  side: SideOption
-00055190: 7320 7c20 4d61 7070 696e 675b 416e 792c  s | Mapping[Any,
-000551a0: 2053 6964 654f 7074 696f 6e73 5d20 3d20   SideOptions] = 
-000551b0: 226c 6566 7422 2c0a 2020 2020 2020 2020  "left",.        
-000551c0: 636f 6f72 645f 6675 6e63 3a20 7374 7220  coord_func: str 
-000551d0: 7c20 4361 6c6c 6162 6c65 207c 204d 6170  | Callable | Map
-000551e0: 7069 6e67 5b41 6e79 2c20 7374 7220 7c20  ping[Any, str | 
-000551f0: 4361 6c6c 6162 6c65 5d20 3d20 226d 6561  Callable] = "mea
-00055200: 6e22 2c0a 2020 2020 2020 2020 2a2a 7769  n",.        **wi
-00055210: 6e64 6f77 5f6b 7761 7267 733a 2069 6e74  ndow_kwargs: int
-00055220: 2c0a 2020 2020 2920 2d3e 2044 6174 6173  ,.    ) -> Datas
-00055230: 6574 436f 6172 7365 6e3a 0a20 2020 2020  etCoarsen:.     
-00055240: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-00055250: 6f61 7273 656e 206f 626a 6563 7420 666f  oarsen object fo
-00055260: 7220 4461 7461 7365 7473 2e0a 0a20 2020  r Datasets...   
-00055270: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00055280: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00055290: 2d2d 0a20 2020 2020 2020 2064 696d 203a  --.        dim :
-000552a0: 206d 6170 7069 6e67 206f 6620 6861 7368   mapping of hash
-000552b0: 6162 6c65 2074 6f20 696e 742c 206f 7074  able to int, opt
-000552c0: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-000552d0: 2020 4d61 7070 696e 6720 6672 6f6d 2074    Mapping from t
-000552e0: 6865 2064 696d 656e 7369 6f6e 206e 616d  he dimension nam
-000552f0: 6520 746f 2074 6865 2077 696e 646f 7720  e to the window 
-00055300: 7369 7a65 2e0a 2020 2020 2020 2020 626f  size..        bo
-00055310: 756e 6461 7279 203a 207b 2265 7861 6374  undary : {"exact
-00055320: 222c 2022 7472 696d 222c 2022 7061 6422  ", "trim", "pad"
-00055330: 7d2c 2064 6566 6175 6c74 3a20 2265 7861  }, default: "exa
-00055340: 6374 220a 2020 2020 2020 2020 2020 2020  ct".            
-00055350: 4966 2027 6578 6163 7427 2c20 6120 5661  If 'exact', a Va
-00055360: 6c75 6545 7272 6f72 2077 696c 6c20 6265  lueError will be
-00055370: 2072 6169 7365 6420 6966 2064 696d 656e   raised if dimen
-00055380: 7369 6f6e 2073 697a 6520 6973 206e 6f74  sion size is not
-00055390: 2061 0a20 2020 2020 2020 2020 2020 206d   a.            m
-000553a0: 756c 7469 706c 6520 6f66 2074 6865 2077  ultiple of the w
-000553b0: 696e 646f 7720 7369 7a65 2e20 4966 2027  indow size. If '
-000553c0: 7472 696d 272c 2074 6865 2065 7863 6573  trim', the exces
-000553d0: 7320 656e 7472 6965 7320 6172 650a 2020  s entries are.  
-000553e0: 2020 2020 2020 2020 2020 6472 6f70 7065            droppe
-000553f0: 642e 2049 6620 2770 6164 272c 204e 4120  d. If 'pad', NA 
-00055400: 7769 6c6c 2062 6520 7061 6464 6564 2e0a  will be padded..
-00055410: 2020 2020 2020 2020 7369 6465 203a 207b          side : {
-00055420: 226c 6566 7422 2c20 2272 6967 6874 227d  "left", "right"}
-00055430: 206f 7220 6d61 7070 696e 6720 6f66 2073   or mapping of s
-00055440: 7472 2074 6f20 7b22 6c65 6674 222c 2022  tr to {"left", "
-00055450: 7269 6768 7422 7d2c 2064 6566 6175 6c74  right"}, default
-00055460: 3a20 226c 6566 7422 0a20 2020 2020 2020  : "left".       
-00055470: 2063 6f6f 7264 5f66 756e 6320 3a20 7374   coord_func : st
-00055480: 7220 6f72 206d 6170 7069 6e67 206f 6620  r or mapping of 
-00055490: 6861 7368 6162 6c65 2074 6f20 7374 722c  hashable to str,
-000554a0: 2064 6566 6175 6c74 3a20 226d 6561 6e22   default: "mean"
-000554b0: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
-000554c0: 6374 696f 6e20 286e 616d 6529 2074 6861  ction (name) tha
-000554d0: 7420 6973 2061 7070 6c69 6564 2074 6f20  t is applied to 
-000554e0: 7468 6520 636f 6f72 6469 6e61 7465 732c  the coordinates,
-000554f0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
-00055500: 6120 6d61 7070 696e 6720 6672 6f6d 2063  a mapping from c
-00055510: 6f6f 7264 696e 6174 6520 6e61 6d65 2074  oordinate name t
-00055520: 6f20 6675 6e63 7469 6f6e 2028 6e61 6d65  o function (name
-00055530: 292e 0a0a 2020 2020 2020 2020 5265 7475  )...        Retu
-00055540: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-00055550: 2d2d 2d0a 2020 2020 2020 2020 636f 7265  ---.        core
-00055560: 2e72 6f6c 6c69 6e67 2e44 6174 6173 6574  .rolling.Dataset
-00055570: 436f 6172 7365 6e0a 0a20 2020 2020 2020  Coarsen..       
-00055580: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-00055590: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-000555a0: 2020 2063 6f72 652e 726f 6c6c 696e 672e     core.rolling.
-000555b0: 4461 7461 7365 7443 6f61 7273 656e 0a20  DatasetCoarsen. 
-000555c0: 2020 2020 2020 2044 6174 6141 7272 6179         DataArray
-000555d0: 2e63 6f61 7273 656e 0a20 2020 2020 2020  .coarsen.       
-000555e0: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-000555f0: 6d20 7861 7272 6179 2e63 6f72 652e 726f  m xarray.core.ro
-00055600: 6c6c 696e 6720 696d 706f 7274 2044 6174  lling import Dat
-00055610: 6173 6574 436f 6172 7365 6e0a 0a20 2020  asetCoarsen..   
-00055620: 2020 2020 2064 696d 203d 2065 6974 6865       dim = eithe
-00055630: 725f 6469 6374 5f6f 725f 6b77 6172 6773  r_dict_or_kwargs
-00055640: 2864 696d 2c20 7769 6e64 6f77 5f6b 7761  (dim, window_kwa
-00055650: 7267 732c 2022 636f 6172 7365 6e22 290a  rgs, "coarsen").
-00055660: 2020 2020 2020 2020 7265 7475 726e 2044          return D
-00055670: 6174 6173 6574 436f 6172 7365 6e28 0a20  atasetCoarsen(. 
-00055680: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-00055690: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
-000556a0: 2c0a 2020 2020 2020 2020 2020 2020 626f  ,.            bo
-000556b0: 756e 6461 7279 3d62 6f75 6e64 6172 792c  undary=boundary,
-000556c0: 0a20 2020 2020 2020 2020 2020 2073 6964  .            sid
-000556d0: 653d 7369 6465 2c0a 2020 2020 2020 2020  e=side,.        
-000556e0: 2020 2020 636f 6f72 645f 6675 6e63 3d63      coord_func=c
-000556f0: 6f6f 7264 5f66 756e 632c 0a20 2020 2020  oord_func,.     
-00055700: 2020 2029 0a0a 2020 2020 6465 6620 7265     )..    def re
-00055710: 7361 6d70 6c65 280a 2020 2020 2020 2020  sample(.        
-00055720: 7365 6c66 2c0a 2020 2020 2020 2020 696e  self,.        in
-00055730: 6465 7865 723a 204d 6170 7069 6e67 5b41  dexer: Mapping[A
-00055740: 6e79 2c20 7374 725d 207c 204e 6f6e 6520  ny, str] | None 
-00055750: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00055760: 736b 6970 6e61 3a20 626f 6f6c 207c 204e  skipna: bool | N
-00055770: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00055780: 2020 2020 636c 6f73 6564 3a20 5369 6465      closed: Side
-00055790: 4f70 7469 6f6e 7320 7c20 4e6f 6e65 203d  Options | None =
-000557a0: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
-000557b0: 6162 656c 3a20 5369 6465 4f70 7469 6f6e  abel: SideOption
-000557c0: 7320 7c20 4e6f 6e65 203d 204e 6f6e 652c  s | None = None,
-000557d0: 0a20 2020 2020 2020 2062 6173 653a 2069  .        base: i
-000557e0: 6e74 207c 204e 6f6e 6520 3d20 4e6f 6e65  nt | None = None
-000557f0: 2c0a 2020 2020 2020 2020 6f66 6673 6574  ,.        offset
-00055800: 3a20 7064 2e54 696d 6564 656c 7461 207c  : pd.Timedelta |
-00055810: 2064 6174 6574 696d 652e 7469 6d65 6465   datetime.timede
-00055820: 6c74 6120 7c20 7374 7220 7c20 4e6f 6e65  lta | str | None
-00055830: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00055840: 206f 7269 6769 6e3a 2073 7472 207c 2044   origin: str | D
-00055850: 6174 6574 696d 654c 696b 6520 3d20 2273  atetimeLike = "s
-00055860: 7461 7274 5f64 6179 222c 0a20 2020 2020  tart_day",.     
-00055870: 2020 206b 6565 705f 6174 7472 733a 2062     keep_attrs: b
-00055880: 6f6f 6c20 7c20 4e6f 6e65 203d 204e 6f6e  ool | None = Non
-00055890: 652c 0a20 2020 2020 2020 206c 6f66 6673  e,.        loffs
-000558a0: 6574 3a20 6461 7465 7469 6d65 2e74 696d  et: datetime.tim
-000558b0: 6564 656c 7461 207c 2073 7472 207c 204e  edelta | str | N
+0004b2e0: 2020 7061 645f 7769 6474 683d 7661 725f    pad_width=var_
+0004b2f0: 7061 645f 7769 6474 682c 0a20 2020 2020  pad_width,.     
+0004b300: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0004b310: 6f64 653d 636f 6f72 645f 7061 645f 6d6f  ode=coord_pad_mo
+0004b320: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
+0004b330: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
+0004b340: 7273 3d6b 6565 705f 6174 7472 732c 0a20  rs=keep_attrs,. 
+0004b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b360: 2020 202a 2a63 6f6f 7264 5f70 6164 5f6f     **coord_pad_o
+0004b370: 7074 696f 6e73 2c20 2023 2074 7970 653a  ptions,  # type:
+0004b380: 2069 676e 6f72 655b 6172 672d 7479 7065   ignore[arg-type
+0004b390: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0004b3a0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0004b3b0: 2020 2020 2320 7265 7365 7420 6465 6661      # reset defa
+0004b3c0: 756c 7420 696e 6465 7820 6f66 2064 696d  ult index of dim
+0004b3d0: 656e 7369 6f6e 2063 6f6f 7264 696e 6174  ension coordinat
+0004b3e0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+0004b3f0: 2020 2069 6620 286e 616d 652c 2920 3d3d     if (name,) ==
+0004b400: 2076 6172 2e64 696d 733a 0a20 2020 2020   var.dims:.     
+0004b410: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0004b420: 696d 5f76 6172 203d 207b 6e61 6d65 3a20  im_var = {name: 
+0004b430: 7661 7269 6162 6c65 735b 6e61 6d65 5d7d  variables[name]}
+0004b440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b450: 2020 2020 2069 6e64 6578 203d 2050 616e       index = Pan
+0004b460: 6461 7349 6e64 6578 2e66 726f 6d5f 7661  dasIndex.from_va
+0004b470: 7269 6162 6c65 7328 6469 6d5f 7661 722c  riables(dim_var,
+0004b480: 206f 7074 696f 6e73 3d7b 7d29 0a20 2020   options={}).   
+0004b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b4a0: 2069 6e64 6578 5f76 6172 7320 3d20 696e   index_vars = in
+0004b4b0: 6465 782e 6372 6561 7465 5f76 6172 6961  dex.create_varia
+0004b4c0: 626c 6573 2864 696d 5f76 6172 290a 2020  bles(dim_var).  
+0004b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b4e0: 2020 696e 6465 7865 735b 6e61 6d65 5d20    indexes[name] 
+0004b4f0: 3d20 696e 6465 780a 2020 2020 2020 2020  = index.        
+0004b500: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+0004b510: 6162 6c65 735b 6e61 6d65 5d20 3d20 696e  ables[name] = in
+0004b520: 6465 785f 7661 7273 5b6e 616d 655d 0a0a  dex_vars[name]..
+0004b530: 2020 2020 2020 2020 6174 7472 7320 3d20          attrs = 
+0004b540: 7365 6c66 2e5f 6174 7472 7320 6966 206b  self._attrs if k
+0004b550: 6565 705f 6174 7472 7320 656c 7365 204e  eep_attrs else N
+0004b560: 6f6e 650a 2020 2020 2020 2020 7265 7475  one.        retu
+0004b570: 726e 2073 656c 662e 5f72 6570 6c61 6365  rn self._replace
+0004b580: 5f77 6974 685f 6e65 775f 6469 6d73 2876  _with_new_dims(v
+0004b590: 6172 6961 626c 6573 2c20 696e 6465 7865  ariables, indexe
+0004b5a0: 733d 696e 6465 7865 732c 2061 7474 7273  s=indexes, attrs
+0004b5b0: 3d61 7474 7273 290a 0a20 2020 2064 6566  =attrs)..    def
+0004b5c0: 2069 6478 6d69 6e28 0a20 2020 2020 2020   idxmin(.       
+0004b5d0: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
+0004b5e0: 2c0a 2020 2020 2020 2020 6469 6d3a 2048  ,.        dim: H
+0004b5f0: 6173 6861 626c 6520 7c20 4e6f 6e65 203d  ashable | None =
+0004b600: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
+0004b610: 6b69 706e 613a 2062 6f6f 6c20 7c20 4e6f  kipna: bool | No
+0004b620: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+0004b630: 2020 2066 696c 6c5f 7661 6c75 653a 2041     fill_value: A
+0004b640: 6e79 203d 2078 7264 7479 7065 732e 4e41  ny = xrdtypes.NA
+0004b650: 2c0a 2020 2020 2020 2020 6b65 6570 5f61  ,.        keep_a
+0004b660: 7474 7273 3a20 626f 6f6c 207c 204e 6f6e  ttrs: bool | Non
+0004b670: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
+0004b680: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+0004b690: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+0004b6a0: 7468 6520 636f 6f72 6469 6e61 7465 206c  the coordinate l
+0004b6b0: 6162 656c 206f 6620 7468 6520 6d69 6e69  abel of the mini
+0004b6c0: 6d75 6d20 7661 6c75 6520 616c 6f6e 6720  mum value along 
+0004b6d0: 6120 6469 6d65 6e73 696f 6e2e 0a0a 2020  a dimension...  
+0004b6e0: 2020 2020 2020 5265 7475 726e 7320 6120        Returns a 
+0004b6f0: 6e65 7720 6044 6174 6173 6574 6020 6e61  new `Dataset` na
+0004b700: 6d65 6420 6166 7465 7220 7468 6520 6469  med after the di
+0004b710: 6d65 6e73 696f 6e20 7769 7468 2074 6865  mension with the
+0004b720: 2076 616c 7565 7320 6f66 0a20 2020 2020   values of.     
+0004b730: 2020 2074 6865 2063 6f6f 7264 696e 6174     the coordinat
+0004b740: 6520 6c61 6265 6c73 2061 6c6f 6e67 2074  e labels along t
+0004b750: 6861 7420 6469 6d65 6e73 696f 6e20 636f  hat dimension co
+0004b760: 7272 6573 706f 6e64 696e 6720 746f 206d  rresponding to m
+0004b770: 696e 696d 756d 0a20 2020 2020 2020 2076  inimum.        v
+0004b780: 616c 7565 7320 616c 6f6e 6720 7468 6174  alues along that
+0004b790: 2064 696d 656e 7369 6f6e 2e0a 0a20 2020   dimension...   
+0004b7a0: 2020 2020 2049 6e20 636f 6d70 6172 6973       In comparis
+0004b7b0: 6f6e 2074 6f20 3a70 793a 6d65 7468 3a60  on to :py:meth:`
+0004b7c0: 7e44 6174 6173 6574 2e61 7267 6d69 6e60  ~Dataset.argmin`
+0004b7d0: 2c20 7468 6973 2072 6574 7572 6e73 2074  , this returns t
+0004b7e0: 6865 0a20 2020 2020 2020 2063 6f6f 7264  he.        coord
+0004b7f0: 696e 6174 6520 6c61 6265 6c20 7768 696c  inate label whil
+0004b800: 6520 3a70 793a 6d65 7468 3a60 7e44 6174  e :py:meth:`~Dat
+0004b810: 6173 6574 2e61 7267 6d69 6e60 2072 6574  aset.argmin` ret
+0004b820: 7572 6e73 2074 6865 2069 6e64 6578 2e0a  urns the index..
+0004b830: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+0004b840: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+0004b850: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
+0004b860: 696d 203a 2048 6173 6861 626c 652c 206f  im : Hashable, o
+0004b870: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0004b880: 2020 2020 4469 6d65 6e73 696f 6e20 6f76      Dimension ov
+0004b890: 6572 2077 6869 6368 2074 6f20 6170 706c  er which to appl
+0004b8a0: 7920 6069 6478 6d69 6e60 2e20 2054 6869  y `idxmin`.  Thi
+0004b8b0: 7320 6973 206f 7074 696f 6e61 6c20 666f  s is optional fo
+0004b8c0: 7220 3144 0a20 2020 2020 2020 2020 2020  r 1D.           
+0004b8d0: 2076 6172 6961 626c 6573 2c20 6275 7420   variables, but 
+0004b8e0: 7265 7175 6972 6564 2066 6f72 2076 6172  required for var
+0004b8f0: 6961 626c 6573 2077 6974 6820 3220 6f72  iables with 2 or
+0004b900: 206d 6f72 6520 6469 6d65 6e73 696f 6e73   more dimensions
+0004b910: 2e0a 2020 2020 2020 2020 736b 6970 6e61  ..        skipna
+0004b920: 203a 2062 6f6f 6c20 6f72 204e 6f6e 652c   : bool or None,
+0004b930: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0004b940: 2020 2020 2020 4966 2054 7275 652c 2073        If True, s
+0004b950: 6b69 7020 6d69 7373 696e 6720 7661 6c75  kip missing valu
+0004b960: 6573 2028 6173 206d 6172 6b65 6420 6279  es (as marked by
+0004b970: 204e 614e 292e 2042 7920 6465 6661 756c   NaN). By defaul
+0004b980: 742c 206f 6e6c 790a 2020 2020 2020 2020  t, only.        
+0004b990: 2020 2020 736b 6970 7320 6d69 7373 696e      skips missin
+0004b9a0: 6720 7661 6c75 6573 2066 6f72 2060 6066  g values for ``f
+0004b9b0: 6c6f 6174 6060 2c20 6060 636f 6d70 6c65  loat``, ``comple
+0004b9c0: 7860 602c 2061 6e64 2060 606f 626a 6563  x``, and ``objec
+0004b9d0: 7460 600a 2020 2020 2020 2020 2020 2020  t``.            
+0004b9e0: 6474 7970 6573 3b20 6f74 6865 7220 6474  dtypes; other dt
+0004b9f0: 7970 6573 2065 6974 6865 7220 646f 206e  ypes either do n
+0004ba00: 6f74 2068 6176 6520 6120 7365 6e74 696e  ot have a sentin
+0004ba10: 656c 206d 6973 7369 6e67 2076 616c 7565  el missing value
+0004ba20: 0a20 2020 2020 2020 2020 2020 2028 6060  .            (``
+0004ba30: 696e 7460 6029 206f 7220 6060 736b 6970  int``) or ``skip
+0004ba40: 6e61 3d54 7275 6560 6020 6861 7320 6e6f  na=True`` has no
+0004ba50: 7420 6265 656e 2069 6d70 6c65 6d65 6e74  t been implement
+0004ba60: 6564 0a20 2020 2020 2020 2020 2020 2028  ed.            (
+0004ba70: 6060 6461 7465 7469 6d65 3634 6060 206f  ``datetime64`` o
+0004ba80: 7220 6060 7469 6d65 6465 6c74 6136 3460  r ``timedelta64`
+0004ba90: 6029 2e0a 2020 2020 2020 2020 6669 6c6c  `)..        fill
+0004baa0: 5f76 616c 7565 203a 2041 6e79 2c20 6465  _value : Any, de
+0004bab0: 6661 756c 743a 204e 614e 0a20 2020 2020  fault: NaN.     
+0004bac0: 2020 2020 2020 2056 616c 7565 2074 6f20         Value to 
+0004bad0: 6265 2066 696c 6c65 6420 696e 2063 6173  be filled in cas
+0004bae0: 6520 616c 6c20 6f66 2074 6865 2076 616c  e all of the val
+0004baf0: 7565 7320 616c 6f6e 6720 6120 6469 6d65  ues along a dime
+0004bb00: 6e73 696f 6e20 6172 650a 2020 2020 2020  nsion are.      
+0004bb10: 2020 2020 2020 6e75 6c6c 2e20 2042 7920        null.  By 
+0004bb20: 6465 6661 756c 7420 7468 6973 2069 7320  default this is 
+0004bb30: 4e61 4e2e 2020 5468 6520 6669 6c6c 2076  NaN.  The fill v
+0004bb40: 616c 7565 2061 6e64 2072 6573 756c 7420  alue and result 
+0004bb50: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
+0004bb60: 6175 746f 6d61 7469 6361 6c6c 7920 636f  automatically co
+0004bb70: 6e76 6572 7465 6420 746f 2061 2063 6f6d  nverted to a com
+0004bb80: 7061 7469 626c 6520 6474 7970 6520 6966  patible dtype if
+0004bb90: 2070 6f73 7369 626c 652e 0a20 2020 2020   possible..     
+0004bba0: 2020 2020 2020 2049 676e 6f72 6564 2069         Ignored i
+0004bbb0: 6620 6060 736b 6970 6e61 6060 2069 7320  f ``skipna`` is 
+0004bbc0: 4661 6c73 652e 0a20 2020 2020 2020 206b  False..        k
+0004bbd0: 6565 705f 6174 7472 7320 3a20 626f 6f6c  eep_attrs : bool
+0004bbe0: 206f 7220 4e6f 6e65 2c20 6f70 7469 6f6e   or None, option
+0004bbf0: 616c 0a20 2020 2020 2020 2020 2020 2049  al.            I
+0004bc00: 6620 5472 7565 2c20 7468 6520 6174 7472  f True, the attr
+0004bc10: 6962 7574 6573 2028 6060 6174 7472 7360  ibutes (``attrs`
+0004bc20: 6029 2077 696c 6c20 6265 2063 6f70 6965  `) will be copie
+0004bc30: 6420 6672 6f6d 2074 6865 0a20 2020 2020  d from the.     
+0004bc40: 2020 2020 2020 206f 7269 6769 6e61 6c20         original 
+0004bc50: 6f62 6a65 6374 2074 6f20 7468 6520 6e65  object to the ne
+0004bc60: 7720 6f6e 652e 2049 6620 4661 6c73 652c  w one. If False,
+0004bc70: 2074 6865 206e 6577 206f 626a 6563 740a   the new object.
+0004bc80: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+0004bc90: 2062 6520 7265 7475 726e 6564 2077 6974   be returned wit
+0004bca0: 686f 7574 2061 7474 7269 6275 7465 732e  hout attributes.
+0004bcb0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+0004bcc0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0004bcd0: 2d0a 2020 2020 2020 2020 7265 6475 6365  -.        reduce
+0004bce0: 6420 3a20 4461 7461 7365 740a 2020 2020  d : Dataset.    
+0004bcf0: 2020 2020 2020 2020 4e65 7720 6044 6174          New `Dat
+0004bd00: 6173 6574 6020 6f62 6a65 6374 2077 6974  aset` object wit
+0004bd10: 6820 6069 6478 6d69 6e60 2061 7070 6c69  h `idxmin` appli
+0004bd20: 6564 2074 6f20 6974 7320 6461 7461 2061  ed to its data a
+0004bd30: 6e64 2074 6865 0a20 2020 2020 2020 2020  nd the.         
+0004bd40: 2020 2069 6e64 6963 6174 6564 2064 696d     indicated dim
+0004bd50: 656e 7369 6f6e 2072 656d 6f76 6564 2e0a  ension removed..
+0004bd60: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+0004bd70: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+0004bd80: 2d2d 0a20 2020 2020 2020 2044 6174 6141  --.        DataA
+0004bd90: 7272 6179 2e69 6478 6d69 6e2c 2044 6174  rray.idxmin, Dat
+0004bda0: 6173 6574 2e69 6478 6d61 782c 2044 6174  aset.idxmax, Dat
+0004bdb0: 6173 6574 2e6d 696e 2c20 4461 7461 7365  aset.min, Datase
+0004bdc0: 742e 6172 676d 696e 0a0a 2020 2020 2020  t.argmin..      
+0004bdd0: 2020 4578 616d 706c 6573 0a20 2020 2020    Examples.     
+0004bde0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+0004bdf0: 2020 2020 3e3e 3e20 6172 7261 7931 203d      >>> array1 =
+0004be00: 2078 722e 4461 7461 4172 7261 7928 0a20   xr.DataArray(. 
+0004be10: 2020 2020 2020 202e 2e2e 2020 2020 205b         ...     [
+0004be20: 302c 2032 2c20 312c 2030 2c20 2d32 5d2c  0, 2, 1, 0, -2],
+0004be30: 2064 696d 733d 2278 222c 2063 6f6f 7264   dims="x", coord
+0004be40: 733d 7b22 7822 3a20 5b22 6122 2c20 2262  s={"x": ["a", "b
+0004be50: 222c 2022 6322 2c20 2264 222c 2022 6522  ", "c", "d", "e"
+0004be60: 5d7d 0a20 2020 2020 2020 202e 2e2e 2029  ]}.        ... )
+0004be70: 0a20 2020 2020 2020 203e 3e3e 2061 7272  .        >>> arr
+0004be80: 6179 3220 3d20 7872 2e44 6174 6141 7272  ay2 = xr.DataArr
+0004be90: 6179 280a 2020 2020 2020 2020 2e2e 2e20  ay(.        ... 
+0004bea0: 2020 2020 5b0a 2020 2020 2020 2020 2e2e      [.        ..
+0004beb0: 2e20 2020 2020 2020 2020 5b32 2e30 2c20  .         [2.0, 
+0004bec0: 312e 302c 2032 2e30 2c20 302e 302c 202d  1.0, 2.0, 0.0, -
+0004bed0: 322e 305d 2c0a 2020 2020 2020 2020 2e2e  2.0],.        ..
+0004bee0: 2e20 2020 2020 2020 2020 5b2d 342e 302c  .         [-4.0,
+0004bef0: 206e 702e 4e61 4e2c 2032 2e30 2c20 6e70   np.NaN, 2.0, np
+0004bf00: 2e4e 614e 2c20 2d32 2e30 5d2c 0a20 2020  .NaN, -2.0],.   
+0004bf10: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
+0004bf20: 205b 6e70 2e4e 614e 2c20 6e70 2e4e 614e   [np.NaN, np.NaN
+0004bf30: 2c20 312e 302c 206e 702e 4e61 4e2c 206e  , 1.0, np.NaN, n
+0004bf40: 702e 4e61 4e5d 2c0a 2020 2020 2020 2020  p.NaN],.        
+0004bf50: 2e2e 2e20 2020 2020 5d2c 0a20 2020 2020  ...     ],.     
+0004bf60: 2020 202e 2e2e 2020 2020 2064 696d 733d     ...     dims=
+0004bf70: 5b22 7922 2c20 2278 225d 2c0a 2020 2020  ["y", "x"],.    
+0004bf80: 2020 2020 2e2e 2e20 2020 2020 636f 6f72      ...     coor
+0004bf90: 6473 3d7b 2279 223a 205b 2d31 2c20 302c  ds={"y": [-1, 0,
+0004bfa0: 2031 5d2c 2022 7822 3a20 5b22 6122 2c20   1], "x": ["a", 
+0004bfb0: 2262 222c 2022 6322 2c20 2264 222c 2022  "b", "c", "d", "
+0004bfc0: 6522 5d7d 2c0a 2020 2020 2020 2020 2e2e  e"]},.        ..
+0004bfd0: 2e20 290a 2020 2020 2020 2020 3e3e 3e20  . ).        >>> 
+0004bfe0: 6473 203d 2078 722e 4461 7461 7365 7428  ds = xr.Dataset(
+0004bff0: 7b22 696e 7422 3a20 6172 7261 7931 2c20  {"int": array1, 
+0004c000: 2266 6c6f 6174 223a 2061 7272 6179 327d  "float": array2}
+0004c010: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
+0004c020: 2e6d 696e 2864 696d 3d22 7822 290a 2020  .min(dim="x").  
+0004c030: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
+0004c040: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
+0004c050: 696d 656e 7369 6f6e 733a 2020 2879 3a20  imensions:  (y: 
+0004c060: 3329 0a20 2020 2020 2020 2043 6f6f 7264  3).        Coord
+0004c070: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
+0004c080: 2020 2a20 7920 2020 2020 2020 2028 7929    * y        (y)
+0004c090: 2069 6e74 3634 202d 3120 3020 310a 2020   int64 -1 0 1.  
+0004c0a0: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
+0004c0b0: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+0004c0c0: 2020 696e 7420 2020 2020 2069 6e74 3634    int      int64
+0004c0d0: 202d 320a 2020 2020 2020 2020 2020 2020   -2.            
+0004c0e0: 666c 6f61 7420 2020 2028 7929 2066 6c6f  float    (y) flo
+0004c0f0: 6174 3634 202d 322e 3020 2d34 2e30 2031  at64 -2.0 -4.0 1
+0004c100: 2e30 0a20 2020 2020 2020 203e 3e3e 2064  .0.        >>> d
+0004c110: 732e 6172 676d 696e 2864 696d 3d22 7822  s.argmin(dim="x"
+0004c120: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
+0004c130: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
+0004c140: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
+0004c150: 2879 3a20 3329 0a20 2020 2020 2020 2043  (y: 3).        C
+0004c160: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
+0004c170: 2020 2020 2020 2a20 7920 2020 2020 2020        * y       
+0004c180: 2028 7929 2069 6e74 3634 202d 3120 3020   (y) int64 -1 0 
+0004c190: 310a 2020 2020 2020 2020 4461 7461 2076  1.        Data v
+0004c1a0: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+0004c1b0: 2020 2020 2020 696e 7420 2020 2020 2069        int      i
+0004c1c0: 6e74 3634 2034 0a20 2020 2020 2020 2020  nt64 4.         
+0004c1d0: 2020 2066 6c6f 6174 2020 2020 2879 2920     float    (y) 
+0004c1e0: 696e 7436 3420 3420 3020 320a 2020 2020  int64 4 0 2.    
+0004c1f0: 2020 2020 3e3e 3e20 6473 2e69 6478 6d69      >>> ds.idxmi
+0004c200: 6e28 6469 6d3d 2278 2229 0a20 2020 2020  n(dim="x").     
+0004c210: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
+0004c220: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
+0004c230: 6e73 696f 6e73 3a20 2028 793a 2033 290a  nsions:  (y: 3).
+0004c240: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
+0004c250: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
+0004c260: 2079 2020 2020 2020 2020 2879 2920 696e   y        (y) in
+0004c270: 7436 3420 2d31 2030 2031 0a20 2020 2020  t64 -1 0 1.     
+0004c280: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
+0004c290: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+0004c2a0: 6e74 2020 2020 2020 3c55 3120 2765 270a  nt      <U1 'e'.
+0004c2b0: 2020 2020 2020 2020 2020 2020 666c 6f61              floa
+0004c2c0: 7420 2020 2028 7929 206f 626a 6563 7420  t    (y) object 
+0004c2d0: 2765 2720 2761 2720 2763 270a 2020 2020  'e' 'a' 'c'.    
+0004c2e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0004c2f0: 7265 7475 726e 2073 656c 662e 6d61 7028  return self.map(
+0004c300: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+0004c310: 686f 6463 616c 6c65 7228 0a20 2020 2020  hodcaller(.     
+0004c320: 2020 2020 2020 2020 2020 2022 6964 786d             "idxm
+0004c330: 696e 222c 0a20 2020 2020 2020 2020 2020  in",.           
+0004c340: 2020 2020 2064 696d 3d64 696d 2c0a 2020       dim=dim,.  
+0004c350: 2020 2020 2020 2020 2020 2020 2020 736b                sk
+0004c360: 6970 6e61 3d73 6b69 706e 612c 0a20 2020  ipna=skipna,.   
+0004c370: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0004c380: 6c5f 7661 6c75 653d 6669 6c6c 5f76 616c  l_value=fill_val
+0004c390: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0004c3a0: 2020 2020 6b65 6570 5f61 7474 7273 3d6b      keep_attrs=k
+0004c3b0: 6565 705f 6174 7472 732c 0a20 2020 2020  eep_attrs,.     
+0004c3c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0004c3d0: 2029 0a0a 2020 2020 6465 6620 6964 786d   )..    def idxm
+0004c3e0: 6178 280a 2020 2020 2020 2020 7365 6c66  ax(.        self
+0004c3f0: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
+0004c400: 2020 2020 2064 696d 3a20 4861 7368 6162       dim: Hashab
+0004c410: 6c65 207c 204e 6f6e 6520 3d20 4e6f 6e65  le | None = None
+0004c420: 2c0a 2020 2020 2020 2020 736b 6970 6e61  ,.        skipna
+0004c430: 3a20 626f 6f6c 207c 204e 6f6e 6520 3d20  : bool | None = 
+0004c440: 4e6f 6e65 2c0a 2020 2020 2020 2020 6669  None,.        fi
+0004c450: 6c6c 5f76 616c 7565 3a20 416e 7920 3d20  ll_value: Any = 
+0004c460: 7872 6474 7970 6573 2e4e 412c 0a20 2020  xrdtypes.NA,.   
+0004c470: 2020 2020 206b 6565 705f 6174 7472 733a       keep_attrs:
+0004c480: 2062 6f6f 6c20 7c20 4e6f 6e65 203d 204e   bool | None = N
+0004c490: 6f6e 652c 0a20 2020 2029 202d 3e20 545f  one,.    ) -> T_
+0004c4a0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+0004c4b0: 2022 2222 5265 7475 726e 2074 6865 2063   """Return the c
+0004c4c0: 6f6f 7264 696e 6174 6520 6c61 6265 6c20  oordinate label 
+0004c4d0: 6f66 2074 6865 206d 6178 696d 756d 2076  of the maximum v
+0004c4e0: 616c 7565 2061 6c6f 6e67 2061 2064 696d  alue along a dim
+0004c4f0: 656e 7369 6f6e 2e0a 0a20 2020 2020 2020  ension...       
+0004c500: 2052 6574 7572 6e73 2061 206e 6577 2060   Returns a new `
+0004c510: 4461 7461 7365 7460 206e 616d 6564 2061  Dataset` named a
+0004c520: 6674 6572 2074 6865 2064 696d 656e 7369  fter the dimensi
+0004c530: 6f6e 2077 6974 6820 7468 6520 7661 6c75  on with the valu
+0004c540: 6573 206f 660a 2020 2020 2020 2020 7468  es of.        th
+0004c550: 6520 636f 6f72 6469 6e61 7465 206c 6162  e coordinate lab
+0004c560: 656c 7320 616c 6f6e 6720 7468 6174 2064  els along that d
+0004c570: 696d 656e 7369 6f6e 2063 6f72 7265 7370  imension corresp
+0004c580: 6f6e 6469 6e67 2074 6f20 6d61 7869 6d75  onding to maximu
+0004c590: 6d0a 2020 2020 2020 2020 7661 6c75 6573  m.        values
+0004c5a0: 2061 6c6f 6e67 2074 6861 7420 6469 6d65   along that dime
+0004c5b0: 6e73 696f 6e2e 0a0a 2020 2020 2020 2020  nsion...        
+0004c5c0: 496e 2063 6f6d 7061 7269 736f 6e20 746f  In comparison to
+0004c5d0: 203a 7079 3a6d 6574 683a 607e 4461 7461   :py:meth:`~Data
+0004c5e0: 7365 742e 6172 676d 6178 602c 2074 6869  set.argmax`, thi
+0004c5f0: 7320 7265 7475 726e 7320 7468 650a 2020  s returns the.  
+0004c600: 2020 2020 2020 636f 6f72 6469 6e61 7465        coordinate
+0004c610: 206c 6162 656c 2077 6869 6c65 203a 7079   label while :py
+0004c620: 3a6d 6574 683a 607e 4461 7461 7365 742e  :meth:`~Dataset.
+0004c630: 6172 676d 6178 6020 7265 7475 726e 7320  argmax` returns 
+0004c640: 7468 6520 696e 6465 782e 0a0a 2020 2020  the index...    
+0004c650: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0004c660: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0004c670: 2d0a 2020 2020 2020 2020 6469 6d20 3a20  -.        dim : 
+0004c680: 7374 722c 206f 7074 696f 6e61 6c0a 2020  str, optional.  
+0004c690: 2020 2020 2020 2020 2020 4469 6d65 6e73            Dimens
+0004c6a0: 696f 6e20 6f76 6572 2077 6869 6368 2074  ion over which t
+0004c6b0: 6f20 6170 706c 7920 6069 6478 6d61 7860  o apply `idxmax`
+0004c6c0: 2e20 2054 6869 7320 6973 206f 7074 696f  .  This is optio
+0004c6d0: 6e61 6c20 666f 7220 3144 0a20 2020 2020  nal for 1D.     
+0004c6e0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+0004c6f0: 2c20 6275 7420 7265 7175 6972 6564 2066  , but required f
+0004c700: 6f72 2076 6172 6961 626c 6573 2077 6974  or variables wit
+0004c710: 6820 3220 6f72 206d 6f72 6520 6469 6d65  h 2 or more dime
+0004c720: 6e73 696f 6e73 2e0a 2020 2020 2020 2020  nsions..        
+0004c730: 736b 6970 6e61 203a 2062 6f6f 6c20 6f72  skipna : bool or
+0004c740: 204e 6f6e 652c 206f 7074 696f 6e61 6c0a   None, optional.
+0004c750: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+0004c760: 7275 652c 2073 6b69 7020 6d69 7373 696e  rue, skip missin
+0004c770: 6720 7661 6c75 6573 2028 6173 206d 6172  g values (as mar
+0004c780: 6b65 6420 6279 204e 614e 292e 2042 7920  ked by NaN). By 
+0004c790: 6465 6661 756c 742c 206f 6e6c 790a 2020  default, only.  
+0004c7a0: 2020 2020 2020 2020 2020 736b 6970 7320            skips 
+0004c7b0: 6d69 7373 696e 6720 7661 6c75 6573 2066  missing values f
+0004c7c0: 6f72 2060 6066 6c6f 6174 6060 2c20 6060  or ``float``, ``
+0004c7d0: 636f 6d70 6c65 7860 602c 2061 6e64 2060  complex``, and `
+0004c7e0: 606f 626a 6563 7460 600a 2020 2020 2020  `object``.      
+0004c7f0: 2020 2020 2020 6474 7970 6573 3b20 6f74        dtypes; ot
+0004c800: 6865 7220 6474 7970 6573 2065 6974 6865  her dtypes eithe
+0004c810: 7220 646f 206e 6f74 2068 6176 6520 6120  r do not have a 
+0004c820: 7365 6e74 696e 656c 206d 6973 7369 6e67  sentinel missing
+0004c830: 2076 616c 7565 0a20 2020 2020 2020 2020   value.         
+0004c840: 2020 2028 6060 696e 7460 6029 206f 7220     (``int``) or 
+0004c850: 6060 736b 6970 6e61 3d54 7275 6560 6020  ``skipna=True`` 
+0004c860: 6861 7320 6e6f 7420 6265 656e 2069 6d70  has not been imp
+0004c870: 6c65 6d65 6e74 6564 0a20 2020 2020 2020  lemented.       
+0004c880: 2020 2020 2028 6060 6461 7465 7469 6d65       (``datetime
+0004c890: 3634 6060 206f 7220 6060 7469 6d65 6465  64`` or ``timede
+0004c8a0: 6c74 6136 3460 6029 2e0a 2020 2020 2020  lta64``)..      
+0004c8b0: 2020 6669 6c6c 5f76 616c 7565 203a 2041    fill_value : A
+0004c8c0: 6e79 2c20 6465 6661 756c 743a 204e 614e  ny, default: NaN
+0004c8d0: 0a20 2020 2020 2020 2020 2020 2056 616c  .            Val
+0004c8e0: 7565 2074 6f20 6265 2066 696c 6c65 6420  ue to be filled 
+0004c8f0: 696e 2063 6173 6520 616c 6c20 6f66 2074  in case all of t
+0004c900: 6865 2076 616c 7565 7320 616c 6f6e 6720  he values along 
+0004c910: 6120 6469 6d65 6e73 696f 6e20 6172 650a  a dimension are.
+0004c920: 2020 2020 2020 2020 2020 2020 6e75 6c6c              null
+0004c930: 2e20 2042 7920 6465 6661 756c 7420 7468  .  By default th
+0004c940: 6973 2069 7320 4e61 4e2e 2020 5468 6520  is is NaN.  The 
+0004c950: 6669 6c6c 2076 616c 7565 2061 6e64 2072  fill value and r
+0004c960: 6573 756c 7420 6172 650a 2020 2020 2020  esult are.      
+0004c970: 2020 2020 2020 6175 746f 6d61 7469 6361        automatica
+0004c980: 6c6c 7920 636f 6e76 6572 7465 6420 746f  lly converted to
+0004c990: 2061 2063 6f6d 7061 7469 626c 6520 6474   a compatible dt
+0004c9a0: 7970 6520 6966 2070 6f73 7369 626c 652e  ype if possible.
+0004c9b0: 0a20 2020 2020 2020 2020 2020 2049 676e  .            Ign
+0004c9c0: 6f72 6564 2069 6620 6060 736b 6970 6e61  ored if ``skipna
+0004c9d0: 6060 2069 7320 4661 6c73 652e 0a20 2020  `` is False..   
+0004c9e0: 2020 2020 206b 6565 705f 6174 7472 7320       keep_attrs 
+0004c9f0: 3a20 626f 6f6c 206f 7220 4e6f 6e65 2c20  : bool or None, 
+0004ca00: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+0004ca10: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
+0004ca20: 6520 6174 7472 6962 7574 6573 2028 6060  e attributes (``
+0004ca30: 6174 7472 7360 6029 2077 696c 6c20 6265  attrs``) will be
+0004ca40: 2063 6f70 6965 6420 6672 6f6d 2074 6865   copied from the
+0004ca50: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
+0004ca60: 6769 6e61 6c20 6f62 6a65 6374 2074 6f20  ginal object to 
+0004ca70: 7468 6520 6e65 7720 6f6e 652e 2049 6620  the new one. If 
+0004ca80: 4661 6c73 652c 2074 6865 206e 6577 206f  False, the new o
+0004ca90: 626a 6563 740a 2020 2020 2020 2020 2020  bject.          
+0004caa0: 2020 7769 6c6c 2062 6520 7265 7475 726e    will be return
+0004cab0: 6564 2077 6974 686f 7574 2061 7474 7269  ed without attri
+0004cac0: 6275 7465 732e 0a0a 2020 2020 2020 2020  butes...        
+0004cad0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+0004cae0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0004caf0: 7265 6475 6365 6420 3a20 4461 7461 7365  reduced : Datase
+0004cb00: 740a 2020 2020 2020 2020 2020 2020 4e65  t.            Ne
+0004cb10: 7720 6044 6174 6173 6574 6020 6f62 6a65  w `Dataset` obje
+0004cb20: 6374 2077 6974 6820 6069 6478 6d61 7860  ct with `idxmax`
+0004cb30: 2061 7070 6c69 6564 2074 6f20 6974 7320   applied to its 
+0004cb40: 6461 7461 2061 6e64 2074 6865 0a20 2020  data and the.   
+0004cb50: 2020 2020 2020 2020 2069 6e64 6963 6174           indicat
+0004cb60: 6564 2064 696d 656e 7369 6f6e 2072 656d  ed dimension rem
+0004cb70: 6f76 6564 2e0a 0a20 2020 2020 2020 2053  oved...        S
+0004cb80: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+0004cb90: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0004cba0: 2044 6174 6141 7272 6179 2e69 6478 6d61   DataArray.idxma
+0004cbb0: 782c 2044 6174 6173 6574 2e69 6478 6d69  x, Dataset.idxmi
+0004cbc0: 6e2c 2044 6174 6173 6574 2e6d 6178 2c20  n, Dataset.max, 
+0004cbd0: 4461 7461 7365 742e 6172 676d 6178 0a0a  Dataset.argmax..
+0004cbe0: 2020 2020 2020 2020 4578 616d 706c 6573          Examples
+0004cbf0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0004cc00: 2d0a 2020 2020 2020 2020 3e3e 3e20 6172  -.        >>> ar
+0004cc10: 7261 7931 203d 2078 722e 4461 7461 4172  ray1 = xr.DataAr
+0004cc20: 7261 7928 0a20 2020 2020 2020 202e 2e2e  ray(.        ...
+0004cc30: 2020 2020 205b 302c 2032 2c20 312c 2030       [0, 2, 1, 0
+0004cc40: 2c20 2d32 5d2c 2064 696d 733d 2278 222c  , -2], dims="x",
+0004cc50: 2063 6f6f 7264 733d 7b22 7822 3a20 5b22   coords={"x": ["
+0004cc60: 6122 2c20 2262 222c 2022 6322 2c20 2264  a", "b", "c", "d
+0004cc70: 222c 2022 6522 5d7d 0a20 2020 2020 2020  ", "e"]}.       
+0004cc80: 202e 2e2e 2029 0a20 2020 2020 2020 203e   ... ).        >
+0004cc90: 3e3e 2061 7272 6179 3220 3d20 7872 2e44  >> array2 = xr.D
+0004cca0: 6174 6141 7272 6179 280a 2020 2020 2020  ataArray(.      
+0004ccb0: 2020 2e2e 2e20 2020 2020 5b0a 2020 2020    ...     [.    
+0004ccc0: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
+0004ccd0: 5b32 2e30 2c20 312e 302c 2032 2e30 2c20  [2.0, 1.0, 2.0, 
+0004cce0: 302e 302c 202d 322e 305d 2c0a 2020 2020  0.0, -2.0],.    
+0004ccf0: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
+0004cd00: 5b2d 342e 302c 206e 702e 4e61 4e2c 2032  [-4.0, np.NaN, 2
+0004cd10: 2e30 2c20 6e70 2e4e 614e 2c20 2d32 2e30  .0, np.NaN, -2.0
+0004cd20: 5d2c 0a20 2020 2020 2020 202e 2e2e 2020  ],.        ...  
+0004cd30: 2020 2020 2020 205b 6e70 2e4e 614e 2c20         [np.NaN, 
+0004cd40: 6e70 2e4e 614e 2c20 312e 302c 206e 702e  np.NaN, 1.0, np.
+0004cd50: 4e61 4e2c 206e 702e 4e61 4e5d 2c0a 2020  NaN, np.NaN],.  
+0004cd60: 2020 2020 2020 2e2e 2e20 2020 2020 5d2c        ...     ],
+0004cd70: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+0004cd80: 2064 696d 733d 5b22 7922 2c20 2278 225d   dims=["y", "x"]
+0004cd90: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
+0004cda0: 2020 636f 6f72 6473 3d7b 2279 223a 205b    coords={"y": [
+0004cdb0: 2d31 2c20 302c 2031 5d2c 2022 7822 3a20  -1, 0, 1], "x": 
+0004cdc0: 5b22 6122 2c20 2262 222c 2022 6322 2c20  ["a", "b", "c", 
+0004cdd0: 2264 222c 2022 6522 5d7d 2c0a 2020 2020  "d", "e"]},.    
+0004cde0: 2020 2020 2e2e 2e20 290a 2020 2020 2020      ... ).      
+0004cdf0: 2020 3e3e 3e20 6473 203d 2078 722e 4461    >>> ds = xr.Da
+0004ce00: 7461 7365 7428 7b22 696e 7422 3a20 6172  taset({"int": ar
+0004ce10: 7261 7931 2c20 2266 6c6f 6174 223a 2061  ray1, "float": a
+0004ce20: 7272 6179 327d 290a 2020 2020 2020 2020  rray2}).        
+0004ce30: 3e3e 3e20 6473 2e6d 6178 2864 696d 3d22  >>> ds.max(dim="
+0004ce40: 7822 290a 2020 2020 2020 2020 3c78 6172  x").        <xar
+0004ce50: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+0004ce60: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+0004ce70: 2020 2879 3a20 3329 0a20 2020 2020 2020    (y: 3).       
+0004ce80: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+0004ce90: 2020 2020 2020 2020 2a20 7920 2020 2020          * y     
+0004cea0: 2020 2028 7929 2069 6e74 3634 202d 3120     (y) int64 -1 
+0004ceb0: 3020 310a 2020 2020 2020 2020 4461 7461  0 1.        Data
+0004cec0: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+0004ced0: 2020 2020 2020 2020 696e 7420 2020 2020          int     
+0004cee0: 2069 6e74 3634 2032 0a20 2020 2020 2020   int64 2.       
+0004cef0: 2020 2020 2066 6c6f 6174 2020 2020 2879       float    (y
+0004cf00: 2920 666c 6f61 7436 3420 322e 3020 322e  ) float64 2.0 2.
+0004cf10: 3020 312e 300a 2020 2020 2020 2020 3e3e  0 1.0.        >>
+0004cf20: 3e20 6473 2e61 7267 6d61 7828 6469 6d3d  > ds.argmax(dim=
+0004cf30: 2278 2229 0a20 2020 2020 2020 203c 7861  "x").        <xa
+0004cf40: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
+0004cf50: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
+0004cf60: 3a20 2028 793a 2033 290a 2020 2020 2020  :  (y: 3).      
+0004cf70: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+0004cf80: 2020 2020 2020 2020 202a 2079 2020 2020           * y    
+0004cf90: 2020 2020 2879 2920 696e 7436 3420 2d31      (y) int64 -1
+0004cfa0: 2030 2031 0a20 2020 2020 2020 2044 6174   0 1.        Dat
+0004cfb0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
+0004cfc0: 2020 2020 2020 2020 2069 6e74 2020 2020           int    
+0004cfd0: 2020 696e 7436 3420 310a 2020 2020 2020    int64 1.      
+0004cfe0: 2020 2020 2020 666c 6f61 7420 2020 2028        float    (
+0004cff0: 7929 2069 6e74 3634 2030 2032 2032 0a20  y) int64 0 2 2. 
+0004d000: 2020 2020 2020 203e 3e3e 2064 732e 6964         >>> ds.id
+0004d010: 786d 6178 2864 696d 3d22 7822 290a 2020  xmax(dim="x").  
+0004d020: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
+0004d030: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
+0004d040: 696d 656e 7369 6f6e 733a 2020 2879 3a20  imensions:  (y: 
+0004d050: 3329 0a20 2020 2020 2020 2043 6f6f 7264  3).        Coord
+0004d060: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
+0004d070: 2020 2a20 7920 2020 2020 2020 2028 7929    * y        (y)
+0004d080: 2069 6e74 3634 202d 3120 3020 310a 2020   int64 -1 0 1.  
+0004d090: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
+0004d0a0: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+0004d0b0: 2020 696e 7420 2020 2020 203c 5531 2027    int      <U1 '
+0004d0c0: 6227 0a20 2020 2020 2020 2020 2020 2066  b'.            f
+0004d0d0: 6c6f 6174 2020 2020 2879 2920 6f62 6a65  loat    (y) obje
+0004d0e0: 6374 2027 6127 2027 6327 2027 6327 0a20  ct 'a' 'c' 'c'. 
+0004d0f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0004d100: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
+0004d110: 6170 280a 2020 2020 2020 2020 2020 2020  ap(.            
+0004d120: 6d65 7468 6f64 6361 6c6c 6572 280a 2020  methodcaller(.  
+0004d130: 2020 2020 2020 2020 2020 2020 2020 2269                "i
+0004d140: 6478 6d61 7822 2c0a 2020 2020 2020 2020  dxmax",.        
+0004d150: 2020 2020 2020 2020 6469 6d3d 6469 6d2c          dim=dim,
+0004d160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d170: 2073 6b69 706e 613d 736b 6970 6e61 2c0a   skipna=skipna,.
+0004d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d190: 6669 6c6c 5f76 616c 7565 3d66 696c 6c5f  fill_value=fill_
+0004d1a0: 7661 6c75 652c 0a20 2020 2020 2020 2020  value,.         
+0004d1b0: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
+0004d1c0: 733d 6b65 6570 5f61 7474 7273 2c0a 2020  s=keep_attrs,.  
+0004d1d0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0004d1e0: 2020 2020 290a 0a20 2020 2064 6566 2061      )..    def a
+0004d1f0: 7267 6d69 6e28 7365 6c66 3a20 545f 4461  rgmin(self: T_Da
+0004d200: 7461 7365 742c 2064 696d 3a20 4861 7368  taset, dim: Hash
+0004d210: 6162 6c65 207c 204e 6f6e 6520 3d20 4e6f  able | None = No
+0004d220: 6e65 2c20 2a2a 6b77 6172 6773 2920 2d3e  ne, **kwargs) ->
+0004d230: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
+0004d240: 2020 2020 2222 2249 6e64 6963 6573 206f      """Indices o
+0004d250: 6620 7468 6520 6d69 6e69 6d61 206f 6620  f the minima of 
+0004d260: 7468 6520 6d65 6d62 6572 2076 6172 6961  the member varia
+0004d270: 626c 6573 2e0a 0a20 2020 2020 2020 2049  bles...        I
+0004d280: 6620 7468 6572 6520 6172 6520 6d75 6c74  f there are mult
+0004d290: 6970 6c65 206d 696e 696d 612c 2074 6865  iple minima, the
+0004d2a0: 2069 6e64 6963 6573 206f 6620 7468 6520   indices of the 
+0004d2b0: 6669 7273 7420 6f6e 6520 666f 756e 6420  first one found 
+0004d2c0: 7769 6c6c 2062 650a 2020 2020 2020 2020  will be.        
+0004d2d0: 7265 7475 726e 6564 2e0a 0a20 2020 2020  returned...     
+0004d2e0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+0004d2f0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+0004d300: 0a20 2020 2020 2020 2064 696d 203a 2048  .        dim : H
+0004d310: 6173 6861 626c 652c 206f 7074 696f 6e61  ashable, optiona
+0004d320: 6c0a 2020 2020 2020 2020 2020 2020 5468  l.            Th
+0004d330: 6520 6469 6d65 6e73 696f 6e20 6f76 6572  e dimension over
+0004d340: 2077 6869 6368 2074 6f20 6669 6e64 2074   which to find t
+0004d350: 6865 206d 696e 696d 756d 2e20 4279 2064  he minimum. By d
+0004d360: 6566 6175 6c74 2c20 6669 6e64 7320 6d69  efault, finds mi
+0004d370: 6e69 6d75 6d20 6f76 6572 0a20 2020 2020  nimum over.     
+0004d380: 2020 2020 2020 2061 6c6c 2064 696d 656e         all dimen
+0004d390: 7369 6f6e 7320 2d20 666f 7220 6e6f 7720  sions - for now 
+0004d3a0: 7265 7475 726e 696e 6720 616e 2069 6e74  returning an int
+0004d3b0: 2066 6f72 2062 6163 6b77 6172 6420 636f   for backward co
+0004d3c0: 6d70 6174 6962 696c 6974 792c 2062 7574  mpatibility, but
+0004d3d0: 0a20 2020 2020 2020 2020 2020 2074 6869  .            thi
+0004d3e0: 7320 6973 2064 6570 7265 6361 7465 642c  s is deprecated,
+0004d3f0: 2069 6e20 6675 7475 7265 2077 696c 6c20   in future will 
+0004d400: 6265 2061 6e20 6572 726f 722c 2073 696e  be an error, sin
+0004d410: 6365 2044 6174 6141 7272 6179 2e61 7267  ce DataArray.arg
+0004d420: 6d69 6e20 7769 6c6c 0a20 2020 2020 2020  min will.       
+0004d430: 2020 2020 2072 6574 7572 6e20 6120 6469       return a di
+0004d440: 6374 2077 6974 6820 696e 6469 6365 7320  ct with indices 
+0004d450: 666f 7220 616c 6c20 6469 6d65 6e73 696f  for all dimensio
+0004d460: 6e73 2c20 7768 6963 6820 646f 6573 206e  ns, which does n
+0004d470: 6f74 206d 616b 6520 7365 6e73 6520 666f  ot make sense fo
+0004d480: 720a 2020 2020 2020 2020 2020 2020 6120  r.            a 
+0004d490: 4461 7461 7365 742e 0a20 2020 2020 2020  Dataset..       
+0004d4a0: 206b 6565 705f 6174 7472 7320 3a20 626f   keep_attrs : bo
+0004d4b0: 6f6c 2c20 6f70 7469 6f6e 616c 0a20 2020  ol, optional.   
+0004d4c0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+0004d4d0: 2c20 7468 6520 6174 7472 6962 7574 6573  , the attributes
+0004d4e0: 2028 6061 7474 7273 6029 2077 696c 6c20   (`attrs`) will 
+0004d4f0: 6265 2063 6f70 6965 6420 6672 6f6d 2074  be copied from t
+0004d500: 6865 206f 7269 6769 6e61 6c0a 2020 2020  he original.    
+0004d510: 2020 2020 2020 2020 6f62 6a65 6374 2074          object t
+0004d520: 6f20 7468 6520 6e65 7720 6f6e 652e 2020  o the new one.  
+0004d530: 4966 2046 616c 7365 2028 6465 6661 756c  If False (defaul
+0004d540: 7429 2c20 7468 6520 6e65 7720 6f62 6a65  t), the new obje
+0004d550: 6374 2077 696c 6c20 6265 0a20 2020 2020  ct will be.     
+0004d560: 2020 2020 2020 2072 6574 7572 6e65 6420         returned 
+0004d570: 7769 7468 6f75 7420 6174 7472 6962 7574  without attribut
+0004d580: 6573 2e0a 2020 2020 2020 2020 736b 6970  es..        skip
+0004d590: 6e61 203a 2062 6f6f 6c2c 206f 7074 696f  na : bool, optio
+0004d5a0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+0004d5b0: 4966 2054 7275 652c 2073 6b69 7020 6d69  If True, skip mi
+0004d5c0: 7373 696e 6720 7661 6c75 6573 2028 6173  ssing values (as
+0004d5d0: 206d 6172 6b65 6420 6279 204e 614e 292e   marked by NaN).
+0004d5e0: 2042 7920 6465 6661 756c 742c 206f 6e6c   By default, onl
+0004d5f0: 790a 2020 2020 2020 2020 2020 2020 736b  y.            sk
+0004d600: 6970 7320 6d69 7373 696e 6720 7661 6c75  ips missing valu
+0004d610: 6573 2066 6f72 2066 6c6f 6174 2064 7479  es for float dty
+0004d620: 7065 733b 206f 7468 6572 2064 7479 7065  pes; other dtype
+0004d630: 7320 6569 7468 6572 2064 6f20 6e6f 740a  s either do not.
+0004d640: 2020 2020 2020 2020 2020 2020 6861 7665              have
+0004d650: 2061 2073 656e 7469 6e65 6c20 6d69 7373   a sentinel miss
+0004d660: 696e 6720 7661 6c75 6520 2869 6e74 2920  ing value (int) 
+0004d670: 6f72 2073 6b69 706e 613d 5472 7565 2068  or skipna=True h
+0004d680: 6173 206e 6f74 2062 6565 6e0a 2020 2020  as not been.    
+0004d690: 2020 2020 2020 2020 696d 706c 656d 656e          implemen
+0004d6a0: 7465 6420 286f 626a 6563 742c 2064 6174  ted (object, dat
+0004d6b0: 6574 696d 6536 3420 6f72 2074 696d 6564  etime64 or timed
+0004d6c0: 656c 7461 3634 292e 0a0a 2020 2020 2020  elta64)...      
+0004d6d0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+0004d6e0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+0004d6f0: 2020 7265 7375 6c74 203a 2044 6174 6173    result : Datas
+0004d700: 6574 0a0a 2020 2020 2020 2020 5365 6520  et..        See 
+0004d710: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+0004d720: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
+0004d730: 7461 4172 7261 792e 6172 676d 696e 0a20  taArray.argmin. 
+0004d740: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0004d750: 2020 2069 6620 6469 6d20 6973 204e 6f6e     if dim is Non
+0004d760: 653a 0a20 2020 2020 2020 2020 2020 2077  e:.            w
+0004d770: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
+0004d780: 2020 2020 2020 2020 2020 2020 2020 224f                "O
+0004d790: 6e63 6520 7468 6520 6265 6861 7669 6f75  nce the behaviou
+0004d7a0: 7220 6f66 2044 6174 6141 7272 6179 2e61  r of DataArray.a
+0004d7b0: 7267 6d69 6e28 2920 616e 6420 5661 7269  rgmin() and Vari
+0004d7c0: 6162 6c65 2e61 7267 6d69 6e28 2920 7769  able.argmin() wi
+0004d7d0: 7468 6f75 7420 220a 2020 2020 2020 2020  thout ".        
+0004d7e0: 2020 2020 2020 2020 2264 696d 2063 6861          "dim cha
+0004d7f0: 6e67 6573 2074 6f20 7265 7475 726e 2061  nges to return a
+0004d800: 2064 6963 7420 6f66 2069 6e64 6963 6573   dict of indices
+0004d810: 206f 6620 6561 6368 2064 696d 656e 7369   of each dimensi
+0004d820: 6f6e 2c20 666f 7220 220a 2020 2020 2020  on, for ".      
+0004d830: 2020 2020 2020 2020 2020 2263 6f6e 7369            "consi
+0004d840: 7374 656e 6379 2069 7420 7769 6c6c 2062  stency it will b
+0004d850: 6520 616e 2065 7272 6f72 2074 6f20 6361  e an error to ca
+0004d860: 6c6c 2044 6174 6173 6574 2e61 7267 6d69  ll Dataset.argmi
+0004d870: 6e28 2920 7769 7468 206e 6f20 6172 6775  n() with no argu
+0004d880: 6d65 6e74 2c22 0a20 2020 2020 2020 2020  ment,".         
+0004d890: 2020 2020 2020 2022 7369 6e63 6520 7765         "since we
+0004d8a0: 2064 6f6e 2774 2072 6574 7572 6e20 6120   don't return a 
+0004d8b0: 6469 6374 206f 6620 4461 7461 7365 7473  dict of Datasets
+0004d8c0: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+0004d8d0: 2020 2020 4465 7072 6563 6174 696f 6e57      DeprecationW
+0004d8e0: 6172 6e69 6e67 2c0a 2020 2020 2020 2020  arning,.        
+0004d8f0: 2020 2020 2020 2020 7374 6163 6b6c 6576          stacklev
+0004d900: 656c 3d32 2c0a 2020 2020 2020 2020 2020  el=2,.          
+0004d910: 2020 290a 2020 2020 2020 2020 6966 2028    ).        if (
+0004d920: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+0004d930: 2069 7320 4e6f 6e65 0a20 2020 2020 2020   is None.       
+0004d940: 2020 2020 206f 7220 286e 6f74 2069 7369       or (not isi
+0004d950: 6e73 7461 6e63 6528 6469 6d2c 2053 6571  nstance(dim, Seq
+0004d960: 7565 6e63 6529 2061 6e64 2064 696d 2069  uence) and dim i
+0004d970: 7320 6e6f 7420 2e2e 2e29 0a20 2020 2020  s not ...).     
+0004d980: 2020 2020 2020 206f 7220 6973 696e 7374         or isinst
+0004d990: 616e 6365 2864 696d 2c20 7374 7229 0a20  ance(dim, str). 
+0004d9a0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+0004d9b0: 2020 2020 2020 2320 5265 7475 726e 2069        # Return i
+0004d9c0: 6e74 2069 6e64 6578 2069 6620 7369 6e67  nt index if sing
+0004d9d0: 6c65 2064 696d 656e 7369 6f6e 2069 7320  le dimension is 
+0004d9e0: 7061 7373 6564 2c20 616e 6420 6973 206e  passed, and is n
+0004d9f0: 6f74 2070 6172 7420 6f66 2061 0a20 2020  ot part of a.   
+0004da00: 2020 2020 2020 2020 2023 2073 6571 7565           # seque
+0004da10: 6e63 650a 2020 2020 2020 2020 2020 2020  nce.            
+0004da20: 6172 676d 696e 5f66 756e 6320 3d20 6765  argmin_func = ge
+0004da30: 7461 7474 7228 6475 636b 5f61 7272 6179  tattr(duck_array
+0004da40: 5f6f 7073 2c20 2261 7267 6d69 6e22 290a  _ops, "argmin").
+0004da50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0004da60: 726e 2073 656c 662e 7265 6475 6365 280a  rn self.reduce(.
+0004da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004da80: 6172 676d 696e 5f66 756e 632c 2064 696d  argmin_func, dim
+0004da90: 3d4e 6f6e 6520 6966 2064 696d 2069 7320  =None if dim is 
+0004daa0: 4e6f 6e65 2065 6c73 6520 5b64 696d 5d2c  None else [dim],
+0004dab0: 202a 2a6b 7761 7267 730a 2020 2020 2020   **kwargs.      
+0004dac0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0004dad0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0004dae0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0004daf0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0004db00: 2020 2020 2257 6865 6e20 6469 6d20 6973      "When dim is
+0004db10: 2061 2073 6571 7565 6e63 6520 6f72 202e   a sequence or .
+0004db20: 2e2e 2c20 4461 7461 4172 7261 792e 6172  .., DataArray.ar
+0004db30: 676d 696e 2829 2072 6574 7572 6e73 2061  gmin() returns a
+0004db40: 2064 6963 742e 2022 0a20 2020 2020 2020   dict. ".       
+0004db50: 2020 2020 2020 2020 2022 6469 6374 7320           "dicts 
+0004db60: 6361 6e6e 6f74 2062 6520 636f 6e74 6169  cannot be contai
+0004db70: 6e65 6420 696e 2061 2044 6174 6173 6574  ned in a Dataset
+0004db80: 2c20 736f 2063 616e 6e6f 7420 6361 6c6c  , so cannot call
+0004db90: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0004dba0: 2020 2022 4461 7461 7365 742e 6172 676d     "Dataset.argm
+0004dbb0: 696e 2829 2077 6974 6820 6120 7365 7175  in() with a sequ
+0004dbc0: 656e 6365 206f 7220 2e2e 2e20 666f 7220  ence or ... for 
+0004dbd0: 6469 6d22 0a20 2020 2020 2020 2020 2020  dim".           
+0004dbe0: 2029 0a0a 2020 2020 6465 6620 6172 676d   )..    def argm
+0004dbf0: 6178 2873 656c 663a 2054 5f44 6174 6173  ax(self: T_Datas
+0004dc00: 6574 2c20 6469 6d3a 2048 6173 6861 626c  et, dim: Hashabl
+0004dc10: 6520 7c20 4e6f 6e65 203d 204e 6f6e 652c  e | None = None,
+0004dc20: 202a 2a6b 7761 7267 7329 202d 3e20 545f   **kwargs) -> T_
+0004dc30: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+0004dc40: 2022 2222 496e 6469 6365 7320 6f66 2074   """Indices of t
+0004dc50: 6865 206d 6178 696d 6120 6f66 2074 6865  he maxima of the
+0004dc60: 206d 656d 6265 7220 7661 7269 6162 6c65   member variable
+0004dc70: 732e 0a0a 2020 2020 2020 2020 4966 2074  s...        If t
+0004dc80: 6865 7265 2061 7265 206d 756c 7469 706c  here are multipl
+0004dc90: 6520 6d61 7869 6d61 2c20 7468 6520 696e  e maxima, the in
+0004dca0: 6469 6365 7320 6f66 2074 6865 2066 6972  dices of the fir
+0004dcb0: 7374 206f 6e65 2066 6f75 6e64 2077 696c  st one found wil
+0004dcc0: 6c20 6265 0a20 2020 2020 2020 2072 6574  l be.        ret
+0004dcd0: 7572 6e65 642e 0a0a 2020 2020 2020 2020  urned...        
+0004dce0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+0004dcf0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0004dd00: 2020 2020 2020 6469 6d20 3a20 7374 722c        dim : str,
+0004dd10: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0004dd20: 2020 2020 2020 5468 6520 6469 6d65 6e73        The dimens
+0004dd30: 696f 6e20 6f76 6572 2077 6869 6368 2074  ion over which t
+0004dd40: 6f20 6669 6e64 2074 6865 206d 6178 696d  o find the maxim
+0004dd50: 756d 2e20 4279 2064 6566 6175 6c74 2c20  um. By default, 
+0004dd60: 6669 6e64 7320 6d61 7869 6d75 6d20 6f76  finds maximum ov
+0004dd70: 6572 0a20 2020 2020 2020 2020 2020 2061  er.            a
+0004dd80: 6c6c 2064 696d 656e 7369 6f6e 7320 2d20  ll dimensions - 
+0004dd90: 666f 7220 6e6f 7720 7265 7475 726e 696e  for now returnin
+0004dda0: 6720 616e 2069 6e74 2066 6f72 2062 6163  g an int for bac
+0004ddb0: 6b77 6172 6420 636f 6d70 6174 6962 696c  kward compatibil
+0004ddc0: 6974 792c 2062 7574 0a20 2020 2020 2020  ity, but.       
+0004ddd0: 2020 2020 2074 6869 7320 6973 2064 6570       this is dep
+0004dde0: 7265 6361 7465 642c 2069 6e20 6675 7475  recated, in futu
+0004ddf0: 7265 2077 696c 6c20 6265 2061 6e20 6572  re will be an er
+0004de00: 726f 722c 2073 696e 6365 2044 6174 6141  ror, since DataA
+0004de10: 7272 6179 2e61 7267 6d61 7820 7769 6c6c  rray.argmax will
+0004de20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0004de30: 7572 6e20 6120 6469 6374 2077 6974 6820  urn a dict with 
+0004de40: 696e 6469 6365 7320 666f 7220 616c 6c20  indices for all 
+0004de50: 6469 6d65 6e73 696f 6e73 2c20 7768 6963  dimensions, whic
+0004de60: 6820 646f 6573 206e 6f74 206d 616b 6520  h does not make 
+0004de70: 7365 6e73 6520 666f 720a 2020 2020 2020  sense for.      
+0004de80: 2020 2020 2020 6120 4461 7461 7365 742e        a Dataset.
+0004de90: 0a20 2020 2020 2020 206b 6565 705f 6174  .        keep_at
+0004dea0: 7472 7320 3a20 626f 6f6c 2c20 6f70 7469  trs : bool, opti
+0004deb0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+0004dec0: 2049 6620 5472 7565 2c20 7468 6520 6174   If True, the at
+0004ded0: 7472 6962 7574 6573 2028 6061 7474 7273  tributes (`attrs
+0004dee0: 6029 2077 696c 6c20 6265 2063 6f70 6965  `) will be copie
+0004def0: 6420 6672 6f6d 2074 6865 206f 7269 6769  d from the origi
+0004df00: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+0004df10: 6f62 6a65 6374 2074 6f20 7468 6520 6e65  object to the ne
+0004df20: 7720 6f6e 652e 2020 4966 2046 616c 7365  w one.  If False
+0004df30: 2028 6465 6661 756c 7429 2c20 7468 6520   (default), the 
+0004df40: 6e65 7720 6f62 6a65 6374 2077 696c 6c20  new object will 
+0004df50: 6265 0a20 2020 2020 2020 2020 2020 2072  be.            r
+0004df60: 6574 7572 6e65 6420 7769 7468 6f75 7420  eturned without 
+0004df70: 6174 7472 6962 7574 6573 2e0a 2020 2020  attributes..    
+0004df80: 2020 2020 736b 6970 6e61 203a 2062 6f6f      skipna : boo
+0004df90: 6c2c 206f 7074 696f 6e61 6c0a 2020 2020  l, optional.    
+0004dfa0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+0004dfb0: 2073 6b69 7020 6d69 7373 696e 6720 7661   skip missing va
+0004dfc0: 6c75 6573 2028 6173 206d 6172 6b65 6420  lues (as marked 
+0004dfd0: 6279 204e 614e 292e 2042 7920 6465 6661  by NaN). By defa
+0004dfe0: 756c 742c 206f 6e6c 790a 2020 2020 2020  ult, only.      
+0004dff0: 2020 2020 2020 736b 6970 7320 6d69 7373        skips miss
+0004e000: 696e 6720 7661 6c75 6573 2066 6f72 2066  ing values for f
+0004e010: 6c6f 6174 2064 7479 7065 733b 206f 7468  loat dtypes; oth
+0004e020: 6572 2064 7479 7065 7320 6569 7468 6572  er dtypes either
+0004e030: 2064 6f20 6e6f 740a 2020 2020 2020 2020   do not.        
+0004e040: 2020 2020 6861 7665 2061 2073 656e 7469      have a senti
+0004e050: 6e65 6c20 6d69 7373 696e 6720 7661 6c75  nel missing valu
+0004e060: 6520 2869 6e74 2920 6f72 2073 6b69 706e  e (int) or skipn
+0004e070: 613d 5472 7565 2068 6173 206e 6f74 2062  a=True has not b
+0004e080: 6565 6e0a 2020 2020 2020 2020 2020 2020  een.            
+0004e090: 696d 706c 656d 656e 7465 6420 286f 626a  implemented (obj
+0004e0a0: 6563 742c 2064 6174 6574 696d 6536 3420  ect, datetime64 
+0004e0b0: 6f72 2074 696d 6564 656c 7461 3634 292e  or timedelta64).
+0004e0c0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+0004e0d0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0004e0e0: 2d0a 2020 2020 2020 2020 7265 7375 6c74  -.        result
+0004e0f0: 203a 2044 6174 6173 6574 0a0a 2020 2020   : Dataset..    
+0004e100: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
+0004e110: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+0004e120: 2020 2020 2020 4461 7461 4172 7261 792e        DataArray.
+0004e130: 6172 676d 6178 0a0a 2020 2020 2020 2020  argmax..        
+0004e140: 2222 220a 2020 2020 2020 2020 6966 2064  """.        if d
+0004e150: 696d 2069 7320 4e6f 6e65 3a0a 2020 2020  im is None:.    
+0004e160: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+0004e170: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
+0004e180: 2020 2020 2020 2022 4f6e 6365 2074 6865         "Once the
+0004e190: 2062 6568 6176 696f 7572 206f 6620 4461   behaviour of Da
+0004e1a0: 7461 4172 7261 792e 6172 676d 696e 2829  taArray.argmin()
+0004e1b0: 2061 6e64 2056 6172 6961 626c 652e 6172   and Variable.ar
+0004e1c0: 676d 696e 2829 2077 6974 686f 7574 2022  gmin() without "
+0004e1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e1e0: 2022 6469 6d20 6368 616e 6765 7320 746f   "dim changes to
+0004e1f0: 2072 6574 7572 6e20 6120 6469 6374 206f   return a dict o
+0004e200: 6620 696e 6469 6365 7320 6f66 2065 6163  f indices of eac
+0004e210: 6820 6469 6d65 6e73 696f 6e2c 2066 6f72  h dimension, for
+0004e220: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0004e230: 2020 2022 636f 6e73 6973 7465 6e63 7920     "consistency 
+0004e240: 6974 2077 696c 6c20 6265 2061 6e20 6572  it will be an er
+0004e250: 726f 7220 746f 2063 616c 6c20 4461 7461  ror to call Data
+0004e260: 7365 742e 6172 676d 696e 2829 2077 6974  set.argmin() wit
+0004e270: 6820 6e6f 2061 7267 756d 656e 742c 220a  h no argument,".
+0004e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e290: 2273 696e 6365 2077 6520 646f 6e27 7420  "since we don't 
+0004e2a0: 7265 7475 726e 2061 2064 6963 7420 6f66  return a dict of
+0004e2b0: 2044 6174 6173 6574 732e 222c 0a20 2020   Datasets.",.   
+0004e2c0: 2020 2020 2020 2020 2020 2020 2044 6570               Dep
+0004e2d0: 7265 6361 7469 6f6e 5761 726e 696e 672c  recationWarning,
+0004e2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e2f0: 2073 7461 636b 6c65 7665 6c3d 322c 0a20   stacklevel=2,. 
+0004e300: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0004e310: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
+0004e320: 2020 2020 2020 6469 6d20 6973 204e 6f6e        dim is Non
+0004e330: 650a 2020 2020 2020 2020 2020 2020 6f72  e.            or
+0004e340: 2028 6e6f 7420 6973 696e 7374 616e 6365   (not isinstance
+0004e350: 2864 696d 2c20 5365 7175 656e 6365 2920  (dim, Sequence) 
+0004e360: 616e 6420 6469 6d20 6973 206e 6f74 202e  and dim is not .
+0004e370: 2e2e 290a 2020 2020 2020 2020 2020 2020  ..).            
+0004e380: 6f72 2069 7369 6e73 7461 6e63 6528 6469  or isinstance(di
+0004e390: 6d2c 2073 7472 290a 2020 2020 2020 2020  m, str).        
+0004e3a0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+0004e3b0: 2052 6574 7572 6e20 696e 7420 696e 6465   Return int inde
+0004e3c0: 7820 6966 2073 696e 676c 6520 6469 6d65  x if single dime
+0004e3d0: 6e73 696f 6e20 6973 2070 6173 7365 642c  nsion is passed,
+0004e3e0: 2061 6e64 2069 7320 6e6f 7420 7061 7274   and is not part
+0004e3f0: 206f 6620 610a 2020 2020 2020 2020 2020   of a.          
+0004e400: 2020 2320 7365 7175 656e 6365 0a20 2020    # sequence.   
+0004e410: 2020 2020 2020 2020 2061 7267 6d61 785f           argmax_
+0004e420: 6675 6e63 203d 2067 6574 6174 7472 2864  func = getattr(d
+0004e430: 7563 6b5f 6172 7261 795f 6f70 732c 2022  uck_array_ops, "
+0004e440: 6172 676d 6178 2229 0a20 2020 2020 2020  argmax").       
+0004e450: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0004e460: 2e72 6564 7563 6528 0a20 2020 2020 2020  .reduce(.       
+0004e470: 2020 2020 2020 2020 2061 7267 6d61 785f           argmax_
+0004e480: 6675 6e63 2c20 6469 6d3d 4e6f 6e65 2069  func, dim=None i
+0004e490: 6620 6469 6d20 6973 204e 6f6e 6520 656c  f dim is None el
+0004e4a0: 7365 205b 6469 6d5d 2c20 2a2a 6b77 6172  se [dim], **kwar
+0004e4b0: 6773 0a20 2020 2020 2020 2020 2020 2029  gs.            )
+0004e4c0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0004e4d0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0004e4e0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+0004e4f0: 2020 2020 2020 2020 2020 2020 2022 5768               "Wh
+0004e500: 656e 2064 696d 2069 7320 6120 7365 7175  en dim is a sequ
+0004e510: 656e 6365 206f 7220 2e2e 2e2c 2044 6174  ence or ..., Dat
+0004e520: 6141 7272 6179 2e61 7267 6d69 6e28 2920  aArray.argmin() 
+0004e530: 7265 7475 726e 7320 6120 6469 6374 2e20  returns a dict. 
+0004e540: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0004e550: 2020 2264 6963 7473 2063 616e 6e6f 7420    "dicts cannot 
+0004e560: 6265 2063 6f6e 7461 696e 6564 2069 6e20  be contained in 
+0004e570: 6120 4461 7461 7365 742c 2073 6f20 6361  a Dataset, so ca
+0004e580: 6e6e 6f74 2063 616c 6c20 220a 2020 2020  nnot call ".    
+0004e590: 2020 2020 2020 2020 2020 2020 2244 6174              "Dat
+0004e5a0: 6173 6574 2e61 7267 6d69 6e28 2920 7769  aset.argmin() wi
+0004e5b0: 7468 2061 2073 6571 7565 6e63 6520 6f72  th a sequence or
+0004e5c0: 202e 2e2e 2066 6f72 2064 696d 220a 2020   ... for dim".  
+0004e5d0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0004e5e0: 2064 6566 2071 7565 7279 280a 2020 2020   def query(.    
+0004e5f0: 2020 2020 7365 6c66 3a20 545f 4461 7461      self: T_Data
+0004e600: 7365 742c 0a20 2020 2020 2020 2071 7565  set,.        que
+0004e610: 7269 6573 3a20 4d61 7070 696e 675b 416e  ries: Mapping[An
+0004e620: 792c 2041 6e79 5d20 7c20 4e6f 6e65 203d  y, Any] | None =
+0004e630: 204e 6f6e 652c 0a20 2020 2020 2020 2070   None,.        p
+0004e640: 6172 7365 723a 2051 7565 7279 5061 7273  arser: QueryPars
+0004e650: 6572 4f70 7469 6f6e 7320 3d20 2270 616e  erOptions = "pan
+0004e660: 6461 7322 2c0a 2020 2020 2020 2020 656e  das",.        en
+0004e670: 6769 6e65 3a20 5175 6572 7945 6e67 696e  gine: QueryEngin
+0004e680: 654f 7074 696f 6e73 203d 204e 6f6e 652c  eOptions = None,
+0004e690: 0a20 2020 2020 2020 206d 6973 7369 6e67  .        missing
+0004e6a0: 5f64 696d 733a 2045 7272 6f72 4f70 7469  _dims: ErrorOpti
+0004e6b0: 6f6e 7357 6974 6857 6172 6e20 3d20 2272  onsWithWarn = "r
+0004e6c0: 6169 7365 222c 0a20 2020 2020 2020 202a  aise",.        *
+0004e6d0: 2a71 7565 7269 6573 5f6b 7761 7267 733a  *queries_kwargs:
+0004e6e0: 2041 6e79 2c0a 2020 2020 2920 2d3e 2054   Any,.    ) -> T
+0004e6f0: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
+0004e700: 2020 2222 2252 6574 7572 6e20 6120 6e65    """Return a ne
+0004e710: 7720 6461 7461 7365 7420 7769 7468 2065  w dataset with e
+0004e720: 6163 6820 6172 7261 7920 696e 6465 7865  ach array indexe
+0004e730: 6420 616c 6f6e 6720 7468 6520 7370 6563  d along the spec
+0004e740: 6966 6965 640a 2020 2020 2020 2020 6469  ified.        di
+0004e750: 6d65 6e73 696f 6e28 7329 2c20 7768 6572  mension(s), wher
+0004e760: 6520 7468 6520 696e 6465 7865 7273 2061  e the indexers a
+0004e770: 7265 2067 6976 656e 2061 7320 7374 7269  re given as stri
+0004e780: 6e67 7320 636f 6e74 6169 6e69 6e67 0a20  ngs containing. 
+0004e790: 2020 2020 2020 2050 7974 686f 6e20 6578         Python ex
+0004e7a0: 7072 6573 7369 6f6e 7320 746f 2062 6520  pressions to be 
+0004e7b0: 6576 616c 7561 7465 6420 6167 6169 6e73  evaluated agains
+0004e7c0: 7420 7468 6520 6461 7461 2076 6172 6961  t the data varia
+0004e7d0: 626c 6573 2069 6e20 7468 650a 2020 2020  bles in the.    
+0004e7e0: 2020 2020 6461 7461 7365 742e 0a0a 2020      dataset...  
+0004e7f0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+0004e800: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0004e810: 2d2d 2d0a 2020 2020 2020 2020 7175 6572  ---.        quer
+0004e820: 6965 7320 3a20 6469 6374 2d6c 696b 652c  ies : dict-like,
+0004e830: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0004e840: 2020 2020 2020 4120 6469 6374 2d6c 696b        A dict-lik
+0004e850: 6520 7769 7468 206b 6579 7320 6d61 7463  e with keys matc
+0004e860: 6869 6e67 2064 696d 656e 7369 6f6e 7320  hing dimensions 
+0004e870: 616e 6420 7661 6c75 6573 2067 6976 656e  and values given
+0004e880: 2062 7920 7374 7269 6e67 730a 2020 2020   by strings.    
+0004e890: 2020 2020 2020 2020 636f 6e74 6169 6e69          containi
+0004e8a0: 6e67 2050 7974 686f 6e20 6578 7072 6573  ng Python expres
+0004e8b0: 7369 6f6e 7320 746f 2062 6520 6576 616c  sions to be eval
+0004e8c0: 7561 7465 6420 6167 6169 6e73 7420 7468  uated against th
+0004e8d0: 6520 6461 7461 2076 6172 6961 626c 6573  e data variables
+0004e8e0: 0a20 2020 2020 2020 2020 2020 2069 6e20  .            in 
+0004e8f0: 7468 6520 6461 7461 7365 742e 2054 6865  the dataset. The
+0004e900: 2065 7870 7265 7373 696f 6e73 2077 696c   expressions wil
+0004e910: 6c20 6265 2065 7661 6c75 6174 6564 2075  l be evaluated u
+0004e920: 7369 6e67 2074 6865 2070 616e 6461 730a  sing the pandas.
+0004e930: 2020 2020 2020 2020 2020 2020 6576 616c              eval
+0004e940: 2829 2066 756e 6374 696f 6e2c 2061 6e64  () function, and
+0004e950: 2063 616e 2063 6f6e 7461 696e 2061 6e79   can contain any
+0004e960: 2076 616c 6964 2050 7974 686f 6e20 6578   valid Python ex
+0004e970: 7072 6573 7369 6f6e 7320 6275 7420 6361  pressions but ca
+0004e980: 6e6e 6f74 0a20 2020 2020 2020 2020 2020  nnot.           
+0004e990: 2063 6f6e 7461 696e 2061 6e79 2050 7974   contain any Pyt
+0004e9a0: 686f 6e20 7374 6174 656d 656e 7473 2e0a  hon statements..
+0004e9b0: 2020 2020 2020 2020 7061 7273 6572 203a          parser :
+0004e9c0: 207b 2270 616e 6461 7322 2c20 2270 7974   {"pandas", "pyt
+0004e9d0: 686f 6e22 7d2c 2064 6566 6175 6c74 3a20  hon"}, default: 
+0004e9e0: 2270 616e 6461 7322 0a20 2020 2020 2020  "pandas".       
+0004e9f0: 2020 2020 2054 6865 2070 6172 7365 7220       The parser 
+0004ea00: 746f 2075 7365 2074 6f20 636f 6e73 7472  to use to constr
+0004ea10: 7563 7420 7468 6520 7379 6e74 6178 2074  uct the syntax t
+0004ea20: 7265 6520 6672 6f6d 2074 6865 2065 7870  ree from the exp
+0004ea30: 7265 7373 696f 6e2e 0a20 2020 2020 2020  ression..       
+0004ea40: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
+0004ea50: 206f 6620 2770 616e 6461 7327 2070 6172   of 'pandas' par
+0004ea60: 7365 7320 636f 6465 2073 6c69 6768 746c  ses code slightl
+0004ea70: 7920 6469 6666 6572 656e 7420 7468 616e  y different than
+0004ea80: 2073 7461 6e64 6172 640a 2020 2020 2020   standard.      
+0004ea90: 2020 2020 2020 5079 7468 6f6e 2e20 416c        Python. Al
+0004eaa0: 7465 726e 6174 6976 656c 792c 2079 6f75  ternatively, you
+0004eab0: 2063 616e 2070 6172 7365 2061 6e20 6578   can parse an ex
+0004eac0: 7072 6573 7369 6f6e 2075 7369 6e67 2074  pression using t
+0004ead0: 6865 2027 7079 7468 6f6e 270a 2020 2020  he 'python'.    
+0004eae0: 2020 2020 2020 2020 7061 7273 6572 2074          parser t
+0004eaf0: 6f20 7265 7461 696e 2073 7472 6963 7420  o retain strict 
+0004eb00: 5079 7468 6f6e 2073 656d 616e 7469 6373  Python semantics
+0004eb10: 2e0a 2020 2020 2020 2020 656e 6769 6e65  ..        engine
+0004eb20: 203a 207b 2270 7974 686f 6e22 2c20 226e   : {"python", "n
+0004eb30: 756d 6578 7072 222c 204e 6f6e 657d 2c20  umexpr", None}, 
+0004eb40: 6465 6661 756c 743a 204e 6f6e 650a 2020  default: None.  
+0004eb50: 2020 2020 2020 2020 2020 5468 6520 656e            The en
+0004eb60: 6769 6e65 2075 7365 6420 746f 2065 7661  gine used to eva
+0004eb70: 6c75 6174 6520 7468 6520 6578 7072 6573  luate the expres
+0004eb80: 7369 6f6e 2e20 5375 7070 6f72 7465 6420  sion. Supported 
+0004eb90: 656e 6769 6e65 7320 6172 653a 0a0a 2020  engines are:..  
+0004eba0: 2020 2020 2020 2020 2020 2d20 4e6f 6e65            - None
+0004ebb0: 3a20 7472 6965 7320 746f 2075 7365 206e  : tries to use n
+0004ebc0: 756d 6578 7072 2c20 6661 6c6c 7320 6261  umexpr, falls ba
+0004ebd0: 636b 2074 6f20 7079 7468 6f6e 0a20 2020  ck to python.   
+0004ebe0: 2020 2020 2020 2020 202d 2022 6e75 6d65           - "nume
+0004ebf0: 7870 7222 3a20 6576 616c 7561 7465 7320  xpr": evaluates 
+0004ec00: 6578 7072 6573 7369 6f6e 7320 7573 696e  expressions usin
+0004ec10: 6720 6e75 6d65 7870 720a 2020 2020 2020  g numexpr.      
+0004ec20: 2020 2020 2020 2d20 2270 7974 686f 6e22        - "python"
+0004ec30: 3a20 7065 7266 6f72 6d73 206f 7065 7261  : performs opera
+0004ec40: 7469 6f6e 7320 6173 2069 6620 796f 7520  tions as if you 
+0004ec50: 6861 6420 6576 616c e280 9964 2069 6e20  had eval...d in 
+0004ec60: 746f 7020 6c65 7665 6c20 7079 7468 6f6e  top level python
+0004ec70: 0a0a 2020 2020 2020 2020 6d69 7373 696e  ..        missin
+0004ec80: 675f 6469 6d73 203a 207b 2272 6169 7365  g_dims : {"raise
+0004ec90: 222c 2022 7761 726e 222c 2022 6967 6e6f  ", "warn", "igno
+0004eca0: 7265 227d 2c20 6465 6661 756c 743a 2022  re"}, default: "
+0004ecb0: 7261 6973 6522 0a20 2020 2020 2020 2020  raise".         
+0004ecc0: 2020 2057 6861 7420 746f 2064 6f20 6966     What to do if
+0004ecd0: 2064 696d 656e 7369 6f6e 7320 7468 6174   dimensions that
+0004ece0: 2073 686f 756c 6420 6265 2073 656c 6563   should be selec
+0004ecf0: 7465 6420 6672 6f6d 2061 7265 206e 6f74  ted from are not
+0004ed00: 2070 7265 7365 6e74 2069 6e20 7468 650a   present in the.
+0004ed10: 2020 2020 2020 2020 2020 2020 4461 7461              Data
+0004ed20: 7365 743a 0a0a 2020 2020 2020 2020 2020  set:..          
+0004ed30: 2020 2d20 2272 6169 7365 223a 2072 6169    - "raise": rai
+0004ed40: 7365 2061 6e20 6578 6365 7074 696f 6e0a  se an exception.
+0004ed50: 2020 2020 2020 2020 2020 2020 2d20 2277              - "w
+0004ed60: 6172 6e22 3a20 7261 6973 6520 6120 7761  arn": raise a wa
+0004ed70: 726e 696e 672c 2061 6e64 2069 676e 6f72  rning, and ignor
+0004ed80: 6520 7468 6520 6d69 7373 696e 6720 6469  e the missing di
+0004ed90: 6d65 6e73 696f 6e73 0a20 2020 2020 2020  mensions.       
+0004eda0: 2020 2020 202d 2022 6967 6e6f 7265 223a       - "ignore":
+0004edb0: 2069 676e 6f72 6520 7468 6520 6d69 7373   ignore the miss
+0004edc0: 696e 6720 6469 6d65 6e73 696f 6e73 0a0a  ing dimensions..
+0004edd0: 2020 2020 2020 2020 2a2a 7175 6572 6965          **querie
+0004ede0: 735f 6b77 6172 6773 203a 207b 6469 6d3a  s_kwargs : {dim:
+0004edf0: 2071 7565 7279 2c20 2e2e 2e7d 2c20 6f70   query, ...}, op
+0004ee00: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+0004ee10: 2020 2054 6865 206b 6579 776f 7264 2061     The keyword a
+0004ee20: 7267 756d 656e 7473 2066 6f72 6d20 6f66  rguments form of
+0004ee30: 2060 6071 7565 7269 6573 6060 2e0a 2020   ``queries``..  
+0004ee40: 2020 2020 2020 2020 2020 4f6e 6520 6f66            One of
+0004ee50: 2071 7565 7269 6573 206f 7220 7175 6572   queries or quer
+0004ee60: 6965 735f 6b77 6172 6773 206d 7573 7420  ies_kwargs must 
+0004ee70: 6265 2070 726f 7669 6465 642e 0a0a 2020  be provided...  
+0004ee80: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+0004ee90: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+0004eea0: 2020 2020 2020 6f62 6a20 3a20 4461 7461        obj : Data
+0004eeb0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
+0004eec0: 4120 6e65 7720 4461 7461 7365 7420 7769  A new Dataset wi
+0004eed0: 7468 2074 6865 2073 616d 6520 636f 6e74  th the same cont
+0004eee0: 656e 7473 2061 7320 7468 6973 2064 6174  ents as this dat
+0004eef0: 6173 6574 2c20 6578 6365 7074 2065 6163  aset, except eac
+0004ef00: 680a 2020 2020 2020 2020 2020 2020 6172  h.            ar
+0004ef10: 7261 7920 616e 6420 6469 6d65 6e73 696f  ray and dimensio
+0004ef20: 6e20 6973 2069 6e64 6578 6564 2062 7920  n is indexed by 
+0004ef30: 7468 6520 7265 7375 6c74 7320 6f66 2074  the results of t
+0004ef40: 6865 2061 7070 726f 7072 6961 7465 0a20  he appropriate. 
+0004ef50: 2020 2020 2020 2020 2020 2071 7565 7269             queri
+0004ef60: 6573 2e0a 0a20 2020 2020 2020 2053 6565  es...        See
+0004ef70: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+0004ef80: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
+0004ef90: 6174 6173 6574 2e69 7365 6c0a 2020 2020  ataset.isel.    
+0004efa0: 2020 2020 7061 6e64 6173 2e65 7661 6c0a      pandas.eval.
+0004efb0: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
+0004efc0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0004efd0: 2d2d 0a20 2020 2020 2020 203e 3e3e 2061  --.        >>> a
+0004efe0: 203d 206e 702e 6172 616e 6765 2830 2c20   = np.arange(0, 
+0004eff0: 352c 2031 290a 2020 2020 2020 2020 3e3e  5, 1).        >>
+0004f000: 3e20 6220 3d20 6e70 2e6c 696e 7370 6163  > b = np.linspac
+0004f010: 6528 302c 2031 2c20 3529 0a20 2020 2020  e(0, 1, 5).     
+0004f020: 2020 203e 3e3e 2064 7320 3d20 7872 2e44     >>> ds = xr.D
+0004f030: 6174 6173 6574 287b 2261 223a 2028 2278  ataset({"a": ("x
+0004f040: 222c 2061 292c 2022 6222 3a20 2822 7822  ", a), "b": ("x"
+0004f050: 2c20 6229 7d29 0a20 2020 2020 2020 203e  , b)}).        >
+0004f060: 3e3e 2064 730a 2020 2020 2020 2020 3c78  >> ds.        <x
+0004f070: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
+0004f080: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+0004f090: 733a 2020 2878 3a20 3529 0a20 2020 2020  s:  (x: 5).     
+0004f0a0: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
+0004f0b0: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
+0004f0c0: 733a 2078 0a20 2020 2020 2020 2044 6174  s: x.        Dat
+0004f0d0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
+0004f0e0: 2020 2020 2020 2020 2061 2020 2020 2020           a      
+0004f0f0: 2020 2878 2920 696e 7436 3420 3020 3120    (x) int64 0 1 
+0004f100: 3220 3320 340a 2020 2020 2020 2020 2020  2 3 4.          
+0004f110: 2020 6220 2020 2020 2020 2028 7829 2066    b        (x) f
+0004f120: 6c6f 6174 3634 2030 2e30 2030 2e32 3520  loat64 0.0 0.25 
+0004f130: 302e 3520 302e 3735 2031 2e30 0a20 2020  0.5 0.75 1.0.   
+0004f140: 2020 2020 203e 3e3e 2064 732e 7175 6572       >>> ds.quer
+0004f150: 7928 783d 2261 203e 2032 2229 0a20 2020  y(x="a > 2").   
+0004f160: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
+0004f170: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
+0004f180: 6d65 6e73 696f 6e73 3a20 2028 783a 2032  mensions:  (x: 2
+0004f190: 290a 2020 2020 2020 2020 4469 6d65 6e73  ).        Dimens
+0004f1a0: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
+0004f1b0: 7264 696e 6174 6573 3a20 780a 2020 2020  rdinates: x.    
+0004f1c0: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
+0004f1d0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0004f1e0: 6120 2020 2020 2020 2028 7829 2069 6e74  a        (x) int
+0004f1f0: 3634 2033 2034 0a20 2020 2020 2020 2020  64 3 4.         
+0004f200: 2020 2062 2020 2020 2020 2020 2878 2920     b        (x) 
+0004f210: 666c 6f61 7436 3420 302e 3735 2031 2e30  float64 0.75 1.0
+0004f220: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0004f230: 2020 2020 2020 2320 616c 6c6f 7720 7175        # allow qu
+0004f240: 6572 6965 7320 746f 2062 6520 6769 7665  eries to be give
+0004f250: 6e20 6569 7468 6572 2061 7320 6120 6469  n either as a di
+0004f260: 6374 206f 7220 6173 206b 7761 7267 730a  ct or as kwargs.
+0004f270: 2020 2020 2020 2020 7175 6572 6965 7320          queries 
+0004f280: 3d20 6569 7468 6572 5f64 6963 745f 6f72  = either_dict_or
+0004f290: 5f6b 7761 7267 7328 7175 6572 6965 732c  _kwargs(queries,
+0004f2a0: 2071 7565 7269 6573 5f6b 7761 7267 732c   queries_kwargs,
+0004f2b0: 2022 7175 6572 7922 290a 0a20 2020 2020   "query")..     
+0004f2c0: 2020 2023 2063 6865 636b 2071 7565 7269     # check queri
+0004f2d0: 6573 0a20 2020 2020 2020 2066 6f72 2064  es.        for d
+0004f2e0: 696d 2c20 6578 7072 2069 6e20 7175 6572  im, expr in quer
+0004f2f0: 6965 732e 6974 656d 7328 293a 0a20 2020  ies.items():.   
+0004f300: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0004f310: 6973 696e 7374 616e 6365 2865 7870 722c  isinstance(expr,
+0004f320: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
+0004f330: 2020 2020 2020 206d 7367 203d 2066 2265         msg = f"e
+0004f340: 7870 7220 666f 7220 6469 6d20 7b64 696d  xpr for dim {dim
+0004f350: 7d20 6d75 7374 2062 6520 6120 7374 7269  } must be a stri
+0004f360: 6e67 2074 6f20 6265 2065 7661 6c75 6174  ng to be evaluat
+0004f370: 6564 2c20 7b74 7970 6528 6578 7072 297d  ed, {type(expr)}
+0004f380: 2067 6976 656e 220a 2020 2020 2020 2020   given".        
+0004f390: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0004f3a0: 6c75 6545 7272 6f72 286d 7367 290a 0a20  lueError(msg).. 
+0004f3b0: 2020 2020 2020 2023 2065 7661 6c75 6174         # evaluat
+0004f3c0: 6520 7468 6520 7175 6572 6965 7320 746f  e the queries to
+0004f3d0: 2063 7265 6174 6520 7468 6520 696e 6465   create the inde
+0004f3e0: 7865 7273 0a20 2020 2020 2020 2069 6e64  xers.        ind
+0004f3f0: 6578 6572 7320 3d20 7b0a 2020 2020 2020  exers = {.      
+0004f400: 2020 2020 2020 6469 6d3a 2070 642e 6576        dim: pd.ev
+0004f410: 616c 2865 7870 722c 2072 6573 6f6c 7665  al(expr, resolve
+0004f420: 7273 3d5b 7365 6c66 5d2c 2070 6172 7365  rs=[self], parse
+0004f430: 723d 7061 7273 6572 2c20 656e 6769 6e65  r=parser, engine
+0004f440: 3d65 6e67 696e 6529 0a20 2020 2020 2020  =engine).       
+0004f450: 2020 2020 2066 6f72 2064 696d 2c20 6578       for dim, ex
+0004f460: 7072 2069 6e20 7175 6572 6965 732e 6974  pr in queries.it
+0004f470: 656d 7328 290a 2020 2020 2020 2020 7d0a  ems().        }.
+0004f480: 0a20 2020 2020 2020 2023 2061 7070 6c79  .        # apply
+0004f490: 2074 6865 2073 656c 6563 7469 6f6e 0a20   the selection. 
+0004f4a0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0004f4b0: 6c66 2e69 7365 6c28 696e 6465 7865 7273  lf.isel(indexers
+0004f4c0: 2c20 6d69 7373 696e 675f 6469 6d73 3d6d  , missing_dims=m
+0004f4d0: 6973 7369 6e67 5f64 696d 7329 0a0a 2020  issing_dims)..  
+0004f4e0: 2020 6465 6620 6375 7276 6566 6974 280a    def curvefit(.
+0004f4f0: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
+0004f500: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
+0004f510: 2063 6f6f 7264 733a 2073 7472 207c 2044   coords: str | D
+0004f520: 6174 6141 7272 6179 207c 2049 7465 7261  ataArray | Itera
+0004f530: 626c 655b 7374 7220 7c20 4461 7461 4172  ble[str | DataAr
+0004f540: 7261 795d 2c0a 2020 2020 2020 2020 6675  ray],.        fu
+0004f550: 6e63 3a20 4361 6c6c 6162 6c65 5b2e 2e2e  nc: Callable[...
+0004f560: 2c20 416e 795d 2c0a 2020 2020 2020 2020  , Any],.        
+0004f570: 7265 6475 6365 5f64 696d 733a 2044 696d  reduce_dims: Dim
+0004f580: 7320 3d20 4e6f 6e65 2c0a 2020 2020 2020  s = None,.      
+0004f590: 2020 736b 6970 6e61 3a20 626f 6f6c 203d    skipna: bool =
+0004f5a0: 2054 7275 652c 0a20 2020 2020 2020 2070   True,.        p
+0004f5b0: 303a 2064 6963 745b 7374 722c 2041 6e79  0: dict[str, Any
+0004f5c0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+0004f5d0: 0a20 2020 2020 2020 2062 6f75 6e64 733a  .        bounds:
+0004f5e0: 2064 6963 745b 7374 722c 2041 6e79 5d20   dict[str, Any] 
+0004f5f0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+0004f600: 2020 2020 2020 2070 6172 616d 5f6e 616d         param_nam
+0004f610: 6573 3a20 5365 7175 656e 6365 5b73 7472  es: Sequence[str
+0004f620: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+0004f630: 0a20 2020 2020 2020 206b 7761 7267 733a  .        kwargs:
+0004f640: 2064 6963 745b 7374 722c 2041 6e79 5d20   dict[str, Any] 
+0004f650: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+0004f660: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
+0004f670: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
+0004f680: 2020 2020 2020 2043 7572 7665 2066 6974         Curve fit
+0004f690: 7469 6e67 206f 7074 696d 697a 6174 696f  ting optimizatio
+0004f6a0: 6e20 666f 7220 6172 6269 7472 6172 7920  n for arbitrary 
+0004f6b0: 6675 6e63 7469 6f6e 732e 0a0a 2020 2020  functions...    
+0004f6c0: 2020 2020 5772 6170 7320 6073 6369 7079      Wraps `scipy
+0004f6d0: 2e6f 7074 696d 697a 652e 6375 7276 655f  .optimize.curve_
+0004f6e0: 6669 7460 2077 6974 6820 6061 7070 6c79  fit` with `apply
+0004f6f0: 5f75 6675 6e63 602e 0a0a 2020 2020 2020  _ufunc`...      
+0004f700: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0004f710: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0004f720: 2020 2020 2020 2020 636f 6f72 6473 203a          coords :
+0004f730: 2068 6173 6861 626c 652c 2044 6174 6141   hashable, DataA
+0004f740: 7272 6179 2c20 6f72 2073 6571 7565 6e63  rray, or sequenc
+0004f750: 6520 6f66 2068 6173 6861 626c 6520 6f72  e of hashable or
+0004f760: 2044 6174 6141 7272 6179 0a20 2020 2020   DataArray.     
+0004f770: 2020 2020 2020 2049 6e64 6570 656e 6465         Independe
+0004f780: 6e74 2063 6f6f 7264 696e 6174 6528 7329  nt coordinate(s)
+0004f790: 206f 7665 7220 7768 6963 6820 746f 2070   over which to p
+0004f7a0: 6572 666f 726d 2074 6865 2063 7572 7665  erform the curve
+0004f7b0: 2066 6974 7469 6e67 2e20 4d75 7374 2073   fitting. Must s
+0004f7c0: 6861 7265 0a20 2020 2020 2020 2020 2020  hare.           
+0004f7d0: 2061 7420 6c65 6173 7420 6f6e 6520 6469   at least one di
+0004f7e0: 6d65 6e73 696f 6e20 7769 7468 2074 6865  mension with the
+0004f7f0: 2063 616c 6c69 6e67 206f 626a 6563 742e   calling object.
+0004f800: 2057 6865 6e20 6669 7474 696e 6720 6d75   When fitting mu
+0004f810: 6c74 692d 6469 6d65 6e73 696f 6e61 6c0a  lti-dimensional.
+0004f820: 2020 2020 2020 2020 2020 2020 6675 6e63              func
+0004f830: 7469 6f6e 732c 2073 7570 706c 7920 6063  tions, supply `c
+0004f840: 6f6f 7264 7360 2061 7320 6120 7365 7175  oords` as a sequ
+0004f850: 656e 6365 2069 6e20 7468 6520 7361 6d65  ence in the same
+0004f860: 206f 7264 6572 2061 7320 6172 6775 6d65   order as argume
+0004f870: 6e74 7320 696e 0a20 2020 2020 2020 2020  nts in.         
+0004f880: 2020 2060 6675 6e63 602e 2054 6f20 6669     `func`. To fi
+0004f890: 7420 616c 6f6e 6720 6578 6973 7469 6e67  t along existing
+0004f8a0: 2064 696d 656e 7369 6f6e 7320 6f66 2074   dimensions of t
+0004f8b0: 6865 2063 616c 6c69 6e67 206f 626a 6563  he calling objec
+0004f8c0: 742c 2060 636f 6f72 6473 6020 6361 6e0a  t, `coords` can.
+0004f8d0: 2020 2020 2020 2020 2020 2020 616c 736f              also
+0004f8e0: 2062 6520 7370 6563 6966 6965 6420 6173   be specified as
+0004f8f0: 2061 2073 7472 206f 7220 7365 7175 656e   a str or sequen
+0004f900: 6365 206f 6620 7374 7273 2e0a 2020 2020  ce of strs..    
+0004f910: 2020 2020 6675 6e63 203a 2063 616c 6c61      func : calla
+0004f920: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
+0004f930: 5573 6572 2073 7065 6369 6669 6564 2066  User specified f
+0004f940: 756e 6374 696f 6e20 696e 2074 6865 2066  unction in the f
+0004f950: 6f72 6d20 6066 2878 2c20 2a70 6172 616d  orm `f(x, *param
+0004f960: 7329 6020 7768 6963 6820 7265 7475 726e  s)` which return
+0004f970: 7320 6120 6e75 6d70 790a 2020 2020 2020  s a numpy.      
+0004f980: 2020 2020 2020 6172 7261 7920 6f66 206c        array of l
+0004f990: 656e 6774 6820 606c 656e 2878 2960 2e20  ength `len(x)`. 
+0004f9a0: 6070 6172 616d 7360 2061 7265 2074 6865  `params` are the
+0004f9b0: 2066 6974 7461 626c 6520 7061 7261 6d65   fittable parame
+0004f9c0: 7465 7273 2077 6869 6368 2061 7265 206f  ters which are o
+0004f9d0: 7074 696d 697a 6564 0a20 2020 2020 2020  ptimized.       
+0004f9e0: 2020 2020 2062 7920 7363 6970 7920 6375       by scipy cu
+0004f9f0: 7276 655f 6669 742e 2060 7860 2063 616e  rve_fit. `x` can
+0004fa00: 2061 6c73 6f20 6265 2073 7065 6369 6669   also be specifi
+0004fa10: 6564 2061 7320 6120 7365 7175 656e 6365  ed as a sequence
+0004fa20: 2063 6f6e 7461 696e 696e 6720 6d75 6c74   containing mult
+0004fa30: 6970 6c65 0a20 2020 2020 2020 2020 2020  iple.           
+0004fa40: 2063 6f6f 7264 696e 6174 6573 2c20 652e   coordinates, e.
+0004fa50: 672e 2060 6628 2878 302c 2078 3129 2c20  g. `f((x0, x1), 
+0004fa60: 2a70 6172 616d 7329 602e 0a20 2020 2020  *params)`..     
+0004fa70: 2020 2072 6564 7563 655f 6469 6d73 203a     reduce_dims :
+0004fa80: 2073 7472 2c20 4974 6572 6162 6c65 206f   str, Iterable o
+0004fa90: 6620 4861 7368 6162 6c65 206f 7220 4e6f  f Hashable or No
+0004faa0: 6e65 2c20 6f70 7469 6f6e 616c 0a20 2020  ne, optional.   
+0004fab0: 2020 2020 2020 2020 2041 6464 6974 696f           Additio
+0004fac0: 6e61 6c20 6469 6d65 6e73 696f 6e28 7329  nal dimension(s)
+0004fad0: 206f 7665 7220 7768 6963 6820 746f 2061   over which to a
+0004fae0: 6767 7265 6761 7465 2077 6869 6c65 2066  ggregate while f
+0004faf0: 6974 7469 6e67 2e20 466f 7220 6578 616d  itting. For exam
+0004fb00: 706c 652c 0a20 2020 2020 2020 2020 2020  ple,.           
+0004fb10: 2063 616c 6c69 6e67 2060 6473 2e63 7572   calling `ds.cur
+0004fb20: 7665 6669 7428 636f 6f72 6473 3d27 7469  vefit(coords='ti
+0004fb30: 6d65 272c 2072 6564 7563 655f 6469 6d73  me', reduce_dims
+0004fb40: 3d5b 276c 6174 272c 2027 6c6f 6e27 5d2c  =['lat', 'lon'],
+0004fb50: 202e 2e2e 2960 2077 696c 6c0a 2020 2020   ...)` will.    
+0004fb60: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
+0004fb70: 6520 616c 6c20 6c61 7420 616e 6420 6c6f  e all lat and lo
+0004fb80: 6e20 706f 696e 7473 2061 6e64 2066 6974  n points and fit
+0004fb90: 2074 6865 2073 7065 6369 6669 6564 2066   the specified f
+0004fba0: 756e 6374 696f 6e20 616c 6f6e 6720 7468  unction along th
+0004fbb0: 650a 2020 2020 2020 2020 2020 2020 7469  e.            ti
+0004fbc0: 6d65 2064 696d 656e 7369 6f6e 2e0a 2020  me dimension..  
+0004fbd0: 2020 2020 2020 736b 6970 6e61 203a 2062        skipna : b
+0004fbe0: 6f6f 6c2c 2064 6566 6175 6c74 3a20 5472  ool, default: Tr
+0004fbf0: 7565 0a20 2020 2020 2020 2020 2020 2057  ue.            W
+0004fc00: 6865 7468 6572 2074 6f20 736b 6970 206d  hether to skip m
+0004fc10: 6973 7369 6e67 2076 616c 7565 7320 7768  issing values wh
+0004fc20: 656e 2066 6974 7469 6e67 2e20 4465 6661  en fitting. Defa
+0004fc30: 756c 7420 6973 2054 7275 652e 0a20 2020  ult is True..   
+0004fc40: 2020 2020 2070 3020 3a20 6469 6374 2d6c       p0 : dict-l
+0004fc50: 696b 652c 206f 7074 696f 6e61 6c0a 2020  ike, optional.  
+0004fc60: 2020 2020 2020 2020 2020 4f70 7469 6f6e            Option
+0004fc70: 616c 2064 6963 7469 6f6e 6172 7920 6f66  al dictionary of
+0004fc80: 2070 6172 616d 6574 6572 206e 616d 6573   parameter names
+0004fc90: 2074 6f20 696e 6974 6961 6c20 6775 6573   to initial gues
+0004fca0: 7365 7320 7061 7373 6564 2074 6f20 7468  ses passed to th
+0004fcb0: 650a 2020 2020 2020 2020 2020 2020 6063  e.            `c
+0004fcc0: 7572 7665 5f66 6974 6020 6070 3060 2061  urve_fit` `p0` a
+0004fcd0: 7267 2e20 4966 206e 6f6e 6520 6f72 206f  rg. If none or o
+0004fce0: 6e6c 7920 736f 6d65 2070 6172 616d 6574  nly some paramet
+0004fcf0: 6572 7320 6172 6520 7061 7373 6564 2c20  ers are passed, 
+0004fd00: 7468 6520 7265 7374 2077 696c 6c0a 2020  the rest will.  
+0004fd10: 2020 2020 2020 2020 2020 6265 2061 7373            be ass
+0004fd20: 6967 6e65 6420 696e 6974 6961 6c20 7661  igned initial va
+0004fd30: 6c75 6573 2066 6f6c 6c6f 7769 6e67 2074  lues following t
+0004fd40: 6865 2064 6566 6175 6c74 2073 6369 7079  he default scipy
+0004fd50: 2062 6568 6176 696f 722e 0a20 2020 2020   behavior..     
+0004fd60: 2020 2062 6f75 6e64 7320 3a20 6469 6374     bounds : dict
+0004fd70: 2d6c 696b 652c 206f 7074 696f 6e61 6c0a  -like, optional.
+0004fd80: 2020 2020 2020 2020 2020 2020 4f70 7469              Opti
+0004fd90: 6f6e 616c 2064 6963 7469 6f6e 6172 7920  onal dictionary 
+0004fda0: 6f66 2070 6172 616d 6574 6572 206e 616d  of parameter nam
+0004fdb0: 6573 2074 6f20 626f 756e 6469 6e67 2076  es to bounding v
+0004fdc0: 616c 7565 7320 7061 7373 6564 2074 6f20  alues passed to 
+0004fdd0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+0004fde0: 6063 7572 7665 5f66 6974 6020 6062 6f75  `curve_fit` `bou
+0004fdf0: 6e64 7360 2061 7267 2e20 4966 206e 6f6e  nds` arg. If non
+0004fe00: 6520 6f72 206f 6e6c 7920 736f 6d65 2070  e or only some p
+0004fe10: 6172 616d 6574 6572 7320 6172 6520 7061  arameters are pa
+0004fe20: 7373 6564 2c20 7468 6520 7265 7374 0a20  ssed, the rest. 
+0004fe30: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
+0004fe40: 6265 2075 6e62 6f75 6e64 6564 2066 6f6c  be unbounded fol
+0004fe50: 6c6f 7769 6e67 2074 6865 2064 6566 6175  lowing the defau
+0004fe60: 6c74 2073 6369 7079 2062 6568 6176 696f  lt scipy behavio
+0004fe70: 722e 0a20 2020 2020 2020 2070 6172 616d  r..        param
+0004fe80: 5f6e 616d 6573 203a 2073 6571 7565 6e63  _names : sequenc
+0004fe90: 6520 6f66 2068 6173 6861 626c 652c 206f  e of hashable, o
+0004fea0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0004feb0: 2020 2020 5365 7175 656e 6365 206f 6620      Sequence of 
+0004fec0: 6e61 6d65 7320 666f 7220 7468 6520 6669  names for the fi
+0004fed0: 7474 6162 6c65 2070 6172 616d 6574 6572  ttable parameter
+0004fee0: 7320 6f66 2060 6675 6e63 602e 2049 6620  s of `func`. If 
+0004fef0: 6e6f 7420 7375 7070 6c69 6564 2c0a 2020  not supplied,.  
+0004ff00: 2020 2020 2020 2020 2020 7468 6973 2077            this w
+0004ff10: 696c 6c20 6265 2061 7574 6f6d 6174 6963  ill be automatic
+0004ff20: 616c 6c79 2064 6574 6572 6d69 6e65 6420  ally determined 
+0004ff30: 6279 2061 7267 756d 656e 7473 206f 6620  by arguments of 
+0004ff40: 6066 756e 6360 2e20 6070 6172 616d 5f6e  `func`. `param_n
+0004ff50: 616d 6573 600a 2020 2020 2020 2020 2020  ames`.          
+0004ff60: 2020 7368 6f75 6c64 2062 6520 6d61 6e75    should be manu
+0004ff70: 616c 6c79 2073 7570 706c 6965 6420 7768  ally supplied wh
+0004ff80: 656e 2066 6974 7469 6e67 2061 2066 756e  en fitting a fun
+0004ff90: 6374 696f 6e20 7468 6174 2074 616b 6573  ction that takes
+0004ffa0: 2061 2076 6172 6961 626c 650a 2020 2020   a variable.    
+0004ffb0: 2020 2020 2020 2020 6e75 6d62 6572 206f          number o
+0004ffc0: 6620 7061 7261 6d65 7465 7273 2e0a 2020  f parameters..  
+0004ffd0: 2020 2020 2020 2a2a 6b77 6172 6773 203a        **kwargs :
+0004ffe0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0004fff0: 2020 2020 2020 4164 6469 7469 6f6e 616c        Additional
+00050000: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+00050010: 7473 2074 6f20 7061 7373 6564 2074 6f20  ts to passed to 
+00050020: 7363 6970 7920 6375 7276 655f 6669 742e  scipy curve_fit.
+00050030: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00050040: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00050050: 2d0a 2020 2020 2020 2020 6375 7276 6566  -.        curvef
+00050060: 6974 5f72 6573 756c 7473 203a 2044 6174  it_results : Dat
+00050070: 6173 6574 0a20 2020 2020 2020 2020 2020  aset.           
+00050080: 2041 2073 696e 676c 6520 6461 7461 7365   A single datase
+00050090: 7420 7768 6963 6820 636f 6e74 6169 6e73  t which contains
+000500a0: 3a0a 0a20 2020 2020 2020 2020 2020 205b  :..            [
+000500b0: 7661 725d 5f63 7572 7665 6669 745f 636f  var]_curvefit_co
+000500c0: 6566 6669 6369 656e 7473 0a20 2020 2020  efficients.     
+000500d0: 2020 2020 2020 2020 2020 2054 6865 2063             The c
+000500e0: 6f65 6666 6963 6965 6e74 7320 6f66 2074  oefficients of t
+000500f0: 6865 2062 6573 7420 6669 742e 0a20 2020  he best fit..   
+00050100: 2020 2020 2020 2020 205b 7661 725d 5f63           [var]_c
+00050110: 7572 7665 6669 745f 636f 7661 7269 616e  urvefit_covarian
+00050120: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+00050130: 2020 2054 6865 2063 6f76 6172 6961 6e63     The covarianc
+00050140: 6520 6d61 7472 6978 206f 6620 7468 6520  e matrix of the 
+00050150: 636f 6566 6669 6369 656e 7420 6573 7469  coefficient esti
+00050160: 6d61 7465 732e 0a0a 2020 2020 2020 2020  mates...        
+00050170: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+00050180: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+00050190: 2020 4461 7461 7365 742e 706f 6c79 6669    Dataset.polyfi
+000501a0: 740a 2020 2020 2020 2020 7363 6970 792e  t.        scipy.
+000501b0: 6f70 7469 6d69 7a65 2e63 7572 7665 5f66  optimize.curve_f
+000501c0: 6974 0a20 2020 2020 2020 2022 2222 0a20  it.        """. 
+000501d0: 2020 2020 2020 2066 726f 6d20 7363 6970         from scip
+000501e0: 792e 6f70 7469 6d69 7a65 2069 6d70 6f72  y.optimize impor
+000501f0: 7420 6375 7276 655f 6669 740a 0a20 2020  t curve_fit..   
+00050200: 2020 2020 2066 726f 6d20 7861 7272 6179       from xarray
+00050210: 2e63 6f72 652e 616c 6967 6e6d 656e 7420  .core.alignment 
+00050220: 696d 706f 7274 2062 726f 6164 6361 7374  import broadcast
+00050230: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
+00050240: 7272 6179 2e63 6f72 652e 636f 6d70 7574  rray.core.comput
+00050250: 6174 696f 6e20 696d 706f 7274 2061 7070  ation import app
+00050260: 6c79 5f75 6675 6e63 0a20 2020 2020 2020  ly_ufunc.       
+00050270: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
+00050280: 652e 6461 7461 6172 7261 7920 696d 706f  e.dataarray impo
+00050290: 7274 205f 5448 4953 5f41 5252 4159 2c20  rt _THIS_ARRAY, 
+000502a0: 4461 7461 4172 7261 790a 0a20 2020 2020  DataArray..     
+000502b0: 2020 2069 6620 7030 2069 7320 4e6f 6e65     if p0 is None
+000502c0: 3a0a 2020 2020 2020 2020 2020 2020 7030  :.            p0
+000502d0: 203d 207b 7d0a 2020 2020 2020 2020 6966   = {}.        if
+000502e0: 2062 6f75 6e64 7320 6973 204e 6f6e 653a   bounds is None:
+000502f0: 0a20 2020 2020 2020 2020 2020 2062 6f75  .            bou
+00050300: 6e64 7320 3d20 7b7d 0a20 2020 2020 2020  nds = {}.       
+00050310: 2069 6620 6b77 6172 6773 2069 7320 4e6f   if kwargs is No
+00050320: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00050330: 6b77 6172 6773 203d 207b 7d0a 0a20 2020  kwargs = {}..   
+00050340: 2020 2020 2072 6564 7563 655f 6469 6d73       reduce_dims
+00050350: 5f3a 206c 6973 745b 4861 7368 6162 6c65  _: list[Hashable
+00050360: 5d0a 2020 2020 2020 2020 6966 206e 6f74  ].        if not
+00050370: 2072 6564 7563 655f 6469 6d73 3a0a 2020   reduce_dims:.  
+00050380: 2020 2020 2020 2020 2020 7265 6475 6365            reduce
+00050390: 5f64 696d 735f 203d 205b 5d0a 2020 2020  _dims_ = [].    
+000503a0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+000503b0: 6e63 6528 7265 6475 6365 5f64 696d 732c  nce(reduce_dims,
+000503c0: 2073 7472 2920 6f72 206e 6f74 2069 7369   str) or not isi
+000503d0: 6e73 7461 6e63 6528 7265 6475 6365 5f64  nstance(reduce_d
+000503e0: 696d 732c 2049 7465 7261 626c 6529 3a0a  ims, Iterable):.
+000503f0: 2020 2020 2020 2020 2020 2020 7265 6475              redu
+00050400: 6365 5f64 696d 735f 203d 205b 7265 6475  ce_dims_ = [redu
+00050410: 6365 5f64 696d 735d 0a20 2020 2020 2020  ce_dims].       
+00050420: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00050430: 2020 2072 6564 7563 655f 6469 6d73 5f20     reduce_dims_ 
+00050440: 3d20 6c69 7374 2872 6564 7563 655f 6469  = list(reduce_di
+00050450: 6d73 290a 0a20 2020 2020 2020 2069 6620  ms)..        if 
+00050460: 280a 2020 2020 2020 2020 2020 2020 6973  (.            is
+00050470: 696e 7374 616e 6365 2863 6f6f 7264 732c  instance(coords,
+00050480: 2073 7472 290a 2020 2020 2020 2020 2020   str).          
+00050490: 2020 6f72 2069 7369 6e73 7461 6e63 6528    or isinstance(
+000504a0: 636f 6f72 6473 2c20 4461 7461 4172 7261  coords, DataArra
+000504b0: 7929 0a20 2020 2020 2020 2020 2020 206f  y).            o
+000504c0: 7220 6e6f 7420 6973 696e 7374 616e 6365  r not isinstance
+000504d0: 2863 6f6f 7264 732c 2049 7465 7261 626c  (coords, Iterabl
+000504e0: 6529 0a20 2020 2020 2020 2029 3a0a 2020  e).        ):.  
+000504f0: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
+00050500: 203d 205b 636f 6f72 6473 5d0a 2020 2020   = [coords].    
+00050510: 2020 2020 636f 6f72 6473 5f3a 2053 6571      coords_: Seq
+00050520: 7565 6e63 655b 4461 7461 4172 7261 795d  uence[DataArray]
+00050530: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+00050540: 2073 656c 665b 636f 6f72 645d 2069 6620   self[coord] if 
+00050550: 6973 696e 7374 616e 6365 2863 6f6f 7264  isinstance(coord
+00050560: 2c20 7374 7229 2065 6c73 6520 636f 6f72  , str) else coor
+00050570: 6420 666f 7220 636f 6f72 6420 696e 2063  d for coord in c
+00050580: 6f6f 7264 730a 2020 2020 2020 2020 5d0a  oords.        ].
+00050590: 0a20 2020 2020 2020 2023 2044 6574 6572  .        # Deter
+000505a0: 6d69 6e65 2077 6865 7468 6572 2061 6e79  mine whether any
+000505b0: 2063 6f6f 7264 7320 6172 6520 6469 6d73   coords are dims
+000505c0: 206f 6e20 7365 6c66 0a20 2020 2020 2020   on self.       
+000505d0: 2066 6f72 2063 6f6f 7264 2069 6e20 636f   for coord in co
+000505e0: 6f72 6473 5f3a 0a20 2020 2020 2020 2020  ords_:.         
+000505f0: 2020 2072 6564 7563 655f 6469 6d73 5f20     reduce_dims_ 
+00050600: 2b3d 205b 6320 666f 7220 6320 696e 2073  += [c for c in s
+00050610: 656c 662e 6469 6d73 2069 6620 636f 6f72  elf.dims if coor
+00050620: 642e 6571 7561 6c73 2873 656c 665b 635d  d.equals(self[c]
+00050630: 295d 0a20 2020 2020 2020 2072 6564 7563  )].        reduc
+00050640: 655f 6469 6d73 5f20 3d20 6c69 7374 2873  e_dims_ = list(s
+00050650: 6574 2872 6564 7563 655f 6469 6d73 5f29  et(reduce_dims_)
+00050660: 290a 2020 2020 2020 2020 7072 6573 6572  ).        preser
+00050670: 7665 645f 6469 6d73 203d 206c 6973 7428  ved_dims = list(
+00050680: 7365 7428 7365 6c66 2e64 696d 7329 202d  set(self.dims) -
+00050690: 2073 6574 2872 6564 7563 655f 6469 6d73   set(reduce_dims
+000506a0: 5f29 290a 2020 2020 2020 2020 6966 206e  _)).        if n
+000506b0: 6f74 2072 6564 7563 655f 6469 6d73 5f3a  ot reduce_dims_:
+000506c0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+000506d0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+000506e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000506f0: 4e6f 2061 7267 756d 656e 7473 2074 6f20  No arguments to 
+00050700: 6063 6f6f 7264 7360 2077 6572 6520 6964  `coords` were id
+00050710: 656e 7469 6669 6564 2061 7320 6120 6469  entified as a di
+00050720: 6d65 6e73 696f 6e20 6f6e 2074 6865 2063  mension on the c
+00050730: 616c 6c69 6e67 2022 0a20 2020 2020 2020  alling ".       
+00050740: 2020 2020 2020 2020 2022 6f62 6a65 6374           "object
+00050750: 2c20 616e 6420 6e6f 2064 696d 7320 7765  , and no dims we
+00050760: 7265 2073 7570 706c 6965 6420 746f 2060  re supplied to `
+00050770: 7265 6475 6365 5f64 696d 7360 2e20 5468  reduce_dims`. Th
+00050780: 6973 2077 6f75 6c64 2072 6573 756c 7420  is would result 
+00050790: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000507a0: 2020 2269 6e20 6669 7474 696e 6720 6f6e    "in fitting on
+000507b0: 2073 6361 6c61 7220 6461 7461 2e22 0a20   scalar data.". 
+000507c0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+000507d0: 2020 2020 2020 2320 4272 6f61 6463 6173        # Broadcas
+000507e0: 7420 616c 6c20 636f 6f72 6473 2077 6974  t all coords wit
+000507f0: 6820 6561 6368 206f 7468 6572 0a20 2020  h each other.   
+00050800: 2020 2020 2063 6f6f 7264 735f 203d 2062       coords_ = b
+00050810: 726f 6164 6361 7374 282a 636f 6f72 6473  roadcast(*coords
+00050820: 5f29 0a20 2020 2020 2020 2063 6f6f 7264  _).        coord
+00050830: 735f 203d 205b 0a20 2020 2020 2020 2020  s_ = [.         
+00050840: 2020 2063 6f6f 7264 2e62 726f 6164 6361     coord.broadca
+00050850: 7374 5f6c 696b 6528 7365 6c66 2c20 6578  st_like(self, ex
+00050860: 636c 7564 653d 7072 6573 6572 7665 645f  clude=preserved_
+00050870: 6469 6d73 2920 666f 7220 636f 6f72 6420  dims) for coord 
+00050880: 696e 2063 6f6f 7264 735f 0a20 2020 2020  in coords_.     
+00050890: 2020 205d 0a0a 2020 2020 2020 2020 7061     ]..        pa
+000508a0: 7261 6d73 2c20 6675 6e63 5f61 7267 7320  rams, func_args 
+000508b0: 3d20 5f67 6574 5f66 756e 635f 6172 6773  = _get_func_args
+000508c0: 2866 756e 632c 2070 6172 616d 5f6e 616d  (func, param_nam
+000508d0: 6573 290a 2020 2020 2020 2020 7061 7261  es).        para
+000508e0: 6d5f 6465 6661 756c 7473 2c20 626f 756e  m_defaults, boun
+000508f0: 6473 5f64 6566 6175 6c74 7320 3d20 5f69  ds_defaults = _i
+00050900: 6e69 7469 616c 697a 655f 6375 7276 6566  nitialize_curvef
+00050910: 6974 5f70 6172 616d 7328 0a20 2020 2020  it_params(.     
+00050920: 2020 2020 2020 2070 6172 616d 732c 2070         params, p
+00050930: 302c 2062 6f75 6e64 732c 2066 756e 635f  0, bounds, func_
+00050940: 6172 6773 0a20 2020 2020 2020 2029 0a20  args.        ). 
+00050950: 2020 2020 2020 206e 5f70 6172 616d 7320         n_params 
+00050960: 3d20 6c65 6e28 7061 7261 6d73 290a 2020  = len(params).  
+00050970: 2020 2020 2020 6b77 6172 6773 2e73 6574        kwargs.set
+00050980: 6465 6661 756c 7428 2270 3022 2c20 5b70  default("p0", [p
+00050990: 6172 616d 5f64 6566 6175 6c74 735b 705d  aram_defaults[p]
+000509a0: 2066 6f72 2070 2069 6e20 7061 7261 6d73   for p in params
+000509b0: 5d29 0a20 2020 2020 2020 206b 7761 7267  ]).        kwarg
+000509c0: 732e 7365 7464 6566 6175 6c74 280a 2020  s.setdefault(.  
+000509d0: 2020 2020 2020 2020 2020 2262 6f75 6e64            "bound
+000509e0: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
+000509f0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+00050a00: 2020 5b62 6f75 6e64 735f 6465 6661 756c    [bounds_defaul
+00050a10: 7473 5b70 5d5b 305d 2066 6f72 2070 2069  ts[p][0] for p i
+00050a20: 6e20 7061 7261 6d73 5d2c 0a20 2020 2020  n params],.     
+00050a30: 2020 2020 2020 2020 2020 205b 626f 756e             [boun
+00050a40: 6473 5f64 6566 6175 6c74 735b 705d 5b31  ds_defaults[p][1
+00050a50: 5d20 666f 7220 7020 696e 2070 6172 616d  ] for p in param
+00050a60: 735d 2c0a 2020 2020 2020 2020 2020 2020  s],.            
+00050a70: 5d2c 0a20 2020 2020 2020 2029 0a0a 2020  ],.        )..  
+00050a80: 2020 2020 2020 6465 6620 5f77 7261 7070        def _wrapp
+00050a90: 6572 2859 2c20 2a63 6f6f 7264 735f 2c20  er(Y, *coords_, 
+00050aa0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+00050ab0: 2020 2020 2020 2023 2057 7261 7020 6375         # Wrap cu
+00050ac0: 7276 655f 6669 7420 7769 7468 2072 6176  rve_fit with rav
+00050ad0: 656c 6564 2063 6f6f 7264 696e 6174 6573  eled coordinates
+00050ae0: 2061 6e64 2070 6f69 6e74 7769 7365 204e   and pointwise N
+00050af0: 614e 2068 616e 646c 696e 670a 2020 2020  aN handling.    
+00050b00: 2020 2020 2020 2020 7820 3d20 6e70 2e76          x = np.v
+00050b10: 7374 6163 6b28 5b63 2e72 6176 656c 2829  stack([c.ravel()
+00050b20: 2066 6f72 2063 2069 6e20 636f 6f72 6473   for c in coords
+00050b30: 5f5d 290a 2020 2020 2020 2020 2020 2020  _]).            
+00050b40: 7920 3d20 592e 7261 7665 6c28 290a 2020  y = Y.ravel().  
+00050b50: 2020 2020 2020 2020 2020 6966 2073 6b69            if ski
+00050b60: 706e 613a 0a20 2020 2020 2020 2020 2020  pna:.           
+00050b70: 2020 2020 206d 6173 6b20 3d20 6e70 2e61       mask = np.a
+00050b80: 6c6c 285b 6e70 2e61 6e79 287e 6e70 2e69  ll([np.any(~np.i
+00050b90: 736e 616e 2878 292c 2061 7869 733d 3029  snan(x), axis=0)
+00050ba0: 2c20 7e6e 702e 6973 6e61 6e28 7929 5d2c  , ~np.isnan(y)],
+00050bb0: 2061 7869 733d 3029 0a20 2020 2020 2020   axis=0).       
+00050bc0: 2020 2020 2020 2020 2078 203d 2078 5b3a           x = x[:
+00050bd0: 2c20 6d61 736b 5d0a 2020 2020 2020 2020  , mask].        
+00050be0: 2020 2020 2020 2020 7920 3d20 795b 6d61          y = y[ma
+00050bf0: 736b 5d0a 2020 2020 2020 2020 2020 2020  sk].            
+00050c00: 2020 2020 6966 206e 6f74 206c 656e 2879      if not len(y
+00050c10: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00050c20: 2020 2020 2020 2070 6f70 7420 3d20 6e70         popt = np
+00050c30: 2e66 756c 6c28 5b6e 5f70 6172 616d 735d  .full([n_params]
+00050c40: 2c20 6e70 2e6e 616e 290a 2020 2020 2020  , np.nan).      
+00050c50: 2020 2020 2020 2020 2020 2020 2020 7063                pc
+00050c60: 6f76 203d 206e 702e 6675 6c6c 285b 6e5f  ov = np.full([n_
+00050c70: 7061 7261 6d73 2c20 6e5f 7061 7261 6d73  params, n_params
+00050c80: 5d2c 206e 702e 6e61 6e29 0a20 2020 2020  ], np.nan).     
+00050c90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00050ca0: 6574 7572 6e20 706f 7074 2c20 7063 6f76  eturn popt, pcov
+00050cb0: 0a20 2020 2020 2020 2020 2020 2078 203d  .            x =
+00050cc0: 206e 702e 7371 7565 657a 6528 7829 0a20   np.squeeze(x). 
+00050cd0: 2020 2020 2020 2020 2020 2070 6f70 742c             popt,
+00050ce0: 2070 636f 7620 3d20 6375 7276 655f 6669   pcov = curve_fi
+00050cf0: 7428 6675 6e63 2c20 782c 2079 2c20 2a2a  t(func, x, y, **
+00050d00: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+00050d10: 2020 2020 7265 7475 726e 2070 6f70 742c      return popt,
+00050d20: 2070 636f 760a 0a20 2020 2020 2020 2072   pcov..        r
+00050d30: 6573 756c 7420 3d20 7479 7065 2873 656c  esult = type(sel
+00050d40: 6629 2829 0a20 2020 2020 2020 2066 6f72  f)().        for
+00050d50: 206e 616d 652c 2064 6120 696e 2073 656c   name, da in sel
+00050d60: 662e 6461 7461 5f76 6172 732e 6974 656d  f.data_vars.item
+00050d70: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00050d80: 2069 6620 6e61 6d65 2069 7320 5f54 4849   if name is _THI
+00050d90: 535f 4152 5241 593a 0a20 2020 2020 2020  S_ARRAY:.       
+00050da0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+00050db0: 2222 0a20 2020 2020 2020 2020 2020 2065  "".            e
+00050dc0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00050dd0: 2020 2020 206e 616d 6520 3d20 6622 7b73       name = f"{s
+00050de0: 7472 286e 616d 6529 7d5f 220a 0a20 2020  tr(name)}_"..   
+00050df0: 2020 2020 2020 2020 2070 6f70 742c 2070           popt, p
+00050e00: 636f 7620 3d20 6170 706c 795f 7566 756e  cov = apply_ufun
+00050e10: 6328 0a20 2020 2020 2020 2020 2020 2020  c(.             
+00050e20: 2020 205f 7772 6170 7065 722c 0a20 2020     _wrapper,.   
+00050e30: 2020 2020 2020 2020 2020 2020 2064 612c               da,
+00050e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050e50: 202a 636f 6f72 6473 5f2c 0a20 2020 2020   *coords_,.     
+00050e60: 2020 2020 2020 2020 2020 2076 6563 746f             vecto
+00050e70: 7269 7a65 3d54 7275 652c 0a20 2020 2020  rize=True,.     
+00050e80: 2020 2020 2020 2020 2020 2064 6173 6b3d             dask=
+00050e90: 2270 6172 616c 6c65 6c69 7a65 6422 2c0a  "parallelized",.
+00050ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050eb0: 696e 7075 745f 636f 7265 5f64 696d 733d  input_core_dims=
+00050ec0: 5b72 6564 7563 655f 6469 6d73 5f20 666f  [reduce_dims_ fo
+00050ed0: 7220 6420 696e 2072 616e 6765 286c 656e  r d in range(len
+00050ee0: 2863 6f6f 7264 735f 2920 2b20 3129 5d2c  (coords_) + 1)],
+00050ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050f00: 206f 7574 7075 745f 636f 7265 5f64 696d   output_core_dim
+00050f10: 733d 5b5b 2270 6172 616d 225d 2c20 5b22  s=[["param"], ["
+00050f20: 636f 765f 6922 2c20 2263 6f76 5f6a 225d  cov_i", "cov_j"]
+00050f30: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00050f40: 2020 2064 6173 6b5f 6775 6675 6e63 5f6b     dask_gufunc_k
+00050f50: 7761 7267 733d 7b0a 2020 2020 2020 2020  wargs={.        
+00050f60: 2020 2020 2020 2020 2020 2020 226f 7574              "out
+00050f70: 7075 745f 7369 7a65 7322 3a20 7b0a 2020  put_sizes": {.  
+00050f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050f90: 2020 2020 2020 2270 6172 616d 223a 206e        "param": n
+00050fa0: 5f70 6172 616d 732c 0a20 2020 2020 2020  _params,.       
+00050fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050fc0: 2022 636f 765f 6922 3a20 6e5f 7061 7261   "cov_i": n_para
+00050fd0: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
+00050fe0: 2020 2020 2020 2020 2020 2020 2263 6f76              "cov
+00050ff0: 5f6a 223a 206e 5f70 6172 616d 732c 0a20  _j": n_params,. 
+00051000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051010: 2020 207d 2c0a 2020 2020 2020 2020 2020     },.          
+00051020: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
+00051030: 2020 2020 2020 2020 206f 7574 7075 745f           output_
+00051040: 6474 7970 6573 3d28 6e70 2e66 6c6f 6174  dtypes=(np.float
+00051050: 3634 2c20 6e70 2e66 6c6f 6174 3634 292c  64, np.float64),
+00051060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051070: 2065 7863 6c75 6465 5f64 696d 733d 7365   exclude_dims=se
+00051080: 7428 7265 6475 6365 5f64 696d 735f 292c  t(reduce_dims_),
+00051090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000510a0: 206b 7761 7267 733d 6b77 6172 6773 2c0a   kwargs=kwargs,.
+000510b0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000510c0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+000510d0: 5b6e 616d 6520 2b20 2263 7572 7665 6669  [name + "curvefi
+000510e0: 745f 636f 6566 6669 6369 656e 7473 225d  t_coefficients"]
+000510f0: 203d 2070 6f70 740a 2020 2020 2020 2020   = popt.        
+00051100: 2020 2020 7265 7375 6c74 5b6e 616d 6520      result[name 
+00051110: 2b20 2263 7572 7665 6669 745f 636f 7661  + "curvefit_cova
+00051120: 7269 616e 6365 225d 203d 2070 636f 760a  riance"] = pcov.
+00051130: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
+00051140: 3d20 7265 7375 6c74 2e61 7373 6967 6e5f  = result.assign_
+00051150: 636f 6f72 6473 280a 2020 2020 2020 2020  coords(.        
+00051160: 2020 2020 7b22 7061 7261 6d22 3a20 7061      {"param": pa
+00051170: 7261 6d73 2c20 2263 6f76 5f69 223a 2070  rams, "cov_i": p
+00051180: 6172 616d 732c 2022 636f 765f 6a22 3a20  arams, "cov_j": 
+00051190: 7061 7261 6d73 7d0a 2020 2020 2020 2020  params}.        
+000511a0: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
+000511b0: 2e61 7474 7273 203d 2073 656c 662e 6174  .attrs = self.at
+000511c0: 7472 732e 636f 7079 2829 0a0a 2020 2020  trs.copy()..    
+000511d0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+000511e0: 740a 0a20 2020 2064 6566 2064 726f 705f  t..    def drop_
+000511f0: 6475 706c 6963 6174 6573 280a 2020 2020  duplicates(.    
+00051200: 2020 2020 7365 6c66 3a20 545f 4461 7461      self: T_Data
+00051210: 7365 742c 0a20 2020 2020 2020 2064 696d  set,.        dim
+00051220: 3a20 4861 7368 6162 6c65 207c 2049 7465  : Hashable | Ite
+00051230: 7261 626c 655b 4861 7368 6162 6c65 5d2c  rable[Hashable],
+00051240: 0a20 2020 2020 2020 206b 6565 703a 204c  .        keep: L
+00051250: 6974 6572 616c 5b22 6669 7273 7422 2c20  iteral["first", 
+00051260: 226c 6173 7422 2c20 4661 6c73 655d 203d  "last", False] =
+00051270: 2022 6669 7273 7422 2c0a 2020 2020 2920   "first",.    ) 
+00051280: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+00051290: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+000512a0: 2061 206e 6577 2044 6174 6173 6574 2077   a new Dataset w
+000512b0: 6974 6820 6475 706c 6963 6174 6520 6469  ith duplicate di
+000512c0: 6d65 6e73 696f 6e20 7661 6c75 6573 2072  mension values r
+000512d0: 656d 6f76 6564 2e0a 0a20 2020 2020 2020  emoved...       
+000512e0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+000512f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00051300: 2020 2020 2020 2064 696d 203a 2064 696d         dim : dim
+00051310: 656e 7369 6f6e 206c 6162 656c 206f 7220  ension label or 
+00051320: 6c61 6265 6c73 0a20 2020 2020 2020 2020  labels.         
+00051330: 2020 2050 6173 7320 602e 2e2e 6020 746f     Pass `...` to
+00051340: 2064 726f 7020 6475 706c 6963 6174 6573   drop duplicates
+00051350: 2061 6c6f 6e67 2061 6c6c 2064 696d 656e   along all dimen
+00051360: 7369 6f6e 732e 0a20 2020 2020 2020 206b  sions..        k
+00051370: 6565 7020 3a20 7b22 6669 7273 7422 2c20  eep : {"first", 
+00051380: 226c 6173 7422 2c20 4661 6c73 657d 2c20  "last", False}, 
+00051390: 6465 6661 756c 743a 2022 6669 7273 7422  default: "first"
+000513a0: 0a20 2020 2020 2020 2020 2020 2044 6574  .            Det
+000513b0: 6572 6d69 6e65 7320 7768 6963 6820 6475  ermines which du
+000513c0: 706c 6963 6174 6573 2028 6966 2061 6e79  plicates (if any
+000513d0: 2920 746f 206b 6565 702e 0a20 2020 2020  ) to keep..     
+000513e0: 2020 2020 2020 202d 2060 6022 6669 7273         - ``"firs
+000513f0: 7422 6060 203a 2044 726f 7020 6475 706c  t"`` : Drop dupl
+00051400: 6963 6174 6573 2065 7863 6570 7420 666f  icates except fo
+00051410: 7220 7468 6520 6669 7273 7420 6f63 6375  r the first occu
+00051420: 7272 656e 6365 2e0a 2020 2020 2020 2020  rrence..        
+00051430: 2020 2020 2d20 6060 226c 6173 7422 6060      - ``"last"``
+00051440: 203a 2044 726f 7020 6475 706c 6963 6174   : Drop duplicat
+00051450: 6573 2065 7863 6570 7420 666f 7220 7468  es except for th
+00051460: 6520 6c61 7374 206f 6363 7572 7265 6e63  e last occurrenc
+00051470: 652e 0a20 2020 2020 2020 2020 2020 202d  e..            -
+00051480: 2046 616c 7365 203a 2044 726f 7020 616c   False : Drop al
+00051490: 6c20 6475 706c 6963 6174 6573 2e0a 0a20  l duplicates... 
+000514a0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+000514b0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+000514c0: 2020 2020 2020 2044 6174 6173 6574 0a0a         Dataset..
+000514d0: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+000514e0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000514f0: 2d0a 2020 2020 2020 2020 4461 7461 4172  -.        DataAr
+00051500: 7261 792e 6472 6f70 5f64 7570 6c69 6361  ray.drop_duplica
+00051510: 7465 730a 2020 2020 2020 2020 2222 220a  tes.        """.
+00051520: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00051530: 7461 6e63 6528 6469 6d2c 2073 7472 293a  tance(dim, str):
+00051540: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+00051550: 733a 2049 7465 7261 626c 6520 3d20 2864  s: Iterable = (d
+00051560: 696d 2c29 0a20 2020 2020 2020 2065 6c69  im,).        eli
+00051570: 6620 6469 6d20 6973 202e 2e2e 3a0a 2020  f dim is ...:.  
+00051580: 2020 2020 2020 2020 2020 6469 6d73 203d            dims =
+00051590: 2073 656c 662e 6469 6d73 0a20 2020 2020   self.dims.     
+000515a0: 2020 2065 6c69 6620 6e6f 7420 6973 696e     elif not isin
+000515b0: 7374 616e 6365 2864 696d 2c20 4974 6572  stance(dim, Iter
+000515c0: 6162 6c65 293a 0a20 2020 2020 2020 2020  able):.         
+000515d0: 2020 2064 696d 7320 3d20 5b64 696d 5d0a     dims = [dim].
+000515e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000515f0: 2020 2020 2020 2020 2020 6469 6d73 203d            dims =
+00051600: 2064 696d 0a0a 2020 2020 2020 2020 6d69   dim..        mi
+00051610: 7373 696e 675f 6469 6d73 203d 2073 6574  ssing_dims = set
+00051620: 2864 696d 7329 202d 2073 6574 2873 656c  (dims) - set(sel
+00051630: 662e 6469 6d73 290a 2020 2020 2020 2020  f.dims).        
+00051640: 6966 206d 6973 7369 6e67 5f64 696d 733a  if missing_dims:
+00051650: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00051660: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
+00051670: 277b 6d69 7373 696e 675f 6469 6d73 7d27  '{missing_dims}'
+00051680: 206e 6f74 2066 6f75 6e64 2069 6e20 6469   not found in di
+00051690: 6d65 6e73 696f 6e73 2229 0a0a 2020 2020  mensions")..    
+000516a0: 2020 2020 696e 6465 7865 7320 3d20 7b64      indexes = {d
+000516b0: 696d 3a20 7e73 656c 662e 6765 745f 696e  im: ~self.get_in
+000516c0: 6465 7828 6469 6d29 2e64 7570 6c69 6361  dex(dim).duplica
+000516d0: 7465 6428 6b65 6570 3d6b 6565 7029 2066  ted(keep=keep) f
+000516e0: 6f72 2064 696d 2069 6e20 6469 6d73 7d0a  or dim in dims}.
+000516f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00051700: 656c 662e 6973 656c 2869 6e64 6578 6573  elf.isel(indexes
+00051710: 290a 0a20 2020 2064 6566 2063 6f6e 7665  )..    def conve
+00051720: 7274 5f63 616c 656e 6461 7228 0a20 2020  rt_calendar(.   
+00051730: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
+00051740: 6173 6574 2c0a 2020 2020 2020 2020 6361  aset,.        ca
+00051750: 6c65 6e64 6172 3a20 4346 4361 6c65 6e64  lendar: CFCalend
+00051760: 6172 2c0a 2020 2020 2020 2020 6469 6d3a  ar,.        dim:
+00051770: 2048 6173 6861 626c 6520 3d20 2274 696d   Hashable = "tim
+00051780: 6522 2c0a 2020 2020 2020 2020 616c 6967  e",.        alig
+00051790: 6e5f 6f6e 3a20 4c69 7465 7261 6c5b 2264  n_on: Literal["d
+000517a0: 6174 6522 2c20 2279 6561 7222 2c20 4e6f  ate", "year", No
+000517b0: 6e65 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ne] = None,.    
+000517c0: 2020 2020 6d69 7373 696e 673a 2041 6e79      missing: Any
+000517d0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+000517e0: 2020 2020 2020 2020 7573 655f 6366 7469          use_cfti
+000517f0: 6d65 3a20 626f 6f6c 207c 204e 6f6e 6520  me: bool | None 
+00051800: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
+00051810: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
+00051820: 2020 2020 2222 2243 6f6e 7665 7274 2074      """Convert t
+00051830: 6865 2044 6174 6173 6574 2074 6f20 616e  he Dataset to an
+00051840: 6f74 6865 7220 6361 6c65 6e64 6172 2e0a  other calendar..
+00051850: 0a20 2020 2020 2020 204f 6e6c 7920 636f  .        Only co
+00051860: 6e76 6572 7473 2074 6865 2069 6e64 6976  nverts the indiv
+00051870: 6964 7561 6c20 7469 6d65 7374 616d 7073  idual timestamps
+00051880: 2c20 646f 6573 206e 6f74 206d 6f64 6966  , does not modif
+00051890: 7920 616e 7920 6461 7461 2065 7863 6570  y any data excep
+000518a0: 740a 2020 2020 2020 2020 696e 2064 726f  t.        in dro
+000518b0: 7070 696e 6720 696e 7661 6c69 642f 7375  pping invalid/su
+000518c0: 7270 6c75 7320 6461 7465 7320 6f72 2069  rplus dates or i
+000518d0: 6e73 6572 7469 6e67 206d 6973 7369 6e67  nserting missing
+000518e0: 2064 6174 6573 2e0a 0a20 2020 2020 2020   dates...       
+000518f0: 2049 6620 7468 6520 736f 7572 6365 2061   If the source a
+00051900: 6e64 2074 6172 6765 7420 6361 6c65 6e64  nd target calend
+00051910: 6172 7320 6172 6520 6569 7468 6572 206e  ars are either n
+00051920: 6f5f 6c65 6170 2c20 616c 6c5f 6c65 6170  o_leap, all_leap
+00051930: 206f 7220 610a 2020 2020 2020 2020 7374   or a.        st
+00051940: 616e 6461 7264 2074 7970 652c 206f 6e6c  andard type, onl
+00051950: 7920 7468 6520 7479 7065 206f 6620 7468  y the type of th
+00051960: 6520 7469 6d65 2061 7272 6179 2069 7320  e time array is 
+00051970: 6d6f 6469 6669 6564 2e0a 2020 2020 2020  modified..      
+00051980: 2020 5768 656e 2063 6f6e 7665 7274 696e    When convertin
+00051990: 6720 746f 2061 206c 6561 7020 7965 6172  g to a leap year
+000519a0: 2066 726f 6d20 6120 6e6f 6e2d 6c65 6170   from a non-leap
+000519b0: 2079 6561 722c 2074 6865 2032 3974 6820   year, the 29th 
+000519c0: 6f66 2046 6562 7275 6172 790a 2020 2020  of February.    
+000519d0: 2020 2020 6973 2072 656d 6f76 6564 2066      is removed f
+000519e0: 726f 6d20 7468 6520 6172 7261 792e 2049  rom the array. I
+000519f0: 6e20 7468 6520 6f74 6865 7220 6469 7265  n the other dire
+00051a00: 6374 696f 6e20 7468 6520 3239 7468 206f  ction the 29th o
+00051a10: 6620 4665 6272 7561 7279 0a20 2020 2020  f February.     
+00051a20: 2020 2077 696c 6c20 6265 206d 6973 7369     will be missi
+00051a30: 6e67 2069 6e20 7468 6520 6f75 7470 7574  ng in the output
+00051a40: 2c20 756e 6c65 7373 2060 6d69 7373 696e  , unless `missin
+00051a50: 6760 2069 7320 7370 6563 6966 6965 642c  g` is specified,
+00051a60: 0a20 2020 2020 2020 2069 6e20 7768 6963  .        in whic
+00051a70: 6820 6361 7365 2074 6861 7420 7661 6c75  h case that valu
+00051a80: 6520 6973 2069 6e73 6572 7465 642e 0a0a  e is inserted...
+00051a90: 2020 2020 2020 2020 466f 7220 636f 6e76          For conv
+00051aa0: 6572 7369 6f6e 7320 696e 766f 6c76 696e  ersions involvin
+00051ab0: 6720 6033 3630 5f64 6179 6020 6361 6c65  g `360_day` cale
+00051ac0: 6e64 6172 732c 2073 6565 204e 6f74 6573  ndars, see Notes
+00051ad0: 2e0a 0a20 2020 2020 2020 2054 6869 7320  ...        This 
+00051ae0: 6d65 7468 6f64 2069 7320 7361 6665 2074  method is safe t
+00051af0: 6f20 7573 6520 7769 7468 2073 7562 2d64  o use with sub-d
+00051b00: 6169 6c79 2064 6174 6120 6173 2069 7420  aily data as it 
+00051b10: 646f 6573 6e27 7420 746f 7563 6820 7468  doesn't touch th
+00051b20: 650a 2020 2020 2020 2020 7469 6d65 2070  e.        time p
+00051b30: 6172 7420 6f66 2074 6865 2074 696d 6573  art of the times
+00051b40: 7461 6d70 732e 0a0a 2020 2020 2020 2020  tamps...        
+00051b50: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00051b60: 2020 202d 2d2d 2d2d 2d2d 2d2d 0a20 2020     ---------.   
+00051b70: 2020 2020 2063 616c 656e 6461 7220 3a20       calendar : 
+00051b80: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
+00051b90: 5468 6520 7461 7267 6574 2063 616c 656e  The target calen
+00051ba0: 6461 7220 6e61 6d65 2e0a 2020 2020 2020  dar name..      
+00051bb0: 2020 6469 6d20 3a20 4861 7368 6162 6c65    dim : Hashable
+00051bc0: 2c20 6465 6661 756c 743a 2022 7469 6d65  , default: "time
+00051bd0: 220a 2020 2020 2020 2020 2020 2020 4e61  ".            Na
+00051be0: 6d65 206f 6620 7468 6520 7469 6d65 2063  me of the time c
+00051bf0: 6f6f 7264 696e 6174 652e 0a20 2020 2020  oordinate..     
+00051c00: 2020 2061 6c69 676e 5f6f 6e20 3a20 7b4e     align_on : {N
+00051c10: 6f6e 652c 2027 6461 7465 272c 2027 7965  one, 'date', 'ye
+00051c20: 6172 277d 2c20 6f70 7469 6f6e 616c 0a20  ar'}, optional. 
+00051c30: 2020 2020 2020 2020 2020 204d 7573 7420             Must 
+00051c40: 6265 2073 7065 6369 6669 6564 2077 6865  be specified whe
+00051c50: 6e20 6569 7468 6572 2073 6f75 7263 6520  n either source 
+00051c60: 6f72 2074 6172 6765 7420 6973 2061 2060  or target is a `
+00051c70: 3336 305f 6461 7960 2063 616c 656e 6461  360_day` calenda
+00051c80: 722c 0a20 2020 2020 2020 2020 2020 2069  r,.            i
+00051c90: 676e 6f72 6564 206f 7468 6572 7769 7365  gnored otherwise
+00051ca0: 2e20 5365 6520 4e6f 7465 732e 0a20 2020  . See Notes..   
+00051cb0: 2020 2020 206d 6973 7369 6e67 203a 2041       missing : A
+00051cc0: 6e79 206f 7220 4e6f 6e65 2c20 6f70 7469  ny or None, opti
+00051cd0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00051ce0: 2042 7920 6465 6661 756c 742c 2069 2e65   By default, i.e
+00051cf0: 2e20 6966 2074 6865 2076 616c 7565 2069  . if the value i
+00051d00: 7320 4e6f 6e65 2c20 7468 6973 206d 6574  s None, this met
+00051d10: 686f 6420 7769 6c6c 2073 696d 706c 7920  hod will simply 
+00051d20: 6174 7465 6d70 740a 2020 2020 2020 2020  attempt.        
+00051d30: 2020 2020 746f 2063 6f6e 7665 7274 2074      to convert t
+00051d40: 6865 2064 6174 6573 2069 6e20 7468 6520  he dates in the 
+00051d50: 736f 7572 6365 2063 616c 656e 6461 7220  source calendar 
+00051d60: 746f 2074 6865 2073 616d 6520 6461 7465  to the same date
+00051d70: 7320 696e 2074 6865 0a20 2020 2020 2020  s in the.       
+00051d80: 2020 2020 2074 6172 6765 7420 6361 6c65       target cale
+00051d90: 6e64 6172 2c20 616e 6420 6472 6f70 2061  ndar, and drop a
+00051da0: 6e79 206f 6620 7468 6f73 6520 7468 6174  ny of those that
+00051db0: 2061 7265 206e 6f74 2070 6f73 7369 626c   are not possibl
+00051dc0: 6520 746f 0a20 2020 2020 2020 2020 2020  e to.           
+00051dd0: 2072 6570 7265 7365 6e74 2e20 2049 6620   represent.  If 
+00051de0: 6120 7661 6c75 6520 6973 2070 726f 7669  a value is provi
+00051df0: 6465 642c 2061 206e 6577 2074 696d 6520  ded, a new time 
+00051e00: 636f 6f72 6469 6e61 7465 2077 696c 6c20  coordinate will 
+00051e10: 6265 0a20 2020 2020 2020 2020 2020 2063  be.            c
+00051e20: 7265 6174 6564 2069 6e20 7468 6520 7461  reated in the ta
+00051e30: 7267 6574 2063 616c 656e 6461 7220 7769  rget calendar wi
+00051e40: 7468 2074 6865 2073 616d 6520 6672 6571  th the same freq
+00051e50: 7565 6e63 7920 6173 2074 6865 206f 7269  uency as the ori
+00051e60: 6769 6e61 6c0a 2020 2020 2020 2020 2020  ginal.          
+00051e70: 2020 7469 6d65 2063 6f6f 7264 696e 6174    time coordinat
+00051e80: 653b 2066 6f72 2061 6e79 2064 6174 6573  e; for any dates
+00051e90: 2074 6861 7420 6172 6520 6e6f 7420 7072   that are not pr
+00051ea0: 6573 656e 7420 696e 2074 6865 2073 6f75  esent in the sou
+00051eb0: 7263 652c 2074 6865 0a20 2020 2020 2020  rce, the.       
+00051ec0: 2020 2020 2064 6174 6120 7769 6c6c 2062       data will b
+00051ed0: 6520 6669 6c6c 6564 2077 6974 6820 7468  e filled with th
+00051ee0: 6973 2076 616c 7565 2e20 204e 6f74 6520  is value.  Note 
+00051ef0: 7468 6174 2075 7369 6e67 2074 6869 7320  that using this 
+00051f00: 6d6f 6465 2072 6571 7569 7265 730a 2020  mode requires.  
+00051f10: 2020 2020 2020 2020 2020 7468 6174 2074            that t
+00051f20: 6865 2073 6f75 7263 6520 6461 7461 2068  he source data h
+00051f30: 6176 6520 616e 2069 6e66 6572 6162 6c65  ave an inferable
+00051f40: 2066 7265 7175 656e 6379 3b20 666f 7220   frequency; for 
+00051f50: 6d6f 7265 2069 6e66 6f72 6d61 7469 6f6e  more information
+00051f60: 0a20 2020 2020 2020 2020 2020 2073 6565  .            see
+00051f70: 203a 7079 3a66 756e 633a 6078 6172 7261   :py:func:`xarra
+00051f80: 792e 696e 6665 725f 6672 6571 602e 2020  y.infer_freq`.  
+00051f90: 466f 7220 6365 7274 6169 6e20 6672 6571  For certain freq
+00051fa0: 7565 6e63 792c 2073 6f75 7263 652c 2061  uency, source, a
+00051fb0: 6e64 0a20 2020 2020 2020 2020 2020 2074  nd.            t
+00051fc0: 6172 6765 7420 6361 6c65 6e64 6172 2063  arget calendar c
+00051fd0: 6f6d 6269 6e61 7469 6f6e 732c 2074 6869  ombinations, thi
+00051fe0: 7320 636f 756c 6420 7265 7375 6c74 2069  s could result i
+00051ff0: 6e20 6d61 6e79 206d 6973 7369 6e67 2076  n many missing v
+00052000: 616c 7565 732c 2073 6565 206e 6f74 6573  alues, see notes
+00052010: 2e0a 2020 2020 2020 2020 7573 655f 6366  ..        use_cf
+00052020: 7469 6d65 203a 2062 6f6f 6c20 6f72 204e  time : bool or N
+00052030: 6f6e 652c 206f 7074 696f 6e61 6c0a 2020  one, optional.  
+00052040: 2020 2020 2020 2020 2020 5768 6574 6865            Whethe
+00052050: 7220 746f 2075 7365 2063 6674 696d 6520  r to use cftime 
+00052060: 6f62 6a65 6374 7320 696e 2074 6865 206f  objects in the o
+00052070: 7574 7075 742c 206f 6e6c 7920 7573 6564  utput, only used
+00052080: 2069 6620 6063 616c 656e 6461 7260 0a20   if `calendar`. 
+00052090: 2020 2020 2020 2020 2020 2069 7320 6f6e             is on
+000520a0: 6520 6f66 207b 2270 726f 6c65 7074 6963  e of {"proleptic
+000520b0: 5f67 7265 676f 7269 616e 222c 2022 6772  _gregorian", "gr
+000520c0: 6567 6f72 6961 6e22 206f 7220 2273 7461  egorian" or "sta
+000520d0: 6e64 6172 6422 7d2e 0a20 2020 2020 2020  ndard"}..       
+000520e0: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
+000520f0: 6520 6e65 7720 7469 6d65 2061 7869 7320  e new time axis 
+00052100: 7573 6573 2063 6674 696d 6520 6f62 6a65  uses cftime obje
+00052110: 6374 732e 0a20 2020 2020 2020 2020 2020  cts..           
+00052120: 2049 6620 4e6f 6e65 2028 6465 6661 756c   If None (defaul
+00052130: 7429 2c20 6974 2075 7365 7320 3a70 793a  t), it uses :py:
+00052140: 636c 6173 733a 606e 756d 7079 2e64 6174  class:`numpy.dat
+00052150: 6574 696d 6536 3460 2076 616c 7565 7320  etime64` values 
+00052160: 6966 2074 6865 0a20 2020 2020 2020 2020  if the.         
+00052170: 2020 2064 6174 6520 7261 6e67 6520 7065     date range pe
+00052180: 726d 6974 7320 6974 2c20 616e 6420 3a70  rmits it, and :p
+00052190: 793a 636c 6173 733a 6063 6674 696d 652e  y:class:`cftime.
+000521a0: 6461 7465 7469 6d65 6020 6f62 6a65 6374  datetime` object
+000521b0: 7320 6966 206e 6f74 2e0a 2020 2020 2020  s if not..      
+000521c0: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
+000521d0: 6974 2075 7365 7320 3a70 793a 636c 6173  it uses :py:clas
+000521e0: 733a 606e 756d 7079 2e64 6174 6574 696d  s:`numpy.datetim
+000521f0: 6536 3460 2020 6f72 2066 6169 6c73 2e0a  e64`  or fails..
+00052200: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00052210: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00052220: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+00052230: 0a20 2020 2020 2020 2020 2020 2043 6f70  .            Cop
+00052240: 7920 6f66 2074 6865 2064 6174 6161 7272  y of the dataarr
+00052250: 6179 2077 6974 6820 7468 6520 7469 6d65  ay with the time
+00052260: 2063 6f6f 7264 696e 6174 6520 636f 6e76   coordinate conv
+00052270: 6572 7465 6420 746f 2074 6865 0a20 2020  erted to the.   
+00052280: 2020 2020 2020 2020 2074 6172 6765 7420           target 
+00052290: 6361 6c65 6e64 6172 2e20 4966 2027 6d69  calendar. If 'mi
+000522a0: 7373 696e 6727 2077 6173 204e 6f6e 6520  ssing' was None 
+000522b0: 2864 6566 6175 6c74 292c 2069 6e76 616c  (default), inval
+000522c0: 6964 2064 6174 6573 2069 6e0a 2020 2020  id dates in.    
+000522d0: 2020 2020 2020 2020 7468 6520 6e65 7720          the new 
+000522e0: 6361 6c65 6e64 6172 2061 7265 2064 726f  calendar are dro
+000522f0: 7070 6564 2c20 6275 7420 6d69 7373 696e  pped, but missin
+00052300: 6720 6461 7465 7320 6172 6520 6e6f 7420  g dates are not 
+00052310: 696e 7365 7274 6564 2e0a 2020 2020 2020  inserted..      
+00052320: 2020 2020 2020 4966 2060 6d69 7373 696e        If `missin
+00052330: 6760 2077 6173 2067 6976 656e 2c20 7468  g` was given, th
+00052340: 6520 6e65 7720 6461 7461 2069 7320 7265  e new data is re
+00052350: 696e 6465 7865 6420 746f 2068 6176 6520  indexed to have 
+00052360: 6120 7469 6d65 2061 7869 730a 2020 2020  a time axis.    
+00052370: 2020 2020 2020 2020 7769 7468 2074 6865          with the
+00052380: 2073 616d 6520 6672 6571 7565 6e63 7920   same frequency 
+00052390: 6173 2074 6865 2073 6f75 7263 652c 2062  as the source, b
+000523a0: 7574 2069 6e20 7468 6520 6e65 7720 6361  ut in the new ca
+000523b0: 6c65 6e64 6172 3b20 616e 790a 2020 2020  lendar; any.    
+000523c0: 2020 2020 2020 2020 6d69 7373 696e 6720          missing 
+000523d0: 6461 7461 706f 696e 7473 2061 7265 2066  datapoints are f
+000523e0: 696c 6c65 6420 7769 7468 2060 6d69 7373  illed with `miss
+000523f0: 696e 6760 2e0a 0a20 2020 2020 2020 204e  ing`...        N
+00052400: 6f74 6573 0a20 2020 2020 2020 202d 2d2d  otes.        ---
+00052410: 2d2d 0a20 2020 2020 2020 2050 6173 7369  --.        Passi
+00052420: 6e67 2061 2076 616c 7565 2074 6f20 606d  ng a value to `m
+00052430: 6973 7369 6e67 6020 6973 206f 6e6c 7920  issing` is only 
+00052440: 7573 6162 6c65 2069 6620 7468 6520 736f  usable if the so
+00052450: 7572 6365 2773 2074 696d 6520 636f 6f72  urce's time coor
+00052460: 6469 6e61 7465 2061 7320 616e 0a20 2020  dinate as an.   
+00052470: 2020 2020 2069 6e66 6572 6162 6c65 2066       inferable f
+00052480: 7265 7175 656e 6369 6573 2028 7365 6520  requencies (see 
+00052490: 3a70 793a 6675 6e63 3a60 7e78 6172 7261  :py:func:`~xarra
+000524a0: 792e 696e 6665 725f 6672 6571 6029 2061  y.infer_freq`) a
+000524b0: 6e64 2069 7320 6f6e 6c79 2061 7070 726f  nd is only appro
+000524c0: 7072 6961 7465 0a20 2020 2020 2020 2069  priate.        i
+000524d0: 6620 7468 6520 7461 7267 6574 2063 6f6f  f the target coo
+000524e0: 7264 696e 6174 652c 2067 656e 6572 6174  rdinate, generat
+000524f0: 6564 2066 726f 6d20 7468 6973 2066 7265  ed from this fre
+00052500: 7175 656e 6379 2c20 6861 7320 6461 7465  quency, has date
+00052510: 7320 6571 7569 7661 6c65 6e74 2074 6f20  s equivalent to 
+00052520: 7468 650a 2020 2020 2020 2020 736f 7572  the.        sour
+00052530: 6365 2e20 4974 2069 7320 7573 7561 6c6c  ce. It is usuall
+00052540: 7920 2a2a 6e6f 742a 2a20 6170 7072 6f70  y **not** approp
+00052550: 7269 6174 6520 746f 2075 7365 2074 6869  riate to use thi
+00052560: 7320 6d6f 6465 2077 6974 683a 0a0a 2020  s mode with:..  
+00052570: 2020 2020 2020 2d20 5065 7269 6f64 2d65        - Period-e
+00052580: 6e64 2066 7265 7175 656e 6369 6573 203a  nd frequencies :
+00052590: 2027 4127 2c20 2759 272c 2027 5127 206f   'A', 'Y', 'Q' o
+000525a0: 7220 274d 272c 2069 6e20 6f70 706f 7369  r 'M', in opposi
+000525b0: 7469 6f6e 2074 6f20 2741 5327 2027 5953  tion to 'AS' 'YS
+000525c0: 272c 2027 5153 2720 616e 6420 274d 5327  ', 'QS' and 'MS'
+000525d0: 0a20 2020 2020 2020 202d 2053 7562 2d6d  .        - Sub-m
+000525e0: 6f6e 7468 6c79 2066 7265 7175 656e 6369  onthly frequenci
+000525f0: 6573 2074 6861 7420 646f 206e 6f74 2064  es that do not d
+00052600: 6976 6964 6520 6120 6461 7920 6576 656e  ivide a day even
+00052610: 6c79 203a 2027 5727 2c20 276e 4427 2077  ly : 'W', 'nD' w
+00052620: 6865 7265 2060 4e20 213d 2031 600a 2020  here `N != 1`.  
+00052630: 2020 2020 2020 2020 2020 6f72 2027 6d48            or 'mH
+00052640: 2720 7768 6572 6520 3234 2025 206d 2021  ' where 24 % m !
+00052650: 3d20 3029 2e0a 0a20 2020 2020 2020 2049  = 0)...        I
+00052660: 6620 6f6e 6520 6f66 2074 6865 2073 6f75  f one of the sou
+00052670: 7263 6520 6f72 2074 6172 6765 7420 6361  rce or target ca
+00052680: 6c65 6e64 6172 7320 6973 2060 2233 3630  lendars is `"360
+00052690: 5f64 6179 2260 2c20 6061 6c69 676e 5f6f  _day"`, `align_o
+000526a0: 6e60 206d 7573 740a 2020 2020 2020 2020  n` must.        
+000526b0: 6265 2073 7065 6369 6669 6564 2061 6e64  be specified and
+000526c0: 2074 776f 206f 7074 696f 6e73 2061 7265   two options are
+000526d0: 206f 6666 6572 6564 2e0a 0a20 2020 2020   offered...     
+000526e0: 2020 202d 2022 7965 6172 220a 2020 2020     - "year".    
+000526f0: 2020 2020 2020 2020 5468 6520 6461 7465          The date
+00052700: 7320 6172 6520 7472 616e 736c 6174 6564  s are translated
+00052710: 2061 6363 6f72 6469 6e67 2074 6f20 7468   according to th
+00052720: 6569 7220 7265 6c61 7469 7665 2070 6f73  eir relative pos
+00052730: 6974 696f 6e20 696e 2074 6865 2079 6561  ition in the yea
+00052740: 722c 0a20 2020 2020 2020 2020 2020 2069  r,.            i
+00052750: 676e 6f72 696e 6720 7468 6569 7220 6f72  gnoring their or
+00052760: 6967 696e 616c 206d 6f6e 7468 2061 6e64  iginal month and
+00052770: 2064 6179 2069 6e66 6f72 6d61 7469 6f6e   day information
+00052780: 2c20 6d65 616e 696e 6720 7468 6174 2074  , meaning that t
+00052790: 6865 0a20 2020 2020 2020 2020 2020 206d  he.            m
+000527a0: 6973 7369 6e67 2f73 7572 706c 7573 2064  issing/surplus d
+000527b0: 6179 7320 6172 6520 6164 6465 642f 7265  ays are added/re
+000527c0: 6d6f 7665 6420 6174 2072 6567 756c 6172  moved at regular
+000527d0: 2069 6e74 6572 7661 6c73 2e0a 0a20 2020   intervals...   
+000527e0: 2020 2020 2020 2020 2046 726f 6d20 6120           From a 
+000527f0: 6033 3630 5f64 6179 6020 746f 2061 2073  `360_day` to a s
+00052800: 7461 6e64 6172 6420 6361 6c65 6e64 6172  tandard calendar
+00052810: 2c20 7468 6520 6f75 7470 7574 2077 696c  , the output wil
+00052820: 6c20 6265 206d 6973 7369 6e67 2074 6865  l be missing the
+00052830: 0a20 2020 2020 2020 2020 2020 2066 6f6c  .            fol
+00052840: 6c6f 7769 6e67 2064 6174 6573 2028 6461  lowing dates (da
+00052850: 7920 6f66 2079 6561 7220 696e 2070 6172  y of year in par
+00052860: 656e 7468 6573 6573 293a 0a0a 2020 2020  entheses):..    
+00052870: 2020 2020 2020 2020 546f 2061 206c 6561          To a lea
+00052880: 7020 7965 6172 3a0a 2020 2020 2020 2020  p year:.        
+00052890: 2020 2020 2020 2020 4a61 6e75 6172 7920          January 
+000528a0: 3331 7374 2028 3331 292c 204d 6172 6368  31st (31), March
+000528b0: 2033 3173 7420 2839 3129 2c20 4a75 6e65   31st (91), June
+000528c0: 2031 7374 2028 3135 3329 2c20 4a75 6c79   1st (153), July
+000528d0: 2033 3173 7420 2832 3133 292c 0a20 2020   31st (213),.   
+000528e0: 2020 2020 2020 2020 2020 2020 2053 6570               Sep
+000528f0: 7465 6d62 6572 2033 3173 7420 2832 3735  tember 31st (275
+00052900: 2920 616e 6420 4e6f 7665 6d62 6572 2033  ) and November 3
+00052910: 3074 6820 2833 3335 292e 0a20 2020 2020  0th (335)..     
+00052920: 2020 2020 2020 2054 6f20 6120 6e6f 6e2d         To a non-
+00052930: 6c65 6170 2079 6561 723a 0a20 2020 2020  leap year:.     
+00052940: 2020 2020 2020 2020 2020 2046 6562 7275             Febru
+00052950: 6172 7920 3674 6820 2833 3629 2c20 4170  ary 6th (36), Ap
+00052960: 7269 6c20 3139 7468 2028 3130 3929 2c20  ril 19th (109), 
+00052970: 4a75 6c79 2032 6e64 2028 3138 3329 2c0a  July 2nd (183),.
+00052980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052990: 5365 7074 656d 6265 7220 3132 7468 2028  September 12th (
+000529a0: 3235 3529 2c20 4e6f 7665 6d62 6572 2032  255), November 2
+000529b0: 3574 6820 2833 3239 292e 0a0a 2020 2020  5th (329)...    
+000529c0: 2020 2020 2020 2020 4672 6f6d 2061 2073          From a s
+000529d0: 7461 6e64 6172 6420 6361 6c65 6e64 6172  tandard calendar
+000529e0: 2074 6f20 6120 6022 3336 305f 6461 7922   to a `"360_day"
+000529f0: 602c 2074 6865 2066 6f6c 6c6f 7769 6e67  `, the following
+00052a00: 2064 6174 6573 2069 6e20 7468 650a 2020   dates in the.  
+00052a10: 2020 2020 2020 2020 2020 736f 7572 6365            source
+00052a20: 2061 7272 6179 2077 696c 6c20 6265 2064   array will be d
+00052a30: 726f 7070 6564 3a0a 0a20 2020 2020 2020  ropped:..       
+00052a40: 2020 2020 2046 726f 6d20 6120 6c65 6170       From a leap
+00052a50: 2079 6561 723a 0a20 2020 2020 2020 2020   year:.         
+00052a60: 2020 2020 2020 204a 616e 7561 7279 2033         January 3
+00052a70: 3173 7420 2833 3129 2c20 4170 7269 6c20  1st (31), April 
+00052a80: 3173 7420 2839 3229 2c20 4a75 6e65 2031  1st (92), June 1
+00052a90: 7374 2028 3135 3329 2c20 4175 6775 7374  st (153), August
+00052aa0: 2031 7374 2028 3231 3429 2c0a 2020 2020   1st (214),.    
+00052ab0: 2020 2020 2020 2020 2020 2020 5365 7074              Sept
+00052ac0: 656d 6265 7220 3331 7374 2028 3237 3529  ember 31st (275)
+00052ad0: 2c20 4465 6365 6d62 6572 2031 7374 2028  , December 1st (
+00052ae0: 3333 3629 0a20 2020 2020 2020 2020 2020  336).           
+00052af0: 2046 726f 6d20 6120 6e6f 6e2d 6c65 6170   From a non-leap
+00052b00: 2079 6561 723a 0a20 2020 2020 2020 2020   year:.         
+00052b10: 2020 2020 2020 2046 6562 7275 6172 7920         February 
+00052b20: 3674 6820 2833 3729 2c20 4170 7269 6c20  6th (37), April 
+00052b30: 3230 7468 2028 3131 3029 2c20 4a75 6c79  20th (110), July
+00052b40: 2032 6e64 2028 3138 3329 2c0a 2020 2020   2nd (183),.    
+00052b50: 2020 2020 2020 2020 2020 2020 5365 7074              Sept
+00052b60: 656d 6265 7220 3133 7468 2028 3235 3629  ember 13th (256)
+00052b70: 2c20 4e6f 7665 6d62 6572 2032 3574 6820  , November 25th 
+00052b80: 2833 3239 290a 0a20 2020 2020 2020 2020  (329)..         
+00052b90: 2020 2054 6869 7320 6f70 7469 6f6e 2069     This option i
+00052ba0: 7320 6265 7374 2075 7365 6420 6f6e 2064  s best used on d
+00052bb0: 6169 6c79 2061 6e64 2073 7562 6461 696c  aily and subdail
+00052bc0: 7920 6461 7461 2e0a 0a20 2020 2020 2020  y data...       
+00052bd0: 202d 2022 6461 7465 220a 2020 2020 2020   - "date".      
+00052be0: 2020 2020 2020 5468 6520 6d6f 6e74 682f        The month/
+00052bf0: 6461 7920 696e 666f 726d 6174 696f 6e20  day information 
+00052c00: 6973 2063 6f6e 7365 7276 6564 2061 6e64  is conserved and
+00052c10: 2069 6e76 616c 6964 2064 6174 6573 2061   invalid dates a
+00052c20: 7265 2064 726f 7070 6564 0a20 2020 2020  re dropped.     
+00052c30: 2020 2020 2020 2066 726f 6d20 7468 6520         from the 
+00052c40: 6f75 7470 7574 2e20 5468 6973 206d 6561  output. This mea
+00052c50: 6e73 2074 6861 7420 7768 656e 2063 6f6e  ns that when con
+00052c60: 7665 7274 696e 6720 6672 6f6d 2061 2060  verting from a `
+00052c70: 2233 3630 5f64 6179 2260 2074 6f20 610a  "360_day"` to a.
+00052c80: 2020 2020 2020 2020 2020 2020 7374 616e              stan
+00052c90: 6461 7264 2063 616c 656e 6461 722c 2061  dard calendar, a
+00052ca0: 6c6c 2033 3173 7420 284a 616e 2c20 4d61  ll 31st (Jan, Ma
+00052cb0: 7263 682c 204d 6179 2c20 4a75 6c79 2c20  rch, May, July, 
+00052cc0: 4175 6775 7374 2c20 4f63 746f 6265 7220  August, October 
+00052cd0: 616e 640a 2020 2020 2020 2020 2020 2020  and.            
+00052ce0: 4465 6365 6d62 6572 2920 7769 6c6c 2062  December) will b
+00052cf0: 6520 6d69 7373 696e 6720 6173 2074 6865  e missing as the
+00052d00: 7265 2069 7320 6e6f 2065 7175 6976 616c  re is no equival
+00052d10: 656e 7420 6461 7465 7320 696e 2074 6865  ent dates in the
+00052d20: 0a20 2020 2020 2020 2020 2020 2060 2233  .            `"3
+00052d30: 3630 5f64 6179 2260 2063 616c 656e 6461  60_day"` calenda
+00052d40: 7220 616e 6420 7468 6520 3239 7468 2028  r and the 29th (
+00052d50: 6f6e 206e 6f6e 2d6c 6561 7020 7965 6172  on non-leap year
+00052d60: 7329 2061 6e64 2033 3074 6820 6f66 2046  s) and 30th of F
+00052d70: 6562 7275 6172 790a 2020 2020 2020 2020  ebruary.        
+00052d80: 2020 2020 7769 6c6c 2062 6520 6472 6f70      will be drop
+00052d90: 7065 6420 6173 2074 6865 7265 2061 7265  ped as there are
+00052da0: 206e 6f20 6571 7569 7661 6c65 6e74 2064   no equivalent d
+00052db0: 6174 6573 2069 6e20 6120 7374 616e 6461  ates in a standa
+00052dc0: 7264 2063 616c 656e 6461 722e 0a0a 2020  rd calendar...  
+00052dd0: 2020 2020 2020 2020 2020 5468 6973 206f            This o
+00052de0: 7074 696f 6e20 6973 2062 6573 7420 7573  ption is best us
+00052df0: 6564 2077 6974 6820 6461 7461 206f 6e20  ed with data on 
+00052e00: 6120 6672 6571 7565 6e63 7920 636f 6172  a frequency coar
+00052e10: 7365 7220 7468 616e 2064 6169 6c79 2e0a  ser than daily..
+00052e20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00052e30: 2020 2020 7265 7475 726e 2063 6f6e 7665      return conve
+00052e40: 7274 5f63 616c 656e 6461 7228 0a20 2020  rt_calendar(.   
+00052e50: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
+00052e60: 2020 2020 2020 2020 2020 2063 616c 656e             calen
+00052e70: 6461 722c 0a20 2020 2020 2020 2020 2020  dar,.           
+00052e80: 2064 696d 3d64 696d 2c0a 2020 2020 2020   dim=dim,.      
+00052e90: 2020 2020 2020 616c 6967 6e5f 6f6e 3d61        align_on=a
+00052ea0: 6c69 676e 5f6f 6e2c 0a20 2020 2020 2020  lign_on,.       
+00052eb0: 2020 2020 206d 6973 7369 6e67 3d6d 6973       missing=mis
+00052ec0: 7369 6e67 2c0a 2020 2020 2020 2020 2020  sing,.          
+00052ed0: 2020 7573 655f 6366 7469 6d65 3d75 7365    use_cftime=use
+00052ee0: 5f63 6674 696d 652c 0a20 2020 2020 2020  _cftime,.       
+00052ef0: 2029 0a0a 2020 2020 6465 6620 696e 7465   )..    def inte
+00052f00: 7270 5f63 616c 656e 6461 7228 0a20 2020  rp_calendar(.   
+00052f10: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
+00052f20: 6173 6574 2c0a 2020 2020 2020 2020 7461  aset,.        ta
+00052f30: 7267 6574 3a20 7064 2e44 6174 6574 696d  rget: pd.Datetim
+00052f40: 6549 6e64 6578 207c 2043 4654 696d 6549  eIndex | CFTimeI
+00052f50: 6e64 6578 207c 2044 6174 6141 7272 6179  ndex | DataArray
+00052f60: 2c0a 2020 2020 2020 2020 6469 6d3a 2048  ,.        dim: H
+00052f70: 6173 6861 626c 6520 3d20 2274 696d 6522  ashable = "time"
+00052f80: 2c0a 2020 2020 2920 2d3e 2054 5f44 6174  ,.    ) -> T_Dat
+00052f90: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
+00052fa0: 2249 6e74 6572 706f 6c61 7465 7320 7468  "Interpolates th
+00052fb0: 6520 4461 7461 7365 7420 746f 2061 6e6f  e Dataset to ano
+00052fc0: 7468 6572 2063 616c 656e 6461 7220 6261  ther calendar ba
+00052fd0: 7365 6420 6f6e 2064 6563 696d 616c 2079  sed on decimal y
+00052fe0: 6561 7220 6d65 6173 7572 652e 0a0a 2020  ear measure...  
+00052ff0: 2020 2020 2020 4561 6368 2074 696d 6573        Each times
+00053000: 7461 6d70 2069 6e20 6073 6f75 7263 6560  tamp in `source`
+00053010: 2061 6e64 2060 7461 7267 6574 6020 6172   and `target` ar
+00053020: 6520 6669 7273 7420 636f 6e76 6572 7465  e first converte
+00053030: 6420 746f 2074 6865 6972 2064 6563 696d  d to their decim
+00053040: 616c 0a20 2020 2020 2020 2079 6561 7220  al.        year 
+00053050: 6571 7569 7661 6c65 6e74 2074 6865 6e20  equivalent then 
+00053060: 6073 6f75 7263 6560 2069 7320 696e 7465  `source` is inte
+00053070: 7270 6f6c 6174 6564 206f 6e20 7468 6520  rpolated on the 
+00053080: 7461 7267 6574 2063 6f6f 7264 696e 6174  target coordinat
+00053090: 652e 0a20 2020 2020 2020 2054 6865 2064  e..        The d
+000530a0: 6563 696d 616c 2079 6561 7220 6f66 2061  ecimal year of a
+000530b0: 2074 696d 6573 7461 6d70 2069 7320 6974   timestamp is it
+000530c0: 7320 7965 6172 2070 6c75 7320 6974 7320  s year plus its 
+000530d0: 7375 622d 7965 6172 2063 6f6d 706f 6e65  sub-year compone
+000530e0: 6e74 0a20 2020 2020 2020 2063 6f6e 7665  nt.        conve
+000530f0: 7274 6564 2074 6f20 7468 6520 6672 6163  rted to the frac
+00053100: 7469 6f6e 206f 6620 6974 7320 7965 6172  tion of its year
+00053110: 2e20 466f 7220 6578 616d 706c 6520 2232  . For example "2
+00053120: 3030 302d 3033 2d30 3120 3132 3a30 3022  000-03-01 12:00"
+00053130: 2069 730a 2020 2020 2020 2020 3230 3030   is.        2000
+00053140: 2e31 3635 3320 696e 2061 2073 7461 6e64  .1653 in a stand
+00053150: 6172 6420 6361 6c65 6e64 6172 206f 7220  ard calendar or 
+00053160: 3230 3030 2e31 3633 3031 2069 6e20 6120  2000.16301 in a 
+00053170: 6022 6e6f 6c65 6170 2260 2063 616c 656e  `"noleap"` calen
+00053180: 6461 722e 0a0a 2020 2020 2020 2020 5468  dar...        Th
+00053190: 6973 206d 6574 686f 6420 7368 6f75 6c64  is method should
+000531a0: 206f 6e6c 7920 6265 2075 7365 6420 7768   only be used wh
+000531b0: 656e 2074 6865 2074 696d 6520 2848 483a  en the time (HH:
+000531c0: 4d4d 3a53 5329 2069 6e66 6f72 6d61 7469  MM:SS) informati
+000531d0: 6f6e 206f 660a 2020 2020 2020 2020 7469  on of.        ti
+000531e0: 6d65 2063 6f6f 7264 696e 6174 6520 6973  me coordinate is
+000531f0: 206e 6f74 2069 6d70 6f72 7461 6e74 2e0a   not important..
+00053200: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00053210: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+00053220: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2074  ------.        t
+00053230: 6172 6765 743a 2044 6174 6141 7272 6179  arget: DataArray
+00053240: 206f 7220 4461 7465 7469 6d65 496e 6465   or DatetimeInde
+00053250: 7820 6f72 2043 4654 696d 6549 6e64 6578  x or CFTimeIndex
+00053260: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+00053270: 2074 6172 6765 7420 7469 6d65 2063 6f6f   target time coo
+00053280: 7264 696e 6174 6520 6f66 2061 2076 616c  rdinate of a val
+00053290: 6964 2064 7479 7065 0a20 2020 2020 2020  id dtype.       
+000532a0: 2020 2020 2028 6e70 2e64 6174 6574 696d       (np.datetim
+000532b0: 6536 3420 6f72 2063 6674 696d 6520 6f62  e64 or cftime ob
+000532c0: 6a65 6374 7329 0a20 2020 2020 2020 2064  jects).        d
+000532d0: 696d 203a 2048 6173 6861 626c 652c 2064  im : Hashable, d
+000532e0: 6566 6175 6c74 3a20 2274 696d 6522 0a20  efault: "time". 
+000532f0: 2020 2020 2020 2020 2020 2054 6865 2074             The t
+00053300: 696d 6520 636f 6f72 6469 6e61 7465 206e  ime coordinate n
+00053310: 616d 652e 0a0a 2020 2020 2020 2020 5265  ame...        Re
+00053320: 7475 726e 0a20 2020 2020 2020 202d 2d2d  turn.        ---
+00053330: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
+00053340: 4172 7261 790a 2020 2020 2020 2020 2020  Array.          
+00053350: 2020 5468 6520 736f 7572 6365 2069 6e74    The source int
+00053360: 6572 706f 6c61 7465 6420 6f6e 2074 6865  erpolated on the
+00053370: 2064 6563 696d 616c 2079 6561 7273 206f   decimal years o
+00053380: 6620 7461 7267 6574 2c0a 2020 2020 2020  f target,.      
+00053390: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+000533a0: 7475 726e 2069 6e74 6572 705f 6361 6c65  turn interp_cale
+000533b0: 6e64 6172 2873 656c 662c 2074 6172 6765  ndar(self, targe
+000533c0: 742c 2064 696d 3d64 696d 290a 0a20 2020  t, dim=dim)..   
+000533d0: 2064 6566 2067 726f 7570 6279 280a 2020   def groupby(.  
+000533e0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+000533f0: 2020 2020 6772 6f75 703a 2048 6173 6861      group: Hasha
+00053400: 626c 6520 7c20 4461 7461 4172 7261 7920  ble | DataArray 
+00053410: 7c20 496e 6465 7856 6172 6961 626c 652c  | IndexVariable,
+00053420: 0a20 2020 2020 2020 2073 7175 6565 7a65  .        squeeze
+00053430: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
+00053440: 2020 2020 2020 2072 6573 746f 7265 5f63         restore_c
+00053450: 6f6f 7264 5f64 696d 733a 2062 6f6f 6c20  oord_dims: bool 
+00053460: 3d20 4661 6c73 652c 0a20 2020 2029 202d  = False,.    ) -
+00053470: 3e20 4461 7461 7365 7447 726f 7570 4279  > DatasetGroupBy
+00053480: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00053490: 7572 6e73 2061 2044 6174 6173 6574 4772  urns a DatasetGr
+000534a0: 6f75 7042 7920 6f62 6a65 6374 2066 6f72  oupBy object for
+000534b0: 2070 6572 666f 726d 696e 6720 6772 6f75   performing grou
+000534c0: 7065 6420 6f70 6572 6174 696f 6e73 2e0a  ped operations..
+000534d0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+000534e0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+000534f0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2067  ------.        g
+00053500: 726f 7570 203a 2048 6173 6861 626c 652c  roup : Hashable,
+00053510: 2044 6174 6141 7272 6179 206f 7220 496e   DataArray or In
+00053520: 6465 7856 6172 6961 626c 650a 2020 2020  dexVariable.    
+00053530: 2020 2020 2020 2020 4172 7261 7920 7768          Array wh
+00053540: 6f73 6520 756e 6971 7565 2076 616c 7565  ose unique value
+00053550: 7320 7368 6f75 6c64 2062 6520 7573 6564  s should be used
+00053560: 2074 6f20 6772 6f75 7020 7468 6973 2061   to group this a
+00053570: 7272 6179 2e20 4966 2061 0a20 2020 2020  rray. If a.     
+00053580: 2020 2020 2020 2073 7472 696e 672c 206d         string, m
+00053590: 7573 7420 6265 2074 6865 206e 616d 6520  ust be the name 
+000535a0: 6f66 2061 2076 6172 6961 626c 6520 636f  of a variable co
+000535b0: 6e74 6169 6e65 6420 696e 2074 6869 7320  ntained in this 
+000535c0: 6461 7461 7365 742e 0a20 2020 2020 2020  dataset..       
+000535d0: 2073 7175 6565 7a65 203a 2062 6f6f 6c2c   squeeze : bool,
+000535e0: 2064 6566 6175 6c74 3a20 5472 7565 0a20   default: True. 
+000535f0: 2020 2020 2020 2020 2020 2049 6620 2267             If "g
+00053600: 726f 7570 2220 6973 2061 2064 696d 656e  roup" is a dimen
+00053610: 7369 6f6e 206f 6620 616e 7920 6172 7261  sion of any arra
+00053620: 7973 2069 6e20 7468 6973 2064 6174 6173  ys in this datas
+00053630: 6574 2c20 6073 7175 6565 7a65 600a 2020  et, `squeeze`.  
+00053640: 2020 2020 2020 2020 2020 636f 6e74 726f            contro
+00053650: 6c73 2077 6865 7468 6572 2074 6865 2073  ls whether the s
+00053660: 7562 6172 7261 7973 2068 6176 6520 6120  ubarrays have a 
+00053670: 6469 6d65 6e73 696f 6e20 6f66 206c 656e  dimension of len
+00053680: 6774 6820 3120 616c 6f6e 670a 2020 2020  gth 1 along.    
+00053690: 2020 2020 2020 2020 7468 6174 2064 696d          that dim
+000536a0: 656e 7369 6f6e 206f 7220 6966 2074 6865  ension or if the
+000536b0: 2064 696d 656e 7369 6f6e 2069 7320 7371   dimension is sq
+000536c0: 7565 657a 6564 206f 7574 2e0a 2020 2020  ueezed out..    
+000536d0: 2020 2020 7265 7374 6f72 655f 636f 6f72      restore_coor
+000536e0: 645f 6469 6d73 203a 2062 6f6f 6c2c 2064  d_dims : bool, d
+000536f0: 6566 6175 6c74 3a20 4661 6c73 650a 2020  efault: False.  
+00053700: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00053710: 652c 2061 6c73 6f20 7265 7374 6f72 6520  e, also restore 
+00053720: 7468 6520 6469 6d65 6e73 696f 6e20 6f72  the dimension or
+00053730: 6465 7220 6f66 206d 756c 7469 2d64 696d  der of multi-dim
+00053740: 656e 7369 6f6e 616c 0a20 2020 2020 2020  ensional.       
+00053750: 2020 2020 2063 6f6f 7264 696e 6174 6573       coordinates
+00053760: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00053770: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00053780: 2d2d 0a20 2020 2020 2020 2067 726f 7570  --.        group
+00053790: 6564 203a 2044 6174 6173 6574 4772 6f75  ed : DatasetGrou
+000537a0: 7042 790a 2020 2020 2020 2020 2020 2020  pBy.            
+000537b0: 4120 6044 6174 6173 6574 4772 6f75 7042  A `DatasetGroupB
+000537c0: 7960 206f 626a 6563 7420 7061 7474 6572  y` object patter
+000537d0: 6e65 6420 6166 7465 7220 6070 616e 6461  ned after `panda
+000537e0: 732e 4772 6f75 7042 7960 2074 6861 7420  s.GroupBy` that 
+000537f0: 6361 6e20 6265 0a20 2020 2020 2020 2020  can be.         
+00053800: 2020 2069 7465 7261 7465 6420 6f76 6572     iterated over
+00053810: 2069 6e20 7468 6520 666f 726d 206f 6620   in the form of 
+00053820: 6028 756e 6971 7565 5f76 616c 7565 2c20  `(unique_value, 
+00053830: 6772 6f75 7065 645f 6172 7261 7929 6020  grouped_array)` 
+00053840: 7061 6972 732e 0a0a 2020 2020 2020 2020  pairs...        
+00053850: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+00053860: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+00053870: 2020 3a72 6566 3a60 6772 6f75 7062 7960    :ref:`groupby`
+00053880: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
+00053890: 7273 2067 7569 6465 2065 7870 6c61 6e61  rs guide explana
+000538a0: 7469 6f6e 206f 6620 686f 7720 746f 2067  tion of how to g
+000538b0: 726f 7570 2061 6e64 2062 696e 2064 6174  roup and bin dat
+000538c0: 612e 0a20 2020 2020 2020 2044 6174 6173  a..        Datas
+000538d0: 6574 2e67 726f 7570 6279 5f62 696e 730a  et.groupby_bins.
+000538e0: 2020 2020 2020 2020 4461 7461 4172 7261          DataArra
+000538f0: 792e 6772 6f75 7062 790a 2020 2020 2020  y.groupby.      
+00053900: 2020 636f 7265 2e67 726f 7570 6279 2e44    core.groupby.D
+00053910: 6174 6173 6574 4772 6f75 7042 790a 2020  atasetGroupBy.  
+00053920: 2020 2020 2020 7061 6e64 6173 2e44 6174        pandas.Dat
+00053930: 6146 7261 6d65 2e67 726f 7570 6279 0a20  aFrame.groupby. 
+00053940: 2020 2020 2020 2044 6174 6173 6574 2e72         Dataset.r
+00053950: 6573 616d 706c 650a 2020 2020 2020 2020  esample.        
+00053960: 4461 7461 4172 7261 792e 7265 7361 6d70  DataArray.resamp
+00053970: 6c65 0a20 2020 2020 2020 2022 2222 0a20  le.        """. 
+00053980: 2020 2020 2020 2066 726f 6d20 7861 7272         from xarr
+00053990: 6179 2e63 6f72 652e 6772 6f75 7062 7920  ay.core.groupby 
+000539a0: 696d 706f 7274 2044 6174 6173 6574 4772  import DatasetGr
+000539b0: 6f75 7042 790a 0a20 2020 2020 2020 2023  oupBy..        #
+000539c0: 2057 6869 6c65 2077 6520 646f 6e27 7420   While we don't 
+000539d0: 6765 6e65 7261 6c6c 7920 6368 6563 6b20  generally check 
+000539e0: 7468 6520 7479 7065 206f 6620 6576 6572  the type of ever
+000539f0: 7920 6172 672c 2070 6173 7369 6e67 0a20  y arg, passing. 
+00053a00: 2020 2020 2020 2023 206d 756c 7469 706c         # multipl
+00053a10: 6520 6469 6d65 6e73 696f 6e73 2061 7320  e dimensions as 
+00053a20: 6d75 6c74 6970 6c65 2061 7267 756d 656e  multiple argumen
+00053a30: 7473 2069 7320 636f 6d6d 6f6e 2065 6e6f  ts is common eno
+00053a40: 7567 682c 2061 6e64 2074 6865 0a20 2020  ugh, and the.   
+00053a50: 2020 2020 2023 2063 6f6e 7365 7175 656e       # consequen
+00053a60: 6365 7320 6869 6464 656e 2065 6e6f 7567  ces hidden enoug
+00053a70: 6820 2873 7472 696e 6773 2065 7661 6c75  h (strings evalu
+00053a80: 6174 6520 6173 2074 7275 6529 2074 6f20  ate as true) to 
+00053a90: 7761 7272 616e 740a 2020 2020 2020 2020  warrant.        
+00053aa0: 2320 6368 6563 6b69 6e67 2068 6572 652e  # checking here.
+00053ab0: 0a20 2020 2020 2020 2023 2041 2066 7574  .        # A fut
+00053ac0: 7572 6520 7665 7273 696f 6e20 636f 756c  ure version coul
+00053ad0: 6420 6d61 6b65 2073 7175 6565 7a65 206b  d make squeeze k
+00053ae0: 7761 7267 206f 6e6c 792c 2062 7574 2077  warg only, but w
+00053af0: 6f75 6c64 2066 6163 650a 2020 2020 2020  ould face.      
+00053b00: 2020 2320 6261 636b 7761 7264 2d63 6f6d    # backward-com
+00053b10: 7061 7420 6973 7375 6573 2e0a 2020 2020  pat issues..    
+00053b20: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+00053b30: 7461 6e63 6528 7371 7565 657a 652c 2062  tance(squeeze, b
+00053b40: 6f6f 6c29 3a0a 2020 2020 2020 2020 2020  ool):.          
+00053b50: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+00053b60: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00053b70: 2020 2066 2260 7371 7565 657a 6560 206d     f"`squeeze` m
+00053b80: 7573 7420 6265 2054 7275 6520 6f72 2046  ust be True or F
+00053b90: 616c 7365 2c20 6275 7420 7b73 7175 6565  alse, but {squee
+00053ba0: 7a65 7d20 7761 7320 7375 7070 6c69 6564  ze} was supplied
+00053bb0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00053bc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00053bd0: 4461 7461 7365 7447 726f 7570 4279 280a  DatasetGroupBy(.
+00053be0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00053bf0: 2c20 6772 6f75 702c 2073 7175 6565 7a65  , group, squeeze
+00053c00: 3d73 7175 6565 7a65 2c20 7265 7374 6f72  =squeeze, restor
+00053c10: 655f 636f 6f72 645f 6469 6d73 3d72 6573  e_coord_dims=res
+00053c20: 746f 7265 5f63 6f6f 7264 5f64 696d 730a  tore_coord_dims.
+00053c30: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00053c40: 6566 2067 726f 7570 6279 5f62 696e 7328  ef groupby_bins(
+00053c50: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00053c60: 2020 2020 2020 2067 726f 7570 3a20 4861         group: Ha
+00053c70: 7368 6162 6c65 207c 2044 6174 6141 7272  shable | DataArr
+00053c80: 6179 207c 2049 6e64 6578 5661 7269 6162  ay | IndexVariab
+00053c90: 6c65 2c0a 2020 2020 2020 2020 6269 6e73  le,.        bins
+00053ca0: 3a20 4172 7261 794c 696b 652c 0a20 2020  : ArrayLike,.   
+00053cb0: 2020 2020 2072 6967 6874 3a20 626f 6f6c       right: bool
+00053cc0: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
+00053cd0: 206c 6162 656c 733a 2041 7272 6179 4c69   labels: ArrayLi
+00053ce0: 6b65 207c 204e 6f6e 6520 3d20 4e6f 6e65  ke | None = None
+00053cf0: 2c0a 2020 2020 2020 2020 7072 6563 6973  ,.        precis
+00053d00: 696f 6e3a 2069 6e74 203d 2033 2c0a 2020  ion: int = 3,.  
+00053d10: 2020 2020 2020 696e 636c 7564 655f 6c6f        include_lo
+00053d20: 7765 7374 3a20 626f 6f6c 203d 2046 616c  west: bool = Fal
+00053d30: 7365 2c0a 2020 2020 2020 2020 7371 7565  se,.        sque
+00053d40: 657a 653a 2062 6f6f 6c20 3d20 5472 7565  eze: bool = True
+00053d50: 2c0a 2020 2020 2020 2020 7265 7374 6f72  ,.        restor
+00053d60: 655f 636f 6f72 645f 6469 6d73 3a20 626f  e_coord_dims: bo
+00053d70: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+00053d80: 2920 2d3e 2044 6174 6173 6574 4772 6f75  ) -> DatasetGrou
+00053d90: 7042 793a 0a20 2020 2020 2020 2022 2222  pBy:.        """
+00053da0: 5265 7475 726e 7320 6120 4461 7461 7365  Returns a Datase
+00053db0: 7447 726f 7570 4279 206f 626a 6563 7420  tGroupBy object 
+00053dc0: 666f 7220 7065 7266 6f72 6d69 6e67 2067  for performing g
+00053dd0: 726f 7570 6564 206f 7065 7261 7469 6f6e  rouped operation
+00053de0: 732e 0a0a 2020 2020 2020 2020 5261 7468  s...        Rath
+00053df0: 6572 2074 6861 6e20 7573 696e 6720 616c  er than using al
+00053e00: 6c20 756e 6971 7565 2076 616c 7565 7320  l unique values 
+00053e10: 6f66 2060 6772 6f75 7060 2c20 7468 6520  of `group`, the 
+00053e20: 7661 6c75 6573 2061 7265 2064 6973 6372  values are discr
+00053e30: 6574 697a 6564 0a20 2020 2020 2020 2066  etized.        f
+00053e40: 6972 7374 2062 7920 6170 706c 7969 6e67  irst by applying
+00053e50: 2060 7061 6e64 6173 2e63 7574 6020 5b31   `pandas.cut` [1
+00053e60: 5d5f 2074 6f20 6067 726f 7570 602e 0a0a  ]_ to `group`...
+00053e70: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00053e80: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00053e90: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6772  -----.        gr
+00053ea0: 6f75 7020 3a20 4861 7368 6162 6c65 2c20  oup : Hashable, 
+00053eb0: 4461 7461 4172 7261 7920 6f72 2049 6e64  DataArray or Ind
+00053ec0: 6578 5661 7269 6162 6c65 0a20 2020 2020  exVariable.     
+00053ed0: 2020 2020 2020 2041 7272 6179 2077 686f         Array who
+00053ee0: 7365 2062 696e 6e65 6420 7661 6c75 6573  se binned values
+00053ef0: 2073 686f 756c 6420 6265 2075 7365 6420   should be used 
+00053f00: 746f 2067 726f 7570 2074 6869 7320 6172  to group this ar
+00053f10: 7261 792e 2049 6620 610a 2020 2020 2020  ray. If a.      
+00053f20: 2020 2020 2020 7374 7269 6e67 2c20 6d75        string, mu
+00053f30: 7374 2062 6520 7468 6520 6e61 6d65 206f  st be the name o
+00053f40: 6620 6120 7661 7269 6162 6c65 2063 6f6e  f a variable con
+00053f50: 7461 696e 6564 2069 6e20 7468 6973 2064  tained in this d
+00053f60: 6174 6173 6574 2e0a 2020 2020 2020 2020  ataset..        
+00053f70: 6269 6e73 203a 2069 6e74 206f 7220 6172  bins : int or ar
+00053f80: 7261 792d 6c69 6b65 0a20 2020 2020 2020  ray-like.       
+00053f90: 2020 2020 2049 6620 6269 6e73 2069 7320       If bins is 
+00053fa0: 616e 2069 6e74 2c20 6974 2064 6566 696e  an int, it defin
+00053fb0: 6573 2074 6865 206e 756d 6265 7220 6f66  es the number of
+00053fc0: 2065 7175 616c 2d77 6964 7468 2062 696e   equal-width bin
+00053fd0: 7320 696e 2074 6865 0a20 2020 2020 2020  s in the.       
+00053fe0: 2020 2020 2072 616e 6765 206f 6620 782e       range of x.
+00053ff0: 2048 6f77 6576 6572 2c20 696e 2074 6869   However, in thi
+00054000: 7320 6361 7365 2c20 7468 6520 7261 6e67  s case, the rang
+00054010: 6520 6f66 2078 2069 7320 6578 7465 6e64  e of x is extend
+00054020: 6564 2062 7920 2e31 250a 2020 2020 2020  ed by .1%.      
+00054030: 2020 2020 2020 6f6e 2065 6163 6820 7369        on each si
+00054040: 6465 2074 6f20 696e 636c 7564 6520 7468  de to include th
+00054050: 6520 6d69 6e20 6f72 206d 6178 2076 616c  e min or max val
+00054060: 7565 7320 6f66 2078 2e20 4966 2062 696e  ues of x. If bin
+00054070: 7320 6973 2061 0a20 2020 2020 2020 2020  s is a.         
+00054080: 2020 2073 6571 7565 6e63 6520 6974 2064     sequence it d
+00054090: 6566 696e 6573 2074 6865 2062 696e 2065  efines the bin e
+000540a0: 6467 6573 2061 6c6c 6f77 696e 6720 666f  dges allowing fo
+000540b0: 7220 6e6f 6e2d 756e 6966 6f72 6d20 6269  r non-uniform bi
+000540c0: 6e0a 2020 2020 2020 2020 2020 2020 7769  n.            wi
+000540d0: 6474 682e 204e 6f20 6578 7465 6e73 696f  dth. No extensio
+000540e0: 6e20 6f66 2074 6865 2072 616e 6765 206f  n of the range o
+000540f0: 6620 7820 6973 2064 6f6e 6520 696e 2074  f x is done in t
+00054100: 6869 7320 6361 7365 2e0a 2020 2020 2020  his case..      
+00054110: 2020 7269 6768 7420 3a20 626f 6f6c 2c20    right : bool, 
+00054120: 6465 6661 756c 743a 2054 7275 650a 2020  default: True.  
+00054130: 2020 2020 2020 2020 2020 496e 6469 6361            Indica
+00054140: 7465 7320 7768 6574 6865 7220 7468 6520  tes whether the 
+00054150: 6269 6e73 2069 6e63 6c75 6465 2074 6865  bins include the
+00054160: 2072 6967 6874 6d6f 7374 2065 6467 6520   rightmost edge 
+00054170: 6f72 206e 6f74 2e20 4966 0a20 2020 2020  or not. If.     
+00054180: 2020 2020 2020 2072 6967 6874 203d 3d20         right == 
+00054190: 5472 7565 2028 7468 6520 6465 6661 756c  True (the defaul
+000541a0: 7429 2c20 7468 656e 2074 6865 2062 696e  t), then the bin
+000541b0: 7320 5b31 2c32 2c33 2c34 5d20 696e 6469  s [1,2,3,4] indi
+000541c0: 6361 7465 0a20 2020 2020 2020 2020 2020  cate.           
+000541d0: 2028 312c 325d 2c20 2832 2c33 5d2c 2028   (1,2], (2,3], (
+000541e0: 332c 345d 2e0a 2020 2020 2020 2020 6c61  3,4]..        la
+000541f0: 6265 6c73 203a 2061 7272 6179 2d6c 696b  bels : array-lik
+00054200: 6520 6f72 2062 6f6f 6c2c 2064 6566 6175  e or bool, defau
+00054210: 6c74 3a20 4e6f 6e65 0a20 2020 2020 2020  lt: None.       
+00054220: 2020 2020 2055 7365 6420 6173 206c 6162       Used as lab
+00054230: 656c 7320 666f 7220 7468 6520 7265 7375  els for the resu
+00054240: 6c74 696e 6720 6269 6e73 2e20 4d75 7374  lting bins. Must
+00054250: 2062 6520 6f66 2074 6865 2073 616d 6520   be of the same 
+00054260: 6c65 6e67 7468 2061 730a 2020 2020 2020  length as.      
+00054270: 2020 2020 2020 7468 6520 7265 7375 6c74        the result
+00054280: 696e 6720 6269 6e73 2e20 4966 2046 616c  ing bins. If Fal
+00054290: 7365 2c20 7374 7269 6e67 2062 696e 206c  se, string bin l
+000542a0: 6162 656c 7320 6172 6520 6173 7369 676e  abels are assign
+000542b0: 6564 2062 790a 2020 2020 2020 2020 2020  ed by.          
+000542c0: 2020 6070 616e 6461 732e 6375 7460 2e0a    `pandas.cut`..
+000542d0: 2020 2020 2020 2020 7072 6563 6973 696f          precisio
+000542e0: 6e20 3a20 696e 742c 2064 6566 6175 6c74  n : int, default
+000542f0: 3a20 330a 2020 2020 2020 2020 2020 2020  : 3.            
+00054300: 5468 6520 7072 6563 6973 696f 6e20 6174  The precision at
+00054310: 2077 6869 6368 2074 6f20 7374 6f72 6520   which to store 
+00054320: 616e 6420 6469 7370 6c61 7920 7468 6520  and display the 
+00054330: 6269 6e73 206c 6162 656c 732e 0a20 2020  bins labels..   
+00054340: 2020 2020 2069 6e63 6c75 6465 5f6c 6f77       include_low
+00054350: 6573 7420 3a20 626f 6f6c 2c20 6465 6661  est : bool, defa
+00054360: 756c 743a 2046 616c 7365 0a20 2020 2020  ult: False.     
+00054370: 2020 2020 2020 2057 6865 7468 6572 2074         Whether t
+00054380: 6865 2066 6972 7374 2069 6e74 6572 7661  he first interva
+00054390: 6c20 7368 6f75 6c64 2062 6520 6c65 6674  l should be left
+000543a0: 2d69 6e63 6c75 7369 7665 206f 7220 6e6f  -inclusive or no
+000543b0: 742e 0a20 2020 2020 2020 2073 7175 6565  t..        squee
+000543c0: 7a65 203a 2062 6f6f 6c2c 2064 6566 6175  ze : bool, defau
+000543d0: 6c74 3a20 5472 7565 0a20 2020 2020 2020  lt: True.       
+000543e0: 2020 2020 2049 6620 2267 726f 7570 2220       If "group" 
+000543f0: 6973 2061 2064 696d 656e 7369 6f6e 206f  is a dimension o
+00054400: 6620 616e 7920 6172 7261 7973 2069 6e20  f any arrays in 
+00054410: 7468 6973 2064 6174 6173 6574 2c20 6073  this dataset, `s
+00054420: 7175 6565 7a65 600a 2020 2020 2020 2020  queeze`.        
+00054430: 2020 2020 636f 6e74 726f 6c73 2077 6865      controls whe
+00054440: 7468 6572 2074 6865 2073 7562 6172 7261  ther the subarra
+00054450: 7973 2068 6176 6520 6120 6469 6d65 6e73  ys have a dimens
+00054460: 696f 6e20 6f66 206c 656e 6774 6820 3120  ion of length 1 
+00054470: 616c 6f6e 670a 2020 2020 2020 2020 2020  along.          
+00054480: 2020 7468 6174 2064 696d 656e 7369 6f6e    that dimension
+00054490: 206f 7220 6966 2074 6865 2064 696d 656e   or if the dimen
+000544a0: 7369 6f6e 2069 7320 7371 7565 657a 6564  sion is squeezed
+000544b0: 206f 7574 2e0a 2020 2020 2020 2020 7265   out..        re
+000544c0: 7374 6f72 655f 636f 6f72 645f 6469 6d73  store_coord_dims
+000544d0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+000544e0: 3a20 4661 6c73 650a 2020 2020 2020 2020  : False.        
+000544f0: 2020 2020 4966 2054 7275 652c 2061 6c73      If True, als
+00054500: 6f20 7265 7374 6f72 6520 7468 6520 6469  o restore the di
+00054510: 6d65 6e73 696f 6e20 6f72 6465 7220 6f66  mension order of
+00054520: 206d 756c 7469 2d64 696d 656e 7369 6f6e   multi-dimension
+00054530: 616c 0a20 2020 2020 2020 2020 2020 2063  al.            c
+00054540: 6f6f 7264 696e 6174 6573 2e0a 0a20 2020  oordinates...   
+00054550: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+00054560: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+00054570: 2020 2020 2067 726f 7570 6564 203a 2044       grouped : D
+00054580: 6174 6173 6574 4772 6f75 7042 790a 2020  atasetGroupBy.  
+00054590: 2020 2020 2020 2020 2020 4120 6044 6174            A `Dat
+000545a0: 6173 6574 4772 6f75 7042 7960 206f 626a  asetGroupBy` obj
+000545b0: 6563 7420 7061 7474 6572 6e65 6420 6166  ect patterned af
+000545c0: 7465 7220 6070 616e 6461 732e 4772 6f75  ter `pandas.Grou
+000545d0: 7042 7960 2074 6861 7420 6361 6e20 6265  pBy` that can be
+000545e0: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
+000545f0: 7261 7465 6420 6f76 6572 2069 6e20 7468  rated over in th
+00054600: 6520 666f 726d 206f 6620 6028 756e 6971  e form of `(uniq
+00054610: 7565 5f76 616c 7565 2c20 6772 6f75 7065  ue_value, groupe
+00054620: 645f 6172 7261 7929 6020 7061 6972 732e  d_array)` pairs.
+00054630: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+00054640: 206e 616d 6520 6f66 2074 6865 2067 726f   name of the gro
+00054650: 7570 2068 6173 2074 6865 2061 6464 6564  up has the added
+00054660: 2073 7566 6669 7820 605f 6269 6e73 6020   suffix `_bins` 
+00054670: 696e 206f 7264 6572 2074 6f0a 2020 2020  in order to.    
+00054680: 2020 2020 2020 2020 6469 7374 696e 6775          distingu
+00054690: 6973 6820 6974 2066 726f 6d20 7468 6520  ish it from the 
+000546a0: 6f72 6967 696e 616c 2076 6172 6961 626c  original variabl
+000546b0: 652e 0a0a 2020 2020 2020 2020 5365 6520  e...        See 
+000546c0: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+000546d0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 3a72  -----.        :r
+000546e0: 6566 3a60 6772 6f75 7062 7960 0a20 2020  ef:`groupby`.   
+000546f0: 2020 2020 2020 2020 2055 7365 7273 2067           Users g
+00054700: 7569 6465 2065 7870 6c61 6e61 7469 6f6e  uide explanation
+00054710: 206f 6620 686f 7720 746f 2067 726f 7570   of how to group
+00054720: 2061 6e64 2062 696e 2064 6174 612e 0a20   and bin data.. 
+00054730: 2020 2020 2020 2044 6174 6173 6574 2e67         Dataset.g
+00054740: 726f 7570 6279 0a20 2020 2020 2020 2044  roupby.        D
+00054750: 6174 6141 7272 6179 2e67 726f 7570 6279  ataArray.groupby
+00054760: 5f62 696e 730a 2020 2020 2020 2020 636f  _bins.        co
+00054770: 7265 2e67 726f 7570 6279 2e44 6174 6173  re.groupby.Datas
+00054780: 6574 4772 6f75 7042 790a 2020 2020 2020  etGroupBy.      
+00054790: 2020 7061 6e64 6173 2e44 6174 6146 7261    pandas.DataFra
+000547a0: 6d65 2e67 726f 7570 6279 0a0a 2020 2020  me.groupby..    
+000547b0: 2020 2020 5265 6665 7265 6e63 6573 0a20      References. 
+000547c0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+000547d0: 2d0a 2020 2020 2020 2020 2e2e 205b 315d  -.        .. [1]
+000547e0: 2068 7474 703a 2f2f 7061 6e64 6173 2e70   http://pandas.p
+000547f0: 7964 6174 612e 6f72 672f 7061 6e64 6173  ydata.org/pandas
+00054800: 2d64 6f63 732f 7374 6162 6c65 2f67 656e  -docs/stable/gen
+00054810: 6572 6174 6564 2f70 616e 6461 732e 6375  erated/pandas.cu
+00054820: 742e 6874 6d6c 0a20 2020 2020 2020 2022  t.html.        "
+00054830: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00054840: 7861 7272 6179 2e63 6f72 652e 6772 6f75  xarray.core.grou
+00054850: 7062 7920 696d 706f 7274 2044 6174 6173  pby import Datas
+00054860: 6574 4772 6f75 7042 790a 0a20 2020 2020  etGroupBy..     
+00054870: 2020 2072 6574 7572 6e20 4461 7461 7365     return Datase
+00054880: 7447 726f 7570 4279 280a 2020 2020 2020  tGroupBy(.      
+00054890: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+000548a0: 2020 2020 2020 2020 6772 6f75 702c 0a20          group,. 
+000548b0: 2020 2020 2020 2020 2020 2073 7175 6565             squee
+000548c0: 7a65 3d73 7175 6565 7a65 2c0a 2020 2020  ze=squeeze,.    
+000548d0: 2020 2020 2020 2020 6269 6e73 3d62 696e          bins=bin
+000548e0: 732c 0a20 2020 2020 2020 2020 2020 2072  s,.            r
+000548f0: 6573 746f 7265 5f63 6f6f 7264 5f64 696d  estore_coord_dim
+00054900: 733d 7265 7374 6f72 655f 636f 6f72 645f  s=restore_coord_
+00054910: 6469 6d73 2c0a 2020 2020 2020 2020 2020  dims,.          
+00054920: 2020 6375 745f 6b77 6172 6773 3d7b 0a20    cut_kwargs={. 
+00054930: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00054940: 7269 6768 7422 3a20 7269 6768 742c 0a20  right": right,. 
+00054950: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00054960: 6c61 6265 6c73 223a 206c 6162 656c 732c  labels": labels,
+00054970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00054980: 2022 7072 6563 6973 696f 6e22 3a20 7072   "precision": pr
+00054990: 6563 6973 696f 6e2c 0a20 2020 2020 2020  ecision,.       
+000549a0: 2020 2020 2020 2020 2022 696e 636c 7564           "includ
+000549b0: 655f 6c6f 7765 7374 223a 2069 6e63 6c75  e_lowest": inclu
+000549c0: 6465 5f6c 6f77 6573 742c 0a20 2020 2020  de_lowest,.     
+000549d0: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
+000549e0: 2020 290a 0a20 2020 2064 6566 2077 6569    )..    def wei
+000549f0: 6768 7465 6428 7365 6c66 2c20 7765 6967  ghted(self, weig
+00054a00: 6874 733a 2044 6174 6141 7272 6179 2920  hts: DataArray) 
+00054a10: 2d3e 2044 6174 6173 6574 5765 6967 6874  -> DatasetWeight
+00054a20: 6564 3a0a 2020 2020 2020 2020 2222 220a  ed:.        """.
+00054a30: 2020 2020 2020 2020 5765 6967 6874 6564          Weighted
+00054a40: 2044 6174 6173 6574 206f 7065 7261 7469   Dataset operati
+00054a50: 6f6e 732e 0a0a 2020 2020 2020 2020 5061  ons...        Pa
+00054a60: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00054a70: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00054a80: 2020 2020 7765 6967 6874 7320 3a20 4461      weights : Da
+00054a90: 7461 4172 7261 790a 2020 2020 2020 2020  taArray.        
+00054aa0: 2020 2020 416e 2061 7272 6179 206f 6620      An array of 
+00054ab0: 7765 6967 6874 7320 6173 736f 6369 6174  weights associat
+00054ac0: 6564 2077 6974 6820 7468 6520 7661 6c75  ed with the valu
+00054ad0: 6573 2069 6e20 7468 6973 2044 6174 6173  es in this Datas
+00054ae0: 6574 2e0a 2020 2020 2020 2020 2020 2020  et..            
+00054af0: 4561 6368 2076 616c 7565 2069 6e20 7468  Each value in th
+00054b00: 6520 6461 7461 2063 6f6e 7472 6962 7574  e data contribut
+00054b10: 6573 2074 6f20 7468 6520 7265 6475 6374  es to the reduct
+00054b20: 696f 6e20 6f70 6572 6174 696f 6e0a 2020  ion operation.  
+00054b30: 2020 2020 2020 2020 2020 6163 636f 7264            accord
+00054b40: 696e 6720 746f 2069 7473 2061 7373 6f63  ing to its assoc
+00054b50: 6961 7465 6420 7765 6967 6874 2e0a 0a20  iated weight... 
+00054b60: 2020 2020 2020 204e 6f74 6573 0a20 2020         Notes.   
+00054b70: 2020 2020 202d 2d2d 2d2d 0a20 2020 2020       -----.     
+00054b80: 2020 2060 6077 6569 6768 7473 6060 206d     ``weights`` m
+00054b90: 7573 7420 6265 2061 2044 6174 6141 7272  ust be a DataArr
+00054ba0: 6179 2061 6e64 2063 616e 6e6f 7420 636f  ay and cannot co
+00054bb0: 6e74 6169 6e20 6d69 7373 696e 6720 7661  ntain missing va
+00054bc0: 6c75 6573 2e0a 2020 2020 2020 2020 4d69  lues..        Mi
+00054bd0: 7373 696e 6720 7661 6c75 6573 2063 616e  ssing values can
+00054be0: 2062 6520 7265 706c 6163 6564 2062 7920   be replaced by 
+00054bf0: 6060 7765 6967 6874 732e 6669 6c6c 6e61  ``weights.fillna
+00054c00: 2830 2960 602e 0a0a 2020 2020 2020 2020  (0)``...        
+00054c10: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+00054c20: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00054c30: 636f 7265 2e77 6569 6768 7465 642e 4461  core.weighted.Da
+00054c40: 7461 7365 7457 6569 6768 7465 640a 0a20  tasetWeighted.. 
+00054c50: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+00054c60: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00054c70: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
+00054c80: 6179 2e77 6569 6768 7465 640a 2020 2020  ay.weighted.    
+00054c90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00054ca0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
+00054cb0: 2e77 6569 6768 7465 6420 696d 706f 7274  .weighted import
+00054cc0: 2044 6174 6173 6574 5765 6967 6874 6564   DatasetWeighted
+00054cd0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00054ce0: 2044 6174 6173 6574 5765 6967 6874 6564   DatasetWeighted
+00054cf0: 2873 656c 662c 2077 6569 6768 7473 290a  (self, weights).
+00054d00: 0a20 2020 2064 6566 2072 6f6c 6c69 6e67  .    def rolling
+00054d10: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00054d20: 2020 2020 2020 2020 6469 6d3a 204d 6170          dim: Map
+00054d30: 7069 6e67 5b41 6e79 2c20 696e 745d 207c  ping[Any, int] |
+00054d40: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+00054d50: 2020 2020 2020 6d69 6e5f 7065 7269 6f64        min_period
+00054d60: 733a 2069 6e74 207c 204e 6f6e 6520 3d20  s: int | None = 
+00054d70: 4e6f 6e65 2c0a 2020 2020 2020 2020 6365  None,.        ce
+00054d80: 6e74 6572 3a20 626f 6f6c 207c 204d 6170  nter: bool | Map
+00054d90: 7069 6e67 5b41 6e79 2c20 626f 6f6c 5d20  ping[Any, bool] 
+00054da0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+00054db0: 202a 2a77 696e 646f 775f 6b77 6172 6773   **window_kwargs
+00054dc0: 3a20 696e 742c 0a20 2020 2029 202d 3e20  : int,.    ) -> 
+00054dd0: 4461 7461 7365 7452 6f6c 6c69 6e67 3a0a  DatasetRolling:.
+00054de0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00054df0: 2020 2020 526f 6c6c 696e 6720 7769 6e64      Rolling wind
+00054e00: 6f77 206f 626a 6563 7420 666f 7220 4461  ow object for Da
+00054e10: 7461 7365 7473 2e0a 0a20 2020 2020 2020  tasets...       
+00054e20: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00054e30: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00054e40: 2020 2020 2020 2064 696d 203a 2064 6963         dim : dic
+00054e50: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
+00054e60: 2020 2020 2020 2020 4d61 7070 696e 6720          Mapping 
+00054e70: 6672 6f6d 2074 6865 2064 696d 656e 7369  from the dimensi
+00054e80: 6f6e 206e 616d 6520 746f 2063 7265 6174  on name to creat
+00054e90: 6520 7468 6520 726f 6c6c 696e 6720 6974  e the rolling it
+00054ea0: 6572 6174 6f72 0a20 2020 2020 2020 2020  erator.         
+00054eb0: 2020 2061 6c6f 6e67 2028 652e 672e 2060     along (e.g. `
+00054ec0: 7469 6d65 6029 2074 6f20 6974 7320 6d6f  time`) to its mo
+00054ed0: 7669 6e67 2077 696e 646f 7720 7369 7a65  ving window size
+00054ee0: 2e0a 2020 2020 2020 2020 6d69 6e5f 7065  ..        min_pe
+00054ef0: 7269 6f64 7320 3a20 696e 7420 6f72 204e  riods : int or N
+00054f00: 6f6e 652c 2064 6566 6175 6c74 3a20 4e6f  one, default: No
+00054f10: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
+00054f20: 696e 696d 756d 206e 756d 6265 7220 6f66  inimum number of
+00054f30: 206f 6273 6572 7661 7469 6f6e 7320 696e   observations in
+00054f40: 2077 696e 646f 7720 7265 7175 6972 6564   window required
+00054f50: 2074 6f20 6861 7665 2061 2076 616c 7565   to have a value
+00054f60: 0a20 2020 2020 2020 2020 2020 2028 6f74  .            (ot
+00054f70: 6865 7277 6973 6520 7265 7375 6c74 2069  herwise result i
+00054f80: 7320 4e41 292e 2054 6865 2064 6566 6175  s NA). The defau
+00054f90: 6c74 2c20 4e6f 6e65 2c20 6973 2065 7175  lt, None, is equ
+00054fa0: 6976 616c 656e 7420 746f 0a20 2020 2020  ivalent to.     
+00054fb0: 2020 2020 2020 2073 6574 7469 6e67 206d         setting m
+00054fc0: 696e 5f70 6572 696f 6473 2065 7175 616c  in_periods equal
+00054fd0: 2074 6f20 7468 6520 7369 7a65 206f 6620   to the size of 
+00054fe0: 7468 6520 7769 6e64 6f77 2e0a 2020 2020  the window..    
+00054ff0: 2020 2020 6365 6e74 6572 203a 2062 6f6f      center : boo
+00055000: 6c20 6f72 204d 6170 7069 6e67 2074 6f20  l or Mapping to 
+00055010: 696e 742c 2064 6566 6175 6c74 3a20 4661  int, default: Fa
+00055020: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00055030: 5365 7420 7468 6520 6c61 6265 6c73 2061  Set the labels a
+00055040: 7420 7468 6520 6365 6e74 6572 206f 6620  t the center of 
+00055050: 7468 6520 7769 6e64 6f77 2e0a 2020 2020  the window..    
+00055060: 2020 2020 2a2a 7769 6e64 6f77 5f6b 7761      **window_kwa
+00055070: 7267 7320 3a20 6f70 7469 6f6e 616c 0a20  rgs : optional. 
+00055080: 2020 2020 2020 2020 2020 2054 6865 206b             The k
+00055090: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+000550a0: 2066 6f72 6d20 6f66 2060 6064 696d 6060   form of ``dim``
+000550b0: 2e0a 2020 2020 2020 2020 2020 2020 4f6e  ..            On
+000550c0: 6520 6f66 2064 696d 206f 7220 7769 6e64  e of dim or wind
+000550d0: 6f77 5f6b 7761 7267 7320 6d75 7374 2062  ow_kwargs must b
+000550e0: 6520 7072 6f76 6964 6564 2e0a 0a20 2020  e provided...   
+000550f0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+00055100: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+00055110: 2020 2020 2063 6f72 652e 726f 6c6c 696e       core.rollin
+00055120: 672e 4461 7461 7365 7452 6f6c 6c69 6e67  g.DatasetRolling
+00055130: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
+00055140: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
+00055150: 2d2d 2d0a 2020 2020 2020 2020 636f 7265  ---.        core
+00055160: 2e72 6f6c 6c69 6e67 2e44 6174 6173 6574  .rolling.Dataset
+00055170: 526f 6c6c 696e 670a 2020 2020 2020 2020  Rolling.        
+00055180: 4461 7461 4172 7261 792e 726f 6c6c 696e  DataArray.rollin
+00055190: 670a 2020 2020 2020 2020 2222 220a 2020  g.        """.  
+000551a0: 2020 2020 2020 6672 6f6d 2078 6172 7261        from xarra
+000551b0: 792e 636f 7265 2e72 6f6c 6c69 6e67 2069  y.core.rolling i
+000551c0: 6d70 6f72 7420 4461 7461 7365 7452 6f6c  mport DatasetRol
+000551d0: 6c69 6e67 0a0a 2020 2020 2020 2020 6469  ling..        di
+000551e0: 6d20 3d20 6569 7468 6572 5f64 6963 745f  m = either_dict_
+000551f0: 6f72 5f6b 7761 7267 7328 6469 6d2c 2077  or_kwargs(dim, w
+00055200: 696e 646f 775f 6b77 6172 6773 2c20 2272  indow_kwargs, "r
+00055210: 6f6c 6c69 6e67 2229 0a20 2020 2020 2020  olling").       
+00055220: 2072 6574 7572 6e20 4461 7461 7365 7452   return DatasetR
+00055230: 6f6c 6c69 6e67 2873 656c 662c 2064 696d  olling(self, dim
+00055240: 2c20 6d69 6e5f 7065 7269 6f64 733d 6d69  , min_periods=mi
+00055250: 6e5f 7065 7269 6f64 732c 2063 656e 7465  n_periods, cente
+00055260: 723d 6365 6e74 6572 290a 0a20 2020 2064  r=center)..    d
+00055270: 6566 2063 6f61 7273 656e 280a 2020 2020  ef coarsen(.    
+00055280: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00055290: 2020 6469 6d3a 204d 6170 7069 6e67 5b41    dim: Mapping[A
+000552a0: 6e79 2c20 696e 745d 207c 204e 6f6e 6520  ny, int] | None 
+000552b0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000552c0: 626f 756e 6461 7279 3a20 436f 6172 7365  boundary: Coarse
+000552d0: 6e42 6f75 6e64 6172 794f 7074 696f 6e73  nBoundaryOptions
+000552e0: 203d 2022 6578 6163 7422 2c0a 2020 2020   = "exact",.    
+000552f0: 2020 2020 7369 6465 3a20 5369 6465 4f70      side: SideOp
+00055300: 7469 6f6e 7320 7c20 4d61 7070 696e 675b  tions | Mapping[
+00055310: 416e 792c 2053 6964 654f 7074 696f 6e73  Any, SideOptions
+00055320: 5d20 3d20 226c 6566 7422 2c0a 2020 2020  ] = "left",.    
+00055330: 2020 2020 636f 6f72 645f 6675 6e63 3a20      coord_func: 
+00055340: 7374 7220 7c20 4361 6c6c 6162 6c65 207c  str | Callable |
+00055350: 204d 6170 7069 6e67 5b41 6e79 2c20 7374   Mapping[Any, st
+00055360: 7220 7c20 4361 6c6c 6162 6c65 5d20 3d20  r | Callable] = 
+00055370: 226d 6561 6e22 2c0a 2020 2020 2020 2020  "mean",.        
+00055380: 2a2a 7769 6e64 6f77 5f6b 7761 7267 733a  **window_kwargs:
+00055390: 2069 6e74 2c0a 2020 2020 2920 2d3e 2044   int,.    ) -> D
+000553a0: 6174 6173 6574 436f 6172 7365 6e3a 0a20  atasetCoarsen:. 
+000553b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000553c0: 2020 2043 6f61 7273 656e 206f 626a 6563     Coarsen objec
+000553d0: 7420 666f 7220 4461 7461 7365 7473 2e0a  t for Datasets..
+000553e0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+000553f0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+00055400: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
+00055410: 696d 203a 206d 6170 7069 6e67 206f 6620  im : mapping of 
+00055420: 6861 7368 6162 6c65 2074 6f20 696e 742c  hashable to int,
+00055430: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00055440: 2020 2020 2020 4d61 7070 696e 6720 6672        Mapping fr
+00055450: 6f6d 2074 6865 2064 696d 656e 7369 6f6e  om the dimension
+00055460: 206e 616d 6520 746f 2074 6865 2077 696e   name to the win
+00055470: 646f 7720 7369 7a65 2e0a 2020 2020 2020  dow size..      
+00055480: 2020 626f 756e 6461 7279 203a 207b 2265    boundary : {"e
+00055490: 7861 6374 222c 2022 7472 696d 222c 2022  xact", "trim", "
+000554a0: 7061 6422 7d2c 2064 6566 6175 6c74 3a20  pad"}, default: 
+000554b0: 2265 7861 6374 220a 2020 2020 2020 2020  "exact".        
+000554c0: 2020 2020 4966 2027 6578 6163 7427 2c20      If 'exact', 
+000554d0: 6120 5661 6c75 6545 7272 6f72 2077 696c  a ValueError wil
+000554e0: 6c20 6265 2072 6169 7365 6420 6966 2064  l be raised if d
+000554f0: 696d 656e 7369 6f6e 2073 697a 6520 6973  imension size is
+00055500: 206e 6f74 2061 0a20 2020 2020 2020 2020   not a.         
+00055510: 2020 206d 756c 7469 706c 6520 6f66 2074     multiple of t
+00055520: 6865 2077 696e 646f 7720 7369 7a65 2e20  he window size. 
+00055530: 4966 2027 7472 696d 272c 2074 6865 2065  If 'trim', the e
+00055540: 7863 6573 7320 656e 7472 6965 7320 6172  xcess entries ar
+00055550: 650a 2020 2020 2020 2020 2020 2020 6472  e.            dr
+00055560: 6f70 7065 642e 2049 6620 2770 6164 272c  opped. If 'pad',
+00055570: 204e 4120 7769 6c6c 2062 6520 7061 6464   NA will be padd
+00055580: 6564 2e0a 2020 2020 2020 2020 7369 6465  ed..        side
+00055590: 203a 207b 226c 6566 7422 2c20 2272 6967   : {"left", "rig
+000555a0: 6874 227d 206f 7220 6d61 7070 696e 6720  ht"} or mapping 
+000555b0: 6f66 2073 7472 2074 6f20 7b22 6c65 6674  of str to {"left
+000555c0: 222c 2022 7269 6768 7422 7d2c 2064 6566  ", "right"}, def
+000555d0: 6175 6c74 3a20 226c 6566 7422 0a20 2020  ault: "left".   
+000555e0: 2020 2020 2063 6f6f 7264 5f66 756e 6320       coord_func 
+000555f0: 3a20 7374 7220 6f72 206d 6170 7069 6e67  : str or mapping
+00055600: 206f 6620 6861 7368 6162 6c65 2074 6f20   of hashable to 
+00055610: 7374 722c 2064 6566 6175 6c74 3a20 226d  str, default: "m
+00055620: 6561 6e22 0a20 2020 2020 2020 2020 2020  ean".           
+00055630: 2066 756e 6374 696f 6e20 286e 616d 6529   function (name)
+00055640: 2074 6861 7420 6973 2061 7070 6c69 6564   that is applied
+00055650: 2074 6f20 7468 6520 636f 6f72 6469 6e61   to the coordina
+00055660: 7465 732c 0a20 2020 2020 2020 2020 2020  tes,.           
+00055670: 206f 7220 6120 6d61 7070 696e 6720 6672   or a mapping fr
+00055680: 6f6d 2063 6f6f 7264 696e 6174 6520 6e61  om coordinate na
+00055690: 6d65 2074 6f20 6675 6e63 7469 6f6e 2028  me to function (
+000556a0: 6e61 6d65 292e 0a0a 2020 2020 2020 2020  name)...        
+000556b0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+000556c0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+000556d0: 636f 7265 2e72 6f6c 6c69 6e67 2e44 6174  core.rolling.Dat
+000556e0: 6173 6574 436f 6172 7365 6e0a 0a20 2020  asetCoarsen..   
+000556f0: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+00055700: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+00055710: 2020 2020 2020 2063 6f72 652e 726f 6c6c         core.roll
+00055720: 696e 672e 4461 7461 7365 7443 6f61 7273  ing.DatasetCoars
+00055730: 656e 0a20 2020 2020 2020 2044 6174 6141  en.        DataA
+00055740: 7272 6179 2e63 6f61 7273 656e 0a20 2020  rray.coarsen.   
+00055750: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00055760: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
+00055770: 652e 726f 6c6c 696e 6720 696d 706f 7274  e.rolling import
+00055780: 2044 6174 6173 6574 436f 6172 7365 6e0a   DatasetCoarsen.
+00055790: 0a20 2020 2020 2020 2064 696d 203d 2065  .        dim = e
+000557a0: 6974 6865 725f 6469 6374 5f6f 725f 6b77  ither_dict_or_kw
+000557b0: 6172 6773 2864 696d 2c20 7769 6e64 6f77  args(dim, window
+000557c0: 5f6b 7761 7267 732c 2022 636f 6172 7365  _kwargs, "coarse
+000557d0: 6e22 290a 2020 2020 2020 2020 7265 7475  n").        retu
+000557e0: 726e 2044 6174 6173 6574 436f 6172 7365  rn DatasetCoarse
+000557f0: 6e28 0a20 2020 2020 2020 2020 2020 2073  n(.            s
+00055800: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+00055810: 2064 696d 2c0a 2020 2020 2020 2020 2020   dim,.          
+00055820: 2020 626f 756e 6461 7279 3d62 6f75 6e64    boundary=bound
+00055830: 6172 792c 0a20 2020 2020 2020 2020 2020  ary,.           
+00055840: 2073 6964 653d 7369 6465 2c0a 2020 2020   side=side,.    
+00055850: 2020 2020 2020 2020 636f 6f72 645f 6675          coord_fu
+00055860: 6e63 3d63 6f6f 7264 5f66 756e 632c 0a20  nc=coord_func,. 
+00055870: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00055880: 6620 7265 7361 6d70 6c65 280a 2020 2020  f resample(.    
+00055890: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+000558a0: 2020 696e 6465 7865 723a 204d 6170 7069    indexer: Mappi
+000558b0: 6e67 5b41 6e79 2c20 7374 725d 207c 204e  ng[Any, str] | N
 000558c0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-000558d0: 2020 2020 7265 7374 6f72 655f 636f 6f72      restore_coor
-000558e0: 645f 6469 6d73 3a20 626f 6f6c 207c 204e  d_dims: bool | N
-000558f0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00055900: 2020 2020 2a2a 696e 6465 7865 725f 6b77      **indexer_kw
-00055910: 6172 6773 3a20 7374 722c 0a20 2020 2029  args: str,.    )
-00055920: 202d 3e20 4461 7461 7365 7452 6573 616d   -> DatasetResam
-00055930: 706c 653a 0a20 2020 2020 2020 2022 2222  ple:.        """
-00055940: 5265 7475 726e 7320 6120 5265 7361 6d70  Returns a Resamp
-00055950: 6c65 206f 626a 6563 7420 666f 7220 7065  le object for pe
-00055960: 7266 6f72 6d69 6e67 2072 6573 616d 706c  rforming resampl
-00055970: 696e 6720 6f70 6572 6174 696f 6e73 2e0a  ing operations..
-00055980: 0a20 2020 2020 2020 2048 616e 646c 6573  .        Handles
-00055990: 2062 6f74 6820 646f 776e 7361 6d70 6c69   both downsampli
-000559a0: 6e67 2061 6e64 2075 7073 616d 706c 696e  ng and upsamplin
-000559b0: 672e 2054 6865 2072 6573 616d 706c 6564  g. The resampled
-000559c0: 0a20 2020 2020 2020 2064 696d 656e 7369  .        dimensi
-000559d0: 6f6e 206d 7573 7420 6265 2061 2064 6174  on must be a dat
-000559e0: 6574 696d 652d 6c69 6b65 2063 6f6f 7264  etime-like coord
-000559f0: 696e 6174 652e 2049 6620 616e 7920 696e  inate. If any in
-00055a00: 7465 7276 616c 730a 2020 2020 2020 2020  tervals.        
-00055a10: 636f 6e74 6169 6e20 6e6f 2076 616c 7565  contain no value
-00055a20: 7320 6672 6f6d 2074 6865 206f 7269 6769  s from the origi
-00055a30: 6e61 6c20 6f62 6a65 6374 2c20 7468 6579  nal object, they
-00055a40: 2077 696c 6c20 6265 2067 6976 656e 0a20   will be given. 
-00055a50: 2020 2020 2020 2074 6865 2076 616c 7565         the value
-00055a60: 2060 604e 614e 6060 2e0a 0a20 2020 2020   ``NaN``...     
-00055a70: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00055a80: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00055a90: 0a20 2020 2020 2020 2069 6e64 6578 6572  .        indexer
-00055aa0: 203a 204d 6170 7069 6e67 206f 6620 4861   : Mapping of Ha
-00055ab0: 7368 6162 6c65 2074 6f20 7374 722c 206f  shable to str, o
-00055ac0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00055ad0: 2020 2020 4d61 7070 696e 6720 6672 6f6d      Mapping from
-00055ae0: 2074 6865 2064 696d 656e 7369 6f6e 206e   the dimension n
-00055af0: 616d 6520 746f 2072 6573 616d 706c 6520  ame to resample 
-00055b00: 6672 6571 7565 6e63 7920 5b31 5d5f 2e20  frequency [1]_. 
-00055b10: 5468 650a 2020 2020 2020 2020 2020 2020  The.            
-00055b20: 6469 6d65 6e73 696f 6e20 6d75 7374 2062  dimension must b
-00055b30: 6520 6461 7465 7469 6d65 2d6c 696b 652e  e datetime-like.
-00055b40: 0a20 2020 2020 2020 2073 6b69 706e 6120  .        skipna 
-00055b50: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
-00055b60: 0a20 2020 2020 2020 2020 2020 2057 6865  .            Whe
-00055b70: 7468 6572 2074 6f20 736b 6970 206d 6973  ther to skip mis
-00055b80: 7369 6e67 2076 616c 7565 7320 7768 656e  sing values when
-00055b90: 2061 6767 7265 6761 7469 6e67 2069 6e20   aggregating in 
-00055ba0: 646f 776e 7361 6d70 6c69 6e67 2e0a 2020  downsampling..  
-00055bb0: 2020 2020 2020 636c 6f73 6564 203a 207b        closed : {
-00055bc0: 226c 6566 7422 2c20 2272 6967 6874 227d  "left", "right"}
-00055bd0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00055be0: 2020 2020 2020 2053 6964 6520 6f66 2065         Side of e
-00055bf0: 6163 6820 696e 7465 7276 616c 2074 6f20  ach interval to 
-00055c00: 7472 6561 7420 6173 2063 6c6f 7365 642e  treat as closed.
-00055c10: 0a20 2020 2020 2020 206c 6162 656c 203a  .        label :
-00055c20: 207b 226c 6566 7422 2c20 2272 6967 6874   {"left", "right
-00055c30: 227d 2c20 6f70 7469 6f6e 616c 0a20 2020  "}, optional.   
-00055c40: 2020 2020 2020 2020 2053 6964 6520 6f66           Side of
-00055c50: 2065 6163 6820 696e 7465 7276 616c 2074   each interval t
-00055c60: 6f20 7573 6520 666f 7220 6c61 6265 6c69  o use for labeli
-00055c70: 6e67 2e0a 2020 2020 2020 2020 6261 7365  ng..        base
-00055c80: 203a 2069 6e74 2c20 6f70 7469 6f6e 616c   : int, optional
-00055c90: 0a20 2020 2020 2020 2020 2020 2046 6f72  .            For
-00055ca0: 2066 7265 7175 656e 6369 6573 2074 6861   frequencies tha
-00055cb0: 7420 6576 656e 6c79 2073 7562 6469 7669  t evenly subdivi
-00055cc0: 6465 2031 2064 6179 2c20 7468 6520 226f  de 1 day, the "o
-00055cd0: 7269 6769 6e22 206f 6620 7468 650a 2020  rigin" of the.  
-00055ce0: 2020 2020 2020 2020 2020 6167 6772 6567            aggreg
-00055cf0: 6174 6564 2069 6e74 6572 7661 6c73 2e20  ated intervals. 
-00055d00: 466f 7220 6578 616d 706c 652c 2066 6f72  For example, for
-00055d10: 2022 3234 4822 2066 7265 7175 656e 6379   "24H" frequency
-00055d20: 2c20 6261 7365 2063 6f75 6c64 0a20 2020  , base could.   
-00055d30: 2020 2020 2020 2020 2072 616e 6765 2066           range f
-00055d40: 726f 6d20 3020 7468 726f 7567 6820 3233  rom 0 through 23
-00055d50: 2e0a 2020 2020 2020 2020 6f72 6967 696e  ..        origin
-00055d60: 203a 207b 2765 706f 6368 272c 2027 7374   : {'epoch', 'st
-00055d70: 6172 7427 2c20 2773 7461 7274 5f64 6179  art', 'start_day
-00055d80: 272c 2027 656e 6427 2c20 2765 6e64 5f64  ', 'end', 'end_d
-00055d90: 6179 277d 2c20 7064 2e54 696d 6573 7461  ay'}, pd.Timesta
-00055da0: 6d70 2c20 6461 7465 7469 6d65 2e64 6174  mp, datetime.dat
-00055db0: 6574 696d 652c 206e 702e 6461 7465 7469  etime, np.dateti
-00055dc0: 6d65 3634 2c20 6f72 2063 6674 696d 652e  me64, or cftime.
-00055dd0: 6461 7465 7469 6d65 2c20 6465 6661 756c  datetime, defaul
-00055de0: 7420 2773 7461 7274 5f64 6179 270a 2020  t 'start_day'.  
-00055df0: 2020 2020 2020 2020 2020 5468 6520 6461            The da
-00055e00: 7465 7469 6d65 206f 6e20 7768 6963 6820  tetime on which 
-00055e10: 746f 2061 646a 7573 7420 7468 6520 6772  to adjust the gr
-00055e20: 6f75 7069 6e67 2e20 5468 6520 7469 6d65  ouping. The time
-00055e30: 7a6f 6e65 206f 6620 6f72 6967 696e 0a20  zone of origin. 
-00055e40: 2020 2020 2020 2020 2020 206d 7573 7420             must 
-00055e50: 6d61 7463 6820 7468 6520 7469 6d65 7a6f  match the timezo
-00055e60: 6e65 206f 6620 7468 6520 696e 6465 782e  ne of the index.
-00055e70: 0a0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-00055e80: 2061 2064 6174 6574 696d 6520 6973 206e   a datetime is n
-00055e90: 6f74 2075 7365 642c 2074 6865 7365 2076  ot used, these v
-00055ea0: 616c 7565 7320 6172 6520 616c 736f 2073  alues are also s
-00055eb0: 7570 706f 7274 6564 3a0a 2020 2020 2020  upported:.      
-00055ec0: 2020 2020 2020 2d20 2765 706f 6368 273a        - 'epoch':
-00055ed0: 2060 6f72 6967 696e 6020 6973 2031 3937   `origin` is 197
-00055ee0: 302d 3031 2d30 310a 2020 2020 2020 2020  0-01-01.        
-00055ef0: 2020 2020 2d20 2773 7461 7274 273a 2060      - 'start': `
-00055f00: 6f72 6967 696e 6020 6973 2074 6865 2066  origin` is the f
-00055f10: 6972 7374 2076 616c 7565 206f 6620 7468  irst value of th
-00055f20: 6520 7469 6d65 7365 7269 6573 0a20 2020  e timeseries.   
-00055f30: 2020 2020 2020 2020 202d 2027 7374 6172           - 'star
-00055f40: 745f 6461 7927 3a20 606f 7269 6769 6e60  t_day': `origin`
-00055f50: 2069 7320 7468 6520 6669 7273 7420 6461   is the first da
-00055f60: 7920 6174 206d 6964 6e69 6768 7420 6f66  y at midnight of
-00055f70: 2074 6865 2074 696d 6573 6572 6965 730a   the timeseries.
-00055f80: 2020 2020 2020 2020 2020 2020 2d20 2765              - 'e
-00055f90: 6e64 273a 2060 6f72 6967 696e 6020 6973  nd': `origin` is
-00055fa0: 2074 6865 206c 6173 7420 7661 6c75 6520   the last value 
-00055fb0: 6f66 2074 6865 2074 696d 6573 6572 6965  of the timeserie
-00055fc0: 730a 2020 2020 2020 2020 2020 2020 2d20  s.            - 
-00055fd0: 2765 6e64 5f64 6179 273a 2060 6f72 6967  'end_day': `orig
-00055fe0: 696e 6020 6973 2074 6865 2063 6569 6c69  in` is the ceili
-00055ff0: 6e67 206d 6964 6e69 6768 7420 6f66 2074  ng midnight of t
-00056000: 6865 206c 6173 7420 6461 790a 2020 2020  he last day.    
-00056010: 2020 2020 6f66 6673 6574 203a 2070 642e      offset : pd.
-00056020: 5469 6d65 6465 6c74 612c 2064 6174 6574  Timedelta, datet
-00056030: 696d 652e 7469 6d65 6465 6c74 612c 206f  ime.timedelta, o
-00056040: 7220 7374 722c 2064 6566 6175 6c74 2069  r str, default i
-00056050: 7320 4e6f 6e65 0a20 2020 2020 2020 2020  s None.         
-00056060: 2020 2041 6e20 6f66 6673 6574 2074 696d     An offset tim
-00056070: 6564 656c 7461 2061 6464 6564 2074 6f20  edelta added to 
-00056080: 7468 6520 6f72 6967 696e 2e0a 2020 2020  the origin..    
-00056090: 2020 2020 6c6f 6666 7365 7420 3a20 7469      loffset : ti
-000560a0: 6d65 6465 6c74 6120 6f72 2073 7472 2c20  medelta or str, 
-000560b0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-000560c0: 2020 2020 204f 6666 7365 7420 7573 6564       Offset used
-000560d0: 2074 6f20 6164 6a75 7374 2074 6865 2072   to adjust the r
-000560e0: 6573 616d 706c 6564 2074 696d 6520 6c61  esampled time la
-000560f0: 6265 6c73 2e20 536f 6d65 2070 616e 6461  bels. Some panda
-00056100: 7320 6461 7465 0a20 2020 2020 2020 2020  s date.         
-00056110: 2020 206f 6666 7365 7420 7374 7269 6e67     offset string
-00056120: 7320 6172 6520 7375 7070 6f72 7465 642e  s are supported.
-00056130: 0a20 2020 2020 2020 2072 6573 746f 7265  .        restore
-00056140: 5f63 6f6f 7264 5f64 696d 7320 3a20 626f  _coord_dims : bo
-00056150: 6f6c 2c20 6f70 7469 6f6e 616c 0a20 2020  ol, optional.   
-00056160: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-00056170: 2c20 616c 736f 2072 6573 746f 7265 2074  , also restore t
-00056180: 6865 2064 696d 656e 7369 6f6e 206f 7264  he dimension ord
-00056190: 6572 206f 6620 6d75 6c74 692d 6469 6d65  er of multi-dime
-000561a0: 6e73 696f 6e61 6c0a 2020 2020 2020 2020  nsional.        
-000561b0: 2020 2020 636f 6f72 6469 6e61 7465 732e      coordinates.
-000561c0: 0a20 2020 2020 2020 202a 2a69 6e64 6578  .        **index
-000561d0: 6572 5f6b 7761 7267 7320 3a20 7374 720a  er_kwargs : str.
-000561e0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-000561f0: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-00056200: 7320 666f 726d 206f 6620 6060 696e 6465  s form of ``inde
-00056210: 7865 7260 602e 0a20 2020 2020 2020 2020  xer``..         
-00056220: 2020 204f 6e65 206f 6620 696e 6465 7865     One of indexe
-00056230: 7220 6f72 2069 6e64 6578 6572 5f6b 7761  r or indexer_kwa
-00056240: 7267 7320 6d75 7374 2062 6520 7072 6f76  rgs must be prov
-00056250: 6964 6564 2e0a 0a20 2020 2020 2020 2052  ided...        R
-00056260: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
-00056270: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2072  ------.        r
-00056280: 6573 616d 706c 6564 203a 2063 6f72 652e  esampled : core.
-00056290: 7265 7361 6d70 6c65 2e44 6174 6141 7272  resample.DataArr
-000562a0: 6179 5265 7361 6d70 6c65 0a20 2020 2020  ayResample.     
-000562b0: 2020 2020 2020 2054 6869 7320 6f62 6a65         This obje
-000562c0: 6374 2072 6573 616d 706c 6564 2e0a 0a20  ct resampled... 
-000562d0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-000562e0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-000562f0: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
-00056300: 6179 2e72 6573 616d 706c 650a 2020 2020  ay.resample.    
-00056310: 2020 2020 7061 6e64 6173 2e53 6572 6965      pandas.Serie
-00056320: 732e 7265 7361 6d70 6c65 0a20 2020 2020  s.resample.     
-00056330: 2020 2070 616e 6461 732e 4461 7461 4672     pandas.DataFr
-00056340: 616d 652e 7265 7361 6d70 6c65 0a20 2020  ame.resample.   
-00056350: 2020 2020 2044 6174 6173 6574 2e67 726f       Dataset.gro
-00056360: 7570 6279 0a20 2020 2020 2020 2044 6174  upby.        Dat
-00056370: 6141 7272 6179 2e67 726f 7570 6279 0a0a  aArray.groupby..
-00056380: 2020 2020 2020 2020 5265 6665 7265 6e63          Referenc
-00056390: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
-000563a0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 2e2e  -----.        ..
-000563b0: 205b 315d 2068 7474 703a 2f2f 7061 6e64   [1] http://pand
-000563c0: 6173 2e70 7964 6174 612e 6f72 672f 7061  as.pydata.org/pa
-000563d0: 6e64 6173 2d64 6f63 732f 7374 6162 6c65  ndas-docs/stable
-000563e0: 2f74 696d 6573 6572 6965 732e 6874 6d6c  /timeseries.html
-000563f0: 236f 6666 7365 742d 616c 6961 7365 730a  #offset-aliases.
-00056400: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00056410: 2020 2020 6672 6f6d 2078 6172 7261 792e      from xarray.
-00056420: 636f 7265 2e72 6573 616d 706c 6520 696d  core.resample im
-00056430: 706f 7274 2044 6174 6173 6574 5265 7361  port DatasetResa
-00056440: 6d70 6c65 0a0a 2020 2020 2020 2020 7265  mple..        re
-00056450: 7475 726e 2073 656c 662e 5f72 6573 616d  turn self._resam
-00056460: 706c 6528 0a20 2020 2020 2020 2020 2020  ple(.           
-00056470: 2072 6573 616d 706c 655f 636c 733d 4461   resample_cls=Da
-00056480: 7461 7365 7452 6573 616d 706c 652c 0a20  tasetResample,. 
-00056490: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-000564a0: 6572 3d69 6e64 6578 6572 2c0a 2020 2020  er=indexer,.    
-000564b0: 2020 2020 2020 2020 736b 6970 6e61 3d73          skipna=s
-000564c0: 6b69 706e 612c 0a20 2020 2020 2020 2020  kipna,.         
-000564d0: 2020 2063 6c6f 7365 643d 636c 6f73 6564     closed=closed
-000564e0: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
-000564f0: 6265 6c3d 6c61 6265 6c2c 0a20 2020 2020  bel=label,.     
-00056500: 2020 2020 2020 2062 6173 653d 6261 7365         base=base
-00056510: 2c0a 2020 2020 2020 2020 2020 2020 6f66  ,.            of
-00056520: 6673 6574 3d6f 6666 7365 742c 0a20 2020  fset=offset,.   
-00056530: 2020 2020 2020 2020 206f 7269 6769 6e3d           origin=
-00056540: 6f72 6967 696e 2c0a 2020 2020 2020 2020  origin,.        
-00056550: 2020 2020 6b65 6570 5f61 7474 7273 3d6b      keep_attrs=k
-00056560: 6565 705f 6174 7472 732c 0a20 2020 2020  eep_attrs,.     
-00056570: 2020 2020 2020 206c 6f66 6673 6574 3d6c         loffset=l
-00056580: 6f66 6673 6574 2c0a 2020 2020 2020 2020  offset,.        
-00056590: 2020 2020 7265 7374 6f72 655f 636f 6f72      restore_coor
-000565a0: 645f 6469 6d73 3d72 6573 746f 7265 5f63  d_dims=restore_c
-000565b0: 6f6f 7264 5f64 696d 732c 0a20 2020 2020  oord_dims,.     
-000565c0: 2020 2020 2020 202a 2a69 6e64 6578 6572         **indexer
-000565d0: 5f6b 7761 7267 732c 0a20 2020 2020 2020  _kwargs,.       
-000565e0: 2029 0a                                   ).
+000558d0: 2020 2020 736b 6970 6e61 3a20 626f 6f6c      skipna: bool
+000558e0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+000558f0: 2020 2020 2020 2020 636c 6f73 6564 3a20          closed: 
+00055900: 5369 6465 4f70 7469 6f6e 7320 7c20 4e6f  SideOptions | No
+00055910: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+00055920: 2020 206c 6162 656c 3a20 5369 6465 4f70     label: SideOp
+00055930: 7469 6f6e 7320 7c20 4e6f 6e65 203d 204e  tions | None = N
+00055940: 6f6e 652c 0a20 2020 2020 2020 2062 6173  one,.        bas
+00055950: 653a 2069 6e74 207c 204e 6f6e 6520 3d20  e: int | None = 
+00055960: 4e6f 6e65 2c0a 2020 2020 2020 2020 6f66  None,.        of
+00055970: 6673 6574 3a20 7064 2e54 696d 6564 656c  fset: pd.Timedel
+00055980: 7461 207c 2064 6174 6574 696d 652e 7469  ta | datetime.ti
+00055990: 6d65 6465 6c74 6120 7c20 7374 7220 7c20  medelta | str | 
+000559a0: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+000559b0: 2020 2020 206f 7269 6769 6e3a 2073 7472       origin: str
+000559c0: 207c 2044 6174 6574 696d 654c 696b 6520   | DatetimeLike 
+000559d0: 3d20 2273 7461 7274 5f64 6179 222c 0a20  = "start_day",. 
+000559e0: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
+000559f0: 733a 2062 6f6f 6c20 7c20 4e6f 6e65 203d  s: bool | None =
+00055a00: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
+00055a10: 6f66 6673 6574 3a20 6461 7465 7469 6d65  offset: datetime
+00055a20: 2e74 696d 6564 656c 7461 207c 2073 7472  .timedelta | str
+00055a30: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00055a40: 2020 2020 2020 2020 7265 7374 6f72 655f          restore_
+00055a50: 636f 6f72 645f 6469 6d73 3a20 626f 6f6c  coord_dims: bool
+00055a60: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00055a70: 2020 2020 2020 2020 2a2a 696e 6465 7865          **indexe
+00055a80: 725f 6b77 6172 6773 3a20 7374 722c 0a20  r_kwargs: str,. 
+00055a90: 2020 2029 202d 3e20 4461 7461 7365 7452     ) -> DatasetR
+00055aa0: 6573 616d 706c 653a 0a20 2020 2020 2020  esample:.       
+00055ab0: 2022 2222 5265 7475 726e 7320 6120 5265   """Returns a Re
+00055ac0: 7361 6d70 6c65 206f 626a 6563 7420 666f  sample object fo
+00055ad0: 7220 7065 7266 6f72 6d69 6e67 2072 6573  r performing res
+00055ae0: 616d 706c 696e 6720 6f70 6572 6174 696f  ampling operatio
+00055af0: 6e73 2e0a 0a20 2020 2020 2020 2048 616e  ns...        Han
+00055b00: 646c 6573 2062 6f74 6820 646f 776e 7361  dles both downsa
+00055b10: 6d70 6c69 6e67 2061 6e64 2075 7073 616d  mpling and upsam
+00055b20: 706c 696e 672e 2054 6865 2072 6573 616d  pling. The resam
+00055b30: 706c 6564 0a20 2020 2020 2020 2064 696d  pled.        dim
+00055b40: 656e 7369 6f6e 206d 7573 7420 6265 2061  ension must be a
+00055b50: 2064 6174 6574 696d 652d 6c69 6b65 2063   datetime-like c
+00055b60: 6f6f 7264 696e 6174 652e 2049 6620 616e  oordinate. If an
+00055b70: 7920 696e 7465 7276 616c 730a 2020 2020  y intervals.    
+00055b80: 2020 2020 636f 6e74 6169 6e20 6e6f 2076      contain no v
+00055b90: 616c 7565 7320 6672 6f6d 2074 6865 206f  alues from the o
+00055ba0: 7269 6769 6e61 6c20 6f62 6a65 6374 2c20  riginal object, 
+00055bb0: 7468 6579 2077 696c 6c20 6265 2067 6976  they will be giv
+00055bc0: 656e 0a20 2020 2020 2020 2074 6865 2076  en.        the v
+00055bd0: 616c 7565 2060 604e 614e 6060 2e0a 0a20  alue ``NaN``... 
+00055be0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00055bf0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00055c00: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e64  ----.        ind
+00055c10: 6578 6572 203a 204d 6170 7069 6e67 206f  exer : Mapping o
+00055c20: 6620 4861 7368 6162 6c65 2074 6f20 7374  f Hashable to st
+00055c30: 722c 206f 7074 696f 6e61 6c0a 2020 2020  r, optional.    
+00055c40: 2020 2020 2020 2020 4d61 7070 696e 6720          Mapping 
+00055c50: 6672 6f6d 2074 6865 2064 696d 656e 7369  from the dimensi
+00055c60: 6f6e 206e 616d 6520 746f 2072 6573 616d  on name to resam
+00055c70: 706c 6520 6672 6571 7565 6e63 7920 5b31  ple frequency [1
+00055c80: 5d5f 2e20 5468 650a 2020 2020 2020 2020  ]_. The.        
+00055c90: 2020 2020 6469 6d65 6e73 696f 6e20 6d75      dimension mu
+00055ca0: 7374 2062 6520 6461 7465 7469 6d65 2d6c  st be datetime-l
+00055cb0: 696b 652e 0a20 2020 2020 2020 2073 6b69  ike..        ski
+00055cc0: 706e 6120 3a20 626f 6f6c 2c20 6f70 7469  pna : bool, opti
+00055cd0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00055ce0: 2057 6865 7468 6572 2074 6f20 736b 6970   Whether to skip
+00055cf0: 206d 6973 7369 6e67 2076 616c 7565 7320   missing values 
+00055d00: 7768 656e 2061 6767 7265 6761 7469 6e67  when aggregating
+00055d10: 2069 6e20 646f 776e 7361 6d70 6c69 6e67   in downsampling
+00055d20: 2e0a 2020 2020 2020 2020 636c 6f73 6564  ..        closed
+00055d30: 203a 207b 226c 6566 7422 2c20 2272 6967   : {"left", "rig
+00055d40: 6874 227d 2c20 6f70 7469 6f6e 616c 0a20  ht"}, optional. 
+00055d50: 2020 2020 2020 2020 2020 2053 6964 6520             Side 
+00055d60: 6f66 2065 6163 6820 696e 7465 7276 616c  of each interval
+00055d70: 2074 6f20 7472 6561 7420 6173 2063 6c6f   to treat as clo
+00055d80: 7365 642e 0a20 2020 2020 2020 206c 6162  sed..        lab
+00055d90: 656c 203a 207b 226c 6566 7422 2c20 2272  el : {"left", "r
+00055da0: 6967 6874 227d 2c20 6f70 7469 6f6e 616c  ight"}, optional
+00055db0: 0a20 2020 2020 2020 2020 2020 2053 6964  .            Sid
+00055dc0: 6520 6f66 2065 6163 6820 696e 7465 7276  e of each interv
+00055dd0: 616c 2074 6f20 7573 6520 666f 7220 6c61  al to use for la
+00055de0: 6265 6c69 6e67 2e0a 2020 2020 2020 2020  beling..        
+00055df0: 6261 7365 203a 2069 6e74 2c20 6f70 7469  base : int, opti
+00055e00: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00055e10: 2046 6f72 2066 7265 7175 656e 6369 6573   For frequencies
+00055e20: 2074 6861 7420 6576 656e 6c79 2073 7562   that evenly sub
+00055e30: 6469 7669 6465 2031 2064 6179 2c20 7468  divide 1 day, th
+00055e40: 6520 226f 7269 6769 6e22 206f 6620 7468  e "origin" of th
+00055e50: 650a 2020 2020 2020 2020 2020 2020 6167  e.            ag
+00055e60: 6772 6567 6174 6564 2069 6e74 6572 7661  gregated interva
+00055e70: 6c73 2e20 466f 7220 6578 616d 706c 652c  ls. For example,
+00055e80: 2066 6f72 2022 3234 4822 2066 7265 7175   for "24H" frequ
+00055e90: 656e 6379 2c20 6261 7365 2063 6f75 6c64  ency, base could
+00055ea0: 0a20 2020 2020 2020 2020 2020 2072 616e  .            ran
+00055eb0: 6765 2066 726f 6d20 3020 7468 726f 7567  ge from 0 throug
+00055ec0: 6820 3233 2e0a 2020 2020 2020 2020 6f72  h 23..        or
+00055ed0: 6967 696e 203a 207b 2765 706f 6368 272c  igin : {'epoch',
+00055ee0: 2027 7374 6172 7427 2c20 2773 7461 7274   'start', 'start
+00055ef0: 5f64 6179 272c 2027 656e 6427 2c20 2765  _day', 'end', 'e
+00055f00: 6e64 5f64 6179 277d 2c20 7064 2e54 696d  nd_day'}, pd.Tim
+00055f10: 6573 7461 6d70 2c20 6461 7465 7469 6d65  estamp, datetime
+00055f20: 2e64 6174 6574 696d 652c 206e 702e 6461  .datetime, np.da
+00055f30: 7465 7469 6d65 3634 2c20 6f72 2063 6674  tetime64, or cft
+00055f40: 696d 652e 6461 7465 7469 6d65 2c20 6465  ime.datetime, de
+00055f50: 6661 756c 7420 2773 7461 7274 5f64 6179  fault 'start_day
+00055f60: 270a 2020 2020 2020 2020 2020 2020 5468  '.            Th
+00055f70: 6520 6461 7465 7469 6d65 206f 6e20 7768  e datetime on wh
+00055f80: 6963 6820 746f 2061 646a 7573 7420 7468  ich to adjust th
+00055f90: 6520 6772 6f75 7069 6e67 2e20 5468 6520  e grouping. The 
+00055fa0: 7469 6d65 7a6f 6e65 206f 6620 6f72 6967  timezone of orig
+00055fb0: 696e 0a20 2020 2020 2020 2020 2020 206d  in.            m
+00055fc0: 7573 7420 6d61 7463 6820 7468 6520 7469  ust match the ti
+00055fd0: 6d65 7a6f 6e65 206f 6620 7468 6520 696e  mezone of the in
+00055fe0: 6465 782e 0a0a 2020 2020 2020 2020 2020  dex...          
+00055ff0: 2020 4966 2061 2064 6174 6574 696d 6520    If a datetime 
+00056000: 6973 206e 6f74 2075 7365 642c 2074 6865  is not used, the
+00056010: 7365 2076 616c 7565 7320 6172 6520 616c  se values are al
+00056020: 736f 2073 7570 706f 7274 6564 3a0a 2020  so supported:.  
+00056030: 2020 2020 2020 2020 2020 2d20 2765 706f            - 'epo
+00056040: 6368 273a 2060 6f72 6967 696e 6020 6973  ch': `origin` is
+00056050: 2031 3937 302d 3031 2d30 310a 2020 2020   1970-01-01.    
+00056060: 2020 2020 2020 2020 2d20 2773 7461 7274          - 'start
+00056070: 273a 2060 6f72 6967 696e 6020 6973 2074  ': `origin` is t
+00056080: 6865 2066 6972 7374 2076 616c 7565 206f  he first value o
+00056090: 6620 7468 6520 7469 6d65 7365 7269 6573  f the timeseries
+000560a0: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
+000560b0: 7374 6172 745f 6461 7927 3a20 606f 7269  start_day': `ori
+000560c0: 6769 6e60 2069 7320 7468 6520 6669 7273  gin` is the firs
+000560d0: 7420 6461 7920 6174 206d 6964 6e69 6768  t day at midnigh
+000560e0: 7420 6f66 2074 6865 2074 696d 6573 6572  t of the timeser
+000560f0: 6965 730a 2020 2020 2020 2020 2020 2020  ies.            
+00056100: 2d20 2765 6e64 273a 2060 6f72 6967 696e  - 'end': `origin
+00056110: 6020 6973 2074 6865 206c 6173 7420 7661  ` is the last va
+00056120: 6c75 6520 6f66 2074 6865 2074 696d 6573  lue of the times
+00056130: 6572 6965 730a 2020 2020 2020 2020 2020  eries.          
+00056140: 2020 2d20 2765 6e64 5f64 6179 273a 2060    - 'end_day': `
+00056150: 6f72 6967 696e 6020 6973 2074 6865 2063  origin` is the c
+00056160: 6569 6c69 6e67 206d 6964 6e69 6768 7420  eiling midnight 
+00056170: 6f66 2074 6865 206c 6173 7420 6461 790a  of the last day.
+00056180: 2020 2020 2020 2020 6f66 6673 6574 203a          offset :
+00056190: 2070 642e 5469 6d65 6465 6c74 612c 2064   pd.Timedelta, d
+000561a0: 6174 6574 696d 652e 7469 6d65 6465 6c74  atetime.timedelt
+000561b0: 612c 206f 7220 7374 722c 2064 6566 6175  a, or str, defau
+000561c0: 6c74 2069 7320 4e6f 6e65 0a20 2020 2020  lt is None.     
+000561d0: 2020 2020 2020 2041 6e20 6f66 6673 6574         An offset
+000561e0: 2074 696d 6564 656c 7461 2061 6464 6564   timedelta added
+000561f0: 2074 6f20 7468 6520 6f72 6967 696e 2e0a   to the origin..
+00056200: 2020 2020 2020 2020 6c6f 6666 7365 7420          loffset 
+00056210: 3a20 7469 6d65 6465 6c74 6120 6f72 2073  : timedelta or s
+00056220: 7472 2c20 6f70 7469 6f6e 616c 0a20 2020  tr, optional.   
+00056230: 2020 2020 2020 2020 204f 6666 7365 7420           Offset 
+00056240: 7573 6564 2074 6f20 6164 6a75 7374 2074  used to adjust t
+00056250: 6865 2072 6573 616d 706c 6564 2074 696d  he resampled tim
+00056260: 6520 6c61 6265 6c73 2e20 536f 6d65 2070  e labels. Some p
+00056270: 616e 6461 7320 6461 7465 0a20 2020 2020  andas date.     
+00056280: 2020 2020 2020 206f 6666 7365 7420 7374         offset st
+00056290: 7269 6e67 7320 6172 6520 7375 7070 6f72  rings are suppor
+000562a0: 7465 642e 0a20 2020 2020 2020 2072 6573  ted..        res
+000562b0: 746f 7265 5f63 6f6f 7264 5f64 696d 7320  tore_coord_dims 
+000562c0: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
+000562d0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+000562e0: 5472 7565 2c20 616c 736f 2072 6573 746f  True, also resto
+000562f0: 7265 2074 6865 2064 696d 656e 7369 6f6e  re the dimension
+00056300: 206f 7264 6572 206f 6620 6d75 6c74 692d   order of multi-
+00056310: 6469 6d65 6e73 696f 6e61 6c0a 2020 2020  dimensional.    
+00056320: 2020 2020 2020 2020 636f 6f72 6469 6e61          coordina
+00056330: 7465 732e 0a20 2020 2020 2020 202a 2a69  tes..        **i
+00056340: 6e64 6578 6572 5f6b 7761 7267 7320 3a20  ndexer_kwargs : 
+00056350: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
+00056360: 5468 6520 6b65 7977 6f72 6420 6172 6775  The keyword argu
+00056370: 6d65 6e74 7320 666f 726d 206f 6620 6060  ments form of ``
+00056380: 696e 6465 7865 7260 602e 0a20 2020 2020  indexer``..     
+00056390: 2020 2020 2020 204f 6e65 206f 6620 696e         One of in
+000563a0: 6465 7865 7220 6f72 2069 6e64 6578 6572  dexer or indexer
+000563b0: 5f6b 7761 7267 7320 6d75 7374 2062 6520  _kwargs must be 
+000563c0: 7072 6f76 6964 6564 2e0a 0a20 2020 2020  provided...     
+000563d0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+000563e0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+000563f0: 2020 2072 6573 616d 706c 6564 203a 2063     resampled : c
+00056400: 6f72 652e 7265 7361 6d70 6c65 2e44 6174  ore.resample.Dat
+00056410: 6141 7272 6179 5265 7361 6d70 6c65 0a20  aArrayResample. 
+00056420: 2020 2020 2020 2020 2020 2054 6869 7320             This 
+00056430: 6f62 6a65 6374 2072 6573 616d 706c 6564  object resampled
+00056440: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
+00056450: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+00056460: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
+00056470: 6141 7272 6179 2e72 6573 616d 706c 650a  aArray.resample.
+00056480: 2020 2020 2020 2020 7061 6e64 6173 2e53          pandas.S
+00056490: 6572 6965 732e 7265 7361 6d70 6c65 0a20  eries.resample. 
+000564a0: 2020 2020 2020 2070 616e 6461 732e 4461         pandas.Da
+000564b0: 7461 4672 616d 652e 7265 7361 6d70 6c65  taFrame.resample
+000564c0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+000564d0: 2e67 726f 7570 6279 0a20 2020 2020 2020  .groupby.       
+000564e0: 2044 6174 6141 7272 6179 2e67 726f 7570   DataArray.group
+000564f0: 6279 0a0a 2020 2020 2020 2020 5265 6665  by..        Refe
+00056500: 7265 6e63 6573 0a20 2020 2020 2020 202d  rences.        -
+00056510: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00056520: 2020 2e2e 205b 315d 2068 7474 703a 2f2f    .. [1] http://
+00056530: 7061 6e64 6173 2e70 7964 6174 612e 6f72  pandas.pydata.or
+00056540: 672f 7061 6e64 6173 2d64 6f63 732f 7374  g/pandas-docs/st
+00056550: 6162 6c65 2f74 696d 6573 6572 6965 732e  able/timeseries.
+00056560: 6874 6d6c 236f 6666 7365 742d 616c 6961  html#offset-alia
+00056570: 7365 730a 2020 2020 2020 2020 2222 220a  ses.        """.
+00056580: 2020 2020 2020 2020 6672 6f6d 2078 6172          from xar
+00056590: 7261 792e 636f 7265 2e72 6573 616d 706c  ray.core.resampl
+000565a0: 6520 696d 706f 7274 2044 6174 6173 6574  e import Dataset
+000565b0: 5265 7361 6d70 6c65 0a0a 2020 2020 2020  Resample..      
+000565c0: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+000565d0: 6573 616d 706c 6528 0a20 2020 2020 2020  esample(.       
+000565e0: 2020 2020 2072 6573 616d 706c 655f 636c       resample_cl
+000565f0: 733d 4461 7461 7365 7452 6573 616d 706c  s=DatasetResampl
+00056600: 652c 0a20 2020 2020 2020 2020 2020 2069  e,.            i
+00056610: 6e64 6578 6572 3d69 6e64 6578 6572 2c0a  ndexer=indexer,.
+00056620: 2020 2020 2020 2020 2020 2020 736b 6970              skip
+00056630: 6e61 3d73 6b69 706e 612c 0a20 2020 2020  na=skipna,.     
+00056640: 2020 2020 2020 2063 6c6f 7365 643d 636c         closed=cl
+00056650: 6f73 6564 2c0a 2020 2020 2020 2020 2020  osed,.          
+00056660: 2020 6c61 6265 6c3d 6c61 6265 6c2c 0a20    label=label,. 
+00056670: 2020 2020 2020 2020 2020 2062 6173 653d             base=
+00056680: 6261 7365 2c0a 2020 2020 2020 2020 2020  base,.          
+00056690: 2020 6f66 6673 6574 3d6f 6666 7365 742c    offset=offset,
+000566a0: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
+000566b0: 6769 6e3d 6f72 6967 696e 2c0a 2020 2020  gin=origin,.    
+000566c0: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
+000566d0: 7273 3d6b 6565 705f 6174 7472 732c 0a20  rs=keep_attrs,. 
+000566e0: 2020 2020 2020 2020 2020 206c 6f66 6673             loffs
+000566f0: 6574 3d6c 6f66 6673 6574 2c0a 2020 2020  et=loffset,.    
+00056700: 2020 2020 2020 2020 7265 7374 6f72 655f          restore_
+00056710: 636f 6f72 645f 6469 6d73 3d72 6573 746f  coord_dims=resto
+00056720: 7265 5f63 6f6f 7264 5f64 696d 732c 0a20  re_coord_dims,. 
+00056730: 2020 2020 2020 2020 2020 202a 2a69 6e64             **ind
+00056740: 6578 6572 5f6b 7761 7267 732c 0a20 2020  exer_kwargs,.   
+00056750: 2020 2020 2029 0a                             ).
```

### Comparing `xarray-2023.3.0/xarray/core/dtypes.py` & `xarray-2023.4.0/xarray/core/dtypes.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/duck_array_ops.py` & `xarray-2023.4.0/xarray/core/duck_array_ops.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/extensions.py` & `xarray-2023.4.0/xarray/core/extensions.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/formatting.py` & `xarray-2023.4.0/xarray/core/formatting.py`

 * *Files 4% similar despite different names*

```diff
@@ -12,15 +12,15 @@
 from reprlib import recursive_repr
 
 import numpy as np
 import pandas as pd
 from pandas.errors import OutOfBoundsDatetime
 
 from xarray.core.duck_array_ops import array_equiv
-from xarray.core.indexing import MemoryCachedArray
+from xarray.core.indexing import ExplicitlyIndexed, MemoryCachedArray
 from xarray.core.options import OPTIONS, _get_boolean_with_default
 from xarray.core.pycompat import array_type
 from xarray.core.utils import is_duck_array
 
 
 def pretty_print(x, numchars: int):
     """Given an object `x`, call `str(x)` and format the returned string so
@@ -110,17 +110,17 @@
 def calc_max_rows_last(max_rows: int) -> int:
     """Calculate the last rows to maintain the max number of rows."""
     return max_rows // 2
 
 
 def format_timestamp(t):
     """Cast given object to a Timestamp and return a nicely formatted string"""
-    # Timestamp is only valid for 1678 to 2262
     try:
-        datetime_str = str(pd.Timestamp(t))
+        timestamp = pd.Timestamp(t)
+        datetime_str = timestamp.isoformat(sep=" ")
     except OutOfBoundsDatetime:
         datetime_str = str(t)
 
     try:
         date_str, time_str = datetime_str.split()
     except ValueError:
         # catch NaT and others that don't split nicely
@@ -553,16 +553,23 @@
     """
     lines = string.splitlines()
     if len(lines) > limit:
         string = "\n".join(chain(lines[: limit // 2], ["..."], lines[-limit // 2 :]))
     return string
 
 
-def short_numpy_repr(array):
-    array = np.asarray(array)
+def short_array_repr(array):
+    from xarray.core.common import AbstractArray
+
+    if isinstance(array, ExplicitlyIndexed):
+        array = array.get_duck_array()
+    elif isinstance(array, AbstractArray):
+        array = array.data
+    if not is_duck_array(array):
+        array = np.asarray(array)
 
     # default to lower precision so a full (abbreviated) line can fit on
     # one line with the default display_width
     options = {
         "precision": 6,
         "linewidth": OPTIONS["display_width"],
         "threshold": OPTIONS["display_values_threshold"],
@@ -578,19 +585,19 @@
         return repr(array)
 
 
 def short_data_repr(array):
     """Format "data" for DataArray and Variable."""
     internal_data = getattr(array, "variable", array)._data
     if isinstance(array, np.ndarray):
-        return short_numpy_repr(array)
+        return short_array_repr(array)
     elif is_duck_array(internal_data):
         return limit_lines(repr(array.data), limit=40)
     elif array._in_memory:
-        return short_numpy_repr(array)
+        return short_array_repr(array)
     else:
         # internal xarray array type
         return f"[{array.size} values with dtype={array.dtype}]"
 
 
 @recursive_repr("<recursive array>")
 def array_repr(arr):
@@ -827,15 +834,15 @@
     summary.append(diff_dim_summary(a, b))
     if callable(compat):
         equiv = compat
     else:
         equiv = array_equiv
 
     if not equiv(a.data, b.data):
-        temp = [wrap_indent(short_numpy_repr(obj), start="    ") for obj in (a, b)]
+        temp = [wrap_indent(short_array_repr(obj), start="    ") for obj in (a, b)]
         diff_data_repr = [
             ab_side + "\n" + ab_data_repr
             for ab_side, ab_data_repr in zip(("L", "R"), temp)
         ]
         summary += ["Differing values:"] + diff_data_repr
 
     if hasattr(a, "coords"):
```

### Comparing `xarray-2023.3.0/xarray/core/formatting_html.py` & `xarray-2023.4.0/xarray/core/formatting_html.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 from __future__ import annotations
 
 import uuid
 from collections import OrderedDict
 from functools import lru_cache, partial
 from html import escape
-from importlib.resources import read_binary
+from importlib.resources import files
 
 from xarray.core.formatting import (
     inline_index_repr,
     inline_variable_array_repr,
     short_data_repr,
 )
 from xarray.core.options import _get_boolean_with_default
@@ -19,15 +19,15 @@
 )
 
 
 @lru_cache(None)
 def _load_static_files():
     """Lazily load the resource files into memory the first time they are needed"""
     return [
-        read_binary(package, resource).decode("utf-8")
+        files(package).joinpath(resource).read_text(encoding="utf-8")
         for package, resource in STATIC_FILES
     ]
 
 
 def short_data_repr_html(array):
     """Format "data" for DataArray and Variable."""
     internal_data = getattr(array, "variable", array)._data
```

### Comparing `xarray-2023.3.0/xarray/core/groupby.py` & `xarray-2023.4.0/xarray/core/groupby.py`

 * *Files 7% similar despite different names*

```diff
@@ -41,29 +41,32 @@
     from xarray.core.dataarray import DataArray
     from xarray.core.dataset import Dataset
     from xarray.core.types import DatetimeLike, SideOptions
     from xarray.core.utils import Frozen
 
     GroupKey = Any
 
+    T_GroupIndicesListInt = list[list[int]]
+    T_GroupIndices = Union[T_GroupIndicesListInt, list[slice], np.ndarray]
+
 
 def check_reduce_dims(reduce_dims, dimensions):
     if reduce_dims is not ...:
         if is_scalar(reduce_dims):
             reduce_dims = [reduce_dims]
         if any(dim not in dimensions for dim in reduce_dims):
             raise ValueError(
                 f"cannot reduce over dimensions {reduce_dims!r}. expected either '...' "
                 f"to reduce over all dimensions or one or more of {dimensions!r}."
             )
 
 
 def unique_value_groups(
     ar, sort: bool = True
-) -> tuple[np.ndarray | pd.Index, list[list[int]]]:
+) -> tuple[np.ndarray | pd.Index, T_GroupIndices, np.ndarray]:
     """Group an array by its unique values.
 
     Parameters
     ----------
     ar : array-like
         Input array. This will be flattened if it is not already 1-D.
     sort : bool, default: True
@@ -76,20 +79,24 @@
     indices : list of lists of int
         Each element provides the integer indices in `ar` with values given by
         the corresponding value in `unique_values`.
     """
     inverse, values = pd.factorize(ar, sort=sort)
     if isinstance(values, pd.MultiIndex):
         values.names = ar.names
-    groups: list[list[int]] = [[] for _ in range(len(values))]
+    groups = _codes_to_groups(inverse, len(values))
+    return values, groups, inverse
+
+
+def _codes_to_groups(inverse: np.ndarray, N: int) -> T_GroupIndicesListInt:
+    groups: T_GroupIndicesListInt = [[] for _ in range(N)]
     for n, g in enumerate(inverse):
         if g >= 0:
-            # pandas uses -1 to mark NaN, but doesn't include them in values
             groups[g].append(n)
-    return values, groups
+    return groups
 
 
 def _dummy_copy(xarray_obj):
     from xarray.core.dataarray import DataArray
     from xarray.core.dataset import Dataset
 
     if isinstance(xarray_obj, Dataset):
@@ -143,15 +150,15 @@
             result[-1] = last_slice
         else:
             result.append(slice_)
             last_slice = slice_
     return result
 
 
-def _inverse_permutation_indices(positions):
+def _inverse_permutation_indices(positions, N: int | None = None) -> np.ndarray | None:
     """Like inverse_permutation, but also handles slices.
 
     Parameters
     ----------
     positions : list of ndarray or slice
         If slice objects, all are assumed to be slices.
 
@@ -164,15 +171,16 @@
 
     if isinstance(positions[0], slice):
         positions = _consolidate_slices(positions)
         if positions == slice(None):
             return None
         positions = [np.arange(sl.start, sl.stop, sl.step) for sl in positions]
 
-    return nputils.inverse_permutation(np.concatenate(positions))
+    newpositions = nputils.inverse_permutation(np.concatenate(positions), N)
+    return newpositions[newpositions != -1]
 
 
 class _DummyGroup:
     """Class for keeping track of grouped dimensions without coordinates.
 
     Should not be user visible.
     """
@@ -205,14 +213,17 @@
         return (self.size,)
 
     def __getitem__(self, key):
         if isinstance(key, tuple):
             key = key[0]
         return self.values[key]
 
+    def copy(self, deep: bool = True, data: Any = None):
+        raise NotImplementedError
+
 
 T_Group = TypeVar("T_Group", bound=Union["DataArray", "IndexVariable", _DummyGroup])
 
 
 def _ensure_1d(
     group: T_Group, obj: T_Xarray
 ) -> tuple[T_Group, T_Xarray, Hashable | None, list[Hashable]]:
@@ -279,14 +290,101 @@
         and len(result.index) > 0
     )
 
     if needs_offset:
         result.index = result.index + loffset
 
 
+def _get_index_and_items(index, grouper):
+    first_items, codes = grouper.first_items(index)
+    full_index = first_items.index
+    if first_items.isnull().any():
+        first_items = first_items.dropna()
+    return full_index, first_items, codes
+
+
+def _factorize_grouper(
+    group, grouper
+) -> tuple[
+    DataArray | IndexVariable | _DummyGroup,
+    T_GroupIndices,
+    np.ndarray,
+    pd.Index,
+]:
+    index = safe_cast_to_index(group)
+    if not index.is_monotonic_increasing:
+        # TODO: sort instead of raising an error
+        raise ValueError("index must be monotonic for resampling")
+    full_index, first_items, codes = _get_index_and_items(index, grouper)
+    sbins = first_items.values.astype(np.int64)
+    group_indices: T_GroupIndices = [
+        slice(i, j) for i, j in zip(sbins[:-1], sbins[1:])
+    ] + [slice(sbins[-1], None)]
+    unique_coord = IndexVariable(group.name, first_items.index)
+    return unique_coord, group_indices, codes, full_index
+
+
+def _factorize_bins(
+    group, bins, cut_kwargs: Mapping | None
+) -> tuple[IndexVariable, T_GroupIndices, np.ndarray, pd.IntervalIndex, DataArray]:
+    from xarray.core.dataarray import DataArray
+
+    if cut_kwargs is None:
+        cut_kwargs = {}
+
+    if duck_array_ops.isnull(bins).all():
+        raise ValueError("All bin edges are NaN.")
+    binned, bins = pd.cut(group.values, bins, **cut_kwargs, retbins=True)
+    codes = binned.codes
+    if (codes == -1).all():
+        raise ValueError(f"None of the data falls within bins with edges {bins!r}")
+    full_index = binned.categories
+    unique_values = binned.unique().dropna()
+    group_indices = [g for g in _codes_to_groups(codes, len(full_index)) if g]
+
+    if len(group_indices) == 0:
+        raise ValueError(f"None of the data falls within bins with edges {bins!r}")
+
+    new_dim_name = str(group.name) + "_bins"
+    group_ = DataArray(binned, getattr(group, "coords", None), name=new_dim_name)
+    unique_coord = IndexVariable(new_dim_name, unique_values)
+    return unique_coord, group_indices, codes, full_index, group_
+
+
+def _factorize_rest(
+    group,
+) -> tuple[IndexVariable, T_GroupIndices, np.ndarray]:
+    # look through group to find the unique values
+    group_as_index = safe_cast_to_index(group)
+    sort = not isinstance(group_as_index, pd.MultiIndex)
+    unique_values, group_indices, codes = unique_value_groups(group_as_index, sort=sort)
+    if len(group_indices) == 0:
+        raise ValueError(
+            "Failed to group data. Are you grouping by a variable that is all NaN?"
+        )
+    unique_coord = IndexVariable(group.name, unique_values)
+    return unique_coord, group_indices, codes
+
+
+def _factorize_dummy(
+    group, squeeze: bool
+) -> tuple[IndexVariable, T_GroupIndices, np.ndarray]:
+    # no need to factorize
+    group_indices: T_GroupIndices
+    if not squeeze:
+        # use slices to do views instead of fancy indexing
+        # equivalent to: group_indices = group_indices.reshape(-1, 1)
+        group_indices = [slice(i, i + 1) for i in range(group.size)]
+    else:
+        group_indices = np.arange(group.size)
+    codes = np.arange(group.size)
+    unique_coord = group
+    return unique_coord, group_indices, codes
+
+
 class GroupBy(Generic[T_Xarray]):
     """A object that implements the split-apply-combine pattern.
 
     Modeled after `pandas.GroupBy`. The `GroupBy` object can be iterated over
     (unique_value, grouped_array) pairs, but the main way to interact with a
     groupby object are with the `apply` or `reduce` methods. You can also
     directly call numpy methods like `mean` or `std`.
@@ -314,14 +412,15 @@
         "_dims",
         "_sizes",
         "_squeeze",
         # Save unstacked object for flox
         "_original_obj",
         "_original_group",
         "_bins",
+        "_codes",
     )
     _obj: T_Xarray
 
     def __init__(
         self,
         obj: T_Xarray,
         group: Hashable | DataArray | IndexVariable,
@@ -351,16 +450,14 @@
         restore_coord_dims : bool, default: True
             If True, also restore the dimension order of multi-dimensional
             coordinates.
         cut_kwargs : dict-like, optional
             Extra keyword arguments to pass to `pandas.cut`
 
         """
-        if cut_kwargs is None:
-            cut_kwargs = {}
         from xarray.core.dataarray import DataArray
 
         if grouper is not None and bins is not None:
             raise TypeError("can't specify both `grouper` and `bins`")
 
         if not isinstance(group, (DataArray, IndexVariable)):
             if not hashable(group):
@@ -391,84 +488,47 @@
         if group.size != expected_size:
             raise ValueError(
                 "the group variable's length does not "
                 "match the length of this variable along its "
                 "dimension"
             )
 
-        full_index = None
-
-        if bins is not None:
-            if duck_array_ops.isnull(bins).all():
-                raise ValueError("All bin edges are NaN.")
-            binned, bins = pd.cut(group.values, bins, **cut_kwargs, retbins=True)
-            new_dim_name = str(group.name) + "_bins"
-            group = DataArray(binned, getattr(group, "coords", None), name=new_dim_name)
-            full_index = binned.categories
-
-        group_indices: list[slice] | list[list[int]] | np.ndarray
-        unique_coord: DataArray | IndexVariable | _DummyGroup
+        self._codes: DataArray
         if grouper is not None:
-            index = safe_cast_to_index(group)
-            if not index.is_monotonic_increasing:
-                # TODO: sort instead of raising an error
-                raise ValueError("index must be monotonic for resampling")
-            full_index, first_items = self._get_index_and_items(index, grouper)
-            sbins = first_items.values.astype(np.int64)
-            group_indices = [slice(i, j) for i, j in zip(sbins[:-1], sbins[1:])] + [
-                slice(sbins[-1], None)
-            ]
-            unique_coord = IndexVariable(group.name, first_items.index)
+            unique_coord, group_indices, codes, full_index = _factorize_grouper(
+                group, grouper
+            )
+            self._codes = group.copy(data=codes)
+        elif bins is not None:
+            unique_coord, group_indices, codes, full_index, group = _factorize_bins(
+                group, bins, cut_kwargs
+            )
+            self._codes = group.copy(data=codes)
         elif group.dims == (group.name,) and _unique_and_monotonic(group):
-            # no need to factorize
-            if not squeeze:
-                # use slices to do views instead of fancy indexing
-                # equivalent to: group_indices = group_indices.reshape(-1, 1)
-                group_indices = [slice(i, i + 1) for i in range(group.size)]
-            else:
-                group_indices = np.arange(group.size)
-            unique_coord = group
+            unique_coord, group_indices, codes = _factorize_dummy(group, squeeze)
+            full_index = None
+            self._codes = obj[group.name].copy(data=codes)
         else:
-            if isinstance(group, DataArray) and group.isnull().any():
-                # drop any NaN valued groups.
-                # also drop obj values where group was NaN
-                # Use where instead of reindex to account for duplicate coordinate labels.
-                obj = obj.where(group.notnull(), drop=True)
-                group = group.dropna(group_dim)
-
-            # look through group to find the unique values
-            group_as_index = safe_cast_to_index(group)
-            sort = bins is None and (not isinstance(group_as_index, pd.MultiIndex))
-            unique_values, group_indices = unique_value_groups(
-                group_as_index, sort=sort
-            )
-            unique_coord = IndexVariable(group.name, unique_values)
-
-        if len(group_indices) == 0:
-            if bins is not None:
-                raise ValueError(
-                    f"None of the data falls within bins with edges {bins!r}"
-                )
-            else:
-                raise ValueError(
-                    "Failed to group data. Are you grouping by a variable that is all NaN?"
-                )
+            unique_coord, group_indices, codes = _factorize_rest(group)
+            full_index = None
+            self._codes = group.copy(data=codes)
 
         # specification for the groupby operation
         self._obj: T_Xarray = obj
         self._group = group
         self._group_dim = group_dim
         self._group_indices = group_indices
         self._unique_coord = unique_coord
         self._stacked_dim = stacked_dim
         self._inserted_dims = inserted_dims
         self._full_index = full_index
         self._restore_coord_dims = restore_coord_dims
         self._bins = bins
         self._squeeze = squeeze
+        self._codes = self._maybe_unstack(self._codes)
 
         # cached attributes
         self._groups: dict[GroupKey, slice | int | list[int]] | None = None
         self._dims: tuple[Hashable, ...] | Frozen[Hashable, int] | None = None
         self._sizes: Frozen[Hashable, int] | None = None
 
     @property
@@ -537,21 +597,14 @@
         return "{}, grouped over {!r}\n{!r} groups with labels {}.".format(
             self.__class__.__name__,
             self._unique_coord.name,
             self._unique_coord.size,
             ", ".join(format_array_flat(self._unique_coord, 30).split()),
         )
 
-    def _get_index_and_items(self, index, grouper):
-        first_items = grouper.first_items(index)
-        full_index = first_items.index
-        if first_items.isnull().any():
-            first_items = first_items.dropna()
-        return full_index, first_items
-
     def _iter_grouped(self) -> Iterator[T_Xarray]:
         """Iterate over each element in this group"""
         for indices in self._group_indices:
             yield self._obj.isel({self._group_dim: indices})
 
     def _infer_concat_args(self, applied_example):
         if self._group_dim in applied_example.dims:
@@ -568,56 +621,59 @@
 
     def _binary_op(self, other, f, reflexive=False):
         from xarray.core.dataarray import DataArray
         from xarray.core.dataset import Dataset
 
         g = f if not reflexive else lambda x, y: f(y, x)
 
-        if self._bins is None:
-            obj = self._original_obj
-            group = self._original_group
-            dims = group.dims
-        else:
-            obj = self._maybe_unstack(self._obj)
-            group = self._maybe_unstack(self._group)
-            dims = (self._group_dim,)
+        obj = self._original_obj
+        group = self._original_group
+        codes = self._codes
+        dims = group.dims
 
         if isinstance(group, _DummyGroup):
             group = obj[group.name]
             coord = group
         else:
             coord = self._unique_coord
             if not isinstance(coord, DataArray):
                 coord = DataArray(self._unique_coord)
-        name = group.name
+        name = self._group.name
 
         if not isinstance(other, (Dataset, DataArray)):
             raise TypeError(
                 "GroupBy objects only support binary ops "
                 "when the other argument is a Dataset or "
                 "DataArray"
             )
 
         if name not in other.dims:
             raise ValueError(
                 "incompatible dimensions for a grouped "
                 f"binary operation: the group variable {name!r} "
-                "is not a dimension on the other argument"
+                "is not a dimension on the other argument "
+                f"with dimensions {other.dims!r}"
             )
 
         # Broadcast out scalars for backwards compatibility
         # TODO: get rid of this when fixing GH2145
         for var in other.coords:
             if other[var].ndim == 0:
                 other[var] = (
                     other[var].drop_vars(var).expand_dims({name: other.sizes[name]})
                 )
 
+        # need to handle NaNs in group or elements that don't belong to any bins
+        mask = codes == -1
+        if mask.any():
+            obj = obj.where(~mask, drop=True)
+            codes = codes.where(~mask, drop=True).astype(int)
+
         other, _ = align(other, coord, join="outer")
-        expanded = other.sel({name: group})
+        expanded = other.isel({name: codes})
 
         result = g(obj, expanded)
 
         if group.ndim > 1:
             # backcompat:
             # TODO: get rid of this when fixing GH2145
             for var in set(obj.coords) - set(obj.xindexes):
@@ -659,22 +715,23 @@
     ):
         """Adaptor function that translates our groupby API to that of flox."""
         from flox.xarray import xarray_reduce
 
         from xarray.core.dataset import Dataset
 
         obj = self._original_obj
+        group = self._original_group
 
         if keep_attrs is None:
             keep_attrs = _get_keep_attrs(default=True)
 
         # preserve current strategy (approximately) for dask groupby.
         # We want to control the default anyway to prevent surprises
         # if flox decides to change its default
-        kwargs.setdefault("method", "split-reduce")
+        kwargs.setdefault("method", "cohorts")
 
         numeric_only = kwargs.pop("numeric_only", None)
         if numeric_only:
             non_numeric = {
                 name: var
                 for name, var in obj.data_vars.items()
                 if not (np.issubdtype(var.dtype, np.number) or (var.dtype == np.bool_))
@@ -688,102 +745,87 @@
         if (
             dim is None or dim == self._group.name
         ) and self._group.name in obj.xindexes:
             index = obj.indexes[self._group.name]
             if index.is_unique and self._squeeze:
                 raise ValueError(f"cannot reduce over dimensions {self._group.name!r}")
 
-        # group is only passed by resample
-        group = kwargs.pop("group", None)
-        if group is None:
-            if isinstance(self._original_group, _DummyGroup):
-                group = self._original_group.name
-            else:
-                group = self._original_group
-
-        unindexed_dims: tuple[str, ...] = tuple()
-        if isinstance(group, str):
-            if group in obj.dims and group not in obj._indexes and self._bins is None:
-                unindexed_dims = (group,)
-            group = self._original_obj[group]
+        unindexed_dims: tuple[Hashable, ...] = tuple()
+        if isinstance(group, _DummyGroup) and self._bins is None:
+            unindexed_dims = (group.name,)
 
         parsed_dim: tuple[Hashable, ...]
         if isinstance(dim, str):
             parsed_dim = (dim,)
         elif dim is None:
             parsed_dim = group.dims
         elif dim is ...:
-            parsed_dim = tuple(self._original_obj.dims)
+            parsed_dim = tuple(obj.dims)
         else:
             parsed_dim = tuple(dim)
 
         # Do this so we raise the same error message whether flox is present or not.
         # Better to control it here than in flox.
-        if any(
-            d not in group.dims and d not in self._original_obj.dims for d in parsed_dim
-        ):
+        if any(d not in group.dims and d not in obj.dims for d in parsed_dim):
             raise ValueError(f"cannot reduce over dimensions {dim}.")
 
-        expected_groups: tuple[np.ndarray | Any, ...]
-        isbin: bool | Sequence[bool]
-        if self._bins is not None:
-            # TODO: fix this; When binning by time, self._bins is a DatetimeIndex
-            expected_groups = (np.array(self._bins),)
-            isbin = (True,)
+        if kwargs["func"] not in ["all", "any", "count"]:
+            kwargs.setdefault("fill_value", np.nan)
+        if self._bins is not None and kwargs["func"] == "count":
             # This is an annoying hack. Xarray returns np.nan
             # when there are no observations in a bin, instead of 0.
             # We can fake that here by forcing min_count=1.
-            if kwargs["func"] == "count":
-                if "fill_value" not in kwargs or kwargs["fill_value"] is None:
-                    kwargs["fill_value"] = np.nan
-                    # note min_count makes no sense in the xarray world
-                    # as a kwarg for count, so this should be OK
-                    kwargs["min_count"] = 1
-            # empty bins have np.nan regardless of dtype
-            # flox's default would not set np.nan for integer dtypes
+            # note min_count makes no sense in the xarray world
+            # as a kwarg for count, so this should be OK
             kwargs.setdefault("fill_value", np.nan)
-        else:
-            expected_groups = (self._unique_coord.values,)
-            isbin = False
+            kwargs.setdefault("min_count", 1)
 
+        output_index = self._get_output_index()
         result = xarray_reduce(
-            self._original_obj.drop_vars(non_numeric),
-            group,
+            obj.drop_vars(non_numeric.keys()),
+            self._codes,
             dim=parsed_dim,
-            expected_groups=expected_groups,
-            isbin=isbin,
+            # pass RangeIndex as a hint to flox that `by` is already factorized
+            expected_groups=(pd.RangeIndex(len(output_index)),),
+            isbin=False,
             keep_attrs=keep_attrs,
             **kwargs,
         )
 
-        # Ignore error when the groupby reduction is effectively
-        # a reduction of the underlying dataset
-        result = result.drop_vars(unindexed_dims, errors="ignore")
+        # we did end up reducing over dimension(s) that are
+        # in the grouped variable
+        if set(self._codes.dims).issubset(set(parsed_dim)):
+            result[self._unique_coord.name] = output_index
+            result = result.drop_vars(unindexed_dims)
 
         # broadcast and restore non-numeric data variables (backcompat)
         for name, var in non_numeric.items():
             if all(d not in var.dims for d in parsed_dim):
                 result[name] = var.variable.set_dims(
                     (group.name,) + var.dims, (result.sizes[group.name],) + var.shape
                 )
 
         if self._bins is not None:
-            # bins provided to flox are at full precision
-            # the bin edge labels have a default precision of 3
-            # reassign to fix that.
-            assert self._full_index is not None
-            result[self._group.name] = self._full_index
             # Fix dimension order when binning a dimension coordinate
             # Needed as long as we do a separate code path for pint;
             # For some reason Datasets and DataArrays behave differently!
             if isinstance(self._obj, Dataset) and self._group_dim in self._obj.dims:
                 result = result.transpose(self._group.name, ...)
 
         return result
 
+    def _get_output_index(self) -> pd.Index:
+        """Return pandas.Index object for the output array."""
+        if self._full_index is not None:
+            # binning and resample
+            return self._full_index.rename(self._unique_coord.name)
+        if isinstance(self._unique_coord, _DummyGroup):
+            return IndexVariable(self._group.name, self._unique_coord.values)
+        return self._unique_coord
+
     def fillna(self, value: Any) -> T_Xarray:
         """Fill missing values in this object by group.
 
         This operation follows the normal broadcasting and alignment rules that
         xarray uses for binary arithmetic, except the result is aligned to this
         object (``join='left'``) instead of aligned to the intersection of
         index coordinates (``join='inner'``).
@@ -846,15 +888,15 @@
 
                 * "lower"
                 * "higher"
                 * "midpoint"
                 * "nearest"
 
             See :py:func:`numpy.quantile` or [1]_ for details. Methods marked with
-            an asterix require numpy version 1.22 or newer. The "method" argument was
+            an asterisk require numpy version 1.22 or newer. The "method" argument was
             previously called "interpolation", renamed in accordance with numpy
             version 1.22.0.
         keep_attrs : bool or None, default: None
             If True, the dataarray's attributes (`attrs`) will be copied from
             the original object to the new one.  If False, the new
             object will be returned without attributes.
         skipna : bool or None, default: None
@@ -994,16 +1036,16 @@
         Dataset.assign_coords
         Dataset.swap_dims
         """
         coords_kwargs = either_dict_or_kwargs(coords, coords_kwargs, "assign_coords")
         return self.map(lambda ds: ds.assign_coords(**coords_kwargs))
 
 
-def _maybe_reorder(xarray_obj, dim, positions):
-    order = _inverse_permutation_indices(positions)
+def _maybe_reorder(xarray_obj, dim, positions, N: int | None):
+    order = _inverse_permutation_indices(positions, N)
 
     if order is None or len(order) != xarray_obj.sizes[dim]:
         return xarray_obj
     else:
         return xarray_obj[{dim: order}]
 
 
@@ -1032,15 +1074,15 @@
         # nb. don't worry too much about maintaining this method -- it does
         # speed things up, but it's not very interpretable and there are much
         # faster alternatives (e.g., doing the grouped aggregation in a
         # compiled language)
         # TODO: benbovy - explicit indexes: this fast implementation doesn't
         # create an explicit index for the stacked dim coordinate
         stacked = Variable.concat(applied, dim, shortcut=True)
-        reordered = _maybe_reorder(stacked, dim, positions)
+        reordered = _maybe_reorder(stacked, dim, positions, N=self._group.size)
         return self._obj._replace_maybe_drop_dims(reordered)
 
     def _restore_dim_order(self, stacked: DataArray) -> DataArray:
         def lookup_order(dimension):
             if dimension == self._group.name:
                 (dimension,) = self._group.dims
             if dimension in self._obj.dims:
@@ -1123,15 +1165,15 @@
         """Recombine the applied objects like the original."""
         applied_example, applied = peek_at(applied)
         coord, dim, positions = self._infer_concat_args(applied_example)
         if shortcut:
             combined = self._concat_shortcut(applied, dim, positions)
         else:
             combined = concat(applied, dim)
-            combined = _maybe_reorder(combined, dim, positions)
+            combined = _maybe_reorder(combined, dim, positions, N=self._group.size)
 
         if isinstance(combined, type(self._obj)):
             # only restore dimension order for arrays
             combined = self._restore_dim_order(combined)
         # assign coord and index when the applied function does not return that coord
         if coord is not None and dim not in applied_example.dims:
             index, index_vars = create_default_index_implicit(coord)
@@ -1279,15 +1321,15 @@
         return self.map(func, shortcut=shortcut, args=args, **kwargs)
 
     def _combine(self, applied):
         """Recombine the applied objects like the original."""
         applied_example, applied = peek_at(applied)
         coord, dim, positions = self._infer_concat_args(applied_example)
         combined = concat(applied, dim)
-        combined = _maybe_reorder(combined, dim, positions)
+        combined = _maybe_reorder(combined, dim, positions, N=self._group.size)
         # assign coord when the applied function does not return that coord
         if coord is not None and dim not in applied_example.dims:
             index, index_vars = create_default_index_implicit(coord)
             indexes = {k: index for k in index_vars}
             combined = combined._overwrite_indexes(indexes, index_vars)
         combined = self._maybe_restore_empty_groups(combined)
         combined = self._maybe_unstack(combined)
@@ -1409,11 +1451,17 @@
                 freq=self.freq,
                 closed=self.closed,
                 label=self.label,
                 origin=self.origin,
                 offset=self.offset,
             )
 
-            first_items = s.groupby(grouper).first()
+            grouped = s.groupby(grouper)
+            first_items = grouped.first()
+            counts = grouped.count()
+            # This way we generate codes for the final output index: full_index.
+            # So for _flox_reduce we avoid one reindex and copy by avoiding
+            # _maybe_restore_empty_groups
+            codes = np.repeat(np.arange(len(first_items)), counts)
             if self.loffset is not None:
                 _apply_loffset(self.loffset, first_items)
-        return first_items
+            return first_items, codes
```

### Comparing `xarray-2023.3.0/xarray/core/indexes.py` & `xarray-2023.4.0/xarray/core/indexes.py`

 * *Files 1% similar despite different names*

```diff
@@ -11,15 +11,21 @@
 
 from xarray.core import formatting, nputils, utils
 from xarray.core.indexing import (
     IndexSelResult,
     PandasIndexingAdapter,
     PandasMultiIndexingAdapter,
 )
-from xarray.core.utils import Frozen, get_valid_numpy_dtype, is_dict_like, is_scalar
+from xarray.core.utils import (
+    Frozen,
+    emit_user_level_warning,
+    get_valid_numpy_dtype,
+    is_dict_like,
+    is_scalar,
+)
 
 if TYPE_CHECKING:
     from xarray.core.types import ErrorOptions, T_Index
     from xarray.core.variable import Variable
 
 IndexVars = dict[Any, "Variable"]
 
@@ -131,15 +137,15 @@
     def _repr_inline_(self, max_width):
         return self.__class__.__name__
 
 
 def _maybe_cast_to_cftimeindex(index: pd.Index) -> pd.Index:
     from xarray.coding.cftimeindex import CFTimeIndex
 
-    if len(index) > 0 and index.dtype == "O":
+    if len(index) > 0 and index.dtype == "O" and not isinstance(index, CFTimeIndex):
         try:
             return CFTimeIndex(index)
         except (ImportError, TypeError):
             return index
     else:
         return index
 
@@ -162,17 +168,29 @@
         # returns the original multi-index for pandas.MultiIndex level coordinates
         index = array._to_index()
     elif isinstance(array, Index):
         index = array.to_pandas_index()
     elif isinstance(array, PandasIndexingAdapter):
         index = array.array
     else:
-        kwargs = {}
-        if hasattr(array, "dtype") and array.dtype.kind == "O":
-            kwargs["dtype"] = object
+        kwargs: dict[str, str] = {}
+        if hasattr(array, "dtype"):
+            if array.dtype.kind == "O":
+                kwargs["dtype"] = "object"
+            elif array.dtype == "float16":
+                emit_user_level_warning(
+                    (
+                        "`pandas.Index` does not support the `float16` dtype."
+                        " Casting to `float64` for you, but in the future please"
+                        " manually cast to either `float32` and `float64`."
+                    ),
+                    category=DeprecationWarning,
+                )
+                kwargs["dtype"] = "float64"
+
         index = pd.Index(np.asarray(array), **kwargs)
 
     return _maybe_cast_to_cftimeindex(index)
 
 
 def _sanitize_slice_element(x):
     from xarray.core.dataarray import DataArray
@@ -255,14 +273,16 @@
 
 
 def get_indexer_nd(index, labels, method=None, tolerance=None):
     """Wrapper around :meth:`pandas.Index.get_indexer` supporting n-dimensional
     labels
     """
     flat_labels = np.ravel(labels)
+    if flat_labels.dtype == "float16":
+        flat_labels = flat_labels.astype("float64")
     flat_indexer = index.get_indexer(flat_labels, method=method, tolerance=tolerance)
     indexer = flat_indexer.reshape(labels.shape)
     return indexer
 
 
 T_PandasIndex = TypeVar("T_PandasIndex", bound="PandasIndex")
```

### Comparing `xarray-2023.3.0/xarray/core/indexing.py` & `xarray-2023.4.0/xarray/core/indexing.py`

 * *Files 4% similar despite different names*

```diff
@@ -24,14 +24,15 @@
     is_duck_dask_array,
 )
 from xarray.core.types import T_Xarray
 from xarray.core.utils import (
     NDArrayMixin,
     either_dict_or_kwargs,
     get_valid_numpy_dtype,
+    is_scalar,
     to_0d_array,
 )
 
 if TYPE_CHECKING:
     from numpy.typing import DTypeLike
 
     from xarray.core.indexes import Index
@@ -444,34 +445,49 @@
 
 
 class ExplicitlyIndexed:
     """Mixin to mark support for Indexer subclasses in indexing."""
 
     __slots__ = ()
 
+    def __array__(self, dtype: np.typing.DTypeLike = None) -> np.ndarray:
+        # Leave casting to an array up to the underlying array type.
+        return np.asarray(self.get_duck_array(), dtype=dtype)
+
+    def get_duck_array(self):
+        return self.array
+
 
 class ExplicitlyIndexedNDArrayMixin(NDArrayMixin, ExplicitlyIndexed):
     __slots__ = ()
 
-    def __array__(self, dtype=None):
+    def get_duck_array(self):
         key = BasicIndexer((slice(None),) * self.ndim)
-        return np.asarray(self[key], dtype=dtype)
+        return self[key]
+
+    def __array__(self, dtype: np.typing.DTypeLike = None) -> np.ndarray:
+        # This is necessary because we apply the indexing key in self.get_duck_array()
+        # Note this is the base class for all lazy indexing classes
+        return np.asarray(self.get_duck_array(), dtype=dtype)
 
 
 class ImplicitToExplicitIndexingAdapter(NDArrayMixin):
     """Wrap an array, converting tuples into the indicated explicit indexer."""
 
     __slots__ = ("array", "indexer_cls")
 
     def __init__(self, array, indexer_cls=BasicIndexer):
         self.array = as_indexable(array)
         self.indexer_cls = indexer_cls
 
-    def __array__(self, dtype=None):
-        return np.asarray(self.array, dtype=dtype)
+    def __array__(self, dtype: np.typing.DTypeLike = None) -> np.ndarray:
+        return np.asarray(self.get_duck_array(), dtype=dtype)
+
+    def get_duck_array(self):
+        return self.array.get_duck_array()
 
     def __getitem__(self, key):
         key = expanded_indexer(key, self.ndim)
         result = self.array[self.indexer_cls(key)]
         if isinstance(result, ExplicitlyIndexed):
             return type(self)(result, self.indexer_cls)
         else:
@@ -526,17 +542,23 @@
         for size, k in zip(self.array.shape, self.key.tuple):
             if isinstance(k, slice):
                 shape.append(len(range(*k.indices(size))))
             elif isinstance(k, np.ndarray):
                 shape.append(k.size)
         return tuple(shape)
 
-    def __array__(self, dtype=None):
-        array = as_indexable(self.array)
-        return np.asarray(array[self.key], dtype=None)
+    def get_duck_array(self):
+        array = self.array[self.key]
+        # self.array[self.key] is now a numpy array when
+        # self.array is a BackendArray subclass
+        # and self.key is BasicIndexer((slice(None, None, None),))
+        # so we need the explicit check for ExplicitlyIndexed
+        if isinstance(array, ExplicitlyIndexed):
+            array = array.get_duck_array()
+        return _wrap_numpy_scalars(array)
 
     def transpose(self, order):
         return LazilyVectorizedIndexedArray(self.array, self.key).transpose(order)
 
     def __getitem__(self, indexer):
         if isinstance(indexer, VectorizedIndexer):
             array = LazilyVectorizedIndexedArray(self.array, self.key)
@@ -579,16 +601,23 @@
             self.key = _arrayize_vectorized_indexer(key, array.shape)
         self.array = as_indexable(array)
 
     @property
     def shape(self) -> tuple[int, ...]:
         return np.broadcast(*self.key.tuple).shape
 
-    def __array__(self, dtype=None):
-        return np.asarray(self.array[self.key], dtype=None)
+    def get_duck_array(self):
+        array = self.array[self.key]
+        # self.array[self.key] is now a numpy array when
+        # self.array is a BackendArray subclass
+        # and self.key is BasicIndexer((slice(None, None, None),))
+        # so we need the explicit check for ExplicitlyIndexed
+        if isinstance(array, ExplicitlyIndexed):
+            array = array.get_duck_array()
+        return _wrap_numpy_scalars(array)
 
     def _updated_key(self, new_key):
         return _combine_indexers(self.key, self.shape, new_key)
 
     def __getitem__(self, indexer):
         # If the indexed array becomes a scalar, return LazilyIndexedArray
         if all(isinstance(ind, integer_types) for ind in indexer.tuple):
@@ -626,16 +655,16 @@
         self._copied = False
 
     def _ensure_copied(self):
         if not self._copied:
             self.array = as_indexable(np.array(self.array))
             self._copied = True
 
-    def __array__(self, dtype=None):
-        return np.asarray(self.array, dtype=dtype)
+    def get_duck_array(self):
+        return self.array.get_duck_array()
 
     def __getitem__(self, key):
         return type(self)(_wrap_numpy_scalars(self.array[key]))
 
     def transpose(self, order):
         return self.array.transpose(order)
 
@@ -653,20 +682,22 @@
 class MemoryCachedArray(ExplicitlyIndexedNDArrayMixin):
     __slots__ = ("array",)
 
     def __init__(self, array):
         self.array = _wrap_numpy_scalars(as_indexable(array))
 
     def _ensure_cached(self):
-        if not isinstance(self.array, NumpyIndexingAdapter):
-            self.array = NumpyIndexingAdapter(np.asarray(self.array))
+        self.array = as_indexable(self.array.get_duck_array())
+
+    def __array__(self, dtype: np.typing.DTypeLike = None) -> np.ndarray:
+        return np.asarray(self.get_duck_array(), dtype=dtype)
 
-    def __array__(self, dtype=None):
+    def get_duck_array(self):
         self._ensure_cached()
-        return np.asarray(self.array, dtype=dtype)
+        return self.array.get_duck_array()
 
     def __getitem__(self, key):
         return type(self)(_wrap_numpy_scalars(self.array[key]))
 
     def transpose(self, order):
         return self.array.transpose(order)
 
@@ -822,42 +853,54 @@
     -------
     Indexing result, in the form of a duck numpy-array.
     """
     raw_key, numpy_indices = decompose_indexer(key, shape, indexing_support)
     result = raw_indexing_method(raw_key.tuple)
     if numpy_indices.tuple:
         # index the loaded np.ndarray
-        result = NumpyIndexingAdapter(np.asarray(result))[numpy_indices]
+        result = NumpyIndexingAdapter(result)[numpy_indices]
     return result
 
 
 def decompose_indexer(
     indexer: ExplicitIndexer, shape: tuple[int, ...], indexing_support: IndexingSupport
 ) -> tuple[ExplicitIndexer, ExplicitIndexer]:
     if isinstance(indexer, VectorizedIndexer):
         return _decompose_vectorized_indexer(indexer, shape, indexing_support)
     if isinstance(indexer, (BasicIndexer, OuterIndexer)):
         return _decompose_outer_indexer(indexer, shape, indexing_support)
     raise TypeError(f"unexpected key type: {indexer}")
 
 
-def _decompose_slice(key, size):
+def _decompose_slice(key: slice, size: int) -> tuple[slice, slice]:
     """convert a slice to successive two slices. The first slice always has
     a positive step.
+
+    >>> _decompose_slice(slice(2, 98, 2), 99)
+    (slice(2, 98, 2), slice(None, None, None))
+
+    >>> _decompose_slice(slice(98, 2, -2), 99)
+    (slice(4, 99, 2), slice(None, None, -1))
+
+    >>> _decompose_slice(slice(98, 2, -2), 98)
+    (slice(3, 98, 2), slice(None, None, -1))
+
+    >>> _decompose_slice(slice(360, None, -10), 361)
+    (slice(0, 361, 10), slice(None, None, -1))
     """
     start, stop, step = key.indices(size)
     if step > 0:
         # If key already has a positive step, use it as is in the backend
         return key, slice(None)
     else:
         # determine stop precisely for step > 1 case
+        # Use the range object to do the calculation
         # e.g. [98:2:-2] -> [98:3:-2]
-        stop = start + int((stop - start - 1) / step) * step + 1
-        start, stop = stop + 1, start + 1
-        return slice(start, stop, -step), slice(None, None, -1)
+        exact_stop = range(start, stop, step)[-1]
+        return slice(exact_stop, start + 1, -step), slice(None, None, -1)
 
 
 def _decompose_vectorized_indexer(
     indexer: VectorizedIndexer,
     shape: tuple[int, ...],
     indexing_support: IndexingSupport,
 ) -> tuple[ExplicitIndexer, ExplicitIndexer]:
@@ -975,20 +1018,33 @@
     >>> np_indexer = OuterIndexer((np.array([0, 2, 1]), np.array([0, 1, 0])))
     >>> # outer indexing for on-memory np.ndarray.
     ... NumpyIndexingAdapter(array)[np_indexer]
     array([[ 2,  3,  2],
            [14, 15, 14],
            [ 8,  9,  8]])
     """
-    if indexing_support == IndexingSupport.VECTORIZED:
-        return indexer, BasicIndexer(())
+    backend_indexer: list[Any] = []
+    np_indexer: list[Any] = []
+
     assert isinstance(indexer, (OuterIndexer, BasicIndexer))
 
-    backend_indexer: list[Any] = []
-    np_indexer = []
+    if indexing_support == IndexingSupport.VECTORIZED:
+        for k, s in zip(indexer.tuple, shape):
+            if isinstance(k, slice):
+                # If it is a slice, then we will slice it as-is
+                # (but make its step positive) in the backend,
+                bk_slice, np_slice = _decompose_slice(k, s)
+                backend_indexer.append(bk_slice)
+                np_indexer.append(np_slice)
+            else:
+                backend_indexer.append(k)
+                if not is_scalar(k):
+                    np_indexer.append(slice(None))
+        return type(indexer)(tuple(backend_indexer)), BasicIndexer(tuple(np_indexer))
+
     # make indexer positive
     pos_indexer: list[np.ndarray | int | np.number] = []
     for k, s in zip(indexer.tuple, shape):
         if isinstance(k, np.ndarray):
             pos_indexer.append(np.where(k < 0, k + s, k))
         elif isinstance(k, integer_types) and k < 0:
             pos_indexer.append(k + s)
@@ -1433,14 +1489,17 @@
         array = self.array
         if isinstance(array, pd.PeriodIndex):
             with suppress(AttributeError):
                 # this might not be public API
                 array = array.astype("object")
         return np.asarray(array.values, dtype=dtype)
 
+    def get_duck_array(self) -> np.ndarray:
+        return np.asarray(self)
+
     @property
     def shape(self) -> tuple[int, ...]:
         return (len(self.array),)
 
     def _convert_scalar(self, item):
         if item is pd.NaT:
             # work around the impossibility of casting NaT with asarray
@@ -1573,16 +1632,16 @@
 
         if self.level is None:
             return "MultiIndex"
         else:
             return format_array_flat(self._get_array_subset(), max_width)
 
     def _repr_html_(self) -> str:
-        from xarray.core.formatting import short_numpy_repr
+        from xarray.core.formatting import short_array_repr
 
-        array_repr = short_numpy_repr(self._get_array_subset())
+        array_repr = short_array_repr(self._get_array_subset())
         return f"<pre>{escape(array_repr)}</pre>"
 
     def copy(self, deep: bool = True) -> PandasMultiIndexingAdapter:
         # see PandasIndexingAdapter.copy
         array = self.array.copy(deep=True) if deep else self.array
         return type(self)(array, self._dtype, self.level)
```

### Comparing `xarray-2023.3.0/xarray/core/merge.py` & `xarray-2023.4.0/xarray/core/merge.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 from __future__ import annotations
 
 from collections import defaultdict
-from collections.abc import Hashable, Iterable, Mapping, Sequence
-from typing import TYPE_CHECKING, AbstractSet, Any, NamedTuple, Optional, Union
+from collections.abc import Hashable, Iterable, Mapping, Sequence, Set
+from typing import TYPE_CHECKING, Any, NamedTuple, Optional, Union
 
 import pandas as pd
 
 from xarray.core import dtypes
 from xarray.core.alignment import deep_align
 from xarray.core.duck_array_ops import lazy_array_equiv
 from xarray.core.indexes import (
@@ -377,15 +377,15 @@
 
     return grouped
 
 
 def merge_coordinates_without_align(
     objects: list[Coordinates],
     prioritized: Mapping[Any, MergeElement] | None = None,
-    exclude_dims: AbstractSet = frozenset(),
+    exclude_dims: Set = frozenset(),
     combine_attrs: CombineAttrsOptions = "override",
 ) -> tuple[dict[Hashable, Variable], dict[Hashable, Index]]:
     """Merge variables/indexes from coordinates without automatic alignments.
 
     This function is used for merging coordinate from pre-existing xarray
     objects.
     """
```

### Comparing `xarray-2023.3.0/xarray/core/missing.py` & `xarray-2023.4.0/xarray/core/missing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/nanops.py` & `xarray-2023.4.0/xarray/core/nanops.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/npcompat.py` & `xarray-2023.4.0/xarray/core/npcompat.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/nputils.py` & `xarray-2023.4.0/xarray/core/nputils.py`

 * *Files 3% similar despite different names*

```diff
@@ -46,30 +46,34 @@
     result = _select_along_axis(values, idx_last, axis)
     if keepdims:
         return np.expand_dims(result, axis=axis)
     else:
         return result
 
 
-def inverse_permutation(indices):
+def inverse_permutation(indices: np.ndarray, N: int | None = None) -> np.ndarray:
     """Return indices for an inverse permutation.
 
     Parameters
     ----------
     indices : 1D np.ndarray with dtype=int
         Integer positions to assign elements to.
+    N : int, optional
+        Size of the array
 
     Returns
     -------
     inverse_permutation : 1D np.ndarray with dtype=int
         Integer indices to take from the original array to create the
         permutation.
     """
+    if N is None:
+        N = len(indices)
     # use intp instead of int64 because of windows :(
-    inverse_permutation = np.empty(len(indices), dtype=np.intp)
+    inverse_permutation = np.full(N, -1, dtype=np.intp)
     inverse_permutation[indices] = np.arange(len(indices), dtype=np.intp)
     return inverse_permutation
 
 
 def _ensure_bool_is_ndarray(result, *args):
     # numpy will sometimes return a scalar value from binary comparisons if it
     # can't handle the comparison instead of broadcasting, e.g.,
```

### Comparing `xarray-2023.3.0/xarray/core/ops.py` & `xarray-2023.4.0/xarray/core/ops.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/options.py` & `xarray-2023.4.0/xarray/core/options.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/parallel.py` & `xarray-2023.4.0/xarray/core/parallel.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 from __future__ import annotations
 
 import collections
 import itertools
 import operator
 from collections.abc import Hashable, Iterable, Mapping, Sequence
-from typing import TYPE_CHECKING, Any, Callable, DefaultDict
+from typing import TYPE_CHECKING, Any, Callable
 
 import numpy as np
 
 from xarray.core.alignment import align
 from xarray.core.dataarray import DataArray
 from xarray.core.dataset import Dataset
 from xarray.core.pycompat import is_dask_collection
@@ -399,15 +399,17 @@
         )
 
     # We're building a new HighLevelGraph hlg. We'll have one new layer
     # for each variable in the dataset, which is the result of the
     # func applied to the values.
 
     graph: dict[Any, Any] = {}
-    new_layers: DefaultDict[str, dict[Any, Any]] = collections.defaultdict(dict)
+    new_layers: collections.defaultdict[str, dict[Any, Any]] = collections.defaultdict(
+        dict
+    )
     gname = "{}-{}".format(
         dask.utils.funcname(func), dask.base.tokenize(npargs[0], args, kwargs)
     )
 
     # map dims to list of chunk indexes
     ichunk = {dim: range(len(chunks_v)) for dim, chunks_v in input_chunks.items()}
     # mapping from chunk index to slice bounds
```

### Comparing `xarray-2023.3.0/xarray/core/pdcompat.py` & `xarray-2023.4.0/xarray/core/pdcompat.py`

 * *Files 27% similar despite different names*

```diff
@@ -35,14 +35,15 @@
 # OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 from __future__ import annotations
 
 from enum import Enum
 from typing import Literal
 
 import pandas as pd
+from packaging.version import Version
 
 from xarray.coding import cftime_offsets
 
 
 def count_not_none(*args) -> int:
     """Compute the number of non-None arguments.
 
@@ -87,7 +88,19 @@
             return pd.Timedelta(base * freq.nanos // freq.n)
     elif isinstance(index, CFTimeIndex):
         freq = cftime_offsets.to_offset(freq)
         if isinstance(freq, cftime_offsets.Tick):
             return base * freq.as_timedelta() // freq.n
     else:
         raise ValueError("Can only resample using a DatetimeIndex or CFTimeIndex.")
+
+
+def nanosecond_precision_timestamp(*args, **kwargs) -> pd.Timestamp:
+    """Return a nanosecond-precision Timestamp object.
+
+    Note this function should no longer be needed after addressing GitHub issue
+    #7493.
+    """
+    if Version(pd.__version__) >= Version("2.0.0"):
+        return pd.Timestamp(*args, **kwargs).as_unit("ns")
+    else:
+        return pd.Timestamp(*args, **kwargs)
```

### Comparing `xarray-2023.3.0/xarray/core/pycompat.py` & `xarray-2023.4.0/xarray/core/pycompat.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/resample.py` & `xarray-2023.4.0/xarray/core/resample.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,15 +1,13 @@
 from __future__ import annotations
 
 import warnings
 from collections.abc import Hashable, Iterable, Sequence
 from typing import TYPE_CHECKING, Any, Callable
 
-import numpy as np
-
 from xarray.core._aggregations import (
     DataArrayResampleAggregations,
     DatasetResampleAggregations,
 )
 from xarray.core.groupby import DataArrayGroupByBase, DatasetGroupByBase, GroupBy
 from xarray.core.types import Dims, InterpOptions, T_Xarray
 
@@ -52,35 +50,15 @@
 
     def _flox_reduce(
         self,
         dim: Dims,
         keep_attrs: bool | None = None,
         **kwargs,
     ) -> T_Xarray:
-        from xarray.core.dataarray import DataArray
-
-        kwargs.setdefault("method", "cohorts")
-
-        # now create a label DataArray since resample doesn't do that somehow
-        repeats = []
-        for slicer in self._group_indices:
-            assert isinstance(slicer, slice)
-            stop = (
-                slicer.stop
-                if slicer.stop is not None
-                else self._obj.sizes[self._group_dim]
-            )
-            repeats.append(stop - slicer.start)
-        labels = np.repeat(self._unique_coord.data, repeats)
-        group = DataArray(labels, dims=(self._group_dim,), name=self._unique_coord.name)
-
-        result = super()._flox_reduce(
-            dim=dim, group=group, keep_attrs=keep_attrs, **kwargs
-        )
-        result = self._maybe_restore_empty_groups(result)
+        result = super()._flox_reduce(dim=dim, keep_attrs=keep_attrs, **kwargs)
         result = result.rename({RESAMPLE_DIM: self._group_dim})
         return result
 
     def _drop_coords(self) -> T_Xarray:
         """Drop non-dimension coordinates along the resampled dimension."""
         obj = self._obj
         for k, v in obj.coords.items():
```

### Comparing `xarray-2023.3.0/xarray/core/resample_cftime.py` & `xarray-2023.4.0/xarray/core/resample_cftime.py`

 * *Files 2% similar despite different names*

```diff
@@ -148,31 +148,30 @@
                 # BaseCFTimeOffset is not public API so we do not include it in
                 # the error message for now.
                 raise ValueError(
                     f"`loffset` must be a str or datetime.timedelta object. "
                     f"Got {self.loffset}."
                 )
 
-            if isinstance(self.loffset, datetime.timedelta):
-                labels = labels + self.loffset
-            else:
-                labels = labels + to_offset(self.loffset)
+            labels = labels + pd.to_timedelta(self.loffset)
 
         # check binner fits data
         if index[0] < datetime_bins[0]:
             raise ValueError("Value falls before first bin")
         if index[-1] > datetime_bins[-1]:
             raise ValueError("Value falls after last bin")
 
-        integer_bins = np.searchsorted(index, datetime_bins, side=self.closed)[:-1]
-        first_items = pd.Series(integer_bins, labels, copy=False)
+        integer_bins = np.searchsorted(index, datetime_bins, side=self.closed)
+        counts = np.diff(integer_bins)
+        codes = np.repeat(np.arange(len(labels)), counts)
+        first_items = pd.Series(integer_bins[:-1], labels, copy=False)
 
         # Mask duplicate values with NaNs, preserving the last values
         non_duplicate = ~first_items.duplicated("last")
-        return first_items.where(non_duplicate)
+        return first_items.where(non_duplicate), codes
 
 
 def _get_time_bins(
     index: CFTimeIndex,
     freq: BaseCFTimeOffset,
     closed: SideOptions,
     label: SideOptions,
```

### Comparing `xarray-2023.3.0/xarray/core/rolling.py` & `xarray-2023.4.0/xarray/core/rolling.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/rolling_exp.py` & `xarray-2023.4.0/xarray/core/rolling_exp.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/types.py` & `xarray-2023.4.0/xarray/core/types.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/utils.py` & `xarray-2023.4.0/xarray/core/utils.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/core/variable.py` & `xarray-2023.4.0/xarray/core/variable.py`

 * *Files 1% similar despite different names*

```diff
@@ -422,14 +422,16 @@
         --------
         Variable.to_numpy
         Variable.as_numpy
         Variable.values
         """
         if is_duck_array(self._data):
             return self._data
+        elif isinstance(self._data, indexing.ExplicitlyIndexed):
+            return self._data.get_duck_array()
         else:
             return self.values
 
     @data.setter
     def data(self, data):
         data = as_compatible_data(data)
         if data.shape != self.shape:
@@ -529,14 +531,16 @@
 
         See Also
         --------
         dask.array.compute
         """
         if is_duck_dask_array(self._data):
             self._data = as_compatible_data(self._data.compute(**kwargs))
+        elif isinstance(self._data, indexing.ExplicitlyIndexed):
+            self._data = self._data.get_duck_array()
         elif not is_duck_array(self._data):
             self._data = np.asarray(self._data)
         return self
 
     def compute(self, **kwargs):
         """Manually trigger loading of this variable's data from disk or a
         remote source into memory and return a new variable. The original is
@@ -973,14 +977,18 @@
     @encoding.setter
     def encoding(self, value):
         try:
             self._encoding = dict(value)
         except ValueError:
             raise ValueError("encoding must be castable to a dictionary")
 
+    def reset_encoding(self: T_Variable) -> T_Variable:
+        """Return a new Variable without encoding."""
+        return self._replace(encoding={})
+
     def copy(
         self: T_Variable, deep: bool = True, data: ArrayLike | None = None
     ) -> T_Variable:
         """Returns a copy of this object.
 
         If `deep=True`, the data array is loaded into memory and copied onto
         the new object. Dimensions, attributes and encodings are always copied.
```

### Comparing `xarray-2023.3.0/xarray/core/weighted.py` & `xarray-2023.4.0/xarray/core/weighted.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/plot/__init__.py` & `xarray-2023.4.0/xarray/plot/__init__.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/plot/accessor.py` & `xarray-2023.4.0/xarray/plot/accessor.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/plot/dataarray_plot.py` & `xarray-2023.4.0/xarray/plot/dataarray_plot.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/plot/dataset_plot.py` & `xarray-2023.4.0/xarray/plot/dataset_plot.py`

 * *Files 0% similar despite different names*

```diff
@@ -124,15 +124,15 @@
         ``center``. Setting both values prevents use of a diverging colormap.
         If discrete levels are provided as an explicit list, both of these
         values are ignored.
     norm : matplotlib.colors.Normalize, optional
         If ``norm`` has ``vmin`` or ``vmax`` specified, the corresponding
         kwarg must be ``None``.
     infer_intervals: bool | None
-        If True the intervals are infered.
+        If True the intervals are inferred.
     center : float, optional
         The value at which to center the colormap. Passing this value implies
         use of a diverging colormap. Setting it to ``False`` prevents use of a
         diverging colormap.
     robust : bool, optional
         If ``True`` and ``vmin`` or ``vmax`` are absent, the colormap range is
         computed with 2nd and 98th percentiles instead of the extreme values.
```

### Comparing `xarray-2023.3.0/xarray/plot/facetgrid.py` & `xarray-2023.4.0/xarray/plot/facetgrid.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/plot/utils.py` & `xarray-2023.4.0/xarray/plot/utils.py`

 * *Files 0% similar despite different names*

```diff
@@ -300,15 +300,15 @@
     # GH3734
     if vmin == vmax:
         vmin, vmax = mpl.ticker.LinearLocator(2).tick_values(vmin, vmax)
 
     if extend is None:
         extend = _determine_extend(calc_data, vmin, vmax)
 
-    if levels is not None or isinstance(norm, mpl.colors.BoundaryNorm):
+    if (levels is not None) and (not isinstance(norm, mpl.colors.BoundaryNorm)):
         cmap, newnorm = _build_discrete_cmap(cmap, levels, extend, filled)
         norm = newnorm if norm is None else norm
 
     # vmin & vmax needs to be None if norm is passed
     # TODO: always return a norm with vmin and vmax
     if norm is not None:
         vmin = None
```

### Comparing `xarray-2023.3.0/xarray/static/css/style.css` & `xarray-2023.4.0/xarray/static/css/style.css`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/static/html/icons-svg-inline.html` & `xarray-2023.4.0/xarray/static/html/icons-svg-inline.html`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/testing.py` & `xarray-2023.4.0/xarray/testing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/__init__.py` & `xarray-2023.4.0/xarray/tests/__init__.py`

 * *Files 4% similar despite different names*

```diff
@@ -71,15 +71,14 @@
 has_cftime, requires_cftime = _importorskip("cftime")
 has_dask, requires_dask = _importorskip("dask")
 has_bottleneck, requires_bottleneck = _importorskip("bottleneck")
 has_rasterio, requires_rasterio = _importorskip("rasterio")
 has_zarr, requires_zarr = _importorskip("zarr")
 has_fsspec, requires_fsspec = _importorskip("fsspec")
 has_iris, requires_iris = _importorskip("iris")
-has_cfgrib, requires_cfgrib = _importorskip("cfgrib")
 has_numbagg, requires_numbagg = _importorskip("numbagg")
 has_seaborn, requires_seaborn = _importorskip("seaborn")
 has_sparse, requires_sparse = _importorskip("sparse")
 has_cupy, requires_cupy = _importorskip("cupy")
 has_cartopy, requires_cartopy = _importorskip("cartopy")
 has_pint, requires_pint = _importorskip("pint")
 has_numexpr, requires_numexpr = _importorskip("numexpr")
@@ -136,32 +135,54 @@
 
 
 class UnexpectedDataAccess(Exception):
     pass
 
 
 class InaccessibleArray(utils.NDArrayMixin, ExplicitlyIndexed):
+    """Disallows any loading."""
+
     def __init__(self, array):
         self.array = array
 
-    def __getitem__(self, key):
-        raise UnexpectedDataAccess("Tried accessing data.")
+    def get_duck_array(self):
+        raise UnexpectedDataAccess("Tried accessing data")
+
+    def __array__(self, dtype: np.typing.DTypeLike = None):
+        raise UnexpectedDataAccess("Tried accessing data")
 
-    def __array__(self):
+    def __getitem__(self, key):
         raise UnexpectedDataAccess("Tried accessing data.")
 
 
 class FirstElementAccessibleArray(InaccessibleArray):
     def __getitem__(self, key):
         tuple_idxr = key.tuple
         if len(tuple_idxr) > 1:
             raise UnexpectedDataAccess("Tried accessing more than one element.")
         return self.array[tuple_idxr]
 
 
+class DuckArrayWrapper(utils.NDArrayMixin):
+    """Array-like that prevents casting to array.
+    Modeled after cupy."""
+
+    def __init__(self, array: np.ndarray):
+        self.array = array
+
+    def __getitem__(self, key):
+        return type(self)(self.array[key])
+
+    def __array__(self, dtype: np.typing.DTypeLike = None):
+        raise UnexpectedDataAccess("Tried accessing data")
+
+    def __array_namespace__(self):
+        """Present to satisfy is_duck_array test."""
+
+
 class ReturnItem:
     def __getitem__(self, key):
         return key
 
 
 class IndexerMaker:
     def __init__(self, indexer_cls):
```

### Comparing `xarray-2023.3.0/xarray/tests/conftest.py` & `xarray-2023.4.0/xarray/tests/conftest.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/data/bears.nc` & `xarray-2023.4.0/xarray/tests/data/bears.nc`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/data/example.grib` & `xarray-2023.4.0/xarray/tests/data/example.grib`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/data/example.ict` & `xarray-2023.4.0/xarray/tests/data/example.ict`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/data/example.uamiv` & `xarray-2023.4.0/xarray/tests/data/example.uamiv`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/data/example_1.nc` & `xarray-2023.4.0/xarray/tests/data/example_1.nc`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_accessor_dt.py` & `xarray-2023.4.0/xarray/tests/test_accessor_dt.py`

 * *Files 2% similar despite different names*

```diff
@@ -55,14 +55,16 @@
             "weekofyear",
             "dayofweek",
             "weekday",
             "dayofyear",
             "quarter",
             "date",
             "time",
+            "daysinmonth",
+            "days_in_month",
             "is_month_start",
             "is_month_end",
             "is_quarter_start",
             "is_quarter_end",
             "is_year_start",
             "is_year_end",
             "is_leap_year",
@@ -70,25 +72,37 @@
     )
     def test_field_access(self, field) -> None:
         if field in ["week", "weekofyear"]:
             data = self.times.isocalendar()["week"]
         else:
             data = getattr(self.times, field)
 
-        expected = xr.DataArray(data, name=field, coords=[self.times], dims=["time"])
+        if data.dtype.kind != "b" and field not in ("date", "time"):
+            # pandas 2.0 returns int32 for integer fields now
+            data = data.astype("int64")
+
+        translations = {
+            "weekday": "dayofweek",
+            "daysinmonth": "days_in_month",
+            "weekofyear": "week",
+        }
+        name = translations.get(field, field)
+
+        expected = xr.DataArray(data, name=name, coords=[self.times], dims=["time"])
 
         if field in ["week", "weekofyear"]:
             with pytest.warns(
                 FutureWarning, match="dt.weekofyear and dt.week have been deprecated"
             ):
                 actual = getattr(self.data.time.dt, field)
         else:
             actual = getattr(self.data.time.dt, field)
 
-        assert_equal(expected, actual)
+        assert expected.dtype == actual.dtype
+        assert_identical(expected, actual)
 
     @pytest.mark.parametrize(
         "field, pandas_field",
         [
             ("year", "year"),
             ("week", "week"),
             ("weekday", "day"),
```

### Comparing `xarray-2023.3.0/xarray/tests/test_accessor_str.py` & `xarray-2023.4.0/xarray/tests/test_accessor_str.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_array_api.py` & `xarray-2023.4.0/xarray/tests/test_array_api.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_backends.py` & `xarray-2023.4.0/xarray/tests/test_backends.py`

 * *Files 4% similar despite different names*

```diff
@@ -59,25 +59,23 @@
     assert_identical,
     assert_no_warnings,
     has_dask,
     has_netCDF4,
     has_scipy,
     mock,
     network,
-    requires_cfgrib,
     requires_cftime,
     requires_dask,
     requires_fsspec,
     requires_h5netcdf,
     requires_iris,
     requires_netCDF4,
     requires_pseudonetcdf,
     requires_pydap,
     requires_pynio,
-    requires_rasterio,
     requires_scipy,
     requires_scipy_or_netCDF4,
     requires_zarr,
 )
 from xarray.tests.test_coding_times import (
     _ALL_CALENDARS,
     _NON_STANDARD_CALENDARS,
@@ -628,14 +626,19 @@
 
     def test_roundtrip_boolean_dtype(self) -> None:
         original = create_boolean_data()
         assert original["x"].dtype == "bool"
         with self.roundtrip(original) as actual:
             assert_identical(original, actual)
             assert actual["x"].dtype == "bool"
+            # this checks for preserving dtype during second roundtrip
+            # see https://github.com/pydata/xarray/issues/7652#issuecomment-1476956975
+            with self.roundtrip(actual) as actual2:
+                assert_identical(original, actual2)
+                assert actual2["x"].dtype == "bool"
 
     def test_orthogonal_indexing(self) -> None:
         in_memory = create_test_data()
         with self.roundtrip(in_memory) as on_disk:
             indexers = {"dim1": [1, 2, 0], "dim2": [3, 2, 0, 3], "dim3": np.arange(5)}
             expected = in_memory.isel(indexers)
             actual = on_disk.isel(**indexers)
@@ -749,14 +752,24 @@
             {
                 "dim1": DataArray([[0, 7], [2, 6], [3, 5]], dims=["a", "b"]),
                 "dim3": slice(-1, 1, -2),
             }
         ]
         multiple_indexing(indexers)
 
+    def test_outer_indexing_reversed(self) -> None:
+        # regression test for GH6560
+        ds = xr.Dataset(
+            {"z": (("t", "p", "y", "x"), np.ones((1, 1, 31, 40)))},
+        )
+
+        with self.roundtrip(ds) as on_disk:
+            subset = on_disk.isel(t=[0], p=0).z[:, ::10, ::10][:, ::-1, :]
+            assert subset.sizes == subset.load().sizes
+
     def test_isel_dataarray(self) -> None:
         # Make sure isel works lazily. GH:issue:1688
         in_memory = create_test_data()
         with self.roundtrip(in_memory) as on_disk:
             expected = in_memory.isel(dim2=in_memory["dim2"] < 3)
             actual = on_disk.isel(dim2=on_disk["dim2"] < 3)
             assert_identical(expected, actual)
@@ -3225,14 +3238,29 @@
 
 
 @pytest.fixture(params=[None, 5])
 def chunks(request):
     return request.param
 
 
+@pytest.fixture(params=["tmp_path", "ZipStore", "Dict"])
+def tmp_store(request, tmp_path):
+    if request.param == "tmp_path":
+        return tmp_path
+    elif request.param == "ZipStore":
+        from zarr.storage import ZipStore
+
+        path = tmp_path / "store.zip"
+        return ZipStore(path)
+    elif request.param == "Dict":
+        return dict()
+    else:
+        raise ValueError("not supported")
+
+
 # using pytest.mark.skipif does not work so this a work around
 def skip_if_not_engine(engine):
     if engine == "netcdf4":
         pytest.importorskip("netCDF4")
     elif engine == "pynio":
         pytest.importorskip("Nio")
     else:
@@ -4172,59 +4200,14 @@
             example.to_netcdf(tmp_file, engine="scipy")
             on_disk = open_dataset(tmp_file, engine="pynio")
             actual = on_disk.rename({"foo": "bar", "x": "y"})
             del on_disk  # trigger garbage collection
             assert_identical(actual, expected)
 
 
-@requires_cfgrib
-class TestCfGrib:
-    def test_read(self) -> None:
-        expected = {
-            "number": 2,
-            "time": 3,
-            "isobaricInhPa": 2,
-            "latitude": 3,
-            "longitude": 4,
-        }
-        with open_example_dataset("example.grib", engine="cfgrib") as ds:
-            assert ds.dims == expected
-            assert list(ds.data_vars) == ["z", "t"]
-            assert ds["z"].min() == 12660.0
-
-    def test_read_filter_by_keys(self) -> None:
-        kwargs = {"filter_by_keys": {"shortName": "t"}}
-        expected = {
-            "number": 2,
-            "time": 3,
-            "isobaricInhPa": 2,
-            "latitude": 3,
-            "longitude": 4,
-        }
-        with open_example_dataset(
-            "example.grib", engine="cfgrib", backend_kwargs=kwargs
-        ) as ds:
-            assert ds.dims == expected
-            assert list(ds.data_vars) == ["t"]
-            assert ds["t"].min() == 231.0
-
-    def test_read_outer(self) -> None:
-        expected = {
-            "number": 2,
-            "time": 3,
-            "isobaricInhPa": 2,
-            "latitude": 2,
-            "longitude": 3,
-        }
-        with open_example_dataset("example.grib", engine="cfgrib") as ds:
-            res = ds.isel(latitude=[0, 2], longitude=[0, 1, 2])
-            assert res.dims == expected
-            assert res["t"].min() == 231.0
-
-
 @requires_pseudonetcdf
 @pytest.mark.filterwarnings("ignore:IOAPI_ISPH is assumed to be 6370000")
 class TestPseudoNetCDFFormat:
     def open(self, path, **kwargs):
         return open_dataset(path, engine="pseudonetcdf", **kwargs)
 
     @contextlib.contextmanager
@@ -4437,570 +4420,14 @@
         }
         for pk, pv in dataset.attrs.items():
             setattr(pncf, pk, pv)
 
         pnc.pncwrite(pncf, path, **save_kwargs)
 
 
-@requires_rasterio
-@contextlib.contextmanager
-def create_tmp_geotiff(
-    nx=4,
-    ny=3,
-    nz=3,
-    transform=None,
-    transform_args=default_value,
-    crs=default_value,
-    open_kwargs=None,
-    additional_attrs=None,
-):
-    if transform_args is default_value:
-        transform_args = [5000, 80000, 1000, 2000.0]
-    if crs is default_value:
-        crs = {
-            "units": "m",
-            "no_defs": True,
-            "ellps": "WGS84",
-            "proj": "utm",
-            "zone": 18,
-        }
-    # yields a temporary geotiff file and a corresponding expected DataArray
-    import rasterio
-    from rasterio.transform import from_origin
-
-    if open_kwargs is None:
-        open_kwargs = {}
-
-    with create_tmp_file(suffix=".tif", allow_cleanup_failure=ON_WINDOWS) as tmp_file:
-        # allow 2d or 3d shapes
-        if nz == 1:
-            data_shape = ny, nx
-            write_kwargs = {"indexes": 1}
-        else:
-            data_shape = nz, ny, nx
-            write_kwargs = {}
-        data = np.arange(nz * ny * nx, dtype=rasterio.float32).reshape(*data_shape)
-        if transform is None:
-            transform = from_origin(*transform_args)
-        if additional_attrs is None:
-            additional_attrs = {
-                "descriptions": tuple(f"d{n + 1}" for n in range(nz)),
-                "units": tuple(f"u{n + 1}" for n in range(nz)),
-            }
-        with rasterio.open(
-            tmp_file,
-            "w",
-            driver="GTiff",
-            height=ny,
-            width=nx,
-            count=nz,
-            crs=crs,
-            transform=transform,
-            dtype=rasterio.float32,
-            **open_kwargs,
-        ) as s:
-            for attr, val in additional_attrs.items():
-                setattr(s, attr, val)
-            s.write(data, **write_kwargs)
-            dx, dy = s.res[0], -s.res[1]
-
-        a, b, c, d = transform_args
-        data = data[np.newaxis, ...] if nz == 1 else data
-        expected = DataArray(
-            data,
-            dims=("band", "y", "x"),
-            coords={
-                "band": np.arange(nz) + 1,
-                "y": -np.arange(ny) * d + b + dy / 2,
-                "x": np.arange(nx) * c + a + dx / 2,
-            },
-        )
-        yield tmp_file, expected
-
-
-@requires_rasterio
-class TestRasterio:
-    @requires_scipy_or_netCDF4
-    def test_serialization(self) -> None:
-        with create_tmp_geotiff(additional_attrs={}) as (tmp_file, expected):
-            # Write it to a netcdf and read again (roundtrip)
-            with pytest.warns(DeprecationWarning), xr.open_rasterio(tmp_file) as rioda:
-                with create_tmp_file(suffix=".nc") as tmp_nc_file:
-                    rioda.to_netcdf(tmp_nc_file)
-                    with xr.open_dataarray(tmp_nc_file) as ncds:
-                        assert_identical(rioda, ncds)
-
-    def test_utm(self) -> None:
-        with create_tmp_geotiff() as (tmp_file, expected):
-            with pytest.warns(DeprecationWarning), xr.open_rasterio(tmp_file) as rioda:
-                assert_allclose(rioda, expected)
-                assert rioda.attrs["scales"] == (1.0, 1.0, 1.0)
-                assert rioda.attrs["offsets"] == (0.0, 0.0, 0.0)
-                assert rioda.attrs["descriptions"] == ("d1", "d2", "d3")
-                assert rioda.attrs["units"] == ("u1", "u2", "u3")
-                assert isinstance(rioda.attrs["crs"], str)
-                assert isinstance(rioda.attrs["res"], tuple)
-                assert isinstance(rioda.attrs["is_tiled"], np.uint8)
-                assert isinstance(rioda.attrs["transform"], tuple)
-                assert len(rioda.attrs["transform"]) == 6
-                np.testing.assert_array_equal(
-                    rioda.attrs["nodatavals"], [np.NaN, np.NaN, np.NaN]
-                )
-
-            # Check no parse coords
-            with pytest.warns(DeprecationWarning), xr.open_rasterio(
-                tmp_file, parse_coordinates=False
-            ) as rioda:
-                assert "x" not in rioda.coords
-                assert "y" not in rioda.coords
-
-    def test_non_rectilinear(self) -> None:
-        from rasterio.transform import from_origin
-
-        # Create a geotiff file with 2d coordinates
-        with create_tmp_geotiff(
-            transform=from_origin(0, 3, 1, 1).rotation(45), crs=None
-        ) as (tmp_file, _):
-            # Default is to not parse coords
-            with pytest.warns(DeprecationWarning), xr.open_rasterio(tmp_file) as rioda:
-                assert "x" not in rioda.coords
-                assert "y" not in rioda.coords
-                assert "crs" not in rioda.attrs
-                assert rioda.attrs["scales"] == (1.0, 1.0, 1.0)
-                assert rioda.attrs["offsets"] == (0.0, 0.0, 0.0)
-                assert rioda.attrs["descriptions"] == ("d1", "d2", "d3")
-                assert rioda.attrs["units"] == ("u1", "u2", "u3")
-                assert isinstance(rioda.attrs["res"], tuple)
-                assert isinstance(rioda.attrs["is_tiled"], np.uint8)
-                assert isinstance(rioda.attrs["transform"], tuple)
-                assert len(rioda.attrs["transform"]) == 6
-
-            # See if a warning is raised if we force it
-            with pytest.warns(Warning, match="transformation isn't rectilinear"):
-                with xr.open_rasterio(tmp_file, parse_coordinates=True) as rioda:
-                    assert "x" not in rioda.coords
-                    assert "y" not in rioda.coords
-
-    def test_platecarree(self) -> None:
-        with create_tmp_geotiff(
-            8,
-            10,
-            1,
-            transform_args=[1, 2, 0.5, 2.0],
-            crs="+proj=latlong",
-            open_kwargs={"nodata": -9765},
-        ) as (tmp_file, expected):
-            with pytest.warns(DeprecationWarning), xr.open_rasterio(tmp_file) as rioda:
-                assert_allclose(rioda, expected)
-                assert rioda.attrs["scales"] == (1.0,)
-                assert rioda.attrs["offsets"] == (0.0,)
-                assert isinstance(rioda.attrs["descriptions"], tuple)
-                assert isinstance(rioda.attrs["units"], tuple)
-                assert isinstance(rioda.attrs["crs"], str)
-                assert isinstance(rioda.attrs["res"], tuple)
-                assert isinstance(rioda.attrs["is_tiled"], np.uint8)
-                assert isinstance(rioda.attrs["transform"], tuple)
-                assert len(rioda.attrs["transform"]) == 6
-                np.testing.assert_array_equal(rioda.attrs["nodatavals"], [-9765.0])
-
-    # rasterio throws a Warning, which is expected since we test rasterio's defaults
-    @pytest.mark.filterwarnings("ignore:Dataset has no geotransform")
-    def test_notransform(self) -> None:
-        # regression test for https://github.com/pydata/xarray/issues/1686
-
-        import rasterio
-
-        # Create a geotiff file
-        with create_tmp_file(suffix=".tif") as tmp_file:
-            # data
-            nx, ny, nz = 4, 3, 3
-            data = np.arange(nx * ny * nz, dtype=rasterio.float32).reshape(nz, ny, nx)
-            with rasterio.open(
-                tmp_file,
-                "w",
-                driver="GTiff",
-                height=ny,
-                width=nx,
-                count=nz,
-                dtype=rasterio.float32,
-            ) as s:
-                s.descriptions = ("nx", "ny", "nz")
-                s.units = ("cm", "m", "km")
-                s.write(data)
-
-            # Tests
-            expected = DataArray(
-                data,
-                dims=("band", "y", "x"),
-                coords={
-                    "band": [1, 2, 3],
-                    "y": [0.5, 1.5, 2.5],
-                    "x": [0.5, 1.5, 2.5, 3.5],
-                },
-            )
-            with pytest.warns(DeprecationWarning), xr.open_rasterio(tmp_file) as rioda:
-                assert_allclose(rioda, expected)
-                assert rioda.attrs["scales"] == (1.0, 1.0, 1.0)
-                assert rioda.attrs["offsets"] == (0.0, 0.0, 0.0)
-                assert rioda.attrs["descriptions"] == ("nx", "ny", "nz")
-                assert rioda.attrs["units"] == ("cm", "m", "km")
-                assert isinstance(rioda.attrs["res"], tuple)
-                assert isinstance(rioda.attrs["is_tiled"], np.uint8)
-                assert isinstance(rioda.attrs["transform"], tuple)
-                assert len(rioda.attrs["transform"]) == 6
-
-    def test_indexing(self) -> None:
-        with create_tmp_geotiff(
-            8, 10, 3, transform_args=[1, 2, 0.5, 2.0], crs="+proj=latlong"
-        ) as (tmp_file, expected):
-            with pytest.warns(DeprecationWarning), xr.open_rasterio(
-                tmp_file, cache=False
-            ) as actual:
-                # tests
-                # assert_allclose checks all data + coordinates
-                assert_allclose(actual, expected)
-                assert not actual.variable._in_memory
-
-                # Basic indexer
-                ind = {"x": slice(2, 5), "y": slice(5, 7)}
-                assert_allclose(expected.isel(**ind), actual.isel(**ind))
-                assert not actual.variable._in_memory
-
-                ind2 = {"band": slice(1, 2), "x": slice(2, 5), "y": slice(5, 7)}
-                assert_allclose(expected.isel(**ind2), actual.isel(**ind2))
-                assert not actual.variable._in_memory
-
-                ind3 = {"band": slice(1, 2), "x": slice(2, 5), "y": 0}
-                assert_allclose(expected.isel(**ind3), actual.isel(**ind3))
-                assert not actual.variable._in_memory
-
-                # orthogonal indexer
-                ind4 = {
-                    "band": np.array([2, 1, 0]),
-                    "x": np.array([1, 0]),
-                    "y": np.array([0, 2]),
-                }
-                assert_allclose(expected.isel(**ind4), actual.isel(**ind4))
-                assert not actual.variable._in_memory
-
-                ind5 = {"band": np.array([2, 1, 0]), "x": np.array([1, 0]), "y": 0}
-                assert_allclose(expected.isel(**ind5), actual.isel(**ind5))
-                assert not actual.variable._in_memory
-
-                ind6 = {"band": 0, "x": np.array([0, 0]), "y": np.array([1, 1, 1])}
-                assert_allclose(expected.isel(**ind6), actual.isel(**ind6))
-                assert not actual.variable._in_memory
-
-                # minus-stepped slice
-                ind7 = {"band": np.array([2, 1, 0]), "x": slice(-1, None, -1), "y": 0}
-                assert_allclose(expected.isel(**ind7), actual.isel(**ind7))
-                assert not actual.variable._in_memory
-
-                ind8 = {"band": np.array([2, 1, 0]), "x": 1, "y": slice(-1, 1, -2)}
-                assert_allclose(expected.isel(**ind8), actual.isel(**ind8))
-                assert not actual.variable._in_memory
-
-                # empty selection
-                ind9 = {"band": np.array([2, 1, 0]), "x": 1, "y": slice(2, 2, 1)}
-                assert_allclose(expected.isel(**ind9), actual.isel(**ind9))
-                assert not actual.variable._in_memory
-
-                ind10 = {"band": slice(0, 0), "x": 1, "y": 2}
-                assert_allclose(expected.isel(**ind10), actual.isel(**ind10))
-                assert not actual.variable._in_memory
-
-                # vectorized indexer
-                ind11 = {
-                    "band": DataArray([2, 1, 0], dims="a"),
-                    "x": DataArray([1, 0, 0], dims="a"),
-                    "y": np.array([0, 2]),
-                }
-                assert_allclose(expected.isel(**ind11), actual.isel(**ind11))
-                assert not actual.variable._in_memory
-
-                ind12 = {
-                    "band": DataArray([[2, 1, 0], [1, 0, 2]], dims=["a", "b"]),
-                    "x": DataArray([[1, 0, 0], [0, 1, 0]], dims=["a", "b"]),
-                    "y": 0,
-                }
-                assert_allclose(expected.isel(**ind12), actual.isel(**ind12))
-                assert not actual.variable._in_memory
-
-                # Selecting lists of bands is fine
-                ex = expected.isel(band=[1, 2])
-                ac = actual.isel(band=[1, 2])
-                assert_allclose(ac, ex)
-                ex = expected.isel(band=[0, 2])
-                ac = actual.isel(band=[0, 2])
-                assert_allclose(ac, ex)
-
-                # Integer indexing
-                ex = expected.isel(band=1)
-                ac = actual.isel(band=1)
-                assert_allclose(ac, ex)
-
-                ex = expected.isel(x=1, y=2)
-                ac = actual.isel(x=1, y=2)
-                assert_allclose(ac, ex)
-
-                ex = expected.isel(band=0, x=1, y=2)
-                ac = actual.isel(band=0, x=1, y=2)
-                assert_allclose(ac, ex)
-
-                # Mixed
-                ex = actual.isel(x=slice(2), y=slice(2))
-                ac = actual.isel(x=[0, 1], y=[0, 1])
-                assert_allclose(ac, ex)
-
-                ex = expected.isel(band=0, x=1, y=slice(5, 7))
-                ac = actual.isel(band=0, x=1, y=slice(5, 7))
-                assert_allclose(ac, ex)
-
-                ex = expected.isel(band=0, x=slice(2, 5), y=2)
-                ac = actual.isel(band=0, x=slice(2, 5), y=2)
-                assert_allclose(ac, ex)
-
-                # One-element lists
-                ex = expected.isel(band=[0], x=slice(2, 5), y=[2])
-                ac = actual.isel(band=[0], x=slice(2, 5), y=[2])
-                assert_allclose(ac, ex)
-
-    def test_caching(self) -> None:
-        with create_tmp_geotiff(
-            8, 10, 3, transform_args=[1, 2, 0.5, 2.0], crs="+proj=latlong"
-        ) as (tmp_file, expected):
-            # Cache is the default
-            with pytest.warns(DeprecationWarning), xr.open_rasterio(tmp_file) as actual:
-                # This should cache everything
-                assert_allclose(actual, expected)
-
-                # once cached, non-windowed indexing should become possible
-                ac = actual.isel(x=[2, 4])
-                ex = expected.isel(x=[2, 4])
-                assert_allclose(ac, ex)
-
-    @requires_dask
-    def test_chunks(self) -> None:
-        with create_tmp_geotiff(
-            8, 10, 3, transform_args=[1, 2, 0.5, 2.0], crs="+proj=latlong"
-        ) as (tmp_file, expected):
-            # Chunk at open time
-            with pytest.warns(DeprecationWarning), xr.open_rasterio(
-                tmp_file, chunks=(1, 2, 2)
-            ) as actual:
-                import dask.array as da
-
-                assert isinstance(actual.data, da.Array)
-                assert "open_rasterio" in actual.data.name
-
-                # do some arithmetic
-                ac = actual.mean()
-                ex = expected.mean()
-                assert_allclose(ac, ex)
-
-                ac = actual.sel(band=1).mean(dim="x")
-                ex = expected.sel(band=1).mean(dim="x")
-                assert_allclose(ac, ex)
-
-    @pytest.mark.xfail(
-        not has_dask, reason="without dask, a non-serializable lock is used"
-    )
-    def test_pickle_rasterio(self) -> None:
-        # regression test for https://github.com/pydata/xarray/issues/2121
-        with create_tmp_geotiff() as (tmp_file, expected):
-            with pytest.warns(DeprecationWarning), xr.open_rasterio(tmp_file) as rioda:
-                temp = pickle.dumps(rioda)
-                with pickle.loads(temp) as actual:
-                    assert_equal(actual, rioda)
-
-    def test_ENVI_tags(self) -> None:
-        rasterio = pytest.importorskip("rasterio")
-        from rasterio.transform import from_origin
-
-        # Create an ENVI file with some tags in the ENVI namespace
-        # this test uses a custom driver, so we can't use create_tmp_geotiff
-        with create_tmp_file(suffix=".dat") as tmp_file:
-            # data
-            nx, ny, nz = 4, 3, 3
-            data = np.arange(nx * ny * nz, dtype=rasterio.float32).reshape(nz, ny, nx)
-            transform = from_origin(5000, 80000, 1000, 2000.0)
-            with rasterio.open(
-                tmp_file,
-                "w",
-                driver="ENVI",
-                height=ny,
-                width=nx,
-                count=nz,
-                crs={
-                    "units": "m",
-                    "no_defs": True,
-                    "ellps": "WGS84",
-                    "proj": "utm",
-                    "zone": 18,
-                },
-                transform=transform,
-                dtype=rasterio.float32,
-            ) as s:
-                s.update_tags(
-                    ns="ENVI",
-                    description="{Tagged file}",
-                    wavelength="{123.000000, 234.234000, 345.345678}",
-                    fwhm="{1.000000, 0.234000, 0.000345}",
-                )
-                s.write(data)
-                dx, dy = s.res[0], -s.res[1]
-
-            # Tests
-            coords = {
-                "band": [1, 2, 3],
-                "y": -np.arange(ny) * 2000 + 80000 + dy / 2,
-                "x": np.arange(nx) * 1000 + 5000 + dx / 2,
-                "wavelength": ("band", np.array([123, 234.234, 345.345678])),
-                "fwhm": ("band", np.array([1, 0.234, 0.000345])),
-            }
-            expected = DataArray(data, dims=("band", "y", "x"), coords=coords)
-
-            with pytest.warns(DeprecationWarning), xr.open_rasterio(tmp_file) as rioda:
-                assert_allclose(rioda, expected)
-                assert isinstance(rioda.attrs["crs"], str)
-                assert isinstance(rioda.attrs["res"], tuple)
-                assert isinstance(rioda.attrs["is_tiled"], np.uint8)
-                assert isinstance(rioda.attrs["transform"], tuple)
-                assert len(rioda.attrs["transform"]) == 6
-                # from ENVI tags
-                assert isinstance(rioda.attrs["description"], str)
-                assert isinstance(rioda.attrs["map_info"], str)
-                assert isinstance(rioda.attrs["samples"], str)
-
-    def test_geotiff_tags(self) -> None:
-        # Create a geotiff file with some tags
-        with create_tmp_geotiff() as (tmp_file, _):
-            with pytest.warns(DeprecationWarning), xr.open_rasterio(tmp_file) as rioda:
-                assert isinstance(rioda.attrs["AREA_OR_POINT"], str)
-
-    @requires_dask
-    def test_no_mftime(self) -> None:
-        # rasterio can accept "filename" urguments that are actually urls,
-        # including paths to remote files.
-        # In issue #1816, we found that these caused dask to break, because
-        # the modification time was used to determine the dask token. This
-        # tests ensure we can still chunk such files when reading with
-        # rasterio.
-        with create_tmp_geotiff(
-            8, 10, 3, transform_args=[1, 2, 0.5, 2.0], crs="+proj=latlong"
-        ) as (tmp_file, expected):
-            with mock.patch("os.path.getmtime", side_effect=OSError):
-                with pytest.warns(DeprecationWarning), xr.open_rasterio(
-                    tmp_file, chunks=(1, 2, 2)
-                ) as actual:
-                    import dask.array as da
-
-                    assert isinstance(actual.data, da.Array)
-                    assert_allclose(actual, expected)
-
-    @network
-    def test_http_url(self) -> None:
-        # more examples urls here
-        # http://download.osgeo.org/geotiff/samples/
-        url = "http://download.osgeo.org/geotiff/samples/made_up/ntf_nord.tif"
-        with pytest.warns(DeprecationWarning), xr.open_rasterio(url) as actual:
-            assert actual.shape == (1, 512, 512)
-        # make sure chunking works
-        with pytest.warns(DeprecationWarning), xr.open_rasterio(
-            url, chunks=(1, 256, 256)
-        ) as actual:
-            import dask.array as da
-
-            assert isinstance(actual.data, da.Array)
-
-    def test_rasterio_environment(self) -> None:
-        import rasterio
-
-        with create_tmp_geotiff() as (tmp_file, expected):
-            # Should fail with error since suffix not allowed
-            with pytest.raises(Exception):
-                with rasterio.Env(GDAL_SKIP="GTiff"):
-                    with pytest.warns(DeprecationWarning), xr.open_rasterio(
-                        tmp_file
-                    ) as actual:
-                        assert_allclose(actual, expected)
-
-    @pytest.mark.xfail(reason="rasterio 1.1.1 is broken. GH3573")
-    def test_rasterio_vrt(self) -> None:
-        import rasterio
-
-        # tmp_file default crs is UTM: CRS({'init': 'epsg:32618'}
-        with create_tmp_geotiff() as (tmp_file, expected):
-            with rasterio.open(tmp_file) as src:
-                with rasterio.vrt.WarpedVRT(src, crs="epsg:4326") as vrt:
-                    expected_shape = (vrt.width, vrt.height)
-                    expected_crs = vrt.crs
-                    expected_res = vrt.res
-                    # Value of single pixel in center of image
-                    lon, lat = vrt.xy(vrt.width // 2, vrt.height // 2)
-                    expected_val = next(vrt.sample([(lon, lat)]))
-                    with pytest.warns(DeprecationWarning), xr.open_rasterio(vrt) as da:
-                        actual_shape = (da.sizes["x"], da.sizes["y"])
-                        actual_crs = da.crs
-                        actual_res = da.res
-                        actual_val = da.sel(dict(x=lon, y=lat), method="nearest").data
-
-                        assert actual_crs == expected_crs
-                        assert actual_res == expected_res
-                        assert actual_shape == expected_shape
-                        assert expected_val.all() == actual_val.all()
-
-    @pytest.mark.filterwarnings(
-        "ignore:open_rasterio is Deprecated in favor of rioxarray."
-    )
-    def test_rasterio_vrt_with_transform_and_size(self) -> None:
-        # Test open_rasterio() support of WarpedVRT with transform, width and
-        # height (issue #2864)
-
-        rasterio = pytest.importorskip("rasterio")
-        from affine import Affine
-        from rasterio.warp import calculate_default_transform
-
-        with create_tmp_geotiff() as (tmp_file, expected):
-            with rasterio.open(tmp_file) as src:
-                # Estimate the transform, width and height
-                # for a change of resolution
-                # tmp_file initial res is (1000,2000) (default values)
-                trans, w, h = calculate_default_transform(
-                    src.crs, src.crs, src.width, src.height, resolution=500, *src.bounds
-                )
-                with rasterio.vrt.WarpedVRT(
-                    src, transform=trans, width=w, height=h
-                ) as vrt:
-                    expected_shape = (vrt.width, vrt.height)
-                    expected_res = vrt.res
-                    expected_transform = vrt.transform
-                    with xr.open_rasterio(vrt) as da:
-                        actual_shape = (da.sizes["x"], da.sizes["y"])
-                        actual_res = da.res
-                        actual_transform = Affine(*da.transform)
-                        assert actual_res == expected_res
-                        assert actual_shape == expected_shape
-                        assert actual_transform == expected_transform
-
-    def test_rasterio_vrt_with_src_crs(self) -> None:
-        # Test open_rasterio() support of WarpedVRT with specified src_crs
-
-        rasterio = pytest.importorskip("rasterio")
-
-        # create geotiff with no CRS and specify it manually
-        with create_tmp_geotiff(crs=None) as (tmp_file, expected):
-            src_crs = rasterio.crs.CRS({"init": "epsg:32618"})
-            with rasterio.open(tmp_file) as src:
-                assert src.crs is None
-                with rasterio.vrt.WarpedVRT(src, src_crs=src_crs) as vrt:
-                    with pytest.warns(DeprecationWarning), xr.open_rasterio(vrt) as da:
-                        assert da.crs == src_crs
-
-
 class TestEncodingInvalid:
     def test_extract_nc4_variable_encoding(self) -> None:
         var = xr.Variable(("x",), [1, 2, 3], {}, {"foo": "bar"})
         with pytest.raises(ValueError, match=r"unexpected encoding"):
             _extract_nc4_variable_encoding(var, raise_on_invalid=True)
 
         var = xr.Variable(("x",), [1, 2, 3], {}, {"chunking": (2, 1)})
@@ -5180,14 +4607,64 @@
             tmp = Path(tmps)
             original_da.to_netcdf(tmp)
 
             with open_dataarray(tmp) as loaded_da:
                 assert_identical(original_da, loaded_da)
 
 
+@requires_zarr
+class TestDataArrayToZarr:
+    def test_dataarray_to_zarr_no_name(self, tmp_store) -> None:
+        original_da = DataArray(np.arange(12).reshape((3, 4)))
+
+        original_da.to_zarr(tmp_store)
+
+        with open_dataarray(tmp_store, engine="zarr") as loaded_da:
+            assert_identical(original_da, loaded_da)
+
+    def test_dataarray_to_zarr_with_name(self, tmp_store) -> None:
+        original_da = DataArray(np.arange(12).reshape((3, 4)), name="test")
+
+        original_da.to_zarr(tmp_store)
+
+        with open_dataarray(tmp_store, engine="zarr") as loaded_da:
+            assert_identical(original_da, loaded_da)
+
+    def test_dataarray_to_zarr_coord_name_clash(self, tmp_store) -> None:
+        original_da = DataArray(
+            np.arange(12).reshape((3, 4)), dims=["x", "y"], name="x"
+        )
+
+        original_da.to_zarr(tmp_store)
+
+        with open_dataarray(tmp_store, engine="zarr") as loaded_da:
+            assert_identical(original_da, loaded_da)
+
+    def test_open_dataarray_options(self, tmp_store) -> None:
+        data = DataArray(np.arange(5), coords={"y": ("x", range(5))}, dims=["x"])
+
+        data.to_zarr(tmp_store)
+
+        expected = data.drop_vars("y")
+        with open_dataarray(tmp_store, engine="zarr", drop_variables=["y"]) as loaded:
+            assert_identical(expected, loaded)
+
+    @requires_dask
+    def test_dataarray_to_zarr_compute_false(self, tmp_store) -> None:
+        from dask.delayed import Delayed
+
+        original_da = DataArray(np.arange(12).reshape((3, 4)))
+
+        output = original_da.to_zarr(tmp_store, compute=False)
+        assert isinstance(output, Delayed)
+        output.compute()
+        with open_dataarray(tmp_store, engine="zarr") as loaded_da:
+            assert_identical(original_da, loaded_da)
+
+
 @requires_scipy_or_netCDF4
 def test_no_warning_from_dask_effective_get() -> None:
     with create_tmp_file() as tmpfile:
         with assert_no_warnings():
             ds = Dataset()
             ds.to_netcdf(tmpfile)
 
@@ -5612,15 +5089,15 @@
         f.write(contents)
     _check_guess_can_open_and_open(entrypoint, path, engine="scipy", expected=ds)
     _check_guess_can_open_and_open(entrypoint, str(path), engine="scipy", expected=ds)
 
     assert entrypoint.guess_can_open("something-local.nc")
     assert entrypoint.guess_can_open("something-local.nc.gz")
     assert not entrypoint.guess_can_open("not-found-and-no-extension")
-    assert not entrypoint.guess_can_open(b"not-a-netcdf-file")
+    assert not entrypoint.guess_can_open(b"not-a-netcdf-file")  # type: ignore[arg-type]
 
 
 @requires_h5netcdf
 def test_h5netcdf_entrypoint(tmp_path: Path) -> None:
     entrypoint = H5netcdfBackendEntrypoint()
     ds = create_test_data()
```

### Comparing `xarray-2023.3.0/xarray/tests/test_backends_api.py` & `xarray-2023.4.0/xarray/tests/test_backends_api.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_backends_common.py` & `xarray-2023.4.0/xarray/tests/test_backends_common.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_backends_file_manager.py` & `xarray-2023.4.0/xarray/tests/test_backends_file_manager.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_backends_lru_cache.py` & `xarray-2023.4.0/xarray/tests/test_backends_lru_cache.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_calendar_ops.py` & `xarray-2023.4.0/xarray/tests/test_calendar_ops.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_cftime_offsets.py` & `xarray-2023.4.0/xarray/tests/test_cftime_offsets.py`

 * *Files 1% similar despite different names*

```diff
@@ -1369,14 +1369,15 @@
 
 def test_date_range_like_same_calendar():
     src = date_range("2000-01-01", periods=12, freq="6H", use_cftime=False)
     out = date_range_like(src, "standard", use_cftime=False)
     assert src is out
 
 
+@pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
 def test_date_range_like_errors():
     src = date_range("1899-02-03", periods=20, freq="D", use_cftime=False)
     src = src[np.arange(20) != 10]  # Remove 1 day so the frequency is not inferable.
 
     with pytest.raises(
         ValueError,
         match="`date_range_like` was unable to generate a range as the source frequency was not inferable.",
```

### Comparing `xarray-2023.3.0/xarray/tests/test_cftimeindex.py` & `xarray-2023.4.0/xarray/tests/test_cftimeindex.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_cftimeindex_resample.py` & `xarray-2023.4.0/xarray/tests/test_cftimeindex_resample.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_coarsen.py` & `xarray-2023.4.0/xarray/tests/test_coarsen.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_coding.py` & `xarray-2023.4.0/xarray/tests/test_coding.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_coding_strings.py` & `xarray-2023.4.0/xarray/tests/test_coding_strings.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_coding_times.py` & `xarray-2023.4.0/xarray/tests/test_coding_times.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_combine.py` & `xarray-2023.4.0/xarray/tests/test_combine.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_computation.py` & `xarray-2023.4.0/xarray/tests/test_computation.py`

 * *Files 1% similar despite different names*

```diff
@@ -2088,14 +2088,44 @@
             xr.DataArray(
                 np.array([1000, 2000, 3000], dtype="timedelta64[ns]"), dims="x"
             ),
             xr.DataArray([0, 1], dims="degree", coords={"degree": [0, 1]}),
             xr.DataArray([1000.0, 2000.0, 3000.0], dims="x"),
             id="timedelta",
         ),
+        pytest.param(
+            xr.DataArray([1, 2, 3], dims="x"),
+            xr.DataArray(
+                [2, 3, 4],
+                dims="degree",
+                coords={"degree": np.array([0, 1, 2], dtype=np.int64)},
+            ),
+            xr.DataArray([9, 2 + 6 + 16, 2 + 9 + 36], dims="x"),
+            id="int64-degree",
+        ),
+        pytest.param(
+            xr.DataArray([1, 2, 3], dims="x"),
+            xr.DataArray(
+                [2, 3, 4],
+                dims="degree",
+                coords={"degree": np.array([0, 1, 2], dtype=np.int32)},
+            ),
+            xr.DataArray([9, 2 + 6 + 16, 2 + 9 + 36], dims="x"),
+            id="int32-degree",
+        ),
+        pytest.param(
+            xr.DataArray([1, 2, 3], dims="x"),
+            xr.DataArray(
+                [2, 3, 4],
+                dims="degree",
+                coords={"degree": np.array([0, 1, 2], dtype=np.uint8)},
+            ),
+            xr.DataArray([9, 2 + 6 + 16, 2 + 9 + 36], dims="x"),
+            id="uint8-degree",
+        ),
     ],
 )
 def test_polyval(
     use_dask: bool,
     x: xr.DataArray | xr.Dataset,
     coeffs: xr.DataArray | xr.Dataset,
     expected: xr.DataArray | xr.Dataset,
```

### Comparing `xarray-2023.3.0/xarray/tests/test_concat.py` & `xarray-2023.4.0/xarray/tests/test_concat.py`

 * *Files 0% similar despite different names*

```diff
@@ -293,14 +293,15 @@
         "cloud_cover",
         "temperature",
         "pressure",
     ]
     assert_identical(actual, expected)
 
 
+@pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
 def test_concat_type_of_missing_fill() -> None:
     datasets = create_typed_datasets(2, seed=123)
     expected1 = concat(datasets, dim="day", fill_value=dtypes.NA)
     expected2 = concat(datasets[::-1], dim="day", fill_value=dtypes.NA)
     vars = ["float", "float2", "string", "int", "datetime64", "timedelta64"]
     expected = [expected2, expected1]
     for i, exp in enumerate(expected):
```

### Comparing `xarray-2023.3.0/xarray/tests/test_conventions.py` & `xarray-2023.4.0/xarray/tests/test_conventions.py`

 * *Files 2% similar despite different names*

```diff
@@ -28,24 +28,24 @@
 )
 from xarray.tests.test_backends import CFEncodedBase
 
 
 class TestBoolTypeArray:
     def test_booltype_array(self) -> None:
         x = np.array([1, 0, 1, 1, 0], dtype="i1")
-        bx = conventions.BoolTypeArray(x)
+        bx = coding.variables.BoolTypeArray(x)
         assert bx.dtype == bool
         assert_array_equal(bx, np.array([True, False, True, True, False], dtype=bool))
 
 
 class TestNativeEndiannessArray:
     def test(self) -> None:
         x = np.arange(5, dtype=">i8")
         expected = np.arange(5, dtype="int64")
-        a = conventions.NativeEndiannessArray(x)
+        a = coding.variables.NativeEndiannessArray(x)
         assert a.dtype == expected.dtype
         assert a.dtype == expected[:].dtype
         assert_array_equal(a, expected)
 
 
 def test_decode_cf_with_conflicting_fill_missing_value() -> None:
     expected = Variable(["t"], [np.nan, np.nan, 2], {"units": "foobar"})
@@ -164,14 +164,15 @@
         enc, _ = conventions.encode_dataset_coordinates(orig)
         assert enc["a"].attrs["coordinates"] == "y"
         assert enc["b"].attrs["coordinates"] == "z"
         orig["a"].attrs["coordinates"] = "foo"
         with pytest.raises(ValueError, match=r"'coordinates' found in both attrs"):
             conventions.encode_dataset_coordinates(orig)
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_emit_coordinates_attribute_in_attrs(self) -> None:
         orig = Dataset(
             {"a": 1, "b": 1},
             coords={"t": np.array("2004-11-01T00:00:00", dtype=np.datetime64)},
         )
 
         orig["a"].attrs["coordinates"] = None
@@ -181,14 +182,15 @@
         assert "coordinates" not in enc["a"].attrs
         assert "coordinates" not in enc["a"].encoding
 
         # check coordinate attribute not emitted for 'b'
         assert enc["b"].attrs.get("coordinates") == "t"
         assert "coordinates" not in enc["b"].encoding
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_emit_coordinates_attribute_in_encoding(self) -> None:
         orig = Dataset(
             {"a": 1, "b": 1},
             coords={"t": np.array("2004-11-01T00:00:00", dtype=np.datetime64)},
         )
 
         orig["a"].encoding["coordinates"] = None
@@ -243,15 +245,15 @@
         )
         actual = conventions.decode_cf(original)
         assert actual.foo.encoding["coordinates"] == "x"
 
     def test_0d_int32_encoding(self) -> None:
         original = Variable((), np.int32(0), encoding={"dtype": "int64"})
         expected = Variable((), np.int64(0))
-        actual = conventions.maybe_encode_nonstring_dtype(original)
+        actual = coding.variables.NonStringCoder().encode(original)
         assert_identical(expected, actual)
 
     def test_decode_cf_with_multiple_missing_values(self) -> None:
         original = Variable(["t"], [0, 1, 2], {"missing_value": np.array([0, 1])})
         expected = Variable(["t"], [np.nan, np.nan, 2], {})
         with warnings.catch_warnings(record=True) as w:
             actual = conventions.decode_cf_variable("t", original)
```

### Comparing `xarray-2023.3.0/xarray/tests/test_cupy.py` & `xarray-2023.4.0/xarray/tests/test_cupy.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_dask.py` & `xarray-2023.4.0/xarray/tests/test_dask.py`

 * *Files 0% similar despite different names*

```diff
@@ -1697,7 +1697,14 @@
         assert len(a.__dask_graph__().layers) == len(b.__dask_graph__().layers)
 
     # Above we performed a slice operation; adding the two slices back together creates
     # a diamond-shaped dependency graph, which in turn will trigger a collision in layer
     # names if we were to use HighLevelGraph.cull() instead of
     # HighLevelGraph.cull_layers() in Dataset.__dask_postpersist__().
     assert_equal(ds2.d1 + ds2.d2, ds.d1 + ds.d2)
+
+
+def test_new_index_var_computes_once():
+    # regression test for GH1533
+    data = dask.array.from_array(np.array([100, 200]))
+    with raise_if_dask_computes(max_computes=1):
+        Dataset(coords={"z": ("z", data)})
```

### Comparing `xarray-2023.3.0/xarray/tests/test_dataarray.py` & `xarray-2023.4.0/xarray/tests/test_dataarray.py`

 * *Files 1% similar despite different names*

```diff
@@ -274,14 +274,33 @@
         self.dv.encoding["foo"] = "bar"
         assert expected == self.dv.encoding
 
         expected2 = {"baz": 0}
         self.dv.encoding = expected2
         assert expected2 is not self.dv.encoding
 
+    def test_reset_encoding(self) -> None:
+        array = self.mda
+        encoding = {"scale_factor": 10}
+        array.encoding = encoding
+        array["x"].encoding = encoding
+
+        assert array.encoding == encoding
+        assert array["x"].encoding == encoding
+
+        actual = array.reset_encoding()
+
+        # did not modify in place
+        assert array.encoding == encoding
+        assert array["x"].encoding == encoding
+
+        # variable and coord encoding is empty
+        assert actual.encoding == {}
+        assert actual["x"].encoding == {}
+
     def test_constructor(self) -> None:
         data = np.random.random((2, 3))
 
         # w/o coords, w/o dims
         actual = DataArray(data)
         expected = Dataset({None: (["dim_0", "dim_1"], data)})[None]
         assert_identical(expected, actual)
@@ -1000,40 +1019,61 @@
         result = array.sel(time=slice(array.time[0], array.time[-1]))
         assert_equal(result, array)
 
         array = DataArray(np.arange(365), [("delta", times - times[0])])
         result = array.sel(delta=slice(array.delta[0], array.delta[-1]))
         assert_equal(result, array)
 
-    def test_sel_float(self) -> None:
+    @pytest.mark.parametrize(
+        ["coord_values", "indices"],
+        (
+            pytest.param(
+                np.array([0.0, 0.111, 0.222, 0.333], dtype="float64"),
+                slice(1, 3),
+                id="float64",
+            ),
+            pytest.param(
+                np.array([0.0, 0.111, 0.222, 0.333], dtype="float32"),
+                slice(1, 3),
+                id="float32",
+            ),
+            pytest.param(
+                np.array([0.0, 0.111, 0.222, 0.333], dtype="float32"), [2], id="scalar"
+            ),
+        ),
+    )
+    def test_sel_float(self, coord_values, indices) -> None:
         data_values = np.arange(4)
 
-        # case coords are float32 and label is list of floats
-        float_values = [0.0, 0.111, 0.222, 0.333]
-        coord_values = np.asarray(float_values, dtype="float32")
-        array = DataArray(data_values, [("float32_coord", coord_values)])
-        expected = DataArray(data_values[1:3], [("float32_coord", coord_values[1:3])])
-        actual = array.sel(float32_coord=float_values[1:3])
-        # case coords are float16 and label is list of floats
-        coord_values_16 = np.asarray(float_values, dtype="float16")
-        expected_16 = DataArray(
-            data_values[1:3], [("float16_coord", coord_values_16[1:3])]
-        )
-        array_16 = DataArray(data_values, [("float16_coord", coord_values_16)])
-        actual_16 = array_16.sel(float16_coord=float_values[1:3])
-
-        # case coord, label are scalars
-        expected_scalar = DataArray(
-            data_values[2], coords={"float32_coord": coord_values[2]}
+        arr = DataArray(data_values, coords={"x": coord_values}, dims="x")
+
+        actual = arr.sel(x=coord_values[indices])
+        expected = DataArray(
+            data_values[indices], coords={"x": coord_values[indices]}, dims="x"
         )
-        actual_scalar = array.sel(float32_coord=float_values[2])
 
-        assert_equal(expected, actual)
-        assert_equal(expected_scalar, actual_scalar)
-        assert_equal(expected_16, actual_16)
+        assert_equal(actual, expected)
+
+    def test_sel_float16(self) -> None:
+        data_values = np.arange(4)
+        coord_values = np.array([0.0, 0.111, 0.222, 0.333], dtype="float16")
+        indices = slice(1, 3)
+
+        message = "`pandas.Index` does not support the `float16` dtype.*"
+
+        with pytest.warns(DeprecationWarning, match=message):
+            arr = DataArray(data_values, coords={"x": coord_values}, dims="x")
+        with pytest.warns(DeprecationWarning, match=message):
+            expected = DataArray(
+                data_values[indices], coords={"x": coord_values[indices]}, dims="x"
+            )
+
+        actual = arr.sel(x=coord_values[indices])
+
+        assert_equal(actual, expected)
 
     def test_sel_float_multiindex(self) -> None:
         # regression test https://github.com/pydata/xarray/issues/5691
         # test multi-index created from coordinates, one with dtype=float32
         lvl1 = ["a", "a", "b", "b"]
         lvl2 = np.array([0.1, 0.2, 0.3, 0.4], dtype=np.float32)
         da = xr.DataArray(
```

### Comparing `xarray-2023.3.0/xarray/tests/test_dataset.py` & `xarray-2023.4.0/xarray/tests/test_dataset.py`

 * *Files 1% similar despite different names*

```diff
@@ -32,14 +32,15 @@
 from xarray.core import dtypes, indexing, utils
 from xarray.core.common import duck_array_ops, full_like
 from xarray.core.coordinates import DatasetCoordinates
 from xarray.core.indexes import Index, PandasIndex
 from xarray.core.pycompat import array_type, integer_types
 from xarray.core.utils import is_scalar
 from xarray.tests import (
+    DuckArrayWrapper,
     InaccessibleArray,
     UnexpectedDataAccess,
     assert_allclose,
     assert_array_equal,
     assert_equal,
     assert_identical,
     assert_no_warnings,
@@ -97,65 +98,71 @@
     )
     datetime_var_to_append = np.array(
         ["2019-01-04", "2019-01-05"], dtype="datetime64[s]"
     )
     bool_var = np.array([True, False, True], dtype=bool)
     bool_var_to_append = np.array([False, True], dtype=bool)
 
-    ds = xr.Dataset(
-        data_vars={
-            "da": xr.DataArray(
-                rs.rand(3, 3, nt1),
-                coords=[lat, lon, time1],
-                dims=["lat", "lon", "time"],
-            ),
-            "string_var": xr.DataArray(string_var, coords=[time1], dims=["time"]),
-            "string_var_fixed_length": xr.DataArray(
-                string_var_fixed_length, coords=[time1], dims=["time"]
-            ),
-            "unicode_var": xr.DataArray(
-                unicode_var, coords=[time1], dims=["time"]
-            ).astype(np.unicode_),
-            "datetime_var": xr.DataArray(datetime_var, coords=[time1], dims=["time"]),
-            "bool_var": xr.DataArray(bool_var, coords=[time1], dims=["time"]),
-        }
-    )
+    with warnings.catch_warnings():
+        warnings.filterwarnings("ignore", "Converting non-nanosecond")
+        ds = xr.Dataset(
+            data_vars={
+                "da": xr.DataArray(
+                    rs.rand(3, 3, nt1),
+                    coords=[lat, lon, time1],
+                    dims=["lat", "lon", "time"],
+                ),
+                "string_var": xr.DataArray(string_var, coords=[time1], dims=["time"]),
+                "string_var_fixed_length": xr.DataArray(
+                    string_var_fixed_length, coords=[time1], dims=["time"]
+                ),
+                "unicode_var": xr.DataArray(
+                    unicode_var, coords=[time1], dims=["time"]
+                ).astype(np.unicode_),
+                "datetime_var": xr.DataArray(
+                    datetime_var, coords=[time1], dims=["time"]
+                ),
+                "bool_var": xr.DataArray(bool_var, coords=[time1], dims=["time"]),
+            }
+        )
 
-    ds_to_append = xr.Dataset(
-        data_vars={
-            "da": xr.DataArray(
-                rs.rand(3, 3, nt2),
-                coords=[lat, lon, time2],
-                dims=["lat", "lon", "time"],
-            ),
-            "string_var": xr.DataArray(
-                string_var_to_append, coords=[time2], dims=["time"]
-            ),
-            "string_var_fixed_length": xr.DataArray(
-                string_var_fixed_length_to_append, coords=[time2], dims=["time"]
-            ),
-            "unicode_var": xr.DataArray(
-                unicode_var[:nt2], coords=[time2], dims=["time"]
-            ).astype(np.unicode_),
-            "datetime_var": xr.DataArray(
-                datetime_var_to_append, coords=[time2], dims=["time"]
-            ),
-            "bool_var": xr.DataArray(bool_var_to_append, coords=[time2], dims=["time"]),
-        }
-    )
+        ds_to_append = xr.Dataset(
+            data_vars={
+                "da": xr.DataArray(
+                    rs.rand(3, 3, nt2),
+                    coords=[lat, lon, time2],
+                    dims=["lat", "lon", "time"],
+                ),
+                "string_var": xr.DataArray(
+                    string_var_to_append, coords=[time2], dims=["time"]
+                ),
+                "string_var_fixed_length": xr.DataArray(
+                    string_var_fixed_length_to_append, coords=[time2], dims=["time"]
+                ),
+                "unicode_var": xr.DataArray(
+                    unicode_var[:nt2], coords=[time2], dims=["time"]
+                ).astype(np.unicode_),
+                "datetime_var": xr.DataArray(
+                    datetime_var_to_append, coords=[time2], dims=["time"]
+                ),
+                "bool_var": xr.DataArray(
+                    bool_var_to_append, coords=[time2], dims=["time"]
+                ),
+            }
+        )
 
-    ds_with_new_var = xr.Dataset(
-        data_vars={
-            "new_var": xr.DataArray(
-                rs.rand(3, 3, nt1 + nt2),
-                coords=[lat, lon, time1.append(time2)],
-                dims=["lat", "lon", "time"],
-            )
-        }
-    )
+        ds_with_new_var = xr.Dataset(
+            data_vars={
+                "new_var": xr.DataArray(
+                    rs.rand(3, 3, nt1 + nt2),
+                    coords=[lat, lon, time1.append(time2)],
+                    dims=["lat", "lon", "time"],
+                )
+            }
+        )
 
     assert all(objp.data.flags.writeable for objp in ds.variables.values())
     assert all(objp.data.flags.writeable for objp in ds_to_append.variables.values())
     return ds, ds_to_append, ds_with_new_var
 
 
 def create_append_string_length_mismatch_test_data(dtype) -> tuple[Dataset, Dataset]:
@@ -199,14 +206,18 @@
     y = DataArray(pd.Index(np.r_[:20], name="y"))
     a = x * y
     b = x * y * y
     return a, b
 
 
 class InaccessibleVariableDataStore(backends.InMemoryDataStore):
+    """
+    Store that does not allow any data access.
+    """
+
     def __init__(self):
         super().__init__()
         self._indexvars = set()
 
     def store(self, variables, *args, **kwargs) -> None:
         super().store(variables, *args, **kwargs)
         for k, v in variables.items():
@@ -219,14 +230,55 @@
                 return v
             data = indexing.LazilyIndexedArray(InaccessibleArray(v.values))
             return Variable(v.dims, data, v.attrs)
 
         return {k: lazy_inaccessible(k, v) for k, v in self._variables.items()}
 
 
+class DuckBackendArrayWrapper(backends.common.BackendArray):
+    """Mimic a BackendArray wrapper around DuckArrayWrapper"""
+
+    def __init__(self, array):
+        self.array = DuckArrayWrapper(array)
+        self.shape = array.shape
+        self.dtype = array.dtype
+
+    def get_array(self):
+        return self.array
+
+    def __getitem__(self, key):
+        return self.array[key.tuple]
+
+
+class AccessibleAsDuckArrayDataStore(backends.InMemoryDataStore):
+    """
+    Store that returns a duck array, not convertible to numpy array,
+    on read. Modeled after nVIDIA's kvikio.
+    """
+
+    def __init__(self):
+        super().__init__()
+        self._indexvars = set()
+
+    def store(self, variables, *args, **kwargs) -> None:
+        super().store(variables, *args, **kwargs)
+        for k, v in variables.items():
+            if isinstance(v, IndexVariable):
+                self._indexvars.add(k)
+
+    def get_variables(self) -> dict[Any, xr.Variable]:
+        def lazy_accessible(k, v) -> xr.Variable:
+            if k in self._indexvars:
+                return v
+            data = indexing.LazilyIndexedArray(DuckBackendArrayWrapper(v.values))
+            return Variable(v.dims, data, v.attrs)
+
+        return {k: lazy_accessible(k, v) for k, v in self._variables.items()}
+
+
 class TestDataset:
     def test_repr(self) -> None:
         data = create_test_data(seed=123)
         data.attrs["foo"] = "bar"
         # need to insert str dtype at runtime to handle different endianness
         expected = dedent(
             """\
@@ -439,14 +491,15 @@
         expected = Dataset({"x": (["x"], 5.0 + np.arange(5))})
         actual = Dataset({"x": 5.0 + np.arange(5)})
         assert_identical(expected, actual)
 
         actual = Dataset({"x": [5, 6, 7, 8, 9]})
         assert_identical(expected, actual)
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_constructor_0d(self) -> None:
         expected = Dataset({"x": ([], 1)})
         for arg in [1, np.array(1), expected["x"]]:
             actual = Dataset({"x": arg})
             assert_identical(expected, actual)
 
         class Arbitrary:
@@ -2823,14 +2876,29 @@
         with pytest.raises(ValueError, match=r"Data must be dict-like"):
             orig.copy(data=new_var1)  # type: ignore[arg-type]
         with pytest.raises(ValueError, match=r"only contain variables in original"):
             orig.copy(data={"not_in_original": new_var1})
         with pytest.raises(ValueError, match=r"contain all variables in original"):
             orig.copy(data={"var1": new_var1})
 
+    def test_reset_encoding(self) -> None:
+        orig = create_test_data()
+        vencoding = {"scale_factor": 10}
+        orig.encoding = {"foo": "bar"}
+
+        for k, v in orig.variables.items():
+            orig[k].encoding = vencoding
+
+        actual = orig.reset_encoding()
+        assert actual.encoding == {}
+        for k, v in actual.variables.items():
+            assert v.encoding == {}
+
+        assert_equal(actual, orig)
+
     def test_rename(self) -> None:
         data = create_test_data()
         newnames = {
             "var1": "renamed_var1",
             "dim2": "renamed_dim2",
         }
         renamed = data.rename(newnames)
@@ -4680,14 +4748,37 @@
             with pytest.raises(UnexpectedDataAccess):
                 ds["var1"].values
 
             # these should not raise UnexpectedDataAccess:
             ds.isel(time=10)
             ds.isel(time=slice(10), dim1=[0]).isel(dim1=0, dim2=-1)
 
+    def test_lazy_load_duck_array(self) -> None:
+        store = AccessibleAsDuckArrayDataStore()
+        create_test_data().dump_to_store(store)
+
+        for decode_cf in [True, False]:
+            ds = open_dataset(store, decode_cf=decode_cf)
+            with pytest.raises(UnexpectedDataAccess):
+                ds["var1"].values
+
+            # these should not raise UnexpectedDataAccess:
+            ds.var1.data
+            ds.isel(time=10)
+            ds.isel(time=slice(10), dim1=[0]).isel(dim1=0, dim2=-1)
+            repr(ds)
+
+            # preserve the duck array type and don't cast to array
+            assert isinstance(ds["var1"].load().data, DuckArrayWrapper)
+            assert isinstance(
+                ds["var1"].isel(dim2=0, dim1=0).load().data, DuckArrayWrapper
+            )
+
+            ds.close()
+
     def test_dropna(self) -> None:
         x = np.random.randn(4, 4)
         x[::2, 0] = np.nan
         y = np.random.randn(4)
         y[-1] = np.nan
         ds = Dataset({"foo": (("a", "b"), x), "bar": (("b", y))})
 
@@ -5491,14 +5582,15 @@
 
         actual = ds.copy(deep=True)
         other = ds.isel(y=slice(2))
         actual += other
         expected = ds + other.reindex_like(ds)
         assert_identical(expected, actual)
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_dataset_math_errors(self) -> None:
         ds = self.make_example_math_dataset()
 
         with pytest.raises(TypeError):
             ds["foo"] += ds
         with pytest.raises(TypeError):
             ds["foo"].variable += ds
@@ -6490,14 +6582,15 @@
         ds.differentiate("y", edge_order=edge_order)["var"],
     )
 
     with pytest.raises(ValueError):
         da.differentiate("x2d")
 
 
+@pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
 @pytest.mark.parametrize("dask", [True, False])
 def test_differentiate_datetime(dask) -> None:
     rs = np.random.RandomState(42)
     coord = np.array(
         [
             "2004-07-13",
             "2006-01-13",
@@ -6686,14 +6779,15 @@
     actual = da.cumulative_integrate(("y", "x"))
     assert actual.ndim == 2
 
     with pytest.raises(ValueError):
         da.cumulative_integrate("x2d")
 
 
+@pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
 @pytest.mark.parametrize("dask", [True, False])
 @pytest.mark.parametrize("which_datetime", ["np", "cftime"])
 def test_trapz_datetime(dask, which_datetime) -> None:
     rs = np.random.RandomState(42)
     if which_datetime == "np":
         coord = np.array(
             [
```

### Comparing `xarray-2023.3.0/xarray/tests/test_deprecation_helpers.py` & `xarray-2023.4.0/xarray/tests/test_deprecation_helpers.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_distributed.py` & `xarray-2023.4.0/xarray/tests/test_distributed.py`

 * *Files 5% similar despite different names*

```diff
@@ -31,25 +31,21 @@
 from xarray.backends.locks import HDF5_LOCK, CombinedLock
 from xarray.tests import (
     assert_allclose,
     assert_identical,
     has_h5netcdf,
     has_netCDF4,
     has_scipy,
-    requires_cfgrib,
     requires_cftime,
     requires_netCDF4,
-    requires_rasterio,
     requires_zarr,
 )
 from xarray.tests.test_backends import (
     ON_WINDOWS,
     create_tmp_file,
-    create_tmp_geotiff,
-    open_example_dataset,
 )
 from xarray.tests.test_dataset import create_test_data
 
 loop = loop  # loop is an imported fixture, which flake8 has issues ack-ing
 
 
 @pytest.fixture
@@ -194,40 +190,14 @@
                     filename, chunks="auto", engine="zarr", **read_kwargs
                 ) as restored:
                     assert isinstance(restored.var1.data, da.Array)
                     computed = restored.compute()
                     assert_allclose(original, computed)
 
 
-@requires_rasterio
-@pytest.mark.filterwarnings("ignore:deallocating CachingFileManager")
-def test_dask_distributed_rasterio_integration_test(loop) -> None:
-    with create_tmp_geotiff() as (tmp_file, expected):
-        with cluster() as (s, [a, b]):
-            with pytest.warns(DeprecationWarning), Client(s["address"], loop=loop):
-                da_tiff = xr.open_rasterio(tmp_file, chunks={"band": 1})
-                assert isinstance(da_tiff.data, da.Array)
-                actual = da_tiff.compute()
-                assert_allclose(actual, expected)
-
-
-@requires_cfgrib
-@pytest.mark.filterwarnings("ignore:deallocating CachingFileManager")
-def test_dask_distributed_cfgrib_integration_test(loop) -> None:
-    with cluster() as (s, [a, b]):
-        with Client(s["address"], loop=loop):
-            with open_example_dataset(
-                "example.grib", engine="cfgrib", chunks={"time": 1}
-            ) as ds:
-                with open_example_dataset("example.grib", engine="cfgrib") as expected:
-                    assert isinstance(ds["t"].data, da.Array)
-                    actual = ds.compute()
-                    assert_allclose(actual, expected)
-
-
 @pytest.mark.xfail(
     condition=Version(distributed.__version__) < Version("2022.02.0"),
     reason="https://github.com/dask/distributed/pull/5739",
 )
 @gen_cluster(client=True)
 async def test_async(c, s, a, b) -> None:
     x = create_test_data()
```

### Comparing `xarray-2023.3.0/xarray/tests/test_dtypes.py` & `xarray-2023.4.0/xarray/tests/test_dtypes.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_duck_array_ops.py` & `xarray-2023.4.0/xarray/tests/test_duck_array_ops.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_extensions.py` & `xarray-2023.4.0/xarray/tests/test_extensions.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_formatting.py` & `xarray-2023.4.0/xarray/tests/test_formatting.py`

 * *Files 2% similar despite different names*

```diff
@@ -538,34 +538,34 @@
     original_options = np.get_printoptions()
     with formatting.set_numpy_options(threshold=10):
         assert len(repr(np.arange(500))) < 200
     # original options are restored
     assert np.get_printoptions() == original_options
 
 
-def test_short_numpy_repr() -> None:
+def test_short_array_repr() -> None:
     cases = [
         np.random.randn(500),
         np.random.randn(20, 20),
         np.random.randn(5, 10, 15),
         np.random.randn(5, 10, 15, 3),
         np.random.randn(100, 5, 1),
     ]
     # number of lines:
     # for default numpy repr: 167, 140, 254, 248, 599
-    # for short_numpy_repr: 1, 7, 24, 19, 25
+    # for short_array_repr: 1, 7, 24, 19, 25
     for array in cases:
-        num_lines = formatting.short_numpy_repr(array).count("\n") + 1
+        num_lines = formatting.short_array_repr(array).count("\n") + 1
         assert num_lines < 30
 
     # threshold option (default: 200)
     array2 = np.arange(100)
-    assert "..." not in formatting.short_numpy_repr(array2)
+    assert "..." not in formatting.short_array_repr(array2)
     with xr.set_options(display_values_threshold=10):
-        assert "..." in formatting.short_numpy_repr(array2)
+        assert "..." in formatting.short_array_repr(array2)
 
 
 def test_large_array_repr_length() -> None:
     da = xr.DataArray(np.random.randn(100, 5, 1))
 
     result = repr(da).splitlines()
     assert len(result) < 50
```

### Comparing `xarray-2023.3.0/xarray/tests/test_formatting_html.py` & `xarray-2023.4.0/xarray/tests/test_formatting_html.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_groupby.py` & `xarray-2023.4.0/xarray/tests/test_groupby.py`

 * *Files 1% similar despite different names*

```diff
@@ -2,25 +2,25 @@
 
 import datetime
 import warnings
 
 import numpy as np
 import pandas as pd
 import pytest
-from pandas.tseries.frequencies import to_offset
 
 import xarray as xr
 from xarray import DataArray, Dataset, Variable
 from xarray.core.groupby import _consolidate_slices
 from xarray.tests import (
     assert_allclose,
     assert_array_equal,
     assert_equal,
     assert_identical,
     create_test_data,
+    has_cftime,
     has_pandas_version_two,
     requires_dask,
     requires_flox,
     requires_scipy,
 )
 
 
@@ -497,14 +497,15 @@
     expected = f"{obj.__class__.__name__}GroupBy"
     expected += ", grouped over 'month'"
     expected += "\n%r groups with labels " % (len(np.unique(obj.t.dt.month)))
     expected += "1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12."
     assert actual == expected
 
 
+@pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
 @pytest.mark.filterwarnings("ignore:invalid value encountered in divide:RuntimeWarning")
 def test_groupby_drops_nans() -> None:
     # GH2383
     # nan in 2D data variable (requires stacking)
     ds = xr.Dataset(
         {
             "variable": (("lat", "lon", "time"), np.arange(60.0).reshape((4, 3, 5))),
@@ -803,14 +804,33 @@
             "time": pd.date_range("2000-01-01", periods=100),
         }
     )
     with pytest.raises(ValueError, match=r"incompat.* grouped binary"):
         ds + ds.groupby("time.month")
 
 
+@pytest.mark.parametrize("use_flox", [True, False])
+def test_groupby_bins_cut_kwargs(use_flox: bool) -> None:
+    da = xr.DataArray(np.arange(12).reshape(6, 2), dims=("x", "y"))
+    x_bins = (0, 2, 4, 6)
+
+    with xr.set_options(use_flox=use_flox):
+        actual = da.groupby_bins(
+            "x", bins=x_bins, include_lowest=True, right=False
+        ).mean()
+    expected = xr.DataArray(
+        np.array([[1.0, 2.0], [5.0, 6.0], [9.0, 10.0]]),
+        dims=("x_bins", "y"),
+        coords={
+            "x_bins": ("x_bins", pd.IntervalIndex.from_breaks(x_bins, closed="left"))
+        },
+    )
+    assert_identical(expected, actual)
+
+
 @pytest.mark.parametrize("indexed_coord", [True, False])
 def test_groupby_bins_math(indexed_coord) -> None:
     N = 7
     da = DataArray(np.random.random((N, N)), dims=("x", "y"))
     if indexed_coord:
         da["x"] = np.arange(N)
         da["y"] = np.arange(N)
@@ -1462,28 +1482,82 @@
         for target in [a, expected]:
             target.coords["b"] = ("x", [0, 0, 1, 1])
         actual = a.groupby("b").fillna(DataArray([0, 2], dims="b"))
         assert_identical(expected, actual)
 
 
 class TestDataArrayResample:
-    def test_resample(self):
-        times = pd.date_range("2000-01-01", freq="6H", periods=10)
+    @pytest.mark.parametrize("use_cftime", [True, False])
+    def test_resample(self, use_cftime: bool) -> None:
+        if use_cftime and not has_cftime:
+            pytest.skip()
+        times = xr.date_range(
+            "2000-01-01", freq="6H", periods=10, use_cftime=use_cftime
+        )
+
+        def resample_as_pandas(array, *args, **kwargs):
+            array_ = array.copy(deep=True)
+            if use_cftime:
+                array_["time"] = times.to_datetimeindex()
+            result = DataArray.from_series(
+                array_.to_series().resample(*args, **kwargs).mean()
+            )
+            if use_cftime:
+                result = result.convert_calendar(
+                    calendar="standard", use_cftime=use_cftime
+                )
+            return result
+
         array = DataArray(np.arange(10), [("time", times)])
 
         actual = array.resample(time="24H").mean()
-        expected = DataArray(array.to_series().resample("24H").mean())
+        expected = resample_as_pandas(array, "24H")
         assert_identical(expected, actual)
 
         actual = array.resample(time="24H").reduce(np.mean)
         assert_identical(expected, actual)
 
+        actual = array.resample(time="24H", closed="right").mean()
+        expected = resample_as_pandas(array, "24H", closed="right")
+        assert_identical(expected, actual)
+
         with pytest.raises(ValueError, match=r"index must be monotonic"):
             array[[2, 0, 1]].resample(time="1D")
 
+    @pytest.mark.parametrize("use_cftime", [True, False])
+    def test_resample_doctest(self, use_cftime: bool) -> None:
+        # run the doctest example here so we are not surprised
+        if use_cftime and not has_cftime:
+            pytest.skip()
+
+        da = xr.DataArray(
+            np.array([1, 2, 3, 1, 2, np.nan]),
+            dims="time",
+            coords=dict(
+                time=(
+                    "time",
+                    xr.date_range(
+                        "2001-01-01", freq="M", periods=6, use_cftime=use_cftime
+                    ),
+                ),
+                labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
+            ),
+        )
+        actual = da.resample(time="3M").count()
+        expected = DataArray(
+            [1, 3, 1],
+            dims="time",
+            coords={
+                "time": xr.date_range(
+                    "2001-01-01", freq="3M", periods=3, use_cftime=use_cftime
+                )
+            },
+        )
+        assert_identical(actual, expected)
+
     def test_da_resample_func_args(self):
         def func(arg1, arg2, arg3=0.0):
             return arg1.mean("time") + arg2 + arg3
 
         times = pd.date_range("2000", periods=3, freq="D")
         da = xr.DataArray([1.0, 1.0, 1.0], coords=[times], dims=["time"])
         expected = xr.DataArray([3.0, 3.0, 3.0], coords=[times], dims=["time"])
@@ -1728,14 +1802,15 @@
             )
             # Use AllClose because there are some small differences in how
             # we upsample timeseries versus the integer indexing as I've
             # done here due to floating point arithmetic
             assert_allclose(expected, actual, rtol=1e-16)
 
     @requires_scipy
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_upsample_interpolate_bug_2197(self):
         dates = pd.date_range("2007-02-01", "2007-03-01", freq="D")
         da = xr.DataArray(np.arange(len(dates)), [("time", dates)])
         result = da.resample(time="M").interpolate("linear")
         expected_times = np.array(
             [np.datetime64("2007-02-28"), np.datetime64("2007-03-31")]
         )
@@ -1801,15 +1876,17 @@
         times = pd.date_range("2000-01-01T02:03:01", freq="6H", periods=10)
         array = DataArray(np.arange(10), [("time", times)])
 
         base = 11
 
         with pytest.warns(FutureWarning, match="the `base` parameter to resample"):
             actual = array.resample(time="24H", base=base).mean()
-        expected = DataArray(array.to_series().resample("24H", base=base).mean())
+        expected = DataArray(
+            array.to_series().resample("24H", offset=f"{base}H").mean()
+        )
         assert_identical(expected, actual)
 
     def test_resample_offset(self) -> None:
         times = pd.date_range("2000-01-01T02:03:01", freq="6H", periods=10)
         array = DataArray(np.arange(10), [("time", times)])
 
         offset = pd.Timedelta("11H")
@@ -1838,23 +1915,30 @@
     )
     def test_resample_loffset(self, loffset) -> None:
         times = pd.date_range("2000-01-01", freq="6H", periods=10)
         array = DataArray(np.arange(10), [("time", times)])
 
         with pytest.warns(FutureWarning, match="`loffset` parameter"):
             actual = array.resample(time="24H", loffset=loffset).mean()
-        expected = DataArray(array.to_series().resample("24H", loffset=loffset).mean())
+        series = array.to_series().resample("24H").mean()
+        if not isinstance(loffset, pd.DateOffset):
+            loffset = pd.Timedelta(loffset)
+        series.index = series.index + loffset
+        expected = DataArray(series)
         assert_identical(actual, expected)
 
     def test_resample_invalid_loffset(self) -> None:
         times = pd.date_range("2000-01-01", freq="6H", periods=10)
         array = DataArray(np.arange(10), [("time", times)])
 
-        with pytest.raises(ValueError, match="`loffset` must be"):
-            array.resample(time="24H", loffset=1).mean()  # type: ignore
+        with pytest.warns(
+            FutureWarning, match="Following pandas, the `loffset` parameter"
+        ):
+            with pytest.raises(ValueError, match="`loffset` must be"):
+                array.resample(time="24H", loffset=1).mean()  # type: ignore
 
 
 class TestDatasetResample:
     def test_resample_and_first(self):
         times = pd.date_range("2000-01-01", freq="6H", periods=10)
         ds = Dataset(
             {
@@ -1934,22 +2018,14 @@
                 "foo": (["time", "x", "y"], np.random.randn(10, 5, 3)),
                 "bar": ("time", np.random.randn(10), {"meta": "data"}),
                 "time": times,
             }
         )
         ds.attrs["dsmeta"] = "dsdata"
 
-        # Our use of `loffset` may change if we align our API with pandas' changes.
-        # ref https://github.com/pydata/xarray/pull/4537
-        actual = ds.resample(time="24H", loffset="-12H").mean().bar
-        expected_ = ds.bar.to_series().resample("24H").mean()
-        expected_.index += to_offset("-12H")
-        expected = DataArray.from_series(expected_)
-        assert_allclose(actual, expected)
-
     def test_resample_by_mean_discarding_attrs(self):
         times = pd.date_range("2000-01-01", freq="6H", periods=10)
         ds = Dataset(
             {
                 "foo": (["time", "x", "y"], np.random.randn(10, 5, 3)),
                 "bar": ("time", np.random.randn(10), {"meta": "data"}),
                 "time": times,
@@ -2122,10 +2198,7 @@
     # TODO: Remove drop_vars when GH6528 is fixed
     # when Dataset.cumsum propagates indexes, and the group variable?
     assert_identical(expected.drop_vars(["time"]), actual)
 
     actual = getattr(ds.foo.resample(time="3M"), method)(dim="time")
     expected.coords["time"] = ds.time
     assert_identical(expected.drop_vars(["time"]).foo, actual)
-
-
-# TODO: move other groupby tests from test_dataset and test_dataarray over here
```

### Comparing `xarray-2023.3.0/xarray/tests/test_indexes.py` & `xarray-2023.4.0/xarray/tests/test_indexes.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_indexing.py` & `xarray-2023.4.0/xarray/tests/test_indexing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_interp.py` & `xarray-2023.4.0/xarray/tests/test_interp.py`

 * *Files 0% similar despite different names*

```diff
@@ -601,14 +601,15 @@
         ),
         (["2000-01-01T12:00", "2000-01-02T12:00"], [0.5, 1.5]),
         (["2000-01-01T12:00", "2000-01-02T12:00", "NaT"], [0.5, 1.5, np.nan]),
         (["2000-01-01T12:00"], 0.5),
         pytest.param("2000-01-01T12:00", 0.5, marks=pytest.mark.xfail),
     ],
 )
+@pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
 def test_datetime(x_new, expected) -> None:
     da = xr.DataArray(
         np.arange(24),
         dims="time",
         coords={"time": pd.date_range("2000-01-01", periods=24)},
     )
```

### Comparing `xarray-2023.3.0/xarray/tests/test_merge.py` & `xarray-2023.4.0/xarray/tests/test_merge.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_missing.py` & `xarray-2023.4.0/xarray/tests/test_missing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_nputils.py` & `xarray-2023.4.0/xarray/tests/test_nputils.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_options.py` & `xarray-2023.4.0/xarray/tests/test_options.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_plot.py` & `xarray-2023.4.0/xarray/tests/test_plot.py`

 * *Files 0% similar despite different names*

```diff
@@ -1200,14 +1200,21 @@
         assert primitive.norm.vmin == min(levels)
 
     def test_discrete_colormap_provided_boundary_norm(self) -> None:
         norm = mpl.colors.BoundaryNorm([0, 5, 10, 15], 4)
         primitive = self.darray.plot.contourf(norm=norm)
         np.testing.assert_allclose(primitive.levels, norm.boundaries)
 
+    def test_discrete_colormap_provided_boundary_norm_matching_cmap_levels(
+        self,
+    ) -> None:
+        norm = mpl.colors.BoundaryNorm([0, 5, 10, 15], 4)
+        primitive = self.darray.plot.contourf(norm=norm)
+        assert primitive.colorbar.norm.Ncmap == primitive.colorbar.norm.N
+
 
 class Common2dMixin:
     """
     Common tests for 2d plotting go here.
 
     These tests assume that a staticmethod for `self.plotfunc` exists.
     Should have the same name as the method.
@@ -2800,14 +2807,15 @@
         p = self.darray.plot.line()
         ax = p[0].axes
 
         # Make sure only mpl converters are used, use type() so only
         # mpl.dates.AutoDateLocator passes and no other subclasses:
         assert type(ax.xaxis.get_major_locator()) is mpl.dates.AutoDateLocator
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_datetime_plot2d(self) -> None:
         # Test that matplotlib-native datetime works:
         da = DataArray(
             np.arange(3 * 4).reshape(3, 4),
             dims=("x", "y"),
             coords={
                 "x": [1, 2, 3],
```

### Comparing `xarray-2023.3.0/xarray/tests/test_plugins.py` & `xarray-2023.4.0/xarray/tests/test_plugins.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,16 +1,32 @@
 from __future__ import annotations
 
 import sys
 from importlib.metadata import EntryPoint
+
+if sys.version_info >= (3, 10):
+    from importlib.metadata import EntryPoints
+else:
+    EntryPoints = list[EntryPoint]
 from unittest import mock
 
 import pytest
 
 from xarray.backends import common, plugins
+from xarray.tests import (
+    has_h5netcdf,
+    has_netCDF4,
+    has_pseudonetcdf,
+    has_pydap,
+    has_pynio,
+    has_scipy,
+    has_zarr,
+)
+
+# Do not import list_engines here, this will break the lazy tests
 
 importlib_metadata_mock = "importlib.metadata"
 
 
 class DummyBackendEntrypointArgs(common.BackendEntrypoint):
     def open_dataset(filename_or_obj, *args):
         pass
@@ -53,15 +69,15 @@
 def test_broken_plugin() -> None:
     broken_backend = EntryPoint(
         "broken_backend",
         "xarray.tests.test_plugins:backend_1",
         "xarray.backends",
     )
     with pytest.warns(RuntimeWarning) as record:
-        _ = plugins.build_engines([broken_backend])
+        _ = plugins.build_engines(EntryPoints([broken_backend]))
     assert len(record) == 1
     message = str(record[0].message)
     assert "Engine 'broken_backend'" in message
 
 
 def test_remove_duplicates_warnings(dummy_duplicated_entrypoints) -> None:
     with pytest.warns(RuntimeWarning) as record:
@@ -95,61 +111,73 @@
     engines = {"engine_1": backend_1, "engine_2": backend_2}
     plugins.set_missing_parameters(engines)
 
     assert len(engines) == 2
     assert backend_1.open_dataset_parameters == ("filename_or_obj", "decoder")
     assert backend_2.open_dataset_parameters == ("filename_or_obj",)
 
-    backend = DummyBackendEntrypointKwargs()
-    backend.open_dataset_parameters = ("filename_or_obj", "decoder")  # type: ignore[misc]
-    plugins.set_missing_parameters({"engine": backend})
-    assert backend.open_dataset_parameters == ("filename_or_obj", "decoder")
+    backend_kwargs = DummyBackendEntrypointKwargs
+    backend_kwargs.open_dataset_parameters = ("filename_or_obj", "decoder")
+    plugins.set_missing_parameters({"engine": backend_kwargs})
+    assert backend_kwargs.open_dataset_parameters == ("filename_or_obj", "decoder")
 
-    backend_args = DummyBackendEntrypointArgs()
-    backend_args.open_dataset_parameters = ("filename_or_obj", "decoder")  # type: ignore[misc]
+    backend_args = DummyBackendEntrypointArgs
+    backend_args.open_dataset_parameters = ("filename_or_obj", "decoder")
     plugins.set_missing_parameters({"engine": backend_args})
     assert backend_args.open_dataset_parameters == ("filename_or_obj", "decoder")
 
+    # reset
+    backend_1.open_dataset_parameters = None
+    backend_1.open_dataset_parameters = None
+    backend_kwargs.open_dataset_parameters = None
+    backend_args.open_dataset_parameters = None
+
 
 def test_set_missing_parameters_raise_error() -> None:
-    backend = DummyBackendEntrypointKwargs()
+    backend = DummyBackendEntrypointKwargs
     with pytest.raises(TypeError):
         plugins.set_missing_parameters({"engine": backend})
 
-    backend_args = DummyBackendEntrypointArgs()
+    backend_args = DummyBackendEntrypointArgs
     with pytest.raises(TypeError):
         plugins.set_missing_parameters({"engine": backend_args})
 
 
 @mock.patch(
     f"{importlib_metadata_mock}.EntryPoint.load",
     mock.MagicMock(return_value=DummyBackendEntrypoint1),
 )
 def test_build_engines() -> None:
     dummy_pkg_entrypoint = EntryPoint(
-        "cfgrib", "xarray.tests.test_plugins:backend_1", "xarray_backends"
+        "dummy", "xarray.tests.test_plugins:backend_1", "xarray_backends"
     )
-    backend_entrypoints = plugins.build_engines([dummy_pkg_entrypoint])
+    backend_entrypoints = plugins.build_engines(EntryPoints([dummy_pkg_entrypoint]))
 
-    assert isinstance(backend_entrypoints["cfgrib"], DummyBackendEntrypoint1)
-    assert backend_entrypoints["cfgrib"].open_dataset_parameters == (
+    assert isinstance(backend_entrypoints["dummy"], DummyBackendEntrypoint1)
+    assert backend_entrypoints["dummy"].open_dataset_parameters == (
         "filename_or_obj",
         "decoder",
     )
 
 
 @mock.patch(
     f"{importlib_metadata_mock}.EntryPoint.load",
     mock.MagicMock(return_value=DummyBackendEntrypoint1),
 )
 def test_build_engines_sorted() -> None:
-    dummy_pkg_entrypoints = [
-        EntryPoint("dummy2", "xarray.tests.test_plugins:backend_1", "xarray.backends"),
-        EntryPoint("dummy1", "xarray.tests.test_plugins:backend_1", "xarray.backends"),
-    ]
+    dummy_pkg_entrypoints = EntryPoints(
+        [
+            EntryPoint(
+                "dummy2", "xarray.tests.test_plugins:backend_1", "xarray.backends"
+            ),
+            EntryPoint(
+                "dummy1", "xarray.tests.test_plugins:backend_1", "xarray.backends"
+            ),
+        ]
+    )
     backend_entrypoints = list(plugins.build_engines(dummy_pkg_entrypoints))
 
     indices = []
     for be in plugins.STANDARD_BACKENDS_ORDER:
         try:
             index = backend_entrypoints.index(be)
             backend_entrypoints.pop(index)
@@ -188,15 +216,14 @@
 def test_lazy_import() -> None:
     """Test that some modules are imported in a lazy manner.
 
     When importing xarray these should not be imported as well.
     Only when running code for the first time that requires them.
     """
     blacklisted = [
-        # "cfgrib",  # TODO: cfgrib has its own plugin now, deprecate?
         "h5netcdf",
         "netCDF4",
         "PseudoNetCDF",
         "pydap",
         "Nio",
         "scipy",
         "zarr",
@@ -236,7 +263,61 @@
         assert (
             len(is_imported) == 0
         ), f"{is_imported} have been imported but should be lazy"
 
     finally:
         # restore original
         sys.modules.update(modules_backup)
+
+
+def test_list_engines() -> None:
+    from xarray.backends import list_engines
+
+    engines = list_engines()
+    assert list_engines.cache_info().currsize == 1
+
+    assert ("scipy" in engines) == has_scipy
+    assert ("h5netcdf" in engines) == has_h5netcdf
+    assert ("netcdf4" in engines) == has_netCDF4
+    assert ("pseudonetcdf" in engines) == has_pseudonetcdf
+    assert ("pydap" in engines) == has_pydap
+    assert ("zarr" in engines) == has_zarr
+    assert ("pynio" in engines) == has_pynio
+    assert "store" in engines
+
+
+def test_refresh_engines() -> None:
+    from xarray.backends import list_engines, refresh_engines
+
+    EntryPointMock1 = mock.MagicMock()
+    EntryPointMock1.name = "test1"
+    EntryPointMock1.load.return_value = DummyBackendEntrypoint1
+
+    if sys.version_info >= (3, 10):
+        return_value = EntryPoints([EntryPointMock1])
+    else:
+        return_value = {"xarray.backends": [EntryPointMock1]}
+
+    with mock.patch("xarray.backends.plugins.entry_points", return_value=return_value):
+        list_engines.cache_clear()
+        engines = list_engines()
+    assert "test1" in engines
+    assert isinstance(engines["test1"], DummyBackendEntrypoint1)
+
+    EntryPointMock2 = mock.MagicMock()
+    EntryPointMock2.name = "test2"
+    EntryPointMock2.load.return_value = DummyBackendEntrypoint2
+
+    if sys.version_info >= (3, 10):
+        return_value2 = EntryPoints([EntryPointMock2])
+    else:
+        return_value2 = {"xarray.backends": [EntryPointMock2]}
+
+    with mock.patch("xarray.backends.plugins.entry_points", return_value=return_value2):
+        refresh_engines()
+        engines = list_engines()
+    assert "test1" not in engines
+    assert "test2" in engines
+    assert isinstance(engines["test2"], DummyBackendEntrypoint2)
+
+    # reset to original
+    refresh_engines()
```

### Comparing `xarray-2023.3.0/xarray/tests/test_rolling.py` & `xarray-2023.4.0/xarray/tests/test_rolling.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_sparse.py` & `xarray-2023.4.0/xarray/tests/test_sparse.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_testing.py` & `xarray-2023.4.0/xarray/tests/test_testing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_tutorial.py` & `xarray-2023.4.0/xarray/tests/test_tutorial.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_ufuncs.py` & `xarray-2023.4.0/xarray/tests/test_ufuncs.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_units.py` & `xarray-2023.4.0/xarray/tests/test_units.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tests/test_utils.py` & `xarray-2023.4.0/xarray/tests/test_utils.py`

 * *Files 2% similar despite different names*

```diff
@@ -19,19 +19,21 @@
         old_method = utils.alias(new_method, "old_method")
         assert "deprecated" in old_method.__doc__
         with pytest.warns(Warning, match="deprecated"):
             old_method()
 
 
 @pytest.mark.parametrize(
-    "a, b, expected", [["a", "b", np.array(["a", "b"])], [1, 2, pd.Index([1, 2])]]
+    ["a", "b", "expected"],
+    [
+        [np.array(["a"]), np.array(["b"]), np.array(["a", "b"])],
+        [np.array([1], dtype="int64"), np.array([2], dtype="int64"), pd.Index([1, 2])],
+    ],
 )
 def test_maybe_coerce_to_str(a, b, expected):
-    a = np.array([a])
-    b = np.array([b])
     index = pd.Index(a).append(pd.Index(b))
 
     actual = utils.maybe_coerce_to_str(index, [a, b])
 
     assert_array_equal(expected, actual)
     assert expected.dtype == actual.dtype
```

### Comparing `xarray-2023.3.0/xarray/tests/test_variable.py` & `xarray-2023.4.0/xarray/tests/test_variable.py`

 * *Files 2% similar despite different names*

```diff
@@ -200,25 +200,27 @@
 
     def test_index_0d_string(self):
         value = "foo"
         dtype = np.dtype("U3")
         x = self.cls(["x"], [value])
         self._assertIndexedLikeNDArray(x, value, dtype)
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_index_0d_datetime(self):
         d = datetime(2000, 1, 1)
         x = self.cls(["x"], [d])
         self._assertIndexedLikeNDArray(x, np.datetime64(d))
 
         x = self.cls(["x"], [np.datetime64(d)])
         self._assertIndexedLikeNDArray(x, np.datetime64(d), "datetime64[ns]")
 
         x = self.cls(["x"], pd.DatetimeIndex([d]))
         self._assertIndexedLikeNDArray(x, np.datetime64(d), "datetime64[ns]")
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_index_0d_timedelta64(self):
         td = timedelta(hours=1)
 
         x = self.cls(["x"], [np.timedelta64(td)])
         self._assertIndexedLikeNDArray(x, np.timedelta64(td), "timedelta64[ns]")
 
         x = self.cls(["x"], pd.to_timedelta([td]))
@@ -271,14 +273,15 @@
 
     def test_0d_time_data(self):
         # regression test for #105
         x = self.cls("time", pd.date_range("2000-01-01", periods=5))
         expected = np.datetime64("2000-01-01", "ns")
         assert x[0].values == expected
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_datetime64_conversion(self):
         times = pd.date_range("2000-01-01", periods=3)
         for values, preserve_source in [
             (times, True),
             (times.values, True),
             (times.values.astype("datetime64[s]"), False),
             (times.to_pydatetime(), False),
@@ -286,14 +289,15 @@
             v = self.cls(["t"], values)
             assert v.dtype == np.dtype("datetime64[ns]")
             assert_array_equal(v.values, times.values)
             assert v.values.dtype == np.dtype("datetime64[ns]")
             same_source = source_ndarray(v.values) is source_ndarray(values)
             assert preserve_source == same_source
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_timedelta64_conversion(self):
         times = pd.timedelta_range(start=0, periods=3)
         for values, preserve_source in [
             (times, True),
             (times.values, True),
             (times.values.astype("timedelta64[s]"), False),
             (times.to_pytimedelta(), False),
@@ -306,21 +310,23 @@
             assert preserve_source == same_source
 
     def test_object_conversion(self):
         data = np.arange(5).astype(str).astype(object)
         actual = self.cls("x", data)
         assert actual.dtype == data.dtype
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_datetime64_valid_range(self):
         data = np.datetime64("1250-01-01", "us")
         pderror = pd.errors.OutOfBoundsDatetime
         with pytest.raises(pderror, match=r"Out of bounds nanosecond"):
             self.cls(["t"], [data])
 
     @pytest.mark.xfail(reason="pandas issue 36615")
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_timedelta64_valid_range(self):
         data = np.timedelta64("200000", "D")
         pderror = pd.errors.OutOfBoundsTimedelta
         with pytest.raises(pderror, match=r"Out of bounds nanosecond"):
             self.cls(["t"], [data])
 
     def test_pandas_data(self):
@@ -451,14 +457,31 @@
             expected.set_dims({"x": 3}),
             expected.copy(deep=True),
             expected.copy(deep=False),
         ]:
             assert_identical(expected.to_base_variable(), actual.to_base_variable())
             assert expected.encoding == actual.encoding
 
+    def test_reset_encoding(self) -> None:
+        encoding1 = {"scale_factor": 1}
+        # encoding set via cls constructor
+        v1 = self.cls(["a"], [0, 1, 2], encoding=encoding1)
+        assert v1.encoding == encoding1
+        v2 = v1.reset_encoding()
+        assert v1.encoding == encoding1
+        assert v2.encoding == {}
+
+        # encoding set via setter
+        encoding3 = {"scale_factor": 10}
+        v3 = self.cls(["a"], [0, 1, 2], encoding=encoding3)
+        assert v3.encoding == encoding3
+        v4 = v3.reset_encoding()
+        assert v3.encoding == encoding3
+        assert v4.encoding == {}
+
     def test_concat(self):
         x = np.arange(5)
         y = np.arange(5, 10)
         v = self.cls(["a"], x)
         w = self.cls(["a"], y)
         assert_identical(
             Variable(["b", "a"], np.array([x, y])), Variable.concat([v, w], "b")
@@ -1058,26 +1081,28 @@
         v = Variable([], np.float32(0.0))
         assert v.item() == 0
         assert type(v.item()) is float
 
         v = IndexVariable("x", np.arange(5))
         assert 2 == v.searchsorted(2)
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_datetime64_conversion_scalar(self):
         expected = np.datetime64("2000-01-01", "ns")
         for values in [
             np.datetime64("2000-01-01"),
             pd.Timestamp("2000-01-01T00"),
             datetime(2000, 1, 1),
         ]:
             v = Variable([], values)
             assert v.dtype == np.dtype("datetime64[ns]")
             assert v.values == expected
             assert v.values.dtype == np.dtype("datetime64[ns]")
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_timedelta64_conversion_scalar(self):
         expected = np.timedelta64(24 * 60 * 60 * 10**9, "ns")
         for values in [
             np.timedelta64(1, "D"),
             pd.Timedelta("1 day"),
             timedelta(days=1),
         ]:
@@ -1096,14 +1121,15 @@
         assert v.values == bytes("foo", "ascii")
 
     def test_0d_datetime(self):
         v = Variable([], pd.Timestamp("2000-01-01"))
         assert v.dtype == np.dtype("datetime64[ns]")
         assert v.values == np.datetime64("2000-01-01", "ns")
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_0d_timedelta(self):
         for td in [pd.to_timedelta("1s"), np.timedelta64(1, "s")]:
             v = Variable([], td)
             assert v.dtype == np.dtype("timedelta64[ns]")
             assert v.values == np.timedelta64(10**9, "ns")
 
     def test_equals_and_identical(self):
@@ -1534,14 +1560,15 @@
         assert_identical(expected_ell, actual)
 
         # test missing dimension, raise warning
         with pytest.warns(UserWarning):
             v.transpose(..., "not_a_dim", missing_dims="warn")
             assert_identical(expected_ell, actual)
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_transpose_0d(self):
         for value in [
             3.5,
             ("a", 1),
             np.datetime64("2000-01-01"),
             np.timedelta64(1, "h"),
             None,
@@ -2197,17 +2224,21 @@
                 func=test_func,
                 boundary="exact",
                 side="left",
             )
         assert new.attrs == _attrs
 
 
+def _init_dask_variable(*args, **kwargs):
+    return Variable(*args, **kwargs).chunk()
+
+
 @requires_dask
 class TestVariableWithDask(VariableSubclassobjects):
-    cls = staticmethod(lambda *args: Variable(*args).chunk())
+    cls = staticmethod(_init_dask_variable)
 
     def test_chunk(self):
         unblocked = Variable(["dim_0", "dim_1"], np.ones((3, 4)))
         assert unblocked.chunks is None
 
         blocked = unblocked.chunk()
         assert blocked.chunks == ((3,), (4,))
@@ -2515,14 +2546,15 @@
         original = np.ma.MaskedArray(np.arange(5), mask=4 * [False] + [True])
         expected = np.arange(5.0)
         expected[-1] = np.nan
         actual = as_compatible_data(original)
         assert_array_equal(expected, actual)
         assert np.dtype(float) == actual.dtype
 
+    @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_datetime(self):
         expected = np.datetime64("2000-01-01")
         actual = as_compatible_data(expected)
         assert expected == actual
         assert np.ndarray == type(actual)
         assert np.dtype("datetime64[ns]") == actual.dtype
```

### Comparing `xarray-2023.3.0/xarray/tests/test_weighted.py` & `xarray-2023.4.0/xarray/tests/test_weighted.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/tutorial.py` & `xarray-2023.4.0/xarray/tutorial.py`

 * *Files 16% similar despite different names*

```diff
@@ -5,21 +5,19 @@
 * building tutorials in the documentation.
 
 """
 from __future__ import annotations
 
 import os
 import pathlib
-import warnings
 from typing import TYPE_CHECKING
 
 import numpy as np
 
 from xarray.backends.api import open_dataset as _open_dataset
-from xarray.backends.rasterio_ import open_rasterio as _open_rasterio
 from xarray.core.dataarray import DataArray
 from xarray.core.dataset import Dataset
 
 if TYPE_CHECKING:
     from xarray.backends.api import T_Engine
 
 
@@ -36,18 +34,14 @@
     elif path is None:
         path = pooch.os_cache(_default_cache_dir_name)
 
     return path
 
 
 external_urls = {}  # type: dict
-external_rasterio_urls = {
-    "RGB.byte": "https://github.com/rasterio/rasterio/raw/1.2.1/tests/data/RGB.byte.tif",
-    "shade": "https://github.com/rasterio/rasterio/raw/1.2.1/tests/data/shade.tif",
-}
 file_formats = {
     "air_temperature": 3,
     "air_temperature_gradient": 4,
     "ASE_ice_velocity": 4,
     "basin_mask": 4,
     "ersstv5": 4,
     "rasm": 3,
@@ -149,105 +143,33 @@
             default_extension = ".nc"
             if engine is None:
                 _check_netcdf_engine_installed(name)
             path = path.with_suffix(default_extension)
         elif path.suffix == ".grib":
             if engine is None:
                 engine = "cfgrib"
+                try:
+                    import cfgrib  # noqa
+                except ImportError as e:
+                    raise ImportError(
+                        "Reading this tutorial dataset requires the cfgrib package."
+                    ) from e
 
         url = f"{base_url}/raw/{version}/{path.name}"
 
     # retrieve the file
     filepath = pooch.retrieve(url=url, known_hash=None, path=cache_dir)
     ds = _open_dataset(filepath, engine=engine, **kws)
     if not cache:
         ds = ds.load()
         pathlib.Path(filepath).unlink()
 
     return ds
 
 
-def open_rasterio(
-    name,
-    engine=None,
-    cache=True,
-    cache_dir=None,
-    **kws,
-):
-    """
-    Open a rasterio dataset from the online repository (requires internet).
-
-    .. deprecated:: 0.20.0
-
-        Deprecated in favor of rioxarray.
-        For information about transitioning, see:
-        https://corteva.github.io/rioxarray/stable/getting_started/getting_started.html
-
-    If a local copy is found then always use that to avoid network traffic.
-
-    Available datasets:
-
-    * ``"RGB.byte"``: TIFF file derived from USGS Landsat 7 ETM imagery.
-    * ``"shade"``: TIFF file derived from from USGS SRTM 90 data
-
-    ``RGB.byte`` and ``shade`` are downloaded from the ``rasterio`` repository [1]_.
-
-    Parameters
-    ----------
-    name : str
-        Name of the file containing the dataset.
-        e.g. 'RGB.byte'
-    cache_dir : path-like, optional
-        The directory in which to search for and write cached data.
-    cache : bool, optional
-        If True, then cache data locally for use on subsequent calls
-    **kws : dict, optional
-        Passed to xarray.open_rasterio
-
-    See Also
-    --------
-    xarray.open_rasterio
-
-    References
-    ----------
-    .. [1] https://github.com/rasterio/rasterio
-    """
-    warnings.warn(
-        "open_rasterio is Deprecated in favor of rioxarray. "
-        "For information about transitioning, see: "
-        "https://corteva.github.io/rioxarray/stable/getting_started/getting_started.html",
-        DeprecationWarning,
-        stacklevel=2,
-    )
-    try:
-        import pooch
-    except ImportError as e:
-        raise ImportError(
-            "tutorial.open_rasterio depends on pooch to download and manage datasets."
-            " To proceed please install pooch."
-        ) from e
-
-    logger = pooch.get_logger()
-    logger.setLevel("WARNING")
-
-    cache_dir = _construct_cache_dir(cache_dir)
-    url = external_rasterio_urls.get(name)
-    if url is None:
-        raise ValueError(f"unknown rasterio dataset: {name}")
-
-    # retrieve the file
-    filepath = pooch.retrieve(url=url, known_hash=None, path=cache_dir)
-    arr = _open_rasterio(filepath, **kws)
-    if not cache:
-        arr = arr.load()
-        pathlib.Path(filepath).unlink()
-
-    return arr
-
-
 def load_dataset(*args, **kwargs) -> Dataset:
     """
     Open, load into memory, and close a dataset from the online repository
     (requires internet).
 
     If a local copy is found then always use that to avoid network traffic.
```

### Comparing `xarray-2023.3.0/xarray/util/deprecation_helpers.py` & `xarray-2023.4.0/xarray/util/deprecation_helpers.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/util/generate_aggregations.py` & `xarray-2023.4.0/xarray/util/generate_aggregations.py`

 * *Files 1% similar despite different names*

```diff
@@ -333,15 +333,15 @@
         yield self.generate_code(method)
 
     def generate_example(self, method):
         create_da = f"""
         >>> da = xr.DataArray({method.np_example_array},
         ...     dims="time",
         ...     coords=dict(
-        ...         time=("time", pd.date_range("01-01-2001", freq="M", periods=6)),
+        ...         time=("time", pd.date_range("2001-01-01", freq="M", periods=6)),
         ...         labels=("time", np.array(["a", "b", "c", "c", "b", "a"])),
         ...     ),
         ... )"""
 
         calculation = f"{self.datastructure.example_var_name}{self.example_call_preamble}.{method.name}"
         if method.extra_kwargs:
             extra_examples = "".join(
```

### Comparing `xarray-2023.3.0/xarray/util/generate_ops.py` & `xarray-2023.4.0/xarray/util/generate_ops.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.3.0/xarray/util/print_versions.py` & `xarray-2023.4.0/xarray/util/print_versions.py`

 * *Files 4% similar despite different names*

```diff
@@ -104,16 +104,14 @@
         ("h5netcdf", lambda mod: mod.__version__),
         ("h5py", lambda mod: mod.__version__),
         ("Nio", lambda mod: mod.__version__),
         ("zarr", lambda mod: mod.__version__),
         ("cftime", lambda mod: mod.__version__),
         ("nc_time_axis", lambda mod: mod.__version__),
         ("PseudoNetCDF", lambda mod: mod.__version__),
-        ("rasterio", lambda mod: mod.__version__),
-        ("cfgrib", lambda mod: mod.__version__),
         ("iris", lambda mod: mod.__version__),
         ("bottleneck", lambda mod: mod.__version__),
         ("dask", lambda mod: mod.__version__),
         ("distributed", lambda mod: mod.__version__),
         ("matplotlib", lambda mod: mod.__version__),
         ("cartopy", lambda mod: mod.__version__),
         ("seaborn", lambda mod: mod.__version__),
```

### Comparing `xarray-2023.3.0/xarray.egg-info/PKG-INFO` & `xarray-2023.4.0/xarray.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: xarray
-Version: 2023.3.0
+Version: 2023.4.0
 Summary: N-D labeled arrays and datasets in Python
 Home-page: https://github.com/pydata/xarray
 Author: xarray Developers
 Author-email: xarray@googlegroups.com
 License: Apache-2.0
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: License :: OSI Approved :: Apache Software License
```

### Comparing `xarray-2023.3.0/xarray.egg-info/SOURCES.txt` & `xarray-2023.4.0/xarray.egg-info/SOURCES.txt`

 * *Files 2% similar despite different names*

```diff
@@ -16,14 +16,15 @@
 pyproject.toml
 requirements.txt
 setup.cfg
 setup.py
 .binder/environment.yml
 .github/FUNDING.yml
 .github/PULL_REQUEST_TEMPLATE.md
+.github/config.yml
 .github/dependabot.yml
 .github/labeler.yml
 .github/stale.yml
 .github/ISSUE_TEMPLATE/bugreport.yml
 .github/ISSUE_TEMPLATE/config.yml
 .github/ISSUE_TEMPLATE/misc.yml
 .github/ISSUE_TEMPLATE/newfeature.yml
@@ -37,14 +38,15 @@
 .github/workflows/publish-test-results.yaml
 .github/workflows/pypi-release.yaml
 .github/workflows/testpypi-release.yaml
 .github/workflows/upstream-dev-ci.yaml
 asv_bench/asv.conf.json
 asv_bench/benchmarks/README_CI.md
 asv_bench/benchmarks/__init__.py
+asv_bench/benchmarks/alignment.py
 asv_bench/benchmarks/combine.py
 asv_bench/benchmarks/dataarray_missing.py
 asv_bench/benchmarks/dataset_io.py
 asv_bench/benchmarks/groupby.py
 asv_bench/benchmarks/import.py
 asv_bench/benchmarks/indexing.py
 asv_bench/benchmarks/interp.py
@@ -128,16 +130,14 @@
 doc/examples/weather-data.ipynb
 doc/examples/_code/accessor_example.py
 doc/gallery/README.txt
 doc/gallery/plot_cartopy_facetgrid.py
 doc/gallery/plot_colorbar_center.py
 doc/gallery/plot_control_colorbar.py
 doc/gallery/plot_lines_from_2d.py
-doc/gallery/plot_rasterio.py
-doc/gallery/plot_rasterio_rgb.py
 doc/getting-started-guide/faq.rst
 doc/getting-started-guide/index.rst
 doc/getting-started-guide/installing.rst
 doc/getting-started-guide/quick-overview.rst
 doc/getting-started-guide/why-xarray.rst
 doc/internals/duck-arrays-integration.rst
 doc/internals/extending-xarray.rst
@@ -183,28 +183,26 @@
 xarray.egg-info/SOURCES.txt
 xarray.egg-info/dependency_links.txt
 xarray.egg-info/not-zip-safe
 xarray.egg-info/requires.txt
 xarray.egg-info/top_level.txt
 xarray/backends/__init__.py
 xarray/backends/api.py
-xarray/backends/cfgrib_.py
 xarray/backends/common.py
 xarray/backends/file_manager.py
 xarray/backends/h5netcdf_.py
 xarray/backends/locks.py
 xarray/backends/lru_cache.py
 xarray/backends/memory.py
 xarray/backends/netCDF4_.py
 xarray/backends/netcdf3.py
 xarray/backends/plugins.py
 xarray/backends/pseudonetcdf_.py
 xarray/backends/pydap_.py
 xarray/backends/pynio_.py
-xarray/backends/rasterio_.py
 xarray/backends/scipy_.py
 xarray/backends/store.py
 xarray/backends/zarr.py
 xarray/coding/__init__.py
 xarray/coding/calendar_ops.py
 xarray/coding/cftime_offsets.py
 xarray/coding/cftimeindex.py
```

