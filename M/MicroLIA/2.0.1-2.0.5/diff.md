# Comparing `tmp/MicroLIA-2.0.1.tar.gz` & `tmp/MicroLIA-2.0.5.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "MicroLIA-2.0.1.tar", last modified: Mon Mar  6 02:09:11 2023, max compression
+gzip compressed data, was "MicroLIA-2.0.5.tar", last modified: Fri Apr 14 06:45:27 2023, max compression
```

## Comparing `MicroLIA-2.0.1.tar` & `MicroLIA-2.0.5.tar`

### file list

```diff
@@ -1,30 +1,30 @@
-drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-03-06 02:09:11.330079 MicroLIA-2.0.1/
--rwxr-xr-x   0 daniel     (501) staff       (20)    35141 2022-10-18 03:09:36.000000 MicroLIA-2.0.1/LICENSE.txt
--rw-r--r--   0 daniel     (501) staff       (20)       37 2022-10-18 03:09:36.000000 MicroLIA-2.0.1/MANIFEST.in
-drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-03-06 02:09:11.318067 MicroLIA-2.0.1/MicroLIA/
--rwxr-xr-x   0 daniel     (501) staff       (20)      365 2022-08-12 15:04:07.000000 MicroLIA-2.0.1/MicroLIA/__init__.py
--rw-r--r--   0 daniel     (501) staff       (20)    63226 2023-03-05 02:11:11.000000 MicroLIA-2.0.1/MicroLIA/cnn_model.py
-drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-03-06 02:09:11.328582 MicroLIA-2.0.1/MicroLIA/data/
--rwxr-xr-x   0 daniel     (501) staff       (20)  1384833 2022-07-17 06:13:15.000000 MicroLIA-2.0.1/MicroLIA/data/Miras_vo.xml
--rwxr-xr-x   0 daniel     (501) staff       (20)       26 2022-07-17 06:13:15.000000 MicroLIA-2.0.1/MicroLIA/data/__init__.py
--rw-r--r--   0 daniel     (501) staff       (20)    13239 2023-02-26 05:38:47.000000 MicroLIA-2.0.1/MicroLIA/data_augmentation.py
--rw-r--r--   0 daniel     (501) staff       (20)    13063 2023-02-26 05:39:07.000000 MicroLIA-2.0.1/MicroLIA/data_processing.py
--rw-r--r--   0 daniel     (501) staff       (20)    49751 2023-03-06 00:59:12.000000 MicroLIA-2.0.1/MicroLIA/ensemble_model.py
--rwxr-xr-x   0 daniel     (501) staff       (20)     4660 2023-02-26 07:06:35.000000 MicroLIA-2.0.1/MicroLIA/extract_features.py
--rwxr-xr-x   0 daniel     (501) staff       (20)    55962 2023-02-26 07:01:21.000000 MicroLIA-2.0.1/MicroLIA/features.py
--rwxr-xr-x   0 daniel     (501) staff       (20)     2644 2022-07-17 06:13:15.000000 MicroLIA-2.0.1/MicroLIA/noise_models.py
--rw-r--r--   0 daniel     (501) staff       (20)    98544 2023-03-05 05:18:40.000000 MicroLIA-2.0.1/MicroLIA/optimization.py
--rwxr-xr-x   0 daniel     (501) staff       (20)     4419 2023-02-26 05:00:18.000000 MicroLIA-2.0.1/MicroLIA/quality_check.py
--rwxr-xr-x   0 daniel     (501) staff       (20)    12914 2023-02-26 04:59:36.000000 MicroLIA-2.0.1/MicroLIA/simulate.py
--rwxr-xr-x   0 daniel     (501) staff       (20)    22811 2023-02-26 09:46:41.000000 MicroLIA-2.0.1/MicroLIA/training_set.py
-drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-03-06 02:09:11.321953 MicroLIA-2.0.1/MicroLIA.egg-info/
--rw-r--r--   0 daniel     (501) staff       (20)      572 2023-03-06 02:09:11.000000 MicroLIA-2.0.1/MicroLIA.egg-info/PKG-INFO
--rw-r--r--   0 daniel     (501) staff       (20)      569 2023-03-06 02:09:11.000000 MicroLIA-2.0.1/MicroLIA.egg-info/SOURCES.txt
--rw-r--r--   0 daniel     (501) staff       (20)        1 2023-03-06 02:09:11.000000 MicroLIA-2.0.1/MicroLIA.egg-info/dependency_links.txt
--rw-r--r--   0 daniel     (501) staff       (20)      161 2023-03-06 02:09:11.000000 MicroLIA-2.0.1/MicroLIA.egg-info/requires.txt
--rw-r--r--   0 daniel     (501) staff       (20)        9 2023-03-06 02:09:11.000000 MicroLIA-2.0.1/MicroLIA.egg-info/top_level.txt
--rw-r--r--   0 daniel     (501) staff       (20)      572 2023-03-06 02:09:11.329533 MicroLIA-2.0.1/PKG-INFO
--rwxr-xr-x   0 daniel     (501) staff       (20)     2641 2022-10-18 03:09:36.000000 MicroLIA-2.0.1/README.md
--rw-r--r--   0 daniel     (501) staff       (20)      388 2023-03-06 02:03:28.000000 MicroLIA-2.0.1/pyproject.toml
--rw-r--r--   0 daniel     (501) staff       (20)       38 2023-03-06 02:09:11.330240 MicroLIA-2.0.1/setup.cfg
--rwxr-xr-x   0 daniel     (501) staff       (20)     1121 2023-03-06 02:03:34.000000 MicroLIA-2.0.1/setup.py
+drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-04-14 06:45:27.257535 MicroLIA-2.0.5/
+-rwxr-xr-x   0 daniel     (501) staff       (20)    35141 2022-10-18 03:09:36.000000 MicroLIA-2.0.5/LICENSE.txt
+-rw-r--r--   0 daniel     (501) staff       (20)       37 2022-10-18 03:09:36.000000 MicroLIA-2.0.5/MANIFEST.in
+drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-04-14 06:45:27.240343 MicroLIA-2.0.5/MicroLIA/
+-rwxr-xr-x   0 daniel     (501) staff       (20)      365 2022-08-12 15:04:07.000000 MicroLIA-2.0.5/MicroLIA/__init__.py
+-rw-r--r--   0 daniel     (501) staff       (20)   172040 2023-04-14 06:01:24.000000 MicroLIA-2.0.5/MicroLIA/cnn_model.py
+drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-04-14 06:45:27.254087 MicroLIA-2.0.5/MicroLIA/data/
+-rwxr-xr-x   0 daniel     (501) staff       (20)  1384833 2022-07-17 06:13:15.000000 MicroLIA-2.0.5/MicroLIA/data/Miras_vo.xml
+-rwxr-xr-x   0 daniel     (501) staff       (20)       26 2022-07-17 06:13:15.000000 MicroLIA-2.0.5/MicroLIA/data/__init__.py
+-rw-r--r--   0 daniel     (501) staff       (20)    36126 2023-04-14 06:02:09.000000 MicroLIA-2.0.5/MicroLIA/data_augmentation.py
+-rw-r--r--   0 daniel     (501) staff       (20)    12888 2023-04-14 06:05:32.000000 MicroLIA-2.0.5/MicroLIA/data_processing.py
+-rw-r--r--   0 daniel     (501) staff       (20)    54677 2023-04-14 06:20:00.000000 MicroLIA-2.0.5/MicroLIA/ensemble_model.py
+-rwxr-xr-x   0 daniel     (501) staff       (20)     5250 2023-03-30 05:00:56.000000 MicroLIA-2.0.5/MicroLIA/extract_features.py
+-rwxr-xr-x   0 daniel     (501) staff       (20)   117151 2023-03-30 03:46:20.000000 MicroLIA-2.0.5/MicroLIA/features.py
+-rwxr-xr-x   0 daniel     (501) staff       (20)     2719 2023-03-19 23:16:44.000000 MicroLIA-2.0.5/MicroLIA/noise_models.py
+-rw-r--r--   0 daniel     (501) staff       (20)   130007 2023-04-14 05:58:12.000000 MicroLIA-2.0.5/MicroLIA/optimization.py
+-rwxr-xr-x   0 daniel     (501) staff       (20)     4419 2023-02-26 05:00:18.000000 MicroLIA-2.0.5/MicroLIA/quality_check.py
+-rwxr-xr-x   0 daniel     (501) staff       (20)    12914 2023-02-26 04:59:36.000000 MicroLIA-2.0.5/MicroLIA/simulate.py
+-rwxr-xr-x   0 daniel     (501) staff       (20)    25733 2023-04-14 06:18:09.000000 MicroLIA-2.0.5/MicroLIA/training_set.py
+drwxr-xr-x   0 daniel     (501) staff       (20)        0 2023-04-14 06:45:27.246483 MicroLIA-2.0.5/MicroLIA.egg-info/
+-rw-r--r--   0 daniel     (501) staff       (20)      572 2023-04-14 06:45:27.000000 MicroLIA-2.0.5/MicroLIA.egg-info/PKG-INFO
+-rw-r--r--   0 daniel     (501) staff       (20)      569 2023-04-14 06:45:27.000000 MicroLIA-2.0.5/MicroLIA.egg-info/SOURCES.txt
+-rw-r--r--   0 daniel     (501) staff       (20)        1 2023-04-14 06:45:27.000000 MicroLIA-2.0.5/MicroLIA.egg-info/dependency_links.txt
+-rw-r--r--   0 daniel     (501) staff       (20)      178 2023-04-14 06:45:27.000000 MicroLIA-2.0.5/MicroLIA.egg-info/requires.txt
+-rw-r--r--   0 daniel     (501) staff       (20)        9 2023-04-14 06:45:27.000000 MicroLIA-2.0.5/MicroLIA.egg-info/top_level.txt
+-rw-r--r--   0 daniel     (501) staff       (20)      572 2023-04-14 06:45:27.257084 MicroLIA-2.0.5/PKG-INFO
+-rwxr-xr-x   0 daniel     (501) staff       (20)     2641 2022-10-18 03:09:36.000000 MicroLIA-2.0.5/README.md
+-rw-r--r--   0 daniel     (501) staff       (20)      417 2023-03-07 06:54:07.000000 MicroLIA-2.0.5/pyproject.toml
+-rw-r--r--   0 daniel     (501) staff       (20)       38 2023-04-14 06:45:27.257665 MicroLIA-2.0.5/setup.cfg
+-rwxr-xr-x   0 daniel     (501) staff       (20)     1141 2023-04-14 06:43:17.000000 MicroLIA-2.0.5/setup.py
```

### Comparing `MicroLIA-2.0.1/LICENSE.txt` & `MicroLIA-2.0.5/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `MicroLIA-2.0.1/MicroLIA/data/Miras_vo.xml` & `MicroLIA-2.0.5/MicroLIA/data/Miras_vo.xml`

 * *Files identical despite different names*

### Comparing `MicroLIA-2.0.1/MicroLIA/data_processing.py` & `MicroLIA-2.0.5/MicroLIA/data_processing.py`

 * *Files 3% similar despite different names*

```diff
@@ -127,30 +127,29 @@
     """
     This function will apply min-max normalization. It returns a 4-d array.
     
     Note:
         min_pixel must be a single input, but the max_pixel can either be 
         an int/float or a list. If it is an int/float then
 
+        Non-subtracted images in the NDWFS Bootes survey data (Bw):
+        NDWFS min 0.01% : 638.186
+        NDWFS max 99.99% : 7350.639
+        Max intensity of expected blobs : ~3000
+    
+
     Args:
         channel (array): 2D array for one image, 3D array for multiple images.
         min_pixel (int, optional): The minimum pixel count, defaults to 0. 
             Pixels with counts below this threshold will be set to this limit.
         max_pixel (int, optional): The maximum pixel count, defaults to 100. 
             Pixels with counts above this threshold will be set to this limit.
 
     Returns:      
         Reshaped data and label arrays.
-
-    Note:
-        In the context of diffuse nebulae detection, the max_pixel value should 
-        be slightly above the maximum expected count for the nebula, as anything 
-        brighter (such as stars) will be set to the same limit of max_pixel, which
-        will result in more robust classification performance.
-        
     """
 
     if isinstance(max_pixel, int) and img_num_channels != 1:
         raise ValueError('The max_pixel parameter should be a list containing the value for each band!')
     if isinstance(max_pixel, int) is False and img_num_channels == 1:
         if isinstance(max_pixel, list):
             max_pixel = max_pixel[0]
@@ -205,15 +204,15 @@
         Image anomalies can be removed by setting normalize=True, as the 
         values below/above the thresholds are set to the min/max limits. We
         strongly recommend normalizing your data.
 
     Args:
         channel (array): 2D array for one image, 3D array for multiple images.
         img_num_channels (int): The number of filters used. Defaults to 1.
-        label (int, optional): Class label, 1 for positive, 1 for negative. Defaults to None.
+        label (int, optional): Class label, 0 for blob, 1 for other. Defaults to None.
         normalize (bool, optional): True will apply min-max normalization.
         min_pixel (int, optional): The minimum pixel count, defaults to 638. 
             Pixels with counts below this threshold will be set to this limit.
         max_pixel (int, optional): The maximum pixel count, defaults to 3000. 
             Pixels with counts above this threshold will be set to this limit.
 
     Returns:      
@@ -252,15 +251,15 @@
 
     #reshape
     label = np.expand_dims(np.array([label]*len(data)), axis=1)
     label = to_categorical(label, 2)
     
     return data, label
 
-def create_training_set(positive_class, negative_class, img_num_channels=1, normalize=True, min_pixel=638, max_pixel=3000):
+def create_training_set(blob_data, other_data, img_num_channels=1, normalize=True, min_pixel=638, max_pixel=3000):
     """
     Combines image data of known class to create a training set.
     This is used for training the machine learning models. The 
     max_pixel parameter can be a single value corresponding to a single channel
     or to a list containing the value for each individual band.
 
     Note: 
@@ -274,29 +273,27 @@
         >>> class2_data, class2_label = process_class(data2, label=1)
         >>> class3_data, class3_label = process_class(data3, label=2)
 
         >>> training_data = np.r_[class1_data, class2_data, class3_data]
         >>> training_labels = np.r_[class1_label class2_label, class3_label]
 
     Args:
-        positive_class (array): 3D array containing more than one image of the positive class.
-        negative_class (array): 3D array containing more than one image of the negative objects.
+        blob_data (array): 3D array containing more than one image of positive objects.
+        other_data (array): 3D array containing more than one image of non-positive objects.
         img_num_channels (int): The number of filters used. Defaults to 1.
         normalize (bool, optional): True will normalize the data using the input min and max pixels
         min_pixel (int, optional): The minimum pixel count, defaults to 638. 
             Pixels with counts below this threshold will be set to this limit.
         max_pixel (int, optional): The maximum pixel count, defaults to 3000. 
             Pixels with counts above this threshold will be set to this limit.
     
     Returns:      
         Reshaped data and label arrays.
     """
 
-    class1_data, class1_label = process_class(positive_class, label=1, normalize=normalize, min_pixel=min_pixel, max_pixel=max_pixel, img_num_channels=img_num_channels)
-    class2_data, class2_label = process_class(negative_class, label=0, normalize=normalize, min_pixel=min_pixel, max_pixel=max_pixel, img_num_channels=img_num_channels)
+    class1_data, class1_label = process_class(blob_data, label=1, normalize=normalize, min_pixel=min_pixel, max_pixel=max_pixel, img_num_channels=img_num_channels)
+    class2_data, class2_label = process_class(other_data, label=0, normalize=normalize, min_pixel=min_pixel, max_pixel=max_pixel, img_num_channels=img_num_channels)
     
     training_data = np.r_[class1_data, class2_data]
     training_labels = np.r_[class1_label, class2_label]
 
     return training_data, training_labels
-
-
```

### Comparing `MicroLIA-2.0.1/MicroLIA/ensemble_model.py` & `MicroLIA-2.0.5/MicroLIA/ensemble_model.py`

 * *Files 2% similar despite different names*

```diff
@@ -28,43 +28,33 @@
 
 from optuna.importance import get_param_importances, FanovaImportanceEvaluator
 from MicroLIA.optimization import hyper_opt, borutashap_opt, KNN_imputation
 from MicroLIA import extract_features
 from xgboost import XGBClassifier
 import scikitplot as skplt
 
+
 class Classifier:
     """
     Creates a machine learning classifier object. The built-in methods can be used to optimize the engine and output visualizations.
 
-    Note:
-        test_size is an optional parameter to speed up the XGB optimization training.
-        If input a random validation data will be generated according to this size,
-        which will replace the cross-validation method used by default during the
-        optimization procedure. Need more testing to make this more robust, recommended
-        option is test_size = None. The opt_cv parameter should be used instead to set
-        the number of folds to use when assessing optimization trial performance. 
-
     Args:
         data_x (ndarray): 2D array of size (n x m), where n is the
             number of samples, and m the number of features.
         data_y (ndarray, str): 1D array containing the corresponing labels.
         clf (str): The machine learning classifier to optimize. Can either be
             'rf' for Random Forest, 'nn' for Neural Network, or 'xgb' for Extreme Gradient Boosting. 
             Defaults to 'rf'.
         optimize (bool): If True the Boruta algorithm will be run to identify the features
             that contain useful information, after which the optimal Random Forest hyperparameters
             will be calculated using Bayesian optimization. 
         opt_cv (int): Cross-validations to perform when assesing the performance at each
             hyperparameter optimization trial. For example, if cv=3, then each optimization trial
             will be assessed according to the 3-fold cross validation accuracy. Defaults to 10.
             NOTE: The higher this number, the longer the optimization will take.
-        test_size (float, optional): The size of the validation data, will be chosen
-            randomly each trial. Must be between 0 and 1. Defaults to None, in which
-            case the opt_cv parameter will be used instead.
         limit_search (bool): If True, the search space for the parameters will be expanded,
             as there are some hyperparameters that can range from 0 to inf. Defaults to False.
         impute (bool): If False no data imputation will be performed. Defaults to True,
             which will result in two outputs, the classifier and the imputer to save
             for future transformations. 
         imp_method (str): The imputation techinque to apply, can either be 'KNN' for k-nearest
             neighbors imputation, or...?. Defaults to 'KNN'.
@@ -77,35 +67,25 @@
             that this does not have to be the same as the machine learning classifier, clf.
         balance (bool, optional): If True, a weights array will be calculated and used
             when fitting the classifier. This can improve classification when classes
             are imbalanced. This is only applied if the classification is a binary task. 
             Defaults to True.        
         csv_file (DataFrame, optional): The csv file output after generating the training set. This can be
             input in lieu of the data_x and data_y arguments.
-        
-    Attributes:
-        model (object): The machine learning model that is created
-        imputer (object): The imputer created during model creation
-        feats_to_use (ndarray): Array of indices containing the metrics
-            that contribute to classification accuracy.
-        feature_history (object): The Boruta feature selection history result.
-        optimization_results (object): The Optuna hyperparameter optimization history result.
-        best_params (dict): The best parameters output from the optimization routine.
     """
 
     def __init__(self, data_x=None, data_y=None, clf='rf', optimize=False, opt_cv=10, 
-        test_size=None, limit_search=True, impute=True, imp_method='KNN', n_iter=25, 
+        limit_search=True, impute=True, imp_method='KNN', n_iter=25, 
         boruta_trials=50, boruta_model='rf', balance=True, csv_file=None):
 
         self.data_x = data_x
         self.data_y = data_y
         self.clf = clf
         self.optimize = optimize 
         self.opt_cv = opt_cv 
-        self.test_size = test_size
         self.limit_search = limit_search
         self.impute = impute
         self.imp_method = imp_method
         self.n_iter = n_iter
         self.boruta_trials = boruta_trials
         self.boruta_model = boruta_model 
         self.balance = balance 
@@ -124,15 +104,15 @@
             self.data_y = csv_file.label
             print('Successfully loaded the data_x and data_y arrays from the input csv_file!')
         else:
             if self.data_x is None or self.data_y is None:
                 print('NOTE: data_x and data_y parameters are required to output visualizations.')
         
         if self.data_y is not None:
-            self.data_y_ = copy.deepcopy(self.data_y) #For plotting purposes, save the original label array as it will be overwrrite with the numerical labels
+            self.data_y_ = copy.deepcopy(self.data_y) #For plotting purposes, save the original label array as it will be overwrite with the numerical labels when plotting only
             if self.clf == 'xgb':
                 if all(isinstance(val, (int, str)) for val in self.data_y):
                     print('XGBoost classifier requires numerical class labels! Converting class labels as follows:')
                     print('________________________________')
                     y = np.zeros(len(self.data_y))
                     for i in range(len(np.unique(self.data_y))):
                         print(str(np.unique(self.data_y)[i]).ljust(10)+'  ------------->     '+str(i))
@@ -214,32 +194,37 @@
         #Re-construct the imputer with the selected features as
         #new predictions will only compute these metrics, need to fit again!
         if self.imp_method == 'KNN':
             data_x, self.imputer = KNN_imputation(data=self.data_x[:,self.feats_to_use], imputer=None)
         else: 
             data_x = self.data_x[:,self.feats_to_use]
 
-        self.model, self.best_params, self.optimization_results = hyper_opt(data_x, self.data_y, clf=self.clf, n_iter=self.n_iter, 
-            balance=self.balance, return_study=True, limit_search=self.limit_search, opt_cv=self.opt_cv, test_size=self.test_size)
-        print("Fitting and returning final model...")
+        if self.n_iter > 0:
+            self.model, self.best_params, self.optimization_results = hyper_opt(data_x, self.data_y, clf=self.clf, n_iter=self.n_iter, 
+                balance=self.balance, return_study=True, limit_search=self.limit_search, opt_cv=self.opt_cv)
+        else:
+            print("Fitting and returning final model...")
+            self.model = hyper_opt(data_x, self.data_y, clf=self.clf, n_iter=self.n_iter, 
+                balance=self.balance, return_study=True, limit_search=self.limit_search, opt_cv=self.opt_cv)
+
         self.model.fit(data_x, self.data_y)
         
     def save(self, dirname=None, path=None, overwrite=False):
         """
-        Saves the trained classifier in a new directory named 'MicroLIA_models', 
+        Saves the trained classifier in a new directory named 'MicroLIA_ensemble_model', 
         as well as the imputer and the features to use attributes, if not None.
         
         Args:
             dirname (str): The name of the directory where the model folder will be saved.
                 This directory will be created, and therefore if it already exists
                 in the system an error will appear.
             path (str): Absolute path where the data folder will be saved
                 Defaults to None, in which case the directory is saved to the
                 local home directory.
-            overwrite (bool, optional): If True the 'MicroLIA_models' folder this
+            overwrite (bool, optional): If True the 'MicroLIA_ensemble_model' folder this
                 function creates in the specified path will be deleted if it exists
                 and created anew to avoid duplicate files. 
         """
         if self.model is None and self.imputer is None and self.feats_to_use is None:
             raise ValueError('The models have not been created! Run the create() method first.')
 
         if path is None:
@@ -352,25 +337,26 @@
 
         print('Successfully loaded the following class attributes: {}{}{}{}{}{}'.format(model, imputer, feats_to_use, best_params, feature_opt_results, optimization_results))
         
         self.path = path
 
         return
 
-    def predict(self, time, mag, magerr, convert=True, zp=24):
+    def predict(self, time, mag, magerr, convert=True, apply_weights=True, zp=24):
         """
         Predics the class label of new, unseen data.
 
         Args:
             time (ndarray): Array of observation timestamps.
             mag (ndarray): Array of observed magnitudes.
             magerr (ndarray): Array of corresponding magnitude errors.
-            model (object): The machine learning model to use for predictions.
-            convert (bool, optional): If False the features are computed with the input magnitudes.
+            convert (bool): If False the features are computed with the input magnitudes.
                 Defaults to True to convert and compute in flux. 
+            apply_weights (bool): Whether to apply the photometric errors when calculating the features. 
+                Defaults to True. Note that this assumes that the erros are Gaussian and uncorrelated. 
             zp (float): Zeropoint of the instrument, used to convert from magnitude
                 to flux. Defaults to 24.
 
         Returns:
             Array containing the classes and the corresponding probability predictions.
         """
 
@@ -378,19 +364,19 @@
             warn('The number of data points is low -- results may be unstable')
 
         #classes = ['CONSTANT', 'CV', 'LPV', 'ML', 'VARIABLE']
         classes = self.model.classes_
         stat_array=[]
         
         if self.imputer is None and self.feats_to_use is None:
-            stat_array.append(extract_features.extract_all(time, mag, magerr, convert=convert, zp=zp))
+            stat_array.append(extract_features.extract_all(time, mag, magerr, convert=convert, apply_weights=apply_weights, zp=zp))
             pred = self.model.predict_proba(stat_array)
             return np.c_[classes, pred[0]]
         
-        stat_array.append(extract_features.extract_all(time, mag, magerr, convert=convert, zp=zp, feats_to_use=self.feats_to_use))
+        stat_array.append(extract_features.extract_all(time, mag, magerr, convert=convert, apply_weights=apply_weights, zp=zp, feats_to_use=self.feats_to_use))
         
         if self.imputer is not None:
             stat_array = self.imputer.transform(stat_array)
         pred = self.model.predict_proba(stat_array)
 
         return np.c_[classes, pred[0]]
 
@@ -406,15 +392,16 @@
             clearly.
 
         Args:
             data_y (ndarray, optional): A custom labels array, that coincides with
                 the labels in model.data_y. Defaults to None, in which case the
                 model.data_y labels are used.
             special_class (optional): The class label that you wish to highlight,
-                setting this optional parameter will 
+                setting this optional parameter will increase the size and alpha parameter
+                for these points in the plot.
             norm (bool): If True the data will be min-max normalized. Defaults
                 to True.
             pca (bool): If True the data will be fit to a Principal Component
                 Analysis and all of the corresponding principal components will 
                 be used to generate the t-SNE plot. Defaults to False.
             legend_loc (str): Location of legend, using matplotlib style.
             title (str): Title of the figure.
@@ -458,15 +445,15 @@
 
         feats = TSNE(n_components=2, method=method, learning_rate=1000, 
             perplexity=35, init='random').fit_transform(data)
         x, y = feats[:,0], feats[:,1]
      
         markers = ['o', 's', '+', 'v', '.', 'x', 'h', 'p', '<', '>', '*']
         #color = ['b', 'g', 'r', 'c', 'm', 'y', 'k', 'b', 'g', 'r', 'c']
-        color = ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33', '#a65628', '#f781bf']
+        color = ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33', '#a65628', '#f781bf', '#e41a1c', '#377eb8'] #Update the last two!
 
         if data_y is None:
             if self.data_y_ is None:
                 if self.csv_file is None:
                     if data_y is None:
                         data_y = self.data_y
                         feats = np.unique(self.data_y)
@@ -587,14 +574,144 @@
             pca_transformation.fit(data) 
             pca_data = pca_transformation.transform(data)
             data = np.asarray(pca_data).astype('float64')
 
         predicted_target, actual_target = evaluate_model(self.model, data, self.data_y, normalize=normalize, k_fold=k_fold)
         generate_matrix(predicted_target, actual_target, normalize=normalize, classes=classes, title=title, savefig=savefig)
 
+    def plot_roc_curve(self, k_fold=10, pca=False, title="Receiver Operating Characteristic Curve", 
+        savefig=False):
+        """
+        Plots ROC curve with k-fold cross-validation, as such the 
+        standard deviation variations are also plotted.
+        
+        Args:
+            classifier: The machine learning classifier to optimize.
+            data_x (ndarray): 2D array of size (n x m), where n is the
+                number of samples, and m the number of features.
+            data_y (ndarray, str): 1D array containing the corresponing labels.
+            k_fold (int, optional): The number of cross-validations to perform.
+                The output confusion matrix will display the mean accuracy across
+                all k_fold iterations. Defaults to 10.
+            title (str, optional): The title of the output plot.
+            savefig (bool): If True the figure will not disply but will be saved instead.
+                Defaults to False. 
+        
+        Returns:
+            AxesImage
+        """
+        if self.model is None:
+            raise ValueError('No model has been created! Run model.create() first.')
+
+        if self.feats_to_use is not None:
+            if len(self.data_x.shape) == 1:
+                data = self.data_x[self.feats_to_use].reshape(1,-1)
+            else:
+                data = self.data_x[:,self.feats_to_use]
+        else:
+            data = self.data_x[:]
+
+        if np.any(np.isnan(data)):
+            print('Automatically imputing NaN values with KNN imputation...')
+            if self.imputer is not None and self.imp_method == 'KNN':
+                data = KNN_imputation(data=data, imputer=self.imputer)
+            else:
+                data = KNN_imputation(data=data)[0]
+
+        data[data>1e7], data[(data<1e-7)&(data>0)], data[data<-1e7] = 1e7, 1e-7, -1e7
+
+        if pca:
+            pca_transformation = decomposition.PCA(n_components=data.shape[1], whiten=True, svd_solver='auto')
+            pca_transformation.fit(data) 
+            pca_data = pca_transformation.transform(data)
+            data = np.asarray(pca_data).astype('float64')
+        
+        model0 = self.model
+        if len(np.unique(self.data_y)) != 2:
+            X_train, X_test, y_train, y_test = train_test_split(data, self.data_y, test_size=0.2, random_state=0)
+            model0.fit(X_train, y_train)
+            y_probas = model0.predict_proba(X_test)
+            skplt.metrics.plot_roc(y_test, y_probas, text_fontsize='large', title='ROC Curve', cmap='cividis', plot_macro=False, plot_micro=False)
+            plt.show()
+            return
+
+        cv = StratifiedKFold(n_splits=k_fold)
+        
+        tprs = []
+        aucs = []
+        mean_fpr = np.linspace(0, 1, 100)
+
+        train = data
+        fig, ax = plt.subplots()
+
+        for i, (data_x, test) in enumerate(cv.split(train, self.data_y)):
+            model0.fit(train[data_x], self.data_y[data_x])
+            viz = RocCurveDisplay.from_estimator(
+                model0,
+                train[test],
+                self.data_y[test],
+                alpha=0,#0.3,
+                lw=1,
+                ax=ax,
+                name="ROC fold {}".format(i+1),
+            )
+            interp_tpr = np.interp(mean_fpr, viz.fpr, viz.tpr)
+            interp_tpr[0] = 0.0
+            tprs.append(interp_tpr)
+            aucs.append(viz.roc_auc)
+
+        mean_tpr = np.mean(tprs, axis=0)
+        mean_tpr[-1] = 1.0
+        mean_auc = auc(mean_fpr, mean_tpr)
+        std_auc = np.std(aucs)
+        lns1, = ax.plot(
+            mean_fpr,
+            mean_tpr,
+            color="b",
+            #label=r"Mean ROC (AUC = %0.2f $\pm$ %0.2f)" % (mean_auc, std_auc),
+            label=r"Mean (AUC = %0.2f)" % (mean_auc),
+            lw=2,
+            alpha=0.8,
+        )
+
+        std_tpr = np.std(tprs, axis=0)
+        tprs_upper = np.minimum(mean_tpr + std_tpr, 1)
+        tprs_lower = np.maximum(mean_tpr - std_tpr, 0)
+        lns_sigma = ax.fill_between(
+            mean_fpr,
+            tprs_lower,
+            tprs_upper,
+            color="grey",
+            alpha=0.2,
+            label=r"$\pm$ 1$\sigma$",
+        )
+
+        ax.set(
+            xlim=[0, 1.0],
+            ylim=[0.0, 1.0],
+            title="Receiver Operating Characteristic Curve",
+        )
+        
+        lns2, = ax.plot([0, 1], [0, 1], linestyle="--", lw=2, color="r", label="Random (AUC=0.5)", alpha=0.8)
+
+        #handles, labels = ax.get_legend_handles_labels()
+        #ax.legend(handles[-3:], labels[-3:], loc="lower center", ncol=3, frameon=False, handlelength=2)
+        ax.legend([lns2, (lns1, lns_sigma)], ['Random (AUC = 0.5)', r"Mean (AUC = %0.2f)" % (mean_auc)], loc='lower center', ncol=2, frameon=False, handlelength=2)
+
+        ax.set_facecolor("white")
+        plt.ylabel('True Positive Rate')#, size=14)
+        plt.xlabel('False Positive Rate')#, size=14)
+        plt.title(label=title)#,fontsize=18)
+
+        if savefig:
+            plt.savefig('Ensemble_ROC_Curve.png', bbox_inches='tight', dpi=300)
+            plt.clf()
+        else:
+            plt.show()
+
     def plot_hyper_opt(self, baseline=None, xlim=None, ylim=None, xlog=True, ylog=False, 
         savefig=False):
         """
         Plots the hyperparameter optimization history.
     
         Args:
             baseline (float): Baseline accuracy achieved when using only
@@ -669,34 +786,34 @@
         
         if savefig:
             plt.savefig('Ensemble_Hyperparameter_Optimization.png', bbox_inches='tight', dpi=300)
             plt.clf()
         else:
             plt.show()
 
-    def plot_feature_opt(self, feat_names=None, top=3, include_other=True, include_shadow=True, 
+    def plot_feature_opt(self, feat_names=None, top='all', include_other=True, include_shadow=True, 
         include_rejected=False, flip_axes=True, save_data=False, savefig=False):
         """
         Returns whisker plot displaying the z-score distribution of each feature
         across all trials.
     
         Note:
-            The following can be used to output the plot from the original API.
+            The following can be used to output the plot from the original BorutaShap API.
 
             model.feature_history.plot(which_features='accepted', X_size=14)
 
             Can designate to display either 'all', 'accepted', or 'tentative'
 
-
         Args: 
             feat_names (ndarry, optional): A list or array containing the names
                 of the features in the data_x matrix, in order. Defaults to None,
                 in which case the respective indices will appear instead.
-            top (float, optional): Designates how many features to plot. Defaults to 3, which 
-                will plot the top 3 performing features.
+            top (float, optional): Designates how many features to plot. If set to 3, it 
+                will plot the top 3 performing features. Can be 'all' in which casee all features
+                that were accepted are plotted. Defaults to 'all'.
             include_other (bool): Whether to include the features that are not in the top designation,
                 if True these features will be averaged out and displayed. Defaults to True.
             include_shadow (bool): Whether to include the max shadow feature that was used as a 
                 baseline for 'random' behavior. Defaults to True.
             include_rejected (bool): Whether to include the rejected features, if True these features 
                 will be averaged out and displayed.
             flip_axes (bool): Whether transpose the figure. Defaults to True.
@@ -713,34 +830,39 @@
             self.feature_history.results_to_csv(filename=fname)
         except AttributeError:
             raise ValueError('No optimization history found for feature selection, run .create() with optimize=True!')
 
         csv_data = pd.read_csv(fname+'.csv')
         #os.remove(fname+'.csv')
         accepted_indices = np.where(csv_data.Decision == 'Accepted')[0]
-        if top > len(accepted_indices):
+        if top == 'all':
             top = len(accepted_indices)
-            print('The top parameter exceeds the number of accepted variables, setting to the maximum value of {}'.format(str(top)))
+        else:
+            if top > len(accepted_indices):
+                top = len(accepted_indices)
+                print('The top parameter exceeds the number of accepted variables, setting to the maximum value of {}'.format(str(top)))
 
         x, y, y_err = [], [], []
 
         for i in accepted_indices[:top]:
             if feat_names is None:
-                x.append(int(i))
+                if self.csv_file is None:
+                    x.append(int(i))
+                else:
+                    x.append(int(csv_data.iloc[i].Features))
             else:
                 x.append(int(csv_data.iloc[i].Features))
             y.append(float(csv_data.iloc[i]['Average Feature Importance']))
             y_err.append(float(csv_data.iloc[i]['Standard Deviation Importance']))
             
         if len(accepted_indices) == top:
             include_other = False
 
         if include_other:
-            mean = []
-            std = []
+            mean, std = [], []
             for j in accepted_indices[top:]:
                 mean.append(float(csv_data.iloc[j]['Average Feature Importance']))
                 std.append(float(csv_data.iloc[j]['Standard Deviation Importance']))
             x.append(0), y.append(np.mean(mean)), y_err.append(np.mean(std))
 
         if include_shadow:
             ix = np.where(csv_data.Features == 'Max_Shadow')[0]
@@ -763,47 +885,53 @@
                     x_names = np.r_[feat_names[x[:-2]], ['Other Accepted'], ['Max Shadow']]
         else:
             if self.csv_file is None:
                 if include_other is False:
                     if include_shadow is False:
                         x_names = csv_data.iloc[x].Features
                     else:
-                        x_names = np.r_[csv_data.iloc[x[:-1]], ['Max Shadow']]
+                        x_names = np.r_[csv_data.iloc[x[:-1]].Features, ['Max Shadow']]
                 else:
                     if include_shadow is False:
                         x_names = np.r_[csv_data.iloc[x[:-1]].Features, ['Max Shadow']]
                     else:
                         x_names = np.r_[csv_data.iloc[x[:-2]].Features, ['Other Accepted'], ['Max Shadow']]
             else:
                 if include_other is False:
                     if include_shadow is False:
-                        x_names = self.self.csv_file.columns[x[:-1]]
+                        x_names = self.csv_file.columns[x[:-1]]
                     else:
                         x_names = np.r_[self.csv_file.columns[x[:-1]], ['Max Shadow']]
                 else:
                     if include_shadow is False:
                         x_names = np.r_[self.csv_file.columns[x[:-1]], ['Max Shadow']]
                     else:
                         x_names = np.r_[self.csv_file.columns[x[:-2]], ['Other Accepted'], ['Max Shadow']]
 
-
         if include_rejected:
             x = []
             rejected_indices = np.where(csv_data.Decision == 'Rejected')[0]
             for i in rejected_indices:
                 if feat_names is None:
-                    x.append(int(i))
+                    if self.csv_file is None:
+                        x.append(int(i))
+                    else:
+                        x.append(int(csv_data.iloc[i].Features))
                 else:
                     x.append(int(csv_data.iloc[i].Features))
                 y.append(float(csv_data.iloc[i]['Average Feature Importance']))
                 y_err.append(float(csv_data.iloc[i]['Standard Deviation Importance']))
-            if feat_names is not None:
-                x_names = np.r_[x_names, feat_names[x]]
+
+            if feat_names is None:
+                if self.csv_file is None:
+                    x_names = np.r_[x_names, csv_data.iloc[x].Features]
+                else:
+                    x_names = np.r_[x_names, self.csv_file.columns[x]]
             else:
-                x_names = np.r_[x_names, csv_data.iloc[x].Features]
+                x_names = np.r_[x_names, feat_names[x]]
         
         y, y_err = np.array(y), np.array(y_err)
         fig, ax = plt.subplots()
         if flip_axes:
             lns, = ax.plot(y, np.arange(len(x_names)), 'k*--', lw=0.77)
             lns_sigma = ax.fill_betweenx(np.arange(len(x_names)), y-y_err, y+y_err, color="grey", alpha=0.2)
             ax.set_xlabel('Z Score', alpha=1, color='k')
@@ -1108,9 +1236,7 @@
     for i in range(Nx):
         print((np.max(data_x[:,i]) - np.min(data_x[:,i])))
         new_array[:,i] = (data_x[:,i] - np.min(data_x[:,i])) / (np.max(data_x[:,i]) - np.min(data_x[:,i]))
 
     return new_array
     
 
-
-
```

### Comparing `MicroLIA-2.0.1/MicroLIA/extract_features.py` & `MicroLIA-2.0.5/MicroLIA/extract_features.py`

 * *Files 8% similar despite different names*

```diff
@@ -4,22 +4,22 @@
     
     @author: danielgodinez
 """
 import numpy as np
 from MicroLIA import features
 from inspect import getmembers, isfunction
 
-def extract_all(time, mag, magerr, feats_to_use=None, convert=True, zp=24, return_names=False):
+def extract_all(time, mag, magerr, apply_weights=True, feats_to_use=None, convert=True, zp=24, return_names=False):
     """
     This function will compute the statistics used to train the RF.
     Amplitude dependent features are computed first, after which the
     mag/flux is normalized by the maximum value to compute the remanining
     features. By default a conversion from mag to flux is performed. If input
     is in flux or you wish to work in mag, set convert to False.  
-        
+    
     Parameters
     ----------
     time : array
         Time of observations
     mag : array
         Magnitude array.
     magerr : array
@@ -27,15 +27,15 @@
     feats_to_use : array
         Array containing indices of features to use. This will be used to index the columns 
         in the data array. Defaults to None, in which case all columns in the data array are used.
     convert : boolean, optional 
         If False the features are computed with the input magnitudes,
         defaults to True to convert and compute in flux. 
     zp : float
-        Zeropoint of the instrument, defaults to 24.
+        Zeropoint of the instrument, only used if convert=True. Defaults to 24.
     return_names : bool
         If True the first output will be the stats array, and the second
         will be the list of corresponding feature names. Defaults to False,
         in which case only the stats array is returned.
 
     Returns
     -------
@@ -54,15 +54,19 @@
         else:
             raise ValueError('mag argument must be a list or array.')
     if isinstance(magerr, np.ndarray) is False:
         if type(magerr) == list:
             magerr = np.array(magerr)
         else:
             raise ValueError('magerr argument must be a list or array.')
-        
+
+    #Remove the nan and inf values, if present in the lightcurve
+    mask = np.where(np.isfinite(time) & np.isfinite(mag) & np.isfinite(magerr))[0]
+    time, mag, magerr = time[mask], mag[mask], magerr[mask]
+
     if convert is True:
         flux = 10**(-(mag-zp)/2.5)
         flux_err = (magerr*flux)/(2.5)*np.log(10)
     elif convert is False:
         flux = mag
         flux_err = magerr
 
@@ -78,29 +82,32 @@
     #normal space
     counter = 0
     for func in all_features_functions:
         if feats_to_use is not None:
             if counter not in feats_to_use:
                 counter += 1
                 continue
-        try:
-            if func[0] == 'amplitude' or func[0] == 'median_buffer_range':
-                feature = func[1](time, flux, flux_err)  #amplitude dependent features use non-normalized flux
-            else:
-                feature = func[1](time, norm_flux, norm_fluxerr)
-
-            feature_names.append(func[0])
-
-            if np.isfinite(feature):
-                stats.append(feature)
-            else:
-                stats.append(np.nan)
+        #try:
+        if func[0] == 'amplitude' or func[0] == 'median_buffer_range':
+            try:
+                feature = func[1](time, flux, flux_err, apply_weights=apply_weights)  #amplitude dependent features use non-normalized flux
+            except:# (ZeroDivisionError, ValueError, IndexError):
+                feature = np.nan
+        else:
+            try:
+                feature = func[1](time, norm_flux, norm_fluxerr, apply_weights=apply_weights)
+            except:# (ZeroDivisionError, ValueError, IndexError):
+                feature = np.nan
 
-        except (ZeroDivisionError, ValueError):
-            stats.append(np.nan)
+        feature_names.append(func[0])
+
+        if np.isfinite(feature):
+            stats.append(feature)
+        else:
+            stats.append(feature)
 
         counter += 1
             
     #derivative space
     flux_deriv = np.gradient(flux, time)
     flux_deriv_err = np.gradient(flux_err, time) 
     
@@ -108,30 +115,32 @@
     norm_flux_deriv_err = flux_deriv_err*(norm_flux_deriv/flux_deriv)
 
     for func in all_features_functions:
         if feats_to_use is not None:
             if counter not in feats_to_use:
                 counter += 1
                 continue
-        try:
-            if func[0] == 'amplitude' or func[0] == 'median_buffer_range':
-                feature = func[1](time, flux, flux_err)  #amplitude dependent features use non-normalized flux
-            else:
-                feature = func[1](time, norm_flux, norm_fluxerr)
-
-            feature_names.append(func[0]+'_deriv')
-
-            if np.isfinite(feature):
-                stats.append(feature)
-            else:
-                stats.append(np.nan)
+        if func[0] == 'amplitude' or func[0] == 'median_buffer_range':
+            try:
+                feature = func[1](time, flux, flux_err, apply_weights=apply_weights)  #amplitude dependent features use non-normalized flux
+            except:# (ZeroDivisionError, ValueError, IndexError):
+                feature = np.nan
+        else:
+            try:
+                feature = func[1](time, norm_flux, norm_fluxerr, apply_weights=apply_weights)
+            except:# (ZeroDivisionError, ValueError, IndexError):
+                feature = np.nan
 
-        except (ZeroDivisionError, ValueError):
-            stats.append(np.nan)
-            
+        feature_names.append(func[0]+'_deriv')
+
+        if np.isfinite(feature):
+            stats.append(feature)
+        else:
+            stats.append(feature)
+        
         counter += 1
 
     stats = np.array(stats)
     stats[np.isfinite(stats)==False] = np.nan
     stats[stats>1e7], stats[(stats<1e-7)&(stats>0)], stats[stats<-1e7] = 1e7, 1e-7, -1e7
 
     if return_names is False:
```

### Comparing `MicroLIA-2.0.1/MicroLIA/noise_models.py` & `MicroLIA-2.0.5/MicroLIA/noise_models.py`

 * *Files 3% similar despite different names*

```diff
@@ -49,14 +49,16 @@
     ----------
     mag : array
         Magnitude to add noise to. 
     fn : function
         Spline fit, must be defined using the create_noise function. 
     zp : Zeropoint
         Zeropoint of the instrument, default is 24.
+    exptime : Exposure time
+        The exposure time of the observations.
         
     Returns
     -------
     mag : array
         The noise-added magnitudes. 
     magerr : array
         The corresponding magnitude errors.
```

### Comparing `MicroLIA-2.0.1/MicroLIA/optimization.py` & `MicroLIA-2.0.5/MicroLIA/optimization.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,6159 +1,8126 @@
 00000000: 2321 2f75 7372 2f62 696e 2f65 6e76 2070  #!/usr/bin/env p
 00000010: 7974 686f 6e33 0a23 202d 2a2d 2063 6f64  ython3.# -*- cod
 00000020: 696e 673a 2075 7466 2d38 202d 2a2d 0a22  ing: utf-8 -*-."
 00000030: 2222 0a43 7265 6174 6564 206f 6e20 5361  "".Created on Sa
 00000040: 7420 4665 6220 2032 3520 3130 3a33 393a  t Feb  25 10:39:
 00000050: 3233 2032 3032 330a 0a40 6175 7468 6f72  23 2023..@author
-00000060: 3a20 6461 6e69 656c 0a22 2222 0a0a 696d  : daniel."""..im
-00000070: 706f 7274 206f 732c 2073 7973 0a69 6d70  port os, sys.imp
-00000080: 6f72 7420 636f 7079 2c20 6763 0a69 6d70  ort copy, gc.imp
-00000090: 6f72 7420 7465 6e73 6f72 666c 6f77 2061  ort tensorflow a
-000000a0: 7320 7466 0a6f 732e 656e 7669 726f 6e5b  s tf.os.environ[
-000000b0: 2750 5954 484f 4e48 4153 4853 4545 4427  'PYTHONHASHSEED'
-000000c0: 5d3d 2027 3027 2023 2c20 6f73 2e65 6e76  ]= '0' #, os.env
-000000d0: 6972 6f6e 5b22 5446 5f44 4554 4552 4d49  iron["TF_DETERMI
-000000e0: 4e49 5354 4943 5f4f 5053 225d 203d 310a  NISTIC_OPS"] =1.
-000000f0: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
-00000100: 6e70 0a69 6d70 6f72 7420 7261 6e64 6f6d  np.import random
-00000110: 2061 7320 7079 7468 6f6e 5f72 616e 646f   as python_rando
-00000120: 6d0a 2323 6874 7470 733a 2f2f 6b65 7261  m.##https://kera
-00000130: 732e 696f 2f67 6574 7469 6e67 5f73 7461  s.io/getting_sta
-00000140: 7274 6564 2f66 6171 2f23 686f 772d 6361  rted/faq/#how-ca
-00000150: 6e2d 692d 6f62 7461 696e 2d72 6570 726f  n-i-obtain-repro
-00000160: 6475 6369 626c 652d 7265 7375 6c74 732d  ducible-results-
-00000170: 7573 696e 672d 6b65 7261 732d 6475 7269  using-keras-duri
-00000180: 6e67 2d64 6576 656c 6f70 6d65 6e74 2323  ng-development##
-00000190: 0a6e 702e 7261 6e64 6f6d 2e73 6565 6428  .np.random.seed(
-000001a0: 3139 3039 292c 2070 7974 686f 6e5f 7261  1909), python_ra
-000001b0: 6e64 6f6d 2e73 6565 6428 3139 3039 292c  ndom.seed(1909),
-000001c0: 2074 662e 7261 6e64 6f6d 2e73 6574 5f73   tf.random.set_s
-000001d0: 6565 6428 3139 3039 290a 6672 6f6d 2070  eed(1909).from p
-000001e0: 616e 6461 7320 696d 706f 7274 2044 6174  andas import Dat
-000001f0: 6146 7261 6d65 0a66 726f 6d20 7761 726e  aFrame.from warn
-00000200: 696e 6773 2069 6d70 6f72 7420 6669 6c74  ings import filt
-00000210: 6572 7761 726e 696e 6773 0a66 696c 7465  erwarnings.filte
-00000220: 7277 6172 6e69 6e67 7328 2269 676e 6f72  rwarnings("ignor
-00000230: 6522 2c20 6361 7465 676f 7279 3d46 7574  e", category=Fut
-00000240: 7572 6557 6172 6e69 6e67 290a 6672 6f6d  ureWarning).from
-00000250: 2063 6f6c 6c65 6374 696f 6e73 2069 6d70   collections imp
-00000260: 6f72 7420 436f 756e 7465 7220 0a0a 696d  ort Counter ..im
-00000270: 706f 7274 2073 6b6c 6561 726e 2e6e 6569  port sklearn.nei
-00000280: 6768 626f 7273 2e5f 6261 7365 0a73 7973  ghbors._base.sys
-00000290: 2e6d 6f64 756c 6573 5b27 736b 6c65 6172  .modules['sklear
-000002a0: 6e2e 6e65 6967 6862 6f72 732e 6261 7365  n.neighbors.base
-000002b0: 275d 203d 2073 6b6c 6561 726e 2e6e 6569  '] = sklearn.nei
-000002c0: 6768 626f 7273 2e5f 6261 7365 0a66 726f  ghbors._base.fro
-000002d0: 6d20 736b 6c65 6172 6e2e 696d 7075 7465  m sklearn.impute
-000002e0: 2069 6d70 6f72 7420 4b4e 4e49 6d70 7574   import KNNImput
-000002f0: 6572 0a66 726f 6d20 736b 6c65 6172 6e2e  er.from sklearn.
-00000300: 656e 7365 6d62 6c65 2069 6d70 6f72 7420  ensemble import 
-00000310: 5261 6e64 6f6d 466f 7265 7374 436c 6173  RandomForestClas
-00000320: 7369 6669 6572 0a66 726f 6d20 736b 6c65  sifier.from skle
-00000330: 6172 6e2e 6e65 7572 616c 5f6e 6574 776f  arn.neural_netwo
-00000340: 726b 2069 6d70 6f72 7420 4d4c 5043 6c61  rk import MLPCla
-00000350: 7373 6966 6965 720a 6672 6f6d 2073 6b6c  ssifier.from skl
-00000360: 6561 726e 2e6d 6574 7269 6373 2069 6d70  earn.metrics imp
-00000370: 6f72 7420 6163 6375 7261 6379 5f73 636f  ort accuracy_sco
-00000380: 7265 0a66 726f 6d20 736b 6c65 6172 6e2e  re.from sklearn.
-00000390: 6d6f 6465 6c5f 7365 6c65 6374 696f 6e20  model_selection 
-000003a0: 696d 706f 7274 2074 7261 696e 5f74 6573  import train_tes
-000003b0: 745f 7370 6c69 742c 2063 726f 7373 5f76  t_split, cross_v
-000003c0: 616c 6964 6174 652c 2063 726f 7373 5f76  alidate, cross_v
-000003d0: 616c 5f73 636f 7265 0a0a 6672 6f6d 2073  al_score..from s
-000003e0: 6b6f 7074 2069 6d70 6f72 7420 4261 7965  kopt import Baye
-000003f0: 7353 6561 7263 6843 562c 2070 6c6f 7473  sSearchCV, plots
-00000400: 2c20 6770 5f6d 696e 696d 697a 650a 6672  , gp_minimize.fr
-00000410: 6f6d 2073 6b6f 7074 2e70 6c6f 7473 2069  om skopt.plots i
-00000420: 6d70 6f72 7420 706c 6f74 5f63 6f6e 7665  mport plot_conve
-00000430: 7267 656e 6365 2c20 706c 6f74 5f6f 626a  rgence, plot_obj
-00000440: 6563 7469 7665 0a66 726f 6d20 736b 6f70  ective.from skop
-00000450: 742e 7370 6163 6520 696d 706f 7274 2052  t.space import R
-00000460: 6561 6c2c 2049 6e74 6567 6572 2c20 4361  eal, Integer, Ca
-00000470: 7465 676f 7269 6361 6c20 0a66 726f 6d20  tegorical .from 
-00000480: 7465 6e73 6f72 666c 6f77 2e6b 6572 6173  tensorflow.keras
-00000490: 2e62 6163 6b65 6e64 2069 6d70 6f72 7420  .backend import 
-000004a0: 636c 6561 725f 7365 7373 696f 6e20 0a66  clear_session .f
-000004b0: 726f 6d20 7465 6e73 6f72 666c 6f77 2e6b  rom tensorflow.k
-000004c0: 6572 6173 2e63 616c 6c62 6163 6b73 2069  eras.callbacks i
-000004d0: 6d70 6f72 7420 4561 726c 7953 746f 7070  mport EarlyStopp
-000004e0: 696e 672c 2043 616c 6c62 6163 6b0a 0a69  ing, Callback..i
-000004f0: 6d70 6f72 7420 6f70 7475 6e61 0a66 726f  mport optuna.fro
-00000500: 6d20 626f 7275 7461 2069 6d70 6f72 7420  m boruta import 
-00000510: 426f 7275 7461 5079 0a66 726f 6d20 426f  BorutaPy.from Bo
-00000520: 7275 7461 5368 6170 2069 6d70 6f72 7420  rutaShap import 
-00000530: 426f 7275 7461 5368 6170 0a66 726f 6d20  BorutaShap.from 
-00000540: 7867 626f 6f73 7420 696d 706f 7274 2058  xgboost import X
-00000550: 4742 436c 6173 7369 6669 6572 2c20 444d  GBClassifier, DM
-00000560: 6174 7269 782c 2074 7261 696e 0a66 726f  atrix, train.fro
-00000570: 6d20 6f70 7475 6e61 2e69 6e74 6567 7261  m optuna.integra
-00000580: 7469 6f6e 2069 6d70 6f72 7420 5446 4b65  tion import TFKe
-00000590: 7261 7350 7275 6e69 6e67 4361 6c6c 6261  rasPruningCallba
-000005a0: 636b 0a6f 7074 756e 612e 6c6f 6767 696e  ck.optuna.loggin
-000005b0: 672e 7365 745f 7665 7262 6f73 6974 7928  g.set_verbosity(
-000005c0: 6f70 7475 6e61 2e6c 6f67 6769 6e67 2e57  optuna.logging.W
-000005d0: 4152 4e49 4e47 290a 6672 6f6d 204d 6963  ARNING).from Mic
-000005e0: 726f 4c49 412e 6461 7461 5f61 7567 6d65  roLIA.data_augme
-000005f0: 6e74 6174 696f 6e20 696d 706f 7274 2061  ntation import a
-00000600: 7567 6d65 6e74 6174 696f 6e2c 2072 6573  ugmentation, res
-00000610: 697a 650a 6672 6f6d 204d 6963 726f 4c49  ize.from MicroLI
-00000620: 4120 696d 706f 7274 2064 6174 615f 7072  A import data_pr
-00000630: 6f63 6573 7369 6e67 2c20 636e 6e5f 6d6f  ocessing, cnn_mo
-00000640: 6465 6c0a 0a0a 636c 6173 7320 6f62 6a65  del...class obje
-00000650: 6374 6976 655f 636e 6e28 6f62 6a65 6374  ctive_cnn(object
-00000660: 293a 0a20 2020 2022 2222 0a20 2020 204f  ):.    """.    O
-00000670: 7074 696d 697a 6174 696f 6e20 6f62 6a65  ptimization obje
-00000680: 6374 6976 6520 6675 6e63 7469 6f6e 2066  ctive function f
-00000690: 6f72 204d 6963 726f 4c49 4127 7320 636f  or MicroLIA's co
-000006a0: 6e76 6f6c 7574 696f 6e61 6c20 6e65 7572  nvolutional neur
-000006b0: 616c 206e 6574 776f 726b 2e20 0a20 2020  al network. .   
-000006c0: 2054 6869 7320 6973 2070 6173 7365 6420   This is passed 
-000006d0: 7468 726f 7567 6820 7468 6520 6879 7065  through the hype
-000006e0: 725f 6f70 7428 2920 6675 6e63 7469 6f6e  r_opt() function
-000006f0: 2077 6865 6e20 6f70 7469 6d69 7a69 6e67   when optimizing
-00000700: 2077 6974 680a 2020 2020 4f70 7475 6e61   with.    Optuna
-00000710: 2e20 5468 6520 4f70 7475 6e61 2073 6f66  . The Optuna sof
-00000720: 7477 6172 6520 666f 7220 6879 7065 7270  tware for hyperp
-00000730: 6172 616d 6574 6572 206f 7074 696d 697a  arameter optimiz
-00000740: 6174 696f 6e20 7761 7320 7075 626c 6973  ation was publis
-00000750: 6865 6420 696e 200a 2020 2020 3230 3139  hed in .    2019
-00000760: 2062 7920 416b 6962 6120 6574 2061 6c2e   by Akiba et al.
-00000770: 2050 6170 6572 3a20 6874 7470 733a 2f2f   Paper: https://
-00000780: 6172 7869 762e 6f72 672f 6162 732f 3139  arxiv.org/abs/19
-00000790: 3037 2e31 3039 3032 0a0a 2020 2020 556e  07.10902..    Un
-000007a0: 6c69 6b65 2074 6865 206f 626a 6563 7469  like the objecti
-000007b0: 7665 2066 756e 6374 696f 6e73 2066 6f72  ve functions for
-000007c0: 2074 6865 2065 6e73 656d 626c 6520 616c   the ensemble al
-000007d0: 676f 7269 7468 6d73 2c20 7468 6973 2074  gorithms, this t
-000007e0: 616b 6573 2061 7320 696e 7075 740a 2020  akes as input.  
-000007f0: 2020 7468 6520 7477 6f20 636c 6173 7365    the two classe
-00000800: 7320 6469 7265 6374 6c79 2c20 706f 7369  s directly, posi
-00000810: 7469 7665 5f63 6c61 7373 2026 206e 6567  tive_class & neg
-00000820: 6174 6976 655f 636c 6173 732c 2069 6e73  ative_class, ins
-00000830: 7465 6164 206f 6620 7468 6520 7472 6164  tead of the trad
-00000840: 6974 696f 6e61 6c20 0a20 2020 2064 6174  itional .    dat
-00000850: 6120 2864 6174 615f 7829 2061 6e64 2061  a (data_x) and a
-00000860: 6363 6f6d 7061 6e79 696e 6720 6c61 6265  ccompanying labe
-00000870: 6c20 6172 7261 7920 2864 6174 615f 7929  l array (data_y)
-00000880: 2e20 5468 6973 2069 7320 6265 6361 7573  . This is becaus
-00000890: 6520 7468 6520 636e 6e5f 6d6f 6465 6c2e  e the cnn_model.
-000008a0: 416c 6578 4e65 7428 2920 0a20 2020 2066  AlexNet() .    f
-000008b0: 756e 6374 696f 6e20 7461 6b65 7320 6173  unction takes as
-000008c0: 2069 6e70 7574 2074 6865 2074 776f 2063   input the two c
-000008d0: 6c61 7373 6573 2073 6570 6172 6174 656c  lasses separatel
-000008e0: 792c 2061 6674 6572 2077 6869 6368 2069  y, after which i
-000008f0: 7420 6175 746f 6d61 7469 6361 6c6c 7920  t automatically 
-00000900: 6173 7369 676e 7320 7468 6520 3120 0a20  assigns the 1 . 
-00000910: 2020 2061 6e64 2030 206c 6162 656c 732c     and 0 labels,
-00000920: 2072 6573 7065 6374 6976 656c 792e 0a0a   respectively...
-00000930: 2020 2020 4279 2064 6566 6175 6c74 2c20      By default, 
-00000940: 6f70 745f 6d6f 6465 6c3d 5472 7565 2061  opt_model=True a
-00000950: 6e64 206f 7074 5f61 7567 3d46 616c 7365  nd opt_aug=False
-00000960: 2e20 4966 206f 7074 5f61 7567 3d54 7275  . If opt_aug=Tru
-00000970: 652c 2074 6865 2069 6d61 6765 2073 697a  e, the image siz
-00000980: 6520 616e 640a 2020 2020 6e75 6d62 6572  e and.    number
-00000990: 206f 6620 6175 676d 656e 7461 7469 6f6e   of augmentation
-000009a0: 7320 746f 2070 6572 666f 726d 206f 6e20  s to perform on 
-000009b0: 6561 6368 2069 6d61 6765 2077 696c 6c20  each image will 
-000009c0: 6265 2069 6e63 6c75 6465 6420 6173 206f  be included as o
-000009d0: 7074 696d 697a 6162 6c65 2076 6172 6961  ptimizable varia
-000009e0: 626c 6573 2e0a 2020 2020 4966 2074 6865  bles..    If the
-000009f0: 206f 7074 5f6d 6178 5f6d 696e 5f70 6978   opt_max_min_pix
-00000a00: 2061 6e64 206f 7074 5f6d 6178 5f6d 6178   and opt_max_max
-00000a10: 5f70 6978 2061 7265 2073 6574 2c20 7468  _pix are set, th
-00000a20: 6520 6f70 7469 6d61 6c20 6d61 7869 6d75  e optimal maximu
-00000a30: 6d20 7069 7865 6c20 7661 6c75 6520 746f  m pixel value to
-00000a40: 2075 7365 0a20 2020 2077 6865 6e20 6d69   use.    when mi
-00000a50: 6e2d 6d61 7820 6e6f 726d 616c 697a 696e  n-max normalizin
-00000a60: 6720 6561 6368 2062 616e 6420 7769 6c6c  g each band will
-00000a70: 2061 6c73 6f20 6265 206f 7074 696d 697a   also be optimiz
-00000a80: 6162 6c65 2076 6172 6961 626c 6573 2074  able variables t
-00000a90: 6861 7420 7769 6c6c 2062 6520 7475 6e65  hat will be tune
-00000aa0: 6420 616e 6420 7265 7475 726e 6564 2e0a  d and returned..
-00000ab0: 2020 2020 4966 206f 7074 5f6d 6f64 656c      If opt_model
-00000ac0: 3d54 7275 652c 2061 6464 6974 696f 6e61  =True, additiona
-00000ad0: 6c20 6172 6368 6974 6563 7475 7265 2070  l architecture p
-00000ae0: 6172 616d 6574 6572 7320 7769 6c6c 2061  arameters will a
-00000af0: 6c73 6f20 6265 2074 756e 6564 2e20 496e  lso be tuned. In
-00000b00: 2062 6f74 6820 696e 7374 616e 6365 7320   both instances 
-00000b10: 7468 6520 7472 6169 6e69 6e67 2070 6172  the training par
-00000b20: 616d 6574 6572 7320 0a20 2020 2077 696c  ameters .    wil
-00000b30: 6c20 6265 206f 7074 696d 697a 6564 2c20  l be optimized, 
-00000b40: 7768 6963 6820 696e 636c 7564 6520 7468  which include th
-00000b50: 6520 6f70 7469 6d69 7a65 722c 206c 6561  e optimizer, lea
-00000b60: 726e 696e 6720 7261 7465 2c20 6465 6361  rning rate, deca
-00000b70: 792c 2061 6e64 206d 6f6d 656e 7475 6d2c  y, and momentum,
-00000b80: 2069 6620 6170 706c 6963 6162 6c65 2e0a   if applicable..
-00000b90: 0a20 2020 204e 6f74 653a 0a20 2020 2020  .    Note:.     
-00000ba0: 2020 2049 6620 6f70 745f 6175 6720 6973     If opt_aug is
-00000bb0: 2065 6e61 626c 6564 2c20 7468 656e 2074   enabled, then t
-00000bc0: 6865 2070 6f73 6974 6976 655f 636c 6173  he positive_clas
-00000bd0: 7320 7361 6d70 6c65 2077 696c 6c20 6265  s sample will be
-00000be0: 2074 6865 2064 6174 6120 7468 6174 2077   the data that w
-00000bf0: 696c 6c20 6175 676d 656e 7465 642e 0a20  ill augmented.. 
-00000c00: 2020 2020 2020 2049 7420 6973 2062 6573         It is bes
-00000c10: 7420 746f 206b 6565 7020 626f 7468 2063  t to keep both c
-00000c20: 6c61 7373 2073 697a 6573 2074 6865 2073  lass sizes the s
-00000c30: 616d 6520 6166 7465 7220 6175 676d 656e  ame after augmen
-00000c40: 7461 7469 6f6e 2c20 7468 6572 6566 6f72  tation, therefor
-00000c50: 6520 6261 6c61 6e63 653d 5472 7565 0a20  e balance=True. 
-00000c60: 2020 2020 2020 2062 7920 6465 6661 756c         by defaul
-00000c70: 742c 2077 6869 6368 2077 696c 6c20 7472  t, which will tr
-00000c80: 756e 6361 7465 2074 6865 206e 6567 6174  uncate the negat
-00000c90: 6976 655f 636c 6173 7320 7361 6d70 6c65  ive_class sample
-00000ca0: 2074 6f20 6d61 7463 6820 7468 6520 6175   to match the au
-00000cb0: 676d 656e 7465 6420 706f 7369 7469 7665  gmented positive
-00000cc0: 5f63 6c61 7373 2073 697a 652e 0a20 2020  _class size..   
-00000cd0: 2020 2020 2054 6865 206f 7468 6572 2063       The other c
-00000ce0: 6c61 7373 2077 696c 6c20 616c 736f 2075  lass will also u
-00000cf0: 6e64 6572 676f 2074 6865 2073 616d 6520  ndergo the same 
-00000d00: 6461 7461 2061 7567 6d65 6e74 6174 696f  data augmentatio
-00000d10: 6e20 7465 6368 6e69 7175 6520 6275 7420  n technique but 
-00000d20: 6f6e 6c79 206f 6e65 2069 6d61 6765 2077  only one image w
-00000d30: 696c 6c20 6265 2072 6574 7572 6e65 640a  ill be returned.
-00000d40: 2020 2020 2020 2020 7065 7220 7361 6d70          per samp
-00000d50: 6c65 2c20 7468 6973 2069 7320 746f 2065  le, this is to e
-00000d60: 6e73 7572 6520 626f 7468 2063 6c61 7373  nsure both class
-00000d70: 6573 2063 6f6e 7461 696e 2074 6865 2073  es contain the s
-00000d80: 616d 6520 6c65 7665 6c20 6f66 2076 6172  ame level of var
-00000d90: 6961 7469 6f6e 2c20 6573 7065 6369 616c  iation, especial
-00000da0: 6c79 2069 6d70 6f72 7461 6e74 0a20 2020  ly important.   
-00000db0: 2020 2020 2077 6865 6e20 6170 706c 7969       when applyi
-00000dc0: 6e67 2074 6865 206d 6173 6b2d 6375 746f  ng the mask-cuto
-00000dd0: 7574 2074 6563 686e 6971 7565 2074 6f20  ut technique to 
-00000de0: 7468 6520 6175 676d 656e 7461 7469 6f6e  the augmentation
-00000df0: 2070 726f 6365 6475 7265 2e0a 0a20 2020   procedure...   
-00000e00: 2020 2020 2053 696e 6365 2074 6865 206d       Since the m
-00000e10: 6178 696d 756d 206e 756d 6265 7220 6f66  aximum number of
-00000e20: 2061 7567 6d65 6e74 6174 696f 6e73 2061   augmentations a
-00000e30: 6c6c 6f77 6564 2069 7320 6261 7463 685f  llowed is batch_
-00000e40: 6d61 7820 7065 7220 6561 6368 2073 616d  max per each sam
-00000e50: 706c 652c 2069 6e20 7072 6163 7469 6365  ple, in practice
-00000e60: 206e 6567 6174 6976 655f 636c 6173 7320   negative_class 
-00000e70: 0a20 2020 2020 2020 2073 686f 756c 6420  .        should 
-00000e80: 636f 6e74 6169 6e20 6261 7463 685f 6d61  contain batch_ma
-00000e90: 7820 7469 6d65 7320 7468 6520 7369 7a65  x times the size
-00000ea0: 206f 6620 706f 7369 7469 7665 5f63 6c61   of positive_cla
-00000eb0: 7373 2e20 4475 7269 6e67 2074 6865 206f  ss. During the o
-00000ec0: 7074 696d 697a 6174 696f 6e20 7072 6f63  ptimization proc
-00000ed0: 6564 7572 652c 2069 6620 616e 200a 2020  edure, if an .  
-00000ee0: 2020 2020 2020 6175 676d 656e 7461 7469        augmentati
-00000ef0: 6f6e 2062 6174 6368 2073 697a 6520 6f66  on batch size of
-00000f00: 2031 3030 2069 7320 6173 7365 7365 6420   100 is assesed 
-00000f10: 616e 6420 706f 7369 7469 7665 2063 6c61  and positive cla
-00000f20: 7373 2063 6f6e 7461 696e 7320 6e20 7361  ss contains n sa
-00000f30: 6d70 6c65 732c 2074 6865 6e20 3130 302a  mples, then 100*
-00000f40: 6e20 6175 676d 656e 7465 6420 696d 6167  n augmented imag
-00000f50: 6573 2077 696c 6c20 6265 2063 7265 6174  es will be creat
-00000f60: 6564 2c20 0a20 2020 2020 2020 2061 6e64  ed, .        and
-00000f70: 2074 6865 7265 666f 7265 2064 7572 696e   therefore durin
-00000f80: 6720 7468 6174 2070 6172 7469 6375 6c61  g that particula
-00000f90: 7220 7472 6961 6c20 7468 6520 6669 7273  r trial the firs
-00000fa0: 7420 3130 302a 6e20 7361 6d70 6c65 7320  t 100*n samples 
-00000fb0: 6672 6f6d 206e 6567 6174 6976 655f 636c  from negative_cl
-00000fc0: 6173 7320 7769 6c6c 2062 6520 7573 6564  ass will be used
-00000fd0: 2c20 6966 2061 7661 696c 6162 6c65 2e20  , if available. 
-00000fe0: 0a20 2020 2020 2020 2054 6f20 7573 6520  .        To use 
-00000ff0: 7468 6520 656e 7469 7265 206e 6567 6174  the entire negat
-00001000: 6976 655f 636c 6173 7320 7361 6d70 6c65  ive_class sample
-00001010: 2072 6567 6172 646c 6573 7320 6f66 2074   regardless of t
-00001020: 6865 206e 756d 6265 7220 6175 676d 656e  he number augmen
-00001030: 7461 7469 6f6e 7320 7065 7266 6f72 6d65  tations performe
-00001040: 642c 2073 6574 2062 616c 616e 6365 3d46  d, set balance=F
-00001050: 616c 7365 2e0a 2020 2020 0a20 2020 2020  alse..    .     
-00001060: 2020 2054 6865 206d 696e 5f70 6978 656c     The min_pixel
-00001070: 2061 6e64 206d 6178 5f70 6978 656c 2076   and max_pixel v
-00001080: 616c 7565 2077 696c 6c20 6265 2075 7365  alue will be use
-00001090: 6420 746f 206d 696e 2d6d 6178 206e 6f72  d to min-max nor
-000010a0: 6d61 6c69 7a65 2074 6865 2069 6d61 6765  malize the image
-000010b0: 732c 2069 6620 6e6f 726d 616c 697a 653d  s, if normalize=
-000010c0: 5472 7565 2e20 5468 6520 6f70 745f 6d61  True. The opt_ma
-000010d0: 785f 6d69 6e5f 7069 780a 2020 2020 2020  x_min_pix.      
-000010e0: 2020 616e 6420 6f70 745f 6d61 785f 6d61    and opt_max_ma
-000010f0: 785f 7069 782c 2077 6865 6e20 7365 742c  x_pix, when set,
-00001100: 2077 696c 6c20 6265 2075 7365 6420 696e   will be used in
-00001110: 7374 6561 6420 6475 7269 6e67 2074 6865  stead during the
-00001120: 206f 7074 696d 697a 6174 696f 6e20 7072   optimization pr
-00001130: 6f63 6564 7572 652c 2073 6f20 6173 2074  ocedure, so as t
-00001140: 6f20 6465 7465 726d 696e 650a 2020 2020  o determine.    
-00001150: 2020 2020 7768 6174 206f 7074 696d 616c      what optimal
-00001160: 206d 6178 696d 756d 2076 616c 7565 2074   maximum value t
-00001170: 6f20 7573 6520 7768 656e 206e 6f72 6d61  o use when norma
-00001180: 6c69 7a69 6e67 2074 6865 2069 6d61 6765  lizing the image
-00001190: 732e 2054 6869 7320 6973 2069 6d70 6f72  s. This is impor
-000011a0: 7461 6e74 2077 6865 6e20 6465 616c 696e  tant when dealin
-000011b0: 6720 7769 7468 2064 6565 702d 7375 7276  g with deep-surv
-000011c0: 6579 2064 6174 612e 200a 2020 2020 2020  ey data. .      
-000011d0: 2020 4966 206f 7074 696d 697a 696e 6720    If optimizing 
-000011e0: 7468 6520 6e6f 726d 616c 697a 6174 696f  the normalizatio
-000011f0: 6e20 7363 6865 6d65 2c20 7468 6520 6465  n scheme, the de
-00001200: 6661 756c 7420 6d69 6e5f 7069 7865 6c20  fault min_pixel 
-00001210: 7769 6c6c 2062 6520 7365 7420 746f 207a  will be set to z
-00001220: 6572 6f2c 2061 7320 7375 6368 206f 6e6c  ero, as such onl
-00001230: 7920 7468 6520 6f70 7469 6d61 6c20 6d61  y the optimal ma
-00001240: 785f 7069 7865 6c20 0a20 2020 2020 2020  x_pixel .       
-00001250: 2066 6f72 2065 7665 7279 2062 616e 6420   for every band 
-00001260: 7769 6c6c 2062 6520 6f75 7470 7574 2e0a  will be output..
-00001270: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
-00001280: 2020 2070 6f73 6974 6976 655f 636c 6173     positive_clas
-00001290: 7320 286e 6461 7272 6179 293a 2054 6865  s (ndarray): The
-000012a0: 2073 616d 706c 6573 2066 6f72 2074 6865   samples for the
-000012b0: 2066 6972 7374 2063 6c61 7373 2073 686f   first class sho
-000012c0: 756c 6420 6265 2070 6173 7365 642c 2077  uld be passed, w
-000012d0: 6869 6368 2077 696c 6c20 6175 746f 6d61  hich will automa
-000012e0: 7469 6361 6c6c 7920 0a20 2020 2020 2020  tically .       
-000012f0: 2020 2020 2062 6520 6173 7369 676e 6564       be assigned
-00001300: 2074 6865 2070 6f73 6974 6976 6520 6c61   the positive la
-00001310: 6265 6c20 2731 272e 0a20 2020 2020 2020  bel '1'..       
-00001320: 206e 6567 6174 6976 655f 636c 6173 7320   negative_class 
-00001330: 286e 6461 7272 6179 2c20 7374 7229 3a20  (ndarray, str): 
-00001340: 5468 6520 7361 6d70 6c65 7320 666f 7220  The samples for 
-00001350: 7468 6520 7365 636f 6e64 2063 6c61 7373  the second class
-00001360: 2073 686f 756c 6420 6265 2070 6173 7365   should be passe
-00001370: 642c 2077 6869 6368 2077 696c 6c20 6175  d, which will au
-00001380: 746f 6d61 7469 6361 6c6c 7920 0a20 2020  tomatically .   
-00001390: 2020 2020 2020 2020 2062 6520 6173 7369           be assi
-000013a0: 676e 6564 2074 6865 206e 6567 6174 6976  gned the negativ
-000013b0: 6520 6c61 6265 6c20 2730 272e 0a20 2020  e label '0'..   
-000013c0: 2020 2020 2069 6d67 5f6e 756d 5f63 6861       img_num_cha
-000013d0: 6e6e 656c 7320 2869 6e74 293a 2054 6865  nnels (int): The
-000013e0: 206e 756d 6265 7220 6f66 2066 696c 7465   number of filte
-000013f0: 7273 2e20 4465 6661 756c 7473 2074 6f20  rs. Defaults to 
-00001400: 312e 0a20 2020 2020 2020 206e 6f72 6d61  1..        norma
-00001410: 6c69 7a65 2028 626f 6f6c 2c20 6f70 7469  lize (bool, opti
-00001420: 6f6e 616c 293a 2049 6620 5472 7565 2074  onal): If True t
-00001430: 6865 2064 6174 6120 7769 6c6c 2062 6520  he data will be 
-00001440: 6d69 6e2d 6d61 7820 6e6f 726d 616c 697a  min-max normaliz
-00001450: 6564 2075 7369 6e67 2074 6865 200a 2020  ed using the .  
-00001460: 2020 2020 2020 2020 2020 696e 7075 7420            input 
-00001470: 6d69 6e20 616e 6420 6d61 7820 7069 7865  min and max pixe
-00001480: 6c73 2e20 4465 6661 756c 7473 2074 6f20  ls. Defaults to 
-00001490: 5472 7565 2e0a 2020 2020 2020 2020 6d69  True..        mi
-000014a0: 6e5f 7069 7865 6c20 2869 6e74 2c20 6f70  n_pixel (int, op
-000014b0: 7469 6f6e 616c 293a 2054 6865 206d 696e  tional): The min
-000014c0: 696d 756d 2070 6978 656c 2063 6f75 6e74  imum pixel count
-000014d0: 2c20 7069 7865 6c73 2077 6974 6820 636f  , pixels with co
-000014e0: 756e 7473 200a 2020 2020 2020 2020 2020  unts .          
-000014f0: 2020 6265 6c6f 7720 7468 6973 2074 6872    below this thr
-00001500: 6573 686f 6c64 2077 696c 6c20 6265 2073  eshold will be s
-00001510: 6574 2074 6f20 7468 6973 206c 696d 6974  et to this limit
-00001520: 2e20 4465 6661 756c 7473 2074 6f20 302e  . Defaults to 0.
-00001530: 0a20 2020 2020 2020 206d 6178 5f70 6978  .        max_pix
-00001540: 656c 2028 696e 742c 206c 6973 742c 206f  el (int, list, o
-00001550: 7074 696f 6e61 6c29 3a20 5468 6520 6d61  ptional): The ma
-00001560: 7869 6d75 6d20 7069 7865 6c20 636f 756e  ximum pixel coun
-00001570: 742c 2070 6978 656c 7320 7769 7468 2063  t, pixels with c
-00001580: 6f75 6e74 7320 0a20 2020 2020 2020 2020  ounts .         
-00001590: 2020 2061 626f 7665 2074 6869 7320 7468     above this th
-000015a0: 7265 7368 6f6c 6420 7769 6c6c 2062 6520  reshold will be 
-000015b0: 7365 7420 746f 2074 6869 7320 6c69 6d69  set to this limi
-000015c0: 742e 2044 6566 6175 6c74 7320 746f 2031  t. Defaults to 1
-000015d0: 3030 2e20 4966 2069 6d67 5f6e 756d 5f63  00. If img_num_c
-000015e0: 6861 6e6e 656c 730a 2020 2020 2020 2020  hannels.        
-000015f0: 2020 2020 6973 206e 6f74 2031 2c20 7468      is not 1, th
-00001600: 6520 6d61 785f 7069 7865 6c20 7368 6f75  e max_pixel shou
-00001610: 6c64 2062 6520 6120 6c69 7374 2063 6f6e  ld be a list con
-00001620: 7461 696e 696e 6720 7477 6f20 7661 6c75  taining two valu
-00001630: 6573 2c20 6f6e 6520 666f 7220 6561 6368  es, one for each
-00001640: 2062 616e 642e 0a20 2020 2020 2020 2076   band..        v
-00001650: 616c 5f70 6f73 6974 6976 6520 286e 6461  al_positive (nda
-00001660: 7272 6179 2c20 6f70 7469 6f6e 616c 293a  rray, optional):
-00001670: 2050 6f73 6974 6976 6520 636c 6173 7320   Positive class 
-00001680: 6461 7461 2074 6f20 6265 2075 7365 6420  data to be used 
-00001690: 666f 7220 7661 6c69 6461 7469 6f6e 2e20  for validation. 
-000016a0: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
-000016b0: 2e0a 2020 2020 2020 2020 7661 6c5f 6e65  ..        val_ne
-000016c0: 6761 7469 7665 2028 6e64 6172 7261 792c  gative (ndarray,
-000016d0: 206f 7074 696f 6e61 6c29 3a20 4e65 6761   optional): Nega
-000016e0: 7469 7665 2063 6c61 7373 2064 6174 6120  tive class data 
-000016f0: 746f 2062 6520 7573 6564 2066 6f72 2076  to be used for v
-00001700: 616c 6964 6174 696f 6e2e 2044 6566 6175  alidation. Defau
-00001710: 6c74 7320 746f 204e 6f6e 652e 0a20 2020  lts to None..   
-00001720: 2020 2020 2074 6573 745f 706f 7369 7469       test_positi
-00001730: 7665 2028 6e64 6172 7261 792c 206f 7074  ve (ndarray, opt
-00001740: 696f 6e61 6c29 3a20 506f 7369 7469 7665  ional): Positive
-00001750: 2063 6c61 7373 2064 6174 6120 746f 2062   class data to b
-00001760: 6520 7573 6564 2066 6f72 2070 6f73 742d  e used for post-
-00001770: 7472 6961 6c20 7465 7374 696e 672e 2044  trial testing. D
-00001780: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
-00001790: 0a20 2020 2020 2020 2074 6573 745f 6e65  .        test_ne
-000017a0: 6761 7469 7665 2028 6e64 6172 7261 792c  gative (ndarray,
-000017b0: 206f 7074 696f 6e61 6c29 3a20 4e65 6761   optional): Nega
-000017c0: 7469 7665 2063 6c61 7373 2064 6174 6120  tive class data 
-000017d0: 746f 2062 6520 7573 6564 2066 6f72 2070  to be used for p
-000017e0: 6f73 742d 7472 6961 6c20 7465 7374 696e  ost-trial testin
-000017f0: 672e 2044 6566 6175 6c74 7320 746f 204e  g. Defaults to N
-00001800: 6f6e 652e 0a20 2020 2020 2020 2074 7261  one..        tra
-00001810: 696e 5f65 706f 6368 7320 2869 6e74 293a  in_epochs (int):
-00001820: 204e 756d 6265 7220 6f66 2065 706f 6368   Number of epoch
-00001830: 7320 746f 2074 6865 2074 7261 696e 2074  s to the train t
-00001840: 6865 2043 4e4e 2074 6f20 6475 7269 6e67  he CNN to during
-00001850: 2074 6865 206f 7074 696d 697a 6174 696f   the optimizatio
-00001860: 6e20 7472 6961 6c73 2e20 4465 6661 756c  n trials. Defaul
-00001870: 7473 2074 6f20 3235 2e0a 2020 2020 2020  ts to 25..      
-00001880: 2020 6d65 7472 6963 2028 7374 7229 3a20    metric (str): 
-00001890: 4173 7365 736d 656e 7420 6d65 7472 6963  Assesment metric
-000018a0: 2074 6f20 7573 6520 7768 656e 2062 6f74   to use when bot
-000018b0: 6820 7072 756e 696e 6720 616e 6420 7363  h pruning and sc
-000018c0: 6f72 696e 6720 7468 6520 6879 7065 7270  oring the hyperp
-000018d0: 6172 616d 6574 6572 206f 7074 696d 697a  arameter optimiz
-000018e0: 6174 696f 6e20 7472 6961 6c2e 0a20 2020  ation trial..   
-000018f0: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-00001900: 7320 746f 2027 6c6f 7373 272e 204f 7074  s to 'loss'. Opt
-00001910: 696f 6e73 2069 6e63 6c75 6465 3a20 276c  ions include: 'l
-00001920: 6f73 7327 2027 6269 6e61 7279 5f61 6363  oss' 'binary_acc
-00001930: 7572 6163 7927 2c20 2766 315f 7363 6f72  uracy', 'f1_scor
-00001940: 6527 2027 616c 6c27 206f 7220 7468 6520  e' 'all' or the 
-00001950: 7661 6c69 6461 7469 6f6e 2065 7175 6976  validation equiv
-00001960: 616c 656e 7473 2028 652e 672e 2027 7661  alents (e.g. 'va
-00001970: 6c5f 6c6f 7373 2729 2e0a 2020 2020 2020  l_loss')..      
-00001980: 2020 7061 7469 656e 6365 2028 696e 7429    patience (int)
-00001990: 3a20 4e75 6d62 6572 206f 6620 6570 6f63  : Number of epoc
-000019a0: 6873 2077 6974 686f 7574 2069 6d70 726f  hs without impro
-000019b0: 7665 6d65 6e74 2062 6566 6f72 6520 7468  vement before th
-000019c0: 6520 6f70 7469 6d69 7a61 7469 6f6e 2074  e optimization t
-000019d0: 7269 616c 2069 7320 7465 726d 696e 6174  rial is terminat
-000019e0: 6564 2e20 4465 6661 756c 7473 2074 6f20  ed. Defaults to 
-000019f0: 302c 2077 6869 6368 0a20 2020 2020 2020  0, which.       
-00001a00: 2020 2020 2064 6973 6162 6c65 7320 7468       disables th
-00001a10: 6973 2066 6561 7475 7265 2e0a 2020 2020  is feature..    
-00001a20: 2020 2020 6176 6572 6167 6520 2862 6f6f      average (boo
-00001a30: 6c29 3a20 4966 2046 616c 7365 2c20 7468  l): If False, th
-00001a40: 6520 6465 7369 676e 6174 6564 206d 6574  e designated met
-00001a50: 7269 6320 7769 6c6c 2062 6520 6361 6c63  ric will be calc
-00001a60: 756c 6174 6564 2061 6363 6f72 6469 6e67  ulated according
-00001a70: 2074 6f20 6974 7320 7661 6c75 6520 6174   to its value at
-00001a80: 2074 6865 2065 6e64 206f 6620 7468 6520   the end of the 
-00001a90: 7472 6169 6e5f 6570 6f63 6873 2e20 0a20  train_epochs. . 
-00001aa0: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
-00001ab0: 7565 2c20 7468 6520 6d65 7472 6963 2077  ue, the metric w
-00001ac0: 696c 6c20 6265 2061 7665 7261 6765 6420  ill be averaged 
-00001ad0: 6f75 7420 6163 726f 7373 2061 6c6c 2074  out across all t
-00001ae0: 7261 696e 5f65 706f 6368 732e 2044 6566  rain_epochs. Def
-00001af0: 6175 6c74 7320 746f 2054 7275 652e 0a20  aults to True.. 
-00001b00: 2020 2020 2020 206f 7074 5f6d 6f64 656c         opt_model
-00001b10: 2028 626f 6f6c 293a 2049 6620 5472 7565   (bool): If True
-00001b20: 2c20 7468 6520 6172 6368 6974 6563 7475  , the architectu
-00001b30: 7265 2070 6172 616d 6574 6572 7320 7769  re parameters wi
-00001b40: 6c6c 2062 6520 6f70 7469 6d69 7a65 642e  ll be optimized.
-00001b50: 2044 6566 6175 6c74 7320 746f 2054 7275   Defaults to Tru
-00001b60: 652e 0a20 2020 2020 2020 206f 7074 5f61  e..        opt_a
-00001b70: 7567 2028 626f 6f6c 293a 2049 6620 5472  ug (bool): If Tr
-00001b80: 7565 2c20 7468 6520 6175 676d 656e 7461  ue, the augmenta
-00001b90: 7469 6f6e 2070 726f 6365 6475 7265 2077  tion procedure w
-00001ba0: 696c 6c20 6265 206f 7074 696d 697a 6564  ill be optimized
-00001bb0: 2e20 4465 6661 756c 7473 2074 6f20 4661  . Defaults to Fa
-00001bc0: 6c73 652e 0a20 2020 2020 2020 2062 6174  lse..        bat
-00001bd0: 6368 5f6d 696e 2028 696e 7429 3a20 5468  ch_min (int): Th
-00001be0: 6520 6d69 6e69 6d75 6d20 6e75 6d62 6572  e minimum number
-00001bf0: 206f 6620 6175 676d 656e 7461 7469 6f6e   of augmentation
-00001c00: 7320 746f 2070 6572 666f 726d 2070 6572  s to perform per
-00001c10: 2069 6d61 6765 206f 6e20 7468 6520 706f   image on the po
-00001c20: 7369 7469 7665 2063 6c61 7373 2c20 6f6e  sitive class, on
-00001c30: 6c79 2061 7070 6c69 6361 626c 6520 0a20  ly applicable . 
-00001c40: 2020 2020 2020 2069 6620 6f70 745f 6175         if opt_au
-00001c50: 673d 5472 7565 2e20 4465 6661 756c 7473  g=True. Defaults
-00001c60: 2074 6f20 322e 0a20 2020 2020 2020 2062   to 2..        b
-00001c70: 6174 6368 5f6d 6178 2028 696e 7429 3a20  atch_max (int): 
-00001c80: 5468 6520 6d61 7869 6d75 6d20 6e75 6d62  The maximum numb
-00001c90: 6572 206f 6620 6175 676d 656e 7461 7469  er of augmentati
-00001ca0: 6f6e 7320 746f 2070 6572 666f 726d 2070  ons to perform p
-00001cb0: 6572 2069 6d61 6765 206f 6e20 7468 6520  er image on the 
-00001cc0: 706f 7369 7469 7665 2063 6c61 7373 2c20  positive class, 
-00001cd0: 6f6e 6c79 2061 7070 6c69 6361 626c 6520  only applicable 
-00001ce0: 0a20 2020 2020 2020 2069 6620 6f70 745f  .        if opt_
-00001cf0: 6175 673d 5472 7565 2e20 4465 6661 756c  aug=True. Defaul
-00001d00: 7473 2074 6f20 3235 2e0a 2020 2020 2020  ts to 25..      
-00001d10: 2020 696d 6167 655f 7369 7a65 5f6d 696e    image_size_min
-00001d20: 2028 696e 7429 3a20 5468 6520 6d69 6e69   (int): The mini
-00001d30: 6d75 6d20 696d 6167 6520 7369 7a65 2074  mum image size t
-00001d40: 6f20 6173 7365 7373 2c20 6f6e 6c79 2061  o assess, only a
-00001d50: 7070 6c69 6361 626c 6520 6966 206f 7074  pplicable if opt
-00001d60: 5f61 7567 3d54 7275 652e 2044 6566 6175  _aug=True. Defau
-00001d70: 6c74 7320 746f 2035 302e 0a20 2020 2020  lts to 50..     
-00001d80: 2020 2069 6d61 6765 5f73 697a 655f 6d61     image_size_ma
-00001d90: 7820 2869 6e74 293a 2054 6865 206d 6178  x (int): The max
-00001da0: 696d 756d 2069 6d61 6765 2073 697a 6520  imum image size 
-00001db0: 746f 2061 7373 6573 732c 206f 6e6c 7920  to assess, only 
-00001dc0: 6170 706c 6963 6162 6c65 2069 6620 6f70  applicable if op
-00001dd0: 745f 6175 673d 5472 7565 2e20 4465 6661  t_aug=True. Defa
-00001de0: 756c 7473 2074 6f20 3130 302e 0a20 2020  ults to 100..   
-00001df0: 2020 2020 206f 7074 5f6d 6178 5f6d 696e       opt_max_min
-00001e00: 5f70 6978 2028 696e 742c 206f 7074 696f  _pix (int, optio
-00001e10: 6e61 6c29 3a20 5468 6520 6d69 6e69 6d75  nal): The minimu
-00001e20: 6d20 6d61 7820 7069 7865 6c20 7661 6c75  m max pixel valu
-00001e30: 6520 746f 2075 7365 2077 6865 6e20 7475  e to use when tu
-00001e40: 6e69 6e67 2074 6865 206e 6f72 6d61 6c69  ning the normali
-00001e50: 7a61 7469 6f6e 2070 726f 6365 6475 7265  zation procedure
-00001e60: 2c20 0a20 2020 2020 2020 2020 2020 206f  , .            o
-00001e70: 6e6c 7920 6170 706c 6963 6162 6c65 2069  nly applicable i
-00001e80: 6620 6f70 745f 6175 673d 5472 7565 2e20  f opt_aug=True. 
-00001e90: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
-00001ea0: 2e0a 2020 2020 2020 2020 6f70 745f 6d61  ..        opt_ma
-00001eb0: 785f 6d61 785f 7069 7820 2869 6e74 2c20  x_max_pix (int, 
-00001ec0: 6f70 7469 6f6e 616c 293a 2054 6865 206d  optional): The m
-00001ed0: 6178 696d 756d 206d 6178 2070 6978 656c  aximum max pixel
-00001ee0: 2076 616c 7565 2074 6f20 7573 6520 7768   value to use wh
-00001ef0: 656e 2074 756e 696e 6720 7468 6520 6e6f  en tuning the no
-00001f00: 726d 616c 697a 6174 696f 6e20 7072 6f63  rmalization proc
-00001f10: 6564 7572 652c 200a 2020 2020 2020 2020  edure, .        
-00001f20: 2020 2020 6f6e 6c79 2061 7070 6c69 6361      only applica
-00001f30: 626c 6520 6966 206f 7074 5f61 7567 3d54  ble if opt_aug=T
-00001f40: 7275 652e 2044 6566 6175 6c74 7320 746f  rue. Defaults to
-00001f50: 204e 6f6e 652e 0a20 2020 2020 2020 2073   None..        s
-00001f60: 6869 6674 2028 696e 7429 3a20 5468 6520  hift (int): The 
-00001f70: 6d61 7820 616c 6c6f 7765 6420 7665 7274  max allowed vert
-00001f80: 6963 616c 2f68 6f72 697a 6f6e 7461 6c20  ical/horizontal 
-00001f90: 7368 6966 7473 2074 6f20 7573 6520 6475  shifts to use du
-00001fa0: 7269 6e67 2074 6865 2064 6174 6120 6175  ring the data au
-00001fb0: 676d 656e 7461 7469 6f6e 2072 6f75 7469  gmentation routi
-00001fc0: 6e65 2c20 6f6e 6c79 2061 7070 6c69 6361  ne, only applica
-00001fd0: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
-00001fe0: 6966 206f 7074 5f61 7567 3d54 7275 652e  if opt_aug=True.
-00001ff0: 2044 6566 6175 6c74 7320 746f 2031 3020   Defaults to 10 
-00002000: 7069 7865 6c73 2e0a 2020 2020 2020 2020  pixels..        
-00002010: 6d61 736b 5f73 697a 6520 2869 6e74 2c20  mask_size (int, 
-00002020: 6f70 7469 6f6e 616c 293a 2049 6620 656e  optional): If en
-00002030: 6162 6c65 642c 2074 6869 7320 7769 6c6c  abled, this will
-00002040: 2073 6574 2074 6865 2070 6978 656c 206c   set the pixel l
-00002050: 656e 6774 6820 6f66 2061 2073 7175 6172  ength of a squar
-00002060: 6520 6375 746f 7574 2c20 746f 2062 6520  e cutout, to be 
-00002070: 7261 6e64 6f6d 6c79 2070 6c61 6365 640a  randomly placed.
-00002080: 2020 2020 2020 2020 2020 2020 736f 6d65              some
-00002090: 7768 6572 6520 696e 2074 6865 2061 7567  where in the aug
-000020a0: 6d65 6e74 6564 2069 6d61 6765 2e20 5468  mented image. Th
-000020b0: 6973 2063 7574 6f75 7420 7769 6c6c 2072  is cutout will r
-000020c0: 6570 6c61 6365 2074 6865 2069 6d61 6765  eplace the image
-000020d0: 2076 616c 7565 7320 7769 7468 2030 2c20   values with 0, 
-000020e0: 7468 6572 6566 6f72 6520 7365 7276 696e  therefore servin
-000020f0: 6720 6173 2061 200a 2020 2020 2020 2020  g as a .        
-00002100: 2020 2020 7265 6775 6c61 7269 7a65 722e      regularizer.
-00002110: 204f 6e6c 7920 6170 706c 6963 6162 6c65   Only applicable
-00002120: 2069 6620 6f70 745f 6175 673d 5472 7565   if opt_aug=True
-00002130: 2e20 4465 6661 756c 7473 2074 6f20 4e6f  . Defaults to No
-00002140: 6e65 2e0a 2020 2020 2020 2020 6e75 6d5f  ne..        num_
-00002150: 6d61 736b 7320 2869 6e74 2c20 6f70 7469  masks (int, opti
-00002160: 6f6e 616c 293a 2054 6865 206e 756d 6265  onal): The numbe
-00002170: 7220 6f66 206d 6173 6b73 2074 6f20 6372  r of masks to cr
-00002180: 6561 7465 2c20 746f 2062 6520 7573 6564  eate, to be used
-00002190: 2061 6c6f 6e67 7369 6465 2074 6865 206d   alongside the m
-000021a0: 6173 6b5f 7369 7a65 2070 6172 616d 6574  ask_size paramet
-000021b0: 6572 2e20 4966 200a 2020 2020 2020 2020  er. If .        
-000021c0: 2020 2020 7468 6973 2069 7320 7365 7420      this is set 
-000021d0: 746f 2061 2076 616c 7565 2067 7265 6174  to a value great
-000021e0: 6572 2074 6861 6e20 6f6e 652c 206f 7665  er than one, ove
-000021f0: 726c 6170 206d 6179 206f 6363 7572 2e20  rlap may occur. 
-00002200: 0a20 2020 2020 2020 2076 6572 626f 7365  .        verbose
-00002210: 2028 696e 7429 3a20 436f 6e74 726f 6c73   (int): Controls
-00002220: 2074 6865 2061 6d6f 756e 7420 6f66 206f   the amount of o
-00002230: 7574 7075 7420 7072 696e 7465 6420 6475  utput printed du
-00002240: 7269 6e67 2074 6865 2074 7261 696e 696e  ring the trainin
-00002250: 6720 7072 6f63 6573 732e 2041 2076 616c  g process. A val
-00002260: 7565 206f 6620 3020 6973 2066 6f72 2073  ue of 0 is for s
-00002270: 696c 656e 7420 6d6f 6465 2c20 0a20 2020  ilent mode, .   
-00002280: 2020 2020 2020 2020 2061 2076 616c 7565           a value
-00002290: 206f 6620 3120 6973 2075 7365 6420 666f   of 1 is used fo
-000022a0: 7220 7072 6f67 7265 7373 2062 6172 206d  r progress bar m
-000022b0: 6f64 652c 2061 6e64 2032 2066 6f72 206f  ode, and 2 for o
-000022c0: 6e65 206c 696e 6520 7065 7220 6570 6f63  ne line per epoc
-000022d0: 6820 6d6f 6465 2e20 4465 6661 756c 7473  h mode. Defaults
-000022e0: 2074 6f20 312e 0a20 2020 2020 2020 206f   to 1..        o
-000022f0: 7074 5f63 7620 2869 6e74 293a 2043 726f  pt_cv (int): Cro
-00002300: 7373 2d76 616c 6964 6174 696f 6e73 2074  ss-validations t
-00002310: 6f20 7065 7266 6f72 6d20 7768 656e 2061  o perform when a
-00002320: 7373 6573 696e 6720 7468 6520 7065 7266  ssesing the perf
-00002330: 6f72 6d61 6e63 6520 6174 2065 6163 680a  ormance at each.
-00002340: 2020 2020 2020 2020 2020 2020 6879 7065              hype
-00002350: 7270 6172 616d 6574 6572 206f 7074 696d  rparameter optim
-00002360: 697a 6174 696f 6e20 7472 6961 6c2e 2046  ization trial. F
-00002370: 6f72 2065 7861 6d70 6c65 2c20 6966 2063  or example, if c
-00002380: 763d 332c 2074 6865 6e20 6561 6368 206f  v=3, then each o
-00002390: 7074 696d 697a 6174 696f 6e20 7472 6961  ptimization tria
-000023a0: 6c0a 2020 2020 2020 2020 2020 2020 7769  l.            wi
-000023b0: 6c6c 2062 6520 6173 7365 7373 6564 2061  ll be assessed a
-000023c0: 6363 6f72 6469 6e67 2074 6f20 7468 6520  ccording to the 
-000023d0: 332d 666f 6c64 2063 726f 7373 2076 616c  3-fold cross val
-000023e0: 6964 6174 696f 6e20 6163 6375 7261 6379  idation accuracy
-000023f0: 2e20 4465 6661 756c 7473 2074 6f20 3130  . Defaults to 10
-00002400: 2e0a 2020 2020 2020 2020 2020 2020 4e4f  ..            NO
-00002410: 5445 3a20 5468 6520 6869 6768 6572 2074  TE: The higher t
-00002420: 6869 7320 6e75 6d62 6572 2c20 7468 6520  his number, the 
-00002430: 6c6f 6e67 6572 2074 6865 206f 7074 696d  longer the optim
-00002440: 697a 6174 696f 6e20 7769 6c6c 2074 616b  ization will tak
-00002450: 652e 0a20 2020 2020 2020 2062 616c 616e  e..        balan
-00002460: 6365 2028 626f 6f6c 2c20 6f70 7469 6f6e  ce (bool, option
-00002470: 616c 293a 2054 6869 7320 7769 6c6c 2064  al): This will d
-00002480: 6574 6572 6d69 6e65 2077 6865 7468 6572  etermine whether
-00002490: 2074 6865 2074 776f 2063 6c61 7373 6573   the two classes
-000024a0: 0a20 2020 2020 2020 2020 2020 2061 7265  .            are
-000024b0: 206b 6570 7420 7468 6520 7361 6d65 2073   kept the same s
-000024c0: 697a 6520 6475 7269 6e67 206f 7074 696d  ize during optim
-000024d0: 697a 6174 696f 6e2c 2061 7070 6c69 6361  ization, applica
-000024e0: 626c 6520 6966 2074 756e 696e 6720 7468  ble if tuning th
-000024f0: 6520 6175 676d 656e 7461 7469 6f6e 0a20  e augmentation. 
-00002500: 2020 2020 2020 2020 2020 2070 6172 616d             param
-00002510: 6574 6572 732e 2044 6566 6175 6c74 7320  eters. Defaults 
-00002520: 746f 2054 7275 652e 0a20 2020 2020 2020  to True..       
-00002530: 206c 696d 6974 5f73 6561 7263 6820 2862   limit_search (b
-00002540: 6f6f 6c29 3a20 4966 2046 616c 7365 2c20  ool): If False, 
-00002550: 7468 6520 416c 6578 4e65 7420 6c61 7965  the AlexNet laye
-00002560: 7220 7061 7265 6d74 6572 7320 7769 6c6c  r paremters will
-00002570: 2062 6520 7475 6e65 642c 2069 6e63 6c75   be tuned, inclu
-00002580: 6469 6e67 2074 6865 206e 756d 6265 7220  ding the number 
-00002590: 6f66 2066 696c 7465 7273 2074 6f20 6c65  of filters to le
-000025a0: 6172 6e0a 2020 2020 2020 2020 2020 2020  arn.            
-000025b0: 6173 2077 656c 6c20 6173 2074 6865 2063  as well as the c
-000025c0: 6f6e 766f 6c75 7469 6f6e 2073 697a 6573  onvolution sizes
-000025d0: 2061 6e64 2073 7472 6964 6573 2e20 4465   and strides. De
-000025e0: 6661 756c 7473 2074 6f20 4661 6c73 6520  faults to False 
-000025f0: 6475 6520 746f 206d 656d 6f72 7920 616c  due to memory al
-00002600: 6c6f 6361 7469 6f6e 2069 7373 7565 7320  location issues 
-00002610: 7768 656e 2068 616e 646c 696e 670a 2020  when handling.  
-00002620: 2020 2020 2020 2020 2020 6c6f 7473 206f            lots o
-00002630: 6620 7475 6e61 626c 6520 7061 7261 6d65  f tunable parame
-00002640: 7465 7273 2e0a 2020 2020 2020 2020 6261  ters..        ba
-00002650: 7463 685f 7369 7a65 5f6d 696e 2028 696e  tch_size_min (in
-00002660: 7429 3a20 5468 6520 6d69 6e69 6d75 6d20  t): The minimum 
-00002670: 6261 7463 6820 7369 7a65 2074 6f20 7573  batch size to us
-00002680: 6520 6475 7269 6e67 2074 7261 696e 696e  e during trainin
-00002690: 672e 2053 686f 756c 6420 6265 206d 756c  g. Should be mul
-000026a0: 7469 706c 6573 206f 6620 3136 2066 6f72  tiples of 16 for
-000026b0: 206f 7074 696d 616c 2068 6172 6477 6172   optimal hardwar
-000026c0: 6520 7573 653f 3f20 4465 6661 756c 7473  e use?? Defaults
-000026d0: 2074 6f20 3136 2e0a 2020 2020 2020 2020   to 16..        
-000026e0: 6261 7463 685f 7369 7a65 5f6d 6178 2028  batch_size_max (
-000026f0: 696e 7429 3a20 5468 6520 4d61 7869 6d75  int): The Maximu
-00002700: 6d20 6261 7463 6820 7369 7a65 2074 6f20  m batch size to 
-00002710: 7573 6520 6475 7269 6e67 2074 7261 696e  use during train
-00002720: 696e 672e 2053 686f 756c 6420 6265 206d  ing. Should be m
-00002730: 756c 7469 706c 6573 206f 6620 3136 2066  ultiples of 16 f
-00002740: 6f72 206f 7074 696d 616c 2068 6172 6477  or optimal hardw
-00002750: 6172 6520 7573 653f 3f20 4465 6661 756c  are use?? Defaul
-00002760: 7473 2074 6f20 3634 2e0a 2020 2020 2020  ts to 64..      
-00002770: 2020 7472 6169 6e5f 6163 635f 7468 7265    train_acc_thre
-00002780: 7368 6f6c 6420 2866 6c6f 6174 2c20 6f70  shold (float, op
-00002790: 7469 6f6e 616c 293a 2041 2076 616c 7565  tional): A value
-000027a0: 2062 6574 7765 656e 2030 2061 6e64 2031   between 0 and 1
-000027b0: 2074 6861 7420 6465 7369 676e 6174 6573   that designates
-000027c0: 2074 6865 2074 7261 696e 696e 6720 6269   the training bi
-000027d0: 6e61 7279 5f61 6363 7572 6163 7920 7468  nary_accuracy th
-000027e0: 7265 7368 6f6c 6420 7468 6174 2073 686f  reshold that sho
-000027f0: 756c 640a 2020 2020 2020 2020 2020 2020  uld.            
-00002800: 6e6f 7420 6265 2065 7863 6565 6465 642e  not be exceeded.
-00002810: 2041 7320 736f 6f6e 2061 7320 7468 6520   As soon as the 
-00002820: 7472 6169 6e69 6e67 2065 7863 6565 6473  training exceeds
-00002830: 2074 6869 7320 6c69 6d69 742c 2074 6865   this limit, the
-00002840: 2074 7269 616c 2069 7320 7374 6f70 7065   trial is stoppe
-00002850: 6420 6561 726c 792e 2044 6566 6175 6c74  d early. Default
-00002860: 7320 746f 204e 6f6e 652e 0a20 2020 2020  s to None..     
-00002870: 2020 206d 6f6e 6974 6f72 3120 2873 7472     monitor1 (str
-00002880: 2c20 6f70 7469 6f6e 616c 293a 2054 6865  , optional): The
-00002890: 2066 6972 7374 206d 6574 7269 6320 746f   first metric to
-000028a0: 206d 6f6e 6974 6f72 2c20 6361 6e20 7461   monitor, can ta
-000028b0: 6b65 2074 6865 2073 616d 6520 7661 6c75  ke the same valu
-000028c0: 6573 2061 7320 7468 6520 6d65 7472 6963  es as the metric
-000028d0: 2061 7267 756d 656e 742e 2044 6566 6175   argument. Defau
-000028e0: 6c74 7320 746f 204e 6f6e 652e 0a20 2020  lts to None..   
-000028f0: 2020 2020 206d 6f6e 6974 6f72 3220 2873       monitor2 (s
-00002900: 7472 2c20 6f70 7469 6f6e 616c 293a 2054  tr, optional): T
-00002910: 6865 2073 6563 6f6e 6420 6d65 7472 6963  he second metric
-00002920: 2074 6f20 6d6f 6e69 746f 722c 2063 616e   to monitor, can
-00002930: 2074 616b 6520 7468 6520 7361 6d65 2076   take the same v
-00002940: 616c 7565 7320 6173 2074 6865 206d 6574  alues as the met
-00002950: 7269 6320 6172 6775 6d65 6e74 2e20 4465  ric argument. De
-00002960: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0a  faults to None..
-00002970: 2020 2020 2020 2020 6d6f 6e69 746f 7231          monitor1
-00002980: 5f74 6872 6573 6820 2866 6c6f 6174 2c20  _thresh (float, 
-00002990: 6f70 7469 6f6e 616c 293a 2054 6865 2074  optional): The t
-000029a0: 6872 6573 686f 6c64 2076 616c 7565 206f  hreshold value o
-000029b0: 6620 7468 6520 6669 7273 7420 6d6f 6e69  f the first moni
-000029c0: 746f 7220 6d65 7472 6963 2e20 4966 2074  tor metric. If t
-000029d0: 6865 206d 6574 7269 6320 6973 206c 6f73  he metric is los
-000029e0: 732d 7265 6c61 7465 640a 2020 2020 2020  s-related.      
-000029f0: 2020 2020 2020 7468 6520 7472 6169 6e69        the traini
-00002a00: 6e67 2077 696c 6c20 7374 6f70 2065 6172  ng will stop ear
-00002a10: 6c79 2069 6620 7468 6520 7661 6c75 6520  ly if the value 
-00002a20: 6661 6c6c 7320 6265 6c6f 7720 7468 6973  falls below this
-00002a30: 2074 6872 6573 686f 6c64 2e20 5369 6d69   threshold. Simi
-00002a40: 6c61 726c 792c 2069 6620 7468 6520 6d65  larly, if the me
-00002a50: 7472 6963 2069 7320 6163 6375 7261 6379  tric is accuracy
-00002a60: 2d72 656c 6174 6564 2c0a 2020 2020 2020  -related,.      
-00002a70: 2020 2020 2020 7468 656e 2074 6865 2074        then the t
-00002a80: 7261 696e 696e 6720 7769 6c6c 2073 746f  raining will sto
-00002a90: 7020 6561 726c 7920 6966 2074 6865 2076  p early if the v
-00002aa0: 616c 7565 2066 616c 6c73 2061 626f 7665  alue falls above
-00002ab0: 2074 6869 7320 7468 7265 7368 6f6c 642e   this threshold.
-00002ac0: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-00002ad0: 652e 0a20 2020 2020 2020 206d 6f6e 6974  e..        monit
-00002ae0: 6f72 325f 7468 7265 7368 2028 666c 6f61  or2_thresh (floa
-00002af0: 742c 206f 7074 696f 6e61 6c29 3a20 5468  t, optional): Th
-00002b00: 6520 7468 7265 7368 6f6c 6420 7661 6c75  e threshold valu
-00002b10: 6520 6f66 2074 6865 2073 6563 6f6e 6420  e of the second 
-00002b20: 6d6f 6e69 746f 7220 6d65 7472 6963 2e20  monitor metric. 
-00002b30: 4966 2074 6865 206d 6574 7269 6320 6973  If the metric is
-00002b40: 206c 6f73 732d 7265 6c61 7465 640a 2020   loss-related.  
-00002b50: 2020 2020 2020 2020 2020 7468 6520 7472            the tr
-00002b60: 6169 6e69 6e67 2077 696c 6c20 7374 6f70  aining will stop
-00002b70: 2065 6172 6c79 2069 6620 7468 6520 7661   early if the va
-00002b80: 6c75 6520 6661 6c6c 7320 6265 6c6f 7720  lue falls below 
-00002b90: 7468 6973 2074 6872 6573 686f 6c64 2e20  this threshold. 
-00002ba0: 5369 6d69 6c61 726c 792c 2069 6620 7468  Similarly, if th
-00002bb0: 6520 6d65 7472 6963 2069 7320 6163 6375  e metric is accu
-00002bc0: 7261 6379 2d72 656c 6174 6564 2c0a 2020  racy-related,.  
-00002bd0: 2020 2020 2020 2020 2020 7468 656e 2074            then t
-00002be0: 6865 2074 7261 696e 696e 6720 7769 6c6c  he training will
-00002bf0: 2073 746f 7020 6561 726c 7920 6966 2074   stop early if t
-00002c00: 6865 2076 616c 7565 2066 616c 6c73 2061  he value falls a
-00002c10: 626f 7665 2074 6869 7320 7468 7265 7368  bove this thresh
-00002c20: 6f6c 642e 2044 6566 6175 6c74 7320 746f  old. Defaults to
-00002c30: 204e 6f6e 652e 0a20 2020 2020 2020 200a   None..        .
-00002c40: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
-00002c50: 2020 2020 2054 6865 2070 6572 666f 726d       The perform
-00002c60: 616e 6365 206d 6574 7269 632e 0a20 2020  ance metric..   
-00002c70: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
-00002c80: 696e 6974 5f5f 2873 656c 662c 2070 6f73  init__(self, pos
-00002c90: 6974 6976 655f 636c 6173 732c 206e 6567  itive_class, neg
-00002ca0: 6174 6976 655f 636c 6173 732c 2069 6d67  ative_class, img
-00002cb0: 5f6e 756d 5f63 6861 6e6e 656c 733d 312c  _num_channels=1,
-00002cc0: 206e 6f72 6d61 6c69 7a65 3d54 7275 652c   normalize=True,
-00002cd0: 206d 696e 5f70 6978 656c 3d30 2c20 6d61   min_pixel=0, ma
-00002ce0: 785f 7069 7865 6c3d 3130 302c 200a 2020  x_pixel=100, .  
-00002cf0: 2020 2020 2020 7661 6c5f 706f 7369 7469        val_positi
-00002d00: 7665 3d4e 6f6e 652c 2076 616c 5f6e 6567  ve=None, val_neg
-00002d10: 6174 6976 653d 4e6f 6e65 2c20 7465 7374  ative=None, test
-00002d20: 5f70 6f73 6974 6976 653d 4e6f 6e65 2c20  _positive=None, 
-00002d30: 7465 7374 5f6e 6567 6174 6976 653d 4e6f  test_negative=No
-00002d40: 6e65 2c20 7472 6169 6e5f 6570 6f63 6873  ne, train_epochs
-00002d50: 3d32 352c 2070 6174 6965 6e63 653d 3230  =25, patience=20
-00002d60: 2c20 0a20 2020 2020 2020 206f 7074 5f6d  , .        opt_m
-00002d70: 6f64 656c 3d54 7275 652c 206f 7074 5f61  odel=True, opt_a
-00002d80: 7567 3d46 616c 7365 2c20 6261 7463 685f  ug=False, batch_
-00002d90: 6d69 6e3d 322c 2062 6174 6368 5f6d 6178  min=2, batch_max
-00002da0: 3d32 352c 2069 6d61 6765 5f73 697a 655f  =25, image_size_
-00002db0: 6d69 6e3d 3530 2c20 696d 6167 655f 7369  min=50, image_si
-00002dc0: 7a65 5f6d 6178 3d31 3030 2c20 0a20 2020  ze_max=100, .   
-00002dd0: 2020 2020 2062 616c 616e 6365 3d54 7275       balance=Tru
-00002de0: 652c 206f 7074 5f6d 6178 5f6d 696e 5f70  e, opt_max_min_p
-00002df0: 6978 3d4e 6f6e 652c 206f 7074 5f6d 6178  ix=None, opt_max
-00002e00: 5f6d 6178 5f70 6978 3d4e 6f6e 652c 206d  _max_pix=None, m
-00002e10: 6574 7269 633d 276c 6f73 7327 2c20 6176  etric='loss', av
-00002e20: 6572 6167 653d 5472 7565 2c20 7368 6966  erage=True, shif
-00002e30: 743d 3130 2c0a 2020 2020 2020 2020 6d61  t=10,.        ma
-00002e40: 736b 5f73 697a 653d 4e6f 6e65 2c20 6e75  sk_size=None, nu
-00002e50: 6d5f 6d61 736b 733d 4e6f 6e65 2c20 6f70  m_masks=None, op
-00002e60: 745f 6376 3d4e 6f6e 652c 2076 6572 626f  t_cv=None, verbo
-00002e70: 7365 3d30 2c20 7472 6169 6e5f 6163 635f  se=0, train_acc_
-00002e80: 7468 7265 7368 6f6c 643d 4e6f 6e65 2c20  threshold=None, 
-00002e90: 0a20 2020 2020 2020 206c 696d 6974 5f73  .        limit_s
-00002ea0: 6561 7263 683d 5472 7565 2c20 6261 7463  earch=True, batc
-00002eb0: 685f 7369 7a65 5f6d 696e 3d31 362c 2062  h_size_min=16, b
-00002ec0: 6174 6368 5f73 697a 655f 6d61 783d 3634  atch_size_max=64
-00002ed0: 2c20 6d6f 6e69 746f 7231 3d4e 6f6e 652c  , monitor1=None,
-00002ee0: 206d 6f6e 6974 6f72 323d 4e6f 6e65 2c20   monitor2=None, 
-00002ef0: 6d6f 6e69 746f 7231 5f74 6872 6573 683d  monitor1_thresh=
-00002f00: 4e6f 6e65 2c20 6d6f 6e69 746f 7232 5f74  None, monitor2_t
-00002f10: 6872 6573 683d 4e6f 6e65 293a 0a0a 2020  hresh=None):..  
-00002f20: 2020 2020 2020 7365 6c66 2e70 6f73 6974        self.posit
-00002f30: 6976 655f 636c 6173 7320 3d20 706f 7369  ive_class = posi
-00002f40: 7469 7665 5f63 6c61 7373 0a20 2020 2020  tive_class.     
-00002f50: 2020 2073 656c 662e 6e65 6761 7469 7665     self.negative
-00002f60: 5f63 6c61 7373 203d 206e 6567 6174 6976  _class = negativ
-00002f70: 655f 636c 6173 730a 2020 2020 2020 2020  e_class.        
-00002f80: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
-00002f90: 6e6e 656c 7320 3d20 696d 675f 6e75 6d5f  nnels = img_num_
-00002fa0: 6368 616e 6e65 6c73 0a20 2020 2020 2020  channels.       
-00002fb0: 2073 656c 662e 6e6f 726d 616c 697a 6520   self.normalize 
-00002fc0: 3d20 6e6f 726d 616c 697a 6520 0a20 2020  = normalize .   
-00002fd0: 2020 2020 2073 656c 662e 6d69 6e5f 7069       self.min_pi
-00002fe0: 7865 6c20 3d20 6d69 6e5f 7069 7865 6c0a  xel = min_pixel.
-00002ff0: 2020 2020 2020 2020 7365 6c66 2e6d 6178          self.max
-00003000: 5f70 6978 656c 203d 206d 6178 5f70 6978  _pixel = max_pix
-00003010: 656c 0a20 2020 2020 2020 2073 656c 662e  el.        self.
-00003020: 7661 6c5f 706f 7369 7469 7665 203d 2076  val_positive = v
-00003030: 616c 5f70 6f73 6974 6976 650a 2020 2020  al_positive.    
-00003040: 2020 2020 7365 6c66 2e76 616c 5f6e 6567      self.val_neg
-00003050: 6174 6976 6520 3d20 7661 6c5f 6e65 6761  ative = val_nega
-00003060: 7469 7665 0a20 2020 2020 2020 2073 656c  tive.        sel
-00003070: 662e 7465 7374 5f70 6f73 6974 6976 6520  f.test_positive 
-00003080: 3d20 7465 7374 5f70 6f73 6974 6976 650a  = test_positive.
-00003090: 2020 2020 2020 2020 7365 6c66 2e74 6573          self.tes
-000030a0: 745f 6e65 6761 7469 7665 203d 2074 6573  t_negative = tes
-000030b0: 745f 6e65 6761 7469 7665 0a20 2020 2020  t_negative.     
-000030c0: 2020 2073 656c 662e 6261 7463 685f 7369     self.batch_si
-000030d0: 7a65 5f6d 696e 203d 2062 6174 6368 5f73  ze_min = batch_s
-000030e0: 697a 655f 6d69 6e0a 2020 2020 2020 2020  ize_min.        
-000030f0: 7365 6c66 2e62 6174 6368 5f73 697a 655f  self.batch_size_
-00003100: 6d61 7820 3d20 6261 7463 685f 7369 7a65  max = batch_size
-00003110: 5f6d 6178 0a0a 2020 2020 2020 2020 7365  _max..        se
-00003120: 6c66 2e74 7261 696e 5f65 706f 6368 7320  lf.train_epochs 
-00003130: 3d20 7472 6169 6e5f 6570 6f63 6873 0a20  = train_epochs. 
-00003140: 2020 2020 2020 2073 656c 662e 7061 7469         self.pati
-00003150: 656e 6365 203d 2070 6174 6965 6e63 6520  ence = patience 
-00003160: 0a20 2020 2020 2020 2073 656c 662e 6f70  .        self.op
-00003170: 745f 6d6f 6465 6c20 3d20 6f70 745f 6d6f  t_model = opt_mo
-00003180: 6465 6c20 200a 2020 2020 2020 2020 7365  del  .        se
-00003190: 6c66 2e6f 7074 5f61 7567 203d 206f 7074  lf.opt_aug = opt
-000031a0: 5f61 7567 0a20 2020 2020 2020 2073 656c  _aug.        sel
-000031b0: 662e 6261 7463 685f 6d69 6e20 3d20 6261  f.batch_min = ba
-000031c0: 7463 685f 6d69 6e20 0a20 2020 2020 2020  tch_min .       
-000031d0: 2073 656c 662e 6261 7463 685f 6d61 7820   self.batch_max 
-000031e0: 3d20 6261 7463 685f 6d61 7820 0a20 2020  = batch_max .   
-000031f0: 2020 2020 2073 656c 662e 696d 6167 655f       self.image_
-00003200: 7369 7a65 5f6d 696e 203d 2069 6d61 6765  size_min = image
-00003210: 5f73 697a 655f 6d69 6e0a 2020 2020 2020  _size_min.      
-00003220: 2020 7365 6c66 2e69 6d61 6765 5f73 697a    self.image_siz
-00003230: 655f 6d61 7820 3d20 696d 6167 655f 7369  e_max = image_si
-00003240: 7a65 5f6d 6178 0a20 2020 2020 2020 2073  ze_max.        s
-00003250: 656c 662e 6261 6c61 6e63 6520 3d20 6261  elf.balance = ba
-00003260: 6c61 6e63 650a 2020 2020 2020 2020 7365  lance.        se
-00003270: 6c66 2e6f 7074 5f6d 6178 5f6d 696e 5f70  lf.opt_max_min_p
-00003280: 6978 203d 206f 7074 5f6d 6178 5f6d 696e  ix = opt_max_min
-00003290: 5f70 6978 0a20 2020 2020 2020 2073 656c  _pix.        sel
-000032a0: 662e 6f70 745f 6d61 785f 6d61 785f 7069  f.opt_max_max_pi
-000032b0: 7820 3d20 6f70 745f 6d61 785f 6d61 785f  x = opt_max_max_
-000032c0: 7069 780a 2020 2020 2020 2020 7365 6c66  pix.        self
-000032d0: 2e6d 6574 7269 6320 3d20 6d65 7472 6963  .metric = metric
-000032e0: 200a 2020 2020 2020 2020 7365 6c66 2e61   .        self.a
-000032f0: 7665 7261 6765 203d 2061 7665 7261 6765  verage = average
-00003300: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
-00003310: 6966 7420 3d20 7368 6966 7420 0a20 2020  ift = shift .   
-00003320: 2020 2020 2073 656c 662e 6f70 745f 6376       self.opt_cv
-00003330: 203d 206f 7074 5f63 760a 2020 2020 2020   = opt_cv.      
-00003340: 2020 7365 6c66 2e76 6572 626f 7365 203d    self.verbose =
-00003350: 2076 6572 626f 7365 0a20 2020 2020 2020   verbose.       
-00003360: 2073 656c 662e 6d61 736b 5f73 697a 6520   self.mask_size 
-00003370: 3d20 6d61 736b 5f73 697a 650a 2020 2020  = mask_size.    
-00003380: 2020 2020 7365 6c66 2e6e 756d 5f6d 6173      self.num_mas
-00003390: 6b73 203d 206e 756d 5f6d 6173 6b73 0a20  ks = num_masks. 
-000033a0: 2020 2020 2020 2073 656c 662e 7472 6169         self.trai
-000033b0: 6e5f 6163 635f 7468 7265 7368 6f6c 6420  n_acc_threshold 
-000033c0: 3d20 7472 6169 6e5f 6163 635f 7468 7265  = train_acc_thre
-000033d0: 7368 6f6c 640a 2020 2020 2020 2020 7365  shold.        se
-000033e0: 6c66 2e6c 696d 6974 5f73 6561 7263 6820  lf.limit_search 
-000033f0: 3d20 6c69 6d69 745f 7365 6172 6368 0a0a  = limit_search..
-00003400: 2020 2020 2020 2020 7365 6c66 2e6d 6f6e          self.mon
-00003410: 6974 6f72 3120 3d20 6d6f 6e69 746f 7231  itor1 = monitor1
-00003420: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
-00003430: 6e69 746f 7232 203d 206d 6f6e 6974 6f72  nitor2 = monitor
-00003440: 320a 2020 2020 2020 2020 7365 6c66 2e6d  2.        self.m
-00003450: 6f6e 6974 6f72 315f 7468 7265 7368 203d  onitor1_thresh =
-00003460: 206d 6f6e 6974 6f72 315f 7468 7265 7368   monitor1_thresh
-00003470: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
-00003480: 6e69 746f 7232 5f74 6872 6573 6820 3d20  nitor2_thresh = 
-00003490: 6d6f 6e69 746f 7232 5f74 6872 6573 680a  monitor2_thresh.
-000034a0: 0a20 2020 2020 2020 2069 6620 2761 6c6c  .        if 'all
-000034b0: 2720 6e6f 7420 696e 2073 656c 662e 6d65  ' not in self.me
-000034c0: 7472 6963 2061 6e64 2027 6c6f 7373 2720  tric and 'loss' 
-000034d0: 6e6f 7420 696e 2073 656c 662e 6d65 7472  not in self.metr
-000034e0: 6963 2061 6e64 2027 6631 5f73 636f 7265  ic and 'f1_score
-000034f0: 2720 6e6f 7420 696e 2073 656c 662e 6d65  ' not in self.me
-00003500: 7472 6963 2061 6e64 2027 6269 6e61 7279  tric and 'binary
-00003510: 5f61 6363 7572 6163 7927 206e 6f74 2069  _accuracy' not i
-00003520: 6e20 7365 6c66 2e6d 6574 7269 633a 0a20  n self.metric:. 
-00003530: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00003540: 2056 616c 7565 4572 726f 7228 2249 6e76   ValueError("Inv
-00003550: 616c 6964 206d 6574 7269 6320 696e 7075  alid metric inpu
-00003560: 742c 206f 7074 696f 6e73 2061 7265 3a20  t, options are: 
-00003570: 276c 6f73 7327 2c20 2762 696e 6172 795f  'loss', 'binary_
-00003580: 6163 6375 7261 6379 272c 2027 6631 5f73  accuracy', 'f1_s
-00003590: 636f 7265 272c 206f 7220 2761 6c6c 272c  core', or 'all',
-000035a0: 2061 6e64 2074 6865 2076 616c 6964 6174   and the validat
-000035b0: 696f 6e20 6571 7569 7661 6c65 6e74 7320  ion equivalents 
-000035c0: 2861 6464 2076 616c 5f20 6174 2074 6865  (add val_ at the
-000035d0: 2062 6567 696e 6e69 6e67 292e 2229 0a20   beginning)."). 
-000035e0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000035f0: 6966 2073 656c 662e 6d65 7472 6963 203d  if self.metric =
-00003600: 3d20 2776 616c 5f6c 6f73 7327 206f 7220  = 'val_loss' or 
-00003610: 7365 6c66 2e6d 6574 7269 6320 3d3d 2027  self.metric == '
-00003620: 7661 6c5f 6269 6e61 7279 5f61 6363 7572  val_binary_accur
-00003630: 6163 7927 3a0a 2020 2020 2020 2020 2020  acy':.          
-00003640: 2020 6966 2073 656c 662e 7661 6c5f 706f    if self.val_po
-00003650: 7369 7469 7665 2069 7320 4e6f 6e65 2061  sitive is None a
-00003660: 6e64 2073 656c 662e 7661 6c5f 6e65 6761  nd self.val_nega
-00003670: 7469 7665 2069 7320 4e6f 6e65 3a0a 2020  tive is None:.  
-00003680: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00003690: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
-000036a0: 4e6f 2076 616c 6964 6174 696f 6e20 6461  No validation da
-000036b0: 7461 2069 6e70 7574 2c20 6368 616e 6765  ta input, change
-000036c0: 2074 6865 206d 6574 7269 6320 746f 2065   the metric to e
-000036d0: 6974 6865 7220 226c 6f73 7322 206f 7220  ither "loss" or 
-000036e0: 2262 696e 6172 795f 6163 6375 7261 6379  "binary_accuracy
-000036f0: 222e 2729 0a0a 2020 2020 2020 2020 6966  ".')..        if
-00003700: 2073 656c 662e 6f70 745f 6d61 785f 6d69   self.opt_max_mi
-00003710: 6e5f 7069 7820 6973 206e 6f74 204e 6f6e  n_pix is not Non
-00003720: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-00003730: 6620 7365 6c66 2e6f 7074 5f6d 6178 5f6d  f self.opt_max_m
-00003740: 6178 5f70 6978 2069 7320 4e6f 6e65 3a0a  ax_pix is None:.
-00003750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003760: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00003770: 2827 546f 206f 7074 696d 697a 6520 6d69  ('To optimize mi
-00003780: 6e2f 6d61 7820 6e6f 726d 616c 697a 6174  n/max normalizat
-00003790: 696f 6e20 7069 7865 6c20 7661 6c75 652c  ion pixel value,
-000037a0: 2062 6f74 6820 6f70 745f 6d69 6e5f 7069   both opt_min_pi
-000037b0: 7820 616e 6420 6f70 745f 6d61 785f 7069  x and opt_max_pi
-000037c0: 7820 6d75 7374 2062 6520 696e 7075 7427  x must be input'
-000037d0: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
-000037e0: 6c66 2e6f 7074 5f6d 6178 5f6d 6178 5f70  lf.opt_max_max_p
-000037f0: 6978 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ix is not None:.
-00003800: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00003810: 656c 662e 6f70 745f 6d61 785f 6d69 6e5f  elf.opt_max_min_
-00003820: 7069 7820 6973 204e 6f6e 653a 0a20 2020  pix is None:.   
-00003830: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00003840: 7365 2056 616c 7565 4572 726f 7228 2754  se ValueError('T
-00003850: 6f20 6f70 7469 6d69 7a65 206d 696e 2f6d  o optimize min/m
-00003860: 6178 206e 6f72 6d61 6c69 7a61 7469 6f6e  ax normalization
-00003870: 2070 6978 656c 2076 616c 7565 2c20 626f   pixel value, bo
-00003880: 7468 206f 7074 5f6d 696e 5f70 6978 2061  th opt_min_pix a
-00003890: 6e64 206f 7074 5f6d 6178 5f70 6978 206d  nd opt_max_pix m
-000038a0: 7573 7420 6265 2069 6e70 7574 2729 0a0a  ust be input')..
-000038b0: 2020 2020 6465 6620 5f5f 6361 6c6c 5f5f      def __call__
-000038c0: 2873 656c 662c 2074 7269 616c 293a 0a0a  (self, trial):..
-000038d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000038e0: 6f70 745f 6175 673a 0a20 2020 2020 2020  opt_aug:.       
-000038f0: 2020 2020 2069 6620 7365 6c66 2e69 6d67       if self.img
-00003900: 5f6e 756d 5f63 6861 6e6e 656c 7320 3d3d  _num_channels ==
-00003910: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00003920: 2020 2020 6368 616e 6e65 6c31 2c20 6368      channel1, ch
-00003930: 616e 6e65 6c32 2c20 6368 616e 6e65 6c33  annel2, channel3
-00003940: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
-00003950: 2873 656c 662e 706f 7369 7469 7665 5f63  (self.positive_c
-00003960: 6c61 7373 292c 204e 6f6e 652c 204e 6f6e  lass), None, Non
-00003970: 6520 0a20 2020 2020 2020 2020 2020 2065  e .            e
-00003980: 6c69 6620 7365 6c66 2e69 6d67 5f6e 756d  lif self.img_num
-00003990: 5f63 6861 6e6e 656c 7320 3d3d 2032 3a0a  _channels == 2:.
-000039a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000039b0: 6368 616e 6e65 6c31 2c20 6368 616e 6e65  channel1, channe
-000039c0: 6c32 2c20 6368 616e 6e65 6c33 203d 2063  l2, channel3 = c
-000039d0: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
-000039e0: 662e 706f 7369 7469 7665 5f63 6c61 7373  f.positive_class
-000039f0: 5b3a 2c3a 2c3a 2c30 5d29 2c20 636f 7079  [:,:,:,0]), copy
-00003a00: 2e64 6565 7063 6f70 7928 7365 6c66 2e70  .deepcopy(self.p
-00003a10: 6f73 6974 6976 655f 636c 6173 735b 3a2c  ositive_class[:,
-00003a20: 3a2c 3a2c 315d 292c 204e 6f6e 6520 0a20  :,:,1]), None . 
-00003a30: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00003a40: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
-00003a50: 6e6e 656c 7320 3d3d 2033 3a0a 2020 2020  nnels == 3:.    
-00003a60: 2020 2020 2020 2020 2020 2020 6368 616e              chan
-00003a70: 6e65 6c31 2c20 6368 616e 6e65 6c32 2c20  nel1, channel2, 
-00003a80: 6368 616e 6e65 6c33 203d 2063 6f70 792e  channel3 = copy.
-00003a90: 6465 6570 636f 7079 2873 656c 662e 706f  deepcopy(self.po
-00003aa0: 7369 7469 7665 5f63 6c61 7373 5b3a 2c3a  sitive_class[:,:
-00003ab0: 2c3a 2c30 5d29 2c20 636f 7079 2e64 6565  ,:,0]), copy.dee
-00003ac0: 7063 6f70 7928 7365 6c66 2e70 6f73 6974  pcopy(self.posit
-00003ad0: 6976 655f 636c 6173 735b 3a2c 3a2c 3a2c  ive_class[:,:,:,
-00003ae0: 315d 292c 2063 6f70 792e 6465 6570 636f  1]), copy.deepco
-00003af0: 7079 2873 656c 662e 706f 7369 7469 7665  py(self.positive
-00003b00: 5f63 6c61 7373 5b3a 2c3a 2c3a 2c32 5d29  _class[:,:,:,2])
-00003b10: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00003b20: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00003b30: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00003b40: 726f 7228 274f 6e6c 7920 7468 7265 6520  ror('Only three 
-00003b50: 6669 6c74 6572 7320 6172 6520 7375 7070  filters are supp
-00003b60: 6f72 7465 6421 2729 0a0a 2020 2020 2020  orted!')..      
-00003b70: 2020 6966 2027 6c6f 7373 2720 696e 2073    if 'loss' in s
-00003b80: 656c 662e 6d65 7472 6963 3a20 2354 6869  elf.metric: #Thi
-00003b90: 7320 7365 7473 2074 6865 206d 6f64 656c  s sets the model
-00003ba0: 2070 6174 6965 6e63 6520 6475 7269 6e67   patience during
-00003bb0: 2069 6e64 6976 6964 7561 6c20 7472 6169   individual trai
-00003bc0: 6e69 6e67 2072 756e 730a 2020 2020 2020  ning runs.      
-00003bd0: 2020 2020 2020 6d6f 6465 203d 2027 6d69        mode = 'mi
-00003be0: 6e27 0a20 2020 2020 2020 2065 6c73 653a  n'.        else:
-00003bf0: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-00003c00: 6520 3d20 276d 6178 270a 0a20 2020 2020  e = 'max'..     
-00003c10: 2020 2069 6620 7365 6c66 2e6f 7074 5f61     if self.opt_a
-00003c20: 7567 3a0a 2020 2020 2020 2020 2020 2020  ug:.            
-00003c30: 6e75 6d5f 6175 6720 3d20 7472 6961 6c2e  num_aug = trial.
-00003c40: 7375 6767 6573 745f 696e 7428 276e 756d  suggest_int('num
-00003c50: 5f61 7567 272c 2073 656c 662e 6261 7463  _aug', self.batc
-00003c60: 685f 6d69 6e2c 2073 656c 662e 6261 7463  h_min, self.batc
-00003c70: 685f 6d61 782c 2073 7465 703d 3129 0a20  h_max, step=1). 
-00003c80: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-00003c90: 5f73 697a 6520 3d20 7472 6961 6c2e 7375  _size = trial.su
-00003ca0: 6767 6573 745f 696e 7428 2769 6d61 6765  ggest_int('image
-00003cb0: 5f73 697a 6527 2c20 7365 6c66 2e69 6d61  _size', self.ima
-00003cc0: 6765 5f73 697a 655f 6d69 6e2c 2073 656c  ge_size_min, sel
-00003cd0: 662e 696d 6167 655f 7369 7a65 5f6d 6178  f.image_size_max
-00003ce0: 2c20 7374 6570 3d31 290a 2020 2020 2020  , step=1).      
-00003cf0: 2020 2020 2020 2372 6f74 6174 696f 6e20        #rotation 
-00003d00: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
-00003d10: 6361 7465 676f 7269 6361 6c28 2772 6f74  categorical('rot
-00003d20: 6174 696f 6e27 2c20 5b54 7275 652c 2046  ation', [True, F
-00003d30: 616c 7365 5d29 0a20 2020 2020 2020 2020  alse]).         
-00003d40: 2020 2072 6f74 6174 696f 6e20 3d20 4661     rotation = Fa
-00003d50: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00003d60: 686f 7269 7a6f 6e74 616c 203d 2076 6572  horizontal = ver
-00003d70: 7469 6361 6c20 3d20 5472 7565 200a 0a20  tical = True .. 
-00003d80: 2020 2020 2020 2020 2020 2061 7567 6d65             augme
-00003d90: 6e74 6564 5f69 6d61 6765 7320 3d20 6175  nted_images = au
-00003da0: 676d 656e 7461 7469 6f6e 2863 6861 6e6e  gmentation(chann
-00003db0: 656c 313d 6368 616e 6e65 6c31 2c20 6368  el1=channel1, ch
-00003dc0: 616e 6e65 6c32 3d63 6861 6e6e 656c 322c  annel2=channel2,
-00003dd0: 2063 6861 6e6e 656c 333d 6368 616e 6e65   channel3=channe
-00003de0: 6c33 2c20 6261 7463 683d 6e75 6d5f 6175  l3, batch=num_au
-00003df0: 672c 200a 2020 2020 2020 2020 2020 2020  g, .            
-00003e00: 2020 2020 7769 6474 685f 7368 6966 743d      width_shift=
-00003e10: 7365 6c66 2e73 6869 6674 2c20 6865 6967  self.shift, heig
-00003e20: 6874 5f73 6869 6674 3d73 656c 662e 7368  ht_shift=self.sh
-00003e30: 6966 742c 2068 6f72 697a 6f6e 7461 6c3d  ift, horizontal=
-00003e40: 686f 7269 7a6f 6e74 616c 2c20 7665 7274  horizontal, vert
-00003e50: 6963 616c 3d76 6572 7469 6361 6c2c 2072  ical=vertical, r
-00003e60: 6f74 6174 696f 6e3d 726f 7461 7469 6f6e  otation=rotation
-00003e70: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-00003e80: 2020 2069 6d61 6765 5f73 697a 653d 696d     image_size=im
-00003e90: 6167 655f 7369 7a65 2c20 6d61 736b 5f73  age_size, mask_s
-00003ea0: 697a 653d 7365 6c66 2e6d 6173 6b5f 7369  ize=self.mask_si
-00003eb0: 7a65 2c20 6e75 6d5f 6d61 736b 733d 7365  ze, num_masks=se
-00003ec0: 6c66 2e6e 756d 5f6d 6173 6b73 290a 0a20  lf.num_masks).. 
-00003ed0: 2020 2020 2020 2020 2020 2023 5468 6520             #The 
-00003ee0: 6175 676d 656e 7461 7469 6f6e 2072 6f75  augmentation rou
-00003ef0: 7469 6e65 2072 6574 7572 6e73 2061 6e20  tine returns an 
-00003f00: 6f75 7470 7574 2066 6f72 2065 6163 6820  output for each 
-00003f10: 6669 6c74 6572 2c20 652e 672e 2033 206f  filter, e.g. 3 o
-00003f20: 7574 7075 7473 2066 6f72 2052 4742 0a20  utputs for RGB. 
-00003f30: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00003f40: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
-00003f50: 656c 7320 3e20 313a 0a20 2020 2020 2020  els > 1:.       
-00003f60: 2020 2020 2020 2020 2063 6c61 7373 5f31           class_1
-00003f70: 3d5b 5d0a 2020 2020 2020 2020 2020 2020  =[].            
-00003f80: 2020 2020 6966 2073 656c 662e 696d 675f      if self.img_
-00003f90: 6e75 6d5f 6368 616e 6e65 6c73 203d 3d20  num_channels == 
-00003fa0: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-00003fb0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00003fc0: 7261 6e67 6528 6c65 6e28 6175 676d 656e  range(len(augmen
-00003fd0: 7465 645f 696d 6167 6573 5b30 5d29 293a  ted_images[0])):
-00003fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003ff0: 2020 2020 2020 2020 2063 6c61 7373 5f31           class_1
-00004000: 2e61 7070 656e 6428 6461 7461 5f70 726f  .append(data_pro
-00004010: 6365 7373 696e 672e 636f 6e63 6174 5f63  cessing.concat_c
-00004020: 6861 6e6e 656c 7328 6175 676d 656e 7465  hannels(augmente
-00004030: 645f 696d 6167 6573 5b30 5d5b 695d 2c20  d_images[0][i], 
-00004040: 6175 676d 656e 7465 645f 696d 6167 6573  augmented_images
-00004050: 5b31 5d5b 695d 2929 0a20 2020 2020 2020  [1][i])).       
-00004060: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00004070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004080: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00004090: 6528 6c65 6e28 6175 676d 656e 7465 645f  e(len(augmented_
-000040a0: 696d 6167 6573 5b30 5d29 293a 0a20 2020  images[0])):.   
-000040b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000040c0: 2020 2020 2063 6c61 7373 5f31 2e61 7070       class_1.app
-000040d0: 656e 6428 6461 7461 5f70 726f 6365 7373  end(data_process
-000040e0: 696e 672e 636f 6e63 6174 5f63 6861 6e6e  ing.concat_chann
-000040f0: 656c 7328 6175 676d 656e 7465 645f 696d  els(augmented_im
-00004100: 6167 6573 5b30 5d5b 695d 2c20 6175 676d  ages[0][i], augm
-00004110: 656e 7465 645f 696d 6167 6573 5b31 5d5b  ented_images[1][
-00004120: 695d 2c20 6175 676d 656e 7465 645f 696d  i], augmented_im
-00004130: 6167 6573 5b32 5d5b 695d 2929 0a20 2020  ages[2][i])).   
-00004140: 2020 2020 2020 2020 2020 2020 2063 6c61               cla
-00004150: 7373 5f31 203d 206e 702e 6172 7261 7928  ss_1 = np.array(
-00004160: 636c 6173 735f 3129 0a20 2020 2020 2020  class_1).       
-00004170: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00004180: 2020 2020 2020 2020 2020 2063 6c61 7373             class
-00004190: 5f31 203d 2061 7567 6d65 6e74 6564 5f69  _1 = augmented_i
-000041a0: 6d61 6765 730a 0a20 2020 2020 2020 2020  mages..         
-000041b0: 2020 2023 5065 7266 6f72 6d20 7361 6d65     #Perform same
-000041c0: 2061 7567 6d65 6e74 6174 696f 6e20 7465   augmentation te
-000041d0: 6368 6e69 7175 6573 206f 6e20 6e65 6761  chniques on nega
-000041e0: 7469 7665 2063 6c61 7373 2064 6174 6120  tive class data 
-000041f0: 666f 7220 6261 6c61 6e63 6520 6275 7420  for balance but 
-00004200: 6f6e 6c79 2075 7365 2062 6174 6368 3d31  only use batch=1
-00004210: 0a20 2020 2020 2020 2020 2020 2023 5468  .            #Th
-00004220: 6973 2069 7320 646f 6e65 2073 6f20 7468  is is done so th
-00004230: 6174 2074 6865 2074 7261 696e 696e 6720  at the training 
-00004240: 6461 7461 2061 6c73 6f20 696e 636c 7564  data also includ
-00004250: 6573 2074 6865 2072 616e 646f 6d20 6375  es the random cu
-00004260: 746f 7574 2c20 6966 2063 6f6e 6669 6775  tout, if configu
-00004270: 7265 642e 0a20 2020 2020 2020 2020 2020  red..           
-00004280: 2069 6620 7365 6c66 2e69 6d67 5f6e 756d   if self.img_num
-00004290: 5f63 6861 6e6e 656c 7320 3d3d 2031 3a0a  _channels == 1:.
-000042a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042b0: 6368 616e 6e65 6c31 2c20 6368 616e 6e65  channel1, channe
-000042c0: 6c32 2c20 6368 616e 6e65 6c33 203d 2063  l2, channel3 = c
-000042d0: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
-000042e0: 662e 6e65 6761 7469 7665 5f63 6c61 7373  f.negative_class
-000042f0: 292c 204e 6f6e 652c 204e 6f6e 6520 0a20  ), None, None . 
-00004300: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00004310: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
-00004320: 6e6e 656c 7320 3d3d 2032 3a0a 2020 2020  nnels == 2:.    
-00004330: 2020 2020 2020 2020 2020 2020 6368 616e              chan
-00004340: 6e65 6c31 2c20 6368 616e 6e65 6c32 2c20  nel1, channel2, 
-00004350: 6368 616e 6e65 6c33 203d 2063 6f70 792e  channel3 = copy.
-00004360: 6465 6570 636f 7079 2873 656c 662e 6e65  deepcopy(self.ne
-00004370: 6761 7469 7665 5f63 6c61 7373 5b3a 2c3a  gative_class[:,:
-00004380: 2c3a 2c30 5d29 2c20 636f 7079 2e64 6565  ,:,0]), copy.dee
-00004390: 7063 6f70 7928 7365 6c66 2e6e 6567 6174  pcopy(self.negat
-000043a0: 6976 655f 636c 6173 735b 3a2c 3a2c 3a2c  ive_class[:,:,:,
-000043b0: 315d 292c 204e 6f6e 6520 0a20 2020 2020  1]), None .     
-000043c0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-000043d0: 2e69 6d67 5f6e 756d 5f63 6861 6e6e 656c  .img_num_channel
-000043e0: 7320 3d3d 2033 3a0a 2020 2020 2020 2020  s == 3:.        
-000043f0: 2020 2020 2020 2020 6368 616e 6e65 6c31          channel1
-00004400: 2c20 6368 616e 6e65 6c32 2c20 6368 616e  , channel2, chan
-00004410: 6e65 6c33 203d 2063 6f70 792e 6465 6570  nel3 = copy.deep
-00004420: 636f 7079 2873 656c 662e 6e65 6761 7469  copy(self.negati
-00004430: 7665 5f63 6c61 7373 5b3a 2c3a 2c3a 2c30  ve_class[:,:,:,0
-00004440: 5d29 2c20 636f 7079 2e64 6565 7063 6f70  ]), copy.deepcop
-00004450: 7928 7365 6c66 2e6e 6567 6174 6976 655f  y(self.negative_
-00004460: 636c 6173 735b 3a2c 3a2c 3a2c 315d 292c  class[:,:,:,1]),
-00004470: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
-00004480: 656c 662e 6e65 6761 7469 7665 5f63 6c61  elf.negative_cla
-00004490: 7373 5b3a 2c3a 2c3a 2c32 5d29 0a20 2020  ss[:,:,:,2]).   
-000044a0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-000044b0: 2020 2020 2020 6175 676d 656e 7465 645f        augmented_
-000044c0: 696d 6167 6573 5f6e 6567 6174 6976 6520  images_negative 
-000044d0: 3d20 6175 676d 656e 7461 7469 6f6e 2863  = augmentation(c
-000044e0: 6861 6e6e 656c 313d 6368 616e 6e65 6c31  hannel1=channel1
-000044f0: 2c20 6368 616e 6e65 6c32 3d63 6861 6e6e  , channel2=chann
-00004500: 656c 322c 2063 6861 6e6e 656c 333d 6368  el2, channel3=ch
-00004510: 616e 6e65 6c33 2c20 6261 7463 683d 312c  annel3, batch=1,
-00004520: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00004530: 2020 7769 6474 685f 7368 6966 743d 7365    width_shift=se
-00004540: 6c66 2e73 6869 6674 2c20 6865 6967 6874  lf.shift, height
-00004550: 5f73 6869 6674 3d73 656c 662e 7368 6966  _shift=self.shif
-00004560: 742c 2068 6f72 697a 6f6e 7461 6c3d 686f  t, horizontal=ho
-00004570: 7269 7a6f 6e74 616c 2c20 7665 7274 6963  rizontal, vertic
-00004580: 616c 3d76 6572 7469 6361 6c2c 2072 6f74  al=vertical, rot
-00004590: 6174 696f 6e3d 726f 7461 7469 6f6e 2c20  ation=rotation, 
-000045a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000045b0: 2069 6d61 6765 5f73 697a 653d 696d 6167   image_size=imag
-000045c0: 655f 7369 7a65 2c20 6d61 736b 5f73 697a  e_size, mask_siz
-000045d0: 653d 7365 6c66 2e6d 6173 6b5f 7369 7a65  e=self.mask_size
-000045e0: 2c20 6e75 6d5f 6d61 736b 733d 7365 6c66  , num_masks=self
-000045f0: 2e6e 756d 5f6d 6173 6b73 290a 0a20 2020  .num_masks)..   
-00004600: 2020 2020 2020 2020 2023 5468 6520 6175           #The au
-00004610: 676d 656e 7461 7469 6f6e 2072 6f75 7469  gmentation routi
-00004620: 6e65 2072 6574 7572 6e73 2061 6e20 6f75  ne returns an ou
-00004630: 7470 7574 2066 6f72 2065 6163 6820 6669  tput for each fi
-00004640: 6c74 6572 2c20 652e 672e 2033 206f 7574  lter, e.g. 3 out
-00004650: 7075 7473 2066 6f72 2052 4742 0a20 2020  puts for RGB.   
-00004660: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00004670: 2e69 6d67 5f6e 756d 5f63 6861 6e6e 656c  .img_num_channel
-00004680: 7320 3e20 313a 0a20 2020 2020 2020 2020  s > 1:.         
-00004690: 2020 2020 2020 2063 6c61 7373 5f32 3d5b         class_2=[
-000046a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000046b0: 2020 6966 2073 656c 662e 696d 675f 6e75    if self.img_nu
-000046c0: 6d5f 6368 616e 6e65 6c73 203d 3d20 323a  m_channels == 2:
-000046d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000046e0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-000046f0: 6e67 6528 6c65 6e28 6175 676d 656e 7465  nge(len(augmente
-00004700: 645f 696d 6167 6573 5f6e 6567 6174 6976  d_images_negativ
-00004710: 655b 305d 2929 3a0a 2020 2020 2020 2020  e[0])):.        
-00004720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004730: 636c 6173 735f 322e 6170 7065 6e64 2864  class_2.append(d
-00004740: 6174 615f 7072 6f63 6573 7369 6e67 2e63  ata_processing.c
-00004750: 6f6e 6361 745f 6368 616e 6e65 6c73 2861  oncat_channels(a
-00004760: 7567 6d65 6e74 6564 5f69 6d61 6765 735f  ugmented_images_
-00004770: 6e65 6761 7469 7665 5b30 5d5b 695d 2c20  negative[0][i], 
-00004780: 6175 676d 656e 7465 645f 696d 6167 6573  augmented_images
-00004790: 5f6e 6567 6174 6976 655b 315d 5b69 5d29  _negative[1][i])
-000047a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000047b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000047c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000047d0: 6920 696e 2072 616e 6765 286c 656e 2861  i in range(len(a
-000047e0: 7567 6d65 6e74 6564 5f69 6d61 6765 735f  ugmented_images_
-000047f0: 6e65 6761 7469 7665 5b30 5d29 293a 0a20  negative[0])):. 
-00004800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004810: 2020 2020 2020 2063 6c61 7373 5f32 2e61         class_2.a
-00004820: 7070 656e 6428 6461 7461 5f70 726f 6365  ppend(data_proce
-00004830: 7373 696e 672e 636f 6e63 6174 5f63 6861  ssing.concat_cha
-00004840: 6e6e 656c 7328 6175 676d 656e 7465 645f  nnels(augmented_
-00004850: 696d 6167 6573 5f6e 6567 6174 6976 655b  images_negative[
-00004860: 305d 5b69 5d2c 2061 7567 6d65 6e74 6564  0][i], augmented
-00004870: 5f69 6d61 6765 735f 6e65 6761 7469 7665  _images_negative
-00004880: 5b31 5d5b 695d 2c20 6175 676d 656e 7465  [1][i], augmente
-00004890: 645f 696d 6167 6573 5f6e 6567 6174 6976  d_images_negativ
-000048a0: 655b 325d 5b69 5d29 290a 2020 2020 2020  e[2][i])).      
-000048b0: 2020 2020 2020 2020 2020 636c 6173 735f            class_
-000048c0: 3220 3d20 6e70 2e61 7272 6179 2863 6c61  2 = np.array(cla
-000048d0: 7373 5f32 290a 2020 2020 2020 2020 2020  ss_2).          
-000048e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000048f0: 2020 2020 2020 2020 636c 6173 735f 3220          class_2 
-00004900: 3d20 6175 676d 656e 7465 645f 696d 6167  = augmented_imag
-00004910: 6573 5f6e 6567 6174 6976 650a 0a20 2020  es_negative..   
-00004920: 2020 2020 2020 2020 2023 4261 6c61 6e63           #Balanc
-00004930: 6520 7468 6520 636c 6173 7320 7369 7a65  e the class size
-00004940: 7320 6966 206e 6563 6573 7361 7279 0a20  s if necessary. 
-00004950: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00004960: 6c66 2e62 616c 616e 6365 3a0a 2020 2020  lf.balance:.    
-00004970: 2020 2020 2020 2020 2020 2020 636c 6173              clas
-00004980: 735f 3220 3d20 636c 6173 735f 325b 3a6c  s_2 = class_2[:l
-00004990: 656e 2863 6c61 7373 5f31 295d 0a20 200a  en(class_1)].  .
-000049a0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-000049b0: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
-000049c0: 6e65 6c73 203d 3d20 313a 0a20 2020 2020  nels == 1:.     
-000049d0: 2020 2020 2020 2020 2020 2063 6c61 7373             class
-000049e0: 5f32 203d 2072 6573 697a 6528 636c 6173  _2 = resize(clas
-000049f0: 735f 322c 2073 697a 653d 696d 6167 655f  s_2, size=image_
-00004a00: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
-00004a10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00004a20: 2020 2020 2020 2020 6368 616e 6e65 6c31          channel1
-00004a30: 203d 2072 6573 697a 6528 636c 6173 735f   = resize(class_
-00004a40: 325b 3a2c 3a2c 3a2c 305d 2c20 7369 7a65  2[:,:,:,0], size
-00004a50: 3d69 6d61 6765 5f73 697a 6529 0a20 2020  =image_size).   
-00004a60: 2020 2020 2020 2020 2020 2020 2063 6861               cha
-00004a70: 6e6e 656c 3220 3d20 7265 7369 7a65 2863  nnel2 = resize(c
-00004a80: 6c61 7373 5f32 5b3a 2c3a 2c3a 2c31 5d2c  lass_2[:,:,:,1],
-00004a90: 2073 697a 653d 696d 6167 655f 7369 7a65   size=image_size
-00004aa0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00004ab0: 2020 6966 2073 656c 662e 696d 675f 6e75    if self.img_nu
-00004ac0: 6d5f 6368 616e 6e65 6c73 203d 3d20 323a  m_channels == 2:
-00004ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004ae0: 2020 2020 2063 6c61 7373 5f32 203d 2064       class_2 = d
-00004af0: 6174 615f 7072 6f63 6573 7369 6e67 2e63  ata_processing.c
-00004b00: 6f6e 6361 745f 6368 616e 6e65 6c73 2863  oncat_channels(c
-00004b10: 6861 6e6e 656c 312c 2063 6861 6e6e 656c  hannel1, channel
-00004b20: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
-00004b30: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00004b40: 2020 2020 2020 2020 2020 2020 2063 6861               cha
-00004b50: 6e6e 656c 3320 3d20 7265 7369 7a65 2863  nnel3 = resize(c
-00004b60: 6c61 7373 5f32 5b3a 2c3a 2c3a 2c32 5d2c  lass_2[:,:,:,2],
-00004b70: 2073 697a 653d 696d 6167 655f 7369 7a65   size=image_size
-00004b80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00004b90: 2020 2020 2020 636c 6173 735f 3220 3d20        class_2 = 
-00004ba0: 6461 7461 5f70 726f 6365 7373 696e 672e  data_processing.
-00004bb0: 636f 6e63 6174 5f63 6861 6e6e 656c 7328  concat_channels(
-00004bc0: 6368 616e 6e65 6c31 2c20 6368 616e 6e65  channel1, channe
-00004bd0: 6c32 2c20 6368 616e 6e65 6c33 290a 0a20  l2, channel3).. 
-00004be0: 2020 2020 2020 2020 2020 2023 4e65 6564             #Need
-00004bf0: 2074 6f20 616c 736f 2063 726f 7020 7468   to also crop th
-00004c00: 6520 7661 6c69 6461 7469 6f6e 2069 6d61  e validation ima
-00004c10: 6765 730a 2020 2020 2020 2020 2020 2020  ges.            
-00004c20: 6966 2073 656c 662e 7661 6c5f 706f 7369  if self.val_posi
-00004c30: 7469 7665 2069 7320 6e6f 7420 4e6f 6e65  tive is not None
-00004c40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004c50: 2020 6966 2073 656c 662e 696d 675f 6e75    if self.img_nu
-00004c60: 6d5f 6368 616e 6e65 6c73 203d 3d20 313a  m_channels == 1:
-00004c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004c80: 2020 2020 2076 616c 5f63 6c61 7373 5f31       val_class_1
-00004c90: 203d 2072 6573 697a 6528 7365 6c66 2e76   = resize(self.v
-00004ca0: 616c 5f70 6f73 6974 6976 652c 2073 697a  al_positive, siz
-00004cb0: 653d 696d 6167 655f 7369 7a65 290a 2020  e=image_size).  
-00004cc0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00004cd0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00004ce0: 2020 2020 2020 2020 7661 6c5f 6368 616e          val_chan
-00004cf0: 6e65 6c31 203d 2072 6573 697a 6528 7365  nel1 = resize(se
-00004d00: 6c66 2e76 616c 5f70 6f73 6974 6976 655b  lf.val_positive[
-00004d10: 3a2c 3a2c 3a2c 305d 2c20 7369 7a65 3d69  :,:,:,0], size=i
-00004d20: 6d61 6765 5f73 697a 6529 0a20 2020 2020  mage_size).     
-00004d30: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00004d40: 616c 5f63 6861 6e6e 656c 3220 3d20 7265  al_channel2 = re
-00004d50: 7369 7a65 2873 656c 662e 7661 6c5f 706f  size(self.val_po
-00004d60: 7369 7469 7665 5b3a 2c3a 2c3a 2c31 5d2c  sitive[:,:,:,1],
-00004d70: 2073 697a 653d 696d 6167 655f 7369 7a65   size=image_size
-00004d80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00004d90: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
-00004da0: 675f 6e75 6d5f 6368 616e 6e65 6c73 203d  g_num_channels =
-00004db0: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-00004dc0: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00004dd0: 5f63 6c61 7373 5f31 203d 2064 6174 615f  _class_1 = data_
-00004de0: 7072 6f63 6573 7369 6e67 2e63 6f6e 6361  processing.conca
-00004df0: 745f 6368 616e 6e65 6c73 2876 616c 5f63  t_channels(val_c
-00004e00: 6861 6e6e 656c 312c 2076 616c 5f63 6861  hannel1, val_cha
-00004e10: 6e6e 656c 3229 0a20 2020 2020 2020 2020  nnel2).         
-00004e20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00004e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004e40: 2020 2020 2020 2020 2076 616c 5f63 6861           val_cha
-00004e50: 6e6e 656c 3320 3d20 7265 7369 7a65 2873  nnel3 = resize(s
-00004e60: 656c 662e 7661 6c5f 706f 7369 7469 7665  elf.val_positive
-00004e70: 5b3a 2c3a 2c3a 2c32 5d2c 2073 697a 653d  [:,:,:,2], size=
-00004e80: 696d 6167 655f 7369 7a65 290a 2020 2020  image_size).    
-00004e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ea0: 2020 2020 7661 6c5f 636c 6173 735f 3120      val_class_1 
-00004eb0: 3d20 6461 7461 5f70 726f 6365 7373 696e  = data_processin
-00004ec0: 672e 636f 6e63 6174 5f63 6861 6e6e 656c  g.concat_channel
-00004ed0: 7328 7661 6c5f 6368 616e 6e65 6c31 2c20  s(val_channel1, 
-00004ee0: 7661 6c5f 6368 616e 6e65 6c32 2c20 7661  val_channel2, va
-00004ef0: 6c5f 6368 616e 6e65 6c33 290a 2020 2020  l_channel3).    
-00004f00: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00004f10: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00004f20: 6c5f 636c 6173 735f 3120 3d20 4e6f 6e65  l_class_1 = None
-00004f30: 200a 0a20 2020 2020 2020 2020 2020 2069   ..            i
-00004f40: 6620 7365 6c66 2e76 616c 5f6e 6567 6174  f self.val_negat
-00004f50: 6976 6520 6973 206e 6f74 204e 6f6e 653a  ive is not None:
-00004f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004f70: 2069 6620 7365 6c66 2e69 6d67 5f6e 756d   if self.img_num
-00004f80: 5f63 6861 6e6e 656c 7320 3d3d 2031 3a0a  _channels == 1:.
-00004f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004fa0: 2020 2020 7661 6c5f 636c 6173 735f 3220      val_class_2 
-00004fb0: 3d20 7265 7369 7a65 2873 656c 662e 7661  = resize(self.va
-00004fc0: 6c5f 6e65 6761 7469 7665 2c20 7369 7a65  l_negative, size
-00004fd0: 3d69 6d61 6765 5f73 697a 6529 0a20 2020  =image_size).   
-00004fe0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00004ff0: 6620 7365 6c66 2e69 6d67 5f6e 756d 5f63  f self.img_num_c
-00005000: 6861 6e6e 656c 7320 3e20 313a 0a20 2020  hannels > 1:.   
-00005010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005020: 2076 616c 5f63 6861 6e6e 656c 3120 3d20   val_channel1 = 
-00005030: 7265 7369 7a65 2873 656c 662e 7661 6c5f  resize(self.val_
-00005040: 6e65 6761 7469 7665 5b3a 2c3a 2c3a 2c30  negative[:,:,:,0
-00005050: 5d2c 2073 697a 653d 696d 6167 655f 7369  ], size=image_si
-00005060: 7a65 290a 2020 2020 2020 2020 2020 2020  ze).            
-00005070: 2020 2020 2020 2020 7661 6c5f 6368 616e          val_chan
-00005080: 6e65 6c32 203d 2072 6573 697a 6528 7365  nel2 = resize(se
-00005090: 6c66 2e76 616c 5f6e 6567 6174 6976 655b  lf.val_negative[
-000050a0: 3a2c 3a2c 3a2c 315d 2c20 7369 7a65 3d69  :,:,:,1], size=i
-000050b0: 6d61 6765 5f73 697a 6529 0a20 2020 2020  mage_size).     
-000050c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000050d0: 6620 7365 6c66 2e69 6d67 5f6e 756d 5f63  f self.img_num_c
-000050e0: 6861 6e6e 656c 7320 3d3d 2032 3a0a 2020  hannels == 2:.  
-000050f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005100: 2020 2020 2020 7661 6c5f 636c 6173 735f        val_class_
-00005110: 3220 3d20 6461 7461 5f70 726f 6365 7373  2 = data_process
-00005120: 696e 672e 636f 6e63 6174 5f63 6861 6e6e  ing.concat_chann
-00005130: 656c 7328 7661 6c5f 6368 616e 6e65 6c31  els(val_channel1
-00005140: 2c20 7661 6c5f 6368 616e 6e65 6c32 290a  , val_channel2).
-00005150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005160: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00005170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005180: 2020 7661 6c5f 6368 616e 6e65 6c33 203d    val_channel3 =
-00005190: 2072 6573 697a 6528 7365 6c66 2e76 616c   resize(self.val
-000051a0: 5f6e 6567 6174 6976 655b 3a2c 3a2c 3a2c  _negative[:,:,:,
-000051b0: 325d 2c20 7369 7a65 3d69 6d61 6765 5f73  2], size=image_s
-000051c0: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
-000051d0: 2020 2020 2020 2020 2020 2020 2076 616c               val
-000051e0: 5f63 6c61 7373 5f32 203d 2064 6174 615f  _class_2 = data_
-000051f0: 7072 6f63 6573 7369 6e67 2e63 6f6e 6361  processing.conca
-00005200: 745f 6368 616e 6e65 6c73 2876 616c 5f63  t_channels(val_c
-00005210: 6861 6e6e 656c 312c 2076 616c 5f63 6861  hannel1, val_cha
-00005220: 6e6e 656c 322c 2076 616c 5f63 6861 6e6e  nnel2, val_chann
-00005230: 656c 3329 0a20 2020 2020 2020 2020 2020  el3).           
-00005240: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00005250: 2020 2020 2020 2076 616c 5f63 6c61 7373         val_class
-00005260: 5f32 203d 204e 6f6e 6520 0a0a 2020 2020  _2 = None ..    
-00005270: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00005280: 2020 2020 2020 636c 6173 735f 312c 2063        class_1, c
-00005290: 6c61 7373 5f32 203d 2073 656c 662e 706f  lass_2 = self.po
-000052a0: 7369 7469 7665 5f63 6c61 7373 2c20 7365  sitive_class, se
-000052b0: 6c66 2e6e 6567 6174 6976 655f 636c 6173  lf.negative_clas
-000052c0: 730a 2020 2020 2020 2020 2020 2020 7661  s.            va
-000052d0: 6c5f 636c 6173 735f 312c 2076 616c 5f63  l_class_1, val_c
-000052e0: 6c61 7373 5f32 203d 2073 656c 662e 7661  lass_2 = self.va
-000052f0: 6c5f 706f 7369 7469 7665 2c20 7365 6c66  l_positive, self
-00005300: 2e76 616c 5f6e 6567 6174 6976 650a 0a20  .val_negative.. 
-00005310: 2020 2020 2020 2023 2323 204f 7074 696d         ### Optim
-00005320: 697a 6520 7468 6520 6d61 7820 7069 7865  ize the max pixe
-00005330: 6c20 746f 2075 7365 2066 6f72 2074 6865  l to use for the
-00005340: 206d 696e 2d6d 6178 206e 6f72 6d61 6c69   min-max normali
-00005350: 7a61 7469 6f6e 202d 2d20 7065 7220 6261  zation -- per ba
-00005360: 6e64 2023 2323 0a20 2020 2020 2020 2069  nd ###.        i
-00005370: 6620 7365 6c66 2e6f 7074 5f6d 6178 5f6d  f self.opt_max_m
-00005380: 696e 5f70 6978 2069 7320 6e6f 7420 4e6f  in_pix is not No
-00005390: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000053a0: 7365 6c66 2e6e 6f72 6d61 6c69 7a65 203d  self.normalize =
-000053b0: 2054 7275 6520 234a 7573 7420 696e 2063   True #Just in c
-000053c0: 6173 6520 6974 2773 2073 6574 2074 6f20  ase it's set to 
-000053d0: 4661 6c73 6520 6279 2074 6865 2075 7365  False by the use
-000053e0: 7220 0a20 2020 2020 2020 2020 2020 206d  r .            m
-000053f0: 696e 5f70 6978 2c20 6d61 785f 7069 7820  in_pix, max_pix 
-00005400: 3d20 302e 302c 205b 5d0a 2020 2020 2020  = 0.0, [].      
-00005410: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
-00005420: 675f 6e75 6d5f 6368 616e 6e65 6c73 203e  g_num_channels >
-00005430: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-00005440: 2020 2020 206d 6178 5f70 6978 5f31 203d       max_pix_1 =
-00005450: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
-00005460: 6e74 2827 6d61 785f 7069 7865 6c5f 3127  nt('max_pixel_1'
-00005470: 2c20 7365 6c66 2e6f 7074 5f6d 6178 5f6d  , self.opt_max_m
-00005480: 696e 5f70 6978 2c20 7365 6c66 2e6f 7074  in_pix, self.opt
-00005490: 5f6d 6178 5f6d 6178 5f70 6978 2c20 7374  _max_max_pix, st
-000054a0: 6570 3d31 290a 2020 2020 2020 2020 2020  ep=1).          
-000054b0: 2020 2020 2020 6d61 785f 7069 782e 6170        max_pix.ap
-000054c0: 7065 6e64 286d 6178 5f70 6978 5f31 290a  pend(max_pix_1).
-000054d0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-000054e0: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
-000054f0: 6e65 6c73 203e 3d20 323a 0a20 2020 2020  nels >= 2:.     
-00005500: 2020 2020 2020 2020 2020 206d 6178 5f70             max_p
-00005510: 6978 5f32 203d 2074 7269 616c 2e73 7567  ix_2 = trial.sug
-00005520: 6765 7374 5f69 6e74 2827 6d61 785f 7069  gest_int('max_pi
-00005530: 7865 6c5f 3227 2c20 7365 6c66 2e6f 7074  xel_2', self.opt
-00005540: 5f6d 6178 5f6d 696e 5f70 6978 2c20 7365  _max_min_pix, se
-00005550: 6c66 2e6f 7074 5f6d 6178 5f6d 6178 5f70  lf.opt_max_max_p
-00005560: 6978 2c20 7374 6570 3d31 290a 2020 2020  ix, step=1).    
-00005570: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
-00005580: 7069 782e 6170 7065 6e64 286d 6178 5f70  pix.append(max_p
-00005590: 6978 5f32 290a 2020 2020 2020 2020 2020  ix_2).          
-000055a0: 2020 6966 2073 656c 662e 696d 675f 6e75    if self.img_nu
-000055b0: 6d5f 6368 616e 6e65 6c73 203d 3d20 333a  m_channels == 3:
-000055c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000055d0: 206d 6178 5f70 6978 5f33 203d 2074 7269   max_pix_3 = tri
-000055e0: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
-000055f0: 6d61 785f 7069 7865 6c5f 3327 2c20 7365  max_pixel_3', se
-00005600: 6c66 2e6f 7074 5f6d 6178 5f6d 696e 5f70  lf.opt_max_min_p
-00005610: 6978 2c20 7365 6c66 2e6f 7074 5f6d 6178  ix, self.opt_max
-00005620: 5f6d 6178 5f70 6978 2c20 7374 6570 3d31  _max_pix, step=1
-00005630: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00005640: 2020 6d61 785f 7069 782e 6170 7065 6e64    max_pix.append
-00005650: 286d 6178 5f70 6978 5f33 290a 2020 2020  (max_pix_3).    
-00005660: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-00005670: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
-00005680: 6c73 203e 2033 3a0a 2020 2020 2020 2020  ls > 3:.        
-00005690: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-000056a0: 6c75 6545 7272 6f72 2827 4f6e 6c79 2075  lueError('Only u
-000056b0: 7020 746f 2074 6872 6565 2063 6861 6e6e  p to three chann
-000056c0: 656c 7320 6172 6520 6375 7272 656e 746c  els are currentl
-000056d0: 7920 7375 7070 6f72 7465 6421 2729 0a20  y supported!'). 
-000056e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000056f0: 2020 2020 2020 2020 206d 696e 5f70 6978           min_pix
-00005700: 2c20 6d61 785f 7069 7820 3d20 7365 6c66  , max_pix = self
-00005710: 2e6d 696e 5f70 6978 656c 2c20 7365 6c66  .min_pixel, self
-00005720: 2e6d 6178 5f70 6978 656c 0a0a 2020 2020  .max_pixel..    
-00005730: 2020 2020 2323 2320 4561 726c 7920 5374      ### Early St
-00005740: 6f70 7069 6e67 2061 6e64 2050 7275 6e69  opping and Pruni
-00005750: 6e67 2043 616c 6c62 6163 6b73 2023 2323  ng Callbacks ###
-00005760: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00005770: 2e70 6174 6965 6e63 6520 213d 2030 3a0a  .patience != 0:.
-00005780: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00005790: 656c 662e 6d65 7472 6963 203d 3d20 2761  elf.metric == 'a
-000057a0: 6c6c 2720 6f72 2073 656c 662e 6d65 7472  ll' or self.metr
-000057b0: 6963 203d 3d20 2776 616c 5f61 6c6c 273a  ic == 'val_all':
-000057c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000057d0: 2070 7269 6e74 2827 4361 6e6e 6f74 2075   print('Cannot u
-000057e0: 7365 2063 616c 6c62 6163 6b73 2069 6620  se callbacks if 
-000057f0: 6176 6572 6167 696e 6720 6f75 7420 616c  averaging out al
-00005800: 6c20 7065 7266 6f72 6d61 6e63 6520 6d65  l performance me
-00005810: 7472 6963 7320 666f 7220 6576 616c 7561  trics for evalua
-00005820: 7469 6f6e 2c20 7365 7474 696e 6720 7061  tion, setting pa
-00005830: 7469 656e 6365 3d30 2e27 290a 2020 2020  tience=0.').    
-00005840: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-00005850: 6261 636b 7320 3d20 5b5d 2354 464b 6572  backs = []#TFKer
-00005860: 6173 5072 756e 696e 6743 616c 6c62 6163  asPruningCallbac
-00005870: 6b28 7472 6961 6c2c 206d 6f6e 6974 6f72  k(trial, monitor
-00005880: 3d73 656c 662e 6d65 7472 6963 292c 5d0a  =self.metric),].
-00005890: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000058a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000058b0: 2020 6966 2073 656c 662e 7472 6169 6e5f    if self.train_
-000058c0: 6163 635f 7468 7265 7368 6f6c 6420 6973  acc_threshold is
-000058d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000058e0: 2020 2020 2020 2020 2020 2063 616c 6c62             callb
-000058f0: 6163 6b73 203d 205b 0a20 2020 2020 2020  acks = [.       
-00005900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005910: 2045 6172 6c79 5374 6f70 7069 6e67 286d   EarlyStopping(m
-00005920: 6f6e 6974 6f72 3d73 656c 662e 6d65 7472  onitor=self.metr
-00005930: 6963 2c20 6d6f 6465 3d6d 6f64 652c 2070  ic, mode=mode, p
-00005940: 6174 6965 6e63 653d 7365 6c66 2e70 6174  atience=self.pat
-00005950: 6965 6e63 6529 2c0a 2020 2020 2020 2020  ience),.        
-00005960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005970: 2354 464b 6572 6173 5072 756e 696e 6743  #TFKerasPruningC
-00005980: 616c 6c62 6163 6b28 7472 6961 6c2c 206d  allback(trial, m
-00005990: 6f6e 6974 6f72 3d73 656c 662e 6d65 7472  onitor=self.metr
-000059a0: 6963 292c 0a20 2020 2020 2020 2020 2020  ic),.           
-000059b0: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
-000059c0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000059d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000059e0: 2020 2020 2020 2020 2063 616c 6c62 6163           callbac
-000059f0: 6b73 203d 205b 0a20 2020 2020 2020 2020  ks = [.         
-00005a00: 2020 2020 2020 2020 2020 2020 2020 2045                 E
-00005a10: 6172 6c79 5374 6f70 7069 6e67 286d 6f6e  arlyStopping(mon
-00005a20: 6974 6f72 3d27 6269 6e61 7279 5f61 6363  itor='binary_acc
-00005a30: 7572 6163 7927 2c20 6d6f 6465 3d27 6d61  uracy', mode='ma
-00005a40: 7827 2c20 7061 7469 656e 6365 3d30 2c20  x', patience=0, 
-00005a50: 6261 7365 6c69 6e65 3d73 656c 662e 7472  baseline=self.tr
-00005a60: 6169 6e5f 6163 635f 7468 7265 7368 6f6c  ain_acc_threshol
-00005a70: 6429 2c0a 2020 2020 2020 2020 2020 2020  d),.            
-00005a80: 2020 2020 2020 2020 2020 2020 4561 726c              Earl
-00005a90: 7953 746f 7070 696e 6728 6d6f 6e69 746f  yStopping(monito
-00005aa0: 723d 7365 6c66 2e6d 6574 7269 632c 206d  r=self.metric, m
-00005ab0: 6f64 653d 6d6f 6465 2c20 7061 7469 656e  ode=mode, patien
-00005ac0: 6365 3d73 656c 662e 7061 7469 656e 6365  ce=self.patience
-00005ad0: 292c 200a 2020 2020 2020 2020 2020 2020  ), .            
-00005ae0: 2020 2020 2020 2020 2020 2020 2354 464b              #TFK
-00005af0: 6572 6173 5072 756e 696e 6743 616c 6c62  erasPruningCallb
-00005b00: 6163 6b28 7472 6961 6c2c 206d 6f6e 6974  ack(trial, monit
-00005b10: 6f72 3d73 656c 662e 6d65 7472 6963 292c  or=self.metric),
-00005b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005b30: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-00005b40: 2020 2020 2020 2069 6620 7365 6c66 2e6d         if self.m
-00005b50: 6f6e 6974 6f72 3120 6973 206e 6f74 204e  onitor1 is not N
-00005b60: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00005b70: 2020 2020 2063 616c 6c62 6163 6b73 2e61       callbacks.a
-00005b80: 7070 656e 6428 4d6f 6e69 746f 725f 5472  ppend(Monitor_Tr
-00005b90: 6163 6b65 7228 6d6f 6e69 746f 7231 3d73  acker(monitor1=s
-00005ba0: 656c 662e 6d6f 6e69 746f 7231 2c20 6d6f  elf.monitor1, mo
-00005bb0: 6e69 746f 7232 3d73 656c 662e 6d6f 6e69  nitor2=self.moni
-00005bc0: 746f 7232 2c20 6d6f 6e69 746f 7231 5f74  tor2, monitor1_t
-00005bd0: 6872 6573 683d 7365 6c66 2e6d 6f6e 6974  hresh=self.monit
-00005be0: 6f72 315f 7468 7265 7368 2c20 6d6f 6e69  or1_thresh, moni
-00005bf0: 746f 7232 5f74 6872 6573 683d 7365 6c66  tor2_thresh=self
-00005c00: 2e6d 6f6e 6974 6f72 325f 7468 7265 7368  .monitor2_thresh
-00005c10: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
-00005c20: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
-00005c30: 6c62 6163 6b73 203d 204e 6f6e 650a 0a20  lbacks = None.. 
-00005c40: 2020 2020 2020 2023 2323 2023 2323 2023         ### ### #
-00005c50: 2323 2023 2323 2023 2323 2023 2323 2023  ## ### ### ### #
-00005c60: 2323 2023 2323 2023 2323 200a 2020 2020  ## ### ### .    
-00005c70: 2020 2020 2323 204f 7074 696d 697a 6520      ## Optimize 
-00005c80: 434e 4e20 2d2d 2041 6c65 784e 6574 206f  CNN -- AlexNet o
-00005c90: 6e6c 7921 2023 230a 2020 2020 2020 2020  nly! ##.        
-00005ca0: 2323 2320 2323 2320 2323 2320 2323 2320  ### ### ### ### 
-00005cb0: 2323 2320 2323 2320 2323 2320 2323 2320  ### ### ### ### 
-00005cc0: 2323 2320 0a0a 2020 2020 2020 2020 2323  ### ..        ##
-00005cd0: 2320 4261 7463 6820 5369 7a65 2c20 4c65  # Batch Size, Le
-00005ce0: 6172 6e69 6e67 2052 6174 6520 2620 4f70  arning Rate & Op
-00005cf0: 7469 6d69 7a65 7220 2323 230a 2020 2020  timizer ###.    
-00005d00: 2020 2020 6261 7463 685f 7369 7a65 203d      batch_size =
-00005d10: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
-00005d20: 6e74 2827 6261 7463 685f 7369 7a65 272c  nt('batch_size',
-00005d30: 2073 656c 662e 6261 7463 685f 7369 7a65   self.batch_size
-00005d40: 5f6d 696e 2c20 7365 6c66 2e62 6174 6368  _min, self.batch
-00005d50: 5f73 697a 655f 6d61 782c 2073 7465 703d  _size_max, step=
-00005d60: 3129 0a20 2020 2020 2020 206c 7220 3d20  1).        lr = 
-00005d70: 7472 6961 6c2e 7375 6767 6573 745f 666c  trial.suggest_fl
-00005d80: 6f61 7428 276c 7227 2c20 3165 2d36 2c20  oat('lr', 1e-6, 
-00005d90: 3165 2d33 2c20 7374 6570 3d31 652d 3429  1e-3, step=1e-4)
-00005da0: 200a 2020 2020 2020 2020 6f70 7469 6d69   .        optimi
-00005db0: 7a65 7220 3d20 7472 6961 6c2e 7375 6767  zer = trial.sugg
-00005dc0: 6573 745f 6361 7465 676f 7269 6361 6c28  est_categorical(
-00005dd0: 276f 7074 696d 697a 6572 272c 205b 2761  'optimizer', ['a
-00005de0: 6461 6d27 2c20 2773 6764 272c 2027 726d  dam', 'sgd', 'rm
-00005df0: 7370 726f 7027 2c20 2761 6461 6772 6164  sprop', 'adagrad
-00005e00: 275d 2920 0a0a 2020 2020 2020 2020 2341  ']) ..        #A
-00005e10: 6461 6d20 616e 6420 4164 6167 7261 6420  dam and Adagrad 
-00005e20: 646f 6e27 7420 6e65 6564 2064 6563 6179  don't need decay
-00005e30: 206e 6f72 206d 6f6d 656e 7475 6d0a 2020   nor momentum.  
-00005e40: 2020 2020 2020 6966 206f 7074 696d 697a        if optimiz
-00005e50: 6572 2021 3d20 2761 6461 6d27 2061 6e64  er != 'adam' and
-00005e60: 206f 7074 696d 697a 6572 2021 3d20 2761   optimizer != 'a
-00005e70: 6461 6772 6164 273a 0a20 2020 2020 2020  dagrad':.       
-00005e80: 2020 2020 2064 6563 6179 203d 2074 7269       decay = tri
-00005e90: 616c 2e73 7567 6765 7374 5f66 6c6f 6174  al.suggest_float
-00005ea0: 2827 6465 6361 7927 2c20 302e 302c 2030  ('decay', 0.0, 0
-00005eb0: 2e31 2c20 7374 6570 3d31 652d 3329 0a20  .1, step=1e-3). 
-00005ec0: 2020 2020 2020 2020 2020 2069 6620 6f70             if op
-00005ed0: 7469 6d69 7a65 7220 3d3d 2027 7367 6427  timizer == 'sgd'
-00005ee0: 3a20 234f 6e6c 7920 5347 4420 7265 7175  : #Only SGD requ
-00005ef0: 6972 6573 206d 6f6d 656e 7475 6d20 616e  ires momentum an
-00005f00: 6420 6e65 7374 6572 6f76 2c20 726d 7370  d nesterov, rmsp
-00005f10: 726f 7020 6f6e 6c79 206e 6565 6473 206c  rop only needs l
-00005f20: 7220 2620 6465 6361 790a 2020 2020 2020  r & decay.      
-00005f30: 2020 2020 2020 2020 2020 6d6f 6d65 6e74            moment
-00005f40: 756d 203d 2074 7269 616c 2e73 7567 6765  um = trial.sugge
-00005f50: 7374 5f66 6c6f 6174 2827 6d6f 6d65 6e74  st_float('moment
-00005f60: 756d 272c 2030 2e30 2c20 312e 302c 2073  um', 0.0, 1.0, s
-00005f70: 7465 703d 302e 3031 290a 2020 2020 2020  tep=0.01).      
-00005f80: 2020 2020 2020 2020 2020 6e65 7374 6572            nester
-00005f90: 6f76 203d 2074 7269 616c 2e73 7567 6765  ov = trial.sugge
-00005fa0: 7374 5f63 6174 6567 6f72 6963 616c 2827  st_categorical('
-00005fb0: 6e65 7374 6572 6f76 272c 205b 5472 7565  nesterov', [True
-00005fc0: 2c20 4661 6c73 655d 290a 2020 2020 2020  , False]).      
-00005fd0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00005fe0: 2020 2020 2020 2020 2020 2020 6d6f 6d65              mome
-00005ff0: 6e74 756d 2c20 6e65 7374 6572 6f76 203d  ntum, nesterov =
-00006000: 2030 2e30 2c20 4661 6c73 650a 2020 2020   0.0, False.    
-00006010: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00006020: 2020 2020 2020 6465 6361 792c 206d 6f6d        decay, mom
-00006030: 656e 7475 6d2c 206e 6573 7465 726f 7620  entum, nesterov 
-00006040: 3d20 302e 302c 2030 2e30 2c20 4661 6c73  = 0.0, 0.0, Fals
-00006050: 650a 0a20 2020 2020 2020 2063 6c65 6172  e..        clear
-00006060: 5f73 6573 7369 6f6e 2829 0a20 2020 2020  _session().     
-00006070: 2020 2069 6620 7365 6c66 2e6f 7074 5f6d     if self.opt_m
-00006080: 6f64 656c 3a0a 2020 2020 2020 2020 2020  odel:.          
-00006090: 2020 2222 2241 6c65 784e 6574 2048 7970    """AlexNet Hyp
-000060a0: 6572 7061 7261 6d65 7465 7220 5365 6172  erparameter Sear
-000060b0: 6368 2053 7061 6365 2222 220a 0a20 2020  ch Space"""..   
-000060c0: 2020 2020 2020 2020 2023 2323 2052 6567           ### Reg
-000060d0: 756c 6172 697a 6174 696f 6e20 5465 6368  ularization Tech
-000060e0: 6e69 7175 6520 2842 4e20 6973 206e 6577  nique (BN is new
-000060f0: 6572 2920 2323 230a 2020 2020 2020 2020  er) ###.        
-00006100: 2020 2020 6d6f 6465 6c5f 7265 6720 3d20      model_reg = 
-00006110: 7472 6961 6c2e 7375 6767 6573 745f 6361  trial.suggest_ca
-00006120: 7465 676f 7269 6361 6c28 276d 6f64 656c  tegorical('model
-00006130: 5f72 6567 272c 205b 276c 6f63 616c 5f72  _reg', ['local_r
-00006140: 6573 706f 6e73 6527 2c20 2762 6174 6368  esponse', 'batch
-00006150: 5f6e 6f72 6d27 5d29 0a0a 2020 2020 2020  _norm'])..      
-00006160: 2020 2020 2020 2323 2320 4163 7469 7661        ### Activa
-00006170: 7469 6f6e 2061 6e64 204c 6f73 7320 4675  tion and Loss Fu
-00006180: 6e63 7469 6f6e 7320 2323 2320 0a20 2020  nctions ### .   
-00006190: 2020 2020 2020 2020 2061 6374 6976 6174           activat
-000061a0: 696f 6e5f 636f 6e76 203d 2074 7269 616c  ion_conv = trial
-000061b0: 2e73 7567 6765 7374 5f63 6174 6567 6f72  .suggest_categor
-000061c0: 6963 616c 2827 6163 7469 7661 7469 6f6e  ical('activation
-000061d0: 5f63 6f6e 7627 2c20 5b27 7265 6c75 272c  _conv', ['relu',
-000061e0: 2020 2773 6967 6d6f 6964 272c 2027 7461    'sigmoid', 'ta
-000061f0: 6e68 272c 2027 656c 7527 2c20 2773 656c  nh', 'elu', 'sel
-00006200: 7527 5d29 2020 2020 2020 2020 2020 2020  u'])            
-00006210: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
-00006220: 6976 6174 696f 6e5f 6465 6e73 6520 3d20  ivation_dense = 
-00006230: 7472 6961 6c2e 7375 6767 6573 745f 6361  trial.suggest_ca
-00006240: 7465 676f 7269 6361 6c28 2761 6374 6976  tegorical('activ
-00006250: 6174 696f 6e5f 6465 6e73 6527 2c20 5b27  ation_dense', ['
-00006260: 7265 6c75 272c 2027 7369 676d 6f69 6427  relu', 'sigmoid'
-00006270: 2c20 2774 616e 6827 2c20 2765 6c75 272c  , 'tanh', 'elu',
-00006280: 2027 7365 6c75 275d 290a 2020 2020 2020   'selu']).      
-00006290: 2020 2020 2020 6c6f 7373 203d 2074 7269        loss = tri
-000062a0: 616c 2e73 7567 6765 7374 5f63 6174 6567  al.suggest_categ
-000062b0: 6f72 6963 616c 2827 6c6f 7373 272c 205b  orical('loss', [
-000062c0: 2762 696e 6172 795f 6372 6f73 7365 6e74  'binary_crossent
-000062d0: 726f 7079 272c 2027 6869 6e67 6527 2c20  ropy', 'hinge', 
-000062e0: 2773 7175 6172 6564 5f68 696e 6765 272c  'squared_hinge',
-000062f0: 2027 6b6c 6427 2c20 276c 6f67 636f 7368   'kld', 'logcosh
-00006300: 275d 2923 2c20 2766 6f63 616c 5f6c 6f73  '])#, 'focal_los
-00006310: 7327 2c20 2764 6963 655f 6c6f 7373 272c  s', 'dice_loss',
-00006320: 2027 6a61 6363 6172 645f 6c6f 7373 275d   'jaccard_loss']
-00006330: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00006340: 2323 204b 6572 6e65 6c20 496e 6974 6961  ## Kernel Initia
-00006350: 6c69 7a65 7273 2023 2323 0a20 2020 2020  lizers ###.     
-00006360: 2020 2020 2020 2063 6f6e 765f 696e 6974         conv_init
-00006370: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
-00006380: 5f63 6174 6567 6f72 6963 616c 2827 636f  _categorical('co
-00006390: 6e76 5f69 6e69 7427 2c20 5b27 756e 6966  nv_init', ['unif
-000063a0: 6f72 6d5f 7363 616c 696e 6727 2c20 2754  orm_scaling', 'T
-000063b0: 7275 6e63 6174 6564 4e6f 726d 616c 272c  runcatedNormal',
-000063c0: 2027 6865 5f6e 6f72 6d61 6c27 2c20 276c   'he_normal', 'l
-000063d0: 6563 756e 5f75 6e69 666f 726d 272c 2027  ecun_uniform', '
-000063e0: 676c 6f72 6f74 5f75 6e69 666f 726d 275d  glorot_uniform']
-000063f0: 2920 0a20 2020 2020 2020 2020 2020 2064  ) .            d
-00006400: 656e 7365 5f69 6e69 7420 3d20 7472 6961  ense_init = tria
-00006410: 6c2e 7375 6767 6573 745f 6361 7465 676f  l.suggest_catego
-00006420: 7269 6361 6c28 2764 656e 7365 5f69 6e69  rical('dense_ini
-00006430: 7427 2c20 5b27 756e 6966 6f72 6d5f 7363  t', ['uniform_sc
-00006440: 616c 696e 6727 2c20 2754 7275 6e63 6174  aling', 'Truncat
-00006450: 6564 4e6f 726d 616c 272c 2768 655f 6e6f  edNormal','he_no
-00006460: 726d 616c 272c 2027 6c65 6375 6e5f 756e  rmal', 'lecun_un
-00006470: 6966 6f72 6d27 2c20 2767 6c6f 726f 745f  iform', 'glorot_
-00006480: 756e 6966 6f72 6d27 5d29 200a 0a20 2020  uniform']) ..   
-00006490: 2020 2020 2020 2020 2023 2323 2054 7261           ### Tra
-000064a0: 696e 2074 6865 204d 6f64 656c 2023 2323  in the Model ###
-000064b0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-000064c0: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
-000064d0: 2069 6620 7365 6c66 2e76 6572 626f 7365   if self.verbose
-000064e0: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-000064f0: 2020 2020 2020 2069 6620 7365 6c66 2e6f         if self.o
-00006500: 7074 5f63 7620 6973 206e 6f74 204e 6f6e  pt_cv is not Non
-00006510: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00006520: 2020 2020 2020 2070 7269 6e74 2829 0a20         print(). 
-00006530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006540: 2020 2070 7269 6e74 2827 2a2a 2a2a 2a2a     print('******
-00006550: 2a2a 2a2a 2a20 2043 5620 2d20 3120 2a2a  *****  CV - 1 **
-00006560: 2a2a 2a2a 2a2a 2a2a 2a27 290a 2020 2020  *********').    
-00006570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006580: 7072 696e 7428 290a 2020 2020 2020 2020  print().        
-00006590: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000065a0: 6f70 745f 6175 673a 0a20 2020 2020 2020  opt_aug:.       
-000065b0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-000065c0: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
-000065d0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-000065e0: 3d3d 3d3d 3d3d 3d20 496d 6167 6520 5061  ======= Image Pa
-000065f0: 7261 6d65 7465 7273 203d 3d3d 3d3d 3d27  rameters ======'
-00006600: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00006610: 2020 2020 2020 7072 696e 7428 290a 2020        print().  
-00006620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006630: 2020 7072 696e 7428 274e 756d 2041 7567    print('Num Aug
-00006640: 6d65 6e74 6174 696f 6e73 203a 272c 206e  mentations :', n
-00006650: 756d 5f61 7567 290a 2020 2020 2020 2020  um_aug).        
-00006660: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00006670: 7428 2749 6d61 6765 2053 697a 6520 3a20  t('Image Size : 
-00006680: 272c 2069 6d61 6765 5f73 697a 6529 0a20  ', image_size). 
-00006690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000066a0: 2020 2070 7269 6e74 2827 4d61 7820 5069     print('Max Pi
-000066b0: 7865 6c28 7329 203a 272c 206d 6178 5f70  xel(s) :', max_p
-000066c0: 6978 290a 0a20 2020 2020 2020 2020 2020  ix)..           
-000066d0: 2023 2323 2050 6f6f 6c69 6e67 2054 7970   ### Pooling Typ
-000066e0: 6520 2323 230a 2020 2020 2020 2020 2020  e ###.          
-000066f0: 2020 6966 2073 656c 662e 6c69 6d69 745f    if self.limit_
-00006700: 7365 6172 6368 3a0a 2020 2020 2020 2020  search:.        
-00006710: 2020 2020 2020 2020 706f 6f6c 696e 675f          pooling_
-00006720: 3120 3d20 7472 6961 6c2e 7375 6767 6573  1 = trial.sugges
-00006730: 745f 6361 7465 676f 7269 6361 6c28 2770  t_categorical('p
-00006740: 6f6f 6c69 6e67 5f31 272c 205b 276d 696e  ooling_1', ['min
-00006750: 272c 2027 6d61 7827 2c20 2761 7665 7261  ', 'max', 'avera
-00006760: 6765 275d 290a 2020 2020 2020 2020 2020  ge']).          
-00006770: 2020 2020 2020 706f 6f6c 696e 675f 3220        pooling_2 
-00006780: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
-00006790: 6361 7465 676f 7269 6361 6c28 2770 6f6f  categorical('poo
-000067a0: 6c69 6e67 5f32 272c 205b 276d 696e 272c  ling_2', ['min',
-000067b0: 2027 6d61 7827 2c20 2761 7665 7261 6765   'max', 'average
-000067c0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-000067d0: 2020 2020 706f 6f6c 696e 675f 3320 3d20      pooling_3 = 
-000067e0: 7472 6961 6c2e 7375 6767 6573 745f 6361  trial.suggest_ca
-000067f0: 7465 676f 7269 6361 6c28 2770 6f6f 6c69  tegorical('pooli
-00006800: 6e67 5f33 272c 205b 276d 696e 272c 2027  ng_3', ['min', '
-00006810: 6d61 7827 2c20 2761 7665 7261 6765 275d  max', 'average']
-00006820: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00006830: 2020 206d 6f64 656c 2c20 6869 7374 6f72     model, histor
-00006840: 7920 3d20 636e 6e5f 6d6f 6465 6c2e 416c  y = cnn_model.Al
-00006850: 6578 4e65 7428 636c 6173 735f 312c 2063  exNet(class_1, c
-00006860: 6c61 7373 5f32 2c20 696d 675f 6e75 6d5f  lass_2, img_num_
-00006870: 6368 616e 6e65 6c73 3d73 656c 662e 696d  channels=self.im
-00006880: 675f 6e75 6d5f 6368 616e 6e65 6c73 2c20  g_num_channels, 
-00006890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000068a0: 2020 2020 206e 6f72 6d61 6c69 7a65 3d73       normalize=s
-000068b0: 656c 662e 6e6f 726d 616c 697a 652c 206d  elf.normalize, m
-000068c0: 696e 5f70 6978 656c 3d6d 696e 5f70 6978  in_pixel=min_pix
-000068d0: 2c20 6d61 785f 7069 7865 6c3d 6d61 785f  , max_pixel=max_
-000068e0: 7069 782c 2076 616c 5f70 6f73 6974 6976  pix, val_positiv
-000068f0: 653d 7661 6c5f 636c 6173 735f 312c 2076  e=val_class_1, v
-00006900: 616c 5f6e 6567 6174 6976 653d 7661 6c5f  al_negative=val_
-00006910: 636c 6173 735f 322c 200a 2020 2020 2020  class_2, .      
-00006920: 2020 2020 2020 2020 2020 2020 2020 6570                ep
-00006930: 6f63 6873 3d73 656c 662e 7472 6169 6e5f  ochs=self.train_
-00006940: 6570 6f63 6873 2c20 6261 7463 685f 7369  epochs, batch_si
-00006950: 7a65 3d62 6174 6368 5f73 697a 652c 206c  ze=batch_size, l
-00006960: 723d 6c72 2c20 6d6f 6d65 6e74 756d 3d6d  r=lr, momentum=m
-00006970: 6f6d 656e 7475 6d2c 2064 6563 6179 3d64  omentum, decay=d
-00006980: 6563 6179 2c20 6e65 7374 6572 6f76 3d6e  ecay, nesterov=n
-00006990: 6573 7465 726f 762c 200a 2020 2020 2020  esterov, .      
-000069a0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-000069b0: 7373 3d6c 6f73 732c 2061 6374 6976 6174  ss=loss, activat
-000069c0: 696f 6e5f 636f 6e76 3d61 6374 6976 6174  ion_conv=activat
-000069d0: 696f 6e5f 636f 6e76 2c20 6163 7469 7661  ion_conv, activa
-000069e0: 7469 6f6e 5f64 656e 7365 3d61 6374 6976  tion_dense=activ
-000069f0: 6174 696f 6e5f 6465 6e73 652c 206d 6f64  ation_dense, mod
-00006a00: 656c 5f72 6567 3d6d 6f64 656c 5f72 6567  el_reg=model_reg
-00006a10: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-00006a20: 2020 2020 2020 2063 6f6e 765f 696e 6974         conv_init
-00006a30: 3d63 6f6e 765f 696e 6974 2c20 6465 6e73  =conv_init, dens
-00006a40: 655f 696e 6974 3d64 656e 7365 5f69 6e69  e_init=dense_ini
-00006a50: 742c 206f 7074 696d 697a 6572 3d6f 7074  t, optimizer=opt
-00006a60: 696d 697a 6572 2c20 6561 726c 795f 7374  imizer, early_st
-00006a70: 6f70 5f63 616c 6c62 6163 6b3d 6361 6c6c  op_callback=call
-00006a80: 6261 636b 732c 2063 6865 636b 706f 696e  backs, checkpoin
-00006a90: 743d 4661 6c73 652c 2076 6572 626f 7365  t=False, verbose
-00006aa0: 3d73 656c 662e 7665 7262 6f73 652c 200a  =self.verbose, .
-00006ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ac0: 2020 2020 706f 6f6c 696e 675f 313d 706f      pooling_1=po
-00006ad0: 6f6c 696e 675f 312c 2070 6f6f 6c69 6e67  oling_1, pooling
-00006ae0: 5f32 3d70 6f6f 6c69 6e67 5f32 2c20 706f  _2=pooling_2, po
-00006af0: 6f6c 696e 675f 333d 706f 6f6c 696e 675f  oling_3=pooling_
-00006b00: 3329 0a20 2020 2020 2020 2020 2020 2065  3).            e
-00006b10: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00006b20: 2020 2020 2023 2323 2046 696c 7465 7220       ### Filter 
-00006b30: 616e 6420 4c61 7965 7220 4368 6172 6163  and Layer Charac
-00006b40: 7465 7273 7469 6373 2023 2323 0a20 2020  terstics ###.   
-00006b50: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00006b60: 7465 725f 3120 3d20 7472 6961 6c2e 7375  ter_1 = trial.su
-00006b70: 6767 6573 745f 696e 7428 2766 696c 7465  ggest_int('filte
-00006b80: 725f 3127 2c20 3132 2c20 3234 302c 2073  r_1', 12, 240, s
-00006b90: 7465 703d 3132 290a 2020 2020 2020 2020  tep=12).        
-00006ba0: 2020 2020 2020 2020 6669 6c74 6572 5f73          filter_s
-00006bb0: 697a 655f 3120 3d20 7472 6961 6c2e 7375  ize_1 = trial.su
-00006bc0: 6767 6573 745f 696e 7428 2766 696c 7465  ggest_int('filte
-00006bd0: 725f 7369 7a65 5f31 272c 2031 2c20 3131  r_size_1', 1, 11
-00006be0: 2c20 7374 6570 3d32 290a 2020 2020 2020  , step=2).      
-00006bf0: 2020 2020 2020 2020 2020 7374 7269 6465            stride
-00006c00: 735f 3120 3d20 7472 6961 6c2e 7375 6767  s_1 = trial.sugg
-00006c10: 6573 745f 696e 7428 2773 7472 6964 6573  est_int('strides
-00006c20: 5f31 272c 2031 2c20 332c 2073 7465 703d  _1', 1, 3, step=
-00006c30: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00006c40: 2020 2070 6f6f 6c69 6e67 5f31 203d 2074     pooling_1 = t
-00006c50: 7269 616c 2e73 7567 6765 7374 5f63 6174  rial.suggest_cat
-00006c60: 6567 6f72 6963 616c 2827 706f 6f6c 696e  egorical('poolin
-00006c70: 675f 3127 2c20 5b27 6d61 7827 2c20 2761  g_1', ['max', 'a
-00006c80: 7665 7261 6765 275d 290a 2020 2020 2020  verage']).      
-00006c90: 2020 2020 2020 2020 2020 706f 6f6c 5f73            pool_s
-00006ca0: 697a 655f 3120 3d20 7472 6961 6c2e 7375  ize_1 = trial.su
-00006cb0: 6767 6573 745f 696e 7428 2770 6f6f 6c5f  ggest_int('pool_
-00006cc0: 7369 7a65 5f31 272c 2031 2c20 372c 2073  size_1', 1, 7, s
-00006cd0: 7465 703d 3129 0a20 2020 2020 2020 2020  tep=1).         
-00006ce0: 2020 2020 2020 2070 6f6f 6c5f 7374 7269         pool_stri
-00006cf0: 6465 5f31 203d 2074 7269 616c 2e73 7567  de_1 = trial.sug
-00006d00: 6765 7374 5f69 6e74 2827 706f 6f6c 5f73  gest_int('pool_s
-00006d10: 7472 6964 655f 3127 2c20 312c 2033 2c20  tride_1', 1, 3, 
-00006d20: 7374 6570 3d31 290a 0a20 2020 2020 2020  step=1)..       
-00006d30: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
-00006d40: 3220 3d20 7472 6961 6c2e 7375 6767 6573  2 = trial.sugges
-00006d50: 745f 696e 7428 2766 696c 7465 725f 3227  t_int('filter_2'
-00006d60: 2c20 3132 2c20 3234 302c 2073 7465 703d  , 12, 240, step=
-00006d70: 3132 290a 2020 2020 2020 2020 2020 2020  12).            
-00006d80: 2020 2020 6669 6c74 6572 5f73 697a 655f      filter_size_
-00006d90: 3220 3d20 7472 6961 6c2e 7375 6767 6573  2 = trial.sugges
-00006da0: 745f 696e 7428 2766 696c 7465 725f 7369  t_int('filter_si
-00006db0: 7a65 5f32 272c 2031 2c20 372c 2073 7465  ze_2', 1, 7, ste
-00006dc0: 703d 3229 0a20 2020 2020 2020 2020 2020  p=2).           
-00006dd0: 2020 2020 2073 7472 6964 6573 5f32 203d       strides_2 =
-00006de0: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
-00006df0: 6e74 2827 7374 7269 6465 735f 3227 2c20  nt('strides_2', 
-00006e00: 312c 2033 2c20 7374 6570 3d31 290a 2020  1, 3, step=1).  
-00006e10: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00006e20: 6f6c 696e 675f 3220 3d20 7472 6961 6c2e  oling_2 = trial.
-00006e30: 7375 6767 6573 745f 6361 7465 676f 7269  suggest_categori
-00006e40: 6361 6c28 2770 6f6f 6c69 6e67 5f32 272c  cal('pooling_2',
-00006e50: 205b 276d 6178 272c 2027 6176 6572 6167   ['max', 'averag
-00006e60: 6527 5d29 0a20 2020 2020 2020 2020 2020  e']).           
-00006e70: 2020 2020 2070 6f6f 6c5f 7369 7a65 5f32       pool_size_2
-00006e80: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
-00006e90: 5f69 6e74 2827 706f 6f6c 5f73 697a 655f  _int('pool_size_
-00006ea0: 3227 2c20 312c 2037 2c20 7374 6570 3d31  2', 1, 7, step=1
-00006eb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00006ec0: 2020 706f 6f6c 5f73 7472 6964 655f 3220    pool_stride_2 
-00006ed0: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
-00006ee0: 696e 7428 2770 6f6f 6c5f 7374 7269 6465  int('pool_stride
-00006ef0: 5f32 272c 2031 2c20 332c 2073 7465 703d  _2', 1, 3, step=
-00006f00: 3129 0a0a 2020 2020 2020 2020 2020 2020  1)..            
-00006f10: 2020 2020 6669 6c74 6572 5f33 203d 2074      filter_3 = t
-00006f20: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
-00006f30: 2827 6669 6c74 6572 5f33 272c 2031 322c  ('filter_3', 12,
-00006f40: 2032 3430 2c20 7374 6570 3d31 3229 0a20   240, step=12). 
-00006f50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00006f60: 696c 7465 725f 7369 7a65 5f33 203d 2074  ilter_size_3 = t
-00006f70: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
-00006f80: 2827 6669 6c74 6572 5f73 697a 655f 3327  ('filter_size_3'
-00006f90: 2c20 312c 2037 2c20 7374 6570 3d32 290a  , 1, 7, step=2).
-00006fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fb0: 7374 7269 6465 735f 3320 3d20 7472 6961  strides_3 = tria
-00006fc0: 6c2e 7375 6767 6573 745f 696e 7428 2773  l.suggest_int('s
-00006fd0: 7472 6964 6573 5f33 272c 2031 2c20 332c  trides_3', 1, 3,
-00006fe0: 2073 7465 703d 3129 0a20 2020 2020 2020   step=1).       
-00006ff0: 2020 2020 2020 2020 2070 6f6f 6c69 6e67           pooling
-00007000: 5f33 203d 2074 7269 616c 2e73 7567 6765  _3 = trial.sugge
-00007010: 7374 5f63 6174 6567 6f72 6963 616c 2827  st_categorical('
-00007020: 706f 6f6c 696e 675f 3327 2c20 5b27 6d61  pooling_3', ['ma
-00007030: 7827 2c20 2761 7665 7261 6765 275d 290a  x', 'average']).
-00007040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007050: 706f 6f6c 5f73 697a 655f 3320 3d20 7472  pool_size_3 = tr
-00007060: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
-00007070: 2770 6f6f 6c5f 7369 7a65 5f33 272c 2031  'pool_size_3', 1
-00007080: 2c20 372c 2073 7465 703d 3129 0a20 2020  , 7, step=1).   
-00007090: 2020 2020 2020 2020 2020 2020 2070 6f6f               poo
-000070a0: 6c5f 7374 7269 6465 5f33 203d 2074 7269  l_stride_3 = tri
-000070b0: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
-000070c0: 706f 6f6c 5f73 7472 6964 655f 3327 2c20  pool_stride_3', 
-000070d0: 312c 2033 2c20 7374 6570 3d31 290a 0a20  1, 3, step=1).. 
-000070e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000070f0: 696c 7465 725f 3420 3d20 7472 6961 6c2e  ilter_4 = trial.
-00007100: 7375 6767 6573 745f 696e 7428 2766 696c  suggest_int('fil
-00007110: 7465 725f 3427 2c20 3132 2c20 3234 302c  ter_4', 12, 240,
-00007120: 2073 7465 703d 3132 290a 2020 2020 2020   step=12).      
-00007130: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
-00007140: 5f73 697a 655f 3420 3d20 7472 6961 6c2e  _size_4 = trial.
-00007150: 7375 6767 6573 745f 696e 7428 2766 696c  suggest_int('fil
-00007160: 7465 725f 7369 7a65 5f34 272c 2031 2c20  ter_size_4', 1, 
-00007170: 372c 2073 7465 703d 3229 0a20 2020 2020  7, step=2).     
-00007180: 2020 2020 2020 2020 2020 2073 7472 6964             strid
-00007190: 6573 5f34 203d 2074 7269 616c 2e73 7567  es_4 = trial.sug
-000071a0: 6765 7374 5f69 6e74 2827 7374 7269 6465  gest_int('stride
-000071b0: 735f 3427 2c20 312c 2033 2c20 7374 6570  s_4', 1, 3, step
-000071c0: 3d31 290a 0a20 2020 2020 2020 2020 2020  =1)..           
-000071d0: 2020 2020 2066 696c 7465 725f 3520 3d20       filter_5 = 
-000071e0: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
-000071f0: 7428 2766 696c 7465 725f 3527 2c20 3132  t('filter_5', 12
-00007200: 2c20 3234 302c 2073 7465 703d 3132 290a  , 240, step=12).
-00007210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007220: 6669 6c74 6572 5f73 697a 655f 3520 3d20  filter_size_5 = 
-00007230: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
-00007240: 7428 2766 696c 7465 725f 7369 7a65 5f35  t('filter_size_5
-00007250: 272c 2031 2c20 372c 2073 7465 703d 3229  ', 1, 7, step=2)
-00007260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007270: 2073 7472 6964 6573 5f35 203d 2074 7269   strides_5 = tri
-00007280: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
-00007290: 7374 7269 6465 735f 3527 2c20 312c 2033  strides_5', 1, 3
-000072a0: 2c20 7374 6570 3d31 2920 0a0a 2020 2020  , step=1) ..    
-000072b0: 2020 2020 2020 2020 2020 2020 2323 2320              ### 
-000072c0: 4465 6e73 6520 4c61 7965 7273 2023 2323  Dense Layers ###
-000072d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000072e0: 2064 656e 7365 5f6e 6575 726f 6e73 5f31   dense_neurons_1
-000072f0: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
-00007300: 5f69 6e74 2827 6465 6e73 655f 6e65 7572  _int('dense_neur
-00007310: 6f6e 735f 3127 2c20 3132 382c 2036 3430  ons_1', 128, 640
-00007320: 302c 2073 7465 703d 3132 3829 0a20 2020  0, step=128).   
-00007330: 2020 2020 2020 2020 2020 2020 2064 656e               den
-00007340: 7365 5f6e 6575 726f 6e73 5f32 203d 2074  se_neurons_2 = t
-00007350: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
-00007360: 2827 6465 6e73 655f 6e65 7572 6f6e 735f  ('dense_neurons_
-00007370: 3227 2c20 3132 382c 2036 3430 302c 2073  2', 128, 6400, s
-00007380: 7465 703d 3132 3829 0a20 2020 2020 2020  tep=128).       
-00007390: 2020 2020 2020 2020 2064 726f 706f 7574           dropout
-000073a0: 5f31 203d 2074 7269 616c 2e73 7567 6765  _1 = trial.sugge
-000073b0: 7374 5f66 6c6f 6174 2827 6472 6f70 6f75  st_float('dropou
-000073c0: 745f 3127 2c20 302e 302c 2030 2e35 2c20  t_1', 0.0, 0.5, 
-000073d0: 7374 6570 3d30 2e30 3129 0a20 2020 2020  step=0.01).     
-000073e0: 2020 2020 2020 2020 2020 2064 726f 706f             dropo
-000073f0: 7574 5f32 203d 2074 7269 616c 2e73 7567  ut_2 = trial.sug
-00007400: 6765 7374 5f66 6c6f 6174 2827 6472 6f70  gest_float('drop
-00007410: 6f75 745f 3227 2c20 302e 302c 2030 2e35  out_2', 0.0, 0.5
-00007420: 2c20 7374 6570 3d30 2e30 3129 200a 0a20  , step=0.01) .. 
-00007430: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00007440: 6f64 656c 2c20 6869 7374 6f72 7920 3d20  odel, history = 
-00007450: 636e 6e5f 6d6f 6465 6c2e 416c 6578 4e65  cnn_model.AlexNe
-00007460: 7428 636c 6173 735f 312c 2063 6c61 7373  t(class_1, class
-00007470: 5f32 2c20 696d 675f 6e75 6d5f 6368 616e  _2, img_num_chan
-00007480: 6e65 6c73 3d73 656c 662e 696d 675f 6e75  nels=self.img_nu
-00007490: 6d5f 6368 616e 6e65 6c73 2c20 0a20 2020  m_channels, .   
-000074a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074b0: 206e 6f72 6d61 6c69 7a65 3d73 656c 662e   normalize=self.
-000074c0: 6e6f 726d 616c 697a 652c 206d 696e 5f70  normalize, min_p
-000074d0: 6978 656c 3d6d 696e 5f70 6978 2c20 6d61  ixel=min_pix, ma
-000074e0: 785f 7069 7865 6c3d 6d61 785f 7069 782c  x_pixel=max_pix,
-000074f0: 2076 616c 5f70 6f73 6974 6976 653d 7661   val_positive=va
-00007500: 6c5f 636c 6173 735f 312c 2076 616c 5f6e  l_class_1, val_n
-00007510: 6567 6174 6976 653d 7661 6c5f 636c 6173  egative=val_clas
-00007520: 735f 322c 200a 2020 2020 2020 2020 2020  s_2, .          
-00007530: 2020 2020 2020 2020 2020 6570 6f63 6873            epochs
-00007540: 3d73 656c 662e 7472 6169 6e5f 6570 6f63  =self.train_epoc
-00007550: 6873 2c20 6261 7463 685f 7369 7a65 3d62  hs, batch_size=b
-00007560: 6174 6368 5f73 697a 652c 206c 723d 6c72  atch_size, lr=lr
-00007570: 2c20 6d6f 6d65 6e74 756d 3d6d 6f6d 656e  , momentum=momen
-00007580: 7475 6d2c 2064 6563 6179 3d64 6563 6179  tum, decay=decay
-00007590: 2c20 6e65 7374 6572 6f76 3d6e 6573 7465  , nesterov=neste
-000075a0: 726f 762c 200a 2020 2020 2020 2020 2020  rov, .          
-000075b0: 2020 2020 2020 2020 2020 6c6f 7373 3d6c            loss=l
-000075c0: 6f73 732c 2061 6374 6976 6174 696f 6e5f  oss, activation_
-000075d0: 636f 6e76 3d61 6374 6976 6174 696f 6e5f  conv=activation_
-000075e0: 636f 6e76 2c20 6163 7469 7661 7469 6f6e  conv, activation
-000075f0: 5f64 656e 7365 3d61 6374 6976 6174 696f  _dense=activatio
-00007600: 6e5f 6465 6e73 652c 206d 6f64 656c 5f72  n_dense, model_r
-00007610: 6567 3d6d 6f64 656c 5f72 6567 2c20 0a20  eg=model_reg, . 
-00007620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007630: 2020 2063 6f6e 765f 696e 6974 3d63 6f6e     conv_init=con
-00007640: 765f 696e 6974 2c20 6465 6e73 655f 696e  v_init, dense_in
-00007650: 6974 3d64 656e 7365 5f69 6e69 742c 206f  it=dense_init, o
-00007660: 7074 696d 697a 6572 3d6f 7074 696d 697a  ptimizer=optimiz
-00007670: 6572 2c20 706f 6f6c 696e 675f 313d 706f  er, pooling_1=po
-00007680: 6f6c 696e 675f 312c 2070 6f6f 6c69 6e67  oling_1, pooling
-00007690: 5f32 3d70 6f6f 6c69 6e67 5f32 2c20 706f  _2=pooling_2, po
-000076a0: 6f6c 696e 675f 333d 706f 6f6c 696e 675f  oling_3=pooling_
-000076b0: 332c 200a 2020 2020 2020 2020 2020 2020  3, .            
-000076c0: 2020 2020 2020 2020 706f 6f6c 5f73 7472          pool_str
-000076d0: 6964 655f 313d 706f 6f6c 5f73 7472 6964  ide_1=pool_strid
-000076e0: 655f 312c 2070 6f6f 6c5f 7369 7a65 5f32  e_1, pool_size_2
-000076f0: 3d70 6f6f 6c5f 7369 7a65 5f32 2c20 706f  =pool_size_2, po
-00007700: 6f6c 5f73 7472 6964 655f 323d 706f 6f6c  ol_stride_2=pool
-00007710: 5f73 7472 6964 655f 322c 200a 2020 2020  _stride_2, .    
-00007720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007730: 706f 6f6c 5f73 697a 655f 333d 706f 6f6c  pool_size_3=pool
-00007740: 5f73 697a 655f 332c 2070 6f6f 6c5f 7374  _size_3, pool_st
-00007750: 7269 6465 5f33 3d70 6f6f 6c5f 7374 7269  ride_3=pool_stri
-00007760: 6465 5f33 2c20 6669 6c74 6572 5f31 3d66  de_3, filter_1=f
-00007770: 696c 7465 725f 312c 2066 696c 7465 725f  ilter_1, filter_
-00007780: 7369 7a65 5f31 3d66 696c 7465 725f 7369  size_1=filter_si
-00007790: 7a65 5f31 2c20 0a20 2020 2020 2020 2020  ze_1, .         
-000077a0: 2020 2020 2020 2020 2020 2073 7472 6964             strid
-000077b0: 6573 5f31 3d73 7472 6964 6573 5f31 2c20  es_1=strides_1, 
-000077c0: 6669 6c74 6572 5f32 3d66 696c 7465 725f  filter_2=filter_
-000077d0: 322c 2066 696c 7465 725f 7369 7a65 5f32  2, filter_size_2
-000077e0: 3d66 696c 7465 725f 7369 7a65 5f32 2c20  =filter_size_2, 
-000077f0: 7374 7269 6465 735f 323d 7374 7269 6465  strides_2=stride
-00007800: 735f 322c 200a 2020 2020 2020 2020 2020  s_2, .          
-00007810: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
-00007820: 5f33 3d66 696c 7465 725f 332c 2066 696c  _3=filter_3, fil
-00007830: 7465 725f 7369 7a65 5f33 3d66 696c 7465  ter_size_3=filte
-00007840: 725f 7369 7a65 5f33 2c20 7374 7269 6465  r_size_3, stride
-00007850: 735f 333d 7374 7269 6465 735f 332c 2066  s_3=strides_3, f
-00007860: 696c 7465 725f 343d 6669 6c74 6572 5f34  ilter_4=filter_4
-00007870: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-00007880: 2020 2020 2020 2066 696c 7465 725f 7369         filter_si
-00007890: 7a65 5f34 3d66 696c 7465 725f 7369 7a65  ze_4=filter_size
-000078a0: 5f34 2c20 7374 7269 6465 735f 343d 7374  _4, strides_4=st
-000078b0: 7269 6465 735f 342c 2066 696c 7465 725f  rides_4, filter_
-000078c0: 353d 6669 6c74 6572 5f35 2c20 6669 6c74  5=filter_5, filt
-000078d0: 6572 5f73 697a 655f 353d 6669 6c74 6572  er_size_5=filter
-000078e0: 5f73 697a 655f 352c 200a 2020 2020 2020  _size_5, .      
-000078f0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00007900: 7269 6465 735f 353d 7374 7269 6465 735f  rides_5=strides_
-00007910: 352c 2064 656e 7365 5f6e 6575 726f 6e73  5, dense_neurons
-00007920: 5f31 3d64 656e 7365 5f6e 6575 726f 6e73  _1=dense_neurons
-00007930: 5f31 2c20 6465 6e73 655f 6e65 7572 6f6e  _1, dense_neuron
-00007940: 735f 323d 6465 6e73 655f 6e65 7572 6f6e  s_2=dense_neuron
-00007950: 735f 322c 200a 2020 2020 2020 2020 2020  s_2, .          
-00007960: 2020 2020 2020 2020 2020 6472 6f70 6f75            dropou
-00007970: 745f 313d 6472 6f70 6f75 745f 312c 2064  t_1=dropout_1, d
-00007980: 726f 706f 7574 5f32 3d64 726f 706f 7574  ropout_2=dropout
-00007990: 5f32 2c20 6561 726c 795f 7374 6f70 5f63  _2, early_stop_c
-000079a0: 616c 6c62 6163 6b3d 6361 6c6c 6261 636b  allback=callback
-000079b0: 732c 2063 6865 636b 706f 696e 743d 4661  s, checkpoint=Fa
-000079c0: 6c73 652c 2076 6572 626f 7365 3d73 656c  lse, verbose=sel
-000079d0: 662e 7665 7262 6f73 6529 0a20 2020 2020  f.verbose).     
-000079e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000079f0: 2020 2020 2069 6620 7365 6c66 2e6f 7074       if self.opt
-00007a00: 5f63 7620 6973 206e 6f74 204e 6f6e 653a  _cv is not None:
-00007a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007a20: 2070 7269 6e74 2829 0a20 2020 2020 2020   print().       
-00007a30: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00007a40: 2a2a 2a2a 2a2a 2a2a 2a2a 2a20 2043 5620  ***********  CV 
-00007a50: 2d20 3120 2a2a 2a2a 2a2a 2a2a 2a2a 2a27  - 1 ***********'
-00007a60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00007a70: 2020 7072 696e 7428 290a 2020 2020 2020    print().      
-00007a80: 2020 2020 2020 6966 2073 656c 662e 6f70        if self.op
-00007a90: 745f 6175 673a 0a20 2020 2020 2020 2020  t_aug:.         
-00007aa0: 2020 2020 2020 2070 7269 6e74 2829 0a20         print(). 
-00007ab0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00007ac0: 7269 6e74 2827 3d3d 3d3d 3d3d 3d20 496d  rint('======= Im
-00007ad0: 6167 6520 5061 7261 6d65 7465 7273 203d  age Parameters =
-00007ae0: 3d3d 3d3d 3d27 290a 2020 2020 2020 2020  =====').        
-00007af0: 2020 2020 2020 2020 7072 696e 7428 290a          print().
-00007b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b10: 7072 696e 7428 274e 756d 2041 7567 6d65  print('Num Augme
-00007b20: 6e74 6174 696f 6e73 203a 2027 2c20 6e75  ntations : ', nu
-00007b30: 6d5f 6175 6729 0a20 2020 2020 2020 2020  m_aug).         
-00007b40: 2020 2020 2020 2070 7269 6e74 2827 496d         print('Im
-00007b50: 6167 6520 5369 7a65 203a 2027 2c20 696d  age Size : ', im
-00007b60: 6167 655f 7369 7a65 290a 2020 2020 2020  age_size).      
-00007b70: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00007b80: 274d 6178 2050 6978 656c 2873 2920 3a20  'Max Pixel(s) : 
-00007b90: 272c 206d 6178 5f70 6978 290a 0a20 2020  ', max_pix)..   
-00007ba0: 2020 2020 2020 2020 206d 6f64 656c 2c20           model, 
-00007bb0: 6869 7374 6f72 7920 3d20 636e 6e5f 6d6f  history = cnn_mo
-00007bc0: 6465 6c2e 416c 6578 4e65 7428 636c 6173  del.AlexNet(clas
-00007bd0: 735f 312c 2063 6c61 7373 5f32 2c20 696d  s_1, class_2, im
-00007be0: 675f 6e75 6d5f 6368 616e 6e65 6c73 3d73  g_num_channels=s
-00007bf0: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
-00007c00: 6e65 6c73 2c20 6e6f 726d 616c 697a 653d  nels, normalize=
-00007c10: 7365 6c66 2e6e 6f72 6d61 6c69 7a65 2c20  self.normalize, 
-00007c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007c30: 206d 696e 5f70 6978 656c 3d6d 696e 5f70   min_pixel=min_p
-00007c40: 6978 2c20 6d61 785f 7069 7865 6c3d 6d61  ix, max_pixel=ma
-00007c50: 785f 7069 782c 2076 616c 5f70 6f73 6974  x_pix, val_posit
-00007c60: 6976 653d 7661 6c5f 636c 6173 735f 312c  ive=val_class_1,
-00007c70: 2076 616c 5f6e 6567 6174 6976 653d 7661   val_negative=va
-00007c80: 6c5f 636c 6173 735f 322c 2065 706f 6368  l_class_2, epoch
-00007c90: 733d 7365 6c66 2e74 7261 696e 5f65 706f  s=self.train_epo
-00007ca0: 6368 732c 200a 2020 2020 2020 2020 2020  chs, .          
-00007cb0: 2020 2020 2020 6261 7463 685f 7369 7a65        batch_size
-00007cc0: 3d62 6174 6368 5f73 697a 652c 206c 723d  =batch_size, lr=
-00007cd0: 6c72 2c20 6d6f 6d65 6e74 756d 3d6d 6f6d  lr, momentum=mom
-00007ce0: 656e 7475 6d2c 2064 6563 6179 3d64 6563  entum, decay=dec
-00007cf0: 6179 2c20 6e65 7374 6572 6f76 3d6e 6573  ay, nesterov=nes
-00007d00: 7465 726f 762c 2065 6172 6c79 5f73 746f  terov, early_sto
-00007d10: 705f 6361 6c6c 6261 636b 3d63 616c 6c62  p_callback=callb
-00007d20: 6163 6b73 2c20 0a20 2020 2020 2020 2020  acks, .         
-00007d30: 2020 2020 2020 2063 6865 636b 706f 696e         checkpoin
-00007d40: 743d 4661 6c73 652c 2076 6572 626f 7365  t=False, verbose
-00007d50: 3d73 656c 662e 7665 7262 6f73 652c 206f  =self.verbose, o
-00007d60: 7074 696d 697a 6572 3d6f 7074 696d 697a  ptimizer=optimiz
-00007d70: 6572 290a 0a20 2020 2020 2020 2023 4966  er)..        #If
-00007d80: 2074 6865 2070 6174 6965 6e63 6520 6973   the patience is
-00007d90: 2072 6561 6368 6564 2c20 7265 7475 726e   reached, return
-00007da0: 206e 616e 230a 2020 2020 2020 2020 6966   nan#.        if
-00007db0: 206c 656e 2868 6973 746f 7279 2e68 6973   len(history.his
-00007dc0: 746f 7279 5b27 6c6f 7373 275d 2920 213d  tory['loss']) !=
-00007dd0: 2073 656c 662e 7472 6169 6e5f 6570 6f63   self.train_epoc
-00007de0: 6873 3a0a 2020 2020 2020 2020 2020 2020  hs:.            
-00007df0: 7072 696e 7428 290a 2020 2020 2020 2020  print().        
-00007e00: 2020 2020 7072 696e 7428 2754 6865 2074      print('The t
-00007e10: 7269 616c 2077 6173 2070 7275 6e65 6420  rial was pruned 
-00007e20: 6f72 2074 6865 2074 7261 696e 696e 6720  or the training 
-00007e30: 7061 7469 656e 6365 2077 6173 2072 6561  patience was rea
-00007e40: 6368 6564 2e2e 2e27 2923 2c20 7265 7475  ched...')#, retu
-00007e50: 726e 696e 6720 302e 3030 3120 7469 6d65  rning 0.001 time
-00007e60: 7320 7468 6520 6e75 6d62 6572 206f 6620  s the number of 
-00007e70: 636f 6d70 6c65 7465 6420 6570 6f63 6873  completed epochs
-00007e80: 2e2e 2e27 290a 2020 2020 2020 2020 2020  ...').          
-00007e90: 2020 7072 696e 7428 290a 2020 2020 2020    print().      
-00007ea0: 2020 2020 2020 7265 7475 726e 2028 6c65        return (le
-00007eb0: 6e28 6869 7374 6f72 792e 6869 7374 6f72  n(history.histor
-00007ec0: 795b 276c 6f73 7327 5d29 202a 2030 2e30  y['loss']) * 0.0
-00007ed0: 3031 2920 2d20 3939 392e 300a 0a20 2020  01) - 999.0..   
-00007ee0: 2020 2020 2023 4966 2074 6865 2074 7261       #If the tra
-00007ef0: 696e 696e 6720 6661 696c 7320 7265 7475  ining fails retu
-00007f00: 726e 204e 614e 2072 6967 6874 2061 7761  rn NaN right awa
-00007f10: 7923 0a20 2020 2020 2020 2069 6620 6e70  y#.        if np
-00007f20: 2e69 7366 696e 6974 6528 6869 7374 6f72  .isfinite(histor
-00007f30: 792e 6869 7374 6f72 795b 276c 6f73 7327  y.history['loss'
-00007f40: 5d5b 2d31 5d29 3a0a 2020 2020 2020 2020  ][-1]):.        
-00007f50: 2020 2020 2349 6620 7468 6520 7472 6169      #If the trai
-00007f60: 6e20 6163 6320 7468 7265 7368 6f6c 6420  n acc threshold 
-00007f70: 6973 2073 6574 230a 2020 2020 2020 2020  is set#.        
-00007f80: 2020 2020 6966 2073 656c 662e 7472 6169      if self.trai
-00007f90: 6e5f 6163 635f 7468 7265 7368 6f6c 6420  n_acc_threshold 
-00007fa0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00007fb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00007fc0: 6869 7374 6f72 792e 6869 7374 6f72 795b  history.history[
-00007fd0: 2762 696e 6172 795f 6163 6375 7261 6379  'binary_accuracy
-00007fe0: 275d 5b2d 315d 203e 2073 656c 662e 7472  '][-1] > self.tr
-00007ff0: 6169 6e5f 6163 635f 7468 7265 7368 6f6c  ain_acc_threshol
-00008000: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-00008010: 2020 2020 2020 2070 7269 6e74 2829 0a20         print(). 
-00008020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008030: 2020 2070 7269 6e74 2827 5468 6520 7472     print('The tr
-00008040: 6961 6c20 7761 7320 7072 756e 6564 206f  ial was pruned o
-00008050: 7220 7468 6520 7472 6169 6e69 6e67 2070  r the training p
-00008060: 6174 6965 6e63 6520 7761 7320 7265 6163  atience was reac
-00008070: 6865 642e 2e2e 2729 232c 2072 6574 7572  hed...')#, retur
-00008080: 6e69 6e67 2030 2e30 3031 2074 696d 6573  ning 0.001 times
-00008090: 2074 6865 206e 756d 6265 7220 6f66 2063   the number of c
-000080a0: 6f6d 706c 6574 6564 2065 706f 6368 732e  ompleted epochs.
-000080b0: 2e2e 2729 0a20 2020 2020 2020 2020 2020  ..').           
-000080c0: 2020 2020 2020 2020 2070 7269 6e74 2829           print()
-000080d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000080e0: 2020 2020 2072 6574 7572 6e20 286c 656e       return (len
-000080f0: 2868 6973 746f 7279 2e68 6973 746f 7279  (history.history
-00008100: 5b27 6c6f 7373 275d 2920 2a20 302e 3030  ['loss']) * 0.00
-00008110: 3129 202d 2039 3939 2e30 0a0a 0a20 2020  1) - 999.0...   
-00008120: 2020 2020 2020 2020 206d 6f64 656c 732c           models,
-00008130: 2068 6973 746f 7269 6573 203d 205b 5d2c   histories = [],
-00008140: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00008150: 6d6f 6465 6c73 2e61 7070 656e 6428 6d6f  models.append(mo
-00008160: 6465 6c29 2c20 6869 7374 6f72 6965 732e  del), histories.
-00008170: 6170 7065 6e64 2868 6973 746f 7279 290a  append(history).
-00008180: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00008190: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000081a0: 2827 5472 6169 6e69 6e67 2066 6169 6c65  ('Training faile
-000081b0: 6420 6475 6520 746f 206e 756d 6572 6963  d due to numeric
-000081c0: 616c 2069 6e73 7461 6269 6c69 7479 2c20  al instability, 
-000081d0: 7265 7475 726e 696e 6720 6e61 6e2e 2e2e  returning nan...
-000081e0: 2729 0a20 2020 2020 2020 2020 2020 2072  ').            r
-000081f0: 6574 7572 6e20 6e70 2e6e 616e 200a 0a20  eturn np.nan .. 
-00008200: 2020 2020 2020 2023 2323 2323 2043 726f         ##### Cro
-00008210: 7373 2d56 616c 6964 6174 696f 6e20 526f  ss-Validation Ro
-00008220: 7574 696e 6520 2d20 7665 7279 2073 7065  utine - very spe
-00008230: 6369 6669 6320 696d 706c 656d 656e 7461  cific implementa
-00008240: 7469 6f6e 2023 2323 2323 0a20 2020 2020  tion #####.     
-00008250: 2020 2069 6620 7365 6c66 2e6f 7074 5f63     if self.opt_c
-00008260: 7620 6973 206e 6f74 204e 6f6e 653a 0a20  v is not None:. 
-00008270: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00008280: 6c66 2e76 616c 5f70 6f73 6974 6976 6520  lf.val_positive 
-00008290: 6973 204e 6f6e 6520 616e 6420 7365 6c66  is None and self
-000082a0: 2e76 616c 5f6e 6567 6174 6976 6520 6973  .val_negative is
-000082b0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-000082c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000082d0: 2056 616c 7565 4572 726f 7228 2743 4e4e   ValueError('CNN
-000082e0: 2063 726f 7373 2d76 616c 6964 6174 696f   cross-validatio
-000082f0: 6e20 6973 2063 7572 7265 6e74 6c79 2073  n is currently s
-00008300: 7570 706f 7274 6564 206f 6e6c 7920 6966  upported only if
-00008310: 2076 616c 6964 6174 696f 6e20 6461 7461   validation data
-00008320: 2069 7320 696e 7075 742e 2729 0a20 2020   is input.').   
-00008330: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00008340: 2e76 616c 5f70 6f73 6974 6976 6520 6973  .val_positive is
-00008350: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00008360: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00008370: 6e28 7365 6c66 2e70 6f73 6974 6976 655f  n(self.positive_
-00008380: 636c 6173 7329 202f 206c 656e 2873 656c  class) / len(sel
-00008390: 662e 7661 6c5f 706f 7369 7469 7665 2920  f.val_positive) 
-000083a0: 3c20 7365 6c66 2e6f 7074 5f63 762d 313a  < self.opt_cv-1:
-000083b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000083c0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-000083d0: 4572 726f 7228 2743 616e 6e6f 7420 7061  Error('Cannot pa
-000083e0: 7274 6974 696f 6e20 7468 6520 7472 6169  rtition the trai
-000083f0: 6e69 6e67 2f76 616c 6964 6174 696f 6e20  ning/validation 
-00008400: 6461 7461 2c20 7265 6665 7220 746f 2074  data, refer to t
-00008410: 6865 2041 5049 2064 6f63 756d 656e 7461  he API documenta
-00008420: 7469 6f6e 2066 6f72 2069 6e73 7472 7563  tion for instruc
-00008430: 7469 6f6e 7320 6f6e 2068 6f77 2074 6f20  tions on how to 
-00008440: 7573 6520 7468 6520 6f70 745f 6376 2070  use the opt_cv p
-00008450: 6172 616d 6574 6572 2e27 290a 2020 2020  arameter.').    
-00008460: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00008470: 7661 6c5f 6e65 6761 7469 7665 2069 7320  val_negative is 
-00008480: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00008490: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-000084a0: 2873 656c 662e 6e65 6761 7469 7665 5f63  (self.negative_c
-000084b0: 6c61 7373 2920 2f20 6c65 6e28 7365 6c66  lass) / len(self
-000084c0: 2e76 616c 5f6e 6567 6174 6976 6529 203c  .val_negative) <
-000084d0: 2073 656c 662e 6f70 745f 6376 2d31 3a0a   self.opt_cv-1:.
-000084e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000084f0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00008500: 7272 6f72 2827 4361 6e6e 6f74 2070 6172  rror('Cannot par
-00008510: 7469 7469 6f6e 2074 6865 2074 7261 696e  tition the train
-00008520: 696e 672f 7661 6c69 6461 7469 6f6e 2064  ing/validation d
-00008530: 6174 612c 2072 6566 6572 2074 6f20 7468  ata, refer to th
-00008540: 6520 4150 4920 646f 6375 6d65 6e74 6174  e API documentat
-00008550: 696f 6e20 666f 7220 696e 7374 7275 6374  ion for instruct
-00008560: 696f 6e73 206f 6e20 686f 7720 746f 2075  ions on how to u
-00008570: 7365 2074 6865 206f 7074 5f63 7620 7061  se the opt_cv pa
-00008580: 7261 6d65 7465 722e 2729 0a20 2020 2020  rameter.').     
-00008590: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-000085a0: 2020 2020 2354 6865 2066 6972 7374 206d      #The first m
-000085b0: 6f64 656c 2061 6c72 6561 6479 2072 616e  odel already ran
-000085c0: 2074 6865 7265 666f 7265 2073 7574 6272   therefore sutbr
-000085d0: 6163 7420 3120 2020 2020 200a 2020 2020  act 1      .    
-000085e0: 2020 2020 2020 2020 666f 7220 6b20 696e          for k in
-000085f0: 2072 616e 6765 2873 656c 662e 6f70 745f   range(self.opt_
-00008600: 6376 2d31 293a 2020 2020 2020 2020 2020  cv-1):          
-00008610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008620: 2023 4d61 6b65 2064 6565 7020 636f 7069   #Make deep copi
-00008630: 6573 2074 6f20 6176 6f69 6420 6f76 6572  es to avoid over
-00008640: 7772 6974 696e 6720 6172 7261 7973 0a20  writing arrays. 
-00008650: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00008660: 6c61 7373 5f31 2c20 636c 6173 735f 3220  lass_1, class_2 
-00008670: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
-00008680: 7365 6c66 2e70 6f73 6974 6976 655f 636c  self.positive_cl
-00008690: 6173 7329 2c20 636f 7079 2e64 6565 7063  ass), copy.deepc
-000086a0: 6f70 7928 7365 6c66 2e6e 6567 6174 6976  opy(self.negativ
-000086b0: 655f 636c 6173 7329 0a20 2020 2020 2020  e_class).       
-000086c0: 2020 2020 2020 2020 2076 616c 5f63 6c61           val_cla
-000086d0: 7373 5f31 2c20 7661 6c5f 636c 6173 735f  ss_1, val_class_
-000086e0: 3220 3d20 636f 7079 2e64 6565 7063 6f70  2 = copy.deepcop
-000086f0: 7928 7365 6c66 2e76 616c 5f70 6f73 6974  y(self.val_posit
-00008700: 6976 6529 2c20 636f 7079 2e64 6565 7063  ive), copy.deepc
-00008710: 6f70 7928 7365 6c66 2e76 616c 5f6e 6567  opy(self.val_neg
-00008720: 6174 6976 6529 0a0a 2020 2020 2020 2020  ative)..        
-00008730: 2020 2020 2020 2020 2353 6f72 7420 7468          #Sort th
-00008740: 6520 6e65 7720 6461 7461 2073 616d 706c  e new data sampl
-00008750: 6573 2c20 6e6f 2072 616e 646f 6d20 7368  es, no random sh
-00008760: 7566 666c 696e 672c 206a 7573 7420 6120  uffling, just a 
-00008770: 6c69 6e65 6172 2073 6571 7565 6e63 650a  linear sequence.
-00008780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008790: 6966 2076 616c 5f63 6c61 7373 5f31 2069  if val_class_1 i
-000087a0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-000087b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000087c0: 7661 6c5f 686f 6c64 5f31 203d 2063 6f70  val_hold_1 = cop
-000087d0: 792e 6465 6570 636f 7079 2863 6c61 7373  y.deepcopy(class
-000087e0: 5f31 5b6b 2a6c 656e 2876 616c 5f63 6c61  _1[k*len(val_cla
-000087f0: 7373 5f31 293a 6c65 6e28 7661 6c5f 636c  ss_1):len(val_cl
-00008800: 6173 735f 3129 2a28 6b2b 3129 5d29 2023  ass_1)*(k+1)]) #
-00008810: 5468 6520 6e65 7720 7661 6c69 6461 7469  The new validati
-00008820: 6f6e 2064 6174 610a 2020 2020 2020 2020  on data.        
-00008830: 2020 2020 2020 2020 2020 2020 636c 6173              clas
-00008840: 735f 315b 6b2a 6c65 6e28 7661 6c5f 636c  s_1[k*len(val_cl
-00008850: 6173 735f 3129 3a6c 656e 2876 616c 5f63  ass_1):len(val_c
-00008860: 6c61 7373 5f31 292a 286b 2b31 295d 203d  lass_1)*(k+1)] =
-00008870: 2063 6f70 792e 6465 6570 636f 7079 2876   copy.deepcopy(v
-00008880: 616c 5f63 6c61 7373 5f31 290a 2020 2020  al_class_1).    
-00008890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000088a0: 7661 6c5f 636c 6173 735f 3120 3d20 7661  val_class_1 = va
-000088b0: 6c5f 686f 6c64 5f31 2023 5468 6520 6e65  l_hold_1 #The ne
-000088c0: 7720 7661 6c69 6461 7469 6f6e 2064 6174  w validation dat
-000088d0: 610a 2020 2020 2020 2020 2020 2020 2020  a.              
-000088e0: 2020 6966 2076 616c 5f63 6c61 7373 5f32    if val_class_2
-000088f0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00008900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008910: 2020 7661 6c5f 686f 6c64 5f32 203d 2063    val_hold_2 = c
-00008920: 6f70 792e 6465 6570 636f 7079 2863 6c61  opy.deepcopy(cla
-00008930: 7373 5f32 5b6b 2a6c 656e 2876 616c 5f63  ss_2[k*len(val_c
-00008940: 6c61 7373 5f32 293a 6c65 6e28 7661 6c5f  lass_2):len(val_
-00008950: 636c 6173 735f 3229 2a28 6b2b 3129 5d29  class_2)*(k+1)])
-00008960: 2023 5468 6520 6e65 7720 7661 6c69 6461   #The new valida
-00008970: 7469 6f6e 2064 6174 610a 2020 2020 2020  tion data.      
-00008980: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-00008990: 6173 735f 325b 6b2a 6c65 6e28 7661 6c5f  ass_2[k*len(val_
-000089a0: 636c 6173 735f 3229 3a6c 656e 2876 616c  class_2):len(val
-000089b0: 5f63 6c61 7373 5f32 292a 286b 2b31 295d  _class_2)*(k+1)]
-000089c0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
-000089d0: 2876 616c 5f63 6c61 7373 5f32 290a 2020  (val_class_2).  
-000089e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000089f0: 2020 7661 6c5f 636c 6173 735f 3220 3d20    val_class_2 = 
-00008a00: 7661 6c5f 686f 6c64 5f32 2023 5468 6520  val_hold_2 #The 
-00008a10: 6e65 7720 7661 6c69 6461 7469 6f6e 2064  new validation d
-00008a20: 6174 610a 0a20 2020 2020 2020 2020 2020  ata..           
-00008a30: 2020 2020 2069 6620 7365 6c66 2e6f 7074       if self.opt
-00008a40: 5f61 7567 3a0a 2020 2020 2020 2020 2020  _aug:.          
-00008a50: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00008a60: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
-00008a70: 6c73 203d 3d20 313a 0a20 2020 2020 2020  ls == 1:.       
-00008a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a90: 2063 6861 6e6e 656c 312c 2063 6861 6e6e   channel1, chann
-00008aa0: 656c 322c 2063 6861 6e6e 656c 3320 3d20  el2, channel3 = 
-00008ab0: 636f 7079 2e64 6565 7063 6f70 7928 636c  copy.deepcopy(cl
-00008ac0: 6173 735f 3129 2c20 4e6f 6e65 2c20 4e6f  ass_1), None, No
-00008ad0: 6e65 200a 2020 2020 2020 2020 2020 2020  ne .            
-00008ae0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-00008af0: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
-00008b00: 6c73 203d 3d20 323a 0a20 2020 2020 2020  ls == 2:.       
-00008b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008b20: 2063 6861 6e6e 656c 312c 2063 6861 6e6e   channel1, chann
-00008b30: 656c 322c 2063 6861 6e6e 656c 3320 3d20  el2, channel3 = 
-00008b40: 636f 7079 2e64 6565 7063 6f70 7928 636c  copy.deepcopy(cl
-00008b50: 6173 735f 315b 3a2c 3a2c 3a2c 305d 292c  ass_1[:,:,:,0]),
-00008b60: 2063 6f70 792e 6465 6570 636f 7079 2863   copy.deepcopy(c
-00008b70: 6c61 7373 5f31 5b3a 2c3a 2c3a 2c31 5d29  lass_1[:,:,:,1])
-00008b80: 2c20 4e6f 6e65 200a 2020 2020 2020 2020  , None .        
-00008b90: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00008ba0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008bb0: 2020 2020 2020 2020 2020 6368 616e 6e65            channe
-00008bc0: 6c31 2c20 6368 616e 6e65 6c32 2c20 6368  l1, channel2, ch
-00008bd0: 616e 6e65 6c33 203d 2063 6f70 792e 6465  annel3 = copy.de
-00008be0: 6570 636f 7079 2863 6c61 7373 5f31 5b3a  epcopy(class_1[:
-00008bf0: 2c3a 2c3a 2c30 5d29 2c20 636f 7079 2e64  ,:,:,0]), copy.d
-00008c00: 6565 7063 6f70 7928 636c 6173 735f 315b  eepcopy(class_1[
-00008c10: 3a2c 3a2c 3a2c 315d 292c 2063 6f70 792e  :,:,:,1]), copy.
-00008c20: 6465 6570 636f 7079 2863 6c61 7373 5f31  deepcopy(class_1
-00008c30: 5b3a 2c3a 2c3a 2c32 5d29 0a20 2020 2020  [:,:,:,2]).     
-00008c40: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00008c50: 2020 2020 2020 2020 2020 2020 6175 676d              augm
-00008c60: 656e 7465 645f 696d 6167 6573 203d 2061  ented_images = a
-00008c70: 7567 6d65 6e74 6174 696f 6e28 6368 616e  ugmentation(chan
-00008c80: 6e65 6c31 3d63 6861 6e6e 656c 312c 2063  nel1=channel1, c
-00008c90: 6861 6e6e 656c 323d 6368 616e 6e65 6c32  hannel2=channel2
-00008ca0: 2c20 6368 616e 6e65 6c33 3d63 6861 6e6e  , channel3=chann
-00008cb0: 656c 332c 2062 6174 6368 3d6e 756d 5f61  el3, batch=num_a
-00008cc0: 7567 2c20 0a20 2020 2020 2020 2020 2020  ug, .           
-00008cd0: 2020 2020 2020 2020 2020 2020 2077 6964               wid
-00008ce0: 7468 5f73 6869 6674 3d73 656c 662e 7368  th_shift=self.sh
-00008cf0: 6966 742c 2068 6569 6768 745f 7368 6966  ift, height_shif
-00008d00: 743d 7365 6c66 2e73 6869 6674 2c20 686f  t=self.shift, ho
-00008d10: 7269 7a6f 6e74 616c 3d68 6f72 697a 6f6e  rizontal=horizon
-00008d20: 7461 6c2c 2076 6572 7469 6361 6c3d 7665  tal, vertical=ve
-00008d30: 7274 6963 616c 2c20 726f 7461 7469 6f6e  rtical, rotation
-00008d40: 3d72 6f74 6174 696f 6e2c 200a 2020 2020  =rotation, .    
-00008d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d60: 2020 2020 696d 6167 655f 7369 7a65 3d69      image_size=i
-00008d70: 6d61 6765 5f73 697a 652c 206d 6173 6b5f  mage_size, mask_
-00008d80: 7369 7a65 3d73 656c 662e 6d61 736b 5f73  size=self.mask_s
-00008d90: 697a 652c 206e 756d 5f6d 6173 6b73 3d73  ize, num_masks=s
-00008da0: 656c 662e 6e75 6d5f 6d61 736b 7329 0a0a  elf.num_masks)..
-00008db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008dc0: 2020 2020 6966 2073 656c 662e 696d 675f      if self.img_
-00008dd0: 6e75 6d5f 6368 616e 6e65 6c73 203e 2031  num_channels > 1
-00008de0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008df0: 2020 2020 2020 2020 2020 636c 6173 735f            class_
-00008e00: 313d 5b5d 0a20 2020 2020 2020 2020 2020  1=[].           
-00008e10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00008e20: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
-00008e30: 6e6e 656c 7320 3d3d 2032 3a0a 2020 2020  nnels == 2:.    
-00008e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e50: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00008e60: 2072 616e 6765 286c 656e 2861 7567 6d65   range(len(augme
-00008e70: 6e74 6564 5f69 6d61 6765 735b 305d 2929  nted_images[0]))
-00008e80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ea0: 2020 636c 6173 735f 312e 6170 7065 6e64    class_1.append
-00008eb0: 2864 6174 615f 7072 6f63 6573 7369 6e67  (data_processing
-00008ec0: 2e63 6f6e 6361 745f 6368 616e 6e65 6c73  .concat_channels
-00008ed0: 2861 7567 6d65 6e74 6564 5f69 6d61 6765  (augmented_image
-00008ee0: 735b 305d 5b69 5d2c 2061 7567 6d65 6e74  s[0][i], augment
-00008ef0: 6564 5f69 6d61 6765 735b 315d 5b69 5d29  ed_images[1][i])
-00008f00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00008f10: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00008f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00008f40: 6920 696e 2072 616e 6765 286c 656e 2861  i in range(len(a
-00008f50: 7567 6d65 6e74 6564 5f69 6d61 6765 735b  ugmented_images[
-00008f60: 305d 2929 3a0a 2020 2020 2020 2020 2020  0])):.          
-00008f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f80: 2020 2020 2020 636c 6173 735f 312e 6170        class_1.ap
-00008f90: 7065 6e64 2864 6174 615f 7072 6f63 6573  pend(data_proces
-00008fa0: 7369 6e67 2e63 6f6e 6361 745f 6368 616e  sing.concat_chan
-00008fb0: 6e65 6c73 2861 7567 6d65 6e74 6564 5f69  nels(augmented_i
-00008fc0: 6d61 6765 735b 305d 5b69 5d2c 2061 7567  mages[0][i], aug
-00008fd0: 6d65 6e74 6564 5f69 6d61 6765 735b 315d  mented_images[1]
-00008fe0: 5b69 5d2c 2061 7567 6d65 6e74 6564 5f69  [i], augmented_i
-00008ff0: 6d61 6765 735b 325d 5b69 5d29 290a 2020  mages[2][i])).  
-00009000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009010: 2020 2020 2020 636c 6173 735f 3120 3d20        class_1 = 
-00009020: 6e70 2e61 7272 6179 2863 6c61 7373 5f31  np.array(class_1
-00009030: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00009040: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00009050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009060: 2020 2020 636c 6173 735f 3120 3d20 6175      class_1 = au
-00009070: 676d 656e 7465 645f 696d 6167 6573 0a0a  gmented_images..
-00009080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009090: 2020 2020 2350 6572 666f 726d 2073 616d      #Perform sam
-000090a0: 6520 6175 676d 656e 7461 7469 6f6e 2074  e augmentation t
-000090b0: 6563 686e 6971 7565 7320 6f6e 206e 6567  echniques on neg
-000090c0: 6174 6976 6520 636c 6173 7320 6461 7461  ative class data
-000090d0: 2c20 6261 7463 683d 310a 2020 2020 2020  , batch=1.      
-000090e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000090f0: 2073 656c 662e 696d 675f 6e75 6d5f 6368   self.img_num_ch
-00009100: 616e 6e65 6c73 203d 3d20 313a 0a20 2020  annels == 1:.   
-00009110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009120: 2020 2020 2063 6861 6e6e 656c 312c 2063       channel1, c
-00009130: 6861 6e6e 656c 322c 2063 6861 6e6e 656c  hannel2, channel
-00009140: 3320 3d20 636f 7079 2e64 6565 7063 6f70  3 = copy.deepcop
-00009150: 7928 636c 6173 735f 3229 2c20 4e6f 6e65  y(class_2), None
-00009160: 2c20 4e6f 6e65 200a 2020 2020 2020 2020  , None .        
-00009170: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00009180: 2073 656c 662e 696d 675f 6e75 6d5f 6368   self.img_num_ch
-00009190: 616e 6e65 6c73 203d 3d20 323a 0a20 2020  annels == 2:.   
-000091a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091b0: 2020 2020 2063 6861 6e6e 656c 312c 2063       channel1, c
-000091c0: 6861 6e6e 656c 322c 2063 6861 6e6e 656c  hannel2, channel
-000091d0: 3320 3d20 636f 7079 2e64 6565 7063 6f70  3 = copy.deepcop
-000091e0: 7928 636c 6173 735f 325b 3a2c 3a2c 3a2c  y(class_2[:,:,:,
-000091f0: 305d 292c 2063 6f70 792e 6465 6570 636f  0]), copy.deepco
-00009200: 7079 2863 6c61 7373 5f32 5b3a 2c3a 2c3a  py(class_2[:,:,:
-00009210: 2c31 5d29 2c20 4e6f 6e65 200a 2020 2020  ,1]), None .    
-00009220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009230: 656c 6966 2073 656c 662e 696d 675f 6e75  elif self.img_nu
-00009240: 6d5f 6368 616e 6e65 6c73 203d 3d20 333a  m_channels == 3:
-00009250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009260: 2020 2020 2020 2020 2063 6861 6e6e 656c           channel
-00009270: 312c 2063 6861 6e6e 656c 322c 2063 6861  1, channel2, cha
-00009280: 6e6e 656c 3320 3d20 636f 7079 2e64 6565  nnel3 = copy.dee
-00009290: 7063 6f70 7928 636c 6173 735f 325b 3a2c  pcopy(class_2[:,
-000092a0: 3a2c 3a2c 305d 292c 2063 6f70 792e 6465  :,:,0]), copy.de
-000092b0: 6570 636f 7079 2863 6c61 7373 5f32 5b3a  epcopy(class_2[:
-000092c0: 2c3a 2c3a 2c31 5d29 2c20 636f 7079 2e64  ,:,:,1]), copy.d
-000092d0: 6565 7063 6f70 7928 636c 6173 735f 325b  eepcopy(class_2[
-000092e0: 3a2c 3a2c 3a2c 325d 290a 2020 2020 2020  :,:,:,2]).      
-000092f0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-00009300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009310: 2020 2061 7567 6d65 6e74 6564 5f69 6d61     augmented_ima
-00009320: 6765 735f 6e65 6761 7469 7665 203d 2061  ges_negative = a
-00009330: 7567 6d65 6e74 6174 696f 6e28 6368 616e  ugmentation(chan
-00009340: 6e65 6c31 3d63 6861 6e6e 656c 312c 2063  nel1=channel1, c
-00009350: 6861 6e6e 656c 323d 6368 616e 6e65 6c32  hannel2=channel2
-00009360: 2c20 6368 616e 6e65 6c33 3d63 6861 6e6e  , channel3=chann
-00009370: 656c 332c 2062 6174 6368 3d31 2c20 0a20  el3, batch=1, . 
-00009380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009390: 2020 2020 2020 2077 6964 7468 5f73 6869         width_shi
-000093a0: 6674 3d73 656c 662e 7368 6966 742c 2068  ft=self.shift, h
-000093b0: 6569 6768 745f 7368 6966 743d 7365 6c66  eight_shift=self
-000093c0: 2e73 6869 6674 2c20 686f 7269 7a6f 6e74  .shift, horizont
-000093d0: 616c 3d68 6f72 697a 6f6e 7461 6c2c 2076  al=horizontal, v
-000093e0: 6572 7469 6361 6c3d 7665 7274 6963 616c  ertical=vertical
-000093f0: 2c20 726f 7461 7469 6f6e 3d72 6f74 6174  , rotation=rotat
-00009400: 696f 6e2c 200a 2020 2020 2020 2020 2020  ion, .          
-00009410: 2020 2020 2020 2020 2020 2020 2020 696d                im
-00009420: 6167 655f 7369 7a65 3d69 6d61 6765 5f73  age_size=image_s
-00009430: 697a 652c 206d 6173 6b5f 7369 7a65 3d73  ize, mask_size=s
-00009440: 656c 662e 6d61 736b 5f73 697a 652c 206e  elf.mask_size, n
-00009450: 756d 5f6d 6173 6b73 3d73 656c 662e 6e75  um_masks=self.nu
-00009460: 6d5f 6d61 736b 7329 0a0a 2020 2020 2020  m_masks)..      
-00009470: 2020 2020 2020 2020 2020 2020 2020 2354                #T
-00009480: 6865 2061 7567 6d65 6e74 6174 696f 6e20  he augmentation 
-00009490: 726f 7574 696e 6520 7265 7475 726e 7320  routine returns 
-000094a0: 616e 206f 7574 7075 7420 666f 7220 6561  an output for ea
-000094b0: 6368 2066 696c 7465 722c 2065 2e67 2e20  ch filter, e.g. 
-000094c0: 3320 6f75 7470 7574 7320 666f 7220 5247  3 outputs for RG
-000094d0: 420a 2020 2020 2020 2020 2020 2020 2020  B.              
-000094e0: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
-000094f0: 675f 6e75 6d5f 6368 616e 6e65 6c73 203e  g_num_channels >
-00009500: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00009510: 2020 2020 2020 2020 2020 2020 636c 6173              clas
-00009520: 735f 323d 5b5d 0a20 2020 2020 2020 2020  s_2=[].         
-00009530: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00009540: 6620 7365 6c66 2e69 6d67 5f6e 756d 5f63  f self.img_num_c
-00009550: 6861 6e6e 656c 7320 3d3d 2032 3a0a 2020  hannels == 2:.  
-00009560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009570: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
-00009580: 696e 2072 616e 6765 286c 656e 2861 7567  in range(len(aug
-00009590: 6d65 6e74 6564 5f69 6d61 6765 735f 6e65  mented_images_ne
-000095a0: 6761 7469 7665 5b30 5d29 293a 0a20 2020  gative[0])):.   
-000095b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095c0: 2020 2020 2020 2020 2020 2020 2063 6c61               cla
-000095d0: 7373 5f32 2e61 7070 656e 6428 6461 7461  ss_2.append(data
-000095e0: 5f70 726f 6365 7373 696e 672e 636f 6e63  _processing.conc
-000095f0: 6174 5f63 6861 6e6e 656c 7328 6175 676d  at_channels(augm
-00009600: 656e 7465 645f 696d 6167 6573 5f6e 6567  ented_images_neg
-00009610: 6174 6976 655b 305d 5b69 5d2c 2061 7567  ative[0][i], aug
-00009620: 6d65 6e74 6564 5f69 6d61 6765 735f 6e65  mented_images_ne
-00009630: 6761 7469 7665 5b31 5d5b 695d 2929 0a20  gative[1][i])). 
-00009640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009650: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00009660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009670: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-00009680: 6e20 7261 6e67 6528 6c65 6e28 6175 676d  n range(len(augm
-00009690: 656e 7465 645f 696d 6167 6573 5f6e 6567  ented_images_neg
-000096a0: 6174 6976 655b 305d 2929 3a0a 2020 2020  ative[0])):.    
-000096b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096c0: 2020 2020 2020 2020 2020 2020 636c 6173              clas
-000096d0: 735f 322e 6170 7065 6e64 2864 6174 615f  s_2.append(data_
-000096e0: 7072 6f63 6573 7369 6e67 2e63 6f6e 6361  processing.conca
-000096f0: 745f 6368 616e 6e65 6c73 2861 7567 6d65  t_channels(augme
-00009700: 6e74 6564 5f69 6d61 6765 735f 6e65 6761  nted_images_nega
-00009710: 7469 7665 5b30 5d5b 695d 2c20 6175 676d  tive[0][i], augm
-00009720: 656e 7465 645f 696d 6167 6573 5f6e 6567  ented_images_neg
-00009730: 6174 6976 655b 315d 5b69 5d2c 2061 7567  ative[1][i], aug
-00009740: 6d65 6e74 6564 5f69 6d61 6765 735f 6e65  mented_images_ne
-00009750: 6761 7469 7665 5b32 5d5b 695d 2929 0a20  gative[2][i])). 
-00009760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009770: 2020 2020 2020 2063 6c61 7373 5f32 203d         class_2 =
-00009780: 206e 702e 6172 7261 7928 636c 6173 735f   np.array(class_
-00009790: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
-000097a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000097b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097c0: 2020 2020 2063 6c61 7373 5f32 203d 2061       class_2 = a
-000097d0: 7567 6d65 6e74 6564 5f69 6d61 6765 735f  ugmented_images_
-000097e0: 6e65 6761 7469 7665 0a0a 2020 2020 2020  negative..      
-000097f0: 2020 2020 2020 2020 2020 2020 2020 2342                #B
-00009800: 616c 616e 6365 2074 6865 2063 6c61 7373  alance the class
-00009810: 2073 697a 6573 0a20 2020 2020 2020 2020   sizes.         
-00009820: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00009830: 6c66 2e62 616c 616e 6365 3a0a 2020 2020  lf.balance:.    
-00009840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009850: 2020 2020 636c 6173 735f 3220 3d20 636c      class_2 = cl
-00009860: 6173 735f 325b 3a6c 656e 2863 6c61 7373  ass_2[:len(class
-00009870: 5f31 295d 2020 2020 200a 0a20 2020 2020  _1)]     ..     
-00009880: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00009890: 6620 7365 6c66 2e69 6d67 5f6e 756d 5f63  f self.img_num_c
-000098a0: 6861 6e6e 656c 7320 3d3d 2031 3a0a 2020  hannels == 1:.  
-000098b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098c0: 2020 2020 2020 636c 6173 735f 3220 3d20        class_2 = 
-000098d0: 7265 7369 7a65 2863 6c61 7373 5f32 2c20  resize(class_2, 
-000098e0: 7369 7a65 3d69 6d61 6765 5f73 697a 6529  size=image_size)
-000098f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009900: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00009910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009920: 2020 2063 6861 6e6e 656c 3120 3d20 7265     channel1 = re
-00009930: 7369 7a65 2863 6c61 7373 5f32 5b3a 2c3a  size(class_2[:,:
-00009940: 2c3a 2c30 5d2c 2073 697a 653d 696d 6167  ,:,0], size=imag
-00009950: 655f 7369 7a65 290a 2020 2020 2020 2020  e_size).        
-00009960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009970: 6368 616e 6e65 6c32 203d 2072 6573 697a  channel2 = resiz
-00009980: 6528 636c 6173 735f 325b 3a2c 3a2c 3a2c  e(class_2[:,:,:,
-00009990: 315d 2c20 7369 7a65 3d69 6d61 6765 5f73  1], size=image_s
-000099a0: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
-000099b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000099c0: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
-000099d0: 6e6e 656c 7320 3d3d 2032 3a0a 2020 2020  nnels == 2:.    
-000099e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099f0: 2020 2020 2020 2020 636c 6173 735f 3220          class_2 
-00009a00: 3d20 6461 7461 5f70 726f 6365 7373 696e  = data_processin
-00009a10: 672e 636f 6e63 6174 5f63 6861 6e6e 656c  g.concat_channel
-00009a20: 7328 6368 616e 6e65 6c31 2c20 6368 616e  s(channel1, chan
-00009a30: 6e65 6c32 290a 2020 2020 2020 2020 2020  nel2).          
-00009a40: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00009a50: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00009a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a70: 6368 616e 6e65 6c33 203d 2072 6573 697a  channel3 = resiz
-00009a80: 6528 636c 6173 735f 325b 3a2c 3a2c 3a2c  e(class_2[:,:,:,
-00009a90: 325d 2c20 7369 7a65 3d69 6d61 6765 5f73  2], size=image_s
-00009aa0: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
-00009ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ac0: 2063 6c61 7373 5f32 203d 2064 6174 615f   class_2 = data_
-00009ad0: 7072 6f63 6573 7369 6e67 2e63 6f6e 6361  processing.conca
-00009ae0: 745f 6368 616e 6e65 6c73 2863 6861 6e6e  t_channels(chann
-00009af0: 656c 312c 2063 6861 6e6e 656c 322c 2063  el1, channel2, c
-00009b00: 6861 6e6e 656c 3329 0a0a 2020 2020 2020  hannel3)..      
-00009b10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00009b20: 2076 616c 5f63 6c61 7373 5f31 2069 7320   val_class_1 is 
-00009b30: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00009b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b50: 2020 6966 2073 656c 662e 696d 675f 6e75    if self.img_nu
-00009b60: 6d5f 6368 616e 6e65 6c73 203d 3d20 313a  m_channels == 1:
-00009b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009b80: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00009b90: 5f63 6c61 7373 5f31 203d 2072 6573 697a  _class_1 = resiz
-00009ba0: 6528 7661 6c5f 636c 6173 735f 312c 2073  e(val_class_1, s
-00009bb0: 697a 653d 696d 6167 655f 7369 7a65 290a  ize=image_size).
-00009bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bd0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00009be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bf0: 2020 2020 2020 2020 2020 7661 6c5f 6368            val_ch
-00009c00: 616e 6e65 6c31 203d 2072 6573 697a 6528  annel1 = resize(
-00009c10: 7661 6c5f 636c 6173 735f 315b 3a2c 3a2c  val_class_1[:,:,
-00009c20: 3a2c 305d 2c20 7369 7a65 3d69 6d61 6765  :,0], size=image
-00009c30: 5f73 697a 6529 0a20 2020 2020 2020 2020  _size).         
-00009c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c50: 2020 2076 616c 5f63 6861 6e6e 656c 3220     val_channel2 
-00009c60: 3d20 7265 7369 7a65 2876 616c 5f63 6c61  = resize(val_cla
-00009c70: 7373 5f31 5b3a 2c3a 2c3a 2c31 5d2c 2073  ss_1[:,:,:,1], s
-00009c80: 697a 653d 696d 6167 655f 7369 7a65 290a  ize=image_size).
-00009c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ca0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00009cb0: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
-00009cc0: 6e65 6c73 203d 3d20 323a 0a20 2020 2020  nels == 2:.     
-00009cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ce0: 2020 2020 2020 2020 2020 2076 616c 5f63             val_c
-00009cf0: 6c61 7373 5f31 203d 2064 6174 615f 7072  lass_1 = data_pr
-00009d00: 6f63 6573 7369 6e67 2e63 6f6e 6361 745f  ocessing.concat_
-00009d10: 6368 616e 6e65 6c73 2876 616c 5f63 6861  channels(val_cha
-00009d20: 6e6e 656c 312c 2076 616c 5f63 6861 6e6e  nnel1, val_chann
-00009d30: 656c 3229 0a20 2020 2020 2020 2020 2020  el2).           
-00009d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d50: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00009d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d70: 2020 2020 2020 2076 616c 5f63 6861 6e6e         val_chann
-00009d80: 656c 3320 3d20 7265 7369 7a65 2876 616c  el3 = resize(val
-00009d90: 5f63 6c61 7373 5f31 5b3a 2c3a 2c3a 2c32  _class_1[:,:,:,2
-00009da0: 5d2c 2073 697a 653d 696d 6167 655f 7369  ], size=image_si
-00009db0: 7a65 290a 2020 2020 2020 2020 2020 2020  ze).            
-00009dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009dd0: 2020 2020 7661 6c5f 636c 6173 735f 3120      val_class_1 
-00009de0: 3d20 6461 7461 5f70 726f 6365 7373 696e  = data_processin
-00009df0: 672e 636f 6e63 6174 5f63 6861 6e6e 656c  g.concat_channel
-00009e00: 7328 7661 6c5f 6368 616e 6e65 6c31 2c20  s(val_channel1, 
-00009e10: 7661 6c5f 6368 616e 6e65 6c32 2c20 7661  val_channel2, va
-00009e20: 6c5f 6368 616e 6e65 6c33 290a 0a20 2020  l_channel3)..   
-00009e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e40: 2069 6620 7661 6c5f 636c 6173 735f 3220   if val_class_2 
-00009e50: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00009e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e70: 2020 2020 2069 6620 7365 6c66 2e69 6d67       if self.img
-00009e80: 5f6e 756d 5f63 6861 6e6e 656c 7320 3d3d  _num_channels ==
-00009e90: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00009ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009eb0: 7661 6c5f 636c 6173 735f 3220 3d20 7265  val_class_2 = re
-00009ec0: 7369 7a65 2876 616c 5f63 6c61 7373 5f32  size(val_class_2
-00009ed0: 2c20 7369 7a65 3d69 6d61 6765 5f73 697a  , size=image_siz
-00009ee0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00009ef0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00009f00: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
-00009f10: 6e6e 656c 7320 3e20 313a 0a20 2020 2020  nnels > 1:.     
-00009f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f30: 2020 2020 2020 2076 616c 5f63 6861 6e6e         val_chann
-00009f40: 656c 3120 3d20 7265 7369 7a65 2876 616c  el1 = resize(val
-00009f50: 5f63 6c61 7373 5f32 5b3a 2c3a 2c3a 2c30  _class_2[:,:,:,0
-00009f60: 5d2c 2073 697a 653d 696d 6167 655f 7369  ], size=image_si
-00009f70: 7a65 290a 2020 2020 2020 2020 2020 2020  ze).            
-00009f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f90: 7661 6c5f 6368 616e 6e65 6c32 203d 2072  val_channel2 = r
-00009fa0: 6573 697a 6528 7661 6c5f 636c 6173 735f  esize(val_class_
-00009fb0: 325b 3a2c 3a2c 3a2c 315d 2c20 7369 7a65  2[:,:,:,1], size
-00009fc0: 3d69 6d61 6765 5f73 697a 6529 0a20 2020  =image_size).   
-00009fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fe0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00009ff0: 2e69 6d67 5f6e 756d 5f63 6861 6e6e 656c  .img_num_channel
-0000a000: 7320 3d3d 2032 3a0a 2020 2020 2020 2020  s == 2:.        
-0000a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a020: 2020 2020 2020 2020 7661 6c5f 636c 6173          val_clas
-0000a030: 735f 3220 3d20 6461 7461 5f70 726f 6365  s_2 = data_proce
-0000a040: 7373 696e 672e 636f 6e63 6174 5f63 6861  ssing.concat_cha
-0000a050: 6e6e 656c 7328 7661 6c5f 6368 616e 6e65  nnels(val_channe
-0000a060: 6c31 2c20 7661 6c5f 6368 616e 6e65 6c32  l1, val_channel2
-0000a070: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000a080: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000a090: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0b0: 2020 2020 7661 6c5f 6368 616e 6e65 6c33      val_channel3
-0000a0c0: 203d 2072 6573 697a 6528 7661 6c5f 636c   = resize(val_cl
-0000a0d0: 6173 735f 325b 3a2c 3a2c 3a2c 325d 2c20  ass_2[:,:,:,2], 
-0000a0e0: 7369 7a65 3d69 6d61 6765 5f73 697a 6529  size=image_size)
-0000a0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000060: 3a20 6461 6e69 656c 0a22 2222 0a69 6d70  : daniel.""".imp
+00000070: 6f72 7420 6f73 2c20 7379 732c 2063 6f70  ort os, sys, cop
+00000080: 792c 2067 632c 2073 656c 6563 746f 7273  y, gc, selectors
+00000090: 2c20 7465 726d 696f 730a 6f73 2e65 6e76  , termios.os.env
+000000a0: 6972 6f6e 5b27 5059 5448 4f4e 4841 5348  iron['PYTHONHASH
+000000b0: 5345 4544 275d 3d20 2730 2720 232c 206f  SEED']= '0' #, o
+000000c0: 732e 656e 7669 726f 6e5b 2254 465f 4445  s.environ["TF_DE
+000000d0: 5445 524d 494e 4953 5449 435f 4f50 5322  TERMINISTIC_OPS"
+000000e0: 5d20 3d31 0a69 6d70 6f72 7420 7465 6e73  ] =1.import tens
+000000f0: 6f72 666c 6f77 2061 7320 7466 0a0a 696d  orflow as tf..im
+00000100: 706f 7274 206e 756d 7079 2061 7320 6e70  port numpy as np
+00000110: 0a69 6d70 6f72 7420 7261 6e64 6f6d 2061  .import random a
+00000120: 7320 7079 7468 6f6e 5f72 616e 646f 6d0a  s python_random.
+00000130: 6e70 2e72 616e 646f 6d2e 7365 6564 2831  np.random.seed(1
+00000140: 3930 3929 2c20 7079 7468 6f6e 5f72 616e  909), python_ran
+00000150: 646f 6d2e 7365 6564 2831 3930 3929 2c20  dom.seed(1909), 
+00000160: 7466 2e72 616e 646f 6d2e 7365 745f 7365  tf.random.set_se
+00000170: 6564 2831 3930 3929 2023 2368 7474 7073  ed(1909) ##https
+00000180: 3a2f 2f6b 6572 6173 2e69 6f2f 6765 7474  ://keras.io/gett
+00000190: 696e 675f 7374 6172 7465 642f 6661 712f  ing_started/faq/
+000001a0: 2368 6f77 2d63 616e 2d69 2d6f 6274 6169  #how-can-i-obtai
+000001b0: 6e2d 7265 7072 6f64 7563 6962 6c65 2d72  n-reproducible-r
+000001c0: 6573 756c 7473 2d75 7369 6e67 2d6b 6572  esults-using-ker
+000001d0: 6173 2d64 7572 696e 672d 6465 7665 6c6f  as-during-develo
+000001e0: 706d 656e 7423 230a 6672 6f6d 2070 616e  pment##.from pan
+000001f0: 6461 7320 696d 706f 7274 2044 6174 6146  das import DataF
+00000200: 7261 6d65 0a66 726f 6d20 7761 726e 696e  rame.from warnin
+00000210: 6773 2069 6d70 6f72 7420 6669 6c74 6572  gs import filter
+00000220: 7761 726e 696e 6773 0a66 696c 7465 7277  warnings.filterw
+00000230: 6172 6e69 6e67 7328 2269 676e 6f72 6522  arnings("ignore"
+00000240: 2c20 6361 7465 676f 7279 3d46 7574 7572  , category=Futur
+00000250: 6557 6172 6e69 6e67 290a 6672 6f6d 2063  eWarning).from c
+00000260: 6f6c 6c65 6374 696f 6e73 2069 6d70 6f72  ollections impor
+00000270: 7420 436f 756e 7465 7220 0a0a 696d 706f  t Counter ..impo
+00000280: 7274 2073 6b6c 6561 726e 2e6e 6569 6768  rt sklearn.neigh
+00000290: 626f 7273 2e5f 6261 7365 0a73 7973 2e6d  bors._base.sys.m
+000002a0: 6f64 756c 6573 5b27 736b 6c65 6172 6e2e  odules['sklearn.
+000002b0: 6e65 6967 6862 6f72 732e 6261 7365 275d  neighbors.base']
+000002c0: 203d 2073 6b6c 6561 726e 2e6e 6569 6768   = sklearn.neigh
+000002d0: 626f 7273 2e5f 6261 7365 0a66 726f 6d20  bors._base.from 
+000002e0: 736b 6c65 6172 6e2e 696d 7075 7465 2069  sklearn.impute i
+000002f0: 6d70 6f72 7420 4b4e 4e49 6d70 7574 6572  mport KNNImputer
+00000300: 0a66 726f 6d20 736b 6c65 6172 6e2e 656e  .from sklearn.en
+00000310: 7365 6d62 6c65 2069 6d70 6f72 7420 5261  semble import Ra
+00000320: 6e64 6f6d 466f 7265 7374 436c 6173 7369  ndomForestClassi
+00000330: 6669 6572 0a66 726f 6d20 736b 6c65 6172  fier.from sklear
+00000340: 6e2e 6e65 7572 616c 5f6e 6574 776f 726b  n.neural_network
+00000350: 2069 6d70 6f72 7420 4d4c 5043 6c61 7373   import MLPClass
+00000360: 6966 6965 720a 6672 6f6d 2073 6b6c 6561  ifier.from sklea
+00000370: 726e 2e6d 6574 7269 6373 2069 6d70 6f72  rn.metrics impor
+00000380: 7420 6163 6375 7261 6379 5f73 636f 7265  t accuracy_score
+00000390: 0a66 726f 6d20 736b 6c65 6172 6e2e 6d6f  .from sklearn.mo
+000003a0: 6465 6c5f 7365 6c65 6374 696f 6e20 696d  del_selection im
+000003b0: 706f 7274 2074 7261 696e 5f74 6573 745f  port train_test_
+000003c0: 7370 6c69 742c 2063 726f 7373 5f76 616c  split, cross_val
+000003d0: 6964 6174 652c 2063 726f 7373 5f76 616c  idate, cross_val
+000003e0: 5f73 636f 7265 0a0a 6672 6f6d 2073 6b6f  _score..from sko
+000003f0: 7074 2069 6d70 6f72 7420 4261 7965 7353  pt import BayesS
+00000400: 6561 7263 6843 562c 2070 6c6f 7473 2c20  earchCV, plots, 
+00000410: 6770 5f6d 696e 696d 697a 650a 6672 6f6d  gp_minimize.from
+00000420: 2073 6b6f 7074 2e70 6c6f 7473 2069 6d70   skopt.plots imp
+00000430: 6f72 7420 706c 6f74 5f63 6f6e 7665 7267  ort plot_converg
+00000440: 656e 6365 2c20 706c 6f74 5f6f 626a 6563  ence, plot_objec
+00000450: 7469 7665 0a66 726f 6d20 736b 6f70 742e  tive.from skopt.
+00000460: 7370 6163 6520 696d 706f 7274 2052 6561  space import Rea
+00000470: 6c2c 2049 6e74 6567 6572 2c20 4361 7465  l, Integer, Cate
+00000480: 676f 7269 6361 6c20 0a66 726f 6d20 7465  gorical .from te
+00000490: 6e73 6f72 666c 6f77 2e6b 6572 6173 2e62  nsorflow.keras.b
+000004a0: 6163 6b65 6e64 2069 6d70 6f72 7420 636c  ackend import cl
+000004b0: 6561 725f 7365 7373 696f 6e20 0a66 726f  ear_session .fro
+000004c0: 6d20 7465 6e73 6f72 666c 6f77 2e6b 6572  m tensorflow.ker
+000004d0: 6173 2e63 616c 6c62 6163 6b73 2069 6d70  as.callbacks imp
+000004e0: 6f72 7420 4561 726c 7953 746f 7070 696e  ort EarlyStoppin
+000004f0: 672c 2043 616c 6c62 6163 6b0a 0a69 6d70  g, Callback..imp
+00000500: 6f72 7420 6f70 7475 6e61 0a66 726f 6d20  ort optuna.from 
+00000510: 426f 7275 7461 5368 6170 2069 6d70 6f72  BorutaShap impor
+00000520: 7420 426f 7275 7461 5368 6170 0a66 726f  t BorutaShap.fro
+00000530: 6d20 626f 7275 7461 2069 6d70 6f72 7420  m boruta import 
+00000540: 426f 7275 7461 5079 0a66 726f 6d20 7867  BorutaPy.from xg
+00000550: 626f 6f73 7420 696d 706f 7274 2058 4742  boost import XGB
+00000560: 436c 6173 7369 6669 6572 2c20 444d 6174  Classifier, DMat
+00000570: 7269 782c 2074 7261 696e 0a66 726f 6d20  rix, train.from 
+00000580: 6f70 7475 6e61 2e69 6e74 6567 7261 7469  optuna.integrati
+00000590: 6f6e 2069 6d70 6f72 7420 5446 4b65 7261  on import TFKera
+000005a0: 7350 7275 6e69 6e67 4361 6c6c 6261 636b  sPruningCallback
+000005b0: 0a6f 7074 756e 612e 6c6f 6767 696e 672e  .optuna.logging.
+000005c0: 7365 745f 7665 7262 6f73 6974 7928 6f70  set_verbosity(op
+000005d0: 7475 6e61 2e6c 6f67 6769 6e67 2e57 4152  tuna.logging.WAR
+000005e0: 4e49 4e47 290a 6672 6f6d 204d 6963 726f  NING).from Micro
+000005f0: 4c49 412e 6461 7461 5f61 7567 6d65 6e74  LIA.data_augment
+00000600: 6174 696f 6e20 696d 706f 7274 2061 7567  ation import aug
+00000610: 6d65 6e74 6174 696f 6e2c 2072 6573 697a  mentation, resiz
+00000620: 650a 6672 6f6d 204d 6963 726f 4c49 4120  e.from MicroLIA 
+00000630: 696d 706f 7274 2064 6174 615f 7072 6f63  import data_proc
+00000640: 6573 7369 6e67 2c20 636e 6e5f 6d6f 6465  essing, cnn_mode
+00000650: 6c0a 0a0a 636c 6173 7320 6f62 6a65 6374  l...class object
+00000660: 6976 655f 636e 6e28 6f62 6a65 6374 293a  ive_cnn(object):
+00000670: 0a20 2020 2022 2222 0a20 2020 204f 7074  .    """.    Opt
+00000680: 696d 697a 6174 696f 6e20 6f62 6a65 6374  imization object
+00000690: 6976 6520 6675 6e63 7469 6f6e 2066 6f72  ive function for
+000006a0: 204d 6963 726f 4c49 4127 7320 636f 6e76   MicroLIA's conv
+000006b0: 6f6c 7574 696f 6e61 6c20 6e65 7572 616c  olutional neural
+000006c0: 206e 6574 776f 726b 732e 0a0a 2020 2020   networks...    
+000006d0: 5468 6973 2069 7320 7061 7373 6564 2074  This is passed t
+000006e0: 6872 6f75 6768 2074 6865 2068 7970 6572  hrough the hyper
+000006f0: 5f6f 7074 2829 2066 756e 6374 696f 6e20  _opt() function 
+00000700: 7768 656e 206f 7074 696d 697a 696e 6720  when optimizing 
+00000710: 7769 7468 0a20 2020 204f 7074 756e 612e  with.    Optuna.
+00000720: 2054 6865 204f 7074 756e 6120 736f 6674   The Optuna soft
+00000730: 7761 7265 2066 6f72 2068 7970 6572 7061  ware for hyperpa
+00000740: 7261 6d65 7465 7220 6f70 7469 6d69 7a61  rameter optimiza
+00000750: 7469 6f6e 2077 6173 2070 7562 6c69 7368  tion was publish
+00000760: 6564 2069 6e20 0a20 2020 2032 3031 3920  ed in .    2019 
+00000770: 6279 2041 6b69 6261 2065 7420 616c 2e20  by Akiba et al. 
+00000780: 5061 7065 723a 2068 7474 7073 3a2f 2f61  Paper: https://a
+00000790: 7278 6976 2e6f 7267 2f61 6273 2f31 3930  rxiv.org/abs/190
+000007a0: 372e 3130 3930 320a 0a20 2020 2055 6e6c  7.10902..    Unl
+000007b0: 696b 6520 7468 6520 6f62 6a65 6374 6976  ike the objectiv
+000007c0: 6520 6675 6e63 7469 6f6e 7320 666f 7220  e functions for 
+000007d0: 7468 6520 656e 7365 6d62 6c65 2061 6c67  the ensemble alg
+000007e0: 6f72 6974 686d 732c 2074 6869 7320 7461  orithms, this ta
+000007f0: 6b65 7320 6173 2069 6e70 7574 0a20 2020  kes as input.   
+00000800: 2074 6865 2074 776f 2063 6c61 7373 6573   the two classes
+00000810: 2064 6972 6563 746c 792c 2070 6f73 6974   directly, posit
+00000820: 6976 655f 636c 6173 7320 2620 6e65 6761  ive_class & nega
+00000830: 7469 7665 5f63 6c61 7373 2c20 696e 7374  tive_class, inst
+00000840: 6561 6420 6f66 2074 6865 2074 7261 6469  ead of the tradi
+00000850: 7469 6f6e 616c 200a 2020 2020 6461 7461  tional .    data
+00000860: 2028 6461 7461 5f78 2920 616e 6420 6163   (data_x) and ac
+00000870: 636f 6d70 616e 7969 6e67 206c 6162 656c  companying label
+00000880: 2061 7272 6179 2028 6461 7461 5f79 292e   array (data_y).
+00000890: 2054 6869 7320 6973 2062 6563 6175 7365   This is because
+000008a0: 2074 6865 2063 6f6e 6669 6775 7265 6420   the configured 
+000008b0: 434e 4e20 6d6f 6465 6c73 200a 2020 2020  CNN models .    
+000008c0: 7461 6b65 2061 7320 696e 7075 7420 7468  take as input th
+000008d0: 6520 7477 6f20 636c 6173 7365 7320 7365  e two classes se
+000008e0: 7061 7261 7465 6c79 2c20 6166 7465 7220  parately, after 
+000008f0: 7768 6963 6820 6974 2061 7574 6f6d 6174  which it automat
+00000900: 6963 616c 6c79 2061 7373 6967 6e73 2074  ically assigns t
+00000910: 6865 2031 2061 6e64 2030 206c 6162 656c  he 1 and 0 label
+00000920: 732c 2072 6573 7065 6374 6976 656c 792e  s, respectively.
+00000930: 0a0a 2020 2020 4279 2064 6566 6175 6c74  ..    By default
+00000940: 2c20 6f70 745f 6d6f 6465 6c3d 5472 7565  , opt_model=True
+00000950: 2061 6e64 206f 7074 5f61 7567 3d46 616c   and opt_aug=Fal
+00000960: 7365 2e20 4966 206f 7074 5f61 7567 3d54  se. If opt_aug=T
+00000970: 7275 652c 2074 6865 2069 6d61 6765 2073  rue, the image s
+00000980: 697a 6520 616e 640a 2020 2020 6e75 6d62  ize and.    numb
+00000990: 6572 206f 6620 6175 676d 656e 7461 7469  er of augmentati
+000009a0: 6f6e 7320 746f 2070 6572 666f 726d 206f  ons to perform o
+000009b0: 6e20 6561 6368 2069 6d61 6765 2077 696c  n each image wil
+000009c0: 6c20 6265 2069 6e63 6c75 6465 6420 6173  l be included as
+000009d0: 206f 7074 696d 697a 6162 6c65 2076 6172   optimizable var
+000009e0: 6961 626c 6573 2e0a 2020 2020 4966 2074  iables..    If t
+000009f0: 6865 206f 7074 5f6d 6178 5f6d 696e 5f70  he opt_max_min_p
+00000a00: 6978 2061 6e64 206f 7074 5f6d 6178 5f6d  ix and opt_max_m
+00000a10: 6178 5f70 6978 2061 7265 2073 6574 2c20  ax_pix are set, 
+00000a20: 7468 6520 6f70 7469 6d61 6c20 6d61 7869  the optimal maxi
+00000a30: 6d75 6d20 7069 7865 6c20 7661 6c75 6520  mum pixel value 
+00000a40: 746f 2075 7365 0a20 2020 2077 6865 6e20  to use.    when 
+00000a50: 6d69 6e2d 6d61 7820 6e6f 726d 616c 697a  min-max normaliz
+00000a60: 696e 6720 6561 6368 2062 616e 6420 7769  ing each band wi
+00000a70: 6c6c 2061 6c73 6f20 6265 206f 7074 696d  ll also be optim
+00000a80: 697a 6162 6c65 2076 6172 6961 626c 6573  izable variables
+00000a90: 2074 6861 7420 7769 6c6c 2062 6520 7475   that will be tu
+00000aa0: 6e65 6420 616e 6420 7265 7475 726e 6564  ned and returned
+00000ab0: 2e0a 2020 2020 4966 206f 7074 5f6d 6f64  ..    If opt_mod
+00000ac0: 656c 3d54 7275 652c 2061 6464 6974 696f  el=True, additio
+00000ad0: 6e61 6c20 6172 6368 6974 6563 7475 7265  nal architecture
+00000ae0: 2070 6172 616d 6574 6572 7320 7769 6c6c   parameters will
+00000af0: 2061 6c73 6f20 6265 2074 756e 6564 2e20   also be tuned. 
+00000b00: 496e 2062 6f74 6820 696e 7374 616e 6365  In both instance
+00000b10: 7320 7468 6520 7472 6169 6e69 6e67 2070  s the training p
+00000b20: 6172 616d 6574 6572 7320 0a20 2020 2077  arameters .    w
+00000b30: 696c 6c20 6265 206f 7074 696d 697a 6564  ill be optimized
+00000b40: 2c20 7768 6963 6820 696e 636c 7564 6520  , which include 
+00000b50: 7468 6520 6f70 7469 6d69 7a65 722c 206c  the optimizer, l
+00000b60: 6561 726e 696e 6720 7261 7465 2c20 6465  earning rate, de
+00000b70: 6361 792c 2061 6e64 206d 6f6d 656e 7475  cay, and momentu
+00000b80: 6d2c 2069 6620 6170 706c 6963 6162 6c65  m, if applicable
+00000b90: 2e0a 0a20 2020 204e 6f74 653a 0a20 2020  ...    Note:.   
+00000ba0: 2020 2020 2049 6620 6f70 745f 6175 6720       If opt_aug 
+00000bb0: 6973 2065 6e61 626c 6564 2c20 7468 656e  is enabled, then
+00000bc0: 2074 6865 2070 6f73 6974 6976 655f 636c   the positive_cl
+00000bd0: 6173 7320 7361 6d70 6c65 2077 696c 6c20  ass sample will 
+00000be0: 6265 2074 6865 2064 6174 6120 7468 6174  be the data that
+00000bf0: 2077 696c 6c20 6175 676d 656e 7465 642e   will augmented.
+00000c00: 0a20 2020 2020 2020 2049 7420 6973 2062  .        It is b
+00000c10: 6573 7420 746f 206b 6565 7020 626f 7468  est to keep both
+00000c20: 2063 6c61 7373 2073 697a 6573 2074 6865   class sizes the
+00000c30: 2073 616d 6520 6166 7465 7220 6175 676d   same after augm
+00000c40: 656e 7461 7469 6f6e 2c20 7468 6572 6566  entation, theref
+00000c50: 6f72 6520 6261 6c61 6e63 653d 5472 7565  ore balance=True
+00000c60: 0a20 2020 2020 2020 2062 7920 6465 6661  .        by defa
+00000c70: 756c 742c 2077 6869 6368 2077 696c 6c20  ult, which will 
+00000c80: 7472 756e 6361 7465 2074 6865 206e 6567  truncate the neg
+00000c90: 6174 6976 655f 636c 6173 7320 7361 6d70  ative_class samp
+00000ca0: 6c65 2074 6f20 6d61 7463 6820 7468 6520  le to match the 
+00000cb0: 6175 676d 656e 7465 6420 706f 7369 7469  augmented positi
+00000cc0: 7665 5f63 6c61 7373 2073 697a 652e 0a20  ve_class size.. 
+00000cd0: 2020 2020 2020 2054 6865 206f 7468 6572         The other
+00000ce0: 2063 6c61 7373 2077 696c 6c20 616c 736f   class will also
+00000cf0: 2075 6e64 6572 676f 2074 6865 2073 616d   undergo the sam
+00000d00: 6520 6461 7461 2061 7567 6d65 6e74 6174  e data augmentat
+00000d10: 696f 6e20 7465 6368 6e69 7175 6520 6275  ion technique bu
+00000d20: 7420 6f6e 6c79 206f 6e65 2069 6d61 6765  t only one image
+00000d30: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
+00000d40: 640a 2020 2020 2020 2020 7065 7220 7361  d.        per sa
+00000d50: 6d70 6c65 2c20 7468 6973 2069 7320 746f  mple, this is to
+00000d60: 2065 6e73 7572 6520 626f 7468 2063 6c61   ensure both cla
+00000d70: 7373 6573 2063 6f6e 7461 696e 2074 6865  sses contain the
+00000d80: 2073 616d 6520 6c65 7665 6c20 6f66 2076   same level of v
+00000d90: 6172 6961 7469 6f6e 2c20 6573 7065 6369  ariation, especi
+00000da0: 616c 6c79 2069 6d70 6f72 7461 6e74 0a20  ally important. 
+00000db0: 2020 2020 2020 2077 6865 6e20 6170 706c         when appl
+00000dc0: 7969 6e67 2074 6865 206d 6173 6b2d 6375  ying the mask-cu
+00000dd0: 746f 7574 2074 6563 686e 6971 7565 2074  tout technique t
+00000de0: 6f20 7468 6520 6175 676d 656e 7461 7469  o the augmentati
+00000df0: 6f6e 2070 726f 6365 6475 7265 2e0a 0a20  on procedure... 
+00000e00: 2020 2020 2020 2053 696e 6365 2074 6865         Since the
+00000e10: 206d 6178 696d 756d 206e 756d 6265 7220   maximum number 
+00000e20: 6f66 2061 7567 6d65 6e74 6174 696f 6e73  of augmentations
+00000e30: 2061 6c6c 6f77 6564 2069 7320 6261 7463   allowed is batc
+00000e40: 685f 6d61 7820 7065 7220 6561 6368 2073  h_max per each s
+00000e50: 616d 706c 652c 2069 6e20 7072 6163 7469  ample, in practi
+00000e60: 6365 206e 6567 6174 6976 655f 636c 6173  ce negative_clas
+00000e70: 7320 0a20 2020 2020 2020 2073 686f 756c  s .        shoul
+00000e80: 6420 636f 6e74 6169 6e20 6261 7463 685f  d contain batch_
+00000e90: 6d61 7820 7469 6d65 7320 7468 6520 7369  max times the si
+00000ea0: 7a65 206f 6620 706f 7369 7469 7665 5f63  ze of positive_c
+00000eb0: 6c61 7373 2e20 4475 7269 6e67 2074 6865  lass. During the
+00000ec0: 206f 7074 696d 697a 6174 696f 6e20 7072   optimization pr
+00000ed0: 6f63 6564 7572 652c 2069 6620 616e 200a  ocedure, if an .
+00000ee0: 2020 2020 2020 2020 6175 676d 656e 7461          augmenta
+00000ef0: 7469 6f6e 2062 6174 6368 2073 697a 6520  tion batch size 
+00000f00: 6f66 2031 3030 2069 7320 6173 7365 7365  of 100 is assese
+00000f10: 6420 616e 6420 706f 7369 7469 7665 2063  d and positive c
+00000f20: 6c61 7373 2063 6f6e 7461 696e 7320 6e20  lass contains n 
+00000f30: 7361 6d70 6c65 732c 2074 6865 6e20 3130  samples, then 10
+00000f40: 302a 6e20 6175 676d 656e 7465 6420 696d  0*n augmented im
+00000f50: 6167 6573 2077 696c 6c20 6265 2063 7265  ages will be cre
+00000f60: 6174 6564 2c20 0a20 2020 2020 2020 2061  ated, .        a
+00000f70: 6e64 2074 6865 7265 666f 7265 2064 7572  nd therefore dur
+00000f80: 696e 6720 7468 6174 2070 6172 7469 6375  ing that particu
+00000f90: 6c61 7220 7472 6961 6c20 7468 6520 6669  lar trial the fi
+00000fa0: 7273 7420 3130 302a 6e20 7361 6d70 6c65  rst 100*n sample
+00000fb0: 7320 6672 6f6d 206e 6567 6174 6976 655f  s from negative_
+00000fc0: 636c 6173 7320 7769 6c6c 2062 6520 7573  class will be us
+00000fd0: 6564 2c20 6966 2061 7661 696c 6162 6c65  ed, if available
+00000fe0: 2e20 0a20 2020 2020 2020 2054 6f20 7573  . .        To us
+00000ff0: 6520 7468 6520 656e 7469 7265 206e 6567  e the entire neg
+00001000: 6174 6976 655f 636c 6173 7320 7361 6d70  ative_class samp
+00001010: 6c65 2072 6567 6172 646c 6573 7320 6f66  le regardless of
+00001020: 2074 6865 206e 756d 6265 7220 6175 676d   the number augm
+00001030: 656e 7461 7469 6f6e 7320 7065 7266 6f72  entations perfor
+00001040: 6d65 642c 2073 6574 2062 616c 616e 6365  med, set balance
+00001050: 3d46 616c 7365 2e0a 2020 2020 0a20 2020  =False..    .   
+00001060: 2020 2020 2054 6865 206d 696e 5f70 6978       The min_pix
+00001070: 656c 2061 6e64 206d 6178 5f70 6978 656c  el and max_pixel
+00001080: 2076 616c 7565 2077 696c 6c20 6265 2075   value will be u
+00001090: 7365 6420 746f 206d 696e 2d6d 6178 206e  sed to min-max n
+000010a0: 6f72 6d61 6c69 7a65 2074 6865 2069 6d61  ormalize the ima
+000010b0: 6765 732c 2069 6620 6e6f 726d 616c 697a  ges, if normaliz
+000010c0: 653d 5472 7565 2e20 5468 6520 6f70 745f  e=True. The opt_
+000010d0: 6d61 785f 6d69 6e5f 7069 780a 2020 2020  max_min_pix.    
+000010e0: 2020 2020 616e 6420 6f70 745f 6d61 785f      and opt_max_
+000010f0: 6d61 785f 7069 782c 2077 6865 6e20 7365  max_pix, when se
+00001100: 742c 2077 696c 6c20 6265 2075 7365 6420  t, will be used 
+00001110: 696e 7374 6561 6420 6475 7269 6e67 2074  instead during t
+00001120: 6865 206f 7074 696d 697a 6174 696f 6e20  he optimization 
+00001130: 7072 6f63 6564 7572 652c 2073 6f20 6173  procedure, so as
+00001140: 2074 6f20 6465 7465 726d 696e 650a 2020   to determine.  
+00001150: 2020 2020 2020 7768 6174 206f 7074 696d        what optim
+00001160: 616c 206d 6178 696d 756d 2076 616c 7565  al maximum value
+00001170: 2074 6f20 7573 6520 7768 656e 206e 6f72   to use when nor
+00001180: 6d61 6c69 7a69 6e67 2074 6865 2069 6d61  malizing the ima
+00001190: 6765 732e 2054 6869 7320 6973 2069 6d70  ges. This is imp
+000011a0: 6f72 7461 6e74 2077 6865 6e20 6465 616c  ortant when deal
+000011b0: 696e 6720 7769 7468 2064 6565 702d 7375  ing with deep-su
+000011c0: 7276 6579 2064 6174 612e 200a 2020 2020  rvey data. .    
+000011d0: 2020 2020 4966 206f 7074 696d 697a 696e      If optimizin
+000011e0: 6720 7468 6520 6e6f 726d 616c 697a 6174  g the normalizat
+000011f0: 696f 6e20 7363 6865 6d65 2c20 7468 6520  ion scheme, the 
+00001200: 6465 6661 756c 7420 6d69 6e5f 7069 7865  default min_pixe
+00001210: 6c20 7769 6c6c 2062 6520 7365 7420 746f  l will be set to
+00001220: 207a 6572 6f2c 2061 7320 7375 6368 206f   zero, as such o
+00001230: 6e6c 7920 7468 6520 6f70 7469 6d61 6c20  nly the optimal 
+00001240: 6d61 785f 7069 7865 6c20 0a20 2020 2020  max_pixel .     
+00001250: 2020 2066 6f72 2065 7665 7279 2062 616e     for every ban
+00001260: 6420 7769 6c6c 2062 6520 6f75 7470 7574  d will be output
+00001270: 2e0a 0a20 2020 2041 7267 733a 0a20 2020  ...    Args:.   
+00001280: 2020 2020 2070 6f73 6974 6976 655f 636c       positive_cl
+00001290: 6173 7320 286e 6461 7272 6179 293a 2054  ass (ndarray): T
+000012a0: 6865 2073 616d 706c 6573 2066 6f72 2074  he samples for t
+000012b0: 6865 2066 6972 7374 2063 6c61 7373 2073  he first class s
+000012c0: 686f 756c 6420 6265 2070 6173 7365 642c  hould be passed,
+000012d0: 2077 6869 6368 2077 696c 6c20 6175 746f   which will auto
+000012e0: 6d61 7469 6361 6c6c 7920 0a20 2020 2020  matically .     
+000012f0: 2020 2020 2020 2062 6520 6173 7369 676e         be assign
+00001300: 6564 2074 6865 2070 6f73 6974 6976 6520  ed the positive 
+00001310: 6c61 6265 6c20 2731 272e 0a20 2020 2020  label '1'..     
+00001320: 2020 206e 6567 6174 6976 655f 636c 6173     negative_clas
+00001330: 7320 286e 6461 7272 6179 293a 2054 6865  s (ndarray): The
+00001340: 2073 616d 706c 6573 2066 6f72 2074 6865   samples for the
+00001350: 2073 6563 6f6e 6420 636c 6173 7320 7368   second class sh
+00001360: 6f75 6c64 2062 6520 7061 7373 6564 2c20  ould be passed, 
+00001370: 7768 6963 6820 7769 6c6c 2061 7574 6f6d  which will autom
+00001380: 6174 6963 616c 6c79 200a 2020 2020 2020  atically .      
+00001390: 2020 2020 2020 6265 2061 7373 6967 6e65        be assigne
+000013a0: 6420 7468 6520 6e65 6761 7469 7665 206c  d the negative l
+000013b0: 6162 656c 2027 3027 2e0a 2020 2020 2020  abel '0'..      
+000013c0: 2020 696d 675f 6e75 6d5f 6368 616e 6e65    img_num_channe
+000013d0: 6c73 2028 696e 7429 3a20 5468 6520 6e75  ls (int): The nu
+000013e0: 6d62 6572 206f 6620 6669 6c74 6572 732e  mber of filters.
+000013f0: 2044 6566 6175 6c74 7320 746f 2031 2e0a   Defaults to 1..
+00001400: 2020 2020 2020 2020 6e6f 726d 616c 697a          normaliz
+00001410: 6520 2862 6f6f 6c2c 206f 7074 696f 6e61  e (bool, optiona
+00001420: 6c29 3a20 4966 2054 7275 6520 7468 6520  l): If True the 
+00001430: 6461 7461 2077 696c 6c20 6265 206d 696e  data will be min
+00001440: 2d6d 6178 206e 6f72 6d61 6c69 7a65 6420  -max normalized 
+00001450: 7573 696e 6720 7468 6520 0a20 2020 2020  using the .     
+00001460: 2020 2020 2020 2069 6e70 7574 206d 696e         input min
+00001470: 2061 6e64 206d 6178 2070 6978 656c 732e   and max pixels.
+00001480: 2044 6566 6175 6c74 7320 746f 2054 7275   Defaults to Tru
+00001490: 652e 0a20 2020 2020 2020 206d 696e 5f70  e..        min_p
+000014a0: 6978 656c 2028 696e 742c 206f 7074 696f  ixel (int, optio
+000014b0: 6e61 6c29 3a20 5468 6520 6d69 6e69 6d75  nal): The minimu
+000014c0: 6d20 7069 7865 6c20 636f 756e 742c 2070  m pixel count, p
+000014d0: 6978 656c 7320 7769 7468 2063 6f75 6e74  ixels with count
+000014e0: 7320 0a20 2020 2020 2020 2020 2020 2062  s .            b
+000014f0: 656c 6f77 2074 6869 7320 7468 7265 7368  elow this thresh
+00001500: 6f6c 6420 7769 6c6c 2062 6520 7365 7420  old will be set 
+00001510: 746f 2074 6869 7320 6c69 6d69 742e 2044  to this limit. D
+00001520: 6566 6175 6c74 7320 746f 2030 2e0a 2020  efaults to 0..  
+00001530: 2020 2020 2020 6d61 785f 7069 7865 6c20        max_pixel 
+00001540: 2869 6e74 2c20 6c69 7374 2c20 6f70 7469  (int, list, opti
+00001550: 6f6e 616c 293a 2054 6865 206d 6178 696d  onal): The maxim
+00001560: 756d 2070 6978 656c 2063 6f75 6e74 2c20  um pixel count, 
+00001570: 7069 7865 6c73 2077 6974 6820 636f 756e  pixels with coun
+00001580: 7473 200a 2020 2020 2020 2020 2020 2020  ts .            
+00001590: 6162 6f76 6520 7468 6973 2074 6872 6573  above this thres
+000015a0: 686f 6c64 2077 696c 6c20 6265 2073 6574  hold will be set
+000015b0: 2074 6f20 7468 6973 206c 696d 6974 2e20   to this limit. 
+000015c0: 4465 6661 756c 7473 2074 6f20 3130 302e  Defaults to 100.
+000015d0: 2049 6620 696d 675f 6e75 6d5f 6368 616e   If img_num_chan
+000015e0: 6e65 6c73 0a20 2020 2020 2020 2020 2020  nels.           
+000015f0: 2069 7320 6e6f 7420 312c 2074 6865 206d   is not 1, the m
+00001600: 6178 5f70 6978 656c 2073 686f 756c 6420  ax_pixel should 
+00001610: 6265 2061 206c 6973 7420 636f 6e74 6169  be a list contai
+00001620: 6e69 6e67 2074 776f 2076 616c 7565 732c  ning two values,
+00001630: 206f 6e65 2066 6f72 2065 6163 6820 6261   one for each ba
+00001640: 6e64 2e0a 2020 2020 2020 2020 7661 6c5f  nd..        val_
+00001650: 706f 7369 7469 7665 2028 6e64 6172 7261  positive (ndarra
+00001660: 792c 206f 7074 696f 6e61 6c29 3a20 506f  y, optional): Po
+00001670: 7369 7469 7665 2063 6c61 7373 2064 6174  sitive class dat
+00001680: 6120 746f 2062 6520 7573 6564 2066 6f72  a to be used for
+00001690: 2076 616c 6964 6174 696f 6e2e 2044 6566   validation. Def
+000016a0: 6175 6c74 7320 746f 204e 6f6e 652e 0a20  aults to None.. 
+000016b0: 2020 2020 2020 2076 616c 5f6e 6567 6174         val_negat
+000016c0: 6976 6520 286e 6461 7272 6179 2c20 6f70  ive (ndarray, op
+000016d0: 7469 6f6e 616c 293a 204e 6567 6174 6976  tional): Negativ
+000016e0: 6520 636c 6173 7320 6461 7461 2074 6f20  e class data to 
+000016f0: 6265 2075 7365 6420 666f 7220 7661 6c69  be used for vali
+00001700: 6461 7469 6f6e 2e20 4465 6661 756c 7473  dation. Defaults
+00001710: 2074 6f20 4e6f 6e65 2e0a 2020 2020 2020   to None..      
+00001720: 2020 7465 7374 5f70 6f73 6974 6976 6520    test_positive 
+00001730: 286e 6461 7272 6179 2c20 6f70 7469 6f6e  (ndarray, option
+00001740: 616c 293a 2050 6f73 6974 6976 6520 636c  al): Positive cl
+00001750: 6173 7320 6461 7461 2074 6f20 6265 2075  ass data to be u
+00001760: 7365 6420 666f 7220 706f 7374 2d74 7269  sed for post-tri
+00001770: 616c 2074 6573 7469 6e67 2e20 4465 6661  al testing. Defa
+00001780: 756c 7473 2074 6f20 4e6f 6e65 2e0a 2020  ults to None..  
+00001790: 2020 2020 2020 7465 7374 5f6e 6567 6174        test_negat
+000017a0: 6976 6520 286e 6461 7272 6179 2c20 6f70  ive (ndarray, op
+000017b0: 7469 6f6e 616c 293a 204e 6567 6174 6976  tional): Negativ
+000017c0: 6520 636c 6173 7320 6461 7461 2074 6f20  e class data to 
+000017d0: 6265 2075 7365 6420 666f 7220 706f 7374  be used for post
+000017e0: 2d74 7269 616c 2074 6573 7469 6e67 2e20  -trial testing. 
+000017f0: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
+00001800: 2e0a 2020 2020 2020 2020 7472 6169 6e5f  ..        train_
+00001810: 6570 6f63 6873 2028 696e 7429 3a20 4e75  epochs (int): Nu
+00001820: 6d62 6572 206f 6620 6570 6f63 6873 2074  mber of epochs t
+00001830: 6f20 7468 6520 7472 6169 6e20 7468 6520  o the train the 
+00001840: 434e 4e20 746f 2064 7572 696e 6720 7468  CNN to during th
+00001850: 6520 6f70 7469 6d69 7a61 7469 6f6e 2074  e optimization t
+00001860: 7269 616c 732e 2044 6566 6175 6c74 7320  rials. Defaults 
+00001870: 746f 2032 352e 0a20 2020 2020 2020 206d  to 25..        m
+00001880: 6574 7269 6320 2873 7472 293a 2041 7373  etric (str): Ass
+00001890: 6573 6d65 6e74 206d 6574 7269 6320 746f  esment metric to
+000018a0: 2075 7365 2077 6865 6e20 626f 7468 2070   use when both p
+000018b0: 7275 6e69 6e67 2061 6e64 2073 636f 7269  runing and scori
+000018c0: 6e67 2074 6865 2068 7970 6572 7061 7261  ng the hyperpara
+000018d0: 6d65 7465 7220 6f70 7469 6d69 7a61 7469  meter optimizati
+000018e0: 6f6e 2074 7269 616c 2e0a 2020 2020 2020  on trial..      
+000018f0: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
+00001900: 6f20 276c 6f73 7327 2e20 4f70 7469 6f6e  o 'loss'. Option
+00001910: 7320 696e 636c 7564 653a 2027 6c6f 7373  s include: 'loss
+00001920: 2720 2762 696e 6172 795f 6163 6375 7261  ' 'binary_accura
+00001930: 6379 272c 2027 6631 5f73 636f 7265 2720  cy', 'f1_score' 
+00001940: 2761 6c6c 2720 6f72 2074 6865 2076 616c  'all' or the val
+00001950: 6964 6174 696f 6e20 6571 7569 7661 6c65  idation equivale
+00001960: 6e74 7320 2865 2e67 2e20 2776 616c 5f6c  nts (e.g. 'val_l
+00001970: 6f73 7327 292e 0a20 2020 2020 2020 2070  oss')..        p
+00001980: 6174 6965 6e63 6520 2869 6e74 293a 204e  atience (int): N
+00001990: 756d 6265 7220 6f66 2065 706f 6368 7320  umber of epochs 
+000019a0: 7769 7468 6f75 7420 696d 7072 6f76 656d  without improvem
+000019b0: 656e 7420 6265 666f 7265 2074 6865 206f  ent before the o
+000019c0: 7074 696d 697a 6174 696f 6e20 7472 6961  ptimization tria
+000019d0: 6c20 6973 2074 6572 6d69 6e61 7465 642e  l is terminated.
+000019e0: 2044 6566 6175 6c74 7320 746f 2030 2c20   Defaults to 0, 
+000019f0: 7768 6963 680a 2020 2020 2020 2020 2020  which.          
+00001a00: 2020 6469 7361 626c 6573 2074 6869 7320    disables this 
+00001a10: 6665 6174 7572 652e 0a20 2020 2020 2020  feature..       
+00001a20: 2061 7665 7261 6765 2028 626f 6f6c 293a   average (bool):
+00001a30: 2049 6620 4661 6c73 652c 2074 6865 2064   If False, the d
+00001a40: 6573 6967 6e61 7465 6420 6d65 7472 6963  esignated metric
+00001a50: 2077 696c 6c20 6265 2063 616c 6375 6c61   will be calcula
+00001a60: 7465 6420 6163 636f 7264 696e 6720 746f  ted according to
+00001a70: 2069 7473 2076 616c 7565 2061 7420 7468   its value at th
+00001a80: 6520 656e 6420 6f66 2074 6865 2074 7261  e end of the tra
+00001a90: 696e 5f65 706f 6368 732e 200a 2020 2020  in_epochs. .    
+00001aa0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00001ab0: 2074 6865 206d 6574 7269 6320 7769 6c6c   the metric will
+00001ac0: 2062 6520 6176 6572 6167 6564 206f 7574   be averaged out
+00001ad0: 2061 6372 6f73 7320 616c 6c20 7472 6169   across all trai
+00001ae0: 6e5f 6570 6f63 6873 2e20 4465 6661 756c  n_epochs. Defaul
+00001af0: 7473 2074 6f20 5472 7565 2e0a 2020 2020  ts to True..    
+00001b00: 2020 2020 6f70 745f 6d6f 6465 6c20 2862      opt_model (b
+00001b10: 6f6f 6c29 3a20 4966 2054 7275 652c 2074  ool): If True, t
+00001b20: 6865 2061 7263 6869 7465 6374 7572 6520  he architecture 
+00001b30: 7061 7261 6d65 7465 7273 2077 696c 6c20  parameters will 
+00001b40: 6265 206f 7074 696d 697a 6564 2e20 4465  be optimized. De
+00001b50: 6661 756c 7473 2074 6f20 5472 7565 2e0a  faults to True..
+00001b60: 2020 2020 2020 2020 6f70 745f 6175 6720          opt_aug 
+00001b70: 2862 6f6f 6c29 3a20 4966 2054 7275 652c  (bool): If True,
+00001b80: 2074 6865 2061 7567 6d65 6e74 6174 696f   the augmentatio
+00001b90: 6e20 7072 6f63 6564 7572 6520 7769 6c6c  n procedure will
+00001ba0: 2062 6520 6f70 7469 6d69 7a65 642e 2044   be optimized. D
+00001bb0: 6566 6175 6c74 7320 746f 2046 616c 7365  efaults to False
+00001bc0: 2e0a 2020 2020 2020 2020 6261 7463 685f  ..        batch_
+00001bd0: 6d69 6e20 2869 6e74 293a 2054 6865 206d  min (int): The m
+00001be0: 696e 696d 756d 206e 756d 6265 7220 6f66  inimum number of
+00001bf0: 2061 7567 6d65 6e74 6174 696f 6e73 2074   augmentations t
+00001c00: 6f20 7065 7266 6f72 6d20 7065 7220 696d  o perform per im
+00001c10: 6167 6520 6f6e 2074 6865 2070 6f73 6974  age on the posit
+00001c20: 6976 6520 636c 6173 732c 206f 6e6c 7920  ive class, only 
+00001c30: 6170 706c 6963 6162 6c65 200a 2020 2020  applicable .    
+00001c40: 2020 2020 2020 2020 6966 206f 7074 5f61          if opt_a
+00001c50: 7567 3d54 7275 652e 2044 6566 6175 6c74  ug=True. Default
+00001c60: 7320 746f 2032 2e0a 2020 2020 2020 2020  s to 2..        
+00001c70: 6261 7463 685f 6d61 7820 2869 6e74 293a  batch_max (int):
+00001c80: 2054 6865 206d 6178 696d 756d 206e 756d   The maximum num
+00001c90: 6265 7220 6f66 2061 7567 6d65 6e74 6174  ber of augmentat
+00001ca0: 696f 6e73 2074 6f20 7065 7266 6f72 6d20  ions to perform 
+00001cb0: 7065 7220 696d 6167 6520 6f6e 2074 6865  per image on the
+00001cc0: 2070 6f73 6974 6976 6520 636c 6173 732c   positive class,
+00001cd0: 206f 6e6c 7920 6170 706c 6963 6162 6c65   only applicable
+00001ce0: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
+00001cf0: 206f 7074 5f61 7567 3d54 7275 652e 2044   opt_aug=True. D
+00001d00: 6566 6175 6c74 7320 746f 2032 352e 0a20  efaults to 25.. 
+00001d10: 2020 2020 2020 2062 6174 6368 5f6f 7468         batch_oth
+00001d20: 6572 2028 696e 7429 3a20 5468 6520 6e75  er (int): The nu
+00001d30: 6d62 6572 206f 6620 6175 676d 656e 7461  mber of augmenta
+00001d40: 7469 6f6e 7320 746f 2070 6572 666f 726d  tions to perform
+00001d50: 2074 6f20 7468 6520 6f74 6865 7220 636c   to the other cl
+00001d60: 6173 732c 2070 7265 7375 6d65 6420 746f  ass, presumed to
+00001d70: 2062 6520 7468 6520 6d61 6a6f 7269 7479   be the majority
+00001d80: 2063 6c61 7373 2e0a 2020 2020 2020 2020   class..        
+00001d90: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
+00001da0: 312e 2054 6869 7320 6973 2064 6f6e 6520  1. This is done 
+00001db0: 746f 2065 6e73 7572 6520 6175 676d 656e  to ensure augmen
+00001dc0: 7461 7469 6f6e 2074 6563 686e 6971 7565  tation technique
+00001dd0: 7320 6172 6520 6170 706c 6965 6420 636f  s are applied co
+00001de0: 6e73 6973 7465 6e74 6c79 2061 6372 6f73  nsistently acros
+00001df0: 7320 626f 7468 2063 6c61 7373 6573 2e0a  s both classes..
+00001e00: 2020 2020 2020 2020 696d 6167 655f 7369          image_si
+00001e10: 7a65 5f6d 696e 2028 696e 7429 3a20 5468  ze_min (int): Th
+00001e20: 6520 6d69 6e69 6d75 6d20 696d 6167 6520  e minimum image 
+00001e30: 7369 7a65 2074 6f20 6173 7365 7373 2c20  size to assess, 
+00001e40: 6f6e 6c79 2061 7070 6c69 6361 626c 6520  only applicable 
+00001e50: 6966 206f 7074 5f61 7567 3d54 7275 652e  if opt_aug=True.
+00001e60: 2044 6566 6175 6c74 7320 746f 2035 302e   Defaults to 50.
+00001e70: 0a20 2020 2020 2020 2069 6d61 6765 5f73  .        image_s
+00001e80: 697a 655f 6d61 7820 2869 6e74 293a 2054  ize_max (int): T
+00001e90: 6865 206d 6178 696d 756d 2069 6d61 6765  he maximum image
+00001ea0: 2073 697a 6520 746f 2061 7373 6573 732c   size to assess,
+00001eb0: 206f 6e6c 7920 6170 706c 6963 6162 6c65   only applicable
+00001ec0: 2069 6620 6f70 745f 6175 673d 5472 7565   if opt_aug=True
+00001ed0: 2e20 4465 6661 756c 7473 2074 6f20 3130  . Defaults to 10
+00001ee0: 302e 0a20 2020 2020 2020 206f 7074 5f6d  0..        opt_m
+00001ef0: 6178 5f6d 696e 5f70 6978 2028 696e 742c  ax_min_pix (int,
+00001f00: 206f 7074 696f 6e61 6c29 3a20 5468 6520   optional): The 
+00001f10: 6d69 6e69 6d75 6d20 6d61 7820 7069 7865  minimum max pixe
+00001f20: 6c20 7661 6c75 6520 746f 2075 7365 2077  l value to use w
+00001f30: 6865 6e20 7475 6e69 6e67 2074 6865 206e  hen tuning the n
+00001f40: 6f72 6d61 6c69 7a61 7469 6f6e 2070 726f  ormalization pro
+00001f50: 6365 6475 7265 2c20 0a20 2020 2020 2020  cedure, .       
+00001f60: 2020 2020 206f 6e6c 7920 6170 706c 6963       only applic
+00001f70: 6162 6c65 2069 6620 6f70 745f 6175 673d  able if opt_aug=
+00001f80: 5472 7565 2e20 4465 6661 756c 7473 2074  True. Defaults t
+00001f90: 6f20 4e6f 6e65 2e0a 2020 2020 2020 2020  o None..        
+00001fa0: 6f70 745f 6d61 785f 6d61 785f 7069 7820  opt_max_max_pix 
+00001fb0: 2869 6e74 2c20 6f70 7469 6f6e 616c 293a  (int, optional):
+00001fc0: 2054 6865 206d 6178 696d 756d 206d 6178   The maximum max
+00001fd0: 2070 6978 656c 2076 616c 7565 2074 6f20   pixel value to 
+00001fe0: 7573 6520 7768 656e 2074 756e 696e 6720  use when tuning 
+00001ff0: 7468 6520 6e6f 726d 616c 697a 6174 696f  the normalizatio
+00002000: 6e20 7072 6f63 6564 7572 652c 200a 2020  n procedure, .  
+00002010: 2020 2020 2020 2020 2020 6f6e 6c79 2061            only a
+00002020: 7070 6c69 6361 626c 6520 6966 206f 7074  pplicable if opt
+00002030: 5f61 7567 3d54 7275 652e 2044 6566 6175  _aug=True. Defau
+00002040: 6c74 7320 746f 204e 6f6e 652e 0a20 2020  lts to None..   
+00002050: 2020 2020 2073 6869 6674 2028 696e 7429       shift (int)
+00002060: 3a20 5468 6520 6d61 7820 616c 6c6f 7765  : The max allowe
+00002070: 6420 7665 7274 6963 616c 2f68 6f72 697a  d vertical/horiz
+00002080: 6f6e 7461 6c20 7368 6966 7473 2074 6f20  ontal shifts to 
+00002090: 7573 6520 6475 7269 6e67 2074 6865 2064  use during the d
+000020a0: 6174 6120 6175 676d 656e 7461 7469 6f6e  ata augmentation
+000020b0: 2072 6f75 7469 6e65 2c20 6f6e 6c79 2061   routine, only a
+000020c0: 7070 6c69 6361 626c 650a 2020 2020 2020  pplicable.      
+000020d0: 2020 2020 2020 6966 206f 7074 5f61 7567        if opt_aug
+000020e0: 3d54 7275 652e 2044 6566 6175 6c74 7320  =True. Defaults 
+000020f0: 746f 2031 3020 7069 7865 6c73 2e0a 2020  to 10 pixels..  
+00002100: 2020 2020 2020 6d61 736b 5f73 697a 6520        mask_size 
+00002110: 2869 6e74 2c20 6f70 7469 6f6e 616c 293a  (int, optional):
+00002120: 2049 6620 656e 6162 6c65 642c 2074 6869   If enabled, thi
+00002130: 7320 7769 6c6c 2073 6574 2074 6865 2070  s will set the p
+00002140: 6978 656c 206c 656e 6774 6820 6f66 2061  ixel length of a
+00002150: 2073 7175 6172 6520 6375 746f 7574 2c20   square cutout, 
+00002160: 746f 2062 6520 7261 6e64 6f6d 6c79 2070  to be randomly p
+00002170: 6c61 6365 640a 2020 2020 2020 2020 2020  laced.          
+00002180: 2020 736f 6d65 7768 6572 6520 696e 2074    somewhere in t
+00002190: 6865 2061 7567 6d65 6e74 6564 2069 6d61  he augmented ima
+000021a0: 6765 2e20 5468 6973 2063 7574 6f75 7420  ge. This cutout 
+000021b0: 7769 6c6c 2072 6570 6c61 6365 2074 6865  will replace the
+000021c0: 2069 6d61 6765 2076 616c 7565 7320 7769   image values wi
+000021d0: 7468 2030 2c20 7468 6572 6566 6f72 6520  th 0, therefore 
+000021e0: 7365 7276 696e 6720 6173 2061 200a 2020  serving as a .  
+000021f0: 2020 2020 2020 2020 2020 7265 6775 6c61            regula
+00002200: 7269 7a65 722e 204f 6e6c 7920 6170 706c  rizer. Only appl
+00002210: 6963 6162 6c65 2069 6620 6f70 745f 6175  icable if opt_au
+00002220: 673d 5472 7565 2e20 4465 6661 756c 7473  g=True. Defaults
+00002230: 2074 6f20 4e6f 6e65 2e0a 2020 2020 2020   to None..      
+00002240: 2020 6e75 6d5f 6d61 736b 7320 2869 6e74    num_masks (int
+00002250: 2c20 6f70 7469 6f6e 616c 293a 2054 6865  , optional): The
+00002260: 206e 756d 6265 7220 6f66 206d 6173 6b73   number of masks
+00002270: 2074 6f20 6372 6561 7465 2c20 746f 2062   to create, to b
+00002280: 6520 7573 6564 2061 6c6f 6e67 7369 6465  e used alongside
+00002290: 2074 6865 206d 6173 6b5f 7369 7a65 2070   the mask_size p
+000022a0: 6172 616d 6574 6572 2e20 4966 200a 2020  arameter. If .  
+000022b0: 2020 2020 2020 2020 2020 7468 6973 2069            this i
+000022c0: 7320 7365 7420 746f 2061 2076 616c 7565  s set to a value
+000022d0: 2067 7265 6174 6572 2074 6861 6e20 6f6e   greater than on
+000022e0: 652c 206f 7665 726c 6170 206d 6179 206f  e, overlap may o
+000022f0: 6363 7572 2e20 0a20 2020 2020 2020 2076  ccur. .        v
+00002300: 6572 626f 7365 2028 696e 7429 3a20 436f  erbose (int): Co
+00002310: 6e74 726f 6c73 2074 6865 2061 6d6f 756e  ntrols the amoun
+00002320: 7420 6f66 206f 7574 7075 7420 7072 696e  t of output prin
+00002330: 7465 6420 6475 7269 6e67 2074 6865 2074  ted during the t
+00002340: 7261 696e 696e 6720 7072 6f63 6573 732e  raining process.
+00002350: 2041 2076 616c 7565 206f 6620 3020 6973   A value of 0 is
+00002360: 2066 6f72 2073 696c 656e 7420 6d6f 6465   for silent mode
+00002370: 2c20 0a20 2020 2020 2020 2020 2020 2061  , .            a
+00002380: 2076 616c 7565 206f 6620 3120 6973 2075   value of 1 is u
+00002390: 7365 6420 666f 7220 7072 6f67 7265 7373  sed for progress
+000023a0: 2062 6172 206d 6f64 652c 2061 6e64 2032   bar mode, and 2
+000023b0: 2066 6f72 206f 6e65 206c 696e 6520 7065   for one line pe
+000023c0: 7220 6570 6f63 6820 6d6f 6465 2e20 4465  r epoch mode. De
+000023d0: 6661 756c 7473 2074 6f20 312e 0a20 2020  faults to 1..   
+000023e0: 2020 2020 206f 7074 5f63 7620 2869 6e74       opt_cv (int
+000023f0: 293a 2043 726f 7373 2d76 616c 6964 6174  ): Cross-validat
+00002400: 696f 6e73 2074 6f20 7065 7266 6f72 6d20  ions to perform 
+00002410: 7768 656e 2061 7373 6573 7369 6e67 2074  when assessing t
+00002420: 6865 2070 6572 666f 726d 616e 6365 2061  he performance a
+00002430: 7420 6561 6368 0a20 2020 2020 2020 2020  t each.         
+00002440: 2020 2068 7970 6572 7061 7261 6d65 7465     hyperparamete
+00002450: 7220 6f70 7469 6d69 7a61 7469 6f6e 2074  r optimization t
+00002460: 7269 616c 2e20 466f 7220 6578 616d 706c  rial. For exampl
+00002470: 652c 2069 6620 6376 3d33 2c20 7468 656e  e, if cv=3, then
+00002480: 2065 6163 6820 6f70 7469 6d69 7a61 7469   each optimizati
+00002490: 6f6e 2074 7269 616c 0a20 2020 2020 2020  on trial.       
+000024a0: 2020 2020 2077 696c 6c20 6265 2061 7373       will be ass
+000024b0: 6573 7365 6420 6163 636f 7264 696e 6720  essed according 
+000024c0: 746f 2074 6865 2033 2d66 6f6c 6420 6372  to the 3-fold cr
+000024d0: 6f73 7320 7661 6c69 6461 7469 6f6e 2061  oss validation a
+000024e0: 6363 7572 6163 792e 2044 6566 6175 6c74  ccuracy. Default
+000024f0: 7320 746f 2031 302e 0a20 2020 2020 2020  s to 10..       
+00002500: 2020 2020 204e 4f54 453a 2054 6865 2068       NOTE: The h
+00002510: 6967 6865 7220 7468 6973 206e 756d 6265  igher this numbe
+00002520: 722c 2074 6865 206c 6f6e 6765 7220 7468  r, the longer th
+00002530: 6520 6f70 7469 6d69 7a61 7469 6f6e 2077  e optimization w
+00002540: 696c 6c20 7461 6b65 2e0a 2020 2020 2020  ill take..      
+00002550: 2020 6261 6c61 6e63 6520 2862 6f6f 6c2c    balance (bool,
+00002560: 206f 7074 696f 6e61 6c29 3a20 5468 6973   optional): This
+00002570: 2077 696c 6c20 6465 7465 726d 696e 6520   will determine 
+00002580: 7768 6574 6865 7220 7468 6520 7477 6f20  whether the two 
+00002590: 636c 6173 7365 730a 2020 2020 2020 2020  classes.        
+000025a0: 2020 2020 6172 6520 6b65 7074 2074 6865      are kept the
+000025b0: 2073 616d 6520 7369 7a65 2064 7572 696e   same size durin
+000025c0: 6720 6f70 7469 6d69 7a61 7469 6f6e 2c20  g optimization, 
+000025d0: 6170 706c 6963 6162 6c65 2069 6620 7475  applicable if tu
+000025e0: 6e69 6e67 2074 6865 2061 7567 6d65 6e74  ning the augment
+000025f0: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
+00002600: 2020 7061 7261 6d65 7465 7273 2e20 4465    parameters. De
+00002610: 6661 756c 7473 2074 6f20 5472 7565 2e0a  faults to True..
+00002620: 2020 2020 2020 2020 636c 6620 2873 7472          clf (str
+00002630: 293a 2043 616e 2062 6520 2761 6c65 786e  ): Can be 'alexn
+00002640: 6574 2720 6f72 2027 6375 7374 6f6d 5f63  et' or 'custom_c
+00002650: 6e6e 2720 666f 7220 7468 6520 6375 7374  nn' for the cust
+00002660: 6f6d 6c79 2063 6f6e 6669 6775 7265 642c  omly configured,
+00002670: 2073 6861 6c6c 6f77 6572 206d 6f64 656c   shallower model
+00002680: 2e20 4361 6e20 616c 736f 2062 6520 0a20  . Can also be . 
+00002690: 2020 2020 2020 2020 2020 2027 7667 6731             'vgg1
+000026a0: 3627 206f 7220 2772 6573 6e65 7431 3827  6' or 'resnet18'
+000026b0: 2e0a 2020 2020 2020 2020 6c69 6d69 745f  ..        limit_
+000026c0: 7365 6172 6368 2028 626f 6f6c 293a 2057  search (bool): W
+000026d0: 6865 7468 6572 2074 6f20 6578 7061 6e64  hether to expand
+000026e0: 2074 6865 2068 7970 6572 7061 7261 6d65   the hyperparame
+000026f0: 7465 7220 7365 6172 6368 2073 7061 6365  ter search space
+00002700: 2c20 6f6e 6c79 2069 6620 6170 706c 6963  , only if applic
+00002710: 6162 6c65 2069 6620 636c 663d 2761 6c65  able if clf='ale
+00002720: 786e 6574 272c 2066 6f72 2065 7861 6d70  xnet', for examp
+00002730: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+00002740: 7468 6973 2077 696c 6c20 696e 636c 7564  this will includ
+00002750: 6520 7468 6520 7475 6e69 6e67 206f 6620  e the tuning of 
+00002760: 7468 6520 696e 6469 7669 6475 616c 206c  the individual l
+00002770: 6179 6572 2070 6172 616d 6574 6572 7320  ayer parameters 
+00002780: 7375 6368 2061 7320 7468 6520 6e75 6d62  such as the numb
+00002790: 6572 206f 6620 6669 6c74 6572 2c20 7369  er of filter, si
+000027a0: 7a65 2026 2073 7472 6964 652e 0a20 2020  ze & stride..   
+000027b0: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
+000027c0: 7320 746f 2054 7275 6520 6475 6520 746f  s to True due to
+000027d0: 206d 656d 6f72 7920 616c 6c6f 6361 7469   memory allocati
+000027e0: 6f6e 2069 7373 7565 7320 7768 656e 2068  on issues when h
+000027f0: 616e 646c 696e 6720 6c6f 7473 206f 6620  andling lots of 
+00002800: 7475 6e61 626c 6520 7061 7261 6d65 7465  tunable paramete
+00002810: 7273 2e0a 2020 2020 2020 2020 6261 7463  rs..        batc
+00002820: 685f 7369 7a65 5f6d 696e 2028 696e 7429  h_size_min (int)
+00002830: 3a20 5468 6520 6d69 6e69 6d75 6d20 6261  : The minimum ba
+00002840: 7463 6820 7369 7a65 2074 6f20 7573 6520  tch size to use 
+00002850: 6475 7269 6e67 2074 7261 696e 696e 672e  during training.
+00002860: 2053 686f 756c 6420 6265 206d 756c 7469   Should be multi
+00002870: 706c 6573 206f 6620 3136 2066 6f72 206f  ples of 16 for o
+00002880: 7074 696d 616c 2068 6172 6477 6172 6520  ptimal hardware 
+00002890: 7573 653f 3f20 4465 6661 756c 7473 2074  use?? Defaults t
+000028a0: 6f20 3136 2e0a 2020 2020 2020 2020 6261  o 16..        ba
+000028b0: 7463 685f 7369 7a65 5f6d 6178 2028 696e  tch_size_max (in
+000028c0: 7429 3a20 5468 6520 4d61 7869 6d75 6d20  t): The Maximum 
+000028d0: 6261 7463 6820 7369 7a65 2074 6f20 7573  batch size to us
+000028e0: 6520 6475 7269 6e67 2074 7261 696e 696e  e during trainin
+000028f0: 672e 2053 686f 756c 6420 6265 206d 756c  g. Should be mul
+00002900: 7469 706c 6573 206f 6620 3136 2066 6f72  tiples of 16 for
+00002910: 206f 7074 696d 616c 2068 6172 6477 6172   optimal hardwar
+00002920: 6520 7573 653f 3f20 4465 6661 756c 7473  e use?? Defaults
+00002930: 2074 6f20 3634 2e0a 2020 2020 2020 2020   to 64..        
+00002940: 6d6f 6e69 746f 7231 2028 7374 722c 206f  monitor1 (str, o
+00002950: 7074 696f 6e61 6c29 3a20 5468 6520 6669  ptional): The fi
+00002960: 7273 7420 6d65 7472 6963 2074 6f20 6d6f  rst metric to mo
+00002970: 6e69 746f 722c 2063 616e 2074 616b 6520  nitor, can take 
+00002980: 7468 6520 7361 6d65 2076 616c 7565 7320  the same values 
+00002990: 6173 2074 6865 206d 6574 7269 6320 6172  as the metric ar
+000029a0: 6775 6d65 6e74 2e20 4465 6661 756c 7473  gument. Defaults
+000029b0: 2074 6f20 4e6f 6e65 2e0a 2020 2020 2020   to None..      
+000029c0: 2020 6d6f 6e69 746f 7232 2028 7374 722c    monitor2 (str,
+000029d0: 206f 7074 696f 6e61 6c29 3a20 5468 6520   optional): The 
+000029e0: 7365 636f 6e64 206d 6574 7269 6320 746f  second metric to
+000029f0: 206d 6f6e 6974 6f72 2c20 6361 6e20 7461   monitor, can ta
+00002a00: 6b65 2074 6865 2073 616d 6520 7661 6c75  ke the same valu
+00002a10: 6573 2061 7320 7468 6520 6d65 7472 6963  es as the metric
+00002a20: 2061 7267 756d 656e 742e 2044 6566 6175   argument. Defau
+00002a30: 6c74 7320 746f 204e 6f6e 652e 0a20 2020  lts to None..   
+00002a40: 2020 2020 206d 6f6e 6974 6f72 315f 7468       monitor1_th
+00002a50: 7265 7368 2028 666c 6f61 742c 206f 7074  resh (float, opt
+00002a60: 696f 6e61 6c29 3a20 5468 6520 7468 7265  ional): The thre
+00002a70: 7368 6f6c 6420 7661 6c75 6520 6f66 2074  shold value of t
+00002a80: 6865 2066 6972 7374 206d 6f6e 6974 6f72  he first monitor
+00002a90: 206d 6574 7269 632e 2049 6620 7468 6520   metric. If the 
+00002aa0: 6d65 7472 6963 2069 7320 6c6f 7373 2d72  metric is loss-r
+00002ab0: 656c 6174 6564 0a20 2020 2020 2020 2020  elated.         
+00002ac0: 2020 2074 6865 2074 7261 696e 696e 6720     the training 
+00002ad0: 7769 6c6c 2073 746f 7020 6561 726c 7920  will stop early 
+00002ae0: 6966 2074 6865 2076 616c 7565 2066 616c  if the value fal
+00002af0: 6c73 2062 656c 6f77 2074 6869 7320 7468  ls below this th
+00002b00: 7265 7368 6f6c 642e 2053 696d 696c 6172  reshold. Similar
+00002b10: 6c79 2c20 6966 2074 6865 206d 6574 7269  ly, if the metri
+00002b20: 6320 6973 2061 6363 7572 6163 792d 7265  c is accuracy-re
+00002b30: 6c61 7465 642c 0a20 2020 2020 2020 2020  lated,.         
+00002b40: 2020 2074 6865 6e20 7468 6520 7472 6169     then the trai
+00002b50: 6e69 6e67 2077 696c 6c20 7374 6f70 2065  ning will stop e
+00002b60: 6172 6c79 2069 6620 7468 6520 7661 6c75  arly if the valu
+00002b70: 6520 6661 6c6c 7320 6162 6f76 6520 7468  e falls above th
+00002b80: 6973 2074 6872 6573 686f 6c64 2e20 4465  is threshold. De
+00002b90: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0a  faults to None..
+00002ba0: 2020 2020 2020 2020 6d6f 6e69 746f 7232          monitor2
+00002bb0: 5f74 6872 6573 6820 2866 6c6f 6174 2c20  _thresh (float, 
+00002bc0: 6f70 7469 6f6e 616c 293a 2054 6865 2074  optional): The t
+00002bd0: 6872 6573 686f 6c64 2076 616c 7565 206f  hreshold value o
+00002be0: 6620 7468 6520 7365 636f 6e64 206d 6f6e  f the second mon
+00002bf0: 6974 6f72 206d 6574 7269 632e 2049 6620  itor metric. If 
+00002c00: 7468 6520 6d65 7472 6963 2069 7320 6c6f  the metric is lo
+00002c10: 7373 2d72 656c 6174 6564 0a20 2020 2020  ss-related.     
+00002c20: 2020 2020 2020 2074 6865 2074 7261 696e         the train
+00002c30: 696e 6720 7769 6c6c 2073 746f 7020 6561  ing will stop ea
+00002c40: 726c 7920 6966 2074 6865 2076 616c 7565  rly if the value
+00002c50: 2066 616c 6c73 2062 656c 6f77 2074 6869   falls below thi
+00002c60: 7320 7468 7265 7368 6f6c 642e 2053 696d  s threshold. Sim
+00002c70: 696c 6172 6c79 2c20 6966 2074 6865 206d  ilarly, if the m
+00002c80: 6574 7269 6320 6973 2061 6363 7572 6163  etric is accurac
+00002c90: 792d 7265 6c61 7465 642c 0a20 2020 2020  y-related,.     
+00002ca0: 2020 2020 2020 2074 6865 6e20 7468 6520         then the 
+00002cb0: 7472 6169 6e69 6e67 2077 696c 6c20 7374  training will st
+00002cc0: 6f70 2065 6172 6c79 2069 6620 7468 6520  op early if the 
+00002cd0: 7661 6c75 6520 6661 6c6c 7320 6162 6f76  value falls abov
+00002ce0: 6520 7468 6973 2074 6872 6573 686f 6c64  e this threshold
+00002cf0: 2e20 4465 6661 756c 7473 2074 6f20 4e6f  . Defaults to No
+00002d00: 6e65 2e0a 2020 2020 2020 2020 736d 6f74  ne..        smot
+00002d10: 655f 7361 6d70 6c69 6e67 2028 666c 6f61  e_sampling (floa
+00002d20: 7429 3a20 5468 6520 736d 6f74 655f 7361  t): The smote_sa
+00002d30: 6d70 6c69 6e67 2070 6172 616d 6574 6572  mpling parameter
+00002d40: 2069 7320 7573 6564 2069 6e20 7468 6520   is used in the 
+00002d50: 534d 4f54 4520 616c 676f 7269 7468 6d20  SMOTE algorithm 
+00002d60: 746f 2073 7065 6369 6679 2074 6865 2064  to specify the d
+00002d70: 6573 6972 6564 200a 2020 2020 2020 2020  esired .        
+00002d80: 2020 2020 7261 7469 6f20 6f66 2074 6865      ratio of the
+00002d90: 206d 696e 6f72 6974 7920 636c 6173 7320   minority class 
+00002da0: 746f 2074 6865 206d 616a 6f72 6974 7920  to the majority 
+00002db0: 636c 6173 732e 2044 6566 6175 6c74 7320  class. Defaults 
+00002dc0: 746f 2030 2077 6869 6368 2064 6973 6162  to 0 which disab
+00002dd0: 6c65 7320 7468 6520 7072 6f63 6564 7572  les the procedur
+00002de0: 652e 2046 6f72 206d 6f72 650a 2020 2020  e. For more.    
+00002df0: 2020 2020 2020 2020 696e 666f 726d 6174          informat
+00002e00: 696f 6e20 7265 6665 7220 746f 2074 6865  ion refer to the
+00002e10: 2065 6e73 656d 626c 655f 6d6f 6465 6c20   ensemble_model 
+00002e20: 6d6f 6475 6c65 2e0a 2020 2020 2020 2020  module..        
+00002e30: 626c 656e 645f 6d61 7820 2866 6c6f 6174  blend_max (float
+00002e40: 293a 2049 6620 7573 6564 2074 6869 7320  ): If used this 
+00002e50: 7769 6c6c 2061 7070 6c79 2062 6c65 6e64  will apply blend
+00002e60: 696e 6720 6175 676d 656e 7461 7469 6f6e  ing augmentation
+00002e70: 200a 2020 2020 2020 2020 6e75 6d5f 696d   .        num_im
+00002e80: 6167 6573 5f74 6f5f 626c 656e 6420 2869  ages_to_blend (i
+00002e90: 6e74 293a 0a20 2020 2020 2020 207a 6f6f  nt):.        zoo
+00002ea0: 6d5f 7261 6e67 6520 2874 7570 6c65 293a  m_range (tuple):
+00002eb0: 0a20 2020 2020 2020 2062 6174 6368 5f6f  .        batch_o
+00002ec0: 7468 6572 2028 696e 7429 3a20 4361 6e20  ther (int): Can 
+00002ed0: 6265 2073 6574 2074 6f20 7a65 726f 2e0a  be set to zero..
+00002ee0: 2020 2020 2020 2020 626c 656e 6469 6e67          blending
+00002ef0: 5f66 756e 6320 2873 7472 293a 0a20 2020  _func (str):.   
+00002f00: 2020 2020 2073 6b65 775f 616e 676c 650a       skew_angle.
+00002f10: 0a20 2020 2052 6574 7572 6e73 3a0a 2020  .    Returns:.  
+00002f20: 2020 2020 2020 5468 6520 7065 7266 6f72        The perfor
+00002f30: 6d61 6e63 6520 6d65 7472 6963 2e0a 2020  mance metric..  
+00002f40: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+00002f50: 5f69 6e69 745f 5f28 7365 6c66 2c20 706f  _init__(self, po
+00002f60: 7369 7469 7665 5f63 6c61 7373 2c20 6e65  sitive_class, ne
+00002f70: 6761 7469 7665 5f63 6c61 7373 2c20 7661  gative_class, va
+00002f80: 6c5f 706f 7369 7469 7665 3d4e 6f6e 652c  l_positive=None,
+00002f90: 2076 616c 5f6e 6567 6174 6976 653d 4e6f   val_negative=No
+00002fa0: 6e65 2c20 696d 675f 6e75 6d5f 6368 616e  ne, img_num_chan
+00002fb0: 6e65 6c73 3d31 2c20 636c 663d 2761 6c65  nels=1, clf='ale
+00002fc0: 786e 6574 272c 200a 2020 2020 2020 2020  xnet', .        
+00002fd0: 6e6f 726d 616c 697a 653d 5472 7565 2c20  normalize=True, 
+00002fe0: 6d69 6e5f 7069 7865 6c3d 302c 206d 6178  min_pixel=0, max
+00002ff0: 5f70 6978 656c 3d31 3030 302c 2070 6174  _pixel=1000, pat
+00003000: 6965 6e63 653d 352c 206d 6574 7269 633d  ience=5, metric=
+00003010: 276c 6f73 7327 2c20 6176 6572 6167 653d  'loss', average=
+00003020: 5472 7565 2c20 0a20 2020 2020 2020 2074  True, .        t
+00003030: 6573 745f 706f 7369 7469 7665 3d4e 6f6e  est_positive=Non
+00003040: 652c 2074 6573 745f 6e65 6761 7469 7665  e, test_negative
+00003050: 3d4e 6f6e 652c 2062 6174 6368 5f73 697a  =None, batch_siz
+00003060: 655f 6d69 6e3d 3136 2c20 6261 7463 685f  e_min=16, batch_
+00003070: 7369 7a65 5f6d 6178 3d36 342c 206f 7074  size_max=64, opt
+00003080: 5f6d 6f64 656c 3d54 7275 652c 2074 7261  _model=True, tra
+00003090: 696e 5f65 706f 6368 733d 3235 2c20 6f70  in_epochs=25, op
+000030a0: 745f 6376 3d4e 6f6e 652c 0a20 2020 2020  t_cv=None,.     
+000030b0: 2020 206f 7074 5f61 7567 3d46 616c 7365     opt_aug=False
+000030c0: 2c20 6261 7463 685f 6d69 6e3d 322c 2062  , batch_min=2, b
+000030d0: 6174 6368 5f6d 6178 3d32 352c 2062 6174  atch_max=25, bat
+000030e0: 6368 5f6f 7468 6572 3d31 2c20 6261 6c61  ch_other=1, bala
+000030f0: 6e63 653d 5472 7565 2c20 696d 6167 655f  nce=True, image_
+00003100: 7369 7a65 5f6d 696e 3d35 302c 2069 6d61  size_min=50, ima
+00003110: 6765 5f73 697a 655f 6d61 783d 3130 302c  ge_size_max=100,
+00003120: 2073 6869 6674 3d31 302c 206f 7074 5f6d   shift=10, opt_m
+00003130: 6178 5f6d 696e 5f70 6978 3d4e 6f6e 652c  ax_min_pix=None,
+00003140: 206f 7074 5f6d 6178 5f6d 6178 5f70 6978   opt_max_max_pix
+00003150: 3d4e 6f6e 652c 200a 2020 2020 2020 2020  =None, .        
+00003160: 6d61 736b 5f73 697a 653d 4e6f 6e65 2c20  mask_size=None, 
+00003170: 6e75 6d5f 6d61 736b 733d 4e6f 6e65 2c20  num_masks=None, 
+00003180: 736d 6f74 655f 7361 6d70 6c69 6e67 3d30  smote_sampling=0
+00003190: 2c20 626c 656e 645f 6d61 783d 302c 206e  , blend_max=0, n
+000031a0: 756d 5f69 6d61 6765 735f 746f 5f62 6c65  um_images_to_ble
+000031b0: 6e64 3d32 2c20 626c 656e 6469 6e67 5f66  nd=2, blending_f
+000031c0: 756e 633d 276d 6561 6e27 2c20 626c 656e  unc='mean', blen
+000031d0: 645f 6f74 6865 723d 312c 200a 2020 2020  d_other=1, .    
+000031e0: 2020 2020 736b 6577 5f61 6e67 6c65 3d30      skew_angle=0
+000031f0: 2c20 7a6f 6f6d 5f72 616e 6765 3d28 302e  , zoom_range=(0.
+00003200: 392c 312e 3129 2c20 6c69 6d69 745f 7365  9,1.1), limit_se
+00003210: 6172 6368 3d54 7275 652c 206d 6f6e 6974  arch=True, monit
+00003220: 6f72 313d 4e6f 6e65 2c20 6d6f 6e69 746f  or1=None, monito
+00003230: 7232 3d4e 6f6e 652c 206d 6f6e 6974 6f72  r2=None, monitor
+00003240: 315f 7468 7265 7368 3d4e 6f6e 652c 206d  1_thresh=None, m
+00003250: 6f6e 6974 6f72 325f 7468 7265 7368 3d4e  onitor2_thresh=N
+00003260: 6f6e 652c 2076 6572 626f 7365 3d30 293a  one, verbose=0):
+00003270: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00003280: 6f73 6974 6976 655f 636c 6173 7320 3d20  ositive_class = 
+00003290: 706f 7369 7469 7665 5f63 6c61 7373 0a20  positive_class. 
+000032a0: 2020 2020 2020 2073 656c 662e 6e65 6761         self.nega
+000032b0: 7469 7665 5f63 6c61 7373 203d 206e 6567  tive_class = neg
+000032c0: 6174 6976 655f 636c 6173 730a 2020 2020  ative_class.    
+000032d0: 2020 2020 7365 6c66 2e69 6d67 5f6e 756d      self.img_num
+000032e0: 5f63 6861 6e6e 656c 7320 3d20 696d 675f  _channels = img_
+000032f0: 6e75 6d5f 6368 616e 6e65 6c73 0a20 2020  num_channels.   
+00003300: 2020 2020 2073 656c 662e 6e6f 726d 616c       self.normal
+00003310: 697a 6520 3d20 6e6f 726d 616c 697a 6520  ize = normalize 
+00003320: 0a20 2020 2020 2020 2073 656c 662e 6d69  .        self.mi
+00003330: 6e5f 7069 7865 6c20 3d20 6d69 6e5f 7069  n_pixel = min_pi
+00003340: 7865 6c0a 2020 2020 2020 2020 7365 6c66  xel.        self
+00003350: 2e6d 6178 5f70 6978 656c 203d 206d 6178  .max_pixel = max
+00003360: 5f70 6978 656c 0a20 2020 2020 2020 2073  _pixel.        s
+00003370: 656c 662e 7661 6c5f 706f 7369 7469 7665  elf.val_positive
+00003380: 203d 2076 616c 5f70 6f73 6974 6976 650a   = val_positive.
+00003390: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
+000033a0: 5f6e 6567 6174 6976 6520 3d20 7661 6c5f  _negative = val_
+000033b0: 6e65 6761 7469 7665 0a20 2020 2020 2020  negative.       
+000033c0: 2073 656c 662e 7465 7374 5f70 6f73 6974   self.test_posit
+000033d0: 6976 6520 3d20 7465 7374 5f70 6f73 6974  ive = test_posit
+000033e0: 6976 650a 2020 2020 2020 2020 7365 6c66  ive.        self
+000033f0: 2e74 6573 745f 6e65 6761 7469 7665 203d  .test_negative =
+00003400: 2074 6573 745f 6e65 6761 7469 7665 0a20   test_negative. 
+00003410: 2020 2020 2020 2073 656c 662e 6261 7463         self.batc
+00003420: 685f 7369 7a65 5f6d 696e 203d 2062 6174  h_size_min = bat
+00003430: 6368 5f73 697a 655f 6d69 6e0a 2020 2020  ch_size_min.    
+00003440: 2020 2020 7365 6c66 2e62 6174 6368 5f73      self.batch_s
+00003450: 697a 655f 6d61 7820 3d20 6261 7463 685f  ize_max = batch_
+00003460: 7369 7a65 5f6d 6178 0a20 2020 2020 2020  size_max.       
+00003470: 200a 2020 2020 2020 2020 7365 6c66 2e74   .        self.t
+00003480: 7261 696e 5f65 706f 6368 7320 3d20 7472  rain_epochs = tr
+00003490: 6169 6e5f 6570 6f63 6873 0a20 2020 2020  ain_epochs.     
+000034a0: 2020 2073 656c 662e 7061 7469 656e 6365     self.patience
+000034b0: 203d 2070 6174 6965 6e63 6520 0a20 2020   = patience .   
+000034c0: 2020 2020 2073 656c 662e 6f70 745f 6d6f       self.opt_mo
+000034d0: 6465 6c20 3d20 6f70 745f 6d6f 6465 6c20  del = opt_model 
+000034e0: 200a 2020 2020 2020 2020 7365 6c66 2e6f   .        self.o
+000034f0: 7074 5f61 7567 203d 206f 7074 5f61 7567  pt_aug = opt_aug
+00003500: 0a20 2020 2020 2020 2073 656c 662e 6261  .        self.ba
+00003510: 7463 685f 6d69 6e20 3d20 6261 7463 685f  tch_min = batch_
+00003520: 6d69 6e20 0a20 2020 2020 2020 2073 656c  min .        sel
+00003530: 662e 6261 7463 685f 6d61 7820 3d20 6261  f.batch_max = ba
+00003540: 7463 685f 6d61 7820 0a20 2020 2020 2020  tch_max .       
+00003550: 2073 656c 662e 6261 7463 685f 6f74 6865   self.batch_othe
+00003560: 7220 3d20 6261 7463 685f 6f74 6865 720a  r = batch_other.
+00003570: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
+00003580: 6765 5f73 697a 655f 6d69 6e20 3d20 696d  ge_size_min = im
+00003590: 6167 655f 7369 7a65 5f6d 696e 0a20 2020  age_size_min.   
+000035a0: 2020 2020 2073 656c 662e 696d 6167 655f       self.image_
+000035b0: 7369 7a65 5f6d 6178 203d 2069 6d61 6765  size_max = image
+000035c0: 5f73 697a 655f 6d61 780a 2020 2020 2020  _size_max.      
+000035d0: 2020 7365 6c66 2e62 616c 616e 6365 203d    self.balance =
+000035e0: 2062 616c 616e 6365 0a20 2020 2020 2020   balance.       
+000035f0: 2073 656c 662e 6f70 745f 6d61 785f 6d69   self.opt_max_mi
+00003600: 6e5f 7069 7820 3d20 6f70 745f 6d61 785f  n_pix = opt_max_
+00003610: 6d69 6e5f 7069 780a 2020 2020 2020 2020  min_pix.        
+00003620: 7365 6c66 2e6f 7074 5f6d 6178 5f6d 6178  self.opt_max_max
+00003630: 5f70 6978 203d 206f 7074 5f6d 6178 5f6d  _pix = opt_max_m
+00003640: 6178 5f70 6978 0a20 2020 2020 2020 2073  ax_pix.        s
+00003650: 656c 662e 6d65 7472 6963 203d 206d 6574  elf.metric = met
+00003660: 7269 6320 0a20 2020 2020 2020 2073 656c  ric .        sel
+00003670: 662e 6176 6572 6167 6520 3d20 6176 6572  f.average = aver
+00003680: 6167 650a 2020 2020 2020 2020 7365 6c66  age.        self
+00003690: 2e73 6869 6674 203d 2073 6869 6674 200a  .shift = shift .
+000036a0: 2020 2020 2020 2020 7365 6c66 2e6f 7074          self.opt
+000036b0: 5f63 7620 3d20 6f70 745f 6376 0a20 2020  _cv = opt_cv.   
+000036c0: 2020 2020 2073 656c 662e 7665 7262 6f73       self.verbos
+000036d0: 6520 3d20 7665 7262 6f73 650a 2020 2020  e = verbose.    
+000036e0: 2020 2020 7365 6c66 2e6d 6173 6b5f 7369      self.mask_si
+000036f0: 7a65 203d 206d 6173 6b5f 7369 7a65 0a20  ze = mask_size. 
+00003700: 2020 2020 2020 2073 656c 662e 6e75 6d5f         self.num_
+00003710: 6d61 736b 7320 3d20 6e75 6d5f 6d61 736b  masks = num_mask
+00003720: 730a 2020 2020 2020 2020 7365 6c66 2e6c  s.        self.l
+00003730: 696d 6974 5f73 6561 7263 6820 3d20 6c69  imit_search = li
+00003740: 6d69 745f 7365 6172 6368 0a20 2020 2020  mit_search.     
+00003750: 2020 2073 656c 662e 636c 6620 3d20 636c     self.clf = cl
+00003760: 660a 0a20 2020 2020 2020 2073 656c 662e  f..        self.
+00003770: 6d6f 6e69 746f 7231 203d 206d 6f6e 6974  monitor1 = monit
+00003780: 6f72 310a 2020 2020 2020 2020 7365 6c66  or1.        self
+00003790: 2e6d 6f6e 6974 6f72 3220 3d20 6d6f 6e69  .monitor2 = moni
+000037a0: 746f 7232 0a20 2020 2020 2020 2073 656c  tor2.        sel
+000037b0: 662e 6d6f 6e69 746f 7231 5f74 6872 6573  f.monitor1_thres
+000037c0: 6820 3d20 6d6f 6e69 746f 7231 5f74 6872  h = monitor1_thr
+000037d0: 6573 680a 2020 2020 2020 2020 7365 6c66  esh.        self
+000037e0: 2e6d 6f6e 6974 6f72 325f 7468 7265 7368  .monitor2_thresh
+000037f0: 203d 206d 6f6e 6974 6f72 325f 7468 7265   = monitor2_thre
+00003800: 7368 0a20 2020 2020 2020 2073 656c 662e  sh.        self.
+00003810: 736d 6f74 655f 7361 6d70 6c69 6e67 203d  smote_sampling =
+00003820: 2073 6d6f 7465 5f73 616d 706c 696e 670a   smote_sampling.
+00003830: 2020 2020 2020 2020 7365 6c66 2e62 6c65          self.ble
+00003840: 6e64 5f6d 6178 203d 2062 6c65 6e64 5f6d  nd_max = blend_m
+00003850: 6178 0a20 2020 2020 2020 2073 656c 662e  ax.        self.
+00003860: 6e75 6d5f 696d 6167 6573 5f74 6f5f 626c  num_images_to_bl
+00003870: 656e 6420 3d20 6e75 6d5f 696d 6167 6573  end = num_images
+00003880: 5f74 6f5f 626c 656e 640a 2020 2020 2020  _to_blend.      
+00003890: 2020 7365 6c66 2e62 6c65 6e64 696e 675f    self.blending_
+000038a0: 6675 6e63 203d 2062 6c65 6e64 696e 675f  func = blending_
+000038b0: 6675 6e63 0a20 2020 2020 2020 2073 656c  func.        sel
+000038c0: 662e 626c 656e 645f 6f74 6865 7220 3d20  f.blend_other = 
+000038d0: 626c 656e 645f 6f74 6865 720a 2020 2020  blend_other.    
+000038e0: 2020 2020 7365 6c66 2e7a 6f6f 6d5f 7261      self.zoom_ra
+000038f0: 6e67 6520 3d20 7a6f 6f6d 5f72 616e 6765  nge = zoom_range
+00003900: 0a20 2020 2020 2020 2073 656c 662e 736b  .        self.sk
+00003910: 6577 5f61 6e67 6c65 203d 2073 6b65 775f  ew_angle = skew_
+00003920: 616e 676c 650a 0a20 2020 2020 2020 2069  angle..        i
+00003930: 6620 2761 6c6c 2720 6e6f 7420 696e 2073  f 'all' not in s
+00003940: 656c 662e 6d65 7472 6963 2061 6e64 2027  elf.metric and '
+00003950: 6c6f 7373 2720 6e6f 7420 696e 2073 656c  loss' not in sel
+00003960: 662e 6d65 7472 6963 2061 6e64 2027 6631  f.metric and 'f1
+00003970: 5f73 636f 7265 2720 6e6f 7420 696e 2073  _score' not in s
+00003980: 656c 662e 6d65 7472 6963 2061 6e64 2027  elf.metric and '
+00003990: 6269 6e61 7279 5f61 6363 7572 6163 7927  binary_accuracy'
+000039a0: 206e 6f74 2069 6e20 7365 6c66 2e6d 6574   not in self.met
+000039b0: 7269 633a 0a20 2020 2020 2020 2020 2020  ric:.           
+000039c0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+000039d0: 7228 2249 6e76 616c 6964 206d 6574 7269  r("Invalid metri
+000039e0: 6320 696e 7075 742c 206f 7074 696f 6e73  c input, options
+000039f0: 2061 7265 3a20 276c 6f73 7327 2c20 2762   are: 'loss', 'b
+00003a00: 696e 6172 795f 6163 6375 7261 6379 272c  inary_accuracy',
+00003a10: 2027 6631 5f73 636f 7265 272c 206f 7220   'f1_score', or 
+00003a20: 2761 6c6c 272c 2061 6e64 2074 6865 2076  'all', and the v
+00003a30: 616c 6964 6174 696f 6e20 6571 7569 7661  alidation equiva
+00003a40: 6c65 6e74 7320 2861 6464 2076 616c 5f20  lents (add val_ 
+00003a50: 6174 2074 6865 2062 6567 696e 6e69 6e67  at the beginning
+00003a60: 292e 2229 0a20 2020 2020 2020 200a 2020  ).").        .  
+00003a70: 2020 2020 2020 6966 2073 656c 662e 6d65        if self.me
+00003a80: 7472 6963 203d 3d20 2776 616c 5f6c 6f73  tric == 'val_los
+00003a90: 7327 206f 7220 7365 6c66 2e6d 6574 7269  s' or self.metri
+00003aa0: 6320 3d3d 2027 7661 6c5f 6269 6e61 7279  c == 'val_binary
+00003ab0: 5f61 6363 7572 6163 7927 3a0a 2020 2020  _accuracy':.    
+00003ac0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00003ad0: 7661 6c5f 706f 7369 7469 7665 2069 7320  val_positive is 
+00003ae0: 4e6f 6e65 2061 6e64 2073 656c 662e 7661  None and self.va
+00003af0: 6c5f 6e65 6761 7469 7665 2069 7320 4e6f  l_negative is No
+00003b00: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00003b10: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00003b20: 7272 6f72 2827 4e6f 2076 616c 6964 6174  rror('No validat
+00003b30: 696f 6e20 6461 7461 2069 6e70 7574 2c20  ion data input, 
+00003b40: 6368 616e 6765 2074 6865 206d 6574 7269  change the metri
+00003b50: 6320 746f 2065 6974 6865 7220 226c 6f73  c to either "los
+00003b60: 7322 2c20 2262 696e 6172 795f 6163 6375  s", "binary_accu
+00003b70: 7261 6379 222c 2022 6631 5f73 636f 7265  racy", "f1_score
+00003b80: 222c 206f 7220 2261 6c6c 222e 2729 0a0a  ", or "all".')..
+00003b90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00003ba0: 6f70 745f 6d61 785f 6d69 6e5f 7069 7820  opt_max_min_pix 
+00003bb0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00003bc0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00003bd0: 2e6f 7074 5f6d 6178 5f6d 6178 5f70 6978  .opt_max_max_pix
+00003be0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00003bf0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00003c00: 5661 6c75 6545 7272 6f72 2827 546f 206f  ValueError('To o
+00003c10: 7074 696d 697a 6520 6d69 6e2f 6d61 7820  ptimize min/max 
+00003c20: 6e6f 726d 616c 697a 6174 696f 6e20 7069  normalization pi
+00003c30: 7865 6c20 7661 6c75 652c 2062 6f74 6820  xel value, both 
+00003c40: 6f70 745f 6d69 6e5f 7069 7820 616e 6420  opt_min_pix and 
+00003c50: 6f70 745f 6d61 785f 7069 7820 6d75 7374  opt_max_pix must
+00003c60: 2062 6520 696e 7075 7427 290a 0a20 2020   be input')..   
+00003c70: 2020 2020 2069 6620 7365 6c66 2e6f 7074       if self.opt
+00003c80: 5f6d 6178 5f6d 6178 5f70 6978 2069 7320  _max_max_pix is 
+00003c90: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00003ca0: 2020 2020 2020 6966 2073 656c 662e 6f70        if self.op
+00003cb0: 745f 6d61 785f 6d69 6e5f 7069 7820 6973  t_max_min_pix is
+00003cc0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00003cd0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00003ce0: 7565 4572 726f 7228 2754 6f20 6f70 7469  ueError('To opti
+00003cf0: 6d69 7a65 206d 696e 2f6d 6178 206e 6f72  mize min/max nor
+00003d00: 6d61 6c69 7a61 7469 6f6e 2070 6978 656c  malization pixel
+00003d10: 2076 616c 7565 2c20 626f 7468 206f 7074   value, both opt
+00003d20: 5f6d 696e 5f70 6978 2061 6e64 206f 7074  _min_pix and opt
+00003d30: 5f6d 6178 5f70 6978 206d 7573 7420 6265  _max_pix must be
+00003d40: 2069 6e70 7574 2729 0a0a 2020 2020 2020   input')..      
+00003d50: 2020 6966 2073 656c 662e 6261 6c61 6e63    if self.balanc
+00003d60: 6520 616e 6420 7365 6c66 2e73 6d6f 7465  e and self.smote
+00003d70: 5f73 616d 706c 696e 6720 3e20 303a 0a20  _sampling > 0:. 
+00003d80: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00003d90: 2827 5741 524e 494e 473a 2062 616c 616e  ('WARNING: balan
+00003da0: 6365 3d54 7275 6520 6275 7420 534d 4f54  ce=True but SMOT
+00003db0: 4520 7361 6d70 6c69 6e67 2077 696c 6c20  E sampling will 
+00003dc0: 6e6f 7420 6265 2061 7070 6c69 6564 2069  not be applied i
+00003dd0: 6620 7468 6520 636c 6173 7365 7320 6172  f the classes ar
+00003de0: 6520 6261 6c61 6e63 6564 2e27 290a 0a20  e balanced.').. 
+00003df0: 2020 2064 6566 205f 5f63 616c 6c5f 5f28     def __call__(
+00003e00: 7365 6c66 2c20 7472 6961 6c29 3a0a 0a20  self, trial):.. 
+00003e10: 2020 2020 2020 2069 6620 7365 6c66 2e6f         if self.o
+00003e20: 7074 5f61 7567 3a0a 2020 2020 2020 2020  pt_aug:.        
+00003e30: 2020 2020 6966 2073 656c 662e 696d 675f      if self.img_
+00003e40: 6e75 6d5f 6368 616e 6e65 6c73 203d 3d20  num_channels == 
+00003e50: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+00003e60: 2020 2063 6861 6e6e 656c 312c 2063 6861     channel1, cha
+00003e70: 6e6e 656c 322c 2063 6861 6e6e 656c 3320  nnel2, channel3 
+00003e80: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
+00003e90: 7365 6c66 2e70 6f73 6974 6976 655f 636c  self.positive_cl
+00003ea0: 6173 7329 2c20 4e6f 6e65 2c20 4e6f 6e65  ass), None, None
+00003eb0: 200a 2020 2020 2020 2020 2020 2020 656c   .            el
+00003ec0: 6966 2073 656c 662e 696d 675f 6e75 6d5f  if self.img_num_
+00003ed0: 6368 616e 6e65 6c73 203d 3d20 323a 0a20  channels == 2:. 
+00003ee0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00003ef0: 6861 6e6e 656c 312c 2063 6861 6e6e 656c  hannel1, channel
+00003f00: 322c 2063 6861 6e6e 656c 3320 3d20 636f  2, channel3 = co
+00003f10: 7079 2e64 6565 7063 6f70 7928 7365 6c66  py.deepcopy(self
+00003f20: 2e70 6f73 6974 6976 655f 636c 6173 735b  .positive_class[
+00003f30: 3a2c 3a2c 3a2c 305d 292c 2063 6f70 792e  :,:,:,0]), copy.
+00003f40: 6465 6570 636f 7079 2873 656c 662e 706f  deepcopy(self.po
+00003f50: 7369 7469 7665 5f63 6c61 7373 5b3a 2c3a  sitive_class[:,:
+00003f60: 2c3a 2c31 5d29 2c20 4e6f 6e65 200a 2020  ,:,1]), None .  
+00003f70: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+00003f80: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
+00003f90: 6e65 6c73 203d 3d20 333a 0a20 2020 2020  nels == 3:.     
+00003fa0: 2020 2020 2020 2020 2020 2063 6861 6e6e             chann
+00003fb0: 656c 312c 2063 6861 6e6e 656c 322c 2063  el1, channel2, c
+00003fc0: 6861 6e6e 656c 3320 3d20 636f 7079 2e64  hannel3 = copy.d
+00003fd0: 6565 7063 6f70 7928 7365 6c66 2e70 6f73  eepcopy(self.pos
+00003fe0: 6974 6976 655f 636c 6173 735b 3a2c 3a2c  itive_class[:,:,
+00003ff0: 3a2c 305d 292c 2063 6f70 792e 6465 6570  :,0]), copy.deep
+00004000: 636f 7079 2873 656c 662e 706f 7369 7469  copy(self.positi
+00004010: 7665 5f63 6c61 7373 5b3a 2c3a 2c3a 2c31  ve_class[:,:,:,1
+00004020: 5d29 2c20 636f 7079 2e64 6565 7063 6f70  ]), copy.deepcop
+00004030: 7928 7365 6c66 2e70 6f73 6974 6976 655f  y(self.positive_
+00004040: 636c 6173 735b 3a2c 3a2c 3a2c 325d 290a  class[:,:,:,2]).
+00004050: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00004060: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004070: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00004080: 6f72 2827 4f6e 6c79 2074 6872 6565 2066  or('Only three f
+00004090: 696c 7465 7273 2061 7265 2073 7570 706f  ilters are suppo
+000040a0: 7274 6564 2127 290a 0a20 2020 2020 2020  rted!')..       
+000040b0: 2069 6620 7365 6c66 2e6f 7074 5f61 7567   if self.opt_aug
+000040c0: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
+000040d0: 7461 7469 6f6e 203d 2068 6f72 697a 6f6e  tation = horizon
+000040e0: 7461 6c20 3d20 7665 7274 6963 616c 203d  tal = vertical =
+000040f0: 2054 7275 6520 0a20 2020 2020 2020 2020   True .         
+00004100: 2020 206e 756d 5f61 7567 203d 2074 7269     num_aug = tri
+00004110: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+00004120: 6e75 6d5f 6175 6727 2c20 7365 6c66 2e62  num_aug', self.b
+00004130: 6174 6368 5f6d 696e 2c20 7365 6c66 2e62  atch_min, self.b
+00004140: 6174 6368 5f6d 6178 2c20 7374 6570 3d31  atch_max, step=1
+00004150: 290a 2020 2020 2020 2020 2020 2020 626c  ).            bl
+00004160: 656e 645f 6d75 6c74 6970 6c69 6572 203d  end_multiplier =
+00004170: 2074 7269 616c 2e73 7567 6765 7374 5f66   trial.suggest_f
+00004180: 6c6f 6174 2827 626c 656e 645f 6d75 6c74  loat('blend_mult
+00004190: 6970 6c69 6572 272c 2031 2e30 2c20 7365  iplier', 1.0, se
+000041a0: 6c66 2e62 6c65 6e64 5f6d 6178 2c20 7374  lf.blend_max, st
+000041b0: 6570 3d30 2e30 3529 2069 6620 7365 6c66  ep=0.05) if self
+000041c0: 2e62 6c65 6e64 5f6d 6178 203e 3d20 312e  .blend_max >= 1.
+000041d0: 3120 656c 7365 2030 0a20 2020 2020 2020  1 else 0.       
+000041e0: 2020 2020 2073 6b65 775f 616e 676c 6520       skew_angle 
+000041f0: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00004200: 696e 7428 2773 6b65 775f 616e 676c 6527  int('skew_angle'
+00004210: 2c20 302c 2073 656c 662e 736b 6577 5f61  , 0, self.skew_a
+00004220: 6e67 6c65 2c20 7374 6570 3d31 2920 6966  ngle, step=1) if
+00004230: 2073 656c 662e 736b 6577 5f61 6e67 6c65   self.skew_angle
+00004240: 203e 2030 2065 6c73 6520 300a 2020 2020   > 0 else 0.    
+00004250: 2020 2020 2020 2020 696d 6167 655f 7369          image_si
+00004260: 7a65 203d 2074 7269 616c 2e73 7567 6765  ze = trial.sugge
+00004270: 7374 5f69 6e74 2827 696d 6167 655f 7369  st_int('image_si
+00004280: 7a65 272c 2073 656c 662e 696d 6167 655f  ze', self.image_
+00004290: 7369 7a65 5f6d 696e 2c20 7365 6c66 2e69  size_min, self.i
+000042a0: 6d61 6765 5f73 697a 655f 6d61 782c 2073  mage_size_max, s
+000042b0: 7465 703d 3129 0a0a 2020 2020 2020 2020  tep=1)..        
+000042c0: 2020 2020 6175 676d 656e 7465 645f 696d      augmented_im
+000042d0: 6167 6573 203d 2061 7567 6d65 6e74 6174  ages = augmentat
+000042e0: 696f 6e28 6368 616e 6e65 6c31 3d63 6861  ion(channel1=cha
+000042f0: 6e6e 656c 312c 2063 6861 6e6e 656c 323d  nnel1, channel2=
+00004300: 6368 616e 6e65 6c32 2c20 6368 616e 6e65  channel2, channe
+00004310: 6c33 3d63 6861 6e6e 656c 332c 2062 6174  l3=channel3, bat
+00004320: 6368 3d6e 756d 5f61 7567 2c20 0a20 2020  ch=num_aug, .   
+00004330: 2020 2020 2020 2020 2020 2020 2077 6964               wid
+00004340: 7468 5f73 6869 6674 3d73 656c 662e 7368  th_shift=self.sh
+00004350: 6966 742c 2068 6569 6768 745f 7368 6966  ift, height_shif
+00004360: 743d 7365 6c66 2e73 6869 6674 2c20 686f  t=self.shift, ho
+00004370: 7269 7a6f 6e74 616c 3d68 6f72 697a 6f6e  rizontal=horizon
+00004380: 7461 6c2c 2076 6572 7469 6361 6c3d 7665  tal, vertical=ve
+00004390: 7274 6963 616c 2c20 726f 7461 7469 6f6e  rtical, rotation
+000043a0: 3d72 6f74 6174 696f 6e2c 200a 2020 2020  =rotation, .    
+000043b0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+000043c0: 655f 7369 7a65 3d69 6d61 6765 5f73 697a  e_size=image_siz
+000043d0: 652c 206d 6173 6b5f 7369 7a65 3d73 656c  e, mask_size=sel
+000043e0: 662e 6d61 736b 5f73 697a 652c 206e 756d  f.mask_size, num
+000043f0: 5f6d 6173 6b73 3d73 656c 662e 6e75 6d5f  _masks=self.num_
+00004400: 6d61 736b 732c 2062 6c65 6e64 5f6d 756c  masks, blend_mul
+00004410: 7469 706c 6965 723d 626c 656e 645f 6d75  tiplier=blend_mu
+00004420: 6c74 6970 6c69 6572 2c20 0a20 2020 2020  ltiplier, .     
+00004430: 2020 2020 2020 2020 2020 2062 6c65 6e64             blend
+00004440: 696e 675f 6675 6e63 3d73 656c 662e 626c  ing_func=self.bl
+00004450: 656e 6469 6e67 5f66 756e 632c 206e 756d  ending_func, num
+00004460: 5f69 6d61 6765 735f 746f 5f62 6c65 6e64  _images_to_blend
+00004470: 3d73 656c 662e 6e75 6d5f 696d 6167 6573  =self.num_images
+00004480: 5f74 6f5f 626c 656e 642c 207a 6f6f 6d5f  _to_blend, zoom_
+00004490: 7261 6e67 653d 7365 6c66 2e7a 6f6f 6d5f  range=self.zoom_
+000044a0: 7261 6e67 652c 2073 6b65 775f 616e 676c  range, skew_angl
+000044b0: 653d 736b 6577 5f61 6e67 6c65 290a 0a20  e=skew_angle).. 
+000044c0: 2020 2020 2020 2020 2020 2023 436f 6e63             #Conc
+000044d0: 6174 2063 6861 6e6e 656c 7320 7369 6e63  at channels sinc
+000044e0: 6520 6175 676d 656e 7461 7469 6f6e 2066  e augmentation f
+000044f0: 756e 6374 696f 6e20 7265 7475 726e 7320  unction returns 
+00004500: 616e 206f 7574 7075 7420 666f 7220 6561  an output for ea
+00004510: 6368 2066 696c 7465 722c 2065 2e67 2e20  ch filter, e.g. 
+00004520: 3320 6f75 7470 7574 7320 666f 7220 5247  3 outputs for RG
+00004530: 420a 2020 2020 2020 2020 2020 2020 6966  B.            if
+00004540: 2073 656c 662e 696d 675f 6e75 6d5f 6368   self.img_num_ch
+00004550: 616e 6e65 6c73 203e 2031 3a0a 2020 2020  annels > 1:.    
+00004560: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+00004570: 735f 313d 5b5d 0a20 2020 2020 2020 2020  s_1=[].         
+00004580: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+00004590: 6d67 5f6e 756d 5f63 6861 6e6e 656c 7320  mg_num_channels 
+000045a0: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
+000045b0: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+000045c0: 696e 2072 616e 6765 286c 656e 2861 7567  in range(len(aug
+000045d0: 6d65 6e74 6564 5f69 6d61 6765 735b 305d  mented_images[0]
+000045e0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+000045f0: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+00004600: 735f 312e 6170 7065 6e64 2864 6174 615f  s_1.append(data_
+00004610: 7072 6f63 6573 7369 6e67 2e63 6f6e 6361  processing.conca
+00004620: 745f 6368 616e 6e65 6c73 2861 7567 6d65  t_channels(augme
+00004630: 6e74 6564 5f69 6d61 6765 735b 305d 5b69  nted_images[0][i
+00004640: 5d2c 2061 7567 6d65 6e74 6564 5f69 6d61  ], augmented_ima
+00004650: 6765 735b 315d 5b69 5d29 290a 2020 2020  ges[1][i])).    
+00004660: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00004670: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004680: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00004690: 616e 6765 286c 656e 2861 7567 6d65 6e74  ange(len(augment
+000046a0: 6564 5f69 6d61 6765 735b 305d 2929 3a0a  ed_images[0])):.
+000046b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000046c0: 2020 2020 2020 2020 636c 6173 735f 312e          class_1.
+000046d0: 6170 7065 6e64 2864 6174 615f 7072 6f63  append(data_proc
+000046e0: 6573 7369 6e67 2e63 6f6e 6361 745f 6368  essing.concat_ch
+000046f0: 616e 6e65 6c73 2861 7567 6d65 6e74 6564  annels(augmented
+00004700: 5f69 6d61 6765 735b 305d 5b69 5d2c 2061  _images[0][i], a
+00004710: 7567 6d65 6e74 6564 5f69 6d61 6765 735b  ugmented_images[
+00004720: 315d 5b69 5d2c 2061 7567 6d65 6e74 6564  1][i], augmented
+00004730: 5f69 6d61 6765 735b 325d 5b69 5d29 290a  _images[2][i])).
+00004740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004750: 636c 6173 735f 3120 3d20 6e70 2e61 7272  class_1 = np.arr
+00004760: 6179 2863 6c61 7373 5f31 290a 2020 2020  ay(class_1).    
+00004770: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00004780: 2020 2020 2020 2020 2020 2020 2020 636c                cl
+00004790: 6173 735f 3120 3d20 6175 676d 656e 7465  ass_1 = augmente
+000047a0: 645f 696d 6167 6573 0a0a 2020 2020 2020  d_images..      
+000047b0: 2020 2020 2020 2350 6572 666f 726d 2073        #Perform s
+000047c0: 616d 6520 6175 676d 656e 7461 7469 6f6e  ame augmentation
+000047d0: 2074 6563 686e 6971 7565 7320 6f6e 206e   techniques on n
+000047e0: 6567 6174 6976 6520 636c 6173 7320 6461  egative class da
+000047f0: 7461 2066 6f72 2062 616c 616e 6365 2062  ta for balance b
+00004800: 7574 2075 7365 2062 6174 6368 3d62 6174  ut use batch=bat
+00004810: 6368 5f6f 7468 6572 2c20 6e75 6d5f 696d  ch_other, num_im
+00004820: 6167 6573 5f74 6f5f 626c 656e 643d 7365  ages_to_blend=se
+00004830: 6c66 2e6e 756d 5f69 6d61 6765 735f 746f  lf.num_images_to
+00004840: 5f62 6c65 6e64 200a 2020 2020 2020 2020  _blend .        
+00004850: 2020 2020 2354 6869 7320 6973 2064 6f6e      #This is don
+00004860: 6520 736f 2074 6861 7420 7468 6520 7472  e so that the tr
+00004870: 6169 6e69 6e67 2064 6174 6120 616c 736f  aining data also
+00004880: 2069 6e63 6c75 6465 7320 7468 6520 7361   includes the sa
+00004890: 6d65 2061 7567 6d65 6e74 6174 696f 6e20  me augmentation 
+000048a0: 7465 6368 6e69 7175 6573 2c20 6966 2063  techniques, if c
+000048b0: 6f6e 6669 6775 7265 642e 0a20 2020 2020  onfigured..     
+000048c0: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+000048d0: 6d67 5f6e 756d 5f63 6861 6e6e 656c 7320  mg_num_channels 
+000048e0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+000048f0: 2020 2020 2020 6368 616e 6e65 6c31 2c20        channel1, 
+00004900: 6368 616e 6e65 6c32 2c20 6368 616e 6e65  channel2, channe
+00004910: 6c33 203d 2063 6f70 792e 6465 6570 636f  l3 = copy.deepco
+00004920: 7079 2873 656c 662e 6e65 6761 7469 7665  py(self.negative
+00004930: 5f63 6c61 7373 292c 204e 6f6e 652c 204e  _class), None, N
+00004940: 6f6e 6520 0a20 2020 2020 2020 2020 2020  one .           
+00004950: 2065 6c69 6620 7365 6c66 2e69 6d67 5f6e   elif self.img_n
+00004960: 756d 5f63 6861 6e6e 656c 7320 3d3d 2032  um_channels == 2
+00004970: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004980: 2020 6368 616e 6e65 6c31 2c20 6368 616e    channel1, chan
+00004990: 6e65 6c32 2c20 6368 616e 6e65 6c33 203d  nel2, channel3 =
+000049a0: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
+000049b0: 656c 662e 6e65 6761 7469 7665 5f63 6c61  elf.negative_cla
+000049c0: 7373 5b3a 2c3a 2c3a 2c30 5d29 2c20 636f  ss[:,:,:,0]), co
+000049d0: 7079 2e64 6565 7063 6f70 7928 7365 6c66  py.deepcopy(self
+000049e0: 2e6e 6567 6174 6976 655f 636c 6173 735b  .negative_class[
+000049f0: 3a2c 3a2c 3a2c 315d 292c 204e 6f6e 6520  :,:,:,1]), None 
+00004a00: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00004a10: 6620 7365 6c66 2e69 6d67 5f6e 756d 5f63  f self.img_num_c
+00004a20: 6861 6e6e 656c 7320 3d3d 2033 3a0a 2020  hannels == 3:.  
+00004a30: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00004a40: 616e 6e65 6c31 2c20 6368 616e 6e65 6c32  annel1, channel2
+00004a50: 2c20 6368 616e 6e65 6c33 203d 2063 6f70  , channel3 = cop
+00004a60: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
+00004a70: 6e65 6761 7469 7665 5f63 6c61 7373 5b3a  negative_class[:
+00004a80: 2c3a 2c3a 2c30 5d29 2c20 636f 7079 2e64  ,:,:,0]), copy.d
+00004a90: 6565 7063 6f70 7928 7365 6c66 2e6e 6567  eepcopy(self.neg
+00004aa0: 6174 6976 655f 636c 6173 735b 3a2c 3a2c  ative_class[:,:,
+00004ab0: 3a2c 315d 292c 2063 6f70 792e 6465 6570  :,1]), copy.deep
+00004ac0: 636f 7079 2873 656c 662e 6e65 6761 7469  copy(self.negati
+00004ad0: 7665 5f63 6c61 7373 5b3a 2c3a 2c3a 2c32  ve_class[:,:,:,2
+00004ae0: 5d29 0a20 2020 2020 2020 2020 2020 200a  ]).            .
+00004af0: 2020 2020 2020 2020 2020 2020 6175 676d              augm
+00004b00: 656e 7465 645f 696d 6167 6573 5f6e 6567  ented_images_neg
+00004b10: 6174 6976 6520 3d20 6175 676d 656e 7461  ative = augmenta
+00004b20: 7469 6f6e 2863 6861 6e6e 656c 313d 6368  tion(channel1=ch
+00004b30: 616e 6e65 6c31 2c20 6368 616e 6e65 6c32  annel1, channel2
+00004b40: 3d63 6861 6e6e 656c 322c 2063 6861 6e6e  =channel2, chann
+00004b50: 656c 333d 6368 616e 6e65 6c33 2c20 6261  el3=channel3, ba
+00004b60: 7463 683d 7365 6c66 2e62 6174 6368 5f6f  tch=self.batch_o
+00004b70: 7468 6572 2c20 0a20 2020 2020 2020 2020  ther, .         
+00004b80: 2020 2020 2020 2077 6964 7468 5f73 6869         width_shi
+00004b90: 6674 3d73 656c 662e 7368 6966 742c 2068  ft=self.shift, h
+00004ba0: 6569 6768 745f 7368 6966 743d 7365 6c66  eight_shift=self
+00004bb0: 2e73 6869 6674 2c20 686f 7269 7a6f 6e74  .shift, horizont
+00004bc0: 616c 3d68 6f72 697a 6f6e 7461 6c2c 2076  al=horizontal, v
+00004bd0: 6572 7469 6361 6c3d 7665 7274 6963 616c  ertical=vertical
+00004be0: 2c20 726f 7461 7469 6f6e 3d72 6f74 6174  , rotation=rotat
+00004bf0: 696f 6e2c 200a 2020 2020 2020 2020 2020  ion, .          
+00004c00: 2020 2020 2020 696d 6167 655f 7369 7a65        image_size
+00004c10: 3d69 6d61 6765 5f73 697a 652c 206d 6173  =image_size, mas
+00004c20: 6b5f 7369 7a65 3d73 656c 662e 6d61 736b  k_size=self.mask
+00004c30: 5f73 697a 652c 206e 756d 5f6d 6173 6b73  _size, num_masks
+00004c40: 3d73 656c 662e 6e75 6d5f 6d61 736b 732c  =self.num_masks,
+00004c50: 2062 6c65 6e64 5f6d 756c 7469 706c 6965   blend_multiplie
+00004c60: 723d 7365 6c66 2e62 6c65 6e64 5f6f 7468  r=self.blend_oth
+00004c70: 6572 2c20 0a20 2020 2020 2020 2020 2020  er, .           
+00004c80: 2020 2020 2062 6c65 6e64 696e 675f 6675       blending_fu
+00004c90: 6e63 3d73 656c 662e 626c 656e 6469 6e67  nc=self.blending
+00004ca0: 5f66 756e 632c 206e 756d 5f69 6d61 6765  _func, num_image
+00004cb0: 735f 746f 5f62 6c65 6e64 3d73 656c 662e  s_to_blend=self.
+00004cc0: 6e75 6d5f 696d 6167 6573 5f74 6f5f 626c  num_images_to_bl
+00004cd0: 656e 642c 207a 6f6f 6d5f 7261 6e67 653d  end, zoom_range=
+00004ce0: 7365 6c66 2e7a 6f6f 6d5f 7261 6e67 652c  self.zoom_range,
+00004cf0: 2073 6b65 775f 616e 676c 653d 736b 6577   skew_angle=skew
+00004d00: 5f61 6e67 6c65 290a 0a20 2020 2020 2020  _angle)..       
+00004d10: 2020 2020 2023 5468 6520 6175 676d 656e       #The augmen
+00004d20: 7461 7469 6f6e 2072 6f75 7469 6e65 2072  tation routine r
+00004d30: 6574 7572 6e73 2061 6e20 6f75 7470 7574  eturns an output
+00004d40: 2066 6f72 2065 6163 6820 6669 6c74 6572   for each filter
+00004d50: 2c20 652e 672e 2033 206f 7574 7075 7473  , e.g. 3 outputs
+00004d60: 2066 6f72 2052 4742 0a20 2020 2020 2020   for RGB.       
+00004d70: 2020 2020 2069 6620 7365 6c66 2e69 6d67       if self.img
+00004d80: 5f6e 756d 5f63 6861 6e6e 656c 7320 3e20  _num_channels > 
+00004d90: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+00004da0: 2020 2063 6c61 7373 5f32 3d5b 5d0a 2020     class_2=[].  
+00004db0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00004dc0: 2073 656c 662e 696d 675f 6e75 6d5f 6368   self.img_num_ch
+00004dd0: 616e 6e65 6c73 203d 3d20 323a 0a20 2020  annels == 2:.   
+00004de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004df0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00004e00: 6c65 6e28 6175 676d 656e 7465 645f 696d  len(augmented_im
+00004e10: 6167 6573 5f6e 6567 6174 6976 655b 305d  ages_negative[0]
+00004e20: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00004e30: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+00004e40: 735f 322e 6170 7065 6e64 2864 6174 615f  s_2.append(data_
+00004e50: 7072 6f63 6573 7369 6e67 2e63 6f6e 6361  processing.conca
+00004e60: 745f 6368 616e 6e65 6c73 2861 7567 6d65  t_channels(augme
+00004e70: 6e74 6564 5f69 6d61 6765 735f 6e65 6761  nted_images_nega
+00004e80: 7469 7665 5b30 5d5b 695d 2c20 6175 676d  tive[0][i], augm
+00004e90: 656e 7465 645f 696d 6167 6573 5f6e 6567  ented_images_neg
+00004ea0: 6174 6976 655b 315d 5b69 5d29 290a 2020  ative[1][i])).  
+00004eb0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00004ec0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00004ed0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00004ee0: 2072 616e 6765 286c 656e 2861 7567 6d65   range(len(augme
+00004ef0: 6e74 6564 5f69 6d61 6765 735f 6e65 6761  nted_images_nega
+00004f00: 7469 7665 5b30 5d29 293a 0a20 2020 2020  tive[0])):.     
+00004f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f20: 2020 2063 6c61 7373 5f32 2e61 7070 656e     class_2.appen
+00004f30: 6428 6461 7461 5f70 726f 6365 7373 696e  d(data_processin
+00004f40: 672e 636f 6e63 6174 5f63 6861 6e6e 656c  g.concat_channel
+00004f50: 7328 6175 676d 656e 7465 645f 696d 6167  s(augmented_imag
+00004f60: 6573 5f6e 6567 6174 6976 655b 305d 5b69  es_negative[0][i
+00004f70: 5d2c 2061 7567 6d65 6e74 6564 5f69 6d61  ], augmented_ima
+00004f80: 6765 735f 6e65 6761 7469 7665 5b31 5d5b  ges_negative[1][
+00004f90: 695d 2c20 6175 676d 656e 7465 645f 696d  i], augmented_im
+00004fa0: 6167 6573 5f6e 6567 6174 6976 655b 325d  ages_negative[2]
+00004fb0: 5b69 5d29 290a 2020 2020 2020 2020 2020  [i])).          
+00004fc0: 2020 2020 2020 636c 6173 735f 3220 3d20        class_2 = 
+00004fd0: 6e70 2e61 7272 6179 2863 6c61 7373 5f32  np.array(class_2
+00004fe0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00004ff0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00005000: 2020 2020 636c 6173 735f 3220 3d20 6175      class_2 = au
+00005010: 676d 656e 7465 645f 696d 6167 6573 5f6e  gmented_images_n
+00005020: 6567 6174 6976 650a 0a20 2020 2020 2020  egative..       
+00005030: 2020 2020 2023 4261 6c61 6e63 6520 7468       #Balance th
+00005040: 6520 636c 6173 7320 7369 7a65 7320 6966  e class sizes if
+00005050: 206e 6563 6573 7361 7279 0a20 2020 2020   necessary.     
+00005060: 2020 2020 2020 2069 6620 7365 6c66 2e62         if self.b
+00005070: 616c 616e 6365 3a0a 2020 2020 2020 2020  alance:.        
+00005080: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00005090: 6261 7463 685f 6f74 6865 7220 3e20 313a  batch_other > 1:
+000050a0: 2023 4d75 7374 2073 6875 6666 6c65 2061   #Must shuffle a
+000050b0: 7320 7468 6520 6175 676d 656e 7461 7469  s the augmentati
+000050c0: 6f6e 7320 7765 7265 2073 7461 636b 6564  ons were stacked
+000050d0: 2073 6571 7565 6e74 6961 6c6c 7921 2121   sequentially!!!
+000050e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000050f0: 2020 2020 2069 7820 3d20 6e70 2e72 616e       ix = np.ran
+00005100: 646f 6d2e 7065 726d 7574 6174 696f 6e28  dom.permutation(
+00005110: 6c65 6e28 636c 6173 735f 3229 290a 2020  len(class_2)).  
+00005120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005130: 2020 636c 6173 735f 3220 3d20 636c 6173    class_2 = clas
+00005140: 735f 325b 6978 5d0a 2020 2020 2020 2020  s_2[ix].        
+00005150: 2020 2020 2020 2020 636c 6173 735f 3220          class_2 
+00005160: 3d20 636c 6173 735f 325b 3a6c 656e 2863  = class_2[:len(c
+00005170: 6c61 7373 5f31 295d 0a20 2020 2020 2020  lass_1)].       
+00005180: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00005190: 2020 2352 6573 697a 6520 6966 206e 6563    #Resize if nec
+000051a0: 6573 7361 7279 2061 6e64 2063 6f6e 6361  essary and conca
+000051b0: 7420 7468 6520 6368 616e 6e65 6c73 0a20  t the channels. 
+000051c0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+000051d0: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
+000051e0: 656c 7320 3d3d 2031 3a0a 2020 2020 2020  els == 1:.      
+000051f0: 2020 2020 2020 2020 2020 636c 6173 735f            class_
+00005200: 3220 3d20 7265 7369 7a65 2863 6c61 7373  2 = resize(class
+00005210: 5f32 2c20 7369 7a65 3d69 6d61 6765 5f73  _2, size=image_s
+00005220: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
+00005230: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00005240: 2020 2020 2020 2063 6861 6e6e 656c 3120         channel1 
+00005250: 3d20 7265 7369 7a65 2863 6c61 7373 5f32  = resize(class_2
+00005260: 5b3a 2c3a 2c3a 2c30 5d2c 2073 697a 653d  [:,:,:,0], size=
+00005270: 696d 6167 655f 7369 7a65 290a 2020 2020  image_size).    
+00005280: 2020 2020 2020 2020 2020 2020 6368 616e              chan
+00005290: 6e65 6c32 203d 2072 6573 697a 6528 636c  nel2 = resize(cl
+000052a0: 6173 735f 325b 3a2c 3a2c 3a2c 315d 2c20  ass_2[:,:,:,1], 
+000052b0: 7369 7a65 3d69 6d61 6765 5f73 697a 6529  size=image_size)
+000052c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000052d0: 2069 6620 7365 6c66 2e69 6d67 5f6e 756d   if self.img_num
+000052e0: 5f63 6861 6e6e 656c 7320 3d3d 2032 3a0a  _channels == 2:.
+000052f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005300: 2020 2020 636c 6173 735f 3220 3d20 6461      class_2 = da
+00005310: 7461 5f70 726f 6365 7373 696e 672e 636f  ta_processing.co
+00005320: 6e63 6174 5f63 6861 6e6e 656c 7328 6368  ncat_channels(ch
+00005330: 616e 6e65 6c31 2c20 6368 616e 6e65 6c32  annel1, channel2
+00005340: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00005350: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00005360: 2020 2020 2020 2020 2020 2020 6368 616e              chan
+00005370: 6e65 6c33 203d 2072 6573 697a 6528 636c  nel3 = resize(cl
+00005380: 6173 735f 325b 3a2c 3a2c 3a2c 325d 2c20  ass_2[:,:,:,2], 
+00005390: 7369 7a65 3d69 6d61 6765 5f73 697a 6529  size=image_size)
+000053a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000053b0: 2020 2020 2063 6c61 7373 5f32 203d 2064       class_2 = d
+000053c0: 6174 615f 7072 6f63 6573 7369 6e67 2e63  ata_processing.c
+000053d0: 6f6e 6361 745f 6368 616e 6e65 6c73 2863  oncat_channels(c
+000053e0: 6861 6e6e 656c 312c 2063 6861 6e6e 656c  hannel1, channel
+000053f0: 322c 2063 6861 6e6e 656c 3329 0a0a 2020  2, channel3)..  
+00005400: 2020 2020 2020 2020 2020 234e 6565 6420            #Need 
+00005410: 746f 2061 6c73 6f20 6372 6f70 2074 6865  to also crop the
+00005420: 2076 616c 6964 6174 696f 6e20 696d 6167   validation imag
+00005430: 6573 0a20 2020 2020 2020 2020 2020 2069  es.            i
+00005440: 6620 7365 6c66 2e76 616c 5f70 6f73 6974  f self.val_posit
+00005450: 6976 6520 6973 206e 6f74 204e 6f6e 653a  ive is not None:
+00005460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005470: 2069 6620 7365 6c66 2e69 6d67 5f6e 756d   if self.img_num
+00005480: 5f63 6861 6e6e 656c 7320 3d3d 2031 3a0a  _channels == 1:.
+00005490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054a0: 2020 2020 7661 6c5f 636c 6173 735f 3120      val_class_1 
+000054b0: 3d20 7265 7369 7a65 2873 656c 662e 7661  = resize(self.va
+000054c0: 6c5f 706f 7369 7469 7665 2c20 7369 7a65  l_positive, size
+000054d0: 3d69 6d61 6765 5f73 697a 6529 0a20 2020  =image_size).   
+000054e0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+000054f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00005500: 2020 2020 2020 2076 616c 5f63 6861 6e6e         val_chann
+00005510: 656c 3120 3d20 7265 7369 7a65 2873 656c  el1 = resize(sel
+00005520: 662e 7661 6c5f 706f 7369 7469 7665 5b3a  f.val_positive[:
+00005530: 2c3a 2c3a 2c30 5d2c 2073 697a 653d 696d  ,:,:,0], size=im
+00005540: 6167 655f 7369 7a65 290a 2020 2020 2020  age_size).      
+00005550: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00005560: 6c5f 6368 616e 6e65 6c32 203d 2072 6573  l_channel2 = res
+00005570: 697a 6528 7365 6c66 2e76 616c 5f70 6f73  ize(self.val_pos
+00005580: 6974 6976 655b 3a2c 3a2c 3a2c 315d 2c20  itive[:,:,:,1], 
+00005590: 7369 7a65 3d69 6d61 6765 5f73 697a 6529  size=image_size)
+000055a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000055b0: 2020 2020 2069 6620 7365 6c66 2e69 6d67       if self.img
+000055c0: 5f6e 756d 5f63 6861 6e6e 656c 7320 3d3d  _num_channels ==
+000055d0: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+000055e0: 2020 2020 2020 2020 2020 2020 7661 6c5f              val_
+000055f0: 636c 6173 735f 3120 3d20 6461 7461 5f70  class_1 = data_p
+00005600: 726f 6365 7373 696e 672e 636f 6e63 6174  rocessing.concat
+00005610: 5f63 6861 6e6e 656c 7328 7661 6c5f 6368  _channels(val_ch
+00005620: 616e 6e65 6c31 2c20 7661 6c5f 6368 616e  annel1, val_chan
+00005630: 6e65 6c32 290a 2020 2020 2020 2020 2020  nel2).          
+00005640: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00005650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005660: 2020 2020 2020 2020 7661 6c5f 6368 616e          val_chan
+00005670: 6e65 6c33 203d 2072 6573 697a 6528 7365  nel3 = resize(se
+00005680: 6c66 2e76 616c 5f70 6f73 6974 6976 655b  lf.val_positive[
+00005690: 3a2c 3a2c 3a2c 325d 2c20 7369 7a65 3d69  :,:,:,2], size=i
+000056a0: 6d61 6765 5f73 697a 6529 0a20 2020 2020  mage_size).     
+000056b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000056c0: 2020 2076 616c 5f63 6c61 7373 5f31 203d     val_class_1 =
+000056d0: 2064 6174 615f 7072 6f63 6573 7369 6e67   data_processing
+000056e0: 2e63 6f6e 6361 745f 6368 616e 6e65 6c73  .concat_channels
+000056f0: 2876 616c 5f63 6861 6e6e 656c 312c 2076  (val_channel1, v
+00005700: 616c 5f63 6861 6e6e 656c 322c 2076 616c  al_channel2, val
+00005710: 5f63 6861 6e6e 656c 3329 0a20 2020 2020  _channel3).     
+00005720: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00005730: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00005740: 5f63 6c61 7373 5f31 203d 204e 6f6e 6520  _class_1 = None 
+00005750: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00005760: 2073 656c 662e 7661 6c5f 6e65 6761 7469   self.val_negati
+00005770: 7665 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ve is not None:.
+00005780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005790: 6966 2073 656c 662e 696d 675f 6e75 6d5f  if self.img_num_
+000057a0: 6368 616e 6e65 6c73 203d 3d20 313a 0a20  channels == 1:. 
+000057b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000057c0: 2020 2076 616c 5f63 6c61 7373 5f32 203d     val_class_2 =
+000057d0: 2072 6573 697a 6528 7365 6c66 2e76 616c   resize(self.val
+000057e0: 5f6e 6567 6174 6976 652c 2073 697a 653d  _negative, size=
+000057f0: 696d 6167 655f 7369 7a65 290a 2020 2020  image_size).    
+00005800: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00005810: 2073 656c 662e 696d 675f 6e75 6d5f 6368   self.img_num_ch
+00005820: 616e 6e65 6c73 203e 2031 3a0a 2020 2020  annels > 1:.    
+00005830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005840: 7661 6c5f 6368 616e 6e65 6c31 203d 2072  val_channel1 = r
+00005850: 6573 697a 6528 7365 6c66 2e76 616c 5f6e  esize(self.val_n
+00005860: 6567 6174 6976 655b 3a2c 3a2c 3a2c 305d  egative[:,:,:,0]
+00005870: 2c20 7369 7a65 3d69 6d61 6765 5f73 697a  , size=image_siz
+00005880: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00005890: 2020 2020 2020 2076 616c 5f63 6861 6e6e         val_chann
+000058a0: 656c 3220 3d20 7265 7369 7a65 2873 656c  el2 = resize(sel
+000058b0: 662e 7661 6c5f 6e65 6761 7469 7665 5b3a  f.val_negative[:
+000058c0: 2c3a 2c3a 2c31 5d2c 2073 697a 653d 696d  ,:,:,1], size=im
+000058d0: 6167 655f 7369 7a65 290a 2020 2020 2020  age_size).      
+000058e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000058f0: 2073 656c 662e 696d 675f 6e75 6d5f 6368   self.img_num_ch
+00005900: 616e 6e65 6c73 203d 3d20 323a 0a20 2020  annels == 2:.   
+00005910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005920: 2020 2020 2076 616c 5f63 6c61 7373 5f32       val_class_2
+00005930: 203d 2064 6174 615f 7072 6f63 6573 7369   = data_processi
+00005940: 6e67 2e63 6f6e 6361 745f 6368 616e 6e65  ng.concat_channe
+00005950: 6c73 2876 616c 5f63 6861 6e6e 656c 312c  ls(val_channel1,
+00005960: 2076 616c 5f63 6861 6e6e 656c 3229 0a20   val_channel2). 
+00005970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005980: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00005990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059a0: 2076 616c 5f63 6861 6e6e 656c 3320 3d20   val_channel3 = 
+000059b0: 7265 7369 7a65 2873 656c 662e 7661 6c5f  resize(self.val_
+000059c0: 6e65 6761 7469 7665 5b3a 2c3a 2c3a 2c32  negative[:,:,:,2
+000059d0: 5d2c 2073 697a 653d 696d 6167 655f 7369  ], size=image_si
+000059e0: 7a65 290a 2020 2020 2020 2020 2020 2020  ze).            
+000059f0: 2020 2020 2020 2020 2020 2020 7661 6c5f              val_
+00005a00: 636c 6173 735f 3220 3d20 6461 7461 5f70  class_2 = data_p
+00005a10: 726f 6365 7373 696e 672e 636f 6e63 6174  rocessing.concat
+00005a20: 5f63 6861 6e6e 656c 7328 7661 6c5f 6368  _channels(val_ch
+00005a30: 616e 6e65 6c31 2c20 7661 6c5f 6368 616e  annel1, val_chan
+00005a40: 6e65 6c32 2c20 7661 6c5f 6368 616e 6e65  nel2, val_channe
+00005a50: 6c33 290a 2020 2020 2020 2020 2020 2020  l3).            
+00005a60: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00005a70: 2020 2020 2020 7661 6c5f 636c 6173 735f        val_class_
+00005a80: 3220 3d20 4e6f 6e65 200a 2020 2020 2020  2 = None .      
+00005a90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00005aa0: 2020 2020 636c 6173 735f 312c 2063 6c61      class_1, cla
+00005ab0: 7373 5f32 203d 2073 656c 662e 706f 7369  ss_2 = self.posi
+00005ac0: 7469 7665 5f63 6c61 7373 2c20 7365 6c66  tive_class, self
+00005ad0: 2e6e 6567 6174 6976 655f 636c 6173 730a  .negative_class.
+00005ae0: 2020 2020 2020 2020 2020 2020 7661 6c5f              val_
+00005af0: 636c 6173 735f 312c 2076 616c 5f63 6c61  class_1, val_cla
+00005b00: 7373 5f32 203d 2073 656c 662e 7661 6c5f  ss_2 = self.val_
+00005b10: 706f 7369 7469 7665 2c20 7365 6c66 2e76  positive, self.v
+00005b20: 616c 5f6e 6567 6174 6976 650a 0a20 2020  al_negative..   
+00005b30: 2020 2020 2023 2323 204f 7074 696d 697a       ### Optimiz
+00005b40: 6520 7468 6520 6d61 7820 7069 7865 6c20  e the max pixel 
+00005b50: 746f 2075 7365 2066 6f72 2074 6865 206d  to use for the m
+00005b60: 696e 2d6d 6178 206e 6f72 6d61 6c69 7a61  in-max normaliza
+00005b70: 7469 6f6e 202d 2d20 4f4e 4520 5049 5820  tion -- ONE PIX 
+00005b80: 5045 5220 4241 4e44 2023 2323 0a20 2020  PER BAND ###.   
+00005b90: 2020 2020 2069 6620 7365 6c66 2e6f 7074       if self.opt
+00005ba0: 5f6d 6178 5f6d 696e 5f70 6978 2069 7320  _max_min_pix is 
+00005bb0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00005bc0: 2020 2020 2020 7365 6c66 2e6e 6f72 6d61        self.norma
+00005bd0: 6c69 7a65 203d 2054 7275 6520 234a 7573  lize = True #Jus
+00005be0: 7420 696e 2063 6173 6520 6974 2773 2073  t in case it's s
+00005bf0: 6574 2074 6f20 4661 6c73 6520 6279 2074  et to False by t
+00005c00: 6865 2075 7365 7220 0a20 2020 2020 2020  he user .       
+00005c10: 2020 2020 206d 696e 5f70 6978 2c20 6d61       min_pix, ma
+00005c20: 785f 7069 7820 3d20 302e 302c 205b 5d0a  x_pix = 0.0, [].
+00005c30: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00005c40: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
+00005c50: 6e65 6c73 203e 3d20 313a 0a20 2020 2020  nels >= 1:.     
+00005c60: 2020 2020 2020 2020 2020 206d 6178 5f70             max_p
+00005c70: 6978 5f31 203d 2074 7269 616c 2e73 7567  ix_1 = trial.sug
+00005c80: 6765 7374 5f69 6e74 2827 6d61 785f 7069  gest_int('max_pi
+00005c90: 7865 6c5f 3127 2c20 7365 6c66 2e6f 7074  xel_1', self.opt
+00005ca0: 5f6d 6178 5f6d 696e 5f70 6978 2c20 7365  _max_min_pix, se
+00005cb0: 6c66 2e6f 7074 5f6d 6178 5f6d 6178 5f70  lf.opt_max_max_p
+00005cc0: 6978 2c20 7374 6570 3d31 293b 206d 6178  ix, step=1); max
+00005cd0: 5f70 6978 2e61 7070 656e 6428 6d61 785f  _pix.append(max_
+00005ce0: 7069 785f 3129 0a20 2020 2020 2020 2020  pix_1).         
+00005cf0: 2020 2069 6620 7365 6c66 2e69 6d67 5f6e     if self.img_n
+00005d00: 756d 5f63 6861 6e6e 656c 7320 3e3d 2032  um_channels >= 2
+00005d10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005d20: 2020 6d61 785f 7069 785f 3220 3d20 7472    max_pix_2 = tr
+00005d30: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+00005d40: 276d 6178 5f70 6978 656c 5f32 272c 2073  'max_pixel_2', s
+00005d50: 656c 662e 6f70 745f 6d61 785f 6d69 6e5f  elf.opt_max_min_
+00005d60: 7069 782c 2073 656c 662e 6f70 745f 6d61  pix, self.opt_ma
+00005d70: 785f 6d61 785f 7069 782c 2073 7465 703d  x_max_pix, step=
+00005d80: 3129 3b20 6d61 785f 7069 782e 6170 7065  1); max_pix.appe
+00005d90: 6e64 286d 6178 5f70 6978 5f32 290a 2020  nd(max_pix_2).  
+00005da0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00005db0: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
+00005dc0: 6c73 203d 3d20 333a 0a20 2020 2020 2020  ls == 3:.       
+00005dd0: 2020 2020 2020 2020 206d 6178 5f70 6978           max_pix
+00005de0: 5f33 203d 2074 7269 616c 2e73 7567 6765  _3 = trial.sugge
+00005df0: 7374 5f69 6e74 2827 6d61 785f 7069 7865  st_int('max_pixe
+00005e00: 6c5f 3327 2c20 7365 6c66 2e6f 7074 5f6d  l_3', self.opt_m
+00005e10: 6178 5f6d 696e 5f70 6978 2c20 7365 6c66  ax_min_pix, self
+00005e20: 2e6f 7074 5f6d 6178 5f6d 6178 5f70 6978  .opt_max_max_pix
+00005e30: 2c20 7374 6570 3d31 293b 206d 6178 5f70  , step=1); max_p
+00005e40: 6978 2e61 7070 656e 6428 6d61 785f 7069  ix.append(max_pi
+00005e50: 785f 3329 0a20 2020 2020 2020 2020 2020  x_3).           
+00005e60: 2065 6c69 6620 7365 6c66 2e69 6d67 5f6e   elif self.img_n
+00005e70: 756d 5f63 6861 6e6e 656c 7320 3e20 333a  um_channels > 3:
+00005e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005e90: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00005ea0: 7228 274f 6e6c 7920 7570 2074 6f20 7468  r('Only up to th
+00005eb0: 7265 6520 6368 616e 6e65 6c73 2061 7265  ree channels are
+00005ec0: 2063 7572 7265 6e74 6c79 2073 7570 706f   currently suppo
+00005ed0: 7274 6564 2127 290a 2020 2020 2020 2020  rted!').        
+00005ee0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00005ef0: 2020 6d69 6e5f 7069 782c 206d 6178 5f70    min_pix, max_p
+00005f00: 6978 203d 2073 656c 662e 6d69 6e5f 7069  ix = self.min_pi
+00005f10: 7865 6c2c 2073 656c 662e 6d61 785f 7069  xel, self.max_pi
+00005f20: 7865 6c0a 0a20 2020 2020 2020 2023 2323  xel..        ###
+00005f30: 2045 6172 6c79 2053 746f 7070 696e 6720   Early Stopping 
+00005f40: 616e 6420 5072 756e 696e 6720 4361 6c6c  and Pruning Call
+00005f50: 6261 636b 7320 2323 230a 2020 2020 2020  backs ###.      
+00005f60: 2020 6966 2073 656c 662e 7061 7469 656e    if self.patien
+00005f70: 6365 2021 3d20 303a 0a20 2020 2020 2020  ce != 0:.       
+00005f80: 2020 2020 206d 6f64 6520 3d20 276d 696e       mode = 'min
+00005f90: 2720 6966 2027 6c6f 7373 2720 696e 2073  ' if 'loss' in s
+00005fa0: 656c 662e 6d65 7472 6963 2065 6c73 6520  elf.metric else 
+00005fb0: 276d 6178 2720 234e 6565 6420 746f 206d  'max' #Need to m
+00005fc0: 696e 696d 697a 6520 7468 6520 6d65 7472  inimize the metr
+00005fd0: 6963 2069 6620 6576 616c 7561 7469 6e67  ic if evaluating
+00005fe0: 2074 6865 206c 6f73 7321 0a20 2020 2020   the loss!.     
+00005ff0: 2020 2020 2020 2069 6620 7365 6c66 2e6d         if self.m
+00006000: 6574 7269 6320 3d3d 2027 7661 6c5f 616c  etric == 'val_al
+00006010: 6c27 3a0a 2020 2020 2020 2020 2020 2020  l':.            
+00006020: 2020 2020 7072 696e 7428 293b 2070 7269      print(); pri
+00006030: 6e74 2822 2743 616e 6e6f 7420 7573 6520  nt("'Cannot use 
+00006040: 6561 726c 7920 7374 6f70 7069 6e67 2063  early stopping c
+00006050: 616c 6c62 6163 6b73 2069 6620 6176 6572  allbacks if aver
+00006060: 6167 696e 6720 6f75 7420 616c 6c20 7065  aging out all pe
+00006070: 7266 6f72 6d61 6e63 6520 6d65 7472 6963  rformance metric
+00006080: 7320 666f 7220 6576 616c 7561 7469 6f6e  s for evaluation
+00006090: 2120 4175 746f 6d61 7469 6361 6c6c 7920  ! Automatically 
+000060a0: 7365 7474 696e 6720 7468 6520 6d65 7472  setting the metr
+000060b0: 6963 2074 6f20 2776 616c 5f6c 6f73 7327  ic to 'val_loss'
+000060c0: 2e20 546f 2064 6973 6162 6c65 2c20 7365  . To disable, se
+000060d0: 7420 7061 7469 656e 6365 3d30 2e22 290a  t patience=0.").
+000060e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000060f0: 6361 6c6c 6261 636b 7320 3d20 5b45 6172  callbacks = [Ear
+00006100: 6c79 5374 6f70 7069 6e67 286d 6f6e 6974  lyStopping(monit
+00006110: 6f72 3d27 7661 6c5f 6c6f 7373 272c 206d  or='val_loss', m
+00006120: 6f64 653d 276d 696e 272c 2070 6174 6965  ode='min', patie
+00006130: 6e63 653d 7365 6c66 2e70 6174 6965 6e63  nce=self.patienc
+00006140: 6529 2c5d 0a20 2020 2020 2020 2020 2020  e),].           
+00006150: 2065 6c69 6620 7365 6c66 2e6d 6574 7269   elif self.metri
+00006160: 6320 3d3d 2027 616c 6c27 3a0a 2020 2020  c == 'all':.    
+00006170: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00006180: 7428 293b 2070 7269 6e74 2822 2743 616e  t(); print("'Can
+00006190: 6e6f 7420 7573 6520 6561 726c 7920 7374  not use early st
+000061a0: 6f70 7069 6e67 2063 616c 6c62 6163 6b73  opping callbacks
+000061b0: 2069 6620 6176 6572 6167 696e 6720 6f75   if averaging ou
+000061c0: 7420 616c 6c20 7065 7266 6f72 6d61 6e63  t all performanc
+000061d0: 6520 6d65 7472 6963 7320 666f 7220 6576  e metrics for ev
+000061e0: 616c 7561 7469 6f6e 2120 4175 746f 6d61  aluation! Automa
+000061f0: 7469 6361 6c6c 7920 7365 7474 696e 6720  tically setting 
+00006200: 7468 6520 6d65 7472 6963 2074 6f20 276c  the metric to 'l
+00006210: 6f73 7327 2e20 546f 2064 6973 6162 6c65  oss'. To disable
+00006220: 2c20 7365 7420 7061 7469 656e 6365 3d30  , set patience=0
+00006230: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00006240: 2020 2020 6361 6c6c 6261 636b 7320 3d20      callbacks = 
+00006250: 5b45 6172 6c79 5374 6f70 7069 6e67 286d  [EarlyStopping(m
+00006260: 6f6e 6974 6f72 3d27 6c6f 7373 272c 206d  onitor='loss', m
+00006270: 6f64 653d 276d 696e 272c 2070 6174 6965  ode='min', patie
+00006280: 6e63 653d 7365 6c66 2e70 6174 6965 6e63  nce=self.patienc
+00006290: 6529 2c5d 0a20 2020 2020 2020 2020 2020  e),].           
+000062a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000062b0: 2020 2020 2020 2063 616c 6c62 6163 6b73         callbacks
+000062c0: 203d 205b 4561 726c 7953 746f 7070 696e   = [EarlyStoppin
+000062d0: 6728 6d6f 6e69 746f 723d 7365 6c66 2e6d  g(monitor=self.m
+000062e0: 6574 7269 632c 206d 6f64 653d 6d6f 6465  etric, mode=mode
+000062f0: 2c20 7061 7469 656e 6365 3d73 656c 662e  , patience=self.
+00006300: 7061 7469 656e 6365 292c 5d20 2354 464b  patience),] #TFK
+00006310: 6572 6173 5072 756e 696e 6743 616c 6c62  erasPruningCallb
+00006320: 6163 6b28 7472 6961 6c2c 206d 6f6e 6974  ack(trial, monit
+00006330: 6f72 3d73 656c 662e 6d65 7472 6963 292c  or=self.metric),
+00006340: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00006350: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00006360: 662e 6d6f 6e69 746f 7231 2069 7320 6e6f  f.monitor1 is no
+00006370: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00006380: 2020 2020 2020 2020 6966 2063 616c 6c62          if callb
+00006390: 6163 6b73 2069 7320 6e6f 7420 4e6f 6e65  acks is not None
+000063a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000063b0: 2020 2020 2020 6361 6c6c 6261 636b 732e        callbacks.
+000063c0: 6170 7065 6e64 284d 6f6e 6974 6f72 5f54  append(Monitor_T
+000063d0: 7261 636b 6572 286d 6f6e 6974 6f72 313d  racker(monitor1=
+000063e0: 7365 6c66 2e6d 6f6e 6974 6f72 312c 206d  self.monitor1, m
+000063f0: 6f6e 6974 6f72 323d 7365 6c66 2e6d 6f6e  onitor2=self.mon
+00006400: 6974 6f72 322c 206d 6f6e 6974 6f72 315f  itor2, monitor1_
+00006410: 7468 7265 7368 3d73 656c 662e 6d6f 6e69  thresh=self.moni
+00006420: 746f 7231 5f74 6872 6573 682c 206d 6f6e  tor1_thresh, mon
+00006430: 6974 6f72 325f 7468 7265 7368 3d73 656c  itor2_thresh=sel
+00006440: 662e 6d6f 6e69 746f 7232 5f74 6872 6573  f.monitor2_thres
+00006450: 6829 290a 2020 2020 2020 2020 2020 2020  h)).            
+00006460: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00006470: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+00006480: 6c6c 6261 636b 7320 3d20 5b4d 6f6e 6974  llbacks = [Monit
+00006490: 6f72 5f54 7261 636b 6572 286d 6f6e 6974  or_Tracker(monit
+000064a0: 6f72 313d 7365 6c66 2e6d 6f6e 6974 6f72  or1=self.monitor
+000064b0: 312c 206d 6f6e 6974 6f72 323d 7365 6c66  1, monitor2=self
+000064c0: 2e6d 6f6e 6974 6f72 322c 206d 6f6e 6974  .monitor2, monit
+000064d0: 6f72 315f 7468 7265 7368 3d73 656c 662e  or1_thresh=self.
+000064e0: 6d6f 6e69 746f 7231 5f74 6872 6573 682c  monitor1_thresh,
+000064f0: 206d 6f6e 6974 6f72 325f 7468 7265 7368   monitor2_thresh
+00006500: 3d73 656c 662e 6d6f 6e69 746f 7232 5f74  =self.monitor2_t
+00006510: 6872 6573 6829 2c5d 0a20 2020 2020 2020  hresh),].       
+00006520: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00006530: 2020 2069 6620 7365 6c66 2e6d 6f6e 6974     if self.monit
+00006540: 6f72 3120 6973 206e 6f74 204e 6f6e 653a  or1 is not None:
+00006550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006560: 2063 616c 6c62 6163 6b73 203d 205b 4d6f   callbacks = [Mo
+00006570: 6e69 746f 725f 5472 6163 6b65 7228 6d6f  nitor_Tracker(mo
+00006580: 6e69 746f 7231 3d73 656c 662e 6d6f 6e69  nitor1=self.moni
+00006590: 746f 7231 2c20 6d6f 6e69 746f 7232 3d73  tor1, monitor2=s
+000065a0: 656c 662e 6d6f 6e69 746f 7232 2c20 6d6f  elf.monitor2, mo
+000065b0: 6e69 746f 7231 5f74 6872 6573 683d 7365  nitor1_thresh=se
+000065c0: 6c66 2e6d 6f6e 6974 6f72 315f 7468 7265  lf.monitor1_thre
+000065d0: 7368 2c20 6d6f 6e69 746f 7232 5f74 6872  sh, monitor2_thr
+000065e0: 6573 683d 7365 6c66 2e6d 6f6e 6974 6f72  esh=self.monitor
+000065f0: 325f 7468 7265 7368 292c 5d0a 2020 2020  2_thresh),].    
+00006600: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00006610: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+00006620: 6c6c 6261 636b 7320 3d20 4e6f 6e65 0a0a  llbacks = None..
+00006630: 2020 2020 2020 2020 2323 2320 2323 2320          ### ### 
+00006640: 2323 2320 2323 2320 2323 2320 2323 2320  ### ### ### ### 
+00006650: 2323 2320 2323 2320 2323 2320 0a20 2020  ### ### ### .   
+00006660: 2020 2020 2020 2020 2020 2323 204f 7074            ## Opt
+00006670: 696d 697a 6520 434e 4e20 4d6f 6465 6c20  imize CNN Model 
+00006680: 2323 0a20 2020 2020 2020 2023 2323 2023  ##.        ### #
+00006690: 2323 2023 2323 2023 2323 2023 2323 2023  ## ### ### ### #
+000066a0: 2323 2023 2323 2023 2323 2023 2323 200a  ## ### ### ### .
+000066b0: 0a20 2020 2020 2020 2023 2323 2042 6174  .        ### Bat
+000066c0: 6368 2053 697a 6520 2323 230a 2020 2020  ch Size ###.    
+000066d0: 2020 2020 2349 6e20 6361 7365 2075 7365      #In case use
+000066e0: 7220 7761 6e74 7320 746f 2066 6978 2074  r wants to fix t
+000066f0: 6865 2062 6174 6368 5f73 697a 652e 2e2e  he batch_size...
+00006700: 2061 6c74 686f 7567 6820 4f70 7475 6e61   although Optuna
+00006710: 2063 616e 206f 7074 696d 697a 6520 6120   can optimize a 
+00006720: 7061 7261 6d20 7261 6e67 696e 6720 6672  param ranging fr
+00006730: 6f6d 206f 6e65 2076 616c 7565 2074 6f20  om one value to 
+00006740: 7468 6520 7361 6d65 2076 616c 7565 2c20  the same value, 
+00006750: 7468 6520 696d 706f 7274 616e 6365 7320  the importances 
+00006760: 7769 6c6c 206e 6f74 2062 6520 6162 6c65  will not be able
+00006770: 2074 6f20 6265 2063 6f6d 7075 7465 6420   to be computed 
+00006780: 6166 7465 7277 6172 6473 2120 5468 6973  afterwards! This
+00006790: 2063 6f6e 6469 7469 6f6e 2069 7320 746f   condition is to
+000067a0: 2061 766f 6964 2074 6869 7320 6275 6721   avoid this bug!
+000067b0: 200a 2020 2020 2020 2020 6966 2073 656c   .        if sel
+000067c0: 662e 6261 7463 685f 7369 7a65 5f6d 696e  f.batch_size_min
+000067d0: 203d 3d20 7365 6c66 2e62 6174 6368 5f73   == self.batch_s
+000067e0: 697a 655f 6d61 783a 0a20 2020 2020 2020  ize_max:.       
+000067f0: 2020 2020 2062 6174 6368 5f73 697a 6520       batch_size 
+00006800: 3d20 7365 6c66 2e62 6174 6368 5f73 697a  = self.batch_siz
+00006810: 655f 6d61 7820 0a20 2020 2020 2020 2065  e_max .        e
+00006820: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00006830: 2062 6174 6368 5f73 697a 6520 3d20 7472   batch_size = tr
+00006840: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+00006850: 2762 6174 6368 5f73 697a 6527 2c20 7365  'batch_size', se
+00006860: 6c66 2e62 6174 6368 5f73 697a 655f 6d69  lf.batch_size_mi
+00006870: 6e2c 2073 656c 662e 6261 7463 685f 7369  n, self.batch_si
+00006880: 7a65 5f6d 6178 2c20 7374 6570 3d31 290a  ze_max, step=1).
+00006890: 0a20 2020 2020 2020 2023 2323 204c 6561  .        ### Lea
+000068a0: 726e 696e 6720 5261 7465 2026 204f 7074  rning Rate & Opt
+000068b0: 696d 697a 6572 2023 2323 0a20 2020 2020  imizer ###.     
+000068c0: 2020 206c 7220 3d20 7472 6961 6c2e 7375     lr = trial.su
+000068d0: 6767 6573 745f 666c 6f61 7428 276c 7227  ggest_float('lr'
+000068e0: 2c20 3165 2d36 2c20 3165 2d33 2c20 7374  , 1e-6, 1e-3, st
+000068f0: 6570 3d35 652d 3629 200a 2020 2020 2020  ep=5e-6) .      
+00006900: 2020 6465 6361 793d 3020 2364 6563 6179    decay=0 #decay
+00006910: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+00006920: 5f66 6c6f 6174 2827 6465 6361 7927 2c20  _float('decay', 
+00006930: 302e 302c 2030 2e31 2c20 7374 6570 3d31  0.0, 0.1, step=1
+00006940: 652d 3329 0a20 2020 2020 2020 206f 7074  e-3).        opt
+00006950: 696d 697a 6572 203d 2074 7269 616c 2e73  imizer = trial.s
+00006960: 7567 6765 7374 5f63 6174 6567 6f72 6963  uggest_categoric
+00006970: 616c 2827 6f70 7469 6d69 7a65 7227 2c20  al('optimizer', 
+00006980: 5b27 7367 6427 2c20 2761 6461 6d27 2c20  ['sgd', 'adam', 
+00006990: 2761 6461 6d61 7827 2c20 276e 6164 616d  'adamax', 'nadam
+000069a0: 272c 2027 6164 6164 656c 7461 272c 2027  ', 'adadelta', '
+000069b0: 726d 7370 726f 7027 5d29 0a0a 2020 2020  rmsprop'])..    
+000069c0: 2020 2020 2341 6c6c 2075 7365 2069 6e76      #All use inv
+000069d0: 6572 7365 2074 696d 6520 6465 6361 792c  erse time decay,
+000069e0: 2061 2066 6577 2075 7365 2072 686f 2061   a few use rho a
+000069f0: 7320 7765 6c6c 2c20 616e 6420 4164 616d  s well, and Adam
+00006a00: 2d62 6173 6564 206f 7074 696d 697a 6572  -based optimizer
+00006a10: 7320 7573 6520 6265 7461 5f31 2061 6e64  s use beta_1 and
+00006a20: 2062 6574 615f 3220 0a20 2020 2020 2020   beta_2 .       
+00006a30: 2069 6620 6f70 7469 6d69 7a65 7220 3d3d   if optimizer ==
+00006a40: 2027 7367 6427 3a0a 2020 2020 2020 2020   'sgd':.        
+00006a50: 2020 2020 6d6f 6d65 6e74 756d 203d 2074      momentum = t
+00006a60: 7269 616c 2e73 7567 6765 7374 5f66 6c6f  rial.suggest_flo
+00006a70: 6174 2827 6d6f 6d65 6e74 756d 272c 2030  at('momentum', 0
+00006a80: 2e30 2c20 312e 302c 2073 7465 703d 3165  .0, 1.0, step=1e
+00006a90: 2d33 290a 2020 2020 2020 2020 2020 2020  -3).            
+00006aa0: 6e65 7374 6572 6f76 203d 2074 7269 616c  nesterov = trial
+00006ab0: 2e73 7567 6765 7374 5f63 6174 6567 6f72  .suggest_categor
+00006ac0: 6963 616c 2827 6e65 7374 6572 6f76 272c  ical('nesterov',
+00006ad0: 205b 5472 7565 2c20 4661 6c73 655d 290a   [True, False]).
+00006ae0: 2020 2020 2020 2020 2020 2020 6265 7461              beta
+00006af0: 5f31 203d 2062 6574 615f 3220 3d20 303b  _1 = beta_2 = 0;
+00006b00: 2061 6d73 6772 6164 203d 2046 616c 7365   amsgrad = False
+00006b10: 0a20 2020 2020 2020 2065 6c69 6620 6f70  .        elif op
+00006b20: 7469 6d69 7a65 7220 3d3d 2027 6164 616d  timizer == 'adam
+00006b30: 2720 6f72 206f 7074 696d 697a 6572 203d  ' or optimizer =
+00006b40: 3d20 2761 6461 6d61 7827 206f 7220 6f70  = 'adamax' or op
+00006b50: 7469 6d69 7a65 7220 3d3d 2027 6e61 6461  timizer == 'nada
+00006b60: 6d27 3a0a 2020 2020 2020 2020 2020 2020  m':.            
+00006b70: 6265 7461 5f31 203d 2074 7269 616c 2e73  beta_1 = trial.s
+00006b80: 7567 6765 7374 5f66 6c6f 6174 2827 6265  uggest_float('be
+00006b90: 7461 5f31 272c 2030 2e30 2c20 312e 302c  ta_1', 0.0, 1.0,
+00006ba0: 2073 7465 703d 3165 2d33 290a 2020 2020   step=1e-3).    
+00006bb0: 2020 2020 2020 2020 6265 7461 5f32 203d          beta_2 =
+00006bc0: 2074 7269 616c 2e73 7567 6765 7374 5f66   trial.suggest_f
+00006bd0: 6c6f 6174 2827 6265 7461 5f32 272c 2030  loat('beta_2', 0
+00006be0: 2e30 2c20 312e 302c 2073 7465 703d 3165  .0, 1.0, step=1e
+00006bf0: 2d33 290a 2020 2020 2020 2020 2020 2020  -3).            
+00006c00: 616d 7367 7261 6420 3d20 7472 6961 6c2e  amsgrad = trial.
+00006c10: 7375 6767 6573 745f 6361 7465 676f 7269  suggest_categori
+00006c20: 6361 6c28 2761 6d73 6772 6164 272c 205b  cal('amsgrad', [
+00006c30: 5472 7565 2c20 4661 6c73 655d 2920 6966  True, False]) if
+00006c40: 206f 7074 696d 697a 6572 203d 3d20 2761   optimizer == 'a
+00006c50: 6461 6d27 2065 6c73 6520 4661 6c73 650a  dam' else False.
+00006c60: 2020 2020 2020 2020 2020 2020 6d6f 6d65              mome
+00006c70: 6e74 756d 2c20 6e65 7374 6572 6f76 203d  ntum, nesterov =
+00006c80: 2030 2e30 2c20 4661 6c73 650a 2020 2020   0.0, False.    
+00006c90: 2020 2020 656c 6966 206f 7074 696d 697a      elif optimiz
+00006ca0: 6572 203d 3d20 2761 6461 6465 6c74 6127  er == 'adadelta'
+00006cb0: 206f 7220 6f70 7469 6d69 7a65 7220 3d3d   or optimizer ==
+00006cc0: 2027 726d 7370 726f 7027 3a0a 2020 2020   'rmsprop':.    
+00006cd0: 2020 2020 2020 2020 7268 6f20 3d20 7472          rho = tr
+00006ce0: 6961 6c2e 7375 6767 6573 745f 666c 6f61  ial.suggest_floa
+00006cf0: 7428 2772 686f 272c 2030 2c20 312c 2073  t('rho', 0, 1, s
+00006d00: 7465 703d 3165 2d33 290a 2020 2020 2020  tep=1e-3).      
+00006d10: 2020 2020 2020 6d6f 6d65 6e74 756d 203d        momentum =
+00006d20: 2062 6574 615f 3120 3d20 6265 7461 5f32   beta_1 = beta_2
+00006d30: 203d 2030 3b20 6e65 7374 6572 6f76 203d   = 0; nesterov =
+00006d40: 2061 6d73 6772 6164 203d 2046 616c 7365   amsgrad = False
+00006d50: 0a0a 2020 2020 2020 2020 636c 6561 725f  ..        clear_
+00006d60: 7365 7373 696f 6e28 290a 2020 2020 2020  session().      
+00006d70: 2020 6966 2073 656c 662e 6f70 745f 6d6f    if self.opt_mo
+00006d80: 6465 6c3a 0a20 2020 2020 2020 2020 2020  del:.           
+00006d90: 2022 2222 434e 4e20 4879 7065 7270 6172   """CNN Hyperpar
+00006da0: 616d 6574 6572 2053 6561 7263 6820 5370  ameter Search Sp
+00006db0: 6163 6522 2222 0a0a 2020 2020 2020 2020  ace"""..        
+00006dc0: 2020 2020 2323 2320 4163 7469 7661 7469      ### Activati
+00006dd0: 6f6e 2061 6e64 204c 6f73 7320 4675 6e63  on and Loss Func
+00006de0: 7469 6f6e 7320 2323 2320 0a20 2020 2020  tions ### .     
+00006df0: 2020 2020 2020 2061 6374 6976 6174 696f         activatio
+00006e00: 6e5f 636f 6e76 203d 2074 7269 616c 2e73  n_conv = trial.s
+00006e10: 7567 6765 7374 5f63 6174 6567 6f72 6963  uggest_categoric
+00006e20: 616c 2827 6163 7469 7661 7469 6f6e 5f63  al('activation_c
+00006e30: 6f6e 7627 2c20 5b27 7265 6c75 272c 2020  onv', ['relu',  
+00006e40: 2773 6967 6d6f 6964 272c 2027 7461 6e68  'sigmoid', 'tanh
+00006e50: 272c 2027 656c 7527 2c20 2773 656c 7527  ', 'elu', 'selu'
+00006e60: 5d29 2020 2020 2020 2020 2020 2020 0a20  ])            . 
+00006e70: 2020 2020 2020 2020 2020 2061 6374 6976             activ
+00006e80: 6174 696f 6e5f 6465 6e73 6520 3d20 7472  ation_dense = tr
+00006e90: 6961 6c2e 7375 6767 6573 745f 6361 7465  ial.suggest_cate
+00006ea0: 676f 7269 6361 6c28 2761 6374 6976 6174  gorical('activat
+00006eb0: 696f 6e5f 6465 6e73 6527 2c20 5b27 7265  ion_dense', ['re
+00006ec0: 6c75 272c 2027 7369 676d 6f69 6427 2c20  lu', 'sigmoid', 
+00006ed0: 2774 616e 6827 2c20 2765 6c75 272c 2027  'tanh', 'elu', '
+00006ee0: 7365 6c75 275d 290a 2020 2020 2020 2020  selu']).        
+00006ef0: 2020 2020 6c6f 7373 203d 2074 7269 616c      loss = trial
+00006f00: 2e73 7567 6765 7374 5f63 6174 6567 6f72  .suggest_categor
+00006f10: 6963 616c 2827 6c6f 7373 272c 205b 2762  ical('loss', ['b
+00006f20: 696e 6172 795f 6372 6f73 7365 6e74 726f  inary_crossentro
+00006f30: 7079 272c 2027 6869 6e67 6527 2c20 2773  py', 'hinge', 's
+00006f40: 7175 6172 6564 5f68 696e 6765 272c 2027  quared_hinge', '
+00006f50: 6b6c 6427 2c20 276c 6f67 636f 7368 275d  kld', 'logcosh']
+00006f60: 2923 2c20 2766 6f63 616c 5f6c 6f73 7327  )#, 'focal_loss'
+00006f70: 2c20 2764 6963 655f 6c6f 7373 272c 2027  , 'dice_loss', '
+00006f80: 6a61 6363 6172 645f 6c6f 7373 275d 290a  jaccard_loss']).
+00006f90: 0a20 2020 2020 2020 2020 2020 2023 2323  .            ###
+00006fa0: 204b 6572 6e65 6c20 496e 6974 6961 6c69   Kernel Initiali
+00006fb0: 7a65 7273 2023 2323 0a20 2020 2020 2020  zers ###.       
+00006fc0: 2020 2020 2063 6f6e 765f 696e 6974 203d       conv_init =
+00006fd0: 2074 7269 616c 2e73 7567 6765 7374 5f63   trial.suggest_c
+00006fe0: 6174 6567 6f72 6963 616c 2827 636f 6e76  ategorical('conv
+00006ff0: 5f69 6e69 7427 2c20 5b27 756e 6966 6f72  _init', ['unifor
+00007000: 6d5f 7363 616c 696e 6727 2c20 2754 7275  m_scaling', 'Tru
+00007010: 6e63 6174 6564 4e6f 726d 616c 272c 2027  ncatedNormal', '
+00007020: 6865 5f6e 6f72 6d61 6c27 2c20 276c 6563  he_normal', 'lec
+00007030: 756e 5f75 6e69 666f 726d 272c 2027 676c  un_uniform', 'gl
+00007040: 6f72 6f74 5f75 6e69 666f 726d 275d 2920  orot_uniform']) 
+00007050: 0a20 2020 2020 2020 2020 2020 2064 656e  .            den
+00007060: 7365 5f69 6e69 7420 3d20 7472 6961 6c2e  se_init = trial.
+00007070: 7375 6767 6573 745f 6361 7465 676f 7269  suggest_categori
+00007080: 6361 6c28 2764 656e 7365 5f69 6e69 7427  cal('dense_init'
+00007090: 2c20 5b27 756e 6966 6f72 6d5f 7363 616c  , ['uniform_scal
+000070a0: 696e 6727 2c20 2754 7275 6e63 6174 6564  ing', 'Truncated
+000070b0: 4e6f 726d 616c 272c 2768 655f 6e6f 726d  Normal','he_norm
+000070c0: 616c 272c 2027 6c65 6375 6e5f 756e 6966  al', 'lecun_unif
+000070d0: 6f72 6d27 2c20 2767 6c6f 726f 745f 756e  orm', 'glorot_un
+000070e0: 6966 6f72 6d27 5d29 200a 0a20 2020 2020  iform']) ..     
+000070f0: 2020 2020 2020 2070 7269 6e74 2829 0a20         print(). 
+00007100: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00007110: 6c66 2e76 6572 626f 7365 203d 3d20 313a  lf.verbose == 1:
+00007120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007130: 2069 6620 7365 6c66 2e6f 7074 5f63 7620   if self.opt_cv 
+00007140: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00007150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007160: 2070 7269 6e74 2829 3b20 7072 696e 7428   print(); print(
+00007170: 272a 2a2a 2a2a 2a2a 2a2a 2a2a 2020 4356  '***********  CV
+00007180: 202d 2031 202a 2a2a 2a2a 2a2a 2a2a 2a2a   - 1 ***********
+00007190: 2729 3b20 7072 696e 7428 290a 2020 2020  '); print().    
+000071a0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000071b0: 656c 662e 6f70 745f 6175 673a 0a20 2020  elf.opt_aug:.   
+000071c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000071d0: 2070 7269 6e74 2829 3b20 7072 696e 7428   print(); print(
+000071e0: 273d 3d3d 3d3d 3d3d 2049 6d61 6765 2050  '======= Image P
+000071f0: 6172 616d 6574 6572 7320 3d3d 3d3d 3d3d  arameters ======
+00007200: 2729 3b20 7072 696e 7428 293b 2070 7269  '); print(); pri
+00007210: 6e74 2827 4e75 6d20 4175 676d 656e 7461  nt('Num Augmenta
+00007220: 7469 6f6e 7320 3a27 2c20 6e75 6d5f 6175  tions :', num_au
+00007230: 6729 3b20 7072 696e 7428 2749 6d61 6765  g); print('Image
+00007240: 2053 697a 6520 3a20 272c 2069 6d61 6765   Size : ', image
+00007250: 5f73 697a 6529 3b20 7072 696e 7428 274d  _size); print('M
+00007260: 6178 2050 6978 656c 2873 2920 3a27 2c20  ax Pixel(s) :', 
+00007270: 6d61 785f 7069 7829 0a0a 2020 2020 2020  max_pix)..      
+00007280: 2020 2020 2020 6966 2073 656c 662e 636c        if self.cl
+00007290: 6620 3d3d 2027 616c 6578 6e65 7427 3a0a  f == 'alexnet':.
+000072a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000072b0: 2023 2323 2052 6567 756c 6172 697a 6174   ### Regularizat
+000072c0: 696f 6e20 5465 6368 6e69 7175 6520 2842  ion Technique (B
+000072d0: 4e20 6973 206e 6577 6572 2c20 416c 6578  N is newer, Alex
+000072e0: 4e65 7420 7573 6564 2074 776f 204c 6f63  Net used two Loc
+000072f0: 616c 2052 6573 706f 6e73 6520 4e6f 726d  al Response Norm
+00007300: 616c 697a 6174 696f 6e20 6c61 7965 7273  alization layers
+00007310: 2061 6674 6572 2074 6865 2066 6972 7374   after the first
+00007320: 2074 776f 2063 6f6e 7673 2920 2323 230a   two convs) ###.
+00007330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007340: 6d6f 6465 6c5f 7265 6720 3d20 7472 6961  model_reg = tria
+00007350: 6c2e 7375 6767 6573 745f 6361 7465 676f  l.suggest_catego
+00007360: 7269 6361 6c28 276d 6f64 656c 5f72 6567  rical('model_reg
+00007370: 272c 205b 4e6f 6e65 2c20 276c 6f63 616c  ', [None, 'local
+00007380: 5f72 6573 706f 6e73 6527 2c20 2762 6174  _response', 'bat
+00007390: 6368 5f6e 6f72 6d27 5d29 0a0a 2020 2020  ch_norm'])..    
+000073a0: 2020 2020 2020 2020 2020 2020 2323 2320              ### 
+000073b0: 506f 6f6c 696e 6720 5479 7065 2023 2323  Pooling Type ###
+000073c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000073d0: 2070 6f6f 6c69 6e67 5f31 203d 2074 7269   pooling_1 = tri
+000073e0: 616c 2e73 7567 6765 7374 5f63 6174 6567  al.suggest_categ
+000073f0: 6f72 6963 616c 2827 706f 6f6c 696e 675f  orical('pooling_
+00007400: 3127 2c20 5b27 6d69 6e27 2c20 276d 6178  1', ['min', 'max
+00007410: 272c 2027 6176 6572 6167 6527 5d29 0a20  ', 'average']). 
+00007420: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00007430: 6f6f 6c69 6e67 5f32 203d 2074 7269 616c  ooling_2 = trial
+00007440: 2e73 7567 6765 7374 5f63 6174 6567 6f72  .suggest_categor
+00007450: 6963 616c 2827 706f 6f6c 696e 675f 3227  ical('pooling_2'
+00007460: 2c20 5b27 6d69 6e27 2c20 276d 6178 272c  , ['min', 'max',
+00007470: 2027 6176 6572 6167 6527 5d29 0a20 2020   'average']).   
+00007480: 2020 2020 2020 2020 2020 2020 2070 6f6f               poo
+00007490: 6c69 6e67 5f33 203d 2074 7269 616c 2e73  ling_3 = trial.s
+000074a0: 7567 6765 7374 5f63 6174 6567 6f72 6963  uggest_categoric
+000074b0: 616c 2827 706f 6f6c 696e 675f 3327 2c20  al('pooling_3', 
+000074c0: 5b27 6d69 6e27 2c20 276d 6178 272c 2027  ['min', 'max', '
+000074d0: 6176 6572 6167 6527 5d29 0a0a 2020 2020  average'])..    
+000074e0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000074f0: 656c 662e 6c69 6d69 745f 7365 6172 6368  elf.limit_search
+00007500: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007510: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+00007520: 2020 2020 2020 206d 6f64 656c 2c20 6869         model, hi
+00007530: 7374 6f72 7920 3d20 636e 6e5f 6d6f 6465  story = cnn_mode
+00007540: 6c2e 416c 6578 4e65 7428 636c 6173 735f  l.AlexNet(class_
+00007550: 312c 2063 6c61 7373 5f32 2c20 696d 675f  1, class_2, img_
+00007560: 6e75 6d5f 6368 616e 6e65 6c73 3d73 656c  num_channels=sel
+00007570: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
+00007580: 6c73 2c20 0a20 2020 2020 2020 2020 2020  ls, .           
+00007590: 2020 2020 2020 2020 2020 2020 206e 6f72               nor
+000075a0: 6d61 6c69 7a65 3d73 656c 662e 6e6f 726d  malize=self.norm
+000075b0: 616c 697a 652c 206d 696e 5f70 6978 656c  alize, min_pixel
+000075c0: 3d6d 696e 5f70 6978 2c20 6d61 785f 7069  =min_pix, max_pi
+000075d0: 7865 6c3d 6d61 785f 7069 782c 2076 616c  xel=max_pix, val
+000075e0: 5f70 6f73 6974 6976 653d 7661 6c5f 636c  _positive=val_cl
+000075f0: 6173 735f 312c 2076 616c 5f6e 6567 6174  ass_1, val_negat
+00007600: 6976 653d 7661 6c5f 636c 6173 735f 322c  ive=val_class_2,
+00007610: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00007620: 2020 2020 2020 2020 2020 6570 6f63 6873            epochs
+00007630: 3d73 656c 662e 7472 6169 6e5f 6570 6f63  =self.train_epoc
+00007640: 6873 2c20 6261 7463 685f 7369 7a65 3d62  hs, batch_size=b
+00007650: 6174 6368 5f73 697a 652c 206f 7074 696d  atch_size, optim
+00007660: 697a 6572 3d6f 7074 696d 697a 6572 2c20  izer=optimizer, 
+00007670: 6c72 3d6c 722c 2064 6563 6179 3d64 6563  lr=lr, decay=dec
+00007680: 6179 2c20 6d6f 6d65 6e74 756d 3d6d 6f6d  ay, momentum=mom
+00007690: 656e 7475 6d2c 206e 6573 7465 726f 763d  entum, nesterov=
+000076a0: 6e65 7374 6572 6f76 2c20 0a20 2020 2020  nesterov, .     
+000076b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000076c0: 2020 2062 6574 615f 313d 6265 7461 5f31     beta_1=beta_1
+000076d0: 2c20 6265 7461 5f32 3d62 6574 615f 322c  , beta_2=beta_2,
+000076e0: 2061 6d73 6772 6164 3d61 6d73 6772 6164   amsgrad=amsgrad
+000076f0: 2c20 6c6f 7373 3d6c 6f73 732c 2061 6374  , loss=loss, act
+00007700: 6976 6174 696f 6e5f 636f 6e76 3d61 6374  ivation_conv=act
+00007710: 6976 6174 696f 6e5f 636f 6e76 2c20 6163  ivation_conv, ac
+00007720: 7469 7661 7469 6f6e 5f64 656e 7365 3d61  tivation_dense=a
+00007730: 6374 6976 6174 696f 6e5f 6465 6e73 652c  ctivation_dense,
+00007740: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00007750: 2020 2020 2020 2020 2020 636f 6e76 5f69            conv_i
+00007760: 6e69 743d 636f 6e76 5f69 6e69 742c 2064  nit=conv_init, d
+00007770: 656e 7365 5f69 6e69 743d 6465 6e73 655f  ense_init=dense_
+00007780: 696e 6974 2c20 6d6f 6465 6c5f 7265 673d  init, model_reg=
+00007790: 6d6f 6465 6c5f 7265 672c 2070 6f6f 6c69  model_reg, pooli
+000077a0: 6e67 5f31 3d70 6f6f 6c69 6e67 5f31 2c20  ng_1=pooling_1, 
+000077b0: 706f 6f6c 696e 675f 323d 706f 6f6c 696e  pooling_2=poolin
+000077c0: 675f 322c 2070 6f6f 6c69 6e67 5f33 3d70  g_2, pooling_3=p
+000077d0: 6f6f 6c69 6e67 5f33 2c20 0a20 2020 2020  ooling_3, .     
+000077e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000077f0: 2020 2073 6d6f 7465 5f73 616d 706c 696e     smote_samplin
+00007800: 673d 7365 6c66 2e73 6d6f 7465 5f73 616d  g=self.smote_sam
+00007810: 706c 696e 672c 2065 6172 6c79 5f73 746f  pling, early_sto
+00007820: 705f 6361 6c6c 6261 636b 3d63 616c 6c62  p_callback=callb
+00007830: 6163 6b73 2c20 6368 6563 6b70 6f69 6e74  acks, checkpoint
+00007840: 3d46 616c 7365 2c20 7665 7262 6f73 653d  =False, verbose=
+00007850: 7365 6c66 2e76 6572 626f 7365 290a 2020  self.verbose).  
+00007860: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00007870: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00007880: 2020 2020 2020 2020 2323 2320 4669 6c74          ### Filt
+00007890: 6572 2061 6e64 204c 6179 6572 2043 6861  er and Layer Cha
+000078a0: 7261 6374 6572 7374 6963 7320 2323 230a  racterstics ###.
+000078b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000078c0: 2020 2020 6669 6c74 6572 5f31 203d 2074      filter_1 = t
+000078d0: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+000078e0: 2827 6669 6c74 6572 5f31 272c 2031 322c  ('filter_1', 12,
+000078f0: 2035 3136 2c20 7374 6570 3d31 3229 0a20   516, step=12). 
+00007900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007910: 2020 2066 696c 7465 725f 7369 7a65 5f31     filter_size_1
+00007920: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+00007930: 5f69 6e74 2827 6669 6c74 6572 5f73 697a  _int('filter_siz
+00007940: 655f 3127 2c20 312c 2031 312c 2073 7465  e_1', 1, 11, ste
+00007950: 703d 3229 0a20 2020 2020 2020 2020 2020  p=2).           
+00007960: 2020 2020 2020 2020 2073 7472 6964 6573           strides
+00007970: 5f31 203d 2074 7269 616c 2e73 7567 6765  _1 = trial.sugge
+00007980: 7374 5f69 6e74 2827 7374 7269 6465 735f  st_int('strides_
+00007990: 3127 2c20 312c 2033 2c20 7374 6570 3d31  1', 1, 3, step=1
+000079a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000079b0: 2020 2020 2020 706f 6f6c 5f73 697a 655f        pool_size_
+000079c0: 3120 3d20 7472 6961 6c2e 7375 6767 6573  1 = trial.sugges
+000079d0: 745f 696e 7428 2770 6f6f 6c5f 7369 7a65  t_int('pool_size
+000079e0: 5f31 272c 2031 2c20 372c 2073 7465 703d  _1', 1, 7, step=
+000079f0: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+00007a00: 2020 2020 2020 2070 6f6f 6c5f 7374 7269         pool_stri
+00007a10: 6465 5f31 203d 2074 7269 616c 2e73 7567  de_1 = trial.sug
+00007a20: 6765 7374 5f69 6e74 2827 706f 6f6c 5f73  gest_int('pool_s
+00007a30: 7472 6964 655f 3127 2c20 312c 2033 2c20  tride_1', 1, 3, 
+00007a40: 7374 6570 3d31 290a 0a20 2020 2020 2020  step=1)..       
+00007a50: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00007a60: 7465 725f 3220 3d20 7472 6961 6c2e 7375  ter_2 = trial.su
+00007a70: 6767 6573 745f 696e 7428 2766 696c 7465  ggest_int('filte
+00007a80: 725f 3227 2c20 3132 2c20 3531 362c 2073  r_2', 12, 516, s
+00007a90: 7465 703d 3132 290a 2020 2020 2020 2020  tep=12).        
+00007aa0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+00007ab0: 6572 5f73 697a 655f 3220 3d20 7472 6961  er_size_2 = tria
+00007ac0: 6c2e 7375 6767 6573 745f 696e 7428 2766  l.suggest_int('f
+00007ad0: 696c 7465 725f 7369 7a65 5f32 272c 2031  ilter_size_2', 1
+00007ae0: 2c20 372c 2073 7465 703d 3229 0a20 2020  , 7, step=2).   
+00007af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b00: 2073 7472 6964 6573 5f32 203d 2074 7269   strides_2 = tri
+00007b10: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+00007b20: 7374 7269 6465 735f 3227 2c20 312c 2033  strides_2', 1, 3
+00007b30: 2c20 7374 6570 3d31 290a 2020 2020 2020  , step=1).      
+00007b40: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00007b50: 6f6c 5f73 697a 655f 3220 3d20 7472 6961  ol_size_2 = tria
+00007b60: 6c2e 7375 6767 6573 745f 696e 7428 2770  l.suggest_int('p
+00007b70: 6f6f 6c5f 7369 7a65 5f32 272c 2031 2c20  ool_size_2', 1, 
+00007b80: 372c 2073 7465 703d 3129 0a20 2020 2020  7, step=1).     
+00007b90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00007ba0: 6f6f 6c5f 7374 7269 6465 5f32 203d 2074  ool_stride_2 = t
+00007bb0: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+00007bc0: 2827 706f 6f6c 5f73 7472 6964 655f 3227  ('pool_stride_2'
+00007bd0: 2c20 312c 2033 2c20 7374 6570 3d31 290a  , 1, 3, step=1).
+00007be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007bf0: 2020 2020 2066 696c 7465 725f 3320 3d20       filter_3 = 
+00007c00: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
+00007c10: 7428 2766 696c 7465 725f 3327 2c20 3132  t('filter_3', 12
+00007c20: 2c20 3531 362c 2073 7465 703d 3132 290a  , 516, step=12).
+00007c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c40: 2020 2020 6669 6c74 6572 5f73 697a 655f      filter_size_
+00007c50: 3320 3d20 7472 6961 6c2e 7375 6767 6573  3 = trial.sugges
+00007c60: 745f 696e 7428 2766 696c 7465 725f 7369  t_int('filter_si
+00007c70: 7a65 5f33 272c 2031 2c20 372c 2073 7465  ze_3', 1, 7, ste
+00007c80: 703d 3229 0a20 2020 2020 2020 2020 2020  p=2).           
+00007c90: 2020 2020 2020 2020 2073 7472 6964 6573           strides
+00007ca0: 5f33 203d 2074 7269 616c 2e73 7567 6765  _3 = trial.sugge
+00007cb0: 7374 5f69 6e74 2827 7374 7269 6465 735f  st_int('strides_
+00007cc0: 3327 2c20 312c 2033 2c20 7374 6570 3d31  3', 1, 3, step=1
+00007cd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00007ce0: 2020 2020 2020 706f 6f6c 5f73 697a 655f        pool_size_
+00007cf0: 3320 3d20 7472 6961 6c2e 7375 6767 6573  3 = trial.sugges
+00007d00: 745f 696e 7428 2770 6f6f 6c5f 7369 7a65  t_int('pool_size
+00007d10: 5f33 272c 2031 2c20 372c 2073 7465 703d  _3', 1, 7, step=
+00007d20: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+00007d30: 2020 2020 2020 2070 6f6f 6c5f 7374 7269         pool_stri
+00007d40: 6465 5f33 203d 2074 7269 616c 2e73 7567  de_3 = trial.sug
+00007d50: 6765 7374 5f69 6e74 2827 706f 6f6c 5f73  gest_int('pool_s
+00007d60: 7472 6964 655f 3327 2c20 312c 2033 2c20  tride_3', 1, 3, 
+00007d70: 7374 6570 3d31 290a 0a20 2020 2020 2020  step=1)..       
+00007d80: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00007d90: 7465 725f 3420 3d20 7472 6961 6c2e 7375  ter_4 = trial.su
+00007da0: 6767 6573 745f 696e 7428 2766 696c 7465  ggest_int('filte
+00007db0: 725f 3427 2c20 3132 2c20 3531 362c 2073  r_4', 12, 516, s
+00007dc0: 7465 703d 3132 290a 2020 2020 2020 2020  tep=12).        
+00007dd0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+00007de0: 6572 5f73 697a 655f 3420 3d20 7472 6961  er_size_4 = tria
+00007df0: 6c2e 7375 6767 6573 745f 696e 7428 2766  l.suggest_int('f
+00007e00: 696c 7465 725f 7369 7a65 5f34 272c 2031  ilter_size_4', 1
+00007e10: 2c20 372c 2073 7465 703d 3229 0a20 2020  , 7, step=2).   
+00007e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007e30: 2073 7472 6964 6573 5f34 203d 2074 7269   strides_4 = tri
+00007e40: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+00007e50: 7374 7269 6465 735f 3427 2c20 312c 2033  strides_4', 1, 3
+00007e60: 2c20 7374 6570 3d31 290a 0a20 2020 2020  , step=1)..     
+00007e70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00007e80: 696c 7465 725f 3520 3d20 7472 6961 6c2e  ilter_5 = trial.
+00007e90: 7375 6767 6573 745f 696e 7428 2766 696c  suggest_int('fil
+00007ea0: 7465 725f 3527 2c20 3132 2c20 3531 362c  ter_5', 12, 516,
+00007eb0: 2073 7465 703d 3132 290a 2020 2020 2020   step=12).      
+00007ec0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00007ed0: 6c74 6572 5f73 697a 655f 3520 3d20 7472  lter_size_5 = tr
+00007ee0: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+00007ef0: 2766 696c 7465 725f 7369 7a65 5f35 272c  'filter_size_5',
+00007f00: 2031 2c20 372c 2073 7465 703d 3229 0a20   1, 7, step=2). 
+00007f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f20: 2020 2073 7472 6964 6573 5f35 203d 2074     strides_5 = t
+00007f30: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+00007f40: 2827 7374 7269 6465 735f 3527 2c20 312c  ('strides_5', 1,
+00007f50: 2033 2c20 7374 6570 3d31 2920 0a0a 2020   3, step=1) ..  
+00007f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f70: 2020 2323 2320 4465 6e73 6520 4c61 7965    ### Dense Laye
+00007f80: 7273 2023 2323 0a20 2020 2020 2020 2020  rs ###.         
+00007f90: 2020 2020 2020 2020 2020 2064 656e 7365             dense
+00007fa0: 5f6e 6575 726f 6e73 5f31 203d 2074 7269  _neurons_1 = tri
+00007fb0: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+00007fc0: 6465 6e73 655f 6e65 7572 6f6e 735f 3127  dense_neurons_1'
+00007fd0: 2c20 3132 382c 2036 3430 302c 2073 7465  , 128, 6400, ste
+00007fe0: 703d 3132 3829 0a20 2020 2020 2020 2020  p=128).         
+00007ff0: 2020 2020 2020 2020 2020 2064 656e 7365             dense
+00008000: 5f6e 6575 726f 6e73 5f32 203d 2074 7269  _neurons_2 = tri
+00008010: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+00008020: 6465 6e73 655f 6e65 7572 6f6e 735f 3227  dense_neurons_2'
+00008030: 2c20 3132 382c 2036 3430 302c 2073 7465  , 128, 6400, ste
+00008040: 703d 3132 3829 0a20 2020 2020 2020 2020  p=128).         
+00008050: 2020 2020 2020 2020 2020 2064 726f 706f             dropo
+00008060: 7574 5f31 203d 2074 7269 616c 2e73 7567  ut_1 = trial.sug
+00008070: 6765 7374 5f66 6c6f 6174 2827 6472 6f70  gest_float('drop
+00008080: 6f75 745f 3127 2c20 302e 302c 2030 2e35  out_1', 0.0, 0.5
+00008090: 2c20 7374 6570 3d30 2e30 3129 0a20 2020  , step=0.01).   
+000080a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000080b0: 2064 726f 706f 7574 5f32 203d 2074 7269   dropout_2 = tri
+000080c0: 616c 2e73 7567 6765 7374 5f66 6c6f 6174  al.suggest_float
+000080d0: 2827 6472 6f70 6f75 745f 3227 2c20 302e  ('dropout_2', 0.
+000080e0: 302c 2030 2e35 2c20 7374 6570 3d30 2e30  0, 0.5, step=0.0
+000080f0: 3129 200a 0a20 2020 2020 2020 2020 2020  1) ..           
+00008100: 2020 2020 2020 2020 206d 6f64 656c 2c20           model, 
+00008110: 6869 7374 6f72 7920 3d20 636e 6e5f 6d6f  history = cnn_mo
+00008120: 6465 6c2e 416c 6578 4e65 7428 636c 6173  del.AlexNet(clas
+00008130: 735f 312c 2063 6c61 7373 5f32 2c20 696d  s_1, class_2, im
+00008140: 675f 6e75 6d5f 6368 616e 6e65 6c73 3d73  g_num_channels=s
+00008150: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
+00008160: 6e65 6c73 2c20 0a20 2020 2020 2020 2020  nels, .         
+00008170: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00008180: 6f72 6d61 6c69 7a65 3d73 656c 662e 6e6f  ormalize=self.no
+00008190: 726d 616c 697a 652c 206d 696e 5f70 6978  rmalize, min_pix
+000081a0: 656c 3d6d 696e 5f70 6978 2c20 6d61 785f  el=min_pix, max_
+000081b0: 7069 7865 6c3d 6d61 785f 7069 782c 2076  pixel=max_pix, v
+000081c0: 616c 5f70 6f73 6974 6976 653d 7661 6c5f  al_positive=val_
+000081d0: 636c 6173 735f 312c 2076 616c 5f6e 6567  class_1, val_neg
+000081e0: 6174 6976 653d 7661 6c5f 636c 6173 735f  ative=val_class_
+000081f0: 322c 200a 2020 2020 2020 2020 2020 2020  2, .            
+00008200: 2020 2020 2020 2020 2020 2020 6570 6f63              epoc
+00008210: 6873 3d73 656c 662e 7472 6169 6e5f 6570  hs=self.train_ep
+00008220: 6f63 6873 2c20 6261 7463 685f 7369 7a65  ochs, batch_size
+00008230: 3d62 6174 6368 5f73 697a 652c 206f 7074  =batch_size, opt
+00008240: 696d 697a 6572 3d6f 7074 696d 697a 6572  imizer=optimizer
+00008250: 2c20 6c72 3d6c 722c 2064 6563 6179 3d64  , lr=lr, decay=d
+00008260: 6563 6179 2c20 6d6f 6d65 6e74 756d 3d6d  ecay, momentum=m
+00008270: 6f6d 656e 7475 6d2c 206e 6573 7465 726f  omentum, nestero
+00008280: 763d 6e65 7374 6572 6f76 2c20 0a20 2020  v=nesterov, .   
+00008290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000082a0: 2020 2020 2062 6574 615f 313d 6265 7461       beta_1=beta
+000082b0: 5f31 2c20 6265 7461 5f32 3d62 6574 615f  _1, beta_2=beta_
+000082c0: 322c 2061 6d73 6772 6164 3d61 6d73 6772  2, amsgrad=amsgr
+000082d0: 6164 2c20 6c6f 7373 3d6c 6f73 732c 2061  ad, loss=loss, a
+000082e0: 6374 6976 6174 696f 6e5f 636f 6e76 3d61  ctivation_conv=a
+000082f0: 6374 6976 6174 696f 6e5f 636f 6e76 2c20  ctivation_conv, 
+00008300: 6163 7469 7661 7469 6f6e 5f64 656e 7365  activation_dense
+00008310: 3d61 6374 6976 6174 696f 6e5f 6465 6e73  =activation_dens
+00008320: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
+00008330: 2020 2020 2020 2020 2020 2020 636f 6e76              conv
+00008340: 5f69 6e69 743d 636f 6e76 5f69 6e69 742c  _init=conv_init,
+00008350: 2064 656e 7365 5f69 6e69 743d 6465 6e73   dense_init=dens
+00008360: 655f 696e 6974 2c20 6d6f 6465 6c5f 7265  e_init, model_re
+00008370: 673d 6d6f 6465 6c5f 7265 672c 200a 2020  g=model_reg, .  
+00008380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008390: 2020 2020 2020 6669 6c74 6572 5f31 3d66        filter_1=f
+000083a0: 696c 7465 725f 312c 2066 696c 7465 725f  ilter_1, filter_
+000083b0: 7369 7a65 5f31 3d66 696c 7465 725f 7369  size_1=filter_si
+000083c0: 7a65 5f31 2c20 7374 7269 6465 735f 313d  ze_1, strides_1=
+000083d0: 7374 7269 6465 735f 312c 2070 6f6f 6c69  strides_1, pooli
+000083e0: 6e67 5f31 3d70 6f6f 6c69 6e67 5f31 2c20  ng_1=pooling_1, 
+000083f0: 706f 6f6c 5f73 697a 655f 313d 706f 6f6c  pool_size_1=pool
+00008400: 5f73 697a 655f 312c 2070 6f6f 6c5f 7374  _size_1, pool_st
+00008410: 7269 6465 5f31 3d70 6f6f 6c5f 7374 7269  ride_1=pool_stri
+00008420: 6465 5f31 2c0a 2020 2020 2020 2020 2020  de_1,.          
+00008430: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00008440: 6c74 6572 5f32 3d66 696c 7465 725f 322c  lter_2=filter_2,
+00008450: 2066 696c 7465 725f 7369 7a65 5f32 3d66   filter_size_2=f
+00008460: 696c 7465 725f 7369 7a65 5f32 2c20 7374  ilter_size_2, st
+00008470: 7269 6465 735f 323d 7374 7269 6465 735f  rides_2=strides_
+00008480: 322c 2070 6f6f 6c69 6e67 5f32 3d70 6f6f  2, pooling_2=poo
+00008490: 6c69 6e67 5f32 2c20 706f 6f6c 5f73 697a  ling_2, pool_siz
+000084a0: 655f 323d 706f 6f6c 5f73 697a 655f 322c  e_2=pool_size_2,
+000084b0: 2070 6f6f 6c5f 7374 7269 6465 5f32 3d70   pool_stride_2=p
+000084c0: 6f6f 6c5f 7374 7269 6465 5f32 2c0a 2020  ool_stride_2,.  
+000084d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000084e0: 2020 2020 2020 6669 6c74 6572 5f33 3d66        filter_3=f
+000084f0: 696c 7465 725f 332c 2066 696c 7465 725f  ilter_3, filter_
+00008500: 7369 7a65 5f33 3d66 696c 7465 725f 7369  size_3=filter_si
+00008510: 7a65 5f33 2c20 7374 7269 6465 735f 333d  ze_3, strides_3=
+00008520: 7374 7269 6465 735f 332c 2070 6f6f 6c69  strides_3, pooli
+00008530: 6e67 5f33 3d70 6f6f 6c69 6e67 5f33 2c20  ng_3=pooling_3, 
+00008540: 706f 6f6c 5f73 697a 655f 333d 706f 6f6c  pool_size_3=pool
+00008550: 5f73 697a 655f 332c 2070 6f6f 6c5f 7374  _size_3, pool_st
+00008560: 7269 6465 5f33 3d70 6f6f 6c5f 7374 7269  ride_3=pool_stri
+00008570: 6465 5f33 2c0a 2020 2020 2020 2020 2020  de_3,.          
+00008580: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00008590: 6c74 6572 5f34 3d66 696c 7465 725f 342c  lter_4=filter_4,
+000085a0: 2066 696c 7465 725f 7369 7a65 5f34 3d66   filter_size_4=f
+000085b0: 696c 7465 725f 7369 7a65 5f34 2c20 7374  ilter_size_4, st
+000085c0: 7269 6465 735f 343d 7374 7269 6465 735f  rides_4=strides_
+000085d0: 342c 200a 2020 2020 2020 2020 2020 2020  4, .            
+000085e0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+000085f0: 6572 5f35 3d66 696c 7465 725f 352c 2066  er_5=filter_5, f
+00008600: 696c 7465 725f 7369 7a65 5f35 3d66 696c  ilter_size_5=fil
+00008610: 7465 725f 7369 7a65 5f35 2c20 7374 7269  ter_size_5, stri
+00008620: 6465 735f 353d 7374 7269 6465 735f 352c  des_5=strides_5,
+00008630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008640: 2020 2020 2020 2020 2064 656e 7365 5f6e           dense_n
+00008650: 6575 726f 6e73 5f31 3d64 656e 7365 5f6e  eurons_1=dense_n
+00008660: 6575 726f 6e73 5f31 2c20 6465 6e73 655f  eurons_1, dense_
+00008670: 6e65 7572 6f6e 735f 323d 6465 6e73 655f  neurons_2=dense_
+00008680: 6e65 7572 6f6e 735f 322c 2064 726f 706f  neurons_2, dropo
+00008690: 7574 5f31 3d64 726f 706f 7574 5f31 2c20  ut_1=dropout_1, 
+000086a0: 6472 6f70 6f75 745f 323d 6472 6f70 6f75  dropout_2=dropou
+000086b0: 745f 322c 200a 2020 2020 2020 2020 2020  t_2, .          
+000086c0: 2020 2020 2020 2020 2020 2020 2020 736d                sm
+000086d0: 6f74 655f 7361 6d70 6c69 6e67 3d73 656c  ote_sampling=sel
+000086e0: 662e 736d 6f74 655f 7361 6d70 6c69 6e67  f.smote_sampling
+000086f0: 2c20 6561 726c 795f 7374 6f70 5f63 616c  , early_stop_cal
+00008700: 6c62 6163 6b3d 6361 6c6c 6261 636b 732c  lback=callbacks,
+00008710: 2063 6865 636b 706f 696e 743d 4661 6c73   checkpoint=Fals
+00008720: 652c 2076 6572 626f 7365 3d73 656c 662e  e, verbose=self.
+00008730: 7665 7262 6f73 6529 0a0a 2020 2020 2020  verbose)..      
+00008740: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+00008750: 636c 6620 3d3d 2027 7265 736e 6574 3138  clf == 'resnet18
+00008760: 273a 0a0a 2020 2020 2020 2020 2020 2020  ':..            
+00008770: 2020 2020 2323 2320 5265 6775 6c61 7269      ### Regulari
+00008780: 7a61 7469 6f6e 2054 6563 686e 6971 7565  zation Technique
+00008790: 2028 4e6f 7465 2074 6861 7420 6966 2075   (Note that if u
+000087a0: 7369 6e67 204c 524e 2c20 7468 656e 2074  sing LRN, then t
+000087b0: 6865 2062 6c6f 636b 7320 776f 6e27 7420  he blocks won't 
+000087c0: 6861 7665 2041 4e59 2072 6567 756c 6172  have ANY regular
+000087d0: 697a 6174 696f 6e20 7369 6e63 6520 7468  ization since th
+000087e0: 6520 6f6e 6c79 206f 7074 696f 6e20 6973  e only option is
+000087f0: 2027 6261 7463 685f 6e6f 726d 2720 666f   'batch_norm' fo
+00008800: 7220 7468 6520 626c 6f63 6b73 2920 2323  r the blocks) ##
+00008810: 230a 2020 2020 2020 2020 2020 2020 2020  #.              
+00008820: 2020 6d6f 6465 6c5f 7265 6720 3d20 7472    model_reg = tr
+00008830: 6961 6c2e 7375 6767 6573 745f 6361 7465  ial.suggest_cate
+00008840: 676f 7269 6361 6c28 276d 6f64 656c 5f72  gorical('model_r
+00008850: 6567 272c 205b 4e6f 6e65 2c20 276c 6f63  eg', [None, 'loc
+00008860: 616c 5f72 6573 706f 6e73 6527 2c20 2762  al_response', 'b
+00008870: 6174 6368 5f6e 6f72 6d27 5d29 0a0a 2020  atch_norm'])..  
+00008880: 2020 2020 2020 2020 2020 2020 2020 234f                #O
+00008890: 6e6c 7920 6f6e 6520 706f 6f6c 696e 6720  nly one pooling 
+000088a0: 6c61 7965 7220 6973 2075 7365 6420 6174  layer is used at
+000088b0: 2074 6865 2076 6572 7920 6265 6769 6e6e   the very beginn
+000088c0: 696e 6720 6f66 2074 6865 206d 6f64 656c  ing of the model
+000088d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000088e0: 2070 6f6f 6c69 6e67 203d 2074 7269 616c   pooling = trial
+000088f0: 2e73 7567 6765 7374 5f63 6174 6567 6f72  .suggest_categor
+00008900: 6963 616c 2827 706f 6f6c 696e 6727 2c20  ical('pooling', 
+00008910: 5b27 6d69 6e27 2c20 276d 6178 272c 2027  ['min', 'max', '
+00008920: 6176 6572 6167 6527 5d29 0a0a 2020 2020  average'])..    
+00008930: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00008940: 656c 662e 6c69 6d69 745f 7365 6172 6368  elf.limit_search
+00008950: 3a20 2020 0a0a 2020 2020 2020 2020 2020  :   ..          
+00008960: 2020 2020 2020 2020 2020 6d6f 6465 6c2c            model,
+00008970: 2068 6973 746f 7279 203d 2063 6e6e 5f6d   history = cnn_m
+00008980: 6f64 656c 2e52 6573 6e65 7431 3828 636c  odel.Resnet18(cl
+00008990: 6173 735f 312c 2063 6c61 7373 5f32 2c20  ass_1, class_2, 
+000089a0: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+000089b0: 3d73 656c 662e 696d 675f 6e75 6d5f 6368  =self.img_num_ch
+000089c0: 616e 6e65 6c73 2c20 0a20 2020 2020 2020  annels, .       
+000089d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000089e0: 206e 6f72 6d61 6c69 7a65 3d73 656c 662e   normalize=self.
+000089f0: 6e6f 726d 616c 697a 652c 206d 696e 5f70  normalize, min_p
+00008a00: 6978 656c 3d6d 696e 5f70 6978 2c20 6d61  ixel=min_pix, ma
+00008a10: 785f 7069 7865 6c3d 6d61 785f 7069 782c  x_pixel=max_pix,
+00008a20: 2076 616c 5f70 6f73 6974 6976 653d 7661   val_positive=va
+00008a30: 6c5f 636c 6173 735f 312c 2076 616c 5f6e  l_class_1, val_n
+00008a40: 6567 6174 6976 653d 7661 6c5f 636c 6173  egative=val_clas
+00008a50: 735f 322c 200a 2020 2020 2020 2020 2020  s_2, .          
+00008a60: 2020 2020 2020 2020 2020 2020 2020 6570                ep
+00008a70: 6f63 6873 3d73 656c 662e 7472 6169 6e5f  ochs=self.train_
+00008a80: 6570 6f63 6873 2c20 6261 7463 685f 7369  epochs, batch_si
+00008a90: 7a65 3d62 6174 6368 5f73 697a 652c 206f  ze=batch_size, o
+00008aa0: 7074 696d 697a 6572 3d6f 7074 696d 697a  ptimizer=optimiz
+00008ab0: 6572 2c20 6c72 3d6c 722c 2064 6563 6179  er, lr=lr, decay
+00008ac0: 3d64 6563 6179 2c20 6d6f 6d65 6e74 756d  =decay, momentum
+00008ad0: 3d6d 6f6d 656e 7475 6d2c 206e 6573 7465  =momentum, neste
+00008ae0: 726f 763d 6e65 7374 6572 6f76 2c20 0a20  rov=nesterov, . 
+00008af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b00: 2020 2020 2020 2062 6574 615f 313d 6265         beta_1=be
+00008b10: 7461 5f31 2c20 6265 7461 5f32 3d62 6574  ta_1, beta_2=bet
+00008b20: 615f 322c 2061 6d73 6772 6164 3d61 6d73  a_2, amsgrad=ams
+00008b30: 6772 6164 2c20 6c6f 7373 3d6c 6f73 732c  grad, loss=loss,
+00008b40: 2061 6374 6976 6174 696f 6e5f 636f 6e76   activation_conv
+00008b50: 3d61 6374 6976 6174 696f 6e5f 636f 6e76  =activation_conv
+00008b60: 2c20 6163 7469 7661 7469 6f6e 5f64 656e  , activation_den
+00008b70: 7365 3d61 6374 6976 6174 696f 6e5f 6465  se=activation_de
+00008b80: 6e73 652c 200a 2020 2020 2020 2020 2020  nse, .          
+00008b90: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00008ba0: 6e76 5f69 6e69 743d 636f 6e76 5f69 6e69  nv_init=conv_ini
+00008bb0: 742c 2064 656e 7365 5f69 6e69 743d 6465  t, dense_init=de
+00008bc0: 6e73 655f 696e 6974 2c20 6d6f 6465 6c5f  nse_init, model_
+00008bd0: 7265 673d 6d6f 6465 6c5f 7265 672c 2070  reg=model_reg, p
+00008be0: 6f6f 6c69 6e67 3d70 6f6f 6c69 6e67 2c0a  ooling=pooling,.
+00008bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c00: 2020 2020 2020 2020 736d 6f74 655f 7361          smote_sa
+00008c10: 6d70 6c69 6e67 3d73 656c 662e 736d 6f74  mpling=self.smot
+00008c20: 655f 7361 6d70 6c69 6e67 2c20 6561 726c  e_sampling, earl
+00008c30: 795f 7374 6f70 5f63 616c 6c62 6163 6b3d  y_stop_callback=
+00008c40: 6361 6c6c 6261 636b 732c 2063 6865 636b  callbacks, check
+00008c50: 706f 696e 743d 4661 6c73 652c 2076 6572  point=False, ver
+00008c60: 626f 7365 3d73 656c 662e 7665 7262 6f73  bose=self.verbos
+00008c70: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00008c80: 2020 2065 6c73 653a 0a0a 2020 2020 2020     else:..      
+00008c90: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00008ca0: 6c74 6572 7320 3d20 7472 6961 6c2e 7375  lters = trial.su
+00008cb0: 6767 6573 745f 696e 7428 2766 696c 7465  ggest_int('filte
+00008cc0: 7273 272c 2031 322c 2035 3136 2c20 7374  rs', 12, 516, st
+00008cd0: 6570 3d31 3229 0a20 2020 2020 2020 2020  ep=12).         
+00008ce0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+00008cf0: 725f 7369 7a65 203d 2074 7269 616c 2e73  r_size = trial.s
+00008d00: 7567 6765 7374 5f69 6e74 2827 6669 6c74  uggest_int('filt
+00008d10: 6572 5f73 697a 6527 2c20 312c 2037 2c20  er_size', 1, 7, 
+00008d20: 7374 6570 3d32 290a 2020 2020 2020 2020  step=2).        
+00008d30: 2020 2020 2020 2020 2020 2020 7374 7269              stri
+00008d40: 6465 7320 3d20 7472 6961 6c2e 7375 6767  des = trial.sugg
+00008d50: 6573 745f 696e 7428 2773 7472 6964 6573  est_int('strides
+00008d60: 272c 2031 2c20 332c 2073 7465 703d 3129  ', 1, 3, step=1)
+00008d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008d80: 2020 2020 2070 6f6f 6c5f 7369 7a65 203d       pool_size =
+00008d90: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
+00008da0: 6e74 2827 706f 6f6c 5f73 697a 6527 2c20  nt('pool_size', 
+00008db0: 312c 2037 2c20 7374 6570 3d32 290a 2020  1, 7, step=2).  
+00008dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008dd0: 2020 706f 6f6c 5f73 7472 6964 6520 3d20    pool_stride = 
+00008de0: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
+00008df0: 7428 2770 6f6f 6c5f 7374 7269 6465 272c  t('pool_stride',
+00008e00: 2031 2c20 332c 2073 7465 703d 3129 0a0a   1, 3, step=1)..
+00008e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e20: 2020 2020 626c 6f63 6b5f 6669 6c74 6572      block_filter
+00008e30: 735f 3120 3d20 7472 6961 6c2e 7375 6767  s_1 = trial.sugg
+00008e40: 6573 745f 696e 7428 2762 6c6f 636b 5f66  est_int('block_f
+00008e50: 696c 7465 7273 5f31 272c 2031 322c 2035  ilters_1', 12, 5
+00008e60: 3136 2c20 7374 6570 3d31 3229 0a20 2020  16, step=12).   
+00008e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e80: 2062 6c6f 636b 5f66 696c 7465 7273 5f32   block_filters_2
+00008e90: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+00008ea0: 5f69 6e74 2827 626c 6f63 6b5f 6669 6c74  _int('block_filt
+00008eb0: 6572 735f 3227 2c20 3132 2c20 3531 362c  ers_2', 12, 516,
+00008ec0: 2073 7465 703d 3132 2920 0a20 2020 2020   step=12) .     
+00008ed0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00008ee0: 6c6f 636b 5f66 696c 7465 7273 5f33 203d  lock_filters_3 =
+00008ef0: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
+00008f00: 6e74 2827 626c 6f63 6b5f 6669 6c74 6572  nt('block_filter
+00008f10: 735f 3327 2c20 3132 2c20 3531 362c 2073  s_3', 12, 516, s
+00008f20: 7465 703d 3132 290a 2020 2020 2020 2020  tep=12).        
+00008f30: 2020 2020 2020 2020 2020 2020 626c 6f63              bloc
+00008f40: 6b5f 6669 6c74 6572 735f 3420 3d20 7472  k_filters_4 = tr
+00008f50: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+00008f60: 2762 6c6f 636b 5f66 696c 7465 7273 5f34  'block_filters_4
+00008f70: 272c 2031 322c 2035 3136 2c20 7374 6570  ', 12, 516, step
+00008f80: 3d31 3229 0a20 2020 2020 2020 2020 2020  =12).           
+00008f90: 2020 2020 2020 2020 2062 6c6f 636b 5f66           block_f
+00008fa0: 696c 7465 7273 5f73 697a 6520 3d20 7472  ilters_size = tr
+00008fb0: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+00008fc0: 2762 6c6f 636b 5f66 696c 7465 7273 5f73  'block_filters_s
+00008fd0: 697a 6527 2c20 312c 2037 2c20 7374 6570  ize', 1, 7, step
+00008fe0: 3d32 290a 0a20 2020 2020 2020 2020 2020  =2)..           
+00008ff0: 2020 2020 2020 2020 206d 6f64 656c 2c20           model, 
+00009000: 6869 7374 6f72 7920 3d20 636e 6e5f 6d6f  history = cnn_mo
+00009010: 6465 6c2e 5265 736e 6574 3138 2863 6c61  del.Resnet18(cla
+00009020: 7373 5f31 2c20 636c 6173 735f 322c 2069  ss_1, class_2, i
+00009030: 6d67 5f6e 756d 5f63 6861 6e6e 656c 733d  mg_num_channels=
+00009040: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
+00009050: 6e6e 656c 732c 200a 2020 2020 2020 2020  nnels, .        
+00009060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009070: 6e6f 726d 616c 697a 653d 7365 6c66 2e6e  normalize=self.n
+00009080: 6f72 6d61 6c69 7a65 2c20 6d69 6e5f 7069  ormalize, min_pi
+00009090: 7865 6c3d 6d69 6e5f 7069 782c 206d 6178  xel=min_pix, max
+000090a0: 5f70 6978 656c 3d6d 6178 5f70 6978 2c20  _pixel=max_pix, 
+000090b0: 7661 6c5f 706f 7369 7469 7665 3d76 616c  val_positive=val
+000090c0: 5f63 6c61 7373 5f31 2c20 7661 6c5f 6e65  _class_1, val_ne
+000090d0: 6761 7469 7665 3d76 616c 5f63 6c61 7373  gative=val_class
+000090e0: 5f32 2c20 0a20 2020 2020 2020 2020 2020  _2, .           
+000090f0: 2020 2020 2020 2020 2020 2020 2065 706f               epo
+00009100: 6368 733d 7365 6c66 2e74 7261 696e 5f65  chs=self.train_e
+00009110: 706f 6368 732c 2062 6174 6368 5f73 697a  pochs, batch_siz
+00009120: 653d 6261 7463 685f 7369 7a65 2c20 6f70  e=batch_size, op
+00009130: 7469 6d69 7a65 723d 6f70 7469 6d69 7a65  timizer=optimize
+00009140: 722c 206c 723d 6c72 2c20 6465 6361 793d  r, lr=lr, decay=
+00009150: 6465 6361 792c 206d 6f6d 656e 7475 6d3d  decay, momentum=
+00009160: 6d6f 6d65 6e74 756d 2c20 6e65 7374 6572  momentum, nester
+00009170: 6f76 3d6e 6573 7465 726f 762c 200a 2020  ov=nesterov, .  
+00009180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009190: 2020 2020 2020 6265 7461 5f31 3d62 6574        beta_1=bet
+000091a0: 615f 312c 2062 6574 615f 323d 6265 7461  a_1, beta_2=beta
+000091b0: 5f32 2c20 616d 7367 7261 643d 616d 7367  _2, amsgrad=amsg
+000091c0: 7261 642c 206c 6f73 733d 6c6f 7373 2c20  rad, loss=loss, 
+000091d0: 6163 7469 7661 7469 6f6e 5f63 6f6e 763d  activation_conv=
+000091e0: 6163 7469 7661 7469 6f6e 5f63 6f6e 762c  activation_conv,
+000091f0: 2061 6374 6976 6174 696f 6e5f 6465 6e73   activation_dens
+00009200: 653d 6163 7469 7661 7469 6f6e 5f64 656e  e=activation_den
+00009210: 7365 2c20 0a20 2020 2020 2020 2020 2020  se, .           
+00009220: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00009230: 765f 696e 6974 3d63 6f6e 765f 696e 6974  v_init=conv_init
+00009240: 2c20 6465 6e73 655f 696e 6974 3d64 656e  , dense_init=den
+00009250: 7365 5f69 6e69 742c 206d 6f64 656c 5f72  se_init, model_r
+00009260: 6567 3d6d 6f64 656c 5f72 6567 2c20 6669  eg=model_reg, fi
+00009270: 6c74 6572 733d 6669 6c74 6572 732c 2066  lters=filters, f
+00009280: 696c 7465 725f 7369 7a65 3d66 696c 7465  ilter_size=filte
+00009290: 725f 7369 7a65 2c20 7374 7269 6465 733d  r_size, strides=
+000092a0: 7374 7269 6465 732c 2020 0a20 2020 2020  strides,  .     
+000092b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092c0: 2020 2070 6f6f 6c69 6e67 3d70 6f6f 6c69     pooling=pooli
+000092d0: 6e67 2c20 706f 6f6c 5f73 697a 653d 706f  ng, pool_size=po
+000092e0: 6f6c 5f73 697a 652c 2070 6f6f 6c5f 7374  ol_size, pool_st
+000092f0: 7269 6465 3d70 6f6f 6c5f 7374 7269 6465  ride=pool_stride
+00009300: 2c20 626c 6f63 6b5f 6669 6c74 6572 735f  , block_filters_
+00009310: 313d 626c 6f63 6b5f 6669 6c74 6572 735f  1=block_filters_
+00009320: 312c 2062 6c6f 636b 5f66 696c 7465 7273  1, block_filters
+00009330: 5f32 3d62 6c6f 636b 5f66 696c 7465 7273  _2=block_filters
+00009340: 5f32 2c20 0a20 2020 2020 2020 2020 2020  _2, .           
+00009350: 2020 2020 2020 2020 2020 2020 2062 6c6f               blo
+00009360: 636b 5f66 696c 7465 7273 5f33 3d62 6c6f  ck_filters_3=blo
+00009370: 636b 5f66 696c 7465 7273 5f33 2c20 626c  ck_filters_3, bl
+00009380: 6f63 6b5f 6669 6c74 6572 735f 343d 626c  ock_filters_4=bl
+00009390: 6f63 6b5f 6669 6c74 6572 735f 342c 2062  ock_filters_4, b
+000093a0: 6c6f 636b 5f66 696c 7465 7273 5f73 697a  lock_filters_siz
+000093b0: 653d 626c 6f63 6b5f 6669 6c74 6572 735f  e=block_filters_
+000093c0: 7369 7a65 2c20 0a20 2020 2020 2020 2020  size, .         
+000093d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000093e0: 6d6f 7465 5f73 616d 706c 696e 673d 7365  mote_sampling=se
+000093f0: 6c66 2e73 6d6f 7465 5f73 616d 706c 696e  lf.smote_samplin
+00009400: 672c 2065 6172 6c79 5f73 746f 705f 6361  g, early_stop_ca
+00009410: 6c6c 6261 636b 3d63 616c 6c62 6163 6b73  llback=callbacks
+00009420: 2c20 6368 6563 6b70 6f69 6e74 3d46 616c  , checkpoint=Fal
+00009430: 7365 2c20 7665 7262 6f73 653d 7365 6c66  se, verbose=self
+00009440: 2e76 6572 626f 7365 290a 0a20 2020 2020  .verbose)..     
+00009450: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00009460: 2e63 6c66 203d 3d20 2763 7573 746f 6d5f  .clf == 'custom_
+00009470: 636e 6e27 3a0a 2020 2020 2020 2020 2020  cnn':.          
+00009480: 2020 2020 2020 6966 2073 656c 662e 6c69        if self.li
+00009490: 6d69 745f 7365 6172 6368 3a0a 2020 2020  mit_search:.    
+000094a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094b0: 7072 696e 7428 2754 6865 7265 2069 7320  print('There is 
+000094c0: 6e6f 206c 696d 6974 5f73 6561 7263 6820  no limit_search 
+000094d0: 6f70 7469 6f6e 2069 6620 636c 663d 2263  option if clf="c
+000094e0: 7573 746f 6d5f 636e 6e22 2c20 6f70 7469  ustom_cnn", opti
+000094f0: 6d69 7a69 6e67 2061 6c6c 206c 6179 6572  mizing all layer
+00009500: 732e 2e2e 2729 0a0a 2020 2020 2020 2020  s...')..        
+00009510: 2020 2020 2020 2020 6d6f 6465 6c5f 7265          model_re
+00009520: 6720 3d20 7472 6961 6c2e 7375 6767 6573  g = trial.sugges
+00009530: 745f 6361 7465 676f 7269 6361 6c28 276d  t_categorical('m
+00009540: 6f64 656c 5f72 6567 272c 205b 4e6f 6e65  odel_reg', [None
+00009550: 2c20 276c 6f63 616c 5f72 6573 706f 6e73  , 'local_respons
+00009560: 6527 2c20 2762 6174 6368 5f6e 6f72 6d27  e', 'batch_norm'
+00009570: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00009580: 2020 2023 4375 7374 6f6d 2043 4e4e 2066     #Custom CNN f
+00009590: 756e 6374 696f 6e2c 2074 6865 2066 6972  unction, the fir
+000095a0: 7374 2043 4f4e 5620 6c61 7965 7220 6973  st CONV layer is
+000095b0: 2072 6571 7569 7265 642e 200a 2020 2020   required. .    
+000095c0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+000095d0: 6572 5f31 203d 2074 7269 616c 2e73 7567  er_1 = trial.sug
+000095e0: 6765 7374 5f69 6e74 2827 6669 6c74 6572  gest_int('filter
+000095f0: 5f31 272c 2031 322c 2035 3136 2c20 7374  _1', 12, 516, st
+00009600: 6570 3d31 3229 0a20 2020 2020 2020 2020  ep=12).         
+00009610: 2020 2020 2020 2066 696c 7465 725f 7369         filter_si
+00009620: 7a65 5f31 203d 2074 7269 616c 2e73 7567  ze_1 = trial.sug
+00009630: 6765 7374 5f69 6e74 2827 6669 6c74 6572  gest_int('filter
+00009640: 5f73 697a 655f 3127 2c20 312c 2031 312c  _size_1', 1, 11,
+00009650: 2073 7465 703d 3229 0a20 2020 2020 2020   step=2).       
+00009660: 2020 2020 2020 2020 2070 6f6f 6c69 6e67           pooling
+00009670: 5f31 203d 2074 7269 616c 2e73 7567 6765  _1 = trial.sugge
+00009680: 7374 5f63 6174 6567 6f72 6963 616c 2827  st_categorical('
+00009690: 706f 6f6c 696e 675f 3127 2c20 5b27 6d69  pooling_1', ['mi
+000096a0: 6e27 2c20 276d 6178 272c 2027 6176 6572  n', 'max', 'aver
+000096b0: 6167 6527 5d29 0a20 2020 2020 2020 2020  age']).         
+000096c0: 2020 2020 2020 2070 6f6f 6c5f 7369 7a65         pool_size
+000096d0: 5f31 203d 2074 7269 616c 2e73 7567 6765  _1 = trial.sugge
+000096e0: 7374 5f69 6e74 2827 706f 6f6c 5f73 697a  st_int('pool_siz
+000096f0: 655f 3127 2c20 312c 2037 2c20 7374 6570  e_1', 1, 7, step
+00009700: 3d31 290a 2020 2020 2020 2020 2020 2020  =1).            
+00009710: 2020 2020 7374 7269 6465 735f 3120 3d20      strides_1 = 
+00009720: 706f 6f6c 5f73 7472 6964 655f 3120 3d20  pool_stride_1 = 
+00009730: 7374 7269 6465 735f 3220 3d20 706f 6f6c  strides_2 = pool
+00009740: 5f73 7472 6964 655f 3220 3d20 7374 7269  _stride_2 = stri
+00009750: 6465 735f 3320 3d20 706f 6f6c 5f73 7472  des_3 = pool_str
+00009760: 6964 655f 3320 3d20 310a 0a20 2020 2020  ide_3 = 1..     
+00009770: 2020 2020 2020 2020 2020 206e 756d 5f63             num_c
+00009780: 6f6e 765f 6c61 7965 7273 203d 2074 7269  onv_layers = tri
+00009790: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+000097a0: 6e75 6d5f 636f 6e76 5f6c 6179 6572 7327  num_conv_layers'
+000097b0: 2c20 312c 2033 2c20 7374 6570 3d31 290a  , 1, 3, step=1).
+000097c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000097d0: 2069 6620 6e75 6d5f 636f 6e76 5f6c 6179   if num_conv_lay
+000097e0: 6572 7320 3d3d 2031 3a0a 2020 2020 2020  ers == 1:.      
+000097f0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00009800: 6c74 6572 5f32 203d 2066 696c 7465 725f  lter_2 = filter_
+00009810: 7369 7a65 5f32 203d 2070 6f6f 6c5f 7369  size_2 = pool_si
+00009820: 7a65 5f32 203d 2066 696c 7465 725f 3320  ze_2 = filter_3 
+00009830: 3d20 6669 6c74 6572 5f73 697a 655f 3320  = filter_size_3 
+00009840: 3d20 7374 7269 6465 735f 3320 3d20 706f  = strides_3 = po
+00009850: 6f6c 5f73 697a 655f 3320 3d20 303b 2070  ol_size_3 = 0; p
+00009860: 6f6f 6c69 6e67 5f32 203d 2070 6f6f 6c69  ooling_2 = pooli
+00009870: 6e67 5f33 203d 204e 6f6e 650a 2020 2020  ng_3 = None.    
+00009880: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00009890: 756d 5f63 6f6e 765f 6c61 7965 7273 203e  um_conv_layers >
+000098a0: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
+000098b0: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+000098c0: 3220 3d20 7472 6961 6c2e 7375 6767 6573  2 = trial.sugges
+000098d0: 745f 696e 7428 2766 696c 7465 725f 3227  t_int('filter_2'
+000098e0: 2c20 3132 2c20 3531 362c 2073 7465 703d  , 12, 516, step=
+000098f0: 3132 290a 2020 2020 2020 2020 2020 2020  12).            
+00009900: 2020 2020 2020 2020 6669 6c74 6572 5f73          filter_s
+00009910: 697a 655f 3220 3d20 7472 6961 6c2e 7375  ize_2 = trial.su
+00009920: 6767 6573 745f 696e 7428 2766 696c 7465  ggest_int('filte
+00009930: 725f 7369 7a65 5f32 272c 2031 2c20 372c  r_size_2', 1, 7,
+00009940: 2073 7465 703d 3229 0a20 2020 2020 2020   step=2).       
+00009950: 2020 2020 2020 2020 2020 2020 2070 6f6f               poo
+00009960: 6c69 6e67 5f32 203d 2074 7269 616c 2e73  ling_2 = trial.s
+00009970: 7567 6765 7374 5f63 6174 6567 6f72 6963  uggest_categoric
+00009980: 616c 2827 706f 6f6c 696e 675f 3227 2c20  al('pooling_2', 
+00009990: 5b27 6d69 6e27 2c20 276d 6178 272c 2027  ['min', 'max', '
+000099a0: 6176 6572 6167 6527 5d29 0a20 2020 2020  average']).     
+000099b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000099c0: 6f6f 6c5f 7369 7a65 5f32 203d 2074 7269  ool_size_2 = tri
+000099d0: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+000099e0: 706f 6f6c 5f73 697a 655f 3227 2c20 312c  pool_size_2', 1,
+000099f0: 2037 2c20 7374 6570 3d31 290a 2020 2020   7, step=1).    
+00009a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009a10: 6669 6c74 6572 5f33 203d 2066 696c 7465  filter_3 = filte
+00009a20: 725f 7369 7a65 5f33 203d 2070 6f6f 6c5f  r_size_3 = pool_
+00009a30: 7369 7a65 5f33 203d 2030 3b20 706f 6f6c  size_3 = 0; pool
+00009a40: 696e 675f 3320 3d20 4e6f 6e65 0a20 2020  ing_3 = None.   
+00009a50: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00009a60: 6e75 6d5f 636f 6e76 5f6c 6179 6572 7320  num_conv_layers 
+00009a70: 3d3d 2033 3a0a 2020 2020 2020 2020 2020  == 3:.          
+00009a80: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00009a90: 5f33 203d 2074 7269 616c 2e73 7567 6765  _3 = trial.sugge
+00009aa0: 7374 5f69 6e74 2827 6669 6c74 6572 5f33  st_int('filter_3
+00009ab0: 272c 2031 322c 2035 3136 2c20 7374 6570  ', 12, 516, step
+00009ac0: 3d31 3229 0a20 2020 2020 2020 2020 2020  =12).           
+00009ad0: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+00009ae0: 7369 7a65 5f33 203d 2074 7269 616c 2e73  size_3 = trial.s
+00009af0: 7567 6765 7374 5f69 6e74 2827 6669 6c74  uggest_int('filt
+00009b00: 6572 5f73 697a 655f 3327 2c20 312c 2037  er_size_3', 1, 7
+00009b10: 2c20 7374 6570 3d32 290a 2020 2020 2020  , step=2).      
+00009b20: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00009b30: 6f6c 696e 675f 3320 3d20 7472 6961 6c2e  oling_3 = trial.
+00009b40: 7375 6767 6573 745f 6361 7465 676f 7269  suggest_categori
+00009b50: 6361 6c28 2770 6f6f 6c69 6e67 5f33 272c  cal('pooling_3',
+00009b60: 205b 276d 696e 272c 2027 6d61 7827 2c20   ['min', 'max', 
+00009b70: 2761 7665 7261 6765 275d 290a 2020 2020  'average']).    
+00009b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b90: 706f 6f6c 5f73 697a 655f 3320 3d20 7472  pool_size_3 = tr
+00009ba0: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+00009bb0: 2770 6f6f 6c5f 7369 7a65 5f33 272c 2031  'pool_size_3', 1
+00009bc0: 2c20 372c 2073 7465 703d 3129 0a0a 2020  , 7, step=1)..  
+00009bd0: 2020 2020 2020 2020 2020 2020 2020 2323                ##
+00009be0: 2320 4465 6e73 6520 4c61 7965 7273 2023  # Dense Layers #
+00009bf0: 2323 0a0a 2020 2020 2020 2020 2020 2020  ##..            
+00009c00: 2020 2020 6465 6e73 655f 6e65 7572 6f6e      dense_neuron
+00009c10: 735f 3120 3d20 7472 6961 6c2e 7375 6767  s_1 = trial.sugg
+00009c20: 6573 745f 696e 7428 2764 656e 7365 5f6e  est_int('dense_n
+00009c30: 6575 726f 6e73 5f31 272c 2031 3238 2c20  eurons_1', 128, 
+00009c40: 3634 3030 2c20 7374 6570 3d31 3238 290a  6400, step=128).
+00009c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c60: 6472 6f70 6f75 745f 3120 3d20 7472 6961  dropout_1 = tria
+00009c70: 6c2e 7375 6767 6573 745f 666c 6f61 7428  l.suggest_float(
+00009c80: 2764 726f 706f 7574 5f31 272c 2030 2e30  'dropout_1', 0.0
+00009c90: 2c20 302e 352c 2073 7465 703d 302e 3031  , 0.5, step=0.01
+00009ca0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00009cb0: 2020 6e75 6d5f 6465 6e73 655f 6c61 7965    num_dense_laye
+00009cc0: 7273 203d 2074 7269 616c 2e73 7567 6765  rs = trial.sugge
+00009cd0: 7374 5f69 6e74 2827 6e75 6d5f 6465 6e73  st_int('num_dens
+00009ce0: 655f 6c61 7965 7273 272c 2031 2c20 332c  e_layers', 1, 3,
+00009cf0: 2073 7465 703d 3129 0a0a 2020 2020 2020   step=1)..      
+00009d00: 2020 2020 2020 2020 2020 6966 206e 756d            if num
+00009d10: 5f64 656e 7365 5f6c 6179 6572 7320 3d3d  _dense_layers ==
+00009d20: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00009d30: 2020 2020 2020 2020 6465 6e73 655f 6e65          dense_ne
+00009d40: 7572 6f6e 735f 3220 3d20 6472 6f70 6f75  urons_2 = dropou
+00009d50: 745f 3220 3d20 6465 6e73 655f 6e65 7572  t_2 = dense_neur
+00009d60: 6f6e 735f 3320 3d20 6472 6f70 6f75 745f  ons_3 = dropout_
+00009d70: 3320 3d20 300a 2020 2020 2020 2020 2020  3 = 0.          
+00009d80: 2020 2020 2020 6966 206e 756d 5f64 656e        if num_den
+00009d90: 7365 5f6c 6179 6572 7320 3e3d 2032 3a0a  se_layers >= 2:.
+00009da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009db0: 2020 2020 6465 6e73 655f 6e65 7572 6f6e      dense_neuron
+00009dc0: 735f 3220 3d20 7472 6961 6c2e 7375 6767  s_2 = trial.sugg
+00009dd0: 6573 745f 696e 7428 2764 656e 7365 5f6e  est_int('dense_n
+00009de0: 6575 726f 6e73 5f32 272c 2031 3238 2c20  eurons_2', 128, 
+00009df0: 3634 3030 2c20 7374 6570 3d31 3238 290a  6400, step=128).
+00009e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e10: 2020 2020 6472 6f70 6f75 745f 3220 3d20      dropout_2 = 
+00009e20: 7472 6961 6c2e 7375 6767 6573 745f 666c  trial.suggest_fl
+00009e30: 6f61 7428 2764 726f 706f 7574 5f32 272c  oat('dropout_2',
+00009e40: 2030 2e30 2c20 302e 352c 2073 7465 703d   0.0, 0.5, step=
+00009e50: 302e 3031 290a 2020 2020 2020 2020 2020  0.01).          
+00009e60: 2020 2020 2020 2020 2020 6465 6e73 655f            dense_
+00009e70: 6e65 7572 6f6e 735f 3320 3d20 6472 6f70  neurons_3 = drop
+00009e80: 6f75 745f 3320 3d20 300a 2020 2020 2020  out_3 = 0.      
+00009e90: 2020 2020 2020 2020 2020 6966 206e 756d            if num
+00009ea0: 5f64 656e 7365 5f6c 6179 6572 7320 3d3d  _dense_layers ==
+00009eb0: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
+00009ec0: 2020 2020 2020 2020 6465 6e73 655f 6e65          dense_ne
+00009ed0: 7572 6f6e 735f 3320 3d20 7472 6961 6c2e  urons_3 = trial.
+00009ee0: 7375 6767 6573 745f 696e 7428 2764 656e  suggest_int('den
+00009ef0: 7365 5f6e 6575 726f 6e73 5f33 272c 2031  se_neurons_3', 1
+00009f00: 3238 2c20 3634 3030 2c20 7374 6570 3d31  28, 6400, step=1
+00009f10: 3238 290a 2020 2020 2020 2020 2020 2020  28).            
+00009f20: 2020 2020 2020 2020 6472 6f70 6f75 745f          dropout_
+00009f30: 3320 3d20 7472 6961 6c2e 7375 6767 6573  3 = trial.sugges
+00009f40: 745f 666c 6f61 7428 2764 726f 706f 7574  t_float('dropout
+00009f50: 5f33 272c 2030 2e30 2c20 302e 352c 2073  _3', 0.0, 0.5, s
+00009f60: 7465 703d 302e 3031 290a 0a20 2020 2020  tep=0.01)..     
+00009f70: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+00009f80: 2c20 6869 7374 6f72 7920 3d20 636e 6e5f  , history = cnn_
+00009f90: 6d6f 6465 6c2e 6375 7374 6f6d 5f6d 6f64  model.custom_mod
+00009fa0: 656c 2863 6c61 7373 5f31 2c20 636c 6173  el(class_1, clas
+00009fb0: 735f 322c 2069 6d67 5f6e 756d 5f63 6861  s_2, img_num_cha
+00009fc0: 6e6e 656c 733d 7365 6c66 2e69 6d67 5f6e  nnels=self.img_n
+00009fd0: 756d 5f63 6861 6e6e 656c 732c 200a 2020  um_channels, .  
+00009fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ff0: 2020 6e6f 726d 616c 697a 653d 7365 6c66    normalize=self
+0000a000: 2e6e 6f72 6d61 6c69 7a65 2c20 6d69 6e5f  .normalize, min_
+0000a010: 7069 7865 6c3d 6d69 6e5f 7069 782c 206d  pixel=min_pix, m
+0000a020: 6178 5f70 6978 656c 3d6d 6178 5f70 6978  ax_pixel=max_pix
+0000a030: 2c20 7661 6c5f 706f 7369 7469 7665 3d76  , val_positive=v
+0000a040: 616c 5f63 6c61 7373 5f31 2c20 7661 6c5f  al_class_1, val_
+0000a050: 6e65 6761 7469 7665 3d76 616c 5f63 6c61  negative=val_cla
+0000a060: 7373 5f32 2c20 0a20 2020 2020 2020 2020  ss_2, .         
+0000a070: 2020 2020 2020 2020 2020 2065 706f 6368             epoch
+0000a080: 733d 7365 6c66 2e74 7261 696e 5f65 706f  s=self.train_epo
+0000a090: 6368 732c 2062 6174 6368 5f73 697a 653d  chs, batch_size=
+0000a0a0: 6261 7463 685f 7369 7a65 2c20 6f70 7469  batch_size, opti
+0000a0b0: 6d69 7a65 723d 6f70 7469 6d69 7a65 722c  mizer=optimizer,
+0000a0c0: 206c 723d 6c72 2c20 6465 6361 793d 6465   lr=lr, decay=de
+0000a0d0: 6361 792c 206d 6f6d 656e 7475 6d3d 6d6f  cay, momentum=mo
+0000a0e0: 6d65 6e74 756d 2c20 6e65 7374 6572 6f76  mentum, nesterov
+0000a0f0: 3d6e 6573 7465 726f 762c 200a 2020 2020  =nesterov, .    
 0000a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a110: 2076 616c 5f63 6c61 7373 5f32 203d 2064   val_class_2 = d
-0000a120: 6174 615f 7072 6f63 6573 7369 6e67 2e63  ata_processing.c
-0000a130: 6f6e 6361 745f 6368 616e 6e65 6c73 2876  oncat_channels(v
-0000a140: 616c 5f63 6861 6e6e 656c 312c 2076 616c  al_channel1, val
-0000a150: 5f63 6861 6e6e 656c 322c 2076 616c 5f63  _channel2, val_c
-0000a160: 6861 6e6e 656c 3329 0a0a 2020 2020 2020  hannel3)..      
-0000a170: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000a180: 662e 7665 7262 6f73 6520 3d3d 2031 3a0a  f.verbose == 1:.
+0000a110: 6265 7461 5f31 3d62 6574 615f 312c 2062  beta_1=beta_1, b
+0000a120: 6574 615f 323d 6265 7461 5f32 2c20 616d  eta_2=beta_2, am
+0000a130: 7367 7261 643d 616d 7367 7261 642c 206c  sgrad=amsgrad, l
+0000a140: 6f73 733d 6c6f 7373 2c20 6163 7469 7661  oss=loss, activa
+0000a150: 7469 6f6e 5f63 6f6e 763d 6163 7469 7661  tion_conv=activa
+0000a160: 7469 6f6e 5f63 6f6e 762c 2061 6374 6976  tion_conv, activ
+0000a170: 6174 696f 6e5f 6465 6e73 653d 6163 7469  ation_dense=acti
+0000a180: 7661 7469 6f6e 5f64 656e 7365 2c20 0a20  vation_dense, . 
 0000a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1a0: 2020 2020 7072 696e 7428 290a 2020 2020      print().    
-0000a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1c0: 7072 696e 7428 272a 2a2a 2a2a 2a2a 2a2a  print('*********
-0000a1d0: 2a2a 2020 4356 202d 207b 7d20 2a2a 2a2a  **  CV - {} ****
-0000a1e0: 2a2a 2a2a 2a2a 2a27 2e66 6f72 6d61 7428  *******'.format(
-0000a1f0: 6b2b 3229 290a 2020 2020 2020 2020 2020  k+2)).          
-0000a200: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000a210: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000a220: 2020 2063 6c65 6172 5f73 6573 7369 6f6e     clear_session
-0000a230: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0000a240: 2020 2069 6620 7365 6c66 2e6f 7074 5f6d     if self.opt_m
-0000a250: 6f64 656c 2069 7320 4661 6c73 653a 0a20  odel is False:. 
-0000a260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a270: 2020 206d 6f64 656c 2c20 6869 7374 6f72     model, histor
-0000a280: 7920 3d20 636e 6e5f 6d6f 6465 6c2e 416c  y = cnn_model.Al
-0000a290: 6578 4e65 7428 636c 6173 735f 312c 2063  exNet(class_1, c
-0000a2a0: 6c61 7373 5f32 2c20 696d 675f 6e75 6d5f  lass_2, img_num_
-0000a2b0: 6368 616e 6e65 6c73 3d73 656c 662e 696d  channels=self.im
-0000a2c0: 675f 6e75 6d5f 6368 616e 6e65 6c73 2c20  g_num_channels, 
-0000a2d0: 6e6f 726d 616c 697a 653d 7365 6c66 2e6e  normalize=self.n
-0000a2e0: 6f72 6d61 6c69 7a65 2c20 0a20 2020 2020  ormalize, .     
-0000a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a300: 2020 206d 696e 5f70 6978 656c 3d6d 696e     min_pixel=min
-0000a310: 5f70 6978 2c20 6d61 785f 7069 7865 6c3d  _pix, max_pixel=
-0000a320: 6d61 785f 7069 782c 2076 616c 5f70 6f73  max_pix, val_pos
-0000a330: 6974 6976 653d 7661 6c5f 636c 6173 735f  itive=val_class_
-0000a340: 312c 2076 616c 5f6e 6567 6174 6976 653d  1, val_negative=
-0000a350: 7661 6c5f 636c 6173 735f 322c 2065 706f  val_class_2, epo
-0000a360: 6368 733d 7365 6c66 2e74 7261 696e 5f65  chs=self.train_e
-0000a370: 706f 6368 732c 200a 2020 2020 2020 2020  pochs, .        
-0000a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a390: 6261 7463 685f 7369 7a65 3d62 6174 6368  batch_size=batch
-0000a3a0: 5f73 697a 652c 206c 723d 6c72 2c20 6d6f  _size, lr=lr, mo
-0000a3b0: 6d65 6e74 756d 3d6d 6f6d 656e 7475 6d2c  mentum=momentum,
-0000a3c0: 2064 6563 6179 3d64 6563 6179 2c20 6e65   decay=decay, ne
-0000a3d0: 7374 6572 6f76 3d6e 6573 7465 726f 762c  sterov=nesterov,
-0000a3e0: 2065 6172 6c79 5f73 746f 705f 6361 6c6c   early_stop_call
-0000a3f0: 6261 636b 3d63 616c 6c62 6163 6b73 2c20  back=callbacks, 
-0000a400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a410: 2020 2020 2020 2020 2063 6f6e 765f 696e           conv_in
-0000a420: 6974 3d63 6f6e 765f 696e 6974 2c20 6465  it=conv_init, de
-0000a430: 6e73 655f 696e 6974 3d64 656e 7365 5f69  nse_init=dense_i
-0000a440: 6e69 742c 2063 6865 636b 706f 696e 743d  nit, checkpoint=
-0000a450: 4661 6c73 652c 2076 6572 626f 7365 3d73  False, verbose=s
-0000a460: 656c 662e 7665 7262 6f73 652c 206f 7074  elf.verbose, opt
-0000a470: 696d 697a 6572 3d6f 7074 696d 697a 6572  imizer=optimizer
-0000a480: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000a490: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000a4a0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000a4b0: 656c 662e 6c69 6d69 745f 7365 6172 6368  elf.limit_search
-0000a4c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a4d0: 2020 2020 2020 2020 2020 6d6f 6465 6c2c            model,
-0000a4e0: 2068 6973 746f 7279 203d 2063 6e6e 5f6d   history = cnn_m
-0000a4f0: 6f64 656c 2e41 6c65 784e 6574 2863 6c61  odel.AlexNet(cla
-0000a500: 7373 5f31 2c20 636c 6173 735f 322c 2069  ss_1, class_2, i
-0000a510: 6d67 5f6e 756d 5f63 6861 6e6e 656c 733d  mg_num_channels=
-0000a520: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
-0000a530: 6e6e 656c 732c 200a 2020 2020 2020 2020  nnels, .        
-0000a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a550: 2020 2020 6e6f 726d 616c 697a 653d 7365      normalize=se
-0000a560: 6c66 2e6e 6f72 6d61 6c69 7a65 2c20 6d69  lf.normalize, mi
-0000a570: 6e5f 7069 7865 6c3d 6d69 6e5f 7069 782c  n_pixel=min_pix,
-0000a580: 206d 6178 5f70 6978 656c 3d6d 6178 5f70   max_pixel=max_p
-0000a590: 6978 2c20 7661 6c5f 706f 7369 7469 7665  ix, val_positive
-0000a5a0: 3d76 616c 5f63 6c61 7373 5f31 2c20 7661  =val_class_1, va
-0000a5b0: 6c5f 6e65 6761 7469 7665 3d76 616c 5f63  l_negative=val_c
-0000a5c0: 6c61 7373 5f32 2c20 0a20 2020 2020 2020  lass_2, .       
-0000a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5e0: 2020 2020 2065 706f 6368 733d 7365 6c66       epochs=self
-0000a5f0: 2e74 7261 696e 5f65 706f 6368 732c 2062  .train_epochs, b
-0000a600: 6174 6368 5f73 697a 653d 6261 7463 685f  atch_size=batch_
-0000a610: 7369 7a65 2c20 6c72 3d6c 722c 206d 6f6d  size, lr=lr, mom
-0000a620: 656e 7475 6d3d 6d6f 6d65 6e74 756d 2c20  entum=momentum, 
-0000a630: 6465 6361 793d 6465 6361 792c 206e 6573  decay=decay, nes
-0000a640: 7465 726f 763d 6e65 7374 6572 6f76 2c20  terov=nesterov, 
-0000a650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a660: 2020 2020 2020 2020 2020 2020 206c 6f73               los
-0000a670: 733d 6c6f 7373 2c20 6163 7469 7661 7469  s=loss, activati
-0000a680: 6f6e 5f63 6f6e 763d 6163 7469 7661 7469  on_conv=activati
-0000a690: 6f6e 5f63 6f6e 762c 2061 6374 6976 6174  on_conv, activat
-0000a6a0: 696f 6e5f 6465 6e73 653d 6163 7469 7661  ion_dense=activa
-0000a6b0: 7469 6f6e 5f64 656e 7365 2c20 6d6f 6465  tion_dense, mode
-0000a6c0: 6c5f 7265 673d 6d6f 6465 6c5f 7265 672c  l_reg=model_reg,
-0000a6d0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0000a6e0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000a6f0: 6e76 5f69 6e69 743d 636f 6e76 5f69 6e69  nv_init=conv_ini
-0000a700: 742c 2064 656e 7365 5f69 6e69 743d 6465  t, dense_init=de
-0000a710: 6e73 655f 696e 6974 2c20 6f70 7469 6d69  nse_init, optimi
-0000a720: 7a65 723d 6f70 7469 6d69 7a65 722c 2065  zer=optimizer, e
-0000a730: 6172 6c79 5f73 746f 705f 6361 6c6c 6261  arly_stop_callba
-0000a740: 636b 3d63 616c 6c62 6163 6b73 2c20 6368  ck=callbacks, ch
-0000a750: 6563 6b70 6f69 6e74 3d46 616c 7365 2c20  eckpoint=False, 
-0000a760: 7665 7262 6f73 653d 7365 6c66 2e76 6572  verbose=self.ver
-0000a770: 626f 7365 2c20 0a20 2020 2020 2020 2020  bose, .         
-0000a780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a790: 2020 2070 6f6f 6c69 6e67 5f31 3d70 6f6f     pooling_1=poo
-0000a7a0: 6c69 6e67 5f31 2c20 706f 6f6c 696e 675f  ling_1, pooling_
-0000a7b0: 323d 706f 6f6c 696e 675f 322c 2070 6f6f  2=pooling_2, poo
-0000a7c0: 6c69 6e67 5f33 3d70 6f6f 6c69 6e67 5f33  ling_3=pooling_3
-0000a7d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000a7e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000a7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a800: 2020 2020 6d6f 6465 6c2c 2068 6973 746f      model, histo
-0000a810: 7279 203d 2063 6e6e 5f6d 6f64 656c 2e41  ry = cnn_model.A
-0000a820: 6c65 784e 6574 2863 6c61 7373 5f31 2c20  lexNet(class_1, 
-0000a830: 636c 6173 735f 322c 2069 6d67 5f6e 756d  class_2, img_num
-0000a840: 5f63 6861 6e6e 656c 733d 7365 6c66 2e69  _channels=self.i
-0000a850: 6d67 5f6e 756d 5f63 6861 6e6e 656c 732c  mg_num_channels,
-0000a860: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0000a870: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-0000a880: 726d 616c 697a 653d 7365 6c66 2e6e 6f72  rmalize=self.nor
-0000a890: 6d61 6c69 7a65 2c20 6d69 6e5f 7069 7865  malize, min_pixe
-0000a8a0: 6c3d 6d69 6e5f 7069 782c 206d 6178 5f70  l=min_pix, max_p
-0000a8b0: 6978 656c 3d6d 6178 5f70 6978 2c20 7661  ixel=max_pix, va
-0000a8c0: 6c5f 706f 7369 7469 7665 3d76 616c 5f63  l_positive=val_c
-0000a8d0: 6c61 7373 5f31 2c20 7661 6c5f 6e65 6761  lass_1, val_nega
-0000a8e0: 7469 7665 3d76 616c 5f63 6c61 7373 5f32  tive=val_class_2
-0000a8f0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-0000a900: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000a910: 706f 6368 733d 7365 6c66 2e74 7261 696e  pochs=self.train
-0000a920: 5f65 706f 6368 732c 2062 6174 6368 5f73  _epochs, batch_s
-0000a930: 697a 653d 6261 7463 685f 7369 7a65 2c20  ize=batch_size, 
-0000a940: 6c72 3d6c 722c 206d 6f6d 656e 7475 6d3d  lr=lr, momentum=
-0000a950: 6d6f 6d65 6e74 756d 2c20 6465 6361 793d  momentum, decay=
-0000a960: 6465 6361 792c 206e 6573 7465 726f 763d  decay, nesterov=
-0000a970: 6e65 7374 6572 6f76 2c20 0a20 2020 2020  nesterov, .     
-0000a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a990: 2020 2020 2020 206c 6f73 733d 6c6f 7373         loss=loss
-0000a9a0: 2c20 6163 7469 7661 7469 6f6e 5f63 6f6e  , activation_con
-0000a9b0: 763d 6163 7469 7661 7469 6f6e 5f63 6f6e  v=activation_con
-0000a9c0: 762c 2061 6374 6976 6174 696f 6e5f 6465  v, activation_de
-0000a9d0: 6e73 653d 6163 7469 7661 7469 6f6e 5f64  nse=activation_d
-0000a9e0: 656e 7365 2c20 6d6f 6465 6c5f 7265 673d  ense, model_reg=
-0000a9f0: 6d6f 6465 6c5f 7265 672c 200a 2020 2020  model_reg, .    
-0000aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa10: 2020 2020 2020 2020 636f 6e76 5f69 6e69          conv_ini
-0000aa20: 743d 636f 6e76 5f69 6e69 742c 2064 656e  t=conv_init, den
-0000aa30: 7365 5f69 6e69 743d 6465 6e73 655f 696e  se_init=dense_in
-0000aa40: 6974 2c20 6f70 7469 6d69 7a65 723d 6f70  it, optimizer=op
-0000aa50: 7469 6d69 7a65 722c 2070 6f6f 6c69 6e67  timizer, pooling
-0000aa60: 5f31 3d70 6f6f 6c69 6e67 5f31 2c20 706f  _1=pooling_1, po
-0000aa70: 6f6c 696e 675f 323d 706f 6f6c 696e 675f  oling_2=pooling_
-0000aa80: 322c 2070 6f6f 6c69 6e67 5f33 3d70 6f6f  2, pooling_3=poo
-0000aa90: 6c69 6e67 5f33 2c20 0a20 2020 2020 2020  ling_3, .       
-0000aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aab0: 2020 2020 2070 6f6f 6c5f 7374 7269 6465       pool_stride
-0000aac0: 5f31 3d70 6f6f 6c5f 7374 7269 6465 5f31  _1=pool_stride_1
-0000aad0: 2c20 706f 6f6c 5f73 697a 655f 323d 706f  , pool_size_2=po
-0000aae0: 6f6c 5f73 697a 655f 322c 2070 6f6f 6c5f  ol_size_2, pool_
-0000aaf0: 7374 7269 6465 5f32 3d70 6f6f 6c5f 7374  stride_2=pool_st
-0000ab00: 7269 6465 5f32 2c20 0a20 2020 2020 2020  ride_2, .       
-0000ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab20: 2020 2020 2070 6f6f 6c5f 7369 7a65 5f33       pool_size_3
-0000ab30: 3d70 6f6f 6c5f 7369 7a65 5f33 2c20 706f  =pool_size_3, po
-0000ab40: 6f6c 5f73 7472 6964 655f 333d 706f 6f6c  ol_stride_3=pool
-0000ab50: 5f73 7472 6964 655f 332c 2066 696c 7465  _stride_3, filte
-0000ab60: 725f 313d 6669 6c74 6572 5f31 2c20 6669  r_1=filter_1, fi
-0000ab70: 6c74 6572 5f73 697a 655f 313d 6669 6c74  lter_size_1=filt
-0000ab80: 6572 5f73 697a 655f 312c 200a 2020 2020  er_size_1, .    
-0000ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aba0: 2020 2020 2020 2020 7374 7269 6465 735f          strides_
-0000abb0: 313d 7374 7269 6465 735f 312c 2066 696c  1=strides_1, fil
-0000abc0: 7465 725f 323d 6669 6c74 6572 5f32 2c20  ter_2=filter_2, 
-0000abd0: 6669 6c74 6572 5f73 697a 655f 323d 6669  filter_size_2=fi
-0000abe0: 6c74 6572 5f73 697a 655f 322c 2073 7472  lter_size_2, str
-0000abf0: 6964 6573 5f32 3d73 7472 6964 6573 5f32  ides_2=strides_2
-0000ac00: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-0000ac10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000ac20: 696c 7465 725f 333d 6669 6c74 6572 5f33  ilter_3=filter_3
-0000ac30: 2c20 6669 6c74 6572 5f73 697a 655f 333d  , filter_size_3=
-0000ac40: 6669 6c74 6572 5f73 697a 655f 332c 2073  filter_size_3, s
-0000ac50: 7472 6964 6573 5f33 3d73 7472 6964 6573  trides_3=strides
-0000ac60: 5f33 2c20 6669 6c74 6572 5f34 3d66 696c  _3, filter_4=fil
-0000ac70: 7465 725f 342c 200a 2020 2020 2020 2020  ter_4, .        
+0000a1a0: 2020 2063 6f6e 765f 696e 6974 3d63 6f6e     conv_init=con
+0000a1b0: 765f 696e 6974 2c20 6465 6e73 655f 696e  v_init, dense_in
+0000a1c0: 6974 3d64 656e 7365 5f69 6e69 742c 206d  it=dense_init, m
+0000a1d0: 6f64 656c 5f72 6567 3d6d 6f64 656c 5f72  odel_reg=model_r
+0000a1e0: 6567 2c20 0a20 2020 2020 2020 2020 2020  eg, .           
+0000a1f0: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+0000a200: 313d 6669 6c74 6572 5f31 2c20 6669 6c74  1=filter_1, filt
+0000a210: 6572 5f73 697a 655f 313d 6669 6c74 6572  er_size_1=filter
+0000a220: 5f73 697a 655f 312c 2073 7472 6964 6573  _size_1, strides
+0000a230: 5f31 3d73 7472 6964 6573 5f31 2c20 706f  _1=strides_1, po
+0000a240: 6f6c 696e 675f 313d 706f 6f6c 696e 675f  oling_1=pooling_
+0000a250: 312c 2070 6f6f 6c5f 7369 7a65 5f31 3d70  1, pool_size_1=p
+0000a260: 6f6f 6c5f 7369 7a65 5f31 2c20 706f 6f6c  ool_size_1, pool
+0000a270: 5f73 7472 6964 655f 313d 706f 6f6c 5f73  _stride_1=pool_s
+0000a280: 7472 6964 655f 312c 200a 2020 2020 2020  tride_1, .      
+0000a290: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000a2a0: 6c74 6572 5f32 3d66 696c 7465 725f 322c  lter_2=filter_2,
+0000a2b0: 2066 696c 7465 725f 7369 7a65 5f32 3d66   filter_size_2=f
+0000a2c0: 696c 7465 725f 7369 7a65 5f32 2c20 7374  ilter_size_2, st
+0000a2d0: 7269 6465 735f 323d 7374 7269 6465 735f  rides_2=strides_
+0000a2e0: 322c 2070 6f6f 6c69 6e67 5f32 3d70 6f6f  2, pooling_2=poo
+0000a2f0: 6c69 6e67 5f32 2c20 706f 6f6c 5f73 697a  ling_2, pool_siz
+0000a300: 655f 323d 706f 6f6c 5f73 697a 655f 322c  e_2=pool_size_2,
+0000a310: 2070 6f6f 6c5f 7374 7269 6465 5f32 3d70   pool_stride_2=p
+0000a320: 6f6f 6c5f 7374 7269 6465 5f32 2c20 0a20  ool_stride_2, . 
+0000a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a340: 2020 2066 696c 7465 725f 333d 6669 6c74     filter_3=filt
+0000a350: 6572 5f33 2c20 6669 6c74 6572 5f73 697a  er_3, filter_siz
+0000a360: 655f 333d 6669 6c74 6572 5f73 697a 655f  e_3=filter_size_
+0000a370: 332c 2073 7472 6964 6573 5f33 3d73 7472  3, strides_3=str
+0000a380: 6964 6573 5f33 2c20 706f 6f6c 696e 675f  ides_3, pooling_
+0000a390: 333d 706f 6f6c 696e 675f 332c 2070 6f6f  3=pooling_3, poo
+0000a3a0: 6c5f 7369 7a65 5f33 3d70 6f6f 6c5f 7369  l_size_3=pool_si
+0000a3b0: 7a65 5f33 2c20 706f 6f6c 5f73 7472 6964  ze_3, pool_strid
+0000a3c0: 655f 333d 706f 6f6c 5f73 7472 6964 655f  e_3=pool_stride_
+0000a3d0: 332c 200a 2020 2020 2020 2020 2020 2020  3, .            
+0000a3e0: 2020 2020 2020 2020 6465 6e73 655f 6e65          dense_ne
+0000a3f0: 7572 6f6e 735f 313d 6465 6e73 655f 6e65  urons_1=dense_ne
+0000a400: 7572 6f6e 735f 312c 2064 656e 7365 5f6e  urons_1, dense_n
+0000a410: 6575 726f 6e73 5f32 3d64 656e 7365 5f6e  eurons_2=dense_n
+0000a420: 6575 726f 6e73 5f32 2c20 6465 6e73 655f  eurons_2, dense_
+0000a430: 6e65 7572 6f6e 735f 333d 6465 6e73 655f  neurons_3=dense_
+0000a440: 6e65 7572 6f6e 735f 332c 200a 2020 2020  neurons_3, .    
+0000a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a460: 6472 6f70 6f75 745f 313d 6472 6f70 6f75  dropout_1=dropou
+0000a470: 745f 312c 2064 726f 706f 7574 5f32 3d64  t_1, dropout_2=d
+0000a480: 726f 706f 7574 5f32 2c20 6472 6f70 6f75  ropout_2, dropou
+0000a490: 745f 333d 6472 6f70 6f75 745f 332c 2073  t_3=dropout_3, s
+0000a4a0: 6d6f 7465 5f73 616d 706c 696e 673d 7365  mote_sampling=se
+0000a4b0: 6c66 2e73 6d6f 7465 5f73 616d 706c 696e  lf.smote_samplin
+0000a4c0: 672c 2020 0a20 2020 2020 2020 2020 2020  g,  .           
+0000a4d0: 2020 2020 2020 2020 2065 6172 6c79 5f73           early_s
+0000a4e0: 746f 705f 6361 6c6c 6261 636b 3d63 616c  top_callback=cal
+0000a4f0: 6c62 6163 6b73 2c20 6368 6563 6b70 6f69  lbacks, checkpoi
+0000a500: 6e74 3d46 616c 7365 2c20 7665 7262 6f73  nt=False, verbos
+0000a510: 653d 7365 6c66 2e76 6572 626f 7365 290a  e=self.verbose).
+0000a520: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0000a530: 6620 7365 6c66 2e63 6c66 203d 3d20 2776  f self.clf == 'v
+0000a540: 6767 3136 273a 0a20 2020 2020 2020 2020  gg16':.         
+0000a550: 2020 2020 2020 2023 2323 2052 6567 756c         ### Regul
+0000a560: 6172 697a 6174 696f 6e20 5465 6368 6e69  arization Techni
+0000a570: 7175 6520 2842 4e20 6973 206e 6577 6572  que (BN is newer
+0000a580: 2c20 5647 4731 3620 7573 6564 204e 6f6e  , VGG16 used Non
+0000a590: 6529 2023 2323 0a20 2020 2020 2020 2020  e) ###.         
+0000a5a0: 2020 2020 2020 206d 6f64 656c 5f72 6567         model_reg
+0000a5b0: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+0000a5c0: 5f63 6174 6567 6f72 6963 616c 2827 6d6f  _categorical('mo
+0000a5d0: 6465 6c5f 7265 6727 2c20 5b4e 6f6e 652c  del_reg', [None,
+0000a5e0: 2027 6261 7463 685f 6e6f 726d 272c 2027   'batch_norm', '
+0000a5f0: 6c6f 6361 6c5f 7265 7370 6f6e 7365 275d  local_response']
+0000a600: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000a610: 2020 2023 2323 204f 6e6c 7920 7468 6520     ### Only the 
+0000a620: 706f 6f6c 696e 6720 7479 7065 7320 6172  pooling types ar
+0000a630: 6520 6f70 7469 6d69 7a65 6420 6966 206c  e optimized if l
+0000a640: 696d 6974 5f73 6561 7263 683d 5472 7565  imit_search=True
+0000a650: 2023 2323 0a20 2020 2020 2020 2020 2020   ###.           
+0000a660: 2020 2020 2070 6f6f 6c69 6e67 5f31 203d       pooling_1 =
+0000a670: 2074 7269 616c 2e73 7567 6765 7374 5f63   trial.suggest_c
+0000a680: 6174 6567 6f72 6963 616c 2827 706f 6f6c  ategorical('pool
+0000a690: 696e 675f 3127 2c20 5b27 6d69 6e27 2c20  ing_1', ['min', 
+0000a6a0: 276d 6178 272c 2027 6176 6572 6167 6527  'max', 'average'
+0000a6b0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0000a6c0: 2020 2070 6f6f 6c69 6e67 5f32 203d 2074     pooling_2 = t
+0000a6d0: 7269 616c 2e73 7567 6765 7374 5f63 6174  rial.suggest_cat
+0000a6e0: 6567 6f72 6963 616c 2827 706f 6f6c 696e  egorical('poolin
+0000a6f0: 675f 3227 2c20 5b27 6d69 6e27 2c20 276d  g_2', ['min', 'm
+0000a700: 6178 272c 2027 6176 6572 6167 6527 5d29  ax', 'average'])
+0000a710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a720: 2070 6f6f 6c69 6e67 5f33 203d 2074 7269   pooling_3 = tri
+0000a730: 616c 2e73 7567 6765 7374 5f63 6174 6567  al.suggest_categ
+0000a740: 6f72 6963 616c 2827 706f 6f6c 696e 675f  orical('pooling_
+0000a750: 3327 2c20 5b27 6d69 6e27 2c20 276d 6178  3', ['min', 'max
+0000a760: 272c 2027 6176 6572 6167 6527 5d29 0a20  ', 'average']). 
+0000a770: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000a780: 6f6f 6c69 6e67 5f34 203d 2074 7269 616c  ooling_4 = trial
+0000a790: 2e73 7567 6765 7374 5f63 6174 6567 6f72  .suggest_categor
+0000a7a0: 6963 616c 2827 706f 6f6c 696e 675f 3427  ical('pooling_4'
+0000a7b0: 2c20 5b27 6d69 6e27 2c20 276d 6178 272c  , ['min', 'max',
+0000a7c0: 2027 6176 6572 6167 6527 5d29 0a20 2020   'average']).   
+0000a7d0: 2020 2020 2020 2020 2020 2020 2070 6f6f               poo
+0000a7e0: 6c69 6e67 5f35 203d 2074 7269 616c 2e73  ling_5 = trial.s
+0000a7f0: 7567 6765 7374 5f63 6174 6567 6f72 6963  uggest_categoric
+0000a800: 616c 2827 706f 6f6c 696e 675f 3527 2c20  al('pooling_5', 
+0000a810: 5b27 6d69 6e27 2c20 276d 6178 272c 2027  ['min', 'max', '
+0000a820: 6176 6572 6167 6527 5d29 0a0a 2020 2020  average'])..    
+0000a830: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000a840: 656c 662e 6c69 6d69 745f 7365 6172 6368  elf.limit_search
+0000a850: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a860: 2020 2020 2020 6d6f 6465 6c2c 2068 6973        model, his
+0000a870: 746f 7279 203d 2063 6e6e 5f6d 6f64 656c  tory = cnn_model
+0000a880: 2e56 4747 3136 2863 6c61 7373 5f31 2c20  .VGG16(class_1, 
+0000a890: 636c 6173 735f 322c 2069 6d67 5f6e 756d  class_2, img_num
+0000a8a0: 5f63 6861 6e6e 656c 733d 7365 6c66 2e69  _channels=self.i
+0000a8b0: 6d67 5f6e 756d 5f63 6861 6e6e 656c 732c  mg_num_channels,
+0000a8c0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0000a8d0: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
+0000a8e0: 697a 653d 7365 6c66 2e6e 6f72 6d61 6c69  ize=self.normali
+0000a8f0: 7a65 2c20 6d69 6e5f 7069 7865 6c3d 6d69  ze, min_pixel=mi
+0000a900: 6e5f 7069 782c 206d 6178 5f70 6978 656c  n_pix, max_pixel
+0000a910: 3d6d 6178 5f70 6978 2c20 7661 6c5f 706f  =max_pix, val_po
+0000a920: 7369 7469 7665 3d76 616c 5f63 6c61 7373  sitive=val_class
+0000a930: 5f31 2c20 7661 6c5f 6e65 6761 7469 7665  _1, val_negative
+0000a940: 3d76 616c 5f63 6c61 7373 5f32 2c20 0a20  =val_class_2, . 
+0000a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a960: 2020 2020 2020 2065 706f 6368 733d 7365         epochs=se
+0000a970: 6c66 2e74 7261 696e 5f65 706f 6368 732c  lf.train_epochs,
+0000a980: 2062 6174 6368 5f73 697a 653d 6261 7463   batch_size=batc
+0000a990: 685f 7369 7a65 2c20 6f70 7469 6d69 7a65  h_size, optimize
+0000a9a0: 723d 6f70 7469 6d69 7a65 722c 206c 723d  r=optimizer, lr=
+0000a9b0: 6c72 2c20 6465 6361 793d 6465 6361 792c  lr, decay=decay,
+0000a9c0: 206d 6f6d 656e 7475 6d3d 6d6f 6d65 6e74   momentum=moment
+0000a9d0: 756d 2c20 6e65 7374 6572 6f76 3d6e 6573  um, nesterov=nes
+0000a9e0: 7465 726f 762c 200a 2020 2020 2020 2020  terov, .        
+0000a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa00: 6265 7461 5f31 3d62 6574 615f 312c 2062  beta_1=beta_1, b
+0000aa10: 6574 615f 323d 6265 7461 5f32 2c20 616d  eta_2=beta_2, am
+0000aa20: 7367 7261 643d 616d 7367 7261 642c 206c  sgrad=amsgrad, l
+0000aa30: 6f73 733d 6c6f 7373 2c20 6163 7469 7661  oss=loss, activa
+0000aa40: 7469 6f6e 5f63 6f6e 763d 6163 7469 7661  tion_conv=activa
+0000aa50: 7469 6f6e 5f63 6f6e 762c 2061 6374 6976  tion_conv, activ
+0000aa60: 6174 696f 6e5f 6465 6e73 653d 6163 7469  ation_dense=acti
+0000aa70: 7661 7469 6f6e 5f64 656e 7365 2c20 0a20  vation_dense, . 
+0000aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa90: 2020 2020 2020 2063 6f6e 765f 696e 6974         conv_init
+0000aaa0: 3d63 6f6e 765f 696e 6974 2c20 6465 6e73  =conv_init, dens
+0000aab0: 655f 696e 6974 3d64 656e 7365 5f69 6e69  e_init=dense_ini
+0000aac0: 742c 206d 6f64 656c 5f72 6567 3d6d 6f64  t, model_reg=mod
+0000aad0: 656c 5f72 6567 2c0a 2020 2020 2020 2020  el_reg,.        
+0000aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aaf0: 706f 6f6c 696e 675f 313d 706f 6f6c 696e  pooling_1=poolin
+0000ab00: 675f 312c 2070 6f6f 6c69 6e67 5f32 3d70  g_1, pooling_2=p
+0000ab10: 6f6f 6c69 6e67 5f32 2c20 706f 6f6c 696e  ooling_2, poolin
+0000ab20: 675f 333d 706f 6f6c 696e 675f 332c 2070  g_3=pooling_3, p
+0000ab30: 6f6f 6c69 6e67 5f34 3d70 6f6f 6c69 6e67  ooling_4=pooling
+0000ab40: 5f34 2c20 706f 6f6c 696e 675f 353d 706f  _4, pooling_5=po
+0000ab50: 6f6c 696e 675f 352c 0a20 2020 2020 2020  oling_5,.       
+0000ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab70: 2073 6d6f 7465 5f73 616d 706c 696e 673d   smote_sampling=
+0000ab80: 7365 6c66 2e73 6d6f 7465 5f73 616d 706c  self.smote_sampl
+0000ab90: 696e 672c 2065 6172 6c79 5f73 746f 705f  ing, early_stop_
+0000aba0: 6361 6c6c 6261 636b 3d63 616c 6c62 6163  callback=callbac
+0000abb0: 6b73 2c20 6368 6563 6b70 6f69 6e74 3d46  ks, checkpoint=F
+0000abc0: 616c 7365 2c20 7665 7262 6f73 653d 7365  alse, verbose=se
+0000abd0: 6c66 2e76 6572 626f 7365 290a 2020 2020  lf.verbose).    
+0000abe0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000abf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ac00: 2020 2020 2020 2323 2320 4669 6c74 6572        ### Filter
+0000ac10: 2061 6e64 204c 6179 6572 2043 6861 7261   and Layer Chara
+0000ac20: 6374 6572 7374 6963 7320 2323 230a 2020  cterstics ###.  
+0000ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac40: 2020 6669 6c74 6572 5f31 203d 2074 7269    filter_1 = tri
+0000ac50: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+0000ac60: 6669 6c74 6572 5f31 272c 2031 322c 2035  filter_1', 12, 5
+0000ac70: 3136 2c20 7374 6570 3d31 3229 0a20 2020  16, step=12).   
 0000ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac90: 2020 2020 6669 6c74 6572 5f73 697a 655f      filter_size_
-0000aca0: 343d 6669 6c74 6572 5f73 697a 655f 342c  4=filter_size_4,
-0000acb0: 2073 7472 6964 6573 5f34 3d73 7472 6964   strides_4=strid
-0000acc0: 6573 5f34 2c20 6669 6c74 6572 5f35 3d66  es_4, filter_5=f
-0000acd0: 696c 7465 725f 352c 2066 696c 7465 725f  ilter_5, filter_
-0000ace0: 7369 7a65 5f35 3d66 696c 7465 725f 7369  size_5=filter_si
-0000acf0: 7a65 5f35 2c20 0a20 2020 2020 2020 2020  ze_5, .         
-0000ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad10: 2020 2073 7472 6964 6573 5f35 3d73 7472     strides_5=str
-0000ad20: 6964 6573 5f35 2c20 6465 6e73 655f 6e65  ides_5, dense_ne
-0000ad30: 7572 6f6e 735f 313d 6465 6e73 655f 6e65  urons_1=dense_ne
-0000ad40: 7572 6f6e 735f 312c 2064 656e 7365 5f6e  urons_1, dense_n
-0000ad50: 6575 726f 6e73 5f32 3d64 656e 7365 5f6e  eurons_2=dense_n
-0000ad60: 6575 726f 6e73 5f32 2c20 0a20 2020 2020  eurons_2, .     
-0000ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad80: 2020 2020 2020 2064 726f 706f 7574 5f31         dropout_1
-0000ad90: 3d64 726f 706f 7574 5f31 2c20 6472 6f70  =dropout_1, drop
-0000ada0: 6f75 745f 323d 6472 6f70 6f75 745f 322c  out_2=dropout_2,
-0000adb0: 2065 6172 6c79 5f73 746f 705f 6361 6c6c   early_stop_call
-0000adc0: 6261 636b 3d63 616c 6c62 6163 6b73 2c20  back=callbacks, 
-0000add0: 6368 6563 6b70 6f69 6e74 3d46 616c 7365  checkpoint=False
-0000ade0: 2c20 7665 7262 6f73 653d 7365 6c66 2e76  , verbose=self.v
-0000adf0: 6572 626f 7365 290a 0a20 2020 2020 2020  erbose)..       
-0000ae00: 2020 2020 2020 2020 2023 4966 2074 6865           #If the
-0000ae10: 2074 7269 616c 2069 7320 7072 756e 6564   trial is pruned
-0000ae20: 206f 7220 7468 6520 7061 7469 656e 6365   or the patience
-0000ae30: 2069 7320 7265 6163 6865 642c 2072 6574   is reached, ret
-0000ae40: 7572 6e20 6e61 6e23 0a20 2020 2020 2020  urn nan#.       
-0000ae50: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0000ae60: 6869 7374 6f72 792e 6869 7374 6f72 795b  history.history[
-0000ae70: 276c 6f73 7327 5d29 2021 3d20 7365 6c66  'loss']) != self
-0000ae80: 2e74 7261 696e 5f65 706f 6368 733a 0a20  .train_epochs:. 
-0000ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aea0: 2020 2070 7269 6e74 2829 0a20 2020 2020     print().     
-0000aeb0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000aec0: 7269 6e74 2827 5468 6520 7472 6961 6c20  rint('The trial 
-0000aed0: 7761 7320 7072 756e 6564 206f 7220 7468  was pruned or th
-0000aee0: 6520 7472 6169 6e69 6e67 2070 6174 6965  e training patie
-0000aef0: 6e63 6520 7761 7320 7265 6163 6865 642e  nce was reached.
-0000af00: 2e2e 2729 232c 2072 6574 7572 6e69 6e67  ..')#, returning
-0000af10: 2030 2e30 3031 2074 696d 6573 2074 6865   0.001 times the
-0000af20: 206e 756d 6265 7220 6f66 2063 6f6d 706c   number of compl
-0000af30: 6574 6564 2065 706f 6368 732e 2e2e 2729  eted epochs...')
-0000af40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000af50: 2020 2020 2070 7269 6e74 2829 0a20 2020       print().   
+0000ac90: 2066 696c 7465 725f 7369 7a65 5f31 203d   filter_size_1 =
+0000aca0: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
+0000acb0: 6e74 2827 6669 6c74 6572 5f73 697a 655f  nt('filter_size_
+0000acc0: 3127 2c20 312c 2031 312c 2073 7465 703d  1', 1, 11, step=
+0000acd0: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
+0000ace0: 2020 2020 2020 2073 7472 6964 6573 5f31         strides_1
+0000acf0: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+0000ad00: 5f69 6e74 2827 7374 7269 6465 735f 3127  _int('strides_1'
+0000ad10: 2c20 312c 2033 2c20 7374 6570 3d31 290a  , 1, 3, step=1).
+0000ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad30: 2020 2020 706f 6f6c 5f73 697a 655f 3120      pool_size_1 
+0000ad40: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+0000ad50: 696e 7428 2770 6f6f 6c5f 7369 7a65 5f31  int('pool_size_1
+0000ad60: 272c 2031 2c20 372c 2073 7465 703d 3129  ', 1, 7, step=1)
+0000ad70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ad80: 2020 2020 2070 6f6f 6c5f 7374 7269 6465       pool_stride
+0000ad90: 5f31 203d 2074 7269 616c 2e73 7567 6765  _1 = trial.sugge
+0000ada0: 7374 5f69 6e74 2827 706f 6f6c 5f73 7472  st_int('pool_str
+0000adb0: 6964 655f 3127 2c20 312c 2033 2c20 7374  ide_1', 1, 3, st
+0000adc0: 6570 3d31 290a 0a20 2020 2020 2020 2020  ep=1)..         
+0000add0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+0000ade0: 725f 3220 3d20 7472 6961 6c2e 7375 6767  r_2 = trial.sugg
+0000adf0: 6573 745f 696e 7428 2766 696c 7465 725f  est_int('filter_
+0000ae00: 3227 2c20 3132 2c20 3531 362c 2073 7465  2', 12, 516, ste
+0000ae10: 703d 3132 290a 2020 2020 2020 2020 2020  p=12).          
+0000ae20: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+0000ae30: 5f73 697a 655f 3220 3d20 7472 6961 6c2e  _size_2 = trial.
+0000ae40: 7375 6767 6573 745f 696e 7428 2766 696c  suggest_int('fil
+0000ae50: 7465 725f 7369 7a65 5f32 272c 2031 2c20  ter_size_2', 1, 
+0000ae60: 372c 2073 7465 703d 3229 0a20 2020 2020  7, step=2).     
+0000ae70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000ae80: 7472 6964 6573 5f32 203d 2074 7269 616c  trides_2 = trial
+0000ae90: 2e73 7567 6765 7374 5f69 6e74 2827 7374  .suggest_int('st
+0000aea0: 7269 6465 735f 3227 2c20 312c 2033 2c20  rides_2', 1, 3, 
+0000aeb0: 7374 6570 3d31 290a 2020 2020 2020 2020  step=1).        
+0000aec0: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+0000aed0: 5f73 697a 655f 3220 3d20 7472 6961 6c2e  _size_2 = trial.
+0000aee0: 7375 6767 6573 745f 696e 7428 2770 6f6f  suggest_int('poo
+0000aef0: 6c5f 7369 7a65 5f32 272c 2031 2c20 372c  l_size_2', 1, 7,
+0000af00: 2073 7465 703d 3129 0a20 2020 2020 2020   step=1).       
+0000af10: 2020 2020 2020 2020 2020 2020 2070 6f6f               poo
+0000af20: 6c5f 7374 7269 6465 5f32 203d 2074 7269  l_stride_2 = tri
+0000af30: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+0000af40: 706f 6f6c 5f73 7472 6964 655f 3227 2c20  pool_stride_2', 
+0000af50: 312c 2033 2c20 7374 6570 3d31 290a 0a20  1, 3, step=1).. 
 0000af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af70: 2072 6574 7572 6e20 286c 656e 2868 6973   return (len(his
-0000af80: 746f 7279 2e68 6973 746f 7279 5b27 6c6f  tory.history['lo
-0000af90: 7373 275d 2920 2a20 302e 3030 3129 202d  ss']) * 0.001) -
-0000afa0: 2039 3939 2e30 0a0a 2020 2020 2020 2020   999.0..        
-0000afb0: 2020 2020 2020 2020 2349 6620 7468 6520          #If the 
-0000afc0: 7472 6169 6e69 6e67 2066 6169 6c73 2072  training fails r
-0000afd0: 6574 7572 6e20 4e61 4e20 7269 6768 7420  eturn NaN right 
-0000afe0: 6177 6179 230a 2020 2020 2020 2020 2020  away#.          
-0000aff0: 2020 2020 2020 6966 206e 702e 6973 6669        if np.isfi
-0000b000: 6e69 7465 2868 6973 746f 7279 2e68 6973  nite(history.his
-0000b010: 746f 7279 5b27 6c6f 7373 275d 5b2d 315d  tory['loss'][-1]
-0000b020: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000b030: 2020 2020 2020 2023 4966 2074 6865 2074         #If the t
-0000b040: 7261 696e 2061 6363 2074 6872 6573 686f  rain acc thresho
-0000b050: 6c64 2069 7320 7365 7423 0a20 2020 2020  ld is set#.     
-0000b060: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000b070: 6620 7365 6c66 2e74 7261 696e 5f61 6363  f self.train_acc
-0000b080: 5f74 6872 6573 686f 6c64 2069 7320 6e6f  _threshold is no
-0000b090: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0b0: 6966 2068 6973 746f 7279 2e68 6973 746f  if history.histo
-0000b0c0: 7279 5b27 6269 6e61 7279 5f61 6363 7572  ry['binary_accur
-0000b0d0: 6163 7927 5d5b 2d31 5d20 3e20 7365 6c66  acy'][-1] > self
-0000b0e0: 2e74 7261 696e 5f61 6363 5f74 6872 6573  .train_acc_thres
-0000b0f0: 686f 6c64 3a0a 2020 2020 2020 2020 2020  hold:.          
-0000b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b110: 2020 7072 696e 7428 290a 2020 2020 2020    print().      
-0000b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b130: 2020 2020 2020 7072 696e 7428 2754 6865        print('The
-0000b140: 2074 7269 616c 2077 6173 2070 7275 6e65   trial was prune
-0000b150: 6420 6f72 2074 6865 2074 7261 696e 696e  d or the trainin
-0000b160: 6720 7061 7469 656e 6365 2077 6173 2072  g patience was r
-0000b170: 6561 6368 6564 2e2e 2e27 2923 2c20 7265  eached...')#, re
-0000b180: 7475 726e 696e 6720 302e 3030 3120 7469  turning 0.001 ti
-0000b190: 6d65 7320 7468 6520 6e75 6d62 6572 206f  mes the number o
-0000b1a0: 6620 636f 6d70 6c65 7465 6420 6570 6f63  f completed epoc
-0000b1b0: 6873 2e2e 2e27 290a 2020 2020 2020 2020  hs...').        
-0000b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1d0: 2020 2020 7072 696e 7428 290a 2020 2020      print().    
-0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1f0: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-0000b200: 6c65 6e28 6869 7374 6f72 792e 6869 7374  len(history.hist
-0000b210: 6f72 795b 276c 6f73 7327 5d29 202a 2030  ory['loss']) * 0
-0000b220: 2e30 3031 2920 2d20 3939 392e 300a 2020  .001) - 999.0.  
-0000b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b240: 2020 6d6f 6465 6c73 2e61 7070 656e 6428    models.append(
-0000b250: 6d6f 6465 6c29 2c20 6869 7374 6f72 6965  model), historie
-0000b260: 732e 6170 7065 6e64 2868 6973 746f 7279  s.append(history
-0000b270: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b280: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000b290: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000b2a0: 7428 2754 7261 696e 696e 6720 6661 696c  t('Training fail
-0000b2b0: 6564 2064 7565 2074 6f20 6e75 6d65 7269  ed due to numeri
-0000b2c0: 6361 6c20 696e 7374 6162 696c 6974 792c  cal instability,
-0000b2d0: 2072 6574 7572 6e69 6e67 206e 616e 2e2e   returning nan..
-0000b2e0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
-0000b2f0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-0000b300: 702e 6e61 6e20 0a0a 2020 2020 2020 2020  p.nan ..        
-0000b310: 2323 2323 2323 2041 6464 6974 696f 6e61  ###### Additiona
-0000b320: 6c20 7465 7374 2064 6174 6120 6d65 7472  l test data metr
-0000b330: 6963 2023 2323 2323 230a 2020 2020 2020  ic ######.      
-0000b340: 2020 6966 2073 656c 662e 7465 7374 5f70    if self.test_p
-0000b350: 6f73 6974 6976 6520 6973 206e 6f74 204e  ositive is not N
-0000b360: 6f6e 6520 6f72 2073 656c 662e 7465 7374  one or self.test
-0000b370: 5f6e 6567 6174 6976 6520 6973 206e 6f74  _negative is not
-0000b380: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000b390: 2020 2069 6620 7365 6c66 2e74 6573 745f     if self.test_
-0000b3a0: 706f 7369 7469 7665 2069 7320 6e6f 7420  positive is not 
-0000b3b0: 4e6f 6e65 2061 6e64 2073 656c 662e 7465  None and self.te
-0000b3c0: 7374 5f6e 6567 6174 6976 6520 6973 206e  st_negative is n
-0000b3d0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000b3e0: 2020 2020 2020 2020 2070 6f73 6974 6976           positiv
-0000b3f0: 655f 7465 7374 5f63 726f 702c 206e 6567  e_test_crop, neg
-0000b400: 6174 6976 655f 7465 7374 5f63 726f 7020  ative_test_crop 
-0000b410: 3d20 7265 7369 7a65 2873 656c 662e 7465  = resize(self.te
-0000b420: 7374 5f70 6f73 6974 6976 652c 2073 697a  st_positive, siz
-0000b430: 653d 696d 6167 655f 7369 7a65 292c 2072  e=image_size), r
-0000b440: 6573 697a 6528 7365 6c66 2e74 6573 745f  esize(self.test_
-0000b450: 6e65 6761 7469 7665 2c20 7369 7a65 3d69  negative, size=i
-0000b460: 6d61 6765 5f73 697a 6529 0a20 2020 2020  mage_size).     
-0000b470: 2020 2020 2020 2020 2020 2058 5f74 6573             X_tes
-0000b480: 742c 2059 5f74 6573 7420 3d20 6372 6561  t, Y_test = crea
-0000b490: 7465 5f74 7261 696e 696e 675f 7365 7428  te_training_set(
-0000b4a0: 706f 7369 7469 7665 5f74 6573 745f 6372  positive_test_cr
-0000b4b0: 6f70 2c20 6e65 6761 7469 7665 5f74 6573  op, negative_tes
-0000b4c0: 745f 6372 6f70 2c20 6e6f 726d 616c 697a  t_crop, normaliz
-0000b4d0: 653d 7365 6c66 2e6e 6f72 6d61 6c69 7a65  e=self.normalize
-0000b4e0: 2c20 6d69 6e5f 7069 7865 6c3d 6d69 6e5f  , min_pixel=min_
-0000b4f0: 7069 782c 206d 6178 5f70 6978 656c 3d6d  pix, max_pixel=m
-0000b500: 6178 5f70 6978 2c20 696d 675f 6e75 6d5f  ax_pix, img_num_
-0000b510: 6368 616e 6e65 6c73 3d73 656c 662e 696d  channels=self.im
-0000b520: 675f 6e75 6d5f 6368 616e 6e65 6c73 290a  g_num_channels).
-0000b530: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0000b540: 2073 656c 662e 7465 7374 5f70 6f73 6974   self.test_posit
-0000b550: 6976 6520 6973 206e 6f74 204e 6f6e 653a  ive is not None:
-0000b560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b570: 2070 6f73 6974 6976 655f 7465 7374 5f63   positive_test_c
-0000b580: 726f 7020 3d20 7265 7369 7a65 2873 656c  rop = resize(sel
-0000b590: 662e 7465 7374 5f70 6f73 6974 6976 652c  f.test_positive,
-0000b5a0: 2073 697a 653d 696d 6167 655f 7369 7a65   size=image_size
-0000b5b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b5c0: 2020 706f 7369 7469 7665 5f63 6c61 7373    positive_class
-0000b5d0: 5f64 6174 612c 2070 6f73 6974 6976 655f  _data, positive_
-0000b5e0: 636c 6173 735f 6c61 6265 6c20 3d20 6461  class_label = da
-0000b5f0: 7461 5f70 726f 6365 7373 696e 672e 7072  ta_processing.pr
-0000b600: 6f63 6573 735f 636c 6173 7328 706f 7369  ocess_class(posi
-0000b610: 7469 7665 5f74 6573 745f 6372 6f70 2c20  tive_test_crop, 
-0000b620: 6c61 6265 6c3d 312c 206e 6f72 6d61 6c69  label=1, normali
-0000b630: 7a65 3d73 656c 662e 6e6f 726d 616c 697a  ze=self.normaliz
-0000b640: 652c 206d 696e 5f70 6978 656c 3d6d 696e  e, min_pixel=min
-0000b650: 5f70 6978 2c20 6d61 785f 7069 7865 6c3d  _pix, max_pixel=
-0000b660: 6d61 785f 7069 782c 2069 6d67 5f6e 756d  max_pix, img_num
-0000b670: 5f63 6861 6e6e 656c 733d 7365 6c66 2e69  _channels=self.i
-0000b680: 6d67 5f6e 756d 5f63 6861 6e6e 656c 7329  mg_num_channels)
-0000b690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b6a0: 2069 6620 7365 6c66 2e74 6573 745f 6e65   if self.test_ne
-0000b6b0: 6761 7469 7665 2069 7320 6e6f 7420 4e6f  gative is not No
-0000b6c0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000b6d0: 2020 2020 2020 2020 6e65 6761 7469 7665          negative
-0000b6e0: 5f74 6573 745f 6372 6f70 203d 2072 6573  _test_crop = res
-0000b6f0: 697a 6528 7365 6c66 2e74 6573 745f 6e65  ize(self.test_ne
-0000b700: 6761 7469 7665 2c20 7369 7a65 3d69 6d61  gative, size=ima
-0000b710: 6765 5f73 697a 6529 0a20 2020 2020 2020  ge_size).       
-0000b720: 2020 2020 2020 2020 2020 2020 206e 6567               neg
-0000b730: 6174 6976 655f 636c 6173 735f 6461 7461  ative_class_data
-0000b740: 2c20 6e65 6761 7469 7665 5f63 6c61 7373  , negative_class
-0000b750: 5f6c 6162 656c 203d 2064 6174 615f 7072  _label = data_pr
-0000b760: 6f63 6573 7369 6e67 2e70 726f 6365 7373  ocessing.process
-0000b770: 5f63 6c61 7373 286e 6567 6174 6976 655f  _class(negative_
-0000b780: 7465 7374 5f63 726f 702c 206c 6162 656c  test_crop, label
-0000b790: 3d30 2c20 6e6f 726d 616c 697a 653d 7365  =0, normalize=se
-0000b7a0: 6c66 2e6e 6f72 6d61 6c69 7a65 2c20 6d69  lf.normalize, mi
-0000b7b0: 6e5f 7069 7865 6c3d 6d69 6e5f 7069 782c  n_pixel=min_pix,
-0000b7c0: 206d 6178 5f70 6978 656c 3d6d 6178 5f70   max_pixel=max_p
-0000b7d0: 6978 2c20 696d 675f 6e75 6d5f 6368 616e  ix, img_num_chan
-0000b7e0: 6e65 6c73 3d73 656c 662e 696d 675f 6e75  nels=self.img_nu
-0000b7f0: 6d5f 6368 616e 6e65 6c73 290a 2020 2020  m_channels).    
-0000b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b810: 585f 7465 7374 2c20 595f 7465 7374 203d  X_test, Y_test =
-0000b820: 206e 702e 725f 5b70 6f73 6974 6976 655f   np.r_[positive_
-0000b830: 636c 6173 735f 6461 7461 2c20 6e65 6761  class_data, nega
-0000b840: 7469 7665 5f63 6c61 7373 5f64 6174 615d  tive_class_data]
-0000b850: 2c20 6e70 2e72 5f5b 706f 7369 7469 7665  , np.r_[positive
-0000b860: 5f63 6c61 7373 5f6c 6162 656c 2c20 6e65  _class_label, ne
-0000b870: 6761 7469 7665 5f63 6c61 7373 5f6c 6162  gative_class_lab
-0000b880: 656c 5d0a 2020 2020 2020 2020 2020 2020  el].            
-0000b890: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000b8a0: 2020 2020 2020 2020 2020 2020 2020 585f                X_
-0000b8b0: 7465 7374 2c20 595f 7465 7374 203d 2070  test, Y_test = p
-0000b8c0: 6f73 6974 6976 655f 636c 6173 735f 6461  ositive_class_da
-0000b8d0: 7461 2c20 706f 7369 7469 7665 5f63 6c61  ta, positive_cla
-0000b8e0: 7373 5f6c 6162 656c 0a20 2020 2020 2020  ss_label.       
-0000b8f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000b900: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0000b910: 6c66 2e74 6573 745f 6e65 6761 7469 7665  lf.test_negative
-0000b920: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0000b930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b940: 2020 585f 7465 7374 2c20 595f 7465 7374    X_test, Y_test
-0000b950: 203d 2064 6174 615f 7072 6f63 6573 7369   = data_processi
-0000b960: 6e67 2e70 726f 6365 7373 5f63 6c61 7373  ng.process_class
-0000b970: 286e 6567 6174 6976 655f 7465 7374 5f63  (negative_test_c
-0000b980: 726f 702c 206c 6162 656c 3d30 2c20 6e6f  rop, label=0, no
-0000b990: 726d 616c 697a 653d 7365 6c66 2e6e 6f72  rmalize=self.nor
-0000b9a0: 6d61 6c69 7a65 2c20 6d69 6e5f 7069 7865  malize, min_pixe
-0000b9b0: 6c3d 6d69 6e5f 7069 782c 206d 6178 5f70  l=min_pix, max_p
-0000b9c0: 6978 656c 3d6d 6178 5f70 6978 2c20 696d  ixel=max_pix, im
-0000b9d0: 675f 6e75 6d5f 6368 616e 6e65 6c73 3d73  g_num_channels=s
-0000b9e0: 656c 662e 696d 675f 6e75 6d5f 6368 616e  elf.img_num_chan
-0000b9f0: 6e65 6c73 290a 2020 2020 2020 2020 2020  nels).          
-0000ba00: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0000ba10: 2323 234c 6f6f 7020 7468 726f 7567 6820  ###Loop through 
-0000ba20: 616c 6c20 7468 6520 6d6f 6465 6c73 2323  all the models##
-0000ba30: 230a 2020 2020 2020 2020 2020 2020 7465  #.            te
-0000ba40: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-0000ba50: 2020 2020 666f 7220 5f6d 6f64 656c 5f20      for _model_ 
-0000ba60: 696e 206d 6f64 656c 733a 0a20 2020 2020  in models:.     
-0000ba70: 2020 2020 2020 2020 2020 2074 6573 745f             test_
-0000ba80: 6c6f 7373 2c20 7465 7374 5f61 6363 2c20  loss, test_acc, 
-0000ba90: 7465 7374 5f66 315f 7363 6f72 6520 3d20  test_f1_score = 
-0000baa0: 5f6d 6f64 656c 5f2e 6576 616c 7561 7465  _model_.evaluate
-0000bab0: 2858 5f74 6573 742c 2059 5f74 6573 742c  (X_test, Y_test,
-0000bac0: 2062 6174 6368 5f73 697a 653d 6c65 6e28   batch_size=len(
-0000bad0: 585f 7465 7374 2929 0a20 2020 2020 2020  X_test)).       
-0000bae0: 2020 2020 2020 2020 2069 6620 276c 6f73           if 'los
-0000baf0: 7327 2069 6e20 7365 6c66 2e6d 6574 7269  s' in self.metri
-0000bb00: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
-0000bb10: 2020 2020 2020 2074 6573 745f 6d65 7472         test_metr
-0000bb20: 6963 203d 2031 202d 2074 6573 745f 6c6f  ic = 1 - test_lo
-0000bb30: 7373 0a20 2020 2020 2020 2020 2020 2020  ss.             
-0000bb40: 2020 2065 6c69 6620 2761 6363 2720 696e     elif 'acc' in
-0000bb50: 2073 656c 662e 6d65 7472 6963 3a0a 2020   self.metric:.  
-0000bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb70: 2020 7465 7374 5f6d 6574 7269 6320 3d20    test_metric = 
-0000bb80: 7465 7374 5f61 6363 200a 2020 2020 2020  test_acc .      
-0000bb90: 2020 2020 2020 2020 2020 656c 6966 2027            elif '
-0000bba0: 6631 2720 696e 2073 656c 662e 6d65 7472  f1' in self.metr
-0000bbb0: 6963 3a0a 2020 2020 2020 2020 2020 2020  ic:.            
-0000bbc0: 2020 2020 2020 2020 7465 7374 5f6d 6574          test_met
-0000bbd0: 7269 6320 3d20 7465 7374 5f66 315f 7363  ric = test_f1_sc
-0000bbe0: 6f72 650a 2020 2020 2020 2020 2020 2020  ore.            
-0000bbf0: 2020 2020 656c 6966 2027 616c 6c27 2069      elif 'all' i
-0000bc00: 6e20 7365 6c66 2e6d 6574 7269 633a 0a20  n self.metric:. 
-0000bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc20: 2020 2074 6573 745f 6d65 7472 6963 203d     test_metric =
-0000bc30: 206e 702e 6d65 616e 285b 3120 2d20 7465   np.mean([1 - te
-0000bc40: 7374 5f6c 6f73 732c 2074 6573 745f 6163  st_loss, test_ac
-0000bc50: 632c 2074 6573 745f 6631 5f73 636f 7265  c, test_f1_score
-0000bc60: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0000bc70: 2020 2074 6573 742e 6170 7065 6e64 2874     test.append(t
-0000bc80: 6573 745f 6d65 7472 6963 290a 0a20 2020  est_metric)..   
-0000bc90: 2020 2020 2020 2020 2074 6573 745f 6d65           test_me
-0000bca0: 7472 6963 203d 206e 702e 6d65 616e 2874  tric = np.mean(t
-0000bcb0: 6573 7429 0a20 2020 2020 2020 2020 2020  est).           
-0000bcc0: 2069 6620 7365 6c66 2e76 6572 626f 7365   if self.verbose
-0000bcd0: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-0000bce0: 2020 2020 2020 2070 7269 6e74 2827 506f         print('Po
-0000bcf0: 7374 2d54 7269 616c 204d 6574 7269 633a  st-Trial Metric:
-0000bd00: 2027 2b73 7472 2874 6573 745f 6d65 7472   '+str(test_metr
-0000bd10: 6963 2929 0a20 2020 2020 2020 2065 6c73  ic)).        els
-0000bd20: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
-0000bd30: 6573 745f 6d65 7472 6963 203d 204e 6f6e  est_metric = Non
-0000bd40: 650a 0a20 2020 2020 2020 2023 2323 2043  e..        ### C
-0000bd50: 616c 6375 6c61 7465 2074 6865 2066 696e  alculate the fin
-0000bd60: 616c 206f 7074 696d 697a 6174 696f 6e20  al optimization 
-0000bd70: 6d65 7472 6963 2023 2323 0a20 2020 2020  metric ###.     
-0000bd80: 2020 206d 6574 7269 6373 203d 205b 276c     metrics = ['l
-0000bd90: 6f73 7327 2c20 2762 696e 6172 795f 6163  oss', 'binary_ac
-0000bda0: 6375 7261 6379 272c 2027 6631 5f73 636f  curacy', 'f1_sco
-0000bdb0: 7265 275d 0a20 2020 2020 2020 2069 6620  re'].        if 
-0000bdc0: 7365 6c66 2e6d 6574 7269 6320 3d3d 2027  self.metric == '
-0000bdd0: 616c 6c27 3a20 2341 7665 7261 6765 2061  all': #Average a
-0000bde0: 6c6c 2074 6865 2074 7261 696e 696e 6720  ll the training 
-0000bdf0: 6d65 7472 6963 730a 2020 2020 2020 2020  metrics.        
-0000be00: 2020 2020 7472 6169 6e69 6e67 5f6d 6574      training_met
-0000be10: 7269 6373 5f6d 6561 6e2c 2074 7261 696e  rics_mean, train
-0000be20: 696e 675f 6c6f 7373 5f6d 6561 6e20 3d20  ing_loss_mean = 
-0000be30: 5b5d 2c20 5b5d 0a20 2020 2020 2020 2020  [], [].         
-0000be40: 2020 2069 6620 7365 6c66 2e61 7665 7261     if self.avera
-0000be50: 6765 3a0a 2020 2020 2020 2020 2020 2020  ge:.            
-0000be60: 2020 2020 666f 7220 5f68 6973 746f 7279      for _history
-0000be70: 5f20 696e 2068 6973 746f 7269 6573 3a0a  _ in histories:.
-0000be80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be90: 2020 2020 7472 6169 6e69 6e67 5f6d 6574      training_met
-0000bea0: 7269 6373 5f6d 6561 6e2e 6170 7065 6e64  rics_mean.append
-0000beb0: 286e 702e 6d65 616e 285b 6e70 2e6d 6561  (np.mean([np.mea
-0000bec0: 6e28 5f68 6973 746f 7279 5f2e 6869 7374  n(_history_.hist
-0000bed0: 6f72 795b 6d65 7472 6963 5d29 2066 6f72  ory[metric]) for
-0000bee0: 206d 6574 7269 6320 696e 206d 6574 7269   metric in metri
-0000bef0: 6373 2069 6620 276c 6f73 7327 206e 6f74  cs if 'loss' not
-0000bf00: 2069 6e20 6d65 7472 6963 5d29 290a 2020   in metric])).  
-0000bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf20: 2020 7472 6169 6e69 6e67 5f6c 6f73 735f    training_loss_
-0000bf30: 6d65 616e 2e61 7070 656e 6428 3120 2d20  mean.append(1 - 
-0000bf40: 6e70 2e6d 6561 6e28 5f68 6973 746f 7279  np.mean(_history
-0000bf50: 5f2e 6869 7374 6f72 795b 276c 6f73 7327  _.history['loss'
-0000bf60: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-0000bf70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000bf80: 2020 2020 2020 666f 7220 5f68 6973 746f        for _histo
-0000bf90: 7279 5f20 696e 2068 6973 746f 7269 6573  ry_ in histories
-0000bfa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000bfb0: 2020 2020 2020 7472 6169 6e69 6e67 5f6d        training_m
-0000bfc0: 6574 7269 6373 5f6d 6561 6e2e 6170 7065  etrics_mean.appe
-0000bfd0: 6e64 286e 702e 6d65 616e 285b 5f68 6973  nd(np.mean([_his
-0000bfe0: 746f 7279 5f2e 6869 7374 6f72 795b 6d65  tory_.history[me
-0000bff0: 7472 6963 5d5b 2d31 5d20 666f 7220 6d65  tric][-1] for me
-0000c000: 7472 6963 2069 6e20 6d65 7472 6963 7320  tric in metrics 
-0000c010: 6966 2027 6c6f 7373 2720 6e6f 7420 696e  if 'loss' not in
-0000c020: 206d 6574 7269 635d 2929 0a20 2020 2020   metric])).     
-0000c030: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000c040: 7261 696e 696e 675f 6c6f 7373 5f6d 6561  raining_loss_mea
-0000c050: 6e2e 6170 7065 6e64 2831 202d 205f 6869  n.append(1 - _hi
-0000c060: 7374 6f72 795f 2e68 6973 746f 7279 5b27  story_.history['
-0000c070: 6c6f 7373 275d 5b2d 315d 290a 2020 2020  loss'][-1]).    
-0000c080: 2020 2020 2020 2020 6966 2074 6573 745f          if test_
-0000c090: 6d65 7472 6963 2069 7320 4e6f 6e65 3a0a  metric is None:.
-0000c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c0b0: 6669 6e61 6c5f 7363 6f72 6520 3d20 6e70  final_score = np
-0000c0c0: 2e6d 6561 6e28 5b74 7261 696e 696e 675f  .mean([training_
-0000c0d0: 6d65 7472 6963 735f 6d65 616e 2c20 7472  metrics_mean, tr
-0000c0e0: 6169 6e69 6e67 5f6c 6f73 735f 6d65 616e  aining_loss_mean
-0000c0f0: 5d29 0a20 2020 2020 2020 2020 2020 2065  ]).            e
-0000c100: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000c110: 2020 2020 2066 696e 616c 5f73 636f 7265       final_score
-0000c120: 203d 206e 702e 6d65 616e 285b 7472 6169   = np.mean([trai
-0000c130: 6e69 6e67 5f6d 6574 7269 6373 5f6d 6561  ning_metrics_mea
-0000c140: 6e2c 2074 7261 696e 696e 675f 6c6f 7373  n, training_loss
-0000c150: 5f6d 6561 6e2c 2074 6573 745f 6d65 7472  _mean, test_metr
-0000c160: 6963 5d29 0a20 2020 2020 2020 2065 6c69  ic]).        eli
-0000c170: 6620 7365 6c66 2e6d 6574 7269 6320 3d3d  f self.metric ==
-0000c180: 2027 7661 6c5f 616c 6c27 3a20 2341 7665   'val_all': #Ave
-0000c190: 7261 6765 2061 6c6c 2074 6865 2076 616c  rage all the val
-0000c1a0: 6964 6174 696f 6e20 6d65 7472 6963 730a  idation metrics.
-0000c1b0: 2020 2020 2020 2020 2020 2020 7661 6c5f              val_
-0000c1c0: 6d65 7472 6963 735f 6d65 616e 2c20 7661  metrics_mean, va
-0000c1d0: 6c5f 6c6f 7373 5f6d 6561 6e20 3d20 5b5d  l_loss_mean = []
-0000c1e0: 2c20 5b5d 200a 2020 2020 2020 2020 2020  , [] .          
-0000c1f0: 2020 6966 2073 656c 662e 6176 6572 6167    if self.averag
-0000c200: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000c210: 2020 2066 6f72 205f 6869 7374 6f72 795f     for _history_
-0000c220: 2069 6e20 6869 7374 6f72 6965 733a 0a20   in histories:. 
-0000c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c240: 2020 2076 616c 5f6d 6574 7269 6373 5f6d     val_metrics_m
-0000c250: 6561 6e2e 6170 7065 6e64 286e 702e 6d65  ean.append(np.me
-0000c260: 616e 285b 6e70 2e6d 6561 6e28 5f68 6973  an([np.mean(_his
-0000c270: 746f 7279 5f2e 6869 7374 6f72 795b 2776  tory_.history['v
-0000c280: 616c 5f27 2b6d 6574 7269 635d 2920 666f  al_'+metric]) fo
-0000c290: 7220 6d65 7472 6963 2069 6e20 6d65 7472  r metric in metr
-0000c2a0: 6963 7320 6966 2027 6c6f 7373 2720 6e6f  ics if 'loss' no
-0000c2b0: 7420 696e 206d 6574 7269 635d 2929 0a20  t in metric])). 
-0000c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2d0: 2020 2076 616c 5f6c 6f73 735f 6d65 616e     val_loss_mean
-0000c2e0: 2e61 7070 656e 6428 3120 2d20 6e70 2e6d  .append(1 - np.m
-0000c2f0: 6561 6e28 5f68 6973 746f 7279 5f2e 6869  ean(_history_.hi
-0000c300: 7374 6f72 795b 2776 616c 5f6c 6f73 7327  story['val_loss'
-0000c310: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-0000c320: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000c330: 2020 2020 2020 666f 7220 5f68 6973 746f        for _histo
-0000c340: 7279 5f20 696e 2068 6973 746f 7269 6573  ry_ in histories
-0000c350: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c360: 2020 2020 2020 7661 6c5f 6d65 7472 6963        val_metric
-0000c370: 735f 6d65 616e 2e61 7070 656e 6428 6e70  s_mean.append(np
-0000c380: 2e6d 6561 6e28 5b5f 6869 7374 6f72 795f  .mean([_history_
-0000c390: 2e68 6973 746f 7279 5b27 7661 6c5f 272b  .history['val_'+
-0000c3a0: 6d65 7472 6963 5d5b 2d31 5d20 666f 7220  metric][-1] for 
-0000c3b0: 6d65 7472 6963 2069 6e20 6d65 7472 6963  metric in metric
-0000c3c0: 7320 6966 2027 6c6f 7373 2720 6e6f 7420  s if 'loss' not 
-0000c3d0: 696e 206d 6574 7269 635d 2929 0a20 2020  in metric])).   
-0000c3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3f0: 2076 616c 5f6c 6f73 735f 6d65 616e 2e61   val_loss_mean.a
-0000c400: 7070 656e 6428 3120 2d20 5f68 6973 746f  ppend(1 - _histo
-0000c410: 7279 5f2e 6869 7374 6f72 795b 2776 616c  ry_.history['val
-0000c420: 5f6c 6f73 7327 5d5b 2d31 5d29 0a20 2020  _loss'][-1]).   
-0000c430: 2020 2020 2020 2020 2069 6620 7465 7374           if test
-0000c440: 5f6d 6574 7269 6320 6973 204e 6f6e 653a  _metric is None:
-0000c450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c460: 2066 696e 616c 5f73 636f 7265 203d 206e   final_score = n
-0000c470: 702e 6d65 616e 285b 7661 6c5f 6d65 7472  p.mean([val_metr
-0000c480: 6963 735f 6d65 616e 2c20 7661 6c5f 6c6f  ics_mean, val_lo
-0000c490: 7373 5f6d 6561 6e5d 290a 2020 2020 2020  ss_mean]).      
-0000c4a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000c4b0: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
-0000c4c0: 6c5f 7363 6f72 6520 3d20 6e70 2e6d 6561  l_score = np.mea
-0000c4d0: 6e28 5b76 616c 5f6d 6574 7269 6373 5f6d  n([val_metrics_m
-0000c4e0: 6561 6e2c 2076 616c 5f6c 6f73 735f 6d65  ean, val_loss_me
-0000c4f0: 616e 2c20 7465 7374 5f6d 6574 7269 635d  an, test_metric]
-0000c500: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0000c510: 2020 2020 2020 2020 2020 2020 7363 6f72              scor
-0000c520: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
-0000c530: 2020 2020 6966 2073 656c 662e 6176 6572      if self.aver
-0000c540: 6167 653a 0a20 2020 2020 2020 2020 2020  age:.           
-0000c550: 2020 2020 2066 6f72 205f 6869 7374 6f72       for _histor
-0000c560: 795f 2069 6e20 6869 7374 6f72 6965 733a  y_ in histories:
-0000c570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c580: 2020 2020 2073 636f 7265 732e 6170 7065       scores.appe
-0000c590: 6e64 286e 702e 6d65 616e 285f 6869 7374  nd(np.mean(_hist
-0000c5a0: 6f72 795f 2e68 6973 746f 7279 5b73 656c  ory_.history[sel
-0000c5b0: 662e 6d65 7472 6963 5d29 290a 2020 2020  f.metric])).    
-0000c5c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000c5d0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000c5e0: 7220 5f68 6973 746f 7279 5f20 696e 2068  r _history_ in h
-0000c5f0: 6973 746f 7269 6573 3a0a 2020 2020 2020  istories:.      
-0000c600: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-0000c610: 6f72 6573 2e61 7070 656e 6428 5f68 6973  ores.append(_his
-0000c620: 746f 7279 5f2e 6869 7374 6f72 795b 7365  tory_.history[se
-0000c630: 6c66 2e6d 6574 7269 635d 5b2d 315d 290a  lf.metric][-1]).
-0000c640: 0a20 2020 2020 2020 2020 2020 2066 696e  .            fin
-0000c650: 616c 5f73 636f 7265 203d 206e 702e 6d65  al_score = np.me
-0000c660: 616e 2873 636f 7265 7329 0a0a 2020 2020  an(scores)..    
-0000c670: 2020 2020 2020 2020 6966 2027 6c6f 7373          if 'loss
-0000c680: 2720 696e 2073 656c 662e 6d65 7472 6963  ' in self.metric
-0000c690: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-0000c6a0: 2020 2066 696e 616c 5f73 636f 7265 203d     final_score =
-0000c6b0: 2031 202d 2066 696e 616c 5f73 636f 7265   1 - final_score
-0000c6c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c6d0: 7465 7374 5f6d 6574 7269 6320 6973 206e  test_metric is n
-0000c6e0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000c6f0: 2020 2020 2020 2020 2066 696e 616c 5f73           final_s
-0000c700: 636f 7265 203d 2028 6669 6e61 6c5f 7363  core = (final_sc
-0000c710: 6f72 6520 2b20 7465 7374 5f6d 6574 7269  ore + test_metri
-0000c720: 6329 202f 2032 2e30 0a20 2020 2020 2020  c) / 2.0.       
-0000c730: 200a 2020 2020 2020 2020 7265 7475 726e   .        return
-0000c740: 2066 696e 616c 5f73 636f 7265 0a0a 636c   final_score..cl
-0000c750: 6173 7320 6f62 6a65 6374 6976 655f 7867  ass objective_xg
-0000c760: 6228 6f62 6a65 6374 293a 0a20 2020 2022  b(object):.    "
-0000c770: 2222 0a20 2020 204f 7074 696d 697a 6174  "".    Optimizat
-0000c780: 696f 6e20 6f62 6a65 6374 6976 6520 6675  ion objective fu
-0000c790: 6e63 7469 6f6e 2066 6f72 2074 6865 2074  nction for the t
-0000c7a0: 7265 652d 6261 7365 6420 5847 426f 6f73  ree-based XGBoos
-0000c7b0: 7420 636c 6173 7369 6669 6572 2e20 0a20  t classifier. . 
-0000c7c0: 2020 2054 6865 204f 7074 756e 6120 736f     The Optuna so
-0000c7d0: 6674 7761 7265 2066 6f72 2068 7970 6572  ftware for hyper
-0000c7e0: 7061 7261 6d65 7465 7220 6f70 7469 6d69  parameter optimi
-0000c7f0: 7a61 7469 6f6e 2077 6173 2070 7562 6c69  zation was publi
-0000c800: 7368 6564 2069 6e20 0a20 2020 2032 3031  shed in .    201
-0000c810: 3920 6279 2041 6b69 6261 2065 7420 616c  9 by Akiba et al
-0000c820: 2e20 5061 7065 723a 2068 7474 7073 3a2f  . Paper: https:/
-0000c830: 2f61 7278 6976 2e6f 7267 2f61 6273 2f31  /arxiv.org/abs/1
-0000c840: 3930 372e 3130 3930 320a 0a20 2020 2074  907.10902..    t
-0000c850: 6573 745f 7369 7a65 2069 7320 616e 206f  est_size is an o
-0000c860: 7074 696f 6e61 6c20 7061 7261 6d65 7465  ptional paramete
-0000c870: 7220 746f 2073 7065 6564 2075 7020 7468  r to speed up th
-0000c880: 6520 5847 4220 6f70 7469 6d69 7a61 7469  e XGB optimizati
-0000c890: 6f6e 2074 7261 696e 696e 672e 0a20 2020  on training..   
-0000c8a0: 2049 6620 696e 7075 742c 2061 2072 616e   If input, a ran
-0000c8b0: 646f 6d20 7661 6c69 6461 7469 6f6e 2064  dom validation d
-0000c8c0: 6174 6120 7769 6c6c 2062 6520 6765 6e65  ata will be gene
-0000c8d0: 7261 7465 6420 6163 636f 7264 696e 6720  rated according 
-0000c8e0: 746f 2074 6869 7320 7465 7374 2073 697a  to this test siz
-0000c8f0: 652c 0a20 2020 2077 6869 6368 2077 696c  e,.    which wil
-0000c900: 6c20 7265 706c 6163 6520 7468 6520 6372  l replace the cr
-0000c910: 6f73 732d 7661 6c69 6461 7469 6f6e 206d  oss-validation m
-0000c920: 6574 686f 6420 7573 6564 2062 7920 6465  ethod used by de
-0000c930: 6661 756c 7420 6475 7269 6e67 2e20 0a20  fault during. . 
-0000c940: 2020 204e 6565 6420 6d6f 7265 2074 6573     Need more tes
-0000c950: 7469 6e67 2074 6f20 6d61 6b65 2074 6869  ting to make thi
-0000c960: 7320 6d6f 7265 2072 6f62 7573 742c 2072  s more robust, r
-0000c970: 6563 6f6d 6d65 6e64 6564 206f 7074 696f  ecommended optio
-0000c980: 6e20 6973 2074 6573 745f 7369 7a65 3d4e  n is test_size=N
-0000c990: 6f6e 652e 200a 2020 2020 5468 6520 6f70  one. .    The op
-0000c9a0: 745f 6376 2070 6172 616d 6574 6572 2073  t_cv parameter s
-0000c9b0: 686f 756c 6420 6265 2075 7365 6420 696e  hould be used in
-0000c9c0: 7374 6561 6420 746f 2073 6574 2074 6865  stead to set the
-0000c9d0: 206e 756d 6265 7220 6f66 2066 6f6c 6473   number of folds
-0000c9e0: 2074 6f20 7573 6520 0a20 2020 2077 6865   to use .    whe
-0000c9f0: 6e20 6173 7365 7373 696e 6720 6f70 7469  n assessing opti
-0000ca00: 6d69 7a61 7469 6f6e 2074 7269 616c 2070  mization trial p
-0000ca10: 6572 666f 726d 616e 6365 2e20 0a0a 2020  erformance. ..  
-0000ca20: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-0000ca30: 6461 7461 5f78 2028 6e64 6172 7261 7929  data_x (ndarray)
-0000ca40: 3a20 3244 2061 7272 6179 206f 6620 7369  : 2D array of si
-0000ca50: 7a65 2028 6e20 7820 6d29 2c20 7768 6572  ze (n x m), wher
-0000ca60: 6520 6e20 6973 2074 6865 0a20 2020 2020  e n is the.     
-0000ca70: 2020 2020 2020 206e 756d 6265 7220 6f66         number of
-0000ca80: 2073 616d 706c 6573 2c20 616e 6420 6d20   samples, and m 
-0000ca90: 7468 6520 6e75 6d62 6572 206f 6620 6665  the number of fe
-0000caa0: 6174 7572 6573 2e0a 2020 2020 2020 2020  atures..        
-0000cab0: 6461 7461 5f79 2028 6e64 6172 7261 792c  data_y (ndarray,
-0000cac0: 2073 7472 293a 2031 4420 6172 7261 7920   str): 1D array 
-0000cad0: 636f 6e74 6169 6e69 6e67 2074 6865 2063  containing the c
-0000cae0: 6f72 7265 7370 6f6e 696e 6720 6c61 6265  orresponing labe
-0000caf0: 6c73 2e20 0a20 2020 2020 2020 206c 696d  ls. .        lim
-0000cb00: 6974 5f73 6561 7263 6820 2862 6f6f 6c29  it_search (bool)
-0000cb10: 3a20 4966 2054 7275 652c 2074 6865 2073  : If True, the s
-0000cb20: 6561 7263 6820 7370 6163 6520 666f 7220  earch space for 
-0000cb30: 7468 6520 7061 7261 6d65 7465 7273 2077  the parameters w
-0000cb40: 696c 6c20 6265 2065 7870 616e 6465 642c  ill be expanded,
-0000cb50: 0a20 2020 2020 2020 2020 2020 2061 7320  .            as 
-0000cb60: 7468 6572 6520 6172 6520 736f 6d65 2068  there are some h
-0000cb70: 7970 6572 7061 7261 6d65 7465 7273 2074  yperparameters t
-0000cb80: 6861 7420 6361 6e20 7261 6e67 6520 6672  hat can range fr
-0000cb90: 6f6d 2030 2074 6f20 696e 662e 2044 6566  om 0 to inf. Def
-0000cba0: 6175 6c74 7320 746f 2046 616c 7365 2e0a  aults to False..
-0000cbb0: 2020 2020 2020 2020 6f70 745f 6376 2028          opt_cv (
-0000cbc0: 696e 7429 3a20 4372 6f73 732d 7661 6c69  int): Cross-vali
-0000cbd0: 6461 7469 6f6e 7320 746f 2070 6572 666f  dations to perfo
-0000cbe0: 726d 2077 6865 6e20 6173 7365 7369 6e67  rm when assesing
-0000cbf0: 2074 6865 2070 6572 666f 726d 616e 6365   the performance
-0000cc00: 2061 7420 6561 6368 0a20 2020 2020 2020   at each.       
-0000cc10: 2020 2020 2068 7970 6572 7061 7261 6d65       hyperparame
-0000cc20: 7465 7220 6f70 7469 6d69 7a61 7469 6f6e  ter optimization
-0000cc30: 2074 7269 616c 2e20 466f 7220 6578 616d   trial. For exam
-0000cc40: 706c 652c 2069 6620 6376 3d33 2c20 7468  ple, if cv=3, th
-0000cc50: 656e 2065 6163 6820 6f70 7469 6d69 7a61  en each optimiza
-0000cc60: 7469 6f6e 2074 7269 616c 0a20 2020 2020  tion trial.     
-0000cc70: 2020 2020 2020 2077 696c 6c20 6265 2061         will be a
-0000cc80: 7373 6573 7365 6420 6163 636f 7264 696e  ssessed accordin
-0000cc90: 6720 746f 2074 6865 2033 2d66 6f6c 6420  g to the 3-fold 
-0000cca0: 6372 6f73 7320 7661 6c69 6461 7469 6f6e  cross validation
-0000ccb0: 2061 6363 7572 6163 792e 200a 2020 2020   accuracy. .    
-0000ccc0: 2020 2020 7465 7374 5f73 697a 6520 2866      test_size (f
-0000ccd0: 6c6f 6174 2c20 6f70 7469 6f6e 616c 293a  loat, optional):
-0000cce0: 2054 6865 2073 697a 6520 6f66 2074 6865   The size of the
-0000ccf0: 2076 616c 6964 6174 696f 6e20 6461 7461   validation data
-0000cd00: 2c20 7769 6c6c 2062 6520 6368 6f73 656e  , will be chosen
-0000cd10: 0a20 2020 2020 2020 2020 2020 2072 616e  .            ran
-0000cd20: 646f 6d6c 7920 6561 6368 2074 7269 616c  domly each trial
-0000cd30: 2e20 4d75 7374 2062 6520 6265 7477 6565  . Must be betwee
-0000cd40: 6e20 3020 616e 6420 312e 2044 6566 6175  n 0 and 1. Defau
-0000cd50: 6c74 7320 746f 204e 6f6e 652c 2069 6e20  lts to None, in 
-0000cd60: 7768 6963 680a 2020 2020 2020 2020 2020  which.          
-0000cd70: 2020 6361 7365 2074 6865 206f 7074 5f63    case the opt_c
-0000cd80: 7620 7061 7261 6d65 7465 7220 7769 6c6c  v parameter will
-0000cd90: 2062 6520 7573 6564 2069 6e73 7465 6164   be used instead
-0000cda0: 2e0a 0a20 2020 2052 6574 7572 6e73 3a0a  ...    Returns:.
-0000cdb0: 2020 2020 2020 2020 5468 6520 7065 7266          The perf
-0000cdc0: 6f72 6d61 6e63 6520 6d65 7472 6963 2e0a  ormance metric..
-0000cdd0: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
-0000cde0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0000cdf0: 6461 7461 5f78 2c20 6461 7461 5f79 2c20  data_x, data_y, 
-0000ce00: 6c69 6d69 745f 7365 6172 6368 3d46 616c  limit_search=Fal
-0000ce10: 7365 2c20 6f70 745f 6376 3d33 2c20 7465  se, opt_cv=3, te
-0000ce20: 7374 5f73 697a 653d 4e6f 6e65 293a 0a20  st_size=None):. 
-0000ce30: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
-0000ce40: 5f78 203d 2064 6174 615f 780a 2020 2020  _x = data_x.    
-0000ce50: 2020 2020 7365 6c66 2e64 6174 615f 7920      self.data_y 
-0000ce60: 3d20 6461 7461 5f79 0a20 2020 2020 2020  = data_y.       
-0000ce70: 2073 656c 662e 6c69 6d69 745f 7365 6172   self.limit_sear
-0000ce80: 6368 203d 206c 696d 6974 5f73 6561 7263  ch = limit_searc
-0000ce90: 680a 2020 2020 2020 2020 7365 6c66 2e6f  h.        self.o
-0000cea0: 7074 5f63 7620 3d20 6f70 745f 6376 200a  pt_cv = opt_cv .
-0000ceb0: 2020 2020 2020 2020 7365 6c66 2e74 6573          self.tes
-0000cec0: 745f 7369 7a65 203d 2074 6573 745f 7369  t_size = test_si
-0000ced0: 7a65 200a 0a20 2020 2064 6566 205f 5f63  ze ..    def __c
-0000cee0: 616c 6c5f 5f28 7365 6c66 2c20 7472 6961  all__(self, tria
-0000cef0: 6c29 3a0a 0a20 2020 2020 2020 2070 6172  l):..        par
-0000cf00: 616d 7320 3d20 7b22 6f62 6a65 6374 6976  ams = {"objectiv
-0000cf10: 6522 3a20 2262 696e 6172 793a 6c6f 6769  e": "binary:logi
-0000cf20: 7374 6963 222c 2022 6576 616c 5f6d 6574  stic", "eval_met
-0000cf30: 7269 6322 3a20 2261 7563 227d 0a20 2020  ric": "auc"}.   
-0000cf40: 200a 2020 2020 2020 2020 6966 2073 656c   .        if sel
-0000cf50: 662e 7465 7374 5f73 697a 6520 6973 206e  f.test_size is n
-0000cf60: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000cf70: 2020 2020 2074 7261 696e 5f78 2c20 7661       train_x, va
-0000cf80: 6c69 645f 782c 2074 7261 696e 5f79 2c20  lid_x, train_y, 
-0000cf90: 7661 6c69 645f 7920 3d20 7472 6169 6e5f  valid_y = train_
-0000cfa0: 7465 7374 5f73 706c 6974 2873 656c 662e  test_split(self.
-0000cfb0: 6461 7461 5f78 2c20 7365 6c66 2e64 6174  data_x, self.dat
-0000cfc0: 615f 792c 2074 6573 745f 7369 7a65 3d73  a_y, test_size=s
-0000cfd0: 656c 662e 7465 7374 5f73 697a 652c 2072  elf.test_size, r
-0000cfe0: 616e 646f 6d5f 7374 6174 653d 6e70 2e72  andom_state=np.r
-0000cff0: 616e 646f 6d2e 7261 6e64 696e 7428 312c  andom.randint(1,
-0000d000: 2031 6539 2929 0a20 2020 2020 2020 2020   1e9)).         
-0000d010: 2020 2064 7472 6169 6e2c 2064 7661 6c69     dtrain, dvali
-0000d020: 6420 3d20 444d 6174 7269 7828 7472 6169  d = DMatrix(trai
-0000d030: 6e5f 782c 206c 6162 656c 3d74 7261 696e  n_x, label=train
-0000d040: 5f79 292c 2044 4d61 7472 6978 2876 616c  _y), DMatrix(val
-0000d050: 6964 5f78 2c20 6c61 6265 6c3d 7661 6c69  id_x, label=vali
-0000d060: 645f 7929 0a20 2020 2020 2020 2020 2020  d_y).           
-0000d070: 2023 7072 696e 7428 2749 6e69 7469 616c   #print('Initial
-0000d080: 697a 696e 6720 5847 426f 6f73 7420 5072  izing XGBoost Pr
-0000d090: 756e 6572 2e2e 2e27 290a 2020 2020 2020  uner...').      
-0000d0a0: 2020 2020 2020 7072 756e 696e 675f 6361        pruning_ca
-0000d0b0: 6c6c 6261 636b 203d 206f 7074 756e 612e  llback = optuna.
-0000d0c0: 696e 7465 6772 6174 696f 6e2e 5847 426f  integration.XGBo
-0000d0d0: 6f73 7450 7275 6e69 6e67 4361 6c6c 6261  ostPruningCallba
-0000d0e0: 636b 2874 7269 616c 2c20 2276 616c 6964  ck(trial, "valid
-0000d0f0: 6174 696f 6e2d 6175 6322 290a 0a20 2020  ation-auc")..   
-0000d100: 2020 2020 2069 6620 7365 6c66 2e6c 696d       if self.lim
-0000d110: 6974 5f73 6561 7263 683a 0a20 2020 2020  it_search:.     
-0000d120: 2020 2020 2020 2070 6172 616d 735b 276e         params['n
-0000d130: 5f65 7374 696d 6174 6f72 7327 5d20 3d20  _estimators'] = 
-0000d140: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
-0000d150: 7428 276e 5f65 7374 696d 6174 6f72 7327  t('n_estimators'
-0000d160: 2c20 3130 302c 2032 3530 290a 2020 2020  , 100, 250).    
-0000d170: 2020 2020 2020 2020 7061 7261 6d73 5b27          params['
-0000d180: 626f 6f73 7465 7227 5d20 3d20 7472 6961  booster'] = tria
-0000d190: 6c2e 7375 6767 6573 745f 6361 7465 676f  l.suggest_catego
-0000d1a0: 7269 6361 6c28 2762 6f6f 7374 6572 272c  rical('booster',
-0000d1b0: 205b 2767 6274 7265 6527 2c20 2764 6172   ['gbtree', 'dar
-0000d1c0: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
-0000d1d0: 2070 6172 616d 735b 2772 6567 5f6c 616d   params['reg_lam
-0000d1e0: 6264 6127 5d20 3d20 7472 6961 6c2e 7375  bda'] = trial.su
-0000d1f0: 6767 6573 745f 6c6f 6775 6e69 666f 726d  ggest_loguniform
-0000d200: 2827 7265 675f 6c61 6d62 6461 272c 2031  ('reg_lambda', 1
-0000d210: 652d 382c 2031 290a 2020 2020 2020 2020  e-8, 1).        
-0000d220: 2020 2020 7061 7261 6d73 5b27 7265 675f      params['reg_
-0000d230: 616c 7068 6127 5d20 3d20 7472 6961 6c2e  alpha'] = trial.
-0000d240: 7375 6767 6573 745f 6c6f 6775 6e69 666f  suggest_logunifo
-0000d250: 726d 2827 7265 675f 616c 7068 6127 2c20  rm('reg_alpha', 
-0000d260: 3165 2d38 2c20 3129 0a20 2020 2020 2020  1e-8, 1).       
-0000d270: 2020 2020 2070 6172 616d 735b 276d 6178       params['max
-0000d280: 5f64 6570 7468 275d 203d 2074 7269 616c  _depth'] = trial
-0000d290: 2e73 7567 6765 7374 5f69 6e74 2827 6d61  .suggest_int('ma
-0000d2a0: 785f 6465 7074 6827 2c20 322c 2032 3529  x_depth', 2, 25)
-0000d2b0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-0000d2c0: 616d 735b 2765 7461 275d 203d 2074 7269  ams['eta'] = tri
-0000d2d0: 616c 2e73 7567 6765 7374 5f6c 6f67 756e  al.suggest_logun
-0000d2e0: 6966 6f72 6d28 2765 7461 272c 2031 652d  iform('eta', 1e-
-0000d2f0: 382c 2031 290a 2020 2020 2020 2020 2020  8, 1).          
-0000d300: 2020 7061 7261 6d73 5b27 6761 6d6d 6127    params['gamma'
-0000d310: 5d20 3d20 7472 6961 6c2e 7375 6767 6573  ] = trial.sugges
-0000d320: 745f 6c6f 6775 6e69 666f 726d 2827 6761  t_loguniform('ga
-0000d330: 6d6d 6127 2c20 3165 2d38 2c20 3129 0a20  mma', 1e-8, 1). 
-0000d340: 2020 2020 2020 2020 2020 2070 6172 616d             param
-0000d350: 735b 2767 726f 775f 706f 6c69 6379 275d  s['grow_policy']
-0000d360: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
-0000d370: 5f63 6174 6567 6f72 6963 616c 2827 6772  _categorical('gr
-0000d380: 6f77 5f70 6f6c 6963 7927 2c20 5b27 6465  ow_policy', ['de
-0000d390: 7074 6877 6973 6527 2c20 276c 6f73 7367  pthwise', 'lossg
-0000d3a0: 7569 6465 275d 290a 0a20 2020 2020 2020  uide'])..       
-0000d3b0: 2020 2020 2069 6620 7061 7261 6d73 5b27       if params['
-0000d3c0: 626f 6f73 7465 7227 5d20 3d3d 2022 6461  booster'] == "da
-0000d3d0: 7274 223a 0a20 2020 2020 2020 2020 2020  rt":.           
-0000d3e0: 2020 2020 2070 6172 616d 735b 2773 616d       params['sam
-0000d3f0: 706c 655f 7479 7065 275d 203d 2074 7269  ple_type'] = tri
-0000d400: 616c 2e73 7567 6765 7374 5f63 6174 6567  al.suggest_categ
-0000d410: 6f72 6963 616c 2827 7361 6d70 6c65 5f74  orical('sample_t
-0000d420: 7970 6527 2c20 5b27 756e 6966 6f72 6d27  ype', ['uniform'
-0000d430: 2c20 2777 6569 6768 7465 6427 5d29 0a20  , 'weighted']). 
-0000d440: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000d450: 6172 616d 735b 276e 6f72 6d61 6c69 7a65  arams['normalize
-0000d460: 5f74 7970 6527 5d20 3d20 7472 6961 6c2e  _type'] = trial.
-0000d470: 7375 6767 6573 745f 6361 7465 676f 7269  suggest_categori
-0000d480: 6361 6c28 276e 6f72 6d61 6c69 7a65 5f74  cal('normalize_t
-0000d490: 7970 6527 2c20 5b27 7472 6565 272c 2027  ype', ['tree', '
-0000d4a0: 666f 7265 7374 275d 290a 2020 2020 2020  forest']).      
-0000d4b0: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-0000d4c0: 5b27 7261 7465 5f64 726f 7027 5d20 3d20  ['rate_drop'] = 
-0000d4d0: 7472 6961 6c2e 7375 6767 6573 745f 6c6f  trial.suggest_lo
-0000d4e0: 6775 6e69 666f 726d 2827 7261 7465 5f64  guniform('rate_d
-0000d4f0: 726f 7027 2c20 3165 2d38 2c20 3129 0a20  rop', 1e-8, 1). 
-0000d500: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000d510: 6172 616d 735b 2773 6b69 705f 6472 6f70  arams['skip_drop
-0000d520: 275d 203d 2074 7269 616c 2e73 7567 6765  '] = trial.sugge
-0000d530: 7374 5f6c 6f67 756e 6966 6f72 6d28 2773  st_loguniform('s
-0000d540: 6b69 705f 6472 6f70 272c 2031 652d 382c  kip_drop', 1e-8,
-0000d550: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
-0000d560: 2020 2020 6966 2073 656c 662e 7465 7374      if self.test
-0000d570: 5f73 697a 6520 6973 204e 6f6e 653a 0a20  _size is None:. 
-0000d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d590: 2020 2063 6c66 203d 2058 4742 436c 6173     clf = XGBClas
-0000d5a0: 7369 6669 6572 2862 6f6f 7374 6572 3d70  sifier(booster=p
-0000d5b0: 6172 616d 735b 2762 6f6f 7374 6572 275d  arams['booster']
-0000d5c0: 2c20 6e5f 6573 7469 6d61 746f 7273 3d70  , n_estimators=p
-0000d5d0: 6172 616d 735b 276e 5f65 7374 696d 6174  arams['n_estimat
-0000d5e0: 6f72 7327 5d2c 2072 6567 5f6c 616d 6264  ors'], reg_lambd
-0000d5f0: 613d 7061 7261 6d73 5b27 7265 675f 6c61  a=params['reg_la
-0000d600: 6d62 6461 275d 2c20 0a20 2020 2020 2020  mbda'], .       
-0000d610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d620: 2072 6567 5f61 6c70 6861 3d70 6172 616d   reg_alpha=param
-0000d630: 735b 2772 6567 5f61 6c70 6861 275d 2c20  s['reg_alpha'], 
-0000d640: 6d61 785f 6465 7074 683d 7061 7261 6d73  max_depth=params
-0000d650: 5b27 6d61 785f 6465 7074 6827 5d2c 2065  ['max_depth'], e
-0000d660: 7461 3d70 6172 616d 735b 2765 7461 275d  ta=params['eta']
-0000d670: 2c20 6761 6d6d 613d 7061 7261 6d73 5b27  , gamma=params['
-0000d680: 6761 6d6d 6127 5d2c 200a 2020 2020 2020  gamma'], .      
-0000d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6a0: 2020 6772 6f77 5f70 6f6c 6963 793d 7061    grow_policy=pa
-0000d6b0: 7261 6d73 5b27 6772 6f77 5f70 6f6c 6963  rams['grow_polic
-0000d6c0: 7927 5d2c 2073 616d 706c 655f 7479 7065  y'], sample_type
-0000d6d0: 3d70 6172 616d 735b 2773 616d 706c 655f  =params['sample_
-0000d6e0: 7479 7065 275d 2c20 6e6f 726d 616c 697a  type'], normaliz
-0000d6f0: 655f 7479 7065 3d70 6172 616d 735b 276e  e_type=params['n
-0000d700: 6f72 6d61 6c69 7a65 5f74 7970 6527 5d2c  ormalize_type'],
-0000d710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d720: 2020 2020 2020 2020 2072 6174 655f 6472           rate_dr
-0000d730: 6f70 3d70 6172 616d 735b 2772 6174 655f  op=params['rate_
-0000d740: 6472 6f70 275d 2c20 736b 6970 5f64 726f  drop'], skip_dro
-0000d750: 703d 7061 7261 6d73 5b27 736b 6970 5f64  p=params['skip_d
-0000d760: 726f 7027 5d2c 2072 616e 646f 6d5f 7374  rop'], random_st
-0000d770: 6174 653d 3139 3039 2923 2c20 7472 6565  ate=1909)#, tree
-0000d780: 5f6d 6574 686f 643d 2768 6973 7427 290a  _method='hist').
-0000d790: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0000d7a0: 2020 2020 2020 2020 2065 6c69 6620 7061           elif pa
-0000d7b0: 7261 6d73 5b27 626f 6f73 7465 7227 5d20  rams['booster'] 
-0000d7c0: 3d3d 2027 6762 7472 6565 273a 0a20 2020  == 'gbtree':.   
-0000d7d0: 2020 2020 2020 2020 2020 2020 2070 6172               par
-0000d7e0: 616d 735b 2773 7562 7361 6d70 6c65 275d  ams['subsample']
-0000d7f0: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
-0000d800: 5f6c 6f67 756e 6966 6f72 6d28 2773 7562  _loguniform('sub
-0000d810: 7361 6d70 6c65 272c 2031 652d 362c 2031  sample', 1e-6, 1
-0000d820: 2e30 290a 2020 2020 2020 2020 2020 2020  .0).            
-0000d830: 2020 2020 6966 2073 656c 662e 7465 7374      if self.test
-0000d840: 5f73 697a 6520 6973 204e 6f6e 653a 0a20  _size is None:. 
+0000af70: 2020 2066 696c 7465 725f 3320 3d20 7472     filter_3 = tr
+0000af80: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+0000af90: 2766 696c 7465 725f 3327 2c20 3132 2c20  'filter_3', 12, 
+0000afa0: 3531 362c 2073 7465 703d 3132 290a 2020  516, step=12).  
+0000afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000afc0: 2020 6669 6c74 6572 5f73 697a 655f 3320    filter_size_3 
+0000afd0: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+0000afe0: 696e 7428 2766 696c 7465 725f 7369 7a65  int('filter_size
+0000aff0: 5f33 272c 2031 2c20 372c 2073 7465 703d  _3', 1, 7, step=
+0000b000: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
+0000b010: 2020 2020 2020 2073 7472 6964 6573 5f33         strides_3
+0000b020: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+0000b030: 5f69 6e74 2827 7374 7269 6465 735f 3327  _int('strides_3'
+0000b040: 2c20 312c 2033 2c20 7374 6570 3d31 290a  , 1, 3, step=1).
+0000b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b060: 2020 2020 706f 6f6c 5f73 697a 655f 3320      pool_size_3 
+0000b070: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+0000b080: 696e 7428 2770 6f6f 6c5f 7369 7a65 5f33  int('pool_size_3
+0000b090: 272c 2031 2c20 372c 2073 7465 703d 3129  ', 1, 7, step=1)
+0000b0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b0b0: 2020 2020 2070 6f6f 6c5f 7374 7269 6465       pool_stride
+0000b0c0: 5f33 203d 2074 7269 616c 2e73 7567 6765  _3 = trial.sugge
+0000b0d0: 7374 5f69 6e74 2827 706f 6f6c 5f73 7472  st_int('pool_str
+0000b0e0: 6964 655f 3327 2c20 312c 2033 2c20 7374  ide_3', 1, 3, st
+0000b0f0: 6570 3d31 290a 0a20 2020 2020 2020 2020  ep=1)..         
+0000b100: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+0000b110: 725f 3420 3d20 7472 6961 6c2e 7375 6767  r_4 = trial.sugg
+0000b120: 6573 745f 696e 7428 2766 696c 7465 725f  est_int('filter_
+0000b130: 3427 2c20 3132 2c20 3531 362c 2073 7465  4', 12, 516, ste
+0000b140: 703d 3132 290a 2020 2020 2020 2020 2020  p=12).          
+0000b150: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+0000b160: 5f73 697a 655f 3420 3d20 7472 6961 6c2e  _size_4 = trial.
+0000b170: 7375 6767 6573 745f 696e 7428 2766 696c  suggest_int('fil
+0000b180: 7465 725f 7369 7a65 5f34 272c 2031 2c20  ter_size_4', 1, 
+0000b190: 372c 2073 7465 703d 3229 0a20 2020 2020  7, step=2).     
+0000b1a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b1b0: 7472 6964 6573 5f34 203d 2074 7269 616c  trides_4 = trial
+0000b1c0: 2e73 7567 6765 7374 5f69 6e74 2827 7374  .suggest_int('st
+0000b1d0: 7269 6465 735f 3427 2c20 312c 2033 2c20  rides_4', 1, 3, 
+0000b1e0: 7374 6570 3d31 290a 2020 2020 2020 2020  step=1).        
+0000b1f0: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+0000b200: 5f73 697a 655f 3420 3d20 7472 6961 6c2e  _size_4 = trial.
+0000b210: 7375 6767 6573 745f 696e 7428 2770 6f6f  suggest_int('poo
+0000b220: 6c5f 7369 7a65 5f34 272c 2031 2c20 372c  l_size_4', 1, 7,
+0000b230: 2073 7465 703d 3129 0a20 2020 2020 2020   step=1).       
+0000b240: 2020 2020 2020 2020 2020 2020 2070 6f6f               poo
+0000b250: 6c5f 7374 7269 6465 5f34 203d 2074 7269  l_stride_4 = tri
+0000b260: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+0000b270: 706f 6f6c 5f73 7472 6964 655f 3427 2c20  pool_stride_4', 
+0000b280: 312c 2033 2c20 7374 6570 3d31 290a 0a20  1, 3, step=1).. 
+0000b290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b2a0: 2020 2066 696c 7465 725f 3520 3d20 7472     filter_5 = tr
+0000b2b0: 6961 6c2e 7375 6767 6573 745f 696e 7428  ial.suggest_int(
+0000b2c0: 2766 696c 7465 725f 3527 2c20 3132 2c20  'filter_5', 12, 
+0000b2d0: 3531 362c 2073 7465 703d 3132 290a 2020  516, step=12).  
+0000b2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b2f0: 2020 6669 6c74 6572 5f73 697a 655f 3520    filter_size_5 
+0000b300: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+0000b310: 696e 7428 2766 696c 7465 725f 7369 7a65  int('filter_size
+0000b320: 5f35 272c 2031 2c20 372c 2073 7465 703d  _5', 1, 7, step=
+0000b330: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
+0000b340: 2020 2020 2020 2073 7472 6964 6573 5f35         strides_5
+0000b350: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+0000b360: 5f69 6e74 2827 7374 7269 6465 735f 3527  _int('strides_5'
+0000b370: 2c20 312c 2033 2c20 7374 6570 3d31 2920  , 1, 3, step=1) 
+0000b380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b390: 2020 2020 2070 6f6f 6c5f 7369 7a65 5f35       pool_size_5
+0000b3a0: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+0000b3b0: 5f69 6e74 2827 706f 6f6c 5f73 697a 655f  _int('pool_size_
+0000b3c0: 3527 2c20 312c 2037 2c20 7374 6570 3d31  5', 1, 7, step=1
+0000b3d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000b3e0: 2020 2020 2020 706f 6f6c 5f73 7472 6964        pool_strid
+0000b3f0: 655f 3520 3d20 7472 6961 6c2e 7375 6767  e_5 = trial.sugg
+0000b400: 6573 745f 696e 7428 2770 6f6f 6c5f 7374  est_int('pool_st
+0000b410: 7269 6465 5f35 272c 2031 2c20 332c 2073  ride_5', 1, 3, s
+0000b420: 7465 703d 3129 0a0a 2020 2020 2020 2020  tep=1)..        
+0000b430: 2020 2020 2020 2020 2020 2020 2323 2320              ### 
+0000b440: 4465 6e73 6520 4c61 7965 7273 2023 2323  Dense Layers ###
+0000b450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b460: 2020 2020 2064 656e 7365 5f6e 6575 726f       dense_neuro
+0000b470: 6e73 5f31 203d 2074 7269 616c 2e73 7567  ns_1 = trial.sug
+0000b480: 6765 7374 5f69 6e74 2827 6465 6e73 655f  gest_int('dense_
+0000b490: 6e65 7572 6f6e 735f 3127 2c20 3132 382c  neurons_1', 128,
+0000b4a0: 2036 3430 302c 2073 7465 703d 3132 3829   6400, step=128)
+0000b4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b4c0: 2020 2020 2064 656e 7365 5f6e 6575 726f       dense_neuro
+0000b4d0: 6e73 5f32 203d 2074 7269 616c 2e73 7567  ns_2 = trial.sug
+0000b4e0: 6765 7374 5f69 6e74 2827 6465 6e73 655f  gest_int('dense_
+0000b4f0: 6e65 7572 6f6e 735f 3227 2c20 3132 382c  neurons_2', 128,
+0000b500: 2036 3430 302c 2073 7465 703d 3132 3829   6400, step=128)
+0000b510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b520: 2020 2020 2064 726f 706f 7574 5f31 203d       dropout_1 =
+0000b530: 2074 7269 616c 2e73 7567 6765 7374 5f66   trial.suggest_f
+0000b540: 6c6f 6174 2827 6472 6f70 6f75 745f 3127  loat('dropout_1'
+0000b550: 2c20 302e 302c 2030 2e35 2c20 7374 6570  , 0.0, 0.5, step
+0000b560: 3d30 2e30 3129 0a20 2020 2020 2020 2020  =0.01).         
+0000b570: 2020 2020 2020 2020 2020 2064 726f 706f             dropo
+0000b580: 7574 5f32 203d 2074 7269 616c 2e73 7567  ut_2 = trial.sug
+0000b590: 6765 7374 5f66 6c6f 6174 2827 6472 6f70  gest_float('drop
+0000b5a0: 6f75 745f 3227 2c20 302e 302c 2030 2e35  out_2', 0.0, 0.5
+0000b5b0: 2c20 7374 6570 3d30 2e30 3129 200a 0a20  , step=0.01) .. 
+0000b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5d0: 2020 206d 6f64 656c 2c20 6869 7374 6f72     model, histor
+0000b5e0: 7920 3d20 636e 6e5f 6d6f 6465 6c2e 5647  y = cnn_model.VG
+0000b5f0: 4731 3628 636c 6173 735f 312c 2063 6c61  G16(class_1, cla
+0000b600: 7373 5f32 2c20 696d 675f 6e75 6d5f 6368  ss_2, img_num_ch
+0000b610: 616e 6e65 6c73 3d73 656c 662e 696d 675f  annels=self.img_
+0000b620: 6e75 6d5f 6368 616e 6e65 6c73 2c20 0a20  num_channels, . 
+0000b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b640: 2020 2020 2020 206e 6f72 6d61 6c69 7a65         normalize
+0000b650: 3d73 656c 662e 6e6f 726d 616c 697a 652c  =self.normalize,
+0000b660: 206d 696e 5f70 6978 656c 3d6d 696e 5f70   min_pixel=min_p
+0000b670: 6978 2c20 6d61 785f 7069 7865 6c3d 6d61  ix, max_pixel=ma
+0000b680: 785f 7069 782c 2076 616c 5f70 6f73 6974  x_pix, val_posit
+0000b690: 6976 653d 7661 6c5f 636c 6173 735f 312c  ive=val_class_1,
+0000b6a0: 2076 616c 5f6e 6567 6174 6976 653d 7661   val_negative=va
+0000b6b0: 6c5f 636c 6173 735f 322c 200a 2020 2020  l_class_2, .    
+0000b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6d0: 2020 2020 6570 6f63 6873 3d73 656c 662e      epochs=self.
+0000b6e0: 7472 6169 6e5f 6570 6f63 6873 2c20 6261  train_epochs, ba
+0000b6f0: 7463 685f 7369 7a65 3d62 6174 6368 5f73  tch_size=batch_s
+0000b700: 697a 652c 206f 7074 696d 697a 6572 3d6f  ize, optimizer=o
+0000b710: 7074 696d 697a 6572 2c20 6c72 3d6c 722c  ptimizer, lr=lr,
+0000b720: 2064 6563 6179 3d64 6563 6179 2c20 6d6f   decay=decay, mo
+0000b730: 6d65 6e74 756d 3d6d 6f6d 656e 7475 6d2c  mentum=momentum,
+0000b740: 206e 6573 7465 726f 763d 6e65 7374 6572   nesterov=nester
+0000b750: 6f76 2c20 0a20 2020 2020 2020 2020 2020  ov, .           
+0000b760: 2020 2020 2020 2020 2020 2020 2062 6574               bet
+0000b770: 615f 313d 6265 7461 5f31 2c20 6265 7461  a_1=beta_1, beta
+0000b780: 5f32 3d62 6574 615f 322c 2061 6d73 6772  _2=beta_2, amsgr
+0000b790: 6164 3d61 6d73 6772 6164 2c20 6c6f 7373  ad=amsgrad, loss
+0000b7a0: 3d6c 6f73 732c 2061 6374 6976 6174 696f  =loss, activatio
+0000b7b0: 6e5f 636f 6e76 3d61 6374 6976 6174 696f  n_conv=activatio
+0000b7c0: 6e5f 636f 6e76 2c20 6163 7469 7661 7469  n_conv, activati
+0000b7d0: 6f6e 5f64 656e 7365 3d61 6374 6976 6174  on_dense=activat
+0000b7e0: 696f 6e5f 6465 6e73 652c 200a 2020 2020  ion_dense, .    
+0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b800: 2020 2020 636f 6e76 5f69 6e69 743d 636f      conv_init=co
+0000b810: 6e76 5f69 6e69 742c 2064 656e 7365 5f69  nv_init, dense_i
+0000b820: 6e69 743d 6465 6e73 655f 696e 6974 2c20  nit=dense_init, 
+0000b830: 6d6f 6465 6c5f 7265 673d 6d6f 6465 6c5f  model_reg=model_
+0000b840: 7265 672c 2020 2020 2020 2020 2020 2020  reg,            
+0000b850: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0000b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b870: 2020 2066 696c 7465 725f 313d 6669 6c74     filter_1=filt
+0000b880: 6572 5f31 2c20 6669 6c74 6572 5f73 697a  er_1, filter_siz
+0000b890: 655f 313d 6669 6c74 6572 5f73 697a 655f  e_1=filter_size_
+0000b8a0: 312c 2073 7472 6964 6573 5f31 3d73 7472  1, strides_1=str
+0000b8b0: 6964 6573 5f31 2c20 706f 6f6c 696e 675f  ides_1, pooling_
+0000b8c0: 313d 706f 6f6c 696e 675f 312c 2070 6f6f  1=pooling_1, poo
+0000b8d0: 6c5f 7369 7a65 5f31 3d70 6f6f 6c5f 7369  l_size_1=pool_si
+0000b8e0: 7a65 5f31 2c20 706f 6f6c 5f73 7472 6964  ze_1, pool_strid
+0000b8f0: 655f 313d 706f 6f6c 5f73 7472 6964 655f  e_1=pool_stride_
+0000b900: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
+0000b910: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+0000b920: 725f 323d 6669 6c74 6572 5f32 2c20 6669  r_2=filter_2, fi
+0000b930: 6c74 6572 5f73 697a 655f 323d 6669 6c74  lter_size_2=filt
+0000b940: 6572 5f73 697a 655f 322c 2073 7472 6964  er_size_2, strid
+0000b950: 6573 5f32 3d73 7472 6964 6573 5f32 2c20  es_2=strides_2, 
+0000b960: 706f 6f6c 696e 675f 323d 706f 6f6c 696e  pooling_2=poolin
+0000b970: 675f 322c 2070 6f6f 6c5f 7369 7a65 5f32  g_2, pool_size_2
+0000b980: 3d70 6f6f 6c5f 7369 7a65 5f32 2c20 706f  =pool_size_2, po
+0000b990: 6f6c 5f73 7472 6964 655f 323d 706f 6f6c  ol_stride_2=pool
+0000b9a0: 5f73 7472 6964 655f 322c 0a20 2020 2020  _stride_2,.     
+0000b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9c0: 2020 2066 696c 7465 725f 333d 6669 6c74     filter_3=filt
+0000b9d0: 6572 5f33 2c20 6669 6c74 6572 5f73 697a  er_3, filter_siz
+0000b9e0: 655f 333d 6669 6c74 6572 5f73 697a 655f  e_3=filter_size_
+0000b9f0: 332c 2073 7472 6964 6573 5f33 3d73 7472  3, strides_3=str
+0000ba00: 6964 6573 5f33 2c20 706f 6f6c 696e 675f  ides_3, pooling_
+0000ba10: 333d 706f 6f6c 696e 675f 332c 2070 6f6f  3=pooling_3, poo
+0000ba20: 6c5f 7369 7a65 5f33 3d70 6f6f 6c5f 7369  l_size_3=pool_si
+0000ba30: 7a65 5f33 2c20 706f 6f6c 5f73 7472 6964  ze_3, pool_strid
+0000ba40: 655f 333d 706f 6f6c 5f73 7472 6964 655f  e_3=pool_stride_
+0000ba50: 332c 0a20 2020 2020 2020 2020 2020 2020  3,.             
+0000ba60: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+0000ba70: 725f 343d 6669 6c74 6572 5f34 2c20 6669  r_4=filter_4, fi
+0000ba80: 6c74 6572 5f73 697a 655f 343d 6669 6c74  lter_size_4=filt
+0000ba90: 6572 5f73 697a 655f 342c 2073 7472 6964  er_size_4, strid
+0000baa0: 6573 5f34 3d73 7472 6964 6573 5f34 2c20  es_4=strides_4, 
+0000bab0: 706f 6f6c 696e 675f 343d 706f 6f6c 696e  pooling_4=poolin
+0000bac0: 675f 342c 2070 6f6f 6c5f 7369 7a65 5f34  g_4, pool_size_4
+0000bad0: 3d70 6f6f 6c5f 7369 7a65 5f34 2c20 706f  =pool_size_4, po
+0000bae0: 6f6c 5f73 7472 6964 655f 343d 706f 6f6c  ol_stride_4=pool
+0000baf0: 5f73 7472 6964 655f 342c 0a20 2020 2020  _stride_4,.     
+0000bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb10: 2020 2066 696c 7465 725f 353d 6669 6c74     filter_5=filt
+0000bb20: 6572 5f35 2c20 6669 6c74 6572 5f73 697a  er_5, filter_siz
+0000bb30: 655f 353d 6669 6c74 6572 5f73 697a 655f  e_5=filter_size_
+0000bb40: 352c 2073 7472 6964 6573 5f35 3d73 7472  5, strides_5=str
+0000bb50: 6964 6573 5f35 2c20 706f 6f6c 696e 675f  ides_5, pooling_
+0000bb60: 353d 706f 6f6c 696e 675f 352c 2070 6f6f  5=pooling_5, poo
+0000bb70: 6c5f 7369 7a65 5f35 3d70 6f6f 6c5f 7369  l_size_5=pool_si
+0000bb80: 7a65 5f35 2c20 706f 6f6c 5f73 7472 6964  ze_5, pool_strid
+0000bb90: 655f 353d 706f 6f6c 5f73 7472 6964 655f  e_5=pool_stride_
+0000bba0: 352c 0a20 2020 2020 2020 2020 2020 2020  5,.             
+0000bbb0: 2020 2020 2020 2020 2020 2064 656e 7365             dense
+0000bbc0: 5f6e 6575 726f 6e73 5f31 3d64 656e 7365  _neurons_1=dense
+0000bbd0: 5f6e 6575 726f 6e73 5f31 2c20 6465 6e73  _neurons_1, dens
+0000bbe0: 655f 6e65 7572 6f6e 735f 323d 6465 6e73  e_neurons_2=dens
+0000bbf0: 655f 6e65 7572 6f6e 735f 322c 2064 726f  e_neurons_2, dro
+0000bc00: 706f 7574 5f31 3d64 726f 706f 7574 5f31  pout_1=dropout_1
+0000bc10: 2c20 6472 6f70 6f75 745f 323d 6472 6f70  , dropout_2=drop
+0000bc20: 6f75 745f 322c 200a 2020 2020 2020 2020  out_2, .        
+0000bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc40: 736d 6f74 655f 7361 6d70 6c69 6e67 3d73  smote_sampling=s
+0000bc50: 656c 662e 736d 6f74 655f 7361 6d70 6c69  elf.smote_sampli
+0000bc60: 6e67 2c20 6561 726c 795f 7374 6f70 5f63  ng, early_stop_c
+0000bc70: 616c 6c62 6163 6b3d 6361 6c6c 6261 636b  allback=callback
+0000bc80: 732c 2063 6865 636b 706f 696e 743d 4661  s, checkpoint=Fa
+0000bc90: 6c73 652c 2076 6572 626f 7365 3d73 656c  lse, verbose=sel
+0000bca0: 662e 7665 7262 6f73 6529 0a0a 2020 2020  f.verbose)..    
+0000bcb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000bcc0: 2020 2020 2020 6966 2073 656c 662e 6f70        if self.op
+0000bcd0: 745f 6376 2069 7320 6e6f 7420 4e6f 6e65  t_cv is not None
+0000bce0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000bcf0: 2020 7072 696e 7428 293b 2070 7269 6e74    print(); print
+0000bd00: 2827 2a2a 2a2a 2a2a 2a2a 2a2a 2a20 2043  ('***********  C
+0000bd10: 5620 2d20 3120 2a2a 2a2a 2a2a 2a2a 2a2a  V - 1 **********
+0000bd20: 2a27 293b 2070 7269 6e74 2829 0a20 2020  *'); print().   
+0000bd30: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000bd40: 2e6f 7074 5f61 7567 3a0a 2020 2020 2020  .opt_aug:.      
+0000bd50: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000bd60: 293b 2070 7269 6e74 2827 3d3d 3d3d 3d3d  ); print('======
+0000bd70: 3d20 496d 6167 6520 5061 7261 6d65 7465  = Image Paramete
+0000bd80: 7273 203d 3d3d 3d3d 3d27 293b 2070 7269  rs ======'); pri
+0000bd90: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
+0000bda0: 2020 2020 2070 7269 6e74 2827 4e75 6d20       print('Num 
+0000bdb0: 4175 676d 656e 7461 7469 6f6e 7320 3a20  Augmentations : 
+0000bdc0: 272c 206e 756d 5f61 7567 290a 2020 2020  ', num_aug).    
+0000bdd0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000bde0: 7428 2749 6d61 6765 2053 697a 6520 3a20  t('Image Size : 
+0000bdf0: 272c 2069 6d61 6765 5f73 697a 6529 0a20  ', image_size). 
+0000be00: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000be10: 7269 6e74 2827 4d61 7820 5069 7865 6c28  rint('Max Pixel(
+0000be20: 7329 203a 2027 2c20 6d61 785f 7069 7829  s) : ', max_pix)
+0000be30: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000be40: 2073 656c 662e 636c 6620 3d3d 2027 616c   self.clf == 'al
+0000be50: 6578 6e65 7427 3a0a 2020 2020 2020 2020  exnet':.        
+0000be60: 2020 2020 2020 2020 6d6f 6465 6c2c 2068          model, h
+0000be70: 6973 746f 7279 203d 2063 6e6e 5f6d 6f64  istory = cnn_mod
+0000be80: 656c 2e41 6c65 784e 6574 2863 6c61 7373  el.AlexNet(class
+0000be90: 5f31 2c20 636c 6173 735f 322c 2069 6d67  _1, class_2, img
+0000bea0: 5f6e 756d 5f63 6861 6e6e 656c 733d 7365  _num_channels=se
+0000beb0: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
+0000bec0: 656c 732c 200a 2020 2020 2020 2020 2020  els, .          
+0000bed0: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
+0000bee0: 697a 653d 7365 6c66 2e6e 6f72 6d61 6c69  ize=self.normali
+0000bef0: 7a65 2c20 6d69 6e5f 7069 7865 6c3d 6d69  ze, min_pixel=mi
+0000bf00: 6e5f 7069 782c 206d 6178 5f70 6978 656c  n_pix, max_pixel
+0000bf10: 3d6d 6178 5f70 6978 2c20 7661 6c5f 706f  =max_pix, val_po
+0000bf20: 7369 7469 7665 3d76 616c 5f63 6c61 7373  sitive=val_class
+0000bf30: 5f31 2c20 7661 6c5f 6e65 6761 7469 7665  _1, val_negative
+0000bf40: 3d76 616c 5f63 6c61 7373 5f32 2c20 0a20  =val_class_2, . 
+0000bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf60: 2020 2065 706f 6368 733d 7365 6c66 2e74     epochs=self.t
+0000bf70: 7261 696e 5f65 706f 6368 732c 2062 6174  rain_epochs, bat
+0000bf80: 6368 5f73 697a 653d 6261 7463 685f 7369  ch_size=batch_si
+0000bf90: 7a65 2c20 6f70 7469 6d69 7a65 723d 6f70  ze, optimizer=op
+0000bfa0: 7469 6d69 7a65 722c 206c 723d 6c72 2c20  timizer, lr=lr, 
+0000bfb0: 6465 6361 793d 6465 6361 792c 206d 6f6d  decay=decay, mom
+0000bfc0: 656e 7475 6d3d 6d6f 6d65 6e74 756d 2c20  entum=momentum, 
+0000bfd0: 6e65 7374 6572 6f76 3d6e 6573 7465 726f  nesterov=nestero
+0000bfe0: 762c 200a 2020 2020 2020 2020 2020 2020  v, .            
+0000bff0: 2020 2020 2020 2020 6265 7461 5f31 3d62          beta_1=b
+0000c000: 6574 615f 312c 2062 6574 615f 323d 6265  eta_1, beta_2=be
+0000c010: 7461 5f32 2c20 616d 7367 7261 643d 616d  ta_2, amsgrad=am
+0000c020: 7367 7261 642c 2073 6d6f 7465 5f73 616d  sgrad, smote_sam
+0000c030: 706c 696e 673d 7365 6c66 2e73 6d6f 7465  pling=self.smote
+0000c040: 5f73 616d 706c 696e 672c 2065 6172 6c79  _sampling, early
+0000c050: 5f73 746f 705f 6361 6c6c 6261 636b 3d63  _stop_callback=c
+0000c060: 616c 6c62 6163 6b73 2c20 6368 6563 6b70  allbacks, checkp
+0000c070: 6f69 6e74 3d46 616c 7365 2c20 7665 7262  oint=False, verb
+0000c080: 6f73 653d 7365 6c66 2e76 6572 626f 7365  ose=self.verbose
+0000c090: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0000c0a0: 6966 2073 656c 662e 636c 6620 3d3d 2027  if self.clf == '
+0000c0b0: 6375 7374 6f6d 5f63 6e6e 273a 0a20 2020  custom_cnn':.   
+0000c0c0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0000c0d0: 656c 2c20 6869 7374 6f72 7920 3d20 636e  el, history = cn
+0000c0e0: 6e5f 6d6f 6465 6c2e 6375 7374 6f6d 5f6d  n_model.custom_m
+0000c0f0: 6f64 656c 2863 6c61 7373 5f31 2c20 636c  odel(class_1, cl
+0000c100: 6173 735f 322c 2069 6d67 5f6e 756d 5f63  ass_2, img_num_c
+0000c110: 6861 6e6e 656c 733d 7365 6c66 2e69 6d67  hannels=self.img
+0000c120: 5f6e 756d 5f63 6861 6e6e 656c 732c 200a  _num_channels, .
+0000c130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c140: 2020 2020 6e6f 726d 616c 697a 653d 7365      normalize=se
+0000c150: 6c66 2e6e 6f72 6d61 6c69 7a65 2c20 6d69  lf.normalize, mi
+0000c160: 6e5f 7069 7865 6c3d 6d69 6e5f 7069 782c  n_pixel=min_pix,
+0000c170: 206d 6178 5f70 6978 656c 3d6d 6178 5f70   max_pixel=max_p
+0000c180: 6978 2c20 7661 6c5f 706f 7369 7469 7665  ix, val_positive
+0000c190: 3d76 616c 5f63 6c61 7373 5f31 2c20 7661  =val_class_1, va
+0000c1a0: 6c5f 6e65 6761 7469 7665 3d76 616c 5f63  l_negative=val_c
+0000c1b0: 6c61 7373 5f32 2c20 0a20 2020 2020 2020  lass_2, .       
+0000c1c0: 2020 2020 2020 2020 2020 2020 2065 706f               epo
+0000c1d0: 6368 733d 7365 6c66 2e74 7261 696e 5f65  chs=self.train_e
+0000c1e0: 706f 6368 732c 2062 6174 6368 5f73 697a  pochs, batch_siz
+0000c1f0: 653d 6261 7463 685f 7369 7a65 2c20 6f70  e=batch_size, op
+0000c200: 7469 6d69 7a65 723d 6f70 7469 6d69 7a65  timizer=optimize
+0000c210: 722c 206c 723d 6c72 2c20 6465 6361 793d  r, lr=lr, decay=
+0000c220: 6465 6361 792c 206d 6f6d 656e 7475 6d3d  decay, momentum=
+0000c230: 6d6f 6d65 6e74 756d 2c20 6e65 7374 6572  momentum, nester
+0000c240: 6f76 3d6e 6573 7465 726f 762c 200a 2020  ov=nesterov, .  
+0000c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c260: 2020 6265 7461 5f31 3d62 6574 615f 312c    beta_1=beta_1,
+0000c270: 2062 6574 615f 323d 6265 7461 5f32 2c20   beta_2=beta_2, 
+0000c280: 616d 7367 7261 643d 616d 7367 7261 642c  amsgrad=amsgrad,
+0000c290: 2073 6d6f 7465 5f73 616d 706c 696e 673d   smote_sampling=
+0000c2a0: 7365 6c66 2e73 6d6f 7465 5f73 616d 706c  self.smote_sampl
+0000c2b0: 696e 672c 2065 6172 6c79 5f73 746f 705f  ing, early_stop_
+0000c2c0: 6361 6c6c 6261 636b 3d63 616c 6c62 6163  callback=callbac
+0000c2d0: 6b73 2c20 6368 6563 6b70 6f69 6e74 3d46  ks, checkpoint=F
+0000c2e0: 616c 7365 2c20 7665 7262 6f73 653d 7365  alse, verbose=se
+0000c2f0: 6c66 2e76 6572 626f 7365 290a 2020 2020  lf.verbose).    
+0000c300: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+0000c310: 662e 636c 6620 3d3d 2027 7667 6731 3627  f.clf == 'vgg16'
+0000c320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c330: 2020 6d6f 6465 6c2c 2068 6973 746f 7279    model, history
+0000c340: 203d 2063 6e6e 5f6d 6f64 656c 2e56 4747   = cnn_model.VGG
+0000c350: 3136 2863 6c61 7373 5f31 2c20 636c 6173  16(class_1, clas
+0000c360: 735f 322c 2069 6d67 5f6e 756d 5f63 6861  s_2, img_num_cha
+0000c370: 6e6e 656c 733d 7365 6c66 2e69 6d67 5f6e  nnels=self.img_n
+0000c380: 756d 5f63 6861 6e6e 656c 732c 200a 2020  um_channels, .  
+0000c390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3a0: 2020 6e6f 726d 616c 697a 653d 7365 6c66    normalize=self
+0000c3b0: 2e6e 6f72 6d61 6c69 7a65 2c20 6d69 6e5f  .normalize, min_
+0000c3c0: 7069 7865 6c3d 6d69 6e5f 7069 782c 206d  pixel=min_pix, m
+0000c3d0: 6178 5f70 6978 656c 3d6d 6178 5f70 6978  ax_pixel=max_pix
+0000c3e0: 2c20 7661 6c5f 706f 7369 7469 7665 3d76  , val_positive=v
+0000c3f0: 616c 5f63 6c61 7373 5f31 2c20 7661 6c5f  al_class_1, val_
+0000c400: 6e65 6761 7469 7665 3d76 616c 5f63 6c61  negative=val_cla
+0000c410: 7373 5f32 2c20 0a20 2020 2020 2020 2020  ss_2, .         
+0000c420: 2020 2020 2020 2020 2020 2065 706f 6368             epoch
+0000c430: 733d 7365 6c66 2e74 7261 696e 5f65 706f  s=self.train_epo
+0000c440: 6368 732c 2062 6174 6368 5f73 697a 653d  chs, batch_size=
+0000c450: 6261 7463 685f 7369 7a65 2c20 6f70 7469  batch_size, opti
+0000c460: 6d69 7a65 723d 6f70 7469 6d69 7a65 722c  mizer=optimizer,
+0000c470: 206c 723d 6c72 2c20 6465 6361 793d 6465   lr=lr, decay=de
+0000c480: 6361 792c 206d 6f6d 656e 7475 6d3d 6d6f  cay, momentum=mo
+0000c490: 6d65 6e74 756d 2c20 6e65 7374 6572 6f76  mentum, nesterov
+0000c4a0: 3d6e 6573 7465 726f 762c 200a 2020 2020  =nesterov, .    
+0000c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4c0: 6265 7461 5f31 3d62 6574 615f 312c 2062  beta_1=beta_1, b
+0000c4d0: 6574 615f 323d 6265 7461 5f32 2c20 616d  eta_2=beta_2, am
+0000c4e0: 7367 7261 643d 616d 7367 7261 642c 2073  sgrad=amsgrad, s
+0000c4f0: 6d6f 7465 5f73 616d 706c 696e 673d 7365  mote_sampling=se
+0000c500: 6c66 2e73 6d6f 7465 5f73 616d 706c 696e  lf.smote_samplin
+0000c510: 672c 2065 6172 6c79 5f73 746f 705f 6361  g, early_stop_ca
+0000c520: 6c6c 6261 636b 3d63 616c 6c62 6163 6b73  llback=callbacks
+0000c530: 2c20 6368 6563 6b70 6f69 6e74 3d46 616c  , checkpoint=Fal
+0000c540: 7365 2c20 7665 7262 6f73 653d 7365 6c66  se, verbose=self
+0000c550: 2e76 6572 626f 7365 290a 2020 2020 2020  .verbose).      
+0000c560: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+0000c570: 636c 6620 3d3d 2027 7265 736e 6574 3138  clf == 'resnet18
+0000c580: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+0000c590: 2020 206d 6f64 656c 2c20 6869 7374 6f72     model, histor
+0000c5a0: 7920 3d20 636e 6e5f 6d6f 6465 6c2e 5265  y = cnn_model.Re
+0000c5b0: 736e 6574 3138 2863 6c61 7373 5f31 2c20  snet18(class_1, 
+0000c5c0: 636c 6173 735f 322c 2069 6d67 5f6e 756d  class_2, img_num
+0000c5d0: 5f63 6861 6e6e 656c 733d 7365 6c66 2e69  _channels=self.i
+0000c5e0: 6d67 5f6e 756d 5f63 6861 6e6e 656c 732c  mg_num_channels,
+0000c5f0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0000c600: 2020 2020 2020 6e6f 726d 616c 697a 653d        normalize=
+0000c610: 7365 6c66 2e6e 6f72 6d61 6c69 7a65 2c20  self.normalize, 
+0000c620: 6d69 6e5f 7069 7865 6c3d 6d69 6e5f 7069  min_pixel=min_pi
+0000c630: 782c 206d 6178 5f70 6978 656c 3d6d 6178  x, max_pixel=max
+0000c640: 5f70 6978 2c20 7661 6c5f 706f 7369 7469  _pix, val_positi
+0000c650: 7665 3d76 616c 5f63 6c61 7373 5f31 2c20  ve=val_class_1, 
+0000c660: 7661 6c5f 6e65 6761 7469 7665 3d76 616c  val_negative=val
+0000c670: 5f63 6c61 7373 5f32 2c20 0a20 2020 2020  _class_2, .     
+0000c680: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000c690: 706f 6368 733d 7365 6c66 2e74 7261 696e  pochs=self.train
+0000c6a0: 5f65 706f 6368 732c 2062 6174 6368 5f73  _epochs, batch_s
+0000c6b0: 697a 653d 6261 7463 685f 7369 7a65 2c20  ize=batch_size, 
+0000c6c0: 6f70 7469 6d69 7a65 723d 6f70 7469 6d69  optimizer=optimi
+0000c6d0: 7a65 722c 206c 723d 6c72 2c20 6465 6361  zer, lr=lr, deca
+0000c6e0: 793d 6465 6361 792c 206d 6f6d 656e 7475  y=decay, momentu
+0000c6f0: 6d3d 6d6f 6d65 6e74 756d 2c20 6e65 7374  m=momentum, nest
+0000c700: 6572 6f76 3d6e 6573 7465 726f 762c 200a  erov=nesterov, .
+0000c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c720: 2020 2020 6265 7461 5f31 3d62 6574 615f      beta_1=beta_
+0000c730: 312c 2062 6574 615f 323d 6265 7461 5f32  1, beta_2=beta_2
+0000c740: 2c20 616d 7367 7261 643d 616d 7367 7261  , amsgrad=amsgra
+0000c750: 642c 2073 6d6f 7465 5f73 616d 706c 696e  d, smote_samplin
+0000c760: 673d 7365 6c66 2e73 6d6f 7465 5f73 616d  g=self.smote_sam
+0000c770: 706c 696e 672c 2065 6172 6c79 5f73 746f  pling, early_sto
+0000c780: 705f 6361 6c6c 6261 636b 3d63 616c 6c62  p_callback=callb
+0000c790: 6163 6b73 2c20 6368 6563 6b70 6f69 6e74  acks, checkpoint
+0000c7a0: 3d46 616c 7365 2c20 7665 7262 6f73 653d  =False, verbose=
+0000c7b0: 7365 6c66 2e76 6572 626f 7365 290a 0a20  self.verbose).. 
+0000c7c0: 2020 2020 2020 2023 4966 2074 6865 2070         #If the p
+0000c7d0: 6174 6965 6e63 6520 6973 2072 6561 6368  atience is reach
+0000c7e0: 6564 202d 2d20 7265 7475 726e 2073 686f  ed -- return sho
+0000c7f0: 756c 6420 6265 2061 2076 616c 7565 2074  uld be a value t
+0000c800: 6861 7420 636f 6e74 6169 6e73 2069 6e66  hat contains inf
+0000c810: 6f72 6d61 7469 6f6e 2072 6567 6172 6469  ormation regardi
+0000c820: 6e67 2074 6865 206e 756d 206f 6620 636f  ng the num of co
+0000c830: 6d70 6c65 7465 6420 6570 6f63 6873 2c20  mpleted epochs, 
+0000c840: 6f74 6865 7277 6973 6520 6966 2072 6574  otherwise if ret
+0000c850: 7572 6e20 3020 6576 6572 7920 7469 6d65  urn 0 every time
+0000c860: 2074 6865 6e20 7468 6520 6f70 7469 6d69   then the optimi
+0000c870: 7a65 7220 6d61 7920 6765 7420 7374 7563  zer may get stuc
+0000c880: 6b23 0a20 2020 2020 2020 2069 6620 6c65  k#.        if le
+0000c890: 6e28 6869 7374 6f72 792e 6869 7374 6f72  n(history.histor
+0000c8a0: 795b 276c 6f73 7327 5d29 2021 3d20 7365  y['loss']) != se
+0000c8b0: 6c66 2e74 7261 696e 5f65 706f 6368 733a  lf.train_epochs:
+0000c8c0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0000c8d0: 6e74 2829 3b20 7072 696e 7428 2754 7261  nt(); print('Tra
+0000c8e0: 696e 696e 6720 7061 7469 656e 6365 2077  ining patience w
+0000c8f0: 6173 2072 6561 6368 6564 2e2e 2e27 293b  as reached...');
+0000c900: 2070 7269 6e74 2829 0a20 2020 2020 2020   print().       
+0000c910: 2020 2020 2072 6574 7572 6e20 286c 656e       return (len
+0000c920: 2868 6973 746f 7279 2e68 6973 746f 7279  (history.history
+0000c930: 5b27 6c6f 7373 275d 2920 2a20 302e 3030  ['loss']) * 0.00
+0000c940: 3129 202d 2039 3939 2e30 0a0a 2020 2020  1) - 999.0..    
+0000c950: 2020 2020 2349 6620 7468 6520 6f75 7470      #If the outp
+0000c960: 7574 2069 7320 6e61 6e0a 2020 2020 2020  ut is nan.      
+0000c970: 2020 6966 206e 702e 6973 6669 6e69 7465    if np.isfinite
+0000c980: 2868 6973 746f 7279 2e68 6973 746f 7279  (history.history
+0000c990: 5b27 6c6f 7373 275d 5b2d 315d 293a 0a20  ['loss'][-1]):. 
+0000c9a0: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0000c9b0: 732c 2068 6973 746f 7269 6573 203d 205b  s, histories = [
+0000c9c0: 5d2c 205b 5d0a 2020 2020 2020 2020 2020  ], [].          
+0000c9d0: 2020 6d6f 6465 6c73 2e61 7070 656e 6428    models.append(
+0000c9e0: 6d6f 6465 6c29 2c20 6869 7374 6f72 6965  model), historie
+0000c9f0: 732e 6170 7065 6e64 2868 6973 746f 7279  s.append(history
+0000ca00: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0000ca10: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000ca20: 7428 293b 2070 7269 6e74 2827 5472 6169  t(); print('Trai
+0000ca30: 6e69 6e67 2066 6169 6c65 6420 6475 6520  ning failed due 
+0000ca40: 746f 206e 756d 6572 6963 616c 2069 6e73  to numerical ins
+0000ca50: 7461 6269 6c69 7479 2c20 7265 7475 726e  tability, return
+0000ca60: 696e 6720 6e61 6e2e 2e2e 2729 0a20 2020  ing nan...').   
+0000ca70: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000ca80: 6e70 2e6e 616e 200a 0a20 2020 2020 2020  np.nan ..       
+0000ca90: 2023 2323 2323 2043 726f 7373 2d56 616c   ##### Cross-Val
+0000caa0: 6964 6174 696f 6e20 526f 7574 696e 6520  idation Routine 
+0000cab0: 2d20 696d 706c 656d 656e 7461 7469 6f6e  - implementation
+0000cac0: 2069 6e20 7768 6963 6820 7468 6520 7661   in which the va
+0000cad0: 6c69 6461 7469 6f6e 2064 6174 6120 6973  lidation data is
+0000cae0: 2069 6e73 6572 7465 6420 696e 746f 2074   inserted into t
+0000caf0: 6865 2074 7261 696e 696e 6720 6461 7461  he training data
+0000cb00: 2077 6974 6820 7468 6520 7265 706c 6163   with the replac
+0000cb10: 656d 656e 7420 7365 7276 696e 6720 6173  ement serving as
+0000cb20: 2074 6865 206e 6577 2076 616c 6964 6174   the new validat
+0000cb30: 696f 6e23 2323 2323 0a20 2020 2020 2020  ion#####.       
+0000cb40: 2069 6620 7365 6c66 2e6f 7074 5f63 7620   if self.opt_cv 
+0000cb50: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000cb60: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000cb70: 2e76 616c 5f70 6f73 6974 6976 6520 6973  .val_positive is
+0000cb80: 204e 6f6e 6520 616e 6420 7365 6c66 2e76   None and self.v
+0000cb90: 616c 5f6e 6567 6174 6976 6520 6973 206e  al_negative is n
+0000cba0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0000cbb0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0000cbc0: 616c 7565 4572 726f 7228 2743 4e4e 2063  alueError('CNN c
+0000cbd0: 726f 7373 2d76 616c 6964 6174 696f 6e20  ross-validation 
+0000cbe0: 6973 2063 7572 7265 6e74 6c79 2073 7570  is currently sup
+0000cbf0: 706f 7274 6564 206f 6e6c 7920 6966 2076  ported only if v
+0000cc00: 616c 6964 6174 696f 6e20 6461 7461 2069  alidation data i
+0000cc10: 7320 696e 7075 742e 2729 0a20 2020 2020  s input.').     
+0000cc20: 2020 2020 2020 2069 6620 7365 6c66 2e76         if self.v
+0000cc30: 616c 5f70 6f73 6974 6976 6520 6973 206e  al_positive is n
+0000cc40: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0000cc50: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0000cc60: 7365 6c66 2e70 6f73 6974 6976 655f 636c  self.positive_cl
+0000cc70: 6173 7329 202f 206c 656e 2873 656c 662e  ass) / len(self.
+0000cc80: 7661 6c5f 706f 7369 7469 7665 2920 3c20  val_positive) < 
+0000cc90: 7365 6c66 2e6f 7074 5f63 762d 313a 0a20  self.opt_cv-1:. 
+0000cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ccb0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000ccc0: 726f 7228 2743 616e 6e6f 7420 6576 656e  ror('Cannot even
+0000ccd0: 6c79 2070 6172 7469 7469 6f6e 2074 6865  ly partition the
+0000cce0: 2074 7261 696e 696e 672f 7661 6c69 6461   training/valida
+0000ccf0: 7469 6f6e 2064 6174 612c 2072 6566 6572  tion data, refer
+0000cd00: 2074 6f20 7468 6520 4d69 6372 6f4c 4941   to the MicroLIA
+0000cd10: 2041 5049 2064 6f63 756d 656e 7461 7469   API documentati
+0000cd20: 6f6e 2066 6f72 2069 6e73 7472 7563 7469  on for instructi
+0000cd30: 6f6e 7320 6f6e 2068 6f77 2074 6f20 7573  ons on how to us
+0000cd40: 6520 7468 6520 6f70 745f 6376 2070 6172  e the opt_cv par
+0000cd50: 616d 6574 6572 2e27 290a 2020 2020 2020  ameter.').      
+0000cd60: 2020 2020 2020 6966 2073 656c 662e 7661        if self.va
+0000cd70: 6c5f 6e65 6761 7469 7665 2069 7320 6e6f  l_negative is no
+0000cd80: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0000cd90: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+0000cda0: 656c 662e 6e65 6761 7469 7665 5f63 6c61  elf.negative_cla
+0000cdb0: 7373 2920 2f20 6c65 6e28 7365 6c66 2e76  ss) / len(self.v
+0000cdc0: 616c 5f6e 6567 6174 6976 6529 203c 2073  al_negative) < s
+0000cdd0: 656c 662e 6f70 745f 6376 2d31 3a0a 2020  elf.opt_cv-1:.  
+0000cde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cdf0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000ce00: 6f72 2827 4361 6e6e 6f74 2065 7665 6e6c  or('Cannot evenl
+0000ce10: 7920 7061 7274 6974 696f 6e20 7468 6520  y partition the 
+0000ce20: 7472 6169 6e69 6e67 2f76 616c 6964 6174  training/validat
+0000ce30: 696f 6e20 6461 7461 2c20 7265 6665 7220  ion data, refer 
+0000ce40: 746f 2074 6865 204d 6963 726f 4c49 4120  to the MicroLIA 
+0000ce50: 4150 4920 646f 6375 6d65 6e74 6174 696f  API documentatio
+0000ce60: 6e20 666f 7220 696e 7374 7275 6374 696f  n for instructio
+0000ce70: 6e73 206f 6e20 686f 7720 746f 2075 7365  ns on how to use
+0000ce80: 2074 6865 206f 7074 5f63 7620 7061 7261   the opt_cv para
+0000ce90: 6d65 7465 722e 2729 0a20 2020 2020 2020  meter.').       
+0000cea0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0000ceb0: 2020 2354 6865 2066 6972 7374 206d 6f64    #The first mod
+0000cec0: 656c 2061 6c72 6561 6479 2072 616e 2074  el already ran t
+0000ced0: 6865 7265 666f 7265 2073 7574 6272 6163  herefore sutbrac
+0000cee0: 7420 3120 2020 2020 200a 2020 2020 2020  t 1      .      
+0000cef0: 2020 2020 2020 666f 7220 6b20 696e 2072        for k in r
+0000cf00: 616e 6765 2873 656c 662e 6f70 745f 6376  ange(self.opt_cv
+0000cf10: 2d31 293a 2020 2020 2020 2020 2020 0a20  -1):          . 
+0000cf20: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000cf30: 4d61 6b65 2064 6565 7020 636f 7069 6573  Make deep copies
+0000cf40: 2074 6f20 6176 6f69 6420 6f76 6572 7772   to avoid overwr
+0000cf50: 6974 696e 6720 6172 7261 7973 0a20 2020  iting arrays.   
+0000cf60: 2020 2020 2020 2020 2020 2020 2063 6c61               cla
+0000cf70: 7373 5f31 2c20 636c 6173 735f 3220 3d20  ss_1, class_2 = 
+0000cf80: 636f 7079 2e64 6565 7063 6f70 7928 7365  copy.deepcopy(se
+0000cf90: 6c66 2e70 6f73 6974 6976 655f 636c 6173  lf.positive_clas
+0000cfa0: 7329 2c20 636f 7079 2e64 6565 7063 6f70  s), copy.deepcop
+0000cfb0: 7928 7365 6c66 2e6e 6567 6174 6976 655f  y(self.negative_
+0000cfc0: 636c 6173 7329 0a20 2020 2020 2020 2020  class).         
+0000cfd0: 2020 2020 2020 2076 616c 5f63 6c61 7373         val_class
+0000cfe0: 5f31 2c20 7661 6c5f 636c 6173 735f 3220  _1, val_class_2 
+0000cff0: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
+0000d000: 7365 6c66 2e76 616c 5f70 6f73 6974 6976  self.val_positiv
+0000d010: 6529 2c20 636f 7079 2e64 6565 7063 6f70  e), copy.deepcop
+0000d020: 7928 7365 6c66 2e76 616c 5f6e 6567 6174  y(self.val_negat
+0000d030: 6976 6529 0a0a 2020 2020 2020 2020 2020  ive)..          
+0000d040: 2020 2020 2020 2353 6f72 7420 7468 6520        #Sort the 
+0000d050: 6e65 7720 6461 7461 2073 616d 706c 6573  new data samples
+0000d060: 2c20 6e6f 2072 616e 646f 6d20 7368 7566  , no random shuf
+0000d070: 666c 696e 672c 206a 7573 7420 6120 6c69  fling, just a li
+0000d080: 6e65 6172 2073 6571 7565 6e63 650a 2020  near sequence.  
+0000d090: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000d0a0: 2076 616c 5f63 6c61 7373 5f31 2069 7320   val_class_1 is 
+0000d0b0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0000d0c0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0000d0d0: 6c5f 686f 6c64 5f31 203d 2063 6f70 792e  l_hold_1 = copy.
+0000d0e0: 6465 6570 636f 7079 2863 6c61 7373 5f31  deepcopy(class_1
+0000d0f0: 5b6b 2a6c 656e 2876 616c 5f63 6c61 7373  [k*len(val_class
+0000d100: 5f31 293a 6c65 6e28 7661 6c5f 636c 6173  _1):len(val_clas
+0000d110: 735f 3129 2a28 6b2b 3129 5d29 2023 5468  s_1)*(k+1)]) #Th
+0000d120: 6520 6e65 7720 7661 6c69 6461 7469 6f6e  e new validation
+0000d130: 2064 6174 610a 2020 2020 2020 2020 2020   data.          
+0000d140: 2020 2020 2020 2020 2020 636c 6173 735f            class_
+0000d150: 315b 6b2a 6c65 6e28 7661 6c5f 636c 6173  1[k*len(val_clas
+0000d160: 735f 3129 3a6c 656e 2876 616c 5f63 6c61  s_1):len(val_cla
+0000d170: 7373 5f31 292a 286b 2b31 295d 203d 2063  ss_1)*(k+1)] = c
+0000d180: 6f70 792e 6465 6570 636f 7079 2876 616c  opy.deepcopy(val
+0000d190: 5f63 6c61 7373 5f31 290a 2020 2020 2020  _class_1).      
+0000d1a0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0000d1b0: 6c5f 636c 6173 735f 3120 3d20 7661 6c5f  l_class_1 = val_
+0000d1c0: 686f 6c64 5f31 2023 5468 6520 6e65 7720  hold_1 #The new 
+0000d1d0: 7661 6c69 6461 7469 6f6e 2064 6174 610a  validation data.
+0000d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1f0: 6966 2076 616c 5f63 6c61 7373 5f32 2069  if val_class_2 i
+0000d200: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d220: 7661 6c5f 686f 6c64 5f32 203d 2063 6f70  val_hold_2 = cop
+0000d230: 792e 6465 6570 636f 7079 2863 6c61 7373  y.deepcopy(class
+0000d240: 5f32 5b6b 2a6c 656e 2876 616c 5f63 6c61  _2[k*len(val_cla
+0000d250: 7373 5f32 293a 6c65 6e28 7661 6c5f 636c  ss_2):len(val_cl
+0000d260: 6173 735f 3229 2a28 6b2b 3129 5d29 2023  ass_2)*(k+1)]) #
+0000d270: 5468 6520 6e65 7720 7661 6c69 6461 7469  The new validati
+0000d280: 6f6e 2064 6174 610a 2020 2020 2020 2020  on data.        
+0000d290: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+0000d2a0: 735f 325b 6b2a 6c65 6e28 7661 6c5f 636c  s_2[k*len(val_cl
+0000d2b0: 6173 735f 3229 3a6c 656e 2876 616c 5f63  ass_2):len(val_c
+0000d2c0: 6c61 7373 5f32 292a 286b 2b31 295d 203d  lass_2)*(k+1)] =
+0000d2d0: 2063 6f70 792e 6465 6570 636f 7079 2876   copy.deepcopy(v
+0000d2e0: 616c 5f63 6c61 7373 5f32 290a 2020 2020  al_class_2).    
+0000d2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d300: 7661 6c5f 636c 6173 735f 3220 3d20 7661  val_class_2 = va
+0000d310: 6c5f 686f 6c64 5f32 2023 5468 6520 6e65  l_hold_2 #The ne
+0000d320: 7720 7661 6c69 6461 7469 6f6e 2064 6174  w validation dat
+0000d330: 610a 0a20 2020 2020 2020 2020 2020 2020  a..             
+0000d340: 2020 2069 6620 7365 6c66 2e6f 7074 5f61     if self.opt_a
+0000d350: 7567 3a0a 2020 2020 2020 2020 2020 2020  ug:.            
+0000d360: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000d370: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+0000d380: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+0000d390: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000d3a0: 6861 6e6e 656c 312c 2063 6861 6e6e 656c  hannel1, channel
+0000d3b0: 322c 2063 6861 6e6e 656c 3320 3d20 636f  2, channel3 = co
+0000d3c0: 7079 2e64 6565 7063 6f70 7928 636c 6173  py.deepcopy(clas
+0000d3d0: 735f 3129 2c20 4e6f 6e65 2c20 4e6f 6e65  s_1), None, None
+0000d3e0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0000d3f0: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+0000d400: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+0000d410: 203d 3d20 323a 0a20 2020 2020 2020 2020   == 2:.         
+0000d420: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000d430: 6861 6e6e 656c 312c 2063 6861 6e6e 656c  hannel1, channel
+0000d440: 322c 2063 6861 6e6e 656c 3320 3d20 636f  2, channel3 = co
+0000d450: 7079 2e64 6565 7063 6f70 7928 636c 6173  py.deepcopy(clas
+0000d460: 735f 315b 3a2c 3a2c 3a2c 305d 292c 2063  s_1[:,:,:,0]), c
+0000d470: 6f70 792e 6465 6570 636f 7079 2863 6c61  opy.deepcopy(cla
+0000d480: 7373 5f31 5b3a 2c3a 2c3a 2c31 5d29 2c20  ss_1[:,:,:,1]), 
+0000d490: 4e6f 6e65 200a 2020 2020 2020 2020 2020  None .          
+0000d4a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4c0: 2020 2020 2020 2020 6368 616e 6e65 6c31          channel1
+0000d4d0: 2c20 6368 616e 6e65 6c32 2c20 6368 616e  , channel2, chan
+0000d4e0: 6e65 6c33 203d 2063 6f70 792e 6465 6570  nel3 = copy.deep
+0000d4f0: 636f 7079 2863 6c61 7373 5f31 5b3a 2c3a  copy(class_1[:,:
+0000d500: 2c3a 2c30 5d29 2c20 636f 7079 2e64 6565  ,:,0]), copy.dee
+0000d510: 7063 6f70 7928 636c 6173 735f 315b 3a2c  pcopy(class_1[:,
+0000d520: 3a2c 3a2c 315d 292c 2063 6f70 792e 6465  :,:,1]), copy.de
+0000d530: 6570 636f 7079 2863 6c61 7373 5f31 5b3a  epcopy(class_1[:
+0000d540: 2c3a 2c3a 2c32 5d29 0a0a 2020 2020 2020  ,:,:,2])..      
+0000d550: 2020 2020 2020 2020 2020 2020 2020 6175                au
+0000d560: 676d 656e 7465 645f 696d 6167 6573 203d  gmented_images =
+0000d570: 2061 7567 6d65 6e74 6174 696f 6e28 6368   augmentation(ch
+0000d580: 616e 6e65 6c31 3d63 6861 6e6e 656c 312c  annel1=channel1,
+0000d590: 2063 6861 6e6e 656c 323d 6368 616e 6e65   channel2=channe
+0000d5a0: 6c32 2c20 6368 616e 6e65 6c33 3d63 6861  l2, channel3=cha
+0000d5b0: 6e6e 656c 332c 2062 6174 6368 3d6e 756d  nnel3, batch=num
+0000d5c0: 5f61 7567 2c20 0a20 2020 2020 2020 2020  _aug, .         
+0000d5d0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000d5e0: 6964 7468 5f73 6869 6674 3d73 656c 662e  idth_shift=self.
+0000d5f0: 7368 6966 742c 2068 6569 6768 745f 7368  shift, height_sh
+0000d600: 6966 743d 7365 6c66 2e73 6869 6674 2c20  ift=self.shift, 
+0000d610: 686f 7269 7a6f 6e74 616c 3d68 6f72 697a  horizontal=horiz
+0000d620: 6f6e 7461 6c2c 2076 6572 7469 6361 6c3d  ontal, vertical=
+0000d630: 7665 7274 6963 616c 2c20 726f 7461 7469  vertical, rotati
+0000d640: 6f6e 3d72 6f74 6174 696f 6e2c 200a 2020  on=rotation, .  
+0000d650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d660: 2020 2020 2020 696d 6167 655f 7369 7a65        image_size
+0000d670: 3d69 6d61 6765 5f73 697a 652c 206d 6173  =image_size, mas
+0000d680: 6b5f 7369 7a65 3d73 656c 662e 6d61 736b  k_size=self.mask
+0000d690: 5f73 697a 652c 206e 756d 5f6d 6173 6b73  _size, num_masks
+0000d6a0: 3d73 656c 662e 6e75 6d5f 6d61 736b 732c  =self.num_masks,
+0000d6b0: 2062 6c65 6e64 5f6d 756c 7469 706c 6965   blend_multiplie
+0000d6c0: 723d 626c 656e 645f 6d75 6c74 6970 6c69  r=blend_multipli
+0000d6d0: 6572 2c20 0a20 2020 2020 2020 2020 2020  er, .           
+0000d6e0: 2020 2020 2020 2020 2020 2020 2062 6c65               ble
+0000d6f0: 6e64 696e 675f 6675 6e63 3d73 656c 662e  nding_func=self.
+0000d700: 626c 656e 6469 6e67 5f66 756e 632c 206e  blending_func, n
+0000d710: 756d 5f69 6d61 6765 735f 746f 5f62 6c65  um_images_to_ble
+0000d720: 6e64 3d73 656c 662e 6e75 6d5f 696d 6167  nd=self.num_imag
+0000d730: 6573 5f74 6f5f 626c 656e 642c 207a 6f6f  es_to_blend, zoo
+0000d740: 6d5f 7261 6e67 653d 7365 6c66 2e7a 6f6f  m_range=self.zoo
+0000d750: 6d5f 7261 6e67 652c 2073 6b65 775f 616e  m_range, skew_an
+0000d760: 676c 653d 736b 6577 5f61 6e67 6c65 290a  gle=skew_angle).
+0000d770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d780: 2020 2020 2069 6620 7365 6c66 2e69 6d67       if self.img
+0000d790: 5f6e 756d 5f63 6861 6e6e 656c 7320 3e20  _num_channels > 
+0000d7a0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+0000d7b0: 2020 2020 2020 2020 2020 2063 6c61 7373             class
+0000d7c0: 5f31 3d5b 5d0a 2020 2020 2020 2020 2020  _1=[].          
+0000d7d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000d7e0: 2073 656c 662e 696d 675f 6e75 6d5f 6368   self.img_num_ch
+0000d7f0: 616e 6e65 6c73 203d 3d20 323a 0a20 2020  annels == 2:.   
+0000d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d810: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+0000d820: 6e20 7261 6e67 6528 6c65 6e28 6175 676d  n range(len(augm
+0000d830: 656e 7465 645f 696d 6167 6573 5b30 5d29  ented_images[0])
+0000d840: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
 0000d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d860: 2020 2063 6c66 203d 2058 4742 436c 6173     clf = XGBClas
-0000d870: 7369 6669 6572 2862 6f6f 7374 6572 3d70  sifier(booster=p
-0000d880: 6172 616d 735b 2762 6f6f 7374 6572 275d  arams['booster']
-0000d890: 2c20 6e5f 6573 7469 6d61 746f 7273 3d70  , n_estimators=p
-0000d8a0: 6172 616d 735b 276e 5f65 7374 696d 6174  arams['n_estimat
-0000d8b0: 6f72 7327 5d2c 2072 6567 5f6c 616d 6264  ors'], reg_lambd
-0000d8c0: 613d 7061 7261 6d73 5b27 7265 675f 6c61  a=params['reg_la
-0000d8d0: 6d62 6461 275d 2c20 0a20 2020 2020 2020  mbda'], .       
-0000d8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d8f0: 2072 6567 5f61 6c70 6861 3d70 6172 616d   reg_alpha=param
-0000d900: 735b 2772 6567 5f61 6c70 6861 275d 2c20  s['reg_alpha'], 
-0000d910: 6d61 785f 6465 7074 683d 7061 7261 6d73  max_depth=params
-0000d920: 5b27 6d61 785f 6465 7074 6827 5d2c 2065  ['max_depth'], e
-0000d930: 7461 3d70 6172 616d 735b 2765 7461 275d  ta=params['eta']
-0000d940: 2c20 6761 6d6d 613d 7061 7261 6d73 5b27  , gamma=params['
-0000d950: 6761 6d6d 6127 5d2c 200a 2020 2020 2020  gamma'], .      
-0000d960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d970: 2020 6772 6f77 5f70 6f6c 6963 793d 7061    grow_policy=pa
-0000d980: 7261 6d73 5b27 6772 6f77 5f70 6f6c 6963  rams['grow_polic
-0000d990: 7927 5d2c 2073 7562 7361 6d70 6c65 3d70  y'], subsample=p
-0000d9a0: 6172 616d 735b 2773 7562 7361 6d70 6c65  arams['subsample
-0000d9b0: 275d 2c20 7261 6e64 6f6d 5f73 7461 7465  '], random_state
-0000d9c0: 3d31 3930 3929 232c 2074 7265 655f 6d65  =1909)#, tree_me
-0000d9d0: 7468 6f64 3d27 6869 7374 2729 0a0a 2020  thod='hist')..  
-0000d9e0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000d9f0: 662e 7465 7374 5f73 697a 6520 6973 206e  f.test_size is n
-0000da00: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000da10: 2020 2020 2020 2020 2062 7374 203d 2074           bst = t
-0000da20: 7261 696e 2870 6172 616d 732c 2064 7472  rain(params, dtr
-0000da30: 6169 6e2c 2065 7661 6c73 3d5b 2864 7661  ain, evals=[(dva
-0000da40: 6c69 642c 2022 7661 6c69 6461 7469 6f6e  lid, "validation
-0000da50: 2229 5d2c 2063 616c 6c62 6163 6b73 3d5b  ")], callbacks=[
-0000da60: 7072 756e 696e 675f 6361 6c6c 6261 636b  pruning_callback
-0000da70: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0000da80: 2020 2070 7265 6473 203d 2062 7374 2e70     preds = bst.p
-0000da90: 7265 6469 6374 2864 7661 6c69 6429 0a20  redict(dvalid). 
-0000daa0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000dab0: 7265 645f 6c61 6265 6c73 203d 206e 702e  red_labels = np.
-0000dac0: 7269 6e74 2870 7265 6473 290a 2020 2020  rint(preds).    
-0000dad0: 2020 2020 2020 2020 2020 2020 6163 6375              accu
-0000dae0: 7261 6379 203d 2061 6363 7572 6163 795f  racy = accuracy_
-0000daf0: 7363 6f72 6528 7661 6c69 645f 792c 2070  score(valid_y, p
-0000db00: 7265 645f 6c61 6265 6c73 290a 2020 2020  red_labels).    
-0000db10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000db20: 2020 2020 2020 2020 2020 2020 2020 2346                #F
-0000db30: 524f 4d20 534b 4c45 4152 4e20 444f 4355  ROM SKLEARN DOCU
-0000db40: 4d45 4e54 4154 494f 4e3a 2046 6f72 2069  MENTATION: For i
-0000db50: 6e74 2f4e 6f6e 6520 696e 7075 7473 2c20  nt/None inputs, 
-0000db60: 6966 2074 6865 2065 7374 696d 6174 6f72  if the estimator
-0000db70: 2069 7320 6120 636c 6173 7369 6669 6572   is a classifier
-0000db80: 2061 6e64 2079 2069 7320 6569 7468 6572   and y is either
-0000db90: 2062 696e 6172 7920 6f72 206d 756c 7469   binary or multi
-0000dba0: 636c 6173 732c 2053 7472 6174 6966 6965  class, Stratifie
-0000dbb0: 644b 466f 6c64 2069 7320 7573 6564 2e20  dKFold is used. 
-0000dbc0: 496e 2061 6c6c 206f 7468 6572 2063 6173  In all other cas
-0000dbd0: 6573 2c20 466f 6c64 2069 7320 7573 6564  es, Fold is used
-0000dbe0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000dbf0: 2020 6376 203d 2063 726f 7373 5f76 616c    cv = cross_val
-0000dc00: 6964 6174 6528 636c 662c 2073 656c 662e  idate(clf, self.
-0000dc10: 6461 7461 5f78 2c20 7365 6c66 2e64 6174  data_x, self.dat
-0000dc20: 615f 792c 2063 763d 7365 6c66 2e6f 7074  a_y, cv=self.opt
-0000dc30: 5f63 7629 200a 2020 2020 2020 2020 2020  _cv) .          
-0000dc40: 2020 2020 2020 6163 6375 7261 6379 203d        accuracy =
-0000dc50: 206e 702e 6d65 616e 2863 765b 2774 6573   np.mean(cv['tes
-0000dc60: 745f 7363 6f72 6527 5d29 0a0a 2020 2020  t_score'])..    
-0000dc70: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-0000dc80: 6363 7572 6163 790a 0a20 2020 2020 2020  ccuracy..       
-0000dc90: 2070 6172 616d 735b 2762 6f6f 7374 6572   params['booster
-0000dca0: 275d 203d 2074 7269 616c 2e73 7567 6765  '] = trial.sugge
-0000dcb0: 7374 5f63 6174 6567 6f72 6963 616c 2827  st_categorical('
-0000dcc0: 626f 6f73 7465 7227 2c20 5b27 6762 7472  booster', ['gbtr
-0000dcd0: 6565 272c 2027 6461 7274 275d 290a 2020  ee', 'dart']).  
-0000dce0: 2020 2020 2020 7061 7261 6d73 5b27 6e5f        params['n_
-0000dcf0: 6573 7469 6d61 746f 7273 275d 203d 2074  estimators'] = t
-0000dd00: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
-0000dd10: 2827 6e5f 6573 7469 6d61 746f 7273 272c  ('n_estimators',
-0000dd20: 2031 3030 2c20 3530 3029 0a20 2020 2020   100, 500).     
-0000dd30: 2020 2070 6172 616d 735b 2772 6567 5f6c     params['reg_l
-0000dd40: 616d 6264 6127 5d20 3d20 7472 6961 6c2e  ambda'] = trial.
-0000dd50: 7375 6767 6573 745f 666c 6f61 7428 2772  suggest_float('r
-0000dd60: 6567 5f6c 616d 6264 6127 2c20 302c 2031  eg_lambda', 0, 1
-0000dd70: 3030 290a 2020 2020 2020 2020 7061 7261  00).        para
-0000dd80: 6d73 5b27 7265 675f 616c 7068 6127 5d20  ms['reg_alpha'] 
-0000dd90: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
-0000dda0: 696e 7428 2772 6567 5f61 6c70 6861 272c  int('reg_alpha',
-0000ddb0: 2030 2c20 3130 3029 0a20 2020 2020 2020   0, 100).       
-0000ddc0: 2070 6172 616d 735b 276d 6178 5f64 6570   params['max_dep
-0000ddd0: 7468 275d 203d 2074 7269 616c 2e73 7567  th'] = trial.sug
-0000dde0: 6765 7374 5f69 6e74 2827 6d61 785f 6465  gest_int('max_de
-0000ddf0: 7074 6827 2c20 322c 2032 3529 0a20 2020  pth', 2, 25).   
-0000de00: 2020 2020 2070 6172 616d 735b 2765 7461       params['eta
-0000de10: 275d 203d 2074 7269 616c 2e73 7567 6765  '] = trial.sugge
-0000de20: 7374 5f66 6c6f 6174 2827 6574 6127 2c20  st_float('eta', 
-0000de30: 3165 2d38 2c20 3129 0a20 2020 2020 2020  1e-8, 1).       
-0000de40: 2070 6172 616d 735b 2767 616d 6d61 275d   params['gamma']
-0000de50: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
-0000de60: 5f69 6e74 2827 6761 6d6d 6127 2c20 312c  _int('gamma', 1,
-0000de70: 2031 3030 290a 2020 2020 2020 2020 7061   100).        pa
-0000de80: 7261 6d73 5b27 6772 6f77 5f70 6f6c 6963  rams['grow_polic
-0000de90: 7927 5d20 3d20 7472 6961 6c2e 7375 6767  y'] = trial.sugg
-0000dea0: 6573 745f 6361 7465 676f 7269 6361 6c28  est_categorical(
-0000deb0: 2767 726f 775f 706f 6c69 6379 272c 205b  'grow_policy', [
-0000dec0: 2764 6570 7468 7769 7365 272c 2027 6c6f  'depthwise', 'lo
-0000ded0: 7373 6775 6964 6527 5d29 0a20 2020 2020  ssguide']).     
-0000dee0: 2020 2070 6172 616d 735b 276d 696e 5f63     params['min_c
-0000def0: 6869 6c64 5f77 6569 6768 7427 5d20 3d20  hild_weight'] = 
-0000df00: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
-0000df10: 7428 276d 696e 5f63 6869 6c64 5f77 6569  t('min_child_wei
-0000df20: 6768 7427 2c20 312c 2031 3030 290a 2020  ght', 1, 100).  
-0000df30: 2020 2020 2020 7061 7261 6d73 5b27 6d61        params['ma
-0000df40: 785f 6465 6c74 615f 7374 6570 275d 203d  x_delta_step'] =
-0000df50: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
-0000df60: 6e74 2827 6d61 785f 6465 6c74 615f 7374  nt('max_delta_st
-0000df70: 6570 272c 2031 2c20 3130 3029 0a20 2020  ep', 1, 100).   
-0000df80: 2020 2020 2070 6172 616d 735b 2773 7562       params['sub
-0000df90: 7361 6d70 6c65 275d 203d 2074 7269 616c  sample'] = trial
-0000dfa0: 2e73 7567 6765 7374 5f66 6c6f 6174 2827  .suggest_float('
-0000dfb0: 7375 6273 616d 706c 6527 2c20 302e 352c  subsample', 0.5,
-0000dfc0: 2031 2e30 290a 2020 2020 2020 2020 7061   1.0).        pa
-0000dfd0: 7261 6d73 5b27 636f 6c73 616d 706c 655f  rams['colsample_
-0000dfe0: 6279 7472 6565 275d 203d 2074 7269 616c  bytree'] = trial
-0000dff0: 2e73 7567 6765 7374 5f66 6c6f 6174 2827  .suggest_float('
-0000e000: 636f 6c73 616d 706c 655f 6279 7472 6565  colsample_bytree
-0000e010: 272c 2030 2e35 2c20 3129 0a0a 2020 2020  ', 0.5, 1)..    
-0000e020: 2020 2020 6966 2070 6172 616d 735b 2762      if params['b
-0000e030: 6f6f 7374 6572 275d 203d 3d20 2264 6172  ooster'] == "dar
-0000e040: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
-0000e050: 7061 7261 6d73 5b27 7361 6d70 6c65 5f74  params['sample_t
-0000e060: 7970 6527 5d20 3d20 7472 6961 6c2e 7375  ype'] = trial.su
-0000e070: 6767 6573 745f 6361 7465 676f 7269 6361  ggest_categorica
-0000e080: 6c28 2773 616d 706c 655f 7479 7065 272c  l('sample_type',
-0000e090: 205b 2775 6e69 666f 726d 272c 2027 7765   ['uniform', 'we
-0000e0a0: 6967 6874 6564 275d 290a 2020 2020 2020  ighted']).      
-0000e0b0: 2020 2020 2020 7061 7261 6d73 5b27 6e6f        params['no
-0000e0c0: 726d 616c 697a 655f 7479 7065 275d 203d  rmalize_type'] =
-0000e0d0: 2074 7269 616c 2e73 7567 6765 7374 5f63   trial.suggest_c
-0000e0e0: 6174 6567 6f72 6963 616c 2827 6e6f 726d  ategorical('norm
-0000e0f0: 616c 697a 655f 7479 7065 272c 205b 2774  alize_type', ['t
-0000e100: 7265 6527 2c20 2766 6f72 6573 7427 5d29  ree', 'forest'])
-0000e110: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-0000e120: 616d 735b 2772 6174 655f 6472 6f70 275d  ams['rate_drop']
-0000e130: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
-0000e140: 5f66 6c6f 6174 2827 7261 7465 5f64 726f  _float('rate_dro
-0000e150: 7027 2c20 3165 2d38 2c20 3129 0a20 2020  p', 1e-8, 1).   
-0000e160: 2020 2020 2020 2020 2070 6172 616d 735b           params[
-0000e170: 2773 6b69 705f 6472 6f70 275d 203d 2074  'skip_drop'] = t
-0000e180: 7269 616c 2e73 7567 6765 7374 5f66 6c6f  rial.suggest_flo
-0000e190: 6174 2827 736b 6970 5f64 726f 7027 2c20  at('skip_drop', 
-0000e1a0: 3165 2d38 2c20 3129 0a20 2020 2020 2020  1e-8, 1).       
-0000e1b0: 2020 2020 2069 6620 7365 6c66 2e74 6573       if self.tes
-0000e1c0: 745f 7369 7a65 2069 7320 4e6f 6e65 3a0a  t_size is None:.
-0000e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1e0: 636c 6620 3d20 5847 4243 6c61 7373 6966  clf = XGBClassif
-0000e1f0: 6965 7228 626f 6f73 7465 723d 7061 7261  ier(booster=para
-0000e200: 6d73 5b27 626f 6f73 7465 7227 5d2c 206e  ms['booster'], n
-0000e210: 5f65 7374 696d 6174 6f72 733d 7061 7261  _estimators=para
-0000e220: 6d73 5b27 6e5f 6573 7469 6d61 746f 7273  ms['n_estimators
-0000e230: 275d 2c20 636f 6c73 616d 706c 655f 6279  '], colsample_by
-0000e240: 7472 6565 3d70 6172 616d 735b 2763 6f6c  tree=params['col
-0000e250: 7361 6d70 6c65 5f62 7974 7265 6527 5d2c  sample_bytree'],
-0000e260: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0000e270: 2020 2020 2020 7265 675f 6c61 6d62 6461        reg_lambda
-0000e280: 3d70 6172 616d 735b 2772 6567 5f6c 616d  =params['reg_lam
-0000e290: 6264 6127 5d2c 2072 6567 5f61 6c70 6861  bda'], reg_alpha
-0000e2a0: 3d70 6172 616d 735b 2772 6567 5f61 6c70  =params['reg_alp
-0000e2b0: 6861 275d 2c20 6d61 785f 6465 7074 683d  ha'], max_depth=
-0000e2c0: 7061 7261 6d73 5b27 6d61 785f 6465 7074  params['max_dept
-0000e2d0: 6827 5d2c 2065 7461 3d70 6172 616d 735b  h'], eta=params[
-0000e2e0: 2765 7461 275d 2c20 0a20 2020 2020 2020  'eta'], .       
-0000e2f0: 2020 2020 2020 2020 2020 2020 2067 616d               gam
-0000e300: 6d61 3d70 6172 616d 735b 2767 616d 6d61  ma=params['gamma
-0000e310: 275d 2c20 6772 6f77 5f70 6f6c 6963 793d  '], grow_policy=
-0000e320: 7061 7261 6d73 5b27 6772 6f77 5f70 6f6c  params['grow_pol
-0000e330: 6963 7927 5d2c 206d 696e 5f63 6869 6c64  icy'], min_child
-0000e340: 5f77 6569 6768 743d 7061 7261 6d73 5b27  _weight=params['
-0000e350: 6d69 6e5f 6368 696c 645f 7765 6967 6874  min_child_weight
-0000e360: 275d 2c20 0a20 2020 2020 2020 2020 2020  '], .           
-0000e370: 2020 2020 2020 2020 206d 6178 5f64 656c           max_del
-0000e380: 7461 5f73 7465 703d 7061 7261 6d73 5b27  ta_step=params['
-0000e390: 6d61 785f 6465 6c74 615f 7374 6570 275d  max_delta_step']
-0000e3a0: 2c20 7375 6273 616d 706c 653d 7061 7261  , subsample=para
-0000e3b0: 6d73 5b27 7375 6273 616d 706c 6527 5d2c  ms['subsample'],
-0000e3c0: 2073 616d 706c 655f 7479 7065 3d70 6172   sample_type=par
-0000e3d0: 616d 735b 2773 616d 706c 655f 7479 7065  ams['sample_type
-0000e3e0: 275d 2c20 0a20 2020 2020 2020 2020 2020  '], .           
-0000e3f0: 2020 2020 2020 2020 206e 6f72 6d61 6c69           normali
-0000e400: 7a65 5f74 7970 653d 7061 7261 6d73 5b27  ze_type=params['
-0000e410: 6e6f 726d 616c 697a 655f 7479 7065 275d  normalize_type']
-0000e420: 2c20 7261 7465 5f64 726f 703d 7061 7261  , rate_drop=para
-0000e430: 6d73 5b27 7261 7465 5f64 726f 7027 5d2c  ms['rate_drop'],
-0000e440: 2073 6b69 705f 6472 6f70 3d70 6172 616d   skip_drop=param
-0000e450: 735b 2773 6b69 705f 6472 6f70 275d 2c20  s['skip_drop'], 
-0000e460: 7261 6e64 6f6d 5f73 7461 7465 3d31 3930  random_state=190
-0000e470: 3929 232c 2074 7265 655f 6d65 7468 6f64  9)#, tree_method
-0000e480: 3d27 6869 7374 2729 0a20 2020 2020 2020  ='hist').       
-0000e490: 2065 6c69 6620 7061 7261 6d73 5b27 626f   elif params['bo
-0000e4a0: 6f73 7465 7227 5d20 3d3d 2027 6762 7472  oster'] == 'gbtr
-0000e4b0: 6565 273a 0a20 2020 2020 2020 2020 2020  ee':.           
-0000e4c0: 2069 6620 7365 6c66 2e74 6573 745f 7369   if self.test_si
-0000e4d0: 7a65 2069 7320 4e6f 6e65 3a0a 2020 2020  ze is None:.    
-0000e4e0: 2020 2020 2020 2020 2020 2020 636c 6620              clf 
-0000e4f0: 3d20 5847 4243 6c61 7373 6966 6965 7228  = XGBClassifier(
-0000e500: 626f 6f73 7465 723d 7061 7261 6d73 5b27  booster=params['
-0000e510: 626f 6f73 7465 7227 5d2c 206e 5f65 7374  booster'], n_est
-0000e520: 696d 6174 6f72 733d 7061 7261 6d73 5b27  imators=params['
-0000e530: 6e5f 6573 7469 6d61 746f 7273 275d 2c20  n_estimators'], 
-0000e540: 636f 6c73 616d 706c 655f 6279 7472 6565  colsample_bytree
-0000e550: 3d70 6172 616d 735b 2763 6f6c 7361 6d70  =params['colsamp
-0000e560: 6c65 5f62 7974 7265 6527 5d2c 2020 7265  le_bytree'],  re
-0000e570: 675f 6c61 6d62 6461 3d70 6172 616d 735b  g_lambda=params[
-0000e580: 2772 6567 5f6c 616d 6264 6127 5d2c 200a  'reg_lambda'], .
-0000e590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5a0: 2020 2020 7265 675f 616c 7068 613d 7061      reg_alpha=pa
-0000e5b0: 7261 6d73 5b27 7265 675f 616c 7068 6127  rams['reg_alpha'
-0000e5c0: 5d2c 206d 6178 5f64 6570 7468 3d70 6172  ], max_depth=par
-0000e5d0: 616d 735b 276d 6178 5f64 6570 7468 275d  ams['max_depth']
-0000e5e0: 2c20 6574 613d 7061 7261 6d73 5b27 6574  , eta=params['et
-0000e5f0: 6127 5d2c 2067 616d 6d61 3d70 6172 616d  a'], gamma=param
-0000e600: 735b 2767 616d 6d61 275d 2c20 6772 6f77  s['gamma'], grow
-0000e610: 5f70 6f6c 6963 793d 7061 7261 6d73 5b27  _policy=params['
-0000e620: 6772 6f77 5f70 6f6c 6963 7927 5d2c 200a  grow_policy'], .
-0000e630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e640: 2020 2020 6d69 6e5f 6368 696c 645f 7765      min_child_we
-0000e650: 6967 6874 3d70 6172 616d 735b 276d 696e  ight=params['min
-0000e660: 5f63 6869 6c64 5f77 6569 6768 7427 5d2c  _child_weight'],
-0000e670: 206d 6178 5f64 656c 7461 5f73 7465 703d   max_delta_step=
-0000e680: 7061 7261 6d73 5b27 6d61 785f 6465 6c74  params['max_delt
-0000e690: 615f 7374 6570 275d 2c20 7375 6273 616d  a_step'], subsam
-0000e6a0: 706c 653d 7061 7261 6d73 5b27 7375 6273  ple=params['subs
-0000e6b0: 616d 706c 6527 5d2c 2072 616e 646f 6d5f  ample'], random_
-0000e6c0: 7374 6174 653d 3139 3039 2923 2c20 7472  state=1909)#, tr
-0000e6d0: 6565 5f6d 6574 686f 643d 2768 6973 7427  ee_method='hist'
-0000e6e0: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
-0000e6f0: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
-0000e700: 6573 745f 7369 7a65 2069 7320 6e6f 7420  est_size is not 
-0000e710: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000e720: 2020 6273 7420 3d20 7472 6169 6e28 7061    bst = train(pa
-0000e730: 7261 6d73 2c20 6474 7261 696e 2c20 6576  rams, dtrain, ev
-0000e740: 616c 733d 5b28 6476 616c 6964 2c20 2276  als=[(dvalid, "v
-0000e750: 616c 6964 6174 696f 6e22 295d 2c20 6361  alidation")], ca
-0000e760: 6c6c 6261 636b 733d 5b70 7275 6e69 6e67  llbacks=[pruning
-0000e770: 5f63 616c 6c62 6163 6b5d 290a 2020 2020  _callback]).    
-0000e780: 2020 2020 2020 2020 7072 6564 7320 3d20          preds = 
-0000e790: 6273 742e 7072 6564 6963 7428 6476 616c  bst.predict(dval
-0000e7a0: 6964 290a 2020 2020 2020 2020 2020 2020  id).            
-0000e7b0: 7072 6564 5f6c 6162 656c 7320 3d20 6e70  pred_labels = np
-0000e7c0: 2e72 696e 7428 7072 6564 7329 0a20 2020  .rint(preds).   
-0000e7d0: 2020 2020 2020 2020 2061 6363 7572 6163           accurac
-0000e7e0: 7920 3d20 6163 6375 7261 6379 5f73 636f  y = accuracy_sco
-0000e7f0: 7265 2876 616c 6964 5f79 2c20 7072 6564  re(valid_y, pred
-0000e800: 5f6c 6162 656c 7329 0a20 2020 2020 2020  _labels).       
-0000e810: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000e820: 2020 2063 7620 3d20 6372 6f73 735f 7661     cv = cross_va
-0000e830: 6c69 6461 7465 2863 6c66 2c20 7365 6c66  lidate(clf, self
-0000e840: 2e64 6174 615f 782c 2073 656c 662e 6461  .data_x, self.da
-0000e850: 7461 5f79 2c20 6376 3d73 656c 662e 6f70  ta_y, cv=self.op
-0000e860: 745f 6376 290a 2020 2020 2020 2020 2020  t_cv).          
-0000e870: 2020 6163 6375 7261 6379 203d 206e 702e    accuracy = np.
-0000e880: 6d65 616e 2863 765b 2774 6573 745f 7363  mean(cv['test_sc
-0000e890: 6f72 6527 5d29 0a20 2020 2020 2020 200a  ore']).        .
-0000e8a0: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-0000e8b0: 6363 7572 6163 790a 0a63 6c61 7373 206f  ccuracy..class o
-0000e8c0: 626a 6563 7469 7665 5f6e 6e28 6f62 6a65  bjective_nn(obje
-0000e8d0: 6374 293a 0a20 2020 2022 2222 0a20 2020  ct):.    """.   
-0000e8e0: 204f 7074 696d 697a 6174 696f 6e20 6f62   Optimization ob
-0000e8f0: 6a65 6374 6976 6520 6675 6e63 7469 6f6e  jective function
-0000e900: 2066 6f72 2074 6865 2073 6369 6b69 742d   for the scikit-
-0000e910: 6c65 6172 6e20 696d 706c 656d 656e 7461  learn implementa
-0000e920: 7469 6e20 6f66 2074 6865 0a20 2020 204d  tin of the.    M
-0000e930: 4c50 2063 6c61 7373 6966 6965 722e 2054  LP classifier. T
-0000e940: 6865 204f 7074 756e 6120 736f 6674 7761  he Optuna softwa
-0000e950: 7265 2066 6f72 2068 7970 6572 7061 7261  re for hyperpara
-0000e960: 6d65 7465 7220 6f70 7469 6d69 7a61 7469  meter optimizati
-0000e970: 6f6e 0a20 2020 2077 6173 2070 7562 6c69  on.    was publi
-0000e980: 7368 6564 2069 6e20 3230 3139 2062 7920  shed in 2019 by 
-0000e990: 416b 6962 6120 6574 2061 6c2e 2050 6170  Akiba et al. Pap
-0000e9a0: 6572 3a20 6874 7470 733a 2f2f 6172 7869  er: https://arxi
-0000e9b0: 762e 6f72 672f 6162 732f 3139 3037 2e31  v.org/abs/1907.1
-0000e9c0: 3039 3032 2e0a 0a20 2020 2054 6865 2074  0902...    The t
-0000e9d0: 6f74 616c 206e 756d 6265 7220 6f66 2068  otal number of h
-0000e9e0: 6964 6465 6e20 6c61 7965 7273 2074 6f20  idden layers to 
-0000e9f0: 7465 7374 2069 7320 6c69 6d69 7465 6420  test is limited 
-0000ea00: 746f 2031 302c 2077 6974 6820 3130 302d  to 10, with 100-
-0000ea10: 3530 3030 2070 6f73 7369 626c 6520 0a20  5000 possible . 
-0000ea20: 2020 206e 756d 6265 7220 6f66 206e 6575     number of neu
-0000ea30: 726f 6e73 2069 6e20 6561 6368 2e0a 0a20  rons in each... 
-0000ea40: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-0000ea50: 2064 6174 615f 7820 286e 6461 7272 6179   data_x (ndarray
-0000ea60: 293a 2032 4420 6172 7261 7920 6f66 2073  ): 2D array of s
-0000ea70: 697a 6520 286e 2078 206d 292c 2077 6865  ize (n x m), whe
-0000ea80: 7265 206e 2069 7320 7468 650a 2020 2020  re n is the.    
-0000ea90: 2020 2020 2020 2020 6e75 6d62 6572 206f          number o
-0000eaa0: 6620 7361 6d70 6c65 732c 2061 6e64 206d  f samples, and m
-0000eab0: 2074 6865 206e 756d 6265 7220 6f66 2066   the number of f
-0000eac0: 6561 7475 7265 732e 0a20 2020 2020 2020  eatures..       
-0000ead0: 2064 6174 615f 7920 286e 6461 7272 6179   data_y (ndarray
-0000eae0: 2c20 7374 7229 3a20 3144 2061 7272 6179  , str): 1D array
-0000eaf0: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
-0000eb00: 636f 7272 6573 706f 6e69 6e67 206c 6162  corresponing lab
-0000eb10: 656c 732e 200a 2020 2020 2020 2020 6f70  els. .        op
-0000eb20: 745f 6376 2028 696e 7429 3a20 4372 6f73  t_cv (int): Cros
-0000eb30: 732d 7661 6c69 6461 7469 6f6e 7320 746f  s-validations to
-0000eb40: 2070 6572 666f 726d 2077 6865 6e20 6173   perform when as
-0000eb50: 7365 7369 6e67 2074 6865 2070 6572 666f  sesing the perfo
-0000eb60: 726d 616e 6365 2061 7420 6561 6368 0a20  rmance at each. 
-0000eb70: 2020 2020 2020 2020 2020 2068 7970 6572             hyper
-0000eb80: 7061 7261 6d65 7465 7220 6f70 7469 6d69  parameter optimi
-0000eb90: 7a61 7469 6f6e 2074 7269 616c 2e20 466f  zation trial. Fo
-0000eba0: 7220 6578 616d 706c 652c 2069 6620 6376  r example, if cv
-0000ebb0: 3d33 2c20 7468 656e 2065 6163 6820 6f70  =3, then each op
-0000ebc0: 7469 6d69 7a61 7469 6f6e 2074 7269 616c  timization trial
-0000ebd0: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
-0000ebe0: 6c20 6265 2061 7373 6573 7365 6420 6163  l be assessed ac
-0000ebf0: 636f 7264 696e 6720 746f 2074 6865 2033  cording to the 3
-0000ec00: 2d66 6f6c 6420 6372 6f73 7320 7661 6c69  -fold cross vali
-0000ec10: 6461 7469 6f6e 2061 6363 7572 6163 792e  dation accuracy.
-0000ec20: 200a 0a20 2020 2052 6574 7572 6e73 3a0a   ..    Returns:.
-0000ec30: 2020 2020 2020 2020 5468 6520 7065 7266          The perf
-0000ec40: 6f72 6d61 6e63 6520 6d65 7472 6963 2c20  ormance metric, 
-0000ec50: 6465 7465 726d 696e 6564 2075 7369 6e67  determined using
-0000ec60: 2074 6865 2063 726f 7373 2d66 6f6c 6420   the cross-fold 
-0000ec70: 7661 6c69 6461 7469 6f6e 206d 6574 686f  validation metho
-0000ec80: 642e 0a20 2020 2022 2222 0a0a 2020 2020  d..    """..    
-0000ec90: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-0000eca0: 662c 2064 6174 615f 782c 2064 6174 615f  f, data_x, data_
-0000ecb0: 792c 206f 7074 5f63 7629 3a0a 2020 2020  y, opt_cv):.    
-0000ecc0: 2020 2020 7365 6c66 2e64 6174 615f 7820      self.data_x 
-0000ecd0: 3d20 6461 7461 5f78 0a20 2020 2020 2020  = data_x.       
-0000ece0: 2073 656c 662e 6461 7461 5f79 203d 2064   self.data_y = d
-0000ecf0: 6174 615f 790a 2020 2020 2020 2020 7365  ata_y.        se
-0000ed00: 6c66 2e6f 7074 5f63 7620 3d20 6f70 745f  lf.opt_cv = opt_
-0000ed10: 6376 0a0a 2020 2020 6465 6620 5f5f 6361  cv..    def __ca
-0000ed20: 6c6c 5f5f 2873 656c 662c 2074 7269 616c  ll__(self, trial
-0000ed30: 293a 0a20 2020 2020 2020 206c 6561 726e  ):.        learn
-0000ed40: 696e 675f 7261 7465 5f69 6e69 7420 3d20  ing_rate_init = 
-0000ed50: 7472 6961 6c2e 7375 6767 6573 745f 666c  trial.suggest_fl
-0000ed60: 6f61 7428 276c 6561 726e 696e 675f 7261  oat('learning_ra
-0000ed70: 7465 5f69 6e69 7427 2c20 3165 2d35 2c20  te_init', 1e-5, 
-0000ed80: 302e 312c 2073 7465 703d 3165 2d35 290a  0.1, step=1e-5).
-0000ed90: 2020 2020 2020 2020 736f 6c76 6572 203d          solver =
-0000eda0: 2074 7269 616c 2e73 7567 6765 7374 5f63   trial.suggest_c
-0000edb0: 6174 6567 6f72 6963 616c 2822 736f 6c76  ategorical("solv
-0000edc0: 6572 222c 205b 2273 6764 222c 2022 6164  er", ["sgd", "ad
-0000edd0: 616d 225d 2920 2322 6c62 6667 7322 0a20  am"]) #"lbfgs". 
-0000ede0: 2020 2020 2020 2061 6374 6976 6174 696f         activatio
-0000edf0: 6e20 3d20 7472 6961 6c2e 7375 6767 6573  n = trial.sugges
-0000ee00: 745f 6361 7465 676f 7269 6361 6c28 2261  t_categorical("a
-0000ee10: 6374 6976 6174 696f 6e22 2c20 5b22 6c6f  ctivation", ["lo
-0000ee20: 6769 7374 6963 222c 2022 7461 6e68 222c  gistic", "tanh",
-0000ee30: 2022 7265 6c75 225d 290a 2020 2020 2020   "relu"]).      
-0000ee40: 2020 6c65 6172 6e69 6e67 5f72 6174 6520    learning_rate 
-0000ee50: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
-0000ee60: 6361 7465 676f 7269 6361 6c28 226c 6561  categorical("lea
-0000ee70: 726e 696e 675f 7261 7465 222c 205b 2263  rning_rate", ["c
-0000ee80: 6f6e 7374 616e 7422 2c20 2269 6e76 7363  onstant", "invsc
-0000ee90: 616c 696e 6722 2c20 2261 6461 7074 6976  aling", "adaptiv
-0000eea0: 6522 5d29 0a20 2020 2020 2020 2061 6c70  e"]).        alp
-0000eeb0: 6861 203d 2074 7269 616c 2e73 7567 6765  ha = trial.sugge
-0000eec0: 7374 5f66 6c6f 6174 2822 616c 7068 6122  st_float("alpha"
-0000eed0: 2c20 3165 2d37 2c20 312c 2073 7465 703d  , 1e-7, 1, step=
-0000eee0: 3165 2d36 290a 2020 2020 2020 2020 6261  1e-6).        ba
-0000eef0: 7463 685f 7369 7a65 203d 2074 7269 616c  tch_size = trial
-0000ef00: 2e73 7567 6765 7374 5f69 6e74 2827 6261  .suggest_int('ba
-0000ef10: 7463 685f 7369 7a65 272c 2031 2c20 3130  tch_size', 1, 10
-0000ef20: 3030 290a 2020 2020 2020 2020 6e5f 6c61  00).        n_la
-0000ef30: 7965 7273 203d 2074 7269 616c 2e73 7567  yers = trial.sug
-0000ef40: 6765 7374 5f69 6e74 2827 6869 6464 656e  gest_int('hidden
-0000ef50: 5f6c 6179 6572 5f73 697a 6573 272c 2031  _layer_sizes', 1
-0000ef60: 2c20 3130 290a 0a20 2020 2020 2020 206c  , 10)..        l
-0000ef70: 6179 6572 7320 3d20 5b5d 0a20 2020 2020  ayers = [].     
-0000ef80: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-0000ef90: 6528 6e5f 6c61 7965 7273 293a 0a20 2020  e(n_layers):.   
-0000efa0: 2020 2020 2020 2020 206c 6179 6572 732e           layers.
-0000efb0: 6170 7065 6e64 2874 7269 616c 2e73 7567  append(trial.sug
-0000efc0: 6765 7374 5f69 6e74 2866 276e 5f75 6e69  gest_int(f'n_uni
-0000efd0: 7473 5f7b 697d 272c 2031 3030 2c20 3530  ts_{i}', 100, 50
-0000efe0: 3030 2929 0a0a 2020 2020 2020 2020 7472  00))..        tr
-0000eff0: 793a 0a20 2020 2020 2020 2020 2020 2063  y:.            c
-0000f000: 6c66 203d 204d 4c50 436c 6173 7369 6669  lf = MLPClassifi
-0000f010: 6572 2868 6964 6465 6e5f 6c61 7965 725f  er(hidden_layer_
-0000f020: 7369 7a65 733d 7475 706c 6528 6c61 7965  sizes=tuple(laye
-0000f030: 7273 292c 6c65 6172 6e69 6e67 5f72 6174  rs),learning_rat
-0000f040: 655f 696e 6974 3d6c 6561 726e 696e 675f  e_init=learning_
-0000f050: 7261 7465 5f69 6e69 742c 200a 2020 2020  rate_init, .    
-0000f060: 2020 2020 2020 2020 2020 2020 736f 6c76              solv
-0000f070: 6572 3d73 6f6c 7665 722c 2061 6374 6976  er=solver, activ
-0000f080: 6174 696f 6e3d 6163 7469 7661 7469 6f6e  ation=activation
-0000f090: 2c20 616c 7068 613d 616c 7068 612c 2062  , alpha=alpha, b
-0000f0a0: 6174 6368 5f73 697a 653d 6261 7463 685f  atch_size=batch_
-0000f0b0: 7369 7a65 2c20 6d61 785f 6974 6572 3d32  size, max_iter=2
-0000f0c0: 3530 302c 2072 616e 646f 6d5f 7374 6174  500, random_stat
-0000f0d0: 653d 3139 3039 290a 2020 2020 2020 2020  e=1909).        
-0000f0e0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-0000f0f0: 2020 2020 7072 696e 7428 2249 6e76 616c      print("Inval
-0000f100: 6964 2068 7970 6572 7061 7261 6d65 7465  id hyperparamete
-0000f110: 7220 636f 6d62 696e 6174 696f 6e2c 2073  r combination, s
-0000f120: 6b69 7070 696e 6720 7472 6961 6c22 290a  kipping trial").
-0000f130: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000f140: 726e 2030 2e30 0a0a 2020 2020 2020 2020  rn 0.0..        
-0000f150: 6376 203d 2063 726f 7373 5f76 616c 6964  cv = cross_valid
-0000f160: 6174 6528 636c 662c 2073 656c 662e 6461  ate(clf, self.da
-0000f170: 7461 5f78 2c20 7365 6c66 2e64 6174 615f  ta_x, self.data_
-0000f180: 792c 2063 763d 7365 6c66 2e6f 7074 5f63  y, cv=self.opt_c
-0000f190: 7629 0a20 2020 2020 2020 2066 696e 616c  v).        final
-0000f1a0: 5f73 636f 7265 203d 206e 702e 6d65 616e  _score = np.mean
-0000f1b0: 2863 765b 2774 6573 745f 7363 6f72 6527  (cv['test_score'
-0000f1c0: 5d29 0a0a 2020 2020 2020 2020 7265 7475  ])..        retu
-0000f1d0: 726e 2066 696e 616c 5f73 636f 7265 0a0a  rn final_score..
-0000f1e0: 636c 6173 7320 6f62 6a65 6374 6976 655f  class objective_
-0000f1f0: 7266 286f 626a 6563 7429 3a0a 2020 2020  rf(object):.    
-0000f200: 2222 220a 2020 2020 4f70 7469 6d69 7a61  """.    Optimiza
-0000f210: 7469 6f6e 206f 626a 6563 7469 7665 2066  tion objective f
-0000f220: 756e 6374 696f 6e20 666f 7220 7468 6520  unction for the 
-0000f230: 7363 696b 6974 2d6c 6561 726e 2069 6d70  scikit-learn imp
-0000f240: 6c65 6d65 6e74 6174 696e 206f 6620 7468  lementatin of th
-0000f250: 650a 2020 2020 5261 6e64 6f6d 2046 6f72  e.    Random For
-0000f260: 6573 7420 636c 6173 7369 6669 6572 2e20  est classifier. 
-0000f270: 5468 6520 4f70 7475 6e61 2073 6f66 7477  The Optuna softw
-0000f280: 6172 6520 666f 7220 6879 7065 7270 6172  are for hyperpar
-0000f290: 616d 6574 6572 206f 7074 696d 697a 6174  ameter optimizat
-0000f2a0: 696f 6e0a 2020 2020 7761 7320 7075 626c  ion.    was publ
-0000f2b0: 6973 6865 6420 696e 2032 3031 3920 6279  ished in 2019 by
-0000f2c0: 2041 6b69 6261 2065 7420 616c 2e20 5061   Akiba et al. Pa
-0000f2d0: 7065 723a 2068 7474 7073 3a2f 2f61 7278  per: https://arx
-0000f2e0: 6976 2e6f 7267 2f61 6273 2f31 3930 372e  iv.org/abs/1907.
-0000f2f0: 3130 3930 320a 0a20 2020 2041 7267 733a  10902..    Args:
-0000f300: 0a20 2020 2020 2020 2064 6174 615f 7820  .        data_x 
-0000f310: 286e 6461 7272 6179 293a 2032 4420 6172  (ndarray): 2D ar
-0000f320: 7261 7920 6f66 2073 697a 6520 286e 2078  ray of size (n x
-0000f330: 206d 292c 2077 6865 7265 206e 2069 7320   m), where n is 
-0000f340: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-0000f350: 6e75 6d62 6572 206f 6620 7361 6d70 6c65  number of sample
-0000f360: 732c 2061 6e64 206d 2074 6865 206e 756d  s, and m the num
-0000f370: 6265 7220 6f66 2066 6561 7475 7265 732e  ber of features.
-0000f380: 0a20 2020 2020 2020 2064 6174 615f 7920  .        data_y 
-0000f390: 286e 6461 7272 6179 2c20 7374 7229 3a20  (ndarray, str): 
-0000f3a0: 3144 2061 7272 6179 2063 6f6e 7461 696e  1D array contain
-0000f3b0: 696e 6720 7468 6520 636f 7272 6573 706f  ing the correspo
-0000f3c0: 6e69 6e67 206c 6162 656c 732e 200a 2020  ning labels. .  
-0000f3d0: 2020 2020 2020 6f70 745f 6376 2028 696e        opt_cv (in
-0000f3e0: 7429 3a20 4372 6f73 732d 7661 6c69 6461  t): Cross-valida
-0000f3f0: 7469 6f6e 7320 746f 2070 6572 666f 726d  tions to perform
-0000f400: 2077 6865 6e20 6173 7365 7369 6e67 2074   when assesing t
-0000f410: 6865 2070 6572 666f 726d 616e 6365 2061  he performance a
-0000f420: 7420 6561 6368 0a20 2020 2020 2020 2020  t each.         
-0000f430: 2020 2068 7970 6572 7061 7261 6d65 7465     hyperparamete
-0000f440: 7220 6f70 7469 6d69 7a61 7469 6f6e 2074  r optimization t
-0000f450: 7269 616c 2e20 466f 7220 6578 616d 706c  rial. For exampl
-0000f460: 652c 2069 6620 6376 3d33 2c20 7468 656e  e, if cv=3, then
-0000f470: 2065 6163 6820 6f70 7469 6d69 7a61 7469   each optimizati
-0000f480: 6f6e 2074 7269 616c 0a20 2020 2020 2020  on trial.       
-0000f490: 2020 2020 2077 696c 6c20 6265 2061 7373       will be ass
-0000f4a0: 6573 7365 6420 6163 636f 7264 696e 6720  essed according 
-0000f4b0: 746f 2074 6865 2033 2d66 6f6c 6420 6372  to the 3-fold cr
-0000f4c0: 6f73 7320 7661 6c69 6461 7469 6f6e 2061  oss validation a
-0000f4d0: 6363 7572 6163 792e 200a 0a20 2020 2052  ccuracy. ..    R
-0000f4e0: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-0000f4f0: 5468 6520 7065 7266 6f72 6d61 6e63 6520  The performance 
-0000f500: 6d65 7472 6963 2c20 6465 7465 726d 696e  metric, determin
-0000f510: 6564 2075 7369 6e67 2074 6865 2063 726f  ed using the cro
-0000f520: 7373 2d66 6f6c 6420 7661 6c69 6461 7469  ss-fold validati
-0000f530: 6f6e 206d 6574 686f 642e 0a20 2020 2022  on method..    "
-0000f540: 2222 0a20 2020 200a 2020 2020 6465 6620  "".    .    def 
-0000f550: 5f5f 696e 6974 5f5f 2873 656c 662c 2064  __init__(self, d
-0000f560: 6174 615f 782c 2064 6174 615f 792c 206f  ata_x, data_y, o
-0000f570: 7074 5f63 7629 3a0a 0a20 2020 2020 2020  pt_cv):..       
-0000f580: 2073 656c 662e 6461 7461 5f78 203d 2064   self.data_x = d
-0000f590: 6174 615f 780a 2020 2020 2020 2020 7365  ata_x.        se
-0000f5a0: 6c66 2e64 6174 615f 7920 3d20 6461 7461  lf.data_y = data
-0000f5b0: 5f79 0a20 2020 2020 2020 2073 656c 662e  _y.        self.
-0000f5c0: 6f70 745f 6376 203d 206f 7074 5f63 760a  opt_cv = opt_cv.
-0000f5d0: 0a20 2020 2064 6566 205f 5f63 616c 6c5f  .    def __call_
-0000f5e0: 5f28 7365 6c66 2c20 7472 6961 6c29 3a0a  _(self, trial):.
-0000f5f0: 0a20 2020 2020 2020 206e 5f65 7374 696d  .        n_estim
-0000f600: 6174 6f72 7320 3d20 7472 6961 6c2e 7375  ators = trial.su
-0000f610: 6767 6573 745f 696e 7428 276e 5f65 7374  ggest_int('n_est
-0000f620: 696d 6174 6f72 7327 2c20 3130 302c 2033  imators', 100, 3
-0000f630: 3030 3029 0a20 2020 2020 2020 2063 7269  000).        cri
-0000f640: 7465 7269 6f6e 203d 2074 7269 616c 2e73  terion = trial.s
-0000f650: 7567 6765 7374 5f63 6174 6567 6f72 6963  uggest_categoric
-0000f660: 616c 2827 6372 6974 6572 696f 6e27 2c20  al('criterion', 
-0000f670: 5b27 6769 6e69 272c 2027 656e 7472 6f70  ['gini', 'entrop
-0000f680: 7927 5d29 0a20 2020 2020 2020 206d 6178  y']).        max
-0000f690: 5f64 6570 7468 203d 2074 7269 616c 2e73  _depth = trial.s
-0000f6a0: 7567 6765 7374 5f69 6e74 2827 6d61 785f  uggest_int('max_
-0000f6b0: 6465 7074 6827 2c20 322c 2032 3529 0a20  depth', 2, 25). 
-0000f6c0: 2020 2020 2020 206d 696e 5f73 616d 706c         min_sampl
-0000f6d0: 6573 5f73 706c 6974 203d 2074 7269 616c  es_split = trial
-0000f6e0: 2e73 7567 6765 7374 5f69 6e74 2827 6d69  .suggest_int('mi
-0000f6f0: 6e5f 7361 6d70 6c65 735f 7370 6c69 7427  n_samples_split'
-0000f700: 2c20 322c 2032 3529 0a20 2020 2020 2020  , 2, 25).       
-0000f710: 206d 696e 5f73 616d 706c 6573 5f6c 6561   min_samples_lea
-0000f720: 6620 3d20 7472 6961 6c2e 7375 6767 6573  f = trial.sugges
-0000f730: 745f 696e 7428 276d 696e 5f73 616d 706c  t_int('min_sampl
-0000f740: 6573 5f6c 6561 6627 2c20 312c 2031 3529  es_leaf', 1, 15)
-0000f750: 0a20 2020 2020 2020 206d 6178 5f66 6561  .        max_fea
-0000f760: 7475 7265 7320 3d20 7472 6961 6c2e 7375  tures = trial.su
-0000f770: 6767 6573 745f 696e 7428 276d 6178 5f66  ggest_int('max_f
-0000f780: 6561 7475 7265 7327 2c20 312c 2073 656c  eatures', 1, sel
-0000f790: 662e 6461 7461 5f78 2e73 6861 7065 5b31  f.data_x.shape[1
-0000f7a0: 5d29 0a20 2020 2020 2020 2062 6f6f 7473  ]).        boots
-0000f7b0: 7472 6170 203d 2074 7269 616c 2e73 7567  trap = trial.sug
-0000f7c0: 6765 7374 5f63 6174 6567 6f72 6963 616c  gest_categorical
-0000f7d0: 2827 626f 6f74 7374 7261 7027 2c20 5b54  ('bootstrap', [T
-0000f7e0: 7275 652c 2046 616c 7365 5d29 0a20 2020  rue, False]).   
-0000f7f0: 2020 2020 200a 2020 2020 2020 2020 7472       .        tr
-0000f800: 793a 0a20 2020 2020 2020 2020 2020 2063  y:.            c
-0000f810: 6c66 203d 2052 616e 646f 6d46 6f72 6573  lf = RandomFores
-0000f820: 7443 6c61 7373 6966 6965 7228 6e5f 6573  tClassifier(n_es
-0000f830: 7469 6d61 746f 7273 3d6e 5f65 7374 696d  timators=n_estim
-0000f840: 6174 6f72 732c 2063 7269 7465 7269 6f6e  ators, criterion
-0000f850: 3d63 7269 7465 7269 6f6e 2c20 6d61 785f  =criterion, max_
-0000f860: 6465 7074 683d 6d61 785f 6465 7074 682c  depth=max_depth,
-0000f870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f880: 206d 696e 5f73 616d 706c 6573 5f73 706c   min_samples_spl
-0000f890: 6974 3d6d 696e 5f73 616d 706c 6573 5f73  it=min_samples_s
-0000f8a0: 706c 6974 2c20 6d69 6e5f 7361 6d70 6c65  plit, min_sample
-0000f8b0: 735f 6c65 6166 3d6d 696e 5f73 616d 706c  s_leaf=min_sampl
-0000f8c0: 6573 5f6c 6561 662c 0a20 2020 2020 2020  es_leaf,.       
-0000f8d0: 2020 2020 2020 2020 206d 6178 5f66 6561           max_fea
-0000f8e0: 7475 7265 733d 6d61 785f 6665 6174 7572  tures=max_featur
-0000f8f0: 6573 2c20 626f 6f74 7374 7261 703d 626f  es, bootstrap=bo
-0000f900: 6f74 7374 7261 702c 2072 616e 646f 6d5f  otstrap, random_
-0000f910: 7374 6174 653d 3139 3039 290a 2020 2020  state=1909).    
-0000f920: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-0000f930: 2020 2020 2020 2020 7072 696e 7428 2249          print("I
-0000f940: 6e76 616c 6964 2068 7970 6572 7061 7261  nvalid hyperpara
-0000f950: 6d65 7465 7220 636f 6d62 696e 6174 696f  meter combinatio
-0000f960: 6e2c 2073 6b69 7070 696e 6720 7472 6961  n, skipping tria
-0000f970: 6c22 290a 2020 2020 2020 2020 2020 2020  l").            
-0000f980: 7265 7475 726e 2030 2e30 0a0a 2020 2020  return 0.0..    
-0000f990: 2020 2020 6376 203d 2063 726f 7373 5f76      cv = cross_v
-0000f9a0: 616c 6964 6174 6528 636c 662c 2073 656c  alidate(clf, sel
-0000f9b0: 662e 6461 7461 5f78 2c20 7365 6c66 2e64  f.data_x, self.d
-0000f9c0: 6174 615f 792c 2063 763d 7365 6c66 2e6f  ata_y, cv=self.o
-0000f9d0: 7074 5f63 7629 0a20 2020 2020 2020 2066  pt_cv).        f
-0000f9e0: 696e 616c 5f73 636f 7265 203d 206e 702e  inal_score = np.
-0000f9f0: 6d65 616e 2863 765b 2774 6573 745f 7363  mean(cv['test_sc
-0000fa00: 6f72 6527 5d29 0a0a 2020 2020 2020 2020  ore'])..        
-0000fa10: 7265 7475 726e 2066 696e 616c 5f73 636f  return final_sco
-0000fa20: 7265 0a0a 0a63 6c61 7373 204d 6f6e 6974  re...class Monit
-0000fa30: 6f72 5f54 7261 636b 6572 2843 616c 6c62  or_Tracker(Callb
-0000fa40: 6163 6b29 3a0a 2020 2020 2222 220a 2020  ack):.    """.  
-0000fa50: 2020 4375 7374 6f6d 2063 616c 6c62 6163    Custom callbac
-0000fa60: 6b20 7468 6174 2061 6c6c 6f77 7320 666f  k that allows fo
-0000fa70: 7220 7477 6f20 6469 6666 6572 656e 7420  r two different 
-0000fa80: 6d6f 6e69 746f 7273 2e0a 2020 2020 5468  monitors..    Th
-0000fa90: 6973 2063 6c61 7373 2069 7320 7573 6564  is class is used
-0000faa0: 2062 7920 7468 6520 606f 626a 6563 7469   by the `objecti
-0000fab0: 7665 5f63 6e6e 6020 726f 7574 696e 6520  ve_cnn` routine 
-0000fac0: 6173 2069 7420 696e 6865 7269 7473 2074  as it inherits t
-0000fad0: 6865 2060 6d6f 6e69 746f 7231 6020 0a20  he `monitor1` . 
-0000fae0: 2020 2061 6e64 2060 6d6f 6e69 746f 7232     and `monitor2
-0000faf0: 6020 6174 7472 6962 7574 6573 2c20 6173  ` attributes, as
-0000fb00: 2077 656c 6c20 6173 2074 6865 6972 2063   well as their c
-0000fb10: 6f72 7265 7370 6f6e 6469 6e67 2074 6872  orresponding thr
-0000fb20: 6573 686f 6c64 732e 2054 6869 7320 6561  esholds. This ea
-0000fb30: 726c 7920 7374 6f70 7069 6e67 0a20 2020  rly stopping.   
-0000fb40: 2063 7573 746f 6d20 6361 6c6c 6261 636b   custom callback
-0000fb50: 2077 696c 6c20 7465 726d 696e 6174 6520   will terminate 
-0000fb60: 7468 6520 7472 6169 6e69 6e67 2065 6172  the training ear
-0000fb70: 6c79 2069 6620 6569 7468 6572 206d 6f6e  ly if either mon
-0000fb80: 6974 6f72 7320 6372 6f73 7320 7468 6569  itors cross thei
-0000fb90: 7220 7265 7370 6563 7469 7665 0a20 2020  r respective.   
-0000fba0: 2074 6872 6573 686f 6c64 2c20 7468 6572   threshold, ther
-0000fbb0: 6566 6f72 6520 7468 6520 7061 7469 656e  efore the patien
-0000fbc0: 6365 2069 6e70 7574 2069 7320 6e6f 7420  ce input is not 
-0000fbd0: 7573 6564 2e20 5768 6574 6865 7220 7468  used. Whether th
-0000fbe0: 6520 7468 7265 7368 6f6c 6420 7368 6f75  e threshold shou
-0000fbf0: 6c64 2062 6520 6120 6365 696c 696e 670a  ld be a ceiling.
-0000fc00: 2020 2020 6f72 2066 6c6f 6f72 2076 616c      or floor val
-0000fc10: 7565 2077 696c 6c20 6265 2064 6574 6572  ue will be deter
-0000fc20: 6d69 6e65 6420 6163 636f 7264 696e 6720  mined according 
-0000fc30: 746f 2074 6865 206d 6574 7269 632c 2062  to the metric, b
-0000fc40: 7920 6368 6563 6b69 6e67 2077 6865 7468  y checking wheth
-0000fc50: 6572 2074 6865 206d 6f6e 6974 6f72 206e  er the monitor n
-0000fc60: 616d 650a 2020 2020 636f 6e74 6169 6e73  ame.    contains
-0000fc70: 2074 6865 2077 6f72 6420 276c 6f73 7327   the word 'loss'
-0000fc80: 2e0a 0a20 2020 2041 7267 733a 0a20 2020  ...    Args:.   
-0000fc90: 2020 2020 206d 6f6e 6974 6f72 3120 2873       monitor1 (s
-0000fca0: 7472 293a 204e 616d 6520 6f66 2074 6865  tr): Name of the
-0000fcb0: 206d 6574 7269 6320 746f 206d 6f6e 6974   metric to monit
-0000fcc0: 6f72 2e20 4966 2060 4e6f 6e65 602c 2074  or. If `None`, t
-0000fcd0: 6869 7320 6d6f 6e69 746f 7220 7769 6c6c  his monitor will
-0000fce0: 206e 6f74 2062 6520 7573 6564 2e0a 2020   not be used..  
-0000fcf0: 2020 2020 2020 6d6f 6e69 746f 7232 2028        monitor2 (
-0000fd00: 7374 7229 3a20 4e61 6d65 206f 6620 7468  str): Name of th
-0000fd10: 6520 6d65 7472 6963 2074 6f20 6d6f 6e69  e metric to moni
-0000fd20: 746f 722e 2049 6620 604e 6f6e 6560 2c20  tor. If `None`, 
-0000fd30: 7468 6973 206d 6f6e 6974 6f72 2077 696c  this monitor wil
-0000fd40: 6c20 6e6f 7420 6265 2075 7365 642e 0a20  l not be used.. 
-0000fd50: 2020 2020 2020 206d 6f6e 6974 6f72 315f         monitor1_
-0000fd60: 7468 7265 7368 2028 666c 6f61 7429 3a20  thresh (float): 
-0000fd70: 5468 7265 7368 6f6c 6420 7661 6c75 6520  Threshold value 
-0000fd80: 666f 7220 606d 6f6e 6974 6f72 3160 2e0a  for `monitor1`..
-0000fd90: 2020 2020 2020 2020 6d6f 6e69 746f 7232          monitor2
-0000fda0: 5f74 6872 6573 6820 2866 6c6f 6174 293a  _thresh (float):
-0000fdb0: 2054 6872 6573 686f 6c64 2076 616c 7565   Threshold value
-0000fdc0: 2066 6f72 2060 6d6f 6e69 746f 7232 602e   for `monitor2`.
-0000fdd0: 0a0a 2020 2020 4174 7472 6962 7574 6573  ..    Attributes
-0000fde0: 3a0a 2020 2020 2020 2020 7374 6f70 7065  :.        stoppe
-0000fdf0: 645f 6570 6f63 6820 2869 6e74 293a 2054  d_epoch (int): T
-0000fe00: 6865 2065 706f 6368 2061 7420 7768 6963  he epoch at whic
-0000fe10: 6820 7468 6520 7472 6169 6e69 6e67 2077  h the training w
-0000fe20: 6173 2073 746f 7070 6564 2e0a 2020 2020  as stopped..    
-0000fe30: 2020 2020 6265 7374 5f6d 6574 7269 6320      best_metric 
-0000fe40: 2866 6c6f 6174 293a 2054 6865 2062 6573  (float): The bes
-0000fe50: 7420 6d65 7472 6963 2076 616c 7565 2061  t metric value a
-0000fe60: 6368 6965 7665 6420 6475 7269 6e67 2074  chieved during t
-0000fe70: 6865 2074 7261 696e 696e 672e 0a20 2020  he training..   
-0000fe80: 2020 2020 2062 6573 745f 7765 6967 6874       best_weight
-0000fe90: 7320 286e 6461 7272 6179 293a 2054 6865  s (ndarray): The
-0000fea0: 2077 6569 6768 7473 206f 6620 7468 6520   weights of the 
-0000feb0: 6d6f 6465 6c20 6174 2074 6865 2065 706f  model at the epo
-0000fec0: 6368 2077 6974 6820 7468 6520 6265 7374  ch with the best
-0000fed0: 206d 6574 7269 6320 7661 6c75 652e 0a0a   metric value...
-0000fee0: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
-0000fef0: 2020 2020 204e 6f6e 650a 2020 2020 2222       None.    ""
-0000ff00: 220a 2020 2020 0a20 2020 2064 6566 205f  ".    .    def _
-0000ff10: 5f69 6e69 745f 5f28 7365 6c66 2c20 6d6f  _init__(self, mo
-0000ff20: 6e69 746f 7231 3d4e 6f6e 652c 206d 6f6e  nitor1=None, mon
-0000ff30: 6974 6f72 323d 4e6f 6e65 2c20 6d6f 6e69  itor2=None, moni
-0000ff40: 746f 7231 5f74 6872 6573 683d 4e6f 6e65  tor1_thresh=None
-0000ff50: 2c20 6d6f 6e69 746f 7232 5f74 6872 6573  , monitor2_thres
-0000ff60: 683d 4e6f 6e65 293a 0a20 2020 2020 2020  h=None):.       
-0000ff70: 2073 7570 6572 2829 2e5f 5f69 6e69 745f   super().__init_
-0000ff80: 5f28 2920 2323 496e 6974 6961 6c69 7a65  _() ##Initialize
-0000ff90: 7320 7468 6520 696e 6865 7269 7465 6420  s the inherited 
-0000ffa0: 6174 7472 6962 7574 6573 2061 6e64 206d  attributes and m
-0000ffb0: 6574 686f 6473 2066 726f 6d20 7468 6520  ethods from the 
-0000ffc0: 7061 7265 6e74 2063 6c61 7373 2061 7320  parent class as 
-0000ffd0: 6974 2077 696c 6c20 696e 6865 7269 7420  it will inherit 
-0000ffe0: 6672 6f6d 2043 616c 6c62 6163 6b0a 2020  from Callback.  
-0000fff0: 2020 2020 2020 7365 6c66 2e6d 6f6e 6974        self.monit
-00010000: 6f72 3120 3d20 6d6f 6e69 746f 7231 0a20  or1 = monitor1. 
-00010010: 2020 2020 2020 2073 656c 662e 6d6f 6e69         self.moni
-00010020: 746f 7232 203d 206d 6f6e 6974 6f72 320a  tor2 = monitor2.
-00010030: 2020 2020 2020 2020 7365 6c66 2e6d 6f6e          self.mon
-00010040: 6974 6f72 315f 7468 7265 7368 203d 206d  itor1_thresh = m
-00010050: 6f6e 6974 6f72 315f 7468 7265 7368 0a20  onitor1_thresh. 
-00010060: 2020 2020 2020 2073 656c 662e 6d6f 6e69         self.moni
-00010070: 746f 7232 5f74 6872 6573 6820 3d20 6d6f  tor2_thresh = mo
-00010080: 6e69 746f 7232 5f74 6872 6573 680a 2020  nitor2_thresh.  
-00010090: 2020 2020 2020 7365 6c66 2e73 746f 7070        self.stopp
-000100a0: 6564 5f65 706f 6368 203d 2030 0a20 2020  ed_epoch = 0.   
-000100b0: 2020 2020 2073 656c 662e 6265 7374 5f6d       self.best_m
-000100c0: 6574 7269 6320 3d20 666c 6f61 7428 2769  etric = float('i
-000100d0: 6e66 2729 200a 2020 2020 2020 2020 7365  nf') .        se
-000100e0: 6c66 2e62 6573 745f 7765 6967 6874 7320  lf.best_weights 
-000100f0: 3d20 4e6f 6e65 2023 5769 6c6c 2075 7365  = None #Will use
-00010100: 2074 6869 7320 746f 2073 746f 7265 2074   this to store t
-00010110: 6865 2077 6569 6768 7473 2077 6974 6820  he weights with 
-00010120: 7468 6520 6265 7374 206d 6574 7269 6320  the best metric 
-00010130: 7661 6c75 650a 0a20 2020 2064 6566 206f  value..    def o
-00010140: 6e5f 6570 6f63 685f 656e 6428 7365 6c66  n_epoch_end(self
-00010150: 2c20 6570 6f63 682c 206c 6f67 733d 7b7d  , epoch, logs={}
-00010160: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00010170: 2020 2020 2020 2054 6869 7320 6d65 7468         This meth
-00010180: 6f64 2077 696c 6c20 6265 2063 616c 6c65  od will be calle
-00010190: 6420 6174 2074 6865 2065 6e64 206f 6620  d at the end of 
-000101a0: 6561 6368 2065 706f 6368 2064 7572 696e  each epoch durin
-000101b0: 6720 7472 6169 6e69 6e67 2e0a 0a20 2020  g training...   
-000101c0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-000101d0: 2020 2020 2020 2065 706f 6368 2028 696e         epoch (in
-000101e0: 7429 3a20 4375 7272 656e 7420 6570 6f63  t): Current epoc
-000101f0: 6820 6e75 6d62 6572 2e0a 2020 2020 2020  h number..      
-00010200: 2020 2020 2020 6c6f 6773 2028 6469 6374        logs (dict
-00010210: 293a 2044 6963 7469 6f6e 6172 7920 636f  ): Dictionary co
-00010220: 6e74 6169 6e69 6e67 2074 6865 206d 6574  ntaining the met
-00010230: 7269 6373 2066 6f72 2074 6865 2063 7572  rics for the cur
-00010240: 7265 6e74 2065 706f 6368 2e0a 0a20 2020  rent epoch...   
-00010250: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
-00010260: 2020 2020 2020 2020 2020 4e6f 6e65 0a20            None. 
-00010270: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-00010280: 2020 2020 6966 2073 656c 662e 6d6f 6e69      if self.moni
-00010290: 746f 7231 2069 7320 6e6f 7420 4e6f 6e65  tor1 is not None
-000102a0: 2061 6e64 2073 656c 662e 6d6f 6e69 746f   and self.monito
-000102b0: 7232 2069 7320 6e6f 7420 4e6f 6e65 3a0a  r2 is not None:.
-000102c0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-000102d0: 656e 745f 3120 3d20 6c6f 6773 2e67 6574  ent_1 = logs.get
-000102e0: 2873 656c 662e 6d6f 6e69 746f 7231 290a  (self.monitor1).
-000102f0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00010300: 656e 745f 3220 3d20 6c6f 6773 2e67 6574  ent_2 = logs.get
-00010310: 2873 656c 662e 6d6f 6e69 746f 7232 290a  (self.monitor2).
-00010320: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00010330: 6c6f 7373 2720 6e6f 7420 696e 2073 656c  loss' not in sel
-00010340: 662e 6d6f 6e69 746f 7231 2061 6e64 2027  f.monitor1 and '
-00010350: 6c6f 7373 2720 696e 2073 656c 662e 6d6f  loss' in self.mo
-00010360: 6e69 746f 7232 3a0a 2020 2020 2020 2020  nitor2:.        
-00010370: 2020 2020 2020 2020 6966 206e 702e 6772          if np.gr
-00010380: 6561 7465 7228 6375 7272 656e 745f 312c  eater(current_1,
-00010390: 2073 656c 662e 6d6f 6e69 746f 7231 5f74   self.monitor1_t
-000103a0: 6872 6573 6829 206f 7220 6e70 2e6c 6573  hresh) or np.les
-000103b0: 735f 6571 7561 6c28 6375 7272 656e 745f  s_equal(current_
-000103c0: 322c 2073 656c 662e 6d6f 6e69 746f 7232  2, self.monitor2
-000103d0: 5f74 6872 6573 6829 3a0a 2020 2020 2020  _thresh):.      
-000103e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000103f0: 6c66 2e73 746f 7070 6564 5f65 706f 6368  lf.stopped_epoch
-00010400: 203d 2065 706f 6368 0a20 2020 2020 2020   = epoch.       
-00010410: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00010420: 662e 6d6f 6465 6c2e 7374 6f70 5f74 7261  f.model.stop_tra
-00010430: 696e 696e 6720 3d20 5472 7565 0a20 2020  ining = True.   
-00010440: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00010450: 7265 6e74 5f6d 6574 7269 6320 3d20 6375  rent_metric = cu
-00010460: 7272 656e 745f 310a 2020 2020 2020 2020  rrent_1.        
-00010470: 2020 2020 656c 6966 2027 6c6f 7373 2720      elif 'loss' 
-00010480: 6e6f 7420 696e 2073 656c 662e 6d6f 6e69  not in self.moni
-00010490: 746f 7231 2061 6e64 2027 6c6f 7373 2720  tor1 and 'loss' 
-000104a0: 6e6f 7420 696e 2073 656c 662e 6d6f 6e69  not in self.moni
-000104b0: 746f 7232 3a0a 2020 2020 2020 2020 2020  tor2:.          
-000104c0: 2020 2020 2020 6966 206e 702e 6772 6561        if np.grea
-000104d0: 7465 7228 6375 7272 656e 745f 312c 2073  ter(current_1, s
-000104e0: 656c 662e 6d6f 6e69 746f 7231 5f74 6872  elf.monitor1_thr
-000104f0: 6573 6829 206f 7220 6e70 2e67 7265 6174  esh) or np.great
-00010500: 6572 2863 7572 7265 6e74 5f32 2c20 7365  er(current_2, se
-00010510: 6c66 2e6d 6f6e 6974 6f72 325f 7468 7265  lf.monitor2_thre
-00010520: 7368 293a 0a20 2020 2020 2020 2020 2020  sh):.           
-00010530: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-00010540: 6f70 7065 645f 6570 6f63 6820 3d20 6570  opped_epoch = ep
-00010550: 6f63 680a 2020 2020 2020 2020 2020 2020  och.            
-00010560: 2020 2020 2020 2020 7365 6c66 2e6d 6f64          self.mod
-00010570: 656c 2e73 746f 705f 7472 6169 6e69 6e67  el.stop_training
-00010580: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00010590: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-000105a0: 6d65 7472 6963 203d 2063 7572 7265 6e74  metric = current
-000105b0: 5f31 0a20 2020 2020 2020 2020 2020 2065  _1.            e
-000105c0: 6c69 6620 276c 6f73 7327 2069 6e20 7365  lif 'loss' in se
-000105d0: 6c66 2e6d 6f6e 6974 6f72 3120 616e 6420  lf.monitor1 and 
-000105e0: 276c 6f73 7327 2069 6e20 7365 6c66 2e6d  'loss' in self.m
-000105f0: 6f6e 6974 6f72 323a 0a20 2020 2020 2020  onitor2:.       
-00010600: 2020 2020 2020 2020 2069 6620 6e70 2e6c           if np.l
-00010610: 6573 735f 6571 7561 6c28 6375 7272 656e  ess_equal(curren
-00010620: 745f 312c 2073 656c 662e 6d6f 6e69 746f  t_1, self.monito
-00010630: 7231 5f74 6872 6573 6829 206f 7220 6e70  r1_thresh) or np
-00010640: 2e6c 6573 735f 6571 7561 6c28 6375 7272  .less_equal(curr
-00010650: 656e 745f 322c 2073 656c 662e 6d6f 6e69  ent_2, self.moni
-00010660: 746f 7232 5f74 6872 6573 6829 3a0a 2020  tor2_thresh):.  
-00010670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010680: 2020 7365 6c66 2e73 746f 7070 6564 5f65    self.stopped_e
-00010690: 706f 6368 203d 2065 706f 6368 0a20 2020  poch = epoch.   
-000106a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000106b0: 2073 656c 662e 6d6f 6465 6c2e 7374 6f70   self.model.stop
-000106c0: 5f74 7261 696e 696e 6720 3d20 5472 7565  _training = True
-000106d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000106e0: 2063 7572 7265 6e74 5f6d 6574 7269 6320   current_metric 
-000106f0: 3d20 6375 7272 656e 745f 310a 2020 2020  = current_1.    
-00010700: 2020 2020 2020 2020 656c 6966 2027 6c6f          elif 'lo
-00010710: 7373 2720 696e 2073 656c 662e 6d6f 6e69  ss' in self.moni
-00010720: 746f 7231 2061 6e64 2027 6c6f 7373 2720  tor1 and 'loss' 
-00010730: 6e6f 7420 696e 2073 656c 662e 6d6f 6e69  not in self.moni
-00010740: 746f 7232 3a0a 2020 2020 2020 2020 2020  tor2:.          
-00010750: 2020 2020 2020 6966 206e 702e 6c65 7373        if np.less
-00010760: 5f65 7175 616c 2863 7572 7265 6e74 5f31  _equal(current_1
-00010770: 2c20 7365 6c66 2e6d 6f6e 6974 6f72 315f  , self.monitor1_
-00010780: 7468 7265 7368 2920 6f72 206e 702e 6772  thresh) or np.gr
-00010790: 6561 7465 7228 6375 7272 656e 745f 322c  eater(current_2,
-000107a0: 2073 656c 662e 6d6f 6e69 746f 7232 5f74   self.monitor2_t
-000107b0: 6872 6573 6829 3a0a 2020 2020 2020 2020  hresh):.        
-000107c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000107d0: 2e73 746f 7070 6564 5f65 706f 6368 203d  .stopped_epoch =
-000107e0: 2065 706f 6368 0a20 2020 2020 2020 2020   epoch.         
-000107f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00010800: 6d6f 6465 6c2e 7374 6f70 5f74 7261 696e  model.stop_train
-00010810: 696e 6720 3d20 5472 7565 0a20 2020 2020  ing = True.     
-00010820: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00010830: 6e74 5f6d 6574 7269 6320 3d20 6375 7272  nt_metric = curr
-00010840: 656e 745f 310a 2020 2020 2020 2020 2020  ent_1.          
-00010850: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00010860: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00010870: 6c75 6545 7272 6f72 2827 496e 7661 6c69  lueError('Invali
-00010880: 6420 6d6f 6e69 746f 7220 696e 7075 742e  d monitor input.
-00010890: 2729 0a20 2020 2020 2020 2020 2020 200a  ').            .
-000108a0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-000108b0: 7572 7265 6e74 5f6d 6574 7269 6320 3c20  urrent_metric < 
-000108c0: 7365 6c66 2e62 6573 745f 6d65 7472 6963  self.best_metric
-000108d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000108e0: 2020 7365 6c66 2e62 6573 745f 6d65 7472    self.best_metr
-000108f0: 6963 203d 2063 7572 7265 6e74 5f6d 6574  ic = current_met
-00010900: 7269 630a 2020 2020 2020 2020 2020 2020  ric.            
-00010910: 2020 2020 7365 6c66 2e62 6573 745f 7765      self.best_we
-00010920: 6967 6874 7320 3d20 7365 6c66 2e6d 6f64  ights = self.mod
-00010930: 656c 2e67 6574 5f77 6569 6768 7473 2829  el.get_weights()
-00010940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010950: 200a 2020 2020 2020 2020 656c 7365 3a0a   .        else:.
-00010960: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00010970: 656e 745f 6d65 7472 6963 203d 206c 6f67  ent_metric = log
-00010980: 732e 6765 7428 7365 6c66 2e6d 6f6e 6974  s.get(self.monit
-00010990: 6f72 3129 0a20 2020 2020 2020 2020 2020  or1).           
-000109a0: 2069 6620 276c 6f73 7327 206e 6f74 2069   if 'loss' not i
-000109b0: 6e20 7365 6c66 2e6d 6f6e 6974 6f72 313a  n self.monitor1:
-000109c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000109d0: 2069 6620 6e70 2e67 7265 6174 6572 2863   if np.greater(c
-000109e0: 7572 7265 6e74 5f6d 6574 7269 632c 2073  urrent_metric, s
-000109f0: 656c 662e 6d6f 6e69 746f 7231 5f74 6872  elf.monitor1_thr
-00010a00: 6573 6829 3a0a 2020 2020 2020 2020 2020  esh):.          
-00010a10: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00010a20: 746f 7070 6564 5f65 706f 6368 203d 2065  topped_epoch = e
-00010a30: 706f 6368 0a20 2020 2020 2020 2020 2020  poch.           
-00010a40: 2020 2020 2020 2020 2073 656c 662e 6d6f           self.mo
-00010a50: 6465 6c2e 7374 6f70 5f74 7261 696e 696e  del.stop_trainin
-00010a60: 6720 3d20 5472 7565 0a20 2020 2020 2020  g = True.       
-00010a70: 2020 2020 2020 2020 2069 6620 6375 7272           if curr
-00010a80: 656e 745f 6d65 7472 6963 203c 2073 656c  ent_metric < sel
-00010a90: 662e 6265 7374 5f6d 6574 7269 633a 0a20  f.best_metric:. 
-00010aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ab0: 2020 2073 656c 662e 6265 7374 5f6d 6574     self.best_met
-00010ac0: 7269 6320 3d20 6375 7272 656e 745f 6d65  ric = current_me
-00010ad0: 7472 6963 0a20 2020 2020 2020 2020 2020  tric.           
-00010ae0: 2020 2020 2020 2020 2073 656c 662e 6265           self.be
-00010af0: 7374 5f77 6569 6768 7473 203d 2073 656c  st_weights = sel
-00010b00: 662e 6d6f 6465 6c2e 6765 745f 7765 6967  f.model.get_weig
-00010b10: 6874 7328 290a 2020 2020 2020 2020 2020  hts().          
-00010b20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00010b30: 2020 2020 2020 2020 6966 206e 702e 6c65          if np.le
-00010b40: 7373 5f65 7175 616c 2863 7572 7265 6e74  ss_equal(current
-00010b50: 5f6d 6574 7269 632c 2073 656c 662e 6d6f  _metric, self.mo
-00010b60: 6e69 746f 7231 5f74 6872 6573 6829 3a0a  nitor1_thresh):.
+0000d860: 2020 2063 6c61 7373 5f31 2e61 7070 656e     class_1.appen
+0000d870: 6428 6461 7461 5f70 726f 6365 7373 696e  d(data_processin
+0000d880: 672e 636f 6e63 6174 5f63 6861 6e6e 656c  g.concat_channel
+0000d890: 7328 6175 676d 656e 7465 645f 696d 6167  s(augmented_imag
+0000d8a0: 6573 5b30 5d5b 695d 2c20 6175 676d 656e  es[0][i], augmen
+0000d8b0: 7465 645f 696d 6167 6573 5b31 5d5b 695d  ted_images[1][i]
+0000d8c0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0000d8d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000d8e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d8f0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0000d900: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
+0000d910: 6175 676d 656e 7465 645f 696d 6167 6573  augmented_images
+0000d920: 5b30 5d29 293a 0a20 2020 2020 2020 2020  [0])):.         
+0000d930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d940: 2020 2020 2020 2063 6c61 7373 5f31 2e61         class_1.a
+0000d950: 7070 656e 6428 6461 7461 5f70 726f 6365  ppend(data_proce
+0000d960: 7373 696e 672e 636f 6e63 6174 5f63 6861  ssing.concat_cha
+0000d970: 6e6e 656c 7328 6175 676d 656e 7465 645f  nnels(augmented_
+0000d980: 696d 6167 6573 5b30 5d5b 695d 2c20 6175  images[0][i], au
+0000d990: 676d 656e 7465 645f 696d 6167 6573 5b31  gmented_images[1
+0000d9a0: 5d5b 695d 2c20 6175 676d 656e 7465 645f  ][i], augmented_
+0000d9b0: 696d 6167 6573 5b32 5d5b 695d 2929 0a20  images[2][i])). 
+0000d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9d0: 2020 2020 2020 2063 6c61 7373 5f31 203d         class_1 =
+0000d9e0: 206e 702e 6172 7261 7928 636c 6173 735f   np.array(class_
+0000d9f0: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+0000da00: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000da10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da20: 2020 2020 2063 6c61 7373 5f31 203d 2061       class_1 = a
+0000da30: 7567 6d65 6e74 6564 5f69 6d61 6765 730a  ugmented_images.
+0000da40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000da50: 2020 2020 2023 5065 7266 6f72 6d20 7361       #Perform sa
+0000da60: 6d65 2061 7567 6d65 6e74 6174 696f 6e20  me augmentation 
+0000da70: 7465 6368 6e69 7175 6573 206f 6e20 6e65  techniques on ne
+0000da80: 6761 7469 7665 2063 6c61 7373 2064 6174  gative class dat
+0000da90: 612c 2062 6174 6368 5f6f 7468 6572 3d31  a, batch_other=1
+0000daa0: 2062 7920 6465 6661 756c 740a 2020 2020   by default.    
+0000dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dac0: 6966 2073 656c 662e 696d 675f 6e75 6d5f  if self.img_num_
+0000dad0: 6368 616e 6e65 6c73 203d 3d20 313a 0a20  channels == 1:. 
+0000dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000daf0: 2020 2020 2020 2063 6861 6e6e 656c 312c         channel1,
+0000db00: 2063 6861 6e6e 656c 322c 2063 6861 6e6e   channel2, chann
+0000db10: 656c 3320 3d20 636f 7079 2e64 6565 7063  el3 = copy.deepc
+0000db20: 6f70 7928 636c 6173 735f 3229 2c20 4e6f  opy(class_2), No
+0000db30: 6e65 2c20 4e6f 6e65 200a 2020 2020 2020  ne, None .      
+0000db40: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000db50: 6966 2073 656c 662e 696d 675f 6e75 6d5f  if self.img_num_
+0000db60: 6368 616e 6e65 6c73 203d 3d20 323a 0a20  channels == 2:. 
+0000db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db80: 2020 2020 2020 2063 6861 6e6e 656c 312c         channel1,
+0000db90: 2063 6861 6e6e 656c 322c 2063 6861 6e6e   channel2, chann
+0000dba0: 656c 3320 3d20 636f 7079 2e64 6565 7063  el3 = copy.deepc
+0000dbb0: 6f70 7928 636c 6173 735f 325b 3a2c 3a2c  opy(class_2[:,:,
+0000dbc0: 3a2c 305d 292c 2063 6f70 792e 6465 6570  :,0]), copy.deep
+0000dbd0: 636f 7079 2863 6c61 7373 5f32 5b3a 2c3a  copy(class_2[:,:
+0000dbe0: 2c3a 2c31 5d29 2c20 4e6f 6e65 200a 2020  ,:,1]), None .  
+0000dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc00: 2020 656c 6966 2073 656c 662e 696d 675f    elif self.img_
+0000dc10: 6e75 6d5f 6368 616e 6e65 6c73 203d 3d20  num_channels == 
+0000dc20: 333a 0a20 2020 2020 2020 2020 2020 2020  3:.             
+0000dc30: 2020 2020 2020 2020 2020 2063 6861 6e6e             chann
+0000dc40: 656c 312c 2063 6861 6e6e 656c 322c 2063  el1, channel2, c
+0000dc50: 6861 6e6e 656c 3320 3d20 636f 7079 2e64  hannel3 = copy.d
+0000dc60: 6565 7063 6f70 7928 636c 6173 735f 325b  eepcopy(class_2[
+0000dc70: 3a2c 3a2c 3a2c 305d 292c 2063 6f70 792e  :,:,:,0]), copy.
+0000dc80: 6465 6570 636f 7079 2863 6c61 7373 5f32  deepcopy(class_2
+0000dc90: 5b3a 2c3a 2c3a 2c31 5d29 2c20 636f 7079  [:,:,:,1]), copy
+0000dca0: 2e64 6565 7063 6f70 7928 636c 6173 735f  .deepcopy(class_
+0000dcb0: 325b 3a2c 3a2c 3a2c 325d 290a 2020 2020  2[:,:,:,2]).    
+0000dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dcd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dce0: 2020 2020 2061 7567 6d65 6e74 6564 5f69       augmented_i
+0000dcf0: 6d61 6765 735f 6e65 6761 7469 7665 203d  mages_negative =
+0000dd00: 2061 7567 6d65 6e74 6174 696f 6e28 6368   augmentation(ch
+0000dd10: 616e 6e65 6c31 3d63 6861 6e6e 656c 312c  annel1=channel1,
+0000dd20: 2063 6861 6e6e 656c 323d 6368 616e 6e65   channel2=channe
+0000dd30: 6c32 2c20 6368 616e 6e65 6c33 3d63 6861  l2, channel3=cha
+0000dd40: 6e6e 656c 332c 2062 6174 6368 3d73 656c  nnel3, batch=sel
+0000dd50: 662e 6261 7463 685f 6f74 6865 722c 200a  f.batch_other, .
+0000dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd70: 2020 2020 2020 2020 7769 6474 685f 7368          width_sh
+0000dd80: 6966 743d 7365 6c66 2e73 6869 6674 2c20  ift=self.shift, 
+0000dd90: 6865 6967 6874 5f73 6869 6674 3d73 656c  height_shift=sel
+0000dda0: 662e 7368 6966 742c 2068 6f72 697a 6f6e  f.shift, horizon
+0000ddb0: 7461 6c3d 686f 7269 7a6f 6e74 616c 2c20  tal=horizontal, 
+0000ddc0: 7665 7274 6963 616c 3d76 6572 7469 6361  vertical=vertica
+0000ddd0: 6c2c 2072 6f74 6174 696f 6e3d 726f 7461  l, rotation=rota
+0000dde0: 7469 6f6e 2c20 0a20 2020 2020 2020 2020  tion, .         
+0000ddf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000de00: 6d61 6765 5f73 697a 653d 696d 6167 655f  mage_size=image_
+0000de10: 7369 7a65 2c20 6d61 736b 5f73 697a 653d  size, mask_size=
+0000de20: 7365 6c66 2e6d 6173 6b5f 7369 7a65 2c20  self.mask_size, 
+0000de30: 6e75 6d5f 6d61 736b 733d 7365 6c66 2e6e  num_masks=self.n
+0000de40: 756d 5f6d 6173 6b73 2c20 626c 656e 645f  um_masks, blend_
+0000de50: 6d75 6c74 6970 6c69 6572 3d73 656c 662e  multiplier=self.
+0000de60: 626c 656e 645f 6f74 6865 722c 200a 2020  blend_other, .  
+0000de70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de80: 2020 2020 2020 626c 656e 6469 6e67 5f66        blending_f
+0000de90: 756e 633d 7365 6c66 2e62 6c65 6e64 696e  unc=self.blendin
+0000dea0: 675f 6675 6e63 2c20 6e75 6d5f 696d 6167  g_func, num_imag
+0000deb0: 6573 5f74 6f5f 626c 656e 643d 7365 6c66  es_to_blend=self
+0000dec0: 2e6e 756d 5f69 6d61 6765 735f 746f 5f62  .num_images_to_b
+0000ded0: 6c65 6e64 2c20 7a6f 6f6d 5f72 616e 6765  lend, zoom_range
+0000dee0: 3d73 656c 662e 7a6f 6f6d 5f72 616e 6765  =self.zoom_range
+0000def0: 2c20 736b 6577 5f61 6e67 6c65 3d73 6b65  , skew_angle=ske
+0000df00: 775f 616e 676c 6529 0a0a 2020 2020 2020  w_angle)..      
+0000df10: 2020 2020 2020 2020 2020 2020 2020 2354                #T
+0000df20: 6865 2061 7567 6d65 6e74 6174 696f 6e20  he augmentation 
+0000df30: 726f 7574 696e 6520 7265 7475 726e 7320  routine returns 
+0000df40: 616e 206f 7574 7075 7420 666f 7220 6561  an output for ea
+0000df50: 6368 2066 696c 7465 722c 2065 2e67 2e20  ch filter, e.g. 
+0000df60: 3320 6f75 7470 7574 7320 666f 7220 5247  3 outputs for RG
+0000df70: 420a 2020 2020 2020 2020 2020 2020 2020  B.              
+0000df80: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
+0000df90: 675f 6e75 6d5f 6368 616e 6e65 6c73 203e  g_num_channels >
+0000dfa0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0000dfb0: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+0000dfc0: 735f 323d 5b5d 0a20 2020 2020 2020 2020  s_2=[].         
+0000dfd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000dfe0: 6620 7365 6c66 2e69 6d67 5f6e 756d 5f63  f self.img_num_c
+0000dff0: 6861 6e6e 656c 7320 3d3d 2032 3a0a 2020  hannels == 2:.  
+0000e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e010: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+0000e020: 696e 2072 616e 6765 286c 656e 2861 7567  in range(len(aug
+0000e030: 6d65 6e74 6564 5f69 6d61 6765 735f 6e65  mented_images_ne
+0000e040: 6761 7469 7665 5b30 5d29 293a 0a20 2020  gative[0])):.   
+0000e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e060: 2020 2020 2020 2020 2020 2020 2063 6c61               cla
+0000e070: 7373 5f32 2e61 7070 656e 6428 6461 7461  ss_2.append(data
+0000e080: 5f70 726f 6365 7373 696e 672e 636f 6e63  _processing.conc
+0000e090: 6174 5f63 6861 6e6e 656c 7328 6175 676d  at_channels(augm
+0000e0a0: 656e 7465 645f 696d 6167 6573 5f6e 6567  ented_images_neg
+0000e0b0: 6174 6976 655b 305d 5b69 5d2c 2061 7567  ative[0][i], aug
+0000e0c0: 6d65 6e74 6564 5f69 6d61 6765 735f 6e65  mented_images_ne
+0000e0d0: 6761 7469 7665 5b31 5d5b 695d 2929 0a20  gative[1][i])). 
+0000e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000e100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e110: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+0000e120: 6e20 7261 6e67 6528 6c65 6e28 6175 676d  n range(len(augm
+0000e130: 656e 7465 645f 696d 6167 6573 5f6e 6567  ented_images_neg
+0000e140: 6174 6976 655b 305d 2929 3a0a 2020 2020  ative[0])):.    
+0000e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e160: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+0000e170: 735f 322e 6170 7065 6e64 2864 6174 615f  s_2.append(data_
+0000e180: 7072 6f63 6573 7369 6e67 2e63 6f6e 6361  processing.conca
+0000e190: 745f 6368 616e 6e65 6c73 2861 7567 6d65  t_channels(augme
+0000e1a0: 6e74 6564 5f69 6d61 6765 735f 6e65 6761  nted_images_nega
+0000e1b0: 7469 7665 5b30 5d5b 695d 2c20 6175 676d  tive[0][i], augm
+0000e1c0: 656e 7465 645f 696d 6167 6573 5f6e 6567  ented_images_neg
+0000e1d0: 6174 6976 655b 315d 5b69 5d2c 2061 7567  ative[1][i], aug
+0000e1e0: 6d65 6e74 6564 5f69 6d61 6765 735f 6e65  mented_images_ne
+0000e1f0: 6761 7469 7665 5b32 5d5b 695d 2929 0a20  gative[2][i])). 
+0000e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e210: 2020 2020 2020 2063 6c61 7373 5f32 203d         class_2 =
+0000e220: 206e 702e 6172 7261 7928 636c 6173 735f   np.array(class_
+0000e230: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
+0000e240: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e260: 2020 2020 2063 6c61 7373 5f32 203d 2061       class_2 = a
+0000e270: 7567 6d65 6e74 6564 5f69 6d61 6765 735f  ugmented_images_
+0000e280: 6e65 6761 7469 7665 0a0a 2020 2020 2020  negative..      
+0000e290: 2020 2020 2020 2020 2020 2020 2020 2342                #B
+0000e2a0: 616c 616e 6365 2074 6865 2063 6c61 7373  alance the class
+0000e2b0: 2073 697a 6573 2069 6620 6e65 6365 7373   sizes if necess
+0000e2c0: 6172 790a 2020 2020 2020 2020 2020 2020  ary.            
+0000e2d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000e2e0: 6261 6c61 6e63 653a 0a20 2020 2020 2020  balance:.       
+0000e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e300: 2069 6620 7365 6c66 2e62 6174 6368 5f6f   if self.batch_o
+0000e310: 7468 6572 203e 2031 3a20 234d 7573 7420  ther > 1: #Must 
+0000e320: 7368 7566 666c 6521 2121 0a20 2020 2020  shuffle!!!.     
+0000e330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e340: 2020 2020 2020 2069 7820 3d20 6e70 2e72         ix = np.r
+0000e350: 616e 646f 6d2e 7065 726d 7574 6174 696f  andom.permutatio
+0000e360: 6e28 6c65 6e28 636c 6173 735f 3229 290a  n(len(class_2)).
+0000e370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e380: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+0000e390: 735f 3220 3d20 636c 6173 735f 325b 6978  s_2 = class_2[ix
+0000e3a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000e3b0: 2020 2020 2020 2020 2020 636c 6173 735f            class_
+0000e3c0: 3220 3d20 636c 6173 735f 325b 3a6c 656e  2 = class_2[:len
+0000e3d0: 2863 6c61 7373 5f31 295d 2020 200a 0a20  (class_1)]   .. 
+0000e3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3f0: 2020 2069 6620 7365 6c66 2e69 6d67 5f6e     if self.img_n
+0000e400: 756d 5f63 6861 6e6e 656c 7320 3d3d 2031  um_channels == 1
+0000e410: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000e420: 2020 2020 2020 2020 2020 636c 6173 735f            class_
+0000e430: 3220 3d20 7265 7369 7a65 2863 6c61 7373  2 = resize(class
+0000e440: 5f32 2c20 7369 7a65 3d69 6d61 6765 5f73  _2, size=image_s
+0000e450: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
+0000e460: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e480: 2020 2020 2020 2063 6861 6e6e 656c 3120         channel1 
+0000e490: 3d20 7265 7369 7a65 2863 6c61 7373 5f32  = resize(class_2
+0000e4a0: 5b3a 2c3a 2c3a 2c30 5d2c 2073 697a 653d  [:,:,:,0], size=
+0000e4b0: 696d 6167 655f 7369 7a65 290a 2020 2020  image_size).    
+0000e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4d0: 2020 2020 6368 616e 6e65 6c32 203d 2072      channel2 = r
+0000e4e0: 6573 697a 6528 636c 6173 735f 325b 3a2c  esize(class_2[:,
+0000e4f0: 3a2c 3a2c 315d 2c20 7369 7a65 3d69 6d61  :,:,1], size=ima
+0000e500: 6765 5f73 697a 6529 0a20 2020 2020 2020  ge_size).       
+0000e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e520: 2069 6620 7365 6c66 2e69 6d67 5f6e 756d   if self.img_num
+0000e530: 5f63 6861 6e6e 656c 7320 3d3d 2032 3a0a  _channels == 2:.
+0000e540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e550: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+0000e560: 735f 3220 3d20 6461 7461 5f70 726f 6365  s_2 = data_proce
+0000e570: 7373 696e 672e 636f 6e63 6174 5f63 6861  ssing.concat_cha
+0000e580: 6e6e 656c 7328 6368 616e 6e65 6c31 2c20  nnels(channel1, 
+0000e590: 6368 616e 6e65 6c32 290a 2020 2020 2020  channel2).      
+0000e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5d0: 2020 2020 6368 616e 6e65 6c33 203d 2072      channel3 = r
+0000e5e0: 6573 697a 6528 636c 6173 735f 325b 3a2c  esize(class_2[:,
+0000e5f0: 3a2c 3a2c 325d 2c20 7369 7a65 3d69 6d61  :,:,2], size=ima
+0000e600: 6765 5f73 697a 6529 0a20 2020 2020 2020  ge_size).       
+0000e610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e620: 2020 2020 2063 6c61 7373 5f32 203d 2064       class_2 = d
+0000e630: 6174 615f 7072 6f63 6573 7369 6e67 2e63  ata_processing.c
+0000e640: 6f6e 6361 745f 6368 616e 6e65 6c73 2863  oncat_channels(c
+0000e650: 6861 6e6e 656c 312c 2063 6861 6e6e 656c  hannel1, channel
+0000e660: 322c 2063 6861 6e6e 656c 3329 0a0a 2020  2, channel3)..  
+0000e670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e680: 2020 6966 2076 616c 5f63 6c61 7373 5f31    if val_class_1
+0000e690: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6b0: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
+0000e6c0: 675f 6e75 6d5f 6368 616e 6e65 6c73 203d  g_num_channels =
+0000e6d0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+0000e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6f0: 2076 616c 5f63 6c61 7373 5f31 203d 2072   val_class_1 = r
+0000e700: 6573 697a 6528 7661 6c5f 636c 6173 735f  esize(val_class_
+0000e710: 312c 2073 697a 653d 696d 6167 655f 7369  1, size=image_si
+0000e720: 7a65 290a 2020 2020 2020 2020 2020 2020  ze).            
+0000e730: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000e740: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000e750: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0000e760: 6c5f 6368 616e 6e65 6c31 203d 2072 6573  l_channel1 = res
+0000e770: 697a 6528 7661 6c5f 636c 6173 735f 315b  ize(val_class_1[
+0000e780: 3a2c 3a2c 3a2c 305d 2c20 7369 7a65 3d69  :,:,:,0], size=i
+0000e790: 6d61 6765 5f73 697a 6529 0a20 2020 2020  mage_size).     
+0000e7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e7b0: 2020 2020 2020 2076 616c 5f63 6861 6e6e         val_chann
+0000e7c0: 656c 3220 3d20 7265 7369 7a65 2876 616c  el2 = resize(val
+0000e7d0: 5f63 6c61 7373 5f31 5b3a 2c3a 2c3a 2c31  _class_1[:,:,:,1
+0000e7e0: 5d2c 2073 697a 653d 696d 6167 655f 7369  ], size=image_si
+0000e7f0: 7a65 290a 2020 2020 2020 2020 2020 2020  ze).            
+0000e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e810: 6966 2073 656c 662e 696d 675f 6e75 6d5f  if self.img_num_
+0000e820: 6368 616e 6e65 6c73 203d 3d20 323a 0a20  channels == 2:. 
+0000e830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e840: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0000e850: 616c 5f63 6c61 7373 5f31 203d 2064 6174  al_class_1 = dat
+0000e860: 615f 7072 6f63 6573 7369 6e67 2e63 6f6e  a_processing.con
+0000e870: 6361 745f 6368 616e 6e65 6c73 2876 616c  cat_channels(val
+0000e880: 5f63 6861 6e6e 656c 312c 2076 616c 5f63  _channel1, val_c
+0000e890: 6861 6e6e 656c 3229 0a20 2020 2020 2020  hannel2).       
+0000e8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e8b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000e8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e8d0: 2020 2020 2020 2020 2020 2076 616c 5f63             val_c
+0000e8e0: 6861 6e6e 656c 3320 3d20 7265 7369 7a65  hannel3 = resize
+0000e8f0: 2876 616c 5f63 6c61 7373 5f31 5b3a 2c3a  (val_class_1[:,:
+0000e900: 2c3a 2c32 5d2c 2073 697a 653d 696d 6167  ,:,2], size=imag
+0000e910: 655f 7369 7a65 290a 2020 2020 2020 2020  e_size).        
+0000e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e930: 2020 2020 2020 2020 7661 6c5f 636c 6173          val_clas
+0000e940: 735f 3120 3d20 6461 7461 5f70 726f 6365  s_1 = data_proce
+0000e950: 7373 696e 672e 636f 6e63 6174 5f63 6861  ssing.concat_cha
+0000e960: 6e6e 656c 7328 7661 6c5f 6368 616e 6e65  nnels(val_channe
+0000e970: 6c31 2c20 7661 6c5f 6368 616e 6e65 6c32  l1, val_channel2
+0000e980: 2c20 7661 6c5f 6368 616e 6e65 6c33 290a  , val_channel3).
+0000e990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e9a0: 2020 2020 2069 6620 7661 6c5f 636c 6173       if val_clas
+0000e9b0: 735f 3220 6973 206e 6f74 204e 6f6e 653a  s_2 is not None:
+0000e9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e9d0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000e9e0: 2e69 6d67 5f6e 756d 5f63 6861 6e6e 656c  .img_num_channel
+0000e9f0: 7320 3d3d 2031 3a0a 2020 2020 2020 2020  s == 1:.        
+0000ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea10: 2020 2020 7661 6c5f 636c 6173 735f 3220      val_class_2 
+0000ea20: 3d20 7265 7369 7a65 2876 616c 5f63 6c61  = resize(val_cla
+0000ea30: 7373 5f32 2c20 7369 7a65 3d69 6d61 6765  ss_2, size=image
+0000ea40: 5f73 697a 6529 0a20 2020 2020 2020 2020  _size).         
+0000ea50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000ea60: 6c69 6620 7365 6c66 2e69 6d67 5f6e 756d  lif self.img_num
+0000ea70: 5f63 6861 6e6e 656c 7320 3e20 313a 0a20  _channels > 1:. 
+0000ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea90: 2020 2020 2020 2020 2020 2076 616c 5f63             val_c
+0000eaa0: 6861 6e6e 656c 3120 3d20 7265 7369 7a65  hannel1 = resize
+0000eab0: 2876 616c 5f63 6c61 7373 5f32 5b3a 2c3a  (val_class_2[:,:
+0000eac0: 2c3a 2c30 5d2c 2073 697a 653d 696d 6167  ,:,0], size=imag
+0000ead0: 655f 7369 7a65 290a 2020 2020 2020 2020  e_size).        
+0000eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eaf0: 2020 2020 7661 6c5f 6368 616e 6e65 6c32      val_channel2
+0000eb00: 203d 2072 6573 697a 6528 7661 6c5f 636c   = resize(val_cl
+0000eb10: 6173 735f 325b 3a2c 3a2c 3a2c 315d 2c20  ass_2[:,:,:,1], 
+0000eb20: 7369 7a65 3d69 6d61 6765 5f73 697a 6529  size=image_size)
+0000eb30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000eb40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000eb50: 7365 6c66 2e69 6d67 5f6e 756d 5f63 6861  self.img_num_cha
+0000eb60: 6e6e 656c 7320 3d3d 2032 3a0a 2020 2020  nnels == 2:.    
+0000eb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb80: 2020 2020 2020 2020 2020 2020 7661 6c5f              val_
+0000eb90: 636c 6173 735f 3220 3d20 6461 7461 5f70  class_2 = data_p
+0000eba0: 726f 6365 7373 696e 672e 636f 6e63 6174  rocessing.concat
+0000ebb0: 5f63 6861 6e6e 656c 7328 7661 6c5f 6368  _channels(val_ch
+0000ebc0: 616e 6e65 6c31 2c20 7661 6c5f 6368 616e  annel1, val_chan
+0000ebd0: 6e65 6c32 290a 2020 2020 2020 2020 2020  nel2).          
+0000ebe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ebf0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec10: 2020 2020 2020 2020 7661 6c5f 6368 616e          val_chan
+0000ec20: 6e65 6c33 203d 2072 6573 697a 6528 7661  nel3 = resize(va
+0000ec30: 6c5f 636c 6173 735f 325b 3a2c 3a2c 3a2c  l_class_2[:,:,:,
+0000ec40: 325d 2c20 7369 7a65 3d69 6d61 6765 5f73  2], size=image_s
+0000ec50: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
+0000ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec70: 2020 2020 2076 616c 5f63 6c61 7373 5f32       val_class_2
+0000ec80: 203d 2064 6174 615f 7072 6f63 6573 7369   = data_processi
+0000ec90: 6e67 2e63 6f6e 6361 745f 6368 616e 6e65  ng.concat_channe
+0000eca0: 6c73 2876 616c 5f63 6861 6e6e 656c 312c  ls(val_channel1,
+0000ecb0: 2076 616c 5f63 6861 6e6e 656c 322c 2076   val_channel2, v
+0000ecc0: 616c 5f63 6861 6e6e 656c 3329 0a0a 2020  al_channel3)..  
+0000ecd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000ece0: 2073 656c 662e 7665 7262 6f73 6520 3d3d   self.verbose ==
+0000ecf0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0000ed00: 2020 2020 2020 2020 7072 696e 7428 293b          print();
+0000ed10: 2070 7269 6e74 2827 2a2a 2a2a 2a2a 2a2a   print('********
+0000ed20: 2a2a 2a20 2043 5620 2d20 7b7d 202a 2a2a  ***  CV - {} ***
+0000ed30: 2a2a 2a2a 2a2a 2a2a 272e 666f 726d 6174  ********'.format
+0000ed40: 286b 2b32 2929 3b20 7072 696e 7428 290a  (k+2)); print().
+0000ed50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ed60: 2063 6c65 6172 5f73 6573 7369 6f6e 2829   clear_session()
+0000ed70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ed80: 2069 6620 7365 6c66 2e6f 7074 5f6d 6f64   if self.opt_mod
+0000ed90: 656c 2069 7320 4661 6c73 653a 0a20 2020  el is False:.   
+0000eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edb0: 2069 6620 7365 6c66 2e63 6c66 203d 3d20   if self.clf == 
+0000edc0: 2761 6c65 786e 6574 273a 0a20 2020 2020  'alexnet':.     
+0000edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ede0: 2020 206d 6f64 656c 2c20 6869 7374 6f72     model, histor
+0000edf0: 7920 3d20 636e 6e5f 6d6f 6465 6c2e 416c  y = cnn_model.Al
+0000ee00: 6578 4e65 7428 636c 6173 735f 312c 2063  exNet(class_1, c
+0000ee10: 6c61 7373 5f32 2c20 696d 675f 6e75 6d5f  lass_2, img_num_
+0000ee20: 6368 616e 6e65 6c73 3d73 656c 662e 696d  channels=self.im
+0000ee30: 675f 6e75 6d5f 6368 616e 6e65 6c73 2c20  g_num_channels, 
+0000ee40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ee50: 2020 2020 2020 2020 2020 2020 206e 6f72               nor
+0000ee60: 6d61 6c69 7a65 3d73 656c 662e 6e6f 726d  malize=self.norm
+0000ee70: 616c 697a 652c 206d 696e 5f70 6978 656c  alize, min_pixel
+0000ee80: 3d6d 696e 5f70 6978 2c20 6d61 785f 7069  =min_pix, max_pi
+0000ee90: 7865 6c3d 6d61 785f 7069 782c 2076 616c  xel=max_pix, val
+0000eea0: 5f70 6f73 6974 6976 653d 7661 6c5f 636c  _positive=val_cl
+0000eeb0: 6173 735f 312c 2076 616c 5f6e 6567 6174  ass_1, val_negat
+0000eec0: 6976 653d 7661 6c5f 636c 6173 735f 322c  ive=val_class_2,
+0000eed0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0000eee0: 2020 2020 2020 2020 2020 2020 2020 6570                ep
+0000eef0: 6f63 6873 3d73 656c 662e 7472 6169 6e5f  ochs=self.train_
+0000ef00: 6570 6f63 6873 2c20 6261 7463 685f 7369  epochs, batch_si
+0000ef10: 7a65 3d62 6174 6368 5f73 697a 652c 206f  ze=batch_size, o
+0000ef20: 7074 696d 697a 6572 3d6f 7074 696d 697a  ptimizer=optimiz
+0000ef30: 6572 2c20 6c72 3d6c 722c 2064 6563 6179  er, lr=lr, decay
+0000ef40: 3d64 6563 6179 2c20 6d6f 6d65 6e74 756d  =decay, momentum
+0000ef50: 3d6d 6f6d 656e 7475 6d2c 206e 6573 7465  =momentum, neste
+0000ef60: 726f 763d 6e65 7374 6572 6f76 2c20 0a20  rov=nesterov, . 
+0000ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef80: 2020 2020 2020 2020 2020 2062 6574 615f             beta_
+0000ef90: 313d 6265 7461 5f31 2c20 6265 7461 5f32  1=beta_1, beta_2
+0000efa0: 3d62 6574 615f 322c 2061 6d73 6772 6164  =beta_2, amsgrad
+0000efb0: 3d61 6d73 6772 6164 2c20 736d 6f74 655f  =amsgrad, smote_
+0000efc0: 7361 6d70 6c69 6e67 3d73 656c 662e 736d  sampling=self.sm
+0000efd0: 6f74 655f 7361 6d70 6c69 6e67 2c20 6561  ote_sampling, ea
+0000efe0: 726c 795f 7374 6f70 5f63 616c 6c62 6163  rly_stop_callbac
+0000eff0: 6b3d 6361 6c6c 6261 636b 732c 2063 6865  k=callbacks, che
+0000f000: 636b 706f 696e 743d 4661 6c73 652c 2076  ckpoint=False, v
+0000f010: 6572 626f 7365 3d73 656c 662e 7665 7262  erbose=self.verb
+0000f020: 6f73 6529 0a20 2020 2020 2020 2020 2020  ose).           
+0000f030: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
+0000f040: 6c66 2e63 6c66 203d 3d20 2763 7573 746f  lf.clf == 'custo
+0000f050: 6d5f 636e 6e27 3a0a 2020 2020 2020 2020  m_cnn':.        
+0000f060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f070: 6d6f 6465 6c2c 2068 6973 746f 7279 203d  model, history =
+0000f080: 2063 6e6e 5f6d 6f64 656c 2e63 7573 746f   cnn_model.custo
+0000f090: 6d5f 6d6f 6465 6c28 636c 6173 735f 312c  m_model(class_1,
+0000f0a0: 2063 6c61 7373 5f32 2c20 696d 675f 6e75   class_2, img_nu
+0000f0b0: 6d5f 6368 616e 6e65 6c73 3d73 656c 662e  m_channels=self.
+0000f0c0: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+0000f0d0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+0000f0e0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000f0f0: 6f72 6d61 6c69 7a65 3d73 656c 662e 6e6f  ormalize=self.no
+0000f100: 726d 616c 697a 652c 206d 696e 5f70 6978  rmalize, min_pix
+0000f110: 656c 3d6d 696e 5f70 6978 2c20 6d61 785f  el=min_pix, max_
+0000f120: 7069 7865 6c3d 6d61 785f 7069 782c 2076  pixel=max_pix, v
+0000f130: 616c 5f70 6f73 6974 6976 653d 7661 6c5f  al_positive=val_
+0000f140: 636c 6173 735f 312c 2076 616c 5f6e 6567  class_1, val_neg
+0000f150: 6174 6976 653d 7661 6c5f 636c 6173 735f  ative=val_class_
+0000f160: 322c 200a 2020 2020 2020 2020 2020 2020  2, .            
+0000f170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f180: 6570 6f63 6873 3d73 656c 662e 7472 6169  epochs=self.trai
+0000f190: 6e5f 6570 6f63 6873 2c20 6261 7463 685f  n_epochs, batch_
+0000f1a0: 7369 7a65 3d62 6174 6368 5f73 697a 652c  size=batch_size,
+0000f1b0: 206f 7074 696d 697a 6572 3d6f 7074 696d   optimizer=optim
+0000f1c0: 697a 6572 2c20 6c72 3d6c 722c 2064 6563  izer, lr=lr, dec
+0000f1d0: 6179 3d64 6563 6179 2c20 6d6f 6d65 6e74  ay=decay, moment
+0000f1e0: 756d 3d6d 6f6d 656e 7475 6d2c 206e 6573  um=momentum, nes
+0000f1f0: 7465 726f 763d 6e65 7374 6572 6f76 2c20  terov=nesterov, 
+0000f200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f210: 2020 2020 2020 2020 2020 2020 2062 6574               bet
+0000f220: 615f 313d 6265 7461 5f31 2c20 6265 7461  a_1=beta_1, beta
+0000f230: 5f32 3d62 6574 615f 322c 2061 6d73 6772  _2=beta_2, amsgr
+0000f240: 6164 3d61 6d73 6772 6164 2c20 736d 6f74  ad=amsgrad, smot
+0000f250: 655f 7361 6d70 6c69 6e67 3d73 656c 662e  e_sampling=self.
+0000f260: 736d 6f74 655f 7361 6d70 6c69 6e67 2c20  smote_sampling, 
+0000f270: 6561 726c 795f 7374 6f70 5f63 616c 6c62  early_stop_callb
+0000f280: 6163 6b3d 6361 6c6c 6261 636b 732c 2063  ack=callbacks, c
+0000f290: 6865 636b 706f 696e 743d 4661 6c73 652c  heckpoint=False,
+0000f2a0: 2076 6572 626f 7365 3d73 656c 662e 7665   verbose=self.ve
+0000f2b0: 7262 6f73 6529 0a20 2020 2020 2020 2020  rbose).         
+0000f2c0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0000f2d0: 7365 6c66 2e63 6c66 203d 3d20 2776 6767  self.clf == 'vgg
+0000f2e0: 3136 273a 0a20 2020 2020 2020 2020 2020  16':.           
+0000f2f0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0000f300: 656c 2c20 6869 7374 6f72 7920 3d20 636e  el, history = cn
+0000f310: 6e5f 6d6f 6465 6c2e 5647 4731 3628 636c  n_model.VGG16(cl
+0000f320: 6173 735f 312c 2063 6c61 7373 5f32 2c20  ass_1, class_2, 
+0000f330: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+0000f340: 3d73 656c 662e 696d 675f 6e75 6d5f 6368  =self.img_num_ch
+0000f350: 616e 6e65 6c73 2c20 0a20 2020 2020 2020  annels, .       
+0000f360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f370: 2020 2020 206e 6f72 6d61 6c69 7a65 3d73       normalize=s
+0000f380: 656c 662e 6e6f 726d 616c 697a 652c 206d  elf.normalize, m
+0000f390: 696e 5f70 6978 656c 3d6d 696e 5f70 6978  in_pixel=min_pix
+0000f3a0: 2c20 6d61 785f 7069 7865 6c3d 6d61 785f  , max_pixel=max_
+0000f3b0: 7069 782c 2076 616c 5f70 6f73 6974 6976  pix, val_positiv
+0000f3c0: 653d 7661 6c5f 636c 6173 735f 312c 2076  e=val_class_1, v
+0000f3d0: 616c 5f6e 6567 6174 6976 653d 7661 6c5f  al_negative=val_
+0000f3e0: 636c 6173 735f 322c 200a 2020 2020 2020  class_2, .      
+0000f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f400: 2020 2020 2020 6570 6f63 6873 3d73 656c        epochs=sel
+0000f410: 662e 7472 6169 6e5f 6570 6f63 6873 2c20  f.train_epochs, 
+0000f420: 6261 7463 685f 7369 7a65 3d62 6174 6368  batch_size=batch
+0000f430: 5f73 697a 652c 206f 7074 696d 697a 6572  _size, optimizer
+0000f440: 3d6f 7074 696d 697a 6572 2c20 6c72 3d6c  =optimizer, lr=l
+0000f450: 722c 2064 6563 6179 3d64 6563 6179 2c20  r, decay=decay, 
+0000f460: 6d6f 6d65 6e74 756d 3d6d 6f6d 656e 7475  momentum=momentu
+0000f470: 6d2c 206e 6573 7465 726f 763d 6e65 7374  m, nesterov=nest
+0000f480: 6572 6f76 2c20 0a20 2020 2020 2020 2020  erov, .         
+0000f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4a0: 2020 2062 6574 615f 313d 6265 7461 5f31     beta_1=beta_1
+0000f4b0: 2c20 6265 7461 5f32 3d62 6574 615f 322c  , beta_2=beta_2,
+0000f4c0: 2061 6d73 6772 6164 3d61 6d73 6772 6164   amsgrad=amsgrad
+0000f4d0: 2c20 736d 6f74 655f 7361 6d70 6c69 6e67  , smote_sampling
+0000f4e0: 3d73 656c 662e 736d 6f74 655f 7361 6d70  =self.smote_samp
+0000f4f0: 6c69 6e67 2c20 6561 726c 795f 7374 6f70  ling, early_stop
+0000f500: 5f63 616c 6c62 6163 6b3d 6361 6c6c 6261  _callback=callba
+0000f510: 636b 732c 2063 6865 636b 706f 696e 743d  cks, checkpoint=
+0000f520: 4661 6c73 652c 2076 6572 626f 7365 3d73  False, verbose=s
+0000f530: 656c 662e 7665 7262 6f73 6529 0a20 2020  elf.verbose).   
+0000f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f550: 2065 6c69 6620 7365 6c66 2e63 6c66 203d   elif self.clf =
+0000f560: 3d20 2772 6573 6e65 7431 3827 3a0a 2020  = 'resnet18':.  
+0000f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f580: 2020 2020 2020 6d6f 6465 6c2c 2068 6973        model, his
+0000f590: 746f 7279 203d 2063 6e6e 5f6d 6f64 656c  tory = cnn_model
+0000f5a0: 2e52 6573 6e65 7431 3828 636c 6173 735f  .Resnet18(class_
+0000f5b0: 312c 2063 6c61 7373 5f32 2c20 696d 675f  1, class_2, img_
+0000f5c0: 6e75 6d5f 6368 616e 6e65 6c73 3d73 656c  num_channels=sel
+0000f5d0: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
+0000f5e0: 6c73 2c20 0a20 2020 2020 2020 2020 2020  ls, .           
+0000f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f600: 206e 6f72 6d61 6c69 7a65 3d73 656c 662e   normalize=self.
+0000f610: 6e6f 726d 616c 697a 652c 206d 696e 5f70  normalize, min_p
+0000f620: 6978 656c 3d6d 696e 5f70 6978 2c20 6d61  ixel=min_pix, ma
+0000f630: 785f 7069 7865 6c3d 6d61 785f 7069 782c  x_pixel=max_pix,
+0000f640: 2076 616c 5f70 6f73 6974 6976 653d 7661   val_positive=va
+0000f650: 6c5f 636c 6173 735f 312c 2076 616c 5f6e  l_class_1, val_n
+0000f660: 6567 6174 6976 653d 7661 6c5f 636c 6173  egative=val_clas
+0000f670: 735f 322c 200a 2020 2020 2020 2020 2020  s_2, .          
+0000f680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f690: 2020 6570 6f63 6873 3d73 656c 662e 7472    epochs=self.tr
+0000f6a0: 6169 6e5f 6570 6f63 6873 2c20 6261 7463  ain_epochs, batc
+0000f6b0: 685f 7369 7a65 3d62 6174 6368 5f73 697a  h_size=batch_siz
+0000f6c0: 652c 206f 7074 696d 697a 6572 3d6f 7074  e, optimizer=opt
+0000f6d0: 696d 697a 6572 2c20 6c72 3d6c 722c 2064  imizer, lr=lr, d
+0000f6e0: 6563 6179 3d64 6563 6179 2c20 6d6f 6d65  ecay=decay, mome
+0000f6f0: 6e74 756d 3d6d 6f6d 656e 7475 6d2c 206e  ntum=momentum, n
+0000f700: 6573 7465 726f 763d 6e65 7374 6572 6f76  esterov=nesterov
+0000f710: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+0000f720: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000f730: 6574 615f 313d 6265 7461 5f31 2c20 6265  eta_1=beta_1, be
+0000f740: 7461 5f32 3d62 6574 615f 322c 2061 6d73  ta_2=beta_2, ams
+0000f750: 6772 6164 3d61 6d73 6772 6164 2c20 736d  grad=amsgrad, sm
+0000f760: 6f74 655f 7361 6d70 6c69 6e67 3d73 656c  ote_sampling=sel
+0000f770: 662e 736d 6f74 655f 7361 6d70 6c69 6e67  f.smote_sampling
+0000f780: 2c20 6561 726c 795f 7374 6f70 5f63 616c  , early_stop_cal
+0000f790: 6c62 6163 6b3d 6361 6c6c 6261 636b 732c  lback=callbacks,
+0000f7a0: 2063 6865 636b 706f 696e 743d 4661 6c73   checkpoint=Fals
+0000f7b0: 652c 2076 6572 626f 7365 3d73 656c 662e  e, verbose=self.
+0000f7c0: 7665 7262 6f73 6529 0a20 2020 2020 2020  verbose).       
+0000f7d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000f7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f7f0: 2020 2069 6620 7365 6c66 2e63 6c66 203d     if self.clf =
+0000f800: 3d20 2761 6c65 786e 6574 273a 0a20 2020  = 'alexnet':.   
+0000f810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f820: 2020 2020 2069 6620 7365 6c66 2e6c 696d       if self.lim
+0000f830: 6974 5f73 6561 7263 683a 0a20 2020 2020  it_search:.     
+0000f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f850: 2020 2020 2020 206d 6f64 656c 2c20 6869         model, hi
+0000f860: 7374 6f72 7920 3d20 636e 6e5f 6d6f 6465  story = cnn_mode
+0000f870: 6c2e 416c 6578 4e65 7428 636c 6173 735f  l.AlexNet(class_
+0000f880: 312c 2063 6c61 7373 5f32 2c20 696d 675f  1, class_2, img_
+0000f890: 6e75 6d5f 6368 616e 6e65 6c73 3d73 656c  num_channels=sel
+0000f8a0: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
+0000f8b0: 6c73 2c20 0a20 2020 2020 2020 2020 2020  ls, .           
+0000f8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8d0: 2020 2020 206e 6f72 6d61 6c69 7a65 3d73       normalize=s
+0000f8e0: 656c 662e 6e6f 726d 616c 697a 652c 206d  elf.normalize, m
+0000f8f0: 696e 5f70 6978 656c 3d6d 696e 5f70 6978  in_pixel=min_pix
+0000f900: 2c20 6d61 785f 7069 7865 6c3d 6d61 785f  , max_pixel=max_
+0000f910: 7069 782c 2076 616c 5f70 6f73 6974 6976  pix, val_positiv
+0000f920: 653d 7661 6c5f 636c 6173 735f 312c 2076  e=val_class_1, v
+0000f930: 616c 5f6e 6567 6174 6976 653d 7661 6c5f  al_negative=val_
+0000f940: 636c 6173 735f 322c 200a 2020 2020 2020  class_2, .      
+0000f950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f960: 2020 2020 2020 2020 2020 6570 6f63 6873            epochs
+0000f970: 3d73 656c 662e 7472 6169 6e5f 6570 6f63  =self.train_epoc
+0000f980: 6873 2c20 6261 7463 685f 7369 7a65 3d62  hs, batch_size=b
+0000f990: 6174 6368 5f73 697a 652c 206f 7074 696d  atch_size, optim
+0000f9a0: 697a 6572 3d6f 7074 696d 697a 6572 2c20  izer=optimizer, 
+0000f9b0: 6c72 3d6c 722c 2064 6563 6179 3d64 6563  lr=lr, decay=dec
+0000f9c0: 6179 2c20 6d6f 6d65 6e74 756d 3d6d 6f6d  ay, momentum=mom
+0000f9d0: 656e 7475 6d2c 206e 6573 7465 726f 763d  entum, nesterov=
+0000f9e0: 6e65 7374 6572 6f76 2c20 0a20 2020 2020  nesterov, .     
+0000f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa00: 2020 2020 2020 2020 2020 2062 6574 615f             beta_
+0000fa10: 313d 6265 7461 5f31 2c20 6265 7461 5f32  1=beta_1, beta_2
+0000fa20: 3d62 6574 615f 322c 2061 6d73 6772 6164  =beta_2, amsgrad
+0000fa30: 3d61 6d73 6772 6164 2c20 6c6f 7373 3d6c  =amsgrad, loss=l
+0000fa40: 6f73 732c 2061 6374 6976 6174 696f 6e5f  oss, activation_
+0000fa50: 636f 6e76 3d61 6374 6976 6174 696f 6e5f  conv=activation_
+0000fa60: 636f 6e76 2c20 6163 7469 7661 7469 6f6e  conv, activation
+0000fa70: 5f64 656e 7365 3d61 6374 6976 6174 696f  _dense=activatio
+0000fa80: 6e5f 6465 6e73 652c 200a 2020 2020 2020  n_dense, .      
+0000fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000faa0: 2020 2020 2020 2020 2020 636f 6e76 5f69            conv_i
+0000fab0: 6e69 743d 636f 6e76 5f69 6e69 742c 2064  nit=conv_init, d
+0000fac0: 656e 7365 5f69 6e69 743d 6465 6e73 655f  ense_init=dense_
+0000fad0: 696e 6974 2c20 6d6f 6465 6c5f 7265 673d  init, model_reg=
+0000fae0: 6d6f 6465 6c5f 7265 672c 2070 6f6f 6c69  model_reg, pooli
+0000faf0: 6e67 5f31 3d70 6f6f 6c69 6e67 5f31 2c20  ng_1=pooling_1, 
+0000fb00: 706f 6f6c 696e 675f 323d 706f 6f6c 696e  pooling_2=poolin
+0000fb10: 675f 322c 2070 6f6f 6c69 6e67 5f33 3d70  g_2, pooling_3=p
+0000fb20: 6f6f 6c69 6e67 5f33 2c20 0a20 2020 2020  ooling_3, .     
+0000fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb40: 2020 2020 2020 2020 2020 2073 6d6f 7465             smote
+0000fb50: 5f73 616d 706c 696e 673d 7365 6c66 2e73  _sampling=self.s
+0000fb60: 6d6f 7465 5f73 616d 706c 696e 672c 2065  mote_sampling, e
+0000fb70: 6172 6c79 5f73 746f 705f 6361 6c6c 6261  arly_stop_callba
+0000fb80: 636b 3d63 616c 6c62 6163 6b73 2c20 6368  ck=callbacks, ch
+0000fb90: 6563 6b70 6f69 6e74 3d46 616c 7365 2c20  eckpoint=False, 
+0000fba0: 7665 7262 6f73 653d 7365 6c66 2e76 6572  verbose=self.ver
+0000fbb0: 626f 7365 290a 2020 2020 2020 2020 2020  bose).          
+0000fbc0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000fbd0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000fbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fbf0: 6d6f 6465 6c2c 2068 6973 746f 7279 203d  model, history =
+0000fc00: 2063 6e6e 5f6d 6f64 656c 2e41 6c65 784e   cnn_model.AlexN
+0000fc10: 6574 2863 6c61 7373 5f31 2c20 636c 6173  et(class_1, clas
+0000fc20: 735f 322c 2069 6d67 5f6e 756d 5f63 6861  s_2, img_num_cha
+0000fc30: 6e6e 656c 733d 7365 6c66 2e69 6d67 5f6e  nnels=self.img_n
+0000fc40: 756d 5f63 6861 6e6e 656c 732c 200a 2020  um_channels, .  
+0000fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc60: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+0000fc70: 726d 616c 697a 653d 7365 6c66 2e6e 6f72  rmalize=self.nor
+0000fc80: 6d61 6c69 7a65 2c20 6d69 6e5f 7069 7865  malize, min_pixe
+0000fc90: 6c3d 6d69 6e5f 7069 782c 206d 6178 5f70  l=min_pix, max_p
+0000fca0: 6978 656c 3d6d 6178 5f70 6978 2c20 7661  ixel=max_pix, va
+0000fcb0: 6c5f 706f 7369 7469 7665 3d76 616c 5f63  l_positive=val_c
+0000fcc0: 6c61 7373 5f31 2c20 7661 6c5f 6e65 6761  lass_1, val_nega
+0000fcd0: 7469 7665 3d76 616c 5f63 6c61 7373 5f32  tive=val_class_2
+0000fce0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+0000fcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd00: 2020 2065 706f 6368 733d 7365 6c66 2e74     epochs=self.t
+0000fd10: 7261 696e 5f65 706f 6368 732c 2062 6174  rain_epochs, bat
+0000fd20: 6368 5f73 697a 653d 6261 7463 685f 7369  ch_size=batch_si
+0000fd30: 7a65 2c20 6f70 7469 6d69 7a65 723d 6f70  ze, optimizer=op
+0000fd40: 7469 6d69 7a65 722c 206c 723d 6c72 2c20  timizer, lr=lr, 
+0000fd50: 6465 6361 793d 6465 6361 792c 206d 6f6d  decay=decay, mom
+0000fd60: 656e 7475 6d3d 6d6f 6d65 6e74 756d 2c20  entum=momentum, 
+0000fd70: 6e65 7374 6572 6f76 3d6e 6573 7465 726f  nesterov=nestero
+0000fd80: 762c 200a 2020 2020 2020 2020 2020 2020  v, .            
+0000fd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fda0: 2020 2020 6265 7461 5f31 3d62 6574 615f      beta_1=beta_
+0000fdb0: 312c 2062 6574 615f 323d 6265 7461 5f32  1, beta_2=beta_2
+0000fdc0: 2c20 616d 7367 7261 643d 616d 7367 7261  , amsgrad=amsgra
+0000fdd0: 642c 206c 6f73 733d 6c6f 7373 2c20 6163  d, loss=loss, ac
+0000fde0: 7469 7661 7469 6f6e 5f63 6f6e 763d 6163  tivation_conv=ac
+0000fdf0: 7469 7661 7469 6f6e 5f63 6f6e 762c 2061  tivation_conv, a
+0000fe00: 6374 6976 6174 696f 6e5f 6465 6e73 653d  ctivation_dense=
+0000fe10: 6163 7469 7661 7469 6f6e 5f64 656e 7365  activation_dense
+0000fe20: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+0000fe30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe40: 2020 2063 6f6e 765f 696e 6974 3d63 6f6e     conv_init=con
+0000fe50: 765f 696e 6974 2c20 6465 6e73 655f 696e  v_init, dense_in
+0000fe60: 6974 3d64 656e 7365 5f69 6e69 742c 206d  it=dense_init, m
+0000fe70: 6f64 656c 5f72 6567 3d6d 6f64 656c 5f72  odel_reg=model_r
+0000fe80: 6567 2c20 0a20 2020 2020 2020 2020 2020  eg, .           
+0000fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fea0: 2020 2020 2066 696c 7465 725f 313d 6669       filter_1=fi
+0000feb0: 6c74 6572 5f31 2c20 6669 6c74 6572 5f73  lter_1, filter_s
+0000fec0: 697a 655f 313d 6669 6c74 6572 5f73 697a  ize_1=filter_siz
+0000fed0: 655f 312c 2073 7472 6964 6573 5f31 3d73  e_1, strides_1=s
+0000fee0: 7472 6964 6573 5f31 2c20 706f 6f6c 696e  trides_1, poolin
+0000fef0: 675f 313d 706f 6f6c 696e 675f 312c 2070  g_1=pooling_1, p
+0000ff00: 6f6f 6c5f 7369 7a65 5f31 3d70 6f6f 6c5f  ool_size_1=pool_
+0000ff10: 7369 7a65 5f31 2c20 706f 6f6c 5f73 7472  size_1, pool_str
+0000ff20: 6964 655f 313d 706f 6f6c 5f73 7472 6964  ide_1=pool_strid
+0000ff30: 655f 312c 0a20 2020 2020 2020 2020 2020  e_1,.           
+0000ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff50: 2020 2020 2066 696c 7465 725f 323d 6669       filter_2=fi
+0000ff60: 6c74 6572 5f32 2c20 6669 6c74 6572 5f73  lter_2, filter_s
+0000ff70: 697a 655f 323d 6669 6c74 6572 5f73 697a  ize_2=filter_siz
+0000ff80: 655f 322c 2073 7472 6964 6573 5f32 3d73  e_2, strides_2=s
+0000ff90: 7472 6964 6573 5f32 2c20 706f 6f6c 696e  trides_2, poolin
+0000ffa0: 675f 323d 706f 6f6c 696e 675f 322c 2070  g_2=pooling_2, p
+0000ffb0: 6f6f 6c5f 7369 7a65 5f32 3d70 6f6f 6c5f  ool_size_2=pool_
+0000ffc0: 7369 7a65 5f32 2c20 706f 6f6c 5f73 7472  size_2, pool_str
+0000ffd0: 6964 655f 323d 706f 6f6c 5f73 7472 6964  ide_2=pool_strid
+0000ffe0: 655f 322c 0a20 2020 2020 2020 2020 2020  e_2,.           
+0000fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010000: 2020 2020 2066 696c 7465 725f 333d 6669       filter_3=fi
+00010010: 6c74 6572 5f33 2c20 6669 6c74 6572 5f73  lter_3, filter_s
+00010020: 697a 655f 333d 6669 6c74 6572 5f73 697a  ize_3=filter_siz
+00010030: 655f 332c 2073 7472 6964 6573 5f33 3d73  e_3, strides_3=s
+00010040: 7472 6964 6573 5f33 2c20 706f 6f6c 696e  trides_3, poolin
+00010050: 675f 333d 706f 6f6c 696e 675f 332c 2070  g_3=pooling_3, p
+00010060: 6f6f 6c5f 7369 7a65 5f33 3d70 6f6f 6c5f  ool_size_3=pool_
+00010070: 7369 7a65 5f33 2c20 706f 6f6c 5f73 7472  size_3, pool_str
+00010080: 6964 655f 333d 706f 6f6c 5f73 7472 6964  ide_3=pool_strid
+00010090: 655f 332c 0a20 2020 2020 2020 2020 2020  e_3,.           
+000100a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000100b0: 2020 2020 2066 696c 7465 725f 343d 6669       filter_4=fi
+000100c0: 6c74 6572 5f34 2c20 6669 6c74 6572 5f73  lter_4, filter_s
+000100d0: 697a 655f 343d 6669 6c74 6572 5f73 697a  ize_4=filter_siz
+000100e0: 655f 342c 2073 7472 6964 6573 5f34 3d73  e_4, strides_4=s
+000100f0: 7472 6964 6573 5f34 2c20 0a20 2020 2020  trides_4, .     
+00010100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010110: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+00010120: 725f 353d 6669 6c74 6572 5f35 2c20 6669  r_5=filter_5, fi
+00010130: 6c74 6572 5f73 697a 655f 353d 6669 6c74  lter_size_5=filt
+00010140: 6572 5f73 697a 655f 352c 2073 7472 6964  er_size_5, strid
+00010150: 6573 5f35 3d73 7472 6964 6573 5f35 2c0a  es_5=strides_5,.
+00010160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010180: 6465 6e73 655f 6e65 7572 6f6e 735f 313d  dense_neurons_1=
+00010190: 6465 6e73 655f 6e65 7572 6f6e 735f 312c  dense_neurons_1,
+000101a0: 2064 656e 7365 5f6e 6575 726f 6e73 5f32   dense_neurons_2
+000101b0: 3d64 656e 7365 5f6e 6575 726f 6e73 5f32  =dense_neurons_2
+000101c0: 2c20 6472 6f70 6f75 745f 313d 6472 6f70  , dropout_1=drop
+000101d0: 6f75 745f 312c 2064 726f 706f 7574 5f32  out_1, dropout_2
+000101e0: 3d64 726f 706f 7574 5f32 2c20 0a20 2020  =dropout_2, .   
+000101f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010200: 2020 2020 2020 2020 2020 2020 2073 6d6f               smo
+00010210: 7465 5f73 616d 706c 696e 673d 7365 6c66  te_sampling=self
+00010220: 2e73 6d6f 7465 5f73 616d 706c 696e 672c  .smote_sampling,
+00010230: 2065 6172 6c79 5f73 746f 705f 6361 6c6c   early_stop_call
+00010240: 6261 636b 3d63 616c 6c62 6163 6b73 2c20  back=callbacks, 
+00010250: 6368 6563 6b70 6f69 6e74 3d46 616c 7365  checkpoint=False
+00010260: 2c20 7665 7262 6f73 653d 7365 6c66 2e76  , verbose=self.v
+00010270: 6572 626f 7365 290a 2020 2020 2020 2020  erbose).        
+00010280: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00010290: 2073 656c 662e 636c 6620 3d3d 2027 6375   self.clf == 'cu
+000102a0: 7374 6f6d 5f63 6e6e 273a 0a20 2020 2020  stom_cnn':.     
+000102b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000102c0: 2020 206d 6f64 656c 2c20 6869 7374 6f72     model, histor
+000102d0: 7920 3d20 636e 6e5f 6d6f 6465 6c2e 6375  y = cnn_model.cu
+000102e0: 7374 6f6d 5f6d 6f64 656c 2863 6c61 7373  stom_model(class
+000102f0: 5f31 2c20 636c 6173 735f 322c 2069 6d67  _1, class_2, img
+00010300: 5f6e 756d 5f63 6861 6e6e 656c 733d 7365  _num_channels=se
+00010310: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
+00010320: 656c 732c 200a 2020 2020 2020 2020 2020  els, .          
+00010330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010340: 2020 6e6f 726d 616c 697a 653d 7365 6c66    normalize=self
+00010350: 2e6e 6f72 6d61 6c69 7a65 2c20 6d69 6e5f  .normalize, min_
+00010360: 7069 7865 6c3d 6d69 6e5f 7069 782c 206d  pixel=min_pix, m
+00010370: 6178 5f70 6978 656c 3d6d 6178 5f70 6978  ax_pixel=max_pix
+00010380: 2c20 7661 6c5f 706f 7369 7469 7665 3d76  , val_positive=v
+00010390: 616c 5f63 6c61 7373 5f31 2c20 7661 6c5f  al_class_1, val_
+000103a0: 6e65 6761 7469 7665 3d76 616c 5f63 6c61  negative=val_cla
+000103b0: 7373 5f32 2c20 0a20 2020 2020 2020 2020  ss_2, .         
+000103c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000103d0: 2020 2065 706f 6368 733d 7365 6c66 2e74     epochs=self.t
+000103e0: 7261 696e 5f65 706f 6368 732c 2062 6174  rain_epochs, bat
+000103f0: 6368 5f73 697a 653d 6261 7463 685f 7369  ch_size=batch_si
+00010400: 7a65 2c20 6f70 7469 6d69 7a65 723d 6f70  ze, optimizer=op
+00010410: 7469 6d69 7a65 722c 206c 723d 6c72 2c20  timizer, lr=lr, 
+00010420: 6465 6361 793d 6465 6361 792c 206d 6f6d  decay=decay, mom
+00010430: 656e 7475 6d3d 6d6f 6d65 6e74 756d 2c20  entum=momentum, 
+00010440: 6e65 7374 6572 6f76 3d6e 6573 7465 726f  nesterov=nestero
+00010450: 762c 200a 2020 2020 2020 2020 2020 2020  v, .            
+00010460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010470: 6265 7461 5f31 3d62 6574 615f 312c 2062  beta_1=beta_1, b
+00010480: 6574 615f 323d 6265 7461 5f32 2c20 616d  eta_2=beta_2, am
+00010490: 7367 7261 643d 616d 7367 7261 642c 206c  sgrad=amsgrad, l
+000104a0: 6f73 733d 6c6f 7373 2c20 6163 7469 7661  oss=loss, activa
+000104b0: 7469 6f6e 5f63 6f6e 763d 6163 7469 7661  tion_conv=activa
+000104c0: 7469 6f6e 5f63 6f6e 762c 2061 6374 6976  tion_conv, activ
+000104d0: 6174 696f 6e5f 6465 6e73 653d 6163 7469  ation_dense=acti
+000104e0: 7661 7469 6f6e 5f64 656e 7365 2c20 0a20  vation_dense, . 
+000104f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010500: 2020 2020 2020 2020 2020 2063 6f6e 765f             conv_
+00010510: 696e 6974 3d63 6f6e 765f 696e 6974 2c20  init=conv_init, 
+00010520: 6465 6e73 655f 696e 6974 3d64 656e 7365  dense_init=dense
+00010530: 5f69 6e69 742c 206d 6f64 656c 5f72 6567  _init, model_reg
+00010540: 3d6d 6f64 656c 5f72 6567 2c20 0a20 2020  =model_reg, .   
+00010550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010560: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+00010570: 313d 6669 6c74 6572 5f31 2c20 6669 6c74  1=filter_1, filt
+00010580: 6572 5f73 697a 655f 313d 6669 6c74 6572  er_size_1=filter
+00010590: 5f73 697a 655f 312c 2073 7472 6964 6573  _size_1, strides
+000105a0: 5f31 3d73 7472 6964 6573 5f31 2c20 706f  _1=strides_1, po
+000105b0: 6f6c 696e 675f 313d 706f 6f6c 696e 675f  oling_1=pooling_
+000105c0: 312c 2070 6f6f 6c5f 7369 7a65 5f31 3d70  1, pool_size_1=p
+000105d0: 6f6f 6c5f 7369 7a65 5f31 2c20 706f 6f6c  ool_size_1, pool
+000105e0: 5f73 7472 6964 655f 313d 706f 6f6c 5f73  _stride_1=pool_s
+000105f0: 7472 6964 655f 312c 200a 2020 2020 2020  tride_1, .      
+00010600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010610: 2020 2020 2020 6669 6c74 6572 5f32 3d66        filter_2=f
+00010620: 696c 7465 725f 322c 2066 696c 7465 725f  ilter_2, filter_
+00010630: 7369 7a65 5f32 3d66 696c 7465 725f 7369  size_2=filter_si
+00010640: 7a65 5f32 2c20 7374 7269 6465 735f 323d  ze_2, strides_2=
+00010650: 7374 7269 6465 735f 322c 2070 6f6f 6c69  strides_2, pooli
+00010660: 6e67 5f32 3d70 6f6f 6c69 6e67 5f32 2c20  ng_2=pooling_2, 
+00010670: 706f 6f6c 5f73 697a 655f 323d 706f 6f6c  pool_size_2=pool
+00010680: 5f73 697a 655f 322c 2070 6f6f 6c5f 7374  _size_2, pool_st
+00010690: 7269 6465 5f32 3d70 6f6f 6c5f 7374 7269  ride_2=pool_stri
+000106a0: 6465 5f32 2c20 0a20 2020 2020 2020 2020  de_2, .         
+000106b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000106c0: 2020 2066 696c 7465 725f 333d 6669 6c74     filter_3=filt
+000106d0: 6572 5f33 2c20 6669 6c74 6572 5f73 697a  er_3, filter_siz
+000106e0: 655f 333d 6669 6c74 6572 5f73 697a 655f  e_3=filter_size_
+000106f0: 332c 2073 7472 6964 6573 5f33 3d73 7472  3, strides_3=str
+00010700: 6964 6573 5f33 2c20 706f 6f6c 696e 675f  ides_3, pooling_
+00010710: 333d 706f 6f6c 696e 675f 332c 2070 6f6f  3=pooling_3, poo
+00010720: 6c5f 7369 7a65 5f33 3d70 6f6f 6c5f 7369  l_size_3=pool_si
+00010730: 7a65 5f33 2c20 706f 6f6c 5f73 7472 6964  ze_3, pool_strid
+00010740: 655f 333d 706f 6f6c 5f73 7472 6964 655f  e_3=pool_stride_
+00010750: 332c 200a 2020 2020 2020 2020 2020 2020  3, .            
+00010760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010770: 6465 6e73 655f 6e65 7572 6f6e 735f 313d  dense_neurons_1=
+00010780: 6465 6e73 655f 6e65 7572 6f6e 735f 312c  dense_neurons_1,
+00010790: 2064 656e 7365 5f6e 6575 726f 6e73 5f32   dense_neurons_2
+000107a0: 3d64 656e 7365 5f6e 6575 726f 6e73 5f32  =dense_neurons_2
+000107b0: 2c20 6465 6e73 655f 6e65 7572 6f6e 735f  , dense_neurons_
+000107c0: 333d 6465 6e73 655f 6e65 7572 6f6e 735f  3=dense_neurons_
+000107d0: 332c 200a 2020 2020 2020 2020 2020 2020  3, .            
+000107e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000107f0: 6472 6f70 6f75 745f 313d 6472 6f70 6f75  dropout_1=dropou
+00010800: 745f 312c 2064 726f 706f 7574 5f32 3d64  t_1, dropout_2=d
+00010810: 726f 706f 7574 5f32 2c20 6472 6f70 6f75  ropout_2, dropou
+00010820: 745f 333d 6472 6f70 6f75 745f 332c 2073  t_3=dropout_3, s
+00010830: 6d6f 7465 5f73 616d 706c 696e 673d 7365  mote_sampling=se
+00010840: 6c66 2e73 6d6f 7465 5f73 616d 706c 696e  lf.smote_samplin
+00010850: 672c 200a 2020 2020 2020 2020 2020 2020  g, .            
+00010860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010870: 6561 726c 795f 7374 6f70 5f63 616c 6c62  early_stop_callb
+00010880: 6163 6b3d 6361 6c6c 6261 636b 732c 2063  ack=callbacks, c
+00010890: 6865 636b 706f 696e 743d 4661 6c73 652c  heckpoint=False,
+000108a0: 2076 6572 626f 7365 3d73 656c 662e 7665   verbose=self.ve
+000108b0: 7262 6f73 6529 2020 0a20 2020 2020 2020  rbose)  .       
+000108c0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+000108d0: 6620 7365 6c66 2e63 6c66 203d 3d20 2776  f self.clf == 'v
+000108e0: 6767 3136 273a 0a20 2020 2020 2020 2020  gg16':.         
+000108f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00010900: 6620 7365 6c66 2e6c 696d 6974 5f73 6561  f self.limit_sea
+00010910: 7263 683a 0a20 2020 2020 2020 2020 2020  rch:.           
+00010920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010930: 206d 6f64 656c 2c20 6869 7374 6f72 7920   model, history 
+00010940: 3d20 636e 6e5f 6d6f 6465 6c2e 5647 4731  = cnn_model.VGG1
+00010950: 3628 636c 6173 735f 312c 2063 6c61 7373  6(class_1, class
+00010960: 5f32 2c20 696d 675f 6e75 6d5f 6368 616e  _2, img_num_chan
+00010970: 6e65 6c73 3d73 656c 662e 696d 675f 6e75  nels=self.img_nu
+00010980: 6d5f 6368 616e 6e65 6c73 2c20 0a20 2020  m_channels, .   
+00010990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000109a0: 2020 2020 2020 2020 2020 2020 206e 6f72               nor
+000109b0: 6d61 6c69 7a65 3d73 656c 662e 6e6f 726d  malize=self.norm
+000109c0: 616c 697a 652c 206d 696e 5f70 6978 656c  alize, min_pixel
+000109d0: 3d6d 696e 5f70 6978 2c20 6d61 785f 7069  =min_pix, max_pi
+000109e0: 7865 6c3d 6d61 785f 7069 782c 2076 616c  xel=max_pix, val
+000109f0: 5f70 6f73 6974 6976 653d 7661 6c5f 636c  _positive=val_cl
+00010a00: 6173 735f 312c 2076 616c 5f6e 6567 6174  ass_1, val_negat
+00010a10: 6976 653d 7661 6c5f 636c 6173 735f 322c  ive=val_class_2,
+00010a20: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00010a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a40: 2020 6570 6f63 6873 3d73 656c 662e 7472    epochs=self.tr
+00010a50: 6169 6e5f 6570 6f63 6873 2c20 6261 7463  ain_epochs, batc
+00010a60: 685f 7369 7a65 3d62 6174 6368 5f73 697a  h_size=batch_siz
+00010a70: 652c 206f 7074 696d 697a 6572 3d6f 7074  e, optimizer=opt
+00010a80: 696d 697a 6572 2c20 6c72 3d6c 722c 2064  imizer, lr=lr, d
+00010a90: 6563 6179 3d64 6563 6179 2c20 6d6f 6d65  ecay=decay, mome
+00010aa0: 6e74 756d 3d6d 6f6d 656e 7475 6d2c 206e  ntum=momentum, n
+00010ab0: 6573 7465 726f 763d 6e65 7374 6572 6f76  esterov=nesterov
+00010ac0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00010ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ae0: 2020 2062 6574 615f 313d 6265 7461 5f31     beta_1=beta_1
+00010af0: 2c20 6265 7461 5f32 3d62 6574 615f 322c  , beta_2=beta_2,
+00010b00: 2061 6d73 6772 6164 3d61 6d73 6772 6164   amsgrad=amsgrad
+00010b10: 2c20 6c6f 7373 3d6c 6f73 732c 2061 6374  , loss=loss, act
+00010b20: 6976 6174 696f 6e5f 636f 6e76 3d61 6374  ivation_conv=act
+00010b30: 6976 6174 696f 6e5f 636f 6e76 2c20 6163  ivation_conv, ac
+00010b40: 7469 7661 7469 6f6e 5f64 656e 7365 3d61  tivation_dense=a
+00010b50: 6374 6976 6174 696f 6e5f 6465 6e73 652c  ctivation_dense,
+00010b60: 200a 2020 2020 2020 2020 2020 2020 2020   .              
 00010b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b80: 2020 2020 7365 6c66 2e73 746f 7070 6564      self.stopped
-00010b90: 5f65 706f 6368 203d 2065 706f 6368 0a20  _epoch = epoch. 
-00010ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010bb0: 2020 2073 656c 662e 6d6f 6465 6c2e 7374     self.model.st
-00010bc0: 6f70 5f74 7261 696e 696e 6720 3d20 5472  op_training = Tr
-00010bd0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00010be0: 2020 2069 6620 6375 7272 656e 745f 6d65     if current_me
-00010bf0: 7472 6963 203c 2073 656c 662e 6265 7374  tric < self.best
-00010c00: 5f6d 6574 7269 633a 0a20 2020 2020 2020  _metric:.       
-00010c10: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00010c20: 662e 6265 7374 5f6d 6574 7269 6320 3d20  f.best_metric = 
-00010c30: 6375 7272 656e 745f 6d65 7472 6963 0a20  current_metric. 
-00010c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c50: 2020 2073 656c 662e 6265 7374 5f77 6569     self.best_wei
-00010c60: 6768 7473 203d 2073 656c 662e 6d6f 6465  ghts = self.mode
-00010c70: 6c2e 6765 745f 7765 6967 6874 7328 290a  l.get_weights().
-00010c80: 0a0a 6465 6620 6879 7065 725f 6f70 7428  ..def hyper_opt(
-00010c90: 6461 7461 5f78 2c20 6461 7461 5f79 2c20  data_x, data_y, 
-00010ca0: 636c 663d 2772 6627 2c20 6e5f 6974 6572  clf='rf', n_iter
-00010cb0: 3d32 352c 2072 6574 7572 6e5f 7374 7564  =25, return_stud
-00010cc0: 793d 5472 7565 2c20 6261 6c61 6e63 653d  y=True, balance=
-00010cd0: 5472 7565 2c20 696d 675f 6e75 6d5f 6368  True, img_num_ch
-00010ce0: 616e 6e65 6c73 3d31 2c20 0a20 2020 206e  annels=1, .    n
-00010cf0: 6f72 6d61 6c69 7a65 3d54 7275 652c 206d  ormalize=True, m
-00010d00: 696e 5f70 6978 656c 3d30 2c20 6d61 785f  in_pixel=0, max_
-00010d10: 7069 7865 6c3d 3130 302c 2076 616c 5f58  pixel=100, val_X
-00010d20: 3d4e 6f6e 652c 2076 616c 5f59 3d4e 6f6e  =None, val_Y=Non
-00010d30: 652c 2074 7261 696e 5f65 706f 6368 733d  e, train_epochs=
-00010d40: 3235 2c20 7061 7469 656e 6365 3d30 2c20  25, patience=0, 
-00010d50: 6d65 7472 6963 3d27 6c6f 7373 272c 200a  metric='loss', .
-00010d60: 2020 2020 6c69 6d69 745f 7365 6172 6368      limit_search
-00010d70: 3d54 7275 652c 206f 7074 5f6d 6f64 656c  =True, opt_model
-00010d80: 3d54 7275 652c 206f 7074 5f61 7567 3d46  =True, opt_aug=F
-00010d90: 616c 7365 2c20 6261 7463 685f 6d69 6e3d  alse, batch_min=
-00010da0: 322c 2062 6174 6368 5f6d 6178 3d32 352c  2, batch_max=25,
-00010db0: 2069 6d61 6765 5f73 697a 655f 6d69 6e3d   image_size_min=
-00010dc0: 3530 2c20 696d 6167 655f 7369 7a65 5f6d  50, image_size_m
-00010dd0: 6178 3d31 3030 2c0a 2020 2020 6f70 745f  ax=100,.    opt_
-00010de0: 6d61 785f 6d69 6e5f 7069 783d 4e6f 6e65  max_min_pix=None
-00010df0: 2c20 6f70 745f 6d61 785f 6d61 785f 7069  , opt_max_max_pi
-00010e00: 783d 4e6f 6e65 2c20 6f70 745f 6376 3d31  x=None, opt_cv=1
-00010e10: 302c 2074 6573 745f 7369 7a65 3d4e 6f6e  0, test_size=Non
-00010e20: 652c 2061 7665 7261 6765 3d54 7275 652c  e, average=True,
-00010e30: 2074 6573 745f 706f 7369 7469 7665 3d4e   test_positive=N
-00010e40: 6f6e 652c 2074 6573 745f 6e65 6761 7469  one, test_negati
-00010e50: 7665 3d4e 6f6e 652c 2073 6869 6674 3d31  ve=None, shift=1
-00010e60: 302c 200a 2020 2020 6d61 736b 5f73 697a  0, .    mask_siz
-00010e70: 653d 4e6f 6e65 2c20 6e75 6d5f 6d61 736b  e=None, num_mask
-00010e80: 733d 4e6f 6e65 2c20 7665 7262 6f73 653d  s=None, verbose=
-00010e90: 312c 2074 7261 696e 5f61 6363 5f74 6872  1, train_acc_thr
-00010ea0: 6573 686f 6c64 3d4e 6f6e 652c 206d 6f6e  eshold=None, mon
-00010eb0: 6974 6f72 313d 4e6f 6e65 2c20 6d6f 6e69  itor1=None, moni
-00010ec0: 746f 7232 3d4e 6f6e 652c 206d 6f6e 6974  tor2=None, monit
-00010ed0: 6f72 315f 7468 7265 7368 3d4e 6f6e 652c  or1_thresh=None,
-00010ee0: 206d 6f6e 6974 6f72 325f 7468 7265 7368   monitor2_thresh
-00010ef0: 3d4e 6f6e 6529 3a0a 2020 2020 2222 220a  =None):.    """.
-00010f00: 2020 2020 4f70 7469 6d69 7a65 7320 6879      Optimizes hy
-00010f10: 7065 7270 6172 616d 6574 6572 7320 7573  perparameters us
-00010f20: 696e 6720 6120 6b2d 666f 6c64 2063 726f  ing a k-fold cro
-00010f30: 7373 2076 616c 6964 6174 696f 6e20 7370  ss validation sp
-00010f40: 6c69 7474 696e 6720 7374 7261 7465 6779  litting strategy
-00010f50: 2c20 756e 6c65 7373 2061 2043 4e4e 0a20  , unless a CNN. 
-00010f60: 2020 2069 7320 6265 696e 6720 6f70 7469     is being opti
-00010f70: 6d69 7a65 642c 2069 6e20 7768 6963 6820  mized, in which 
-00010f80: 6361 7365 206e 6f20 6372 6f73 732d 7661  case no cross-va
-00010f90: 6c69 6461 7469 6f6e 2069 7320 7065 7266  lidation is perf
-00010fa0: 6f72 6d65 6420 6475 7269 6e67 2074 7269  ormed during tri
-00010fb0: 616c 2061 7373 6573 6d65 6e74 2e0a 0a20  al assesment... 
-00010fc0: 2020 202a 2a49 4d50 4f52 5441 4e54 2a2a     **IMPORTANT**
-00010fd0: 2049 6e20 7468 6520 6361 7365 206f 6620   In the case of 
-00010fe0: 434e 4e20 6f70 7469 6d69 7a61 7469 6f6e  CNN optimization
-00010ff0: 2c20 6461 7461 5f78 2061 6e64 2064 6174  , data_x and dat
-00011000: 615f 7920 6172 6520 6e6f 7420 7468 6520  a_y are not the 
-00011010: 7374 616e 6461 7264 0a20 2020 2064 6174  standard.    dat
-00011020: 6120 706c 7573 206c 6162 656c 7320 2d2d  a plus labels --
-00011030: 2069 6620 6f70 7469 6d69 7a69 6e67 2061   if optimizing a
-00011040: 2043 4e4e 2074 6865 2073 616d 706c 6573   CNN the samples
-00011050: 2066 6f72 2074 6865 2066 6972 7374 2063   for the first c
-00011060: 6c61 7373 2073 686f 756c 6420 6265 2070  lass should be p
-00011070: 6173 7365 640a 2020 2020 7468 726f 7567  assed.    throug
-00011080: 6820 7468 6520 6461 7461 5f78 2070 6172  h the data_x par
-00011090: 616d 6574 6572 2c20 616e 6420 7468 6520  ameter, and the 
-000110a0: 7361 6d70 6c65 7320 666f 7220 7468 6520  samples for the 
-000110b0: 7365 636f 6e64 2063 6c61 7373 2073 686f  second class sho
-000110c0: 756c 6420 6265 2067 6976 656e 2061 7320  uld be given as 
-000110d0: 6461 7461 5f79 2e0a 2020 2020 5468 6573  data_y..    Thes
-000110e0: 6520 7477 6f20 636c 6173 7365 7320 7769  e two classes wi
-000110f0: 6c6c 2061 7574 6f6d 6174 6963 616c 6c79  ll automatically
-00011100: 2062 6520 6173 7369 676e 6564 2074 6865   be assigned the
-00011110: 2070 6f73 6974 6976 6520 616e 6420 6e65   positive and ne
-00011120: 6761 7469 7665 206c 6162 656c 7320 3120  gative labels 1 
-00011130: 616e 6420 302c 2072 6573 7065 6374 6976  and 0, respectiv
-00011140: 656c 792e 0a20 2020 204c 696b 6577 6973  ely..    Likewis
-00011150: 652c 2069 6620 6f70 7469 6d69 7a69 6e67  e, if optimizing
-00011160: 2061 2043 4e4e 206d 6f64 656c 2c20 7661   a CNN model, va
-00011170: 6c5f 5820 636f 7272 6573 706f 6e64 7320  l_X corresponds 
-00011180: 746f 2074 6865 2069 6d61 6765 7320 6f66  to the images of
-00011190: 2074 6865 2066 6972 7374 2063 6c61 7373   the first class
-000111a0: 2c20 616e 6420 7661 6c5f 5920 7468 6520  , and val_Y the 
-000111b0: 696d 6167 6573 206f 6620 7468 6520 7365  images of the se
-000111c0: 636f 6e64 2063 6c61 7373 2e20 0a20 2020  cond class. .   
-000111d0: 200a 2020 2020 4966 2073 6176 655f 7374   .    If save_st
-000111e0: 7564 793d 5472 7565 2c20 7468 6520 4f70  udy=True, the Op
-000111f0: 7475 6e61 2073 7475 6479 206f 626a 6563  tuna study objec
-00011200: 7420 7769 6c6c 2062 6520 7468 6520 7468  t will be the th
-00011210: 6972 6420 6f75 7470 7574 2e20 5468 6973  ird output. This
-00011220: 0a20 2020 206f 626a 6563 7420 6361 6e20  .    object can 
-00011230: 6265 2075 7365 6420 666f 7220 7661 7269  be used for vari
-00011240: 6f75 7320 616e 616c 7973 6973 2c20 696e  ous analysis, in
-00011250: 636c 7564 696e 6720 6f70 7469 6d69 7a61  cluding optimiza
-00011260: 7469 6f6e 2076 6973 7561 6c69 7a61 7469  tion visualizati
-00011270: 6f6e 732e 0a20 2020 2053 6565 3a20 6874  ons..    See: ht
-00011280: 7470 733a 2f2f 6f70 7475 6e61 2e72 6561  tps://optuna.rea
-00011290: 6474 6865 646f 6373 2e69 6f2f 656e 2f73  dthedocs.io/en/s
-000112a0: 7461 626c 652f 7265 6665 7265 6e63 652f  table/reference/
-000112b0: 6765 6e65 7261 7465 642f 6f70 7475 6e61  generated/optuna
-000112c0: 2e73 7475 6479 2e53 7475 6479 2e68 746d  .study.Study.htm
-000112d0: 6c0a 0a20 2020 2045 7861 6d70 6c65 3a0a  l..    Example:.
-000112e0: 2020 2020 2020 2020 5468 6520 6675 6e63          The func
-000112f0: 7469 6f6e 2077 696c 6c20 6372 6561 7465  tion will create
-00011300: 2074 6865 2063 6c61 7373 6966 6963 6174   the classificat
-00011310: 696f 6e20 656e 6769 6e65 2061 6e64 206f  ion engine and o
-00011320: 7074 696d 697a 6520 7468 6520 6879 7065  ptimize the hype
-00011330: 7270 6172 616d 6574 6572 730a 2020 2020  rparameters.    
-00011340: 2020 2020 7573 696e 6720 616e 2069 7465      using an ite
-00011350: 7261 7469 7665 2061 7070 726f 6163 683a  rative approach:
-00011360: 0a0a 2020 2020 2020 2020 3e3e 3e20 6d6f  ..        >>> mo
-00011370: 6465 6c2c 2070 6172 616d 7320 3d20 6879  del, params = hy
-00011380: 7065 725f 6f70 7428 6461 7461 5f78 2c20  per_opt(data_x, 
-00011390: 6461 7461 5f79 2c20 636c 663d 2772 6627  data_y, clf='rf'
-000113a0: 2920 0a20 2020 2020 2020 200a 2020 2020  ) .        .    
-000113b0: 2020 2020 5468 6520 6669 7273 7420 6f75      The first ou
-000113c0: 7470 7574 2069 7320 6f75 7220 6f70 7469  tput is our opti
-000113d0: 6d61 6c20 636c 6173 7369 6669 6572 2c20  mal classifier, 
-000113e0: 616e 6420 7769 6c6c 2062 6520 7573 6564  and will be used
-000113f0: 2074 6f20 6d61 6b65 2070 7265 6469 6374   to make predict
-00011400: 696f 6e73 3a0a 2020 2020 2020 2020 0a20  ions:.        . 
-00011410: 2020 2020 2020 203e 3e3e 2070 7265 6469         >>> predi
-00011420: 6374 696f 6e20 3d20 6d6f 6465 6c2e 7072  ction = model.pr
-00011430: 6564 6963 7428 6e65 775f 6461 7461 290a  edict(new_data).
-00011440: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00011450: 2054 6865 2073 6563 6f6e 6420 6f75 7470   The second outp
-00011460: 7574 206f 6620 7468 6520 6f70 7469 6d69  ut of the optimi
-00011470: 7a65 2066 756e 6374 696f 6e20 6973 2074  ze function is t
-00011480: 6865 2064 6963 7469 6f6e 6172 7920 636f  he dictionary co
-00011490: 6e74 6169 6e69 6e67 0a20 2020 2020 2020  ntaining.       
-000114a0: 2074 6865 2068 7970 6572 7061 7261 6d65   the hyperparame
-000114b0: 7465 7220 636f 6d62 696e 6174 696f 6e20  ter combination 
-000114c0: 7468 6174 2079 6965 6c64 6564 2074 6865  that yielded the
-000114d0: 2068 6967 6865 7374 206d 6561 6e20 6163   highest mean ac
-000114e0: 6375 7261 6379 2e0a 0a20 2020 2020 2020  curacy...       
-000114f0: 2049 6620 7361 7665 5f73 7475 6479 203d   If save_study =
-00011500: 2054 7275 652c 2074 6865 204f 7074 756e   True, the Optun
-00011510: 6120 7374 7564 7920 6f62 6a65 6374 2077  a study object w
-00011520: 696c 6c20 616c 736f 2062 6520 7265 7475  ill also be retu
-00011530: 726e 6564 2061 7320 7468 6520 7468 6972  rned as the thir
-00011540: 6420 6f75 7470 7574 2e0a 2020 2020 2020  d output..      
-00011550: 2020 5468 6973 2063 616e 2062 6520 7573    This can be us
-00011560: 6564 2074 6f20 706c 6f74 2074 6865 206f  ed to plot the o
-00011570: 7074 696d 697a 6174 696f 6e20 7265 7375  ptimization resu
-00011580: 6c74 732c 2073 6565 3a20 6874 7470 733a  lts, see: https:
-00011590: 2f2f 6f70 7475 6e61 2e72 6561 6474 6865  //optuna.readthe
-000115a0: 646f 6373 2e69 6f2f 656e 2f6c 6174 6573  docs.io/en/lates
-000115b0: 742f 7475 746f 7269 616c 2f31 305f 6b65  t/tutorial/10_ke
-000115c0: 795f 6665 6174 7572 6573 2f30 3035 5f76  y_features/005_v
-000115d0: 6973 7561 6c69 7a61 7469 6f6e 2e68 746d  isualization.htm
-000115e0: 6c23 7370 6878 2d67 6c72 2d74 7574 6f72  l#sphx-glr-tutor
-000115f0: 6961 6c2d 3130 2d6b 6579 2d66 6561 7475  ial-10-key-featu
-00011600: 7265 732d 3030 352d 7669 7375 616c 697a  res-005-visualiz
-00011610: 6174 696f 6e2d 7079 0a0a 2020 2020 2020  ation-py..      
-00011620: 2020 3e3e 3e20 6672 6f6d 206f 7074 756e    >>> from optun
-00011630: 612e 7669 7375 616c 697a 6174 696f 6e2e  a.visualization.
-00011640: 6d61 7470 6c6f 746c 6962 2069 6d70 6f72  matplotlib impor
-00011650: 7420 706c 6f74 5f63 6f6e 746f 7572 0a20  t plot_contour. 
-00011660: 2020 2020 2020 203e 3e3e 200a 2020 2020         >>> .    
-00011670: 2020 2020 3e3e 3e20 6d6f 6465 6c2c 2070      >>> model, p
-00011680: 6172 616d 732c 2073 7475 6479 203d 2068  arams, study = h
-00011690: 7970 6572 5f6f 7074 2864 6174 615f 782c  yper_opt(data_x,
-000116a0: 2064 6174 615f 792c 2063 6c66 3d27 7266   data_y, clf='rf
-000116b0: 272c 2073 6176 655f 7374 7564 793d 5472  ', save_study=Tr
-000116c0: 7565 2920 0a20 2020 2020 2020 203e 3e3e  ue) .        >>>
-000116d0: 2070 6c6f 745f 636f 6e74 6f75 7228 7374   plot_contour(st
-000116e0: 7564 7929 0a0a 2020 2020 2020 2020 4966  udy)..        If
-000116f0: 2063 6c66 3d27 636e 6e27 2c20 7468 6520   clf='cnn', the 
-00011700: 6d6f 6465 6c20 6973 206e 6f74 2072 6574  model is not ret
-00011710: 7572 6e65 642e 0a20 2020 2020 2020 200a  urned..        .
-00011720: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00011730: 2020 6461 7461 5f78 2028 6e64 6172 7261    data_x (ndarra
-00011740: 7929 3a20 3244 2061 7272 6179 206f 6620  y): 2D array of 
-00011750: 7369 7a65 2028 6e20 7820 6d29 2c20 7768  size (n x m), wh
-00011760: 6572 6520 6e20 6973 2074 6865 0a20 2020  ere n is the.   
-00011770: 2020 2020 2020 2020 206e 756d 6265 7220           number 
-00011780: 6f66 2073 616d 706c 6573 2c20 616e 6420  of samples, and 
-00011790: 6d20 7468 6520 6e75 6d62 6572 206f 6620  m the number of 
-000117a0: 6665 6174 7572 6573 2e20 4966 2063 6c66  features. If clf
-000117b0: 3d27 636e 6e27 2c20 0a20 2020 2020 2020  ='cnn', .       
-000117c0: 2020 2020 2074 6865 2073 616d 706c 6573       the samples
-000117d0: 2066 6f72 2074 6865 2066 6972 7374 2063   for the first c
-000117e0: 6c61 7373 2073 686f 756c 6420 6265 2070  lass should be p
-000117f0: 6173 7365 642c 2077 6869 6368 2077 696c  assed, which wil
-00011800: 6c20 6175 746f 6d61 7469 6361 6c6c 7920  l automatically 
-00011810: 0a20 2020 2020 2020 2020 2020 2062 6520  .            be 
-00011820: 6173 7369 676e 6564 2074 6865 2070 6f73  assigned the pos
-00011830: 6974 6976 6520 6c61 6265 6c20 2731 272e  itive label '1'.
-00011840: 0a20 2020 2020 2020 2064 6174 615f 7920  .        data_y 
-00011850: 286e 6461 7272 6179 2c20 7374 7229 3a20  (ndarray, str): 
-00011860: 3144 2061 7272 6179 2063 6f6e 7461 696e  1D array contain
-00011870: 696e 6720 7468 6520 636f 7272 6573 706f  ing the correspo
-00011880: 6e69 6e67 206c 6162 656c 732e 2049 6620  ning labels. If 
-00011890: 636c 663d 2763 6e6e 272c 0a20 2020 2020  clf='cnn',.     
-000118a0: 2020 2020 2020 2074 6865 2073 616d 706c         the sampl
-000118b0: 6573 2066 6f72 2074 6865 2073 6563 6f6e  es for the secon
-000118c0: 6420 636c 6173 7320 7368 6f75 6c64 2062  d class should b
-000118d0: 6520 7061 7373 6564 2c20 7768 6963 6820  e passed, which 
-000118e0: 7769 6c6c 2061 7574 6f6d 6174 6963 616c  will automatical
-000118f0: 6c79 0a20 2020 2020 2020 2020 2020 2062  ly.            b
-00011900: 6520 6173 7369 676e 6564 2074 6865 206e  e assigned the n
-00011910: 6567 6174 6976 6520 6c61 6265 6c20 2730  egative label '0
-00011920: 272e 0a20 2020 2020 2020 2063 6c66 2028  '..        clf (
-00011930: 7374 7229 3a20 5468 6520 6d61 6368 696e  str): The machin
-00011940: 6520 6c65 6172 6e69 6e67 2063 6c61 7373  e learning class
-00011950: 6966 6965 7220 746f 206f 7074 696d 697a  ifier to optimiz
-00011960: 652e 2043 616e 2065 6974 6865 7220 6265  e. Can either be
-00011970: 0a20 2020 2020 2020 2020 2020 2027 7266  .            'rf
-00011980: 2720 666f 7220 5261 6e64 6f6d 2046 6f72  ' for Random For
-00011990: 6573 742c 2027 6e6e 2720 666f 7220 4e65  est, 'nn' for Ne
-000119a0: 7572 616c 204e 6574 776f 726b 2c20 2778  ural Network, 'x
-000119b0: 6762 2720 666f 7220 6558 7472 656d 6520  gb' for eXtreme 
-000119c0: 4772 6164 6965 6e74 2042 6f6f 7374 696e  Gradient Boostin
-000119d0: 672c 0a20 2020 2020 2020 2020 2020 206f  g,.            o
-000119e0: 7220 2763 6e6e 2720 666f 7220 436f 6e76  r 'cnn' for Conv
-000119f0: 6f6c 7574 696f 6e61 6c20 4e65 7572 616c  olutional Neural
-00011a00: 204e 6574 776f 726b 2e20 4465 6661 756c   Network. Defaul
-00011a10: 7473 2074 6f20 2772 6627 2e0a 2020 2020  ts to 'rf'..    
-00011a20: 2020 2020 6e5f 6974 6572 2028 696e 742c      n_iter (int,
-00011a30: 206f 7074 696f 6e61 6c29 3a20 5468 6520   optional): The 
-00011a40: 6d61 7869 6d75 6d20 6e75 6d62 6572 206f  maximum number o
-00011a50: 6620 6974 6572 6174 696f 6e73 2074 6f20  f iterations to 
-00011a60: 7065 7266 6f72 6d20 6475 7269 6e67 200a  perform during .
-00011a70: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00011a80: 6879 7065 7270 6172 616d 6574 6572 2073  hyperparameter s
-00011a90: 6561 7263 682e 2044 6566 6175 6c74 7320  earch. Defaults 
-00011aa0: 746f 2032 352e 0a20 2020 2020 2020 206f  to 25..        o
-00011ab0: 7074 5f63 7620 2869 6e74 293a 2043 726f  pt_cv (int): Cro
-00011ac0: 7373 2d76 616c 6964 6174 696f 6e73 2074  ss-validations t
-00011ad0: 6f20 7065 7266 6f72 6d20 7768 656e 2061  o perform when a
-00011ae0: 7373 6573 696e 6720 7468 6520 7065 7266  ssesing the perf
-00011af0: 6f72 6d61 6e63 6520 6174 2065 6163 680a  ormance at each.
-00011b00: 2020 2020 2020 2020 2020 2020 6879 7065              hype
-00011b10: 7270 6172 616d 6574 6572 206f 7074 696d  rparameter optim
-00011b20: 697a 6174 696f 6e20 7472 6961 6c2e 2046  ization trial. F
-00011b30: 6f72 2065 7861 6d70 6c65 2c20 6966 2063  or example, if c
-00011b40: 763d 332c 2074 6865 6e20 6561 6368 206f  v=3, then each o
-00011b50: 7074 696d 697a 6174 696f 6e20 7472 6961  ptimization tria
-00011b60: 6c0a 2020 2020 2020 2020 2020 2020 7769  l.            wi
-00011b70: 6c6c 2062 6520 6173 7365 7373 6564 2061  ll be assessed a
-00011b80: 6363 6f72 6469 6e67 2074 6f20 7468 6520  ccording to the 
-00011b90: 332d 666f 6c64 2063 726f 7373 2076 616c  3-fold cross val
-00011ba0: 6964 6174 696f 6e20 6163 6375 7261 6379  idation accuracy
-00011bb0: 2e20 4465 6661 756c 7473 2074 6f20 3130  . Defaults to 10
-00011bc0: 2e0a 2020 2020 2020 2020 2020 2020 4e4f  ..            NO
-00011bd0: 5445 3a20 5468 6520 6869 6768 6572 2074  TE: The higher t
-00011be0: 6869 7320 6e75 6d62 6572 2c20 7468 6520  his number, the 
-00011bf0: 6c6f 6e67 6572 2074 6865 206f 7074 696d  longer the optim
-00011c00: 697a 6174 696f 6e20 7769 6c6c 2074 616b  ization will tak
-00011c10: 652e 0a20 2020 2020 2020 2074 6573 745f  e..        test_
-00011c20: 7369 7a65 2028 666c 6f61 742c 206f 7074  size (float, opt
-00011c30: 696f 6e61 6c29 3a20 4361 6e20 7573 6520  ional): Can use 
-00011c40: 7468 6973 2069 6e20 6c69 6575 206f 6620  this in lieu of 
-00011c50: 6f70 745f 6376 2c20 6f6e 6c79 2069 6620  opt_cv, only if 
-00011c60: 636c 663d 2778 6762 2721 0a20 2020 2020  clf='xgb'!.     
-00011c70: 2020 2020 2020 204d 7573 7420 6265 2062         Must be b
-00011c80: 6574 7765 656e 2030 2061 6e64 2031 2061  etween 0 and 1 a
-00011c90: 7320 7468 6973 2073 6574 7320 7468 6520  s this sets the 
-00011ca0: 7369 7a65 206f 6620 7468 6520 7661 6c69  size of the vali
-00011cb0: 6461 7469 6f6e 2064 6174 612c 2077 6869  dation data, whi
-00011cc0: 6368 2077 696c 6c20 6265 2063 686f 7365  ch will be chose
-00011cd0: 6e20 7261 6e64 6f6d 6c79 2065 6163 6820  n randomly each 
-00011ce0: 7472 6961 6c2e 200a 2020 2020 2020 2020  trial. .        
-00011cf0: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
-00011d00: 4e6f 6e65 2c20 696e 2077 6869 6368 2063  None, in which c
-00011d10: 6173 6520 7468 6520 6f70 745f 6376 2070  ase the opt_cv p
-00011d20: 6172 616d 6574 6572 2077 696c 6c20 6265  arameter will be
-00011d30: 2075 7365 642e 2054 6869 7320 6973 2075   used. This is u
-00011d40: 7365 6420 0a20 2020 2020 2020 2020 2020  sed .           
-00011d50: 2074 6f20 656e 6162 6c65 2061 6e20 6561   to enable an ea
-00011d60: 726c 7920 7374 6f70 7069 6e67 2063 616c  rly stopping cal
-00011d70: 6c62 6163 6b20 7768 6963 6820 6973 206e  lback which is n
-00011d80: 6f74 2070 6f73 7369 626c 6520 7769 7468  ot possible with
-00011d90: 2074 6865 2063 726f 7373 2d76 616c 6964   the cross-valid
-00011da0: 6174 696f 6e20 6d65 7468 6f64 2e0a 2020  ation method..  
-00011db0: 2020 2020 2020 6c69 6d69 745f 7365 6172        limit_sear
-00011dc0: 6368 2028 626f 6f6c 293a 2049 6620 5472  ch (bool): If Tr
-00011dd0: 7565 2074 6865 206f 7074 696d 697a 6174  ue the optimizat
-00011de0: 696f 6e20 7365 6172 6368 2073 7061 6365  ion search space
-00011df0: 7320 7769 6c6c 2062 6520 6c69 6d69 7465  s will be limite
-00011e00: 642c 2066 6f72 2063 6f6d 7075 7461 7469  d, for computati
-00011e10: 6f6e 616c 2061 6e64 2074 696d 6520 7075  onal and time pu
-00011e20: 7270 6f73 6573 2e20 0a20 2020 2020 2020  rposes. .       
-00011e30: 2020 2020 2054 6869 7320 6973 2065 7370       This is esp
-00011e40: 6563 6961 6c6c 7920 696d 706f 7274 616e  ecially importan
-00011e50: 7420 6966 2063 6c66 3d27 636e 6e27 2061  t if clf='cnn' a
-00011e60: 7320 6d65 6d6f 7279 2065 7272 6f72 7320  s memory errors 
-00011e70: 6361 6e20 6265 2065 6e63 6f75 6e74 6572  can be encounter
-00011e80: 6564 2e20 4465 6661 756c 7473 2074 6f20  ed. Defaults to 
-00011e90: 5472 7565 2e0a 2020 2020 2020 2020 6261  True..        ba
-00011ea0: 6c61 6e63 6520 2862 6f6f 6c2c 206f 7074  lance (bool, opt
-00011eb0: 696f 6e61 6c29 3a20 4966 2054 7275 652c  ional): If True,
-00011ec0: 2061 2077 6569 6768 7473 2061 7272 6179   a weights array
-00011ed0: 2077 696c 6c20 6265 2063 616c 6375 6c61   will be calcula
-00011ee0: 7465 6420 616e 6420 7573 6564 0a20 2020  ted and used.   
-00011ef0: 2020 2020 2020 2020 2077 6865 6e20 6669           when fi
-00011f00: 7474 696e 6720 7468 6520 636c 6173 7369  tting the classi
-00011f10: 6669 6572 2e20 5468 6973 2063 616e 2069  fier. This can i
-00011f20: 6d70 726f 7665 2063 6c61 7373 6966 6963  mprove classific
-00011f30: 6174 696f 6e20 7768 656e 2063 6c61 7373  ation when class
-00011f40: 6573 0a20 2020 2020 2020 2020 2020 2061  es.            a
-00011f50: 7265 2069 6d62 616c 616e 6365 642e 2054  re imbalanced. T
-00011f60: 6869 7320 6973 206f 6e6c 7920 6170 706c  his is only appl
-00011f70: 6965 6420 6966 2074 6865 2063 6c61 7373  ied if the class
-00011f80: 6966 6963 6174 696f 6e20 6973 2061 2062  ification is a b
-00011f90: 696e 6172 7920 7461 736b 2e20 0a20 2020  inary task. .   
-00011fa0: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-00011fb0: 7320 746f 2054 7275 652e 2049 6620 636c  s to True. If cl
-00011fc0: 663d 2763 6e6e 272c 2074 6869 7320 7769  f='cnn', this wi
-00011fd0: 6c6c 2064 6574 6572 6d69 6e65 2077 6865  ll determine whe
-00011fe0: 7468 6572 2074 6865 2074 776f 2063 6c61  ther the two cla
-00011ff0: 7373 6573 0a20 2020 2020 2020 2020 2020  sses.           
-00012000: 2061 7265 206b 6570 7420 7468 6520 7361   are kept the sa
-00012010: 6d65 2073 697a 6520 6475 7269 6e67 206f  me size during o
-00012020: 7074 696d 697a 6174 696f 6e2c 2061 7070  ptimization, app
-00012030: 6c69 6361 626c 6520 6966 2074 756e 696e  licable if tunin
-00012040: 6720 7468 6520 6175 676d 656e 7461 7469  g the augmentati
-00012050: 6f6e 0a20 2020 2020 2020 2020 2020 2070  on.            p
-00012060: 6172 616d 6574 6572 732e 2044 6566 6175  arameters. Defau
-00012070: 6c74 7320 746f 2054 7275 652e 0a20 2020  lts to True..   
-00012080: 2020 2020 2072 6574 7572 6e5f 7374 7564       return_stud
-00012090: 7920 2862 6f6f 6c2c 206f 7074 696f 6e61  y (bool, optiona
-000120a0: 6c29 3a20 4966 2054 7275 6520 7468 6520  l): If True the 
-000120b0: 4f70 7475 6e61 2073 7475 6479 206f 626a  Optuna study obj
-000120c0: 6563 7420 7769 6c6c 2062 6520 7265 7475  ect will be retu
-000120d0: 726e 6564 2e20 5468 6973 0a20 2020 2020  rned. This.     
-000120e0: 2020 2020 2020 2063 616e 2062 6520 7573         can be us
-000120f0: 6564 2074 6f20 7265 7669 6577 2074 6865  ed to review the
-00012100: 206d 6574 686f 6420 6174 7472 6962 7574   method attribut
-00012110: 6573 2c20 7375 6368 2061 7320 6f70 7469  es, such as opti
-00012120: 6d69 7a61 7469 6f6e 2070 6c6f 7473 2e20  mization plots. 
-00012130: 4465 6661 756c 7473 2074 6f20 5472 7565  Defaults to True
-00012140: 2e0a 0a20 2020 2054 6865 2066 6f6c 6c6c  ...    The folll
-00012150: 6f77 696e 6720 6172 6775 6d65 6e74 7320  owing arguments 
-00012160: 6172 6520 6f6e 6c79 2075 7365 6420 7768  are only used wh
-00012170: 656e 206f 7074 696d 697a 696e 6720 7468  en optimizing th
-00012180: 6520 434e 4e20 6e65 7477 6f72 6b3a 0a0a  e CNN network:..
-00012190: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-000121a0: 2020 696d 675f 6e75 6d5f 6368 616e 6e65    img_num_channe
-000121b0: 6c73 2028 696e 7429 3a20 5468 6520 6e75  ls (int): The nu
-000121c0: 6d62 6572 206f 6620 6669 6c74 6572 732e  mber of filters.
-000121d0: 2044 6566 6175 6c74 7320 746f 2031 2e0a   Defaults to 1..
-000121e0: 2020 2020 2020 2020 6e6f 726d 616c 697a          normaliz
-000121f0: 6520 2862 6f6f 6c2c 206f 7074 696f 6e61  e (bool, optiona
-00012200: 6c29 3a20 4966 2054 7275 6520 7468 6520  l): If True the 
-00012210: 6461 7461 2077 696c 6c20 6265 206d 696e  data will be min
-00012220: 2d6d 6178 206e 6f72 6d61 6c69 7a65 6420  -max normalized 
-00012230: 7573 696e 6720 7468 6520 0a20 2020 2020  using the .     
-00012240: 2020 2020 2020 2069 6e70 7574 206d 696e         input min
-00012250: 2061 6e64 206d 6178 2070 6978 656c 732e   and max pixels.
-00012260: 2044 6566 6175 6c74 7320 746f 2054 7275   Defaults to Tru
-00012270: 652e 0a20 2020 2020 2020 206d 696e 5f70  e..        min_p
-00012280: 6978 656c 2028 696e 742c 206f 7074 696f  ixel (int, optio
-00012290: 6e61 6c29 3a20 5468 6520 6d69 6e69 6d75  nal): The minimu
-000122a0: 6d20 7069 7865 6c20 636f 756e 742c 2070  m pixel count, p
-000122b0: 6978 656c 7320 7769 7468 2063 6f75 6e74  ixels with count
-000122c0: 7320 0a20 2020 2020 2020 2020 2020 2062  s .            b
-000122d0: 656c 6f77 2074 6869 7320 7468 7265 7368  elow this thresh
-000122e0: 6f6c 6420 7769 6c6c 2062 6520 7365 7420  old will be set 
-000122f0: 746f 2074 6869 7320 6c69 6d69 742e 2044  to this limit. D
-00012300: 6566 6175 6c74 7320 746f 2030 2e0a 2020  efaults to 0..  
-00012310: 2020 2020 2020 6d61 785f 7069 7865 6c20        max_pixel 
-00012320: 2869 6e74 2c20 6c69 7374 2c20 6f70 7469  (int, list, opti
-00012330: 6f6e 616c 293a 2054 6865 206d 6178 696d  onal): The maxim
-00012340: 756d 2070 6978 656c 2063 6f75 6e74 2c20  um pixel count, 
-00012350: 7069 7865 6c73 2077 6974 6820 636f 756e  pixels with coun
-00012360: 7473 200a 2020 2020 2020 2020 2020 2020  ts .            
-00012370: 6162 6f76 6520 7468 6973 2074 6872 6573  above this thres
-00012380: 686f 6c64 2077 696c 6c20 6265 2073 6574  hold will be set
-00012390: 2074 6f20 7468 6973 206c 696d 6974 2e20   to this limit. 
-000123a0: 4465 6661 756c 7473 2074 6f20 3130 302e  Defaults to 100.
-000123b0: 2049 6620 696d 675f 6e75 6d5f 6368 616e   If img_num_chan
-000123c0: 6e65 6c73 0a20 2020 2020 2020 2020 2020  nels.           
-000123d0: 2069 7320 6e6f 7420 312c 2074 6865 206d   is not 1, the m
-000123e0: 6178 5f70 6978 656c 2073 686f 756c 6420  ax_pixel should 
-000123f0: 6265 2061 206c 6973 7420 636f 6e74 6169  be a list contai
-00012400: 6e69 6e67 2074 776f 2076 616c 7565 732c  ning two values,
-00012410: 206f 6e65 2066 6f72 2065 6163 6820 6261   one for each ba
-00012420: 6e64 2e0a 2020 2020 2020 2020 7661 6c5f  nd..        val_
-00012430: 706f 7369 7469 7665 2028 6e64 6172 7261  positive (ndarra
-00012440: 792c 206f 7074 696f 6e61 6c29 3a20 506f  y, optional): Po
-00012450: 7369 7469 7665 2063 6c61 7373 2064 6174  sitive class dat
-00012460: 6120 746f 2062 6520 7573 6564 2066 6f72  a to be used for
-00012470: 2076 616c 6964 6174 696f 6e2e 2044 6566   validation. Def
-00012480: 6175 6c74 7320 746f 204e 6f6e 652e 0a20  aults to None.. 
-00012490: 2020 2020 2020 2076 616c 5f6e 6567 6174         val_negat
-000124a0: 6976 6520 286e 6461 7272 6179 2c20 6f70  ive (ndarray, op
-000124b0: 7469 6f6e 616c 293a 204e 6567 6174 6976  tional): Negativ
-000124c0: 6520 636c 6173 7320 6461 7461 2074 6f20  e class data to 
-000124d0: 6265 2075 7365 6420 666f 7220 7661 6c69  be used for vali
-000124e0: 6461 7469 6f6e 2e20 4465 6661 756c 7473  dation. Defaults
-000124f0: 2074 6f20 4e6f 6e65 2e0a 2020 2020 2020   to None..      
-00012500: 2020 7465 7374 5f70 6f73 6974 6976 6520    test_positive 
-00012510: 286e 6461 7272 6179 2c20 6f70 7469 6f6e  (ndarray, option
-00012520: 616c 293a 2050 6f73 6974 6976 6520 636c  al): Positive cl
-00012530: 6173 7320 6461 7461 2074 6f20 6265 2075  ass data to be u
-00012540: 7365 6420 666f 7220 706f 7374 2d74 7269  sed for post-tri
-00012550: 616c 2074 6573 7469 6e67 2e20 4465 6661  al testing. Defa
-00012560: 756c 7473 2074 6f20 4e6f 6e65 2e0a 2020  ults to None..  
-00012570: 2020 2020 2020 7465 7374 5f6e 6567 6174        test_negat
-00012580: 6976 6520 286e 6461 7272 6179 2c20 6f70  ive (ndarray, op
-00012590: 7469 6f6e 616c 293a 204e 6567 6174 6976  tional): Negativ
-000125a0: 6520 636c 6173 7320 6461 7461 2074 6f20  e class data to 
-000125b0: 6265 2075 7365 6420 666f 7220 706f 7374  be used for post
-000125c0: 2d74 7269 616c 2074 6573 7469 6e67 2e20  -trial testing. 
-000125d0: 4465 6661 756c 7473 2074 6f20 4e6f 6e65  Defaults to None
-000125e0: 2e0a 2020 2020 2020 2020 7472 6169 6e5f  ..        train_
-000125f0: 6570 6f63 6873 2028 696e 7429 3a20 4e75  epochs (int): Nu
-00012600: 6d62 6572 206f 6620 6570 6f63 6873 2074  mber of epochs t
-00012610: 6f20 7468 6520 7472 6169 6e20 7468 6520  o the train the 
-00012620: 434e 4e20 746f 2064 7572 696e 6720 7468  CNN to during th
-00012630: 6520 6f70 7469 6d69 7a61 7469 6f6e 2074  e optimization t
-00012640: 7269 616c 732e 2044 6566 6175 6c74 7320  rials. Defaults 
-00012650: 746f 2032 352e 0a20 2020 2020 2020 206d  to 25..        m
-00012660: 6574 7269 6320 2873 7472 293a 2041 7373  etric (str): Ass
-00012670: 6573 6d65 6e74 206d 6574 7269 6320 746f  esment metric to
-00012680: 2075 7365 2077 6865 6e20 626f 7468 2070   use when both p
-00012690: 7275 6e69 6e67 2061 6e64 2073 636f 7269  runing and scori
-000126a0: 6e67 2074 6865 2068 7970 6572 7061 7261  ng the hyperpara
-000126b0: 6d65 7465 7220 6f70 7469 6d69 7a61 7469  meter optimizati
-000126c0: 6f6e 2074 7269 616c 2e0a 2020 2020 2020  on trial..      
-000126d0: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
-000126e0: 6f20 276c 6f73 7327 2e20 4f70 7469 6f6e  o 'loss'. Option
-000126f0: 7320 696e 636c 7564 653a 2027 6c6f 7373  s include: 'loss
-00012700: 2720 2762 696e 6172 795f 6163 6375 7261  ' 'binary_accura
-00012710: 6379 272c 2027 6631 5f73 636f 7265 2720  cy', 'f1_score' 
-00012720: 2761 6c6c 2720 6f72 2074 6865 2076 616c  'all' or the val
-00012730: 6964 6174 696f 6e20 6571 7569 7661 6c65  idation equivale
-00012740: 6e74 7320 2865 2e67 2e20 2776 616c 5f6c  nts (e.g. 'val_l
-00012750: 6f73 7327 292e 0a20 2020 2020 2020 2070  oss')..        p
-00012760: 6174 6965 6e63 6520 2869 6e74 293a 204e  atience (int): N
-00012770: 756d 6265 7220 6f66 2065 706f 6368 7320  umber of epochs 
-00012780: 7769 7468 6f75 7420 696d 7072 6f76 656d  without improvem
-00012790: 656e 7420 6265 666f 7265 2074 6865 206f  ent before the o
-000127a0: 7074 696d 697a 6174 696f 6e20 7472 6961  ptimization tria
-000127b0: 6c20 6973 2074 6572 6d69 6e61 7465 642e  l is terminated.
-000127c0: 2044 6566 6175 6c74 7320 746f 2030 2c20   Defaults to 0, 
-000127d0: 7768 6963 680a 2020 2020 2020 2020 2020  which.          
-000127e0: 2020 6469 7361 626c 6573 2074 6869 7320    disables this 
-000127f0: 6665 6174 7572 652e 0a20 2020 2020 2020  feature..       
-00012800: 2061 7665 7261 6765 2028 626f 6f6c 293a   average (bool):
-00012810: 2049 6620 4661 6c73 652c 2074 6865 2064   If False, the d
-00012820: 6573 6967 6e61 7465 6420 6d65 7472 6963  esignated metric
-00012830: 2077 696c 6c20 6265 2063 616c 6375 6c61   will be calcula
-00012840: 7465 6420 6163 636f 7264 696e 6720 746f  ted according to
-00012850: 2069 7473 2076 616c 7565 2061 7420 7468   its value at th
-00012860: 6520 656e 6420 6f66 2074 6865 2074 7261  e end of the tra
-00012870: 696e 5f65 706f 6368 732e 200a 2020 2020  in_epochs. .    
-00012880: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-00012890: 2074 6865 206d 6574 7269 6320 7769 6c6c   the metric will
-000128a0: 2062 6520 6176 6572 6167 6564 206f 7574   be averaged out
-000128b0: 2061 6372 6f73 7320 616c 6c20 7472 6169   across all trai
-000128c0: 6e5f 6570 6f63 6873 2e20 4465 6661 756c  n_epochs. Defaul
-000128d0: 7473 2074 6f20 5472 7565 2e0a 2020 2020  ts to True..    
-000128e0: 2020 2020 6f70 745f 6d6f 6465 6c20 2862      opt_model (b
-000128f0: 6f6f 6c29 3a20 4966 2054 7275 652c 2074  ool): If True, t
-00012900: 6865 2061 7263 6869 7465 6374 7572 6520  he architecture 
-00012910: 7061 7261 6d65 7465 7273 2077 696c 6c20  parameters will 
-00012920: 6265 206f 7074 696d 697a 6564 2e20 4465  be optimized. De
-00012930: 6661 756c 7473 2074 6f20 5472 7565 2e0a  faults to True..
-00012940: 2020 2020 2020 2020 6f70 745f 6175 6720          opt_aug 
-00012950: 2862 6f6f 6c29 3a20 4966 2054 7275 652c  (bool): If True,
-00012960: 2074 6865 2061 7567 6d65 6e74 6174 696f   the augmentatio
-00012970: 6e20 7072 6f63 6564 7572 6520 7769 6c6c  n procedure will
-00012980: 2062 6520 6f70 7469 6d69 7a65 642e 2044   be optimized. D
-00012990: 6566 6175 6c74 7320 746f 2046 616c 7365  efaults to False
-000129a0: 2e0a 2020 2020 2020 2020 6261 7463 685f  ..        batch_
-000129b0: 6d69 6e20 2869 6e74 293a 2054 6865 206d  min (int): The m
-000129c0: 696e 696d 756d 206e 756d 6265 7220 6f66  inimum number of
-000129d0: 2061 7567 6d65 6e74 6174 696f 6e73 2074   augmentations t
-000129e0: 6f20 7065 7266 6f72 6d20 7065 7220 696d  o perform per im
-000129f0: 6167 6520 6f6e 2074 6865 2070 6f73 6974  age on the posit
-00012a00: 6976 6520 636c 6173 732c 206f 6e6c 7920  ive class, only 
-00012a10: 6170 706c 6963 6162 6c65 200a 2020 2020  applicable .    
-00012a20: 2020 2020 6966 206f 7074 5f61 7567 3d54      if opt_aug=T
-00012a30: 7275 652e 2044 6566 6175 6c74 7320 746f  rue. Defaults to
-00012a40: 2032 2e0a 2020 2020 2020 2020 6261 7463   2..        batc
-00012a50: 685f 6d61 7820 2869 6e74 293a 2054 6865  h_max (int): The
-00012a60: 206d 6178 696d 756d 206e 756d 6265 7220   maximum number 
-00012a70: 6f66 2061 7567 6d65 6e74 6174 696f 6e73  of augmentations
-00012a80: 2074 6f20 7065 7266 6f72 6d20 7065 7220   to perform per 
-00012a90: 696d 6167 6520 6f6e 2074 6865 2070 6f73  image on the pos
-00012aa0: 6974 6976 6520 636c 6173 732c 206f 6e6c  itive class, onl
-00012ab0: 7920 6170 706c 6963 6162 6c65 200a 2020  y applicable .  
-00012ac0: 2020 2020 2020 6966 206f 7074 5f61 7567        if opt_aug
-00012ad0: 3d54 7275 652e 2044 6566 6175 6c74 7320  =True. Defaults 
-00012ae0: 746f 2032 352e 0a20 2020 2020 2020 2069  to 25..        i
-00012af0: 6d61 6765 5f73 697a 655f 6d69 6e20 2869  mage_size_min (i
-00012b00: 6e74 293a 2054 6865 206d 696e 696d 756d  nt): The minimum
-00012b10: 2069 6d61 6765 2073 697a 6520 746f 2061   image size to a
-00012b20: 7373 6573 732c 206f 6e6c 7920 6170 706c  ssess, only appl
-00012b30: 6963 6162 6c65 2069 6620 6f70 745f 6175  icable if opt_au
-00012b40: 673d 5472 7565 2e20 4465 6661 756c 7473  g=True. Defaults
-00012b50: 2074 6f20 3530 2e0a 2020 2020 2020 2020   to 50..        
-00012b60: 696d 6167 655f 7369 7a65 5f6d 6178 2028  image_size_max (
-00012b70: 696e 7429 3a20 5468 6520 6d61 7869 6d75  int): The maximu
-00012b80: 6d20 696d 6167 6520 7369 7a65 2074 6f20  m image size to 
-00012b90: 6173 7365 7373 2c20 6f6e 6c79 2061 7070  assess, only app
-00012ba0: 6c69 6361 626c 6520 6966 206f 7074 5f61  licable if opt_a
-00012bb0: 7567 3d54 7275 652e 2044 6566 6175 6c74  ug=True. Default
-00012bc0: 7320 746f 2031 3030 2e0a 2020 2020 2020  s to 100..      
-00012bd0: 2020 6f70 745f 6d61 785f 6d69 6e5f 7069    opt_max_min_pi
-00012be0: 7820 2869 6e74 2c20 6f70 7469 6f6e 616c  x (int, optional
-00012bf0: 293a 2054 6865 206d 696e 696d 756d 206d  ): The minimum m
-00012c00: 6178 2070 6978 656c 2076 616c 7565 2074  ax pixel value t
-00012c10: 6f20 7573 6520 7768 656e 2074 756e 696e  o use when tunin
-00012c20: 6720 7468 6520 6e6f 726d 616c 697a 6174  g the normalizat
-00012c30: 696f 6e20 7072 6f63 6564 7572 652c 200a  ion procedure, .
-00012c40: 2020 2020 2020 2020 2020 2020 6f6e 6c79              only
-00012c50: 2061 7070 6c69 6361 626c 6520 6966 206f   applicable if o
-00012c60: 7074 5f61 7567 3d54 7275 652e 2044 6566  pt_aug=True. Def
-00012c70: 6175 6c74 7320 746f 204e 6f6e 652e 0a20  aults to None.. 
-00012c80: 2020 2020 2020 206f 7074 5f6d 6178 5f6d         opt_max_m
-00012c90: 6178 5f70 6978 2028 696e 742c 206f 7074  ax_pix (int, opt
-00012ca0: 696f 6e61 6c29 3a20 5468 6520 6d61 7869  ional): The maxi
-00012cb0: 6d75 6d20 6d61 7820 7069 7865 6c20 7661  mum max pixel va
-00012cc0: 6c75 6520 746f 2075 7365 2077 6865 6e20  lue to use when 
-00012cd0: 7475 6e69 6e67 2074 6865 206e 6f72 6d61  tuning the norma
-00012ce0: 6c69 7a61 7469 6f6e 2070 726f 6365 6475  lization procedu
-00012cf0: 7265 2c20 0a20 2020 2020 2020 2020 2020  re, .           
-00012d00: 206f 6e6c 7920 6170 706c 6963 6162 6c65   only applicable
-00012d10: 2069 6620 6f70 745f 6175 673d 5472 7565   if opt_aug=True
-00012d20: 2e20 4465 6661 756c 7473 2074 6f20 4e6f  . Defaults to No
-00012d30: 6e65 2e0a 2020 2020 2020 2020 7368 6966  ne..        shif
-00012d40: 7420 2869 6e74 293a 2054 6865 206d 6178  t (int): The max
-00012d50: 2061 6c6c 6f77 6564 2076 6572 7469 6361   allowed vertica
-00012d60: 6c2f 686f 7269 7a6f 6e74 616c 2073 6869  l/horizontal shi
-00012d70: 6674 7320 746f 2075 7365 2064 7572 696e  fts to use durin
-00012d80: 6720 7468 6520 6461 7461 2061 7567 6d65  g the data augme
-00012d90: 6e74 6174 696f 6e20 726f 7574 696e 652c  ntation routine,
-00012da0: 206f 6e6c 7920 6170 706c 6963 6162 6c65   only applicable
-00012db0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00012dc0: 6f70 745f 6175 673d 5472 7565 2e20 4465  opt_aug=True. De
-00012dd0: 6661 756c 7473 2074 6f20 3130 2070 6978  faults to 10 pix
-00012de0: 656c 732e 0a20 2020 2020 2020 206d 6173  els..        mas
-00012df0: 6b5f 7369 7a65 2028 696e 742c 206f 7074  k_size (int, opt
-00012e00: 696f 6e61 6c29 3a20 4966 2065 6e61 626c  ional): If enabl
-00012e10: 6564 2c20 7468 6973 2077 696c 6c20 7365  ed, this will se
-00012e20: 7420 7468 6520 7069 7865 6c20 6c65 6e67  t the pixel leng
-00012e30: 7468 206f 6620 6120 7371 7561 7265 2063  th of a square c
-00012e40: 7574 6f75 742c 2074 6f20 6265 2072 616e  utout, to be ran
-00012e50: 646f 6d6c 7920 706c 6163 6564 0a20 2020  domly placed.   
-00012e60: 2020 2020 2020 2020 2073 6f6d 6577 6865           somewhe
-00012e70: 7265 2069 6e20 7468 6520 6175 676d 656e  re in the augmen
-00012e80: 7465 6420 696d 6167 652e 2054 6869 7320  ted image. This 
-00012e90: 6375 746f 7574 2077 696c 6c20 7265 706c  cutout will repl
-00012ea0: 6163 6520 7468 6520 696d 6167 6520 7661  ace the image va
-00012eb0: 6c75 6573 2077 6974 6820 302c 2074 6865  lues with 0, the
-00012ec0: 7265 666f 7265 2073 6572 7669 6e67 2061  refore serving a
-00012ed0: 7320 6120 0a20 2020 2020 2020 2020 2020  s a .           
-00012ee0: 2072 6567 756c 6172 697a 6572 2e20 4f6e   regularizer. On
-00012ef0: 6c79 2061 7070 6c69 6361 626c 6520 6966  ly applicable if
-00012f00: 206f 7074 5f61 7567 3d54 7275 652e 2044   opt_aug=True. D
-00012f10: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
-00012f20: 0a20 2020 2020 2020 206e 756d 5f6d 6173  .        num_mas
-00012f30: 6b73 2028 696e 742c 206f 7074 696f 6e61  ks (int, optiona
-00012f40: 6c29 3a20 5468 6520 6e75 6d62 6572 206f  l): The number o
-00012f50: 6620 6d61 736b 7320 746f 2063 7265 6174  f masks to creat
-00012f60: 652c 2074 6f20 6265 2075 7365 6420 616c  e, to be used al
-00012f70: 6f6e 6773 6964 6520 7468 6520 6d61 736b  ongside the mask
-00012f80: 5f73 697a 6520 7061 7261 6d65 7465 722e  _size parameter.
-00012f90: 2049 6620 0a20 2020 2020 2020 2020 2020   If .           
-00012fa0: 2074 6869 7320 6973 2073 6574 2074 6f20   this is set to 
-00012fb0: 6120 7661 6c75 6520 6772 6561 7465 7220  a value greater 
-00012fc0: 7468 616e 206f 6e65 2c20 6f76 6572 6c61  than one, overla
-00012fd0: 7020 6d61 7920 6f63 6375 722e 200a 2020  p may occur. .  
-00012fe0: 2020 2020 2020 7665 7262 6f73 6520 2869        verbose (i
-00012ff0: 6e74 293a 2043 6f6e 7472 6f6c 7320 7468  nt): Controls th
-00013000: 6520 616d 6f75 6e74 206f 6620 6f75 7470  e amount of outp
-00013010: 7574 2070 7269 6e74 6564 2064 7572 696e  ut printed durin
-00013020: 6720 7468 6520 7472 6169 6e69 6e67 2070  g the training p
-00013030: 726f 6365 7373 2e20 4120 7661 6c75 6520  rocess. A value 
-00013040: 6f66 2030 2069 7320 666f 7220 7369 6c65  of 0 is for sile
-00013050: 6e74 206d 6f64 652c 200a 2020 2020 2020  nt mode, .      
-00013060: 2020 2020 2020 6120 7661 6c75 6520 6f66        a value of
-00013070: 2031 2069 7320 7573 6564 2066 6f72 2070   1 is used for p
-00013080: 726f 6772 6573 7320 6261 7220 6d6f 6465  rogress bar mode
-00013090: 2c20 616e 6420 3220 666f 7220 6f6e 6520  , and 2 for one 
-000130a0: 6c69 6e65 2070 6572 2065 706f 6368 206d  line per epoch m
-000130b0: 6f64 652e 2044 6566 6175 6c74 7320 746f  ode. Defaults to
-000130c0: 2031 2e0a 0a20 2020 2054 6865 2066 6f6c   1...    The fol
-000130d0: 6c6c 6f77 696e 6720 6172 6775 6d65 6e74  llowing argument
-000130e0: 7320 6361 6e20 6265 2075 7365 6420 746f  s can be used to
-000130f0: 2073 6574 2065 6172 6c79 2d73 746f 7070   set early-stopp
-00013100: 696e 6720 6361 6c6c 6261 636b 732e 2054  ing callbacks. T
-00013110: 6865 7365 2063 616e 2062 6520 7573 6564  hese can be used
-00013120: 2074 6f20 7465 726d 696e 6174 6520 7472   to terminate tr
-00013130: 6961 6c73 2074 6861 7420 6578 6365 6564  ials that exceed
-00013140: 0a20 2020 2070 7265 2d64 6574 6572 6d69  .    pre-determi
-00013150: 6e65 6420 7468 7265 7368 6f6c 6473 2c20  ned thresholds, 
-00013160: 7768 6963 6820 6d61 7920 6265 2069 6e64  which may be ind
-00013170: 6963 6174 6976 6520 6f66 2061 6e20 6f76  icative of an ov
-00013180: 6572 6669 7420 6d6f 6465 6c2e 0a0a 2020  erfit model...  
-00013190: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-000131a0: 7472 6169 6e5f 6163 635f 7468 7265 7368  train_acc_thresh
-000131b0: 6f6c 6420 2866 6c6f 6174 2c20 6f70 7469  old (float, opti
-000131c0: 6f6e 616c 293a 2041 2076 616c 7565 2062  onal): A value b
-000131d0: 6574 7765 656e 2030 2061 6e64 2031 2074  etween 0 and 1 t
-000131e0: 6861 7420 6465 7369 676e 6174 6573 2074  hat designates t
-000131f0: 6865 2074 7261 696e 696e 6720 6269 6e61  he training bina
-00013200: 7279 5f61 6363 7572 6163 7920 7468 7265  ry_accuracy thre
-00013210: 7368 6f6c 6420 7468 6174 2073 686f 756c  shold that shoul
-00013220: 640a 2020 2020 2020 2020 2020 2020 6e6f  d.            no
-00013230: 7420 6265 2065 7863 6565 6465 642e 2041  t be exceeded. A
-00013240: 7320 736f 6f6e 2061 7320 7468 6520 7472  s soon as the tr
-00013250: 6169 6e69 6e67 2065 7863 6565 6473 2074  aining exceeds t
-00013260: 6869 7320 6c69 6d69 742c 2074 6865 2074  his limit, the t
-00013270: 7269 616c 2069 7320 7374 6f70 7065 6420  rial is stopped 
-00013280: 6561 726c 792e 2044 6566 6175 6c74 7320  early. Defaults 
-00013290: 746f 204e 6f6e 652e 0a20 2020 2020 2020  to None..       
-000132a0: 206d 6f6e 6974 6f72 3120 2873 7472 2c20   monitor1 (str, 
-000132b0: 6f70 7469 6f6e 616c 293a 2054 6865 2066  optional): The f
-000132c0: 6972 7374 206d 6574 7269 6320 746f 206d  irst metric to m
-000132d0: 6f6e 6974 6f72 2c20 6361 6e20 7461 6b65  onitor, can take
-000132e0: 2074 6865 2073 616d 6520 7661 6c75 6573   the same values
-000132f0: 2061 7320 7468 6520 6d65 7472 6963 2061   as the metric a
-00013300: 7267 756d 656e 742e 2044 6566 6175 6c74  rgument. Default
-00013310: 7320 746f 204e 6f6e 652e 0a20 2020 2020  s to None..     
-00013320: 2020 206d 6f6e 6974 6f72 3220 2873 7472     monitor2 (str
-00013330: 2c20 6f70 7469 6f6e 616c 293a 2054 6865  , optional): The
-00013340: 2073 6563 6f6e 6420 6d65 7472 6963 2074   second metric t
-00013350: 6f20 6d6f 6e69 746f 722c 2063 616e 2074  o monitor, can t
-00013360: 616b 6520 7468 6520 7361 6d65 2076 616c  ake the same val
-00013370: 7565 7320 6173 2074 6865 206d 6574 7269  ues as the metri
-00013380: 6320 6172 6775 6d65 6e74 2e20 4465 6661  c argument. Defa
-00013390: 756c 7473 2074 6f20 4e6f 6e65 2e0a 2020  ults to None..  
-000133a0: 2020 2020 2020 6d6f 6e69 746f 7231 5f74        monitor1_t
-000133b0: 6872 6573 6820 2866 6c6f 6174 2c20 6f70  hresh (float, op
-000133c0: 7469 6f6e 616c 293a 2054 6865 2074 6872  tional): The thr
-000133d0: 6573 686f 6c64 2076 616c 7565 206f 6620  eshold value of 
-000133e0: 7468 6520 6669 7273 7420 6d6f 6e69 746f  the first monito
-000133f0: 7220 6d65 7472 6963 2e20 4966 2074 6865  r metric. If the
-00013400: 206d 6574 7269 6320 6973 206c 6f73 732d   metric is loss-
-00013410: 7265 6c61 7465 640a 2020 2020 2020 2020  related.        
-00013420: 2020 2020 7468 6520 7472 6169 6e69 6e67      the training
-00013430: 2077 696c 6c20 7374 6f70 2065 6172 6c79   will stop early
-00013440: 2069 6620 7468 6520 7661 6c75 6520 6661   if the value fa
-00013450: 6c6c 7320 6265 6c6f 7720 7468 6973 2074  lls below this t
-00013460: 6872 6573 686f 6c64 2e20 5369 6d69 6c61  hreshold. Simila
-00013470: 726c 792c 2069 6620 7468 6520 6d65 7472  rly, if the metr
-00013480: 6963 2069 7320 6163 6375 7261 6379 2d72  ic is accuracy-r
-00013490: 656c 6174 6564 2c0a 2020 2020 2020 2020  elated,.        
-000134a0: 2020 2020 7468 656e 2074 6865 2074 7261      then the tra
-000134b0: 696e 696e 6720 7769 6c6c 2073 746f 7020  ining will stop 
-000134c0: 6561 726c 7920 6966 2074 6865 2076 616c  early if the val
-000134d0: 7565 2066 616c 6c73 2061 626f 7665 2074  ue falls above t
-000134e0: 6869 7320 7468 7265 7368 6f6c 642e 2044  his threshold. D
-000134f0: 6566 6175 6c74 7320 746f 204e 6f6e 652e  efaults to None.
-00013500: 0a20 2020 2020 2020 206d 6f6e 6974 6f72  .        monitor
-00013510: 325f 7468 7265 7368 2028 666c 6f61 742c  2_thresh (float,
-00013520: 206f 7074 696f 6e61 6c29 3a20 5468 6520   optional): The 
-00013530: 7468 7265 7368 6f6c 6420 7661 6c75 6520  threshold value 
-00013540: 6f66 2074 6865 2073 6563 6f6e 6420 6d6f  of the second mo
-00013550: 6e69 746f 7220 6d65 7472 6963 2e20 4966  nitor metric. If
-00013560: 2074 6865 206d 6574 7269 6320 6973 206c   the metric is l
-00013570: 6f73 732d 7265 6c61 7465 640a 2020 2020  oss-related.    
-00013580: 2020 2020 2020 2020 7468 6520 7472 6169          the trai
-00013590: 6e69 6e67 2077 696c 6c20 7374 6f70 2065  ning will stop e
-000135a0: 6172 6c79 2069 6620 7468 6520 7661 6c75  arly if the valu
-000135b0: 6520 6661 6c6c 7320 6265 6c6f 7720 7468  e falls below th
-000135c0: 6973 2074 6872 6573 686f 6c64 2e20 5369  is threshold. Si
-000135d0: 6d69 6c61 726c 792c 2069 6620 7468 6520  milarly, if the 
-000135e0: 6d65 7472 6963 2069 7320 6163 6375 7261  metric is accura
-000135f0: 6379 2d72 656c 6174 6564 2c0a 2020 2020  cy-related,.    
-00013600: 2020 2020 2020 2020 7468 656e 2074 6865          then the
-00013610: 2074 7261 696e 696e 6720 7769 6c6c 2073   training will s
-00013620: 746f 7020 6561 726c 7920 6966 2074 6865  top early if the
-00013630: 2076 616c 7565 2066 616c 6c73 2061 626f   value falls abo
-00013640: 7665 2074 6869 7320 7468 7265 7368 6f6c  ve this threshol
-00013650: 642e 2044 6566 6175 6c74 7320 746f 204e  d. Defaults to N
-00013660: 6f6e 652e 0a20 2020 2020 2020 200a 2020  one..        .  
-00013670: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-00013680: 2020 2054 6865 2066 6972 7374 206f 7574     The first out
-00013690: 7075 7420 6973 2074 6865 2063 6c61 7373  put is the class
-000136a0: 6966 6965 7220 7769 7468 2074 6865 206f  ifier with the o
-000136b0: 7074 696d 616c 2068 7970 6572 7061 7261  ptimal hyperpara
-000136c0: 6d65 7465 7273 2e0a 2020 2020 2020 2020  meters..        
-000136d0: 5365 636f 6e64 206f 7574 7075 7420 6973  Second output is
-000136e0: 2061 2064 6963 7469 6f6e 6172 7920 636f   a dictionary co
-000136f0: 6e74 6169 6e69 6e67 2074 6865 206f 7074  ntaining the opt
-00013700: 696d 616c 2068 7970 6572 7061 7261 6d65  imal hyperparame
-00013710: 7465 7273 2e0a 2020 2020 2020 2020 4966  ters..        If
-00013720: 2073 6176 655f 7374 7564 793d 5472 7565   save_study=True
-00013730: 2c20 7468 6520 4f70 7475 6e61 2073 7475  , the Optuna stu
-00013740: 6479 206f 626a 6563 7420 7769 6c6c 2062  dy object will b
-00013750: 6520 7468 6520 7468 6972 6420 6f75 7470  e the third outp
-00013760: 7574 2e0a 2020 2020 2222 220a 0a20 2020  ut..    """..   
-00013770: 2069 6620 636c 6620 3d3d 2027 7266 273a   if clf == 'rf':
-00013780: 0a20 2020 2020 2020 206d 6f64 656c 5f30  .        model_0
-00013790: 203d 2052 616e 646f 6d46 6f72 6573 7443   = RandomForestC
-000137a0: 6c61 7373 6966 6965 7228 7261 6e64 6f6d  lassifier(random
-000137b0: 5f73 7461 7465 3d31 3930 3929 0a20 2020  _state=1909).   
-000137c0: 2065 6c69 6620 636c 6620 3d3d 2027 6e6e   elif clf == 'nn
-000137d0: 273a 0a20 2020 2020 2020 206d 6f64 656c  ':.        model
-000137e0: 5f30 203d 204d 4c50 436c 6173 7369 6669  _0 = MLPClassifi
-000137f0: 6572 2872 616e 646f 6d5f 7374 6174 653d  er(random_state=
-00013800: 3139 3039 290a 2020 2020 656c 6966 2063  1909).    elif c
-00013810: 6c66 203d 3d20 2778 6762 273a 0a20 2020  lf == 'xgb':.   
-00013820: 2020 2020 206d 6f64 656c 5f30 203d 2058       model_0 = X
-00013830: 4742 436c 6173 7369 6669 6572 2872 616e  GBClassifier(ran
-00013840: 646f 6d5f 7374 6174 653d 3139 3039 290a  dom_state=1909).
-00013850: 2020 2020 2020 2020 6966 2061 6c6c 2869          if all(i
-00013860: 7369 6e73 7461 6e63 6528 7661 6c2c 2028  sinstance(val, (
-00013870: 696e 742c 2073 7472 2929 2066 6f72 2076  int, str)) for v
-00013880: 616c 2069 6e20 6461 7461 5f79 293a 0a20  al in data_y):. 
-00013890: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000138a0: 2827 5847 426f 6f73 7420 636c 6173 7369  ('XGBoost classi
-000138b0: 6669 6572 2072 6571 7569 7265 7320 6e75  fier requires nu
-000138c0: 6d65 7269 6361 6c20 636c 6173 7320 6c61  merical class la
-000138d0: 6265 6c73 2120 436f 6e76 6572 7469 6e67  bels! Converting
-000138e0: 2063 6c61 7373 206c 6162 656c 7320 6173   class labels as
-000138f0: 2066 6f6c 6c6f 7773 3a27 290a 2020 2020   follows:').    
-00013900: 2020 2020 2020 2020 7072 696e 7428 275f          print('_
-00013910: 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f  ________________
-00013920: 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f  ________________
-00013930: 5f5f 5f27 290a 2020 2020 2020 2020 2020  ___').          
-00013940: 2020 7920 3d20 6e70 2e7a 6572 6f73 286c    y = np.zeros(l
-00013950: 656e 2864 6174 615f 7929 290a 2020 2020  en(data_y)).    
-00013960: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00013970: 2072 616e 6765 286c 656e 286e 702e 756e   range(len(np.un
-00013980: 6971 7565 2864 6174 615f 7929 2929 3a0a  ique(data_y))):.
-00013990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139a0: 7072 696e 7428 7374 7228 6e70 2e75 6e69  print(str(np.uni
-000139b0: 7175 6528 6461 7461 5f79 295b 695d 292e  que(data_y)[i]).
-000139c0: 6c6a 7573 7428 3130 292b 2720 202d 2d2d  ljust(10)+'  ---
-000139d0: 2d2d 2d2d 2d2d 2d2d 2d2d 3e20 2020 2020  ---------->     
-000139e0: 272b 7374 7228 6929 290a 2020 2020 2020  '+str(i)).      
-000139f0: 2020 2020 2020 2020 2020 696e 6465 7820            index 
-00013a00: 3d20 6e70 2e77 6865 7265 2864 6174 615f  = np.where(data_
-00013a10: 7920 3d3d 206e 702e 756e 6971 7565 2864  y == np.unique(d
-00013a20: 6174 615f 7929 5b69 5d29 5b30 5d0a 2020  ata_y)[i])[0].  
-00013a30: 2020 2020 2020 2020 2020 2020 2020 795b                y[
-00013a40: 696e 6465 785d 203d 2069 0a20 2020 2020  index] = i.     
-00013a50: 2020 2020 2020 2064 6174 615f 7920 3d20         data_y = 
-00013a60: 7920 0a20 2020 2020 2020 2020 2020 2070  y .            p
-00013a70: 7269 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d  rint('----------
-00013a80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00013a90: 2d2d 2d2d 2d2d 2d2d 2d2d 2729 0a20 2020  ----------').   
-00013aa0: 2065 6c69 6620 636c 6620 3d3d 2027 636e   elif clf == 'cn
-00013ab0: 6e27 3a0a 2020 2020 2020 2020 7061 7373  n':.        pass
-00013ac0: 200a 2020 2020 656c 7365 3a0a 2020 2020   .    else:.    
-00013ad0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00013ae0: 7272 6f72 2827 636c 6620 6172 6775 6d65  rror('clf argume
-00013af0: 6e74 206d 7573 7420 6569 7468 6572 2062  nt must either b
-00013b00: 6520 2272 6622 2c20 2278 6762 222c 2022  e "rf", "xgb", "
-00013b10: 6e6e 222c 206f 7220 2263 6e6e 222e 2729  nn", or "cnn".')
-00013b20: 0a0a 2020 2020 6966 2063 6c66 2021 3d20  ..    if clf != 
-00013b30: 2763 6e6e 273a 0a20 2020 2020 2020 2063  'cnn':.        c
-00013b40: 7620 3d20 6372 6f73 735f 7661 6c69 6461  v = cross_valida
-00013b50: 7465 286d 6f64 656c 5f30 2c20 6461 7461  te(model_0, data
-00013b60: 5f78 2c20 6461 7461 5f79 2c20 6376 3d6f  _x, data_y, cv=o
-00013b70: 7074 5f63 7629 0a20 2020 2020 2020 2069  pt_cv).        i
-00013b80: 6e69 7469 616c 5f73 636f 7265 203d 206e  nitial_score = n
-00013b90: 702e 6d65 616e 2863 765b 2774 6573 745f  p.mean(cv['test_
-00013ba0: 7363 6f72 6527 5d29 0a0a 2020 2020 7361  score'])..    sa
-00013bb0: 6d70 6c65 7220 3d20 6f70 7475 6e61 2e73  mpler = optuna.s
-00013bc0: 616d 706c 6572 732e 5450 4553 616d 706c  amplers.TPESampl
-00013bd0: 6572 2873 6565 643d 3139 3039 290a 2020  er(seed=1909).  
-00013be0: 2020 7374 7564 7920 3d20 6f70 7475 6e61    study = optuna
-00013bf0: 2e63 7265 6174 655f 7374 7564 7928 6469  .create_study(di
-00013c00: 7265 6374 696f 6e3d 276d 6178 696d 697a  rection='maximiz
-00013c10: 6527 2c20 7361 6d70 6c65 723d 7361 6d70  e', sampler=samp
-00013c20: 6c65 722c 2070 7275 6e65 723d 6f70 7475  ler, pruner=optu
-00013c30: 6e61 2e70 7275 6e65 7273 2e4d 6564 6961  na.pruners.Media
-00013c40: 6e50 7275 6e65 7228 6e5f 7374 6172 7475  nPruner(n_startu
-00013c50: 705f 7472 6961 6c73 3d35 2c20 6e5f 7761  p_trials=5, n_wa
-00013c60: 726d 7570 5f73 7465 7073 3d33 302c 2069  rmup_steps=30, i
-00013c70: 6e74 6572 7661 6c5f 7374 6570 733d 3130  nterval_steps=10
-00013c80: 2929 0a20 2020 2070 7269 6e74 2827 5374  )).    print('St
-00013c90: 6172 7469 6e67 2068 7970 6572 7061 7261  arting hyperpara
-00013ca0: 6d65 7465 7220 6f70 7469 6d69 7a61 7469  meter optimizati
-00013cb0: 6f6e 2c20 7468 6973 2077 696c 6c20 7461  on, this will ta
-00013cc0: 6b65 2061 2077 6869 6c65 2e2e 2e27 290a  ke a while...').
-00013cd0: 2020 2020 2349 6620 6269 6e61 7279 2063      #If binary c
-00013ce0: 6c61 7373 6966 6963 6174 696f 6e20 7461  lassification ta
-00013cf0: 736b 2c20 6361 6e20 6465 616c 2077 6974  sk, can deal wit
-00013d00: 6820 696d 6261 6c61 6e63 6520 636c 6173  h imbalance clas
-00013d10: 7365 7320 7769 7468 2077 6569 6768 7473  ses with weights
-00013d20: 2068 7970 6572 7061 7261 6d65 7465 720a   hyperparameter.
-00013d30: 2020 2020 6966 206c 656e 286e 702e 756e      if len(np.un
-00013d40: 6971 7565 2864 6174 615f 7929 2920 3d3d  ique(data_y)) ==
-00013d50: 2032 2061 6e64 2063 6c66 2021 3d20 2763   2 and clf != 'c
-00013d60: 6e6e 273a 0a20 2020 2020 2020 2063 6f75  nn':.        cou
-00013d70: 6e74 6572 203d 2043 6f75 6e74 6572 2864  nter = Counter(d
-00013d80: 6174 615f 7929 0a20 2020 2020 2020 2069  ata_y).        i
-00013d90: 6620 636f 756e 7465 725b 6e70 2e75 6e69  f counter[np.uni
-00013da0: 7175 6528 6461 7461 5f79 295b 305d 5d20  que(data_y)[0]] 
-00013db0: 213d 2063 6f75 6e74 6572 5b6e 702e 756e  != counter[np.un
-00013dc0: 6971 7565 2864 6174 615f 7929 5b31 5d5d  ique(data_y)[1]]
-00013dd0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00013de0: 2062 616c 616e 6365 3a0a 2020 2020 2020   balance:.      
-00013df0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00013e00: 2755 6e62 616c 616e 6365 6420 6461 7461  'Unbalanced data
-00013e10: 7365 7420 6465 7465 6374 6564 2c20 7769  set detected, wi
-00013e20: 6c6c 2074 7261 696e 2063 6c61 7373 6966  ll train classif
-00013e30: 6965 7220 7769 7468 2077 6569 6768 7473  ier with weights
-00013e40: 2120 546f 2064 6973 6162 6c65 2c20 7365  ! To disable, se
-00013e50: 7420 6261 6c61 6e63 653d 4661 6c73 6527  t balance=False'
-00013e60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00013e70: 2020 6966 2063 6c66 203d 3d20 2778 6762    if clf == 'xgb
-00013e80: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00013e90: 2020 2020 2020 2074 6f74 616c 5f6e 6567         total_neg
-00013ea0: 6174 6976 6520 3d20 6c65 6e28 6e70 2e77  ative = len(np.w
-00013eb0: 6865 7265 2864 6174 615f 7920 3d3d 2063  here(data_y == c
-00013ec0: 6f75 6e74 6572 2e6d 6f73 745f 636f 6d6d  ounter.most_comm
-00013ed0: 6f6e 2831 295b 305d 5b30 5d29 5b30 5d29  on(1)[0][0])[0])
-00013ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013ef0: 2020 2020 2074 6f74 616c 5f70 6f73 6974       total_posit
-00013f00: 6976 6520 3d20 6c65 6e28 6461 7461 5f79  ive = len(data_y
-00013f10: 2920 2d20 746f 7461 6c5f 6e65 6761 7469  ) - total_negati
-00013f20: 7665 0a20 2020 2020 2020 2020 2020 2020  ve.             
-00013f30: 2020 2020 2020 2073 616d 706c 655f 7765         sample_we
-00013f40: 6967 6874 203d 2074 6f74 616c 5f6e 6567  ight = total_neg
-00013f50: 6174 6976 6520 2f20 746f 7461 6c5f 706f  ative / total_po
-00013f60: 7369 7469 7665 0a20 2020 2020 2020 2020  sitive.         
-00013f70: 2020 2020 2020 2065 6c69 6620 636c 6620         elif clf 
-00013f80: 3d3d 2027 7266 273a 0a20 2020 2020 2020  == 'rf':.       
-00013f90: 2020 2020 2020 2020 2020 2020 2073 616d               sam
-00013fa0: 706c 655f 7765 6967 6874 203d 2027 6261  ple_weight = 'ba
-00013fb0: 6c61 6e63 6564 270a 2020 2020 2020 2020  lanced'.        
-00013fc0: 2020 2020 2020 2020 656c 6966 2063 6c66          elif clf
-00013fd0: 203d 3d20 276e 6e27 3a0a 2020 2020 2020   == 'nn':.      
-00013fe0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00013ff0: 696e 7428 2757 4152 4e49 4e47 3a20 4d4c  int('WARNING: ML
-00014000: 5043 6c61 7373 6966 6965 7228 2920 646f  PClassifier() do
-00014010: 6573 206e 6f74 2073 7570 706f 7274 2073  es not support s
-00014020: 616d 706c 6520 7765 6967 6874 732e 2729  ample weights.')
-00014030: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00014040: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00014050: 2020 2073 616d 706c 655f 7765 6967 6874     sample_weight
-00014060: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00014070: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00014080: 2020 7361 6d70 6c65 5f77 6569 6768 7420    sample_weight 
-00014090: 3d20 4e6f 6e65 0a20 2020 2065 6c73 653a  = None.    else:
-000140a0: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-000140b0: 7765 6967 6874 203d 204e 6f6e 650a 0a20  weight = None.. 
-000140c0: 2020 2069 6620 636c 6620 3d3d 2027 7266     if clf == 'rf
-000140d0: 273a 0a20 2020 2020 2020 2074 7279 3a0a  ':.        try:.
-000140e0: 2020 2020 2020 2020 2020 2020 6f62 6a65              obje
-000140f0: 6374 6976 6520 3d20 6f62 6a65 6374 6976  ctive = objectiv
-00014100: 655f 7266 2864 6174 615f 782c 2064 6174  e_rf(data_x, dat
-00014110: 615f 792c 206f 7074 5f63 763d 6f70 745f  a_y, opt_cv=opt_
-00014120: 6376 290a 2020 2020 2020 2020 2020 2020  cv).            
-00014130: 7374 7564 792e 6f70 7469 6d69 7a65 286f  study.optimize(o
-00014140: 626a 6563 7469 7665 2c20 6e5f 7472 6961  bjective, n_tria
-00014150: 6c73 3d6e 5f69 7465 722c 2073 686f 775f  ls=n_iter, show_
-00014160: 7072 6f67 7265 7373 5f62 6172 3d54 7275  progress_bar=Tru
-00014170: 6529 232c 2067 635f 6166 7465 725f 7472  e)#, gc_after_tr
-00014180: 6961 6c3d 5472 7565 290a 2020 2020 2020  ial=True).      
-00014190: 2020 2020 2020 7061 7261 6d73 203d 2073        params = s
-000141a0: 7475 6479 2e62 6573 745f 7472 6961 6c2e  tudy.best_trial.
-000141b0: 7061 7261 6d73 0a20 2020 2020 2020 2020  params.         
-000141c0: 2020 206d 6f64 656c 203d 2052 616e 646f     model = Rando
-000141d0: 6d46 6f72 6573 7443 6c61 7373 6966 6965  mForestClassifie
-000141e0: 7228 6e5f 6573 7469 6d61 746f 7273 3d70  r(n_estimators=p
-000141f0: 6172 616d 735b 276e 5f65 7374 696d 6174  arams['n_estimat
-00014200: 6f72 7327 5d2c 2063 7269 7465 7269 6f6e  ors'], criterion
-00014210: 3d70 6172 616d 735b 2763 7269 7465 7269  =params['criteri
-00014220: 6f6e 275d 2c20 0a20 2020 2020 2020 2020  on'], .         
-00014230: 2020 2020 2020 206d 6178 5f64 6570 7468         max_depth
-00014240: 3d70 6172 616d 735b 276d 6178 5f64 6570  =params['max_dep
-00014250: 7468 275d 2c20 6d69 6e5f 7361 6d70 6c65  th'], min_sample
-00014260: 735f 7370 6c69 743d 7061 7261 6d73 5b27  s_split=params['
-00014270: 6d69 6e5f 7361 6d70 6c65 735f 7370 6c69  min_samples_spli
-00014280: 7427 5d2c 200a 2020 2020 2020 2020 2020  t'], .          
-00014290: 2020 2020 2020 6d69 6e5f 7361 6d70 6c65        min_sample
-000142a0: 735f 6c65 6166 3d70 6172 616d 735b 276d  s_leaf=params['m
-000142b0: 696e 5f73 616d 706c 6573 5f6c 6561 6627  in_samples_leaf'
-000142c0: 5d2c 206d 6178 5f66 6561 7475 7265 733d  ], max_features=
-000142d0: 7061 7261 6d73 5b27 6d61 785f 6665 6174  params['max_feat
-000142e0: 7572 6573 275d 2c20 0a20 2020 2020 2020  ures'], .       
-000142f0: 2020 2020 2020 2020 2062 6f6f 7473 7472           bootstr
-00014300: 6170 3d70 6172 616d 735b 2762 6f6f 7473  ap=params['boots
-00014310: 7472 6170 275d 2c20 636c 6173 735f 7765  trap'], class_we
-00014320: 6967 6874 3d73 616d 706c 655f 7765 6967  ight=sample_weig
-00014330: 6874 2c20 7261 6e64 6f6d 5f73 7461 7465  ht, random_state
-00014340: 3d31 3930 3929 0a20 2020 2020 2020 2065  =1909).        e
-00014350: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
-00014360: 2020 2070 7269 6e74 2827 4661 696c 6564     print('Failed
-00014370: 2074 6f20 6f70 7469 6d69 7a65 2077 6974   to optimize wit
-00014380: 6820 4f70 7475 6e61 2c20 7377 6974 6368  h Optuna, switch
-00014390: 696e 6720 6f76 6572 2074 6f20 4261 7965  ing over to Baye
-000143a0: 7353 6561 7263 6843 562e 2e2e 2729 0a20  sSearchCV...'). 
-000143b0: 2020 2020 2020 2020 2020 2070 6172 616d             param
-000143c0: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-000143d0: 2020 2020 2020 2763 7269 7465 7269 6f6e        'criterion
-000143e0: 273a 205b 2267 696e 6922 2c20 2265 6e74  ': ["gini", "ent
-000143f0: 726f 7079 225d 2c0a 2020 2020 2020 2020  ropy"],.        
-00014400: 2020 2020 2020 2020 276e 5f65 7374 696d          'n_estim
-00014410: 6174 6f72 7327 3a20 5b69 6e74 2878 2920  ators': [int(x) 
-00014420: 666f 7220 7820 696e 206e 702e 6c69 6e73  for x in np.lins
-00014430: 7061 6365 2835 302c 3130 3030 2c20 6e75  pace(50,1000, nu
-00014440: 6d3d 3230 295d 2c20 0a20 2020 2020 2020  m=20)], .       
-00014450: 2020 2020 2020 2020 2027 6d61 785f 6665           'max_fe
-00014460: 6174 7572 6573 273a 205b 6461 7461 5f78  atures': [data_x
-00014470: 2e73 6861 7065 5b31 5d2c 2022 7371 7274  .shape[1], "sqrt
-00014480: 222c 2022 6c6f 6732 225d 2c0a 2020 2020  ", "log2"],.    
-00014490: 2020 2020 2020 2020 2020 2020 276d 6178              'max
-000144a0: 5f64 6570 7468 273a 205b 696e 7428 7829  _depth': [int(x)
-000144b0: 2066 6f72 2078 2069 6e20 6e70 2e6c 696e   for x in np.lin
-000144c0: 7370 6163 6528 352c 3530 2c6e 756d 3d35  space(5,50,num=5
-000144d0: 295d 2c0a 2020 2020 2020 2020 2020 2020  )],.            
-000144e0: 2020 2020 276d 696e 5f73 616d 706c 6573      'min_samples
-000144f0: 5f73 706c 6974 273a 205b 332c 342c 362c  _split': [3,4,6,
-00014500: 372c 382c 392c 3130 5d2c 0a20 2020 2020  7,8,9,10],.     
-00014510: 2020 2020 2020 2020 2020 2027 6d69 6e5f             'min_
-00014520: 7361 6d70 6c65 735f 6c65 6166 273a 205b  samples_leaf': [
-00014530: 312c 332c 352c 372c 392c 3130 5d2c 0a20  1,3,5,7,9,10],. 
-00014540: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00014550: 6d61 785f 6c65 6166 5f6e 6f64 6573 273a  max_leaf_nodes':
-00014560: 205b 696e 7428 7829 2066 6f72 2078 2069   [int(x) for x i
-00014570: 6e20 6e70 2e6c 696e 7370 6163 6528 322c  n np.linspace(2,
-00014580: 3230 3029 5d2c 0a20 2020 2020 2020 2020  200)],.         
-00014590: 2020 2020 2020 2027 626f 6f74 7374 7261         'bootstra
-000145a0: 7027 3a20 5b54 7275 652c 4661 6c73 655d  p': [True,False]
-000145b0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-000145c0: 7d0a 2020 2020 2020 2020 2020 2020 6773  }.            gs
-000145d0: 203d 2042 6179 6573 5365 6172 6368 4356   = BayesSearchCV
-000145e0: 286e 5f69 7465 723d 6e5f 6974 6572 2c20  (n_iter=n_iter, 
-000145f0: 6573 7469 6d61 746f 723d 6d6f 6465 6c5f  estimator=model_
-00014600: 302c 2073 6561 7263 685f 7370 6163 6573  0, search_spaces
-00014610: 3d70 6172 616d 732c 200a 2020 2020 2020  =params, .      
-00014620: 2020 2020 2020 2020 2020 6f70 7469 6d69            optimi
-00014630: 7a65 725f 6b77 6172 6773 3d7b 2762 6173  zer_kwargs={'bas
-00014640: 655f 6573 7469 6d61 746f 7227 3a20 2752  e_estimator': 'R
-00014650: 4627 7d2c 2063 763d 6f70 745f 6376 290a  F'}, cv=opt_cv).
-00014660: 2020 2020 2020 2020 2020 2020 6773 2e66              gs.f
-00014670: 6974 2864 6174 615f 782c 2064 6174 615f  it(data_x, data_
-00014680: 7929 0a20 2020 2020 2020 2020 2020 2062  y).            b
-00014690: 6573 745f 6573 742c 2062 6573 745f 7363  est_est, best_sc
-000146a0: 6f72 6520 3d20 6773 2e62 6573 745f 6573  ore = gs.best_es
-000146b0: 7469 6d61 746f 725f 2c20 6e70 2e72 6f75  timator_, np.rou
-000146c0: 6e64 2867 732e 6265 7374 5f73 636f 7265  nd(gs.best_score
-000146d0: 5f2c 2034 290a 2020 2020 2020 2020 2020  _, 4).          
-000146e0: 2020 7072 696e 7428 2748 6967 6865 7374    print('Highest
-000146f0: 206d 6561 6e20 6163 6375 7261 6379 3a20   mean accuracy: 
-00014700: 7b7d 272e 666f 726d 6174 2862 6573 745f  {}'.format(best_
-00014710: 7363 6f72 6529 290a 2020 2020 2020 2020  score)).        
-00014720: 2020 2020 7265 7475 726e 2067 732e 6265      return gs.be
-00014730: 7374 5f65 7374 696d 6174 6f72 5f2c 2067  st_estimator_, g
-00014740: 732e 6265 7374 5f70 6172 616d 735f 0a0a  s.best_params_..
-00014750: 2020 2020 656c 6966 2063 6c66 203d 3d20      elif clf == 
-00014760: 276e 6e27 3a0a 2020 2020 2020 2020 7472  'nn':.        tr
-00014770: 793a 0a20 2020 2020 2020 2020 2020 206f  y:.            o
-00014780: 626a 6563 7469 7665 203d 206f 626a 6563  bjective = objec
-00014790: 7469 7665 5f6e 6e28 6461 7461 5f78 2c20  tive_nn(data_x, 
-000147a0: 6461 7461 5f79 2c20 6f70 745f 6376 3d6f  data_y, opt_cv=o
-000147b0: 7074 5f63 7629 0a20 2020 2020 2020 2020  pt_cv).         
-000147c0: 2020 2073 7475 6479 2e6f 7074 696d 697a     study.optimiz
-000147d0: 6528 6f62 6a65 6374 6976 652c 206e 5f74  e(objective, n_t
-000147e0: 7269 616c 733d 6e5f 6974 6572 2c20 7368  rials=n_iter, sh
-000147f0: 6f77 5f70 726f 6772 6573 735f 6261 723d  ow_progress_bar=
-00014800: 5472 7565 2923 2c20 6763 5f61 6674 6572  True)#, gc_after
-00014810: 5f74 7269 616c 3d54 7275 6529 0a20 2020  _trial=True).   
-00014820: 2020 2020 2020 2020 2070 6172 616d 7320           params 
-00014830: 3d20 7374 7564 792e 6265 7374 5f74 7269  = study.best_tri
-00014840: 616c 2e70 6172 616d 730a 2020 2020 2020  al.params.      
-00014850: 2020 2020 2020 6c61 7965 7273 203d 205b        layers = [
-00014860: 7061 7261 6d20 666f 7220 7061 7261 6d20  param for param 
-00014870: 696e 2070 6172 616d 7320 6966 2027 6e5f  in params if 'n_
-00014880: 756e 6974 735f 2720 696e 2070 6172 616d  units_' in param
-00014890: 5d0a 2020 2020 2020 2020 2020 2020 6c61  ].            la
-000148a0: 7965 7273 203d 2074 7570 6c65 2870 6172  yers = tuple(par
-000148b0: 616d 735b 6c61 7965 725d 2066 6f72 206c  ams[layer] for l
-000148c0: 6179 6572 2069 6e20 6c61 7965 7273 290a  ayer in layers).
-000148d0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-000148e0: 6c20 3d20 4d4c 5043 6c61 7373 6966 6965  l = MLPClassifie
-000148f0: 7228 6869 6464 656e 5f6c 6179 6572 5f73  r(hidden_layer_s
-00014900: 697a 6573 3d74 7570 6c65 286c 6179 6572  izes=tuple(layer
-00014910: 7329 2c20 6c65 6172 6e69 6e67 5f72 6174  s), learning_rat
-00014920: 655f 696e 6974 3d70 6172 616d 735b 276c  e_init=params['l
-00014930: 6561 726e 696e 675f 7261 7465 5f69 6e69  earning_rate_ini
-00014940: 7427 5d2c 200a 2020 2020 2020 2020 2020  t'], .          
-00014950: 2020 2020 2020 6163 7469 7661 7469 6f6e        activation
-00014960: 3d70 6172 616d 735b 2761 6374 6976 6174  =params['activat
-00014970: 696f 6e27 5d2c 206c 6561 726e 696e 675f  ion'], learning_
-00014980: 7261 7465 3d70 6172 616d 735b 276c 6561  rate=params['lea
-00014990: 726e 696e 675f 7261 7465 275d 2c20 616c  rning_rate'], al
-000149a0: 7068 613d 7061 7261 6d73 5b27 616c 7068  pha=params['alph
-000149b0: 6127 5d2c 200a 2020 2020 2020 2020 2020  a'], .          
-000149c0: 2020 2020 2020 6261 7463 685f 7369 7a65        batch_size
-000149d0: 3d70 6172 616d 735b 2762 6174 6368 5f73  =params['batch_s
-000149e0: 697a 6527 5d2c 2073 6f6c 7665 723d 7061  ize'], solver=pa
-000149f0: 7261 6d73 5b27 736f 6c76 6572 275d 2c20  rams['solver'], 
-00014a00: 6d61 785f 6974 6572 3d32 3530 302c 2072  max_iter=2500, r
-00014a10: 616e 646f 6d5f 7374 6174 653d 3139 3039  andom_state=1909
-00014a20: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-00014a30: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00014a40: 696e 7428 2746 6169 6c65 6420 746f 206f  int('Failed to o
-00014a50: 7074 696d 697a 6520 7769 7468 204f 7074  ptimize with Opt
-00014a60: 756e 612c 2073 7769 7463 6869 6e67 206f  una, switching o
-00014a70: 7665 7220 746f 2042 6179 6573 5365 6172  ver to BayesSear
-00014a80: 6368 4356 2e2e 2e27 290a 2020 2020 2020  chCV...').      
-00014a90: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
-00014aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014ab0: 2027 6869 6464 656e 5f6c 6179 6572 5f73   'hidden_layer_s
-00014ac0: 697a 6573 273a 205b 2831 3030 2c29 2c28  izes': [(100,),(
-00014ad0: 3530 2c31 3030 2c35 3029 2c28 3735 2c35  50,100,50),(75,5
-00014ae0: 302c 3230 292c 2831 3530 2c31 3030 2c35  0,20),(150,100,5
-00014af0: 3029 2c28 3132 302c 3830 2c34 3029 2c28  0),(120,80,40),(
-00014b00: 3130 302c 3530 2c33 3029 5d2c 0a20 2020  100,50,30)],.   
-00014b10: 2020 2020 2020 2020 2020 2020 2027 6c65               'le
-00014b20: 6172 6e69 6e67 5f72 6174 6527 3a20 5b27  arning_rate': ['
-00014b30: 636f 6e73 7461 6e74 272c 2027 696e 7673  constant', 'invs
-00014b40: 6361 6c69 6e67 272c 2027 6164 6170 7469  caling', 'adapti
-00014b50: 7665 275d 2c0a 2020 2020 2020 2020 2020  ve'],.          
-00014b60: 2020 2020 2020 2761 6c70 6861 273a 205b        'alpha': [
-00014b70: 302e 3030 3030 312c 2030 2e35 5d2c 200a  0.00001, 0.5], .
-00014b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b90: 2761 6374 6976 6174 696f 6e27 3a20 5b27  'activation': ['
-00014ba0: 7461 6e68 272c 2027 6c6f 6769 7374 6963  tanh', 'logistic
-00014bb0: 272c 2027 7265 6c75 275d 2c0a 2020 2020  ', 'relu'],.    
-00014bc0: 2020 2020 2020 2020 2020 2020 2773 6f6c              'sol
-00014bd0: 7665 7227 3a20 5b27 7367 6427 2c20 2761  ver': ['sgd', 'a
-00014be0: 6461 6d27 5d2c 0a20 2020 2020 2020 2020  dam'],.         
-00014bf0: 2020 2020 2020 2027 6d61 785f 6974 6572         'max_iter
-00014c00: 273a 205b 3130 302c 2031 3530 2c20 3230  ': [100, 150, 20
-00014c10: 305d 200a 2020 2020 2020 2020 2020 2020  0] .            
-00014c20: 7d0a 2020 2020 2020 2020 2020 2020 6773  }.            gs
-00014c30: 203d 2042 6179 6573 5365 6172 6368 4356   = BayesSearchCV
-00014c40: 286e 5f69 7465 723d 6e5f 6974 6572 2c20  (n_iter=n_iter, 
-00014c50: 6573 7469 6d61 746f 723d 6d6f 6465 6c5f  estimator=model_
-00014c60: 302c 2073 6561 7263 685f 7370 6163 6573  0, search_spaces
-00014c70: 3d70 6172 616d 732c 2063 763d 6f70 745f  =params, cv=opt_
-00014c80: 6376 290a 2020 2020 2020 2020 2020 2020  cv).            
-00014c90: 6773 2e66 6974 2864 6174 615f 782c 2064  gs.fit(data_x, d
-00014ca0: 6174 615f 7929 0a20 2020 2020 2020 2020  ata_y).         
-00014cb0: 2020 2062 6573 745f 6573 742c 2062 6573     best_est, bes
-00014cc0: 745f 7363 6f72 6520 3d20 6773 2e62 6573  t_score = gs.bes
-00014cd0: 745f 6573 7469 6d61 746f 725f 2c20 6e70  t_estimator_, np
-00014ce0: 2e72 6f75 6e64 2867 732e 6265 7374 5f73  .round(gs.best_s
-00014cf0: 636f 7265 5f2c 2034 290a 2020 2020 2020  core_, 4).      
-00014d00: 2020 2020 2020 7072 696e 7428 2748 6967        print('Hig
-00014d10: 6865 7374 206d 6561 6e20 6163 6375 7261  hest mean accura
-00014d20: 6379 3a20 7b7d 272e 666f 726d 6174 2862  cy: {}'.format(b
-00014d30: 6573 745f 7363 6f72 6529 290a 2020 2020  est_score)).    
-00014d40: 2020 2020 2020 2020 7265 7475 726e 2067          return g
-00014d50: 732e 6265 7374 5f65 7374 696d 6174 6f72  s.best_estimator
-00014d60: 5f2c 2067 732e 6265 7374 5f70 6172 616d  _, gs.best_param
-00014d70: 735f 0a20 2020 2020 2020 2020 200a 2020  s_.          .  
-00014d80: 2020 656c 6966 2063 6c66 203d 3d20 2778    elif clf == 'x
-00014d90: 6762 273a 0a20 2020 2020 2020 206f 626a  gb':.        obj
-00014da0: 6563 7469 7665 203d 206f 626a 6563 7469  ective = objecti
-00014db0: 7665 5f78 6762 2864 6174 615f 782c 2064  ve_xgb(data_x, d
-00014dc0: 6174 615f 792c 206c 696d 6974 5f73 6561  ata_y, limit_sea
-00014dd0: 7263 683d 6c69 6d69 745f 7365 6172 6368  rch=limit_search
-00014de0: 2c20 6f70 745f 6376 3d6f 7074 5f63 762c  , opt_cv=opt_cv,
-00014df0: 2074 6573 745f 7369 7a65 3d74 6573 745f   test_size=test_
-00014e00: 7369 7a65 290a 2020 2020 2020 2020 6966  size).        if
-00014e10: 206c 696d 6974 5f73 6561 7263 683a 0a20   limit_search:. 
-00014e20: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00014e30: 2827 4e4f 5445 3a20 546f 2065 7870 616e  ('NOTE: To expan
-00014e40: 6420 6879 7065 7270 6172 616d 6574 6572  d hyperparameter
-00014e50: 2073 6561 7263 6820 7370 6163 652c 2073   search space, s
-00014e60: 6574 206c 696d 6974 5f73 6561 7263 683d  et limit_search=
-00014e70: 4661 6c73 652c 2061 6c74 686f 7567 6820  False, although 
-00014e80: 7468 6973 2077 696c 6c20 696e 6372 6561  this will increa
-00014e90: 7365 2074 6865 206f 7074 696d 697a 6174  se the optimizat
-00014ea0: 696f 6e20 7469 6d65 2073 6967 6e69 6669  ion time signifi
-00014eb0: 6361 6e74 6c79 2e27 290a 2020 2020 2020  cantly.').      
-00014ec0: 2020 7374 7564 792e 6f70 7469 6d69 7a65    study.optimize
-00014ed0: 286f 626a 6563 7469 7665 2c20 6e5f 7472  (objective, n_tr
-00014ee0: 6961 6c73 3d6e 5f69 7465 722c 2073 686f  ials=n_iter, sho
-00014ef0: 775f 7072 6f67 7265 7373 5f62 6172 3d54  w_progress_bar=T
-00014f00: 7275 6529 232c 2067 635f 6166 7465 725f  rue)#, gc_after_
-00014f10: 7472 6961 6c3d 5472 7565 290a 2020 2020  trial=True).    
-00014f20: 2020 2020 7061 7261 6d73 203d 2073 7475      params = stu
-00014f30: 6479 2e62 6573 745f 7472 6961 6c2e 7061  dy.best_trial.pa
-00014f40: 7261 6d73 0a20 2020 2020 2020 2069 6620  rams.        if 
-00014f50: 6c69 6d69 745f 7365 6172 6368 3a0a 2020  limit_search:.  
-00014f60: 2020 2020 2020 2020 2020 6966 2070 6172            if par
-00014f70: 616d 735b 2762 6f6f 7374 6572 275d 203d  ams['booster'] =
-00014f80: 3d20 2764 6172 7427 3a0a 2020 2020 2020  = 'dart':.      
-00014f90: 2020 2020 2020 2020 2020 6d6f 6465 6c20            model 
-00014fa0: 3d20 5847 4243 6c61 7373 6966 6965 7228  = XGBClassifier(
-00014fb0: 626f 6f73 7465 723d 7061 7261 6d73 5b27  booster=params['
-00014fc0: 626f 6f73 7465 7227 5d2c 2020 6e5f 6573  booster'],  n_es
-00014fd0: 7469 6d61 746f 7273 3d70 6172 616d 735b  timators=params[
-00014fe0: 276e 5f65 7374 696d 6174 6f72 7327 5d2c  'n_estimators'],
-00014ff0: 2072 6567 5f6c 616d 6264 613d 7061 7261   reg_lambda=para
-00015000: 6d73 5b27 7265 675f 6c61 6d62 6461 275d  ms['reg_lambda']
-00015010: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-00015020: 2020 2020 2020 2072 6567 5f61 6c70 6861         reg_alpha
-00015030: 3d70 6172 616d 735b 2772 6567 5f61 6c70  =params['reg_alp
-00015040: 6861 275d 2c20 6d61 785f 6465 7074 683d  ha'], max_depth=
-00015050: 7061 7261 6d73 5b27 6d61 785f 6465 7074  params['max_dept
-00015060: 6827 5d2c 2065 7461 3d70 6172 616d 735b  h'], eta=params[
-00015070: 2765 7461 275d 2c20 6761 6d6d 613d 7061  'eta'], gamma=pa
-00015080: 7261 6d73 5b27 6761 6d6d 6127 5d2c 200a  rams['gamma'], .
-00015090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150a0: 2020 2020 6772 6f77 5f70 6f6c 6963 793d      grow_policy=
-000150b0: 7061 7261 6d73 5b27 6772 6f77 5f70 6f6c  params['grow_pol
-000150c0: 6963 7927 5d2c 2073 616d 706c 655f 7479  icy'], sample_ty
-000150d0: 7065 3d70 6172 616d 735b 2773 616d 706c  pe=params['sampl
-000150e0: 655f 7479 7065 275d 2c20 6e6f 726d 616c  e_type'], normal
-000150f0: 697a 655f 7479 7065 3d70 6172 616d 735b  ize_type=params[
-00015100: 276e 6f72 6d61 6c69 7a65 5f74 7970 6527  'normalize_type'
-00015110: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00015120: 2020 2020 2020 2072 6174 655f 6472 6f70         rate_drop
-00015130: 3d70 6172 616d 735b 2772 6174 655f 6472  =params['rate_dr
-00015140: 6f70 275d 2c20 736b 6970 5f64 726f 703d  op'], skip_drop=
-00015150: 7061 7261 6d73 5b27 736b 6970 5f64 726f  params['skip_dro
-00015160: 7027 5d2c 2073 6361 6c65 5f70 6f73 5f77  p'], scale_pos_w
-00015170: 6569 6768 743d 7361 6d70 6c65 5f77 6569  eight=sample_wei
-00015180: 6768 742c 2072 616e 646f 6d5f 7374 6174  ght, random_stat
-00015190: 653d 3139 3039 290a 2020 2020 2020 2020  e=1909).        
-000151a0: 2020 2020 656c 6966 2070 6172 616d 735b      elif params[
-000151b0: 2762 6f6f 7374 6572 275d 203d 3d20 2767  'booster'] == 'g
-000151c0: 6274 7265 6527 3a0a 2020 2020 2020 2020  btree':.        
-000151d0: 2020 2020 2020 2020 6d6f 6465 6c20 3d20          model = 
-000151e0: 5847 4243 6c61 7373 6966 6965 7228 626f  XGBClassifier(bo
-000151f0: 6f73 7465 723d 7061 7261 6d73 5b27 626f  oster=params['bo
-00015200: 6f73 7465 7227 5d2c 2020 6e5f 6573 7469  oster'],  n_esti
-00015210: 6d61 746f 7273 3d70 6172 616d 735b 276e  mators=params['n
-00015220: 5f65 7374 696d 6174 6f72 7327 5d2c 2072  _estimators'], r
-00015230: 6567 5f6c 616d 6264 613d 7061 7261 6d73  eg_lambda=params
-00015240: 5b27 7265 675f 6c61 6d62 6461 275d 2c20  ['reg_lambda'], 
-00015250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015260: 2020 2020 2072 6567 5f61 6c70 6861 3d70       reg_alpha=p
-00015270: 6172 616d 735b 2772 6567 5f61 6c70 6861  arams['reg_alpha
-00015280: 275d 2c20 6d61 785f 6465 7074 683d 7061  '], max_depth=pa
-00015290: 7261 6d73 5b27 6d61 785f 6465 7074 6827  rams['max_depth'
-000152a0: 5d2c 2065 7461 3d70 6172 616d 735b 2765  ], eta=params['e
-000152b0: 7461 275d 2c20 6761 6d6d 613d 7061 7261  ta'], gamma=para
-000152c0: 6d73 5b27 6761 6d6d 6127 5d2c 200a 2020  ms['gamma'], .  
+00010b80: 2020 636f 6e76 5f69 6e69 743d 636f 6e76    conv_init=conv
+00010b90: 5f69 6e69 742c 2064 656e 7365 5f69 6e69  _init, dense_ini
+00010ba0: 743d 6465 6e73 655f 696e 6974 2c20 6d6f  t=dense_init, mo
+00010bb0: 6465 6c5f 7265 673d 6d6f 6465 6c5f 7265  del_reg=model_re
+00010bc0: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
+00010bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010be0: 2020 2070 6f6f 6c69 6e67 5f31 3d70 6f6f     pooling_1=poo
+00010bf0: 6c69 6e67 5f31 2c20 706f 6f6c 696e 675f  ling_1, pooling_
+00010c00: 323d 706f 6f6c 696e 675f 322c 2070 6f6f  2=pooling_2, poo
+00010c10: 6c69 6e67 5f33 3d70 6f6f 6c69 6e67 5f33  ling_3=pooling_3
+00010c20: 2c20 706f 6f6c 696e 675f 343d 706f 6f6c  , pooling_4=pool
+00010c30: 696e 675f 342c 2070 6f6f 6c69 6e67 5f35  ing_4, pooling_5
+00010c40: 3d70 6f6f 6c69 6e67 5f35 2c0a 2020 2020  =pooling_5,.    
+00010c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c60: 2020 2020 2020 2020 2020 2020 736d 6f74              smot
+00010c70: 655f 7361 6d70 6c69 6e67 3d73 656c 662e  e_sampling=self.
+00010c80: 736d 6f74 655f 7361 6d70 6c69 6e67 2c20  smote_sampling, 
+00010c90: 6561 726c 795f 7374 6f70 5f63 616c 6c62  early_stop_callb
+00010ca0: 6163 6b3d 6361 6c6c 6261 636b 732c 2063  ack=callbacks, c
+00010cb0: 6865 636b 706f 696e 743d 4661 6c73 652c  heckpoint=False,
+00010cc0: 2076 6572 626f 7365 3d73 656c 662e 7665   verbose=self.ve
+00010cd0: 7262 6f73 6529 0a20 2020 2020 2020 2020  rbose).         
+00010ce0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00010cf0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00010d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d10: 206d 6f64 656c 2c20 6869 7374 6f72 7920   model, history 
+00010d20: 3d20 636e 6e5f 6d6f 6465 6c2e 5647 4731  = cnn_model.VGG1
+00010d30: 3628 636c 6173 735f 312c 2063 6c61 7373  6(class_1, class
+00010d40: 5f32 2c20 696d 675f 6e75 6d5f 6368 616e  _2, img_num_chan
+00010d50: 6e65 6c73 3d73 656c 662e 696d 675f 6e75  nels=self.img_nu
+00010d60: 6d5f 6368 616e 6e65 6c73 2c20 0a20 2020  m_channels, .   
+00010d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d80: 2020 2020 2020 2020 2020 2020 206e 6f72               nor
+00010d90: 6d61 6c69 7a65 3d73 656c 662e 6e6f 726d  malize=self.norm
+00010da0: 616c 697a 652c 206d 696e 5f70 6978 656c  alize, min_pixel
+00010db0: 3d6d 696e 5f70 6978 2c20 6d61 785f 7069  =min_pix, max_pi
+00010dc0: 7865 6c3d 6d61 785f 7069 782c 2076 616c  xel=max_pix, val
+00010dd0: 5f70 6f73 6974 6976 653d 7661 6c5f 636c  _positive=val_cl
+00010de0: 6173 735f 312c 2076 616c 5f6e 6567 6174  ass_1, val_negat
+00010df0: 6976 653d 7661 6c5f 636c 6173 735f 322c  ive=val_class_2,
+00010e00: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00010e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e20: 2020 6570 6f63 6873 3d73 656c 662e 7472    epochs=self.tr
+00010e30: 6169 6e5f 6570 6f63 6873 2c20 6261 7463  ain_epochs, batc
+00010e40: 685f 7369 7a65 3d62 6174 6368 5f73 697a  h_size=batch_siz
+00010e50: 652c 206f 7074 696d 697a 6572 3d6f 7074  e, optimizer=opt
+00010e60: 696d 697a 6572 2c20 6c72 3d6c 722c 2064  imizer, lr=lr, d
+00010e70: 6563 6179 3d64 6563 6179 2c20 6d6f 6d65  ecay=decay, mome
+00010e80: 6e74 756d 3d6d 6f6d 656e 7475 6d2c 206e  ntum=momentum, n
+00010e90: 6573 7465 726f 763d 6e65 7374 6572 6f76  esterov=nesterov
+00010ea0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00010eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ec0: 2020 2062 6574 615f 313d 6265 7461 5f31     beta_1=beta_1
+00010ed0: 2c20 6265 7461 5f32 3d62 6574 615f 322c  , beta_2=beta_2,
+00010ee0: 2061 6d73 6772 6164 3d61 6d73 6772 6164   amsgrad=amsgrad
+00010ef0: 2c20 6c6f 7373 3d6c 6f73 732c 2061 6374  , loss=loss, act
+00010f00: 6976 6174 696f 6e5f 636f 6e76 3d61 6374  ivation_conv=act
+00010f10: 6976 6174 696f 6e5f 636f 6e76 2c20 6163  ivation_conv, ac
+00010f20: 7469 7661 7469 6f6e 5f64 656e 7365 3d61  tivation_dense=a
+00010f30: 6374 6976 6174 696f 6e5f 6465 6e73 652c  ctivation_dense,
+00010f40: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00010f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f60: 2020 636f 6e76 5f69 6e69 743d 636f 6e76    conv_init=conv
+00010f70: 5f69 6e69 742c 2064 656e 7365 5f69 6e69  _init, dense_ini
+00010f80: 743d 6465 6e73 655f 696e 6974 2c20 6d6f  t=dense_init, mo
+00010f90: 6465 6c5f 7265 673d 6d6f 6465 6c5f 7265  del_reg=model_re
+00010fa0: 672c 2020 2020 2020 2020 2020 2020 2020  g,              
+00010fb0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00010fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010fd0: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+00010fe0: 313d 6669 6c74 6572 5f31 2c20 6669 6c74  1=filter_1, filt
+00010ff0: 6572 5f73 697a 655f 313d 6669 6c74 6572  er_size_1=filter
+00011000: 5f73 697a 655f 312c 2073 7472 6964 6573  _size_1, strides
+00011010: 5f31 3d73 7472 6964 6573 5f31 2c20 706f  _1=strides_1, po
+00011020: 6f6c 696e 675f 313d 706f 6f6c 696e 675f  oling_1=pooling_
+00011030: 312c 2070 6f6f 6c5f 7369 7a65 5f31 3d70  1, pool_size_1=p
+00011040: 6f6f 6c5f 7369 7a65 5f31 2c20 706f 6f6c  ool_size_1, pool
+00011050: 5f73 7472 6964 655f 313d 706f 6f6c 5f73  _stride_1=pool_s
+00011060: 7472 6964 655f 312c 0a20 2020 2020 2020  tride_1,.       
+00011070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011080: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+00011090: 323d 6669 6c74 6572 5f32 2c20 6669 6c74  2=filter_2, filt
+000110a0: 6572 5f73 697a 655f 323d 6669 6c74 6572  er_size_2=filter
+000110b0: 5f73 697a 655f 322c 2073 7472 6964 6573  _size_2, strides
+000110c0: 5f32 3d73 7472 6964 6573 5f32 2c20 706f  _2=strides_2, po
+000110d0: 6f6c 696e 675f 323d 706f 6f6c 696e 675f  oling_2=pooling_
+000110e0: 322c 2070 6f6f 6c5f 7369 7a65 5f32 3d70  2, pool_size_2=p
+000110f0: 6f6f 6c5f 7369 7a65 5f32 2c20 706f 6f6c  ool_size_2, pool
+00011100: 5f73 7472 6964 655f 323d 706f 6f6c 5f73  _stride_2=pool_s
+00011110: 7472 6964 655f 322c 0a20 2020 2020 2020  tride_2,.       
+00011120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011130: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+00011140: 333d 6669 6c74 6572 5f33 2c20 6669 6c74  3=filter_3, filt
+00011150: 6572 5f73 697a 655f 333d 6669 6c74 6572  er_size_3=filter
+00011160: 5f73 697a 655f 332c 2073 7472 6964 6573  _size_3, strides
+00011170: 5f33 3d73 7472 6964 6573 5f33 2c20 706f  _3=strides_3, po
+00011180: 6f6c 696e 675f 333d 706f 6f6c 696e 675f  oling_3=pooling_
+00011190: 332c 2070 6f6f 6c5f 7369 7a65 5f33 3d70  3, pool_size_3=p
+000111a0: 6f6f 6c5f 7369 7a65 5f33 2c20 706f 6f6c  ool_size_3, pool
+000111b0: 5f73 7472 6964 655f 333d 706f 6f6c 5f73  _stride_3=pool_s
+000111c0: 7472 6964 655f 332c 0a20 2020 2020 2020  tride_3,.       
+000111d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111e0: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+000111f0: 343d 6669 6c74 6572 5f34 2c20 6669 6c74  4=filter_4, filt
+00011200: 6572 5f73 697a 655f 343d 6669 6c74 6572  er_size_4=filter
+00011210: 5f73 697a 655f 342c 2073 7472 6964 6573  _size_4, strides
+00011220: 5f34 3d73 7472 6964 6573 5f34 2c20 706f  _4=strides_4, po
+00011230: 6f6c 696e 675f 343d 706f 6f6c 696e 675f  oling_4=pooling_
+00011240: 342c 2070 6f6f 6c5f 7369 7a65 5f34 3d70  4, pool_size_4=p
+00011250: 6f6f 6c5f 7369 7a65 5f34 2c20 706f 6f6c  ool_size_4, pool
+00011260: 5f73 7472 6964 655f 343d 706f 6f6c 5f73  _stride_4=pool_s
+00011270: 7472 6964 655f 342c 0a20 2020 2020 2020  tride_4,.       
+00011280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011290: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+000112a0: 353d 6669 6c74 6572 5f35 2c20 6669 6c74  5=filter_5, filt
+000112b0: 6572 5f73 697a 655f 353d 6669 6c74 6572  er_size_5=filter
+000112c0: 5f73 697a 655f 352c 2073 7472 6964 6573  _size_5, strides
+000112d0: 5f35 3d73 7472 6964 6573 5f35 2c20 706f  _5=strides_5, po
+000112e0: 6f6c 696e 675f 353d 706f 6f6c 696e 675f  oling_5=pooling_
+000112f0: 352c 2070 6f6f 6c5f 7369 7a65 5f35 3d70  5, pool_size_5=p
+00011300: 6f6f 6c5f 7369 7a65 5f35 2c20 706f 6f6c  ool_size_5, pool
+00011310: 5f73 7472 6964 655f 353d 706f 6f6c 5f73  _stride_5=pool_s
+00011320: 7472 6964 655f 352c 0a20 2020 2020 2020  tride_5,.       
+00011330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011340: 2020 2020 2020 2020 2064 656e 7365 5f6e           dense_n
+00011350: 6575 726f 6e73 5f31 3d64 656e 7365 5f6e  eurons_1=dense_n
+00011360: 6575 726f 6e73 5f31 2c20 6465 6e73 655f  eurons_1, dense_
+00011370: 6e65 7572 6f6e 735f 323d 6465 6e73 655f  neurons_2=dense_
+00011380: 6e65 7572 6f6e 735f 322c 2064 726f 706f  neurons_2, dropo
+00011390: 7574 5f31 3d64 726f 706f 7574 5f31 2c20  ut_1=dropout_1, 
+000113a0: 6472 6f70 6f75 745f 323d 6472 6f70 6f75  dropout_2=dropou
+000113b0: 745f 322c 200a 2020 2020 2020 2020 2020  t_2, .          
+000113c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000113d0: 2020 2020 2020 736d 6f74 655f 7361 6d70        smote_samp
+000113e0: 6c69 6e67 3d73 656c 662e 736d 6f74 655f  ling=self.smote_
+000113f0: 7361 6d70 6c69 6e67 2c20 6561 726c 795f  sampling, early_
+00011400: 7374 6f70 5f63 616c 6c62 6163 6b3d 6361  stop_callback=ca
+00011410: 6c6c 6261 636b 732c 2063 6865 636b 706f  llbacks, checkpo
+00011420: 696e 743d 4661 6c73 652c 2076 6572 626f  int=False, verbo
+00011430: 7365 3d73 656c 662e 7665 7262 6f73 6529  se=self.verbose)
+00011440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011450: 2020 2020 2065 6c69 6620 7365 6c66 2e63       elif self.c
+00011460: 6c66 203d 3d20 2772 6573 6e65 7431 3827  lf == 'resnet18'
+00011470: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011480: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00011490: 662e 6c69 6d69 745f 7365 6172 6368 3a0a  f.limit_search:.
+000114a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114b0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+000114c0: 6c2c 2068 6973 746f 7279 203d 2063 6e6e  l, history = cnn
+000114d0: 5f6d 6f64 656c 2e52 6573 6e65 7431 3828  _model.Resnet18(
+000114e0: 636c 6173 735f 312c 2063 6c61 7373 5f32  class_1, class_2
+000114f0: 2c20 696d 675f 6e75 6d5f 6368 616e 6e65  , img_num_channe
+00011500: 6c73 3d73 656c 662e 696d 675f 6e75 6d5f  ls=self.img_num_
+00011510: 6368 616e 6e65 6c73 2c20 0a20 2020 2020  channels, .     
+00011520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011530: 2020 2020 2020 2020 2020 206e 6f72 6d61             norma
+00011540: 6c69 7a65 3d73 656c 662e 6e6f 726d 616c  lize=self.normal
+00011550: 697a 652c 206d 696e 5f70 6978 656c 3d6d  ize, min_pixel=m
+00011560: 696e 5f70 6978 2c20 6d61 785f 7069 7865  in_pix, max_pixe
+00011570: 6c3d 6d61 785f 7069 782c 2076 616c 5f70  l=max_pix, val_p
+00011580: 6f73 6974 6976 653d 7661 6c5f 636c 6173  ositive=val_clas
+00011590: 735f 312c 2076 616c 5f6e 6567 6174 6976  s_1, val_negativ
+000115a0: 653d 7661 6c5f 636c 6173 735f 322c 200a  e=val_class_2, .
+000115b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115d0: 6570 6f63 6873 3d73 656c 662e 7472 6169  epochs=self.trai
+000115e0: 6e5f 6570 6f63 6873 2c20 6261 7463 685f  n_epochs, batch_
+000115f0: 7369 7a65 3d62 6174 6368 5f73 697a 652c  size=batch_size,
+00011600: 206f 7074 696d 697a 6572 3d6f 7074 696d   optimizer=optim
+00011610: 697a 6572 2c20 6c72 3d6c 722c 2064 6563  izer, lr=lr, dec
+00011620: 6179 3d64 6563 6179 2c20 6d6f 6d65 6e74  ay=decay, moment
+00011630: 756d 3d6d 6f6d 656e 7475 6d2c 206e 6573  um=momentum, nes
+00011640: 7465 726f 763d 6e65 7374 6572 6f76 2c20  terov=nesterov, 
+00011650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011670: 2062 6574 615f 313d 6265 7461 5f31 2c20   beta_1=beta_1, 
+00011680: 6265 7461 5f32 3d62 6574 615f 322c 2061  beta_2=beta_2, a
+00011690: 6d73 6772 6164 3d61 6d73 6772 6164 2c20  msgrad=amsgrad, 
+000116a0: 6c6f 7373 3d6c 6f73 732c 2061 6374 6976  loss=loss, activ
+000116b0: 6174 696f 6e5f 636f 6e76 3d61 6374 6976  ation_conv=activ
+000116c0: 6174 696f 6e5f 636f 6e76 2c20 6163 7469  ation_conv, acti
+000116d0: 7661 7469 6f6e 5f64 656e 7365 3d61 6374  vation_dense=act
+000116e0: 6976 6174 696f 6e5f 6465 6e73 652c 200a  ivation_dense, .
+000116f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011710: 636f 6e76 5f69 6e69 743d 636f 6e76 5f69  conv_init=conv_i
+00011720: 6e69 742c 2064 656e 7365 5f69 6e69 743d  nit, dense_init=
+00011730: 6465 6e73 655f 696e 6974 2c20 6d6f 6465  dense_init, mode
+00011740: 6c5f 7265 673d 6d6f 6465 6c5f 7265 672c  l_reg=model_reg,
+00011750: 2070 6f6f 6c69 6e67 3d70 6f6f 6c69 6e67   pooling=pooling
+00011760: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00011770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011780: 2020 736d 6f74 655f 7361 6d70 6c69 6e67    smote_sampling
+00011790: 3d73 656c 662e 736d 6f74 655f 7361 6d70  =self.smote_samp
+000117a0: 6c69 6e67 2c20 6561 726c 795f 7374 6f70  ling, early_stop
+000117b0: 5f63 616c 6c62 6163 6b3d 6361 6c6c 6261  _callback=callba
+000117c0: 636b 732c 2063 6865 636b 706f 696e 743d  cks, checkpoint=
+000117d0: 4661 6c73 652c 2076 6572 626f 7365 3d73  False, verbose=s
+000117e0: 656c 662e 7665 7262 6f73 6529 0a20 2020  elf.verbose).   
+000117f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011800: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00011810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011820: 2020 2020 2020 206d 6f64 656c 2c20 6869         model, hi
+00011830: 7374 6f72 7920 3d20 636e 6e5f 6d6f 6465  story = cnn_mode
+00011840: 6c2e 5265 736e 6574 3138 2863 6c61 7373  l.Resnet18(class
+00011850: 5f31 2c20 636c 6173 735f 322c 2069 6d67  _1, class_2, img
+00011860: 5f6e 756d 5f63 6861 6e6e 656c 733d 7365  _num_channels=se
+00011870: 6c66 2e69 6d67 5f6e 756d 5f63 6861 6e6e  lf.img_num_chann
+00011880: 656c 732c 200a 2020 2020 2020 2020 2020  els, .          
+00011890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118a0: 2020 2020 2020 6e6f 726d 616c 697a 653d        normalize=
+000118b0: 7365 6c66 2e6e 6f72 6d61 6c69 7a65 2c20  self.normalize, 
+000118c0: 6d69 6e5f 7069 7865 6c3d 6d69 6e5f 7069  min_pixel=min_pi
+000118d0: 782c 206d 6178 5f70 6978 656c 3d6d 6178  x, max_pixel=max
+000118e0: 5f70 6978 2c20 7661 6c5f 706f 7369 7469  _pix, val_positi
+000118f0: 7665 3d76 616c 5f63 6c61 7373 5f31 2c20  ve=val_class_1, 
+00011900: 7661 6c5f 6e65 6761 7469 7665 3d76 616c  val_negative=val
+00011910: 5f63 6c61 7373 5f32 2c20 0a20 2020 2020  _class_2, .     
+00011920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011930: 2020 2020 2020 2020 2020 2065 706f 6368             epoch
+00011940: 733d 7365 6c66 2e74 7261 696e 5f65 706f  s=self.train_epo
+00011950: 6368 732c 2062 6174 6368 5f73 697a 653d  chs, batch_size=
+00011960: 6261 7463 685f 7369 7a65 2c20 6f70 7469  batch_size, opti
+00011970: 6d69 7a65 723d 6f70 7469 6d69 7a65 722c  mizer=optimizer,
+00011980: 206c 723d 6c72 2c20 6465 6361 793d 6465   lr=lr, decay=de
+00011990: 6361 792c 206d 6f6d 656e 7475 6d3d 6d6f  cay, momentum=mo
+000119a0: 6d65 6e74 756d 2c20 6e65 7374 6572 6f76  mentum, nesterov
+000119b0: 3d6e 6573 7465 726f 762c 200a 2020 2020  =nesterov, .    
+000119c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119d0: 2020 2020 2020 2020 2020 2020 6265 7461              beta
+000119e0: 5f31 3d62 6574 615f 312c 2062 6574 615f  _1=beta_1, beta_
+000119f0: 323d 6265 7461 5f32 2c20 616d 7367 7261  2=beta_2, amsgra
+00011a00: 643d 616d 7367 7261 642c 206c 6f73 733d  d=amsgrad, loss=
+00011a10: 6c6f 7373 2c20 6163 7469 7661 7469 6f6e  loss, activation
+00011a20: 5f63 6f6e 763d 6163 7469 7661 7469 6f6e  _conv=activation
+00011a30: 5f63 6f6e 762c 2061 6374 6976 6174 696f  _conv, activatio
+00011a40: 6e5f 6465 6e73 653d 6163 7469 7661 7469  n_dense=activati
+00011a50: 6f6e 5f64 656e 7365 2c20 0a20 2020 2020  on_dense, .     
+00011a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a70: 2020 2020 2020 2020 2020 2063 6f6e 765f             conv_
+00011a80: 696e 6974 3d63 6f6e 765f 696e 6974 2c20  init=conv_init, 
+00011a90: 6465 6e73 655f 696e 6974 3d64 656e 7365  dense_init=dense
+00011aa0: 5f69 6e69 742c 206d 6f64 656c 5f72 6567  _init, model_reg
+00011ab0: 3d6d 6f64 656c 5f72 6567 2c20 6669 6c74  =model_reg, filt
+00011ac0: 6572 733d 6669 6c74 6572 732c 2066 696c  ers=filters, fil
+00011ad0: 7465 725f 7369 7a65 3d66 696c 7465 725f  ter_size=filter_
+00011ae0: 7369 7a65 2c20 7374 7269 6465 733d 7374  size, strides=st
+00011af0: 7269 6465 732c 2020 0a20 2020 2020 2020  rides,  .       
+00011b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b10: 2020 2020 2020 2020 2070 6f6f 6c69 6e67           pooling
+00011b20: 3d70 6f6f 6c69 6e67 2c20 706f 6f6c 5f73  =pooling, pool_s
+00011b30: 697a 653d 706f 6f6c 5f73 697a 652c 2070  ize=pool_size, p
+00011b40: 6f6f 6c5f 7374 7269 6465 3d70 6f6f 6c5f  ool_stride=pool_
+00011b50: 7374 7269 6465 2c20 626c 6f63 6b5f 6669  stride, block_fi
+00011b60: 6c74 6572 735f 313d 626c 6f63 6b5f 6669  lters_1=block_fi
+00011b70: 6c74 6572 735f 312c 2062 6c6f 636b 5f66  lters_1, block_f
+00011b80: 696c 7465 7273 5f32 3d62 6c6f 636b 5f66  ilters_2=block_f
+00011b90: 696c 7465 7273 5f32 2c20 0a20 2020 2020  ilters_2, .     
+00011ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bb0: 2020 2020 2020 2020 2020 2062 6c6f 636b             block
+00011bc0: 5f66 696c 7465 7273 5f33 3d62 6c6f 636b  _filters_3=block
+00011bd0: 5f66 696c 7465 7273 5f33 2c20 626c 6f63  _filters_3, bloc
+00011be0: 6b5f 6669 6c74 6572 735f 343d 626c 6f63  k_filters_4=bloc
+00011bf0: 6b5f 6669 6c74 6572 735f 342c 2062 6c6f  k_filters_4, blo
+00011c00: 636b 5f66 696c 7465 7273 5f73 697a 653d  ck_filters_size=
+00011c10: 626c 6f63 6b5f 6669 6c74 6572 735f 7369  block_filters_si
+00011c20: 7a65 2c20 0a20 2020 2020 2020 2020 2020  ze, .           
+00011c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c40: 2020 2020 2073 6d6f 7465 5f73 616d 706c       smote_sampl
+00011c50: 696e 673d 7365 6c66 2e73 6d6f 7465 5f73  ing=self.smote_s
+00011c60: 616d 706c 696e 672c 2065 6172 6c79 5f73  ampling, early_s
+00011c70: 746f 705f 6361 6c6c 6261 636b 3d63 616c  top_callback=cal
+00011c80: 6c62 6163 6b73 2c20 6368 6563 6b70 6f69  lbacks, checkpoi
+00011c90: 6e74 3d46 616c 7365 2c20 7665 7262 6f73  nt=False, verbos
+00011ca0: 653d 7365 6c66 2e76 6572 626f 7365 290a  e=self.verbose).
+00011cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011cc0: 2023 4966 2074 6865 2070 6174 6965 6e63   #If the patienc
+00011cd0: 6520 6973 2072 6561 6368 6564 202d 2d20  e is reached -- 
+00011ce0: 7265 7475 726e 2073 686f 756c 6420 6265  return should be
+00011cf0: 2061 2076 616c 7565 2074 6861 7420 636f   a value that co
+00011d00: 6e74 6169 6e73 2069 6e66 6f72 6d61 7469  ntains informati
+00011d10: 6f6e 2072 6567 6172 6469 6e67 2074 6865  on regarding the
+00011d20: 206e 756d 206f 6620 636f 6d70 6c65 7465   num of complete
+00011d30: 6420 6570 6f63 6873 2c20 6f74 6865 7277  d epochs, otherw
+00011d40: 6973 6520 6966 2072 6574 7572 6e20 3020  ise if return 0 
+00011d50: 6576 6572 7920 7469 6d65 2074 6865 6e20  every time then 
+00011d60: 7468 6520 6f70 7469 6d69 7a65 7220 6d61  the optimizer ma
+00011d70: 7920 6765 7420 7374 7563 6b23 0a20 2020  y get stuck#.   
+00011d80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00011d90: 6c65 6e28 6869 7374 6f72 792e 6869 7374  len(history.hist
+00011da0: 6f72 795b 276c 6f73 7327 5d29 2021 3d20  ory['loss']) != 
+00011db0: 7365 6c66 2e74 7261 696e 5f65 706f 6368  self.train_epoch
+00011dc0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00011dd0: 2020 2020 2020 2070 7269 6e74 2829 3b20         print(); 
+00011de0: 7072 696e 7428 2754 6865 2074 7261 696e  print('The train
+00011df0: 696e 6720 7061 7469 656e 6365 2077 6173  ing patience was
+00011e00: 2072 6561 6368 6564 2e2e 2e27 293b 2070   reached...'); p
+00011e10: 7269 6e74 2829 0a20 2020 2020 2020 2020  rint().         
+00011e20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00011e30: 6e20 286c 656e 2868 6973 746f 7279 2e68  n (len(history.h
+00011e40: 6973 746f 7279 5b27 6c6f 7373 275d 2920  istory['loss']) 
+00011e50: 2a20 302e 3030 3129 202d 2039 3939 2e30  * 0.001) - 999.0
+00011e60: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011e70: 2020 2349 6620 7468 6520 7472 6169 6e69    #If the traini
+00011e80: 6e67 2066 6169 6c73 2072 6574 7572 6e20  ng fails return 
+00011e90: 4e61 4e20 7269 6768 7420 6177 6179 230a  NaN right away#.
+00011ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011eb0: 6966 206e 702e 6973 6669 6e69 7465 2868  if np.isfinite(h
+00011ec0: 6973 746f 7279 2e68 6973 746f 7279 5b27  istory.history['
+00011ed0: 6c6f 7373 275d 5b2d 315d 293a 0a20 2020  loss'][-1]):.   
+00011ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ef0: 206d 6f64 656c 732e 6170 7065 6e64 286d   models.append(m
+00011f00: 6f64 656c 292c 2068 6973 746f 7269 6573  odel), histories
+00011f10: 2e61 7070 656e 6428 6869 7374 6f72 7929  .append(history)
+00011f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011f30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00011f40: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00011f50: 2829 3b20 7072 696e 7428 2754 7261 696e  (); print('Train
+00011f60: 696e 6720 6661 696c 6564 2064 7565 2074  ing failed due t
+00011f70: 6f20 6e75 6d65 7269 6361 6c20 696e 7374  o numerical inst
+00011f80: 6162 696c 6974 792c 2072 6574 7572 6e69  ability, returni
+00011f90: 6e67 206e 616e 2e2e 2e27 290a 2020 2020  ng nan...').    
+00011fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fb0: 7265 7475 726e 206e 702e 6e61 6e20 0a0a  return np.nan ..
+00011fc0: 2020 2020 2020 2020 2323 2323 2323 2041          ###### A
+00011fd0: 6464 6974 696f 6e61 6c20 7465 7374 2064  dditional test d
+00011fe0: 6174 6120 6d65 7472 6963 2c20 6f70 7469  ata metric, opti
+00011ff0: 6f6e 616c 2069 6e70 7574 2023 2323 2323  onal input #####
+00012000: 230a 2020 2020 2020 2020 6966 2073 656c  #.        if sel
+00012010: 662e 7465 7374 5f70 6f73 6974 6976 6520  f.test_positive 
+00012020: 6973 206e 6f74 204e 6f6e 6520 6f72 2073  is not None or s
+00012030: 656c 662e 7465 7374 5f6e 6567 6174 6976  elf.test_negativ
+00012040: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+00012050: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00012060: 6c66 2e74 6573 745f 706f 7369 7469 7665  lf.test_positive
+00012070: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00012080: 2073 656c 662e 7465 7374 5f6e 6567 6174   self.test_negat
+00012090: 6976 6520 6973 206e 6f74 204e 6f6e 653a  ive is not None:
+000120a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000120b0: 2070 6f73 6974 6976 655f 7465 7374 5f63   positive_test_c
+000120c0: 726f 702c 206e 6567 6174 6976 655f 7465  rop, negative_te
+000120d0: 7374 5f63 726f 7020 3d20 7265 7369 7a65  st_crop = resize
+000120e0: 2873 656c 662e 7465 7374 5f70 6f73 6974  (self.test_posit
+000120f0: 6976 652c 2073 697a 653d 696d 6167 655f  ive, size=image_
+00012100: 7369 7a65 292c 2072 6573 697a 6528 7365  size), resize(se
+00012110: 6c66 2e74 6573 745f 6e65 6761 7469 7665  lf.test_negative
+00012120: 2c20 7369 7a65 3d69 6d61 6765 5f73 697a  , size=image_siz
+00012130: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00012140: 2020 2058 5f74 6573 742c 2059 5f74 6573     X_test, Y_tes
+00012150: 7420 3d20 6372 6561 7465 5f74 7261 696e  t = create_train
+00012160: 696e 675f 7365 7428 706f 7369 7469 7665  ing_set(positive
+00012170: 5f74 6573 745f 6372 6f70 2c20 6e65 6761  _test_crop, nega
+00012180: 7469 7665 5f74 6573 745f 6372 6f70 2c20  tive_test_crop, 
+00012190: 6e6f 726d 616c 697a 653d 7365 6c66 2e6e  normalize=self.n
+000121a0: 6f72 6d61 6c69 7a65 2c20 6d69 6e5f 7069  ormalize, min_pi
+000121b0: 7865 6c3d 6d69 6e5f 7069 782c 206d 6178  xel=min_pix, max
+000121c0: 5f70 6978 656c 3d6d 6178 5f70 6978 2c20  _pixel=max_pix, 
+000121d0: 696d 675f 6e75 6d5f 6368 616e 6e65 6c73  img_num_channels
+000121e0: 3d73 656c 662e 696d 675f 6e75 6d5f 6368  =self.img_num_ch
+000121f0: 616e 6e65 6c73 290a 2020 2020 2020 2020  annels).        
+00012200: 2020 2020 656c 6966 2073 656c 662e 7465      elif self.te
+00012210: 7374 5f70 6f73 6974 6976 6520 6973 206e  st_positive is n
+00012220: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00012230: 2020 2020 2020 2020 2070 6f73 6974 6976           positiv
+00012240: 655f 7465 7374 5f63 726f 7020 3d20 7265  e_test_crop = re
+00012250: 7369 7a65 2873 656c 662e 7465 7374 5f70  size(self.test_p
+00012260: 6f73 6974 6976 652c 2073 697a 653d 696d  ositive, size=im
+00012270: 6167 655f 7369 7a65 290a 2020 2020 2020  age_size).      
+00012280: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+00012290: 7665 5f63 6c61 7373 5f64 6174 612c 2070  ve_class_data, p
+000122a0: 6f73 6974 6976 655f 636c 6173 735f 6c61  ositive_class_la
+000122b0: 6265 6c20 3d20 6461 7461 5f70 726f 6365  bel = data_proce
+000122c0: 7373 696e 672e 7072 6f63 6573 735f 636c  ssing.process_cl
+000122d0: 6173 7328 706f 7369 7469 7665 5f74 6573  ass(positive_tes
+000122e0: 745f 6372 6f70 2c20 6c61 6265 6c3d 312c  t_crop, label=1,
+000122f0: 206e 6f72 6d61 6c69 7a65 3d73 656c 662e   normalize=self.
+00012300: 6e6f 726d 616c 697a 652c 206d 696e 5f70  normalize, min_p
+00012310: 6978 656c 3d6d 696e 5f70 6978 2c20 6d61  ixel=min_pix, ma
+00012320: 785f 7069 7865 6c3d 6d61 785f 7069 782c  x_pixel=max_pix,
+00012330: 2069 6d67 5f6e 756d 5f63 6861 6e6e 656c   img_num_channel
+00012340: 733d 7365 6c66 2e69 6d67 5f6e 756d 5f63  s=self.img_num_c
+00012350: 6861 6e6e 656c 7329 0a20 2020 2020 2020  hannels).       
+00012360: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00012370: 2e74 6573 745f 6e65 6761 7469 7665 2069  .test_negative i
+00012380: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00012390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123a0: 6e65 6761 7469 7665 5f74 6573 745f 6372  negative_test_cr
+000123b0: 6f70 203d 2072 6573 697a 6528 7365 6c66  op = resize(self
+000123c0: 2e74 6573 745f 6e65 6761 7469 7665 2c20  .test_negative, 
+000123d0: 7369 7a65 3d69 6d61 6765 5f73 697a 6529  size=image_size)
+000123e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000123f0: 2020 2020 206e 6567 6174 6976 655f 636c       negative_cl
+00012400: 6173 735f 6461 7461 2c20 6e65 6761 7469  ass_data, negati
+00012410: 7665 5f63 6c61 7373 5f6c 6162 656c 203d  ve_class_label =
+00012420: 2064 6174 615f 7072 6f63 6573 7369 6e67   data_processing
+00012430: 2e70 726f 6365 7373 5f63 6c61 7373 286e  .process_class(n
+00012440: 6567 6174 6976 655f 7465 7374 5f63 726f  egative_test_cro
+00012450: 702c 206c 6162 656c 3d30 2c20 6e6f 726d  p, label=0, norm
+00012460: 616c 697a 653d 7365 6c66 2e6e 6f72 6d61  alize=self.norma
+00012470: 6c69 7a65 2c20 6d69 6e5f 7069 7865 6c3d  lize, min_pixel=
+00012480: 6d69 6e5f 7069 782c 206d 6178 5f70 6978  min_pix, max_pix
+00012490: 656c 3d6d 6178 5f70 6978 2c20 696d 675f  el=max_pix, img_
+000124a0: 6e75 6d5f 6368 616e 6e65 6c73 3d73 656c  num_channels=sel
+000124b0: 662e 696d 675f 6e75 6d5f 6368 616e 6e65  f.img_num_channe
+000124c0: 6c73 290a 2020 2020 2020 2020 2020 2020  ls).            
+000124d0: 2020 2020 2020 2020 585f 7465 7374 2c20          X_test, 
+000124e0: 595f 7465 7374 203d 206e 702e 725f 5b70  Y_test = np.r_[p
+000124f0: 6f73 6974 6976 655f 636c 6173 735f 6461  ositive_class_da
+00012500: 7461 2c20 6e65 6761 7469 7665 5f63 6c61  ta, negative_cla
+00012510: 7373 5f64 6174 615d 2c20 6e70 2e72 5f5b  ss_data], np.r_[
+00012520: 706f 7369 7469 7665 5f63 6c61 7373 5f6c  positive_class_l
+00012530: 6162 656c 2c20 6e65 6761 7469 7665 5f63  abel, negative_c
+00012540: 6c61 7373 5f6c 6162 656c 5d0a 2020 2020  lass_label].    
+00012550: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00012560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012570: 2020 2020 2020 585f 7465 7374 2c20 595f        X_test, Y_
+00012580: 7465 7374 203d 2070 6f73 6974 6976 655f  test = positive_
+00012590: 636c 6173 735f 6461 7461 2c20 706f 7369  class_data, posi
+000125a0: 7469 7665 5f63 6c61 7373 5f6c 6162 656c  tive_class_label
+000125b0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000125c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000125d0: 2020 2069 6620 7365 6c66 2e74 6573 745f     if self.test_
+000125e0: 6e65 6761 7469 7665 2069 7320 6e6f 7420  negative is not 
+000125f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00012600: 2020 2020 2020 2020 2020 585f 7465 7374            X_test
+00012610: 2c20 595f 7465 7374 203d 2064 6174 615f  , Y_test = data_
+00012620: 7072 6f63 6573 7369 6e67 2e70 726f 6365  processing.proce
+00012630: 7373 5f63 6c61 7373 286e 6567 6174 6976  ss_class(negativ
+00012640: 655f 7465 7374 5f63 726f 702c 206c 6162  e_test_crop, lab
+00012650: 656c 3d30 2c20 6e6f 726d 616c 697a 653d  el=0, normalize=
+00012660: 7365 6c66 2e6e 6f72 6d61 6c69 7a65 2c20  self.normalize, 
+00012670: 6d69 6e5f 7069 7865 6c3d 6d69 6e5f 7069  min_pixel=min_pi
+00012680: 782c 206d 6178 5f70 6978 656c 3d6d 6178  x, max_pixel=max
+00012690: 5f70 6978 2c20 696d 675f 6e75 6d5f 6368  _pix, img_num_ch
+000126a0: 616e 6e65 6c73 3d73 656c 662e 696d 675f  annels=self.img_
+000126b0: 6e75 6d5f 6368 616e 6e65 6c73 290a 2020  num_channels).  
+000126c0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+000126d0: 2020 2020 2020 2020 2323 234c 6f6f 7020          ###Loop 
+000126e0: 7468 726f 7567 6820 616c 6c20 7468 6520  through all the 
+000126f0: 6d6f 6465 6c73 2074 6f20 6361 6c63 756c  models to calcul
+00012700: 6174 6520 7468 6520 7065 7266 6f72 6d61  ate the performa
+00012710: 6e63 6520 6f66 2065 6163 6823 2323 0a20  nce of each###. 
+00012720: 2020 2020 2020 2020 2020 2074 6573 7420             test 
+00012730: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+00012740: 2066 6f72 205f 6d6f 6465 6c5f 2069 6e20   for _model_ in 
+00012750: 6d6f 6465 6c73 3a0a 2020 2020 2020 2020  models:.        
+00012760: 2020 2020 2020 2020 7465 7374 5f6c 6f73          test_los
+00012770: 732c 2074 6573 745f 6163 632c 2074 6573  s, test_acc, tes
+00012780: 745f 6631 5f73 636f 7265 203d 205f 6d6f  t_f1_score = _mo
+00012790: 6465 6c5f 2e65 7661 6c75 6174 6528 585f  del_.evaluate(X_
+000127a0: 7465 7374 2c20 595f 7465 7374 2c20 6261  test, Y_test, ba
+000127b0: 7463 685f 7369 7a65 3d6c 656e 2858 5f74  tch_size=len(X_t
+000127c0: 6573 7429 290a 2020 2020 2020 2020 2020  est)).          
+000127d0: 2020 2020 2020 6966 2027 6c6f 7373 2720        if 'loss' 
+000127e0: 696e 2073 656c 662e 6d65 7472 6963 3a0a  in self.metric:.
+000127f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012800: 2020 2020 7465 7374 5f6d 6574 7269 6320      test_metric 
+00012810: 3d20 3120 2d20 7465 7374 5f6c 6f73 730a  = 1 - test_loss.
+00012820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012830: 656c 6966 2027 6163 6327 2069 6e20 7365  elif 'acc' in se
+00012840: 6c66 2e6d 6574 7269 633a 0a20 2020 2020  lf.metric:.     
+00012850: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00012860: 6573 745f 6d65 7472 6963 203d 2074 6573  est_metric = tes
+00012870: 745f 6163 6320 0a20 2020 2020 2020 2020  t_acc .         
+00012880: 2020 2020 2020 2065 6c69 6620 2766 3127         elif 'f1'
+00012890: 2069 6e20 7365 6c66 2e6d 6574 7269 633a   in self.metric:
+000128a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000128b0: 2020 2020 2074 6573 745f 6d65 7472 6963       test_metric
+000128c0: 203d 2074 6573 745f 6631 5f73 636f 7265   = test_f1_score
+000128d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000128e0: 2065 6c69 6620 2761 6c6c 2720 696e 2073   elif 'all' in s
+000128f0: 656c 662e 6d65 7472 6963 3a0a 2020 2020  elf.metric:.    
+00012900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012910: 7465 7374 5f6d 6574 7269 6320 3d20 6e70  test_metric = np
+00012920: 2e6d 6561 6e28 5b31 202d 2074 6573 745f  .mean([1 - test_
+00012930: 6c6f 7373 2c20 7465 7374 5f61 6363 2c20  loss, test_acc, 
+00012940: 7465 7374 5f66 315f 7363 6f72 655d 290a  test_f1_score]).
+00012950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012960: 7465 7374 2e61 7070 656e 6428 7465 7374  test.append(test
+00012970: 5f6d 6574 7269 6329 0a0a 2020 2020 2020  _metric)..      
+00012980: 2020 2020 2020 7465 7374 5f6d 6574 7269        test_metri
+00012990: 6320 3d20 6e70 2e6d 6561 6e28 7465 7374  c = np.mean(test
+000129a0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000129b0: 2073 656c 662e 7665 7262 6f73 6520 3d3d   self.verbose ==
+000129c0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+000129d0: 2020 2020 7072 696e 7428 293b 2070 7269      print(); pri
+000129e0: 6e74 2827 506f 7374 2d54 7269 616c 204d  nt('Post-Trial M
+000129f0: 6574 7269 633a 2027 2b73 7472 2874 6573  etric: '+str(tes
+00012a00: 745f 6d65 7472 6963 2929 0a20 2020 2020  t_metric)).     
+00012a10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00012a20: 2020 2020 2074 6573 745f 6d65 7472 6963       test_metric
+00012a30: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
+00012a40: 2023 2323 2043 616c 6375 6c61 7465 2074   ### Calculate t
+00012a50: 6865 2066 696e 616c 206f 7074 696d 697a  he final optimiz
+00012a60: 6174 696f 6e20 6d65 7472 6963 2023 2323  ation metric ###
+00012a70: 0a20 2020 2020 2020 206d 6574 7269 6373  .        metrics
+00012a80: 203d 205b 276c 6f73 7327 2c20 2762 696e   = ['loss', 'bin
+00012a90: 6172 795f 6163 6375 7261 6379 272c 2027  ary_accuracy', '
+00012aa0: 6631 5f73 636f 7265 275d 0a20 2020 2020  f1_score'].     
+00012ab0: 2020 2069 6620 7365 6c66 2e6d 6574 7269     if self.metri
+00012ac0: 6320 3d3d 2027 616c 6c27 3a20 2341 7665  c == 'all': #Ave
+00012ad0: 7261 6765 2061 6c6c 2074 6865 2074 7261  rage all the tra
+00012ae0: 696e 696e 6720 6d65 7472 6963 730a 2020  ining metrics.  
+00012af0: 2020 2020 2020 2020 2020 7472 6169 6e69            traini
+00012b00: 6e67 5f6d 6574 7269 6373 5f6d 6561 6e2c  ng_metrics_mean,
+00012b10: 2074 7261 696e 696e 675f 6c6f 7373 5f6d   training_loss_m
+00012b20: 6561 6e20 3d20 5b5d 2c20 5b5d 0a20 2020  ean = [], [].   
+00012b30: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00012b40: 2e61 7665 7261 6765 3a0a 2020 2020 2020  .average:.      
+00012b50: 2020 2020 2020 2020 2020 666f 7220 5f68            for _h
+00012b60: 6973 746f 7279 5f20 696e 2068 6973 746f  istory_ in histo
+00012b70: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
+00012b80: 2020 2020 2020 2020 2020 7472 6169 6e69            traini
+00012b90: 6e67 5f6d 6574 7269 6373 5f6d 6561 6e2e  ng_metrics_mean.
+00012ba0: 6170 7065 6e64 286e 702e 6d65 616e 285b  append(np.mean([
+00012bb0: 6e70 2e6d 6561 6e28 5f68 6973 746f 7279  np.mean(_history
+00012bc0: 5f2e 6869 7374 6f72 795b 6d65 7472 6963  _.history[metric
+00012bd0: 5d29 2066 6f72 206d 6574 7269 6320 696e  ]) for metric in
+00012be0: 206d 6574 7269 6373 2069 6620 276c 6f73   metrics if 'los
+00012bf0: 7327 206e 6f74 2069 6e20 6d65 7472 6963  s' not in metric
+00012c00: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+00012c10: 2020 2020 2020 2020 7472 6169 6e69 6e67          training
+00012c20: 5f6c 6f73 735f 6d65 616e 2e61 7070 656e  _loss_mean.appen
+00012c30: 6428 3120 2d20 6e70 2e6d 6561 6e28 5f68  d(1 - np.mean(_h
+00012c40: 6973 746f 7279 5f2e 6869 7374 6f72 795b  istory_.history[
+00012c50: 276c 6f73 7327 5d29 290a 2020 2020 2020  'loss'])).      
+00012c60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00012c70: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00012c80: 5f68 6973 746f 7279 5f20 696e 2068 6973  _history_ in his
+00012c90: 746f 7269 6573 3a0a 2020 2020 2020 2020  tories:.        
+00012ca0: 2020 2020 2020 2020 2020 2020 7472 6169              trai
+00012cb0: 6e69 6e67 5f6d 6574 7269 6373 5f6d 6561  ning_metrics_mea
+00012cc0: 6e2e 6170 7065 6e64 286e 702e 6d65 616e  n.append(np.mean
+00012cd0: 285b 5f68 6973 746f 7279 5f2e 6869 7374  ([_history_.hist
+00012ce0: 6f72 795b 6d65 7472 6963 5d5b 2d31 5d20  ory[metric][-1] 
+00012cf0: 666f 7220 6d65 7472 6963 2069 6e20 6d65  for metric in me
+00012d00: 7472 6963 7320 6966 2027 6c6f 7373 2720  trics if 'loss' 
+00012d10: 6e6f 7420 696e 206d 6574 7269 635d 2929  not in metric]))
+00012d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012d30: 2020 2020 2074 7261 696e 696e 675f 6c6f       training_lo
+00012d40: 7373 5f6d 6561 6e2e 6170 7065 6e64 2831  ss_mean.append(1
+00012d50: 202d 205f 6869 7374 6f72 795f 2e68 6973   - _history_.his
+00012d60: 746f 7279 5b27 6c6f 7373 275d 5b2d 315d  tory['loss'][-1]
+00012d70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00012d80: 2074 6573 745f 6d65 7472 6963 2069 7320   test_metric is 
+00012d90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00012da0: 2020 2020 2020 6669 6e61 6c5f 7363 6f72        final_scor
+00012db0: 6520 3d20 6e70 2e6d 6561 6e28 5b74 7261  e = np.mean([tra
+00012dc0: 696e 696e 675f 6d65 7472 6963 735f 6d65  ining_metrics_me
+00012dd0: 616e 2c20 7472 6169 6e69 6e67 5f6c 6f73  an, training_los
+00012de0: 735f 6d65 616e 5d29 0a20 2020 2020 2020  s_mean]).       
+00012df0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00012e00: 2020 2020 2020 2020 2020 2066 696e 616c             final
+00012e10: 5f73 636f 7265 203d 206e 702e 6d65 616e  _score = np.mean
+00012e20: 285b 7472 6169 6e69 6e67 5f6d 6574 7269  ([training_metri
+00012e30: 6373 5f6d 6561 6e2c 2074 7261 696e 696e  cs_mean, trainin
+00012e40: 675f 6c6f 7373 5f6d 6561 6e2c 2074 6573  g_loss_mean, tes
+00012e50: 745f 6d65 7472 6963 5d29 0a20 2020 2020  t_metric]).     
+00012e60: 2020 2065 6c69 6620 7365 6c66 2e6d 6574     elif self.met
+00012e70: 7269 6320 3d3d 2027 7661 6c5f 616c 6c27  ric == 'val_all'
+00012e80: 3a20 2341 7665 7261 6765 2061 6c6c 2074  : #Average all t
+00012e90: 6865 2076 616c 6964 6174 696f 6e20 6d65  he validation me
+00012ea0: 7472 6963 730a 2020 2020 2020 2020 2020  trics.          
+00012eb0: 2020 7661 6c5f 6d65 7472 6963 735f 6d65    val_metrics_me
+00012ec0: 616e 2c20 7661 6c5f 6c6f 7373 5f6d 6561  an, val_loss_mea
+00012ed0: 6e20 3d20 5b5d 2c20 5b5d 200a 2020 2020  n = [], [] .    
+00012ee0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00012ef0: 6176 6572 6167 653a 0a20 2020 2020 2020  average:.       
+00012f00: 2020 2020 2020 2020 2066 6f72 205f 6869           for _hi
+00012f10: 7374 6f72 795f 2069 6e20 6869 7374 6f72  story_ in histor
+00012f20: 6965 733a 0a20 2020 2020 2020 2020 2020  ies:.           
+00012f30: 2020 2020 2020 2020 2076 616c 5f6d 6574           val_met
+00012f40: 7269 6373 5f6d 6561 6e2e 6170 7065 6e64  rics_mean.append
+00012f50: 286e 702e 6d65 616e 285b 6e70 2e6d 6561  (np.mean([np.mea
+00012f60: 6e28 5f68 6973 746f 7279 5f2e 6869 7374  n(_history_.hist
+00012f70: 6f72 795b 2776 616c 5f27 2b6d 6574 7269  ory['val_'+metri
+00012f80: 635d 2920 666f 7220 6d65 7472 6963 2069  c]) for metric i
+00012f90: 6e20 6d65 7472 6963 7320 6966 2027 6c6f  n metrics if 'lo
+00012fa0: 7373 2720 6e6f 7420 696e 206d 6574 7269  ss' not in metri
+00012fb0: 635d 2929 0a20 2020 2020 2020 2020 2020  c])).           
+00012fc0: 2020 2020 2020 2020 2076 616c 5f6c 6f73           val_los
+00012fd0: 735f 6d65 616e 2e61 7070 656e 6428 3120  s_mean.append(1 
+00012fe0: 2d20 6e70 2e6d 6561 6e28 5f68 6973 746f  - np.mean(_histo
+00012ff0: 7279 5f2e 6869 7374 6f72 795b 2776 616c  ry_.history['val
+00013000: 5f6c 6f73 7327 5d29 290a 2020 2020 2020  _loss'])).      
+00013010: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00013020: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00013030: 5f68 6973 746f 7279 5f20 696e 2068 6973  _history_ in his
+00013040: 746f 7269 6573 3a0a 2020 2020 2020 2020  tories:.        
+00013050: 2020 2020 2020 2020 2020 2020 7661 6c5f              val_
+00013060: 6d65 7472 6963 735f 6d65 616e 2e61 7070  metrics_mean.app
+00013070: 656e 6428 6e70 2e6d 6561 6e28 5b5f 6869  end(np.mean([_hi
+00013080: 7374 6f72 795f 2e68 6973 746f 7279 5b27  story_.history['
+00013090: 7661 6c5f 272b 6d65 7472 6963 5d5b 2d31  val_'+metric][-1
+000130a0: 5d20 666f 7220 6d65 7472 6963 2069 6e20  ] for metric in 
+000130b0: 6d65 7472 6963 7320 6966 2027 6c6f 7373  metrics if 'loss
+000130c0: 2720 6e6f 7420 696e 206d 6574 7269 635d  ' not in metric]
+000130d0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+000130e0: 2020 2020 2020 2076 616c 5f6c 6f73 735f         val_loss_
+000130f0: 6d65 616e 2e61 7070 656e 6428 3120 2d20  mean.append(1 - 
+00013100: 5f68 6973 746f 7279 5f2e 6869 7374 6f72  _history_.histor
+00013110: 795b 2776 616c 5f6c 6f73 7327 5d5b 2d31  y['val_loss'][-1
+00013120: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
+00013130: 6620 7465 7374 5f6d 6574 7269 6320 6973  f test_metric is
+00013140: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00013150: 2020 2020 2020 2066 696e 616c 5f73 636f         final_sco
+00013160: 7265 203d 206e 702e 6d65 616e 285b 7661  re = np.mean([va
+00013170: 6c5f 6d65 7472 6963 735f 6d65 616e 2c20  l_metrics_mean, 
+00013180: 7661 6c5f 6c6f 7373 5f6d 6561 6e5d 290a  val_loss_mean]).
+00013190: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000131a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000131b0: 2020 6669 6e61 6c5f 7363 6f72 6520 3d20    final_score = 
+000131c0: 6e70 2e6d 6561 6e28 5b76 616c 5f6d 6574  np.mean([val_met
+000131d0: 7269 6373 5f6d 6561 6e2c 2076 616c 5f6c  rics_mean, val_l
+000131e0: 6f73 735f 6d65 616e 2c20 7465 7374 5f6d  oss_mean, test_m
+000131f0: 6574 7269 635d 290a 2020 2020 2020 2020  etric]).        
+00013200: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00013210: 2020 7363 6f72 6573 203d 205b 5d0a 2020    scores = [].  
+00013220: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00013230: 662e 6176 6572 6167 653a 0a20 2020 2020  f.average:.     
+00013240: 2020 2020 2020 2020 2020 2066 6f72 205f             for _
+00013250: 6869 7374 6f72 795f 2069 6e20 6869 7374  history_ in hist
+00013260: 6f72 6965 733a 0a20 2020 2020 2020 2020  ories:.         
+00013270: 2020 2020 2020 2020 2020 2073 636f 7265             score
+00013280: 732e 6170 7065 6e64 286e 702e 6d65 616e  s.append(np.mean
+00013290: 285f 6869 7374 6f72 795f 2e68 6973 746f  (_history_.histo
+000132a0: 7279 5b73 656c 662e 6d65 7472 6963 5d29  ry[self.metric])
+000132b0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+000132c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000132d0: 2020 2020 666f 7220 5f68 6973 746f 7279      for _history
+000132e0: 5f20 696e 2068 6973 746f 7269 6573 3a0a  _ in histories:.
+000132f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013300: 2020 2020 7363 6f72 6573 2e61 7070 656e      scores.appen
+00013310: 6428 5f68 6973 746f 7279 5f2e 6869 7374  d(_history_.hist
+00013320: 6f72 795b 7365 6c66 2e6d 6574 7269 635d  ory[self.metric]
+00013330: 5b2d 315d 290a 0a20 2020 2020 2020 2020  [-1])..         
+00013340: 2020 2066 696e 616c 5f73 636f 7265 203d     final_score =
+00013350: 206e 702e 6d65 616e 2873 636f 7265 7329   np.mean(scores)
+00013360: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00013370: 2027 6c6f 7373 2720 696e 2073 656c 662e   'loss' in self.
+00013380: 6d65 7472 6963 3a20 0a20 2020 2020 2020  metric: .       
+00013390: 2020 2020 2020 2020 2066 696e 616c 5f73           final_s
+000133a0: 636f 7265 203d 2031 202d 2066 696e 616c  core = 1 - final
+000133b0: 5f73 636f 7265 0a20 2020 2020 2020 2020  _score.         
+000133c0: 2020 2069 6620 7465 7374 5f6d 6574 7269     if test_metri
+000133d0: 6320 6973 206e 6f74 204e 6f6e 653a 0a20  c is not None:. 
+000133e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000133f0: 696e 616c 5f73 636f 7265 203d 2028 6669  inal_score = (fi
+00013400: 6e61 6c5f 7363 6f72 6520 2b20 7465 7374  nal_score + test
+00013410: 5f6d 6574 7269 6329 202f 2032 2e30 0a20  _metric) / 2.0. 
+00013420: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00013430: 7265 7475 726e 2066 696e 616c 5f73 636f  return final_sco
+00013440: 7265 0a0a 636c 6173 7320 6f62 6a65 6374  re..class object
+00013450: 6976 655f 7867 6228 6f62 6a65 6374 293a  ive_xgb(object):
+00013460: 0a20 2020 2022 2222 0a20 2020 204f 7074  .    """.    Opt
+00013470: 696d 697a 6174 696f 6e20 6f62 6a65 6374  imization object
+00013480: 6976 6520 6675 6e63 7469 6f6e 2066 6f72  ive function for
+00013490: 2074 6865 2074 7265 652d 6261 7365 6420   the tree-based 
+000134a0: 5847 426f 6f73 7420 636c 6173 7369 6669  XGBoost classifi
+000134b0: 6572 2e20 0a20 2020 2054 6865 204f 7074  er. .    The Opt
+000134c0: 756e 6120 736f 6674 7761 7265 2066 6f72  una software for
+000134d0: 2068 7970 6572 7061 7261 6d65 7465 7220   hyperparameter 
+000134e0: 6f70 7469 6d69 7a61 7469 6f6e 2077 6173  optimization was
+000134f0: 2070 7562 6c69 7368 6564 2069 6e20 0a20   published in . 
+00013500: 2020 2032 3031 3920 6279 2041 6b69 6261     2019 by Akiba
+00013510: 2065 7420 616c 2e20 5061 7065 723a 2068   et al. Paper: h
+00013520: 7474 7073 3a2f 2f61 7278 6976 2e6f 7267  ttps://arxiv.org
+00013530: 2f61 6273 2f31 3930 372e 3130 3930 320a  /abs/1907.10902.
+00013540: 2020 2020 0a20 2020 204e 6f74 653a 0a20      .    Note:. 
+00013550: 2020 2020 2020 2049 6620 6f70 745f 6376         If opt_cv
+00013560: 2069 7320 6265 7477 6565 6e20 3020 616e   is between 0 an
+00013570: 6420 312c 2061 2070 7275 6e69 6e67 2070  d 1, a pruning p
+00013580: 726f 6365 6475 7265 2077 696c 6c20 6265  rocedure will be
+00013590: 2069 6e69 7469 6c69 617a 6564 2028 6120   initiliazed (a 
+000135a0: 7072 6f63 6564 7572 6520 696e 636f 6d70  procedure incomp
+000135b0: 6174 6962 6c65 2077 6974 6820 6372 6f73  atible with cros
+000135c0: 732d 7661 6c69 6461 7469 6f6e 292c 0a20  s-validation),. 
+000135d0: 2020 2020 2020 2073 6f20 6173 2074 6f20         so as to 
+000135e0: 7370 6565 6420 7570 2074 6865 2058 4742  speed up the XGB
+000135f0: 206f 7074 696d 697a 6174 696f 6e2e 2049   optimization. I
+00013600: 6620 6f70 745f 6376 2069 7320 6265 7477  f opt_cv is betw
+00013610: 6565 6e20 3020 616e 6420 312c 2061 2072  een 0 and 1, a r
+00013620: 616e 646f 6d20 7661 6c69 6461 7469 6f6e  andom validation
+00013630: 2064 6174 6120 7769 6c6c 2062 6520 6765   data will be ge
+00013640: 6e65 7261 7465 6420 6163 636f 7264 696e  nerated accordin
+00013650: 6720 746f 2074 6869 7320 7261 7469 6f2c  g to this ratio,
+00013660: 0a20 2020 2020 2020 2077 6869 6368 2077  .        which w
+00013670: 696c 6c20 7265 706c 6163 6520 7468 6520  ill replace the 
+00013680: 6372 6f73 732d 7661 6c69 6461 7469 6f6e  cross-validation
+00013690: 206d 6574 686f 6420 7573 6564 2062 7920   method used by 
+000136a0: 6465 6661 756c 742e 2049 7420 7769 6c6c  default. It will
+000136b0: 2070 7275 6e65 2061 6363 6f72 6469 6e67   prune according
+000136c0: 0a20 2020 2020 2020 2074 6f20 7468 6520  .        to the 
+000136d0: 6631 2d73 636f 7265 206f 6620 7468 6520  f1-score of the 
+000136e0: 7661 6c69 6461 7469 6f6e 2064 6174 612c  validation data,
+000136f0: 2077 6869 6368 2077 6f75 6c64 2062 6520   which would be 
+00013700: 3130 2520 6f66 2074 6865 2074 7261 696e  10% of the train
+00013710: 696e 6720 6461 7461 2069 6620 6f70 745f  ing data if opt_
+00013720: 6376 3d30 2e31 2c20 666f 7220 6578 616d  cv=0.1, for exam
+00013730: 706c 652e 200a 2020 2020 2020 2020 4e65  ple. .        Ne
+00013740: 6564 206d 6f72 6520 7465 7374 696e 6720  ed more testing 
+00013750: 746f 206d 616b 6520 7468 6973 206d 6f72  to make this mor
+00013760: 6520 726f 6275 7374 2e0a 2020 2020 2020  e robust..      
+00013770: 2020 0a20 2020 2041 7267 733a 0a20 2020    .    Args:.   
+00013780: 2020 2020 2064 6174 615f 7820 286e 6461       data_x (nda
+00013790: 7272 6179 293a 2032 4420 6172 7261 7920  rray): 2D array 
+000137a0: 6f66 2073 697a 6520 286e 2078 206d 292c  of size (n x m),
+000137b0: 2077 6865 7265 206e 2069 7320 7468 650a   where n is the.
+000137c0: 2020 2020 2020 2020 2020 2020 6e75 6d62              numb
+000137d0: 6572 206f 6620 7361 6d70 6c65 732c 2061  er of samples, a
+000137e0: 6e64 206d 2074 6865 206e 756d 6265 7220  nd m the number 
+000137f0: 6f66 2066 6561 7475 7265 732e 0a20 2020  of features..   
+00013800: 2020 2020 2064 6174 615f 7920 286e 6461       data_y (nda
+00013810: 7272 6179 2c20 7374 7229 3a20 3144 2061  rray, str): 1D a
+00013820: 7272 6179 2063 6f6e 7461 696e 696e 6720  rray containing 
+00013830: 7468 6520 636f 7272 6573 706f 6e69 6e67  the corresponing
+00013840: 206c 6162 656c 732e 200a 2020 2020 2020   labels. .      
+00013850: 2020 6c69 6d69 745f 7365 6172 6368 2028    limit_search (
+00013860: 626f 6f6c 293a 2049 6620 5472 7565 2c20  bool): If True, 
+00013870: 7468 6520 7365 6172 6368 2073 7061 6365  the search space
+00013880: 2066 6f72 2074 6865 2070 6172 616d 6574   for the paramet
+00013890: 6572 7320 7769 6c6c 2062 6520 6578 7061  ers will be expa
+000138a0: 6e64 6564 2c0a 2020 2020 2020 2020 2020  nded,.          
+000138b0: 2020 6173 2074 6865 7265 2061 7265 2073    as there are s
+000138c0: 6f6d 6520 6879 7065 7270 6172 616d 6574  ome hyperparamet
+000138d0: 6572 7320 7468 6174 2063 616e 2072 616e  ers that can ran
+000138e0: 6765 2066 726f 6d20 3020 746f 2069 6e66  ge from 0 to inf
+000138f0: 2e20 4465 6661 756c 7473 2074 6f20 4661  . Defaults to Fa
+00013900: 6c73 652e 0a20 2020 2020 2020 206f 7074  lse..        opt
+00013910: 5f63 7620 2869 6e74 293a 2043 726f 7373  _cv (int): Cross
+00013920: 2d76 616c 6964 6174 696f 6e73 2074 6f20  -validations to 
+00013930: 7065 7266 6f72 6d20 7768 656e 2061 7373  perform when ass
+00013940: 6573 696e 6720 7468 6520 7065 7266 6f72  esing the perfor
+00013950: 6d61 6e63 6520 6174 2065 6163 680a 2020  mance at each.  
+00013960: 2020 2020 2020 2020 2020 6879 7065 7270            hyperp
+00013970: 6172 616d 6574 6572 206f 7074 696d 697a  arameter optimiz
+00013980: 6174 696f 6e20 7472 6961 6c2e 2046 6f72  ation trial. For
+00013990: 2065 7861 6d70 6c65 2c20 6966 2063 763d   example, if cv=
+000139a0: 332c 2074 6865 6e20 6561 6368 206f 7074  3, then each opt
+000139b0: 696d 697a 6174 696f 6e20 7472 6961 6c0a  imization trial.
+000139c0: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+000139d0: 2062 6520 6173 7365 7373 6564 2061 6363   be assessed acc
+000139e0: 6f72 6469 6e67 2074 6f20 7468 6520 332d  ording to the 3-
+000139f0: 666f 6c64 2063 726f 7373 2076 616c 6964  fold cross valid
+00013a00: 6174 696f 6e20 6163 6375 7261 6379 2e20  ation accuracy. 
+00013a10: 4966 2074 6869 7320 6973 0a20 2020 2020  If this is.     
+00013a20: 2020 2020 2020 2062 6574 7765 656e 2030         between 0
+00013a30: 2061 6e64 2031 2c20 7468 6973 2076 616c   and 1, this val
+00013a40: 7565 2077 6f75 6c64 2062 6520 7573 6564  ue would be used
+00013a50: 2061 7320 7468 6520 7261 7469 6f20 6f66   as the ratio of
+00013a60: 2074 6865 2076 616c 6964 6174 696f 6e20   the validation 
+00013a70: 746f 2074 7261 696e 696e 6720 6461 7461  to training data
+00013a80: 2e0a 2020 2020 2020 2020 2020 2020 4465  ..            De
+00013a90: 6661 756c 7473 2074 6f20 4e6f 6e65 2c20  faults to None, 
+00013aa0: 696e 2077 6869 6368 2063 6173 6520 7468  in which case th
+00013ab0: 6520 6372 6f73 732d 7661 6c69 6461 7469  e cross-validati
+00013ac0: 6f6e 2070 726f 6365 6475 7265 2077 696c  on procedure wil
+00013ad0: 6c20 6265 2065 6d70 6c6f 7965 642e 0a20  l be employed.. 
+00013ae0: 2020 2020 2020 2065 7661 6c5f 6d65 7472         eval_metr
+00013af0: 6963 2028 7374 7229 3a20 5468 6520 6576  ic (str): The ev
+00013b00: 616c 7561 7469 6f6e 206d 6574 7269 6320  aluation metric 
+00013b10: 7768 656e 2065 7661 6c75 6174 696e 6720  when evaluating 
+00013b20: 7468 6520 7661 6c69 6461 7469 6f6e 2064  the validation d
+00013b30: 6174 612c 2075 7365 6420 7768 656e 0a20  ata, used when. 
+00013b40: 2020 2020 2020 2020 2020 206f 7074 5f63             opt_c
+00013b50: 7620 6973 206c 6573 7320 7468 616e 2031  v is less than 1
+00013b60: 2e20 4465 6661 756c 7473 2074 6f20 2266  . Defaults to "f
+00013b70: 3122 2e20 466f 7220 616c 6c20 6f70 7469  1". For all opti
+00013b80: 6f6e 7320 7365 6520 6576 616c 5f6d 6574  ons see eval_met
+00013b90: 7269 6320 6672 6f6d 3a20 6874 7470 733a  ric from: https:
+00013ba0: 2f2f 7867 626f 6f73 742e 7265 6164 7468  //xgboost.readth
+00013bb0: 6564 6f63 732e 696f 2f65 6e2f 6c61 7465  edocs.io/en/late
+00013bc0: 7374 2f70 6172 616d 6574 6572 2e68 746d  st/parameter.htm
+00013bd0: 6c23 6d65 7472 6963 730a 0a20 2020 2052  l#metrics..    R
+00013be0: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
+00013bf0: 5468 6520 6372 6f73 732d 7661 6c69 6461  The cross-valida
+00013c00: 7469 6f6e 2061 6363 7572 6163 7920 2869  tion accuracy (i
+00013c10: 6620 6f70 745f 6376 2069 7320 6772 6561  f opt_cv is grea
+00013c20: 7465 7220 7468 616e 2031 2c20 3120 776f  ter than 1, 1 wo
+00013c30: 756c 6420 6265 2073 696e 676c 6520 696e  uld be single in
+00013c40: 7374 616e 6365 2061 6363 7572 6163 7929  stance accuracy)
+00013c50: 0a20 2020 2020 2020 206f 722c 2069 6620  .        or, if 
+00013c60: 6f70 745f 6376 2069 7320 6265 7477 6565  opt_cv is betwee
+00013c70: 6e20 3020 616e 6420 312c 2074 6865 2076  n 0 and 1, the v
+00013c80: 616c 6964 6174 696f 6e20 6163 6375 7261  alidation accura
+00013c90: 6379 2061 6363 6f72 6469 6e67 2074 6f20  cy according to 
+00013ca0: 7468 6520 636f 7272 6573 706f 6e64 696e  the correspondin
+00013cb0: 6720 7465 7374 2073 697a 652e 0a20 2020  g test size..   
+00013cc0: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+00013cd0: 696e 6974 5f5f 2873 656c 662c 2064 6174  init__(self, dat
+00013ce0: 615f 782c 2064 6174 615f 792c 206c 696d  a_x, data_y, lim
+00013cf0: 6974 5f73 6561 7263 683d 4661 6c73 652c  it_search=False,
+00013d00: 206f 7074 5f63 763d 332c 2065 7661 6c5f   opt_cv=3, eval_
+00013d10: 6d65 7472 6963 3d22 6631 2229 3a0a 2020  metric="f1"):.  
+00013d20: 2020 2020 2020 7365 6c66 2e64 6174 615f        self.data_
+00013d30: 7820 3d20 6461 7461 5f78 0a20 2020 2020  x = data_x.     
+00013d40: 2020 2073 656c 662e 6461 7461 5f79 203d     self.data_y =
+00013d50: 2064 6174 615f 790a 2020 2020 2020 2020   data_y.        
+00013d60: 7365 6c66 2e6c 696d 6974 5f73 6561 7263  self.limit_searc
+00013d70: 6820 3d20 6c69 6d69 745f 7365 6172 6368  h = limit_search
+00013d80: 0a20 2020 2020 2020 2073 656c 662e 6f70  .        self.op
+00013d90: 745f 6376 203d 206f 7074 5f63 7620 0a20  t_cv = opt_cv . 
+00013da0: 2020 2020 2020 2073 656c 662e 6576 616c         self.eval
+00013db0: 5f6d 6574 7269 6320 3d20 6576 616c 5f6d  _metric = eval_m
+00013dc0: 6574 7269 6320 0a0a 2020 2020 6465 6620  etric ..    def 
+00013dd0: 5f5f 6361 6c6c 5f5f 2873 656c 662c 2074  __call__(self, t
+00013de0: 7269 616c 293a 0a0a 2020 2020 2020 2020  rial):..        
+00013df0: 7061 7261 6d73 203d 207b 226f 626a 6563  params = {"objec
+00013e00: 7469 7665 223a 2022 6269 6e61 7279 3a6c  tive": "binary:l
+00013e10: 6f67 6973 7469 6322 2c20 2265 7661 6c5f  ogistic", "eval_
+00013e20: 6d65 7472 6963 223a 2073 656c 662e 6576  metric": self.ev
+00013e30: 616c 5f6d 6574 7269 637d 200a 2020 2020  al_metric} .    
+00013e40: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00013e50: 2e6f 7074 5f63 7620 3c20 313a 0a20 2020  .opt_cv < 1:.   
+00013e60: 2020 2020 2020 2020 2074 7261 696e 5f78           train_x
+00013e70: 2c20 7661 6c69 645f 782c 2074 7261 696e  , valid_x, train
+00013e80: 5f79 2c20 7661 6c69 645f 7920 3d20 7472  _y, valid_y = tr
+00013e90: 6169 6e5f 7465 7374 5f73 706c 6974 2873  ain_test_split(s
+00013ea0: 656c 662e 6461 7461 5f78 2c20 7365 6c66  elf.data_x, self
+00013eb0: 2e64 6174 615f 792c 2074 6573 745f 7369  .data_y, test_si
+00013ec0: 7a65 3d73 656c 662e 6f70 745f 6376 2c20  ze=self.opt_cv, 
+00013ed0: 7261 6e64 6f6d 5f73 7461 7465 3d31 3930  random_state=190
+00013ee0: 3929 236e 702e 7261 6e64 6f6d 2e72 616e  9)#np.random.ran
+00013ef0: 6469 6e74 2831 2c20 3165 3929 290a 2020  dint(1, 1e9)).  
+00013f00: 2020 2020 2020 2020 2020 6474 7261 696e            dtrain
+00013f10: 2c20 6476 616c 6964 203d 2044 4d61 7472  , dvalid = DMatr
+00013f20: 6978 2874 7261 696e 5f78 2c20 6c61 6265  ix(train_x, labe
+00013f30: 6c3d 7472 6169 6e5f 7929 2c20 444d 6174  l=train_y), DMat
+00013f40: 7269 7828 7661 6c69 645f 782c 206c 6162  rix(valid_x, lab
+00013f50: 656c 3d76 616c 6964 5f79 290a 2020 2020  el=valid_y).    
+00013f60: 2020 2020 2020 2020 2370 7269 6e74 2827          #print('
+00013f70: 496e 6974 6961 6c69 7a69 6e67 2058 4742  Initializing XGB
+00013f80: 6f6f 7374 2050 7275 6e65 722e 2e2e 2729  oost Pruner...')
+00013f90: 0a20 2020 2020 2020 2020 2020 2070 7275  .            pru
+00013fa0: 6e69 6e67 5f63 616c 6c62 6163 6b20 3d20  ning_callback = 
+00013fb0: 6f70 7475 6e61 2e69 6e74 6567 7261 7469  optuna.integrati
+00013fc0: 6f6e 2e58 4742 6f6f 7374 5072 756e 696e  on.XGBoostPrunin
+00013fd0: 6743 616c 6c62 6163 6b28 7472 6961 6c2c  gCallback(trial,
+00013fe0: 2022 7661 6c69 6461 7469 6f6e 2d22 202b   "validation-" +
+00013ff0: 2073 656c 662e 6576 616c 5f6d 6574 7269   self.eval_metri
+00014000: 6329 0a0a 2020 2020 2020 2020 6966 2073  c)..        if s
+00014010: 656c 662e 6c69 6d69 745f 7365 6172 6368  elf.limit_search
+00014020: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00014030: 7261 6d73 5b27 6e5f 6573 7469 6d61 746f  rams['n_estimato
+00014040: 7273 275d 203d 2074 7269 616c 2e73 7567  rs'] = trial.sug
+00014050: 6765 7374 5f69 6e74 2827 6e5f 6573 7469  gest_int('n_esti
+00014060: 6d61 746f 7273 272c 2031 3030 2c20 3235  mators', 100, 25
+00014070: 3029 0a20 2020 2020 2020 2020 2020 2070  0).            p
+00014080: 6172 616d 735b 2762 6f6f 7374 6572 275d  arams['booster']
+00014090: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+000140a0: 5f63 6174 6567 6f72 6963 616c 2827 626f  _categorical('bo
+000140b0: 6f73 7465 7227 2c20 5b27 6762 7472 6565  oster', ['gbtree
+000140c0: 272c 2027 6461 7274 275d 290a 2020 2020  ', 'dart']).    
+000140d0: 2020 2020 2020 2020 7061 7261 6d73 5b27          params['
+000140e0: 7265 675f 6c61 6d62 6461 275d 203d 2074  reg_lambda'] = t
+000140f0: 7269 616c 2e73 7567 6765 7374 5f6c 6f67  rial.suggest_log
+00014100: 756e 6966 6f72 6d28 2772 6567 5f6c 616d  uniform('reg_lam
+00014110: 6264 6127 2c20 3165 2d38 2c20 3129 0a20  bda', 1e-8, 1). 
+00014120: 2020 2020 2020 2020 2020 2070 6172 616d             param
+00014130: 735b 2772 6567 5f61 6c70 6861 275d 203d  s['reg_alpha'] =
+00014140: 2074 7269 616c 2e73 7567 6765 7374 5f6c   trial.suggest_l
+00014150: 6f67 756e 6966 6f72 6d28 2772 6567 5f61  oguniform('reg_a
+00014160: 6c70 6861 272c 2031 652d 382c 2031 290a  lpha', 1e-8, 1).
+00014170: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00014180: 6d73 5b27 6d61 785f 6465 7074 6827 5d20  ms['max_depth'] 
+00014190: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+000141a0: 696e 7428 276d 6178 5f64 6570 7468 272c  int('max_depth',
+000141b0: 2032 2c20 3235 290a 2020 2020 2020 2020   2, 25).        
+000141c0: 2020 2020 7061 7261 6d73 5b27 6574 6127      params['eta'
+000141d0: 5d20 3d20 7472 6961 6c2e 7375 6767 6573  ] = trial.sugges
+000141e0: 745f 6c6f 6775 6e69 666f 726d 2827 6574  t_loguniform('et
+000141f0: 6127 2c20 3165 2d38 2c20 3129 0a20 2020  a', 1e-8, 1).   
+00014200: 2020 2020 2020 2020 2070 6172 616d 735b           params[
+00014210: 2767 616d 6d61 275d 203d 2074 7269 616c  'gamma'] = trial
+00014220: 2e73 7567 6765 7374 5f6c 6f67 756e 6966  .suggest_logunif
+00014230: 6f72 6d28 2767 616d 6d61 272c 2031 652d  orm('gamma', 1e-
+00014240: 382c 2031 290a 2020 2020 2020 2020 2020  8, 1).          
+00014250: 2020 7061 7261 6d73 5b27 6772 6f77 5f70    params['grow_p
+00014260: 6f6c 6963 7927 5d20 3d20 7472 6961 6c2e  olicy'] = trial.
+00014270: 7375 6767 6573 745f 6361 7465 676f 7269  suggest_categori
+00014280: 6361 6c28 2767 726f 775f 706f 6c69 6379  cal('grow_policy
+00014290: 272c 205b 2764 6570 7468 7769 7365 272c  ', ['depthwise',
+000142a0: 2027 6c6f 7373 6775 6964 6527 5d29 0a0a   'lossguide'])..
+000142b0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+000142c0: 6172 616d 735b 2762 6f6f 7374 6572 275d  arams['booster']
+000142d0: 203d 3d20 2264 6172 7422 3a0a 2020 2020   == "dart":.    
+000142e0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+000142f0: 6d73 5b27 7361 6d70 6c65 5f74 7970 6527  ms['sample_type'
+00014300: 5d20 3d20 7472 6961 6c2e 7375 6767 6573  ] = trial.sugges
+00014310: 745f 6361 7465 676f 7269 6361 6c28 2773  t_categorical('s
+00014320: 616d 706c 655f 7479 7065 272c 205b 2775  ample_type', ['u
+00014330: 6e69 666f 726d 272c 2027 7765 6967 6874  niform', 'weight
+00014340: 6564 275d 290a 2020 2020 2020 2020 2020  ed']).          
+00014350: 2020 2020 2020 7061 7261 6d73 5b27 6e6f        params['no
+00014360: 726d 616c 697a 655f 7479 7065 275d 203d  rmalize_type'] =
+00014370: 2074 7269 616c 2e73 7567 6765 7374 5f63   trial.suggest_c
+00014380: 6174 6567 6f72 6963 616c 2827 6e6f 726d  ategorical('norm
+00014390: 616c 697a 655f 7479 7065 272c 205b 2774  alize_type', ['t
+000143a0: 7265 6527 2c20 2766 6f72 6573 7427 5d29  ree', 'forest'])
+000143b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000143c0: 2070 6172 616d 735b 2772 6174 655f 6472   params['rate_dr
+000143d0: 6f70 275d 203d 2074 7269 616c 2e73 7567  op'] = trial.sug
+000143e0: 6765 7374 5f6c 6f67 756e 6966 6f72 6d28  gest_loguniform(
+000143f0: 2772 6174 655f 6472 6f70 272c 2031 652d  'rate_drop', 1e-
+00014400: 382c 2031 290a 2020 2020 2020 2020 2020  8, 1).          
+00014410: 2020 2020 2020 7061 7261 6d73 5b27 736b        params['sk
+00014420: 6970 5f64 726f 7027 5d20 3d20 7472 6961  ip_drop'] = tria
+00014430: 6c2e 7375 6767 6573 745f 6c6f 6775 6e69  l.suggest_loguni
+00014440: 666f 726d 2827 736b 6970 5f64 726f 7027  form('skip_drop'
+00014450: 2c20 3165 2d38 2c20 3129 0a20 2020 2020  , 1e-8, 1).     
+00014460: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00014470: 6c66 2e6f 7074 5f63 7620 3e3d 2031 3a0a  lf.opt_cv >= 1:.
+00014480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014490: 2020 2020 636c 6620 3d20 5847 4243 6c61      clf = XGBCla
+000144a0: 7373 6966 6965 7228 626f 6f73 7465 723d  ssifier(booster=
+000144b0: 7061 7261 6d73 5b27 626f 6f73 7465 7227  params['booster'
+000144c0: 5d2c 206e 5f65 7374 696d 6174 6f72 733d  ], n_estimators=
+000144d0: 7061 7261 6d73 5b27 6e5f 6573 7469 6d61  params['n_estima
+000144e0: 746f 7273 275d 2c20 7265 675f 6c61 6d62  tors'], reg_lamb
+000144f0: 6461 3d70 6172 616d 735b 2772 6567 5f6c  da=params['reg_l
+00014500: 616d 6264 6127 5d2c 200a 2020 2020 2020  ambda'], .      
+00014510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014520: 2020 7265 675f 616c 7068 613d 7061 7261    reg_alpha=para
+00014530: 6d73 5b27 7265 675f 616c 7068 6127 5d2c  ms['reg_alpha'],
+00014540: 206d 6178 5f64 6570 7468 3d70 6172 616d   max_depth=param
+00014550: 735b 276d 6178 5f64 6570 7468 275d 2c20  s['max_depth'], 
+00014560: 6574 613d 7061 7261 6d73 5b27 6574 6127  eta=params['eta'
+00014570: 5d2c 2067 616d 6d61 3d70 6172 616d 735b  ], gamma=params[
+00014580: 2767 616d 6d61 275d 2c20 0a20 2020 2020  'gamma'], .     
+00014590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145a0: 2020 2067 726f 775f 706f 6c69 6379 3d70     grow_policy=p
+000145b0: 6172 616d 735b 2767 726f 775f 706f 6c69  arams['grow_poli
+000145c0: 6379 275d 2c20 7361 6d70 6c65 5f74 7970  cy'], sample_typ
+000145d0: 653d 7061 7261 6d73 5b27 7361 6d70 6c65  e=params['sample
+000145e0: 5f74 7970 6527 5d2c 206e 6f72 6d61 6c69  _type'], normali
+000145f0: 7a65 5f74 7970 653d 7061 7261 6d73 5b27  ze_type=params['
+00014600: 6e6f 726d 616c 697a 655f 7479 7065 275d  normalize_type']
+00014610: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014620: 2020 2020 2020 2020 2020 7261 7465 5f64            rate_d
+00014630: 726f 703d 7061 7261 6d73 5b27 7261 7465  rop=params['rate
+00014640: 5f64 726f 7027 5d2c 2073 6b69 705f 6472  _drop'], skip_dr
+00014650: 6f70 3d70 6172 616d 735b 2773 6b69 705f  op=params['skip_
+00014660: 6472 6f70 275d 2c20 7261 6e64 6f6d 5f73  drop'], random_s
+00014670: 7461 7465 3d31 3930 3929 232c 2074 7265  tate=1909)#, tre
+00014680: 655f 6d65 7468 6f64 3d27 6869 7374 2729  e_method='hist')
+00014690: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+000146a0: 2020 2020 2020 2020 2020 656c 6966 2070            elif p
+000146b0: 6172 616d 735b 2762 6f6f 7374 6572 275d  arams['booster']
+000146c0: 203d 3d20 2767 6274 7265 6527 3a0a 2020   == 'gbtree':.  
+000146d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000146e0: 7261 6d73 5b27 7375 6273 616d 706c 6527  rams['subsample'
+000146f0: 5d20 3d20 7472 6961 6c2e 7375 6767 6573  ] = trial.sugges
+00014700: 745f 6c6f 6775 6e69 666f 726d 2827 7375  t_loguniform('su
+00014710: 6273 616d 706c 6527 2c20 3165 2d36 2c20  bsample', 1e-6, 
+00014720: 312e 3029 0a20 2020 2020 2020 2020 2020  1.0).           
+00014730: 2020 2020 2069 6620 7365 6c66 2e6f 7074       if self.opt
+00014740: 5f63 7620 3e3d 2031 3a0a 2020 2020 2020  _cv >= 1:.      
+00014750: 2020 2020 2020 2020 2020 2020 2020 636c                cl
+00014760: 6620 3d20 5847 4243 6c61 7373 6966 6965  f = XGBClassifie
+00014770: 7228 626f 6f73 7465 723d 7061 7261 6d73  r(booster=params
+00014780: 5b27 626f 6f73 7465 7227 5d2c 206e 5f65  ['booster'], n_e
+00014790: 7374 696d 6174 6f72 733d 7061 7261 6d73  stimators=params
+000147a0: 5b27 6e5f 6573 7469 6d61 746f 7273 275d  ['n_estimators']
+000147b0: 2c20 7265 675f 6c61 6d62 6461 3d70 6172  , reg_lambda=par
+000147c0: 616d 735b 2772 6567 5f6c 616d 6264 6127  ams['reg_lambda'
+000147d0: 5d2c 200a 2020 2020 2020 2020 2020 2020  ], .            
+000147e0: 2020 2020 2020 2020 2020 2020 7265 675f              reg_
+000147f0: 616c 7068 613d 7061 7261 6d73 5b27 7265  alpha=params['re
+00014800: 675f 616c 7068 6127 5d2c 206d 6178 5f64  g_alpha'], max_d
+00014810: 6570 7468 3d70 6172 616d 735b 276d 6178  epth=params['max
+00014820: 5f64 6570 7468 275d 2c20 6574 613d 7061  _depth'], eta=pa
+00014830: 7261 6d73 5b27 6574 6127 5d2c 2067 616d  rams['eta'], gam
+00014840: 6d61 3d70 6172 616d 735b 2767 616d 6d61  ma=params['gamma
+00014850: 275d 2c20 0a20 2020 2020 2020 2020 2020  '], .           
+00014860: 2020 2020 2020 2020 2020 2020 2067 726f               gro
+00014870: 775f 706f 6c69 6379 3d70 6172 616d 735b  w_policy=params[
+00014880: 2767 726f 775f 706f 6c69 6379 275d 2c20  'grow_policy'], 
+00014890: 7375 6273 616d 706c 653d 7061 7261 6d73  subsample=params
+000148a0: 5b27 7375 6273 616d 706c 6527 5d2c 2072  ['subsample'], r
+000148b0: 616e 646f 6d5f 7374 6174 653d 3139 3039  andom_state=1909
+000148c0: 2923 2c20 7472 6565 5f6d 6574 686f 643d  )#, tree_method=
+000148d0: 2768 6973 7427 290a 0a20 2020 2020 2020  'hist')..       
+000148e0: 2020 2020 2069 6620 7365 6c66 2e6f 7074       if self.opt
+000148f0: 5f63 7620 3c20 313a 0a20 2020 2020 2020  _cv < 1:.       
+00014900: 2020 2020 2020 2020 2062 7374 203d 2074           bst = t
+00014910: 7261 696e 2870 6172 616d 732c 2064 7472  rain(params, dtr
+00014920: 6169 6e2c 2065 7661 6c73 3d5b 2864 7661  ain, evals=[(dva
+00014930: 6c69 642c 2022 7661 6c69 6461 7469 6f6e  lid, "validation
+00014940: 2229 5d2c 2063 616c 6c62 6163 6b73 3d5b  ")], callbacks=[
+00014950: 7072 756e 696e 675f 6361 6c6c 6261 636b  pruning_callback
+00014960: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00014970: 2020 2070 7265 6473 203d 2062 7374 2e70     preds = bst.p
+00014980: 7265 6469 6374 2864 7661 6c69 6429 0a20  redict(dvalid). 
+00014990: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000149a0: 7265 645f 6c61 6265 6c73 203d 206e 702e  red_labels = np.
+000149b0: 7269 6e74 2870 7265 6473 290a 2020 2020  rint(preds).    
+000149c0: 2020 2020 2020 2020 2020 2020 6163 6375              accu
+000149d0: 7261 6379 203d 2061 6363 7572 6163 795f  racy = accuracy_
+000149e0: 7363 6f72 6528 7661 6c69 645f 792c 2070  score(valid_y, p
+000149f0: 7265 645f 6c61 6265 6c73 290a 2020 2020  red_labels).    
+00014a00: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00014a10: 2020 2020 2020 2020 2020 2020 2020 2346                #F
+00014a20: 524f 4d20 534b 4c45 4152 4e20 444f 4355  ROM SKLEARN DOCU
+00014a30: 4d45 4e54 4154 494f 4e3a 2046 6f72 2069  MENTATION: For i
+00014a40: 6e74 2f4e 6f6e 6520 696e 7075 7473 2c20  nt/None inputs, 
+00014a50: 6966 2074 6865 2065 7374 696d 6174 6f72  if the estimator
+00014a60: 2069 7320 6120 636c 6173 7369 6669 6572   is a classifier
+00014a70: 2061 6e64 2079 2069 7320 6569 7468 6572   and y is either
+00014a80: 2062 696e 6172 7920 6f72 206d 756c 7469   binary or multi
+00014a90: 636c 6173 732c 2053 7472 6174 6966 6965  class, Stratifie
+00014aa0: 644b 466f 6c64 2069 7320 7573 6564 2e20  dKFold is used. 
+00014ab0: 496e 2061 6c6c 206f 7468 6572 2063 6173  In all other cas
+00014ac0: 6573 2c20 466f 6c64 2069 7320 7573 6564  es, Fold is used
+00014ad0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014ae0: 2020 6376 203d 2063 726f 7373 5f76 616c    cv = cross_val
+00014af0: 6964 6174 6528 636c 662c 2073 656c 662e  idate(clf, self.
+00014b00: 6461 7461 5f78 2c20 7365 6c66 2e64 6174  data_x, self.dat
+00014b10: 615f 792c 2063 763d 7365 6c66 2e6f 7074  a_y, cv=self.opt
+00014b20: 5f63 7629 200a 2020 2020 2020 2020 2020  _cv) .          
+00014b30: 2020 2020 2020 6163 6375 7261 6379 203d        accuracy =
+00014b40: 206e 702e 6d65 616e 2863 765b 2774 6573   np.mean(cv['tes
+00014b50: 745f 7363 6f72 6527 5d29 0a0a 2020 2020  t_score'])..    
+00014b60: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+00014b70: 6363 7572 6163 790a 0a20 2020 2020 2020  ccuracy..       
+00014b80: 2070 6172 616d 735b 2762 6f6f 7374 6572   params['booster
+00014b90: 275d 203d 2074 7269 616c 2e73 7567 6765  '] = trial.sugge
+00014ba0: 7374 5f63 6174 6567 6f72 6963 616c 2827  st_categorical('
+00014bb0: 626f 6f73 7465 7227 2c20 5b27 6762 7472  booster', ['gbtr
+00014bc0: 6565 272c 2027 6461 7274 275d 290a 2020  ee', 'dart']).  
+00014bd0: 2020 2020 2020 7061 7261 6d73 5b27 6e5f        params['n_
+00014be0: 6573 7469 6d61 746f 7273 275d 203d 2074  estimators'] = t
+00014bf0: 7269 616c 2e73 7567 6765 7374 5f69 6e74  rial.suggest_int
+00014c00: 2827 6e5f 6573 7469 6d61 746f 7273 272c  ('n_estimators',
+00014c10: 2031 3030 2c20 3530 3029 0a20 2020 2020   100, 500).     
+00014c20: 2020 2070 6172 616d 735b 2772 6567 5f6c     params['reg_l
+00014c30: 616d 6264 6127 5d20 3d20 7472 6961 6c2e  ambda'] = trial.
+00014c40: 7375 6767 6573 745f 666c 6f61 7428 2772  suggest_float('r
+00014c50: 6567 5f6c 616d 6264 6127 2c20 302c 2031  eg_lambda', 0, 1
+00014c60: 3030 290a 2020 2020 2020 2020 7061 7261  00).        para
+00014c70: 6d73 5b27 7265 675f 616c 7068 6127 5d20  ms['reg_alpha'] 
+00014c80: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00014c90: 696e 7428 2772 6567 5f61 6c70 6861 272c  int('reg_alpha',
+00014ca0: 2030 2c20 3130 3029 0a20 2020 2020 2020   0, 100).       
+00014cb0: 2070 6172 616d 735b 276d 6178 5f64 6570   params['max_dep
+00014cc0: 7468 275d 203d 2074 7269 616c 2e73 7567  th'] = trial.sug
+00014cd0: 6765 7374 5f69 6e74 2827 6d61 785f 6465  gest_int('max_de
+00014ce0: 7074 6827 2c20 322c 2032 3529 0a20 2020  pth', 2, 25).   
+00014cf0: 2020 2020 2070 6172 616d 735b 2765 7461       params['eta
+00014d00: 275d 203d 2074 7269 616c 2e73 7567 6765  '] = trial.sugge
+00014d10: 7374 5f66 6c6f 6174 2827 6574 6127 2c20  st_float('eta', 
+00014d20: 3165 2d38 2c20 3129 0a20 2020 2020 2020  1e-8, 1).       
+00014d30: 2070 6172 616d 735b 2767 616d 6d61 275d   params['gamma']
+00014d40: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+00014d50: 5f69 6e74 2827 6761 6d6d 6127 2c20 312c  _int('gamma', 1,
+00014d60: 2031 3030 290a 2020 2020 2020 2020 7061   100).        pa
+00014d70: 7261 6d73 5b27 6772 6f77 5f70 6f6c 6963  rams['grow_polic
+00014d80: 7927 5d20 3d20 7472 6961 6c2e 7375 6767  y'] = trial.sugg
+00014d90: 6573 745f 6361 7465 676f 7269 6361 6c28  est_categorical(
+00014da0: 2767 726f 775f 706f 6c69 6379 272c 205b  'grow_policy', [
+00014db0: 2764 6570 7468 7769 7365 272c 2027 6c6f  'depthwise', 'lo
+00014dc0: 7373 6775 6964 6527 5d29 0a20 2020 2020  ssguide']).     
+00014dd0: 2020 2070 6172 616d 735b 276d 696e 5f63     params['min_c
+00014de0: 6869 6c64 5f77 6569 6768 7427 5d20 3d20  hild_weight'] = 
+00014df0: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
+00014e00: 7428 276d 696e 5f63 6869 6c64 5f77 6569  t('min_child_wei
+00014e10: 6768 7427 2c20 312c 2031 3030 290a 2020  ght', 1, 100).  
+00014e20: 2020 2020 2020 7061 7261 6d73 5b27 6d61        params['ma
+00014e30: 785f 6465 6c74 615f 7374 6570 275d 203d  x_delta_step'] =
+00014e40: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
+00014e50: 6e74 2827 6d61 785f 6465 6c74 615f 7374  nt('max_delta_st
+00014e60: 6570 272c 2031 2c20 3130 3029 0a20 2020  ep', 1, 100).   
+00014e70: 2020 2020 2070 6172 616d 735b 2773 7562       params['sub
+00014e80: 7361 6d70 6c65 275d 203d 2074 7269 616c  sample'] = trial
+00014e90: 2e73 7567 6765 7374 5f66 6c6f 6174 2827  .suggest_float('
+00014ea0: 7375 6273 616d 706c 6527 2c20 302e 352c  subsample', 0.5,
+00014eb0: 2031 2e30 290a 2020 2020 2020 2020 7061   1.0).        pa
+00014ec0: 7261 6d73 5b27 636f 6c73 616d 706c 655f  rams['colsample_
+00014ed0: 6279 7472 6565 275d 203d 2074 7269 616c  bytree'] = trial
+00014ee0: 2e73 7567 6765 7374 5f66 6c6f 6174 2827  .suggest_float('
+00014ef0: 636f 6c73 616d 706c 655f 6279 7472 6565  colsample_bytree
+00014f00: 272c 2030 2e35 2c20 3129 0a0a 2020 2020  ', 0.5, 1)..    
+00014f10: 2020 2020 6966 2070 6172 616d 735b 2762      if params['b
+00014f20: 6f6f 7374 6572 275d 203d 3d20 2264 6172  ooster'] == "dar
+00014f30: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
+00014f40: 7061 7261 6d73 5b27 7361 6d70 6c65 5f74  params['sample_t
+00014f50: 7970 6527 5d20 3d20 7472 6961 6c2e 7375  ype'] = trial.su
+00014f60: 6767 6573 745f 6361 7465 676f 7269 6361  ggest_categorica
+00014f70: 6c28 2773 616d 706c 655f 7479 7065 272c  l('sample_type',
+00014f80: 205b 2775 6e69 666f 726d 272c 2027 7765   ['uniform', 'we
+00014f90: 6967 6874 6564 275d 290a 2020 2020 2020  ighted']).      
+00014fa0: 2020 2020 2020 7061 7261 6d73 5b27 6e6f        params['no
+00014fb0: 726d 616c 697a 655f 7479 7065 275d 203d  rmalize_type'] =
+00014fc0: 2074 7269 616c 2e73 7567 6765 7374 5f63   trial.suggest_c
+00014fd0: 6174 6567 6f72 6963 616c 2827 6e6f 726d  ategorical('norm
+00014fe0: 616c 697a 655f 7479 7065 272c 205b 2774  alize_type', ['t
+00014ff0: 7265 6527 2c20 2766 6f72 6573 7427 5d29  ree', 'forest'])
+00015000: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00015010: 616d 735b 2772 6174 655f 6472 6f70 275d  ams['rate_drop']
+00015020: 203d 2074 7269 616c 2e73 7567 6765 7374   = trial.suggest
+00015030: 5f66 6c6f 6174 2827 7261 7465 5f64 726f  _float('rate_dro
+00015040: 7027 2c20 3165 2d38 2c20 3129 0a20 2020  p', 1e-8, 1).   
+00015050: 2020 2020 2020 2020 2070 6172 616d 735b           params[
+00015060: 2773 6b69 705f 6472 6f70 275d 203d 2074  'skip_drop'] = t
+00015070: 7269 616c 2e73 7567 6765 7374 5f66 6c6f  rial.suggest_flo
+00015080: 6174 2827 736b 6970 5f64 726f 7027 2c20  at('skip_drop', 
+00015090: 3165 2d38 2c20 3129 0a20 2020 2020 2020  1e-8, 1).       
+000150a0: 2020 2020 2069 6620 7365 6c66 2e6f 7074       if self.opt
+000150b0: 5f63 7620 3e3d 2031 3a0a 2020 2020 2020  _cv >= 1:.      
+000150c0: 2020 2020 2020 2020 2020 636c 6620 3d20            clf = 
+000150d0: 5847 4243 6c61 7373 6966 6965 7228 626f  XGBClassifier(bo
+000150e0: 6f73 7465 723d 7061 7261 6d73 5b27 626f  oster=params['bo
+000150f0: 6f73 7465 7227 5d2c 206e 5f65 7374 696d  oster'], n_estim
+00015100: 6174 6f72 733d 7061 7261 6d73 5b27 6e5f  ators=params['n_
+00015110: 6573 7469 6d61 746f 7273 275d 2c20 636f  estimators'], co
+00015120: 6c73 616d 706c 655f 6279 7472 6565 3d70  lsample_bytree=p
+00015130: 6172 616d 735b 2763 6f6c 7361 6d70 6c65  arams['colsample
+00015140: 5f62 7974 7265 6527 5d2c 200a 2020 2020  _bytree'], .    
+00015150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015160: 7265 675f 6c61 6d62 6461 3d70 6172 616d  reg_lambda=param
+00015170: 735b 2772 6567 5f6c 616d 6264 6127 5d2c  s['reg_lambda'],
+00015180: 2072 6567 5f61 6c70 6861 3d70 6172 616d   reg_alpha=param
+00015190: 735b 2772 6567 5f61 6c70 6861 275d 2c20  s['reg_alpha'], 
+000151a0: 6d61 785f 6465 7074 683d 7061 7261 6d73  max_depth=params
+000151b0: 5b27 6d61 785f 6465 7074 6827 5d2c 2065  ['max_depth'], e
+000151c0: 7461 3d70 6172 616d 735b 2765 7461 275d  ta=params['eta']
+000151d0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+000151e0: 2020 2020 2020 2067 616d 6d61 3d70 6172         gamma=par
+000151f0: 616d 735b 2767 616d 6d61 275d 2c20 6772  ams['gamma'], gr
+00015200: 6f77 5f70 6f6c 6963 793d 7061 7261 6d73  ow_policy=params
+00015210: 5b27 6772 6f77 5f70 6f6c 6963 7927 5d2c  ['grow_policy'],
+00015220: 206d 696e 5f63 6869 6c64 5f77 6569 6768   min_child_weigh
+00015230: 743d 7061 7261 6d73 5b27 6d69 6e5f 6368  t=params['min_ch
+00015240: 696c 645f 7765 6967 6874 275d 2c20 0a20  ild_weight'], . 
+00015250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015260: 2020 206d 6178 5f64 656c 7461 5f73 7465     max_delta_ste
+00015270: 703d 7061 7261 6d73 5b27 6d61 785f 6465  p=params['max_de
+00015280: 6c74 615f 7374 6570 275d 2c20 7375 6273  lta_step'], subs
+00015290: 616d 706c 653d 7061 7261 6d73 5b27 7375  ample=params['su
+000152a0: 6273 616d 706c 6527 5d2c 2073 616d 706c  bsample'], sampl
+000152b0: 655f 7479 7065 3d70 6172 616d 735b 2773  e_type=params['s
+000152c0: 616d 706c 655f 7479 7065 275d 2c20 0a20  ample_type'], . 
 000152d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152e0: 2020 6772 6f77 5f70 6f6c 6963 793d 7061    grow_policy=pa
-000152f0: 7261 6d73 5b27 6772 6f77 5f70 6f6c 6963  rams['grow_polic
-00015300: 7927 5d2c 2073 7562 7361 6d70 6c65 3d70  y'], subsample=p
-00015310: 6172 616d 735b 2773 7562 7361 6d70 6c65  arams['subsample
-00015320: 275d 2c20 7363 616c 655f 706f 735f 7765  '], scale_pos_we
-00015330: 6967 6874 3d73 616d 706c 655f 7765 6967  ight=sample_weig
-00015340: 6874 2c20 7261 6e64 6f6d 5f73 7461 7465  ht, random_state
-00015350: 3d31 3930 3929 0a20 2020 2020 2020 2065  =1909).        e
-00015360: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00015370: 2069 6620 7061 7261 6d73 5b27 626f 6f73   if params['boos
-00015380: 7465 7227 5d20 3d3d 2027 6461 7274 273a  ter'] == 'dart':
-00015390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000153a0: 206d 6f64 656c 203d 2058 4742 436c 6173   model = XGBClas
-000153b0: 7369 6669 6572 2862 6f6f 7374 6572 3d70  sifier(booster=p
-000153c0: 6172 616d 735b 2762 6f6f 7374 6572 275d  arams['booster']
-000153d0: 2c20 6e5f 6573 7469 6d61 746f 7273 3d70  , n_estimators=p
-000153e0: 6172 616d 735b 276e 5f65 7374 696d 6174  arams['n_estimat
-000153f0: 6f72 7327 5d2c 2063 6f6c 7361 6d70 6c65  ors'], colsample
-00015400: 5f62 7974 7265 653d 7061 7261 6d73 5b27  _bytree=params['
-00015410: 636f 6c73 616d 706c 655f 6279 7472 6565  colsample_bytree
-00015420: 275d 2c20 0a20 2020 2020 2020 2020 2020  '], .           
-00015430: 2020 2020 2020 2020 2072 6567 5f6c 616d           reg_lam
-00015440: 6264 613d 7061 7261 6d73 5b27 7265 675f  bda=params['reg_
-00015450: 6c61 6d62 6461 275d 2c20 7265 675f 616c  lambda'], reg_al
-00015460: 7068 613d 7061 7261 6d73 5b27 7265 675f  pha=params['reg_
-00015470: 616c 7068 6127 5d2c 206d 6178 5f64 6570  alpha'], max_dep
-00015480: 7468 3d70 6172 616d 735b 276d 6178 5f64  th=params['max_d
-00015490: 6570 7468 275d 2c20 6574 613d 7061 7261  epth'], eta=para
-000154a0: 6d73 5b27 6574 6127 5d2c 2067 616d 6d61  ms['eta'], gamma
-000154b0: 3d70 6172 616d 735b 2767 616d 6d61 275d  =params['gamma']
-000154c0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-000154d0: 2020 2020 2020 2067 726f 775f 706f 6c69         grow_poli
-000154e0: 6379 3d70 6172 616d 735b 2767 726f 775f  cy=params['grow_
-000154f0: 706f 6c69 6379 275d 2c20 7361 6d70 6c65  policy'], sample
-00015500: 5f74 7970 653d 7061 7261 6d73 5b27 7361  _type=params['sa
-00015510: 6d70 6c65 5f74 7970 6527 5d2c 206e 6f72  mple_type'], nor
-00015520: 6d61 6c69 7a65 5f74 7970 653d 7061 7261  malize_type=para
-00015530: 6d73 5b27 6e6f 726d 616c 697a 655f 7479  ms['normalize_ty
-00015540: 7065 275d 2c72 6174 655f 6472 6f70 3d70  pe'],rate_drop=p
-00015550: 6172 616d 735b 2772 6174 655f 6472 6f70  arams['rate_drop
-00015560: 275d 2c20 0a20 2020 2020 2020 2020 2020  '], .           
-00015570: 2020 2020 2020 2020 2073 6b69 705f 6472           skip_dr
-00015580: 6f70 3d70 6172 616d 735b 2773 6b69 705f  op=params['skip_
-00015590: 6472 6f70 275d 2c20 6d69 6e5f 6368 696c  drop'], min_chil
-000155a0: 645f 7765 6967 6874 3d70 6172 616d 735b  d_weight=params[
-000155b0: 276d 696e 5f63 6869 6c64 5f77 6569 6768  'min_child_weigh
-000155c0: 7427 5d2c 206d 6178 5f64 656c 7461 5f73  t'], max_delta_s
-000155d0: 7465 703d 7061 7261 6d73 5b27 6d61 785f  tep=params['max_
-000155e0: 6465 6c74 615f 7374 6570 275d 2c20 7375  delta_step'], su
-000155f0: 6273 616d 706c 653d 7061 7261 6d73 5b27  bsample=params['
-00015600: 7375 6273 616d 706c 6527 5d2c 0a20 2020  subsample'],.   
-00015610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015620: 2073 6361 6c65 5f70 6f73 5f77 6569 6768   scale_pos_weigh
-00015630: 743d 7361 6d70 6c65 5f77 6569 6768 742c  t=sample_weight,
-00015640: 2072 616e 646f 6d5f 7374 6174 653d 3139   random_state=19
-00015650: 3039 290a 2020 2020 2020 2020 2020 2020  09).            
-00015660: 656c 6966 2070 6172 616d 735b 2762 6f6f  elif params['boo
-00015670: 7374 6572 275d 203d 3d20 2767 6274 7265  ster'] == 'gbtre
-00015680: 6527 3a0a 2020 2020 2020 2020 2020 2020  e':.            
-00015690: 2020 2020 6d6f 6465 6c20 3d20 5847 4243      model = XGBC
-000156a0: 6c61 7373 6966 6965 7228 626f 6f73 7465  lassifier(booste
-000156b0: 723d 7061 7261 6d73 5b27 626f 6f73 7465  r=params['booste
-000156c0: 7227 5d2c 206e 5f65 7374 696d 6174 6f72  r'], n_estimator
-000156d0: 733d 7061 7261 6d73 5b27 6e5f 6573 7469  s=params['n_esti
-000156e0: 6d61 746f 7273 275d 2c20 636f 6c73 616d  mators'], colsam
-000156f0: 706c 655f 6279 7472 6565 3d70 6172 616d  ple_bytree=param
-00015700: 735b 2763 6f6c 7361 6d70 6c65 5f62 7974  s['colsample_byt
-00015710: 7265 6527 5d2c 200a 2020 2020 2020 2020  ree'], .        
-00015720: 2020 2020 2020 2020 2020 2020 7265 675f              reg_
-00015730: 6c61 6d62 6461 3d70 6172 616d 735b 2772  lambda=params['r
-00015740: 6567 5f6c 616d 6264 6127 5d2c 2072 6567  eg_lambda'], reg
-00015750: 5f61 6c70 6861 3d70 6172 616d 735b 2772  _alpha=params['r
-00015760: 6567 5f61 6c70 6861 275d 2c20 6d61 785f  eg_alpha'], max_
-00015770: 6465 7074 683d 7061 7261 6d73 5b27 6d61  depth=params['ma
-00015780: 785f 6465 7074 6827 5d2c 2065 7461 3d70  x_depth'], eta=p
-00015790: 6172 616d 735b 2765 7461 275d 2c20 6761  arams['eta'], ga
-000157a0: 6d6d 613d 7061 7261 6d73 5b27 6761 6d6d  mma=params['gamm
-000157b0: 6127 5d2c 200a 2020 2020 2020 2020 2020  a'], .          
-000157c0: 2020 2020 2020 2020 2020 6772 6f77 5f70            grow_p
-000157d0: 6f6c 6963 793d 7061 7261 6d73 5b27 6772  olicy=params['gr
-000157e0: 6f77 5f70 6f6c 6963 7927 5d2c 2073 7562  ow_policy'], sub
-000157f0: 7361 6d70 6c65 3d70 6172 616d 735b 2773  sample=params['s
-00015800: 7562 7361 6d70 6c65 275d 2c20 6d69 6e5f  ubsample'], min_
-00015810: 6368 696c 645f 7765 6967 6874 3d70 6172  child_weight=par
-00015820: 616d 735b 276d 696e 5f63 6869 6c64 5f77  ams['min_child_w
-00015830: 6569 6768 7427 5d2c 206d 6178 5f64 656c  eight'], max_del
-00015840: 7461 5f73 7465 703d 7061 7261 6d73 5b27  ta_step=params['
-00015850: 6d61 785f 6465 6c74 615f 7374 6570 275d  max_delta_step']
-00015860: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015870: 2020 2020 2020 7363 616c 655f 706f 735f        scale_pos_
-00015880: 7765 6967 6874 3d73 616d 706c 655f 7765  weight=sample_we
-00015890: 6967 6874 2c20 7261 6e64 6f6d 5f73 7461  ight, random_sta
-000158a0: 7465 3d31 3930 3929 0a20 2020 2020 2020  te=1909).       
-000158b0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-000158c0: 2020 206f 626a 6563 7469 7665 203d 206f     objective = o
-000158d0: 626a 6563 7469 7665 5f63 6e6e 2864 6174  bjective_cnn(dat
-000158e0: 615f 782c 2064 6174 615f 792c 2069 6d67  a_x, data_y, img
-000158f0: 5f6e 756d 5f63 6861 6e6e 656c 733d 696d  _num_channels=im
-00015900: 675f 6e75 6d5f 6368 616e 6e65 6c73 2c20  g_num_channels, 
-00015910: 6e6f 726d 616c 697a 653d 6e6f 726d 616c  normalize=normal
-00015920: 697a 652c 206d 696e 5f70 6978 656c 3d6d  ize, min_pixel=m
-00015930: 696e 5f70 6978 656c 2c20 6d61 785f 7069  in_pixel, max_pi
-00015940: 7865 6c3d 6d61 785f 7069 7865 6c2c 200a  xel=max_pixel, .
-00015950: 2020 2020 2020 2020 2020 2020 7661 6c5f              val_
-00015960: 706f 7369 7469 7665 3d76 616c 5f58 2c20  positive=val_X, 
-00015970: 7661 6c5f 6e65 6761 7469 7665 3d76 616c  val_negative=val
-00015980: 5f59 2c20 7472 6169 6e5f 6570 6f63 6873  _Y, train_epochs
-00015990: 3d74 7261 696e 5f65 706f 6368 732c 2070  =train_epochs, p
-000159a0: 6174 6965 6e63 653d 7061 7469 656e 6365  atience=patience
-000159b0: 2c20 6d65 7472 6963 3d6d 6574 7269 632c  , metric=metric,
-000159c0: 2061 7665 7261 6765 3d61 7665 7261 6765   average=average
-000159d0: 2c20 7465 7374 5f70 6f73 6974 6976 653d  , test_positive=
-000159e0: 7465 7374 5f70 6f73 6974 6976 652c 2074  test_positive, t
-000159f0: 6573 745f 6e65 6761 7469 7665 3d74 6573  est_negative=tes
-00015a00: 745f 6e65 6761 7469 7665 2c0a 2020 2020  t_negative,.    
-00015a10: 2020 2020 2020 2020 6f70 745f 6d6f 6465          opt_mode
-00015a20: 6c3d 6f70 745f 6d6f 6465 6c2c 206f 7074  l=opt_model, opt
-00015a30: 5f61 7567 3d6f 7074 5f61 7567 2c20 6261  _aug=opt_aug, ba
-00015a40: 7463 685f 6d69 6e3d 6261 7463 685f 6d69  tch_min=batch_mi
-00015a50: 6e2c 2062 6174 6368 5f6d 6178 3d62 6174  n, batch_max=bat
-00015a60: 6368 5f6d 6178 2c20 696d 6167 655f 7369  ch_max, image_si
-00015a70: 7a65 5f6d 696e 3d69 6d61 6765 5f73 697a  ze_min=image_siz
-00015a80: 655f 6d69 6e2c 2069 6d61 6765 5f73 697a  e_min, image_siz
-00015a90: 655f 6d61 783d 696d 6167 655f 7369 7a65  e_max=image_size
-00015aa0: 5f6d 6178 2c20 6261 6c61 6e63 653d 6261  _max, balance=ba
-00015ab0: 6c61 6e63 652c 200a 2020 2020 2020 2020  lance, .        
-00015ac0: 2020 2020 6f70 745f 6d61 785f 6d69 6e5f      opt_max_min_
-00015ad0: 7069 783d 6f70 745f 6d61 785f 6d69 6e5f  pix=opt_max_min_
-00015ae0: 7069 782c 206f 7074 5f6d 6178 5f6d 6178  pix, opt_max_max
-00015af0: 5f70 6978 3d6f 7074 5f6d 6178 5f6d 6178  _pix=opt_max_max
-00015b00: 5f70 6978 2c20 7368 6966 743d 7368 6966  _pix, shift=shif
-00015b10: 742c 206f 7074 5f63 763d 6f70 745f 6376  t, opt_cv=opt_cv
-00015b20: 2c20 6d61 736b 5f73 697a 653d 6d61 736b  , mask_size=mask
-00015b30: 5f73 697a 652c 206e 756d 5f6d 6173 6b73  _size, num_masks
-00015b40: 3d6e 756d 5f6d 6173 6b73 2c20 7472 6169  =num_masks, trai
-00015b50: 6e5f 6163 635f 7468 7265 7368 6f6c 643d  n_acc_threshold=
-00015b60: 7472 6169 6e5f 6163 635f 7468 7265 7368  train_acc_thresh
-00015b70: 6f6c 642c 0a20 2020 2020 2020 2020 2020  old,.           
-00015b80: 2076 6572 626f 7365 3d76 6572 626f 7365   verbose=verbose
-00015b90: 2c20 6c69 6d69 745f 7365 6172 6368 3d6c  , limit_search=l
-00015ba0: 696d 6974 5f73 6561 7263 682c 206d 6f6e  imit_search, mon
-00015bb0: 6974 6f72 313d 6d6f 6e69 746f 7231 2c20  itor1=monitor1, 
-00015bc0: 6d6f 6e69 746f 7232 3d6d 6f6e 6974 6f72  monitor2=monitor
-00015bd0: 322c 206d 6f6e 6974 6f72 315f 7468 7265  2, monitor1_thre
-00015be0: 7368 3d6d 6f6e 6974 6f72 315f 7468 7265  sh=monitor1_thre
-00015bf0: 7368 2c20 6d6f 6e69 746f 7232 5f74 6872  sh, monitor2_thr
-00015c00: 6573 683d 6d6f 6e69 746f 7232 5f74 6872  esh=monitor2_thr
-00015c10: 6573 6829 0a20 2020 2020 2020 2073 7475  esh).        stu
-00015c20: 6479 2e6f 7074 696d 697a 6528 6f62 6a65  dy.optimize(obje
-00015c30: 6374 6976 652c 206e 5f74 7269 616c 733d  ctive, n_trials=
-00015c40: 6e5f 6974 6572 2c20 7368 6f77 5f70 726f  n_iter, show_pro
-00015c50: 6772 6573 735f 6261 723d 5472 7565 2c20  gress_bar=True, 
-00015c60: 6763 5f61 6674 6572 5f74 7269 616c 3d54  gc_after_trial=T
-00015c70: 7275 6529 232c 206e 5f6a 6f62 733d 3129  rue)#, n_jobs=1)
-00015c80: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
-00015c90: 3d20 7374 7564 792e 6265 7374 5f74 7269  = study.best_tri
-00015ca0: 616c 2e70 6172 616d 730a 0a20 2020 2066  al.params..    f
-00015cb0: 696e 616c 5f73 636f 7265 203d 2073 7475  inal_score = stu
-00015cc0: 6479 2e62 6573 745f 7661 6c75 650a 0a20  dy.best_value.. 
-00015cd0: 2020 2069 6620 636c 6620 213d 2027 636e     if clf != 'cn
-00015ce0: 6e27 3a0a 2020 2020 2020 2020 6966 2069  n':.        if i
-00015cf0: 6e69 7469 616c 5f73 636f 7265 203e 2066  nitial_score > f
-00015d00: 696e 616c 5f73 636f 7265 3a0a 2020 2020  inal_score:.    
-00015d10: 2020 2020 2020 2020 7072 696e 7428 2748          print('H
-00015d20: 7970 6572 7061 7261 6d65 7465 7220 6f70  yperparameter op
-00015d30: 7469 6d69 7a61 7469 6f6e 2063 6f6d 706c  timization compl
-00015d40: 6574 6521 204f 7074 696d 616c 2070 6572  ete! Optimal per
-00015d50: 666f 726d 616e 6365 206f 6620 7b7d 2069  formance of {} i
-00015d60: 7320 4c4f 5745 5220 7468 616e 2074 6865  s LOWER than the
-00015d70: 2062 6173 6520 7065 7266 6f72 6d61 6e63   base performanc
-00015d80: 6520 6f66 207b 7d2c 2074 7279 2069 6e63  e of {}, try inc
-00015d90: 7265 6173 696e 6720 7468 6520 7661 6c75  reasing the valu
-00015da0: 6520 6f66 206e 5f69 7465 7220 616e 6420  e of n_iter and 
-00015db0: 7275 6e20 6167 6169 6e2e 272e 666f 726d  run again.'.form
-00015dc0: 6174 286e 702e 726f 756e 6428 6669 6e61  at(np.round(fina
-00015dd0: 6c5f 7363 6f72 652c 2036 292c 206e 702e  l_score, 6), np.
-00015de0: 726f 756e 6428 696e 6974 6961 6c5f 7363  round(initial_sc
-00015df0: 6f72 652c 2036 2929 290a 2020 2020 2020  ore, 6))).      
-00015e00: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00015e10: 2020 2020 7072 696e 7428 2748 7970 6572      print('Hyper
-00015e20: 7061 7261 6d65 7465 7220 6f70 7469 6d69  parameter optimi
-00015e30: 7a61 7469 6f6e 2063 6f6d 706c 6574 6521  zation complete!
-00015e40: 204f 7074 696d 616c 2070 6572 666f 726d   Optimal perform
-00015e50: 616e 6365 206f 6620 7b7d 2069 7320 4849  ance of {} is HI
-00015e60: 4748 4552 2074 6861 6e20 7468 6520 6261  GHER than the ba
-00015e70: 7365 2070 6572 666f 726d 616e 6365 206f  se performance o
-00015e80: 6620 7b7d 2e27 2e66 6f72 6d61 7428 6e70  f {}.'.format(np
-00015e90: 2e72 6f75 6e64 2866 696e 616c 5f73 636f  .round(final_sco
-00015ea0: 7265 2c20 3629 2c20 6e70 2e72 6f75 6e64  re, 6), np.round
-00015eb0: 2869 6e69 7469 616c 5f73 636f 7265 2c20  (initial_score, 
-00015ec0: 3629 2929 0a20 2020 2020 2020 2069 6620  6))).        if 
-00015ed0: 7265 7475 726e 5f73 7475 6479 3a0a 2020  return_study:.  
-00015ee0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00015ef0: 206d 6f64 656c 2c20 7061 7261 6d73 2c20   model, params, 
-00015f00: 7374 7564 790a 2020 2020 2020 2020 7265  study.        re
-00015f10: 7475 726e 206d 6f64 656c 2c20 7061 7261  turn model, para
-00015f20: 6d73 0a20 2020 2065 6c73 653a 0a20 2020  ms.    else:.   
-00015f30: 2020 2020 2070 7269 6e74 2827 4879 7065       print('Hype
-00015f40: 7270 6172 616d 6574 6572 206f 7074 696d  rparameter optim
-00015f50: 697a 6174 696f 6e20 636f 6d70 6c65 7465  ization complete
-00015f60: 2120 4f70 7469 6d61 6c20 7065 7266 6f72  ! Optimal perfor
-00015f70: 6d61 6e63 653a 207b 7d27 2e66 6f72 6d61  mance: {}'.forma
-00015f80: 7428 6e70 2e72 6f75 6e64 2866 696e 616c  t(np.round(final
-00015f90: 5f73 636f 7265 2c20 3629 2929 0a20 2020  _score, 6))).   
-00015fa0: 2020 2020 2069 6620 7265 7475 726e 5f73       if return_s
-00015fb0: 7475 6479 3a0a 2020 2020 2020 2020 2020  tudy:.          
-00015fc0: 2020 7265 7475 726e 2070 6172 616d 732c    return params,
-00015fd0: 2073 7475 6479 0a20 2020 2020 2020 2072   study.        r
-00015fe0: 6574 7572 6e20 7061 7261 6d73 0a0a 6465  eturn params..de
-00015ff0: 6620 626f 7275 7461 7368 6170 5f6f 7074  f borutashap_opt
-00016000: 2864 6174 615f 782c 2064 6174 615f 792c  (data_x, data_y,
-00016010: 2062 6f72 7574 615f 7472 6961 6c73 3d35   boruta_trials=5
-00016020: 302c 206d 6f64 656c 3d27 7266 272c 2069  0, model='rf', i
-00016030: 6d70 6f72 7461 6e63 655f 7479 7065 3d27  mportance_type='
-00016040: 6761 696e 2729 3a0a 2020 2020 2222 220a  gain'):.    """.
-00016050: 2020 2020 4170 706c 6965 7320 6120 636f      Applies a co
-00016060: 6d62 696e 6174 696f 6e20 6f66 2074 6865  mbination of the
-00016070: 2042 6f72 7574 6120 616c 676f 7269 7468   Boruta algorith
-00016080: 6d20 616e 640a 2020 2020 5368 6170 6c65  m and.    Shaple
-00016090: 7920 7661 6c75 6573 2c20 6120 6d65 7468  y values, a meth
-000160a0: 6f64 2064 6576 656c 6f70 6564 2062 7920  od developed by 
-000160b0: 456f 6768 616e 204b 6561 6e79 2028 3230  Eoghan Keany (20
-000160c0: 3230 292e 0a0a 2020 2020 5365 653a 2068  20)...    See: h
-000160d0: 7474 7073 3a2f 2f64 6f69 2e6f 7267 2f31  ttps://doi.org/1
-000160e0: 302e 3532 3831 2f7a 656e 6f64 6f2e 3432  0.5281/zenodo.42
-000160f0: 3437 3631 380a 0a20 2020 2041 7267 733a  47618..    Args:
-00016100: 0a20 2020 2020 2020 2064 6174 615f 7820  .        data_x 
-00016110: 286e 6461 7272 6179 293a 2032 4420 6172  (ndarray): 2D ar
-00016120: 7261 7920 6f66 2073 697a 6520 286e 2078  ray of size (n x
-00016130: 206d 292c 2077 6865 7265 206e 2069 7320   m), where n is 
-00016140: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-00016150: 6e75 6d62 6572 206f 6620 7361 6d70 6c65  number of sample
-00016160: 732c 2061 6e64 206d 2074 6865 206e 756d  s, and m the num
-00016170: 6265 7220 6f66 2066 6561 7475 7265 732e  ber of features.
-00016180: 0a20 2020 2020 2020 2064 6174 615f 7920  .        data_y 
-00016190: 286e 6461 7272 6179 2c20 7374 7229 3a20  (ndarray, str): 
-000161a0: 3144 2061 7272 6179 2063 6f6e 7461 696e  1D array contain
-000161b0: 696e 6720 7468 6520 636f 7272 6573 706f  ing the correspo
-000161c0: 6e69 6e67 206c 6162 656c 732e 0a20 2020  ning labels..   
-000161d0: 2020 2020 2062 6f72 7574 615f 7472 6961       boruta_tria
-000161e0: 6c73 2028 696e 7429 3a20 5468 6520 6e75  ls (int): The nu
-000161f0: 6d62 6572 206f 6620 7472 6961 6c73 2074  mber of trials t
-00016200: 6f20 7275 6e2e 2041 206c 6172 6765 7220  o run. A larger 
-00016210: 6e75 6d62 6572 2069 730a 2020 2020 2020  number is.      
-00016220: 2020 2020 2020 6265 7474 6572 2061 7320        better as 
-00016230: 7468 6520 6469 7374 7269 6275 7469 6f6e  the distribution
-00016240: 2077 696c 6c20 6265 206d 6f72 6520 726f   will be more ro
-00016250: 6275 7374 2074 6f20 7261 6e64 6f6d 2066  bust to random f
-00016260: 6c75 6374 7561 7469 6f6e 732e 200a 2020  luctuations. .  
-00016270: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
-00016280: 7473 2074 6f20 3530 2e0a 2020 2020 2020  ts to 50..      
-00016290: 2020 6d6f 6465 6c20 2873 7472 293a 2054    model (str): T
-000162a0: 6865 2065 6e73 656d 626c 6520 6d65 7468  he ensemble meth
-000162b0: 6f64 2074 6f20 7573 6520 7768 656e 2066  od to use when f
-000162c0: 6974 7469 6e67 2061 6e64 2063 616c 6375  itting and calcu
-000162d0: 6c61 7469 6e67 0a20 2020 2020 2020 2020  lating.         
-000162e0: 2020 2074 6865 2066 6561 7475 7265 2069     the feature i
-000162f0: 6d70 6f72 7461 6e63 6520 6d65 7472 6963  mportance metric
-00016300: 2e20 4f6e 6c79 2074 776f 206f 7074 696f  . Only two optio
-00016310: 6e73 2061 7265 2063 7572 7265 6e74 6c79  ns are currently
-00016320: 0a20 2020 2020 2020 2020 2020 2073 7570  .            sup
-00016330: 706f 7274 6564 2c20 2772 6627 2066 6f72  ported, 'rf' for
-00016340: 2052 616e 646f 6d20 466f 7265 7374 2061   Random Forest a
-00016350: 6e64 2027 7867 6227 2066 6f72 2045 7874  nd 'xgb' for Ext
-00016360: 7265 6d65 2047 7261 6469 656e 7420 426f  reme Gradient Bo
-00016370: 6f73 7469 6e67 2e0a 2020 2020 2020 2020  osting..        
-00016380: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
-00016390: 2772 6627 2e0a 2020 2020 2020 2020 696d  'rf'..        im
-000163a0: 706f 7274 616e 6365 5f74 7970 6520 2873  portance_type (s
-000163b0: 7472 293a 2054 6865 2066 6561 7475 7265  tr): The feature
-000163c0: 2069 6d70 6f72 7461 6e63 6520 7479 7065   importance type
-000163d0: 2074 6f20 7573 652c 206f 6e6c 7920 6170   to use, only ap
-000163e0: 706c 6963 6162 6c65 0a20 2020 2020 2020  plicable.       
-000163f0: 2020 2020 2077 6865 6e20 7573 696e 6720       when using 
-00016400: 636c 663d 2778 6762 272e 2054 6865 206f  clf='xgb'. The o
-00016410: 7074 696f 6e73 2069 6e63 6c75 6465 20e2  ptions include .
-00016420: 809c 6761 696e e280 9d2c 20e2 809c 7765  ..gain..., ...we
-00016430: 6967 6874 e280 9d2c 20e2 809c 636f 7665  ight..., ...cove
-00016440: 72e2 809d 2c0a 2020 2020 2020 2020 2020  r...,.          
-00016450: 2020 e280 9c74 6f74 616c 5f67 6169 6ee2    ...total_gain.
-00016460: 809d 206f 7220 e280 9c74 6f74 616c 5f63  .. or ...total_c
-00016470: 6f76 6572 e280 9d2e 2044 6566 6175 6c74  over.... Default
-00016480: 7320 746f 2027 6761 696e 272e 0a0a 2020  s to 'gain'...  
-00016490: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-000164a0: 2020 2046 6972 7374 206f 7574 7075 7420     First output 
-000164b0: 6973 2061 2031 4420 6172 7261 7920 636f  is a 1D array co
-000164c0: 6e74 6169 6e69 6e67 2074 6865 2069 6e64  ntaining the ind
-000164d0: 6963 6573 206f 6620 7468 6520 7365 6c65  ices of the sele
-000164e0: 6374 6564 2066 6561 7475 7265 732e 200a  cted features. .
-000164f0: 2020 2020 2020 2020 5468 6573 6520 696e          These in
-00016500: 6469 6365 7320 6361 6e20 7468 656e 2062  dices can then b
-00016510: 6520 7573 6564 2074 6f20 7365 6c65 6374  e used to select
-00016520: 2074 6865 2063 6f6c 756d 6e73 2069 6e20   the columns in 
-00016530: 7468 6520 6461 7461 5f78 2061 7272 6179  the data_x array
-00016540: 2e0a 2020 2020 2020 2020 5365 636f 6e64  ..        Second
-00016550: 206f 7574 7075 7420 6973 2074 6865 2066   output is the f
-00016560: 6561 7475 7265 2073 656c 6563 7469 6f6e  eature selection
-00016570: 206f 626a 6563 742c 2077 6869 6368 2063   object, which c
-00016580: 6f6e 7461 696e 7320 6665 6174 7572 6520  ontains feature 
-00016590: 7365 6c65 6374 696f 6e0a 2020 2020 2020  selection.      
-000165a0: 2020 6869 7374 6f72 7920 696e 666f 726d    history inform
-000165b0: 6174 696f 6e20 616e 6420 7669 7375 616c  ation and visual
-000165c0: 697a 6174 696f 6e20 6f70 7469 6f6e 732e  ization options.
-000165d0: 0a20 2020 2022 2222 0a20 2020 200a 2020  .    """.    .  
-000165e0: 2020 6966 2062 6f72 7574 615f 7472 6961    if boruta_tria
-000165f0: 6c73 203d 3d20 303a 2023 5468 6973 2069  ls == 0: #This i
-00016600: 7320 7468 6520 666c 6167 2074 6861 7420  s the flag that 
-00016610: 7468 6520 656e 7365 6d62 6c65 5f6d 6f64  the ensemble_mod
-00016620: 656c 2e43 6c61 7373 6966 6965 7220 636c  el.Classifier cl
-00016630: 6173 7320 7573 6573 2074 6f20 6469 7361  ass uses to disa
-00016640: 626c 6520 6665 6174 7572 6520 7365 6c65  ble feature sele
-00016650: 6374 696f 6e0a 2020 2020 2020 2020 7265  ction.        re
-00016660: 7475 726e 206e 702e 6172 616e 6765 2864  turn np.arange(d
-00016670: 6174 615f 782e 7368 6170 655b 315d 292c  ata_x.shape[1]),
-00016680: 204e 6f6e 650a 0a20 2020 2069 6620 626f   None..    if bo
-00016690: 7275 7461 5f74 7269 616c 7320 3c20 3230  ruta_trials < 20
-000166a0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-000166b0: 2757 4152 4e49 4e47 3a20 5265 7375 6c74  'WARNING: Result
-000166c0: 7320 6172 6520 756e 7374 6162 6c65 2069  s are unstable i
-000166d0: 6620 626f 7275 7461 5f74 7269 616c 7320  f boruta_trials 
-000166e0: 6973 2074 6f6f 206c 6f77 2127 290a 2020  is too low!').  
-000166f0: 2020 6966 206e 702e 616e 7928 6e70 2e69    if np.any(np.i
-00016700: 736e 616e 2864 6174 615f 7829 293a 0a20  snan(data_x)):. 
-00016710: 2020 2020 2020 2023 7072 696e 7428 274e         #print('N
-00016720: 614e 2076 616c 7565 7320 6465 7465 6374  aN values detect
-00016730: 6564 2c20 6170 706c 7969 6e67 2053 7472  ed, applying Str
-00016740: 6177 6d61 6e20 696d 7075 7461 7469 6f6e  awman imputation
-00016750: 2e2e 2e27 290a 2020 2020 2020 2020 6461  ...').        da
-00016760: 7461 5f78 203d 2053 7472 6177 6d61 6e5f  ta_x = Strawman_
-00016770: 696d 7075 7461 7469 6f6e 2864 6174 615f  imputation(data_
-00016780: 7829 0a0a 2020 2020 6966 206d 6f64 656c  x)..    if model
-00016790: 203d 3d20 2772 6627 3a0a 2020 2020 2020   == 'rf':.      
-000167a0: 2020 636c 6173 7369 6669 6572 203d 2052    classifier = R
-000167b0: 616e 646f 6d46 6f72 6573 7443 6c61 7373  andomForestClass
-000167c0: 6966 6965 7228 7261 6e64 6f6d 5f73 7461  ifier(random_sta
-000167d0: 7465 3d31 3930 3929 0a20 2020 2065 6c69  te=1909).    eli
-000167e0: 6620 6d6f 6465 6c20 3d3d 2027 7867 6227  f model == 'xgb'
-000167f0: 3a0a 2020 2020 2020 2020 636c 6173 7369  :.        classi
-00016800: 6669 6572 203d 2058 4742 436c 6173 7369  fier = XGBClassi
-00016810: 6669 6572 2874 7265 655f 6d65 7468 6f64  fier(tree_method
-00016820: 3d27 6578 6163 7427 2c20 6d61 785f 6465  ='exact', max_de
-00016830: 7074 683d 3230 2c20 696d 706f 7274 616e  pth=20, importan
-00016840: 6365 5f74 7970 653d 696d 706f 7274 616e  ce_type=importan
-00016850: 6365 5f74 7970 652c 2072 616e 646f 6d5f  ce_type, random_
-00016860: 7374 6174 653d 3139 3039 290a 2020 2020  state=1909).    
-00016870: 656c 7365 3a0a 2020 2020 2020 2020 7261  else:.        ra
-00016880: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
-00016890: 4d6f 6465 6c20 6172 6775 6d65 6e74 206d  Model argument m
-000168a0: 7573 7420 6569 7468 6572 2062 6520 2272  ust either be "r
-000168b0: 6622 206f 7220 2278 6762 222e 2729 0a20  f" or "xgb".'). 
-000168c0: 2020 200a 2020 2020 7472 793a 0a20 2020     .    try:.   
-000168d0: 2020 2020 2023 426f 7275 7461 5368 6170       #BorutaShap
-000168e0: 2070 726f 6772 616d 2072 6571 7569 7265   program require
-000168f0: 7320 696e 7075 7420 746f 2068 6176 6520  s input to have 
-00016900: 7468 6520 636f 6c75 6d6e 7320 6174 7472  the columns attr
-00016910: 6962 7574 650a 2020 2020 2020 2020 2343  ibute.        #C
-00016920: 6f6e 7665 7274 696e 6720 746f 2050 616e  onverting to Pan
-00016930: 6461 7320 6461 7461 6672 616d 650a 2020  das dataframe.  
-00016940: 2020 2020 2020 636f 6c73 203d 205b 7374        cols = [st
-00016950: 7228 6929 2066 6f72 2069 2069 6e20 6e70  r(i) for i in np
-00016960: 2e61 7261 6e67 6528 6461 7461 5f78 2e73  .arange(data_x.s
-00016970: 6861 7065 5b31 5d29 5d0a 2020 2020 2020  hape[1])].      
-00016980: 2020 5820 3d20 4461 7461 4672 616d 6528    X = DataFrame(
-00016990: 6461 7461 5f78 2c20 636f 6c75 6d6e 733d  data_x, columns=
-000169a0: 636f 6c73 290a 2020 2020 2020 2020 7920  cols).        y 
-000169b0: 3d20 6e70 2e7a 6572 6f73 286c 656e 2864  = np.zeros(len(d
-000169c0: 6174 615f 7929 290a 0a20 2020 2020 2020  ata_y))..       
-000169d0: 2023 4265 6c6f 7720 6973 2074 6f20 636f   #Below is to co
-000169e0: 6e76 6572 7420 6361 7465 676f 7269 6361  nvert categorica
-000169f0: 6c20 6c61 6265 6c73 2074 6f20 6e75 6d65  l labels to nume
-00016a00: 7269 6361 6c2c 2061 7320 7065 7220 426f  rical, as per Bo
-00016a10: 7275 7461 5368 6170 2072 6571 7569 7265  rutaShap require
-00016a20: 6d65 6e74 730a 2020 2020 2020 2020 666f  ments.        fo
-00016a30: 7220 692c 206c 6162 656c 2069 6e20 656e  r i, label in en
-00016a40: 756d 6572 6174 6528 6e70 2e75 6e69 7175  umerate(np.uniqu
-00016a50: 6528 6461 7461 5f79 2929 3a0a 2020 2020  e(data_y)):.    
-00016a60: 2020 2020 2020 2020 6d61 736b 203d 206e          mask = n
-00016a70: 702e 7768 6572 6528 6461 7461 5f79 203d  p.where(data_y =
-00016a80: 3d20 6c61 6265 6c29 5b30 5d0a 2020 2020  = label)[0].    
-00016a90: 2020 2020 2020 2020 795b 6d61 736b 5d20          y[mask] 
-00016aa0: 3d20 690a 0a20 2020 2020 2020 2066 6561  = i..        fea
-00016ab0: 745f 7365 6c65 6374 6f72 203d 2042 6f72  t_selector = Bor
-00016ac0: 7574 6153 6861 7028 6d6f 6465 6c3d 636c  utaShap(model=cl
-00016ad0: 6173 7369 6669 6572 2c20 696d 706f 7274  assifier, import
-00016ae0: 616e 6365 5f6d 6561 7375 7265 3d27 7368  ance_measure='sh
-00016af0: 6170 272c 2063 6c61 7373 6966 6963 6174  ap', classificat
-00016b00: 696f 6e3d 5472 7565 290a 2020 2020 2020  ion=True).      
-00016b10: 2020 7072 696e 7428 2752 756e 6e69 6e67    print('Running
-00016b20: 2066 6561 7475 7265 2073 656c 6563 7469   feature selecti
-00016b30: 6f6e 2e2e 2e27 290a 2020 2020 2020 2020  on...').        
-00016b40: 6665 6174 5f73 656c 6563 746f 722e 6669  feat_selector.fi
-00016b50: 7428 583d 582c 2079 3d79 2c20 6e5f 7472  t(X=X, y=y, n_tr
-00016b60: 6961 6c73 3d62 6f72 7574 615f 7472 6961  ials=boruta_tria
-00016b70: 6c73 2c20 7665 7262 6f73 653d 4661 6c73  ls, verbose=Fals
-00016b80: 652c 2072 616e 646f 6d5f 7374 6174 653d  e, random_state=
-00016b90: 3139 3039 290a 0a20 2020 2020 2020 2069  1909)..        i
-00016ba0: 6e64 6578 203d 206e 702e 6172 7261 7928  ndex = np.array(
-00016bb0: 5b69 6e74 2866 6561 7429 2066 6f72 2066  [int(feat) for f
-00016bc0: 6561 7420 696e 2066 6561 745f 7365 6c65  eat in feat_sele
-00016bd0: 6374 6f72 2e61 6363 6570 7465 645d 290a  ctor.accepted]).
-00016be0: 2020 2020 2020 2020 696e 6465 782e 736f          index.so
-00016bf0: 7274 2829 0a20 2020 2020 2020 2070 7269  rt().        pri
-00016c00: 6e74 2827 4665 6174 7572 6520 7365 6c65  nt('Feature sele
-00016c10: 6374 696f 6e20 636f 6d70 6c65 7465 2c20  ction complete, 
-00016c20: 7b7d 2073 656c 6563 7465 6420 6f75 7420  {} selected out 
-00016c30: 6f66 207b 7d21 272e 666f 726d 6174 286c  of {}!'.format(l
-00016c40: 656e 2869 6e64 6578 292c 2064 6174 615f  en(index), data_
-00016c50: 782e 7368 6170 655b 315d 2929 0a20 2020  x.shape[1])).   
-00016c60: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-00016c70: 2070 7269 6e74 2827 426f 7275 7461 2077   print('Boruta w
-00016c80: 6974 6820 5368 6170 6c65 7920 7661 6c75  ith Shapley valu
-00016c90: 6573 2066 6169 6c65 642c 2073 7769 7463  es failed, switc
-00016ca0: 6869 6e67 2074 6f20 6f72 6967 696e 616c  hing to original
-00016cb0: 2042 6f72 7574 612e 2e2e 2729 0a20 2020   Boruta...').   
-00016cc0: 2020 2020 2069 6e64 6578 203d 2062 6f72       index = bor
-00016cd0: 7574 615f 6f70 7428 6461 7461 5f78 2c20  uta_opt(data_x, 
-00016ce0: 6461 7461 5f79 290a 0a20 2020 2072 6574  data_y)..    ret
-00016cf0: 7572 6e20 696e 6465 782c 2066 6561 745f  urn index, feat_
-00016d00: 7365 6c65 6374 6f72 0a0a 6465 6620 626f  selector..def bo
-00016d10: 7275 7461 5f6f 7074 2864 6174 615f 782c  ruta_opt(data_x,
-00016d20: 2064 6174 615f 7929 3a0a 2020 2020 2222   data_y):.    ""
-00016d30: 220a 2020 2020 4170 706c 6965 7320 7468  ".    Applies th
-00016d40: 6520 426f 7275 7461 2061 6c67 6f72 6974  e Boruta algorit
-00016d50: 686d 2028 4b75 7273 6120 2620 5275 646e  hm (Kursa & Rudn
-00016d60: 6963 6b69 2032 3031 3129 2074 6f20 6964  icki 2011) to id
-00016d70: 656e 7469 6679 2066 6561 7475 7265 730a  entify features.
-00016d80: 2020 2020 7468 6174 2070 6572 666f 726d      that perform
-00016d90: 2077 6f72 7365 2074 6861 6e20 7261 6e64   worse than rand
-00016da0: 6f6d 2e0a 0a20 2020 2053 6565 3a20 6874  om...    See: ht
-00016db0: 7470 733a 2f2f 6172 7869 762e 6f72 672f  tps://arxiv.org/
-00016dc0: 7064 662f 3131 3036 2e35 3131 322e 7064  pdf/1106.5112.pd
-00016dd0: 660a 0a20 2020 2041 7267 733a 0a20 2020  f..    Args:.   
-00016de0: 2020 2020 2064 6174 615f 7820 286e 6461       data_x (nda
-00016df0: 7272 6179 293a 2032 4420 6172 7261 7920  rray): 2D array 
-00016e00: 6f66 2073 697a 6520 286e 2078 206d 292c  of size (n x m),
-00016e10: 2077 6865 7265 206e 2069 7320 7468 650a   where n is the.
-00016e20: 2020 2020 2020 2020 2020 2020 6e75 6d62              numb
-00016e30: 6572 206f 6620 7361 6d70 6c65 732c 2061  er of samples, a
-00016e40: 6e64 206d 2074 6865 206e 756d 6265 7220  nd m the number 
-00016e50: 6f66 2066 6561 7475 7265 732e 0a20 2020  of features..   
-00016e60: 2020 2020 2064 6174 615f 7920 286e 6461       data_y (nda
-00016e70: 7272 6179 2c20 7374 7229 3a20 3144 2061  rray, str): 1D a
-00016e80: 7272 6179 2063 6f6e 7461 696e 696e 6720  rray containing 
-00016e90: 7468 6520 636f 7272 6573 706f 6e69 6e67  the corresponing
-00016ea0: 206c 6162 656c 732e 0a20 2020 2020 2020   labels..       
-00016eb0: 2020 2020 200a 2020 2020 5265 7475 726e       .    Return
-00016ec0: 733a 0a20 2020 2020 2020 2031 4420 6172  s:.        1D ar
-00016ed0: 7261 7920 636f 6e74 6169 6e69 6e67 2074  ray containing t
-00016ee0: 6865 2069 6e64 6963 6573 206f 6620 7468  he indices of th
-00016ef0: 6520 7365 6c65 6374 6564 2066 6561 7475  e selected featu
-00016f00: 7265 732e 2054 6869 7320 6361 6e20 7468  res. This can th
-00016f10: 656e 0a20 2020 2020 2020 2062 6520 7573  en.        be us
-00016f20: 6564 2074 6f20 696e 6465 7820 7468 6520  ed to index the 
-00016f30: 636f 6c75 6d6e 7320 696e 2074 6865 2064  columns in the d
-00016f40: 6174 615f 7820 6172 7261 792e 0a20 2020  ata_x array..   
-00016f50: 2022 2222 0a0a 2020 2020 636c 6173 7369   """..    classi
-00016f60: 6669 6572 203d 2052 616e 646f 6d46 6f72  fier = RandomFor
-00016f70: 6573 7443 6c61 7373 6966 6965 7228 7261  estClassifier(ra
-00016f80: 6e64 6f6d 5f73 7461 7465 3d31 3930 3929  ndom_state=1909)
-00016f90: 0a0a 2020 2020 6665 6174 5f73 656c 6563  ..    feat_selec
-00016fa0: 746f 7220 3d20 426f 7275 7461 5079 2863  tor = BorutaPy(c
-00016fb0: 6c61 7373 6966 6965 722c 206e 5f65 7374  lassifier, n_est
-00016fc0: 696d 6174 6f72 733d 2761 7574 6f27 2c20  imators='auto', 
-00016fd0: 7261 6e64 6f6d 5f73 7461 7465 3d31 3930  random_state=190
-00016fe0: 3929 0a20 2020 2070 7269 6e74 2827 5275  9).    print('Ru
-00016ff0: 6e6e 696e 6720 6665 6174 7572 6520 7365  nning feature se
-00017000: 6c65 6374 696f 6e2e 2e2e 2729 0a20 2020  lection...').   
-00017010: 2066 6561 745f 7365 6c65 6374 6f72 2e66   feat_selector.f
-00017020: 6974 2864 6174 615f 782c 2064 6174 615f  it(data_x, data_
-00017030: 7929 0a0a 2020 2020 6665 6174 7320 3d20  y)..    feats = 
-00017040: 6e70 2e61 7272 6179 285b 7374 7228 6665  np.array([str(fe
-00017050: 6174 2920 666f 7220 6665 6174 2069 6e20  at) for feat in 
-00017060: 6665 6174 5f73 656c 6563 746f 722e 7375  feat_selector.su
-00017070: 7070 6f72 745f 5d29 0a20 2020 2069 6e64  pport_]).    ind
-00017080: 6578 203d 206e 702e 7768 6572 6528 6665  ex = np.where(fe
-00017090: 6174 7320 3d3d 2027 5472 7565 2729 5b30  ats == 'True')[0
-000170a0: 5d0a 2020 2020 7072 696e 7428 2746 6561  ].    print('Fea
-000170b0: 7475 7265 2073 656c 6563 7469 6f6e 2063  ture selection c
-000170c0: 6f6d 706c 6574 652c 207b 7d20 7365 6c65  omplete, {} sele
-000170d0: 6374 6564 206f 7574 206f 6620 7b7d 2127  cted out of {}!'
-000170e0: 2e66 6f72 6d61 7428 6c65 6e28 696e 6465  .format(len(inde
-000170f0: 7829 2c6c 656e 2866 6561 745f 7365 6c65  x),len(feat_sele
-00017100: 6374 6f72 2e73 7570 706f 7274 2929 290a  ctor.support))).
-00017110: 2020 2020 7265 7475 726e 2069 6e64 6578      return index
-00017120: 0a0a 6465 6620 5374 7261 776d 616e 5f69  ..def Strawman_i
-00017130: 6d70 7574 6174 696f 6e28 6461 7461 293a  mputation(data):
-00017140: 0a20 2020 2022 2222 0a20 2020 2050 6572  .    """.    Per
-00017150: 666f 726d 2053 7472 6177 6d61 6e20 696d  form Strawman im
-00017160: 7075 7461 7469 6f6e 2c20 6120 7469 6d65  putation, a time
-00017170: 2d65 6666 6963 6965 6e74 2061 6c67 6f72  -efficient algor
-00017180: 6974 686d 0a20 2020 2069 6e20 7768 6963  ithm.    in whic
-00017190: 6820 6d69 7373 696e 6720 6461 7461 2076  h missing data v
-000171a0: 616c 7565 7320 6172 6520 7265 706c 6163  alues are replac
-000171b0: 6564 2077 6974 6820 7468 6520 6d65 6469  ed with the medi
-000171c0: 616e 0a20 2020 2076 616c 7565 206f 6620  an.    value of 
-000171d0: 7468 6520 656e 7469 7265 2c20 6e6f 6e2d  the entire, non-
-000171e0: 4e61 4e20 7361 6d70 6c65 2e20 4966 2074  NaN sample. If t
-000171f0: 6865 2064 6174 6120 6973 2061 2068 6f74  he data is a hot
-00017200: 2d65 6e63 6f64 6564 0a20 2020 2062 6f6f  -encoded.    boo
-00017210: 6c65 616e 2028 6173 2074 6865 2052 4620  lean (as the RF 
-00017220: 646f 6573 206e 6f74 2061 6c6c 6f77 2054  does not allow T
-00017230: 7275 6520 6f72 2046 616c 7365 292c 2074  rue or False), t
-00017240: 6865 6e20 7468 6520 0a20 2020 2069 6e73  hen the .    ins
-00017250: 7461 6e63 6520 7468 6174 2069 7320 7573  tance that is us
-00017260: 6564 2074 6865 206d 6f73 7420 7769 6c6c  ed the most will
-00017270: 2062 6520 636f 6d70 7574 6564 2061 7320   be computed as 
-00017280: 7468 6520 6d65 6469 616e 2e20 0a0a 2020  the median. ..  
-00017290: 2020 5468 6973 2069 7320 7468 6520 6261    This is the ba
-000172a0: 7365 6c69 6e65 2061 6c67 6f72 6974 686d  seline algorithm
-000172b0: 2075 7365 6420 6279 2028 5461 6e67 2026   used by (Tang &
-000172c0: 2049 7368 7761 7261 6e20 3230 3137 292e   Ishwaran 2017).
-000172d0: 0a20 2020 2053 6565 3a20 6874 7470 733a  .    See: https:
-000172e0: 2f2f 6172 7869 762e 6f72 672f 7064 662f  //arxiv.org/pdf/
-000172f0: 3137 3031 2e30 3533 3035 2e70 6466 0a0a  1701.05305.pdf..
-00017300: 2020 2020 4e6f 7465 3a0a 2020 2020 2020      Note:.      
-00017310: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
-00017320: 6173 7375 6d65 7320 6561 6368 2072 6f77  assumes each row
-00017330: 2063 6f72 7265 7370 6f6e 6473 2074 6f20   corresponds to 
-00017340: 6f6e 6520 7361 6d70 6c65 2c20 616e 6420  one sample, and 
-00017350: 0a20 2020 2020 2020 2074 6861 7420 6d69  .        that mi
-00017360: 7373 696e 6720 7661 6c75 6573 2061 7265  ssing values are
-00017370: 206d 6173 6b65 6420 6173 2065 6974 6865   masked as eithe
-00017380: 7220 4e61 4e20 6f72 2069 6e66 2e20 0a0a  r NaN or inf. ..
-00017390: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-000173a0: 2020 6461 7461 2028 6e64 6172 7261 7929    data (ndarray)
-000173b0: 3a20 3144 2061 7272 6179 2069 6620 7369  : 1D array if si
-000173c0: 6e67 6c65 2070 6172 616d 6574 6572 2069  ngle parameter i
-000173d0: 7320 696e 7075 742e 2049 660a 2020 2020  s input. If.    
-000173e0: 2020 2020 2020 2020 6461 7461 2069 7320          data is 
-000173f0: 322d 6469 6d65 6e73 696f 6e61 6c2c 2074  2-dimensional, t
-00017400: 6865 206d 6564 6961 6e73 2077 696c 6c20  he medians will 
-00017410: 6265 2063 616c 6375 6c61 7465 640a 2020  be calculated.  
-00017420: 2020 2020 2020 2020 2020 7573 696e 6720            using 
-00017430: 7468 6520 6e6f 6e2d 6d69 7373 696e 6720  the non-missing 
-00017440: 7661 6c75 6573 2069 6e20 6561 6368 2063  values in each c
-00017450: 6f72 7265 7370 6f6e 6469 6e67 2063 6f6c  orresponding col
-00017460: 756d 6e2e 0a0a 2020 2020 5265 7475 726e  umn...    Return
-00017470: 733a 0a20 2020 2020 2020 2054 6865 2064  s:.        The d
-00017480: 6174 6120 6172 7261 7920 7769 7468 2074  ata array with t
-00017490: 6865 206d 6973 7369 6e67 2076 616c 7565  he missing value
-000174a0: 7320 6669 6c6c 6564 2069 6e2e 200a 2020  s filled in. .  
-000174b0: 2020 2222 220a 0a20 2020 2069 6620 6e70    """..    if np
-000174c0: 2e61 6c6c 286e 702e 6973 6669 6e69 7465  .all(np.isfinite
-000174d0: 2864 6174 6129 293a 0a20 2020 2020 2020  (data)):.       
-000174e0: 2070 7269 6e74 2827 4e6f 206d 6973 7369   print('No missi
-000174f0: 6e67 2076 616c 7565 7320 696e 2064 6174  ng values in dat
-00017500: 612c 2072 6574 7572 6e69 6e67 206f 7269  a, returning ori
-00017510: 6769 6e61 6c20 6172 7261 792e 2729 0a20  ginal array.'). 
-00017520: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
-00017530: 7461 200a 0a20 2020 2069 6620 6c65 6e28  ta ..    if len(
-00017540: 6461 7461 2e73 6861 7065 2920 3d3d 2031  data.shape) == 1
-00017550: 3a0a 2020 2020 2020 2020 6d61 736b 203d  :.        mask =
-00017560: 206e 702e 7768 6572 6528 6e70 2e69 7366   np.where(np.isf
-00017570: 696e 6974 6528 6461 7461 2929 5b30 5d0a  inite(data))[0].
-00017580: 2020 2020 2020 2020 6d65 6469 616e 203d          median =
-00017590: 206e 702e 6d65 6469 616e 2864 6174 615b   np.median(data[
-000175a0: 6d61 736b 5d29 0a20 2020 2020 2020 2064  mask]).        d
-000175b0: 6174 615b 6e70 2e69 736e 616e 2864 6174  ata[np.isnan(dat
-000175c0: 6129 5d20 3d20 6d65 6469 616e 200a 0a20  a)] = median .. 
-000175d0: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
-000175e0: 7461 0a0a 2020 2020 4e79 2c20 4e78 203d  ta..    Ny, Nx =
-000175f0: 2064 6174 612e 7368 6170 650a 2020 2020   data.shape.    
-00017600: 696d 7075 7465 645f 6461 7461 203d 206e  imputed_data = n
-00017610: 702e 7a65 726f 7328 284e 792c 4e78 2929  p.zeros((Ny,Nx))
-00017620: 0a0a 2020 2020 666f 7220 6920 696e 2072  ..    for i in r
-00017630: 616e 6765 284e 7829 3a0a 2020 2020 2020  ange(Nx):.      
-00017640: 2020 6d61 736b 203d 206e 702e 7768 6572    mask = np.wher
-00017650: 6528 6e70 2e69 7366 696e 6974 6528 6461  e(np.isfinite(da
-00017660: 7461 5b3a 2c69 5d29 295b 305d 0a20 2020  ta[:,i]))[0].   
-00017670: 2020 2020 206d 6564 6961 6e20 3d20 6e70       median = np
-00017680: 2e6d 6564 6961 6e28 6461 7461 5b3a 2c69  .median(data[:,i
-00017690: 5d5b 6d61 736b 5d29 0a0a 2020 2020 2020  ][mask])..      
-000176a0: 2020 666f 7220 6a20 696e 2072 616e 6765    for j in range
-000176b0: 284e 7929 3a0a 2020 2020 2020 2020 2020  (Ny):.          
-000176c0: 2020 6966 206e 702e 6973 6e61 6e28 6461    if np.isnan(da
-000176d0: 7461 5b6a 2c69 5d29 203d 3d20 5472 7565  ta[j,i]) == True
-000176e0: 206f 7220 6e70 2e69 7369 6e66 2864 6174   or np.isinf(dat
-000176f0: 615b 6a2c 695d 2920 3d3d 2054 7275 653a  a[j,i]) == True:
-00017700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017710: 2069 6d70 7574 6564 5f64 6174 615b 6a2c   imputed_data[j,
-00017720: 695d 203d 206d 6564 6961 6e0a 2020 2020  i] = median.    
-00017730: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00017740: 2020 2020 2020 2020 2020 2020 2020 696d                im
-00017750: 7075 7465 645f 6461 7461 5b6a 2c69 5d20  puted_data[j,i] 
-00017760: 3d20 6461 7461 5b6a 2c69 5d0a 0a20 2020  = data[j,i]..   
-00017770: 2072 6574 7572 6e20 696d 7075 7465 645f   return imputed_
-00017780: 6461 7461 200a 0a64 6566 204b 4e4e 5f69  data ..def KNN_i
-00017790: 6d70 7574 6174 696f 6e28 6461 7461 2c20  mputation(data, 
-000177a0: 696d 7075 7465 723d 4e6f 6e65 2c20 6b3d  imputer=None, k=
-000177b0: 3329 3a0a 2020 2020 2222 220a 2020 2020  3):.    """.    
-000177c0: 5065 7266 6f72 6d73 206b 2d4e 6561 7265  Performs k-Neare
-000177d0: 7374 204e 6569 6768 626f 7220 696d 7075  st Neighbor impu
-000177e0: 7461 7469 6f6e 2061 6e64 2074 7261 6e73  tation and trans
-000177f0: 666f 726d 6174 696f 6e2e 0a20 2020 2042  formation..    B
-00017800: 7920 6465 6661 756c 7420 7468 6520 696d  y default the im
-00017810: 7075 7465 7220 7769 6c6c 2062 6520 6372  puter will be cr
-00017820: 6561 7465 6420 616e 6420 7265 7475 726e  eated and return
-00017830: 6564 2c20 756e 6c65 7373 0a20 2020 2074  ed, unless.    t
-00017840: 6865 2069 6d70 7574 6572 2061 7267 756d  he imputer argum
-00017850: 656e 7420 6973 2073 6574 2c20 696e 2077  ent is set, in w
-00017860: 6869 6368 2063 6173 6520 6f6e 6c79 2074  hich case only t
-00017870: 6865 2074 7261 6e73 666f 726d 6564 0a20  he transformed. 
-00017880: 2020 2064 6174 6120 6973 206f 7574 7075     data is outpu
-00017890: 742e 200a 0a20 2020 2041 7320 7468 6973  t. ..    As this
-000178a0: 2062 756e 646c 6573 206e 6569 6768 626f   bundles neighbo
-000178b0: 7273 2061 6363 6f72 6469 6e67 2074 6f20  rs according to 
-000178c0: 7468 6569 7220 6575 636c 6564 6961 6e20  their eucledian 
-000178d0: 6469 7374 616e 6365 2c0a 2020 2020 6974  distance,.    it
-000178e0: 2069 7320 7365 6e73 6974 6976 6520 746f   is sensitive to
-000178f0: 206f 7574 6c69 6572 732e 2043 616e 2061   outliers. Can a
-00017900: 6c73 6f20 7969 656c 6420 7765 616b 2070  lso yield weak p
-00017910: 7265 6469 6374 696f 6e73 2069 6620 7468  redictions if th
-00017920: 650a 2020 2020 7472 6169 6e69 6e67 2066  e.    training f
-00017930: 6561 7475 7265 7320 6172 6520 6865 6176  eatures are heav
-00017940: 696c 6979 2063 6f72 7265 6c61 7465 642e  iliy correlated.
-00017950: 0a20 2020 200a 2020 2020 4172 6773 3a0a  .    .    Args:.
-00017960: 2020 2020 2020 2020 696d 7075 7465 7220          imputer 
-00017970: 286f 7074 696f 6e61 6c29 3a20 4120 4b4e  (optional): A KN
-00017980: 4e49 6d70 7574 6572 2063 6c61 7373 2069  NImputer class i
-00017990: 6e73 7461 6e63 652c 2063 6f6e 6669 6775  nstance, configu
-000179a0: 7265 6420 7573 696e 6720 736b 6c65 6172  red using sklear
-000179b0: 6e2e 696d 7075 7465 2e4b 4e4e 496d 7075  n.impute.KNNImpu
-000179c0: 7465 722e 0a20 2020 2020 2020 2020 2020  ter..           
-000179d0: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
-000179e0: 652c 2069 6e20 7768 6963 6820 6361 7365  e, in which case
-000179f0: 2074 6865 2074 7261 6e73 666f 726d 6174   the transformat
-00017a00: 696f 6e20 6973 2063 7265 6174 6564 2075  ion is created u
-00017a10: 7369 6e67 0a20 2020 2020 2020 2020 2020  sing.           
-00017a20: 2074 6865 2064 6174 6120 6974 7365 6c66   the data itself
-00017a30: 2e20 0a20 2020 2020 2020 2064 6174 6120  . .        data 
-00017a40: 286e 6461 7272 6179 293a 2031 4420 6172  (ndarray): 1D ar
-00017a50: 7261 7920 6966 2073 696e 676c 6520 7061  ray if single pa
-00017a60: 7261 6d65 7465 7220 6973 2069 6e70 7574  rameter is input
-00017a70: 2e20 4966 0a20 2020 2020 2020 2020 2020  . If.           
-00017a80: 2064 6174 6120 6973 2032 2d64 696d 656e   data is 2-dimen
-00017a90: 7369 6f6e 616c 2c20 7468 6520 6d65 6469  sional, the medi
-00017aa0: 616e 7320 7769 6c6c 2062 6520 6361 6c63  ans will be calc
-00017ab0: 756c 6174 6564 0a20 2020 2020 2020 2020  ulated.         
-00017ac0: 2020 2075 7369 6e67 2074 6865 206e 6f6e     using the non
-00017ad0: 2d6d 6973 7369 6e67 2076 616c 7565 7320  -missing values 
-00017ae0: 696e 2065 6163 6820 636f 7272 6573 706f  in each correspo
-00017af0: 6e64 696e 6720 636f 6c75 6d6e 2e0a 2020  nding column..  
-00017b00: 2020 2020 2020 6b20 2869 6e74 2c20 6f70        k (int, op
-00017b10: 7469 6f6e 616c 293a 2049 6620 696d 7075  tional): If impu
-00017b20: 7465 7220 6973 204e 6f6e 652c 2074 6869  ter is None, thi
-00017b30: 7320 6973 2074 6865 206e 756d 6265 720a  s is the number.
-00017b40: 2020 2020 2020 2020 2020 2020 6f66 206e              of n
-00017b50: 6561 7265 7374 206e 6569 6768 626f 7273  earest neighbors
-00017b60: 2074 6f20 636f 6e73 6964 6572 2077 6865   to consider whe
-00017b70: 6e20 636f 6d70 7574 696e 6720 7468 6520  n computing the 
-00017b80: 696d 7075 7461 7469 6f6e 2e0a 2020 2020  imputation..    
-00017b90: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
-00017ba0: 2074 6f20 332e 2049 6620 696d 7075 7465   to 3. If impute
-00017bb0: 7220 6172 6775 6d65 6e74 2069 7320 7365  r argument is se
-00017bc0: 742c 2074 6869 7320 7661 7269 6162 6c65  t, this variable
-00017bd0: 2069 7320 6967 6e6f 7265 642e 0a0a 2020   is ignored...  
-00017be0: 2020 4e6f 7465 3a0a 2020 2020 2020 2020    Note:.        
-00017bf0: 5461 6e67 2026 2049 7368 7761 7261 6e20  Tang & Ishwaran 
-00017c00: 3230 3137 2072 6570 6f72 7465 6420 7468  2017 reported th
-00017c10: 6174 2069 6620 7468 6572 6520 6973 206c  at if there is l
-00017c20: 6f77 2074 6f20 6d65 6469 756d 0a20 2020  ow to medium.   
-00017c30: 2020 2020 2063 6f72 7265 6c61 7469 6f6e       correlation
-00017c40: 2069 6e20 7468 6520 6461 7461 7365 742c   in the dataset,
-00017c50: 2052 4620 696d 7075 7461 7469 6f6e 2061   RF imputation a
-00017c60: 6c67 6f72 6974 686d 7320 7065 7266 6f72  lgorithms perfor
-00017c70: 6d20 0a20 2020 2020 2020 2062 6574 7465  m .        bette
-00017c80: 7220 7468 616e 204b 4e4e 2069 6d70 7574  r than KNN imput
-00017c90: 6174 696f 6e0a 0a20 2020 2045 7861 6d70  ation..    Examp
-00017ca0: 6c65 3a0a 2020 2020 2020 2020 4966 2077  le:.        If w
-00017cb0: 6520 6861 7665 206f 7572 2074 7261 696e  e have our train
-00017cc0: 696e 6720 6461 7461 2069 6e20 616e 2061  ing data in an a
-00017cd0: 7272 6179 2063 616c 6c65 6420 7472 6169  rray called trai
-00017ce0: 6e69 6e67 5f73 6574 2c20 7765 200a 2020  ning_set, we .  
-00017cf0: 2020 2020 2020 6361 6e20 6372 6561 7465        can create
-00017d00: 2074 6865 2069 6d70 7574 6572 2073 6f20   the imputer so 
-00017d10: 7468 6174 2077 6520 6361 6e20 6361 6c6c  that we can call
-00017d20: 2069 7420 746f 2074 7261 6e73 666f 726d   it to transform
-00017d30: 206e 6577 2064 6174 610a 2020 2020 2020   new data.      
-00017d40: 2020 7768 656e 206d 616b 696e 6720 6f6e    when making on
-00017d50: 2d74 6865 2d66 6965 6c64 2070 7265 6469  -the-field predi
-00017d60: 6374 696f 6e73 2e0a 0a20 2020 2020 2020  ctions...       
-00017d70: 203e 3e3e 2069 6d70 7574 6564 5f64 6174   >>> imputed_dat
-00017d80: 612c 206b 6e6e 5f69 6d70 7574 6572 203d  a, knn_imputer =
-00017d90: 204b 4e4e 5f69 6d70 7574 6174 696f 6e28   KNN_imputation(
-00017da0: 6461 7461 3d74 7261 696e 696e 675f 7365  data=training_se
-00017db0: 742c 2069 6d70 7574 6572 3d4e 6f6e 6529  t, imputer=None)
-00017dc0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00017dd0: 2020 4e6f 7720 7765 2063 616e 2075 7365    Now we can use
-00017de0: 2074 6865 2069 6d70 7574 6564 2064 6174   the imputed dat
-00017df0: 6120 746f 2063 7265 6174 6520 6f75 7220  a to create our 
-00017e00: 6d61 6368 696e 6520 6c65 6172 6e69 6e67  machine learning
-00017e10: 206d 6f64 656c 2e0a 2020 2020 2020 2020   model..        
-00017e20: 4166 7465 7277 6172 6473 2c20 7768 656e  Afterwards, when
-00017e30: 206e 6577 2064 6174 6120 6973 2069 6e70   new data is inp
-00017e40: 7574 2066 6f72 2070 7265 6469 6374 696f  ut for predictio
-00017e50: 6e2c 2077 6520 7769 6c6c 2069 6e73 6572  n, we will inser
-00017e60: 7420 6f75 7220 0a20 2020 2020 2020 2069  t our .        i
-00017e70: 6d70 7574 6572 2069 6e74 6f20 7468 6520  mputer into the 
-00017e80: 7069 7065 6c69 6e65 6e20 6279 2063 616c  pipelinen by cal
-00017e90: 6c69 6e67 2074 6869 7320 6675 6e63 7469  ling this functi
-00017ea0: 6f6e 2061 6761 696e 2c20 6275 7420 7468  on again, but th
-00017eb0: 6973 2074 696d 650a 2020 2020 2020 2020  is time.        
-00017ec0: 7769 7468 2074 6865 2069 6d70 7574 6572  with the imputer
-00017ed0: 2061 7267 756d 656e 7420 7365 743a 0a0a   argument set:..
-00017ee0: 2020 2020 2020 2020 3e3e 3e20 6e65 775f          >>> new_
-00017ef0: 6461 7461 203d 206b 6e6e 5f69 6d70 7574  data = knn_imput
-00017f00: 6174 696f 6e28 6e65 775f 6461 7461 2c20  ation(new_data, 
-00017f10: 696d 7075 7465 723d 6b6e 6e5f 696d 7075  imputer=knn_impu
-00017f20: 7465 7229 0a0a 2020 2020 5265 7475 726e  ter)..    Return
-00017f30: 733a 0a20 2020 2020 2020 2054 6865 2066  s:.        The f
-00017f40: 6972 7374 206f 7574 7075 7420 6973 2074  irst output is t
-00017f50: 6865 2064 6174 6120 6172 7261 7920 7769  he data array wi
-00017f60: 7468 2077 6974 6820 7468 6520 6d69 7373  th with the miss
-00017f70: 696e 6720 7661 6c75 6573 2066 696c 6c65  ing values fille
-00017f80: 6420 696e 2e20 0a20 2020 2020 2020 2054  d in. .        T
-00017f90: 6865 2073 6563 6f6e 6420 6f75 7470 7574  he second output
-00017fa0: 2069 7320 7468 6520 4b4e 4e20 496d 7075   is the KNN Impu
-00017fb0: 7465 7220 7468 6174 2073 686f 756c 6420  ter that should 
-00017fc0: 6265 2075 7365 6420 746f 2074 7261 6e73  be used to trans
-00017fd0: 666f 726d 0a20 2020 2020 2020 206e 6577  form.        new
-00017fe0: 2064 6174 612c 2070 7269 6f72 2074 6f20   data, prior to 
-00017ff0: 7072 6564 6963 7469 6f6e 732e 200a 2020  predictions. .  
-00018000: 2020 2222 220a 0a20 2020 2069 6620 696d    """..    if im
-00018010: 7075 7465 7220 6973 204e 6f6e 653a 0a20  puter is None:. 
-00018020: 2020 2020 2020 2069 6d70 7574 6572 203d         imputer =
-00018030: 204b 4e4e 496d 7075 7465 7228 6e5f 6e65   KNNImputer(n_ne
-00018040: 6967 6862 6f72 733d 6b29 0a20 2020 2020  ighbors=k).     
-00018050: 2020 2069 6d70 7574 6572 2e66 6974 2864     imputer.fit(d
-00018060: 6174 6129 0a20 2020 2020 2020 2069 6d70  ata).        imp
-00018070: 7574 6564 5f64 6174 6120 3d20 696d 7075  uted_data = impu
-00018080: 7465 722e 7472 616e 7366 6f72 6d28 6461  ter.transform(da
-00018090: 7461 290a 2020 2020 2020 2020 7265 7475  ta).        retu
-000180a0: 726e 2069 6d70 7574 6564 5f64 6174 612c  rn imputed_data,
-000180b0: 2069 6d70 7574 6572 0a0a 2020 2020 7265   imputer..    re
-000180c0: 7475 726e 2069 6d70 7574 6572 2e74 7261  turn imputer.tra
-000180d0: 6e73 666f 726d 2864 6174 6129 200a 0a0a  nsform(data) ...
-000180e0: 0a0a 0a0a 0a0a 0a0a 0a0a 0a0a 0a0a 0a0a  ................
+000152e0: 2020 206e 6f72 6d61 6c69 7a65 5f74 7970     normalize_typ
+000152f0: 653d 7061 7261 6d73 5b27 6e6f 726d 616c  e=params['normal
+00015300: 697a 655f 7479 7065 275d 2c20 7261 7465  ize_type'], rate
+00015310: 5f64 726f 703d 7061 7261 6d73 5b27 7261  _drop=params['ra
+00015320: 7465 5f64 726f 7027 5d2c 2073 6b69 705f  te_drop'], skip_
+00015330: 6472 6f70 3d70 6172 616d 735b 2773 6b69  drop=params['ski
+00015340: 705f 6472 6f70 275d 2c20 7261 6e64 6f6d  p_drop'], random
+00015350: 5f73 7461 7465 3d31 3930 3929 232c 2074  _state=1909)#, t
+00015360: 7265 655f 6d65 7468 6f64 3d27 6869 7374  ree_method='hist
+00015370: 2729 0a20 2020 2020 2020 2065 6c69 6620  ').        elif 
+00015380: 7061 7261 6d73 5b27 626f 6f73 7465 7227  params['booster'
+00015390: 5d20 3d3d 2027 6762 7472 6565 273a 0a20  ] == 'gbtree':. 
+000153a0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+000153b0: 6c66 2e6f 7074 5f63 7620 3e3d 2031 3a0a  lf.opt_cv >= 1:.
+000153c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153d0: 636c 6620 3d20 5847 4243 6c61 7373 6966  clf = XGBClassif
+000153e0: 6965 7228 626f 6f73 7465 723d 7061 7261  ier(booster=para
+000153f0: 6d73 5b27 626f 6f73 7465 7227 5d2c 206e  ms['booster'], n
+00015400: 5f65 7374 696d 6174 6f72 733d 7061 7261  _estimators=para
+00015410: 6d73 5b27 6e5f 6573 7469 6d61 746f 7273  ms['n_estimators
+00015420: 275d 2c20 636f 6c73 616d 706c 655f 6279  '], colsample_by
+00015430: 7472 6565 3d70 6172 616d 735b 2763 6f6c  tree=params['col
+00015440: 7361 6d70 6c65 5f62 7974 7265 6527 5d2c  sample_bytree'],
+00015450: 2020 7265 675f 6c61 6d62 6461 3d70 6172    reg_lambda=par
+00015460: 616d 735b 2772 6567 5f6c 616d 6264 6127  ams['reg_lambda'
+00015470: 5d2c 200a 2020 2020 2020 2020 2020 2020  ], .            
+00015480: 2020 2020 2020 2020 7265 675f 616c 7068          reg_alph
+00015490: 613d 7061 7261 6d73 5b27 7265 675f 616c  a=params['reg_al
+000154a0: 7068 6127 5d2c 206d 6178 5f64 6570 7468  pha'], max_depth
+000154b0: 3d70 6172 616d 735b 276d 6178 5f64 6570  =params['max_dep
+000154c0: 7468 275d 2c20 6574 613d 7061 7261 6d73  th'], eta=params
+000154d0: 5b27 6574 6127 5d2c 2067 616d 6d61 3d70  ['eta'], gamma=p
+000154e0: 6172 616d 735b 2767 616d 6d61 275d 2c20  arams['gamma'], 
+000154f0: 6772 6f77 5f70 6f6c 6963 793d 7061 7261  grow_policy=para
+00015500: 6d73 5b27 6772 6f77 5f70 6f6c 6963 7927  ms['grow_policy'
+00015510: 5d2c 200a 2020 2020 2020 2020 2020 2020  ], .            
+00015520: 2020 2020 2020 2020 6d69 6e5f 6368 696c          min_chil
+00015530: 645f 7765 6967 6874 3d70 6172 616d 735b  d_weight=params[
+00015540: 276d 696e 5f63 6869 6c64 5f77 6569 6768  'min_child_weigh
+00015550: 7427 5d2c 206d 6178 5f64 656c 7461 5f73  t'], max_delta_s
+00015560: 7465 703d 7061 7261 6d73 5b27 6d61 785f  tep=params['max_
+00015570: 6465 6c74 615f 7374 6570 275d 2c20 7375  delta_step'], su
+00015580: 6273 616d 706c 653d 7061 7261 6d73 5b27  bsample=params['
+00015590: 7375 6273 616d 706c 6527 5d2c 2072 616e  subsample'], ran
+000155a0: 646f 6d5f 7374 6174 653d 3139 3039 2923  dom_state=1909)#
+000155b0: 2c20 7472 6565 5f6d 6574 686f 643d 2768  , tree_method='h
+000155c0: 6973 7427 290a 2020 2020 2020 2020 2020  ist').          
+000155d0: 2020 0a20 2020 2020 2020 2069 6620 7365    .        if se
+000155e0: 6c66 2e6f 7074 5f63 7620 3c20 313a 0a20  lf.opt_cv < 1:. 
+000155f0: 2020 2020 2020 2020 2020 2062 7374 203d             bst =
+00015600: 2074 7261 696e 2870 6172 616d 732c 2064   train(params, d
+00015610: 7472 6169 6e2c 2065 7661 6c73 3d5b 2864  train, evals=[(d
+00015620: 7661 6c69 642c 2022 7661 6c69 6461 7469  valid, "validati
+00015630: 6f6e 2229 5d2c 2063 616c 6c62 6163 6b73  on")], callbacks
+00015640: 3d5b 7072 756e 696e 675f 6361 6c6c 6261  =[pruning_callba
+00015650: 636b 5d29 0a20 2020 2020 2020 2020 2020  ck]).           
+00015660: 2070 7265 6473 203d 2062 7374 2e70 7265   preds = bst.pre
+00015670: 6469 6374 2864 7661 6c69 6429 0a20 2020  dict(dvalid).   
+00015680: 2020 2020 2020 2020 2070 7265 645f 6c61           pred_la
+00015690: 6265 6c73 203d 206e 702e 7269 6e74 2870  bels = np.rint(p
+000156a0: 7265 6473 290a 2020 2020 2020 2020 2020  reds).          
+000156b0: 2020 6163 6375 7261 6379 203d 2061 6363    accuracy = acc
+000156c0: 7572 6163 795f 7363 6f72 6528 7661 6c69  uracy_score(vali
+000156d0: 645f 792c 2070 7265 645f 6c61 6265 6c73  d_y, pred_labels
+000156e0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+000156f0: 2020 2020 2020 2020 2020 2020 6376 203d              cv =
+00015700: 2063 726f 7373 5f76 616c 6964 6174 6528   cross_validate(
+00015710: 636c 662c 2073 656c 662e 6461 7461 5f78  clf, self.data_x
+00015720: 2c20 7365 6c66 2e64 6174 615f 792c 2063  , self.data_y, c
+00015730: 763d 7365 6c66 2e6f 7074 5f63 7629 0a20  v=self.opt_cv). 
+00015740: 2020 2020 2020 2020 2020 2061 6363 7572             accur
+00015750: 6163 7920 3d20 6e70 2e6d 6561 6e28 6376  acy = np.mean(cv
+00015760: 5b27 7465 7374 5f73 636f 7265 275d 290a  ['test_score']).
+00015770: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00015780: 2072 6574 7572 6e20 6163 6375 7261 6379   return accuracy
+00015790: 0a0a 636c 6173 7320 6f62 6a65 6374 6976  ..class objectiv
+000157a0: 655f 6e6e 286f 626a 6563 7429 3a0a 2020  e_nn(object):.  
+000157b0: 2020 2222 220a 2020 2020 4f70 7469 6d69    """.    Optimi
+000157c0: 7a61 7469 6f6e 206f 626a 6563 7469 7665  zation objective
+000157d0: 2066 756e 6374 696f 6e20 666f 7220 7468   function for th
+000157e0: 6520 7363 696b 6974 2d6c 6561 726e 2069  e scikit-learn i
+000157f0: 6d70 6c65 6d65 6e74 6174 696e 206f 6620  mplementatin of 
+00015800: 7468 650a 2020 2020 4d4c 5020 636c 6173  the.    MLP clas
+00015810: 7369 6669 6572 2e20 5468 6520 4f70 7475  sifier. The Optu
+00015820: 6e61 2073 6f66 7477 6172 6520 666f 7220  na software for 
+00015830: 6879 7065 7270 6172 616d 6574 6572 206f  hyperparameter o
+00015840: 7074 696d 697a 6174 696f 6e0a 2020 2020  ptimization.    
+00015850: 7761 7320 7075 626c 6973 6865 6420 696e  was published in
+00015860: 2032 3031 3920 6279 2041 6b69 6261 2065   2019 by Akiba e
+00015870: 7420 616c 2e20 5061 7065 723a 2068 7474  t al. Paper: htt
+00015880: 7073 3a2f 2f61 7278 6976 2e6f 7267 2f61  ps://arxiv.org/a
+00015890: 6273 2f31 3930 372e 3130 3930 322e 0a0a  bs/1907.10902...
+000158a0: 2020 2020 5468 6520 746f 7461 6c20 6e75      The total nu
+000158b0: 6d62 6572 206f 6620 6869 6464 656e 206c  mber of hidden l
+000158c0: 6179 6572 7320 746f 2074 6573 7420 6973  ayers to test is
+000158d0: 206c 696d 6974 6564 2074 6f20 3130 2c20   limited to 10, 
+000158e0: 7769 7468 2031 3030 2d35 3030 3020 706f  with 100-5000 po
+000158f0: 7373 6962 6c65 200a 2020 2020 6e75 6d62  ssible .    numb
+00015900: 6572 206f 6620 6e65 7572 6f6e 7320 696e  er of neurons in
+00015910: 2065 6163 682e 0a0a 2020 2020 4172 6773   each...    Args
+00015920: 3a0a 2020 2020 2020 2020 6461 7461 5f78  :.        data_x
+00015930: 2028 6e64 6172 7261 7929 3a20 3244 2061   (ndarray): 2D a
+00015940: 7272 6179 206f 6620 7369 7a65 2028 6e20  rray of size (n 
+00015950: 7820 6d29 2c20 7768 6572 6520 6e20 6973  x m), where n is
+00015960: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00015970: 206e 756d 6265 7220 6f66 2073 616d 706c   number of sampl
+00015980: 6573 2c20 616e 6420 6d20 7468 6520 6e75  es, and m the nu
+00015990: 6d62 6572 206f 6620 6665 6174 7572 6573  mber of features
+000159a0: 2e0a 2020 2020 2020 2020 6461 7461 5f79  ..        data_y
+000159b0: 2028 6e64 6172 7261 792c 2073 7472 293a   (ndarray, str):
+000159c0: 2031 4420 6172 7261 7920 636f 6e74 6169   1D array contai
+000159d0: 6e69 6e67 2074 6865 2063 6f72 7265 7370  ning the corresp
+000159e0: 6f6e 696e 6720 6c61 6265 6c73 2e20 0a20  oning labels. . 
+000159f0: 2020 2020 2020 206f 7074 5f63 7620 2869         opt_cv (i
+00015a00: 6e74 293a 2043 726f 7373 2d76 616c 6964  nt): Cross-valid
+00015a10: 6174 696f 6e73 2074 6f20 7065 7266 6f72  ations to perfor
+00015a20: 6d20 7768 656e 2061 7373 6573 696e 6720  m when assesing 
+00015a30: 7468 6520 7065 7266 6f72 6d61 6e63 6520  the performance 
+00015a40: 6174 2065 6163 680a 2020 2020 2020 2020  at each.        
+00015a50: 2020 2020 6879 7065 7270 6172 616d 6574      hyperparamet
+00015a60: 6572 206f 7074 696d 697a 6174 696f 6e20  er optimization 
+00015a70: 7472 6961 6c2e 2046 6f72 2065 7861 6d70  trial. For examp
+00015a80: 6c65 2c20 6966 2063 763d 332c 2074 6865  le, if cv=3, the
+00015a90: 6e20 6561 6368 206f 7074 696d 697a 6174  n each optimizat
+00015aa0: 696f 6e20 7472 6961 6c0a 2020 2020 2020  ion trial.      
+00015ab0: 2020 2020 2020 7769 6c6c 2062 6520 6173        will be as
+00015ac0: 7365 7373 6564 2061 6363 6f72 6469 6e67  sessed according
+00015ad0: 2074 6f20 7468 6520 332d 666f 6c64 2063   to the 3-fold c
+00015ae0: 726f 7373 2076 616c 6964 6174 696f 6e20  ross validation 
+00015af0: 6163 6375 7261 6379 2e20 0a0a 2020 2020  accuracy. ..    
+00015b00: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
+00015b10: 2054 6865 2070 6572 666f 726d 616e 6365   The performance
+00015b20: 206d 6574 7269 632c 2064 6574 6572 6d69   metric, determi
+00015b30: 6e65 6420 7573 696e 6720 7468 6520 6372  ned using the cr
+00015b40: 6f73 732d 666f 6c64 2076 616c 6964 6174  oss-fold validat
+00015b50: 696f 6e20 6d65 7468 6f64 2e0a 2020 2020  ion method..    
+00015b60: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
+00015b70: 6e69 745f 5f28 7365 6c66 2c20 6461 7461  nit__(self, data
+00015b80: 5f78 2c20 6461 7461 5f79 2c20 6f70 745f  _x, data_y, opt_
+00015b90: 6376 293a 0a20 2020 2020 2020 2073 656c  cv):.        sel
+00015ba0: 662e 6461 7461 5f78 203d 2064 6174 615f  f.data_x = data_
+00015bb0: 780a 2020 2020 2020 2020 7365 6c66 2e64  x.        self.d
+00015bc0: 6174 615f 7920 3d20 6461 7461 5f79 0a20  ata_y = data_y. 
+00015bd0: 2020 2020 2020 2073 656c 662e 6f70 745f         self.opt_
+00015be0: 6376 203d 206f 7074 5f63 760a 0a20 2020  cv = opt_cv..   
+00015bf0: 2064 6566 205f 5f63 616c 6c5f 5f28 7365   def __call__(se
+00015c00: 6c66 2c20 7472 6961 6c29 3a0a 2020 2020  lf, trial):.    
+00015c10: 2020 2020 6c65 6172 6e69 6e67 5f72 6174      learning_rat
+00015c20: 655f 696e 6974 203d 2074 7269 616c 2e73  e_init = trial.s
+00015c30: 7567 6765 7374 5f66 6c6f 6174 2827 6c65  uggest_float('le
+00015c40: 6172 6e69 6e67 5f72 6174 655f 696e 6974  arning_rate_init
+00015c50: 272c 2031 652d 352c 2030 2e31 2c20 7374  ', 1e-5, 0.1, st
+00015c60: 6570 3d31 652d 3529 0a20 2020 2020 2020  ep=1e-5).       
+00015c70: 2073 6f6c 7665 7220 3d20 7472 6961 6c2e   solver = trial.
+00015c80: 7375 6767 6573 745f 6361 7465 676f 7269  suggest_categori
+00015c90: 6361 6c28 2273 6f6c 7665 7222 2c20 5b22  cal("solver", ["
+00015ca0: 7367 6422 2c20 2261 6461 6d22 5d29 2023  sgd", "adam"]) #
+00015cb0: 226c 6266 6773 220a 2020 2020 2020 2020  "lbfgs".        
+00015cc0: 6163 7469 7661 7469 6f6e 203d 2074 7269  activation = tri
+00015cd0: 616c 2e73 7567 6765 7374 5f63 6174 6567  al.suggest_categ
+00015ce0: 6f72 6963 616c 2822 6163 7469 7661 7469  orical("activati
+00015cf0: 6f6e 222c 205b 226c 6f67 6973 7469 6322  on", ["logistic"
+00015d00: 2c20 2274 616e 6822 2c20 2272 656c 7522  , "tanh", "relu"
+00015d10: 5d29 0a20 2020 2020 2020 206c 6561 726e  ]).        learn
+00015d20: 696e 675f 7261 7465 203d 2074 7269 616c  ing_rate = trial
+00015d30: 2e73 7567 6765 7374 5f63 6174 6567 6f72  .suggest_categor
+00015d40: 6963 616c 2822 6c65 6172 6e69 6e67 5f72  ical("learning_r
+00015d50: 6174 6522 2c20 5b22 636f 6e73 7461 6e74  ate", ["constant
+00015d60: 222c 2022 696e 7673 6361 6c69 6e67 222c  ", "invscaling",
+00015d70: 2022 6164 6170 7469 7665 225d 290a 2020   "adaptive"]).  
+00015d80: 2020 2020 2020 616c 7068 6120 3d20 7472        alpha = tr
+00015d90: 6961 6c2e 7375 6767 6573 745f 666c 6f61  ial.suggest_floa
+00015da0: 7428 2261 6c70 6861 222c 2031 652d 372c  t("alpha", 1e-7,
+00015db0: 2031 2c20 7374 6570 3d31 652d 3629 0a20   1, step=1e-6). 
+00015dc0: 2020 2020 2020 2062 6174 6368 5f73 697a         batch_siz
+00015dd0: 6520 3d20 7472 6961 6c2e 7375 6767 6573  e = trial.sugges
+00015de0: 745f 696e 7428 2762 6174 6368 5f73 697a  t_int('batch_siz
+00015df0: 6527 2c20 312c 2031 3030 3029 0a20 2020  e', 1, 1000).   
+00015e00: 2020 2020 206e 5f6c 6179 6572 7320 3d20       n_layers = 
+00015e10: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
+00015e20: 7428 2768 6964 6465 6e5f 6c61 7965 725f  t('hidden_layer_
+00015e30: 7369 7a65 7327 2c20 312c 2031 3029 0a0a  sizes', 1, 10)..
+00015e40: 2020 2020 2020 2020 6c61 7965 7273 203d          layers =
+00015e50: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
+00015e60: 6920 696e 2072 616e 6765 286e 5f6c 6179  i in range(n_lay
+00015e70: 6572 7329 3a0a 2020 2020 2020 2020 2020  ers):.          
+00015e80: 2020 6c61 7965 7273 2e61 7070 656e 6428    layers.append(
+00015e90: 7472 6961 6c2e 7375 6767 6573 745f 696e  trial.suggest_in
+00015ea0: 7428 6627 6e5f 756e 6974 735f 7b69 7d27  t(f'n_units_{i}'
+00015eb0: 2c20 3130 302c 2035 3030 3029 290a 0a20  , 100, 5000)).. 
+00015ec0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00015ed0: 2020 2020 2020 2020 636c 6620 3d20 4d4c          clf = ML
+00015ee0: 5043 6c61 7373 6966 6965 7228 6869 6464  PClassifier(hidd
+00015ef0: 656e 5f6c 6179 6572 5f73 697a 6573 3d74  en_layer_sizes=t
+00015f00: 7570 6c65 286c 6179 6572 7329 2c6c 6561  uple(layers),lea
+00015f10: 726e 696e 675f 7261 7465 5f69 6e69 743d  rning_rate_init=
+00015f20: 6c65 6172 6e69 6e67 5f72 6174 655f 696e  learning_rate_in
+00015f30: 6974 2c20 0a20 2020 2020 2020 2020 2020  it, .           
+00015f40: 2020 2020 2073 6f6c 7665 723d 736f 6c76       solver=solv
+00015f50: 6572 2c20 6163 7469 7661 7469 6f6e 3d61  er, activation=a
+00015f60: 6374 6976 6174 696f 6e2c 2061 6c70 6861  ctivation, alpha
+00015f70: 3d61 6c70 6861 2c20 6261 7463 685f 7369  =alpha, batch_si
+00015f80: 7a65 3d62 6174 6368 5f73 697a 652c 206d  ze=batch_size, m
+00015f90: 6178 5f69 7465 723d 3235 3030 2c20 7261  ax_iter=2500, ra
+00015fa0: 6e64 6f6d 5f73 7461 7465 3d31 3930 3929  ndom_state=1909)
+00015fb0: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
+00015fc0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00015fd0: 6e74 2822 496e 7661 6c69 6420 6879 7065  nt("Invalid hype
+00015fe0: 7270 6172 616d 6574 6572 2063 6f6d 6269  rparameter combi
+00015ff0: 6e61 7469 6f6e 2c20 736b 6970 7069 6e67  nation, skipping
+00016000: 2074 7269 616c 2229 0a20 2020 2020 2020   trial").       
+00016010: 2020 2020 2072 6574 7572 6e20 302e 300a       return 0.0.
+00016020: 0a20 2020 2020 2020 2063 7620 3d20 6372  .        cv = cr
+00016030: 6f73 735f 7661 6c69 6461 7465 2863 6c66  oss_validate(clf
+00016040: 2c20 7365 6c66 2e64 6174 615f 782c 2073  , self.data_x, s
+00016050: 656c 662e 6461 7461 5f79 2c20 6376 3d73  elf.data_y, cv=s
+00016060: 656c 662e 6f70 745f 6376 290a 2020 2020  elf.opt_cv).    
+00016070: 2020 2020 6669 6e61 6c5f 7363 6f72 6520      final_score 
+00016080: 3d20 6e70 2e6d 6561 6e28 6376 5b27 7465  = np.mean(cv['te
+00016090: 7374 5f73 636f 7265 275d 290a 0a20 2020  st_score'])..   
+000160a0: 2020 2020 2072 6574 7572 6e20 6669 6e61       return fina
+000160b0: 6c5f 7363 6f72 650a 0a63 6c61 7373 206f  l_score..class o
+000160c0: 626a 6563 7469 7665 5f72 6628 6f62 6a65  bjective_rf(obje
+000160d0: 6374 293a 0a20 2020 2022 2222 0a20 2020  ct):.    """.   
+000160e0: 204f 7074 696d 697a 6174 696f 6e20 6f62   Optimization ob
+000160f0: 6a65 6374 6976 6520 6675 6e63 7469 6f6e  jective function
+00016100: 2066 6f72 2074 6865 2073 6369 6b69 742d   for the scikit-
+00016110: 6c65 6172 6e20 696d 706c 656d 656e 7461  learn implementa
+00016120: 7469 6e20 6f66 2074 6865 0a20 2020 2052  tin of the.    R
+00016130: 616e 646f 6d20 466f 7265 7374 2063 6c61  andom Forest cla
+00016140: 7373 6966 6965 722e 2054 6865 204f 7074  ssifier. The Opt
+00016150: 756e 6120 736f 6674 7761 7265 2066 6f72  una software for
+00016160: 2068 7970 6572 7061 7261 6d65 7465 7220   hyperparameter 
+00016170: 6f70 7469 6d69 7a61 7469 6f6e 0a20 2020  optimization.   
+00016180: 2077 6173 2070 7562 6c69 7368 6564 2069   was published i
+00016190: 6e20 3230 3139 2062 7920 416b 6962 6120  n 2019 by Akiba 
+000161a0: 6574 2061 6c2e 2050 6170 6572 3a20 6874  et al. Paper: ht
+000161b0: 7470 733a 2f2f 6172 7869 762e 6f72 672f  tps://arxiv.org/
+000161c0: 6162 732f 3139 3037 2e31 3039 3032 0a0a  abs/1907.10902..
+000161d0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+000161e0: 2020 6461 7461 5f78 2028 6e64 6172 7261    data_x (ndarra
+000161f0: 7929 3a20 3244 2061 7272 6179 206f 6620  y): 2D array of 
+00016200: 7369 7a65 2028 6e20 7820 6d29 2c20 7768  size (n x m), wh
+00016210: 6572 6520 6e20 6973 2074 6865 0a20 2020  ere n is the.   
+00016220: 2020 2020 2020 2020 206e 756d 6265 7220           number 
+00016230: 6f66 2073 616d 706c 6573 2c20 616e 6420  of samples, and 
+00016240: 6d20 7468 6520 6e75 6d62 6572 206f 6620  m the number of 
+00016250: 6665 6174 7572 6573 2e0a 2020 2020 2020  features..      
+00016260: 2020 6461 7461 5f79 2028 6e64 6172 7261    data_y (ndarra
+00016270: 792c 2073 7472 293a 2031 4420 6172 7261  y, str): 1D arra
+00016280: 7920 636f 6e74 6169 6e69 6e67 2074 6865  y containing the
+00016290: 2063 6f72 7265 7370 6f6e 696e 6720 6c61   corresponing la
+000162a0: 6265 6c73 2e20 0a20 2020 2020 2020 206f  bels. .        o
+000162b0: 7074 5f63 7620 2869 6e74 293a 2043 726f  pt_cv (int): Cro
+000162c0: 7373 2d76 616c 6964 6174 696f 6e73 2074  ss-validations t
+000162d0: 6f20 7065 7266 6f72 6d20 7768 656e 2061  o perform when a
+000162e0: 7373 6573 696e 6720 7468 6520 7065 7266  ssesing the perf
+000162f0: 6f72 6d61 6e63 6520 6174 2065 6163 680a  ormance at each.
+00016300: 2020 2020 2020 2020 2020 2020 6879 7065              hype
+00016310: 7270 6172 616d 6574 6572 206f 7074 696d  rparameter optim
+00016320: 697a 6174 696f 6e20 7472 6961 6c2e 2046  ization trial. F
+00016330: 6f72 2065 7861 6d70 6c65 2c20 6966 2063  or example, if c
+00016340: 763d 332c 2074 6865 6e20 6561 6368 206f  v=3, then each o
+00016350: 7074 696d 697a 6174 696f 6e20 7472 6961  ptimization tria
+00016360: 6c0a 2020 2020 2020 2020 2020 2020 7769  l.            wi
+00016370: 6c6c 2062 6520 6173 7365 7373 6564 2061  ll be assessed a
+00016380: 6363 6f72 6469 6e67 2074 6f20 7468 6520  ccording to the 
+00016390: 332d 666f 6c64 2063 726f 7373 2076 616c  3-fold cross val
+000163a0: 6964 6174 696f 6e20 6163 6375 7261 6379  idation accuracy
+000163b0: 2e20 0a0a 2020 2020 5265 7475 726e 733a  . ..    Returns:
+000163c0: 0a20 2020 2020 2020 2054 6865 2070 6572  .        The per
+000163d0: 666f 726d 616e 6365 206d 6574 7269 632c  formance metric,
+000163e0: 2064 6574 6572 6d69 6e65 6420 7573 696e   determined usin
+000163f0: 6720 7468 6520 6372 6f73 732d 666f 6c64  g the cross-fold
+00016400: 2076 616c 6964 6174 696f 6e20 6d65 7468   validation meth
+00016410: 6f64 2e0a 2020 2020 2222 220a 2020 2020  od..    """.    
+00016420: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00016430: 5f28 7365 6c66 2c20 6461 7461 5f78 2c20  _(self, data_x, 
+00016440: 6461 7461 5f79 2c20 6f70 745f 6376 293a  data_y, opt_cv):
+00016450: 0a0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
+00016460: 6174 615f 7820 3d20 6461 7461 5f78 0a20  ata_x = data_x. 
+00016470: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
+00016480: 5f79 203d 2064 6174 615f 790a 2020 2020  _y = data_y.    
+00016490: 2020 2020 7365 6c66 2e6f 7074 5f63 7620      self.opt_cv 
+000164a0: 3d20 6f70 745f 6376 0a0a 2020 2020 6465  = opt_cv..    de
+000164b0: 6620 5f5f 6361 6c6c 5f5f 2873 656c 662c  f __call__(self,
+000164c0: 2074 7269 616c 293a 0a0a 2020 2020 2020   trial):..      
+000164d0: 2020 6e5f 6573 7469 6d61 746f 7273 203d    n_estimators =
+000164e0: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
+000164f0: 6e74 2827 6e5f 6573 7469 6d61 746f 7273  nt('n_estimators
+00016500: 272c 2031 3030 2c20 3330 3030 290a 2020  ', 100, 3000).  
+00016510: 2020 2020 2020 6372 6974 6572 696f 6e20        criterion 
+00016520: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00016530: 6361 7465 676f 7269 6361 6c28 2763 7269  categorical('cri
+00016540: 7465 7269 6f6e 272c 205b 2767 696e 6927  terion', ['gini'
+00016550: 2c20 2765 6e74 726f 7079 275d 290a 2020  , 'entropy']).  
+00016560: 2020 2020 2020 6d61 785f 6465 7074 6820        max_depth 
+00016570: 3d20 7472 6961 6c2e 7375 6767 6573 745f  = trial.suggest_
+00016580: 696e 7428 276d 6178 5f64 6570 7468 272c  int('max_depth',
+00016590: 2032 2c20 3235 290a 2020 2020 2020 2020   2, 25).        
+000165a0: 6d69 6e5f 7361 6d70 6c65 735f 7370 6c69  min_samples_spli
+000165b0: 7420 3d20 7472 6961 6c2e 7375 6767 6573  t = trial.sugges
+000165c0: 745f 696e 7428 276d 696e 5f73 616d 706c  t_int('min_sampl
+000165d0: 6573 5f73 706c 6974 272c 2032 2c20 3235  es_split', 2, 25
+000165e0: 290a 2020 2020 2020 2020 6d69 6e5f 7361  ).        min_sa
+000165f0: 6d70 6c65 735f 6c65 6166 203d 2074 7269  mples_leaf = tri
+00016600: 616c 2e73 7567 6765 7374 5f69 6e74 2827  al.suggest_int('
+00016610: 6d69 6e5f 7361 6d70 6c65 735f 6c65 6166  min_samples_leaf
+00016620: 272c 2031 2c20 3135 290a 2020 2020 2020  ', 1, 15).      
+00016630: 2020 6d61 785f 6665 6174 7572 6573 203d    max_features =
+00016640: 2074 7269 616c 2e73 7567 6765 7374 5f69   trial.suggest_i
+00016650: 6e74 2827 6d61 785f 6665 6174 7572 6573  nt('max_features
+00016660: 272c 2031 2c20 7365 6c66 2e64 6174 615f  ', 1, self.data_
+00016670: 782e 7368 6170 655b 315d 290a 2020 2020  x.shape[1]).    
+00016680: 2020 2020 626f 6f74 7374 7261 7020 3d20      bootstrap = 
+00016690: 7472 6961 6c2e 7375 6767 6573 745f 6361  trial.suggest_ca
+000166a0: 7465 676f 7269 6361 6c28 2762 6f6f 7473  tegorical('boots
+000166b0: 7472 6170 272c 205b 5472 7565 2c20 4661  trap', [True, Fa
+000166c0: 6c73 655d 290a 2020 2020 2020 2020 0a20  lse]).        . 
+000166d0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+000166e0: 2020 2020 2020 2020 636c 6620 3d20 5261          clf = Ra
+000166f0: 6e64 6f6d 466f 7265 7374 436c 6173 7369  ndomForestClassi
+00016700: 6669 6572 286e 5f65 7374 696d 6174 6f72  fier(n_estimator
+00016710: 733d 6e5f 6573 7469 6d61 746f 7273 2c20  s=n_estimators, 
+00016720: 6372 6974 6572 696f 6e3d 6372 6974 6572  criterion=criter
+00016730: 696f 6e2c 206d 6178 5f64 6570 7468 3d6d  ion, max_depth=m
+00016740: 6178 5f64 6570 7468 2c0a 2020 2020 2020  ax_depth,.      
+00016750: 2020 2020 2020 2020 2020 6d69 6e5f 7361            min_sa
+00016760: 6d70 6c65 735f 7370 6c69 743d 6d69 6e5f  mples_split=min_
+00016770: 7361 6d70 6c65 735f 7370 6c69 742c 206d  samples_split, m
+00016780: 696e 5f73 616d 706c 6573 5f6c 6561 663d  in_samples_leaf=
+00016790: 6d69 6e5f 7361 6d70 6c65 735f 6c65 6166  min_samples_leaf
+000167a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000167b0: 2020 6d61 785f 6665 6174 7572 6573 3d6d    max_features=m
+000167c0: 6178 5f66 6561 7475 7265 732c 2062 6f6f  ax_features, boo
+000167d0: 7473 7472 6170 3d62 6f6f 7473 7472 6170  tstrap=bootstrap
+000167e0: 2c20 7261 6e64 6f6d 5f73 7461 7465 3d31  , random_state=1
+000167f0: 3930 3929 0a20 2020 2020 2020 2065 7863  909).        exc
+00016800: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+00016810: 2070 7269 6e74 2822 496e 7661 6c69 6420   print("Invalid 
+00016820: 6879 7065 7270 6172 616d 6574 6572 2063  hyperparameter c
+00016830: 6f6d 6269 6e61 7469 6f6e 2c20 736b 6970  ombination, skip
+00016840: 7069 6e67 2074 7269 616c 2229 0a20 2020  ping trial").   
+00016850: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00016860: 302e 300a 0a20 2020 2020 2020 2063 7620  0.0..        cv 
+00016870: 3d20 6372 6f73 735f 7661 6c69 6461 7465  = cross_validate
+00016880: 2863 6c66 2c20 7365 6c66 2e64 6174 615f  (clf, self.data_
+00016890: 782c 2073 656c 662e 6461 7461 5f79 2c20  x, self.data_y, 
+000168a0: 6376 3d73 656c 662e 6f70 745f 6376 290a  cv=self.opt_cv).
+000168b0: 2020 2020 2020 2020 6669 6e61 6c5f 7363          final_sc
+000168c0: 6f72 6520 3d20 6e70 2e6d 6561 6e28 6376  ore = np.mean(cv
+000168d0: 5b27 7465 7374 5f73 636f 7265 275d 290a  ['test_score']).
+000168e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000168f0: 6669 6e61 6c5f 7363 6f72 650a 0a63 6c61  final_score..cla
+00016900: 7373 204d 6f6e 6974 6f72 5f54 7261 636b  ss Monitor_Track
+00016910: 6572 2843 616c 6c62 6163 6b29 3a0a 2020  er(Callback):.  
+00016920: 2020 2222 220a 2020 2020 4375 7374 6f6d    """.    Custom
+00016930: 2063 616c 6c62 6163 6b20 7468 6174 2061   callback that a
+00016940: 6c6c 6f77 7320 666f 7220 7477 6f20 6469  llows for two di
+00016950: 6666 6572 656e 7420 6d6f 6e69 746f 7273  fferent monitors
+00016960: 2e0a 2020 2020 5468 6973 2063 6c61 7373  ..    This class
+00016970: 2069 7320 7573 6564 2062 7920 7468 6520   is used by the 
+00016980: 606f 626a 6563 7469 7665 5f63 6e6e 6020  `objective_cnn` 
+00016990: 726f 7574 696e 6520 6173 2069 7420 696e  routine as it in
+000169a0: 6865 7269 7473 2074 6865 2060 6d6f 6e69  herits the `moni
+000169b0: 746f 7231 6020 0a20 2020 2061 6e64 2060  tor1` .    and `
+000169c0: 6d6f 6e69 746f 7232 6020 6174 7472 6962  monitor2` attrib
+000169d0: 7574 6573 2c20 6173 2077 656c 6c20 6173  utes, as well as
+000169e0: 2074 6865 6972 2063 6f72 7265 7370 6f6e   their correspon
+000169f0: 6469 6e67 2074 6872 6573 686f 6c64 732e  ding thresholds.
+00016a00: 2054 6869 7320 6561 726c 7920 7374 6f70   This early stop
+00016a10: 7069 6e67 0a20 2020 2063 7573 746f 6d20  ping.    custom 
+00016a20: 6361 6c6c 6261 636b 2077 696c 6c20 7465  callback will te
+00016a30: 726d 696e 6174 6520 7468 6520 7472 6169  rminate the trai
+00016a40: 6e69 6e67 2065 6172 6c79 2069 6620 6569  ning early if ei
+00016a50: 7468 6572 206d 6f6e 6974 6f72 7320 6372  ther monitors cr
+00016a60: 6f73 7320 7468 6569 7220 7265 7370 6563  oss their respec
+00016a70: 7469 7665 0a20 2020 2074 6872 6573 686f  tive.    thresho
+00016a80: 6c64 2c20 7468 6572 6566 6f72 6520 7468  ld, therefore th
+00016a90: 6520 7061 7469 656e 6365 2069 6e70 7574  e patience input
+00016aa0: 2069 7320 6e6f 7420 7573 6564 2e20 5768   is not used. Wh
+00016ab0: 6574 6865 7220 7468 6520 7468 7265 7368  ether the thresh
+00016ac0: 6f6c 6420 7368 6f75 6c64 2062 6520 6120  old should be a 
+00016ad0: 6365 696c 696e 670a 2020 2020 6f72 2066  ceiling.    or f
+00016ae0: 6c6f 6f72 2076 616c 7565 2077 696c 6c20  loor value will 
+00016af0: 6265 2064 6574 6572 6d69 6e65 6420 6163  be determined ac
+00016b00: 636f 7264 696e 6720 746f 2074 6865 206d  cording to the m
+00016b10: 6574 7269 632c 2062 7920 6368 6563 6b69  etric, by checki
+00016b20: 6e67 2077 6865 7468 6572 2074 6865 206d  ng whether the m
+00016b30: 6f6e 6974 6f72 206e 616d 650a 2020 2020  onitor name.    
+00016b40: 636f 6e74 6169 6e73 2074 6865 2077 6f72  contains the wor
+00016b50: 6420 276c 6f73 7327 2e0a 0a20 2020 2041  d 'loss'...    A
+00016b60: 7267 733a 0a20 2020 2020 2020 206d 6f6e  rgs:.        mon
+00016b70: 6974 6f72 3120 2873 7472 293a 204e 616d  itor1 (str): Nam
+00016b80: 6520 6f66 2074 6865 206d 6574 7269 6320  e of the metric 
+00016b90: 746f 206d 6f6e 6974 6f72 2e20 4966 2060  to monitor. If `
+00016ba0: 4e6f 6e65 602c 2074 6869 7320 6d6f 6e69  None`, this moni
+00016bb0: 746f 7220 7769 6c6c 206e 6f74 2062 6520  tor will not be 
+00016bc0: 7573 6564 2e0a 2020 2020 2020 2020 6d6f  used..        mo
+00016bd0: 6e69 746f 7232 2028 7374 7229 3a20 4e61  nitor2 (str): Na
+00016be0: 6d65 206f 6620 7468 6520 6d65 7472 6963  me of the metric
+00016bf0: 2074 6f20 6d6f 6e69 746f 722e 2049 6620   to monitor. If 
+00016c00: 604e 6f6e 6560 2c20 7468 6973 206d 6f6e  `None`, this mon
+00016c10: 6974 6f72 2077 696c 6c20 6e6f 7420 6265  itor will not be
+00016c20: 2075 7365 642e 0a20 2020 2020 2020 206d   used..        m
+00016c30: 6f6e 6974 6f72 315f 7468 7265 7368 2028  onitor1_thresh (
+00016c40: 666c 6f61 7429 3a20 5468 7265 7368 6f6c  float): Threshol
+00016c50: 6420 7661 6c75 6520 666f 7220 606d 6f6e  d value for `mon
+00016c60: 6974 6f72 3160 2e0a 2020 2020 2020 2020  itor1`..        
+00016c70: 6d6f 6e69 746f 7232 5f74 6872 6573 6820  monitor2_thresh 
+00016c80: 2866 6c6f 6174 293a 2054 6872 6573 686f  (float): Thresho
+00016c90: 6c64 2076 616c 7565 2066 6f72 2060 6d6f  ld value for `mo
+00016ca0: 6e69 746f 7232 602e 0a0a 2020 2020 4174  nitor2`...    At
+00016cb0: 7472 6962 7574 6573 3a0a 2020 2020 2020  tributes:.      
+00016cc0: 2020 7374 6f70 7065 645f 6570 6f63 6820    stopped_epoch 
+00016cd0: 2869 6e74 293a 2054 6865 2065 706f 6368  (int): The epoch
+00016ce0: 2061 7420 7768 6963 6820 7468 6520 7472   at which the tr
+00016cf0: 6169 6e69 6e67 2077 6173 2073 746f 7070  aining was stopp
+00016d00: 6564 2e0a 2020 2020 2020 2020 6265 7374  ed..        best
+00016d10: 5f6d 6574 7269 6320 2866 6c6f 6174 293a  _metric (float):
+00016d20: 2054 6865 2062 6573 7420 6d65 7472 6963   The best metric
+00016d30: 2076 616c 7565 2061 6368 6965 7665 6420   value achieved 
+00016d40: 6475 7269 6e67 2074 6865 2074 7261 696e  during the train
+00016d50: 696e 672e 0a20 2020 2020 2020 2062 6573  ing..        bes
+00016d60: 745f 7765 6967 6874 7320 286e 6461 7272  t_weights (ndarr
+00016d70: 6179 293a 2054 6865 2077 6569 6768 7473  ay): The weights
+00016d80: 206f 6620 7468 6520 6d6f 6465 6c20 6174   of the model at
+00016d90: 2074 6865 2065 706f 6368 2077 6974 6820   the epoch with 
+00016da0: 7468 6520 6265 7374 206d 6574 7269 6320  the best metric 
+00016db0: 7661 6c75 652e 0a0a 2020 2020 5265 7475  value...    Retu
+00016dc0: 726e 733a 0a20 2020 2020 2020 204e 6f6e  rns:.        Non
+00016dd0: 650a 2020 2020 2222 220a 2020 2020 0a20  e.    """.    . 
+00016de0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00016df0: 7365 6c66 2c20 6d6f 6e69 746f 7231 3d4e  self, monitor1=N
+00016e00: 6f6e 652c 206d 6f6e 6974 6f72 323d 4e6f  one, monitor2=No
+00016e10: 6e65 2c20 6d6f 6e69 746f 7231 5f74 6872  ne, monitor1_thr
+00016e20: 6573 683d 4e6f 6e65 2c20 6d6f 6e69 746f  esh=None, monito
+00016e30: 7232 5f74 6872 6573 683d 4e6f 6e65 293a  r2_thresh=None):
+00016e40: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+00016e50: 2e5f 5f69 6e69 745f 5f28 2920 2323 496e  .__init__() ##In
+00016e60: 6974 6961 6c69 7a65 7320 7468 6520 696e  itializes the in
+00016e70: 6865 7269 7465 6420 6174 7472 6962 7574  herited attribut
+00016e80: 6573 2061 6e64 206d 6574 686f 6473 2066  es and methods f
+00016e90: 726f 6d20 7468 6520 7061 7265 6e74 2063  rom the parent c
+00016ea0: 6c61 7373 2061 7320 6974 2077 696c 6c20  lass as it will 
+00016eb0: 696e 6865 7269 7420 6672 6f6d 2043 616c  inherit from Cal
+00016ec0: 6c62 6163 6b0a 2020 2020 2020 2020 7365  lback.        se
+00016ed0: 6c66 2e6d 6f6e 6974 6f72 3120 3d20 6d6f  lf.monitor1 = mo
+00016ee0: 6e69 746f 7231 0a20 2020 2020 2020 2073  nitor1.        s
+00016ef0: 656c 662e 6d6f 6e69 746f 7232 203d 206d  elf.monitor2 = m
+00016f00: 6f6e 6974 6f72 320a 2020 2020 2020 2020  onitor2.        
+00016f10: 7365 6c66 2e6d 6f6e 6974 6f72 315f 7468  self.monitor1_th
+00016f20: 7265 7368 203d 206d 6f6e 6974 6f72 315f  resh = monitor1_
+00016f30: 7468 7265 7368 0a20 2020 2020 2020 2073  thresh.        s
+00016f40: 656c 662e 6d6f 6e69 746f 7232 5f74 6872  elf.monitor2_thr
+00016f50: 6573 6820 3d20 6d6f 6e69 746f 7232 5f74  esh = monitor2_t
+00016f60: 6872 6573 680a 2020 2020 2020 2020 7365  hresh.        se
+00016f70: 6c66 2e73 746f 7070 6564 5f65 706f 6368  lf.stopped_epoch
+00016f80: 203d 2030 0a20 2020 2020 2020 2073 656c   = 0.        sel
+00016f90: 662e 6265 7374 5f6d 6574 7269 6320 3d20  f.best_metric = 
+00016fa0: 666c 6f61 7428 2769 6e66 2729 200a 2020  float('inf') .  
+00016fb0: 2020 2020 2020 7365 6c66 2e62 6573 745f        self.best_
+00016fc0: 7765 6967 6874 7320 3d20 4e6f 6e65 2023  weights = None #
+00016fd0: 5769 6c6c 2075 7365 2074 6869 7320 746f  Will use this to
+00016fe0: 2073 746f 7265 2074 6865 2077 6569 6768   store the weigh
+00016ff0: 7473 2077 6974 6820 7468 6520 6265 7374  ts with the best
+00017000: 206d 6574 7269 6320 7661 6c75 6520 6275   metric value bu
+00017010: 7420 6e6f 7420 6375 7272 656e 746c 7920  t not currently 
+00017020: 6361 6c6c 6564 2069 6e20 7468 6520 726f  called in the ro
+00017030: 7574 696e 650a 0a20 2020 2064 6566 206f  utine..    def o
+00017040: 6e5f 6570 6f63 685f 656e 6428 7365 6c66  n_epoch_end(self
+00017050: 2c20 6570 6f63 682c 206c 6f67 733d 7b7d  , epoch, logs={}
+00017060: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00017070: 2020 2020 2020 2054 6869 7320 6d65 7468         This meth
+00017080: 6f64 2077 696c 6c20 6265 2063 616c 6c65  od will be calle
+00017090: 6420 6174 2074 6865 2065 6e64 206f 6620  d at the end of 
+000170a0: 6561 6368 2065 706f 6368 2064 7572 696e  each epoch durin
+000170b0: 6720 7472 6169 6e69 6e67 2e0a 0a20 2020  g training...   
+000170c0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+000170d0: 2020 2020 2020 2065 706f 6368 2028 696e         epoch (in
+000170e0: 7429 3a20 4375 7272 656e 7420 6570 6f63  t): Current epoc
+000170f0: 6820 6e75 6d62 6572 2e0a 2020 2020 2020  h number..      
+00017100: 2020 2020 2020 6c6f 6773 2028 6469 6374        logs (dict
+00017110: 293a 2044 6963 7469 6f6e 6172 7920 636f  ): Dictionary co
+00017120: 6e74 6169 6e69 6e67 2074 6865 206d 6574  ntaining the met
+00017130: 7269 6373 2066 6f72 2074 6865 2063 7572  rics for the cur
+00017140: 7265 6e74 2065 706f 6368 2e0a 0a20 2020  rent epoch...   
+00017150: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
+00017160: 2020 2020 2020 2020 2020 4e6f 6e65 0a20            None. 
+00017170: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00017180: 2020 2020 6966 2073 656c 662e 6d6f 6e69      if self.moni
+00017190: 746f 7231 2069 7320 6e6f 7420 4e6f 6e65  tor1 is not None
+000171a0: 2061 6e64 2073 656c 662e 6d6f 6e69 746f   and self.monito
+000171b0: 7232 2069 7320 6e6f 7420 4e6f 6e65 3a0a  r2 is not None:.
+000171c0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+000171d0: 656e 745f 3120 3d20 6c6f 6773 2e67 6574  ent_1 = logs.get
+000171e0: 2873 656c 662e 6d6f 6e69 746f 7231 290a  (self.monitor1).
+000171f0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00017200: 656e 745f 3220 3d20 6c6f 6773 2e67 6574  ent_2 = logs.get
+00017210: 2873 656c 662e 6d6f 6e69 746f 7232 290a  (self.monitor2).
+00017220: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00017230: 6c6f 7373 2720 6e6f 7420 696e 2073 656c  loss' not in sel
+00017240: 662e 6d6f 6e69 746f 7231 2061 6e64 2027  f.monitor1 and '
+00017250: 6c6f 7373 2720 696e 2073 656c 662e 6d6f  loss' in self.mo
+00017260: 6e69 746f 7232 3a0a 2020 2020 2020 2020  nitor2:.        
+00017270: 2020 2020 2020 2020 6966 206e 702e 6772          if np.gr
+00017280: 6561 7465 7228 6375 7272 656e 745f 312c  eater(current_1,
+00017290: 2073 656c 662e 6d6f 6e69 746f 7231 5f74   self.monitor1_t
+000172a0: 6872 6573 6829 206f 7220 6e70 2e6c 6573  hresh) or np.les
+000172b0: 735f 6571 7561 6c28 6375 7272 656e 745f  s_equal(current_
+000172c0: 322c 2073 656c 662e 6d6f 6e69 746f 7232  2, self.monitor2
+000172d0: 5f74 6872 6573 6829 3a0a 2020 2020 2020  _thresh):.      
+000172e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000172f0: 6c66 2e73 746f 7070 6564 5f65 706f 6368  lf.stopped_epoch
+00017300: 203d 2065 706f 6368 0a20 2020 2020 2020   = epoch.       
+00017310: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00017320: 662e 6d6f 6465 6c2e 7374 6f70 5f74 7261  f.model.stop_tra
+00017330: 696e 696e 6720 3d20 5472 7565 0a20 2020  ining = True.   
+00017340: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+00017350: 7265 6e74 5f6d 6574 7269 6320 3d20 6375  rent_metric = cu
+00017360: 7272 656e 745f 310a 2020 2020 2020 2020  rrent_1.        
+00017370: 2020 2020 656c 6966 2027 6c6f 7373 2720      elif 'loss' 
+00017380: 6e6f 7420 696e 2073 656c 662e 6d6f 6e69  not in self.moni
+00017390: 746f 7231 2061 6e64 2027 6c6f 7373 2720  tor1 and 'loss' 
+000173a0: 6e6f 7420 696e 2073 656c 662e 6d6f 6e69  not in self.moni
+000173b0: 746f 7232 3a0a 2020 2020 2020 2020 2020  tor2:.          
+000173c0: 2020 2020 2020 6966 206e 702e 6772 6561        if np.grea
+000173d0: 7465 7228 6375 7272 656e 745f 312c 2073  ter(current_1, s
+000173e0: 656c 662e 6d6f 6e69 746f 7231 5f74 6872  elf.monitor1_thr
+000173f0: 6573 6829 206f 7220 6e70 2e67 7265 6174  esh) or np.great
+00017400: 6572 2863 7572 7265 6e74 5f32 2c20 7365  er(current_2, se
+00017410: 6c66 2e6d 6f6e 6974 6f72 325f 7468 7265  lf.monitor2_thre
+00017420: 7368 293a 0a20 2020 2020 2020 2020 2020  sh):.           
+00017430: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+00017440: 6f70 7065 645f 6570 6f63 6820 3d20 6570  opped_epoch = ep
+00017450: 6f63 680a 2020 2020 2020 2020 2020 2020  och.            
+00017460: 2020 2020 2020 2020 7365 6c66 2e6d 6f64          self.mod
+00017470: 656c 2e73 746f 705f 7472 6169 6e69 6e67  el.stop_training
+00017480: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00017490: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+000174a0: 6d65 7472 6963 203d 2063 7572 7265 6e74  metric = current
+000174b0: 5f31 0a20 2020 2020 2020 2020 2020 2065  _1.            e
+000174c0: 6c69 6620 276c 6f73 7327 2069 6e20 7365  lif 'loss' in se
+000174d0: 6c66 2e6d 6f6e 6974 6f72 3120 616e 6420  lf.monitor1 and 
+000174e0: 276c 6f73 7327 2069 6e20 7365 6c66 2e6d  'loss' in self.m
+000174f0: 6f6e 6974 6f72 323a 0a20 2020 2020 2020  onitor2:.       
+00017500: 2020 2020 2020 2020 2069 6620 6e70 2e6c           if np.l
+00017510: 6573 735f 6571 7561 6c28 6375 7272 656e  ess_equal(curren
+00017520: 745f 312c 2073 656c 662e 6d6f 6e69 746f  t_1, self.monito
+00017530: 7231 5f74 6872 6573 6829 206f 7220 6e70  r1_thresh) or np
+00017540: 2e6c 6573 735f 6571 7561 6c28 6375 7272  .less_equal(curr
+00017550: 656e 745f 322c 2073 656c 662e 6d6f 6e69  ent_2, self.moni
+00017560: 746f 7232 5f74 6872 6573 6829 3a0a 2020  tor2_thresh):.  
+00017570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017580: 2020 7365 6c66 2e73 746f 7070 6564 5f65    self.stopped_e
+00017590: 706f 6368 203d 2065 706f 6368 0a20 2020  poch = epoch.   
+000175a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000175b0: 2073 656c 662e 6d6f 6465 6c2e 7374 6f70   self.model.stop
+000175c0: 5f74 7261 696e 696e 6720 3d20 5472 7565  _training = True
+000175d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000175e0: 2063 7572 7265 6e74 5f6d 6574 7269 6320   current_metric 
+000175f0: 3d20 6375 7272 656e 745f 310a 2020 2020  = current_1.    
+00017600: 2020 2020 2020 2020 656c 6966 2027 6c6f          elif 'lo
+00017610: 7373 2720 696e 2073 656c 662e 6d6f 6e69  ss' in self.moni
+00017620: 746f 7231 2061 6e64 2027 6c6f 7373 2720  tor1 and 'loss' 
+00017630: 6e6f 7420 696e 2073 656c 662e 6d6f 6e69  not in self.moni
+00017640: 746f 7232 3a0a 2020 2020 2020 2020 2020  tor2:.          
+00017650: 2020 2020 2020 6966 206e 702e 6c65 7373        if np.less
+00017660: 5f65 7175 616c 2863 7572 7265 6e74 5f31  _equal(current_1
+00017670: 2c20 7365 6c66 2e6d 6f6e 6974 6f72 315f  , self.monitor1_
+00017680: 7468 7265 7368 2920 6f72 206e 702e 6772  thresh) or np.gr
+00017690: 6561 7465 7228 6375 7272 656e 745f 322c  eater(current_2,
+000176a0: 2073 656c 662e 6d6f 6e69 746f 7232 5f74   self.monitor2_t
+000176b0: 6872 6573 6829 3a0a 2020 2020 2020 2020  hresh):.        
+000176c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000176d0: 2e73 746f 7070 6564 5f65 706f 6368 203d  .stopped_epoch =
+000176e0: 2065 706f 6368 0a20 2020 2020 2020 2020   epoch.         
+000176f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00017700: 6d6f 6465 6c2e 7374 6f70 5f74 7261 696e  model.stop_train
+00017710: 696e 6720 3d20 5472 7565 0a20 2020 2020  ing = True.     
+00017720: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00017730: 6e74 5f6d 6574 7269 6320 3d20 6375 7272  nt_metric = curr
+00017740: 656e 745f 310a 2020 2020 2020 2020 2020  ent_1.          
+00017750: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00017760: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00017770: 6c75 6545 7272 6f72 2827 496e 7661 6c69  lueError('Invali
+00017780: 6420 6d6f 6e69 746f 7220 696e 7075 742e  d monitor input.
+00017790: 2729 0a20 2020 2020 2020 2020 2020 200a  ').            .
+000177a0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+000177b0: 7572 7265 6e74 5f6d 6574 7269 6320 3c20  urrent_metric < 
+000177c0: 7365 6c66 2e62 6573 745f 6d65 7472 6963  self.best_metric
+000177d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000177e0: 2020 7365 6c66 2e62 6573 745f 6d65 7472    self.best_metr
+000177f0: 6963 203d 2063 7572 7265 6e74 5f6d 6574  ic = current_met
+00017800: 7269 630a 2020 2020 2020 2020 2020 2020  ric.            
+00017810: 2020 2020 7365 6c66 2e62 6573 745f 7765      self.best_we
+00017820: 6967 6874 7320 3d20 7365 6c66 2e6d 6f64  ights = self.mod
+00017830: 656c 2e67 6574 5f77 6569 6768 7473 2829  el.get_weights()
+00017840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017850: 200a 2020 2020 2020 2020 656c 7365 3a0a   .        else:.
+00017860: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00017870: 656e 745f 6d65 7472 6963 203d 206c 6f67  ent_metric = log
+00017880: 732e 6765 7428 7365 6c66 2e6d 6f6e 6974  s.get(self.monit
+00017890: 6f72 3129 0a20 2020 2020 2020 2020 2020  or1).           
+000178a0: 2069 6620 276c 6f73 7327 206e 6f74 2069   if 'loss' not i
+000178b0: 6e20 7365 6c66 2e6d 6f6e 6974 6f72 313a  n self.monitor1:
+000178c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000178d0: 2069 6620 6e70 2e67 7265 6174 6572 2863   if np.greater(c
+000178e0: 7572 7265 6e74 5f6d 6574 7269 632c 2073  urrent_metric, s
+000178f0: 656c 662e 6d6f 6e69 746f 7231 5f74 6872  elf.monitor1_thr
+00017900: 6573 6829 3a0a 2020 2020 2020 2020 2020  esh):.          
+00017910: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00017920: 746f 7070 6564 5f65 706f 6368 203d 2065  topped_epoch = e
+00017930: 706f 6368 0a20 2020 2020 2020 2020 2020  poch.           
+00017940: 2020 2020 2020 2020 2073 656c 662e 6d6f           self.mo
+00017950: 6465 6c2e 7374 6f70 5f74 7261 696e 696e  del.stop_trainin
+00017960: 6720 3d20 5472 7565 0a20 2020 2020 2020  g = True.       
+00017970: 2020 2020 2020 2020 2069 6620 6375 7272           if curr
+00017980: 656e 745f 6d65 7472 6963 203c 2073 656c  ent_metric < sel
+00017990: 662e 6265 7374 5f6d 6574 7269 633a 0a20  f.best_metric:. 
+000179a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000179b0: 2020 2073 656c 662e 6265 7374 5f6d 6574     self.best_met
+000179c0: 7269 6320 3d20 6375 7272 656e 745f 6d65  ric = current_me
+000179d0: 7472 6963 0a20 2020 2020 2020 2020 2020  tric.           
+000179e0: 2020 2020 2020 2020 2073 656c 662e 6265           self.be
+000179f0: 7374 5f77 6569 6768 7473 203d 2073 656c  st_weights = sel
+00017a00: 662e 6d6f 6465 6c2e 6765 745f 7765 6967  f.model.get_weig
+00017a10: 6874 7328 290a 2020 2020 2020 2020 2020  hts().          
+00017a20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00017a30: 2020 2020 2020 2020 6966 206e 702e 6c65          if np.le
+00017a40: 7373 5f65 7175 616c 2863 7572 7265 6e74  ss_equal(current
+00017a50: 5f6d 6574 7269 632c 2073 656c 662e 6d6f  _metric, self.mo
+00017a60: 6e69 746f 7231 5f74 6872 6573 6829 3a0a  nitor1_thresh):.
+00017a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a80: 2020 2020 7365 6c66 2e73 746f 7070 6564      self.stopped
+00017a90: 5f65 706f 6368 203d 2065 706f 6368 0a20  _epoch = epoch. 
+00017aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ab0: 2020 2073 656c 662e 6d6f 6465 6c2e 7374     self.model.st
+00017ac0: 6f70 5f74 7261 696e 696e 6720 3d20 5472  op_training = Tr
+00017ad0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00017ae0: 2020 2069 6620 6375 7272 656e 745f 6d65     if current_me
+00017af0: 7472 6963 203c 2073 656c 662e 6265 7374  tric < self.best
+00017b00: 5f6d 6574 7269 633a 0a20 2020 2020 2020  _metric:.       
+00017b10: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00017b20: 662e 6265 7374 5f6d 6574 7269 6320 3d20  f.best_metric = 
+00017b30: 6375 7272 656e 745f 6d65 7472 6963 0a20  current_metric. 
+00017b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b50: 2020 2073 656c 662e 6265 7374 5f77 6569     self.best_wei
+00017b60: 6768 7473 203d 2073 656c 662e 6d6f 6465  ghts = self.mode
+00017b70: 6c2e 6765 745f 7765 6967 6874 7328 290a  l.get_weights().
+00017b80: 0a0a 6465 6620 6879 7065 725f 6f70 7428  ..def hyper_opt(
+00017b90: 6461 7461 5f78 3d4e 6f6e 652c 2064 6174  data_x=None, dat
+00017ba0: 615f 793d 4e6f 6e65 2c20 7661 6c5f 583d  a_y=None, val_X=
+00017bb0: 4e6f 6e65 2c20 7661 6c5f 593d 4e6f 6e65  None, val_Y=None
+00017bc0: 2c20 696d 675f 6e75 6d5f 6368 616e 6e65  , img_num_channe
+00017bd0: 6c73 3d31 2c20 636c 663d 2761 6c65 786e  ls=1, clf='alexn
+00017be0: 6574 272c 200a 2020 2020 6e6f 726d 616c  et', .    normal
+00017bf0: 697a 653d 5472 7565 2c20 6d69 6e5f 7069  ize=True, min_pi
+00017c00: 7865 6c3d 302c 206d 6178 5f70 6978 656c  xel=0, max_pixel
+00017c10: 3d31 3030 302c 206e 5f69 7465 723d 3235  =1000, n_iter=25
+00017c20: 2c20 7061 7469 656e 6365 3d35 2c20 6d65  , patience=5, me
+00017c30: 7472 6963 3d27 6c6f 7373 272c 2061 7665  tric='loss', ave
+00017c40: 7261 6765 3d54 7275 652c 200a 2020 2020  rage=True, .    
+00017c50: 7465 7374 5f70 6f73 6974 6976 653d 4e6f  test_positive=No
+00017c60: 6e65 2c20 7465 7374 5f6e 6567 6174 6976  ne, test_negativ
+00017c70: 653d 4e6f 6e65 2c20 6f70 745f 6d6f 6465  e=None, opt_mode
+00017c80: 6c3d 5472 7565 2c20 6261 7463 685f 7369  l=True, batch_si
+00017c90: 7a65 5f6d 696e 3d31 362c 2062 6174 6368  ze_min=16, batch
+00017ca0: 5f73 697a 655f 6d61 783d 3634 2c20 7472  _size_max=64, tr
+00017cb0: 6169 6e5f 6570 6f63 6873 3d32 352c 206f  ain_epochs=25, o
+00017cc0: 7074 5f63 763d 4e6f 6e65 2c0a 2020 2020  pt_cv=None,.    
+00017cd0: 6f70 745f 6175 673d 4661 6c73 652c 2062  opt_aug=False, b
+00017ce0: 6174 6368 5f6d 696e 3d32 2c20 6261 7463  atch_min=2, batc
+00017cf0: 685f 6d61 783d 3235 2c20 6261 7463 685f  h_max=25, batch_
+00017d00: 6f74 6865 723d 312c 2062 616c 616e 6365  other=1, balance
+00017d10: 3d54 7275 652c 2069 6d61 6765 5f73 697a  =True, image_siz
+00017d20: 655f 6d69 6e3d 3530 2c20 696d 6167 655f  e_min=50, image_
+00017d30: 7369 7a65 5f6d 6178 3d31 3030 2c20 7368  size_max=100, sh
+00017d40: 6966 743d 3130 2c20 6f70 745f 6d61 785f  ift=10, opt_max_
+00017d50: 6d69 6e5f 7069 783d 4e6f 6e65 2c20 6f70  min_pix=None, op
+00017d60: 745f 6d61 785f 6d61 785f 7069 783d 4e6f  t_max_max_pix=No
+00017d70: 6e65 2c20 0a20 2020 206d 6173 6b5f 7369  ne, .    mask_si
+00017d80: 7a65 3d4e 6f6e 652c 206e 756d 5f6d 6173  ze=None, num_mas
+00017d90: 6b73 3d4e 6f6e 652c 2073 6d6f 7465 5f73  ks=None, smote_s
+00017da0: 616d 706c 696e 673d 302c 2062 6c65 6e64  ampling=0, blend
+00017db0: 5f6d 6178 3d30 2c20 6e75 6d5f 696d 6167  _max=0, num_imag
+00017dc0: 6573 5f74 6f5f 626c 656e 643d 322c 2062  es_to_blend=2, b
+00017dd0: 6c65 6e64 696e 675f 6675 6e63 3d27 6d65  lending_func='me
+00017de0: 616e 272c 2062 6c65 6e64 5f6f 7468 6572  an', blend_other
+00017df0: 3d31 2c20 7a6f 6f6d 5f72 616e 6765 3d28  =1, zoom_range=(
+00017e00: 302e 392c 312e 3129 2c20 736b 6577 5f61  0.9,1.1), skew_a
+00017e10: 6e67 6c65 3d30 2c0a 2020 2020 6c69 6d69  ngle=0,.    limi
+00017e20: 745f 7365 6172 6368 3d54 7275 652c 206d  t_search=True, m
+00017e30: 6f6e 6974 6f72 313d 4e6f 6e65 2c20 6d6f  onitor1=None, mo
+00017e40: 6e69 746f 7232 3d4e 6f6e 652c 206d 6f6e  nitor2=None, mon
+00017e50: 6974 6f72 315f 7468 7265 7368 3d4e 6f6e  itor1_thresh=Non
+00017e60: 652c 206d 6f6e 6974 6f72 325f 7468 7265  e, monitor2_thre
+00017e70: 7368 3d4e 6f6e 652c 2076 6572 626f 7365  sh=None, verbose
+00017e80: 3d30 2c20 7265 7475 726e 5f73 7475 6479  =0, return_study
+00017e90: 3d54 7275 6529 3a20 0a20 2020 2022 2222  =True): .    """
+00017ea0: 0a20 2020 204f 7074 696d 697a 6573 2068  .    Optimizes h
+00017eb0: 7970 6572 7061 7261 6d65 7465 7273 2075  yperparameters u
+00017ec0: 7369 6e67 2061 206b 2d66 6f6c 6420 6372  sing a k-fold cr
+00017ed0: 6f73 7320 7661 6c69 6461 7469 6f6e 2073  oss validation s
+00017ee0: 706c 6974 7469 6e67 2073 7472 6174 6567  plitting strateg
+00017ef0: 792e 0a0a 2020 2020 2a2a 494d 504f 5254  y...    **IMPORT
+00017f00: 414e 542a 2a20 496e 2074 6865 2063 6173  ANT** In the cas
+00017f10: 6520 6f66 2043 4e4e 206f 7074 696d 697a  e of CNN optimiz
+00017f20: 6174 696f 6e2c 2064 6174 615f 7820 616e  ation, data_x an
+00017f30: 6420 6461 7461 5f79 2061 7265 206e 6f74  d data_y are not
+00017f40: 2074 6865 2073 7461 6e64 6172 640a 2020   the standard.  
+00017f50: 2020 6461 7461 2070 6c75 7320 6c61 6265    data plus labe
+00017f60: 6c73 202d 2d20 4d69 6372 6f4c 4941 2061  ls -- MicroLIA a
+00017f70: 7373 756d 6573 2062 696e 6172 7920 636c  ssumes binary cl
+00017f80: 6173 7369 6669 6361 7469 6f6e 2061 6c77  assification alw
+00017f90: 6179 7320 7468 6572 6566 6f72 6520 6966  ays therefore if
+00017fa0: 206f 7074 696d 697a 696e 6720 6120 0a20   optimizing a . 
+00017fb0: 2020 2043 4e4e 2074 6865 2073 616d 706c     CNN the sampl
+00017fc0: 6573 2066 6f72 2074 6865 2066 6972 7374  es for the first
+00017fd0: 2063 6c61 7373 2073 686f 756c 6420 6265   class should be
+00017fe0: 2070 6173 7365 6420 7468 726f 7567 6820   passed through 
+00017ff0: 7468 6520 6461 7461 5f78 2070 6172 616d  the data_x param
+00018000: 6574 6572 2c20 616e 6420 7468 6520 0a20  eter, and the . 
+00018010: 2020 2073 616d 706c 6573 2066 6f72 2074     samples for t
+00018020: 6865 2073 6563 6f6e 6420 636c 6173 7320  he second class 
+00018030: 7368 6f75 6c64 2062 6520 6769 7665 6e20  should be given 
+00018040: 6173 2064 6174 615f 792e 2054 6865 7365  as data_y. These
+00018050: 2074 776f 2063 6c61 7373 6573 2077 696c   two classes wil
+00018060: 6c20 6175 746f 6d61 7469 6361 6c6c 7920  l automatically 
+00018070: 0a20 2020 2062 6520 6173 7369 676e 6564  .    be assigned
+00018080: 2074 6865 2070 6f73 6974 6976 6520 616e   the positive an
+00018090: 6420 6e65 6761 7469 7665 206c 6162 656c  d negative label
+000180a0: 7320 3120 616e 6420 302c 2072 6573 7065  s 1 and 0, respe
+000180b0: 6374 6976 656c 792e 204c 696b 6577 6973  ctively. Likewis
+000180c0: 652c 2069 6620 6f70 7469 6d69 7a69 6e67  e, if optimizing
+000180d0: 2061 200a 2020 2020 434e 4e20 6d6f 6465   a .    CNN mode
+000180e0: 6c2c 2076 616c 5f58 2063 6f72 7265 7370  l, val_X corresp
+000180f0: 6f6e 6473 2074 6f20 7468 6520 696d 6167  onds to the imag
+00018100: 6573 206f 6620 7468 6520 6669 7273 7420  es of the first 
+00018110: 636c 6173 732c 2061 6e64 2076 616c 5f59  class, and val_Y
+00018120: 2074 6865 2069 6d61 6765 7320 6f66 2074   the images of t
+00018130: 6865 2073 6563 6f6e 6420 636c 6173 732e  he second class.
+00018140: 200a 2020 2020 0a20 2020 2049 6620 7361   .    .    If sa
+00018150: 7665 5f73 7475 6479 3d54 7275 652c 2074  ve_study=True, t
+00018160: 6865 204f 7074 756e 6120 7374 7564 7920  he Optuna study 
+00018170: 6f62 6a65 6374 2077 696c 6c20 6265 2074  object will be t
+00018180: 6865 2074 6869 7264 206f 7574 7075 742e  he third output.
+00018190: 2054 6869 730a 2020 2020 6f62 6a65 6374   This.    object
+000181a0: 2063 616e 2062 6520 7573 6564 2066 6f72   can be used for
+000181b0: 2076 6172 696f 7573 2061 6e61 6c79 7369   various analysi
+000181c0: 732c 2069 6e63 6c75 6469 6e67 206f 7074  s, including opt
+000181d0: 696d 697a 6174 696f 6e20 7669 7375 616c  imization visual
+000181e0: 697a 6174 696f 6e73 2e0a 2020 2020 5365  izations..    Se
+000181f0: 653a 2068 7474 7073 3a2f 2f6f 7074 756e  e: https://optun
+00018200: 612e 7265 6164 7468 6564 6f63 732e 696f  a.readthedocs.io
+00018210: 2f65 6e2f 7374 6162 6c65 2f72 6566 6572  /en/stable/refer
+00018220: 656e 6365 2f67 656e 6572 6174 6564 2f6f  ence/generated/o
+00018230: 7074 756e 612e 7374 7564 792e 5374 7564  ptuna.study.Stud
+00018240: 792e 6874 6d6c 0a0a 2020 2020 4578 616d  y.html..    Exam
+00018250: 706c 653a 0a20 2020 2020 2020 2054 6865  ple:.        The
+00018260: 2066 756e 6374 696f 6e20 7769 6c6c 2063   function will c
+00018270: 7265 6174 6520 7468 6520 636c 6173 7369  reate the classi
+00018280: 6669 6361 7469 6f6e 2065 6e67 696e 6520  fication engine 
+00018290: 616e 6420 6f70 7469 6d69 7a65 2074 6865  and optimize the
+000182a0: 2068 7970 6572 7061 7261 6d65 7465 7273   hyperparameters
+000182b0: 0a20 2020 2020 2020 2075 7369 6e67 2061  .        using a
+000182c0: 6e20 6974 6572 6174 6976 6520 6170 7072  n iterative appr
+000182d0: 6f61 6368 3a0a 0a20 2020 2020 2020 203e  oach:..        >
+000182e0: 3e3e 206d 6f64 656c 2c20 7061 7261 6d73  >> model, params
+000182f0: 203d 2068 7970 6572 5f6f 7074 2864 6174   = hyper_opt(dat
+00018300: 615f 782c 2064 6174 615f 792c 2063 6c66  a_x, data_y, clf
+00018310: 3d27 7266 2729 200a 2020 2020 2020 2020  ='rf') .        
+00018320: 0a20 2020 2020 2020 2054 6865 2066 6972  .        The fir
+00018330: 7374 206f 7574 7075 7420 6973 206f 7572  st output is our
+00018340: 206f 7074 696d 616c 2063 6c61 7373 6966   optimal classif
+00018350: 6965 722c 2061 6e64 2077 696c 6c20 6265  ier, and will be
+00018360: 2075 7365 6420 746f 206d 616b 6520 7072   used to make pr
+00018370: 6564 6963 7469 6f6e 733a 0a20 2020 2020  edictions:.     
+00018380: 2020 200a 2020 2020 2020 2020 3e3e 3e20     .        >>> 
+00018390: 7072 6564 6963 7469 6f6e 203d 206d 6f64  prediction = mod
+000183a0: 656c 2e70 7265 6469 6374 286e 6577 5f64  el.predict(new_d
+000183b0: 6174 6129 0a20 2020 2020 2020 200a 2020  ata).        .  
+000183c0: 2020 2020 2020 5468 6520 7365 636f 6e64        The second
+000183d0: 206f 7574 7075 7420 6f66 2074 6865 206f   output of the o
+000183e0: 7074 696d 697a 6520 6675 6e63 7469 6f6e  ptimize function
+000183f0: 2069 7320 7468 6520 6469 6374 696f 6e61   is the dictiona
+00018400: 7279 2063 6f6e 7461 696e 696e 670a 2020  ry containing.  
+00018410: 2020 2020 2020 7468 6520 6879 7065 7270        the hyperp
+00018420: 6172 616d 6574 6572 2063 6f6d 6269 6e61  arameter combina
+00018430: 7469 6f6e 2074 6861 7420 7969 656c 6465  tion that yielde
+00018440: 6420 7468 6520 6869 6768 6573 7420 6d65  d the highest me
+00018450: 616e 2061 6363 7572 6163 792e 0a0a 2020  an accuracy...  
+00018460: 2020 2020 2020 4966 2073 6176 655f 7374        If save_st
+00018470: 7564 7920 3d20 5472 7565 2c20 7468 6520  udy = True, the 
+00018480: 4f70 7475 6e61 2073 7475 6479 206f 626a  Optuna study obj
+00018490: 6563 7420 7769 6c6c 2061 6c73 6f20 6265  ect will also be
+000184a0: 2072 6574 7572 6e65 6420 6173 2074 6865   returned as the
+000184b0: 2074 6869 7264 206f 7574 7075 742e 0a20   third output.. 
+000184c0: 2020 2020 2020 2054 6869 7320 6361 6e20         This can 
+000184d0: 6265 2075 7365 6420 746f 2070 6c6f 7420  be used to plot 
+000184e0: 7468 6520 6f70 7469 6d69 7a61 7469 6f6e  the optimization
+000184f0: 2072 6573 756c 7473 2c20 7365 653a 2068   results, see: h
+00018500: 7474 7073 3a2f 2f6f 7074 756e 612e 7265  ttps://optuna.re
+00018510: 6164 7468 6564 6f63 732e 696f 2f65 6e2f  adthedocs.io/en/
+00018520: 6c61 7465 7374 2f74 7574 6f72 6961 6c2f  latest/tutorial/
+00018530: 3130 5f6b 6579 5f66 6561 7475 7265 732f  10_key_features/
+00018540: 3030 355f 7669 7375 616c 697a 6174 696f  005_visualizatio
+00018550: 6e2e 6874 6d6c 2373 7068 782d 676c 722d  n.html#sphx-glr-
+00018560: 7475 746f 7269 616c 2d31 302d 6b65 792d  tutorial-10-key-
+00018570: 6665 6174 7572 6573 2d30 3035 2d76 6973  features-005-vis
+00018580: 7561 6c69 7a61 7469 6f6e 2d70 790a 0a20  ualization-py.. 
+00018590: 2020 2020 2020 203e 3e3e 2066 726f 6d20         >>> from 
+000185a0: 6f70 7475 6e61 2e76 6973 7561 6c69 7a61  optuna.visualiza
+000185b0: 7469 6f6e 2e6d 6174 706c 6f74 6c69 6220  tion.matplotlib 
+000185c0: 696d 706f 7274 2070 6c6f 745f 636f 6e74  import plot_cont
+000185d0: 6f75 720a 2020 2020 2020 2020 3e3e 3e20  our.        >>> 
+000185e0: 0a20 2020 2020 2020 203e 3e3e 206d 6f64  .        >>> mod
+000185f0: 656c 2c20 7061 7261 6d73 2c20 7374 7564  el, params, stud
+00018600: 7920 3d20 6879 7065 725f 6f70 7428 6461  y = hyper_opt(da
+00018610: 7461 5f78 2c20 6461 7461 5f79 2c20 636c  ta_x, data_y, cl
+00018620: 663d 2772 6627 2c20 7361 7665 5f73 7475  f='rf', save_stu
+00018630: 6479 3d54 7275 6529 200a 2020 2020 2020  dy=True) .      
+00018640: 2020 3e3e 3e20 706c 6f74 5f63 6f6e 746f    >>> plot_conto
+00018650: 7572 2873 7475 6479 290a 0a20 2020 2020  ur(study)..     
+00018660: 2020 2049 6620 636c 663d 2761 6c65 786e     If clf='alexn
+00018670: 6574 2720 6f72 2061 6e79 206f 6620 7468  et' or any of th
+00018680: 6520 434e 4e20 6f70 7469 6f6e 732c 2074  e CNN options, t
+00018690: 6865 206d 6f64 656c 2069 7320 6e6f 7420  he model is not 
+000186a0: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
+000186b0: 2020 0a20 2020 2041 7267 733a 0a20 2020    .    Args:.   
+000186c0: 2020 2020 2064 6174 615f 7820 286e 6461       data_x (nda
+000186d0: 7272 6179 293a 2032 4420 6172 7261 7920  rray): 2D array 
+000186e0: 6f66 2073 697a 6520 286e 2078 206d 292c  of size (n x m),
+000186f0: 2077 6865 7265 206e 2069 7320 7468 650a   where n is the.
+00018700: 2020 2020 2020 2020 2020 2020 6e75 6d62              numb
+00018710: 6572 206f 6620 7361 6d70 6c65 732c 2061  er of samples, a
+00018720: 6e64 206d 2074 6865 206e 756d 6265 7220  nd m the number 
+00018730: 6f66 2066 6561 7475 7265 732e 2049 6620  of features. If 
+00018740: 636c 663d 2761 6c65 786e 6574 2720 6f72  clf='alexnet' or
+00018750: 2061 6e79 206f 6620 7468 6520 434e 4e20   any of the CNN 
+00018760: 6f70 7469 6f6e 732c 200a 2020 2020 2020  options, .      
+00018770: 2020 2020 2020 7468 6520 7361 6d70 6c65        the sample
+00018780: 7320 666f 7220 7468 6520 6669 7273 7420  s for the first 
+00018790: 636c 6173 7320 7368 6f75 6c64 2062 6520  class should be 
+000187a0: 7061 7373 6564 2c20 7768 6963 6820 7769  passed, which wi
+000187b0: 6c6c 2061 7574 6f6d 6174 6963 616c 6c79  ll automatically
+000187c0: 200a 2020 2020 2020 2020 2020 2020 6265   .            be
+000187d0: 2061 7373 6967 6e65 6420 7468 6520 706f   assigned the po
+000187e0: 7369 7469 7665 206c 6162 656c 2027 3127  sitive label '1'
+000187f0: 2e0a 2020 2020 2020 2020 6461 7461 5f79  ..        data_y
+00018800: 2028 6e64 6172 7261 792c 2073 7472 293a   (ndarray, str):
+00018810: 2031 4420 6172 7261 7920 636f 6e74 6169   1D array contai
+00018820: 6e69 6e67 2074 6865 2063 6f72 7265 7370  ning the corresp
+00018830: 6f6e 696e 6720 6c61 6265 6c73 2e20 4966  oning labels. If
+00018840: 2063 6c66 3d27 616c 6578 6e65 7427 206f   clf='alexnet' o
+00018850: 7220 616e 7920 6f66 2074 6865 2043 4e4e  r any of the CNN
+00018860: 206f 7074 696f 6e73 2c20 0a20 2020 2020   options, .     
+00018870: 2020 2020 2020 2074 6865 2073 616d 706c         the sampl
+00018880: 6573 2066 6f72 2074 6865 2073 6563 6f6e  es for the secon
+00018890: 6420 636c 6173 7320 7368 6f75 6c64 2062  d class should b
+000188a0: 6520 7061 7373 6564 2c20 7768 6963 6820  e passed, which 
+000188b0: 7769 6c6c 2061 7574 6f6d 6174 6963 616c  will automatical
+000188c0: 6c79 0a20 2020 2020 2020 2020 2020 2062  ly.            b
+000188d0: 6520 6173 7369 676e 6564 2074 6865 206e  e assigned the n
+000188e0: 6567 6174 6976 6520 6c61 6265 6c20 2730  egative label '0
+000188f0: 272e 0a20 2020 2020 2020 2063 6c66 2028  '..        clf (
+00018900: 7374 7229 3a20 5468 6520 6d61 6368 696e  str): The machin
+00018910: 6520 6c65 6172 6e69 6e67 2063 6c61 7373  e learning class
+00018920: 6966 6965 7220 746f 206f 7074 696d 697a  ifier to optimiz
+00018930: 652e 2043 616e 2065 6974 6865 7220 6265  e. Can either be
+00018940: 0a20 2020 2020 2020 2020 2020 2027 7266  .            'rf
+00018950: 2720 666f 7220 5261 6e64 6f6d 2046 6f72  ' for Random For
+00018960: 6573 742c 2027 6e6e 2720 666f 7220 4e65  est, 'nn' for Ne
+00018970: 7572 616c 204e 6574 776f 726b 2c20 2778  ural Network, 'x
+00018980: 6762 2720 666f 7220 6558 7472 656d 6520  gb' for eXtreme 
+00018990: 4772 6164 6965 6e74 2042 6f6f 7374 696e  Gradient Boostin
+000189a0: 672c 0a20 2020 2020 2020 2020 2020 206f  g,.            o
+000189b0: 7220 2761 6c65 786e 6574 2720 6f72 2061  r 'alexnet' or a
+000189c0: 6e79 206f 6620 7468 6520 434e 4e20 6f70  ny of the CNN op
+000189d0: 7469 6f6e 732c 2066 6f72 2043 6f6e 766f  tions, for Convo
+000189e0: 6c75 7469 6f6e 616c 204e 6575 7261 6c20  lutional Neural 
+000189f0: 4e65 7477 6f72 6b2e 2044 6566 6175 6c74  Network. Default
+00018a00: 7320 746f 2027 7266 272e 0a20 2020 2020  s to 'rf'..     
+00018a10: 2020 206e 5f69 7465 7220 2869 6e74 2c20     n_iter (int, 
+00018a20: 6f70 7469 6f6e 616c 293a 2054 6865 206d  optional): The m
+00018a30: 6178 696d 756d 206e 756d 6265 7220 6f66  aximum number of
+00018a40: 2069 7465 7261 7469 6f6e 7320 746f 2070   iterations to p
+00018a50: 6572 666f 726d 2064 7572 696e 6720 0a20  erform during . 
+00018a60: 2020 2020 2020 2020 2020 2074 6865 2068             the h
+00018a70: 7970 6572 7061 7261 6d65 7465 7220 7365  yperparameter se
+00018a80: 6172 6368 2e20 4465 6661 756c 7473 2074  arch. Defaults t
+00018a90: 6f20 3235 2e0a 2020 2020 2020 2020 6f70  o 25..        op
+00018aa0: 745f 6376 2028 696e 7429 3a20 4372 6f73  t_cv (int): Cros
+00018ab0: 732d 7661 6c69 6461 7469 6f6e 7320 746f  s-validations to
+00018ac0: 2070 6572 666f 726d 2077 6865 6e20 6173   perform when as
+00018ad0: 7365 7369 6e67 2074 6865 2070 6572 666f  sesing the perfo
+00018ae0: 726d 616e 6365 2061 7420 6561 6368 0a20  rmance at each. 
+00018af0: 2020 2020 2020 2020 2020 2068 7970 6572             hyper
+00018b00: 7061 7261 6d65 7465 7220 6f70 7469 6d69  parameter optimi
+00018b10: 7a61 7469 6f6e 2074 7269 616c 2e20 466f  zation trial. Fo
+00018b20: 7220 6578 616d 706c 652c 2069 6620 6376  r example, if cv
+00018b30: 3d33 2c20 7468 656e 2065 6163 6820 6f70  =3, then each op
+00018b40: 7469 6d69 7a61 7469 6f6e 2074 7269 616c  timization trial
+00018b50: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
+00018b60: 6c20 6265 2061 7373 6573 7365 6420 6163  l be assessed ac
+00018b70: 636f 7264 696e 6720 746f 2074 6865 2033  cording to the 3
+00018b80: 2d66 6f6c 6420 6372 6f73 7320 7661 6c69  -fold cross vali
+00018b90: 6461 7469 6f6e 2061 6363 7572 6163 792e  dation accuracy.
+00018ba0: 200a 2020 2020 2020 2020 2020 2020 4966   .            If
+00018bb0: 2063 6c66 3d27 7867 6227 2061 6e64 2074   clf='xgb' and t
+00018bc0: 6869 7320 7661 6c75 6520 6973 2073 6574  his value is set
+00018bd0: 2062 6574 7765 656e 2030 2061 6e64 2031   between 0 and 1
+00018be0: 2c20 7468 6973 2073 6574 7320 7468 6520  , this sets the 
+00018bf0: 7369 7a65 206f 6620 7468 6520 7661 6c69  size of the vali
+00018c00: 6461 7469 6f6e 2064 6174 612c 200a 2020  dation data, .  
+00018c10: 2020 2020 2020 2020 2020 7768 6963 6820            which 
+00018c20: 7769 6c6c 2062 6520 6368 6f73 656e 2072  will be chosen r
+00018c30: 616e 646f 6d6c 7920 6561 6368 2074 7269  andomly each tri
+00018c40: 616c 2e20 5468 6973 2069 7320 7573 6564  al. This is used
+00018c50: 2074 6f20 656e 6162 6c65 2061 6e20 6561   to enable an ea
+00018c60: 726c 7920 7374 6f70 7069 6e67 2063 616c  rly stopping cal
+00018c70: 6c62 6163 6b20 7768 6963 6820 0a20 2020  lback which .   
+00018c80: 2020 2020 2020 2020 2069 7320 6e6f 7420           is not 
+00018c90: 706f 7373 6962 6c65 2077 6974 6820 7468  possible with th
+00018ca0: 6520 6372 6f73 732d 7661 6c69 6461 7469  e cross-validati
+00018cb0: 6f6e 206d 6574 686f 642e 2044 6566 6175  on method. Defau
+00018cc0: 6c74 7320 746f 2031 302e 200a 2020 2020  lts to 10. .    
+00018cd0: 2020 2020 6c69 6d69 745f 7365 6172 6368      limit_search
+00018ce0: 2028 626f 6f6c 293a 2049 6620 5472 7565   (bool): If True
+00018cf0: 2074 6865 206f 7074 696d 697a 6174 696f   the optimizatio
+00018d00: 6e20 7365 6172 6368 2073 7061 6365 7320  n search spaces 
+00018d10: 7769 6c6c 2062 6520 6c69 6d69 7465 642c  will be limited,
+00018d20: 2066 6f72 2063 6f6d 7075 7461 7469 6f6e   for computation
+00018d30: 616c 2061 6e64 2074 696d 6520 7075 7270  al and time purp
+00018d40: 6f73 6573 2e20 0a20 2020 2020 2020 2020  oses. .         
+00018d50: 2020 2054 6869 7320 6973 2065 7370 6563     This is espec
+00018d60: 6961 6c6c 7920 696d 706f 7274 616e 7420  ially important 
+00018d70: 6966 2074 756e 696e 6720 6120 434e 4e20  if tuning a CNN 
+00018d80: 6d6f 6465 6c2c 2061 7320 6d65 6d6f 7279  model, as memory
+00018d90: 2065 7272 6f72 7320 6361 6e20 6265 2065   errors can be e
+00018da0: 6e63 6f75 6e74 6572 6564 2e20 4465 6661  ncountered. Defa
+00018db0: 756c 7473 2074 6f20 5472 7565 2e0a 2020  ults to True..  
+00018dc0: 2020 2020 2020 6261 6c61 6e63 6520 2862        balance (b
+00018dd0: 6f6f 6c2c 206f 7074 696f 6e61 6c29 3a20  ool, optional): 
+00018de0: 4966 2054 7275 652c 2061 2077 6569 6768  If True, a weigh
+00018df0: 7473 2061 7272 6179 2077 696c 6c20 6265  ts array will be
+00018e00: 2063 616c 6375 6c61 7465 6420 616e 6420   calculated and 
+00018e10: 7573 6564 0a20 2020 2020 2020 2020 2020  used.           
+00018e20: 2077 6865 6e20 6669 7474 696e 6720 7468   when fitting th
+00018e30: 6520 636c 6173 7369 6669 6572 2e20 5468  e classifier. Th
+00018e40: 6973 2063 616e 2069 6d70 726f 7665 2063  is can improve c
+00018e50: 6c61 7373 6966 6963 6174 696f 6e20 7768  lassification wh
+00018e60: 656e 2063 6c61 7373 6573 0a20 2020 2020  en classes.     
+00018e70: 2020 2020 2020 2061 7265 2069 6d62 616c         are imbal
+00018e80: 616e 6365 642e 2054 6869 7320 6973 206f  anced. This is o
+00018e90: 6e6c 7920 6170 706c 6965 6420 6966 2074  nly applied if t
+00018ea0: 6865 2063 6c61 7373 6966 6963 6174 696f  he classificatio
+00018eb0: 6e20 6973 2061 2062 696e 6172 7920 7461  n is a binary ta
+00018ec0: 736b 2e20 0a20 2020 2020 2020 2020 2020  sk. .           
+00018ed0: 2044 6566 6175 6c74 7320 746f 2054 7275   Defaults to Tru
+00018ee0: 652e 2049 6620 636c 663d 2761 6c65 786e  e. If clf='alexn
+00018ef0: 6574 2720 6f72 2061 6e79 206f 6620 7468  et' or any of th
+00018f00: 6520 434e 4e20 6f70 7469 6f6e 732c 2074  e CNN options, t
+00018f10: 6869 7320 7769 6c6c 2064 6574 6572 6d69  his will determi
+00018f20: 6e65 2077 6865 7468 6572 2074 6865 2074  ne whether the t
+00018f30: 776f 2063 6c61 7373 6573 0a20 2020 2020  wo classes.     
+00018f40: 2020 2020 2020 2061 7265 206b 6570 7420         are kept 
+00018f50: 7468 6520 7361 6d65 2073 697a 6520 6475  the same size du
+00018f60: 7269 6e67 206f 7074 696d 697a 6174 696f  ring optimizatio
+00018f70: 6e2c 2061 7070 6c69 6361 626c 6520 6966  n, applicable if
+00018f80: 2074 756e 696e 6720 7468 6520 6175 676d   tuning the augm
+00018f90: 656e 7461 7469 6f6e 0a20 2020 2020 2020  entation.       
+00018fa0: 2020 2020 2070 6172 616d 6574 6572 732e       parameters.
+00018fb0: 2044 6566 6175 6c74 7320 746f 2054 7275   Defaults to Tru
+00018fc0: 652e 0a20 2020 2020 2020 2072 6574 7572  e..        retur
+00018fd0: 6e5f 7374 7564 7920 2862 6f6f 6c2c 206f  n_study (bool, o
+00018fe0: 7074 696f 6e61 6c29 3a20 4966 2054 7275  ptional): If Tru
+00018ff0: 6520 7468 6520 4f70 7475 6e61 2073 7475  e the Optuna stu
+00019000: 6479 206f 626a 6563 7420 7769 6c6c 2062  dy object will b
+00019010: 6520 7265 7475 726e 6564 2e20 5468 6973  e returned. This
+00019020: 0a20 2020 2020 2020 2020 2020 2063 616e  .            can
+00019030: 2062 6520 7573 6564 2074 6f20 7265 7669   be used to revi
+00019040: 6577 2074 6865 206d 6574 686f 6420 6174  ew the method at
+00019050: 7472 6962 7574 6573 2c20 7375 6368 2061  tributes, such a
+00019060: 7320 6f70 7469 6d69 7a61 7469 6f6e 2070  s optimization p
+00019070: 6c6f 7473 2e20 4465 6661 756c 7473 2074  lots. Defaults t
+00019080: 6f20 5472 7565 2e0a 0a20 2020 2054 6865  o True...    The
+00019090: 2066 6f6c 6c6c 6f77 696e 6720 6172 6775   folllowing argu
+000190a0: 6d65 6e74 7320 6172 6520 6f6e 6c79 2075  ments are only u
+000190b0: 7365 6420 7768 656e 206f 7074 696d 697a  sed when optimiz
+000190c0: 696e 6720 7468 6520 434e 4e20 6e65 7477  ing the CNN netw
+000190d0: 6f72 6b3a 0a0a 2020 2020 4172 6773 3a0a  ork:..    Args:.
+000190e0: 2020 2020 2020 2020 696d 675f 6e75 6d5f          img_num_
+000190f0: 6368 616e 6e65 6c73 2028 696e 7429 3a20  channels (int): 
+00019100: 5468 6520 6e75 6d62 6572 206f 6620 6669  The number of fi
+00019110: 6c74 6572 732e 2044 6566 6175 6c74 7320  lters. Defaults 
+00019120: 746f 2031 2e0a 2020 2020 2020 2020 6e6f  to 1..        no
+00019130: 726d 616c 697a 6520 2862 6f6f 6c2c 206f  rmalize (bool, o
+00019140: 7074 696f 6e61 6c29 3a20 4966 2054 7275  ptional): If Tru
+00019150: 6520 7468 6520 6461 7461 2077 696c 6c20  e the data will 
+00019160: 6265 206d 696e 2d6d 6178 206e 6f72 6d61  be min-max norma
+00019170: 6c69 7a65 6420 7573 696e 6720 7468 6520  lized using the 
+00019180: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
+00019190: 7574 206d 696e 2061 6e64 206d 6178 2070  ut min and max p
+000191a0: 6978 656c 732e 2044 6566 6175 6c74 7320  ixels. Defaults 
+000191b0: 746f 2054 7275 652e 0a20 2020 2020 2020  to True..       
+000191c0: 206d 696e 5f70 6978 656c 2028 696e 742c   min_pixel (int,
+000191d0: 206f 7074 696f 6e61 6c29 3a20 5468 6520   optional): The 
+000191e0: 6d69 6e69 6d75 6d20 7069 7865 6c20 636f  minimum pixel co
+000191f0: 756e 742c 2070 6978 656c 7320 7769 7468  unt, pixels with
+00019200: 2063 6f75 6e74 7320 0a20 2020 2020 2020   counts .       
+00019210: 2020 2020 2062 656c 6f77 2074 6869 7320       below this 
+00019220: 7468 7265 7368 6f6c 6420 7769 6c6c 2062  threshold will b
+00019230: 6520 7365 7420 746f 2074 6869 7320 6c69  e set to this li
+00019240: 6d69 742e 2044 6566 6175 6c74 7320 746f  mit. Defaults to
+00019250: 2030 2e0a 2020 2020 2020 2020 6d61 785f   0..        max_
+00019260: 7069 7865 6c20 2869 6e74 2c20 6c69 7374  pixel (int, list
+00019270: 2c20 6f70 7469 6f6e 616c 293a 2054 6865  , optional): The
+00019280: 206d 6178 696d 756d 2070 6978 656c 2063   maximum pixel c
+00019290: 6f75 6e74 2c20 7069 7865 6c73 2077 6974  ount, pixels wit
+000192a0: 6820 636f 756e 7473 200a 2020 2020 2020  h counts .      
+000192b0: 2020 2020 2020 6162 6f76 6520 7468 6973        above this
+000192c0: 2074 6872 6573 686f 6c64 2077 696c 6c20   threshold will 
+000192d0: 6265 2073 6574 2074 6f20 7468 6973 206c  be set to this l
+000192e0: 696d 6974 2e20 4465 6661 756c 7473 2074  imit. Defaults t
+000192f0: 6f20 3130 302e 2049 6620 696d 675f 6e75  o 100. If img_nu
+00019300: 6d5f 6368 616e 6e65 6c73 0a20 2020 2020  m_channels.     
+00019310: 2020 2020 2020 2069 7320 6e6f 7420 312c         is not 1,
+00019320: 2074 6865 206d 6178 5f70 6978 656c 2073   the max_pixel s
+00019330: 686f 756c 6420 6265 2061 206c 6973 7420  hould be a list 
+00019340: 636f 6e74 6169 6e69 6e67 2074 776f 2076  containing two v
+00019350: 616c 7565 732c 206f 6e65 2066 6f72 2065  alues, one for e
+00019360: 6163 6820 6261 6e64 2e0a 2020 2020 2020  ach band..      
+00019370: 2020 7661 6c5f 706f 7369 7469 7665 2028    val_positive (
+00019380: 6e64 6172 7261 792c 206f 7074 696f 6e61  ndarray, optiona
+00019390: 6c29 3a20 506f 7369 7469 7665 2063 6c61  l): Positive cla
+000193a0: 7373 2064 6174 6120 746f 2062 6520 7573  ss data to be us
+000193b0: 6564 2066 6f72 2076 616c 6964 6174 696f  ed for validatio
+000193c0: 6e2e 2044 6566 6175 6c74 7320 746f 204e  n. Defaults to N
+000193d0: 6f6e 652e 0a20 2020 2020 2020 2076 616c  one..        val
+000193e0: 5f6e 6567 6174 6976 6520 286e 6461 7272  _negative (ndarr
+000193f0: 6179 2c20 6f70 7469 6f6e 616c 293a 204e  ay, optional): N
+00019400: 6567 6174 6976 6520 636c 6173 7320 6461  egative class da
+00019410: 7461 2074 6f20 6265 2075 7365 6420 666f  ta to be used fo
+00019420: 7220 7661 6c69 6461 7469 6f6e 2e20 4465  r validation. De
+00019430: 6661 756c 7473 2074 6f20 4e6f 6e65 2e0a  faults to None..
+00019440: 2020 2020 2020 2020 7465 7374 5f70 6f73          test_pos
+00019450: 6974 6976 6520 286e 6461 7272 6179 2c20  itive (ndarray, 
+00019460: 6f70 7469 6f6e 616c 293a 2050 6f73 6974  optional): Posit
+00019470: 6976 6520 636c 6173 7320 6461 7461 2074  ive class data t
+00019480: 6f20 6265 2075 7365 6420 666f 7220 706f  o be used for po
+00019490: 7374 2d74 7269 616c 2074 6573 7469 6e67  st-trial testing
+000194a0: 2e20 4465 6661 756c 7473 2074 6f20 4e6f  . Defaults to No
+000194b0: 6e65 2e0a 2020 2020 2020 2020 7465 7374  ne..        test
+000194c0: 5f6e 6567 6174 6976 6520 286e 6461 7272  _negative (ndarr
+000194d0: 6179 2c20 6f70 7469 6f6e 616c 293a 204e  ay, optional): N
+000194e0: 6567 6174 6976 6520 636c 6173 7320 6461  egative class da
+000194f0: 7461 2074 6f20 6265 2075 7365 6420 666f  ta to be used fo
+00019500: 7220 706f 7374 2d74 7269 616c 2074 6573  r post-trial tes
+00019510: 7469 6e67 2e20 4465 6661 756c 7473 2074  ting. Defaults t
+00019520: 6f20 4e6f 6e65 2e0a 2020 2020 2020 2020  o None..        
+00019530: 7472 6169 6e5f 6570 6f63 6873 2028 696e  train_epochs (in
+00019540: 7429 3a20 4e75 6d62 6572 206f 6620 6570  t): Number of ep
+00019550: 6f63 6873 2074 6f20 7468 6520 7472 6169  ochs to the trai
+00019560: 6e20 7468 6520 434e 4e20 746f 2064 7572  n the CNN to dur
+00019570: 696e 6720 7468 6520 6f70 7469 6d69 7a61  ing the optimiza
+00019580: 7469 6f6e 2074 7269 616c 732e 2044 6566  tion trials. Def
+00019590: 6175 6c74 7320 746f 2032 352e 0a20 2020  aults to 25..   
+000195a0: 2020 2020 206d 6574 7269 6320 2873 7472       metric (str
+000195b0: 293a 2041 7373 6573 6d65 6e74 206d 6574  ): Assesment met
+000195c0: 7269 6320 746f 2075 7365 2077 6865 6e20  ric to use when 
+000195d0: 626f 7468 2070 7275 6e69 6e67 2061 6e64  both pruning and
+000195e0: 2073 636f 7269 6e67 2074 6865 2068 7970   scoring the hyp
+000195f0: 6572 7061 7261 6d65 7465 7220 6f70 7469  erparameter opti
+00019600: 6d69 7a61 7469 6f6e 2074 7269 616c 2e0a  mization trial..
+00019610: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
+00019620: 756c 7473 2074 6f20 276c 6f73 7327 2e20  ults to 'loss'. 
+00019630: 4f70 7469 6f6e 7320 696e 636c 7564 653a  Options include:
+00019640: 2027 6c6f 7373 2720 2762 696e 6172 795f   'loss' 'binary_
+00019650: 6163 6375 7261 6379 272c 2027 6631 5f73  accuracy', 'f1_s
+00019660: 636f 7265 2720 2761 6c6c 2720 6f72 2074  core' 'all' or t
+00019670: 6865 2076 616c 6964 6174 696f 6e20 6571  he validation eq
+00019680: 7569 7661 6c65 6e74 7320 2865 2e67 2e20  uivalents (e.g. 
+00019690: 2776 616c 5f6c 6f73 7327 292e 0a20 2020  'val_loss')..   
+000196a0: 2020 2020 2070 6174 6965 6e63 6520 2869       patience (i
+000196b0: 6e74 293a 204e 756d 6265 7220 6f66 2065  nt): Number of e
+000196c0: 706f 6368 7320 7769 7468 6f75 7420 696d  pochs without im
+000196d0: 7072 6f76 656d 656e 7420 6265 666f 7265  provement before
+000196e0: 2074 6865 206f 7074 696d 697a 6174 696f   the optimizatio
+000196f0: 6e20 7472 6961 6c20 6973 2074 6572 6d69  n trial is termi
+00019700: 6e61 7465 642e 2044 6566 6175 6c74 7320  nated. Defaults 
+00019710: 746f 2030 2c20 7768 6963 680a 2020 2020  to 0, which.    
+00019720: 2020 2020 2020 2020 6469 7361 626c 6573          disables
+00019730: 2074 6869 7320 6665 6174 7572 652e 0a20   this feature.. 
+00019740: 2020 2020 2020 2061 7665 7261 6765 2028         average (
+00019750: 626f 6f6c 293a 2049 6620 4661 6c73 652c  bool): If False,
+00019760: 2074 6865 2064 6573 6967 6e61 7465 6420   the designated 
+00019770: 6d65 7472 6963 2077 696c 6c20 6265 2063  metric will be c
+00019780: 616c 6375 6c61 7465 6420 6163 636f 7264  alculated accord
+00019790: 696e 6720 746f 2069 7473 2076 616c 7565  ing to its value
+000197a0: 2061 7420 7468 6520 656e 6420 6f66 2074   at the end of t
+000197b0: 6865 2074 7261 696e 5f65 706f 6368 732e  he train_epochs.
+000197c0: 200a 2020 2020 2020 2020 2020 2020 4966   .            If
+000197d0: 2054 7275 652c 2074 6865 206d 6574 7269   True, the metri
+000197e0: 6320 7769 6c6c 2062 6520 6176 6572 6167  c will be averag
+000197f0: 6564 206f 7574 2061 6372 6f73 7320 616c  ed out across al
+00019800: 6c20 7472 6169 6e5f 6570 6f63 6873 2e20  l train_epochs. 
+00019810: 4465 6661 756c 7473 2074 6f20 5472 7565  Defaults to True
+00019820: 2e0a 0a20 2020 2020 2020 206f 7074 5f6d  ...        opt_m
+00019830: 6f64 656c 2028 626f 6f6c 293a 2049 6620  odel (bool): If 
+00019840: 5472 7565 2c20 7468 6520 6172 6368 6974  True, the archit
+00019850: 6563 7475 7265 2070 6172 616d 6574 6572  ecture parameter
+00019860: 7320 7769 6c6c 2062 6520 6f70 7469 6d69  s will be optimi
+00019870: 7a65 642e 2044 6566 6175 6c74 7320 746f  zed. Defaults to
+00019880: 2054 7275 652e 0a20 2020 2020 2020 206f   True..        o
+00019890: 7074 5f61 7567 2028 626f 6f6c 293a 2049  pt_aug (bool): I
+000198a0: 6620 5472 7565 2c20 7468 6520 6175 676d  f True, the augm
+000198b0: 656e 7461 7469 6f6e 2070 726f 6365 6475  entation procedu
+000198c0: 7265 2077 696c 6c20 6265 206f 7074 696d  re will be optim
+000198d0: 697a 6564 2e20 4465 6661 756c 7473 2074  ized. Defaults t
+000198e0: 6f20 4661 6c73 652e 0a20 2020 2020 2020  o False..       
+000198f0: 2062 6174 6368 5f6d 696e 2028 696e 7429   batch_min (int)
+00019900: 3a20 5468 6520 6d69 6e69 6d75 6d20 6e75  : The minimum nu
+00019910: 6d62 6572 206f 6620 6175 676d 656e 7461  mber of augmenta
+00019920: 7469 6f6e 7320 746f 2070 6572 666f 726d  tions to perform
+00019930: 2070 6572 2069 6d61 6765 206f 6e20 7468   per image on th
+00019940: 6520 706f 7369 7469 7665 2063 6c61 7373  e positive class
+00019950: 2c20 6f6e 6c79 2061 7070 6c69 6361 626c  , only applicabl
+00019960: 6520 0a20 2020 2020 2020 2020 2020 2069  e .            i
+00019970: 6620 6f70 745f 6175 673d 5472 7565 2e20  f opt_aug=True. 
+00019980: 4465 6661 756c 7473 2074 6f20 322e 0a20  Defaults to 2.. 
+00019990: 2020 2020 2020 2062 6174 6368 5f6d 6178         batch_max
+000199a0: 2028 696e 7429 3a20 5468 6520 6d61 7869   (int): The maxi
+000199b0: 6d75 6d20 6e75 6d62 6572 206f 6620 6175  mum number of au
+000199c0: 676d 656e 7461 7469 6f6e 7320 746f 2070  gmentations to p
+000199d0: 6572 666f 726d 2070 6572 2069 6d61 6765  erform per image
+000199e0: 206f 6e20 7468 6520 706f 7369 7469 7665   on the positive
+000199f0: 2063 6c61 7373 2c20 6f6e 6c79 2061 7070   class, only app
+00019a00: 6c69 6361 626c 6520 0a20 2020 2020 2020  licable .       
+00019a10: 2020 2020 2069 6620 6f70 745f 6175 673d       if opt_aug=
+00019a20: 5472 7565 2e20 4465 6661 756c 7473 2074  True. Defaults t
+00019a30: 6f20 3235 2e0a 2020 2020 2020 2020 6261  o 25..        ba
+00019a40: 7463 685f 6f74 6865 7220 2869 6e74 293a  tch_other (int):
+00019a50: 2054 6865 206e 756d 6265 7220 6f66 2061   The number of a
+00019a60: 7567 6d65 6e74 6174 696f 6e73 2074 6f20  ugmentations to 
+00019a70: 7065 7266 6f72 6d20 746f 2074 6865 206f  perform to the o
+00019a80: 7468 6572 2063 6c61 7373 2c20 7072 6573  ther class, pres
+00019a90: 756d 6564 2074 6f20 6265 2074 6865 206d  umed to be the m
+00019aa0: 616a 6f72 6974 7920 636c 6173 732e 0a20  ajority class.. 
+00019ab0: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
+00019ac0: 6c74 7320 746f 2031 2e20 5468 6973 2069  lts to 1. This i
+00019ad0: 7320 646f 6e65 2074 6f20 656e 7375 7265  s done to ensure
+00019ae0: 2061 7567 6d65 6e74 6174 696f 6e20 7465   augmentation te
+00019af0: 6368 6e69 7175 6573 2061 7265 2061 7070  chniques are app
+00019b00: 6c69 6564 2063 6f6e 7369 7374 656e 746c  lied consistentl
+00019b10: 7920 6163 726f 7373 2062 6f74 6820 636c  y across both cl
+00019b20: 6173 7365 732e 2020 2020 2020 2020 0a20  asses.        . 
+00019b30: 2020 2020 2020 2069 6d61 6765 5f73 697a         image_siz
+00019b40: 655f 6d69 6e20 2869 6e74 293a 2054 6865  e_min (int): The
+00019b50: 206d 696e 696d 756d 2069 6d61 6765 2073   minimum image s
+00019b60: 697a 6520 746f 2061 7373 6573 732c 206f  ize to assess, o
+00019b70: 6e6c 7920 6170 706c 6963 6162 6c65 2069  nly applicable i
+00019b80: 6620 6f70 745f 6175 673d 5472 7565 2e20  f opt_aug=True. 
+00019b90: 4465 6661 756c 7473 2074 6f20 3530 2e0a  Defaults to 50..
+00019ba0: 2020 2020 2020 2020 696d 6167 655f 7369          image_si
+00019bb0: 7a65 5f6d 6178 2028 696e 7429 3a20 5468  ze_max (int): Th
+00019bc0: 6520 6d61 7869 6d75 6d20 696d 6167 6520  e maximum image 
+00019bd0: 7369 7a65 2074 6f20 6173 7365 7373 2c20  size to assess, 
+00019be0: 6f6e 6c79 2061 7070 6c69 6361 626c 6520  only applicable 
+00019bf0: 6966 206f 7074 5f61 7567 3d54 7275 652e  if opt_aug=True.
+00019c00: 2044 6566 6175 6c74 7320 746f 2031 3030   Defaults to 100
+00019c10: 2e0a 2020 2020 2020 2020 6f70 745f 6d61  ..        opt_ma
+00019c20: 785f 6d69 6e5f 7069 7820 2869 6e74 2c20  x_min_pix (int, 
+00019c30: 6f70 7469 6f6e 616c 293a 2054 6865 206d  optional): The m
+00019c40: 696e 696d 756d 206d 6178 2070 6978 656c  inimum max pixel
+00019c50: 2076 616c 7565 2074 6f20 7573 6520 7768   value to use wh
+00019c60: 656e 2074 756e 696e 6720 7468 6520 6e6f  en tuning the no
+00019c70: 726d 616c 697a 6174 696f 6e20 7072 6f63  rmalization proc
+00019c80: 6564 7572 652c 200a 2020 2020 2020 2020  edure, .        
+00019c90: 2020 2020 6f6e 6c79 2061 7070 6c69 6361      only applica
+00019ca0: 626c 6520 6966 206f 7074 5f61 7567 3d54  ble if opt_aug=T
+00019cb0: 7275 652e 2044 6566 6175 6c74 7320 746f  rue. Defaults to
+00019cc0: 204e 6f6e 652e 0a20 2020 2020 2020 206f   None..        o
+00019cd0: 7074 5f6d 6178 5f6d 6178 5f70 6978 2028  pt_max_max_pix (
+00019ce0: 696e 742c 206f 7074 696f 6e61 6c29 3a20  int, optional): 
+00019cf0: 5468 6520 6d61 7869 6d75 6d20 6d61 7820  The maximum max 
+00019d00: 7069 7865 6c20 7661 6c75 6520 746f 2075  pixel value to u
+00019d10: 7365 2077 6865 6e20 7475 6e69 6e67 2074  se when tuning t
+00019d20: 6865 206e 6f72 6d61 6c69 7a61 7469 6f6e  he normalization
+00019d30: 2070 726f 6365 6475 7265 2c20 0a20 2020   procedure, .   
+00019d40: 2020 2020 2020 2020 206f 6e6c 7920 6170           only ap
+00019d50: 706c 6963 6162 6c65 2069 6620 6f70 745f  plicable if opt_
+00019d60: 6175 673d 5472 7565 2e20 4465 6661 756c  aug=True. Defaul
+00019d70: 7473 2074 6f20 4e6f 6e65 2e0a 2020 2020  ts to None..    
+00019d80: 2020 2020 7368 6966 7420 2869 6e74 293a      shift (int):
+00019d90: 2054 6865 206d 6178 2061 6c6c 6f77 6564   The max allowed
+00019da0: 2076 6572 7469 6361 6c2f 686f 7269 7a6f   vertical/horizo
+00019db0: 6e74 616c 2073 6869 6674 7320 746f 2075  ntal shifts to u
+00019dc0: 7365 2064 7572 696e 6720 7468 6520 6461  se during the da
+00019dd0: 7461 2061 7567 6d65 6e74 6174 696f 6e20  ta augmentation 
+00019de0: 726f 7574 696e 652c 206f 6e6c 7920 6170  routine, only ap
+00019df0: 706c 6963 6162 6c65 0a20 2020 2020 2020  plicable.       
+00019e00: 2020 2020 2069 6620 6f70 745f 6175 673d       if opt_aug=
+00019e10: 5472 7565 2e20 4465 6661 756c 7473 2074  True. Defaults t
+00019e20: 6f20 3130 2070 6978 656c 732e 0a20 2020  o 10 pixels..   
+00019e30: 2020 2020 206d 6173 6b5f 7369 7a65 2028       mask_size (
+00019e40: 696e 742c 206f 7074 696f 6e61 6c29 3a20  int, optional): 
+00019e50: 4966 2065 6e61 626c 6564 2c20 7468 6973  If enabled, this
+00019e60: 2077 696c 6c20 7365 7420 7468 6520 7069   will set the pi
+00019e70: 7865 6c20 6c65 6e67 7468 206f 6620 6120  xel length of a 
+00019e80: 7371 7561 7265 2063 7574 6f75 742c 2074  square cutout, t
+00019e90: 6f20 6265 2072 616e 646f 6d6c 7920 706c  o be randomly pl
+00019ea0: 6163 6564 0a20 2020 2020 2020 2020 2020  aced.           
+00019eb0: 2073 6f6d 6577 6865 7265 2069 6e20 7468   somewhere in th
+00019ec0: 6520 6175 676d 656e 7465 6420 696d 6167  e augmented imag
+00019ed0: 652e 2054 6869 7320 6375 746f 7574 2077  e. This cutout w
+00019ee0: 696c 6c20 7265 706c 6163 6520 7468 6520  ill replace the 
+00019ef0: 696d 6167 6520 7661 6c75 6573 2077 6974  image values wit
+00019f00: 6820 302c 2074 6865 7265 666f 7265 2073  h 0, therefore s
+00019f10: 6572 7669 6e67 2061 7320 6120 0a20 2020  erving as a .   
+00019f20: 2020 2020 2020 2020 2072 6567 756c 6172           regular
+00019f30: 697a 6572 2e20 4f6e 6c79 2061 7070 6c69  izer. Only appli
+00019f40: 6361 626c 6520 6966 206f 7074 5f61 7567  cable if opt_aug
+00019f50: 3d54 7275 652e 2044 6566 6175 6c74 7320  =True. Defaults 
+00019f60: 746f 204e 6f6e 652e 0a20 2020 2020 2020  to None..       
+00019f70: 206e 756d 5f6d 6173 6b73 2028 696e 742c   num_masks (int,
+00019f80: 206f 7074 696f 6e61 6c29 3a20 5468 6520   optional): The 
+00019f90: 6e75 6d62 6572 206f 6620 6d61 736b 7320  number of masks 
+00019fa0: 746f 2063 7265 6174 652c 2074 6f20 6265  to create, to be
+00019fb0: 2075 7365 6420 616c 6f6e 6773 6964 6520   used alongside 
+00019fc0: 7468 6520 6d61 736b 5f73 697a 6520 7061  the mask_size pa
+00019fd0: 7261 6d65 7465 722e 2049 6620 0a20 2020  rameter. If .   
+00019fe0: 2020 2020 2020 2020 2074 6869 7320 6973           this is
+00019ff0: 2073 6574 2074 6f20 6120 7661 6c75 6520   set to a value 
+0001a000: 6772 6561 7465 7220 7468 616e 206f 6e65  greater than one
+0001a010: 2c20 6f76 6572 6c61 7020 6d61 7920 6f63  , overlap may oc
+0001a020: 6375 722e 200a 2020 2020 2020 2020 7665  cur. .        ve
+0001a030: 7262 6f73 6520 2869 6e74 293a 2043 6f6e  rbose (int): Con
+0001a040: 7472 6f6c 7320 7468 6520 616d 6f75 6e74  trols the amount
+0001a050: 206f 6620 6f75 7470 7574 2070 7269 6e74   of output print
+0001a060: 6564 2064 7572 696e 6720 7468 6520 7472  ed during the tr
+0001a070: 6169 6e69 6e67 2070 726f 6365 7373 2e20  aining process. 
+0001a080: 4120 7661 6c75 6520 6f66 2030 2069 7320  A value of 0 is 
+0001a090: 666f 7220 7369 6c65 6e74 206d 6f64 652c  for silent mode,
+0001a0a0: 200a 2020 2020 2020 2020 2020 2020 6120   .            a 
+0001a0b0: 7661 6c75 6520 6f66 2031 2069 7320 7573  value of 1 is us
+0001a0c0: 6564 2066 6f72 2070 726f 6772 6573 7320  ed for progress 
+0001a0d0: 6261 7220 6d6f 6465 2c20 616e 6420 3220  bar mode, and 2 
+0001a0e0: 666f 7220 6f6e 6520 6c69 6e65 2070 6572  for one line per
+0001a0f0: 2065 706f 6368 206d 6f64 652e 2044 6566   epoch mode. Def
+0001a100: 6175 6c74 7320 746f 2031 2e0a 2020 2020  aults to 1..    
+0001a110: 2020 2020 736d 6f74 655f 7361 6d70 6c69      smote_sampli
+0001a120: 6e67 2028 666c 6f61 7429 3a20 5468 6520  ng (float): The 
+0001a130: 736d 6f74 655f 7361 6d70 6c69 6e67 2070  smote_sampling p
+0001a140: 6172 616d 6574 6572 2069 7320 7573 6564  arameter is used
+0001a150: 2069 6e20 7468 6520 534d 4f54 4520 616c   in the SMOTE al
+0001a160: 676f 7269 7468 6d20 746f 2073 7065 6369  gorithm to speci
+0001a170: 6679 2074 6865 2064 6573 6972 6564 200a  fy the desired .
+0001a180: 2020 2020 2020 2020 2020 2020 7261 7469              rati
+0001a190: 6f20 6f66 2074 6865 206d 696e 6f72 6974  o of the minorit
+0001a1a0: 7920 636c 6173 7320 746f 2074 6865 206d  y class to the m
+0001a1b0: 616a 6f72 6974 7920 636c 6173 732e 2044  ajority class. D
+0001a1c0: 6566 6175 6c74 7320 746f 2030 2077 6869  efaults to 0 whi
+0001a1d0: 6368 2064 6973 6162 6c65 7320 7468 6520  ch disables the 
+0001a1e0: 7072 6f63 6564 7572 652e 0a20 2020 2020  procedure..     
+0001a1f0: 2020 200a 2020 2020 5468 6520 666f 6c6c     .    The foll
+0001a200: 6c6f 7769 6e67 2061 7267 756d 656e 7473  lowing arguments
+0001a210: 2063 616e 2062 6520 7573 6564 2074 6f20   can be used to 
+0001a220: 7365 7420 6561 726c 792d 7374 6f70 7069  set early-stoppi
+0001a230: 6e67 2063 616c 6c62 6163 6b73 2e20 5468  ng callbacks. Th
+0001a240: 6573 6520 6361 6e20 6265 2075 7365 6420  ese can be used 
+0001a250: 746f 2074 6572 6d69 6e61 7465 2074 7269  to terminate tri
+0001a260: 616c 7320 7468 6174 2065 7863 6565 640a  als that exceed.
+0001a270: 2020 2020 7072 652d 6465 7465 726d 696e      pre-determin
+0001a280: 6564 2074 6872 6573 686f 6c64 732c 2077  ed thresholds, w
+0001a290: 6869 6368 206d 6179 2062 6520 696e 6469  hich may be indi
+0001a2a0: 6361 7469 7665 206f 6620 616e 206f 7665  cative of an ove
+0001a2b0: 7266 6974 206d 6f64 656c 2e0a 0a20 2020  rfit model...   
+0001a2c0: 2041 7267 733a 0a20 2020 2020 2020 206d   Args:.        m
+0001a2d0: 6f6e 6974 6f72 3120 2873 7472 2c20 6f70  onitor1 (str, op
+0001a2e0: 7469 6f6e 616c 293a 2054 6865 2066 6972  tional): The fir
+0001a2f0: 7374 206d 6574 7269 6320 746f 206d 6f6e  st metric to mon
+0001a300: 6974 6f72 2c20 6361 6e20 7461 6b65 2074  itor, can take t
+0001a310: 6865 2073 616d 6520 7661 6c75 6573 2061  he same values a
+0001a320: 7320 7468 6520 6d65 7472 6963 2061 7267  s the metric arg
+0001a330: 756d 656e 742e 2044 6566 6175 6c74 7320  ument. Defaults 
+0001a340: 746f 204e 6f6e 652e 0a20 2020 2020 2020  to None..       
+0001a350: 206d 6f6e 6974 6f72 3220 2873 7472 2c20   monitor2 (str, 
+0001a360: 6f70 7469 6f6e 616c 293a 2054 6865 2073  optional): The s
+0001a370: 6563 6f6e 6420 6d65 7472 6963 2074 6f20  econd metric to 
+0001a380: 6d6f 6e69 746f 722c 2063 616e 2074 616b  monitor, can tak
+0001a390: 6520 7468 6520 7361 6d65 2076 616c 7565  e the same value
+0001a3a0: 7320 6173 2074 6865 206d 6574 7269 6320  s as the metric 
+0001a3b0: 6172 6775 6d65 6e74 2e20 4465 6661 756c  argument. Defaul
+0001a3c0: 7473 2074 6f20 4e6f 6e65 2e0a 2020 2020  ts to None..    
+0001a3d0: 2020 2020 6d6f 6e69 746f 7231 5f74 6872      monitor1_thr
+0001a3e0: 6573 6820 2866 6c6f 6174 2c20 6f70 7469  esh (float, opti
+0001a3f0: 6f6e 616c 293a 2054 6865 2074 6872 6573  onal): The thres
+0001a400: 686f 6c64 2076 616c 7565 206f 6620 7468  hold value of th
+0001a410: 6520 6669 7273 7420 6d6f 6e69 746f 7220  e first monitor 
+0001a420: 6d65 7472 6963 2e20 4966 2074 6865 206d  metric. If the m
+0001a430: 6574 7269 6320 6973 206c 6f73 732d 7265  etric is loss-re
+0001a440: 6c61 7465 640a 2020 2020 2020 2020 2020  lated.          
+0001a450: 2020 7468 6520 7472 6169 6e69 6e67 2077    the training w
+0001a460: 696c 6c20 7374 6f70 2065 6172 6c79 2069  ill stop early i
+0001a470: 6620 7468 6520 7661 6c75 6520 6661 6c6c  f the value fall
+0001a480: 7320 6265 6c6f 7720 7468 6973 2074 6872  s below this thr
+0001a490: 6573 686f 6c64 2e20 5369 6d69 6c61 726c  eshold. Similarl
+0001a4a0: 792c 2069 6620 7468 6520 6d65 7472 6963  y, if the metric
+0001a4b0: 2069 7320 6163 6375 7261 6379 2d72 656c   is accuracy-rel
+0001a4c0: 6174 6564 2c0a 2020 2020 2020 2020 2020  ated,.          
+0001a4d0: 2020 7468 656e 2074 6865 2074 7261 696e    then the train
+0001a4e0: 696e 6720 7769 6c6c 2073 746f 7020 6561  ing will stop ea
+0001a4f0: 726c 7920 6966 2074 6865 2076 616c 7565  rly if the value
+0001a500: 2066 616c 6c73 2061 626f 7665 2074 6869   falls above thi
+0001a510: 7320 7468 7265 7368 6f6c 642e 2044 6566  s threshold. Def
+0001a520: 6175 6c74 7320 746f 204e 6f6e 652e 0a20  aults to None.. 
+0001a530: 2020 2020 2020 206d 6f6e 6974 6f72 325f         monitor2_
+0001a540: 7468 7265 7368 2028 666c 6f61 742c 206f  thresh (float, o
+0001a550: 7074 696f 6e61 6c29 3a20 5468 6520 7468  ptional): The th
+0001a560: 7265 7368 6f6c 6420 7661 6c75 6520 6f66  reshold value of
+0001a570: 2074 6865 2073 6563 6f6e 6420 6d6f 6e69   the second moni
+0001a580: 746f 7220 6d65 7472 6963 2e20 4966 2074  tor metric. If t
+0001a590: 6865 206d 6574 7269 6320 6973 206c 6f73  he metric is los
+0001a5a0: 732d 7265 6c61 7465 640a 2020 2020 2020  s-related.      
+0001a5b0: 2020 2020 2020 7468 6520 7472 6169 6e69        the traini
+0001a5c0: 6e67 2077 696c 6c20 7374 6f70 2065 6172  ng will stop ear
+0001a5d0: 6c79 2069 6620 7468 6520 7661 6c75 6520  ly if the value 
+0001a5e0: 6661 6c6c 7320 6265 6c6f 7720 7468 6973  falls below this
+0001a5f0: 2074 6872 6573 686f 6c64 2e20 5369 6d69   threshold. Simi
+0001a600: 6c61 726c 792c 2069 6620 7468 6520 6d65  larly, if the me
+0001a610: 7472 6963 2069 7320 6163 6375 7261 6379  tric is accuracy
+0001a620: 2d72 656c 6174 6564 2c0a 2020 2020 2020  -related,.      
+0001a630: 2020 2020 2020 7468 656e 2074 6865 2074        then the t
+0001a640: 7261 696e 696e 6720 7769 6c6c 2073 746f  raining will sto
+0001a650: 7020 6561 726c 7920 6966 2074 6865 2076  p early if the v
+0001a660: 616c 7565 2066 616c 6c73 2061 626f 7665  alue falls above
+0001a670: 2074 6869 7320 7468 7265 7368 6f6c 642e   this threshold.
+0001a680: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
+0001a690: 652e 0a20 2020 2020 2020 200a 2020 2020  e..        .    
+0001a6a0: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
+0001a6b0: 2054 6865 2066 6972 7374 206f 7574 7075   The first outpu
+0001a6c0: 7420 6973 2074 6865 2063 6c61 7373 6966  t is the classif
+0001a6d0: 6965 7220 7769 7468 2074 6865 206f 7074  ier with the opt
+0001a6e0: 696d 616c 2068 7970 6572 7061 7261 6d65  imal hyperparame
+0001a6f0: 7465 7273 2e0a 2020 2020 2020 2020 5365  ters..        Se
+0001a700: 636f 6e64 206f 7574 7075 7420 6973 2061  cond output is a
+0001a710: 2064 6963 7469 6f6e 6172 7920 636f 6e74   dictionary cont
+0001a720: 6169 6e69 6e67 2074 6865 206f 7074 696d  aining the optim
+0001a730: 616c 2068 7970 6572 7061 7261 6d65 7465  al hyperparamete
+0001a740: 7273 2e0a 2020 2020 2020 2020 4966 2073  rs..        If s
+0001a750: 6176 655f 7374 7564 793d 5472 7565 2c20  ave_study=True, 
+0001a760: 7468 6520 4f70 7475 6e61 2073 7475 6479  the Optuna study
+0001a770: 206f 626a 6563 7420 7769 6c6c 2062 6520   object will be 
+0001a780: 7468 6520 7468 6972 6420 6f75 7470 7574  the third output
+0001a790: 2e0a 2020 2020 2222 220a 0a20 2020 2069  ..    """..    i
+0001a7a0: 6620 636c 6620 3d3d 2027 7266 273a 0a20  f clf == 'rf':. 
+0001a7b0: 2020 2020 2020 206d 6f64 656c 5f30 203d         model_0 =
+0001a7c0: 2052 616e 646f 6d46 6f72 6573 7443 6c61   RandomForestCla
+0001a7d0: 7373 6966 6965 7228 7261 6e64 6f6d 5f73  ssifier(random_s
+0001a7e0: 7461 7465 3d31 3930 3929 0a20 2020 2065  tate=1909).    e
+0001a7f0: 6c69 6620 636c 6620 3d3d 2027 6e6e 273a  lif clf == 'nn':
+0001a800: 0a20 2020 2020 2020 206d 6f64 656c 5f30  .        model_0
+0001a810: 203d 204d 4c50 436c 6173 7369 6669 6572   = MLPClassifier
+0001a820: 2872 616e 646f 6d5f 7374 6174 653d 3139  (random_state=19
+0001a830: 3039 290a 2020 2020 656c 6966 2063 6c66  09).    elif clf
+0001a840: 203d 3d20 2778 6762 273a 0a20 2020 2020   == 'xgb':.     
+0001a850: 2020 206d 6f64 656c 5f30 203d 2058 4742     model_0 = XGB
+0001a860: 436c 6173 7369 6669 6572 2872 616e 646f  Classifier(rando
+0001a870: 6d5f 7374 6174 653d 3139 3039 290a 2020  m_state=1909).  
+0001a880: 2020 2020 2020 6966 2061 6c6c 2869 7369        if all(isi
+0001a890: 6e73 7461 6e63 6528 7661 6c2c 2028 696e  nstance(val, (in
+0001a8a0: 742c 2073 7472 2929 2066 6f72 2076 616c  t, str)) for val
+0001a8b0: 2069 6e20 6461 7461 5f79 293a 0a20 2020   in data_y):.   
+0001a8c0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0001a8d0: 5847 426f 6f73 7420 636c 6173 7369 6669  XGBoost classifi
+0001a8e0: 6572 2072 6571 7569 7265 7320 6e75 6d65  er requires nume
+0001a8f0: 7269 6361 6c20 636c 6173 7320 6c61 6265  rical class labe
+0001a900: 6c73 2120 436f 6e76 6572 7469 6e67 2063  ls! Converting c
+0001a910: 6c61 7373 206c 6162 656c 7320 6173 2066  lass labels as f
+0001a920: 6f6c 6c6f 7773 3a27 290a 2020 2020 2020  ollows:').      
+0001a930: 2020 2020 2020 7072 696e 7428 275f 5f5f        print('___
+0001a940: 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f  ________________
+0001a950: 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f  ________________
+0001a960: 5f27 290a 2020 2020 2020 2020 2020 2020  _').            
+0001a970: 7920 3d20 6e70 2e7a 6572 6f73 286c 656e  y = np.zeros(len
+0001a980: 2864 6174 615f 7929 290a 2020 2020 2020  (data_y)).      
+0001a990: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+0001a9a0: 616e 6765 286c 656e 286e 702e 756e 6971  ange(len(np.uniq
+0001a9b0: 7565 2864 6174 615f 7929 2929 3a0a 2020  ue(data_y))):.  
+0001a9c0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001a9d0: 696e 7428 7374 7228 6e70 2e75 6e69 7175  int(str(np.uniqu
+0001a9e0: 6528 6461 7461 5f79 295b 695d 292e 6c6a  e(data_y)[i]).lj
+0001a9f0: 7573 7428 3130 292b 2720 202d 2d2d 2d2d  ust(10)+'  -----
+0001aa00: 2d2d 2d2d 2d2d 2d2d 3e20 2020 2020 272b  -------->     '+
+0001aa10: 7374 7228 6929 290a 2020 2020 2020 2020  str(i)).        
+0001aa20: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
+0001aa30: 6e70 2e77 6865 7265 2864 6174 615f 7920  np.where(data_y 
+0001aa40: 3d3d 206e 702e 756e 6971 7565 2864 6174  == np.unique(dat
+0001aa50: 615f 7929 5b69 5d29 5b30 5d0a 2020 2020  a_y)[i])[0].    
+0001aa60: 2020 2020 2020 2020 2020 2020 795b 696e              y[in
+0001aa70: 6465 785d 203d 2069 0a20 2020 2020 2020  dex] = i.       
+0001aa80: 2020 2020 2064 6174 615f 7920 3d20 7920       data_y = y 
+0001aa90: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001aaa0: 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('------------
+0001aab0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001aac0: 2d2d 2d2d 2d2d 2d2d 2729 0a20 2020 2065  --------').    e
+0001aad0: 6c69 6620 636c 6620 3d3d 2027 616c 6578  lif clf == 'alex
+0001aae0: 6e65 7427 206f 7220 636c 6620 3d3d 2027  net' or clf == '
+0001aaf0: 7667 6731 3627 206f 7220 636c 6620 3d3d  vgg16' or clf ==
+0001ab00: 2027 7265 736e 6574 3138 2720 6f72 2063   'resnet18' or c
+0001ab10: 6c66 203d 3d20 2763 7573 746f 6d5f 636e  lf == 'custom_cn
+0001ab20: 6e27 3a0a 2020 2020 2020 2020 7061 7373  n':.        pass
+0001ab30: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+0001ab40: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0001ab50: 726f 7228 2763 6c66 2061 7267 756d 656e  ror('clf argumen
+0001ab60: 7420 6d75 7374 2065 6974 6865 7220 6265  t must either be
+0001ab70: 2022 7266 222c 2022 7867 6222 2c20 226e   "rf", "xgb", "n
+0001ab80: 6e22 2c20 6f72 2022 616c 6578 6e65 7422  n", or "alexnet"
+0001ab90: 2c20 2276 6767 3136 222c 2022 7265 736e  , "vgg16", "resn
+0001aba0: 6574 3138 222c 2022 6375 7374 6f6d 5f63  et18", "custom_c
+0001abb0: 6e6e 222e 2729 0a0a 2020 2020 6966 206e  nn".')..    if n
+0001abc0: 5f69 7465 7220 3d3d 2030 3a0a 2020 2020  _iter == 0:.    
+0001abd0: 2020 2020 6966 2063 6c66 203d 3d20 2772      if clf == 'r
+0001abe0: 6627 206f 7220 636c 6620 3d3d 2027 7867  f' or clf == 'xg
+0001abf0: 6227 206f 7220 636c 6620 3d3d 2027 6e6e  b' or clf == 'nn
+0001ac00: 273a 0a20 2020 2020 2020 2020 2020 2070  ':.            p
+0001ac10: 7269 6e74 2827 4e6f 206f 7074 696d 697a  rint('No optimiz
+0001ac20: 6174 696f 6e20 7472 6961 6c73 2063 6f6e  ation trials con
+0001ac30: 6669 6775 7265 6420 286e 5f69 7465 723d  figured (n_iter=
+0001ac40: 3029 2c20 7265 7475 726e 696e 6720 6261  0), returning ba
+0001ac50: 7365 207b 7d20 6d6f 6465 6c2e 2e2e 272e  se {} model...'.
+0001ac60: 666f 726d 6174 2863 6c66 2929 0a20 2020  format(clf)).   
+0001ac70: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001ac80: 6d6f 6465 6c5f 3020 0a20 2020 2020 2020  model_0 .       
+0001ac90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001aca0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0001acb0: 726f 7228 274e 6f20 6f70 7469 6d69 7a61  ror('No optimiza
+0001acc0: 7469 6f6e 2074 7269 616c 7320 636f 6e66  tion trials conf
+0001acd0: 6967 7572 6564 2c20 7365 7420 6e5f 6974  igured, set n_it
+0001ace0: 6572 203e 2030 2127 290a 0a20 2020 2069  er > 0!')..    i
+0001acf0: 6620 636c 6620 3d3d 2027 7266 2720 6f72  f clf == 'rf' or
+0001ad00: 2063 6c66 203d 3d20 2778 6762 2720 6f72   clf == 'xgb' or
+0001ad10: 2063 6c66 203d 3d20 276e 6e27 3a0a 2020   clf == 'nn':.  
+0001ad20: 2020 2020 2020 6376 203d 2063 726f 7373        cv = cross
+0001ad30: 5f76 616c 6964 6174 6528 6d6f 6465 6c5f  _validate(model_
+0001ad40: 302c 2064 6174 615f 782c 2064 6174 615f  0, data_x, data_
+0001ad50: 792c 2063 763d 6f70 745f 6376 290a 2020  y, cv=opt_cv).  
+0001ad60: 2020 2020 2020 696e 6974 6961 6c5f 7363        initial_sc
+0001ad70: 6f72 6520 3d20 6e70 2e6d 6561 6e28 6376  ore = np.mean(cv
+0001ad80: 5b27 7465 7374 5f73 636f 7265 275d 290a  ['test_score']).
+0001ad90: 0a20 2020 2073 616d 706c 6572 203d 206f  .    sampler = o
+0001ada0: 7074 756e 612e 7361 6d70 6c65 7273 2e54  ptuna.samplers.T
+0001adb0: 5045 5361 6d70 6c65 7228 7365 6564 3d31  PESampler(seed=1
+0001adc0: 3930 3929 0a20 2020 2073 7475 6479 203d  909).    study =
+0001add0: 206f 7074 756e 612e 6372 6561 7465 5f73   optuna.create_s
+0001ade0: 7475 6479 2864 6972 6563 7469 6f6e 3d27  tudy(direction='
+0001adf0: 6d61 7869 6d69 7a65 272c 2073 616d 706c  maximize', sampl
+0001ae00: 6572 3d73 616d 706c 6572 2923 2c20 7072  er=sampler)#, pr
+0001ae10: 756e 6572 3d6f 7074 756e 612e 7072 756e  uner=optuna.prun
+0001ae20: 6572 732e 4d65 6469 616e 5072 756e 6572  ers.MedianPruner
+0001ae30: 286e 5f73 7461 7274 7570 5f74 7269 616c  (n_startup_trial
+0001ae40: 733d 352c 206e 5f77 6172 6d75 705f 7374  s=5, n_warmup_st
+0001ae50: 6570 733d 3330 2c20 696e 7465 7276 616c  eps=30, interval
+0001ae60: 5f73 7465 7073 3d31 3029 290a 2020 2020  _steps=10)).    
+0001ae70: 7072 696e 7428 2753 7461 7274 696e 6720  print('Starting 
+0001ae80: 6879 7065 7270 6172 616d 6574 6572 206f  hyperparameter o
+0001ae90: 7074 696d 697a 6174 696f 6e2c 2074 6869  ptimization, thi
+0001aea0: 7320 7769 6c6c 2074 616b 6520 6120 7768  s will take a wh
+0001aeb0: 696c 652e 2e2e 2729 0a0a 2020 2020 2349  ile...')..    #I
+0001aec0: 6620 6269 6e61 7279 2063 6c61 7373 6966  f binary classif
+0001aed0: 6963 6174 696f 6e20 7461 736b 2c20 6361  ication task, ca
+0001aee0: 6e20 6465 616c 2077 6974 6820 696d 6261  n deal with imba
+0001aef0: 6c61 6e63 6520 636c 6173 7365 7320 7769  lance classes wi
+0001af00: 7468 2077 6569 6768 7473 2068 7970 6572  th weights hyper
+0001af10: 7061 7261 6d65 7465 720a 2020 2020 6966  parameter.    if
+0001af20: 206c 656e 286e 702e 756e 6971 7565 2864   len(np.unique(d
+0001af30: 6174 615f 7929 2920 3d3d 2032 3a0a 2020  ata_y)) == 2:.  
+0001af40: 2020 2020 2020 6966 2063 6c66 203d 3d20        if clf == 
+0001af50: 2772 6627 206f 7220 636c 6620 3d3d 2027  'rf' or clf == '
+0001af60: 7867 6227 206f 7220 636c 6620 3d3d 2027  xgb' or clf == '
+0001af70: 6e6e 273a 0a20 2020 2020 2020 2020 2020  nn':.           
+0001af80: 2063 6f75 6e74 6572 203d 2043 6f75 6e74   counter = Count
+0001af90: 6572 2864 6174 615f 7929 0a20 2020 2020  er(data_y).     
+0001afa0: 2020 2020 2020 2069 6620 636f 756e 7465         if counte
+0001afb0: 725b 6e70 2e75 6e69 7175 6528 6461 7461  r[np.unique(data
+0001afc0: 5f79 295b 305d 5d20 213d 2063 6f75 6e74  _y)[0]] != count
+0001afd0: 6572 5b6e 702e 756e 6971 7565 2864 6174  er[np.unique(dat
+0001afe0: 615f 7929 5b31 5d5d 3a0a 2020 2020 2020  a_y)[1]]:.      
+0001aff0: 2020 2020 2020 2020 2020 6966 2062 616c            if bal
+0001b000: 616e 6365 3a0a 2020 2020 2020 2020 2020  ance:.          
+0001b010: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0001b020: 2755 6e62 616c 616e 6365 6420 6461 7461  'Unbalanced data
+0001b030: 7365 7420 6465 7465 6374 6564 2c20 7769  set detected, wi
+0001b040: 6c6c 2074 7261 696e 2063 6c61 7373 6966  ll train classif
+0001b050: 6965 7220 7769 7468 2077 6569 6768 7473  ier with weights
+0001b060: 2120 546f 2064 6973 6162 6c65 2c20 7365  ! To disable, se
+0001b070: 7420 6261 6c61 6e63 653d 4661 6c73 6527  t balance=False'
+0001b080: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001b090: 2020 2020 2020 6966 2063 6c66 203d 3d20        if clf == 
+0001b0a0: 2778 6762 273a 0a20 2020 2020 2020 2020  'xgb':.         
+0001b0b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001b0c0: 6f74 616c 5f6e 6567 6174 6976 6520 3d20  otal_negative = 
+0001b0d0: 6c65 6e28 6e70 2e77 6865 7265 2864 6174  len(np.where(dat
+0001b0e0: 615f 7920 3d3d 2063 6f75 6e74 6572 2e6d  a_y == counter.m
+0001b0f0: 6f73 745f 636f 6d6d 6f6e 2831 295b 305d  ost_common(1)[0]
+0001b100: 5b30 5d29 5b30 5d29 0a20 2020 2020 2020  [0])[0]).       
+0001b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b120: 2074 6f74 616c 5f70 6f73 6974 6976 6520   total_positive 
+0001b130: 3d20 6c65 6e28 6461 7461 5f79 2920 2d20  = len(data_y) - 
+0001b140: 746f 7461 6c5f 6e65 6761 7469 7665 0a20  total_negative. 
+0001b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b160: 2020 2020 2020 2073 616d 706c 655f 7765         sample_we
+0001b170: 6967 6874 203d 2074 6f74 616c 5f6e 6567  ight = total_neg
+0001b180: 6174 6976 6520 2f20 746f 7461 6c5f 706f  ative / total_po
+0001b190: 7369 7469 7665 0a20 2020 2020 2020 2020  sitive.         
+0001b1a0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001b1b0: 636c 6620 3d3d 2027 7266 273a 0a20 2020  clf == 'rf':.   
+0001b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1d0: 2020 2020 2073 616d 706c 655f 7765 6967       sample_weig
+0001b1e0: 6874 203d 2027 6261 6c61 6e63 6564 270a  ht = 'balanced'.
+0001b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b200: 2020 2020 656c 6966 2063 6c66 203d 3d20      elif clf == 
+0001b210: 276e 6e27 3a0a 2020 2020 2020 2020 2020  'nn':.          
+0001b220: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001b230: 696e 7428 2757 4152 4e49 4e47 3a20 4d4c  int('WARNING: ML
+0001b240: 5043 6c61 7373 6966 6965 7228 2920 646f  PClassifier() do
+0001b250: 6573 206e 6f74 2073 7570 706f 7274 2073  es not support s
+0001b260: 616d 706c 6520 7765 6967 6874 732e 2729  ample weights.')
+0001b270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b280: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001b290: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+0001b2a0: 655f 7765 6967 6874 203d 204e 6f6e 650a  e_weight = None.
+0001b2b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001b2c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001b2d0: 2020 7361 6d70 6c65 5f77 6569 6768 7420    sample_weight 
+0001b2e0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2065  = None.        e
+0001b2f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001b300: 2070 7269 6e74 2827 556e 6261 6c61 6e63   print('Unbalanc
+0001b310: 6564 2064 6174 6173 6574 2064 6574 6563  ed dataset detec
+0001b320: 7465 6420 6275 7420 7468 6520 6f70 7469  ted but the opti
+0001b330: 6d69 7a61 7469 6f6e 2072 6f75 7469 6e65  mization routine
+0001b340: 2064 6f65 7320 6e6f 7420 6375 7272 656e   does not curren
+0001b350: 746c 7920 7375 7070 6f72 7420 7765 6967  tly support weig
+0001b360: 6874 732e 2054 6f20 7573 6520 7468 6520  hts. To use the 
+0001b370: 7765 6967 6874 6564 5f62 696e 6172 795f  weighted_binary_
+0001b380: 6372 6f73 7365 6e74 726f 7079 206c 6f73  crossentropy los
+0001b390: 7320 6675 6e63 7469 6f6e 2c20 6c6f 6164  s function, load
+0001b3a0: 2074 6865 2064 6573 6972 6564 206d 6f64   the desired mod
+0001b3b0: 656c 2064 6972 6563 746c 7920 616e 6420  el directly and 
+0001b3c0: 7365 7420 6c6f 7373 3d22 7765 6967 6874  set loss="weight
+0001b3d0: 6564 5f62 696e 6172 795f 6372 6f73 7365  ed_binary_crosse
+0001b3e0: 6e74 726f 7079 2220 2872 6566 6572 2074  ntropy" (refer t
+0001b3f0: 6f20 7468 6520 4d69 6372 6f4c 4941 2e63  o the MicroLIA.c
+0001b400: 6e6e 5f6d 6f64 656c 2041 5049 2064 6f63  nn_model API doc
+0001b410: 756d 656e 7461 7469 6f6e 292e 2729 0a20  umentation).'). 
+0001b420: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001b430: 2073 616d 706c 655f 7765 6967 6874 203d   sample_weight =
+0001b440: 204e 6f6e 650a 0a20 2020 2069 6620 636c   None..    if cl
+0001b450: 6620 3d3d 2027 7266 273a 0a20 2020 2020  f == 'rf':.     
+0001b460: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001b470: 2020 2020 6f62 6a65 6374 6976 6520 3d20      objective = 
+0001b480: 6f62 6a65 6374 6976 655f 7266 2864 6174  objective_rf(dat
+0001b490: 615f 782c 2064 6174 615f 792c 206f 7074  a_x, data_y, opt
+0001b4a0: 5f63 763d 6f70 745f 6376 290a 2020 2020  _cv=opt_cv).    
+0001b4b0: 2020 2020 2020 2020 7374 7564 792e 6f70          study.op
+0001b4c0: 7469 6d69 7a65 286f 626a 6563 7469 7665  timize(objective
+0001b4d0: 2c20 6e5f 7472 6961 6c73 3d6e 5f69 7465  , n_trials=n_ite
+0001b4e0: 722c 2073 686f 775f 7072 6f67 7265 7373  r, show_progress
+0001b4f0: 5f62 6172 3d54 7275 6529 232c 2067 635f  _bar=True)#, gc_
+0001b500: 6166 7465 725f 7472 6961 6c3d 5472 7565  after_trial=True
+0001b510: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
+0001b520: 7261 6d73 203d 2073 7475 6479 2e62 6573  rams = study.bes
+0001b530: 745f 7472 6961 6c2e 7061 7261 6d73 0a20  t_trial.params. 
+0001b540: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0001b550: 203d 2052 616e 646f 6d46 6f72 6573 7443   = RandomForestC
+0001b560: 6c61 7373 6966 6965 7228 6e5f 6573 7469  lassifier(n_esti
+0001b570: 6d61 746f 7273 3d70 6172 616d 735b 276e  mators=params['n
+0001b580: 5f65 7374 696d 6174 6f72 7327 5d2c 2063  _estimators'], c
+0001b590: 7269 7465 7269 6f6e 3d70 6172 616d 735b  riterion=params[
+0001b5a0: 2763 7269 7465 7269 6f6e 275d 2c20 0a20  'criterion'], . 
+0001b5b0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001b5c0: 6178 5f64 6570 7468 3d70 6172 616d 735b  ax_depth=params[
+0001b5d0: 276d 6178 5f64 6570 7468 275d 2c20 6d69  'max_depth'], mi
+0001b5e0: 6e5f 7361 6d70 6c65 735f 7370 6c69 743d  n_samples_split=
+0001b5f0: 7061 7261 6d73 5b27 6d69 6e5f 7361 6d70  params['min_samp
+0001b600: 6c65 735f 7370 6c69 7427 5d2c 200a 2020  les_split'], .  
+0001b610: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+0001b620: 6e5f 7361 6d70 6c65 735f 6c65 6166 3d70  n_samples_leaf=p
+0001b630: 6172 616d 735b 276d 696e 5f73 616d 706c  arams['min_sampl
+0001b640: 6573 5f6c 6561 6627 5d2c 206d 6178 5f66  es_leaf'], max_f
+0001b650: 6561 7475 7265 733d 7061 7261 6d73 5b27  eatures=params['
+0001b660: 6d61 785f 6665 6174 7572 6573 275d 2c20  max_features'], 
+0001b670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b680: 2062 6f6f 7473 7472 6170 3d70 6172 616d   bootstrap=param
+0001b690: 735b 2762 6f6f 7473 7472 6170 275d 2c20  s['bootstrap'], 
+0001b6a0: 636c 6173 735f 7765 6967 6874 3d73 616d  class_weight=sam
+0001b6b0: 706c 655f 7765 6967 6874 2c20 7261 6e64  ple_weight, rand
+0001b6c0: 6f6d 5f73 7461 7465 3d31 3930 3929 0a20  om_state=1909). 
+0001b6d0: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+0001b6e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001b6f0: 2827 4661 696c 6564 2074 6f20 6f70 7469  ('Failed to opti
+0001b700: 6d69 7a65 2077 6974 6820 4f70 7475 6e61  mize with Optuna
+0001b710: 2c20 7377 6974 6368 696e 6720 6f76 6572  , switching over
+0001b720: 2074 6f20 4261 7965 7353 6561 7263 6843   to BayesSearchC
+0001b730: 562e 2e2e 2729 0a20 2020 2020 2020 2020  V...').         
+0001b740: 2020 2070 6172 616d 7320 3d20 7b0a 2020     params = {.  
+0001b750: 2020 2020 2020 2020 2020 2020 2020 2763                'c
+0001b760: 7269 7465 7269 6f6e 273a 205b 2267 696e  riterion': ["gin
+0001b770: 6922 2c20 2265 6e74 726f 7079 225d 2c0a  i", "entropy"],.
+0001b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b790: 276e 5f65 7374 696d 6174 6f72 7327 3a20  'n_estimators': 
+0001b7a0: 5b69 6e74 2878 2920 666f 7220 7820 696e  [int(x) for x in
+0001b7b0: 206e 702e 6c69 6e73 7061 6365 2835 302c   np.linspace(50,
+0001b7c0: 3130 3030 2c20 6e75 6d3d 3230 295d 2c20  1000, num=20)], 
+0001b7d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b7e0: 2027 6d61 785f 6665 6174 7572 6573 273a   'max_features':
+0001b7f0: 205b 6461 7461 5f78 2e73 6861 7065 5b31   [data_x.shape[1
+0001b800: 5d2c 2022 7371 7274 222c 2022 6c6f 6732  ], "sqrt", "log2
+0001b810: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+0001b820: 2020 2020 276d 6178 5f64 6570 7468 273a      'max_depth':
+0001b830: 205b 696e 7428 7829 2066 6f72 2078 2069   [int(x) for x i
+0001b840: 6e20 6e70 2e6c 696e 7370 6163 6528 352c  n np.linspace(5,
+0001b850: 3530 2c6e 756d 3d35 295d 2c0a 2020 2020  50,num=5)],.    
+0001b860: 2020 2020 2020 2020 2020 2020 276d 696e              'min
+0001b870: 5f73 616d 706c 6573 5f73 706c 6974 273a  _samples_split':
+0001b880: 205b 332c 342c 362c 372c 382c 392c 3130   [3,4,6,7,8,9,10
+0001b890: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0001b8a0: 2020 2027 6d69 6e5f 7361 6d70 6c65 735f     'min_samples_
+0001b8b0: 6c65 6166 273a 205b 312c 332c 352c 372c  leaf': [1,3,5,7,
+0001b8c0: 392c 3130 5d2c 0a20 2020 2020 2020 2020  9,10],.         
+0001b8d0: 2020 2020 2020 2027 6d61 785f 6c65 6166         'max_leaf
+0001b8e0: 5f6e 6f64 6573 273a 205b 696e 7428 7829  _nodes': [int(x)
+0001b8f0: 2066 6f72 2078 2069 6e20 6e70 2e6c 696e   for x in np.lin
+0001b900: 7370 6163 6528 322c 3230 3029 5d2c 0a20  space(2,200)],. 
+0001b910: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001b920: 626f 6f74 7374 7261 7027 3a20 5b54 7275  bootstrap': [Tru
+0001b930: 652c 4661 6c73 655d 2020 200a 2020 2020  e,False]   .    
+0001b940: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0001b950: 2020 2020 2020 6773 203d 2042 6179 6573        gs = Bayes
+0001b960: 5365 6172 6368 4356 286e 5f69 7465 723d  SearchCV(n_iter=
+0001b970: 6e5f 6974 6572 2c20 6573 7469 6d61 746f  n_iter, estimato
+0001b980: 723d 6d6f 6465 6c5f 302c 2073 6561 7263  r=model_0, searc
+0001b990: 685f 7370 6163 6573 3d70 6172 616d 732c  h_spaces=params,
+0001b9a0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0001b9b0: 2020 6f70 7469 6d69 7a65 725f 6b77 6172    optimizer_kwar
+0001b9c0: 6773 3d7b 2762 6173 655f 6573 7469 6d61  gs={'base_estima
+0001b9d0: 746f 7227 3a20 2752 4627 7d2c 2063 763d  tor': 'RF'}, cv=
+0001b9e0: 6f70 745f 6376 290a 2020 2020 2020 2020  opt_cv).        
+0001b9f0: 2020 2020 6773 2e66 6974 2864 6174 615f      gs.fit(data_
+0001ba00: 782c 2064 6174 615f 7929 0a20 2020 2020  x, data_y).     
+0001ba10: 2020 2020 2020 2062 6573 745f 6573 742c         best_est,
+0001ba20: 2062 6573 745f 7363 6f72 6520 3d20 6773   best_score = gs
+0001ba30: 2e62 6573 745f 6573 7469 6d61 746f 725f  .best_estimator_
+0001ba40: 2c20 6e70 2e72 6f75 6e64 2867 732e 6265  , np.round(gs.be
+0001ba50: 7374 5f73 636f 7265 5f2c 2034 290a 2020  st_score_, 4).  
+0001ba60: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0001ba70: 2748 6967 6865 7374 206d 6561 6e20 6163  'Highest mean ac
+0001ba80: 6375 7261 6379 3a20 7b7d 272e 666f 726d  curacy: {}'.form
+0001ba90: 6174 2862 6573 745f 7363 6f72 6529 290a  at(best_score)).
+0001baa0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001bab0: 726e 2067 732e 6265 7374 5f65 7374 696d  rn gs.best_estim
+0001bac0: 6174 6f72 5f2c 2067 732e 6265 7374 5f70  ator_, gs.best_p
+0001bad0: 6172 616d 735f 0a0a 2020 2020 656c 6966  arams_..    elif
+0001bae0: 2063 6c66 203d 3d20 276e 6e27 3a0a 2020   clf == 'nn':.  
+0001baf0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001bb00: 2020 2020 2020 206f 626a 6563 7469 7665         objective
+0001bb10: 203d 206f 626a 6563 7469 7665 5f6e 6e28   = objective_nn(
+0001bb20: 6461 7461 5f78 2c20 6461 7461 5f79 2c20  data_x, data_y, 
+0001bb30: 6f70 745f 6376 3d6f 7074 5f63 7629 0a20  opt_cv=opt_cv). 
+0001bb40: 2020 2020 2020 2020 2020 2073 7475 6479             study
+0001bb50: 2e6f 7074 696d 697a 6528 6f62 6a65 6374  .optimize(object
+0001bb60: 6976 652c 206e 5f74 7269 616c 733d 6e5f  ive, n_trials=n_
+0001bb70: 6974 6572 2c20 7368 6f77 5f70 726f 6772  iter, show_progr
+0001bb80: 6573 735f 6261 723d 5472 7565 2923 2c20  ess_bar=True)#, 
+0001bb90: 6763 5f61 6674 6572 5f74 7269 616c 3d54  gc_after_trial=T
+0001bba0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0001bbb0: 2070 6172 616d 7320 3d20 7374 7564 792e   params = study.
+0001bbc0: 6265 7374 5f74 7269 616c 2e70 6172 616d  best_trial.param
+0001bbd0: 730a 2020 2020 2020 2020 2020 2020 6c61  s.            la
+0001bbe0: 7965 7273 203d 205b 7061 7261 6d20 666f  yers = [param fo
+0001bbf0: 7220 7061 7261 6d20 696e 2070 6172 616d  r param in param
+0001bc00: 7320 6966 2027 6e5f 756e 6974 735f 2720  s if 'n_units_' 
+0001bc10: 696e 2070 6172 616d 5d0a 2020 2020 2020  in param].      
+0001bc20: 2020 2020 2020 6c61 7965 7273 203d 2074        layers = t
+0001bc30: 7570 6c65 2870 6172 616d 735b 6c61 7965  uple(params[laye
+0001bc40: 725d 2066 6f72 206c 6179 6572 2069 6e20  r] for layer in 
+0001bc50: 6c61 7965 7273 290a 2020 2020 2020 2020  layers).        
+0001bc60: 2020 2020 6d6f 6465 6c20 3d20 4d4c 5043      model = MLPC
+0001bc70: 6c61 7373 6966 6965 7228 6869 6464 656e  lassifier(hidden
+0001bc80: 5f6c 6179 6572 5f73 697a 6573 3d74 7570  _layer_sizes=tup
+0001bc90: 6c65 286c 6179 6572 7329 2c20 6c65 6172  le(layers), lear
+0001bca0: 6e69 6e67 5f72 6174 655f 696e 6974 3d70  ning_rate_init=p
+0001bcb0: 6172 616d 735b 276c 6561 726e 696e 675f  arams['learning_
+0001bcc0: 7261 7465 5f69 6e69 7427 5d2c 200a 2020  rate_init'], .  
+0001bcd0: 2020 2020 2020 2020 2020 2020 2020 6163                ac
+0001bce0: 7469 7661 7469 6f6e 3d70 6172 616d 735b  tivation=params[
+0001bcf0: 2761 6374 6976 6174 696f 6e27 5d2c 206c  'activation'], l
+0001bd00: 6561 726e 696e 675f 7261 7465 3d70 6172  earning_rate=par
+0001bd10: 616d 735b 276c 6561 726e 696e 675f 7261  ams['learning_ra
+0001bd20: 7465 275d 2c20 616c 7068 613d 7061 7261  te'], alpha=para
+0001bd30: 6d73 5b27 616c 7068 6127 5d2c 200a 2020  ms['alpha'], .  
+0001bd40: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+0001bd50: 7463 685f 7369 7a65 3d70 6172 616d 735b  tch_size=params[
+0001bd60: 2762 6174 6368 5f73 697a 6527 5d2c 2073  'batch_size'], s
+0001bd70: 6f6c 7665 723d 7061 7261 6d73 5b27 736f  olver=params['so
+0001bd80: 6c76 6572 275d 2c20 6d61 785f 6974 6572  lver'], max_iter
+0001bd90: 3d32 3530 302c 2072 616e 646f 6d5f 7374  =2500, random_st
+0001bda0: 6174 653d 3139 3039 290a 2020 2020 2020  ate=1909).      
+0001bdb0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+0001bdc0: 2020 2020 2020 7072 696e 7428 2746 6169        print('Fai
+0001bdd0: 6c65 6420 746f 206f 7074 696d 697a 6520  led to optimize 
+0001bde0: 7769 7468 204f 7074 756e 612c 2073 7769  with Optuna, swi
+0001bdf0: 7463 6869 6e67 206f 7665 7220 746f 2042  tching over to B
+0001be00: 6179 6573 5365 6172 6368 4356 2e2e 2e27  ayesSearchCV...'
+0001be10: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
+0001be20: 7261 6d73 203d 207b 0a20 2020 2020 2020  rams = {.       
+0001be30: 2020 2020 2020 2020 2027 6869 6464 656e           'hidden
+0001be40: 5f6c 6179 6572 5f73 697a 6573 273a 205b  _layer_sizes': [
+0001be50: 2831 3030 2c29 2c28 3530 2c31 3030 2c35  (100,),(50,100,5
+0001be60: 3029 2c28 3735 2c35 302c 3230 292c 2831  0),(75,50,20),(1
+0001be70: 3530 2c31 3030 2c35 3029 2c28 3132 302c  50,100,50),(120,
+0001be80: 3830 2c34 3029 2c28 3130 302c 3530 2c33  80,40),(100,50,3
+0001be90: 3029 5d2c 0a20 2020 2020 2020 2020 2020  0)],.           
+0001bea0: 2020 2020 2027 6c65 6172 6e69 6e67 5f72       'learning_r
+0001beb0: 6174 6527 3a20 5b27 636f 6e73 7461 6e74  ate': ['constant
+0001bec0: 272c 2027 696e 7673 6361 6c69 6e67 272c  ', 'invscaling',
+0001bed0: 2027 6164 6170 7469 7665 275d 2c0a 2020   'adaptive'],.  
+0001bee0: 2020 2020 2020 2020 2020 2020 2020 2761                'a
+0001bef0: 6c70 6861 273a 205b 302e 3030 3030 312c  lpha': [0.00001,
+0001bf00: 2030 2e35 5d2c 200a 2020 2020 2020 2020   0.5], .        
+0001bf10: 2020 2020 2020 2020 2761 6374 6976 6174          'activat
+0001bf20: 696f 6e27 3a20 5b27 7461 6e68 272c 2027  ion': ['tanh', '
+0001bf30: 6c6f 6769 7374 6963 272c 2027 7265 6c75  logistic', 'relu
+0001bf40: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+0001bf50: 2020 2020 2773 6f6c 7665 7227 3a20 5b27      'solver': ['
+0001bf60: 7367 6427 2c20 2761 6461 6d27 5d2c 0a20  sgd', 'adam'],. 
+0001bf70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001bf80: 6d61 785f 6974 6572 273a 205b 3130 302c  max_iter': [100,
+0001bf90: 2031 3530 2c20 3230 305d 200a 2020 2020   150, 200] .    
+0001bfa0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0001bfb0: 2020 2020 2020 6773 203d 2042 6179 6573        gs = Bayes
+0001bfc0: 5365 6172 6368 4356 286e 5f69 7465 723d  SearchCV(n_iter=
+0001bfd0: 6e5f 6974 6572 2c20 6573 7469 6d61 746f  n_iter, estimato
+0001bfe0: 723d 6d6f 6465 6c5f 302c 2073 6561 7263  r=model_0, searc
+0001bff0: 685f 7370 6163 6573 3d70 6172 616d 732c  h_spaces=params,
+0001c000: 2063 763d 6f70 745f 6376 290a 2020 2020   cv=opt_cv).    
+0001c010: 2020 2020 2020 2020 6773 2e66 6974 2864          gs.fit(d
+0001c020: 6174 615f 782c 2064 6174 615f 7929 0a20  ata_x, data_y). 
+0001c030: 2020 2020 2020 2020 2020 2062 6573 745f             best_
+0001c040: 6573 742c 2062 6573 745f 7363 6f72 6520  est, best_score 
+0001c050: 3d20 6773 2e62 6573 745f 6573 7469 6d61  = gs.best_estima
+0001c060: 746f 725f 2c20 6e70 2e72 6f75 6e64 2867  tor_, np.round(g
+0001c070: 732e 6265 7374 5f73 636f 7265 5f2c 2034  s.best_score_, 4
+0001c080: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+0001c090: 696e 7428 2748 6967 6865 7374 206d 6561  int('Highest mea
+0001c0a0: 6e20 6163 6375 7261 6379 3a20 7b7d 272e  n accuracy: {}'.
+0001c0b0: 666f 726d 6174 2862 6573 745f 7363 6f72  format(best_scor
+0001c0c0: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
+0001c0d0: 7265 7475 726e 2067 732e 6265 7374 5f65  return gs.best_e
+0001c0e0: 7374 696d 6174 6f72 5f2c 2067 732e 6265  stimator_, gs.be
+0001c0f0: 7374 5f70 6172 616d 735f 0a20 2020 2020  st_params_.     
+0001c100: 2020 2020 200a 2020 2020 656c 6966 2063       .    elif c
+0001c110: 6c66 203d 3d20 2778 6762 273a 0a20 2020  lf == 'xgb':.   
+0001c120: 2020 2020 206f 626a 6563 7469 7665 203d       objective =
+0001c130: 206f 626a 6563 7469 7665 5f78 6762 2864   objective_xgb(d
+0001c140: 6174 615f 782c 2064 6174 615f 792c 206c  ata_x, data_y, l
+0001c150: 696d 6974 5f73 6561 7263 683d 6c69 6d69  imit_search=limi
+0001c160: 745f 7365 6172 6368 2c20 6f70 745f 6376  t_search, opt_cv
+0001c170: 3d6f 7074 5f63 7629 0a20 2020 2020 2020  =opt_cv).       
+0001c180: 2069 6620 6c69 6d69 745f 7365 6172 6368   if limit_search
+0001c190: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0001c1a0: 696e 7428 274e 4f54 453a 2054 6f20 6578  int('NOTE: To ex
+0001c1b0: 7061 6e64 2068 7970 6572 7061 7261 6d65  pand hyperparame
+0001c1c0: 7465 7220 7365 6172 6368 2073 7061 6365  ter search space
+0001c1d0: 2c20 7365 7420 6c69 6d69 745f 7365 6172  , set limit_sear
+0001c1e0: 6368 3d46 616c 7365 2c20 616c 7468 6f75  ch=False, althou
+0001c1f0: 6768 2074 6869 7320 7769 6c6c 2069 6e63  gh this will inc
+0001c200: 7265 6173 6520 7468 6520 6f70 7469 6d69  rease the optimi
+0001c210: 7a61 7469 6f6e 2074 696d 6520 7369 676e  zation time sign
+0001c220: 6966 6963 616e 746c 792e 2729 0a20 2020  ificantly.').   
+0001c230: 2020 2020 2073 7475 6479 2e6f 7074 696d       study.optim
+0001c240: 697a 6528 6f62 6a65 6374 6976 652c 206e  ize(objective, n
+0001c250: 5f74 7269 616c 733d 6e5f 6974 6572 2c20  _trials=n_iter, 
+0001c260: 7368 6f77 5f70 726f 6772 6573 735f 6261  show_progress_ba
+0001c270: 723d 5472 7565 2923 2c20 6763 5f61 6674  r=True)#, gc_aft
+0001c280: 6572 5f74 7269 616c 3d54 7275 6529 0a20  er_trial=True). 
+0001c290: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+0001c2a0: 7374 7564 792e 6265 7374 5f74 7269 616c  study.best_trial
+0001c2b0: 2e70 6172 616d 730a 2020 2020 2020 2020  .params.        
+0001c2c0: 6966 206c 696d 6974 5f73 6561 7263 683a  if limit_search:
+0001c2d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001c2e0: 7061 7261 6d73 5b27 626f 6f73 7465 7227  params['booster'
+0001c2f0: 5d20 3d3d 2027 6461 7274 273a 0a20 2020  ] == 'dart':.   
+0001c300: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0001c310: 656c 203d 2058 4742 436c 6173 7369 6669  el = XGBClassifi
+0001c320: 6572 2862 6f6f 7374 6572 3d70 6172 616d  er(booster=param
+0001c330: 735b 2762 6f6f 7374 6572 275d 2c20 206e  s['booster'],  n
+0001c340: 5f65 7374 696d 6174 6f72 733d 7061 7261  _estimators=para
+0001c350: 6d73 5b27 6e5f 6573 7469 6d61 746f 7273  ms['n_estimators
+0001c360: 275d 2c20 7265 675f 6c61 6d62 6461 3d70  '], reg_lambda=p
+0001c370: 6172 616d 735b 2772 6567 5f6c 616d 6264  arams['reg_lambd
+0001c380: 6127 5d2c 200a 2020 2020 2020 2020 2020  a'], .          
+0001c390: 2020 2020 2020 2020 2020 7265 675f 616c            reg_al
+0001c3a0: 7068 613d 7061 7261 6d73 5b27 7265 675f  pha=params['reg_
+0001c3b0: 616c 7068 6127 5d2c 206d 6178 5f64 6570  alpha'], max_dep
+0001c3c0: 7468 3d70 6172 616d 735b 276d 6178 5f64  th=params['max_d
+0001c3d0: 6570 7468 275d 2c20 6574 613d 7061 7261  epth'], eta=para
+0001c3e0: 6d73 5b27 6574 6127 5d2c 2067 616d 6d61  ms['eta'], gamma
+0001c3f0: 3d70 6172 616d 735b 2767 616d 6d61 275d  =params['gamma']
+0001c400: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+0001c410: 2020 2020 2020 2067 726f 775f 706f 6c69         grow_poli
+0001c420: 6379 3d70 6172 616d 735b 2767 726f 775f  cy=params['grow_
+0001c430: 706f 6c69 6379 275d 2c20 7361 6d70 6c65  policy'], sample
+0001c440: 5f74 7970 653d 7061 7261 6d73 5b27 7361  _type=params['sa
+0001c450: 6d70 6c65 5f74 7970 6527 5d2c 206e 6f72  mple_type'], nor
+0001c460: 6d61 6c69 7a65 5f74 7970 653d 7061 7261  malize_type=para
+0001c470: 6d73 5b27 6e6f 726d 616c 697a 655f 7479  ms['normalize_ty
+0001c480: 7065 275d 2c0a 2020 2020 2020 2020 2020  pe'],.          
+0001c490: 2020 2020 2020 2020 2020 7261 7465 5f64            rate_d
+0001c4a0: 726f 703d 7061 7261 6d73 5b27 7261 7465  rop=params['rate
+0001c4b0: 5f64 726f 7027 5d2c 2073 6b69 705f 6472  _drop'], skip_dr
+0001c4c0: 6f70 3d70 6172 616d 735b 2773 6b69 705f  op=params['skip_
+0001c4d0: 6472 6f70 275d 2c20 7363 616c 655f 706f  drop'], scale_po
+0001c4e0: 735f 7765 6967 6874 3d73 616d 706c 655f  s_weight=sample_
+0001c4f0: 7765 6967 6874 2c20 7261 6e64 6f6d 5f73  weight, random_s
+0001c500: 7461 7465 3d31 3930 3929 0a20 2020 2020  tate=1909).     
+0001c510: 2020 2020 2020 2065 6c69 6620 7061 7261         elif para
+0001c520: 6d73 5b27 626f 6f73 7465 7227 5d20 3d3d  ms['booster'] ==
+0001c530: 2027 6762 7472 6565 273a 0a20 2020 2020   'gbtree':.     
+0001c540: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0001c550: 203d 2058 4742 436c 6173 7369 6669 6572   = XGBClassifier
+0001c560: 2862 6f6f 7374 6572 3d70 6172 616d 735b  (booster=params[
+0001c570: 2762 6f6f 7374 6572 275d 2c20 206e 5f65  'booster'],  n_e
+0001c580: 7374 696d 6174 6f72 733d 7061 7261 6d73  stimators=params
+0001c590: 5b27 6e5f 6573 7469 6d61 746f 7273 275d  ['n_estimators']
+0001c5a0: 2c20 7265 675f 6c61 6d62 6461 3d70 6172  , reg_lambda=par
+0001c5b0: 616d 735b 2772 6567 5f6c 616d 6264 6127  ams['reg_lambda'
+0001c5c0: 5d2c 200a 2020 2020 2020 2020 2020 2020  ], .            
+0001c5d0: 2020 2020 2020 2020 7265 675f 616c 7068          reg_alph
+0001c5e0: 613d 7061 7261 6d73 5b27 7265 675f 616c  a=params['reg_al
+0001c5f0: 7068 6127 5d2c 206d 6178 5f64 6570 7468  pha'], max_depth
+0001c600: 3d70 6172 616d 735b 276d 6178 5f64 6570  =params['max_dep
+0001c610: 7468 275d 2c20 6574 613d 7061 7261 6d73  th'], eta=params
+0001c620: 5b27 6574 6127 5d2c 2067 616d 6d61 3d70  ['eta'], gamma=p
+0001c630: 6172 616d 735b 2767 616d 6d61 275d 2c20  arams['gamma'], 
+0001c640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c650: 2020 2020 2067 726f 775f 706f 6c69 6379       grow_policy
+0001c660: 3d70 6172 616d 735b 2767 726f 775f 706f  =params['grow_po
+0001c670: 6c69 6379 275d 2c20 7375 6273 616d 706c  licy'], subsampl
+0001c680: 653d 7061 7261 6d73 5b27 7375 6273 616d  e=params['subsam
+0001c690: 706c 6527 5d2c 2073 6361 6c65 5f70 6f73  ple'], scale_pos
+0001c6a0: 5f77 6569 6768 743d 7361 6d70 6c65 5f77  _weight=sample_w
+0001c6b0: 6569 6768 742c 2072 616e 646f 6d5f 7374  eight, random_st
+0001c6c0: 6174 653d 3139 3039 290a 2020 2020 2020  ate=1909).      
+0001c6d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001c6e0: 2020 2020 6966 2070 6172 616d 735b 2762      if params['b
+0001c6f0: 6f6f 7374 6572 275d 203d 3d20 2764 6172  ooster'] == 'dar
+0001c700: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
+0001c710: 2020 2020 6d6f 6465 6c20 3d20 5847 4243      model = XGBC
+0001c720: 6c61 7373 6966 6965 7228 626f 6f73 7465  lassifier(booste
+0001c730: 723d 7061 7261 6d73 5b27 626f 6f73 7465  r=params['booste
+0001c740: 7227 5d2c 206e 5f65 7374 696d 6174 6f72  r'], n_estimator
+0001c750: 733d 7061 7261 6d73 5b27 6e5f 6573 7469  s=params['n_esti
+0001c760: 6d61 746f 7273 275d 2c20 636f 6c73 616d  mators'], colsam
+0001c770: 706c 655f 6279 7472 6565 3d70 6172 616d  ple_bytree=param
+0001c780: 735b 2763 6f6c 7361 6d70 6c65 5f62 7974  s['colsample_byt
+0001c790: 7265 6527 5d2c 200a 2020 2020 2020 2020  ree'], .        
+0001c7a0: 2020 2020 2020 2020 2020 2020 7265 675f              reg_
+0001c7b0: 6c61 6d62 6461 3d70 6172 616d 735b 2772  lambda=params['r
+0001c7c0: 6567 5f6c 616d 6264 6127 5d2c 2072 6567  eg_lambda'], reg
+0001c7d0: 5f61 6c70 6861 3d70 6172 616d 735b 2772  _alpha=params['r
+0001c7e0: 6567 5f61 6c70 6861 275d 2c20 6d61 785f  eg_alpha'], max_
+0001c7f0: 6465 7074 683d 7061 7261 6d73 5b27 6d61  depth=params['ma
+0001c800: 785f 6465 7074 6827 5d2c 2065 7461 3d70  x_depth'], eta=p
+0001c810: 6172 616d 735b 2765 7461 275d 2c20 6761  arams['eta'], ga
+0001c820: 6d6d 613d 7061 7261 6d73 5b27 6761 6d6d  mma=params['gamm
+0001c830: 6127 5d2c 200a 2020 2020 2020 2020 2020  a'], .          
+0001c840: 2020 2020 2020 2020 2020 6772 6f77 5f70            grow_p
+0001c850: 6f6c 6963 793d 7061 7261 6d73 5b27 6772  olicy=params['gr
+0001c860: 6f77 5f70 6f6c 6963 7927 5d2c 2073 616d  ow_policy'], sam
+0001c870: 706c 655f 7479 7065 3d70 6172 616d 735b  ple_type=params[
+0001c880: 2773 616d 706c 655f 7479 7065 275d 2c20  'sample_type'], 
+0001c890: 6e6f 726d 616c 697a 655f 7479 7065 3d70  normalize_type=p
+0001c8a0: 6172 616d 735b 276e 6f72 6d61 6c69 7a65  arams['normalize
+0001c8b0: 5f74 7970 6527 5d2c 7261 7465 5f64 726f  _type'],rate_dro
+0001c8c0: 703d 7061 7261 6d73 5b27 7261 7465 5f64  p=params['rate_d
+0001c8d0: 726f 7027 5d2c 200a 2020 2020 2020 2020  rop'], .        
+0001c8e0: 2020 2020 2020 2020 2020 2020 736b 6970              skip
+0001c8f0: 5f64 726f 703d 7061 7261 6d73 5b27 736b  _drop=params['sk
+0001c900: 6970 5f64 726f 7027 5d2c 206d 696e 5f63  ip_drop'], min_c
+0001c910: 6869 6c64 5f77 6569 6768 743d 7061 7261  hild_weight=para
+0001c920: 6d73 5b27 6d69 6e5f 6368 696c 645f 7765  ms['min_child_we
+0001c930: 6967 6874 275d 2c20 6d61 785f 6465 6c74  ight'], max_delt
+0001c940: 615f 7374 6570 3d70 6172 616d 735b 276d  a_step=params['m
+0001c950: 6178 5f64 656c 7461 5f73 7465 7027 5d2c  ax_delta_step'],
+0001c960: 2073 7562 7361 6d70 6c65 3d70 6172 616d   subsample=param
+0001c970: 735b 2773 7562 7361 6d70 6c65 275d 2c0a  s['subsample'],.
+0001c980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c990: 2020 2020 7363 616c 655f 706f 735f 7765      scale_pos_we
+0001c9a0: 6967 6874 3d73 616d 706c 655f 7765 6967  ight=sample_weig
+0001c9b0: 6874 2c20 7261 6e64 6f6d 5f73 7461 7465  ht, random_state
+0001c9c0: 3d31 3930 3929 0a20 2020 2020 2020 2020  =1909).         
+0001c9d0: 2020 2065 6c69 6620 7061 7261 6d73 5b27     elif params['
+0001c9e0: 626f 6f73 7465 7227 5d20 3d3d 2027 6762  booster'] == 'gb
+0001c9f0: 7472 6565 273a 0a20 2020 2020 2020 2020  tree':.         
+0001ca00: 2020 2020 2020 206d 6f64 656c 203d 2058         model = X
+0001ca10: 4742 436c 6173 7369 6669 6572 2862 6f6f  GBClassifier(boo
+0001ca20: 7374 6572 3d70 6172 616d 735b 2762 6f6f  ster=params['boo
+0001ca30: 7374 6572 275d 2c20 6e5f 6573 7469 6d61  ster'], n_estima
+0001ca40: 746f 7273 3d70 6172 616d 735b 276e 5f65  tors=params['n_e
+0001ca50: 7374 696d 6174 6f72 7327 5d2c 2063 6f6c  stimators'], col
+0001ca60: 7361 6d70 6c65 5f62 7974 7265 653d 7061  sample_bytree=pa
+0001ca70: 7261 6d73 5b27 636f 6c73 616d 706c 655f  rams['colsample_
+0001ca80: 6279 7472 6565 275d 2c20 0a20 2020 2020  bytree'], .     
+0001ca90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001caa0: 6567 5f6c 616d 6264 613d 7061 7261 6d73  eg_lambda=params
+0001cab0: 5b27 7265 675f 6c61 6d62 6461 275d 2c20  ['reg_lambda'], 
+0001cac0: 7265 675f 616c 7068 613d 7061 7261 6d73  reg_alpha=params
+0001cad0: 5b27 7265 675f 616c 7068 6127 5d2c 206d  ['reg_alpha'], m
+0001cae0: 6178 5f64 6570 7468 3d70 6172 616d 735b  ax_depth=params[
+0001caf0: 276d 6178 5f64 6570 7468 275d 2c20 6574  'max_depth'], et
+0001cb00: 613d 7061 7261 6d73 5b27 6574 6127 5d2c  a=params['eta'],
+0001cb10: 2067 616d 6d61 3d70 6172 616d 735b 2767   gamma=params['g
+0001cb20: 616d 6d61 275d 2c20 0a20 2020 2020 2020  amma'], .       
+0001cb30: 2020 2020 2020 2020 2020 2020 2067 726f               gro
+0001cb40: 775f 706f 6c69 6379 3d70 6172 616d 735b  w_policy=params[
+0001cb50: 2767 726f 775f 706f 6c69 6379 275d 2c20  'grow_policy'], 
+0001cb60: 7375 6273 616d 706c 653d 7061 7261 6d73  subsample=params
+0001cb70: 5b27 7375 6273 616d 706c 6527 5d2c 206d  ['subsample'], m
+0001cb80: 696e 5f63 6869 6c64 5f77 6569 6768 743d  in_child_weight=
+0001cb90: 7061 7261 6d73 5b27 6d69 6e5f 6368 696c  params['min_chil
+0001cba0: 645f 7765 6967 6874 275d 2c20 6d61 785f  d_weight'], max_
+0001cbb0: 6465 6c74 615f 7374 6570 3d70 6172 616d  delta_step=param
+0001cbc0: 735b 276d 6178 5f64 656c 7461 5f73 7465  s['max_delta_ste
+0001cbd0: 7027 5d2c 0a20 2020 2020 2020 2020 2020  p'],.           
+0001cbe0: 2020 2020 2020 2020 2073 6361 6c65 5f70           scale_p
+0001cbf0: 6f73 5f77 6569 6768 743d 7361 6d70 6c65  os_weight=sample
+0001cc00: 5f77 6569 6768 742c 2072 616e 646f 6d5f  _weight, random_
+0001cc10: 7374 6174 653d 3139 3039 290a 2020 2020  state=1909).    
+0001cc20: 2020 200a 2020 2020 656c 7365 3a0a 2020     .    else:.  
+0001cc30: 2020 2020 2020 6f62 6a65 6374 6976 6520        objective 
+0001cc40: 3d20 6f62 6a65 6374 6976 655f 636e 6e28  = objective_cnn(
+0001cc50: 6461 7461 5f78 2c20 6461 7461 5f79 2c20  data_x, data_y, 
+0001cc60: 7661 6c5f 706f 7369 7469 7665 3d76 616c  val_positive=val
+0001cc70: 5f58 2c20 7661 6c5f 6e65 6761 7469 7665  _X, val_negative
+0001cc80: 3d76 616c 5f59 2c20 696d 675f 6e75 6d5f  =val_Y, img_num_
+0001cc90: 6368 616e 6e65 6c73 3d69 6d67 5f6e 756d  channels=img_num
+0001cca0: 5f63 6861 6e6e 656c 732c 2063 6c66 3d63  _channels, clf=c
+0001ccb0: 6c66 2c20 0a20 2020 2020 2020 2020 2020  lf, .           
+0001ccc0: 206e 6f72 6d61 6c69 7a65 3d6e 6f72 6d61   normalize=norma
+0001ccd0: 6c69 7a65 2c20 6d69 6e5f 7069 7865 6c3d  lize, min_pixel=
+0001cce0: 6d69 6e5f 7069 7865 6c2c 206d 6178 5f70  min_pixel, max_p
+0001ccf0: 6978 656c 3d6d 6178 5f70 6978 656c 2c20  ixel=max_pixel, 
+0001cd00: 7061 7469 656e 6365 3d70 6174 6965 6e63  patience=patienc
+0001cd10: 652c 206d 6574 7269 633d 6d65 7472 6963  e, metric=metric
+0001cd20: 2c20 6176 6572 6167 653d 6176 6572 6167  , average=averag
+0001cd30: 652c 2020 0a20 2020 2020 2020 2020 2020  e,  .           
+0001cd40: 2074 6573 745f 706f 7369 7469 7665 3d74   test_positive=t
+0001cd50: 6573 745f 706f 7369 7469 7665 2c20 7465  est_positive, te
+0001cd60: 7374 5f6e 6567 6174 6976 653d 7465 7374  st_negative=test
+0001cd70: 5f6e 6567 6174 6976 652c 206f 7074 5f6d  _negative, opt_m
+0001cd80: 6f64 656c 3d6f 7074 5f6d 6f64 656c 2c20  odel=opt_model, 
+0001cd90: 6261 7463 685f 7369 7a65 5f6d 696e 3d62  batch_size_min=b
+0001cda0: 6174 6368 5f73 697a 655f 6d69 6e2c 2062  atch_size_min, b
+0001cdb0: 6174 6368 5f73 697a 655f 6d61 783d 6261  atch_size_max=ba
+0001cdc0: 7463 685f 7369 7a65 5f6d 6178 2c20 7472  tch_size_max, tr
+0001cdd0: 6169 6e5f 6570 6f63 6873 3d74 7261 696e  ain_epochs=train
+0001cde0: 5f65 706f 6368 732c 206f 7074 5f63 763d  _epochs, opt_cv=
+0001cdf0: 6f70 745f 6376 2c0a 2020 2020 2020 2020  opt_cv,.        
+0001ce00: 2020 2020 6f70 745f 6175 673d 6f70 745f      opt_aug=opt_
+0001ce10: 6175 672c 2062 6174 6368 5f6d 696e 3d62  aug, batch_min=b
+0001ce20: 6174 6368 5f6d 696e 2c20 6261 7463 685f  atch_min, batch_
+0001ce30: 6d61 783d 6261 7463 685f 6d61 782c 2062  max=batch_max, b
+0001ce40: 6174 6368 5f6f 7468 6572 3d62 6174 6368  atch_other=batch
+0001ce50: 5f6f 7468 6572 2c20 6261 6c61 6e63 653d  _other, balance=
+0001ce60: 6261 6c61 6e63 652c 2069 6d61 6765 5f73  balance, image_s
+0001ce70: 697a 655f 6d69 6e3d 696d 6167 655f 7369  ize_min=image_si
+0001ce80: 7a65 5f6d 696e 2c20 696d 6167 655f 7369  ze_min, image_si
+0001ce90: 7a65 5f6d 6178 3d69 6d61 6765 5f73 697a  ze_max=image_siz
+0001cea0: 655f 6d61 782c 200a 2020 2020 2020 2020  e_max, .        
+0001ceb0: 2020 2020 7368 6966 743d 7368 6966 742c      shift=shift,
+0001cec0: 206f 7074 5f6d 6178 5f6d 696e 5f70 6978   opt_max_min_pix
+0001ced0: 3d6f 7074 5f6d 6178 5f6d 696e 5f70 6978  =opt_max_min_pix
+0001cee0: 2c20 6f70 745f 6d61 785f 6d61 785f 7069  , opt_max_max_pi
+0001cef0: 783d 6f70 745f 6d61 785f 6d61 785f 7069  x=opt_max_max_pi
+0001cf00: 782c 206d 6173 6b5f 7369 7a65 3d6d 6173  x, mask_size=mas
+0001cf10: 6b5f 7369 7a65 2c20 6e75 6d5f 6d61 736b  k_size, num_mask
+0001cf20: 733d 6e75 6d5f 6d61 736b 732c 2073 6d6f  s=num_masks, smo
+0001cf30: 7465 5f73 616d 706c 696e 673d 736d 6f74  te_sampling=smot
+0001cf40: 655f 7361 6d70 6c69 6e67 2c20 0a20 2020  e_sampling, .   
+0001cf50: 2020 2020 2020 2020 2062 6c65 6e64 5f6d           blend_m
+0001cf60: 6178 3d62 6c65 6e64 5f6d 6178 2c20 6e75  ax=blend_max, nu
+0001cf70: 6d5f 696d 6167 6573 5f74 6f5f 626c 656e  m_images_to_blen
+0001cf80: 643d 6e75 6d5f 696d 6167 6573 5f74 6f5f  d=num_images_to_
+0001cf90: 626c 656e 642c 2062 6c65 6e64 696e 675f  blend, blending_
+0001cfa0: 6675 6e63 3d62 6c65 6e64 696e 675f 6675  func=blending_fu
+0001cfb0: 6e63 2c20 626c 656e 645f 6f74 6865 723d  nc, blend_other=
+0001cfc0: 626c 656e 645f 6f74 6865 722c 207a 6f6f  blend_other, zoo
+0001cfd0: 6d5f 7261 6e67 653d 7a6f 6f6d 5f72 616e  m_range=zoom_ran
+0001cfe0: 6765 2c20 736b 6577 5f61 6e67 6c65 3d73  ge, skew_angle=s
+0001cff0: 6b65 775f 616e 676c 652c 0a20 2020 2020  kew_angle,.     
+0001d000: 2020 2020 2020 206c 696d 6974 5f73 6561         limit_sea
+0001d010: 7263 683d 6c69 6d69 745f 7365 6172 6368  rch=limit_search
+0001d020: 2c20 6d6f 6e69 746f 7231 3d6d 6f6e 6974  , monitor1=monit
+0001d030: 6f72 312c 206d 6f6e 6974 6f72 323d 6d6f  or1, monitor2=mo
+0001d040: 6e69 746f 7232 2c20 6d6f 6e69 746f 7231  nitor2, monitor1
+0001d050: 5f74 6872 6573 683d 6d6f 6e69 746f 7231  _thresh=monitor1
+0001d060: 5f74 6872 6573 682c 206d 6f6e 6974 6f72  _thresh, monitor
+0001d070: 325f 7468 7265 7368 3d6d 6f6e 6974 6f72  2_thresh=monitor
+0001d080: 325f 7468 7265 7368 2c20 7665 7262 6f73  2_thresh, verbos
+0001d090: 653d 7665 7262 6f73 6529 2020 2020 2020  e=verbose)      
+0001d0a0: 0a20 2020 2020 2020 2073 7475 6479 2e6f  .        study.o
+0001d0b0: 7074 696d 697a 6528 6f62 6a65 6374 6976  ptimize(objectiv
+0001d0c0: 652c 206e 5f74 7269 616c 733d 6e5f 6974  e, n_trials=n_it
+0001d0d0: 6572 2c20 7368 6f77 5f70 726f 6772 6573  er, show_progres
+0001d0e0: 735f 6261 723d 5472 7565 2c20 6763 5f61  s_bar=True, gc_a
+0001d0f0: 6674 6572 5f74 7269 616c 3d54 7275 6529  fter_trial=True)
+0001d100: 232c 206e 5f6a 6f62 733d 3129 0a20 2020  #, n_jobs=1).   
+0001d110: 2020 2020 2070 6172 616d 7320 3d20 7374       params = st
+0001d120: 7564 792e 6265 7374 5f74 7269 616c 2e70  udy.best_trial.p
+0001d130: 6172 616d 730a 0a20 2020 2066 696e 616c  arams..    final
+0001d140: 5f73 636f 7265 203d 2073 7475 6479 2e62  _score = study.b
+0001d150: 6573 745f 7661 6c75 650a 0a20 2020 2069  est_value..    i
+0001d160: 6620 636c 6620 3d3d 2027 7266 2720 6f72  f clf == 'rf' or
+0001d170: 2063 6c66 203d 3d20 2778 6762 2720 6f72   clf == 'xgb' or
+0001d180: 2063 6c66 203d 3d20 276e 6e27 3a0a 2020   clf == 'nn':.  
+0001d190: 2020 2020 2020 6966 2069 6e69 7469 616c        if initial
+0001d1a0: 5f73 636f 7265 203e 2066 696e 616c 5f73  _score > final_s
+0001d1b0: 636f 7265 3a0a 2020 2020 2020 2020 2020  core:.          
+0001d1c0: 2020 7072 696e 7428 2748 7970 6572 7061    print('Hyperpa
+0001d1d0: 7261 6d65 7465 7220 6f70 7469 6d69 7a61  rameter optimiza
+0001d1e0: 7469 6f6e 2063 6f6d 706c 6574 6521 204f  tion complete! O
+0001d1f0: 7074 696d 616c 2070 6572 666f 726d 616e  ptimal performan
+0001d200: 6365 206f 6620 7b7d 2069 7320 4c4f 5745  ce of {} is LOWE
+0001d210: 5220 7468 616e 2074 6865 2062 6173 6520  R than the base 
+0001d220: 7065 7266 6f72 6d61 6e63 6520 6f66 207b  performance of {
+0001d230: 7d2c 2074 7279 2069 6e63 7265 6173 696e  }, try increasin
+0001d240: 6720 7468 6520 7661 6c75 6520 6f66 206e  g the value of n
+0001d250: 5f69 7465 7220 616e 6420 7275 6e20 6167  _iter and run ag
+0001d260: 6169 6e2e 272e 666f 726d 6174 286e 702e  ain.'.format(np.
+0001d270: 726f 756e 6428 6669 6e61 6c5f 7363 6f72  round(final_scor
+0001d280: 652c 2038 292c 206e 702e 726f 756e 6428  e, 8), np.round(
+0001d290: 696e 6974 6961 6c5f 7363 6f72 652c 2038  initial_score, 8
+0001d2a0: 2929 290a 2020 2020 2020 2020 656c 7365  ))).        else
+0001d2b0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0001d2c0: 696e 7428 2748 7970 6572 7061 7261 6d65  int('Hyperparame
+0001d2d0: 7465 7220 6f70 7469 6d69 7a61 7469 6f6e  ter optimization
+0001d2e0: 2063 6f6d 706c 6574 6521 204f 7074 696d   complete! Optim
+0001d2f0: 616c 2070 6572 666f 726d 616e 6365 206f  al performance o
+0001d300: 6620 7b7d 2069 7320 4849 4748 4552 2074  f {} is HIGHER t
+0001d310: 6861 6e20 7468 6520 6261 7365 2070 6572  han the base per
+0001d320: 666f 726d 616e 6365 206f 6620 7b7d 2e27  formance of {}.'
+0001d330: 2e66 6f72 6d61 7428 6e70 2e72 6f75 6e64  .format(np.round
+0001d340: 2866 696e 616c 5f73 636f 7265 2c20 3829  (final_score, 8)
+0001d350: 2c20 6e70 2e72 6f75 6e64 2869 6e69 7469  , np.round(initi
+0001d360: 616c 5f73 636f 7265 2c20 3829 2929 0a20  al_score, 8))). 
+0001d370: 2020 2020 2020 2069 6620 7265 7475 726e         if return
+0001d380: 5f73 7475 6479 3a0a 2020 2020 2020 2020  _study:.        
+0001d390: 2020 2020 7265 7475 726e 206d 6f64 656c      return model
+0001d3a0: 2c20 7061 7261 6d73 2c20 7374 7564 790a  , params, study.
+0001d3b0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+0001d3c0: 6f64 656c 2c20 7061 7261 6d73 0a20 2020  odel, params.   
+0001d3d0: 2065 6c73 653a 0a20 2020 2020 2020 2070   else:.        p
+0001d3e0: 7269 6e74 2827 4879 7065 7270 6172 616d  rint('Hyperparam
+0001d3f0: 6574 6572 206f 7074 696d 697a 6174 696f  eter optimizatio
+0001d400: 6e20 636f 6d70 6c65 7465 2120 4f70 7469  n complete! Opti
+0001d410: 6d61 6c20 7065 7266 6f72 6d61 6e63 653a  mal performance:
+0001d420: 207b 7d27 2e66 6f72 6d61 7428 6e70 2e72   {}'.format(np.r
+0001d430: 6f75 6e64 2866 696e 616c 5f73 636f 7265  ound(final_score
+0001d440: 2c20 3829 2929 0a20 2020 2020 2020 2069  , 8))).        i
+0001d450: 6620 7265 7475 726e 5f73 7475 6479 3a0a  f return_study:.
+0001d460: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001d470: 726e 2070 6172 616d 732c 2073 7475 6479  rn params, study
+0001d480: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001d490: 7061 7261 6d73 0a0a 6465 6620 626f 7275  params..def boru
+0001d4a0: 7461 7368 6170 5f6f 7074 2864 6174 615f  tashap_opt(data_
+0001d4b0: 782c 2064 6174 615f 792c 2062 6f72 7574  x, data_y, borut
+0001d4c0: 615f 7472 6961 6c73 3d35 302c 206d 6f64  a_trials=50, mod
+0001d4d0: 656c 3d27 7266 272c 2069 6d70 6f72 7461  el='rf', importa
+0001d4e0: 6e63 655f 7479 7065 3d27 6761 696e 2729  nce_type='gain')
+0001d4f0: 3a0a 2020 2020 2222 220a 2020 2020 4170  :.    """.    Ap
+0001d500: 706c 6965 7320 6120 636f 6d62 696e 6174  plies a combinat
+0001d510: 696f 6e20 6f66 2074 6865 2042 6f72 7574  ion of the Borut
+0001d520: 6120 616c 676f 7269 7468 6d20 616e 640a  a algorithm and.
+0001d530: 2020 2020 5368 6170 6c65 7920 7661 6c75      Shapley valu
+0001d540: 6573 2c20 6120 6d65 7468 6f64 2064 6576  es, a method dev
+0001d550: 656c 6f70 6564 2062 7920 456f 6768 616e  eloped by Eoghan
+0001d560: 204b 6561 6e79 2028 3230 3230 292e 0a0a   Keany (2020)...
+0001d570: 2020 2020 5365 653a 2068 7474 7073 3a2f      See: https:/
+0001d580: 2f64 6f69 2e6f 7267 2f31 302e 3532 3831  /doi.org/10.5281
+0001d590: 2f7a 656e 6f64 6f2e 3432 3437 3631 380a  /zenodo.4247618.
+0001d5a0: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
+0001d5b0: 2020 2064 6174 615f 7820 286e 6461 7272     data_x (ndarr
+0001d5c0: 6179 293a 2032 4420 6172 7261 7920 6f66  ay): 2D array of
+0001d5d0: 2073 697a 6520 286e 2078 206d 292c 2077   size (n x m), w
+0001d5e0: 6865 7265 206e 2069 7320 7468 650a 2020  here n is the.  
+0001d5f0: 2020 2020 2020 2020 2020 6e75 6d62 6572            number
+0001d600: 206f 6620 7361 6d70 6c65 732c 2061 6e64   of samples, and
+0001d610: 206d 2074 6865 206e 756d 6265 7220 6f66   m the number of
+0001d620: 2066 6561 7475 7265 732e 0a20 2020 2020   features..     
+0001d630: 2020 2064 6174 615f 7920 286e 6461 7272     data_y (ndarr
+0001d640: 6179 2c20 7374 7229 3a20 3144 2061 7272  ay, str): 1D arr
+0001d650: 6179 2063 6f6e 7461 696e 696e 6720 7468  ay containing th
+0001d660: 6520 636f 7272 6573 706f 6e69 6e67 206c  e corresponing l
+0001d670: 6162 656c 732e 0a20 2020 2020 2020 2062  abels..        b
+0001d680: 6f72 7574 615f 7472 6961 6c73 2028 696e  oruta_trials (in
+0001d690: 7429 3a20 5468 6520 6e75 6d62 6572 206f  t): The number o
+0001d6a0: 6620 7472 6961 6c73 2074 6f20 7275 6e2e  f trials to run.
+0001d6b0: 2041 206c 6172 6765 7220 6e75 6d62 6572   A larger number
+0001d6c0: 2069 730a 2020 2020 2020 2020 2020 2020   is.            
+0001d6d0: 6265 7474 6572 2061 7320 7468 6520 6469  better as the di
+0001d6e0: 7374 7269 6275 7469 6f6e 2077 696c 6c20  stribution will 
+0001d6f0: 6265 206d 6f72 6520 726f 6275 7374 2074  be more robust t
+0001d700: 6f20 7261 6e64 6f6d 2066 6c75 6374 7561  o random fluctua
+0001d710: 7469 6f6e 732e 200a 2020 2020 2020 2020  tions. .        
+0001d720: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
+0001d730: 3530 2e0a 2020 2020 2020 2020 6d6f 6465  50..        mode
+0001d740: 6c20 2873 7472 293a 2054 6865 2065 6e73  l (str): The ens
+0001d750: 656d 626c 6520 6d65 7468 6f64 2074 6f20  emble method to 
+0001d760: 7573 6520 7768 656e 2066 6974 7469 6e67  use when fitting
+0001d770: 2061 6e64 2063 616c 6375 6c61 7469 6e67   and calculating
+0001d780: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+0001d790: 2066 6561 7475 7265 2069 6d70 6f72 7461   feature importa
+0001d7a0: 6e63 6520 6d65 7472 6963 2e20 4f6e 6c79  nce metric. Only
+0001d7b0: 2074 776f 206f 7074 696f 6e73 2061 7265   two options are
+0001d7c0: 2063 7572 7265 6e74 6c79 0a20 2020 2020   currently.     
+0001d7d0: 2020 2020 2020 2073 7570 706f 7274 6564         supported
+0001d7e0: 2c20 2772 6627 2066 6f72 2052 616e 646f  , 'rf' for Rando
+0001d7f0: 6d20 466f 7265 7374 2061 6e64 2027 7867  m Forest and 'xg
+0001d800: 6227 2066 6f72 2045 7874 7265 6d65 2047  b' for Extreme G
+0001d810: 7261 6469 656e 7420 426f 6f73 7469 6e67  radient Boosting
+0001d820: 2e0a 2020 2020 2020 2020 2020 2020 4465  ..            De
+0001d830: 6661 756c 7473 2074 6f20 2772 6627 2e0a  faults to 'rf'..
+0001d840: 2020 2020 2020 2020 696d 706f 7274 616e          importan
+0001d850: 6365 5f74 7970 6520 2873 7472 293a 2054  ce_type (str): T
+0001d860: 6865 2066 6561 7475 7265 2069 6d70 6f72  he feature impor
+0001d870: 7461 6e63 6520 7479 7065 2074 6f20 7573  tance type to us
+0001d880: 652c 206f 6e6c 7920 6170 706c 6963 6162  e, only applicab
+0001d890: 6c65 0a20 2020 2020 2020 2020 2020 2077  le.            w
+0001d8a0: 6865 6e20 7573 696e 6720 636c 663d 2778  hen using clf='x
+0001d8b0: 6762 272e 2054 6865 206f 7074 696f 6e73  gb'. The options
+0001d8c0: 2069 6e63 6c75 6465 20e2 809c 6761 696e   include ...gain
+0001d8d0: e280 9d2c 20e2 809c 7765 6967 6874 e280  ..., ...weight..
+0001d8e0: 9d2c 20e2 809c 636f 7665 72e2 809d 2c0a  ., ...cover...,.
+0001d8f0: 2020 2020 2020 2020 2020 2020 e280 9c74              ...t
+0001d900: 6f74 616c 5f67 6169 6ee2 809d 206f 7220  otal_gain... or 
+0001d910: e280 9c74 6f74 616c 5f63 6f76 6572 e280  ...total_cover..
+0001d920: 9d2e 2044 6566 6175 6c74 7320 746f 2027  .. Defaults to '
+0001d930: 6761 696e 272e 0a0a 2020 2020 5265 7475  gain'...    Retu
+0001d940: 726e 733a 0a20 2020 2020 2020 2046 6972  rns:.        Fir
+0001d950: 7374 206f 7574 7075 7420 6973 2061 2031  st output is a 1
+0001d960: 4420 6172 7261 7920 636f 6e74 6169 6e69  D array containi
+0001d970: 6e67 2074 6865 2069 6e64 6963 6573 206f  ng the indices o
+0001d980: 6620 7468 6520 7365 6c65 6374 6564 2066  f the selected f
+0001d990: 6561 7475 7265 732e 200a 2020 2020 2020  eatures. .      
+0001d9a0: 2020 5468 6573 6520 696e 6469 6365 7320    These indices 
+0001d9b0: 6361 6e20 7468 656e 2062 6520 7573 6564  can then be used
+0001d9c0: 2074 6f20 7365 6c65 6374 2074 6865 2063   to select the c
+0001d9d0: 6f6c 756d 6e73 2069 6e20 7468 6520 6461  olumns in the da
+0001d9e0: 7461 5f78 2061 7272 6179 2e0a 2020 2020  ta_x array..    
+0001d9f0: 2020 2020 5365 636f 6e64 206f 7574 7075      Second outpu
+0001da00: 7420 6973 2074 6865 2066 6561 7475 7265  t is the feature
+0001da10: 2073 656c 6563 7469 6f6e 206f 626a 6563   selection objec
+0001da20: 742c 2077 6869 6368 2063 6f6e 7461 696e  t, which contain
+0001da30: 7320 6665 6174 7572 6520 7365 6c65 6374  s feature select
+0001da40: 696f 6e0a 2020 2020 2020 2020 6869 7374  ion.        hist
+0001da50: 6f72 7920 696e 666f 726d 6174 696f 6e20  ory information 
+0001da60: 616e 6420 7669 7375 616c 697a 6174 696f  and visualizatio
+0001da70: 6e20 6f70 7469 6f6e 732e 0a20 2020 2022  n options..    "
+0001da80: 2222 0a20 2020 200a 2020 2020 6966 2062  "".    .    if b
+0001da90: 6f72 7574 615f 7472 6961 6c73 203d 3d20  oruta_trials == 
+0001daa0: 303a 2023 5468 6973 2069 7320 7468 6520  0: #This is the 
+0001dab0: 666c 6167 2074 6861 7420 7468 6520 656e  flag that the en
+0001dac0: 7365 6d62 6c65 5f6d 6f64 656c 2e43 6c61  semble_model.Cla
+0001dad0: 7373 6966 6965 7220 636c 6173 7320 7573  ssifier class us
+0001dae0: 6573 2074 6f20 6469 7361 626c 6520 6665  es to disable fe
+0001daf0: 6174 7572 6520 7365 6c65 6374 696f 6e0a  ature selection.
+0001db00: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+0001db10: 702e 6172 616e 6765 2864 6174 615f 782e  p.arange(data_x.
+0001db20: 7368 6170 655b 315d 292c 204e 6f6e 650a  shape[1]), None.
+0001db30: 0a20 2020 2069 6620 626f 7275 7461 5f74  .    if boruta_t
+0001db40: 7269 616c 7320 3c20 3230 3a0a 2020 2020  rials < 20:.    
+0001db50: 2020 2020 7072 696e 7428 2757 4152 4e49      print('WARNI
+0001db60: 4e47 3a20 5265 7375 6c74 7320 6172 6520  NG: Results are 
+0001db70: 756e 7374 6162 6c65 2069 6620 626f 7275  unstable if boru
+0001db80: 7461 5f74 7269 616c 7320 6973 2074 6f6f  ta_trials is too
+0001db90: 206c 6f77 2127 290a 2020 2020 6966 206e   low!').    if n
+0001dba0: 702e 616e 7928 6e70 2e69 736e 616e 2864  p.any(np.isnan(d
+0001dbb0: 6174 615f 7829 293a 0a20 2020 2020 2020  ata_x)):.       
+0001dbc0: 2023 7072 696e 7428 274e 614e 2076 616c   #print('NaN val
+0001dbd0: 7565 7320 6465 7465 6374 6564 2c20 6170  ues detected, ap
+0001dbe0: 706c 7969 6e67 2053 7472 6177 6d61 6e20  plying Strawman 
+0001dbf0: 696d 7075 7461 7469 6f6e 2e2e 2e27 290a  imputation...').
+0001dc00: 2020 2020 2020 2020 6461 7461 5f78 203d          data_x =
+0001dc10: 2053 7472 6177 6d61 6e5f 696d 7075 7461   Strawman_imputa
+0001dc20: 7469 6f6e 2864 6174 615f 7829 0a0a 2020  tion(data_x)..  
+0001dc30: 2020 6966 206d 6f64 656c 203d 3d20 2772    if model == 'r
+0001dc40: 6627 3a0a 2020 2020 2020 2020 636c 6173  f':.        clas
+0001dc50: 7369 6669 6572 203d 2052 616e 646f 6d46  sifier = RandomF
+0001dc60: 6f72 6573 7443 6c61 7373 6966 6965 7228  orestClassifier(
+0001dc70: 7261 6e64 6f6d 5f73 7461 7465 3d31 3930  random_state=190
+0001dc80: 3929 0a20 2020 2065 6c69 6620 6d6f 6465  9).    elif mode
+0001dc90: 6c20 3d3d 2027 7867 6227 3a0a 2020 2020  l == 'xgb':.    
+0001dca0: 2020 2020 636c 6173 7369 6669 6572 203d      classifier =
+0001dcb0: 2058 4742 436c 6173 7369 6669 6572 2874   XGBClassifier(t
+0001dcc0: 7265 655f 6d65 7468 6f64 3d27 6578 6163  ree_method='exac
+0001dcd0: 7427 2c20 6d61 785f 6465 7074 683d 3230  t', max_depth=20
+0001dce0: 2c20 696d 706f 7274 616e 6365 5f74 7970  , importance_typ
+0001dcf0: 653d 696d 706f 7274 616e 6365 5f74 7970  e=importance_typ
+0001dd00: 652c 2072 616e 646f 6d5f 7374 6174 653d  e, random_state=
+0001dd10: 3139 3039 290a 2020 2020 656c 7365 3a0a  1909).    else:.
+0001dd20: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0001dd30: 6c75 6545 7272 6f72 2827 4d6f 6465 6c20  lueError('Model 
+0001dd40: 6172 6775 6d65 6e74 206d 7573 7420 6569  argument must ei
+0001dd50: 7468 6572 2062 6520 2272 6622 206f 7220  ther be "rf" or 
+0001dd60: 2278 6762 222e 2729 0a20 2020 200a 2020  "xgb".').    .  
+0001dd70: 2020 7472 793a 0a20 2020 2020 2020 2023    try:.        #
+0001dd80: 426f 7275 7461 5368 6170 2070 726f 6772  BorutaShap progr
+0001dd90: 616d 2072 6571 7569 7265 7320 696e 7075  am requires inpu
+0001dda0: 7420 746f 2068 6176 6520 7468 6520 636f  t to have the co
+0001ddb0: 6c75 6d6e 7320 6174 7472 6962 7574 650a  lumns attribute.
+0001ddc0: 2020 2020 2020 2020 2343 6f6e 7665 7274          #Convert
+0001ddd0: 696e 6720 746f 2050 616e 6461 7320 6461  ing to Pandas da
+0001dde0: 7461 6672 616d 650a 2020 2020 2020 2020  taframe.        
+0001ddf0: 636f 6c73 203d 205b 7374 7228 6929 2066  cols = [str(i) f
+0001de00: 6f72 2069 2069 6e20 6e70 2e61 7261 6e67  or i in np.arang
+0001de10: 6528 6461 7461 5f78 2e73 6861 7065 5b31  e(data_x.shape[1
+0001de20: 5d29 5d0a 2020 2020 2020 2020 5820 3d20  ])].        X = 
+0001de30: 4461 7461 4672 616d 6528 6461 7461 5f78  DataFrame(data_x
+0001de40: 2c20 636f 6c75 6d6e 733d 636f 6c73 290a  , columns=cols).
+0001de50: 2020 2020 2020 2020 7920 3d20 6e70 2e7a          y = np.z
+0001de60: 6572 6f73 286c 656e 2864 6174 615f 7929  eros(len(data_y)
+0001de70: 290a 0a20 2020 2020 2020 2023 4265 6c6f  )..        #Belo
+0001de80: 7720 6973 2074 6f20 636f 6e76 6572 7420  w is to convert 
+0001de90: 6361 7465 676f 7269 6361 6c20 6c61 6265  categorical labe
+0001dea0: 6c73 2074 6f20 6e75 6d65 7269 6361 6c2c  ls to numerical,
+0001deb0: 2061 7320 7065 7220 426f 7275 7461 5368   as per BorutaSh
+0001dec0: 6170 2072 6571 7569 7265 6d65 6e74 730a  ap requirements.
+0001ded0: 2020 2020 2020 2020 666f 7220 692c 206c          for i, l
+0001dee0: 6162 656c 2069 6e20 656e 756d 6572 6174  abel in enumerat
+0001def0: 6528 6e70 2e75 6e69 7175 6528 6461 7461  e(np.unique(data
+0001df00: 5f79 2929 3a0a 2020 2020 2020 2020 2020  _y)):.          
+0001df10: 2020 6d61 736b 203d 206e 702e 7768 6572    mask = np.wher
+0001df20: 6528 6461 7461 5f79 203d 3d20 6c61 6265  e(data_y == labe
+0001df30: 6c29 5b30 5d0a 2020 2020 2020 2020 2020  l)[0].          
+0001df40: 2020 795b 6d61 736b 5d20 3d20 690a 0a20    y[mask] = i.. 
+0001df50: 2020 2020 2020 2066 6561 745f 7365 6c65         feat_sele
+0001df60: 6374 6f72 203d 2042 6f72 7574 6153 6861  ctor = BorutaSha
+0001df70: 7028 6d6f 6465 6c3d 636c 6173 7369 6669  p(model=classifi
+0001df80: 6572 2c20 696d 706f 7274 616e 6365 5f6d  er, importance_m
+0001df90: 6561 7375 7265 3d27 7368 6170 272c 2063  easure='shap', c
+0001dfa0: 6c61 7373 6966 6963 6174 696f 6e3d 5472  lassification=Tr
+0001dfb0: 7565 290a 2020 2020 2020 2020 7072 696e  ue).        prin
+0001dfc0: 7428 2752 756e 6e69 6e67 2066 6561 7475  t('Running featu
+0001dfd0: 7265 2073 656c 6563 7469 6f6e 2e2e 2e27  re selection...'
+0001dfe0: 290a 2020 2020 2020 2020 6665 6174 5f73  ).        feat_s
+0001dff0: 656c 6563 746f 722e 6669 7428 583d 582c  elector.fit(X=X,
+0001e000: 2079 3d79 2c20 6e5f 7472 6961 6c73 3d62   y=y, n_trials=b
+0001e010: 6f72 7574 615f 7472 6961 6c73 2c20 7665  oruta_trials, ve
+0001e020: 7262 6f73 653d 4661 6c73 652c 2072 616e  rbose=False, ran
+0001e030: 646f 6d5f 7374 6174 653d 3139 3039 290a  dom_state=1909).
+0001e040: 0a20 2020 2020 2020 2069 6e64 6578 203d  .        index =
+0001e050: 206e 702e 6172 7261 7928 5b69 6e74 2866   np.array([int(f
+0001e060: 6561 7429 2066 6f72 2066 6561 7420 696e  eat) for feat in
+0001e070: 2066 6561 745f 7365 6c65 6374 6f72 2e61   feat_selector.a
+0001e080: 6363 6570 7465 645d 290a 2020 2020 2020  ccepted]).      
+0001e090: 2020 696e 6465 782e 736f 7274 2829 0a20    index.sort(). 
+0001e0a0: 2020 2020 2020 2070 7269 6e74 2827 4665         print('Fe
+0001e0b0: 6174 7572 6520 7365 6c65 6374 696f 6e20  ature selection 
+0001e0c0: 636f 6d70 6c65 7465 2c20 7b7d 2073 656c  complete, {} sel
+0001e0d0: 6563 7465 6420 6f75 7420 6f66 207b 7d21  ected out of {}!
+0001e0e0: 272e 666f 726d 6174 286c 656e 2869 6e64  '.format(len(ind
+0001e0f0: 6578 292c 2064 6174 615f 782e 7368 6170  ex), data_x.shap
+0001e100: 655b 315d 2929 0a20 2020 2065 7863 6570  e[1])).    excep
+0001e110: 743a 0a20 2020 2020 2020 2070 7269 6e74  t:.        print
+0001e120: 2827 426f 7275 7461 2077 6974 6820 5368  ('Boruta with Sh
+0001e130: 6170 6c65 7920 7661 6c75 6573 2066 6169  apley values fai
+0001e140: 6c65 642c 2073 7769 7463 6869 6e67 2074  led, switching t
+0001e150: 6f20 6f72 6967 696e 616c 2042 6f72 7574  o original Borut
+0001e160: 612e 2e2e 2729 0a20 2020 2020 2020 2069  a...').        i
+0001e170: 6e64 6578 203d 2062 6f72 7574 615f 6f70  ndex = boruta_op
+0001e180: 7428 6461 7461 5f78 2c20 6461 7461 5f79  t(data_x, data_y
+0001e190: 290a 0a20 2020 2072 6574 7572 6e20 696e  )..    return in
+0001e1a0: 6465 782c 2066 6561 745f 7365 6c65 6374  dex, feat_select
+0001e1b0: 6f72 0a0a 6465 6620 626f 7275 7461 5f6f  or..def boruta_o
+0001e1c0: 7074 2864 6174 615f 782c 2064 6174 615f  pt(data_x, data_
+0001e1d0: 7929 3a0a 2020 2020 2222 220a 2020 2020  y):.    """.    
+0001e1e0: 4170 706c 6965 7320 7468 6520 426f 7275  Applies the Boru
+0001e1f0: 7461 2061 6c67 6f72 6974 686d 2028 4b75  ta algorithm (Ku
+0001e200: 7273 6120 2620 5275 646e 6963 6b69 2032  rsa & Rudnicki 2
+0001e210: 3031 3129 2074 6f20 6964 656e 7469 6679  011) to identify
+0001e220: 2066 6561 7475 7265 730a 2020 2020 7468   features.    th
+0001e230: 6174 2070 6572 666f 726d 2077 6f72 7365  at perform worse
+0001e240: 2074 6861 6e20 7261 6e64 6f6d 2e0a 0a20   than random... 
+0001e250: 2020 2053 6565 3a20 6874 7470 733a 2f2f     See: https://
+0001e260: 6172 7869 762e 6f72 672f 7064 662f 3131  arxiv.org/pdf/11
+0001e270: 3036 2e35 3131 322e 7064 660a 0a20 2020  06.5112.pdf..   
+0001e280: 2041 7267 733a 0a20 2020 2020 2020 2064   Args:.        d
+0001e290: 6174 615f 7820 286e 6461 7272 6179 293a  ata_x (ndarray):
+0001e2a0: 2032 4420 6172 7261 7920 6f66 2073 697a   2D array of siz
+0001e2b0: 6520 286e 2078 206d 292c 2077 6865 7265  e (n x m), where
+0001e2c0: 206e 2069 7320 7468 650a 2020 2020 2020   n is the.      
+0001e2d0: 2020 2020 2020 6e75 6d62 6572 206f 6620        number of 
+0001e2e0: 7361 6d70 6c65 732c 2061 6e64 206d 2074  samples, and m t
+0001e2f0: 6865 206e 756d 6265 7220 6f66 2066 6561  he number of fea
+0001e300: 7475 7265 732e 0a20 2020 2020 2020 2064  tures..        d
+0001e310: 6174 615f 7920 286e 6461 7272 6179 2c20  ata_y (ndarray, 
+0001e320: 7374 7229 3a20 3144 2061 7272 6179 2063  str): 1D array c
+0001e330: 6f6e 7461 696e 696e 6720 7468 6520 636f  ontaining the co
+0001e340: 7272 6573 706f 6e69 6e67 206c 6162 656c  rresponing label
+0001e350: 732e 0a20 2020 2020 2020 2020 2020 200a  s..            .
+0001e360: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+0001e370: 2020 2020 2031 4420 6172 7261 7920 636f       1D array co
+0001e380: 6e74 6169 6e69 6e67 2074 6865 2069 6e64  ntaining the ind
+0001e390: 6963 6573 206f 6620 7468 6520 7365 6c65  ices of the sele
+0001e3a0: 6374 6564 2066 6561 7475 7265 732e 2054  cted features. T
+0001e3b0: 6869 7320 6361 6e20 7468 656e 0a20 2020  his can then.   
+0001e3c0: 2020 2020 2062 6520 7573 6564 2074 6f20       be used to 
+0001e3d0: 696e 6465 7820 7468 6520 636f 6c75 6d6e  index the column
+0001e3e0: 7320 696e 2074 6865 2064 6174 615f 7820  s in the data_x 
+0001e3f0: 6172 7261 792e 0a20 2020 2022 2222 0a0a  array..    """..
+0001e400: 2020 2020 636c 6173 7369 6669 6572 203d      classifier =
+0001e410: 2052 616e 646f 6d46 6f72 6573 7443 6c61   RandomForestCla
+0001e420: 7373 6966 6965 7228 7261 6e64 6f6d 5f73  ssifier(random_s
+0001e430: 7461 7465 3d31 3930 3929 0a0a 2020 2020  tate=1909)..    
+0001e440: 6665 6174 5f73 656c 6563 746f 7220 3d20  feat_selector = 
+0001e450: 426f 7275 7461 5079 2863 6c61 7373 6966  BorutaPy(classif
+0001e460: 6965 722c 206e 5f65 7374 696d 6174 6f72  ier, n_estimator
+0001e470: 733d 2761 7574 6f27 2c20 7261 6e64 6f6d  s='auto', random
+0001e480: 5f73 7461 7465 3d31 3930 3929 0a20 2020  _state=1909).   
+0001e490: 2070 7269 6e74 2827 5275 6e6e 696e 6720   print('Running 
+0001e4a0: 6665 6174 7572 6520 7365 6c65 6374 696f  feature selectio
+0001e4b0: 6e2e 2e2e 2729 0a20 2020 2066 6561 745f  n...').    feat_
+0001e4c0: 7365 6c65 6374 6f72 2e66 6974 2864 6174  selector.fit(dat
+0001e4d0: 615f 782c 2064 6174 615f 7929 0a0a 2020  a_x, data_y)..  
+0001e4e0: 2020 6665 6174 7320 3d20 6e70 2e61 7272    feats = np.arr
+0001e4f0: 6179 285b 7374 7228 6665 6174 2920 666f  ay([str(feat) fo
+0001e500: 7220 6665 6174 2069 6e20 6665 6174 5f73  r feat in feat_s
+0001e510: 656c 6563 746f 722e 7375 7070 6f72 745f  elector.support_
+0001e520: 5d29 0a20 2020 2069 6e64 6578 203d 206e  ]).    index = n
+0001e530: 702e 7768 6572 6528 6665 6174 7320 3d3d  p.where(feats ==
+0001e540: 2027 5472 7565 2729 5b30 5d0a 2020 2020   'True')[0].    
+0001e550: 7072 696e 7428 2746 6561 7475 7265 2073  print('Feature s
+0001e560: 656c 6563 7469 6f6e 2063 6f6d 706c 6574  election complet
+0001e570: 652c 207b 7d20 7365 6c65 6374 6564 206f  e, {} selected o
+0001e580: 7574 206f 6620 7b7d 2127 2e66 6f72 6d61  ut of {}!'.forma
+0001e590: 7428 6c65 6e28 696e 6465 7829 2c6c 656e  t(len(index),len
+0001e5a0: 2866 6561 745f 7365 6c65 6374 6f72 2e73  (feat_selector.s
+0001e5b0: 7570 706f 7274 2929 290a 2020 2020 7265  upport))).    re
+0001e5c0: 7475 726e 2069 6e64 6578 0a0a 6465 6620  turn index..def 
+0001e5d0: 5374 7261 776d 616e 5f69 6d70 7574 6174  Strawman_imputat
+0001e5e0: 696f 6e28 6461 7461 293a 0a20 2020 2022  ion(data):.    "
+0001e5f0: 2222 0a20 2020 2050 6572 666f 726d 2053  "".    Perform S
+0001e600: 7472 6177 6d61 6e20 696d 7075 7461 7469  trawman imputati
+0001e610: 6f6e 2c20 6120 7469 6d65 2d65 6666 6963  on, a time-effic
+0001e620: 6965 6e74 2061 6c67 6f72 6974 686d 0a20  ient algorithm. 
+0001e630: 2020 2069 6e20 7768 6963 6820 6d69 7373     in which miss
+0001e640: 696e 6720 6461 7461 2076 616c 7565 7320  ing data values 
+0001e650: 6172 6520 7265 706c 6163 6564 2077 6974  are replaced wit
+0001e660: 6820 7468 6520 6d65 6469 616e 0a20 2020  h the median.   
+0001e670: 2076 616c 7565 206f 6620 7468 6520 656e   value of the en
+0001e680: 7469 7265 2c20 6e6f 6e2d 4e61 4e20 7361  tire, non-NaN sa
+0001e690: 6d70 6c65 2e20 4966 2074 6865 2064 6174  mple. If the dat
+0001e6a0: 6120 6973 2061 2068 6f74 2d65 6e63 6f64  a is a hot-encod
+0001e6b0: 6564 0a20 2020 2062 6f6f 6c65 616e 2028  ed.    boolean (
+0001e6c0: 6173 2074 6865 2052 4620 646f 6573 206e  as the RF does n
+0001e6d0: 6f74 2061 6c6c 6f77 2054 7275 6520 6f72  ot allow True or
+0001e6e0: 2046 616c 7365 292c 2074 6865 6e20 7468   False), then th
+0001e6f0: 6520 0a20 2020 2069 6e73 7461 6e63 6520  e .    instance 
+0001e700: 7468 6174 2069 7320 7573 6564 2074 6865  that is used the
+0001e710: 206d 6f73 7420 7769 6c6c 2062 6520 636f   most will be co
+0001e720: 6d70 7574 6564 2061 7320 7468 6520 6d65  mputed as the me
+0001e730: 6469 616e 2e20 0a0a 2020 2020 5468 6973  dian. ..    This
+0001e740: 2069 7320 7468 6520 6261 7365 6c69 6e65   is the baseline
+0001e750: 2061 6c67 6f72 6974 686d 2075 7365 6420   algorithm used 
+0001e760: 6279 2028 5461 6e67 2026 2049 7368 7761  by (Tang & Ishwa
+0001e770: 7261 6e20 3230 3137 292e 0a20 2020 2053  ran 2017)..    S
+0001e780: 6565 3a20 6874 7470 733a 2f2f 6172 7869  ee: https://arxi
+0001e790: 762e 6f72 672f 7064 662f 3137 3031 2e30  v.org/pdf/1701.0
+0001e7a0: 3533 3035 2e70 6466 0a0a 2020 2020 4e6f  5305.pdf..    No
+0001e7b0: 7465 3a0a 2020 2020 2020 2020 5468 6973  te:.        This
+0001e7c0: 2066 756e 6374 696f 6e20 6173 7375 6d65   function assume
+0001e7d0: 7320 6561 6368 2072 6f77 2063 6f72 7265  s each row corre
+0001e7e0: 7370 6f6e 6473 2074 6f20 6f6e 6520 7361  sponds to one sa
+0001e7f0: 6d70 6c65 2c20 616e 6420 0a20 2020 2020  mple, and .     
+0001e800: 2020 2074 6861 7420 6d69 7373 696e 6720     that missing 
+0001e810: 7661 6c75 6573 2061 7265 206d 6173 6b65  values are maske
+0001e820: 6420 6173 2065 6974 6865 7220 4e61 4e20  d as either NaN 
+0001e830: 6f72 2069 6e66 2e20 0a0a 2020 2020 4172  or inf. ..    Ar
+0001e840: 6773 3a0a 2020 2020 2020 2020 6461 7461  gs:.        data
+0001e850: 2028 6e64 6172 7261 7929 3a20 3144 2061   (ndarray): 1D a
+0001e860: 7272 6179 2069 6620 7369 6e67 6c65 2070  rray if single p
+0001e870: 6172 616d 6574 6572 2069 7320 696e 7075  arameter is inpu
+0001e880: 742e 2049 660a 2020 2020 2020 2020 2020  t. If.          
+0001e890: 2020 6461 7461 2069 7320 322d 6469 6d65    data is 2-dime
+0001e8a0: 6e73 696f 6e61 6c2c 2074 6865 206d 6564  nsional, the med
+0001e8b0: 6961 6e73 2077 696c 6c20 6265 2063 616c  ians will be cal
+0001e8c0: 6375 6c61 7465 640a 2020 2020 2020 2020  culated.        
+0001e8d0: 2020 2020 7573 696e 6720 7468 6520 6e6f      using the no
+0001e8e0: 6e2d 6d69 7373 696e 6720 7661 6c75 6573  n-missing values
+0001e8f0: 2069 6e20 6561 6368 2063 6f72 7265 7370   in each corresp
+0001e900: 6f6e 6469 6e67 2063 6f6c 756d 6e2e 0a0a  onding column...
+0001e910: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+0001e920: 2020 2020 2054 6865 2064 6174 6120 6172       The data ar
+0001e930: 7261 7920 7769 7468 2074 6865 206d 6973  ray with the mis
+0001e940: 7369 6e67 2076 616c 7565 7320 6669 6c6c  sing values fill
+0001e950: 6564 2069 6e2e 200a 2020 2020 2222 220a  ed in. .    """.
+0001e960: 0a20 2020 2069 6620 6e70 2e61 6c6c 286e  .    if np.all(n
+0001e970: 702e 6973 6669 6e69 7465 2864 6174 6129  p.isfinite(data)
+0001e980: 293a 0a20 2020 2020 2020 2070 7269 6e74  ):.        print
+0001e990: 2827 4e6f 206d 6973 7369 6e67 2076 616c  ('No missing val
+0001e9a0: 7565 7320 696e 2064 6174 612c 2072 6574  ues in data, ret
+0001e9b0: 7572 6e69 6e67 206f 7269 6769 6e61 6c20  urning original 
+0001e9c0: 6172 7261 792e 2729 0a20 2020 2020 2020  array.').       
+0001e9d0: 2072 6574 7572 6e20 6461 7461 200a 0a20   return data .. 
+0001e9e0: 2020 2069 6620 6c65 6e28 6461 7461 2e73     if len(data.s
+0001e9f0: 6861 7065 2920 3d3d 2031 3a0a 2020 2020  hape) == 1:.    
+0001ea00: 2020 2020 6d61 736b 203d 206e 702e 7768      mask = np.wh
+0001ea10: 6572 6528 6e70 2e69 7366 696e 6974 6528  ere(np.isfinite(
+0001ea20: 6461 7461 2929 5b30 5d0a 2020 2020 2020  data))[0].      
+0001ea30: 2020 6d65 6469 616e 203d 206e 702e 6d65    median = np.me
+0001ea40: 6469 616e 2864 6174 615b 6d61 736b 5d29  dian(data[mask])
+0001ea50: 0a20 2020 2020 2020 2064 6174 615b 6e70  .        data[np
+0001ea60: 2e69 736e 616e 2864 6174 6129 5d20 3d20  .isnan(data)] = 
+0001ea70: 6d65 6469 616e 200a 0a20 2020 2020 2020  median ..       
+0001ea80: 2072 6574 7572 6e20 6461 7461 0a0a 2020   return data..  
+0001ea90: 2020 4e79 2c20 4e78 203d 2064 6174 612e    Ny, Nx = data.
+0001eaa0: 7368 6170 650a 2020 2020 696d 7075 7465  shape.    impute
+0001eab0: 645f 6461 7461 203d 206e 702e 7a65 726f  d_data = np.zero
+0001eac0: 7328 284e 792c 4e78 2929 0a0a 2020 2020  s((Ny,Nx))..    
+0001ead0: 666f 7220 6920 696e 2072 616e 6765 284e  for i in range(N
+0001eae0: 7829 3a0a 2020 2020 2020 2020 6d61 736b  x):.        mask
+0001eaf0: 203d 206e 702e 7768 6572 6528 6e70 2e69   = np.where(np.i
+0001eb00: 7366 696e 6974 6528 6461 7461 5b3a 2c69  sfinite(data[:,i
+0001eb10: 5d29 295b 305d 0a20 2020 2020 2020 206d  ]))[0].        m
+0001eb20: 6564 6961 6e20 3d20 6e70 2e6d 6564 6961  edian = np.media
+0001eb30: 6e28 6461 7461 5b3a 2c69 5d5b 6d61 736b  n(data[:,i][mask
+0001eb40: 5d29 0a0a 2020 2020 2020 2020 666f 7220  ])..        for 
+0001eb50: 6a20 696e 2072 616e 6765 284e 7929 3a0a  j in range(Ny):.
+0001eb60: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001eb70: 702e 6973 6e61 6e28 6461 7461 5b6a 2c69  p.isnan(data[j,i
+0001eb80: 5d29 203d 3d20 5472 7565 206f 7220 6e70  ]) == True or np
+0001eb90: 2e69 7369 6e66 2864 6174 615b 6a2c 695d  .isinf(data[j,i]
+0001eba0: 2920 3d3d 2054 7275 653a 0a20 2020 2020  ) == True:.     
+0001ebb0: 2020 2020 2020 2020 2020 2069 6d70 7574             imput
+0001ebc0: 6564 5f64 6174 615b 6a2c 695d 203d 206d  ed_data[j,i] = m
+0001ebd0: 6564 6961 6e0a 2020 2020 2020 2020 2020  edian.          
+0001ebe0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001ebf0: 2020 2020 2020 2020 696d 7075 7465 645f          imputed_
+0001ec00: 6461 7461 5b6a 2c69 5d20 3d20 6461 7461  data[j,i] = data
+0001ec10: 5b6a 2c69 5d0a 0a20 2020 2072 6574 7572  [j,i]..    retur
+0001ec20: 6e20 696d 7075 7465 645f 6461 7461 200a  n imputed_data .
+0001ec30: 0a64 6566 204b 4e4e 5f69 6d70 7574 6174  .def KNN_imputat
+0001ec40: 696f 6e28 6461 7461 2c20 696d 7075 7465  ion(data, impute
+0001ec50: 723d 4e6f 6e65 2c20 6b3d 3329 3a0a 2020  r=None, k=3):.  
+0001ec60: 2020 2222 220a 2020 2020 5065 7266 6f72    """.    Perfor
+0001ec70: 6d73 206b 2d4e 6561 7265 7374 204e 6569  ms k-Nearest Nei
+0001ec80: 6768 626f 7220 696d 7075 7461 7469 6f6e  ghbor imputation
+0001ec90: 2061 6e64 2074 7261 6e73 666f 726d 6174   and transformat
+0001eca0: 696f 6e2e 0a20 2020 2042 7920 6465 6661  ion..    By defa
+0001ecb0: 756c 7420 7468 6520 696d 7075 7465 7220  ult the imputer 
+0001ecc0: 7769 6c6c 2062 6520 6372 6561 7465 6420  will be created 
+0001ecd0: 616e 6420 7265 7475 726e 6564 2c20 756e  and returned, un
+0001ece0: 6c65 7373 0a20 2020 2074 6865 2069 6d70  less.    the imp
+0001ecf0: 7574 6572 2061 7267 756d 656e 7420 6973  uter argument is
+0001ed00: 2073 6574 2c20 696e 2077 6869 6368 2063   set, in which c
+0001ed10: 6173 6520 6f6e 6c79 2074 6865 2074 7261  ase only the tra
+0001ed20: 6e73 666f 726d 6564 0a20 2020 2064 6174  nsformed.    dat
+0001ed30: 6120 6973 206f 7574 7075 742e 200a 0a20  a is output. .. 
+0001ed40: 2020 2041 7320 7468 6973 2062 756e 646c     As this bundl
+0001ed50: 6573 206e 6569 6768 626f 7273 2061 6363  es neighbors acc
+0001ed60: 6f72 6469 6e67 2074 6f20 7468 6569 7220  ording to their 
+0001ed70: 6575 636c 6564 6961 6e20 6469 7374 616e  eucledian distan
+0001ed80: 6365 2c0a 2020 2020 6974 2069 7320 7365  ce,.    it is se
+0001ed90: 6e73 6974 6976 6520 746f 206f 7574 6c69  nsitive to outli
+0001eda0: 6572 732e 2043 616e 2061 6c73 6f20 7969  ers. Can also yi
+0001edb0: 656c 6420 7765 616b 2070 7265 6469 6374  eld weak predict
+0001edc0: 696f 6e73 2069 6620 7468 650a 2020 2020  ions if the.    
+0001edd0: 7472 6169 6e69 6e67 2066 6561 7475 7265  training feature
+0001ede0: 7320 6172 6520 6865 6176 696c 6979 2063  s are heaviliy c
+0001edf0: 6f72 7265 6c61 7465 642e 0a20 2020 200a  orrelated..    .
+0001ee00: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+0001ee10: 2020 696d 7075 7465 7220 286f 7074 696f    imputer (optio
+0001ee20: 6e61 6c29 3a20 4120 4b4e 4e49 6d70 7574  nal): A KNNImput
+0001ee30: 6572 2063 6c61 7373 2069 6e73 7461 6e63  er class instanc
+0001ee40: 652c 2063 6f6e 6669 6775 7265 6420 7573  e, configured us
+0001ee50: 696e 6720 736b 6c65 6172 6e2e 696d 7075  ing sklearn.impu
+0001ee60: 7465 2e4b 4e4e 496d 7075 7465 722e 0a20  te.KNNImputer.. 
+0001ee70: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
+0001ee80: 6c74 7320 746f 204e 6f6e 652c 2069 6e20  lts to None, in 
+0001ee90: 7768 6963 6820 6361 7365 2074 6865 2074  which case the t
+0001eea0: 7261 6e73 666f 726d 6174 696f 6e20 6973  ransformation is
+0001eeb0: 2063 7265 6174 6564 2075 7369 6e67 0a20   created using. 
+0001eec0: 2020 2020 2020 2020 2020 2074 6865 2064             the d
+0001eed0: 6174 6120 6974 7365 6c66 2e20 0a20 2020  ata itself. .   
+0001eee0: 2020 2020 2064 6174 6120 286e 6461 7272       data (ndarr
+0001eef0: 6179 293a 2031 4420 6172 7261 7920 6966  ay): 1D array if
+0001ef00: 2073 696e 676c 6520 7061 7261 6d65 7465   single paramete
+0001ef10: 7220 6973 2069 6e70 7574 2e20 4966 0a20  r is input. If. 
+0001ef20: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+0001ef30: 6973 2032 2d64 696d 656e 7369 6f6e 616c  is 2-dimensional
+0001ef40: 2c20 7468 6520 6d65 6469 616e 7320 7769  , the medians wi
+0001ef50: 6c6c 2062 6520 6361 6c63 756c 6174 6564  ll be calculated
+0001ef60: 0a20 2020 2020 2020 2020 2020 2075 7369  .            usi
+0001ef70: 6e67 2074 6865 206e 6f6e 2d6d 6973 7369  ng the non-missi
+0001ef80: 6e67 2076 616c 7565 7320 696e 2065 6163  ng values in eac
+0001ef90: 6820 636f 7272 6573 706f 6e64 696e 6720  h corresponding 
+0001efa0: 636f 6c75 6d6e 2e0a 2020 2020 2020 2020  column..        
+0001efb0: 6b20 2869 6e74 2c20 6f70 7469 6f6e 616c  k (int, optional
+0001efc0: 293a 2049 6620 696d 7075 7465 7220 6973  ): If imputer is
+0001efd0: 204e 6f6e 652c 2074 6869 7320 6973 2074   None, this is t
+0001efe0: 6865 206e 756d 6265 720a 2020 2020 2020  he number.      
+0001eff0: 2020 2020 2020 6f66 206e 6561 7265 7374        of nearest
+0001f000: 206e 6569 6768 626f 7273 2074 6f20 636f   neighbors to co
+0001f010: 6e73 6964 6572 2077 6865 6e20 636f 6d70  nsider when comp
+0001f020: 7574 696e 6720 7468 6520 696d 7075 7461  uting the imputa
+0001f030: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
+0001f040: 2020 4465 6661 756c 7473 2074 6f20 332e    Defaults to 3.
+0001f050: 2049 6620 696d 7075 7465 7220 6172 6775   If imputer argu
+0001f060: 6d65 6e74 2069 7320 7365 742c 2074 6869  ment is set, thi
+0001f070: 7320 7661 7269 6162 6c65 2069 7320 6967  s variable is ig
+0001f080: 6e6f 7265 642e 0a0a 2020 2020 4e6f 7465  nored...    Note
+0001f090: 3a0a 2020 2020 2020 2020 5461 6e67 2026  :.        Tang &
+0001f0a0: 2049 7368 7761 7261 6e20 3230 3137 2072   Ishwaran 2017 r
+0001f0b0: 6570 6f72 7465 6420 7468 6174 2069 6620  eported that if 
+0001f0c0: 7468 6572 6520 6973 206c 6f77 2074 6f20  there is low to 
+0001f0d0: 6d65 6469 756d 0a20 2020 2020 2020 2063  medium.        c
+0001f0e0: 6f72 7265 6c61 7469 6f6e 2069 6e20 7468  orrelation in th
+0001f0f0: 6520 6461 7461 7365 742c 2052 4620 696d  e dataset, RF im
+0001f100: 7075 7461 7469 6f6e 2061 6c67 6f72 6974  putation algorit
+0001f110: 686d 7320 7065 7266 6f72 6d20 0a20 2020  hms perform .   
+0001f120: 2020 2020 2062 6574 7465 7220 7468 616e       better than
+0001f130: 204b 4e4e 2069 6d70 7574 6174 696f 6e0a   KNN imputation.
+0001f140: 0a20 2020 2045 7861 6d70 6c65 3a0a 2020  .    Example:.  
+0001f150: 2020 2020 2020 4966 2077 6520 6861 7665        If we have
+0001f160: 206f 7572 2074 7261 696e 696e 6720 6461   our training da
+0001f170: 7461 2069 6e20 616e 2061 7272 6179 2063  ta in an array c
+0001f180: 616c 6c65 6420 7472 6169 6e69 6e67 5f73  alled training_s
+0001f190: 6574 2c20 7765 200a 2020 2020 2020 2020  et, we .        
+0001f1a0: 6361 6e20 6372 6561 7465 2074 6865 2069  can create the i
+0001f1b0: 6d70 7574 6572 2073 6f20 7468 6174 2077  mputer so that w
+0001f1c0: 6520 6361 6e20 6361 6c6c 2069 7420 746f  e can call it to
+0001f1d0: 2074 7261 6e73 666f 726d 206e 6577 2064   transform new d
+0001f1e0: 6174 610a 2020 2020 2020 2020 7768 656e  ata.        when
+0001f1f0: 206d 616b 696e 6720 6f6e 2d74 6865 2d66   making on-the-f
+0001f200: 6965 6c64 2070 7265 6469 6374 696f 6e73  ield predictions
+0001f210: 2e0a 0a20 2020 2020 2020 203e 3e3e 2069  ...        >>> i
+0001f220: 6d70 7574 6564 5f64 6174 612c 206b 6e6e  mputed_data, knn
+0001f230: 5f69 6d70 7574 6572 203d 204b 4e4e 5f69  _imputer = KNN_i
+0001f240: 6d70 7574 6174 696f 6e28 6461 7461 3d74  mputation(data=t
+0001f250: 7261 696e 696e 675f 7365 742c 2069 6d70  raining_set, imp
+0001f260: 7574 6572 3d4e 6f6e 6529 0a20 2020 2020  uter=None).     
+0001f270: 2020 200a 2020 2020 2020 2020 4e6f 7720     .        Now 
+0001f280: 7765 2063 616e 2075 7365 2074 6865 2069  we can use the i
+0001f290: 6d70 7574 6564 2064 6174 6120 746f 2063  mputed data to c
+0001f2a0: 7265 6174 6520 6f75 7220 6d61 6368 696e  reate our machin
+0001f2b0: 6520 6c65 6172 6e69 6e67 206d 6f64 656c  e learning model
+0001f2c0: 2e0a 2020 2020 2020 2020 4166 7465 7277  ..        Afterw
+0001f2d0: 6172 6473 2c20 7768 656e 206e 6577 2064  ards, when new d
+0001f2e0: 6174 6120 6973 2069 6e70 7574 2066 6f72  ata is input for
+0001f2f0: 2070 7265 6469 6374 696f 6e2c 2077 6520   prediction, we 
+0001f300: 7769 6c6c 2069 6e73 6572 7420 6f75 7220  will insert our 
+0001f310: 0a20 2020 2020 2020 2069 6d70 7574 6572  .        imputer
+0001f320: 2069 6e74 6f20 7468 6520 7069 7065 6c69   into the pipeli
+0001f330: 6e65 6e20 6279 2063 616c 6c69 6e67 2074  nen by calling t
+0001f340: 6869 7320 6675 6e63 7469 6f6e 2061 6761  his function aga
+0001f350: 696e 2c20 6275 7420 7468 6973 2074 696d  in, but this tim
+0001f360: 650a 2020 2020 2020 2020 7769 7468 2074  e.        with t
+0001f370: 6865 2069 6d70 7574 6572 2061 7267 756d  he imputer argum
+0001f380: 656e 7420 7365 743a 0a0a 2020 2020 2020  ent set:..      
+0001f390: 2020 3e3e 3e20 6e65 775f 6461 7461 203d    >>> new_data =
+0001f3a0: 206b 6e6e 5f69 6d70 7574 6174 696f 6e28   knn_imputation(
+0001f3b0: 6e65 775f 6461 7461 2c20 696d 7075 7465  new_data, impute
+0001f3c0: 723d 6b6e 6e5f 696d 7075 7465 7229 0a0a  r=knn_imputer)..
+0001f3d0: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+0001f3e0: 2020 2020 2054 6865 2066 6972 7374 206f       The first o
+0001f3f0: 7574 7075 7420 6973 2074 6865 2064 6174  utput is the dat
+0001f400: 6120 6172 7261 7920 7769 7468 2077 6974  a array with wit
+0001f410: 6820 7468 6520 6d69 7373 696e 6720 7661  h the missing va
+0001f420: 6c75 6573 2066 696c 6c65 6420 696e 2e20  lues filled in. 
+0001f430: 0a20 2020 2020 2020 2054 6865 2073 6563  .        The sec
+0001f440: 6f6e 6420 6f75 7470 7574 2069 7320 7468  ond output is th
+0001f450: 6520 4b4e 4e20 496d 7075 7465 7220 7468  e KNN Imputer th
+0001f460: 6174 2073 686f 756c 6420 6265 2075 7365  at should be use
+0001f470: 6420 746f 2074 7261 6e73 666f 726d 0a20  d to transform. 
+0001f480: 2020 2020 2020 206e 6577 2064 6174 612c         new data,
+0001f490: 2070 7269 6f72 2074 6f20 7072 6564 6963   prior to predic
+0001f4a0: 7469 6f6e 732e 200a 2020 2020 2222 220a  tions. .    """.
+0001f4b0: 0a20 2020 2069 6620 696d 7075 7465 7220  .    if imputer 
+0001f4c0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0001f4d0: 2069 6d70 7574 6572 203d 204b 4e4e 496d   imputer = KNNIm
+0001f4e0: 7075 7465 7228 6e5f 6e65 6967 6862 6f72  puter(n_neighbor
+0001f4f0: 733d 6b29 0a20 2020 2020 2020 2069 6d70  s=k).        imp
+0001f500: 7574 6572 2e66 6974 2864 6174 6129 0a20  uter.fit(data). 
+0001f510: 2020 2020 2020 2069 6d70 7574 6564 5f64         imputed_d
+0001f520: 6174 6120 3d20 696d 7075 7465 722e 7472  ata = imputer.tr
+0001f530: 616e 7366 6f72 6d28 6461 7461 290a 2020  ansform(data).  
+0001f540: 2020 2020 2020 7265 7475 726e 2069 6d70        return imp
+0001f550: 7574 6564 5f64 6174 612c 2069 6d70 7574  uted_data, imput
+0001f560: 6572 0a0a 2020 2020 7265 7475 726e 2069  er..    return i
+0001f570: 6d70 7574 6572 2e74 7261 6e73 666f 726d  mputer.transform
+0001f580: 2864 6174 6129 200a 0a63 6c61 7373 2049  (data) ..class I
+0001f590: 6e70 7574 5469 6d65 6f75 743a 0a20 2020  nputTimeout:.   
+0001f5a0: 2022 2222 0a20 2020 2041 2063 6c61 7373   """.    A class
+0001f5b0: 2066 6f72 2072 6561 6469 6e67 2075 7365   for reading use
+0001f5c0: 7220 696e 7075 7420 7769 7468 2061 2074  r input with a t
+0001f5d0: 696d 656f 7574 206f 6e20 4c69 6e75 782c  imeout on Linux,
+0001f5e0: 2075 7365 6420 696e 2074 6865 2043 4e4e   used in the CNN
+0001f5f0: 206f 7074 696d 697a 6174 696f 6e20 726f   optimization ro
+0001f600: 7574 696e 652e 200a 0a20 2020 2045 7861  utine. ..    Exa
+0001f610: 6d70 6c65 3a0a 0a20 2020 2020 2020 2069  mple:..        i
+0001f620: 6e70 7574 5f74 696d 656f 7574 203d 2049  nput_timeout = I
+0001f630: 6e70 7574 5469 6d65 6f75 7428 2245 6e74  nputTimeout("Ent
+0001f640: 6572 2079 6f75 7220 696e 7075 743a 2022  er your input: "
+0001f650: 2c20 3529 0a20 2020 2020 2020 2074 7279  , 5).        try
+0001f660: 3a0a 2020 2020 2020 2020 2020 2020 7573  :.            us
+0001f670: 6572 5f69 6e70 7574 203d 2069 6e70 7574  er_input = input
+0001f680: 5f74 696d 656f 7574 2e69 6e70 7574 696d  _timeout.inputim
+0001f690: 656f 7574 2829 0a20 2020 2020 2020 2020  eout().         
+0001f6a0: 2020 2070 7269 6e74 2822 5573 6572 2069     print("User i
+0001f6b0: 6e70 7574 3a22 2c20 7573 6572 5f69 6e70  nput:", user_inp
+0001f6c0: 7574 290a 2020 2020 2020 2020 6578 6365  ut).        exce
+0001f6d0: 7074 2049 6e70 7574 5469 6d65 6f75 742e  pt InputTimeout.
+0001f6e0: 5469 6d65 6f75 744f 6363 7572 7265 643a  TimeoutOccurred:
+0001f6f0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001f700: 6e74 2822 5469 6d65 6f75 7420 6f63 6375  nt("Timeout occu
+0001f710: 7272 6564 2e20 4e6f 2069 6e70 7574 2072  rred. No input r
+0001f720: 6563 6569 7665 642e 2229 0a0a 2020 2020  eceived.")..    
+0001f730: 4174 7472 6962 7574 6573 3a0a 2020 2020  Attributes:.    
+0001f740: 2020 2020 7072 6f6d 7074 2028 7374 7229      prompt (str)
+0001f750: 3a20 5468 6520 7072 6f6d 7074 206d 6573  : The prompt mes
+0001f760: 7361 6765 2074 6f20 6469 7370 6c61 7920  sage to display 
+0001f770: 746f 2074 6865 2075 7365 722e 0a20 2020  to the user..   
+0001f780: 2020 2020 2074 696d 656f 7574 2028 666c       timeout (fl
+0001f790: 6f61 7429 3a20 5468 6520 6e75 6d62 6572  oat): The number
+0001f7a0: 206f 6620 7365 636f 6e64 7320 746f 2077   of seconds to w
+0001f7b0: 6169 7420 666f 7220 696e 7075 7420 6265  ait for input be
+0001f7c0: 666f 7265 2074 696d 696e 6720 6f75 742e  fore timing out.
+0001f7d0: 0a20 2020 200a 2020 2020 4d65 7468 6f64  .    .    Method
+0001f7e0: 733a 0a20 2020 2020 2020 2069 6e70 7574  s:.        input
+0001f7f0: 696d 656f 7574 2829 3a20 5265 6164 7320  imeout(): Reads 
+0001f800: 7573 6572 2069 6e70 7574 2066 726f 6d20  user input from 
+0001f810: 7468 6520 636f 6d6d 616e 6420 6c69 6e65  the command line
+0001f820: 2077 6974 6820 6120 7469 6d65 6f75 742e   with a timeout.
+0001f830: 2049 6620 6e6f 2069 6e70 7574 2069 730a   If no input is.
+0001f840: 2020 2020 2020 2020 2020 2020 7265 6365              rece
+0001f850: 6976 6564 2077 6974 6869 6e20 7468 6520  ived within the 
+0001f860: 7370 6563 6966 6965 6420 7469 6d65 6f75  specified timeou
+0001f870: 742c 2061 2054 696d 656f 7574 4f63 6375  t, a TimeoutOccu
+0001f880: 7272 6564 2065 7863 6570 7469 6f6e 2069  rred exception i
+0001f890: 7320 7261 6973 6564 2e0a 2020 2020 2222  s raised..    ""
+0001f8a0: 220a 0a20 2020 2063 6c61 7373 2054 696d  "..    class Tim
+0001f8b0: 656f 7574 4f63 6375 7272 6564 2845 7863  eoutOccurred(Exc
+0001f8c0: 6570 7469 6f6e 293a 0a20 2020 2020 2020  eption):.       
+0001f8d0: 2070 6173 730a 2020 2020 0a20 2020 2064   pass.    .    d
+0001f8e0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+0001f8f0: 2c20 7072 6f6d 7074 3d27 272c 2074 696d  , prompt='', tim
+0001f900: 656f 7574 3d33 3029 3a0a 2020 2020 2020  eout=30):.      
+0001f910: 2020 7365 6c66 2e70 726f 6d70 7420 3d20    self.prompt = 
+0001f920: 7072 6f6d 7074 0a20 2020 2020 2020 2073  prompt.        s
+0001f930: 656c 662e 7469 6d65 6f75 7420 3d20 7469  elf.timeout = ti
+0001f940: 6d65 6f75 740a 2020 2020 2020 2020 7365  meout.        se
+0001f950: 6c66 2e65 6368 6f20 3d20 7365 6c66 2e5f  lf.echo = self._
+0001f960: 6563 686f 5f70 6f73 6978 0a20 2020 2020  echo_posix.     
+0001f970: 2020 2073 656c 662e 696e 7075 7469 6d65     self.inputime
+0001f980: 6f75 7420 3d20 7365 6c66 2e5f 696e 7075  out = self._inpu
+0001f990: 7469 6d65 6f75 745f 706f 7369 780a 2020  timeout_posix.  
+0001f9a0: 2020 0a20 2020 2064 6566 205f 6563 686f    .    def _echo
+0001f9b0: 5f70 6f73 6978 2873 656c 662c 2073 7472  _posix(self, str
+0001f9c0: 696e 6729 3a0a 2020 2020 2020 2020 7379  ing):.        sy
+0001f9d0: 732e 7374 646f 7574 2e77 7269 7465 2873  s.stdout.write(s
+0001f9e0: 7472 696e 6729 0a20 2020 2020 2020 2073  tring).        s
+0001f9f0: 7973 2e73 7464 6f75 742e 666c 7573 6828  ys.stdout.flush(
+0001fa00: 290a 2020 2020 2020 2020 0a20 2020 2064  ).        .    d
+0001fa10: 6566 205f 696e 7075 7469 6d65 6f75 745f  ef _inputimeout_
+0001fa20: 706f 7369 7828 7365 6c66 293a 0a20 2020  posix(self):.   
+0001fa30: 2020 2020 2073 656c 662e 6563 686f 2873       self.echo(s
+0001fa40: 656c 662e 7072 6f6d 7074 290a 2020 2020  elf.prompt).    
+0001fa50: 2020 2020 7365 6c20 3d20 7365 6c65 6374      sel = select
+0001fa60: 6f72 732e 4465 6661 756c 7453 656c 6563  ors.DefaultSelec
+0001fa70: 746f 7228 290a 2020 2020 2020 2020 7365  tor().        se
+0001fa80: 6c2e 7265 6769 7374 6572 2873 7973 2e73  l.register(sys.s
+0001fa90: 7464 696e 2c20 7365 6c65 6374 6f72 732e  tdin, selectors.
+0001faa0: 4556 454e 545f 5245 4144 290a 2020 2020  EVENT_READ).    
+0001fab0: 2020 2020 6576 656e 7473 203d 2073 656c      events = sel
+0001fac0: 2e73 656c 6563 7428 7365 6c66 2e74 696d  .select(self.tim
+0001fad0: 656f 7574 290a 0a20 2020 2020 2020 2069  eout)..        i
+0001fae0: 6620 6576 656e 7473 3a0a 2020 2020 2020  f events:.      
+0001faf0: 2020 2020 2020 6b65 792c 205f 203d 2065        key, _ = e
+0001fb00: 7665 6e74 735b 305d 0a20 2020 2020 2020  vents[0].       
+0001fb10: 2020 2020 2072 6574 7572 6e20 6b65 792e       return key.
+0001fb20: 6669 6c65 6f62 6a2e 7265 6164 6c69 6e65  fileobj.readline
+0001fb30: 2829 2e72 7374 7269 7028 275c 6e27 290a  ().rstrip('\n').
+0001fb40: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001fb50: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
+0001fb60: 6368 6f28 275c 6e27 290a 2020 2020 2020  cho('\n').      
+0001fb70: 2020 2020 2020 7465 726d 696f 732e 7463        termios.tc
+0001fb80: 666c 7573 6828 7379 732e 7374 6469 6e2c  flush(sys.stdin,
+0001fb90: 2074 6572 6d69 6f73 2e54 4349 464c 5553   termios.TCIFLUS
+0001fba0: 4829 0a20 2020 2020 2020 2020 2020 2072  H).            r
+0001fbb0: 6169 7365 2073 656c 662e 5469 6d65 6f75  aise self.Timeou
+0001fbc0: 744f 6363 7572 7265 640a 2020 2020 2020  tOccurred.      
+0001fbd0: 2020 2020 2020 0a                              .
```

### Comparing `MicroLIA-2.0.1/MicroLIA/quality_check.py` & `MicroLIA-2.0.5/MicroLIA/quality_check.py`

 * *Files identical despite different names*

### Comparing `MicroLIA-2.0.1/MicroLIA/simulate.py` & `MicroLIA-2.0.5/MicroLIA/simulate.py`

 * *Files identical despite different names*

### Comparing `MicroLIA-2.0.1/MicroLIA/training_set.py` & `MicroLIA-2.0.5/MicroLIA/training_set.py`

 * *Files 18% similar despite different names*

```diff
@@ -8,28 +8,30 @@
 import random
 from pathlib import Path
 import pkg_resources
 from warnings import warn
 from inspect import getmembers, isfunction
 
 import numpy as np
+import matplotlib.pyplot as plt  
 from pandas import DataFrame
 from astropy.io import fits
 from progress import bar
 from astropy.io.votable import parse_single_table
 from sklearn import decomposition
 
 from MicroLIA import simulate
 from MicroLIA import noise_models
 from MicroLIA import quality_check
 from MicroLIA import extract_features
 from MicroLIA import features
 
 def create(timestamps, load_microlensing=None, min_mag=14, max_mag=21, noise=None, zp=24, exptime=60, 
-    n_class=500, ml_n1=7, cv_n1=7, cv_n2=1, t0_dist=None, u0_dist=None, tE_dist=None, filename='', save_file=True):
+    n_class=500, ml_n1=7, cv_n1=7, cv_n2=1, t0_dist=None, u0_dist=None, tE_dist=None, filename='', 
+    apply_weights=True, save_file=True):
     """
     Creates a training dataset using adaptive cadence.
     Simulates each class n_class times, adding errors from
     a noise model either defined using the create_noise
     function, or Gaussian by default.
 
     Note:
@@ -98,14 +100,17 @@
         considered during the microlensing simulations. The indivial
         tE per simulation will be selected from a uniform distribution
         between these two values.
     filename: str, optional
         The name to be appended to the lightcurves.fits and the all_features.txt
         files, only relevant if save_file=True. If no argument is input the
         files will be saved with the default names only.
+    apply_weights: bool 
+        Whether to apply the photometric errors when calculating the features. Defaults
+        to True. Note that this assumes that the erros are Gaussian and uncorrelated. 
     save_file: bool
         If True the lightcurve.fits and all_features.txt files will be
         saved to the home directory. Defaults to True.
 
     Outputs
     _______
     data_x : array
@@ -115,15 +120,15 @@
     dataset : FITS
         All simulated lightcurves in a FITS file, sorted by class and ID
     all_features : txt file
         A txt file containing all the features plus class label and ID.
     """
 
     if len(getmembers(features, isfunction))*2 > n_class*5:
-        raise ValueError("Parameter n_class must be at least "+str(int(1+len(getmembers(features, isfunction))*2//5))+" for principal components to be computed.")
+        print("WARNING: Parameter n_class must be at least "+str(int(1+len(getmembers(features, isfunction))*2//5))+" for principal components to be computed.")
 
     while True:
         try:
             len(timestamps[0])
             break
         except TypeError:
             raise ValueError("Incorrect format -- append the timestamps to a list and try again.")
@@ -152,15 +157,15 @@
         id_num = [k]*len(time)
         id_list.append(id_num)
 
         times_list.append(time)
         mag_list.append(mag)
         magerr_list.append(magerr)
         
-        stats, feature_names = extract_features.extract_all(time, mag, magerr, convert=True, zp=zp, return_names=True)
+        stats, feature_names = extract_features.extract_all(time, mag, magerr, apply_weights=apply_weights, convert=True, zp=zp, return_names=True)
         stats = [i for i in stats]
         stats = ['VARIABLE'] + [k] + stats
         stats_list.append(stats)
         progess_bar.next()
     progess_bar.finish()
 
     progess_bar = bar.FillingSquaresBar('Simulating constants......', max=n_class)
@@ -180,15 +185,15 @@
         id_num = [1*n_class+k]*len(time)
         id_list.append(id_num)
 
         times_list.append(time)
         mag_list.append(mag)
         magerr_list.append(magerr)
         
-        stats = extract_features.extract_all(time, mag, magerr, convert=True, zp=zp)
+        stats = extract_features.extract_all(time, mag, magerr, apply_weights=apply_weights, convert=True, zp=zp)
         stats = [i for i in stats]
         stats = ['CONSTANT'] + [1*n_class+k] + stats
         stats_list.append(stats) 
         progess_bar.next()  
     progess_bar.finish()
 
     progess_bar = bar.FillingSquaresBar('Simulating CV.............', max=n_class)   
@@ -217,15 +222,15 @@
                 id_num = [2*n_class+k]*len(time)
                 id_list.append(id_num)
             
                 times_list.append(time)
                 mag_list.append(mag)
                 magerr_list.append(magerr)
                 
-                stats = extract_features.extract_all(time, mag, magerr, convert=True, zp=zp)
+                stats = extract_features.extract_all(time, mag, magerr, apply_weights=apply_weights, convert=True, zp=zp)
                 stats = [i for i in stats]
                 stats = ['CV'] + [2*n_class+k] + stats
                 stats_list.append(stats)
                 progess_bar.next()
                 break
 
             if j == 99:
@@ -263,15 +268,15 @@
         id_num = [4*n_class+k]*len(time)
         id_list.append(id_num)
 
         times_list.append(time)
         mag_list.append(mag)
         magerr_list.append(magerr)
         
-        stats = extract_features.extract_all(time, mag, magerr, convert=True, zp=zp)
+        stats = extract_features.extract_all(time, mag, magerr, apply_weights=apply_weights, convert=True, zp=zp)
         stats = [i for i in stats]
         stats = ['LPV'] + [4*n_class+k] + stats
         stats_list.append(stats)
         progess_bar.next()
     progess_bar.finish()
 
     if load_microlensing is None:
@@ -301,15 +306,15 @@
                     id_num = [3*n_class+k]*len(time)
                     id_list.append(id_num)
                 
                     times_list.append(time)
                     mag_list.append(mag)
                     magerr_list.append(magerr)
                    
-                    stats = extract_features.extract_all(time, mag, magerr, convert=True, zp=zp)
+                    stats = extract_features.extract_all(time, mag, magerr, apply_weights=apply_weights, convert=True, zp=zp)
                     stats = [i for i in stats]
                     stats = ['ML'] + [3*n_class+k] + stats
                     stats_list.append(stats)
                     progess_bar.next()
                     break
 
                 if j == 99:
@@ -326,15 +331,15 @@
                 id_num = [1*n_class+k+i]*len(time)
                 id_list.append(id_num)
 
                 times_list.append(time)
                 mag_list.append(mag)
                 magerr_list.append(magerr)
                 
-                stats = extract_features.extract_all(time, mag, magerr, convert=True, zp=zp)
+                stats = extract_features.extract_all(time, mag, magerr, apply_weights=apply_weights, convert=True, zp=zp)
                 stats = [i for i in stats]
                 stats = ['ML'] + [1*n_class+k+i] + stats
                 stats_list.append(stats) 
                 progess_bar.next()  
             progess_bar.finish()
             
         except: #If load_microlensing is a path 
@@ -356,15 +361,15 @@
                 id_num = [1*n_class+k+i]*len(time)
                 id_list.append(id_num)
 
                 times_list.append(time)
                 mag_list.append(mag)
                 magerr_list.append(magerr)
                 
-                stats = extract_features.extract_all(time, mag, magerr, convert=True, zp=zp)
+                stats = extract_features.extract_all(time, mag, magerr, apply_weights=apply_weights, convert=True, zp=zp)
                 stats = [i for i in stats]
                 stats = ['ML'] + [1*n_class+k+i] + stats
                 stats_list.append(stats) 
                 progess_bar.next()  
             progess_bar.finish()
 
     if save_file:
@@ -375,42 +380,42 @@
         col1 = fits.Column(name='ID', format='E', array=np.hstack(id_list))
         col2 = fits.Column(name='time', format='D', array=np.hstack(times_list))
         col3 = fits.Column(name='mag', format='E', array=np.hstack(mag_list))
         col4 = fits.Column(name='magerr', format='E', array=np.hstack(magerr_list))
         cols = fits.ColDefs([col0, col1, col2, col3, col4])
         hdu = fits.BinTableHDU.from_columns(cols)
 
-        fname = Path('lightcurves'+filename+'.fits')
+        fname = Path('lightcurves_'+filename+'_.fits')
         if fname.exists(): #To avoid error if file already exists
             fname.unlink()
         hdu.writeto(path+str(fname),overwrite=True)
 
-        np.savetxt(path+'feats.txt',np.array(stats_list).astype(str),fmt='%s')
-        with open(path+'feats.txt', 'r') as infile, open(path+'all_features'+filename+'.txt', 'w') as outfile:    
+        np.savetxt(path+'temporary_feats.txt', np.array(stats_list).astype(str), fmt='%s')
+        with open(path+'temporary_feats.txt', 'r') as infile, open(path+'all_features_'+filename+'.txt', 'w') as outfile:    
             outfile.write('# FEAT NAMES # || ' + ' || '.join(feature_names) + '\n')
             data = infile.read()
             data = data.replace("'", "")
             data = data.replace(",", "")
             data = data.replace("[", "")
             data = data.replace("]", "")
             outfile.write(data)
-        os.remove(path+'feats.txt')
+        os.remove(path+'temporary_feats.txt')
 
     data = np.array(stats_list)
     data_x = data[:,2:].astype('float')
     data_y = data[:,0].astype(str)
 
     df = DataFrame(data_x, columns=feature_names)
     df['label'] = data_y
-    df.to_csv(path+'MicroLIA_Training_Set.csv', index=False)
+    df.to_csv(path+'MicroLIA_Training_Set_'+filename+'_.csv', index=False)
     print("Complete! Files saved in: {}".format(path))
 
     return data_x, data_y
 
-def load_all(path, convert=True, zp=24, filename='', save_file=True):
+def load_all(path, convert=True, zp=24, filename='', extract_all=True, apply_weights=True, save_file=True):
     """
     Function to load already simulated lightcurves. The subdirectories in the path
     must contain the lightcurve text files for each class (columns: time,mag,magerr)
 
     Note:
         If a file cannot be loaded with the standard numpy.loadtxt() function
         it will be printed and skipped, therefore no strings allowed, only the columns with the float numbers (nan ok)
@@ -418,20 +423,23 @@
     Args:
         path: str
             Path to the root directory containing the lightcurve subdirectories
         convert: bool
             If True the magnitudes will be converted to flux using the input zeropoint.
             If the lightcurves are already in flux, set convert=False. Defaults to True.
         zp: float
-            The zero point of the observing instrument, will be used when generating
-            the noise model. Defaults to 24.
+            The zero point of the observing instrument, will be used to calcualate 
+            the features. This is ignored used if convert=False. Defaults to 24.
         filename: str, optional
             The name to be appended to the lightcurves.fits and the all_features.txt
             files, only relevant if save_file=True. If no argument is input the
             files will be saved with the default names only.
+        apply_weights: bool 
+            Whether to apply the photometric errors when calculating the features. Defaults
+            to True. Note that this assumes that the erros are Gaussian and uncorrelated. 
         save_file: bool
             If True the lightcurve.fits and all_features.txt files will be
             saved to the home directory. Defaults to True.
 
     Outputs
     _______
     data_x : array
@@ -449,39 +457,41 @@
     times_list=[]
     mag_list=[]
     magerr_list=[]
     source_class_list=[]
     id_list=[]
     stats_list = []
 
+    k=0 #ID counter
     for i in range(len(sub_directories)):
         dir_name = sub_directories[i].split('/')[-1]
         filenames = [name for name in os.listdir(sub_directories[i])]
         progess_bar = bar.FillingSquaresBar('Loading '+dir_name+' lightcurves...', max=len(filenames)) 
         for j in range(len(filenames)):
+            k+=1
             try:
                 lightcurve = np.loadtxt(sub_directories[i]+'/'+filenames[j])
                 time, mag, magerr = lightcurve[:,0], lightcurve[:,1], lightcurve[:,2]
             except:
-                print('WARNING: File {} could not be loaded, skipping...'.format(filenames[j]))
+                print(); print('WARNING: File {} could not be loaded, skipping...'.format(filenames[j]))
                 continue
 
             source_class = [dir_name]*len(time)
             source_class_list.append(source_class)
 
-            id_num = [j]*len(time)
+            id_num = [k]*len(time)
             id_list.append(id_num)
 
             times_list.append(time)
             mag_list.append(mag)
             magerr_list.append(magerr)
 
-            stats, feature_names = extract_features.extract_all(time, mag, magerr, convert=convert, zp=zp, return_names=True)
+            stats, feature_names = extract_features.extract_all(time, mag, magerr, apply_weights=apply_weights, convert=convert, zp=zp, return_names=True)
             stats = [i for i in stats]
-            stats = [dir_name] + [j] + stats
+            stats = [dir_name] + [k] + stats
             stats_list.append(stats) 
             progess_bar.next()  
         progess_bar.finish()
 
     if save_file:
         print('Writing files to home directory...')
         path = str(Path.home())+'/'
@@ -490,34 +500,82 @@
         col1 = fits.Column(name='ID', format='E', array=np.hstack(id_list))
         col2 = fits.Column(name='time', format='D', array=np.hstack(times_list))
         col3 = fits.Column(name='mag', format='E', array=np.hstack(mag_list))
         col4 = fits.Column(name='magerr', format='E', array=np.hstack(magerr_list))
         cols = fits.ColDefs([col0, col1, col2, col3, col4])
         hdu = fits.BinTableHDU.from_columns(cols)
 
-        fname = Path('lightcurves'+filename+'.fits')
+        fname = Path('lightcurves_'+filename+'_.fits')
         if fname.exists(): #To avoid error if file already exists
             fname.unlink()
-        hdu.writeto(path+str(fname),overwrite=True)
+        hdu.writeto(path+str(fname), overwrite=True)
 
-        np.savetxt(path+'feats.txt',np.array(stats_list).astype(str),fmt='%s')
-        with open(path+'feats.txt', 'r') as infile, open(path+'all_features'+filename+'.txt', 'w') as outfile:    
+        np.savetxt(path+'temporary_feats.txt',np.array(stats_list).astype(str),fmt='%s')
+        with open(path+'temporary_feats.txt', 'r') as infile, open(path+'all_features_'+filename+'.txt', 'w') as outfile:    
             outfile.write('# ' + ', '.join(feature_names) + '\n')
             data = infile.read()
             data = data.replace("'", "")
             data = data.replace(",", "")
             data = data.replace("[", "")
             data = data.replace("]", "")
             outfile.write(data)
-        os.remove(path+'feats.txt')
+        os.remove(path+'temporary_feats.txt')
 
     data = np.array(stats_list)
     data_x = data[:,2:].astype('float')
     data_y = data[:,0].astype(str)
-
-    df = DataFrame(data_x, columns=feature_names[1:])
+    print(data_x.shape, len(feature_names))
+    df = DataFrame(data_x, columns=feature_names)
     df['label'] = data_y
     df.to_csv(path+'MicroLIA_Training_Set.csv', index=False)
     print("Complete! Files saved in: {}".format(path))
 
     return data_x, data_y
 
+def plot(hdu, ID=None, label=None, savefig=False):
+    """
+    Plots simulated lightcurve, extracted from the 
+    lightcurves.fits file that is saved upon training set
+    creation
+
+    Args:
+        hdu (fits file) : The loaded lightcurves.fits file.
+        ID (int, optional): The ID of the lightcurve to be plotted.
+            This input is overwritten if label is also input. Defaults to None.
+        label (str, optional): The class label of the lightcuve class
+            to be plotted, the lightcurve will be chosen randomly among
+            the class sample.
+        savefig (bool): If True the figure will be saved to the
+            working directory. Defaults to False, which will plot
+            the figure instead.
+
+        Returns:
+            AxesImage
+    """
+
+    classes = np.unique(np.array(hdu[1].data['Class']))
+
+    if ID is not None:
+        index = np.where(hdu[1].data['ID'] == ID)[0]
+    if label is not None:
+        index = np.where(hdu[1].data['Class'] == label)[0]
+        index = np.random.choice(index)
+        index = np.where(hdu[1].data['ID'] == hdu[1].data['ID'][index])[0]
+        if len(index) == 0:
+            raise ValueError('Could not find input class label, options are: {}'.format(classes))
+    else:
+        print('Plotting random lightcurve...')
+        index = np.random.choice(np.arange(len(hdu[1].data['Class'])))
+        index = np.where(hdu[1].data['ID'] == hdu[1].data['ID'][index])[0]
+
+    time, mag, magerr = hdu[1].data['time'][index], hdu[1].data['mag'][index], hdu[1].data['magerr'][index]
+    plt.errorbar(time, mag, magerr, fmt='ro--')
+    plt.gca().invert_yaxis()
+    plt.xlabel('Time (days)')
+    plt.ylabel('Mag')
+    plt.title(str(hdu[1].data['Class'][index[0]])+' || ID: '+str(int(hdu[1].data['ID'][index[0]])))
+
+    if savefig:
+        plt.savefig(str(hdu[1].data['Class'][index[0]])+'_ID_'+str(int(hdu[1].data['ID'][index[0]])), bbox_inches='tight', dpi=300)
+        plt.clf()
+    else:
+        plt.show()
```

### Comparing `MicroLIA-2.0.1/MicroLIA.egg-info/PKG-INFO` & `MicroLIA-2.0.5/MicroLIA.egg-info/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: MicroLIA
-Version: 2.0.1
+Version: 2.0.5
 Summary: Machine learning classifier for microlensing
 Home-page: https://github.com/Professor-G/MicroLIA
 Author: Daniel Godines
 Author-email: danielgodinez123@gmail.com
 License: GPL-3.0
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
```

### Comparing `MicroLIA-2.0.1/MicroLIA.egg-info/SOURCES.txt` & `MicroLIA-2.0.5/MicroLIA.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `MicroLIA-2.0.1/PKG-INFO` & `MicroLIA-2.0.5/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: MicroLIA
-Version: 2.0.1
+Version: 2.0.5
 Summary: Machine learning classifier for microlensing
 Home-page: https://github.com/Professor-G/MicroLIA
 Author: Daniel Godines
 Author-email: danielgodinez123@gmail.com
 License: GPL-3.0
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
```

### Comparing `MicroLIA-2.0.1/README.md` & `MicroLIA-2.0.5/README.md`

 * *Files identical despite different names*

### Comparing `MicroLIA-2.0.1/setup.py` & `MicroLIA-2.0.5/setup.py`

 * *Files 18% similar despite different names*

```diff
@@ -5,15 +5,15 @@
 @author: danielgodinez
 """
 from setuptools import setup, find_packages, Extension
 
 
 setup(
     name="MicroLIA",
-    version="2.0.1",
+    version="2.0.5",
     author="Daniel Godines",
     author_email="danielgodinez123@gmail.com",
     description="Machine learning classifier for microlensing",
     license='GPL-3.0',
     url = "https://github.com/Professor-G/MicroLIA",
     classifiers=[
 		'Development Status :: 5 - Production/Stable',
@@ -21,15 +21,15 @@
 		'Topic :: Software Development :: Build Tools',
         'License :: OSI Approved :: GNU General Public License v3 (GPLv3)',
 		'Programming Language :: Python :: 3',	   
 ],
     packages=find_packages('.'),
     install_requires = ['numpy','scikit-learn', 'scikit-optimize', 'astropy','scipy','peakutils',
         'progress', 'matplotlib', 'optuna', 'boruta', 'BorutaShap', 'xgboost', 'scikit-plot',
-        'tensorflow', 'pandas', 'dill', 'opencv-python'],
+        'tensorflow', 'pandas', 'dill', 'opencv-python', 'imbalanced-learn'],
     python_requires='>=3.7,<4',
     include_package_data=True,
     test_suite="nose.collector",
     package_data={
     '': ['Miras_vo.xml'],
 },
```

